(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Ee;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED="DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED="DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOAD_PROGRESS="GEOMETRY_LOAD_PROGRESS",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED",t.ACTORS_CHANGED="CORNERSTONE_ACTORS_CHANGED"})(Ee||(Ee={}));var gt;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(gt||(gt={}));var Bt;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(Bt||(Bt={}));var ao;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(ao||(ao={}));const ml={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6};var B4={BlendMode:ml};const{BlendMode:W0}=B4;var as;(function(t){t[t.COMPOSITE=W0.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=W0.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=W0.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=W0.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",t[t.LABELMAP_EDGE_PROJECTION_BLEND=W0.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"})(as||(as={}));var os;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition",t.AXIAL_REFORMAT="axial_reformat",t.CORONAL_REFORMAT="coronal_reformat",t.SAGITTAL_REFORMAT="sagittal_reformat",t.REFORMAT="reformat"})(os||(os={}));var Ff;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE",t.MESH="MESH"})(Ff||(Ff={}));var zd;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(zd||(zd={}));const xw=zd;var Hd;(function(t){t.PLY="PLY",t.STL="STL",t.OBJ="OBJ",t.VTP="VTP"})(Hd||(Hd={}));const Ew=Hd;var dr;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(dr||(dr={}));var jd;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(jd||(jd={}));const Ow=jd;var da;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated",t.CALIBRATED="Calibrated",t.UNKNOWN="Unknown"})(da||(da={}));var Or;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(Or||(Or={}));var ui;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(ui||(ui={}));var Al;(function(t){t.FRAME="f",t.SECOND="s"})(Al||(Al={}));const Rw=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return Al}},Symbol.toStringTag,{value:"Module"}));var Ur;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.FRAME_MODULE="frameModule",t.WADO_WEB_CLIENT="wadoWebClient",t.INSTANCE="instance",t.IMAGE_SOP_INSTANCE_REFERENCE="ImageSopInstanceReference",t.REFERENCED_SERIES_REFERENCE="ReferencedSeriesReference",t.PREDECESSOR_SEQUENCE="PredecessorSequence",t.STUDY_DATA="StudyData",t.SERIES_DATA="SeriesData",t.IMAGE_DATA="ImageData",t.RTSS_INSTANCE_DATA="RtssInstanceData",t.NEW_INSTANCE_DATA="NewInstanceData",t.RTSS_CONTOUR="metaRTSSContour",t.SEG_BIT="metaSegBitmap",t.SR_ANNOTATION="metaSrAnnotation"})(Ur||(Ur={}));var Kd;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(Kd||(Kd={}));var Uf;(function(t){t.RLE="RLE",t.Volume="Volume"})(Uf||(Uf={}));var vc;(function(t){t.Tiled="tiled",t.ContextPool="contextPool"})(vc||(vc={}));const Ra=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:as,CalibrationTypes:da,ContourType:xw,DynamicOperatorType:Ow,Events:Ee,get GenerateImageType(){return Kd},GeometryType:Ff,ImageQualityStatus:ui,InterpolationType:ao,MeshType:Ew,MetadataModules:Ur,OrientationAxis:os,RenderingEngineModeEnum:vc,RequestType:gt,VOILUTFunctionType:dr,VideoEnums:Rw,ViewportStatus:Or,ViewportType:Bt,VoxelManagerEnum:Uf},Symbol.toStringTag,{value:"Module"})),qd={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},dn={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(dn);const Ii=.001;function $4(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&$4(r)}return Object.freeze(t)}const Dw={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},oo=$4(Dw),W4=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],Mw={slicer3D:[160/255,164/255,217/255]},Gh=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:Mw,CPU_COLORMAPS:qd,EPSILON:Ii,MPR_CAMERA_VALUES:oo,RENDERING_DEFAULTS:dn,VIEWPORT_PRESETS:W4},Symbol.toStringTag,{value:"Module"})),z0={},Fl={get:t=>z0[t],set:t=>{const e=t.id;z0[e]=t},delete:t=>delete z0[t],getAll:()=>{const e=Object.keys(z0).map(n=>z0[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};function _c(t){return Fl.get(t)}function Da(){return Fl.getAll()}const kf=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",_w=t=>Array.isArray(t)?[]:{},Ul=(t,e)=>e&&e.clone===!0&&kf(t)?Zr(_w(t),t,e):t,Qp=(t,e,n)=>{const r=t.slice();return e.forEach(function(i,a){typeof r[a]>"u"?r[a]=Ul(i,n):kf(i)?r[a]=Zr(t[a],i,n):t.indexOf(i)===-1&&(r[a]=Ul(i,n))}),r},Iw=(t,e,n)=>{const r={};return kf(t)&&Object.keys(t).forEach(function(i){r[i]=Ul(t[i],n)}),Object.keys(e).forEach(function(i){!kf(e[i])||!t[i]?r[i]=Ul(e[i],n):r[i]=Zr(t[i],e[i],n)}),r},Zr=(t={},e={},n=void 0)=>{const r=Array.isArray(e),a=(n||{arrayMerge:Qp}).arrayMerge||Qp;return r?Array.isArray(t)?a(t,e,n):Ul(e,n):Iw(t,e,n)};const z4=Symbol("Comlink.proxy"),bw=Symbol("Comlink.endpoint"),H4=Symbol("Comlink.releaseProxy"),_1=Symbol("Comlink.finalizer"),ef=Symbol("Comlink.thrown"),j4=t=>typeof t=="object"&&t!==null||typeof t=="function",Lw={canHandle:t=>j4(t)&&t[z4],serialize(t){const{port1:e,port2:n}=new MessageChannel;return Bh(t,e),[n,[n]]},deserialize(t){return t.start(),Xd(t)}},Vw={canHandle:t=>j4(t)&&ef in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},K4=new Map([["proxy",Lw],["throw",Vw]]);function Pw(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function Bh(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!Pw(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:o,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(rc);let l;try{const f=s.slice(0,-1).reduce((g,d)=>g[d],t),u=s.reduce((g,d)=>g[d],t);switch(o){case"GET":l=u;break;case"SET":f[s.slice(-1)[0]]=rc(i.data.value),l=!0;break;case"APPLY":l=u.apply(f,c);break;case"CONSTRUCT":{const g=new u(...c);l=Z4(g)}break;case"ENDPOINT":{const{port1:g,port2:d}=new MessageChannel;Bh(t,d),l=kw(g,[g])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[ef]:0}}Promise.resolve(l).catch(f=>({value:f,[ef]:0})).then(f=>{const[u,g]=$f(f);e.postMessage(Object.assign(Object.assign({},u),{id:a}),g),o==="RELEASE"&&(e.removeEventListener("message",r),q4(e),_1 in t&&typeof t[_1]=="function"&&t[_1]())}).catch(f=>{const[u,g]=$f({value:new TypeError("Unserializable return value"),[ef]:0});e.postMessage(Object.assign(Object.assign({},u),{id:a}),g)})}),e.start&&e.start()}function Nw(t){return t.constructor.name==="MessagePort"}function q4(t){Nw(t)&&t.close()}function Xd(t,e){const n=new Map;return t.addEventListener("message",function(i){const{data:a}=i;if(!a||!a.id)return;const o=n.get(a.id);if(o)try{o(a)}finally{n.delete(a.id)}}),Yd(t,n,[],e)}function Cu(t){if(t)throw new Error("Proxy has been released and is not useable")}function X4(t){return Hc(t,new Map,{type:"RELEASE"}).then(()=>{q4(t)})}const Gf=new WeakMap,Bf="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Gf.get(t)||0)-1;Gf.set(t,e),e===0&&X4(t)});function Aw(t,e){const n=(Gf.get(e)||0)+1;Gf.set(e,n),Bf&&Bf.register(t,e,t)}function Fw(t){Bf&&Bf.unregister(t)}function Yd(t,e,n=[],r=function(){}){let i=!1;const a=new Proxy(r,{get(o,s){if(Cu(i),s===H4)return()=>{Fw(a),X4(t),e.clear(),i=!0};if(s==="then"){if(n.length===0)return{then:()=>a};const c=Hc(t,e,{type:"GET",path:n.map(l=>l.toString())}).then(rc);return c.then.bind(c)}return Yd(t,e,[...n,s])},set(o,s,c){Cu(i);const[l,f]=$f(c);return Hc(t,e,{type:"SET",path:[...n,s].map(u=>u.toString()),value:l},f).then(rc)},apply(o,s,c){Cu(i);const l=n[n.length-1];if(l===bw)return Hc(t,e,{type:"ENDPOINT"}).then(rc);if(l==="bind")return Yd(t,e,n.slice(0,-1));const[f,u]=e5(c);return Hc(t,e,{type:"APPLY",path:n.map(g=>g.toString()),argumentList:f},u).then(rc)},construct(o,s){Cu(i);const[c,l]=e5(s);return Hc(t,e,{type:"CONSTRUCT",path:n.map(f=>f.toString()),argumentList:c},l).then(rc)}});return Aw(a,t),a}function Uw(t){return Array.prototype.concat.apply([],t)}function e5(t){const e=t.map($f);return[e.map(n=>n[0]),Uw(e.map(n=>n[1]))]}const Y4=new WeakMap;function kw(t,e){return Y4.set(t,e),t}function Z4(t){return Object.assign(t,{[z4]:!0})}function $f(t){for(const[e,n]of K4)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},Y4.get(t)||[]]}function rc(t){switch(t.type){case"HANDLER":return K4.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Hc(t,e,n,r){return new Promise(i=>{const a=Gw();e.set(a,i),t.start&&t.start(),t.postMessage(Object.assign({id:a},n),r)})}function Gw(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function nr(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}class $h{constructor(e){this.numRequests={[gt.Interaction]:0,[gt.Thumbnail]:0,[gt.Prefetch]:0,[gt.Compute]:0},this.id=e||nr(),this.requestPool={[gt.Interaction]:{0:[]},[gt.Thumbnail]:{0:[]},[gt.Prefetch]:{0:[]},[gt.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[gt.Interaction]:0,[gt.Thumbnail]:0,[gt.Prefetch]:0,[gt.Compute]:0},this.maxNumRequests={[gt.Interaction]:6,[gt.Thumbnail]:6,[gt.Prefetch]:5,[gt.Compute]:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,i=0){const a={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][i]===void 0&&(this.requestPool[n][i]=[]),this.requestPool[n][i].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(i=>{r[i]=r[i].filter(a=>e(a))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let i=0;i<n;i++){const a=this.getNextRequest(e);if(a===null)return!1;if(a){this.numRequests[e]++,this.awake=!0;let o;try{o=a.requestFn()}catch(s){console.warn("sendRequest failed",s)}o?.finally?o.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(gt.Interaction),n=this.sendRequests(gt.Thumbnail),r=this.sendRequests(gt.Prefetch),i=this.sendRequests(gt.Compute);!e&&!n&&!r&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,i)=>r-i)}getRequestPool(){return this.requestPool}}class J4{constructor(){this.workerRegistry={},this.workerPoolManager=new $h("webworker")}registerWorker(e,n,r={}){const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:o={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!a){console.warn(`Worker type '${e}' is already registered...`);return}a&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:o.enabled,idleCheckIntervalId:null,idleTimeThreshold:o.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let c=0;c<i;c++){const l=n();s.instances.push(Xd(l)),s.nativeWorkers.push(l),s.workerFn=n}this.workerRegistry[e]=s}getNextWorkerAPI(e){const n=this.workerRegistry[e];if(!n)return console.error(`Worker type '${e}' is not registered.`),null;const r=n.instances.filter(o=>o!==null);let i=0,a=n.loadCounters[0]||0;for(let o=1;o<r.length;o++){const s=n.loadCounters[o]||0;s<a&&(i=o,a=s)}if(n.instances[i]===null){const o=n.workerFn();n.instances[i]=Xd(o),n.nativeWorkers[i]=o}return n.loadCounters[i]+=1,{api:n.instances[i],index:i}}executeTask(e,n,r={},{requestType:i=gt.Compute,priority:a=0,options:o={},callbacks:s=[]}={}){return new Promise((c,l)=>{const f=async()=>{const{api:u,index:g}=this.getNextWorkerAPI(e);if(!u){const d=new Error(`No available worker instance for '${e}'`);console.error(d),l(d);return}try{let d=[];s.length&&(d=s.map(m=>Z4(m)));const p=this.workerRegistry[e];p.processing=!0;const h=await u[n](r,...d);p.processing=!1,p.lastActiveTime[g]=Date.now(),p.autoTerminateOnIdle&&!p.idleCheckIntervalId&&p.idleTimeThreshold&&(p.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,p.idleTimeThreshold)},p.idleTimeThreshold)),c(h)}catch(d){console.error(`Error executing method '${n}' on worker '${e}':`,d),l(d)}finally{this.workerRegistry[e].loadCounters[g]--}};this.workerPoolManager.addRequest(f,i,o,a)})}terminateIdleWorkers(e,n){const r=this.workerRegistry[e];if(r.processing)return;const i=Date.now();r.instances.forEach((a,o)=>{const s=r.lastActiveTime[o],c=s!==null&&r.loadCounters[o]>0,l=i-s;!c&&l>n&&this.terminateWorkerInstance(e,o)})}terminate(e){const n=this.workerRegistry[e];if(!n){console.error(`Worker type '${e}' is not registered.`);return}n.instances.forEach((r,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,n){const r=this.workerRegistry[e],i=r.instances[n];i!==null&&(i[H4](),r.nativeWorkers[n].terminate(),r.instances[n]=null,r.lastActiveTime[n]=null)}}const I1=4,Bw=5,$w=1,t5=[1,1];function n5({ext:t,filterType:e,texData:n,internalFormat:r,glDataType:i}){try{const a=document.createElement("canvas");a.width=I1,a.height=I1;const o=a.getContext("webgl2");if(!o)return!1;const s=`#version 300 es
    void main() {
      gl_PointSize = ${I1.toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,c=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `;let l;if(t&&(l=o.getExtension(t),!l))return!1;const f=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(f,s),o.compileShader(f),!o.getShaderParameter(f,o.COMPILE_STATUS))return!1;const u=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(u,c),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))return!1;const g=o.createProgram();if(o.attachShader(g,f),o.attachShader(g,u),o.linkProgram(g),!o.getProgramParameter(g,o.LINK_STATUS))return!1;const d=o.createTexture();o.bindTexture(o.TEXTURE_2D,d),o.texImage2D(o.TEXTURE_2D,0,r(o,l),Bw,$w,0,o.RED,i(o,l),n);const p=e==="LINEAR"?o.LINEAR:o.NEAREST;o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,p),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,p),o.useProgram(g),o.drawArrays(o.POINTS,0,1);const h=new Uint8Array(4);o.readPixels(t5[0],t5[1],1,1,o.RGBA,o.UNSIGNED_BYTE,h);const[m,v,y]=h,T=o.getExtension("WEBGL_lose_context");return T&&T.loseContext(),m===v&&v===y&&m!==0}catch{return!1}}function Ww(){const t=new Int16Array([32767,2e3,3e3,4e3,5e3,16784,7e3,8e3,9e3,32767]);return{norm16:n5({ext:"EXT_texture_norm16",filterType:"NEAREST",texData:t,internalFormat:(e,n)=>n.R16_SNORM_EXT,glDataType:e=>e.SHORT}),norm16Linear:n5({ext:"EXT_texture_norm16",filterType:"LINEAR",texData:t,internalFormat:(e,n)=>n.R16_SNORM_EXT,glDataType:e=>e.SHORT})}}let rl=!1;const Zd={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useLegacyCameraFOV:!1,strictZSpacingForVolumeViewport:!0,renderingEngineMode:vc.ContextPool,webGlContextCount:7,volumeRendering:{sampleDistanceMultiplier:1}},debug:{statsOverlay:!1},peerImport:t=>null};let Qa={...Zd,rendering:{...Zd.rendering}},vl=null,Q4=!1;function zw(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function Hw(){const t=zw();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function jw(){const t=Ww();return t.norm16&&t.norm16Linear}function ev(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function Kw(t=Qa){return rl||(Q4=jw(),Qa=Zr(Zd,t),Qa.isMobile&&(Qa.rendering.webGlContextCount=1),ev()&&(t.rendering?.preferSizeOverAccuracy?Qa.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),Hw()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),Qa.rendering.useCPURendering=!0),rl=!0,vl||(vl=new J4),rl)}function qw(){return Q4}function Wh(){return!ev()}function yl(){return Qa.rendering.useCPURendering}function Xw(){return rl}function wa(){return Qa}function tv(){return vl||(vl=new J4),vl}async function Yw(t){return Qa.peerImport(t)}class Zw{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=i=>{this.removeEventListener(e,r),n.call(this,i)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[n]){const a=o=>{i[n]&&clearTimeout(i[n].timeoutId),i[n].timeoutId=setTimeout(()=>{n.call(this,o)},r)};i[n]={original:n,handle:a,timeoutId:null},this.addEventListener(e,a)}}removeEventListenerDebounced(e,n){if(this.debouncedListeners[e]?.[n]){const r=this.debouncedListeners[e][n];this.removeEventListener(e,r.handle),clearTimeout(r.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],i=r.length;for(let a=0;a<i;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let i=0;i<r;i++)try{n[i].call(this,e)}catch(a){console.error(`error in event listener of type:  ${e.type}`,a)}return!e.defaultPrevented}}const Me=new Zw;function Oe(t=Me,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t?.dispatchEvent(r)}var no=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ji(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Jw(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var b1,r5;function Qw(){return r5||(r5=1,b1=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n}),b1}var eS=Qw();const zh=ji(eS);var L1,i5;function nv(){if(i5)return L1;i5=1;var t=Object.prototype.toString;return L1=function(n){var r=t.call(n),i=r==="[object Arguments]";return i||(i=r!=="[object Array]"&&n!==null&&typeof n=="object"&&typeof n.length=="number"&&n.length>=0&&t.call(n.callee)==="[object Function]"),i},L1}var V1,a5;function tS(){if(a5)return V1;a5=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=nv(),i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(g){var d=g.constructor;return d&&d.prototype===g},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=(function(){if(typeof window>"u")return!1;for(var g in window)try{if(!l["$"+g]&&e.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{c(window[g])}catch{return!0}}catch{return!0}return!1})(),u=function(g){if(typeof window>"u"||!f)return c(g);try{return c(g)}catch{return!1}};t=function(d){var p=d!==null&&typeof d=="object",h=n.call(d)==="[object Function]",m=r(d),v=p&&n.call(d)==="[object String]",y=[];if(!p&&!h&&!m)throw new TypeError("Object.keys called on a non-object");var T=o&&h;if(v&&d.length>0&&!e.call(d,0))for(var C=0;C<d.length;++C)y.push(String(C));if(m&&d.length>0)for(var w=0;w<d.length;++w)y.push(String(w));else for(var S in d)!(T&&S==="prototype")&&e.call(d,S)&&y.push(String(S));if(a)for(var _=u(d),D=0;D<s.length;++D)!(_&&s[D]==="constructor")&&e.call(d,s[D])&&y.push(s[D]);return y}}return V1=t,V1}var P1,o5;function nS(){if(o5)return P1;o5=1;var t=Array.prototype.slice,e=nv(),n=Object.keys,r=n?function(o){return n(o)}:tS(),i=Object.keys;return r.shim=function(){if(Object.keys){var o=(function(){var s=Object.keys(arguments);return s&&s.length===arguments.length})(1,2);o||(Object.keys=function(c){return e(c)?i(t.call(c)):i(c)})}else Object.keys=r;return Object.keys||r},P1=r,P1}var N1,s5;function rv(){if(s5)return N1;s5=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return N1=t,N1}var A1,c5;function rS(){return c5||(c5=1,A1=SyntaxError),A1}var F1,l5;function iS(){return l5||(l5=1,F1=TypeError),F1}var U1,u5;function aS(){return u5||(u5=1,U1=Object.getOwnPropertyDescriptor),U1}var k1,f5;function oS(){if(f5)return k1;f5=1;var t=aS();if(t)try{t([],"length")}catch{t=null}return k1=t,k1}var G1,g5;function sS(){if(g5)return G1;g5=1;var t=rv(),e=rS(),n=iS(),r=oS();return G1=function(a,o,s){if(!a||typeof a!="object"&&typeof a!="function")throw new n("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new n("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new n("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new n("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new n("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new n("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,f=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,g=!!r&&r(a,o);if(t)t(a,o,{configurable:f===null&&g?g.configurable:!f,enumerable:c===null&&g?g.enumerable:!c,value:s,writable:l===null&&g?g.writable:!l});else if(u||!c&&!l&&!f)a[o]=s;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},G1}var B1,d5;function cS(){if(d5)return B1;d5=1;var t=rv(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},B1=e,B1}var $1,h5;function iv(){if(h5)return $1;h5=1;var t=nS(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",n=Object.prototype.toString,r=Array.prototype.concat,i=sS(),a=function(l){return typeof l=="function"&&n.call(l)==="[object Function]"},o=cS()(),s=function(l,f,u,g){if(f in l){if(g===!0){if(l[f]===u)return}else if(!a(g)||!g())return}o?i(l,f,u,!0):i(l,f,u)},c=function(l,f){var u=arguments.length>2?arguments[2]:{},g=t(f);e&&(g=r.call(g,Object.getOwnPropertySymbols(f)));for(var d=0;d<g.length;d+=1)s(l,g[d],f[g[d]],u[g[d]])};return c.supportsDescriptors=!!o,$1=c,$1}var H0={exports:{}},p5;function av(){return p5||(p5=1,typeof self<"u"?H0.exports=self:typeof window<"u"?H0.exports=window:H0.exports=Function("return this")()),H0.exports}var W1,m5;function ov(){if(m5)return W1;m5=1;var t=av();return W1=function(){return typeof no!="object"||!no||no.Math!==Math||no.Array!==Array?t:no},W1}var z1,v5;function lS(){if(v5)return z1;v5=1;var t=iv(),e=ov();return z1=function(){var r=e();if(t.supportsDescriptors){var i=Object.getOwnPropertyDescriptor(r,"globalThis");(!i||i.configurable&&(i.enumerable||!i.writable||globalThis!==r))&&Object.defineProperty(r,"globalThis",{configurable:!0,enumerable:!1,value:r,writable:!0})}else(typeof globalThis!="object"||globalThis!==r)&&(r.globalThis=r);return r},z1}var H1,y5;function uS(){if(y5)return H1;y5=1;var t=iv(),e=av(),n=ov(),r=lS(),i=n(),a=function(){return i};return t(a,{getPolyfill:n,implementation:e,shim:r}),H1=a,H1}var fS=uS();const gS=ji(fS),Gi=gS(),sv={vtkObject:()=>null};function $i(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Gi.console&&Gi.console.error&&Gi.console.error("Invalid VTK object"),null;const e=sv[t.vtkClass];if(!e)return Gi.console&&Gi.console.error&&Gi.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(i=>{n[i]&&typeof n[i]=="object"&&n[i].vtkClass&&(n[i]=$i(n[i]))});const r=e(n);return r&&r.modified&&r.modified(),r}function dS(t,e){sv[t]=e}$i.register=dS;class j1 extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let Jd=0;const cv=t=>{throw new Error(`Named parameter '${t}' is missing`)},lv=Symbol("void");function hS(){return Jd}const uv={};function ic(){}const pS=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];pS.forEach(t=>{uv[t]=ic});Gi.console=console.hasOwnProperty("log")?console:uv;const gs={debug:ic,error:Gi.console.error||ic,info:Gi.console.info||ic,log:Gi.console.log||ic,warn:Gi.console.warn||ic};function fv(t,e){gs[t]&&(gs[t]=e||ic)}function gv(){gs.log(...arguments)}function dv(){gs.info(...arguments)}function Wf(){gs.debug(...arguments)}function yt(){gs.error(...arguments)}function Pg(){gs.warn(...arguments)}const T5={};function hv(t){T5[t]||(gs.error(t),T5[t]=!0)}const pr=Object.create(null);pr.Float32Array=Float32Array;pr.Float64Array=Float64Array;pr.Uint8Array=Uint8Array;pr.Int8Array=Int8Array;pr.Uint16Array=Uint16Array;pr.Int16Array=Int16Array;pr.Uint32Array=Uint32Array;pr.Int32Array=Int32Array;pr.Uint8ClampedArray=Uint8ClampedArray;try{pr.BigInt64Array=BigInt64Array,pr.BigUint64Array=BigUint64Array}catch{}function _0(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(pr[t]||Float64Array)(...n)}function Ng(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(pr[t]||Float64Array).from(...n)}function Ag(t){return t.charAt(0).toUpperCase()+t.slice(1)}function wn(t){return Ag(t[0]==="_"?t.slice(1):t)}function pv(t){return t.charAt(0).toLowerCase()+t.slice(1)}function mv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(t),a="B";for(;i>n;)i/=n,a=r.pop();return`${i.toFixed(e)} ${a}`}function vv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function yv(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function mS(t){return Object.values(pr).some(e=>t instanceof e)}function vS(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function yS(t,e){return Object.keys(t).find(n=>t[n]===e)}function Tv(t){return t&&t.isA?t.getState():t}function Hh(t){setTimeout(t,0)}function Cv(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function an(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};yv(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++Jd),!("classHierarchy"in e))e.classHierarchy=new j1("vtkObject");else if(!(e.classHierarchy instanceof j1)){const a=new j1;for(let o=0;o<e.classHierarchy.length;o++)a.push(e.classHierarchy[o]);e.classHierarchy=a}function r(a){n[a]=null}function i(a){function o(){r(a)}return Object.freeze({unsubscribe:o})}return t.isDeleted=()=>!!e.deleted,t.modified=a=>{if(e.deleted){yt("instance deleted - cannot call any method");return}a&&a<t.getMTime()||(e.mtime=++Jd,n.forEach(o=>o&&o(t)))},t.onModified=a=>{if(e.deleted)return yt("instance deleted - cannot call any method"),null;const o=n.length;return n.push(a),i(o)},t.getMTime=()=>e.mtime,t.isA=a=>{let o=e.classHierarchy.length;for(;o--;)if(e.classHierarchy[o]===a)return!0;return!1},t.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-a]},t.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(a).forEach(l=>{const f=s?null:t[`set${Ag(l)}`];f&&Array.isArray(a[l])&&f.length>1?c=f(...a[l])||c:f?c=f(a[l])||c:(["mtime"].indexOf(l)===-1&&!o&&Pg(`Warning: Set value to model directly ${l}, ${a[l]}`),c=e[l]!==a[l]||c,e[l]=a[l])}),c},t.get=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(!o.length)return e;const c={};return o.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=a=>e[a],t.delete=()=>{Object.keys(e).forEach(a=>delete e[a]),n.forEach((a,o)=>r(o)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const a={...e,vtkClass:t.getClassName()};Object.keys(a).forEach(s=>{a[s]===null||a[s]===void 0||s[0]==="_"?delete a[s]:a[s].isA?a[s]=a[s].getState():Array.isArray(a[s])?a[s]=a[s].map(Tv):mS(a[s])&&(a[s]=Array.from(a[s]))});const o={};return Object.keys(a).sort().forEach(s=>{o[s]=a[s]}),o.mtime&&delete o.mtime,o},t.shallowCopy=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${t.getClassName()}`);const s=a.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(f=>{const u=c.indexOf(f);u===-1?o&&Wf(`add ${f} in shallowCopy`):c.splice(u,1),e[f]=s[f]}),c.length&&o&&Wf(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const TS={object(t,e,n){return function(){return{...e[n.name]}}}};function $r(t,e,n){n.forEach(r=>{if(typeof r=="object"){const i=TS[r.type];i?t[`get${wn(r.name)}`]=i(t,e,r):t[`get${wn(r.name)}`]=()=>e[r.name]}else t[`get${wn(r)}`]=()=>e[r]})}const wv={enum(t,e,n){const r=`_on${wn(n.name)}Changed`;return i=>{if(typeof i=="string"){if(n.enum[i]!==void 0)return e[n.name]!==n.enum[i]?(e[n.name]=n.enum[i],t.modified(),!0):!1;throw yt(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[n.name]!==i){if(Object.keys(n.enum).map(a=>n.enum[a]).indexOf(i)!==-1){const a=e[n.name];return e[n.name]=i,e[r]?.(t,e,i,a),t.modified(),!0}throw yt(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw yt(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){n.params?.length===1&&Pg('Setter of type "object" with a single "param" field is not supported');const r=`_on${wn(n.name)}Changed`;return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];let s;if(a.length>1&&n.params?.length?s=n.params.reduce((c,l,f)=>Object.assign(c,{[l]:a[f]}),{}):s=a[0],!zh(e[n.name],s)){const c=e[n.name];return e[n.name]=s,e[r]?.(t,e,s,c),t.modified(),!0}return!1}}};function C5(t){if(typeof t=="object"){const e=wv[t.type];if(e)return(n,r)=>e(n,r,t);throw yt(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const i=`_on${wn(t)}Changed`;return function(o){if(r.deleted)return yt("instance deleted - cannot call any method"),!1;if(r[t]!==o){const s=r[t.name];return r[t]=o,r[i]?.(n,r,o,s),n.modified(),!0}return!1}}}function Ql(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${wn(r.name)}`]=C5(r)(t,e):t[`set${wn(r)}`]=C5(r)(t,e)})}function Gn(t,e,n){$r(t,e,n),Ql(t,e,n)}function I0(t,e,n){n.forEach(r=>{t[`get${wn(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${wn(r)}ByReference`]=()=>e[r]})}function jh(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(e[a]&&r&&e[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const o=`_on${wn(a)}Changed`;t[`set${wn(a)}`]=function(){if(e.deleted)return yt("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let f=c,u,g=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],g=!0),f==null)u=e[a]!==f;else{if(r&&f.length!==r)if(f.length<r&&i!==void 0)for(f=Array.from(f),g=!1;f.length<r;)f.push(i);else throw new RangeError(`Invalid number of values for array setter (${a})`);u=e[a]==null||e[a].length!==f.length;for(let d=0;!u&&d<f.length;++d)u=e[a][d]!==f[d];u&&g&&(f=Array.from(f))}if(u){const d=e[a.name];e[a]=f,e[o]?.(t,e,f,d),t.modified()}return u},t[`set${wn(a)}From`]=s=>{const c=e[a];s.forEach((l,f)=>{c[f]=l})}})}function Kh(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;I0(t,e,n),jh(t,e,n,r,i)}function eu(t,e,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function qh(t,e,n,r){e.inputData?e.inputData=e.inputData.map($i):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map($i):e.inputConnection=[],e.output?e.output=e.output.map($i):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map($i):e.inputArrayToProcess=[],e.numberOfInputs=n;function i(d){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){yt("instance deleted - cannot call any method");return}if(p>=e.numberOfInputs){yt(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[p]!==d||e.inputConnection[p])&&(e.inputData[p]=d,e.inputConnection[p]=null,t.modified&&t.modified())}function a(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[d]&&(e.inputData[d]=e.inputConnection[d]()),e.inputData[d]}function o(d){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){yt("instance deleted - cannot call any method");return}if(p>=e.numberOfInputs){let h=`algorithm ${t.getClassName()} only has `;h+=`${e.numberOfInputs}`,h+=" input ports. To add more input ports, use addInputConnection()",yt(h);return}e.inputData[p]=null,e.inputConnection[p]=d}function s(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[d]}function c(){let d=e.numberOfInputs;for(;d&&!e.inputData[d-1]&&!e.inputConnection[d-1];)d--;return d===e.numberOfInputs&&e.numberOfInputs++,d}function l(d){if(e.deleted){yt("instance deleted - cannot call any method");return}o(d,c())}function f(d){if(e.deleted){yt("instance deleted - cannot call any method");return}i(d,c())}function u(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(yt("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[d])}t.shouldUpdate=()=>{const d=t.getMTime();let p=1/0,h=r;for(;h--;){if(!e.output[h]||e.output[h].isDeleted())return!0;const m=e.output[h].getMTime();if(m<d)return!0;m<p&&(p=m)}for(h=e.numberOfInputs;h--;)if(e.inputConnection[h]?.filter.shouldUpdate()||t.getInputData(h)?.getMTime()>p)return!0;return!1};function g(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const p=()=>u(d);return p.filter=t,p}if(e.numberOfInputs){let d=e.numberOfInputs;for(;d--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=o,t.addInputData=f,t.addInputConnection=l,t.getInputData=a,t.getInputConnection=s}r&&(t.getOutputData=u,t.getOutputPort=g),t.update=()=>{const d=[];if(e.numberOfInputs){let p=0;for(;p<e.numberOfInputs;)d[p]=t.getInputData(p),p++}t.requestData&&!t.isDeleted()&&t.shouldUpdate()&&t.requestData(d,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=d=>{const p=e.inputArrayToProcess[d],h=e.inputData[d];return p&&h?h[`get${p.fieldAssociation}`]().getArray(p.arrayName):null},t.setInputArrayToProcess=function(d,p,h){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<d;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[d]={arrayName:p,fieldAssociation:h,attributeType:m}}}const Xh=Symbol("Event abort");function Sv(t,e,n){const r=[],i=t.delete;let a=1;function o(l){for(let f=0;f<r.length;++f){const[u]=r[f];if(u===l){r.splice(f,1);return}}}function s(l){function f(){o(l)}return Object.freeze({unsubscribe:f})}function c(){if(e.deleted){yt("instance deleted - cannot call any method");return}const l=r.slice();for(let f=0;f<l.length;++f){const[,u,g]=l[f];if(u){if(g<0)setTimeout(()=>u.apply(t,arguments),1-g);else if(u.apply(t,arguments)===Xh)break}}}t[`invoke${wn(n)}`]=c,t[`on${wn(n)}`]=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return yt("instance deleted - cannot call any method"),null;const u=a++;return r.push([u,l,f]),r.sort((g,d)=>d[2]-g[2]),s(u)},t.delete=()=>{i(),r.forEach(l=>{let[f]=l;return o(f)})}}function Yt(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},a={};return t(a,i,r),Object.freeze(a)};return e&&$i.register(e,n),n}function tu(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e.filter(o=>!!o).map(o=>o(...i))}}function Yh(t){return t&&t.isA&&t.isA("vtkObject")}function zf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Yh(t)){if(r.indexOf(t)>=0)return n;r.push(t);const i=e(t);i!==void 0&&n.push(i);const a=t.get();Object.keys(a).forEach(o=>{const s=a[o];Array.isArray(s)?s.forEach(c=>{zf(c,e,n,r)}):zf(s,e,n,r)})}return n}function xv(t,e,n){var r=this;let i;const a=function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];const l=r,f=()=>{i=null,n||t.apply(l,s)},u=n&&!i;clearTimeout(i),i=setTimeout(f,e),u&&t.apply(l,s)};return a.cancel=()=>clearTimeout(i),a}function Ev(t,e){let n=!1,r=null;function i(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];if(n){r=s;return}n=!0,t(...s),setTimeout(i,e)}return a}function Zh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,i)=>{e.keystore[r]=i},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let CS=1;const wu="__root__";function Ov(t,e){Zh(t,e);const n=t.delete;e.proxyId=`${CS++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),$r(t,e,["proxyId","proxyGroup","proxyName"]),Gn(t,e,["proxyManager"]);const r={},i={};function a(l,f){i[f]||(i[f]=[]);const u=i[f];for(let g=0;g<l.length;g++)u.push(l[g].name),r[l[g].name]=l[g],l[g].children&&l[g].children.length&&a(l[g].children,l[g].name)}a(e.ui,wu),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(r).forEach(f=>delete r[f]),Object.keys(i).forEach(f=>delete i[f]),a(e.ui,wu),t.modified()};function o(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wu;return i[l]}t.updateProxyProperty=(l,f)=>{const u=r[l];u?Object.assign(u,f):r[l]={...f}},t.activate=()=>{if(e.proxyManager){const l=`setActive${wn(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,f)=>{f in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[f]=[]),e.propertyLinkSubscribers[f].push(l)},t.gcPropertyLinks=l=>{const f=e.propertyLinkSubscribers[l]||[];for(;f.length;)f.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const g=[];let d=0,p=!1;function h(C){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(p)return null;const S=[];let _=null;for(d=g.length;d--;){const N=g[d];N.instance===C?_=N:S.push(N)}if(!_)return null;const D=_.instance[`get${wn(_.propertyName)}`]();if(!vS(D,u)||w){for(u=D,p=!0;S.length;){const N=S.pop();N.instance.set({[N.propertyName]:u})}p=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=D),D}function m(C,w){const S=[];for(d=g.length;d--;){const _=g[d];_.instance===C&&(_.propertyName===w||w===void 0)&&(_.subscription.unsubscribe(),S.push(d))}for(;S.length;)g.splice(S.pop(),1)}function v(C,w){let S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const _=C.onModified(h),D=g[0];return g.push({instance:C,propertyName:w,subscription:_}),S&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?C.set({[w]:e.propertyLinkMap[l].value}):D&&h(D.instance,!0)),{unsubscribe:()=>m(C,w)}}function y(){for(;g.length;)g.pop().subscription.unsubscribe()}const T={bind:v,unbind:m,unsubscribe:y,persistent:f};return e.propertyLinkMap[l]=T,T};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wu;const f=[],u=e.proxyId,g=o(l)||[];for(let d=0;d<g.length;d++){const p=g[d],h=t[`get${wn(p)}`],m=h?h():void 0,v={id:u,name:p,value:m},y=s(p);y.length&&(v.children=y),f.push(v)}return f}t.listPropertyNames=()=>s().map(l=>l.name),t.getPropertyByName=l=>s().find(f=>f.name===l),t.getPropertyDomainByName=l=>(r[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let f=l.length;for(;f--;)e.propertyLinkMap[l[f]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:f,property:u,persistent:g,updateOnBind:d,type:p}=e.links[l];if(p==="application"){const h=e.proxyManager.getPropertyLink(f,g);t.registerPropertyLinkForGC(h,"application"),h.bind(t,u,d)}}}Hh(c)}function Rv(t,e,n){const r=t.delete,i=[],a=Object.keys(n);let o=a.length;for(;o--;){const s=a[o],{modelKey:c,property:l,modified:f=!0}=n[s],u=wn(l),g=wn(s);t[`get${g}`]=e[c][`get${u}`],t[`set${g}`]=e[c][`set${u}`],f&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function Dv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let l=c.length;for(;l--;){const f=c[l];e[f].set(s[f])}}const a=Object.keys(r);let o=a.length;for(;o--;){const s=a[o];e[s]=r[s];const c=n[s];t[`set${wn(s)}`]=l=>{if(l!==e[s]){e[s]=l;const f=c[l];i(f),t.modified()}}}a.length&&$r(t,e,a)}const w5=10,S5=40,x5=800;function Mv(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*w5,i=n*w5,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=S5,i*=S5):(r*=x5,i*=x5)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:i||r}}var A={algo:qh,capitalize:Ag,chain:tu,debounce:xv,enumToString:yS,event:Sv,EVENT_ABORT:Xh,formatBytesToProperUnit:mv,formatNumbersWithThousandSeparator:vv,get:$r,getArray:I0,getCurrentGlobalMTime:hS,getStateArrayMapFunc:Tv,isVtkObject:Yh,keystore:Zh,measurePromiseExecution:Cv,moveToProtected:eu,newInstance:Yt,newTypedArray:_0,newTypedArrayFrom:Ng,normalizeWheel:Mv,obj:an,proxy:Ov,proxyPropertyMapping:Rv,proxyPropertyState:Dv,safeArrays:yv,set:Ql,setArray:jh,setGet:Gn,setGetArray:Kh,setImmediate:Hh,setLoggerFunction:fv,throttle:Ev,traverseInstanceTree:zf,TYPED_ARRAYS:pr,uncapitalize:pv,VOID:lv,vtkDebugMacro:Wf,vtkErrorMacro:yt,vtkInfoMacro:dv,vtkLogMacro:gv,vtkOnceErrorMacro:hv,vtkWarningMacro:Pg,objectSetterMap:wv,requiredParam:cv},Dr=Object.freeze({__proto__:null,requiredParam:cv,VOID:lv,setLoggerFunction:fv,vtkLogMacro:gv,vtkInfoMacro:dv,vtkDebugMacro:Wf,vtkErrorMacro:yt,vtkWarningMacro:Pg,vtkOnceErrorMacro:hv,TYPED_ARRAYS:pr,newTypedArray:_0,newTypedArrayFrom:Ng,capitalize:Ag,_capitalize:wn,uncapitalize:pv,formatBytesToProperUnit:mv,formatNumbersWithThousandSeparator:vv,setImmediateVTK:Hh,measurePromiseExecution:Cv,obj:an,get:$r,set:Ql,setGet:Gn,getArray:I0,setArray:jh,setGetArray:Kh,moveToProtected:eu,algo:qh,EVENT_ABORT:Xh,event:Sv,newInstance:Yt,chain:tu,isVtkObject:Yh,traverseInstanceTree:zf,debounce:xv,throttle:Ev,keystore:Zh,proxy:Ov,proxyPropertyMapping:Rv,proxyPropertyState:Dv,normalizeWheel:Mv,default:A}),tf={exports:{}},wS=tf.exports,E5;function SS(){return E5||(E5=1,(function(t){(function(e,n,r){function i(c){var l=this,f=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(c),l.s0<0&&(l.s0+=1),l.s1-=f(c),l.s1<0&&(l.s1+=1),l.s2-=f(c),l.s2<0&&(l.s2+=1),f=null}function a(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function o(c,l){var f=new i(c),u=l&&l.state,g=f.next;return g.int32=function(){return f.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,u&&(typeof u=="object"&&a(u,f),g.state=function(){return a(f,{})}),g}function s(){var c=4022871197,l=function(f){f=String(f);for(var u=0;u<f.length;u++){c+=f.charCodeAt(u);var g=.02519603282416938*c;c=g>>>0,g-=c,g*=c,c=g>>>0,g-=c,c+=g*4294967296}return(c>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=o:this.alea=o})(wS,t)})(tf)),tf.exports}var nf={exports:{}},xS=nf.exports,O5;function ES(){return O5||(O5=1,(function(t){(function(e,n,r){function i(s){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(g+d)/(1<<21);while(p===0);return p},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xor128=o})(xS,t)})(nf)),nf.exports}var rf={exports:{}},OS=rf.exports,R5;function RS(){return R5||(R5=1,(function(t){(function(e,n,r){function i(s){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,f==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(g+d)/(1<<21);while(p===0);return p},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xorwow=o})(OS,t)})(rf)),rf.exports}var af={exports:{}},DS=af.exports,D5;function MS(){return D5||(D5=1,(function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var f=c.x,u=c.i,g,d;return g=f[u],g^=g>>>7,d=g^g<<24,g=f[u+1&7],d^=g^g>>>10,g=f[u+3&7],d^=g^g>>>3,g=f[u+4&7],d^=g^g<<7,g=f[u+7&7],g=g^g<<13,d^=g^g<<9,f[u]=d,c.i=u+1&7,d};function l(f,u){var g,d=[];if(u===(u|0))d[0]=u;else for(u=""+u,g=0;g<u.length;++g)d[g&7]=d[g&7]<<15^u.charCodeAt(g)+d[g+1&7]<<13;for(;d.length<8;)d.push(0);for(g=0;g<8&&d[g]===0;++g);for(g==8?d[7]=-1:d[g],f.x=d,f.i=0,g=256;g>0;--g)f.next()}l(c,s)}function a(s,c){return c.x=s.x.slice(),c.i=s.i,c}function o(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(g+d)/(1<<21);while(p===0);return p},u.int32=l.next,u.quick=u,f&&(f.x&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xorshift7=o})(DS,t)})(af)),af.exports}var of={exports:{}},_S=of.exports,M5;function IS(){return M5||(M5=1,(function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var f=c.w,u=c.X,g=c.i,d,p;return c.w=f=f+1640531527|0,p=u[g+34&127],d=u[g=g+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=u[g]=p^d,c.i=g,p+(f^f>>>16)|0};function l(f,u){var g,d,p,h,m,v=[],y=128;for(u===(u|0)?(d=u,u=null):(u=u+"\0",d=0,y=Math.max(y,u.length)),p=0,h=-32;h<y;++h)u&&(d^=u.charCodeAt((h+32)%u.length)),h===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,h>=0&&(m=m+1640531527|0,g=v[h&127]^=d+m,p=g==0?p+1:0);for(p>=128&&(v[(u&&u.length||0)&127]=-1),p=127,h=512;h>0;--h)d=v[p+34&127],g=v[p=p+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,v[p]=d^g;f.w=m,f.X=v,f.i=p}l(c,s)}function a(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function o(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(g+d)/(1<<21);while(p===0);return p},u.int32=l.next,u.quick=u,f&&(f.X&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xor4096=o})(_S,t)})(of)),of.exports}var sf={exports:{}},bS=sf.exports,_5;function LS(){return _5||(_5=1,(function(t){(function(e,n,r){function i(s){var c=this,l="";c.next=function(){var u=c.b,g=c.c,d=c.d,p=c.a;return u=u<<25^u>>>7^g,g=g-d|0,d=d<<24^d>>>8^p,p=p-u|0,c.b=u=u<<20^u>>>12^g,c.c=g=g-d|0,c.d=d<<16^g>>>16^p,c.a=p-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):l+=s;for(var f=0;f<l.length+20;f++)c.b^=l.charCodeAt(f)|0,c.next()}function a(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(g+d)/(1<<21);while(p===0);return p},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.tychei=o})(bS,t)})(sf)),sf.exports}var cf={exports:{}};const VS={},PS=Object.freeze(Object.defineProperty({__proto__:null,default:VS},Symbol.toStringTag,{value:"Module"})),ho=Jw(PS);var NS=cf.exports,I5;function AS(){return I5||(I5=1,(function(t){(function(e,n,r){var i=256,a=6,o=52,s="random",c=r.pow(i,a),l=r.pow(2,o),f=l*2,u=i-1,g;function d(C,w,S){var _=[];w=w==!0?{entropy:!0}:w||{};var D=v(m(w.entropy?[C,T(n)]:C??y(),3),_),N=new p(_),P=function(){for(var F=N.g(a),B=c,k=0;F<l;)F=(F+k)*i,B*=i,k=N.g(1);for(;F>=f;)F/=2,B/=2,k>>>=1;return(F+k)/B};return P.int32=function(){return N.g(4)|0},P.quick=function(){return N.g(4)/4294967296},P.double=P,v(T(N.S),n),(w.pass||S||function(F,B,k,U){return U&&(U.S&&h(U,N),F.state=function(){return h(N,{})}),k?(r[s]=F,B):F})(P,D,"global"in w?w.global:this==r,w.state)}function p(C){var w,S=C.length,_=this,D=0,N=_.i=_.j=0,P=_.S=[];for(S||(C=[S++]);D<i;)P[D]=D++;for(D=0;D<i;D++)P[D]=P[N=u&N+C[D%S]+(w=P[D])],P[N]=w;(_.g=function(F){for(var B,k=0,U=_.i,H=_.j,W=_.S;F--;)B=W[U=u&U+1],k=k*i+W[u&(W[U]=W[H=u&H+B])+(W[H]=B)];return _.i=U,_.j=H,k})(i)}function h(C,w){return w.i=C.i,w.j=C.j,w.S=C.S.slice(),w}function m(C,w){var S=[],_=typeof C,D;if(w&&_=="object")for(D in C)try{S.push(m(C[D],w-1))}catch{}return S.length?S:_=="string"?C:C+"\0"}function v(C,w){for(var S=C+"",_,D=0;D<S.length;)w[u&D]=u&(_^=w[u&D]*19)+S.charCodeAt(D++);return T(w)}function y(){try{var C;return g&&(C=g.randomBytes)?C=C(i):(C=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(C)),T(C)}catch{var w=e.navigator,S=w&&w.plugins;return[+new Date,e,S,e.screen,T(n)]}}function T(C){return String.fromCharCode.apply(0,C)}if(v(r.random(),n),t.exports){t.exports=d;try{g=ho}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:NS,[],Math)})(cf)),cf.exports}var K1,b5;function FS(){if(b5)return K1;b5=1;var t=SS(),e=ES(),n=RS(),r=MS(),i=IS(),a=LS(),o=AS();return o.alea=t,o.xor128=e,o.xorwow=n,o.xorshift7=r,o.xor4096=i,o.tychei=a,K1=o,K1}var US=FS();const kS=ji(US),Jh=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],GS=[1,0,0,0,1,0,0,0,1],Qh=1e-6,e2=1e-12,{vtkErrorMacro:_v,vtkWarningMacro:yc}=A;let Iv=0;const L5=20;function nu(t){return()=>_v(`vtkMath::${t} - NOT IMPLEMENTED`)}function Tl(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[n*e+a],t[n*e+a]=t[r*e+a],t[r*e+a]=i}function il(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[a*e+n],t[a*e+n]=t[a*e+r],t[a*e+r]=i}function nn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const BS=()=>Math.PI;function $S(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function gn(t){return t/180*Math.PI}function Hf(t){return t*180/Math.PI}const{round:WS,floor:t2,ceil:zS,min:HS,max:jS}=Math;function KS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let i=e,a=t.length;i<a;i+=n)t[i]<r&&(r=t[i]);return r}function qS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let i=e,a=t.length;i<a;i+=n)r<t[i]&&(r=t[i]);return r}function XS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,i=-1/0;for(let a=e,o=t.length;a<o;a+=n)t[a]<r&&(r=t[a]),i<t[a]&&(i=t[a]);return[r,i]}const YS=nu("ceilLog2"),ZS=nu("factorial");function qo(t){let e=1;for(;e<t;)e*=2;return e}function al(t){return t===qo(t)}function JS(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function QS(t,e){if(t<e)return 0;const n=nn(e);for(let r=0;r<e;++r)n[r]=r;return n}function ex(t,e,n){let r=0;for(let i=e-1;i>=0;--i)if(n[i]<t-e+i){let a=n[i]+1;for(;i<e;)n[i++]=a++;r=1;break}return r}function tx(t){kS(`${t}`,{global:!0}),Iv=t}function nx(){return Iv}function rx(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const ix=nu("gaussian");function d0(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Kn(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function bv(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function Lv(t,e){return t[0]*=e,t[1]*=e,t}function Qd(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function ax(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function at(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ox(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function kr(t,e,n){const r=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=i,n[2]=a,n}function fi(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function hi(t){const e=fi(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function sx(t){const e=fi(t,3);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e),e}function cx(t,e,n,r){const i=t[0]*t[0],a=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(i+a+o);let c,l,f;i>a&&i>o?(c=0,l=1,f=2):a>o?(c=1,l=2,f=0):(c=2,l=0,f=1);const u=t[c]/s,g=t[l]/s,d=t[f]/s,p=Math.sqrt(u*u+d*d);if(r!==0){const h=Math.sin(r),m=Math.cos(r);e&&(e[c]=(d*m-u*g*h)/p,e[l]=h*p,e[f]=(-(u*m)-g*d*h)/p),n&&(n[c]=(-(d*h)-u*g*m)/p,n[l]=m*p,n[f]=(u*h-g*d*m)/p)}else e&&(e[c]=d/p,e[l]=0,e[f]=-u/p),n&&(n[c]=-u*g/p,n[l]=p,n[f]=-g*d/p)}function lx(t,e,n){const r=at(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const i=at(t,e)/r;for(let a=0;a<3;a++)n[a]=e[a];return bv(n,i),!0}function eh(t,e){return t[0]*e[0]+t[1]*e[1]}function ux(t,e,n){const r=eh(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const i=eh(t,e)/r;for(let a=0;a<2;a++)n[a]=e[a];return Lv(n,i),!0}function si(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function fx(t,e){const n=[0,0,0];return kr(t,e,n),Math.atan2(fi(n),at(t,e))}function gx(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function dx(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function hx(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function Vv(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function px(t){const e=Vv(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function hn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function mx(t,e){let n,r,i;const a=[0,0,0];for(let o=0;o<3;o++)i=Math.abs(t[o*3]),(r=Math.abs(t[o*3+1]))>i&&(i=r),(r=Math.abs(t[o*3+2]))>i&&(i=r),a[o]=1/i;i=a[0]*Math.abs(t[0]),n=0,(r=a[1]*Math.abs(t[3]))>=i&&(i=r,n=1),(r=a[2]*Math.abs(t[6]))>=i&&(n=2),n!==0&&(Tl(t,3,n,0),a[n]=a[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=a[1]*Math.abs(t[4]),n=1,(r=a[2]*Math.abs(t[7]))>=i&&(n=2,Tl(t,3,1,2),a[2]=a[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function vx(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function yx(t,e,n){const r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],f=t[7],u=t[8],g=+hn(s,f,c,u),d=-hn(o,l,c,u),p=+hn(o,l,s,f),h=-hn(i,f,a,u),m=+hn(r,l,a,u),v=-hn(r,l,i,f),y=+hn(i,s,a,c),T=-hn(r,o,a,c),C=+hn(r,o,i,s),w=r*g+i*d+a*p,S=g*e[0]+h*e[1]+y*e[2],_=d*e[0]+m*e[1]+T*e[2],D=p*e[0]+v*e[1]+C*e[2];n[0]=S/w,n[1]=_/w,n[2]=D/w}function lf(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=i,n[2]=a}function th(t,e,n){const r=[...t],i=[...e];for(let a=0;a<3;a++)n[a]=r[0]*i[a]+r[1]*i[a+3]+r[2]*i[a+6],n[a+3]=r[3]*i[a]+r[4]*i[a+3]+r[5]*i[a+6],n[a+6]=r[6]*i[a]+r[7]*i[a+3]+r[8]*i[a+6]}function Tx(t,e,n,r,i,a,o){r!==i&&_v("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let l=0;l<n;l++)for(let f=0;f<a;f++){o[l*a+f]=0;for(let u=0;u<r;u++)o[l*a+f]+=s[l*r+u]*c[f+a*u]}}function n0(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function Cx(t,e){const n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=+hn(o,l,s,f),g=-hn(a,c,s,f),d=+hn(a,c,o,l),p=-hn(r,l,i,f),h=+hn(n,c,i,f),m=-hn(n,c,r,l),v=+hn(r,o,i,s),y=-hn(n,a,i,s),T=+hn(n,a,r,o),C=n*u+r*g+i*d;C===0&&yc("Matrix has 0 determinant"),e[0]=u/C,e[3]=g/C,e[6]=d/C,e[1]=p/C,e[4]=h/C,e[7]=m/C,e[2]=v/C,e[5]=y/C,e[8]=T/C}function Fg(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function Pv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Qh;if(t.length!==e.length)return!1;function r(i,a){return Math.abs(i-e[a])<=n}return t.every(r)}const h0=Pv;function Nv(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function Av(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function wx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qh;return h0(t,Jh,e)}function Sx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qh;return h0(t,GS,e)}function Fv(t,e){const n=t[0]*t[0],r=t[0]*t[1],i=t[0]*t[2],a=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],f=t[1]*t[3],u=t[2]*t[3],g=o+s+c;let d=1/(n+g);const p=(n-g)*d;d*=2,e[0]=o*d+p,e[3]=(l+a)*d,e[6]=(f-i)*d,e[1]=(l-a)*d,e[4]=s*d+p,e[7]=(u+r)*d,e[2]=(f+i)*d,e[5]=(u-r)*d,e[8]=c*d+p}function uf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function nh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=uf(t[0],n),e[1]=uf(t[1],n),e[2]=uf(t[2],n),e}function ru(t,e,n,r){let i,a,o,s,c,l,f,u,g,d,p,h,m,v,y,T;const C=nn(e),w=nn(e),S=(D,N,P)=>{v=D[N],m=D[P],D[N]=v-h*(m+v*d),D[P]=m+h*(v-m*d)};for(Av(e,r),c=0;c<e;c++)C[c]=n[c]=t[c+c*e],w[c]=0;for(i=0;i<L5;i++){for(p=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)p+=Math.abs(t[c*e+s]);if(p===0)break;for(i<3?f=.2*p/(e*e):f=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(v=100*Math.abs(t[c*e+s]),i>3&&Math.abs(n[c])+v===Math.abs(n[c])&&Math.abs(n[s])+v===Math.abs(n[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>f){for(m=n[s]-n[c],Math.abs(m)+v===Math.abs(m)?g=t[c*e+s]/m:(u=.5*m/t[c*e+s],g=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(g=-g)),y=1/Math.sqrt(1+g*g),h=g*y,d=h/(1+y),m=g*t[c*e+s],w[c]-=m,w[s]+=m,n[c]-=m,n[s]+=m,t[c*e+s]=0,a=0;a<=c-1;a++)S(t,a*e+c,a*e+s);for(a=c+1;a<=s-1;a++)S(t,c*e+a,a*e+s);for(a=s+1;a<e;a++)S(t,c*e+a,s*e+a);for(a=0;a<e;a++)S(r,a*e+c,a*e+s)}for(c=0;c<e;c++)C[c]+=w[c],n[c]=C[c],w[c]=0}if(i>=L5)return yc("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(a=0;a<e-1;a++){for(o=a,T=n[o],i=a+1;i<e;i++)(n[i]>=T||Math.abs(n[i]-T)<e2)&&(o=i,T=n[o]);o!==a&&(n[o]=n[a],n[a]=T,il(r,e,a,o))}const _=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)r[i]>=0&&l++;if(l<_)for(i=0;i<e;i++)r[i*e+a]*=-1;return 1}function Uv(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=[...n];ru(a,4,i,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function xx(t,e,n){const r=t[0]*e[0],i=t[0]*e[1],a=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],f=t[1]*e[3],u=t[2]*e[0],g=t[2]*e[1],d=t[2]*e[2],p=t[2]*e[3],h=t[3]*e[0],m=t[3]*e[1],v=t[3]*e[2],y=t[3]*e[3];n[0]=r-c-d-y,n[1]=i+s+p-v,n[2]=a-f+u+m,n[3]=o+l-g+h}function kv(t,e){for(let g=0;g<9;g++)e[g]=t[g];const n=nn(3),r=nn(3);let i;for(let g=0;g<3;g++){const d=Math.abs(e[g*3]),p=Math.abs(e[g*3+1]),h=Math.abs(e[g*3+2]);i=p>d?p:d,i=h>i?h:i,n[g]=1,i!==0&&(n[g]/=i)}const a=Math.abs(e[0])*n[0],o=Math.abs(e[3])*n[1],s=Math.abs(e[6])*n[2];r[0]=0,i=a,o>=i&&(i=o,r[0]=1),s>=i&&(r[0]=2),r[0]!==0&&(il(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],l=Math.abs(e[7])*n[2];r[1]=1,i=c,l>=i&&(r[1]=2,il(e,3,1,2)),r[2]=2;let f=0;if(Fg(e)<0){f=1;for(let g=0;g<9;g++)e[g]=-e[g]}const u=nn(4);if(Uv(e,u),Fv(u,e),f)for(let g=0;g<9;g++)e[g]=-e[g];r[1]!==1&&il(e,3,r[1],1),r[0]!==0&&il(e,3,r[0],0)}function Gv(t,e,n){let r,i,a,o,s,c;const l=[...t];if(ru(l,3,e,n),e[0]===e[1]&&e[0]===e[2]){Nv(n);return}for(n0(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),o=0,i=1;i<3;i++)c<(s=Math.abs(n[r*3+i]))&&(c=s,o=i);o!==r&&(s=e[o],e[o]=e[r],e[r]=s,Tl(n,3,r,o)),n[o*3+o]<0&&(n[o*3]=-n[o*3],n[o*3+1]=-n[o*3+1],n[o*3+2]=-n[o*3+2]),i=(o+1)%3,a=(o+2)%3,n[i*3]=0,n[i*3+1]=0,n[i*3+2]=0,n[i*3+i]=1;const f=kr([n[o*3],n[o*3+1],n[o*3+2]],[n[i*3],n[i*3+1],n[i*3+2]],[]);hi(f);const u=kr(f,[n[o*3],n[o*3+1],n[o*3+2]],[]);for(let g=0;g<3;g++)n[a*3+g]=f[g],n[i*3+g]=u[g];n0(n,n);return}for(c=Math.abs(n[0]),o=0,r=1;r<3;r++)c<(s=Math.abs(n[r*3]))&&(c=s,o=r);if(o!==0){const f=e[o];e[o]=e[0],e[0]=f,Tl(n,3,o,0)}if(Math.abs(n[4])<Math.abs(n[7])){const f=e[2];e[2]=e[1],e[1]=f,Tl(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);Fg(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),n0(n,n)}function Ex(t,e,n,r){let i;const a=[...t],o=Fg(a);if(o<0)for(i=0;i<9;i++)a[i]=-a[i];kv(a,e),n0(a,a),th(a,e,r),Gv(r,n,r),th(e,r,e),n0(r,r),o<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function n2(t,e,n){let r,i,a,o,s=0,c,l,f;const u=nn(n);for(r=0;r<n;r++){for(o=0,i=0;i<n;i++)(f=Math.abs(t[r*n+i]))>o&&(o=f);if(o===0)return yc("Unable to factor linear system"),0;u[r]=1/o}for(i=0;i<n;i++){for(r=0;r<i;r++){for(c=t[r*n+i],a=0;a<r;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c}for(o=0,r=i;r<n;r++){for(c=t[r*n+i],a=0;a<i;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c,(l=u[r]*Math.abs(c))>=o&&(o=l,s=r)}if(i!==s){for(a=0;a<n;a++)l=t[s*n+a],t[s*n+a]=t[i*n+a],t[i*n+a]=l;u[s]=u[i]}if(e[i]=s,Math.abs(t[i*n+i])<=e2)return yc("Unable to factor linear system"),0;if(i!==n-1)for(l=1/t[i*n+i],r=i+1;r<n;r++)t[r*n+i]*=l}return 1}function r2(t,e,n,r){let i,a,o,s,c;for(o=-1,i=0;i<r;i++){if(s=e[i],c=n[s],n[s]=n[i],o>=0)for(a=o;a<=i-1;a++)c-=t[i*r+a]*n[a];else c!==0&&(o=i);n[i]=c}for(i=r-1;i>=0;i--){for(c=n[i],a=i+1;a<r;a++)c-=t[i*r+a]*n[a];n[i]=c/t[i*r+i]}}function Bv(t,e,n){if(n===2){const i=nn(2),a=hn(t[0],t[1],t[2],t[3]);return a===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/a,i[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=i[0],e[1]=i[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=nn(n);return n2(t,r,n)===0?0:(r2(t,r,e,n),1)}function i2(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const a=r||nn(n),o=i||nn(n);if(n2(t,a,n)===0)return null;for(let s=0;s<n;s++){for(let c=0;c<n;c++)o[c]=0;o[s]=1,r2(t,a,o,n);for(let c=0;c<n;c++)e[c*n+s]=o[c]}return e}function Ox(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let a=i;a<e;a++)Math.abs(t[i*e+a])>r&&(r=Math.abs(t[i*e+a]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<n&&(n=Math.abs(t[i*e+i]));return n===0?Number.MAX_VALUE:r/n}function Rx(t,e,n){return ru(t,3,e,n)}function rh(t,e,n,r){if(t<n)return yc("Insufficient number of samples. Underdetermined."),0;let i,a,o;const s=nn(n*n),c=nn(n),l=nn(n*n);for(o=0;o<t;o++)for(i=0;i<n;i++)for(a=i;a<n;a++)s[i*n+a]+=e[o*n+i]*e[o*n+a];for(i=0;i<n;i++)for(a=0;a<i;a++)s[i*n+a]=s[a*n+i];for(ru(s,n,c,l),i=0;i<n;i++)r[i]=l[i*n+n-1];return 1}function Dx(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<i)return yc("Insufficient number of samples. Underdetermined."),0;const s=nn(i);let c=1,l,f=0,u,g,d,p=0;if(o){for(g=0;g<i;g++)s[g]=1;for(u=0;u<t;u++)for(g=0;g<i;g++)Math.abs(r[u*i+g])>e2&&(c=0,s[g]=0);if(c&&i===1)return yc("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),rh(t,e,n,a);if(c)p=1;else for(g=0;g<i;g++)s[g]&&(p=1)}p&&(l=nn(n),f=rh(t,e,n,l));const h=nn(n*n),m=nn(n*n),v=nn(n*i);for(d=0;d<t;d++)for(u=0;u<n;u++){for(g=u;g<n;g++)h[u*n+g]+=e[d*n+u]*e[d*n+g];for(g=0;g<i;g++)v[u*i+g]+=e[d*n+u]*r[d*i+g]}for(u=0;u<n;u++)for(g=0;g<u;g++)h[u*n+g]=h[g*n+u];const y=i2(h,m,n);if(y)for(u=0;u<n;u++)for(g=0;g<i;g++)for(a[u*i+g]=0,d=0;d<n;d++)a[u*i+g]+=m[u*n+d]*v[d*i+g];if(p){for(g=0;g<i;g++)if(s[g])for(u=0;u<n;u++)a[u*i+g]=l[u*i]}return p?f&&y:y}function Mx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function ol(t,e){let n,r;const[i,a,o]=t,s=1/3,c=1/6,l=2/3;let f=i,u=i;a>f?f=a:a<u&&(u=a),o>f?f=o:o<u&&(u=o);const g=f;g>0?r=(f-u)/f:r=0,r>0?(i===f?n=c*(a-o)/(f-u):a===f?n=s+c*(o-i)/(f-u):n=l+c*(i-a)/(f-u),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=g}function ac(t,e){const[n,r,i]=t,a=1/3,o=1/6,s=2/3,c=5/6;let l,f,u;n>o&&n<=a?(f=1,l=(a-n)/o,u=0):n>a&&n<=.5?(f=1,u=(n-a)/o,l=0):n>.5&&n<=s?(u=1,f=(s-n)/o,l=0):n>s&&n<=c?(u=1,l=(n-s)/o,f=0):n>c&&n<=1?(l=1,u=(1-n)/o,f=0):(l=1,f=n/o,u=0),l=r*l+(1-r),f=r*f+(1-r),u=r*u+(1-r),l*=i,f*=i,u*=i,e[0]=l,e[1]=f,e[2]=u}function $v(t,e){const[n,r,i]=t;let a=(n+16)/116,o=r/500+a,s=a-i/200;a**3>.008856?a**=3:a=(a-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,l=1,f=1.089;e[0]=c*o,e[1]=l*a,e[2]=f*s}function Wv(t,e){const[n,r,i]=t,a=.9505,o=1,s=1.089;let c=n/a,l=r/o,f=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-f)}function zv(t,e){const[n,r,i]=t;let a=n*3.2406+r*-1.5372+i*-.4986,o=n*-.9689+r*1.8758+i*.0415,s=n*.0557+r*-.204+i*1.057;a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=a;c<o&&(c=o),c<s&&(c=s),c>1&&(a/=c,o/=c,s/=c),a<0&&(a=0),o<0&&(o=0),s<0&&(s=0),e[0]=a,e[1]=o,e[2]=s}function Hv(t,e){let[n,r,i]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=n*.4124+r*.3576+i*.1805,e[1]=n*.2126+r*.7152+i*.0722,e[2]=n*.0193+r*.1192+i*.9505}function cc(t,e){const n=[0,0,0];Hv(t,n),Wv(n,e)}function jf(t,e){const n=[0,0,0];$v(t,n),zv(n,e)}function a2(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function ff(t){return!(t[1]-t[0]<0)}function _x(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function Wi(t,e,n){return t<e?e:t>n?n:t}function ih(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Wi(t[0],e[0],n[0]),r[1]=Wi(t[1],e[1],n[1]),r[2]=Wi(t[2],e[2],n[2]),r}function Ix(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const bx=nu("GetScalarTypeFittingRange"),Lx=nu("GetAdjustedScalarRange");function Vx(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function Px(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function Nx(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function Ax(t,e,n,r){const i=nn(3),a=nn(3),o=nn(3),s=nn(3),c=nn(3),l=nn(3);for(let C=0;C<3;++C)i[C]=t[C]-e[C],a[C]=e[C]-n[C],o[C]=n[C]-t[C],s[C]=-i[C],c[C]=-a[C],l[C]=-o[C];const f=fi(s),u=fi(c),g=fi(o),d=nn(3);kr(i,a,d);const p=fi(d),h=f*u*g/(2*p),m=2*p*p,v=u*u*at(i,l)/m,y=g*g*at(s,a)/m,T=f*f*at(o,c)/m;for(let C=0;C<3;++C)r[C]=v*t[C]+y*e[C]+T*n[C];return h}const Fx=1/0,Ux=-1/0,jv=t=>!Number.isFinite(t),{isFinite:kx,isNaN:ah}=Number,Kf=ah;function Tc(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function Gx(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const i=Math.abs(t[r]);i>e&&(n=r,e=i)}return n}function Kv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let a=0;a<e;++a)n[a]=a,r[a]=a;for(let a=e-1;a>0;a--){let o=-1/0,s=0,c=0;for(let l=0;l<=a;++l){const f=n[l];for(let u=0;u<=a;++u){const g=r[u],d=Math.abs(t[f+e*g]);d>o&&(o=d,s=l,c=u)}}[n[a],n[s]]=[n[s],n[a]],[r[a],r[c]]=[r[c],r[a]]}const i=new Array(e*e).fill(0);for(let a=0;a<e;++a){const o=n[a]+e*r[a];i[o]=t[o]<0?-1:1}return i}function qv(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function Bx(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(qv).join("")}`}function Su(t){return Math.round(t*255)}function $x(t){return t.length===3?`rgb(${t.map(Su).join(", ")})`:`rgba(${Su(t[0]||0)}, ${Su(t[1]||0)}, ${Su(t[2]||0)}, ${t[3]||0})`}var Tn={Pi:BS,ldexp:$S,radiansFromDegrees:gn,degreesFromRadians:Hf,round:WS,floor:t2,ceil:zS,ceilLog2:YS,min:HS,max:jS,arrayMin:KS,arrayMax:qS,arrayRange:XS,isPowerOfTwo:al,nearestPowerOfTwo:qo,factorial:ZS,binomial:JS,beginCombination:QS,nextCombination:ex,randomSeed:tx,getSeed:nx,random:rx,gaussian:ix,add:d0,subtract:Kn,multiplyScalar:bv,multiplyScalar2D:Lv,multiplyAccumulate:Qd,multiplyAccumulate2D:ax,dot:at,outer:ox,cross:kr,norm:fi,normalize:hi,perpendiculars:cx,projectVector:lx,projectVector2D:ux,distance2BetweenPoints:si,angleBetweenVectors:fx,gaussianAmplitude:gx,gaussianWeight:dx,dot2D:eh,outer2D:hx,norm2D:Vv,normalize2D:px,determinant2x2:hn,LUFactor3x3:mx,LUSolve3x3:vx,linearSolve3x3:yx,multiply3x3_vect3:lf,multiply3x3_mat3:th,multiplyMatrix:Tx,transpose3x3:n0,invert3x3:Cx,identity3x3:Nv,identity:Av,isIdentity:wx,isIdentity3x3:Sx,determinant3x3:Fg,quaternionToMatrix3x3:Fv,areEquals:Pv,areMatricesEqual:h0,roundNumber:uf,roundVector:nh,matrix3x3ToQuaternion:Uv,multiplyQuaternion:xx,orthogonalize3x3:kv,diagonalize3x3:Gv,singularValueDecomposition3x3:Ex,solveLinearSystem:Bv,invertMatrix:i2,luFactorLinearSystem:n2,luSolveLinearSystem:r2,estimateMatrixCondition:Ox,jacobi:Rx,jacobiN:ru,solveHomogeneousLeastSquares:rh,solveLeastSquares:Dx,hex2float:Mx,rgb2hsv:ol,hsv2rgb:ac,lab2xyz:$v,xyz2lab:Wv,xyz2rgb:zv,rgb2xyz:Hv,rgb2lab:cc,lab2rgb:jf,uninitializeBounds:a2,areBoundsInitialized:ff,computeBoundsFromPoints:_x,clampValue:Wi,clampVector:ih,clampAndNormalizeValue:Ix,getScalarTypeFittingRange:bx,getAdjustedScalarRange:Lx,extentIsWithinOtherExtent:Vx,boundsIsWithinOtherBounds:Px,pointIsWithinBounds:Nx,solve3PointCircle:Ax,inf:Fx,negInf:Ux,isInf:jv,isNan:ah,isNaN:ah,isFinite:kx,createUninitializedBounds:Tc,getMajorAxisIndex:Gx,getSparseOrthogonalMatrix:Kv,floatToHex2:qv,floatRGB2HexCode:Bx,float2CssRGBA:$x};const Wx={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},dt={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},zx=dt.FLOAT;var Xv={DefaultDataType:zx,DataTypeByteSize:Wx,VtkDataTypes:dt};const{vtkErrorMacro:Hx}=Dr,{DefaultDataType:jx}=Xv,Kx=1e-6;function oh(t,e,n){const r=t.length;let i=Number.MAX_VALUE,a=-Number.MAX_VALUE,o,s;for(s=e;s<r;s+=n)if(!Number.isNaN(t[s])){i=t[s],a=i;break}for(;s<r;s+=n)o=t[s],o<i?i=o:o>a&&(a=o);return{min:i,max:a}}function qx(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function Yv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const i=t.length/n,a=new Float64Array(i);for(let o=0,s=0;o<i;++o){for(let c=s+n;s<c;++s)a[o]+=t[s]*t[s];a[o]**=.5}return oh(a,0,1)}return oh(t,e<0?0:e,n)}function V5(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function o2(t){return Object.prototype.toString.call(t).slice(8,-1)}function Xx(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,r);const a=fi(r,e);a>n&&(n=a)}return n}const Yx={computeRange:Yv,createRangeHelper:qx,fastComputeRange:oh,getDataType:o2,getMaxNorm:Xx};function Zx(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const i=t.getNumberOfComponents(),a=e.values.length/(i>0?i:1);if(r===a)return!0;if(r>a){const o=e.values;return e.values=_0(e.dataType,(r+a)*i),e.values.set(o),!0}return e.size>r*i&&(e.size=r*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.allocate=r=>{n(t.getNumberOfTuples()+r)},t.resize=r=>{n(r);const i=r*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>(t.resize(0),t),t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+i]},t.setComponent=(r,i,a)=>{a!==e.values[r*e.numberOfComponents+i]&&(e.values[r*e.numberOfComponents+i]=a,t.dataChange())},t.getValue=r=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;return t.getComponent(i,a)},t.setValue=(r,i)=>{const a=r/e.numberOfComponents,o=r%e.numberOfComponents;t.setComponent(a,o,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=r;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let a=null;return e.ranges||(e.ranges=V5(e.ranges,e.numberOfComponents)),a=e.ranges[i],a?(e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple):(a=Yv(t.getData(),r,e.numberOfComponents),e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple)},t.setRange=(r,i)=>{e.ranges||(e.ranges=V5(e.ranges,e.numberOfComponents));const a={min:r.min,max:r.max};return e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);const i=[];for(let a=0;a<e.numberOfComponents;a++){const[o,s]=t.getRange(a),c={min:o,max:s};i.push(c)}if(e.numberOfComponents>1){const[a,o]=t.getRange(-1),s={min:a,max:o};i.push(s)}return i},t.setTuple=(r,i)=>{const a=r*e.numberOfComponents;for(let o=0;o<e.numberOfComponents;o++)e.values[a+o]=i[o]},t.setTuples=(r,i)=>{let a=r*e.numberOfComponents;const o=Math.min(i.length,e.size-a);for(let s=0;s<o;)e.values[a++]=i[s++]},t.insertTuple=(r,i)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,i),r),t.insertTuples=(r,i)=>{const a=r+i.length/e.numberOfComponents;return e.size<a*e.numberOfComponents&&(e.size=a*e.numberOfComponents,n(a)),t.setTuples(r,i),a},t.insertNextTuple=r=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,r)},t.insertNextTuples=r=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,r)},t.findTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kx;for(let a=0;a<e.size;a+=e.numberOfComponents)if(Math.abs(r[0]-e.values[a])<=i){let o=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(r[s]-e.values[a+s])>i){o=!1;break}if(o)return a/e.numberOfComponents}return-1},t.getTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=e.numberOfComponents||1,o=r*a;switch(a){case 4:i[3]=e.values[o+3];case 3:i[2]=e.values[o+2];case 2:i[1]=e.values[o+1];case 1:i[0]=e.values[o];break;default:for(let s=a-1;s>=0;--s)i[s]=e.values[o+s]}return i},t.getTuples=(r,i)=>{const a=(r??0)*e.numberOfComponents,o=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(a,o);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>Jv({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,i)=>{e.values=r,e.size=r.length,e.dataType=o2(r),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const i={};return Object.keys(r).sort().forEach(a=>{i[a]=r[a]}),i.mtime&&delete i.mtime,i},t.deepCopy=r=>{const i=t.getDataType(),a=e.values;t.shallowCopy(r),e.ranges=structuredClone(r.getRanges()),a?.length>=r.getNumberOfValues()&&i===r.getDataType()?(a.set(r.getData()),e.values=a,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,i,a,o,s,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==o.getNumberOfComponents())&&Hx("numberOfComponents must match");const f=i.getTuple(a),u=o.getTuple(s),g=[];switch(g.length=l,l){case 4:g[3]=f[3]+(u[3]-f[3])*c;case 3:g[2]=f[2]+(u[2]-f[2])*c;case 2:g[1]=f[1]+(u[1]-f[1])*c;case 1:g[0]=f[0]+(u[0]-f[0])*c;break;default:for(let d=0;d<l;d++)g[d]=f[d]+(u[d]-f[d])*c}return t.insertTuple(r,g)}}const Jx={name:"",numberOfComponents:1,dataType:jx,rangeTuple:[0,0]};function Zv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Jx,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Ng(e.dataType,e.values)):e.values=_0(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=o2(e.values)),an(t,e),Ql(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");Zx(t,e)}const Jv=Yt(Zv,"vtkDataArray");var ot={newInstance:Jv,extend:Zv,...Yx,...Xv};const Qx={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},sh={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},eE={LINEAR:0,LOG10:1};var s2={VectorMode:Qx,ScalarMappingTarget:sh,Scale:eE};const tE={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},nE={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},rE={BY_ID:0,BY_NAME:1};var c2={ColorMode:tE,GetArray:rE,ScalarMode:nE};const{ScalarMappingTarget:P5,Scale:iE,VectorMode:la}=s2,{VtkDataTypes:Bo}=ot,{ColorMode:xu}=c2,{vtkErrorMacro:N5}=A;function aE(t){return t}function A5(t){return Math.floor(t*255+.5)}function oE(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(la.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(la.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(la.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){N5("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const i=r.length;for(let a=0;a<i;a++)e.annotationArray.push({value:n[a],annotation:String(r[a])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let i=t.checkForAnnotatedValue(n),a=!1;return i>=0?e.annotationArray[i].annotation!==r&&(e.annotationArray[i].annotation=r,a=!0):(e.annotationArray.push({value:n,annotation:r}),i=e.annotationArray.length-1,a=!0),a&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),i=r>=0;return i&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(n);t.getIndexedColor(i,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,i)=>{const a=n.getNumberOfComponents();let o=null;if(r===xu.DEFAULT&&(n.getDataType()===Bo.UNSIGNED_CHAR||n.getDataType()===Bo.UNSIGNED_CHAR_CLAMPED)||r===xu.DIRECT_SCALARS&&n)o=t.convertToRGBA(n,a,n.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:Bo.UNSIGNED_CHAR},c=A.newTypedArray(s.dataType,4*n.getNumberOfTuples());s.values=c,s.size=c.length,o=ot.newInstance(s);let l=i;l<0&&a>1?t.mapVectorsThroughTable(n,o,P5.RGBA,-1,-1):(l<0&&(l=0),l>=a&&(l=a-1),t.mapScalarsThroughTable(n,o,P5.RGBA,l))}return o},t.mapVectorsToMagnitude=(n,r,i)=>{const a=n.getNumberOfTuples(),o=n.getNumberOfComponents(),s=r.getData(),c=n.getData();for(let l=0;l<a;l++){let f=0;for(let u=0;u<i;u++)f+=c[l*o+u]*c[l*o+u];s[l]=Math.sqrt(f)}},t.mapVectorsThroughTable=(n,r,i,a,o)=>{let s=t.getVectorMode(),c=o,l=a;const f=n.getNumberOfComponents();s===la.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=f&&(l=f-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=f):(l<0&&(l=0),l>=f&&(l=f-1),l+c>f&&(c=f-l)),s===la.MAGNITUDE&&(f===1||c===1)&&(s=la.COMPONENT));let u=0;switch(l>0&&(u=l),s){case la.COMPONENT:{t.mapScalarsThroughTable(n,r,i,u);break}case la.RGBCOLORS:break;case la.MAGNITUDE:default:{const g=ot.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,g,c),t.mapScalarsThroughTable(g,r,i,0);break}}},t.luminanceToRGBA=(n,r,i,a)=>{const o=a(i),s=r.getData(),c=n.getData(),l=s.length,f=0,u=1;let g=0;for(let d=f;d<l;d+=u){const p=a(s[d]);c[g*4]=p,c[g*4+1]=p,c[g*4+2]=p,c[g*4+3]=o,g++}},t.luminanceAlphaToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,l=0,f=2;let u=0;for(let g=l;g<c;g+=f){const d=a(o[g]);s[u]=d,s[u+1]=d,s[u+2]=d,s[u+3]=a(o[g+1])*i,u+=4}},t.rGBToRGBA=(n,r,i,a)=>{const o=A5(i),s=r.getData(),c=n.getData(),l=s.length,f=0,u=3;let g=0;for(let d=f;d<l;d+=u)c[g*4]=a(s[d]),c[g*4+1]=a(s[d+1]),c[g*4+2]=a(s[d+2]),c[g*4+3]=o,g++},t.rGBAToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,l=0,f=4;let u=0;for(let g=l;g<c;g+=f)s[u*4]=a(o[g]),s[u*4+1]=a(o[g+1]),s[u*4+2]=a(o[g+2]),s[u*4+3]=a(o[g+3])*i,u++},t.convertToRGBA=(n,r,i)=>{let{alpha:a}=e;if(r===4&&a>=1&&n.getDataType()===Bo.UNSIGNED_CHAR)return n;const o=ot.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:Bo.UNSIGNED_CHAR});if(i<=0)return o;a=a>0?a:0,a=a<1?a:1;let s=aE;switch((n.getDataType()===Bo.FLOAT||n.getDataType()===Bo.DOUBLE)&&(s=A5),r){case 1:t.luminanceToRGBA(o,n,a,s);break;case 2:t.luminanceAlphaToRGBA(o,n,s);break;case 3:t.rGBToRGBA(o,n,a,s);break;case 4:t.rGBAToRGBA(o,n,a,s);break;default:return N5("Cannot convert colors"),null}return o},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,i)=>{if(!n)return t.isOpaque();const a=n.getNumberOfComponents();return r===xu.DEFAULT&&n.getDataType()===Bo.UNSIGNED_CHAR||r===xu.DIRECT_SCALARS?a===3||a===1?e.alpha>=1:n.getRange(a-1)[0]===255:!0}}const sE={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:la.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:iE.LINEAR};function Qv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sE,n),A.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],A.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),A.setArray(t,e,["mappingRange"],2),A.getArray(t,e,["mappingRange"]),oE(t,e)}const cE=A.newInstance(Qv,"vtkScalarsToColors");var l2={newInstance:cE,extend:Qv,...s2};const lE={RGB:0,HSV:1,LAB:2,DIVERGING:3},uE={LINEAR:0,LOG10:1};var e8={ColorSpace:lE,Scale:uE};const{ColorSpace:Oi,Scale:u2}=e8,{ScalarMappingTarget:Eu}=l2,{vtkDebugMacro:fE,vtkErrorMacro:ja,vtkWarningMacro:gE}=A;function F5(t,e){const n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i),o=a>.001?Math.acos(n/a):0,s=o>.001?Math.atan2(i,r):0;e[0]=a,e[1]=o,e[2]=s}function dE(t,e){const n=t[0],r=t[1],i=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(i),e[2]=n*Math.sin(r)*Math.sin(i)}function U5(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function hE(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function k5(t,e,n,r){const i=[],a=[];cc(e,i),cc(n,a);const o=[],s=[];F5(i,o),F5(a,s);let c=t;if(o[1]>.05&&s[1]>.05&&hE(o[2],s[2])>.33*Math.PI){let u=Math.max(o[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(o[0]=u,o[1]=0,o[2]=0,c=2*c-1)}o[1]<.05&&s[1]>.05?o[2]=U5(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=U5(o,s[0]));const l=[];l[0]=(1-c)*o[0]+c*s[0],l[1]=(1-c)*o[1]+c*s[1],l[2]=(1-c)*o[2]+c*s[2];const f=[];dE(l,f),jf(f,r)}function pE(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,i,a)=>t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return ja("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return ja("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const c={x:n,r,g:i,b:a,midpoint:o,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==n;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(n,r,i,a)=>t.addHSVPointLong(n,r,i,a,.5,0),t.addHSVPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return ac([r,i,a],c),t.addRGBPoint(n,c[0],c[1],c[2],o,s)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((a,o)=>a.x-o.x);const r=JSON.stringify(e.nodes),i=t.updateRange();return!i&&n!==r?(t.modified(),!0):i},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const i=r;if(r>=e.nodes.length)return-1;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===n){e.nodes[i].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,i,a,o,s,c,l)=>{t.sortAndUpdateRange();for(let f=0;f<e.nodes.length;)e.nodes[f].x>=n&&e.nodes[f].x<=o?e.nodes.splice(f,1):f++;t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong(o,s,c,l,.5,0),t.modified()},t.addHSVSegment=(n,r,i,a,o,s,c,l)=>{const f=[r,i,a],u=[s,c,l],g=[],d=[];ac(f,g),ac(u,d),t.addRGBSegment(n,g[0],g[1],g[2],o,d[0],d[1],d[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const i=t.getSize(),a=t.getAnnotatedValueIndexInternal(n);if(a<0||i===0){const o=t.getNanColorByReference();r[0]=o[0],r[1]=o[1],r[2]=o[2]}else{const o=[];t.getNodeValue(a%i,o),r[0]=o[1],r[1]=o[2],r[2]=o[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.logScaleEnabled=()=>e.scale===u2.LOG10,t.usingLogScale=()=>t.logScaleEnabled()&&e.mappingRange[0]>0,t.getTable=(n,r,i,a)=>{const o=t.usingLogScale(),s=o?Math.log10(Number(n)):Number(n),c=o?Math.log10(Number(r)):Number(r);if(Kf(s)||Kf(c)){for(let _=0;_<i;_++)a[_*3+0]=e.nanColor[0],a[_*3+1]=e.nanColor[1],a[_*3+2]=e.nanColor[2];return}let l=0;const f=e.nodes.length;let u=0,g=0,d=0;f!==0&&(u=e.nodes[f-1].r,g=e.nodes[f-1].g,d=e.nodes[f-1].b);let p=0,h=0,m=0;const v=[0,0,0],y=[0,0,0];let T=0,C=0;const w=[];let S=e.mappingRange;o&&(S=[Math.log10(e.mappingRange[0]),Math.log10(e.mappingRange[1])]);for(let _=0;_<i;_++){const D=3*_;if(i>1?p=s+_/(i-1)*(c-s):p=.5*(s+c),e.discretize){const N=S;if(p>=N[0]&&p<=N[1]){const P=e.numberOfValues,F=N[1]-N[0];if(P<=1)p=N[0]+F/2;else{const B=(p-N[0])/F,k=t2(P*B);p=N[0]+k/(P-1)*F}}}for(;l<f&&p>e.nodes[l].x;)l++,l<f&&(h=e.nodes[l-1].x,m=e.nodes[l].x,v[0]=e.nodes[l-1].r,y[0]=e.nodes[l].r,v[1]=e.nodes[l-1].g,y[1]=e.nodes[l].g,v[2]=e.nodes[l-1].b,y[2]=e.nodes[l].b,T=e.nodes[l-1].midpoint,C=e.nodes[l-1].sharpness,T<1e-5&&(T=1e-5),T>.99999&&(T=.99999));if(p>S[1])a[D]=0,a[D+1]=0,a[D+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(a[D]=e.aboveRangeColor[0],a[D+1]=e.aboveRangeColor[1],a[D+2]=e.aboveRangeColor[2]):(a[D]=u,a[D+1]=g,a[D+2]=d));else if(p<S[0]||jv(p)&&p<0)a[D]=0,a[D+1]=0,a[D+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(a[D]=e.belowRangeColor[0],a[D+1]=e.belowRangeColor[1],a[D+2]=e.belowRangeColor[2]):f>0&&(a[D]=e.nodes[0].r,a[D+1]=e.nodes[0].g,a[D+2]=e.nodes[0].b));else if(l===0&&(Math.abs(p-s)<1e-6||e.discretize))f>0?(a[D]=e.nodes[0].r,a[D+1]=e.nodes[0].g,a[D+2]=e.nodes[0].b):(a[D]=0,a[D+1]=0,a[D+2]=0);else{let N=0;if(N=(p-h)/(m-h),N<T?N=.5*N/T:N=.5+.5*(N-T)/(1-T),C>.99)if(N<.5){a[D]=v[0],a[D+1]=v[1],a[D+2]=v[2];continue}else{a[D]=y[0],a[D+1]=y[1],a[D+2]=y[2];continue}if(C<.01){if(e.colorSpace===Oi.RGB)a[D]=(1-N)*v[0]+N*y[0],a[D+1]=(1-N)*v[1]+N*y[1],a[D+2]=(1-N)*v[2]+N*y[2];else if(e.colorSpace===Oi.HSV){const ne=[],q=[];ol(v,ne),ol(y,q),e.hSVWrap&&(ne[0]-q[0]>.5||q[0]-ne[0]>.5)&&(ne[0]>q[0]?ne[0]-=1:q[0]-=1);const Q=[];Q[0]=(1-N)*ne[0]+N*q[0],Q[0]<0&&(Q[0]+=1),Q[1]=(1-N)*ne[1]+N*q[1],Q[2]=(1-N)*ne[2]+N*q[2],ac(Q,w),a[D]=w[0],a[D+1]=w[1],a[D+2]=w[2]}else if(e.colorSpace===Oi.LAB){const ne=[],q=[];cc(v,ne),cc(y,q);const Q=[];Q[0]=(1-N)*ne[0]+N*q[0],Q[1]=(1-N)*ne[1]+N*q[1],Q[2]=(1-N)*ne[2]+N*q[2],jf(Q,w),a[D]=w[0],a[D+1]=w[1],a[D+2]=w[2]}else e.colorSpace===Oi.DIVERGING?(k5(N,v,y,w),a[D]=w[0],a[D+1]=w[1],a[D+2]=w[2]):ja("ColorSpace set to invalid value.",e.colorSpace);continue}N<.5?N=.5*(N*2)**(1+10*C):N>.5&&(N=1-.5*((1-N)*2)**(1+10*C));const P=N*N,F=P*N,B=2*F-3*P+1,k=-2*F+3*P,U=F-2*P+N,H=F-P;let W,J;if(e.colorSpace===Oi.RGB)for(let ne=0;ne<3;ne++)W=y[ne]-v[ne],J=(1-C)*W,a[D+ne]=B*v[ne]+k*y[ne]+U*J+H*J;else if(e.colorSpace===Oi.HSV){const ne=[],q=[];ol(v,ne),ol(y,q),e.hSVWrap&&(ne[0]-q[0]>.5||q[0]-ne[0]>.5)&&(ne[0]>q[0]?ne[0]-=1:q[0]-=1);const Q=[];for(let ae=0;ae<3;ae++)W=q[ae]-ne[ae],J=(1-C)*W,Q[ae]=B*ne[ae]+k*q[ae]+U*J+H*J,ae===0&&Q[ae]<0&&(Q[ae]+=1);ac(Q,w),a[D]=w[0],a[D+1]=w[1],a[D+2]=w[2]}else if(e.colorSpace===Oi.LAB){const ne=[],q=[];cc(v,ne),cc(y,q);const Q=[];for(let ae=0;ae<3;ae++)W=q[ae]-ne[ae],J=(1-C)*W,Q[ae]=B*ne[ae]+k*q[ae]+U*J+H*J;jf(Q,w),a[D]=w[0],a[D+1]=w[1],a[D+2]=w[2]}else e.colorSpace===Oi.DIVERGING?(k5(N,v,y,w),a[D]=w[0],a[D+1]=w[1],a[D+2]=w[2]):ja("ColorSpace set to invalid value.");for(let ne=0;ne<3;ne++)a[D+ne]=a[D+ne]<0?0:a[D+ne],a[D+ne]=a[D+ne]>1?1:a[D+ne]}}},t.getUint8Table=function(n,r,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==a)return e.table;if(e.nodes.length===0)return ja("Attempting to lookup a value with no points in the function"),e.table;const o=a?4:3;(e.tableSize!==i||e.tableWithAlpha!==a)&&(e.table=new Uint8Array(i*o),e.tableSize=i,e.tableWithAlpha=a);const s=[];t.getTable(n,r,i,s);for(let c=0;c<i;c++)e.table[c*o+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*o+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*o+2]=Math.floor(s[c*3+2]*255+.5),a&&(e.table[c*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let i=0;i<n.getNumberOfTuples();i++)switch(r){case 3:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}case 6:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,i,a)=>{let o=0;t.removeAllPoints(),i>1&&(o=(r-n)/(i-1));for(let s=0;s<i;s++){const c={x:n+o*s,r:a[s*3],g:a[s*3+1],b:a[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(ja("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return ja("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const n=e.nodes?.length??0;return Math.max(4094,n)},t.getIndexedColor=(n,r)=>{const i=t.getSize();if(i>0&&n>=0){const o=[];t.getNodeValue(n%i,o);for(let s=0;s<3;++s)r[s]=o[s+1];r[3]=1;return}const a=t.getNanColorByReference();r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let i=0;i<n;i++)t.addRGBPoint(r[i*4],r[i*4+1],r[i*4+2],r[i*4+3])}},t.setMappingRange=(n,r)=>{const i=[n,r],a=[n,r],o=t.getRange(),s=t.logScaleEnabled();if(o[1]===i[1]&&o[0]===i[0])return;if(i[1]===i[0]){ja("attempt to set zero width color range");return}s&&(i[0]<=0?console.warn("attempt to set log scale color range with non-positive minimum"):(a[0]=Math.log10(i[0]),a[1]=Math.log10(i[1])));const c=(a[1]-a[0])/(o[1]-o[0]),l=a[0]-o[0]*c;for(let f=0;f<e.nodes.length;++f)e.nodes[f].x=e.nodes[f].x*c+l;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),i=[];r[0]<n[0]?(t.getColor(n[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])):(t.getColor(r[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])),r[1]>n[1]?(t.getColor(n[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])):(t.getColor(r[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const i=e.nodes[r+1].x-e.nodes[r].x;i<n&&(n=i)}return n},t.mapScalarsThroughTable=(n,r,i,a)=>{if(t.getSize()===0){fE("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,i,a):t.mapData(n,r,i,a)},t.mapData=(n,r,i,a)=>{if(t.getSize()===0){gE("Transfer Function Has No Points!");return}const o=Math.floor(t.getAlpha()*255+.5),s=n.getNumberOfTuples(),c=n.getNumberOfComponents(),l=r.getData(),f=n.getData(),u=[];if(i===Eu.RGBA)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*4]=Math.floor(u[0]*255+.5),l[g*4+1]=Math.floor(u[1]*255+.5),l[g*4+2]=Math.floor(u[2]*255+.5),l[g*4+3]=o}if(i===Eu.RGB)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*3]=Math.floor(u[0]*255+.5),l[g*3+1]=Math.floor(u[1]*255+.5),l[g*3+2]=Math.floor(u[2]*255+.5)}if(i===Eu.LUMINANCE)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(i===Eu.LUMINANCE_ALPHA)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[g*2+1]=o}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=Oi[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(ja(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=Oi.RGB));let i=r!==JSON.stringify(e.colorSpace);const a=i||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||a!==JSON.stringify(e.nanColor);const o=i||JSON.stringify(e.nodes);if(n.RGBPoints){const l=n.RGBPoints.length;e.nodes=[];const f=.5,u=0;for(let g=0;g<l;g+=4)e.nodes.push({x:n.RGBPoints[g],r:n.RGBPoints[g+1],g:n.RGBPoints[g+2],b:n.RGBPoints[g+3],midpoint:f,sharpness:u})}const s=t.sortAndUpdateRange(),c=!s&&(i||o!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const mE={clamping:!0,colorSpace:Oi.RGB,hSVWrap:!0,scale:u2.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function t8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mE,n),l2.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},A.obj(e.buildTime),A.get(t,e,["buildTime","mappingRange"]),A.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:Oi},{type:"enum",name:"scale",enum:u2}]),A.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),A.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),pE(t,e)}const vE=A.newInstance(t8,"vtkColorTransferFunction");var po={newInstance:vE,extend:t8,...e8},yE=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const p0=Object.create(null);yE.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{p0[t.Name]=t});const m0=Object.keys(p0);m0.sort();function TE(t){return p0[t]}function CE(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(p0[t.Name]||(m0.push(t.Name),m0.sort()),p0[t.Name]=t)}function wE(t){const e=m0.indexOf(t);e>-1&&m0.splice(e,1),delete p0[t]}var kl={addPreset:CE,removePresetByName:wE,getPresetByName:TE,rgbPresetNames:m0};const{vtkErrorMacro:Ou}=A;function SE(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,i=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let a=1;a<e.nodes.length;a++){if(n=e.nodes[a].y,n!==r)if(n>r)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(r=n,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){n=0;break}return n?r=Number.MAX_VALUE:i>0?r=e.nodes[i-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const i=e.nodes.length;return n<0||n>=i?(Ou("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const i=e.nodes.length;if(n<0||n>=i)return Ou("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,i,a)=>{if(i<0||i>1)return Ou("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return Ou("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const o={x:n,y:r,midpoint:i,sharpness:a};e.nodes.push(o),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==n;s++);return s<e.nodes.length?s:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,i)=>r.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const i=r;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,i,a)=>{t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=n&&e.nodes[o].x<=i?e.nodes.splice(o,1):o++;t.addPoint(n,r,.5,0),t.addPoint(i,a,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<n-1;i++){const a=e.nodes[i+1].x-e.nodes[i].x;a<r&&(r=a)}return r},t.getTable=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const l=e.nodes.length;let f=0;l!==0&&(f=e.nodes[l-1].y);let u=0,g=0,d=0,p=0,h=0,m=0,v=0;for(s=0;s<i;s++){const y=o*s;for(i>1?u=n+s/(i-1)*(r-n):u=.5*(n+r);c<l&&u>e.nodes[c].x;)c++,c<l&&(g=e.nodes[c-1].x,d=e.nodes[c].x,p=e.nodes[c-1].y,h=e.nodes[c].y,m=e.nodes[c-1].midpoint,v=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(c>=l)a[y]=e.clamping?f:0;else if(c===0)a[y]=e.clamping?e.nodes[0].y:0;else{let T=(u-g)/(d-g);if(T<m?T=.5*T/m:T=.5+.5*(T-m)/(1-m),v>.99)if(T<.5){a[y]=p;continue}else{a[y]=h;continue}if(v<.01){a[y]=(1-T)*p+T*h;continue}T<.5?T=.5*(T*2)**(1+10*v):T>.5&&(T=1-.5*((1-T)*2)**(1+10*v));const C=T*T,w=C*T,S=2*w-3*C+1,_=-2*w+3*C,D=w-2*C+T,N=w-C,P=h-p,F=(1-v)*P;a[y]=S*p+_*h+D*F+N*F;const B=p<h?p:h,k=p>h?p:h;a[y]=a[y]<B?B:a[y],a[y]=a[y]>k?k:a[y]}}}}const xE={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function n8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xE,n),A.obj(t,e),e.nodes=[],A.setGet(t,e,["allowDuplicateScalars","clamping"]),A.setArray(t,e,["range"],2),A.getArray(t,e,["range"]),SE(t,e)}const EE=A.newInstance(n8,"vtkPiecewiseFunction");var Cc={newInstance:EE,extend:n8},Mt=1e-6,Sn=typeof Float32Array<"u"?Float32Array:Array,OE=Math.PI/180;function RE(t){return t*OE}function qf(t,e){return Math.abs(t-e)<=Mt*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function ua(){var t=new Sn(9);return Sn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function uc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function DE(t){var e=new Sn(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ME(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function sl(t,e,n,r,i,a,o,s,c){var l=new Sn(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=c,l}function r8(t,e,n,r,i,a,o,s,c,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l,t}function bi(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Gl(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function ds(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=f*o-s*l,g=-f*a+s*c,d=l*a-o*c,p=n*u+r*g+i*d;return p?(p=1/p,t[0]=u*p,t[1]=(-f*r+i*l)*p,t[2]=(s*r-i*o)*p,t[3]=g*p,t[4]=(f*n-i*c)*p,t[5]=(-s*n+i*a)*p,t[6]=d*p,t[7]=(-l*n+r*c)*p,t[8]=(o*n-r*a)*p,t):null}function _E(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8];return t[0]=o*f-s*l,t[1]=i*l-r*f,t[2]=r*s-i*o,t[3]=s*c-a*f,t[4]=n*f-i*c,t[5]=i*a-n*s,t[6]=a*l-o*c,t[7]=r*c-n*l,t[8]=n*o-r*a,t}function Zs(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8];return e*(l*a-o*c)+n*(-l*i+o*s)+r*(c*i-a*s)}function fc(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],d=n[1],p=n[2],h=n[3],m=n[4],v=n[5],y=n[6],T=n[7],C=n[8];return t[0]=g*r+d*o+p*l,t[1]=g*i+d*s+p*f,t[2]=g*a+d*c+p*u,t[3]=h*r+m*o+v*l,t[4]=h*i+m*s+v*f,t[5]=h*a+m*c+v*u,t[6]=y*r+T*o+C*l,t[7]=y*i+T*s+C*f,t[8]=y*a+T*c+C*u,t}function IE(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=c,t[6]=g*r+d*o+l,t[7]=g*i+d*s+f,t[8]=g*a+d*c+u,t}function bE(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=Math.sin(n),d=Math.cos(n);return t[0]=d*r+g*o,t[1]=d*i+g*s,t[2]=d*a+g*c,t[3]=d*o-g*r,t[4]=d*s-g*i,t[5]=d*c-g*a,t[6]=l,t[7]=f,t[8]=u,t}function LE(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function VE(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function PE(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function NE(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function AE(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function FE(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,l=n*o,f=r*o,u=r*s,g=i*o,d=i*s,p=i*c,h=a*o,m=a*s,v=a*c;return t[0]=1-u-p,t[3]=f-v,t[6]=g+m,t[1]=f+v,t[4]=1-l-p,t[7]=d-h,t[2]=g-m,t[5]=d+h,t[8]=1-l-u,t}function UE(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],p=e[12],h=e[13],m=e[14],v=e[15],y=n*s-r*o,T=n*c-i*o,C=n*l-a*o,w=r*c-i*s,S=r*l-a*s,_=i*l-a*c,D=f*h-u*p,N=f*m-g*p,P=f*v-d*p,F=u*m-g*h,B=u*v-d*h,k=g*v-d*m,U=y*k-T*B+C*F+w*P-S*N+_*D;return U?(U=1/U,t[0]=(s*k-c*B+l*F)*U,t[1]=(c*P-o*k-l*N)*U,t[2]=(o*B-s*P+l*D)*U,t[3]=(i*B-r*k-a*F)*U,t[4]=(n*k-i*P+a*N)*U,t[5]=(r*P-n*B-a*D)*U,t[6]=(h*_-m*S+v*w)*U,t[7]=(m*C-p*_-v*T)*U,t[8]=(p*S-h*C+v*y)*U,t):null}function kE(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function GE(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function BE(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function $E(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function i8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function WE(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function zE(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function HE(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function jE(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=e[0],g=e[1],d=e[2],p=e[3],h=e[4],m=e[5],v=e[6],y=e[7],T=e[8];return Math.abs(n-u)<=Mt*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-g)<=Mt*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-d)<=Mt*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=Mt*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-h)<=Mt*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-m)<=Mt*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=Mt*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-y)<=Mt*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-T)<=Mt*Math.max(1,Math.abs(f),Math.abs(T))}var KE=fc,qE=i8;const XE=Object.freeze(Object.defineProperty({__proto__:null,add:$E,adjoint:_E,clone:DE,copy:ME,create:ua,determinant:Zs,equals:jE,exactEquals:HE,frob:BE,fromMat2d:AE,fromMat4:uc,fromQuat:FE,fromRotation:PE,fromScaling:NE,fromTranslation:VE,fromValues:sl,identity:bi,invert:ds,mul:KE,multiply:fc,multiplyScalar:WE,multiplyScalarAndAdd:zE,normalFromMat4:UE,projection:kE,rotate:bE,scale:LE,set:r8,str:GE,sub:qE,subtract:i8,translate:IE,transpose:Gl},Symbol.toStringTag,{value:"Module"}));function pi(){var t=new Sn(16);return Sn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function YE(t){var e=new Sn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function mn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a8(t,e,n,r,i,a,o,s,c,l,f,u,g,d,p,h){var m=new Sn(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=a,m[6]=o,m[7]=s,m[8]=c,m[9]=l,m[10]=f,m[11]=u,m[12]=g,m[13]=d,m[14]=p,m[15]=h,m}function ZE(t,e,n,r,i,a,o,s,c,l,f,u,g,d,p,h,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l,t[9]=f,t[10]=u,t[11]=g,t[12]=d,t[13]=p,t[14]=h,t[15]=m,t}function Ze(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bt(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function In(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],p=e[12],h=e[13],m=e[14],v=e[15],y=n*s-r*o,T=n*c-i*o,C=n*l-a*o,w=r*c-i*s,S=r*l-a*s,_=i*l-a*c,D=f*h-u*p,N=f*m-g*p,P=f*v-d*p,F=u*m-g*h,B=u*v-d*h,k=g*v-d*m,U=y*k-T*B+C*F+w*P-S*N+_*D;return U?(U=1/U,t[0]=(s*k-c*B+l*F)*U,t[1]=(i*B-r*k-a*F)*U,t[2]=(h*_-m*S+v*w)*U,t[3]=(g*S-u*_-d*w)*U,t[4]=(c*P-o*k-l*N)*U,t[5]=(n*k-i*P+a*N)*U,t[6]=(m*C-p*_-v*T)*U,t[7]=(f*_-g*C+d*T)*U,t[8]=(o*B-s*P+l*D)*U,t[9]=(r*P-n*B-a*D)*U,t[10]=(p*S-h*C+v*y)*U,t[11]=(u*C-f*S-d*y)*U,t[12]=(s*N-o*F-c*D)*U,t[13]=(n*F-r*N+i*D)*U,t[14]=(h*T-p*w-m*y)*U,t[15]=(f*w-u*T+g*y)*U,t):null}function JE(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],p=e[12],h=e[13],m=e[14],v=e[15];return t[0]=s*(g*v-d*m)-u*(c*v-l*m)+h*(c*d-l*g),t[1]=-(r*(g*v-d*m)-u*(i*v-a*m)+h*(i*d-a*g)),t[2]=r*(c*v-l*m)-s*(i*v-a*m)+h*(i*l-a*c),t[3]=-(r*(c*d-l*g)-s*(i*d-a*g)+u*(i*l-a*c)),t[4]=-(o*(g*v-d*m)-f*(c*v-l*m)+p*(c*d-l*g)),t[5]=n*(g*v-d*m)-f*(i*v-a*m)+p*(i*d-a*g),t[6]=-(n*(c*v-l*m)-o*(i*v-a*m)+p*(i*l-a*c)),t[7]=n*(c*d-l*g)-o*(i*d-a*g)+f*(i*l-a*c),t[8]=o*(u*v-d*h)-f*(s*v-l*h)+p*(s*d-l*u),t[9]=-(n*(u*v-d*h)-f*(r*v-a*h)+p*(r*d-a*u)),t[10]=n*(s*v-l*h)-o*(r*v-a*h)+p*(r*l-a*s),t[11]=-(n*(s*d-l*u)-o*(r*d-a*u)+f*(r*l-a*s)),t[12]=-(o*(u*m-g*h)-f*(s*m-c*h)+p*(s*g-c*u)),t[13]=n*(u*m-g*h)-f*(r*m-i*h)+p*(r*g-i*u),t[14]=-(n*(s*m-c*h)-o*(r*m-i*h)+p*(r*c-i*s)),t[15]=n*(s*g-c*u)-o*(r*g-i*u)+f*(r*c-i*s),t}function QE(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],f=t[9],u=t[10],g=t[11],d=t[12],p=t[13],h=t[14],m=t[15],v=e*o-n*a,y=e*s-r*a,T=e*c-i*a,C=n*s-r*o,w=n*c-i*o,S=r*c-i*s,_=l*p-f*d,D=l*h-u*d,N=l*m-g*d,P=f*h-u*p,F=f*m-g*p,B=u*m-g*h;return v*B-y*F+T*P+C*N-w*D+S*_}function rt(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=e[9],d=e[10],p=e[11],h=e[12],m=e[13],v=e[14],y=e[15],T=n[0],C=n[1],w=n[2],S=n[3];return t[0]=T*r+C*s+w*u+S*h,t[1]=T*i+C*c+w*g+S*m,t[2]=T*a+C*l+w*d+S*v,t[3]=T*o+C*f+w*p+S*y,T=n[4],C=n[5],w=n[6],S=n[7],t[4]=T*r+C*s+w*u+S*h,t[5]=T*i+C*c+w*g+S*m,t[6]=T*a+C*l+w*d+S*v,t[7]=T*o+C*f+w*p+S*y,T=n[8],C=n[9],w=n[10],S=n[11],t[8]=T*r+C*s+w*u+S*h,t[9]=T*i+C*c+w*g+S*m,t[10]=T*a+C*l+w*d+S*v,t[11]=T*o+C*f+w*p+S*y,T=n[12],C=n[13],w=n[14],S=n[15],t[12]=T*r+C*s+w*u+S*h,t[13]=T*i+C*c+w*g+S*m,t[14]=T*a+C*l+w*d+S*v,t[15]=T*o+C*f+w*p+S*y,t}function Mn(t,e,n){var r=n[0],i=n[1],a=n[2],o,s,c,l,f,u,g,d,p,h,m,v;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],c=e[2],l=e[3],f=e[4],u=e[5],g=e[6],d=e[7],p=e[8],h=e[9],m=e[10],v=e[11],t[0]=o,t[1]=s,t[2]=c,t[3]=l,t[4]=f,t[5]=u,t[6]=g,t[7]=d,t[8]=p,t[9]=h,t[10]=m,t[11]=v,t[12]=o*r+f*i+p*a+e[12],t[13]=s*r+u*i+h*a+e[13],t[14]=c*r+g*i+m*a+e[14],t[15]=l*r+d*i+v*a+e[15]),t}function Sa(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ui(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),c,l,f,u,g,d,p,h,m,v,y,T,C,w,S,_,D,N,P,F,B,k,U,H;return s<Mt?null:(s=1/s,i*=s,a*=s,o*=s,c=Math.sin(n),l=Math.cos(n),f=1-l,u=e[0],g=e[1],d=e[2],p=e[3],h=e[4],m=e[5],v=e[6],y=e[7],T=e[8],C=e[9],w=e[10],S=e[11],_=i*i*f+l,D=a*i*f+o*c,N=o*i*f-a*c,P=i*a*f-o*c,F=a*a*f+l,B=o*a*f+i*c,k=i*o*f+a*c,U=a*o*f-i*c,H=o*o*f+l,t[0]=u*_+h*D+T*N,t[1]=g*_+m*D+C*N,t[2]=d*_+v*D+w*N,t[3]=p*_+y*D+S*N,t[4]=u*P+h*F+T*B,t[5]=g*P+m*F+C*B,t[6]=d*P+v*F+w*B,t[7]=p*P+y*F+S*B,t[8]=u*k+h*U+T*H,t[9]=g*k+m*U+C*H,t[10]=d*k+v*U+w*H,t[11]=p*k+y*U+S*H,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function f2(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*r,t[5]=o*i+f*r,t[6]=s*i+u*r,t[7]=c*i+g*r,t[8]=l*i-a*r,t[9]=f*i-o*r,t[10]=u*i-s*r,t[11]=g*i-c*r,t}function g2(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*r,t[1]=o*i-f*r,t[2]=s*i-u*r,t[3]=c*i-g*r,t[8]=a*r+l*i,t[9]=o*r+f*i,t[10]=s*r+u*i,t[11]=c*r+g*i,t}function d2(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],l=e[4],f=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*r,t[1]=o*i+f*r,t[2]=s*i+u*r,t[3]=c*i+g*r,t[4]=l*i-a*r,t[5]=f*i-o*r,t[6]=u*i-s*r,t[7]=g*i-c*r,t}function b0(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Ug(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h2(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.hypot(r,i,a),s,c,l;return o<Mt?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=r*r*l+c,t[1]=i*r*l+a*s,t[2]=a*r*l-i*s,t[3]=0,t[4]=r*i*l-a*s,t[5]=i*i*l+c,t[6]=a*i*l+r*s,t[7]=0,t[8]=r*a*l+i*s,t[9]=i*a*l-r*s,t[10]=a*a*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function eO(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tO(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nO(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o8(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,c=i+i,l=a+a,f=r*s,u=r*c,g=r*l,d=i*c,p=i*l,h=a*l,m=o*s,v=o*c,y=o*l;return t[0]=1-(d+h),t[1]=u+y,t[2]=g-v,t[3]=0,t[4]=u-y,t[5]=1-(f+h),t[6]=p+m,t[7]=0,t[8]=g+v,t[9]=p-m,t[10]=1-(f+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function rO(t,e){var n=new Sn(3),r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=r*r+i*i+a*a+o*o;return u>0?(n[0]=(s*o+f*r+c*a-l*i)*2/u,n[1]=(c*o+f*i+l*r-s*a)*2/u,n[2]=(l*o+f*a+s*i-c*r)*2/u):(n[0]=(s*o+f*r+c*a-l*i)*2,n[1]=(c*o+f*i+l*r-s*a)*2,n[2]=(l*o+f*a+s*i-c*r)*2),o8(t,e,n),t}function iO(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function s8(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],c=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(c,l,f),t}function ch(t,e){var n=new Sn(3);s8(n,e);var r=1/n[0],i=1/n[1],a=1/n[2],o=e[0]*r,s=e[1]*i,c=e[2]*a,l=e[4]*r,f=e[5]*i,u=e[6]*a,g=e[8]*r,d=e[9]*i,p=e[10]*a,h=o+f+p,m=0;return h>0?(m=Math.sqrt(h+1)*2,t[3]=.25*m,t[0]=(u-d)/m,t[1]=(g-c)/m,t[2]=(s-l)/m):o>f&&o>p?(m=Math.sqrt(1+o-f-p)*2,t[3]=(u-d)/m,t[0]=.25*m,t[1]=(s+l)/m,t[2]=(g+c)/m):f>p?(m=Math.sqrt(1+f-o-p)*2,t[3]=(g-c)/m,t[0]=(s+l)/m,t[1]=.25*m,t[2]=(u+d)/m):(m=Math.sqrt(1+p-o-f)*2,t[3]=(s-l)/m,t[0]=(g+c)/m,t[1]=(u+d)/m,t[2]=.25*m),t}function c8(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=i+i,l=a+a,f=o+o,u=i*c,g=i*l,d=i*f,p=a*l,h=a*f,m=o*f,v=s*c,y=s*l,T=s*f,C=r[0],w=r[1],S=r[2];return t[0]=(1-(p+m))*C,t[1]=(g+T)*C,t[2]=(d-y)*C,t[3]=0,t[4]=(g-T)*w,t[5]=(1-(u+m))*w,t[6]=(h+v)*w,t[7]=0,t[8]=(d+y)*S,t[9]=(h-v)*S,t[10]=(1-(u+p))*S,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function aO(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],c=e[3],l=a+a,f=o+o,u=s+s,g=a*l,d=a*f,p=a*u,h=o*f,m=o*u,v=s*u,y=c*l,T=c*f,C=c*u,w=r[0],S=r[1],_=r[2],D=i[0],N=i[1],P=i[2],F=(1-(h+v))*w,B=(d+C)*w,k=(p-T)*w,U=(d-C)*S,H=(1-(g+v))*S,W=(m+y)*S,J=(p+T)*_,ne=(m-y)*_,q=(1-(g+h))*_;return t[0]=F,t[1]=B,t[2]=k,t[3]=0,t[4]=U,t[5]=H,t[6]=W,t[7]=0,t[8]=J,t[9]=ne,t[10]=q,t[11]=0,t[12]=n[0]+D-(F*D+U*N+J*P),t[13]=n[1]+N-(B*D+H*N+ne*P),t[14]=n[2]+P-(k*D+W*N+q*P),t[15]=1,t}function r0(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,l=n*o,f=r*o,u=r*s,g=i*o,d=i*s,p=i*c,h=a*o,m=a*s,v=a*c;return t[0]=1-u-p,t[1]=f+v,t[2]=g-m,t[3]=0,t[4]=f-v,t[5]=1-l-p,t[6]=d+h,t[7]=0,t[8]=g+m,t[9]=d-h,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oO(t,e,n,r,i,a,o){var s=1/(n-e),c=1/(i-r),l=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*c,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function l8(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var sO=l8;function cO(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function lO(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+s),l=2/(i+a);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((o-s)*c*.5),t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function u8(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=(o+a)*l,t[15]=1,t}var p2=u8;function uO(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=a*l,t[15]=1,t}function f8(t,e,n,r){var i,a,o,s,c,l,f,u,g,d,p=e[0],h=e[1],m=e[2],v=r[0],y=r[1],T=r[2],C=n[0],w=n[1],S=n[2];return Math.abs(p-C)<Mt&&Math.abs(h-w)<Mt&&Math.abs(m-S)<Mt?Ze(t):(f=p-C,u=h-w,g=m-S,d=1/Math.hypot(f,u,g),f*=d,u*=d,g*=d,i=y*g-T*u,a=T*f-v*g,o=v*u-y*f,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=u*o-g*a,c=g*i-f*o,l=f*a-u*i,d=Math.hypot(s,c,l),d?(d=1/d,s*=d,c*=d,l*=d):(s=0,c=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=a,t[5]=c,t[6]=u,t[7]=0,t[8]=o,t[9]=l,t[10]=g,t[11]=0,t[12]=-(i*p+a*h+o*m),t[13]=-(s*p+c*h+l*m),t[14]=-(f*p+u*h+g*m),t[15]=1,t)}function fO(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],c=r[1],l=r[2],f=i-n[0],u=a-n[1],g=o-n[2],d=f*f+u*u+g*g;d>0&&(d=1/Math.sqrt(d),f*=d,u*=d,g*=d);var p=c*g-l*u,h=l*f-s*g,m=s*u-c*f;return d=p*p+h*h+m*m,d>0&&(d=1/Math.sqrt(d),p*=d,h*=d,m*=d),t[0]=p,t[1]=h,t[2]=m,t[3]=0,t[4]=u*m-g*h,t[5]=g*p-f*m,t[6]=f*h-u*p,t[7]=0,t[8]=f,t[9]=u,t[10]=g,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function gO(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function dO(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function hO(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function g8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function pO(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function mO(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function vO(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function yO(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=t[9],g=t[10],d=t[11],p=t[12],h=t[13],m=t[14],v=t[15],y=e[0],T=e[1],C=e[2],w=e[3],S=e[4],_=e[5],D=e[6],N=e[7],P=e[8],F=e[9],B=e[10],k=e[11],U=e[12],H=e[13],W=e[14],J=e[15];return Math.abs(n-y)<=Mt*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-T)<=Mt*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-C)<=Mt*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(a-w)<=Mt*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-S)<=Mt*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-_)<=Mt*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-D)<=Mt*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(l-N)<=Mt*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(f-P)<=Mt*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(u-F)<=Mt*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(g-B)<=Mt*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(d-k)<=Mt*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(p-U)<=Mt*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(h-H)<=Mt*Math.max(1,Math.abs(h),Math.abs(H))&&Math.abs(m-W)<=Mt*Math.max(1,Math.abs(m),Math.abs(W))&&Math.abs(v-J)<=Mt*Math.max(1,Math.abs(v),Math.abs(J))}var Xf=rt,TO=g8;const Yf=Object.freeze(Object.defineProperty({__proto__:null,add:hO,adjoint:JE,clone:YE,copy:mn,create:pi,determinant:QE,equals:yO,exactEquals:vO,frob:dO,fromQuat:r0,fromQuat2:rO,fromRotation:h2,fromRotationTranslation:o8,fromRotationTranslationScale:c8,fromRotationTranslationScaleOrigin:aO,fromScaling:Ug,fromTranslation:b0,fromValues:a8,fromXRotation:eO,fromYRotation:tO,fromZRotation:nO,frustum:oO,getRotation:ch,getScaling:s8,getTranslation:iO,identity:Ze,invert:In,lookAt:f8,mul:Xf,multiply:rt,multiplyScalar:pO,multiplyScalarAndAdd:mO,ortho:p2,orthoNO:u8,orthoZO:uO,perspective:sO,perspectiveFromFieldOfView:lO,perspectiveNO:l8,perspectiveZO:cO,rotate:Ui,rotateX:f2,rotateY:g2,rotateZ:d2,scale:Sa,set:ZE,str:gO,sub:TO,subtract:g8,targetTo:fO,translate:Mn,transpose:bt},Symbol.toStringTag,{value:"Module"}));function Ie(){var t=new Sn(3);return Sn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function d8(t){var e=new Sn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function hs(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Et(t,e,n){var r=new Sn(3);return r[0]=t,r[1]=e,r[2]=n,r}function h8(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Yr(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function co(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function _n(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function p8(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function zi(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Qn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function v0(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function lo(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Zf(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ht(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function He(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zt(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],c=n[2];return t[0]=i*c-a*s,t[1]=a*o-r*c,t[2]=r*s-i*o,t}function At(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function Jf(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function m8(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2],c=Math.sqrt(n*n+r*r+i*i),l=Math.sqrt(a*a+o*o+s*s),f=c*l,u=f&&He(t,e)/f;return Math.acos(Math.min(Math.max(u,-1),1))}function CO(t){return t[0]=0,t[1]=0,t[2]=0,t}function G5(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function B5(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=Mt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=Mt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Mt*Math.max(1,Math.abs(i),Math.abs(s))}var Ut=_n,wO=p8,SO=v0,Qf=hs;(function(){var t=Ie();return function(e,n,r,i,a,o){var s,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function xO(){var t=new Sn(4);return Sn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function EO(t,e,n,r){var i=new Sn(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function $5(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function OO(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t}function Zo(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}(function(){var t=xO();return function(e,n,r,i,a,o){var s,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function ps(){var t=new Sn(4);return Sn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function kg(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function RO(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>Mt?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function W5(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],c=n[1],l=n[2],f=n[3];return t[0]=r*f+o*s+i*l-a*c,t[1]=i*f+o*c+a*s-r*l,t[2]=a*f+o*l+r*c-i*s,t[3]=o*f-r*s-i*c-a*l,t}function gf(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=n[0],l=n[1],f=n[2],u=n[3],g,d,p,h,m;return d=i*c+a*l+o*f+s*u,d<0&&(d=-d,c=-c,l=-l,f=-f,u=-u),1-d>Mt?(g=Math.acos(d),p=Math.sin(g),h=Math.sin((1-r)*g)/p,m=Math.sin(r*g)/p):(h=1-r,m=r),t[0]=h*i+m*c,t[1]=h*a+m*l,t[2]=h*o+m*f,t[3]=h*s+m*u,t}function DO(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function MO(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[a*3+a]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[a*3+o]-e[o*3+a])*r,t[a]=(e[a*3+i]+e[i*3+a])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}var z5=EO,v8=OO;(function(){var t=Ie(),e=Et(1,0,0),n=Et(0,1,0);return function(r,i,a){var o=He(i,a);return o<-.999999?(zt(t,e,i),Qf(t)<1e-6&&zt(t,n,i),Ht(t,t),kg(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(zt(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,v8(r,r))}})();(function(){var t=ps(),e=ps();return function(n,r,i,a,o,s){return gf(t,r,o,s),gf(e,i,a,s),gf(n,t,e,2*s*(1-s)),n}})();(function(){var t=ua();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],v8(e,MO(e,t))}})();function un(){var t=new Sn(2);return Sn!=Float32Array&&(t[0]=0,t[1]=0),t}function H5(t,e){var n=new Sn(2);return n[0]=t,n[1]=e,n}function i0(t,e,n){return t[0]=e,t[1]=n,t}function m2(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function gr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function j5(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Ru(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function er(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function ns(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function y8(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Js(t,e){return t[0]*e[0]+t[1]*e[1]}var eg=gr,v2=er;(function(){var t=un();return function(e,n,r,i,a,o){var s,c;for(n||(n=2),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}})();function hr(t){const e=t.indexOf(":");return t.substring(e+1)}function T8(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>>0).toString(36)}const _O=1073741824;class IO{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageIdsToVolumeIdCache=new Map,this._referencedImageIdToImageIdCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*_O,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((a,o)=>o.sharedCacheKey?a:a+o.sizeInBytes,0);return n+r>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,n=!1)=>{const r=this._imageCache.get(e);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=r;r.image?.referencedImageId&&this._referencedImageIdToImageIdCache.delete(r.image.referencedImageId),i?.cancelFn&&i.cancelFn(),i?.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:i}=n;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),r.cancelFn&&r.cancelFn(),i.imageIds&&i.imageIds.forEach(a=>{const o=this._imageCache.get(a);o&&o.sharedCacheKey===e&&(o.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),Oe(Me,Ee.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),Oe(Me,Ee.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(e,n)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:e,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(i=>{try{this._putGeometryCommon(e,i,r)}catch(a){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,a),a}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:e};Oe(Me,Ee.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(e)},this._decacheGeometry=e=>{const n=this._geometryCache.get(e);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImageByReferencedImageId=e=>{const n=this._referencedImageIdToImageIdCache.get(e);if(n)return this._imageCache.get(n)?.image},this.getImage=(e,n=ui.FAR_REPLICATE)=>{if(e===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(e);if(r&&(r.timeStamp=Date.now(),!(r.image?.imageQualityStatus<n)))return r.image},this.getVolume=(e,n=!1)=>{if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(e);return r?(r.timeStamp=Date.now(),r.volume):n?[...this._volumeCache.values()].find(i=>i.volumeId.includes(e))?.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:n=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,n),this.incrementImageCacheSize(-r.sizeInBytes);const i={image:r,imageId:e};Oe(Me,Ee.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:e};Oe(Me,Ee.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}generateVolumeId(e){const n=e.map(hr).sort();let r=2166136261;for(const i of n){const a=T8(i);for(let o=0;o<a.length;o++)r^=a.charCodeAt(o),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)}return`volume-${(r>>>0).toString(36)}`}getImageIdsForVolumeId(e){return Array.from(this._imageIdsToVolumeIdCache.entries()).filter(([n,r])=>r===e).map(([n])=>n)}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function a(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(a);const o=i.map(c=>c.imageId);let s=o;n&&(s=o.filter(c=>!n.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),Oe(Me,Ee.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;for(const c of o)if(this.removeImageLoadObject(c),Oe(Me,Ee.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}_putImageCommon(e,n,r){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(Ee.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const i={image:r};n.referencedImageId&&this._referencedImageIdToImageIdCache.set(n.referencedImageId,e),Oe(Me,Ee.IMAGE_CACHE_IMAGE_ADDED,i),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(e,n){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(e);if(r?.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...r,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),n.promise.then(a=>{try{this._putImageCommon(e,a,i)}catch(o){throw console.debug(`Error in _putImageCommon for image ${e}:`,o),o}}).catch(a=>{throw console.debug(`Error caching image ${e}:`,a),this._imageCache.delete(e),a})}putImageSync(e,n){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,r);try{this._putImageCommon(e,n,r)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=hr(e);for(const i of n){const a=this._volumeCache.get(i);if(!a)return;const{volume:o}=a;if(!o.imageIds.length)return;const s=o.getImageURIIndex(r);if(s>-1)return{volume:o,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const n=hr(e),i=Array.from(this._imageCache.keys()).find(a=>hr(a)===n);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,n,r){if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,n.imageIds?.forEach(a=>{const o=this._imageCache.get(a);o&&(o.sharedCacheKey=e)});const i={volume:r};Oe(Me,Ee.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,n){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,r);try{this._putVolumeCommon(e,n,r)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(i=>{try{this._putVolumeCommon(e,i,r)}catch(a){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,a),this._volumeCache.delete(e),a}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,n,r){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(Ee.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const i={geometry:r};Oe(Me,Ee.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,n){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,r);try{this._putGeometryCommon(e,n,r)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,n){const r=this._imageCache.get(e);if(!r){n&&this._imageCache.set(e,{image:n,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(e){const n=this._imageCache.get(e)?.image;return n?n.imageQualityStatus||ui.FULL_RESOLUTION:void 0}}const Ve=new IO;function C8(t,e,n){return Math.abs(t-e)<=n}function bO(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!C8(t[r],e[r],n))return!1;return!0}function K5(t){return typeof t=="number"}function q5(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Wt(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:K5(t)&&K5(e)?C8(t,e,n):q5(t)&&q5(e)?bO(t,e,n):!1}const w8=t=>typeof t=="number"?-t:t?.map?t.map(w8):!t,lh=t=>typeof t=="number"?Math.abs(t):t?.map?t.map(lh):t,S8=(t,e,n=void 0)=>Wt(t,w8(e),n),df=(t,e,n=void 0)=>Wt(lh(t),lh(e),n);function Za(t){return Array.isArray(t)?Za(t[0]):isFinite(t)&&!isNaN(t)}function Mi(t){return Gr(t,"vtkVolume")||Gr(t,"vtkImageSlice")}function Gr(t,e){const n="isA"in t?t:t.actor;return n?!!n.isA(e):!1}const y2=new Map;function LO(t){t.name=t.name||t.Name,y2.set(t.name,t)}function Bl(t){return y2.get(t)}function x8(){return Array.from(y2.keys())}function T2(t,e){const n=kl.rgbPresetNames.map(c=>kl.getPresetByName(c)),r=x8().map(c=>Bl(c)),a=n.concat(r).find(c=>{const{RGBPoints:l}=c;if(l.length!==t.length)return!1;for(let f=0;f<l.length;f+=4)if(!Wt(l.slice(f+1,f+4),t.slice(f+1,f+4)))return!1;return!0});if(!a)return null;const o=[];if(Gr(e,"vtkVolume")){const c=e.getProperty().getScalarOpacity(0).getDataPointer();if(!c)return{name:a.Name};for(let l=0;l<c.length;l+=2)o.push({value:c[l],opacity:c[l+1]})}return{name:a.Name,...Array.isArray(o)&&o.length>0&&{opacity:o},...typeof o=="number"&&{opacity:o}}}function VO(t){const{volumeActor:e,preset:n,opacity:r=.9,threshold:i=null,colorRange:a=[0,5]}=t;e.getMapper().setSampleDistance(1);const s=po.newInstance(),c=n||kl.getPresetByName("hsv");s.applyColorMap(c),s.setMappingRange(a[0],a[1]),e.getProperty().setRGBTransferFunction(0,s),C2(e,r,i)}function E8(t,e){const n=w2(t);C2(t,e,n)}function O8(t,e){const n=S2(t);C2(t,n,e)}function C2(t,e,n){const r=t.getMapper().getInputData().get("voxelManager");if(!r?.voxelManager)throw new Error("No voxel manager was found for the volume actor, or you cannot yet update opacity with a threshold using stacked images");const i=r.voxelManager.getRange(),a=Cc.newInstance();if(n!==null){const o=Math.abs(i[1]-i[0])*.001,s=Math.max(i[0],Math.min(i[1],n));a.addPoint(i[0],0),a.addPoint(s-o,0),a.addPoint(s,e),a.addPoint(i[1],e)}else a.addPoint(i[0],e),a.addPoint(i[1],e);t.getProperty().setScalarOpacity(0,a)}function w2(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return null;const n=e.getDataPointer();if(!n||n.length<=4)return null;for(let r=0;r<n.length-2;r+=2){n[r];const i=n[r+1],a=n[r+2],o=n[r+3];if(i===0&&o>0)return a}return null}function S2(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return 1;const n=e.getDataPointer();if(!n||n.length===0)return 1;let r=0;for(let i=1;i<n.length;i+=2)n[i]>r&&(r=n[i]);return r}const PO=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:T2,getColormap:Bl,getColormapNames:x8,getMaxOpacity:S2,getThresholdValue:w2,registerColormap:LO,setColorMapTransferFunctionForVolumeActor:VO,updateOpacity:E8,updateThreshold:O8},Symbol.toStringTag,{value:"Module"}));function Cl(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}const NO=(t,e,n)=>e-n/4*Math.log((1-t)/t);function iu(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function a0(t,e,n=dr.LINEAR){if(n===dr.LINEAR||n===dr.SAMPLED_SIGMOID)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(n===dr.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};throw new Error("Invalid VOI LUT function")}const AO=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:a0,toWindowLevel:iu},Symbol.toStringTag,{value:"Module"}));function x2(t,e=1024){const{windowWidth:n,windowCenter:r}=iu(t.lower,t.upper),a=Array.from({length:e},(s,c)=>(c+1)/(e+2)).flatMap(s=>[NO(s,r,n),s,s,s,.5,0]),o=po.newInstance();return o.buildFunctionFromArray(ot.newInstance({values:a,numberOfComponents:6})),o}function y0(t,e){return t.worldToIndex(e).map(Math.round)}function hf(t,e){return t.worldToIndex(e)}function tg(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const i=[];t.getNodeValue(r,i),n.push(i)}return n}function Gg(t,e){e?.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}const FO=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:tg,setTransferFunctionNodes:Gg},Symbol.toStringTag,{value:"Module"}));function UO(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{A.vtkErrorMacro("not implemented")}}const kO={};function R8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kO,n),A.obj(t,e),A.setGet(t,e,["transform"]),UO(t,e)}const GO=A.newInstance(R8,"vtkImplicitFunction");var BO={newInstance:GO,extend:R8};const uh=1e-6,D8="coincide",M8="disjoint";function $O(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function _8(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function I8(t,e,n,r){const i=[];Kn(t,e,i);const a=at(n,i);r[0]=t[0]-a*n[0],r[1]=t[1]-a*n[1],r[2]=t[2]-a*n[2]}function b8(t,e,n){const r=at(t,e);let i=at(e,e);return i===0&&(i=1),n[0]=t[0]-r*e[0]/i,n[1]=t[1]-r*e[1]/i,n[2]=t[2]-r*e[2]/i,n}function L8(t,e,n,r){const i=[];Kn(t,e,i);const a=at(n,i),o=at(n,n);o!==0?(r[0]=t[0]-a*n[0]/o,r[1]=t[1]-a*n[1]/o,r[2]=t[2]-a*n[2]/o):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function V8(t,e,n,r){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],o=[];Kn(e,t,a),Kn(n,t,o);const s=at(r,o),c=at(r,a);let l,f;return c<0?l=-c:l=c,s<0?f=-s*uh:f=s*uh,l<=f||(i.t=s/c,i.x[0]=t[0]+i.t*a[0],i.x[1]=t[1]+i.t*a[1],i.x[2]=t[2]+i.t*a[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function P8(t,e,n,r){const i={intersection:!1,l0:[],l1:[],error:null},a=[];kr(e,r,a);const o=a.map(u=>Math.abs(u));if(o[0]+o[1]+o[2]<uh){const u=[];return Kn(t,n,u),at(e,u)===0?i.error=D8:i.error=M8,i}let s;o[0]>o[1]&&o[0]>o[2]?s="x":o[1]>o[2]?s="y":s="z";const c=[],l=-at(e,t),f=-at(r,n);switch(s){case"x":c[0]=0,c[1]=(f*e[2]-l*r[2])/a[0],c[2]=(l*r[1]-f*e[1])/a[0];break;case"y":c[0]=(l*r[2]-f*e[2])/a[1],c[1]=0,c[2]=(f*e[0]-l*r[0])/a[1];break;case"z":c[0]=(f*e[1]-l*r[1])/a[2],c[1]=(l*r[0]-f*e[0])/a[2],c[2]=0;break}return i.l0=c,d0(c,a,i.l1),i.intersection=!0,i}const WO={evaluate:$O,distanceToPlane:_8,projectPoint:I8,projectVector:b8,generalizedProjectPoint:L8,intersectWithLine:V8,intersectWithPlane:P8,DISJOINT:M8,COINCIDE:D8};function zO(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>_8(n,e.origin,e.normal),t.projectPoint=(n,r)=>{I8(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>b8(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{L8(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,i)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>V8(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>P8(n,r,e.origin,e.normal)}const HO={normal:[0,0,1],origin:[0,0,0]};function N8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HO,n),BO.extend(t,e,n),A.setGetArray(t,e,["normal","origin"],3),zO(t,e)}const jO=A.newInstance(N8,"vtkPlane");var tr={newInstance:jO,extend:N8,...WO};const Bg=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function A8(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function mo(t){return t?.length>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function E2(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function O2(t){return E2(t,Bg)}function ng(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=i<e?i:e,t[1]=a>e?a:e,t[2]=o<n?o:n,t[3]=s>n?s:n,t[4]=c<r?c:r,t[5]=l>r?l:r,t}function R2(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)ng(t,...e[n]);else for(let n=0;n<e.length;n+=3)ng(t,...e.slice(n,n+3));return t}function F8(t,e,n,r,i,a,o){const[s,c,l,f,u,g]=t;return o===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],g)):(t[0]=Math.min(e,s),t[1]=Math.max(n,c),t[2]=Math.min(r,l),t[3]=Math.max(i,f),t[4]=Math.min(a,u),t[5]=Math.max(o,g)),t}function U8(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=e,t[1]=e>a?e:a,t[2]=n,t[3]=n>s?n:s,t[4]=r,t[5]=r>l?r:l,i!==e||o!==n||c!==r}function k8(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=n<o?n:o,t[3]=n,t[4]=r<c?r:c,t[5]=r,a!==e||s!==n||l!==r}function D2(t,e){return e==null?KO(t):(t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t)}function KO(t){const e=[0,0,0];let n=-1,r=0,i=0;for(let a=0;a<3;++a)i=t[a*2+1]-t[a*2],i>r&&(r=i,n=a),e[a]=i>0?1:0;if(n<0)return D2(t,.5);for(let a=0;a<3;++a)if(!e[a]){const o=.005*r;t[a*2]-=o,t[a*2+1]+=o}return t}function M2(t,e,n,r){return mo(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function _2(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function qO(t,e,n,r){if(!mo(t))return!1;const i=_2(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],M2(t,e,n,r),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function wl(t,e){return t[e*2+1]-t[e*2]}function au(t){return[wl(t,0),wl(t,1),wl(t,2)]}function G8(t){return t.slice(0,2)}function B8(t){return t.slice(2,4)}function $8(t){return t.slice(4,6)}function W8(t){const e=au(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function I2(t){if(mo(t)){const e=au(t);return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}return null}function z8(t){const e=I2(t);return e!==null?Math.sqrt(e):null}function $g(t){return[t[0],t[2],t[4]]}function Wg(t){return[t[1],t[3],t[5]]}function Du(t,e){return t<=0&&e>=0||t>=0&&e<=0}function b2(t,e){return e[0]=[t[0],t[2],t[4]],e[1]=[t[0],t[2],t[5]],e[2]=[t[0],t[3],t[4]],e[3]=[t[0],t[3],t[5]],e[4]=[t[1],t[2],t[4]],e[5]=[t[1],t[2],t[5]],e[6]=[t[1],t[3],t[4]],e[7]=[t[1],t[3],t[5]],e}function H8(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function j8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=b2(t,[]);for(let i=0;i<r.length;++i)At(r[i],r[i],e);return O2(n),R2(n,r)}function K8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function q8(t,e,n,r){const i=[].concat(Bg),a=t.getData();for(let o=0;o<a.length;o+=3){const s=[a[o],a[o+1],a[o+2]],c=at(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=at(s,n);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const f=at(s,r);i[4]=Math.min(f,i[4]),i[5]=Math.max(f,i[5])}return i}function X8(t,e,n,r,i){let a=!0;const o=[];let s=0;const c=[],l=[0,0,0],f=0,u=1,g=2;for(let d=0;d<3;d++)e[d]<t[2*d]?(o[d]=u,l[d]=t[2*d],a=!1):e[d]>t[2*d+1]?(o[d]=f,l[d]=t[2*d+1],a=!1):o[d]=g;if(a)return r[0]=e[0],r[1]=e[1],r[2]=e[2],i[0]=0,1;for(let d=0;d<3;d++)o[d]!==g&&n[d]!==0?c[d]=(l[d]-e[d])/n[d]:c[d]=-1;for(let d=0;d<3;d++)c[s]<c[d]&&(s=d);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let d=0;d<3;d++)if(s!==d){if(r[d]=e[d]+c[s]*n[d],r[d]<t[2*d]||r[d]>t[2*d+1])return 0}else r[d]=l[d];return 1}function Y8(t,e,n){const r=[];let i=0,a=1,o=1;for(let s=4;s<=5;++s){r[2]=t[s];for(let c=2;c<=3;++c){r[1]=t[c];for(let l=0;l<=1;++l)if(r[0]=t[l],i=tr.evaluate(n,e,r),o&&(a=i>=0?1:-1,o=0),i===0||a>0&&i<0||a<0&&i>0)return 1}}return 0}function Z8(t,e){if(!(mo(t)&&mo(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let i=0;i<3;i++)if(r=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(r=!0,n[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(r=!0,n[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(r=!0,n[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(r=!0,n[i*2+1]=t[i*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function rg(t,e){if(!(mo(t)&&mo(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function ig(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function XO(t,e){return!(!rg(t,e)||!ig(t,...$g(e))||!ig(t,...Wg(e)))}function J8(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let a=0;for(let u=0;u<2;u++)for(let g=2;g<4;g++)for(let d=4;d<6;d++){const p=[t[u],t[g],t[d]];i[a++]=tr.evaluate(n,e,p)}let o=2;for(;o--&&!(Du(i[r[o][0]],i[r[o][4]])&&Du(i[r[o][1]],i[r[o][5]])&&Du(i[r[o][2]],i[r[o][6]])&&Du(i[r[o][3]],i[r[o][7]])););if(o<0)return!1;const s=Math.sign(n[o]),c=Math.abs((t[o*2+1]-t[o*2])*n[o]);let l=s>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const g=Math.abs(i[r[o][u]])/c;s>0&&g<l&&(l=g),s<0&&g>l&&(l=g)}const f=(1-l)*t[o*2]+l*t[o*2+1];return s>0?t[o*2]=f:t[o*2+1]=f,!0}function Q8(t,e){for(let r=0;r<3;++r)e[r]=e[r]<1?1:e[r];let n=e[0]*e[1]*e[2];for(;n>t;){for(let r=0;r<3;++r)e[r]=e[r]>1?e[r]-1:1;n=e[0]*e[1]*e[2]}}function e6(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];e=e<=0?1:e;let i=0;const a=[0,0,0];let o=-1,s=0;const c=au(t),l=c[0]+c[1]+c[2],f=l*(.001/3);for(let h=0;h<3;++h)c[h]>s&&(o=h,s=c[h]),c[h]>f?(a[h]=1,i++):a[h]=0;const u=$g(t),g=Wg(t);if(i<1)return n[0]=1,n[1]=1,n[2]=1,r[0]=u[0]-.5,r[1]=g[0]+.5,r[2]=u[1]-.5,r[3]=g[1]+.5,r[4]=u[2]-.5,r[5]=g[2]+.5,1;let d=e;d/=a[0]?c[0]/l:1,d/=a[1]?c[1]/l:1,d/=a[2]?c[2]/l:1,d**=1/i;for(let h=0;h<3;++h)n[h]=a[h]?Math.floor(d*c[h]/l):1,n[h]=n[h]<1?1:n[h];Q8(e,n);const p=.5*c[o]/n[o];for(let h=0;h<3;++h)a[h]?(r[2*h]=u[h],r[2*h+1]=g[h]):(r[2*h]=u[h]-p,r[2*h+1]=g[h]+p);return n[0]*n[1]*n[2]}function t6(t,e){if(t[0]>=e[0]&&t[0]<=e[1]&&t[1]>=e[2]&&t[1]<=e[3]&&t[2]>=e[4]&&t[2]<=e[5])return 0;const n=[0,0,0];return t[0]<e[0]?n[0]=e[0]-t[0]:t[0]>e[1]&&(n[0]=t[0]-e[1]),t[1]<e[2]?n[1]=e[2]-t[1]:t[1]>e[3]&&(n[1]=t[1]-e[3]),t[2]<e[4]?n[2]=e[4]-t[2]:t[2]>e[5]&&(n[2]=t[2]-e[5]),at(n,n)}class YO{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(Bg))}getBounds(){return this.bounds}equals(e){return A8(this.bounds,e)}isValid(){return mo(this.bounds)}setBounds(e){return E2(this.bounds,e)}reset(){return O2(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ng(this.bounds,...n)}addPoints(e){return R2(this.bounds,e)}addBounds(e,n,r,i,a,o){return F8(this.bounds,e,n,r,i,a,o)}setMinPoint(e,n,r){return U8(this.bounds,e,n,r)}setMaxPoint(e,n,r){return k8(this.bounds,e,n,r)}inflate(e){return D2(this.bounds,e)}scale(e,n,r){return M2(this.bounds,e,n,r)}getCenter(){return _2(this.bounds)}getLength(e){return wl(this.bounds,e)}getLengths(){return au(this.bounds)}getMaxLength(){return W8(this.bounds)}getDiagonalLength(){return z8(this.bounds)}getDiagonalLength2(){return I2(this.bounds)}getMinPoint(){return $g(this.bounds)}getMaxPoint(){return Wg(this.bounds)}getXRange(){return G8(this.bounds)}getYRange(){return B8(this.bounds)}getZRange(){return $8(this.bounds)}getCorners(e){return b2(this.bounds,e)}computeCornerPoints(e,n){return H8(this.bounds,e,n)}computeLocalBounds(e,n,r){return q8(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return j8(this.bounds,e,n)}computeScale3(e){return K8(this.bounds,e)}cutWithPlane(e,n){return J8(this.bounds,e,n)}intersectBox(e,n,r,i){return X8(this.bounds,e,n,r,i)}intersectPlane(e,n){return Y8(this.bounds,e,n)}intersect(e){return Z8(this.bounds,e)}intersects(e){return rg(this.bounds,e)}containsPoint(e,n,r){return ig(this.bounds,e,n,r)}contains(e){return rg(this.bounds,e)}computeDivisions(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return e6(this.bounds,e,n,r)}distance2ToBounds(e){return t6(e,this.bounds)}}function ZO(t){const e=t&&t.bounds;return new YO(e)}const JO={equals:A8,isValid:mo,setBounds:E2,reset:O2,addPoint:ng,addPoints:R2,addBounds:F8,setMinPoint:U8,setMaxPoint:k8,inflate:D2,scale:M2,scaleAboutCenter:qO,getCenter:_2,getLength:wl,getLengths:au,getMaxLength:W8,getDiagonalLength:z8,getDiagonalLength2:I2,getMinPoint:$g,getMaxPoint:Wg,getXRange:G8,getYRange:B8,getZRange:$8,getCorners:b2,computeCornerPoints:H8,computeLocalBounds:q8,transformBounds:j8,computeScale3:K8,cutWithPlane:J8,intersectBox:X8,intersectPlane:Y8,intersect:Z8,intersects:rg,containsPoint:ig,contains:XO,computeDivisions:e6,clampDivisions:Q8,distance2ToBounds:t6,INIT_BOUNDS:Bg};var xt={newInstance:ZO,...JO};const QO={DISPLAY:0,WORLD:1};var n6={CoordinateSystem:QO};const{CoordinateSystem:fh}=n6;function X5(t){return()=>A.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function eR(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const i=e.textures[r].getMTime();i>n&&(n=i)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=X5("pick"),t.hasKey=X5("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(i=>i!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(fh.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(fh.DISPLAY)}const tR={allocatedRenderTime:10,coordinateSystem:fh.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function r6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tR,n),A.obj(t,e),A.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),A.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),A.moveToProtected(t,e,["parentProp"]),eR(t,e)}const nR=A.newInstance(r6,"vtkProp");var i6={newInstance:nR,extend:r6,...n6};const rR=1e-6;function iR(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((i,a)=>i+r[a]),t.modified()},t.getOrientationWXYZ=()=>{const r=ps();ch(r,e.rotation);const i=new Float64Array(3),a=RO(i,r);return[Hf(a),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ch(r,e.rotation)},t.rotateX=r=>{r!==0&&(f2(e.rotation,e.rotation,gn(r)),t.modified())},t.rotateY=r=>{r!==0&&(g2(e.rotation,e.rotation,gn(r)),t.modified())},t.rotateZ=r=>{r!==0&&(d2(e.rotation,e.rotation,gn(r)),t.modified())},t.rotateWXYZ=(r,i,a,o)=>{if(r===0||i===0&&a===0&&o===0)return;const s=gn(r),c=ps();kg(c,[i,a,o],s);const l=new Float64Array(16);r0(l,c),rt(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-rR)return;const i=r0(new Float64Array(16),r);rt(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(r,i,a)=>r===e.orientation[0]&&i===e.orientation[1]&&a===e.orientation[2]?!1:(e.orientation=[r,i,a],Ze(e.rotation),t.rotateZ(a),t.rotateX(r),t.rotateY(i),t.modified(),!0),t.setOrientationFromQuaternion=r=>{const i=pi();return r0(i,r),h0(i,e.rotation)?!1:(e.rotation=i,t.modified(),!0)},t.setUserMatrix=r=>h0(e.userMatrix,r)?!1:(mn(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){Ze(e.matrix),e.userMatrix&&rt(e.matrix,e.matrix,e.userMatrix),Mn(e.matrix,e.matrix,e.origin),Mn(e.matrix,e.matrix,e.position),rt(e.matrix,e.matrix,e.rotation),Sa(e.matrix,e.matrix,e.scale),Mn(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),bt(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let i=0;i<4;++i)(r===i?1:0)!==e.matrix[r+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getBoundsByReference=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r,e.bounds=[...xt.INIT_BOUNDS],e.boundsMTime.modified(),r;if(!e.mapperBounds||!r.every((i,a)=>r[a]===e.mapperBounds[a])||t.getMTime()>e.boundsMTime.getMTime()){A.vtkDebugMacro("Recomputing bounds..."),e.mapperBounds=r,t.computeMatrix();const i=new Float64Array(16);bt(i,e.matrix),xt.transformBounds(r,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBounds=()=>{const r=t.getBoundsByReference();try{return[...r]}catch{return r}},t.getCenter=()=>xt.getCenter(e.bounds),t.getLength=()=>xt.getLength(e.bounds),t.getXRange=()=>xt.getXRange(e.bounds),t.getYRange=()=>xt.getYRange(e.bounds),t.getZRange=()=>xt.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n),t.getProperty=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.properties[r]==null&&(e.properties[r]=t.makeProperty?.()),e.properties[r]},t.getProperties=()=>(e.properties.length===0&&(e.properties[0]=t.makeProperty?.()),e.properties),t.setProperty=(r,i)=>{const a=Number.isInteger(r),[o,s]=a?[r,i]:[0,r];return e.properties[o]===s?!1:(e.properties[o]=s,!0)},t.getMTime=()=>{let r=e.mtime;return e.properties.forEach(i=>{if(i!==null){const a=i.getMTime();r=a>r?a:r}}),r}}const aR={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[...xt.INIT_BOUNDS],properties:[],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function a6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aR,n),i6.extend(t,e,n),e.matrixMTime={},A.obj(e.matrixMTime),A.get(t,e,["isIdentity"]),A.getArray(t,e,["orientation"]),A.setGetArray(t,e,["origin","position","scale"],3),A.setGet(t,e,["properties"]),e.matrix=Ze(new Float64Array(16)),e.rotation=Ze(new Float64Array(16)),e.userMatrix=Ze(new Float64Array(16)),e.transform=null,iR(t,e)}const oR=A.newInstance(a6,"vtkProp3D");var L2={newInstance:oR,extend:a6};const o6={NEAREST:0,LINEAR:1,FAST_LINEAR:2},s6={FRACTIONAL:0,PROPORTIONAL:1},pf={DEFAULT:0,ADDITIVE:1,COLORIZE:2,CUSTOM:3},sR={OFF:0,NORMALIZED:1,RAW:2};var c6={InterpolationType:o6,OpacityMode:s6,ColorMixPreset:pf,FilterMode:sR};const{InterpolationType:cl,OpacityMode:cR,FilterMode:ll,ColorMixPreset:lR}=c6,{vtkErrorMacro:q1}=A,mf=4;function uR(t,e){e.classHierarchy.push("vtkVolumeProperty");const n={...t};t.getMTime=()=>{let a=e.mtime,o;for(let s=0;s<mf;s++)e.componentData[s].colorChannels===1?e.componentData[s].grayTransferFunction&&(o=e.componentData[s].grayTransferFunction.getMTime(),a=a>o?a:o):e.componentData[s].colorChannels===3&&e.componentData[s].rGBTransferFunction&&(o=e.componentData[s].rGBTransferFunction.getMTime(),a=a>o?a:o),e.componentData[s].scalarOpacity&&(o=e.componentData[s].scalarOpacity.getMTime(),a=a>o?a:o),e.componentData[s].gradientOpacity&&(e.componentData[s].disableGradientOpacity||(o=e.componentData[s].gradientOpacity.getMTime(),a=a>o?a:o));return a},t.getColorChannels=a=>a<0||a>3?(q1("Bad index - must be between 0 and 3"),0):e.componentData[a].colorChannels,t.setGrayTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[a].grayTransferFunction!==o&&(e.componentData[a].grayTransferFunction=o,s=!0),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1,s=!0),s&&t.modified(),s},t.getGrayTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[a].grayTransferFunction===null&&(e.componentData[a].grayTransferFunction=Cc.newInstance(),e.componentData[a].grayTransferFunction.addPoint(0,0),e.componentData[a].grayTransferFunction.addPoint(1024,1),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1),t.modified()),e.componentData[a].grayTransferFunction},t.setRGBTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[a].rGBTransferFunction!==o&&(e.componentData[a].rGBTransferFunction=o,s=!0),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3,s=!0),s&&t.modified(),s},t.getRGBTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[a].rGBTransferFunction===null&&(e.componentData[a].rGBTransferFunction=po.newInstance(),e.componentData[a].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[a].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3),t.modified()),e.componentData[a].rGBTransferFunction},t.setScalarOpacity=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[a].scalarOpacity!==o?(e.componentData[a].scalarOpacity=o,t.modified(),!0):!1},t.getScalarOpacity=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[a].scalarOpacity===null&&(e.componentData[a].scalarOpacity=Cc.newInstance(),e.componentData[a].scalarOpacity.addPoint(0,1),e.componentData[a].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[a].scalarOpacity},t.setComponentWeight=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(a<0||a>=mf)return q1("Invalid index"),!1;const s=Math.min(1,Math.max(0,o));return e.componentData[a].componentWeight!==s?(e.componentData[a].componentWeight=s,t.modified(),!0):!1},t.getComponentWeight=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return a<0||a>=mf?(q1("Invalid index"),0):e.componentData[a].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(cl.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(cl.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(cl.FAST_LINEAR),t.getInterpolationTypeAsString=()=>A.enumToString(cl,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(a=>{const o=A.capitalize(a);t[`set${o}`]=(s,c)=>e.componentData[s][`${a}`]!==c?(e.componentData[s][`${a}`]=c,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(a=>{const o=A.capitalize(a);t[`get${o}`]=s=>e.componentData[s][`${a}`]}),t.setAverageIPScalarRange=(a,o)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(a,o)},t.getFilterModeAsString=()=>A.enumToString(ll,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(ll.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(ll.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(ll.RAW)},t.setGlobalIlluminationReach=a=>n.setGlobalIlluminationReach(Wi(a,0,1)),t.setVolumetricScatteringBlending=a=>n.setVolumetricScatteringBlending(Wi(a,0,1)),t.setAnisotropy=a=>n.setAnisotropy(Wi(a,-.99,.99)),t.setLAOKernelSize=a=>n.setLAOKernelSize(t2(Wi(a,1,32))),t.setLAOKernelRadius=a=>n.setLAOKernelRadius(a>=1?a:1)}const fR=t=>({colorMixPreset:lR.DEFAULT,independentComponents:!0,interpolationType:cl.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,ipScalarRange:[-1e6,1e6],filterMode:ll.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7,updatedExtents:[],...t});function gR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,fR(n)),A.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<mf;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:cR.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}A.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius","updatedExtents"]),A.setGetArray(t,e,["ipScalarRange"],2),A.setGetArray(t,e,["labelOutlineThickness"]),uR(t,e)}const dR=A.newInstance(gR,"vtkVolumeProperty");var hR={newInstance:dR,...c6};function pR(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>[t],t.makeProperty=hR.newInstance,t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const mR={mapper:null};function l6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mR,n),L2.extend(t,e,n),e.boundsMTime={},A.obj(e.boundsMTime),A.setGet(t,e,["mapper"]),pR(t,e)}const vR=A.newInstance(l6,"vtkVolume");var yR={newInstance:vR,extend:l6};const{vtkErrorMacro:TR}=A,CR=["Build","Render"];function wR(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const i=r.getTraverseOperation(),a=t[i];if(a){a(r);return}t.apply(r,!0);for(let o=0;o<e.children.length;o++)e.children[o].traverse(r);t.apply(r,!1)},t.apply=(r,i)=>{const a=t[r.getOperation()];a&&a(i,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let i=0;i<e.children.length;++i){const o=e.children[i].getViewNodeFor(r);if(o)return o}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(r);return i||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const i=e._renderableChildMap.get(r);if(i!==void 0)return i.setVisited(!0),i;const a=t.createViewNode(r);if(a)return a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(r,a),e.children.push(a),a},t.addMissingNodes=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!r.length))for(let a=0;a<r.length;++a){const o=r[a],s=t.addMissingNode(o);if(i&&s!==void 0&&e.children[a]!==s){for(let c=a+1;c<e.children.length;++c)if(e.children[c]===s){e.children.splice(c,1),e.children.splice(a,0,s);break}}}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];if(e.children.indexOf(a)===-1){a.setParent(t),e.children.push(a);const s=a.getRenderable();s&&e._renderableChildMap.set(s,a)}a.setVisited(!0)}},t.removeNode=r=>{const i=e.children.findIndex(o=>o===r);if(i<0)return!1;const a=r.getRenderable();return a&&e._renderableChildMap.delete(a),r.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let i=0;i<e.children.length;++i){const a=e.children[i];if(a.getVisited())e.children[r++]=a,a.setVisited(!1);else{const s=a.getRenderable();s&&e._renderableChildMap.delete(s),a.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return TR("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(r);return i&&i.setRenderable(r),i};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const SR={renderable:null,myFactory:null,children:[],visited:!1};function u6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SR,n),A.obj(t,e),A.event(t,e,"event"),e._renderableChildMap=new Map,A.get(t,e,["visited"]),A.setGet(t,e,["_parent","renderable","myFactory"]),A.getArray(t,e,["children"]),A.moveToProtected(t,e,["parent"]),wR(t,e)}const xR=A.newInstance(u6,"vtkViewNode");var bn={newInstance:xR,extend:u6,PASS_TYPES:CR};function ER(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const OR={};function f6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OR,n),A.obj(t,e),ER(t,e)}const RR=A.newInstance(f6,"vtkViewNodeFactory");var V2={newInstance:RR,extend:f6};const g6=Object.create(null);function rr(t,e){g6[t]=e}function DR(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const MR={};function d6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MR,n),e.overrides=g6,V2.extend(t,e,n),DR(t,e)}const _R=A.newInstance(d6,"vtkOpenGLViewNodeFactory");var IR={newInstance:_R,extend:d6};function bR(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){mn(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),uc(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),ds(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),bt(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();mn(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),bt(e.keyMatrices.vcpc,e.keyMatrices.vcpc),rt(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const LR={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function VR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LR,n),bn.extend(t,e,n),e.keyMatrixTime={},an(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Gn(t,e,["context","keyMatrixTime"]),bR(t,e)}const h6=Yt(VR);var PR={newInstance:h6};rr("vtkCamera",h6);const{vtkDebugMacro:NR}=Dr;function AR(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(NR("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),r|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const a=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.colorMask(!0,!0,!0,!0),r&&i.clear(r),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-s,d=Math.round(u[1])-c;return g<0&&(g=0),d<0&&(d=0),{usize:g,vsize:d,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const a=e.renderable.getBackgroundByReference();r.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const FR={context:null,_openGLRenderWindow:null,selector:null};function UR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FR,n),bn.extend(t,e,n),$r(t,e,["shaderCache"]),Gn(t,e,["selector"]),eu(t,e,["openGLRenderWindow"]),AR(t,e)}const p6=Yt(UR,"vtkOpenGLRenderer");var kR={newInstance:p6};rr("vtkRenderer",p6);const{isVtkObject:GR}=A;function m6(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function v6(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const BR={extractCellSizes:m6,getNumberOfCells:v6};function $R(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=v6(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=m6(t.getData())),e.cellSizes),t.resize=r=>{const i=t.getNumberOfTuples();n.resize(r);const a=t.getNumberOfTuples();a<i&&(a===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let i=r;const a=e.values[i++];return e.values.subarray(i,i+a)},t.insertNextCell=r=>{let i;GR(r)?i=r.getPointsIds():i=r;const a=t.getNumberOfCells();return t.insertNextTuples([i.length,...i]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(i.length),a},t.getMaxCellSize=()=>t.getCellSizes().reduce((r,i)=>Math.max(r,i),0)}function WR(t){return{empty:!0,numberOfComponents:1,dataType:dt.UNSIGNED_INT,...t}}function y6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ot.extend(t,e,WR(n)),$R(t,e)}const zR=A.newInstance(y6,"vtkCellArray");var wc={newInstance:zR,extend:y6,...BR};const{vtkErrorMacro:HR}=A;function jR(t,e){let n=0;e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==a&&(e.size=a*o,e.values=A.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(o),t.modified())},t.setPoint=function(a){for(var o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];t.setTuple(a,s)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(a,o,s)=>t.insertNextTuple([a,o,s]),t.insertPoint=(a,o)=>t.insertTuple(a,o);const r=t.getBounds;t.getBounds=()=>(n<e.mtime&&t.computeBounds(),r());const i=t.getBoundsByReference;t.getBoundsByReference=()=>(n<e.mtime&&t.computeBounds(),i()),t.computeBounds=()=>{if(t.getNumberOfComponents()===3){const a=t.getRange(0);e.bounds[0]=a[0],e.bounds[1]=a[1];const o=t.getRange(1);e.bounds[2]=o[0],e.bounds[3]=o[1];const s=t.getRange(2);e.bounds[4]=s[0],e.bounds[5]=s[1]}else if(t.getNumberOfComponents()===2){const a=t.getRange(0);e.bounds[0]=a[0],e.bounds[1]=a[1];const o=t.getRange(1);e.bounds[2]=o[0],e.bounds[3]=o[1],e.bounds[4]=0,e.bounds[5]=0}else HR(`getBounds called on an array with components of ${t.getNumberOfComponents()}`),a2(e.bounds);n=A.getCurrentGlobalMTime()},t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const KR={empty:!0,numberOfComponents:3,dataType:dt.FLOAT,bounds:[1,-1,1,-1,1,-1]};function T6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KR,n),ot.extend(t,e,n),A.getArray(t,e,["bounds"],6),jR(t,e)}const qR=A.newInstance(T6,"vtkPoints");var ag={newInstance:qR,extend:T6};function XR(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=A.newTypedArray(n.getDataType(),3*e.pointsIds.length));const a=n.getData();e.pointsIds.forEach((o,s)=>{let c=3*o,l=3*s;i[l]=a[c],i[++l]=a[++c],i[++l]=a[++c]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let i=n.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>e.points.getBounds(),t.getLength2=()=>{const n=xt.getLengths(t.getBounds());return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},t.getParametricDistance=n=>{let r,i=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>i&&(i=r);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,i,a,o,s,c)=>{},t.evaluatePosition=(n,r,i,a,o,s)=>{A.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const YR={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function C6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YR,n),A.obj(t,e),e.points||(e.points=ag.newInstance()),A.get(t,e,["points","pointsIds"]),XR(t,e)}const ZR=A.newInstance(C6,"vtkCell");var Sc={newInstance:ZR,extend:C6};function JR(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function QR(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.insertCellReference(c,a[c]++,o)})}}else{for(let o=0;o<i;o++)Sc.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o)Sc.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,a[c]++,o)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(i=>i!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{JR(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,i)=>{e.array[n].cells[r]=i}}const eD={array:null,maxId:0,extend:0};function w6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eD,n),A.obj(t,e),QR(t,e)}const tD=A.newInstance(w6,"vtkCellLinks");var nD={newInstance:tD,extend:w6};const Ft={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},gh=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function rD(t){return t<gh.length?gh[t]:"UnknownClass"}function iD(t){return gh.findIndex(t)}function aD(t){return t<Ft.VTK_QUADRATIC_EDGE||t===Ft.VTK_CONVEX_POINT_SET||t===Ft.VTK_POLYHEDRON}function oD(t){return t===Ft.VTK_TRIANGLE_STRIP||t===Ft.VTK_POLY_LINE||t===Ft.VTK_POLY_VERTEX}const sD={getClassNameFromTypeId:rD,getTypeIdFromClassName:iD,isLinear:aD,hasSubCells:oD};function cD(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,i)=>{e.typeArray[n]=r,e.locationArray[n]=i,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,i)=>{e.size=n,e.typeArray=r,e.locationArray=i,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=Ft.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let i=0;i<r;++i)if(n===t.getCellType(i))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const lD={size:0,maxId:-1,extend:1e3};function S6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lD,n),A.obj(t,e),A.get(t,e,["size","maxId","extend"]),A.getArray(t,e,["typeArray","locationArray"]),cD(t,e)}const uD=A.newInstance(S6,"vtkCellTypes");var fD={newInstance:uD,extend:S6,...sD};const x6={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var E6={IntersectionState:x6};const{IntersectionState:vf}=E6;function qc(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},a=[];let o;a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2];const s=a[0]*(t[0]-e[0])+a[1]*(t[1]-e[1])+a[2]*(t[2]-e[2]),c=at(a,a);let l=1e-5*s;return c!==0&&(i.t=s/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?o=e:i.t>1?o=n:(o=a,a[0]=e[0]+i.t*a[0],a[1]=e[1]+i.t*a[1],a[2]=e[2]+i.t*a[2]),r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2]),i.distance=si(o,t),i}function O6(t,e,n,r,i,a){const o=[],s=[],c=[];i[0]=0,a[0]=0,Kn(e,t,o),Kn(r,n,s),Kn(n,t,c);const l=[at(o,o),-at(o,s),-at(o,s),at(s,s)],f=[];if(f[0]=at(o,c),f[1]=-at(s,c),Bv(l,f,2)===0){let u=Number.MAX_VALUE;const g=[t,e,n,r],d=[n,n,t,t],p=[r,r,e,e];a[0],a[0],i[0],i[0],i[0],i[0],a[0],a[0];let h;for(let m=0;m<4;m++)h=qc(g[m],d[m],p[m]),h.distance<u&&(u=h.distance,h.t);return vf.ON_LINE}return i[0]=f[0],a[0]=f[1],i[0]>=0&&i[0]<=1&&a[0]>=0&&a[0]<=1?vf.YES_INTERSECTION:vf.NO_INTERSECTION}const gD={distanceToLine:qc,intersection:O6};function dD(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,o,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const l=[],f=[],u=[];e.points.getPoint(0,f),e.points.getPoint(1,u);const g=[],d=[],p=O6(r,i,f,u,g,d);if(c.t=g[0],c.betweenPoints=n(c.t),s[0]=d[0],p===vf.YES_INTERSECTION){for(let h=0;h<3;h++)o[h]=f[h]+s[0]*(u[h]-f[h]),l[h]=r[h]+c.t*(i[h]-r[h]);if(si(o,l)<=a*a)return c.intersect=1,c}else{let h;if(c.t<0)return h=qc(r,f,u,o),h.distance<=a*a&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return h=qc(i,f,u,o),h.distance<=a*a&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,h=qc(f,r,i,o),c.t=h.t,h.distance<=a*a&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,h=qc(u,r,i,o),c.t=h.t,h.distance<=a*a&&(c.intersect=1),c}return c},t.evaluateLocation=(r,i,a)=>{const o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=o[c]+r[0]*(s[c]-o[c]);a[0]=1-r[0],a[1]=r[0]},t.evaluateOrientation=(r,i,a)=>e.orientations?(gf(i,e.orientations[0],e.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const hD={orientations:null};function R6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hD,n),Sc.extend(t,e,n),A.setGet(t,e,["orientations"]),dD(t,e)}const pD=A.newInstance(R6,"vtkLine");var Er={newInstance:pD,extend:R6,...gD,...E6};const{vtkErrorMacro:Y5,vtkWarningMacro:mD}=A;function vD(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:$i(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(i=>i),e.arrays=r.getArrays().map(i=>({data:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const i=r.getName(),{array:a,index:o}=t.getArrayWithIndex(i);return a!=null?(e.arrays[o]={data:r},o):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return t.removeArrayByIndex(i)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((i,a,o)=>a.data.getName()===r?a.data:i,null),t.getArrayWithIndex=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const i=e.arrays[r];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(o=>{const s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){let c=t.getArrayByName(o.getName());if(c)if(o.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<o.getNumberOfTuples()){const l=a>-1?a:i;c.insertTuple(l,o.getTuple(i))}else c.insertTuples(0,o.getTuples());else Y5("Unhandled case in passData");else if(i<0||i>o.getNumberOfTuples())t.addArray(o),r.getAttributes(o).forEach(l=>{t.setAttribute(o,l)});else{const l=o.getNumberOfComponents();let f=o.getNumberOfValues();const u=a>-1?a:i;f<=u*l&&(f=(u+1)*l),c=ot.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:l,values:A.newTypedArray(o.getDataType(),f),size:0}),c.insertTuple(u,o.getTuple(i)),t.addArray(c),r.getAttributes(o).forEach(g=>{t.setAttribute(c,g)})}}})},t.interpolateData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let f=t.getArrayByName(c.getName());if(f)if(c.getNumberOfComponents()===f.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const u=o>-1?o:i;f.interpolateTuple(u,c,i,c,a,s),mD("Unexpected case in interpolateData")}else f.insertTuples(c.getTuples());else Y5("Unhandled case in interpolateData");else if(i<0||a<0||i>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let g=c.getNumberOfValues();const d=o>-1?o:i;g<=d*u&&(g=(d+1)*u),f=ot.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:A.newTypedArray(c.getDataType(),g),size:0}),f.interpolateTuple(d,c,i,c,a,s),t.addArray(f),r.getAttributes(c).forEach(p=>{t.setAttribute(f,p)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(i=>{const a=i.newClone();return a.deepCopy(i),{data:a}})},t.copyFlags=r=>r.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,i)=>i.data.getMTime()>r?i.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,i)=>r+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(i=>({data:i.data.getState()}))),r}}const yD={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function D6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yD,n),A.obj(t,e),vD(t,e)}const TD=A.newInstance(D6,"vtkFieldData");var CD={newInstance:TD,extend:D6};const wD={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},SD={MAX:0,EXACT:1,NOLIMIT:2},xD={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},ED={DUPLICATEPOINT:1,HIDDENPOINT:2},OD={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},RD="vtkGhostType",DD={DEFAULT:0,SINGLE:1,DOUBLE:2};var M6={AttributeCopyOperations:OD,AttributeLimitTypes:SD,AttributeTypes:wD,CellGhostTypes:xD,DesiredOutputPrecision:DD,PointGhostTypes:ED,ghostArrayName:RD};const{AttributeTypes:$o,AttributeCopyOperations:$s}=M6,{vtkWarningMacro:Mu}=A;function MD(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(o){let s=n.find(c=>$o[c.toUpperCase()]===o||typeof o!="number"&&c.toLowerCase()===o.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=o=>!0,t.setAttribute=(o,s)=>{const c=r(s);if(o&&c.toUpperCase()==="PEDIGREEIDS"&&!o.isA("vtkDataArray"))return Mu(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(o&&!t.checkNumberOfComponents(o,c))return Mu(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===o)return l;t.removeArrayByIndex(l)}return o?(l=t.addArray(o),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=o=>n.filter(s=>t[`get${s}`]()===o),t.setActiveAttributeByName=(o,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(o).index,s),t.setActiveAttributeByIndex=(o,s)=>{const c=r(s);if(o>=0&&o<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(o);if(!l.isA("vtkDataArray"))return Mu(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return Mu(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=o,t.modified(),o}return o===-1&&(e[`active${c}`]=o,t.modified()),-1},t.getActiveAttribute=o=>{const s=r(o);return t[`get${s}`]()},t.removeAllArrays=()=>{n.forEach(o=>{e[`active${o}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=o=>(o!==-1&&n.forEach(s=>{o===e[`active${s}`]?e[`active${s}`]=-1:o<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(o)),n.forEach(o=>{const s=`active${o}`;t[`get${o}`]=()=>t.getArrayByIndex(e[s]),t[`set${o}`]=c=>t.setAttribute(c,o),t[`setActive${o}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,o),t[`copy${o}Off`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[$s.PASSDATA][$o[c]]=!1},t[`copy${o}On`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[$s.PASSDATA][$o[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys($s).filter(o=>o!=="ALLCOPY").forEach(o=>{e.copyAttributeFlags[$s[o]]=Object.keys($o).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[$o[c]]=!0,s),[])}),e.copyAttributeFlags[$s.COPYTUPLE][$o.GLOBALIDS]=!1,e.copyAttributeFlags[$s.INTERPOLATE][$o.GLOBALIDS]=!1,e.copyAttributeFlags[$s.COPYTUPLE][$o.PEDIGREEIDS]=!1},t.initialize=A.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(o=>{!e.dataArrays[o].ref&&e.dataArrays[o].type==="vtkDataArray"&&t.addArray(ot.newInstance(e.dataArrays[o]))});const a=t.shallowCopy;t.shallowCopy=(o,s)=>{a(o,s),e.arrays=o.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,s),{data:l}})},t.initializeAttributeCopyFlags()}const _D={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function _6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_D,n),CD.extend(t,e,n),A.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),MD(t,e)}const ID=A.newInstance(_6,"vtkDataSetAttributes");var Z5={newInstance:ID,extend:_6,...M6};const bD={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},LD={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var VD={FieldDataTypes:bD,FieldAssociations:LD};const ul=["pointData","cellData","fieldData"];function PD(t,e){e.classHierarchy.push("vtkDataSet"),ul.forEach(i=>{e[i]?e[i]=$i(e[i]):e[i]=Z5.newInstance()}),t.computeBounds=()=>{if(e.modifiedTime&&e.computeTime&&e.modifiedTime>e.computeTime||!e.computeTime){const i=t.getPoints();i?.getNumberOfPoints()?xt.setBounds(e.bounds,i.getBoundsByReference()):e.bounds=Tn.createUninitializedBounds(),e.computeTime=A.getCurrentGlobalMTime()}},t.getLength2=()=>{const i=t.getBoundsByReference();return!i||i.length!==6?0:xt.getDiagonalLength2(i)},t.getLength=()=>Math.sqrt(t.getLength2()),t.getCenter=()=>{const i=t.getBoundsByReference();return!i||i.length!==6?[0,0,0]:xt.getCenter(i)},t.getCellBounds=i=>{const a=t.getCell(i);return a?a.getBounds():Tn.createUninitializedBounds()},t.getBounds=A.chain(()=>t.computeBounds,t.getBounds),t.getBoundsByReference=A.chain(()=>t.computeBounds,t.getBoundsByReference);const n=t.shallowCopy;t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(i,a),ul.forEach(o=>{e[o]=Z5.newInstance(),e[o].shallowCopy(i.getReferenceByName(o))})};const r=t.getMTime;t.getMTime=()=>ul.reduce((i,a)=>Math.max(i,e[a]?.getMTime()??i),r()),t.initialize=()=>(ul.forEach(i=>e[i]?.initialize()),t)}const ND={};function I6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ND,n),A.obj(t,e),A.setGet(t,e,ul),A.getArray(t,e,["bounds"],6),PD(t,e)}const AD=A.newInstance(I6,"vtkDataSet");var L0={newInstance:AD,extend:I6,...VD};function FD(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=$i(e.points):e.points=ag.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(a,o),e.points=ag.newInstance(),e.points.shallowCopy(a.getPoints())};const r=t.getMTime;t.getMTime=()=>{const a=r();return Math.max(a,e.points?.getMTime()??a)};const i=t.initialize;t.initialize=()=>(e.points?.initialize(),i())}const UD={};function b6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UD,n),L0.extend(t,e,n),A.setGet(t,e,["points"]),FD(t,e)}const kD=A.newInstance(b6,"vtkPointSet");var GD={newInstance:kD,extend:b6};function BD(t,e){e.classHierarchy.push("vtkPolyLine");const n=Er.newInstance();n.getPoints().setNumberOfPoints(2),t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,o,s,c,l)=>{const f={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null},u=t.getNumberOfPoints()-1;let g=Number.MAX_VALUE;for(let d=0;d<u;d++){const p=[0,0,0];n.getPoints().getData().set(e.points.getData().subarray(3*d,3*(d+2)));const h=n.intersectWithLine(a,o,s,c,l);if(h.intersect===1&&h.t<=f.t+s&&h.t>=r&&h.t<=i){f.intersect=1;const m=n.getParametricDistance(p);if(m<g||m===g&&h.t<f.t){f.subId=d,f.t=h.t,g=m;for(let v=0;v<3;v++)c[v],p[v]}}}return f},t.evaluateLocation=(r,i,a,o)=>(n.getPoints().getData().set(e.points.getData().subarray(3*r,3*(r+2))),n.evaluateLocation(i,a,o)),t.evaluateOrientation=(r,i,a,o)=>(e.orientations?n.setOrientations([e.orientations[r],e.orientations[r+1]]):n.setOrientations(null),n.evaluateOrientation(i,a,o)),t.getDistancesToFirstPoint=()=>{const r=e.distancesTime.getMTime();if(r<e.points.getMTime()||r<t.getMTime()){const i=t.getNumberOfPoints();if(e.distances?e.distances.length=i:e.distances=new Array(i),i>0){const a=new Array(3),o=new Array(3);let s=0;e.distances[0]=s,e.points.getPoint(0,a);for(let c=1;c<i;++c)e.points.getPoint(c,o),s+=e.distanceFunction(a,o),e.distances[c]=s,h8(a,o)}e.distancesTime.modified()}return e.distances},t.findPointIdAtDistanceFromFirstPoint=r=>{const i=t.getDistancesToFirstPoint();if(i.length<2)return-1;let a=0,o=i.length-1;if(r<i[a]||r>i[o]||i[o]===0)return-1;for(;o-a>1;){const s=Math.floor((a+o)/2);i[s]<=r?a=s:o=s}return a}}const $D={orientations:null,distanceFunction:SO};function L6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$D,n),Sc.extend(t,e,n),A.setGet(t,e,["orientations","distanceFunction"]),e.distancesTime={},A.obj(e.distancesTime,{mtime:0}),BD(t,e)}const WD=A.newInstance(L6,"vtkPolyLine");var zD={newInstance:WD,extend:L6};function HD(t,e){e.classHierarchy.push("vtkPriorityQueue"),t.push=(n,r)=>{const i=e.elements.findIndex(a=>a.priority>n);e.elements.splice(i,0,{priority:n,element:r})},t.pop=()=>e.elements.length>0?e.elements.shift().element:null,t.deleteById=n=>{e.elements=e.elements.filter(r=>{let{element:i}=r;return i.id!==n})},t.length=()=>e.elements.length}const jD={elements:[]};function V6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jD,n),A.obj(t,e),HD(t,e)}const KD=A.newInstance(V6,"vtkPriorityQueue");var qD={newInstance:KD,extend:V6};const _u=1e-6,J5=11920929e-14,XD=1e-8,Qs={FAILURE:-1,OUTSIDE:0,INSIDE:1,INTERSECTION:2,ON_LINE:3};function Q5(t,e,n,r,i){return(r[t]-n[t])*(i[e]-n[e])-(i[t]-n[t])*(r[e]-n[e])}function YD(t,e,n,r){if(t[0]<n[0]||t[0]>n[1]||t[1]<n[2]||t[1]>n[3]||t[2]<n[4]||t[2]>n[5])return Qs.OUTSIDE;if(hi(r)<=J5)return Qs.FAILURE;let i=XD*((n[1]-n[0])*(n[1]-n[0])+(n[3]-n[2])*(n[3]-n[2])+(n[5]-n[4])*(n[5]-n[4]));i*=i,i=i===0?J5:i;const a=[],o=[];for(let f=0;f<e.length;){if(a[0]=e[f++],a[1]=e[f++],a[2]=e[f++],si(t,a)<=i)return Qs.INSIDE;const{distance:u,t:g}=Er.distanceToLine(t,a,o);if(u<=i&&g>0&&g<1)return Qs.INSIDE}let s,c;Math.abs(r[0])>Math.abs(r[1])?Math.abs(r[0])>Math.abs(r[2])?(s=1,c=2):(s=0,c=1):Math.abs(r[1])>Math.abs(r[2])?(s=0,c=2):(s=0,c=1);let l=0;for(let f=0;f<e.length;)a[0]=e[f++],a[1]=e[f++],a[2]=e[f++],f<e.length?(o[0]=e[f],o[1]=e[f+1],o[2]=e[f+2]):(o[0]=e[0],o[1]=e[1],o[2]=e[2]),a[c]<=t[c]?o[c]>t[c]&&Q5(s,c,a,o,t)>0&&++l:o[c]<=t[c]&&Q5(s,c,a,o,t)<0&&--l;return l===0?Qs.OUTSIDE:Qs.INSIDE}function ZD(t,e,n){const r=t.length,i=[];e.getPoint(t[0],i),n[0]=i[0],n[1]=i[0],n[2]=i[1],n[3]=i[1],n[4]=i[2],n[5]=i[2];for(let o=1;o<r;o++)e.getPoint(t[o],i),xt.addPoint(n,...i);const a=xt.getLengths(n);return at(a,a)}function JD(t,e,n){n.length=3,n[0]=0,n[1]=0,n[2]=0;const r=[];let i=[],a=[];const o=[],s=[];e.getPoint(t[0],r),e.getPoint(t[1],i);for(let c=2;c<t.length;c++){e.getPoint(t[c],a),Kn(a,i,o),Kn(r,i,s);const l=[0,0,0];kr(o,s,l),d0(n,l,n),[i,a]=[a,i]}return hi(n)}function QD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];n[0]=0,n[1]=0,n[2]=0;const r=t.length,i=[];for(let a=0;a<r;a++)e.getPoint(t[a],i),n[0]+=i[0],n[1]+=i[1],n[2]+=i[2];return n[0]/=r,n[1]/=r,n[2]/=r,n}const eM={PolygonWithPointIntersectionState:Qs,pointInPolygon:YD,getBounds:ZD,getNormal:JD,computeCentroid:QD};function tM(t,e){e.classHierarchy.push("vtkPolygon");function n(){const s=[0,0,0],c=[0,0,0];e.normal=[0,0,0];const l=[...e.firstPoint.point];let f=e.firstPoint;for(let u=0;u<e.pointCount;u++){Kn(f.point,l,s),Kn(f.next.point,l,c);const g=[0,0,0];kr(s,c,g),d0(e.normal,g,e.normal),f=f.next}return hi(e.normal)}function r(s){const c=[0,0,0],l=[0,0,0],f=[0,0,0],u=[0,0,0];Kn(s.point,s.previous.point,c),Kn(s.next.point,s.point,l),Kn(s.previous.point,s.next.point,f),kr(c,l,u);const g=at(u,e.normal);if(g<=0)return-1;const d=fi(c)+fi(l)+fi(f);return d*d/g}function i(s){if(e.pointCount<=3)return!0;const c=s.previous,l=s.next,f=[0,0,0];Kn(l.point,c.point,f);const u=[0,0,0];if(kr(f,e.normal,u),hi(u),fi(u)===0)return!1;let g=tr.evaluate(u,c.point,l.next.point),d=g>_u?1:g<-_u?-1:0,p=d<0?1:0;for(let h=l.next.next;h.id!==c.id;h=h.next){const m=h.previous;g=tr.evaluate(u,c.point,h.point);const v=g>_u?1:g<-_u?-1:0;if(v!==d){if(p||(p=v<=0?1:0),Er.intersection(c.point,l.point,h.point,m.point,[0],[0])===x6.YES_INTERSECTION)return!1;d=v}}return p===1}function a(s,c){e.pointCount-=1;const l=s.previous,f=s.next;e.tris=e.tris.concat(s.point),e.tris=e.tris.concat(f.point),e.tris=e.tris.concat(l.point),l.next=f,f.previous=l,c.deleteById(l.id),c.deleteById(f.id);const u=r(l);u>0&&c.push(u,l);const g=r(f);g>0&&c.push(g,f),s.id===e.firstPoint.id&&(e.firstPoint=f)}function o(){n();const s=qD.newInstance();let c=e.firstPoint;for(let l=0;l<e.pointCount;l++){const f=r(c);f>0&&s.push(f,c),c=c.next}for(;e.pointCount>2&&s.length()>0;)if(e.pointCount===s.length()){const l=s.pop();a(l,s)}else{const l=s.pop();i(l)&&a(l,s)}return e.pointCount<=2}t.triangulate=()=>e.firstPoint?o():null,t.setPoints=s=>{e.pointCount=s.length,e.firstPoint={id:0,point:s[0],next:null,previous:null};let c=e.firstPoint;for(let l=1;l<e.pointCount;l++)c.next={id:l,point:s[l],next:null,previous:c},c=c.next;e.firstPoint.previous=c,c.next=e.firstPoint},t.getPointArray=()=>e.tris}const nM={firstPoint:null,pointCount:0,tris:[]};function P6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nM,n),A.obj(t,e),tM(t,e)}const rM=A.newInstance(P6,"vtkPolygon");var iM={newInstance:rM,extend:P6,...eM};function P2(t,e,n,r){const i=n[0]-e[0],a=n[1]-e[1],o=n[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];r[0]=a*l-o*c,r[1]=o*s-i*l,r[2]=i*c-a*s}function $l(t,e,n,r){P2(t,e,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i!==0&&(r[0]/=i,r[1]/=i,r[2]/=i)}function N6(t){t[0]=-1,t[1]=1,t[2]=0,t[3]=-1,t[4]=0,t[5]=1}function aM(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],l=[],f=[],u=[],g=[];$l(t,e,n,u),$l(r,i,a,g);const d=-at(u,t),p=-at(g,r),h=[at(g,t)+p,at(g,e)+p,at(g,n)+p];if(h[0]*h[1]>o&&h[0]*h[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const m=[at(u,r)+d,at(u,i)+d,at(u,a)+d];if(m[0]*m[1]>o&&m[0]*m[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Math.abs(u[0]-g[0])<1e-9&&Math.abs(u[1]-g[1])<1e-9&&Math.abs(u[2]-g[2])<1e-9&&Math.abs(d-p)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const v=[t,e,n],y=[r,i,a],T=at(u,g),C=(d-p*T)/(T*T-1),w=(p-d*T)/(T*T-1),S=[C*u[0]+w*g[0],C*u[1]+w*g[1],C*u[2]+w*g[2]],_=kr(u,g,[]);hi(_);let D=0,N=0;const P=[],F=[];let B=50,k=50;for(let W=0;W<3;W++){const J=W,ne=(W+1)%3,q=tr.intersectWithLine(v[J],v[ne],r,g);q.intersection&&q.t>0-o&&q.t<1+o&&(q.t<1+o&&q.t>1-o&&(B=D),P[D++]=at(q.x,_)-at(S,_));const Q=tr.intersectWithLine(y[J],y[ne],t,u);Q.intersection&&Q.t>0-o&&Q.t<1+o&&(Q.t<1+o&&Q.t>1-o&&(k=N),F[N++]=at(Q.x,_)-at(S,_))}if(D>2){D--;const W=P[2];P[2]=P[B],P[B]=W}if(N>2){N--;const W=F[2];F[2]=F[k],F[k]=W}if(D!==2||N!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Number.isNaN(P[0])||Number.isNaN(P[1])||Number.isNaN(F[0])||Number.isNaN(F[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(P[0]>P[1]){const W=P[1];P[1]=P[0],P[0]=W}if(F[0]>F[1]){const W=F[1];F[1]=F[0],F[0]=W}let U,H;return P[1]<F[0]||F[1]<P[0]?{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f}:(P[0]<F[0]?P[1]<F[1]?(f[0]=2,f[1]=1,U=F[0],H=P[1]):(f[0]=2,f[1]=2,U=F[0],H=F[1]):P[1]<F[1]?(f[0]=1,f[1]=1,U=P[0],H=P[1]):(f[0]=1,f[1]=2,U=P[0],H=F[1]),Qd(S,_,U,c),Qd(S,_,H,l),{intersect:!0,coplanar:s,pt1:c,pt2:l,surfaceId:f})}const oM={computeNormalDirection:P2,computeNormal:$l,interpolationDerivs:N6,intersectWithTriangle:aM};function sM(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,i,a,o)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;const c=[],l=i*i,f=[],u=[],g=[];e.points.getPoint(0,f),e.points.getPoint(1,u),e.points.getPoint(2,g);const d=[],p=[];if($l(f,u,g,d),d[0]!==0||d[1]!==0||d[2]!==0){const T=tr.intersectWithLine(n,r,f,d);if(s.betweenPoints=T.betweenPoints,s.t=T.t,a[0]=T.x[0],a[1]=T.x[1],a[2]=T.x[2],!T.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;const C=t.evaluatePosition(a,c,o,p);if(C.evaluation>=0)return C.dist2<=l?(s.intersect=1,s):(s.intersect=C.evaluation,s)}const h=si(f,u),m=si(u,g),v=si(g,f);e.line||(e.line=Er.newInstance()),h>m&&h>v?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,u)):m>v&&m>h?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f));const y=e.line.intersectWithLine(n,r,i,a,o);if(s.betweenPoints=y.betweenPoints,s.t=y.t,y.intersect){const T=[],C=[],w=[];for(let S=0;S<3;S++)T[S]=f[S]-g[S],C[S]=u[S]-g[S],w[S]=a[S]-g[S];return o[0]=at(w,T)/v,o[1]=at(w,C)/m,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=(n,r,i,a)=>{const o={subId:0,dist2:0,evaluation:-1};let s,c;const l=[],f=[],u=[],g=[];let d;const p=[],h=[],m=[];let v=0,y=0;const T=[];let C,w,S,_=[];const D=[],N=[],P=[];o.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,f),e.points.getPoint(0,u),P2(l,f,u,g),tr.generalizedProjectPoint(n,l,g,P);let F=0;for(s=0;s<3;s++)g[s]<0?d=-g[s]:d=g[s],d>F&&(F=d,y=s);for(c=0,s=0;s<3;s++)s!==y&&(T[c++]=s);for(s=0;s<2;s++)p[s]=P[T[s]]-u[T[s]],h[s]=l[T[s]]-u[T[s]],m[s]=f[T[s]]-u[T[s]];if(v=hn(h,m),v===0)return i[0]=0,i[1]=0,o.evaluation=-1,o;if(i[0]=hn(p,m)/v,i[1]=hn(h,p)/v,a[0]=1-(i[0]+i[1]),a[1]=i[0],a[2]=i[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(o.dist2=si(P,n),r[0]=P[0],r[1]=P[1],r[2]=P[2]),o.evaluation=1;else{let B;if(r){if(a[1]<0&&a[2]<0)for(C=si(n,u),w=Er.distanceToLine(n,l,u,B,D),S=Er.distanceToLine(n,u,f,B,N),C<w?(o.dist2=C,_=u):(o.dist2=w,_=D),S<o.dist2&&(o.dist2=S,_=N),s=0;s<3;s++)r[s]=_[s];else if(a[2]<0&&a[0]<0)for(C=si(n,l),w=Er.distanceToLine(n,l,u,B,D),S=Er.distanceToLine(n,l,f,B,N),C<w?(o.dist2=C,_=l):(o.dist2=w,_=D),S<o.dist2&&(o.dist2=S,_=N),s=0;s<3;s++)r[s]=_[s];else if(a[1]<0&&a[0]<0)for(C=si(n,f),w=Er.distanceToLine(n,f,u,B,D),S=Er.distanceToLine(n,l,f,B,N),C<w?(o.dist2=C,_=f):(o.dist2=w,_=D),S<o.dist2&&(o.dist2=S,_=N),s=0;s<3;s++)r[s]=_[s];else if(a[0]<0){const k=Er.distanceToLine(n,l,f,r);o.dist2=k.distance}else if(a[1]<0){const k=Er.distanceToLine(n,f,u,r);o.dist2=k.distance}else if(a[2]<0){const k=Er.distanceToLine(n,l,u,r);o.dist2=k.distance}}o.evaluation=0}return o},t.evaluateLocation=(n,r,i)=>{const a=[],o=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,o),e.points.getPoint(2,s);const c=1-n[0]-n[1];for(let l=0;l<3;l++)r[l]=a[l]*c+o[l]*n[0]+s[l]*n[1];i[0]=c,i[1]=n[0],i[2]=n[1]},t.getParametricDistance=n=>{let r,i=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let o=0;o<3;o++)a[o]<0?r=-a[o]:a[o]>1?r=a[o]-1:r=0,r>i&&(i=r);return i},t.derivatives=(n,r,i,a,o)=>{const s=e.points.getPoint(0),c=e.points.getPoint(1),l=e.points.getPoint(2),f=[],u=[],g=[],d=[];$l(s,c,l,f),Kn(c,s,u),Kn(l,s,d),kr(f,u,g);const p=hi(u);if(p<=0||hi(g)<=0){for(let w=0;w<a;w++)for(let S=0;S<3;S++)o[w*a+S]=0;return}const h=[0,0],m=[p,0],v=[at(d,u),at(d,g)],y=new Array(6);N6(y);const T=[m[0]-h[0],m[1]-h[1],v[0]-h[0],v[1]-h[1]],C=A.newTypedArray(pr.Float64Array,4);i2(T,C,2);for(let w=0;w<a;w++){let S=0,_=0;for(let P=0;P<3;P++)S+=y[P]*i[a*P+w],_+=y[3+P]*i[a*P+w];const D=S*C[0]+_*C[1],N=S*C[2]+_*C[3];o[3*w]=D*u[0]+N*g[0],o[3*w+1]=D*u[1]+N*g[1],o[3*w+2]=D*u[2]+N*g[2]}},t.cellBoundary=(n,r,i)=>{const a=r[0]-r[1],o=.5*(1-r[0])-r[1],s=2*r[0]+r[1]-1;return a>=0&&o>=0?(i[0]=e.pointsIds[0],i[1]=e.pointsIds[1]):o<0&&s>=0?(i[0]=e.pointsIds[1],i[1]=e.pointsIds[2]):(i[0]=e.pointsIds[2],i[1]=e.pointsIds[0]),!(r[0]<0||r[1]<0||r[0]>1||r[1]>1||1-r[0]-r[1]<0)}}const cM={};function A6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cM,n),Sc.extend(t,e,n),sM(t,e)}const lM=A.newInstance(A6,"vtkTriangle");var N2={newInstance:lM,extend:A6,...oM};function em(){return{intersected:!1,subId:-1,x:[0,0,0],pCoords:[0,0,0],t:-1}}function uM(t,e){e.classHierarchy.push("vtkQuad"),t.getCellDimension=()=>2,t.getCellType=()=>Ft.VTK_QUAD,t.getNumberOfEdges=()=>4,t.getNumberOfFaces=()=>0,t.intersectWithLine=(n,r,i,a,o)=>{let s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1},c;const l=e.points.getPoint(0,[]),f=e.points.getPoint(1,[]),u=e.points.getPoint(2,[]),g=e.points.getPoint(3,[]),d=si(l,u),p=si(f,g);if(d===p){let S,_=0,D=0;for(let N=0;N<4;N++)S=e.pointsIds[N],S>_&&(_=S,D=N);D===0||D===2?c=0:c=1}else d<p?c=0:c=1;let h=null;e.triangle?h=e.triangle.getPoints():(e.triangle=N2.newInstance(),h=ag.newInstance(),h.setNumberOfPoints(3),e.triangle.initialize(h));let m;const v=em();let y;const T=em();let C,w;switch(c){case 0:h.setPoint(0,...l),h.setPoint(1,...f),h.setPoint(2,...u),m=e.triangle.intersectWithLine(n,r,i,v.x,v.pCoords),h.setPoint(0,...u),h.setPoint(1,...g),h.setPoint(2,...l),y=e.triangle.intersectWithLine(n,r,i,T.x,T.pCoords),C=m.intersect&&y.intersect?m.t<=y.t:m.intersect,w=m.intersect&&y.intersect?y.t<m.t:y.intersect,C?(s=m,a[0]=v.x[0],a[1]=v.x[1],a[2]=v.x[2],o[0]=v.pCoords[0]+v.pCoords[1],o[1]=v.pCoords[1],o[2]=v.pCoords[2]):w&&(s=y,a[0]=T.x[0],a[1]=T.x[1],a[2]=T.x[2],o[0]=1-(T.pCoords[0]+T.pCoords[1]),o[1]=1-T.pCoords[1],o[2]=T.pCoords[2]);break;case 1:h.setPoint(0,...l),h.setPoint(1,...f),h.setPoint(2,...g),m=e.triangle.intersectWithLine(n,r,i,v.x,v.pCoords),h.setPoint(0,...u),h.setPoint(1,...g),h.setPoint(2,...f),y=e.triangle.intersectWithLine(n,r,i,T.x,T.pCoords),C=m.intersect&&y.intersect?m.t<=y.t:m.intersect,w=m.intersect&&y.intersect?y.t<m.t:y.intersect,C?(s=m,a[0]=v.x[0],a[1]=v.x[1],a[2]=v.x[2],o[0]=v.pCoords[0],o[1]=v.pCoords[1],o[2]=v.pCoords[2]):w&&(s=y,a[0]=T.x[0],a[1]=T.x[1],a[2]=T.x[2],o[0]=1-T.pCoords[0],o[1]=1-T.pCoords[1],o[2]=T.pCoords[2]);break}return s},t.interpolationFunctions=(n,r)=>{const i=1-n[0],a=1-n[1];r[0]=i*a,r[1]=n[0]*a,r[2]=n[0]*n[1],r[3]=i*n[1]},t.evaluateLocation=(n,r,i)=>{const a=[];t.interpolationFunctions(n,i),r[0]=0,r[1]=0,r[2]=0;for(let o=0;o<4;o++){e.points.getPoint(o,a);for(let s=0;s<3;s++)r[s]+=a[s]*i[o]}}}const fM={};function F6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fM,n),Sc.extend(t,e,n),uM(t,e)}const gM=A.newInstance(F6,"vtkQuad");var dM={newInstance:gM,extend:F6};const{vtkErrorMacro:U6}=A;function tm(t){return()=>U6(`vtkTriangleStrip.${t} - NOT IMPLEMENTED`)}function hM(t,e){if(!Array.isArray(t)||t.length<3){U6("decomposeStrip - Invalid points array");return}let n=t[0],r=t[1];for(let i=0;i<t.length-2;i++){const a=t[i+2];i%2?e.insertNextCell([r,n,a]):e.insertNextCell([n,r,a]),n=r,r=a}}const pM={decomposeStrip:hM};function mM(t,e){e.classHierarchy.push("vtkTriangleStrip");const n=t.initialize;t.initialize=(r,i)=>{e.triangle.initialize(r,i),n(r,i)},t.getCellType=()=>Ft.VTK_TRIANGLE_STRIP,t.getCellDimension=()=>2,t.getNumberOfEdges=()=>e.pointsIds.length,t.getNumberOfFaces=()=>0,t.evaluatePosition=(r,i,a,o,s)=>{const c=[0,0,0];let l=Number.MAX_VALUE,f=0;const u=[],g=[],d=[];a[2]=0,g[0]=0,g[1]=0,g[2]=0;const p=e.triangle.getPoints();p.setNumberOfPoints(3);const m=e.triangle.getPointsIds().length;for(let v=0;v<m;v++)s[v]=0;for(let v=0;v<m-2;v++){const y=[];p.getPoint(v,y);const T=[];p.getPoint(v+1,T);const C=[];p.getPoint(v+2,C),p.setData(Float32Array.from([...y,...T,...C]),3);const w=e.triangle.evaluatePosition(r,d,c,u),S=w.dist2;w.evaluation>=0&&(S<l||S===l&&f===0)&&(f=w,i&&(i[0]=d[0],i[1]=d[1],i[2]=d[2]),a[0]=c[0],a[1]=c[1],l=S,g[0]=u[0],g[1]=u[1],g[2]=u[2])}return o[0]=l,s[0]=g[0],s[1]=g[1],s[2]=g[2],f},t.evaluateLocation=(r,i,a,o)=>{const s=[[0,1,2],[1,0,2]],c=r%2,l=e.pointsIds.length;for(let p=0;p<l;p++)o[p]=0;const f=1-i[0]-i[1];o[r]=f,o[r+1]=i[0],o[r+2]=i[1];const u=[];e.points.getPoint(r+s[c][0],u);const g=[];e.points.getPoint(r+s[c][1],g);const d=[];e.points.getPoint(r+s[c][2],d);for(let p=0;p<3;p++)a[p]=u[p]*o[r]+g[p]*o[r+1]+d[p]*o[r+2]},t.cellBoundary=(r,i,a)=>{const o=[[0,1,2],[1,0,2]],s=r%2,c=e.triangle.getPointsIds();return c[0]=e.pointsIds[o[s][0]],c[1]=e.pointsIds[o[s][1]],c[2]=e.pointsIds[o[s][2]],e.triangle.cellBoundary(0,i,a)},t.getEdge=r=>{let i,a;const o=e.pointsIds.length;return r===0?(i=0,a=1):r===o-1?(i=r-1,a=r):(i=r-1,a=r+1),e.line.getPointsIds()[0]=e.pointsIds[i],e.line.getPointsIds()[1]=e.pointsIds[a],e.line.getPoints().setPoint(0,e.points.getPoint(i)),e.line.getPoints().setPoint(1,e.points.getPoint(a)),e.line},t.intersectWithLine=(r,i,a,o,s)=>{const c=e.pointsIds.length-2,l=e.triangle.getPoints();l.setNumberOfPoints(3);for(let f=0;f<c;f++){const u=[];e.points.getPoint(e.pointsIds[f],u);const g=[];e.points.getPoint(e.pointsIds[f+1],g);const d=[];e.points.getPoint(e.pointsIds[f+2],d),l.setData(Float32Array.from([...u,...g,...d]),3);const p=e.triangle.intersectWithLine(r,i,a,o,s);if(p.intersect)return p}return!1},t.triangulate=()=>{const r=e.points.getNumberOfPoints()-2;e.tris=new Array(3*r);const i=[[0,1,2],[1,0,2]];for(let a=0;a<r;a++){const o=a%2;for(let s=0;s<3;s++)e.tris[a*3+s]=a+i[o][s]}return!0},t.getPointArray=()=>e.tris,t.derivatives=(r,i,a,o,s)=>{const c=[];e.points.getPoint(r,c);const l=[];e.points.getPoint(r+1,l);const f=[];e.points.getPoint(r+2,f);const u=e.triangle.getPoints();u.setPoint(0,...c),u.setPoint(1,...l),u.setPoint(2,...f),e.triangle.derivatives(0,i,a,o,s)},t.getParametricCenter=r=>(r[0]=.333333,r[1]=.333333,r[2]=0,Math.floor((e.pointsIds.length-2)/2)),t.contour=(r,i,a,o,s,c,l,f,u,g,d)=>tm("contour")(),t.clip=(r,i,a,o,s,c,l,f,u,g)=>tm("clip")()}const vM={line:null,triangle:null,tris:null};function k6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vM,n),Sc.extend(t,e,n),e.line||(e.line=Er.newInstance()),e.triangle||(e.triangle=N2.newInstance()),mM(t,e)}const yM=A.newInstance(k6,"vtkTriangleStrip");var TM={newInstance:yM,extend:k6,...pM};const Lc=["verts","lines","polys","strips"],{vtkWarningMacro:nm}=A,CM={[Ft.VTK_LINE]:Er,[Ft.VTK_QUAD]:dM,[Ft.VTK_POLY_LINE]:Er,[Ft.VTK_TRIANGLE]:N2,[Ft.VTK_TRIANGLE_STRIP]:TM,[Ft.VTK_POLY_LINE]:zD,[Ft.VTK_POLYGON]:iM};function wM(t,e){e.classHierarchy.push("vtkPolyData");function n(s){return s.replace(/(?:^\w|[A-Z]|\b\w)/g,c=>c.toUpperCase()).replace(/\s+/g,"")}function r(){e.cells=void 0,e.links=void 0}Lc.forEach(s=>{t[`getNumberOf${n(s)}`]=()=>e[s].getNumberOfCells(),e[s]?e[s]=$i(e[s]):e[s]=wc.newInstance(),e[`_on${n(s)}Changed`]=r}),t.getNumberOfCells=()=>Lc.reduce((s,c)=>s+e[c].getNumberOfCells(),0);const i=t.shallowCopy;t.shallowCopy=function(s){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;i(s,c),Lc.forEach(l=>{e[l]=wc.newInstance(),e[l].shallowCopy(s.getReferenceByName(l))})};const a=t.getMTime;t.getMTime=()=>Lc.reduce((s,c)=>Math.max(s,e[c]?.getMTime()??s),a());const o=t.initialize;t.initialize=()=>(Lc.forEach(s=>e[s]?.initialize()),r(),o()),t.buildCells=()=>{const s=t.getNumberOfVerts(),c=t.getNumberOfLines(),l=t.getNumberOfPolys(),f=t.getNumberOfStrips(),u=s+c+l+f,g=new Uint8Array(u);let d=g;const p=new Uint32Array(u);let h=p;if(s){let m=0;e.verts.getCellSizes().forEach((v,y)=>{h[y]=m,d[y]=v>1?Ft.VTK_POLY_VERTEX:Ft.VTK_VERTEX,m+=v+1}),h=h.subarray(s),d=d.subarray(s)}if(c){let m=0;e.lines.getCellSizes().forEach((v,y)=>{h[y]=m,d[y]=v>2?Ft.VTK_POLY_LINE:Ft.VTK_LINE,v===1&&nm("Building VTK_LINE ",y," with only one point, but VTK_LINE needs at least two points. Check the input."),m+=v+1}),h=h.subarray(c),d=d.subarray(c)}if(l){let m=0;e.polys.getCellSizes().forEach((v,y)=>{switch(h[y]=m,v){case 3:d[y]=Ft.VTK_TRIANGLE;break;case 4:d[y]=Ft.VTK_QUAD;break;default:d[y]=Ft.VTK_POLYGON;break}v<3&&nm("Building VTK_TRIANGLE ",y," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),m+=v+1}),h+=h.subarray(l),d+=d.subarray(l)}if(f){let m=0;d.fill(Ft.VTK_TRIANGLE_STRIP,0,f),e.strips.getCellSizes().forEach((v,y)=>{h[y]=m,m+=v+1})}e.cells=fD.newInstance(),e.cells.setCellTypes(u,g,p)},t.buildLinks=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells==null&&t.buildCells(),e.links=nD.newInstance(),s>0?e.links.allocate(s):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=s=>e.cells.getCellType(s),t.getCellPoints=s=>{const c=t.getCellType(s);let l=null;switch(c){case Ft.VTK_VERTEX:case Ft.VTK_POLY_VERTEX:l=e.verts;break;case Ft.VTK_LINE:case Ft.VTK_POLY_LINE:l=e.lines;break;case Ft.VTK_TRIANGLE:case Ft.VTK_QUAD:case Ft.VTK_POLYGON:l=e.polys;break;case Ft.VTK_TRIANGLE_STRIP:l=e.strips;break;default:return l=null,{type:0,cellPointIds:null}}const f=e.cells.getCellLocation(s),u=l.getCell(f);return{cellType:c,cellPointIds:u}},t.getPointCells=s=>e.links.getCells(s),t.getCellEdgeNeighbors=(s,c,l)=>{const f=e.links.getLink(c),u=e.links.getLink(l);return f.cells.filter(g=>g!==s&&u.cells.indexOf(g)!==-1)},t.getCell=function(s){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const l=t.getCellPoints(s),f=c||CM[l.cellType].newInstance();return f.initialize(t.getPoints(),l.cellPointIds),f},t.getMaxCellSize=()=>Lc.reduce((s,c)=>Math.max(s,e[c]?.getMaxCellSize?.()??0),0)}const SM={};function G6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SM,n),GD.extend(t,e,n),A.get(t,e,["cells","links"]),A.setGet(t,e,["verts","lines","polys","strips"]),wM(t,e)}const xM=A.newInstance(G6,"vtkPolyData");var uo={newInstance:xM,extend:G6};const{vtkErrorMacro:EM}=A;class OM{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const i=this.segmentMapping[n],a=this.segmentMapping[r];if(i!==void 0&&a!==void 0)if(Math.abs(i)===Math.abs(a)){const o=i<a?a:i,s=this.segments[o];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[o]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const o=Math.abs(i),s=Math.abs(a),c=this.segments[o],l=this.segments[s];this.segments[o]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const o=this.segments[i];for(let s=1;s<e.length;s++)o.push(e[s]);this.segmentMapping[r]=i}else{const o=this.segments[-i];this.segmentMapping[r]=i;for(let s=1;s<e.length;s++)o.unshift(e[s])}this.segmentMapping[n]=void 0}else if(a!==void 0){if(a>0){const o=this.segments[a];for(let s=1;s<e.length;s++)o.push(e[e.length-1-s]);this.segmentMapping[n]=a}else{const o=this.segments[-a];this.segmentMapping[n]=a;for(let s=1;s<e.length;s++)o.unshift(e[e.length-s-1])}this.segmentMapping[r]=void 0}else{const o=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-o,this.segmentMapping[r]=o}}}function RM(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const i=n[0];if(!i){EM("Invalid or missing input");return}const a=r[0]?.initialize()||uo.newInstance();a.shallowCopy(i);const o=new OM,s=i.getLines().getData();let c=0;for(;c<s.length;){const g=s[c++],d=[];for(let p=0;p<g;p++)d.push(s[c+p]);o.addSegment(d),c+=g}const{faces:l}=o;let f=l.length;for(let g=0;g<l.length;g++)f+=l[g].length;const u=new Uint16Array(f);c=0;for(let g=0;g<l.length;g++){const d=l[g];u[c++]=d.length;for(let p=0;p<d.length;p++)u[c++]=d[p]}a.setPolys(wc.newInstance({values:u,name:"faces"})),r[0]=a}}const DM={};function B6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DM,n),A.obj(t,e),A.algo(t,e,1,1),RM(t,e)}const MM=A.newInstance(B6,"vtkClosedPolyLineToSurfaceFilter");var _M={newInstance:MM,extend:B6};const{vtkErrorMacro:rm}=Dr;function IM(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const i=r.polyIdx+1,a=i+r.cellSize;r.polyIdx=a;let o=0;for(let s=i;s<a;++s)r.cell[o++]=e[s]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const i=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let o=0;for(let s=i;s<a;++s)r.cell[o++]=n[s]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function bM(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let i=n.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function r(i,a){const o=i.getPoints(),s=o.getData(),c=i.getPointData(),l=o.getNumberOfPoints(),f=[],u=[],g=[],d={},p=c.getNumberOfArrays();for(let _=0;_<p;_++)d[c.getArrayName(_)]=[];(!e.cutScalars||e.cutScalars.length<l)&&(e.cutScalars=new Float32Array(l));let h=0,m=0;for(;h<s.length;)e.cutScalars[m++]=e.cutFunction.evaluateFunction(s[h++],s[h++],s[h++]);const v=[],y=new Array(3),T=new Array(3),C=[];for(const _=IM(i);!_.done;_.next()){if(_.cellSize<=2)continue;for(let B=0;B<_.cellSize;)C[B]=e.cutScalars[_.cell[B++]];const D=C[0]>0;let N=!0;for(let B=1;B<_.cell.length;B++)if(C[B]>0!==D){N=!1;break}if(N)continue;const P=[];for(let B=0;B<_.cellSize;B++){const k=B+1===_.cellSize?0:B+1,U=C[B]>0;if(C[k]>0===U)continue;let W=B,J=k,ne=C[J]-C[W];ne<=0&&(W=k,J=B,ne*=-1);let q=0;ne!==0&&(q=(e.cutValue-C[W])/ne);const Q=_.cell[W],ae=_.cell[J];y[0]=s[Q*3],y[1]=s[Q*3+1],y[2]=s[Q*3+2],T[0]=s[ae*3],T[1]=s[ae*3+1],T[2]=s[ae*3+2];const me=[y[0]+q*(T[0]-y[0]),y[1]+q*(T[1]-y[1]),y[2]+q*(T[2]-y[2])],de={};for(let je=0;je<p;je++){const $e=c.getArrayByIndex(je),Be=c.getArrayName(je),qe=$e.getData(),Qe=$e.getNumberOfComponents(),ut=new Array(Qe);for(let ke=0;ke<Qe;ke++){const Xe=qe[Qe*Q+ke],et=qe[Qe*ae+ke];ut.push(Xe+q*(et-Xe))}de[Be]=ut}P.push({pointEdge1:Q,pointEdge2:ae,intersectedPoint:me,intersectedArrays:de,newPointID:-1})}for(let B=0;B<P.length;B++){const k=P[B];let U=!1;for(let H=0;H<v.length;H++){const W=v[H],J=k.pointEdge1===W.pointEdge1&&k.pointEdge2===W.pointEdge2,ne=k.intersectedPoint[0]===W.intersectedPoint[0]&&k.intersectedPoint[1]===W.intersectedPoint[1]&&k.intersectedPoint[2]===W.intersectedPoint[2];if(J||ne){U=!0,P[B].newPointID=v[H].newPointID;break}}U||(f.push(k.intersectedPoint[0]),f.push(k.intersectedPoint[1]),f.push(k.intersectedPoint[2]),Object.keys(k.intersectedArrays).forEach(H=>{d[H].push(...k.intersectedArrays[H])}),P[B].newPointID=f.length/3-1,v.push(P[B]))}const F=P.length;F===2?u.push(F,P[0].newPointID,P[1].newPointID):F>2&&(g.push(F),P.forEach(B=>{g.push(B.newPointID)}))}a.getPoints().setData(Ng(o.getDataType(),f),3);const S=a.getPointData();for(let _=0;_<p;_++){const D=c.getArrayName(_),N=ot.newInstance({name:D,dataType:c.getArrayByIndex(_).getDataType(),values:d[D],numberOfComponents:c.getArrayByIndex(_).getNumberOfComponents()});S.addArray(N)}u.length!==0&&a.getLines().setData(Uint16Array.from(u)),g.length!==0&&a.getPolys().setData(Uint16Array.from(g))}t.requestData=(i,a)=>{const o=i[0];if(!o){rm("Invalid or missing input");return}if(!e.cutFunction){rm("Missing cut function");return}const s=a[0]?.initialize()||uo.newInstance();r(o,s),a[0]=s}}const LM={cutFunction:null,cutScalars:null,cutValue:0};function $6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LM,n),an(t,e),qh(t,e,1,1),Gn(t,e,["cutFunction","cutValue"]),bM(t,e)}const VM=Yt($6,"vtkCutter");var PM={newInstance:VM,extend:$6};const fo={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var W6={ObjectType:fo};const{ObjectType:yf}=W6,NM={};function AM(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(s){switch(s){case yf.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case yf.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case yf.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,i=null,a=!0,o="";t.getType=()=>r,t.setType=s=>{r=s},t.getHandle=()=>i,t.isReady=()=>a===!1,t.generateBuffer=s=>{const c=n(s);return i===null&&(i=e.context.createBuffer(),r=s),n(r)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),i),e.context.bufferData(n(r),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,a=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(n(r),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>o}const FM={objectType:yf.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function z6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FM,n),A.obj(t,e),A.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),A.moveToProtected(t,e,["openGLRenderWindow"]),AM(t,e)}const UM=A.newInstance(z6);var so={newInstance:UM,extend:z6,...NM,...W6};const H6={FLAT:0,GOURAUD:1,PHONG:2},gi={POINTS:0,WIREFRAME:1,SURFACE:2},kM=H6;var j6={Shading:H6,Representation:gi,Interpolation:kM};function A2(t){let e=0,n=0;for(let i=0;i<3;++i){const a=t.getRange(i),o=a[1]-a[0];e+=o*o;const s=.5*(a[1]+a[0]);n+=s*s}const r=e>0&&(Math.abs(n)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&n>1e6);if(r){const i=new Float64Array(3),a=new Float64Array(3);for(let o=0;o<3;++o){const s=t.getRange(o),c=s[1]-s[0];i[o]=.5*(s[1]+s[0]),a[o]=c>0?1/c:1}return{useShiftAndScale:r,coordShift:i,coordScale:a}}return{useShiftAndScale:r,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}const{vtkErrorMacro:im}=A;function GM(t,e){const n=new Float64Array(3);Zf(n,e);const r=new Float64Array(16);return c8(r,ps(),t,n),r}function BM(t,e){return t===null||e===null?!1:!(G5(t,[0,0,0])&&G5(e,[1,1,1]))}function $M(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(fo.ARRAY_BUFFER),t.createVBO=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=a.points.getData();let c=null,l=null,f=null;const u=a.colors?a.colors.getNumberOfComponents():0,g=a.tcoords?a.tcoords.getNumberOfComponents():0;a.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=a.normals.getData()),a.customAttributes&&a.customAttributes.forEach(q=>{q&&(e.customData.push({data:q.getData(),offset:4*e.blockSize,components:q.getNumberOfComponents(),name:q.getName()}),e.blockSize+=q.getNumberOfComponents())}),a.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,l=a.tcoords.getData()),a.colors?(e.colorComponents=a.colors.getNumberOfComponents(),e.colorOffset=0,f=a.colors.getData(),e.colorBO||(e.colorBO=so.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let d=0,p=0,h=0,m=0,v=0,y=0,T;const C={anythingToPoints(q,Q,ae,me){for(let de=0;de<q;++de)T(Q[ae+de],me)},linesToWireframe(q,Q,ae,me){for(let de=0;de<q-1;++de)T(Q[ae+de],me),T(Q[ae+de+1],me)},polysToWireframe(q,Q,ae,me){if(q>2)for(let de=0;de<q;++de)T(Q[ae+de],me),T(Q[ae+(de+1)%q],me)},stripsToWireframe(q,Q,ae,me){if(q>2){for(let de=0;de<q-1;++de)T(Q[ae+de],me),T(Q[ae+de+1],me);for(let de=0;de<q-2;de++)T(Q[ae+de],me),T(Q[ae+de+2],me)}},polysToSurface(q,Q,ae,me){for(let de=0;de<q-2;de++)T(Q[ae+0],me),T(Q[ae+de+1],me),T(Q[ae+de+2],me)},stripsToSurface(q,Q,ae,me){for(let de=0;de<q-2;de++)T(Q[ae+de],me),T(Q[ae+de+1+de%2],me),T(Q[ae+de+1+(de+1)%2],me)}},w={anythingToPoints(q,Q){return q},linesToWireframe(q,Q){return q>1?(q-1)*2:0},polysToWireframe(q,Q){return q>2?q*2:0},stripsToWireframe(q,Q){return q>2?q*4-6:0},polysToSurface(q,Q){return q>2?(q-2)*3:0},stripsToSurface(q,Q,ae){return q>2?(q-2)*3:0}};let S=null,_=null;i===gi.POINTS||r==="verts"?(S=C.anythingToPoints,_=w.anythingToPoints):i===gi.WIREFRAME||r==="lines"?(S=C[`${r}ToWireframe`],_=w[`${r}ToWireframe`]):(S=C[`${r}ToSurface`],_=w[`${r}ToSurface`]);const D=n.getData(),N=D.length;let P=0;for(let q=0;q<N;)P+=_(D[q],D),q+=D[q]+1;let F=null;const B=new Float32Array(P*e.blockSize);f&&(F=new Uint8Array(P*4));let k=0,U=0;const{useShiftAndScale:H,coordShift:W,coordScale:J}=A2(a.points);if(H?t.setCoordShiftAndScale(W,J):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),o)if(!o.points&&!o.cells)o.points=new Int32Array(P),o.cells=new Int32Array(P);else{const q=new Int32Array(P+o.points.length);q.set(o.points),o.points=q;const Q=new Int32Array(P+o.cells.length);Q.set(o.cells),o.cells=Q}let ne=a.vertexOffset;T=function(Q,ae){if(o&&(o.points[ne]=Q,o.cells[ne]=y+a.cellOffset),++ne,d=Q*3,e.coordShiftAndScaleEnabled?(B[k++]=(s[d++]-e.coordShift[0])*e.coordScale[0],B[k++]=(s[d++]-e.coordShift[1])*e.coordScale[1],B[k++]=(s[d++]-e.coordShift[2])*e.coordScale[2]):(B[k++]=s[d++],B[k++]=s[d++],B[k++]=s[d++]),c!==null&&(a.haveCellNormals?p=(y+a.cellOffset)*3:p=Q*3,B[k++]=c[p++],B[k++]=c[p++],B[k++]=c[p++]),e.customData.forEach(me=>{v=Q*me.components;for(let de=0;de<me.components;++de)B[k++]=me.data[v++]}),l!==null){a.useTCoordsPerCell?h=ae*g:h=Q*g;for(let me=0;me<g;++me)B[k++]=l[h++]}f!==null&&(a.haveCellScalars?m=(y+a.cellOffset)*u:m=Q*u,F[U++]=f[m++],F[U++]=f[m++],F[U++]=f[m++],F[U++]=u===4?f[m++]:255)};for(let q=0;q<N;q+=D[q]+1,y++)S(D[q],D,q+1,y+a.cellOffset);return e.elementCount=P,t.upload(B,fo.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(F,fo.ARRAY_BUFFER)),y},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){im("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){im("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!B5(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!B5(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=BM(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=GM(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const WM={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function K6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WM,n),so.extend(t,e,n),A.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),A.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),$M(t,e)}const zM=A.newInstance(K6);var HM={newInstance:zM,extend:K6};const{vtkErrorMacro:jM}=A;function KM(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return jM(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const qM={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function q6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qM,n),A.obj(t,e),A.setGet(t,e,["shaderType","source","error","handle","context"]),KM(t,e)}const XM=A.newInstance(q6,"vtkShader");var X1={newInstance:XM,extend:q6};const{vtkErrorMacro:sa}=A;function YM(t,e,n,r){const i=typeof n=="string"?n:n.join(`
`),a=r===!1?e:new RegExp(e,"g"),o=t.replace(a,i);return{replace:o!==i,result:o}}function ZM(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(sa(e.error),0):t.link()?(t.setCompiled(!0),1):(sa(`Links failed: ${e.error}`),0):(sa(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),sa(e.fragmentShader.getError()),0):(sa(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),sa(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return sa(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix4fv(i,!1,a),!0},t.setUniformMatrix3x3=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix3fv(i,!1,a),!0},t.setUniformf=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(i,r),!0)},t.setUniformfv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(i,r),!0)},t.setUniformi=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(i,r),!0)},t.setUniformiv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(i,r),!0)},t.setUniform2f=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(a,r,i),!0},t.setUniform2fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(i,r),!0)},t.setUniform2i=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(a,r,i),!0},t.setUniform2iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(i,r),!0)},t.setUniform3f=(n,r,i,a)=>{const o=t.findUniform(n);if(o===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,r,i,a),!0},t.setUniform3fArray=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(i,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,s[0],s[1],s[2]),!0},t.setUniform3iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(i,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(i,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(i,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(sa("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return sa("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const JM={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function X6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JM,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=X1.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=X1.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=X1.newInstance(),e.geometryShader.setShaderType("Geometry"),A.obj(t,e),A.get(t,e,["lastCameraMTime"]),A.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),ZM(t,e)}const QM=A.newInstance(X6,"vtkShaderProgram");var ce={newInstance:QM,extend:X6,substitute:YM};function e_(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,1):n.vertexAttribDivisor(o.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,0):n.vertexAttribDivisor(o.index+c,0)),n.disableVertexAttribArray(o.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,i,a,o,s,c,l)=>t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,l,0,!1),t.addAttributeArrayWithDivisor=(n,r,i,a,o,s,c,l,f,u)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==fo.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const g=e.context,d={};if(d.name=i,d.index=g.getAttribLocation(e.handleProgram,i),d.offset=a,d.stride=o,d.type=s,d.size=c,d.normalize=l,d.isMatrix=u,d.divisor=f,d.Index===-1)return!1;if(r.bind(),g.enableVertexAttribArray(d.index),g.vertexAttribPointer(d.index,d.size,d.type,d.normalize,d.stride,d.offset),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(d.index,1):g.vertexAttribDivisor(d.index,1)),d.buffer=r.getHandle(),!e.supported){let p=!1;for(let h=0;h<e.buffers.length;++h){const m=e.buffers[h];if(m.buffer===d.buffer){p=!0;let v=!1;for(let y=0;y<m.attributes.length;++y)m.attributes[y].name===i&&(v=!0,m.attributes[y]=d);v||m.attributes.push(d)}}p||e.buffers.push({buffer:d.buffer,attributes:[d]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,i,a,o,s,c,l,f)=>{const u=t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,l,f,!0);if(!u)return u;const g=e.context,d=g.getAttribLocation(e.handleProgram,i);for(let p=1;p<c;p++)g.enableVertexAttribArray(d+p),g.vertexAttribPointer(d+p,c,s,l,o,a+o*p/c),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(d+p,1):g.vertexAttribDivisor(d+p,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];for(let a=0;a<i.attributes.length;++a)if(i.attributes[a].name===n)return i.attributes.splice(a,1),i.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const t_={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function Y6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,t_,n),e.buffers=[],A.obj(t,e),A.get(t,e,["supported"]),A.setGet(t,e,["forceEmulation"]),e_(t,e)}const n_=A.newInstance(Y6,"vtkOpenGLVertexArrayObject");var zg={newInstance:n_,extend:Y6};const fa={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function r_(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,i,a)=>{if(e.CABO.getElementCount()){const o=t.getOpenGLMode(i),s=t.haveWideLines(n,r),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),o===c.LINES&&s?(t.updateShaders(n,r,a),c.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,a),c.drawArrays(o,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(o===c.POINTS?1:0)||(o===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===gi.POINTS||r===fa.Points?e.context.POINTS:n===gi.WIREFRAME||r===fa.Lines||r===fa.TrisEdges||r===fa.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,i)=>!!(i.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(a,n,r);const o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,n,r),i.setPropertyShaderParameters(t,n,r),i.setCameraShaderParameters(t,n,r),i.setLightingShaderParameters(t,n,r),i.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,i)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const a=parseFloat(r.getProperty().getLineWidth()),o=a/2;t.getProgram().setUniformf("lineWidthStepSize",a/Math.ceil(a)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===fa.Points||r.getProperty().getRepresentation()===gi.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,i)=>{let a=n.Vertex;a=ce.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,a=ce.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,i)&&(a=ce.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,a=ce.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=a},t.getPointPickingPrimitiveSize=()=>e.primitiveType===fa.Points?2:e.primitiveType===fa.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const i_={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function Z6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,i_,n),A.obj(t,e),e.shaderSourceTime={},A.obj(e.shaderSourceTime),e.attributeUpdateTime={},A.obj(e.attributeUpdateTime),A.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=ce.newInstance(),e.VAO=zg.newInstance(),e.CABO=HM.newInstance(),r_(t,e)}const a_=A.newInstance(Z6);var To={newInstance:a_,extend:Z6,primTypes:fa};const o_=t=>t,am=1e-6;let J6=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=Ze(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?RE:o_}rotateFromDirections(e,n){const r=new Float64Array(3),i=new Float64Array(3),a=new Float64Array(16);Yr(r,e[0],e[1],e[2]),Yr(i,n[0],n[1],n[2]),Ht(r,r),Ht(i,i);const o=He(r,i);return o>=1?this:(zt(this.tmp,r,i),hs(this.tmp)<am&&(zt(this.tmp,[1,0,0],e),hs(this.tmp)<am&&zt(this.tmp,[0,1,0],e)),h2(a,Math.acos(o),this.tmp),rt(this.matrix,this.matrix,a),this)}rotate(e,n){return Yr(this.tmp,...n),Ht(this.tmp,this.tmp),Ui(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return f2(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return g2(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return d2(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return Yr(this.tmp,e,n,r),Mn(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return Yr(this.tmp,e,n,r),Sa(this.matrix,this.matrix,this.tmp),this}multiply(e){return rt(this.matrix,this.matrix,e),this}multiply3x3(e){return rt(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return In(this.matrix,this.matrix),this}identity(){return Ze(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(h0(Jh,this.matrix))return this;const i=r===-1?e.length:n+r*3;for(let a=n;a<i;a+=3)Yr(this.tmp,e[a],e[a+1],e[a+2]),At(this.tmp,this.tmp,this.matrix),e[a]=this.tmp[0],e[a+1]=this.tmp[1],e[a+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&mn(this.matrix,e),this}};function s_(){return new J6(!0)}function c_(){return new J6(!1)}var lc={buildFromDegree:s_,buildFromRadian:c_};const l_=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],u_=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function f_(t,e){e.classHierarchy.push("vtkCubeSource"),t.requestData=(n,r)=>{const i=r[0]?.initialize()||uo.newInstance();r[0]=i;const a=24,o=A.newTypedArray(e.pointType,a*3);i.getPoints().setData(o,3);const s=A.newTypedArray(e.pointType,a*3),c=ot.newInstance({name:"Normals",values:s,numberOfComponents:3});i.getPointData().setNormals(c);let l=2;e.generate3DTextureCoordinates===!0&&(l=3);const f=A.newTypedArray(e.pointType,a*l),u=ot.newInstance({name:"TextureCoordinates",values:f,numberOfComponents:l});i.getPointData().setTCoords(u);const g=[0,0,0],d=[0,0,0],p=[0,0];let h=0;g[0]=-e.xLength/2,d[0]=-1,d[1]=0,d[2]=0;for(let m=0;m<2;m++){g[1]=-e.yLength/2;for(let v=0;v<2;v++){p[1]=g[1]+.5,g[2]=-e.zLength/2;for(let y=0;y<2;y++)p[0]=(g[2]+.5)*(1-2*m),o[h*3]=g[0],o[h*3+1]=g[1],o[h*3+2]=g[2],s[h*3]=d[0],s[h*3+1]=d[1],s[h*3+2]=d[2],l===2?(f[h*l]=p[0],f[h*l+1]=p[1]):(f[h*l]=2*m-1,f[h*l+1]=2*v-1,f[h*l+2]=2*y-1),h++,g[2]+=e.zLength;g[1]+=e.yLength}g[0]+=e.xLength,d[0]+=2}g[1]=-e.yLength/2,d[1]=-1,d[0]=0,d[2]=0;for(let m=0;m<2;m++){g[0]=-e.xLength/2;for(let v=0;v<2;v++){p[0]=(g[0]+.5)*(2*m-1),g[2]=-e.zLength/2;for(let y=0;y<2;y++)p[1]=(g[2]+.5)*-1,o[h*3]=g[0],o[h*3+1]=g[1],o[h*3+2]=g[2],s[h*3]=d[0],s[h*3+1]=d[1],s[h*3+2]=d[2],l===2?(f[h*l]=p[0],f[h*l+1]=p[1]):(f[h*l]=2*v-1,f[h*l+1]=2*m-1,f[h*l+2]=2*y-1),h++,g[2]+=e.zLength;g[0]+=e.xLength}g[1]+=e.yLength,d[1]+=2}g[2]=-e.zLength/2,d[2]=-1,d[0]=0,d[1]=0;for(let m=0;m<2;m++){g[1]=-e.yLength/2;for(let v=0;v<2;v++){p[1]=g[1]+.5,g[0]=-e.xLength/2;for(let y=0;y<2;y++)p[0]=(g[0]+.5)*(2*m-1),o[h*3]=g[0],o[h*3+1]=g[1],o[h*3+2]=g[2],s[h*3]=d[0],s[h*3+1]=d[1],s[h*3+2]=d[2],l===2?(f[h*l]=p[0],f[h*l+1]=p[1]):(f[h*l]=2*y-1,f[h*l+1]=2*v-1,f[h*l+2]=2*m-1),h++,g[0]+=e.xLength;g[1]+=e.yLength}g[2]+=e.zLength,d[2]+=2}if(e.rotations&&lc.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(o).apply(s),e.center&&lc.buildFromRadian().translate(...e.center).apply(o),e.matrix){lc.buildFromRadian().setMatrix(e.matrix).apply(o);const m=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];lc.buildFromRadian().setMatrix(m).apply(s)}e.generateFaces?i.getPolys().deepCopy(e._polys):i.getPolys().initialize(),e.generateLines?(i.getLines().deepCopy(e._lineCells),i.getPointData().setNormals(null)):i.getLines().initialize(),i.modified()},t.setBounds=function(){let n=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))n=arguments.length<=0?void 0:arguments[0];else for(let r=0;r<arguments.length;r++)n.push(r<0||arguments.length<=r?void 0:arguments[r]);n.length===6&&(t.setXLength(n[1]-n[0]),t.setYLength(n[3]-n[2]),t.setZLength(n[5]-n[4]),t.setCenter([(n[0]+n[1])/2,(n[2]+n[3])/2,(n[4]+n[5])/2]))}}const g_={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function Q6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,g_,n),A.obj(t,e),A.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),A.setGetArray(t,e,["center","rotations"],3),A.setGetArray(t,e,["matrix"],16),e._polys=wc.newInstance({values:Uint16Array.from(u_)}),e._lineCells=wc.newInstance({values:Uint16Array.from(l_)}),A.moveToProtected(t,e,["polys","lineCells"]),A.algo(t,e,0,1),f_(t,e)}const d_=A.newInstance(Q6,"vtkCubeSource");var h_={newInstance:d_,extend:Q6};const{vtkErrorMacro:om}=A;function p_(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,i)=>{const a=r[0];if(!a||!a.isA("vtkImageData")){om("Invalid or missing input");return}const o=a.getSpatialExtent();if(!o){om("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(o),e._cubeSource.setMatrix(a.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const m_={};function e9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m_,n),A.obj(t,e),A.algo(t,e,1,1),e._cubeSource=h_.newInstance(),A.moveToProtected(t,e,["cubeSource","tmpOut"]),p_(t,e)}const v_=A.newInstance(e9,"vtkImageDataOutlineFilter");var y_={newInstance:v_,extend:e9};const Wl={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},ze={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var t9={Wrap:Wl,Filter:ze};const n9=new Float32Array(1),T_=new Int32Array(n9.buffer);function C_(t){n9[0]=t;const e=T_[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(i===255?0:1)&&e&8388607,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=r&1,n)}function w_(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var jc={fromHalf:w_,toHalf:C_};function S_(){try{const r=new Int16Array([0,32767]),i=[1,1],a=document.createElement("canvas");a.width=4,a.height=4;const o=a.getContext("webgl2");if(!o)return!1;const s=o.getExtension("EXT_texture_norm16");if(!s)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,l=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,f=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(f,c),o.compileShader(f),!o.getShaderParameter(f,o.COMPILE_STATUS))return!1;const u=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(u,l),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))return!1;const g=o.createProgram();if(o.attachShader(g,f),o.attachShader(g,u),o.linkProgram(g),!o.getProgramParameter(g,o.LINK_STATUS))return!1;const d=o.createTexture();o.bindTexture(o.TEXTURE_2D,d),o.texImage2D(o.TEXTURE_2D,0,s.R16_SNORM_EXT,2,1,0,o.RED,o.SHORT,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.useProgram(g),o.drawArrays(o.POINTS,0,1);const p=new Uint8Array(4);o.readPixels(i[0],i[1],1,1,o.RGBA,o.UNSIGNED_BYTE,p);const[h,m,v]=p,y=o.getExtension("WEBGL_lose_context");return y&&y.loseContext(),h===m&&m===v&&h!==0}catch{return!1}}let Y1;function x_(){return Y1===void 0&&(Y1=S_()),Y1}const{Wrap:eo,Filter:An}=t9,{VtkDataTypes:vt}=ot,{vtkDebugMacro:Z1,vtkErrorMacro:Ws,vtkWarningMacro:sm,requiredParam:wt}=Dr,{toHalf:E_}=jc;function O_(t,e){e.classHierarchy.push("vtkOpenGLTexture");function n(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(p?e._openGLRenderWindow=p:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(An.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(An.LINEAR),t.setMagnificationFilter(An.LINEAR)):(t.setMinificationFilter(An.NEAREST),t.setMagnificationFilter(An.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(eo.REPEAT),t.setWrapS(eo.REPEAT),t.setWrapT(eo.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImageBitmap()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(An.LINEAR_MIPMAP_LINEAR)),e.renderable.getImageBitmap()&&e.renderable.getImageLoaded()&&(t.create2DFromImageBitmap(e.renderable.getImageBitmap()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(An.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(An.LINEAR_MIPMAP_LINEAR));const m=e.renderable.getCanvas();t.create2DFromRaw({width:m.width,height:m.height,numComps:4,dataType:vt.UNSIGNED_CHAR,data:m,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const m=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(An.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw({width:m.width,height:m.height,numComps:4,dataType:vt.UNSIGNED_CHAR,data:m.data,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const h=e.renderable.getInputData(0);if(h&&h.getPointData().getScalars()){const m=h.getExtent(),v=h.getPointData().getScalars(),y=[];for(let T=0;T<e.renderable.getNumberOfInputPorts();++T){const C=e.renderable.getInputData(T),w=C?C.getPointData().getScalars().getData():null;w&&y.push(w)}e.renderable.getInterpolate()&&v.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(An.LINEAR_MIPMAP_LINEAR)),y.length%6===0?t.createCubeFromRaw({width:m[1]-m[0]+1,height:m[3]-m[2]+1,numComps:v.getNumberOfComponents(),dataType:v.getDataType(),data:y}):t.create2DFromRaw({width:m[1]-m[0]+1,height:m[3]-m[2]+1,numComps:v.getNumberOfComponents(),dataType:v.getDataType(),data:v.getData()}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const r=()=>{if(!((e.minificationFilter===An.LINEAR||e.magnificationFilter===An.LINEAR)&&!x_()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=p=>{p&&e.handle&&(p.activateTexture(t),p.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(p),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let p=!1;if(e.context&&e.handle){let h=0;switch(e.target){case e.context.TEXTURE_2D:h=e.context.TEXTURE_BINDING_2D;break;default:sm("impossible case");break}p=e.context.getIntegerv(h)===e.handle}return p},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(p,h)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(p,h)),e.internalFormat||Z1(`Unable to find suitable internal format for T=${p} NC= ${h}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&sm("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(p,h)=>{let m=0;return m=e._openGLRenderWindow.getDefaultTextureInternalFormat(p,h,r(),t.useHalfFloat()),m||(m||(Z1("Unsupported internal texture type!"),Z1(`Unable to find suitable internal format for T=${p} NC= ${h}`)),m)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=p=>{e._forceInternalFormat=!0,p!==e.internalFormat&&(e.internalFormat=p,t.modified())},t.getFormat=(p,h)=>(e.format=t.getDefaultFormat(p,h),e.format),t.getDefaultFormat=(p,h)=>{if(e._openGLRenderWindow.getWebgl2())switch(h){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(h){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=p=>{const h=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(p){case vt.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(r()&&!h&&vt.SHORT):return e.context.SHORT;case(r()&&!h&&vt.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(h&&vt.SHORT):return e.context.HALF_FLOAT;case(h&&vt.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case vt.FLOAT:case vt.VOID:default:return e.context.FLOAT}switch(p){case vt.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case vt.FLOAT:case vt.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const m=e.context.getExtension("OES_texture_half_float");if(m&&e.context.getExtension("OES_texture_half_float_linear"))return m.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(p){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||h)&&(e.openGLDataType=t.getDefaultDataType(p)),e.openGLDataType},t.getShiftAndScale=()=>{let p=0,h=1;switch(e.openGLDataType){case e.context.BYTE:h=127.5,p=h-128;break;case e.context.UNSIGNED_BYTE:h=255,p=0;break;case e.context.SHORT:h=32767.5,p=h-32768;break;case e.context.UNSIGNED_SHORT:h=65536,p=0;break;case e.context.INT:h=21474836475e-1,p=h-2147483648;break;case e.context.UNSIGNED_INT:h=4294967295,p=0;break;case e.context.FLOAT:}return{shift:p,scale:h}},t.getOpenGLFilterMode=p=>{switch(p){case An.NEAREST:return e.context.NEAREST;case An.LINEAR:return e.context.LINEAR;case An.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case An.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case An.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case An.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=p=>{switch(p){case eo.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case eo.REPEAT:return e.context.REPEAT;case eo.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function i(p){const[h,m,v,y,T,C]=p;return[m-h+1,y-v+1,C-T+1]}function a(p){const[h,m,v]=i(p);return h*m*v}function o(p,h,m,v,y){const[T,C,w,S,_,D]=m,[N,P]=h,F=N*P;let B=y;for(let k=_;k<=D;k++){const U=k*F;for(let H=w;H<=S;H++){const W=U+H*N;for(let J=W+T,ne=W+C;J<=ne;J++,B++)v[B]=p[J]}}}function s(p,h){const v=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||p.constructor,y=h.reduce((S,_)=>S+a(_),0),T=new v(y),C=[e.width,e.height,e.depth];let w=0;return h.forEach(S=>{o(p,C,S,T,w),w+=a(S)}),T}t.updateArrayDataTypeForGL=function(p,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];const y=[];let T=e.width*e.height*e.components;m&&(T*=e.depth);const C=!!v.length;if(p!==vt.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let S=0;S<h.length;S++)if(h[S])if(C)y.push(s(h[S],v,Float32Array));else{const _=h[S].length>T?h[S].subarray(0,T):h[S];y.push(new Float32Array(_))}else y.push(null);if(p!==vt.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let S=0;S<h.length;S++)if(h[S])if(C)y.push(s(h[S],v,Uint8Array));else{const _=h[S].length>T?h[S].subarray(0,T):h[S];y.push(new Uint8Array(_))}else y.push(null);let w=!1;if(e._openGLRenderWindow.getWebgl2())w=e.openGLDataType===e.context.HALF_FLOAT;else{const S=e.context.getExtension("OES_texture_half_float");w=S&&e.openGLDataType===S.HALF_FLOAT_OES}if(w)for(let S=0;S<h.length;S++)if(h[S]){const _=C?s(h[S],v):h[S],D=new Uint16Array(C?_.length:T),N=D.length;for(let P=0;P<N;P++)D[P]=E_(_[P]);y.push(D)}else y.push(null);if(y.length===0)for(let S=0;S<h.length;S++)y.push(C&&h[S]?s(h[S],v):h[S]);return y};function c(p){if(e._openGLRenderWindow.getWebgl2())return p;const h=[],m=e.width,v=e.height,y=e.components;if(p&&(!al(m)||!al(v))){const T=e.context.getExtension("OES_texture_half_float"),C=qo(m),w=qo(v),S=C*w*e.components;for(let _=0;_<p.length;_++)if(p[_]!==null){let D=null;const N=v/w,P=m/C;let F=!1;e.openGLDataType===e.context.FLOAT?D=new Float32Array(S):T&&e.openGLDataType===T.HALF_FLOAT_OES?(D=new Uint16Array(S),F=!0):D=new Uint8Array(S);for(let B=0;B<w;B++){const k=B*C*y,U=B*N;let H=Math.floor(U),W=Math.ceil(U);W>=v&&(W=v-1);const J=U-H,ne=1-J;H=H*m*y,W=W*m*y;for(let q=0;q<C;q++){const Q=q*y,ae=q*P;let me=Math.floor(ae),de=Math.ceil(ae);de>=m&&(de=m-1);const je=ae-me;me*=y,de*=y;for(let $e=0;$e<y;$e++)F?D[k+Q+$e]=jc.toHalf(jc.fromHalf(p[_][H+me+$e])*ne*(1-je)+jc.fromHalf(p[_][H+de+$e])*ne*je+jc.fromHalf(p[_][W+me+$e])*J*(1-je)+jc.fromHalf(p[_][W+de+$e])*J*je):D[k+Q+$e]=p[_][H+me+$e]*ne*(1-je)+p[_][H+de+$e]*ne*je+p[_][W+me+$e]*J*(1-je)+p[_][W+de+$e]*J*je}}h.push(D),e.width=C,e.height=w}else h.push(null)}if(h.length===0)for(let T=0;T<p.length;T++)h.push(p[T]);return h}function l(p){return e._openGLRenderWindow?e.resizable||e.renderable?.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&r()&&(p===vt.UNSIGNED_SHORT||p===vt.SHORT)):!1:!1}t.create2DFromRaw=function(){let{width:p=wt("width"),height:h=wt("height"),numComps:m=wt("numComps"),dataType:v=wt("dataType"),data:y=wt("data"),flip:T=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(v,!0),t.getInternalFormat(v,m),t.getFormat(v,m),!e.internalFormat||!e.format||!e.openGLDataType)return Ws("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=m,e.width=p,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const C=[y],w=t.updateArrayDataTypeForGL(v,C),S=c(w);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,T),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(v)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),S[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,S[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,S[0]),e.generateMipmap&&e.context.generateMipmap(e.target),T&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*m*e._openGLRenderWindow.getDefaultTextureByteSize(v,r(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=function(){let{width:p=wt("width"),height:h=wt("height"),numComps:m=wt("numComps"),dataType:v=wt("dataType"),data:y=wt("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(v),t.getInternalFormat(v,m),t.getFormat(v,m),!e.internalFormat||!e.format||!e.openGLDataType)return Ws("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=m,e.width=p,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=y.length/6-1,t.createTexture(),t.bind();const T=t.updateArrayDataTypeForGL(v,y),C=c(T),w=[];let S=e.width,_=e.height;for(let D=0;D<C.length;D++){D%6===0&&D!==0&&(S/=2,_/=2),w[D]=_0(v,_*S*e.components);for(let N=0;N<_;++N){const P=N*S*e.components,F=(_-N-1)*S*e.components;w[D].set(C[D].slice(F,F+S*e.components),P)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(v)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let D=0;D<6;D++){let N=0,P=e.width,F=e.height;for(;P>=1&&F>=1;){let B=null;N<=e.maxLevel&&(B=w[6*N+D]),l(v)?B!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+D,N,0,0,P,F,e.format,e.openGLDataType,B):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+D,N,e.internalFormat,P,F,0,e.format,e.openGLDataType,B),N++,P/=2,F/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*m*e._openGLRenderWindow.getDefaultTextureByteSize(v,r(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=function(){let{width:p=wt("width"),height:h=wt("height"),dataType:m=wt("dataType"),data:v=wt("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.getOpenGLDataType(m),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?m===vt.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Ws("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=p,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(m)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),v!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(m,r(),t.useHalfFloat()),t.deactivate(),!0)},t.create2DFromImage=p=>{if(t.getOpenGLDataType(vt.UNSIGNED_CHAR),t.getInternalFormat(vt.UNSIGNED_CHAR,4),t.getFormat(vt.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Ws("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const h=!e._openGLRenderWindow.getWebgl2()&&(!al(p.width)||!al(p.height));let m=p,v=p.width,y=p.height,T=!0;const C=window.chrome;if(h||C){const w=new OffscreenCanvas(qo(p.width),qo(p.height));v=w.width,y=w.height;const S=w.getContext("2d");S.translate(0,w.height),S.scale(1,-1),S.drawImage(p,0,0,p.width,p.height,0,0,w.width,w.height),m=w,T=!1}return e.width=v,e.height=y,e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,T),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(vt.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,m)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,m),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(vt.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0},t.create2DFromImageBitmap=p=>(t.getOpenGLDataType(vt.UNSIGNED_CHAR),t.getInternalFormat(vt.UNSIGNED_CHAR,4),t.getFormat(vt.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType?(Ws("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.width=p.width,e.height=p.height,l(vt.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,p)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,p),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(vt.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0));function f(p,h,m){const v=new Array(m),y=new Array(m);for(let T=0;T<m;++T)v[T]=p[T],y[T]=h[T]-p[T]||1;return{scale:y,offset:v}}function u(p,h){for(let m=0;m<p.length;m++){const v=p[m],y=h[m]+v;if(v<-2048||v>2048||y<-2048||y>2048)return!1}return!0}function g(p,h,m,v){t.getOpenGLDataType(p);const y=u(h,m)||v;let T=!1;if(e._openGLRenderWindow.getWebgl2())T=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&y||e.openGLDataType===e.context.HALF_FLOAT;else{const C=e.context.getExtension("OES_texture_half_float");T=C&&e.openGLDataType===C.HALF_FLOAT_OES}e.canUseHalfFloat=T&&y}function d(p,h){const m=p.getNumberOfComponents(),v=p.getDataType(),y=p.getData(),T=new Array(m),C=new Array(m);for(let S=0;S<m;++S){const[_,D]=p.getRange(S);T[S]=_,C[S]=D}const w=f(T,C,m);return g(v,w.offset,w.scale,h),t.useHalfFloat()||t.getOpenGLDataType(v,!0),{numComps:m,dataType:v,data:y,scaleOffsets:w}}t.create2DFilterableFromRaw=function(){let{width:p=wt("width"),height:h=wt("height"),numComps:m=wt("numComps"),dataType:v=wt("dataType"),data:y=wt("data"),preferSizeOverAccuracy:T=!1,ranges:C=void 0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create2DFilterableFromDataArray({width:p,height:h,dataArray:ot.newInstance({numberOfComponents:m,dataType:v,values:y,ranges:C}),preferSizeOverAccuracy:T})},t.create2DFilterableFromDataArray=function(){let{width:p=wt("width"),height:h=wt("height"),dataArray:m=wt("dataArray"),preferSizeOverAccuracy:v=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:y,dataType:T,data:C}=d(m,v);t.create2DFromRaw({width:p,height:h,numComps:y,dataType:T,data:C})},t.updateVolumeInfoForGL=(p,h)=>{let m=!1;const v=t.useHalfFloat();(!e.volumeInfo?.scale||!e.volumeInfo?.offset)&&(e.volumeInfo={scale:new Array(h),offset:new Array(h)});for(let y=0;y<h;++y)e.volumeInfo.scale[y]=1,e.volumeInfo.offset[y]=0;if(r()&&!v&&p===vt.SHORT){for(let y=0;y<h;++y)e.volumeInfo.scale[y]=32767;m=!0}if(r()&&!v&&p===vt.UNSIGNED_SHORT){for(let y=0;y<h;++y)e.volumeInfo.scale[y]=65535;m=!0}if(p===vt.UNSIGNED_CHAR){for(let y=0;y<h;++y)e.volumeInfo.scale[y]=255;m=!0}return(p===vt.FLOAT||v&&(p===vt.SHORT||p===vt.UNSIGNED_SHORT))&&(m=!0),m},t.create3DFromRaw=function(){let{width:p=wt("width"),height:h=wt("height"),depth:m=wt("depth"),numComps:v=wt("numComps"),dataType:y=wt("dataType"),data:T=wt("data"),updatedExtents:C=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},w=y,S=T;if(!t.updateVolumeInfoForGL(w,v)&&S){const k=p*h*m,U=structuredClone(e.volumeInfo),H=new Float32Array(k*v);e.volumeInfo.offset=U.offset,e.volumeInfo.scale=U.scale;let W=0;const J=U.scale.map(ne=>1/ne);for(let ne=0;ne<k;ne++)for(let q=0;q<v;q++)H[W]=(S[W]-U.offset[q])*J[q],W++;w=vt.FLOAT,S=H}if(t.getOpenGLDataType(w),t.getInternalFormat(w,v),t.getFormat(w,v),!e.internalFormat||!e.format||!e.openGLDataType)return Ws("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=v,e.width=p,e.height=h,e.depth=m,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const _=C.length>0,D=!_||!zh(e._prevTexParams,n()),N=[S],F=t.updateArrayDataTypeForGL(w,N,!0,D?[]:C),B=c(F);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),D)l(w)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),B[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,B[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,B[0]),e._prevTexParams=n();else if(_){const k=B[0];let U=0;for(let H=0;H<C.length;H++){const W=C[H],J=i(W),ne=a(W),q=new k.constructor(k.buffer,U,ne);U+=q.byteLength,e.context.texSubImage3D(e.target,0,W[0],W[2],W[4],J[0],J[1],J[2],e.format,e.openGLDataType,q)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(w,r(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(){let{width:p=wt("width"),height:h=wt("height"),depth:m=wt("depth"),numComps:v=wt("numComps"),dataType:y=wt("dataType"),data:T=wt("data"),preferSizeOverAccuracy:C=!1,ranges:w=void 0,updatedExtents:S=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create3DFilterableFromDataArray({width:p,height:h,depth:m,dataArray:ot.newInstance({numberOfComponents:v,dataType:y,values:T,ranges:w}),preferSizeOverAccuracy:C,updatedExtents:S})},t.create3DFilterableFromDataArray=function(){let{width:p=wt("width"),height:h=wt("height"),depth:m=wt("depth"),dataArray:v=wt("dataArray"),preferSizeOverAccuracy:y=!1,updatedExtents:T=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:C,dataType:w,data:S,scaleOffsets:_}=d(v,y),D=[],N=[];for(let Be=0;Be<C;++Be)D[Be]=0,N[Be]=1;if(e.volumeInfo={scale:N,offset:D,dataComputedScale:_.scale,dataComputedOffset:_.offset,width:p,height:h,depth:m},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw({width:p,height:h,depth:m,numComps:C,dataType:w,data:S,updatedExtents:T});const P=p*h*m,F=structuredClone(_);let B=(Be,qe,Qe,ut,ke)=>{Be[qe]=Qe},k=vt.UNSIGNED_CHAR;if(w===vt.UNSIGNED_CHAR)for(let Be=0;Be<C;++Be)F.offset[Be]=0,F.scale[Be]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(k=vt.FLOAT,B=(Be,qe,Qe,ut,ke)=>{Be[qe]=(Qe-ut)/ke}):(k=vt.UNSIGNED_CHAR,B=(Be,qe,Qe,ut,ke)=>{Be[qe]=255*(Qe-ut)/ke});if(t.getOpenGLDataType(k),t.getInternalFormat(k,C),t.getFormat(k,C),!e.internalFormat||!e.format||!e.openGLDataType)return Ws("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=C,e.depth=1,e.numberOfDimensions=2;let U=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);U>4096&&(k===vt.FLOAT||C>=3)&&(U=4096);let H=1,W=1;P>U*U&&(H=Math.ceil(Math.sqrt(P/(U*U))),W=H);let J=Math.sqrt(P)/H;J=qo(J);const ne=Math.floor(J*H/p),q=Math.ceil(m/ne),Q=qo(h*q/W);e.width=J,e.height=Q,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=ne,e.volumeInfo.yreps=q,e.volumeInfo.xstride=H,e.volumeInfo.ystride=W,e.volumeInfo.offset=F.offset,e.volumeInfo.scale=F.scale;let ae;const me=J*Q*C;k===vt.FLOAT?ae=new Float32Array(me):ae=new Uint8Array(me);let de=0;const je=Math.floor(p/H),$e=Math.floor(h/W);for(let Be=0;Be<q;Be++){const qe=Math.min(ne,m-Be*ne),Qe=C*(e.width-qe*Math.floor(p/H));for(let ut=0;ut<$e;ut++){for(let ke=0;ke<qe;ke++){const Xe=C*((Be*ne+ke)*p*h+W*ut*p);for(let et=0;et<je;et++)for(let $t=0;$t<C;$t++)B(ae,de,S[Xe+H*et*C+$t],F.offset[$t],F.scale[$t]),de++}de+=Qe}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(k)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),ae!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,ae)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,ae),t.deactivate(),!0},t.setOpenGLRenderWindow=p=>{e._openGLRenderWindow!==p&&(t.releaseGraphicsResources(),e._openGLRenderWindow=p,e.context=null,p&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=p=>p&&p.isCurrent()?p.getIntegerv(p.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=p=>{e.enableUseHalfFloat=p}}const R_={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:eo.CLAMP_TO_EDGE,wrapT:eo.CLAMP_TO_EDGE,wrapR:eo.CLAMP_TO_EDGE,minificationFilter:An.NEAREST,magnificationFilter:An.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function r9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R_,n),bn.extend(t,e,n),e.sendParametersTime={},an(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},an(e.textureBuildTime,{mtime:0}),Ql(t,e,["format","openGLDataType"]),Gn(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),$r(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),eu(t,e,["openGLRenderWindow"]),O_(t,e)}const i9=Yt(r9,"vtkOpenGLTexture");var Xt={newInstance:i9,extend:r9,...t9};rr("vtkTexture",i9);function D_(t,e){t.replaceShaderCoincidentOffset=(n,r,i)=>{const a=t.getCoincidentParameters(r,i);if(a&&(a.factor!==0||a.offset!==0)){let o=n.Fragment;o=ce.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(a.factor!==0?(o=ce.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=ce.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=ce.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(a.factor!==0?(o=ce.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=ce.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=ce.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=o}}}function M_(t,e){t.applyShaderReplacements=(n,r,i)=>{let a=null;if(r&&(a=r.ShaderReplacements),a)for(let o=0;o<a.length;o++){const s=a[o];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,l=n[c],f=ce.substitute(l,s.originalValue,s.replacementValue,s.replaceAll);n[c]=f.result}}},t.buildShaders=(n,r,i)=>{t.getReplacedShaderTemplate(n,r,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const a=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,a,!0),t.replaceShaderValues(n,r,i),t.applyShaderReplacements(n,a)},t.getReplacedShaderTemplate=(n,r,i)=>{const a=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,i);let o=n.Vertex;if(a){const l=a.VertexShaderCode;l!==void 0&&l!==""&&(o=l)}n.Vertex=o;let s=n.Fragment;if(a){const l=a.FragmentShaderCode;l!==void 0&&l!==""&&(s=l)}n.Fragment=s;let c=n.Geometry;if(a){const l=a.GeometryShaderCode;l!==void 0&&(c=l)}n.Geometry=c}}var ms={implementReplaceShaderCoincidentOffset:D_,implementBuildShadersWithReplacements:M_};const{vtkWarningMacro:__}=A;let F2;function I_(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(At(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const i=new Float64Array(3),a=new Float64Array(3);for(let o=0;o<n.length;o+=3)i[0]=n[o],i[1]=n[o+1],i[2]=n[o+2],At(a,i,e.matrix),r[o]=a[0],r[o+1]=a[1],r[o+2]=a[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?rt(r,e.matrix,n):rt(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const i=new Float64Array(16),a=new Float64Array(16),o=e.preMultiplyFlag?()=>rt(a,e.matrix,i):()=>rt(a,i,e.matrix);for(let s=0;s<n.length;s+=16){for(let c=0;c<16;++c)i[c]=n[s+c];o();for(let c=0;c<16;++c)r[s+c]=a[c]}return r},t.getInverse=()=>F2({matrix:Tn.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag}),t.translate=(n,r,i)=>{if(n===0&&r===0&&i===0)return;const a=pi();b0(a,[n,r,i]),e.preMultiplyFlag?rt(e.matrix,e.matrix,a):rt(e.matrix,a,e.matrix),t.modified()},t.rotateWXYZ=(n,r,i,a)=>{if(r===0&&i===0&&a===0){__("No rotation applied, axis is zero vector.");return}if(n===0)return;const o=Tn.radiansFromDegrees(n),s=ps();kg(s,[r,i,a],o);const c=new Float64Array(16);r0(c,s),e.preMultiplyFlag?rt(e.matrix,e.matrix,c):rt(e.matrix,c,e.matrix),t.modified()},t.rotateX=n=>{t.rotateWXYZ(n,1,0,0)},t.rotateY=n=>{t.rotateWXYZ(n,0,1,0)},t.rotateZ=n=>{t.rotateWXYZ(n,0,0,1)},t.scale=(n,r,i)=>{if(n===1&&r===1&&i===1)return;const a=pi();Ug(a,[n,r,i]),e.preMultiplyFlag?rt(e.matrix,e.matrix,a):rt(e.matrix,a,e.matrix),t.modified()},t.transformNormal=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=uc(ua(),e.matrix),a=ua();ds(a,i);const o=ua();return Gl(o,a),t.transformVector(n,r,o),Tn.normalize(r),r},t.transformNormals=(n,r)=>{const i=n.getData(),a=r.getData(),o=[0,0,0],s=uc(ua(),e.matrix),c=ua();ds(c,s);const l=ua();Gl(l,c);for(let f=0;f<i.length;f+=3)o[0]=i[f],o[1]=i[f+1],o[2]=i[f+2],t.transformVector(o,o,l),Tn.normalize(o),a[f]=o[0],a[f+1]=o[1],a[f+2]=o[2]},t.transformVector=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||uc(ua(),e.matrix);return Jf(r,n,a),r},t.transformVectors=(n,r)=>{const i=n.getData(),a=r.getData(),o=[0,0,0];for(let s=0;s<i.length;s+=3)o[0]=i[s],o[1]=i[s+1],o[2]=i[s+2],t.transformVector(o,o),Tn.normalize(o),a[s]=o[0],a[s+1]=o[1],a[s+2]=o[2]},t.transformPointsNormalsVectors=function(n,r,i,a,o,s){let c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;const f=n.getNumberOfPoints(),u=c?.length??0,g=new Float64Array(3),d=new Float64Array(3),p=new Float64Array(3),h=new Float64Array(3);let m=!1,v=!1,y=!1;const T=[];for(let C=0;C<f;C++){if(n.getPoint(C,g),d.set(g),t.transformPoint(g,g),r.setPoint(C,...g),Tn.areEquals(d,g)||(m=!0),o){const w=o.getData(),S=s.getData();g[0]=w[C*3],g[1]=w[C*3+1],g[2]=w[C*3+2],p.set(g),t.transformVector(g,g),S[C*3]=g[0],S[C*3+1]=g[1],S[C*3+2]=g[2],Tn.areEquals(p,g)||(v=!0)}if(i){const w=i.getData(),S=a.getData();g[0]=w[C*3],g[1]=w[C*3+1],g[2]=w[C*3+2],h.set(g),t.transformNormal(g,g),S[C*3]=g[0],S[C*3+1]=g[1],S[C*3+2]=g[2],Tn.areEquals(h,g)||(y=!0)}if(c)for(let w=0;w<u;w++){const S=c[w].getData(),_=l[w].getData();g[0]=S[C*3],g[1]=S[C*3+1],g[2]=S[C*3+2],p.set(g),t.transformVector(g,g),_[C*3]=g[0],_[C*3+1]=g[1],_[C*3+2]=g[2],!Tn.arrayEqual(p,g)&&!T.includes(w)&&T.push(w)}}m&&r.modified(),v&&s.modified(),y&&a.modified(),T.forEach(C=>l[C].modified())}}const b_={preMultiplyFlag:!1,matrix:[...Jh]};function a9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,b_,n),A.obj(t,e),A.setGet(t,e,["preMultiplyFlag"]),A.setGetArray(t,e,["matrix"],16),I_(t,e)}F2=A.newInstance(a9,"vtkTransform");var L_={newInstance:F2,extend:a9};function xa(t,e,n){return t.length>0?`${t.map(r=>r?.getMTime()??"x").join("/")}-${e}-${n}`:"0"}function U2(t,e){return`${e.getMTime()}`}var V_=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,P_=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const ss={NEAREST:0,LINEAR:1};var N_={InterpolationType:ss};const Ki={Off:0,PolygonOffset:1};let dh=Ki.PolygonOffset,og=Ki.Off;const A_=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function F_(){return dh}function U_(t){const e=dh===t;return dh=t,e}function k_(){return og}function Hg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=og===t;return og=t,e}function G_(){return Hg(Ki.Off)}function B_(){return Hg(Ki.Off)}function $_(){return Hg(Ki.PolygonOffset)}function W_(){return A_[og]}var hh={Resolve:Ki,getResolveCoincidentTopologyAsString:W_,getResolveCoincidentTopologyPolygonOffsetFaces:F_,getResolveCoincidentTopology:k_,setResolveCoincidentTopology:Hg,setResolveCoincidentTopologyPolygonOffsetFaces:U_,setResolveCoincidentTopologyToDefault:G_,setResolveCoincidentTopologyToOff:B_,setResolveCoincidentTopologyToPolygonOffset:$_};function o9(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=A.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const k2=["Polygon","Line","Point"],z_={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},H_=()=>{},oc={modified:H_};o9(oc,z_,k2.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function j_(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),A.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(hh).forEach(n=>{t[n]=hh[n]}),Object.keys(oc).filter(n=>n!=="modified").forEach(n=>{t[n]=oc[n]}),o9(t,e.topologyOffset,k2.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=oc.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=oc.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=oc.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var jg={implementCoincidentTopologyMethods:j_,staticOffsetAPI:oc,otherStaticMethods:hh,CATEGORIES:k2,Resolve:Ki};const{vtkErrorMacro:zs}=Dr;function cm(t,e,n){return e.identity(n),t.reduce((r,i,a)=>a===0?i?e.copy(r,i):e.identity(r):i?e.multiply(r,r,i):r,n)}function K_(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");const n=new Map;function r(c,l){if(!l)return;const u=(n.get(l)??0)-1;u<=0?(c.unregisterGraphicsResourceUser(l,t),n.delete(l)):n.set(l,u)}function i(c,l){if(!l)return;const f=n.get(l)??0,u=f+1;n.set(l,u),f<=0&&c.registerGraphicsResourceUser(l,t)}function a(c,l,f){l!==f&&(r(c,l),i(c,f))}function o(c){[...n.keys()].forEach(l=>c.unregisterGraphicsResourceUser(l,t))}t.buildPass=c=>{if(c){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const l=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(l.getActiveCamera());const f=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),f&&!f.isDeleted()&&f!==e._openGLRenderWindow&&o(f),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(c,l)=>{c&&(e.currentRenderPass=l,t.render())},t.zBufferPass=c=>{c&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=c=>t.zBufferPass(c),t.opaquePass=c=>{c&&t.render()},t.getCoincidentParameters=(c,l)=>e.renderable.getResolveCoincidentTopology()==Ki.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const c=e._openGLImageSlice.getRenderable(),l=e._openGLRenderer.getRenderable();t.renderPiece(l,c)},t.renderPiece=(c,l)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const f=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let p=0;p<f;++p){const h=e.renderable.getInputData(p);h&&!h.isDeleted()&&e.currentValidInputs.push({imageData:h,inputIndex:p})}const u=e.currentValidInputs.length;if(u<=0){zs("No input!");return}const d=e.currentValidInputs[0].imageData.getPointData().getScalars();e.multiTexturePerVolumeEnabled=u>1,e.numberOfComponents=e.multiTexturePerVolumeEnabled?u:d.getNumberOfComponents(),t.updateResliceGeometry(),t.renderPieceStart(c,l),t.renderPieceDraw(c,l),t.renderPieceFinish(c,l),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(c,l)=>{t.updateBufferObjects(c,l);const f=l.getProperties();e.currentValidInputs.forEach(p=>{let{inputIndex:h}=p;const v=f[h].getInterpolationType(),y=e.scalarTextures[h];v===ss.NEAREST?(y.setMinificationFilter(ze.NEAREST),y.setMagnificationFilter(ze.NEAREST)):(y.setMinificationFilter(ze.LINEAR),y.setMagnificationFilter(ze.LINEAR))});const u=e.currentValidInputs[0];f[u.inputIndex].getInterpolationType()===ss.NEAREST?(e.colorTexture.setMinificationFilter(ze.NEAREST),e.colorTexture.setMagnificationFilter(ze.NEAREST),e.pwfTexture.setMinificationFilter(ze.NEAREST),e.pwfTexture.setMagnificationFilter(ze.NEAREST)):(e.colorTexture.setMinificationFilter(ze.LINEAR),e.colorTexture.setMagnificationFilter(ze.LINEAR),e.pwfTexture.setMinificationFilter(ze.LINEAR),e.pwfTexture.setMagnificationFilter(ze.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(c,l)=>{const f=e.context,u=[...e.scalarTextures,e.colorTexture,e.pwfTexture];u.forEach(g=>g.activate()),t.updateShaders(e.tris,c,l),f.drawArrays(f.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),u.forEach(g=>g.deactivate())},t.renderPieceFinish=(c,l)=>{},t.updateBufferObjects=(c,l)=>{t.getNeedToRebuildBufferObjects(c,l)&&t.buildBufferObjects(c,l)},t.getNeedToRebuildBufferObjects=(c,l)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<l.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<l.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.currentValidInputs.some(f=>{let{imageData:u}=f;return e.VBOBuildTime.getMTime()<u.getMTime()})||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(f=>!!f?.getHandle())||!e.colorTexture?.getHandle()||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(c,l)=>{const f=l.getProperties();e.currentValidInputs.forEach((F,B)=>{let{imageData:k}=F;const U=k.getPointData().getScalars(),H=e._openGLRenderWindow.getGraphicsResourceForObject(U),W=U2(k,U),J=!H?.oglObject?.getHandle()||H?.hash!==W,ne=f[B],q=ne.getUpdatedExtents(),Q=!!q.length;if(J&&!Q){const ae=Xt.newInstance();ae.setOpenGLRenderWindow(e._openGLRenderWindow);const me=k.getDimensions();ae.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),ae.resetFormatAndType(),ae.create3DFilterableFromDataArray({width:me[0],height:me[1],depth:me[2],dataArray:U}),e._openGLRenderWindow.setGraphicsResourceForObject(U,ae,W),e.scalarTextures[B]=ae}else e.scalarTextures[B]=H.oglObject;if(Q){ne.setUpdatedExtents([]);const ae=k.getDimensions();e.scalarTextures[B].create3DFilterableFromDataArray({width:ae[0],height:ae[1],depth:ae[2],dataArray:U,updatedExtents:q})}a(e._openGLRenderWindow,e._scalarTexturesCore[B],U),e._scalarTexturesCore[B]=U});const u=e.currentValidInputs[0],g=f[u.inputIndex],d=g.getIndependentComponents(),p=d?e.numberOfComponents:1,h=d?2*p:1,m=[];for(let F=0;F<p;++F)m.push(g.getRGBTransferFunction(F));const v=xa(m,d,p),y=g.getRGBTransferFunction(),T=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!T?.oglObject?.getHandle()||T?.hash!==v){let F=e.renderable.getColorTextureWidth();F<=0&&(F=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const B=F*h*3,k=new Uint8ClampedArray(B),U=Xt.newInstance();if(U.setOpenGLRenderWindow(e._openGLRenderWindow),y){const H=new Float32Array(F*3);for(let W=0;W<p;W++){const J=g.getRGBTransferFunction(W),ne=J.getRange();if(J.getTable(ne[0],ne[1],F,H,1),d)for(let q=0;q<F*3;q++)k[W*F*6+q]=255*H[q],k[W*F*6+q+F*3]=255*H[q];else for(let q=0;q<F*3;q++)k[W*F*3+q]=255*H[q]}U.resetFormatAndType(),U.create2DFromRaw({width:F,height:h,numComps:3,dataType:dt.UNSIGNED_CHAR,data:k})}else{for(let H=0;H<F*3;++H){const W=255*H/((F-1)*3);for(let J=0;J<h;++J)k[J*F*3+H+0]=W,k[J*F*3+H+1]=W,k[J*F*3+H+2]=W}U.resetFormatAndType(),U.create2DFromRaw({width:F,height:1,numComps:3,dataType:dt.UNSIGNED_CHAR,data:k})}y&&e._openGLRenderWindow.setGraphicsResourceForObject(y,U,v),e.colorTexture=U}else e.colorTexture=T.oglObject;a(e._openGLRenderWindow,e._colorTextureCore,y),e._colorTextureCore=y;const w=[];for(let F=0;F<p;++F)w.push(g.getPiecewiseFunction(F));const S=xa(w,d,p),_=g.getPiecewiseFunction(),D=e._openGLRenderWindow.getGraphicsResourceForObject(_);if(!D?.oglObject?.getHandle()||D?.hash!==S){let F=e.renderable.getOpacityTextureWidth();F<=0&&(F=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const B=F*h,k=new Uint8ClampedArray(B),U=Xt.newInstance();if(U.setOpenGLRenderWindow(e._openGLRenderWindow),_){const H=new Float32Array(B),W=new Float32Array(F);for(let J=0;J<p;++J){const ne=g.getPiecewiseFunction(J);if(ne===null)H.fill(1);else{const q=ne.getRange();if(ne.getTable(q[0],q[1],F,W,1),d)for(let Q=0;Q<F;Q++)H[J*F*2+Q]=W[Q],H[J*F*2+Q+F]=W[Q];else for(let Q=0;Q<F;Q++)H[Q]=W[Q]}}U.resetFormatAndType(),U.create2DFromRaw({width:F,height:h,numComps:1,dataType:dt.FLOAT,data:H})}else k.fill(255),U.resetFormatAndType(),U.create2DFromRaw({width:F,height:h,numComps:1,dataType:dt.UNSIGNED_CHAR,data:k});_&&e._openGLRenderWindow.setGraphicsResourceForObject(_,U,S),e.pwfTexture=U}else e.pwfTexture=D.oglObject;a(e._openGLRenderWindow,e._pwfTextureCore,_),e._pwfTextureCore=_;const P=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==P){const F=ot.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});F.setName("points");const B=ot.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),k={points:F,cellOffset:0};if(e.renderable.getSlabThickness()>0){const U=e.resliceGeom.getPointData().getNormals();U?k.normals=U:zs("Slab mode requested without normals")}e.tris.getCABO().createVBO(B,"polys",gi.SURFACE,k)}e.VBOBuildString=P,e.VBOBuildTime.modified()},t.updateShaders=(c,l,f)=>{if(e.lastBoundBO=c,t.getNeedToRebuildShaders(c,l,f)){const u={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(u,l,f);const g=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(u.Vertex,u.Fragment,u.Geometry);g!==c.getProgram()&&(c.setProgram(g),c.getVAO().releaseGraphicsResources()),c.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(c.getProgram());c.getVAO().bind(),t.setMapperShaderParameters(c,l,f),t.setCameraShaderParameters(c,l,f),t.setPropertyShaderParameters(c,l,f)},t.setMapperShaderParameters=(c,l,f)=>{const u=c.getProgram(),g=e.currentValidInputs[0].imageData;if(c.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>c.getAttributeUpdateTime().getMTime()||c.getShaderSourceTime().getMTime()>c.getAttributeUpdateTime().getMTime())){e.scalarTextures.forEach((h,m)=>{u.setUniformi(`volumeTexture[${m}]`,h.getTextureUnit())}),u.isAttributeUsed("vertexWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"vertexWC",c.getCABO().getVertexOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||zs("Error setting vertexWC in shader VAO.")),u.isAttributeUsed("normalWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"normalWC",c.getCABO().getNormalOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||zs("Error setting normalWC in shader VAO.")),u.isUniformUsed("slabThickness")&&u.setUniformf("slabThickness",e.renderable.getSlabThickness()),u.isUniformUsed("spacing")&&u.setUniform3fv("spacing",g.getSpacing()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabTrapezoid")&&u.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const p=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null;if(u.isUniformUsed("WCTCMatrix")){const h=g.getDimensions();mn(e.tmpMat4,g.getIndexToWorld()),Mn(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),Sa(e.tmpMat4,e.tmpMat4,h),In(e.tmpMat4,e.tmpMat4),p&&rt(e.tmpMat4,e.tmpMat4,p),u.setUniformMatrix("WCTCMatrix",e.tmpMat4)}u.isUniformUsed("vboScaling")&&u.setUniform3fv("vboScaling",c.getCABO().getCoordScale()??[1,1,1]),c.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&c.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),c.getProgram().isUniformUsed("coffset")){const d=t.getCoincidentParameters(l,f);c.getProgram().setUniformf("coffset",d.offset),c.getProgram().isUniformUsed("cfactor")&&c.getProgram().setUniformf("cfactor",d.factor)}},t.setCameraShaderParameters=(c,l,f)=>{const u=e._openGLCamera.getKeyMatrices(l),g=e._openGLImageSlice.getKeyMatrices(),p=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null,h=c.getProgram();h.isUniformUsed("MCPCMatrix")&&(Ze(e.tmpMat4),h.setUniformMatrix("MCPCMatrix",cm([u.wcpc,g.mcwc,p],Yf,e.tmpMat4))),h.isUniformUsed("MCVCMatrix")&&(Ze(e.tmpMat4),h.setUniformMatrix("MCVCMatrix",cm([u.wcvc,g.mcwc,p],Yf,e.tmpMat4)))},t.setPropertyShaderParameters=(c,l,f)=>{const u=c.getProgram(),g=f.getProperty(e.currentValidInputs[0].inputIndex),d=g.getOpacity();u.setUniformf("opacity",d);const p=e.numberOfComponents,h=g.getIndependentComponents();if(h)for(let y=0;y<p;++y)u.setUniformf(`mix${y}`,g.getComponentWeight(y));for(let y=0;y<p;y++){const T=e.multiTexturePerVolumeEnabled,C=T?y:0,w=T?0:y,_=e.scalarTextures[C].getVolumeInfo(),D=_.scale[w],N=_.offset[w],P=h?y:0;let F=g.getColorWindow(),B=g.getColorLevel();const k=g.getRGBTransferFunction(P);if(k&&g.getUseLookupTableScalarRange()){const q=k.getRange();F=q[1]-q[0],B=.5*(q[1]+q[0])}const U=D/F,H=(N-B)/F+.5;u.setUniformf(`cshift${y}`,H),u.setUniformf(`cscale${y}`,U);let W=1,J=0;const ne=g.getPiecewiseFunction(P);if(ne){const q=ne.getRange(),Q=q[1]-q[0],ae=.5*(q[0]+q[1]);W=D/Q,J=(N-ae)/Q+.5}u.setUniformf(`pwfshift${y}`,J),u.setUniformf(`pwfscale${y}`,W)}const m=e.colorTexture.getTextureUnit();u.setUniformi("colorTexture1",m);const v=e.pwfTexture.getTextureUnit();u.setUniformi("pwfTexture1",v),u.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(c,l,f)=>{const u=f.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents(),g=e.renderable.getSlabThickness(),d=e.renderable.getSlabType(),p=e.renderable.getSlabTrapezoidIntegration();let h=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(h=!0),h||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastNumberOfComponents!==e.numberOfComponents||e.lastMultiTexturePerVolumeEnabled!==e.multiTexturePerVolumeEnabled||c.getProgram()?.getHandle()===0||e.lastIndependentComponents!==u||e.lastSlabThickness!==g||e.lastSlabType!==d||e.lastSlabTrapezoidIntegration!==p?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastNumberOfComponents=e.numberOfComponents,e.lastMultiTexturePerVolumeEnabled=e.multiTexturePerVolumeEnabled,e.lastIndependentComponents=u,e.lastSlabThickness=g,e.lastSlabType=d,e.lastSlabTrapezoidIntegration=p,!0):!1},t.getShaderTemplate=(c,l,f)=>{c.Vertex=V_,c.Fragment=P_,c.Geometry=""},t.replaceShaderValues=(c,l,f)=>{if(t.replaceShaderTCoord(c,l,f),t.replaceShaderPositionVC(c,l,f),e.haveSeenDepthRequest){let u=c.Fragment;u=ce.substitute(u,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,u=ce.substitute(u,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,c.Fragment=u}t.replaceShaderCoincidentOffset(c,l,f)},t.replaceShaderTCoord=(c,l,f)=>{let u=c.Vertex;const g=c.Geometry;let d=c.Fragment;const p=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],h=e.renderable.getSlabThickness();u=ce.substitute(u,"//VTK::TCoord::Dec",p).result;const m=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];u=ce.substitute(u,"//VTK::TCoord::Impl",m).result;const v=e.numberOfComponents,y=f.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents();let T=["in vec3 fragTexCoord;",`uniform highp sampler3D volumeTexture[${e.scalarTextures.length}];`,"uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(T.push("vec4 rawSampleTexture(vec3 pos) {"),!e.multiTexturePerVolumeEnabled)T.push("return texture(volumeTexture[0], pos);","}");else{T.push("vec4 rawSample;");for(let w=0;w<e.scalarTextures.length;++w)T.push(`rawSample[${w}] = texture(volumeTexture[${w}], pos)[0];`);T.push("return rawSample;","}")}if(y){for(let w=1;w<v;w++)T=T.concat([`uniform float cshift${w};`,`uniform float cscale${w};`,`uniform float pwfshift${w};`,`uniform float pwfscale${w};`]);switch(v){case 1:T=T.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:T=T.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:T=T.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:T=T.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:zs("Unsupported number of independent coordinates.")}}h>0&&(T=T.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),T=T.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),d=ce.substitute(d,"//VTK::TCoord::Dec",T).result;let C=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = rawSampleTexture(fragTexCoord);"];if(h>0&&(C=C.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),y){const w=["r","g","b","a"];for(let S=0;S<v;++S)C=C.concat([`vec3 tcolor${S} = texture2D(colorTexture1, vec2(tvalue.${w[S]} * cscale${S} + cshift${S}, height${S})).rgb;`,`float compWeight${S} = mix${S} * texture2D(pwfTexture1, vec2(tvalue.${w[S]} * pwfscale${S} + pwfshift${S}, height${S})).r;`]);switch(v){case 1:C=C.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:C=C.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:zs("Unsupported number of independent coordinates.")}}else switch(v){case 1:C=C.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:C=C.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}d=ce.substitute(d,"//VTK::TCoord::Impl",C).result,c.Vertex=u,c.Fragment=d,c.Geometry=g},t.replaceShaderPositionVC=(c,l,f)=>{let u=c.Vertex;const g=c.Geometry;let d=c.Fragment;const p=e.renderable.getSlabThickness();let h=["attribute vec4 vertexWC;"];h=h.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),p>0&&(h=h.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),u=ce.substitute(u,"//VTK::PositionVC::Dec",h).result;let m=["gl_Position = MCPCMatrix * vertexWC;"];p>0&&(m=m.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),u=ce.substitute(u,"//VTK::PositionVC::Impl",m).result,u=ce.substitute(u,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let v=[];p>0&&(v=v.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),d=ce.substitute(d,"//VTK::PositionVC::Dec",v).result,c.Vertex=u,c.Geometry=g,c.Fragment=d};function s(c){Tn.normalize(c);const l=[0,0,0];for(let f=0;f<3;++f){CO(l),l[f]=1;const u=Tn.dot(c,l);if(u<-.999999||u>.999999)return[!0,f]}return[!1,2]}t.updateResliceGeometry=()=>{let c="";const l=e.currentValidInputs[0].imageData,f=l?.getBounds();let u=!0,g=2;const d=e.renderable.getSlicePolyData(),p=e.renderable.getSlicePlane();if(d)c=c.concat(`PolyData${d.getMTime()}`);else if(p){c=c.concat(`Plane${p.getMTime()}`);const h=ua();l&&(c=c.concat(`Image${l.getMTime()}`),r8(h,...l.getDirection()),ds(h,h));const m=[...p.getNormal()];Jf(m,m,h),[u,g]=s(m)}else{const h=tr.newInstance();h.setNormal(0,0,1);let m=[0,1,0,1,0,1];l&&(m=f),h.setOrigin(m[0],m[2],.5*(m[5]+m[4])),e.renderable.setSlicePlane(h),c=c.concat(`Plane${p?.getMTime()}`),l&&(c=c.concat(`Image${l.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==c){if(d)e.resliceGeom||(e.resliceGeom=uo.newInstance()),e.resliceGeom.getPoints().setData(d.getPoints().getData(),3),e.resliceGeom.getPolys().setData(d.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(d.getPointData().getNormals());else if(p)if(u){const h=new Float32Array(12),m=l.worldToIndex(p.getOrigin(),[0,0,0]),v=[(g+1)%3,(g+2)%3].sort(),y=l.getSpatialExtent();let T=0;for(let D=0;D<2;++D)for(let N=0;N<2;++N)h[T+g]=m[g],h[T+v[0]]=y[2*v[0]+N],h[T+v[1]]=y[2*v[1]+D],T+=3;e.transform.setMatrix(l.getIndexToWorld()),e.transform.transformPoints(h,h);const C=new Uint16Array(8);C[0]=3,C[1]=0,C[2]=1,C[3]=3,C[4]=3,C[5]=0,C[6]=3,C[7]=2;const w=p.getNormal();Tn.normalize(w);const S=new Float32Array(12);for(let D=0;D<4;++D)S[3*D]=w[0],S[3*D+1]=w[1],S[3*D+2]=w[2];e.resliceGeom||(e.resliceGeom=uo.newInstance()),e.resliceGeom.getPoints().setData(h,3),e.resliceGeom.getPolys().setData(C,1);const _=ot.newInstance({numberOfComponents:3,values:S,name:"Normals"});e.resliceGeom.getPointData().setNormals(_)}else{e.outlineFilter.setInputData(l),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(p),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=uo.newInstance());const h=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(h.getPoints().getData(),3),e.resliceGeom.getPolys().setData(h.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(h.getPointData().getNormals());const m=p.getNormal(),v=e.resliceGeom.getNumberOfPoints();Tn.normalize(m);const y=new Float32Array(v*3);for(let C=0;C<v;++C)y[3*C]=m[0],y[3*C+1]=m[1],y[3*C+2]=m[2];const T=ot.newInstance({numberOfComponents:3,values:y,name:"Normals"});e.resliceGeom.getPointData().setNormals(T)}else zs("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=c,e.resliceGeom?.modified()}},t.setScalarTextures=c=>{e.scalarTextures=[...c],e._externalOpenGLTexture=!0},t.delete=tu(()=>{e._openGLRenderWindow&&o(e._openGLRenderWindow)},t.delete)}const q_={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastNumberOfComponents:0,lastMultiTexturePerVolumeEnabled:!1,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,scalarTextures:[],_scalarTexturesCore:[],colorTexture:null,_colorTextureCore:null,pwfTexture:null,_pwfTextureCore:null,_externalOpenGLTexture:!1,resliceGeom:null,resliceGeomUpdateString:null,tris:null};function X_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,q_,n),bn.extend(t,e,n),ms.implementReplaceShaderCoincidentOffset(t,e,n),ms.implementBuildShadersWithReplacements(t,e,n),e.tris=To.newInstance(),e.scalarTextures=[],e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},an(e.VBOBuildTime),e.tmpMat4=Ze(new Float64Array(16)),e.outlineFilter=y_.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=uo.newInstance(),e.cutter=PM.newInstance(),e.lineToSurfaceFilter=_M.newInstance(),e.transform=L_.newInstance(),$r(t,e,["scalarTextures"]),K_(t,e)}const Y_=Yt(X_,"vtkOpenGLImageResliceMapper");rr("vtkImageResliceMapper",Y_);const Z_={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Kg={SlicingMode:Z_},G2=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,ou=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:Vc}=Dr,{SlicingMode:ri}=Kg;function J_(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const i=e[r].trim();i.length>0&&n.push(i)}return n}function Q_(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function n(r){e.openGLTexture.releaseGraphicsResources(r),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray,e._labelOutlineOpacity].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const a=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()==Ki.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=G2,r.Fragment=ou,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=ce.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=ce.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,o=ce.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,o=ce.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=a.getProperty().getIndependentComponents();let f=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(a.getProperty().getUseLabelOutline()&&(f=f.concat(["uniform sampler2D labelOutlineTexture1;","uniform sampler2D labelOutlineOpacityTexture1;"])),l){for(let g=1;g<c;g++)f=f.concat([`uniform float cshift${g};`,`uniform float cscale${g};`,`uniform float pwfshift${g};`,`uniform float pwfscale${g};`]);switch(c){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Vc("Unsupported number of independent coordinates.")}}if(s=ce.substitute(s,"//VTK::TCoord::Dec",f).result,a.getProperty().getUseLabelOutline()===!0&&(s=ce.substitute(s,"//VTK::LabelOutline::Dec",["uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,s=ce.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=ce.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),l){const g=["r","g","b","a"];let d=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let p=0;p<c;p++)d=d.concat([`vec3 tcolor${p} = mix${p} * texture2D(colorTexture1, vec2(tvalue.${g[p]} * cscale${p} + cshift${p}, height${p})).rgb;`,`float compWeight${p} = mix${p} * texture2D(pwfTexture1, vec2(tvalue.${g[p]} * pwfscale${p} + pwfshift${p}, height${p})).r;`]);switch(c){case 1:d=d.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:d=d.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Vc("Unsupported number of independent coordinates.")}s=ce.substitute(s,"//VTK::TCoord::Impl",d).result}else switch(c){case 1:s=ce.substitute(s,"//VTK::TCoord::Impl",[...J_(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  float outlineOpacity = texture2D(labelOutlineOpacityTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=ce.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=ce.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=ce.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=ce.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=ce.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(yt("OpenGL has a limit of 6 clipping planes"),c=6),o=ce.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=ce.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=ce.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=ce.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getNeedToRebuildShaders=(r,i,a)=>{const o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getProgram()?.getHandle()===0||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<a.getProperty().getMTime()||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(r,i,a)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Vc("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||Vc("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());const o=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",o);const s=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c)for(let g=0;g<s;g++)r.getProgram().setUniformf(`mix${g}`,a.getProperty().getComponentWeight(g));const l=e.openGLTexture.getShiftAndScale();for(let g=0;g<s;g++){let d=a.getProperty().getColorWindow(),p=a.getProperty().getColorLevel();const h=c?g:0,m=a.getProperty().getRGBTransferFunction(h);if(m&&a.getProperty().getUseLookupTableScalarRange()){const T=m.getRange();d=T[1]-T[0],p=.5*(T[1]+T[0])}const v=l.scale/d,y=(l.shift-p)/d+.5;r.getProgram().setUniformf(`cshift${g}`,y),r.getProgram().setUniformf(`cscale${g}`,v)}for(let g=0;g<s;g++){let d=1,p=0;const h=c?g:0,m=a.getProperty().getPiecewiseFunction(h);if(m){const v=m.getRange(),y=v[1]-v[0],T=.5*(v[0]+v[1]);d=l.scale/y,p=(l.shift-T)/y+.5}r.getProgram().setUniformf(`pwfshift${g}`,p),r.getProgram().setUniformf(`pwfscale${g}`,d)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const g=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",g.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",g.factor)}const f=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",f);const u=e.pwfTexture.getTextureUnit();if(r.getProgram().setUniformi("pwfTexture1",u),a.getProperty().getUseLabelOutline()){const g=e.labelOutlineThicknessTexture.getTextureUnit();r.getProgram().setUniformi("labelOutlineTexture1",g);const d=e.labelOutlineOpacityTexture.getTextureUnit();r.getProgram().setUniformi("labelOutlineOpacityTexture1",d)}if(e.renderable.getNumberOfClippingPlanes()){let g=e.renderable.getNumberOfClippingPlanes();g>6&&(yt("OpenGL has a limit of 6 clipping planes"),g=6);const p=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,h=p?mn(e.imagematinv,a.getMatrix()):a.getMatrix();p&&(bt(h,h),rt(h,h,p),bt(h,h)),bt(e.imagemat,e.currentInput.getIndexToWorld()),rt(e.imagematinv,h,e.imagemat);const m=[];for(let v=0;v<g;v++){const y=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,v,y);for(let T=0;T<4;T++)m.push(y[T])}r.getProgram().setUniformi("numClipPlanes",g),r.getProgram().setUniform4fv("clipPlanes",m)}},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();rt(e.imagemat,s.mcwc,l);const f=e.openGLCamera.getKeyMatrices(i);if(rt(e.imagemat,f.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){const g=r.getCABO().getInverseShiftAndScaleMatrix();rt(e.imagemat,e.imagemat,g)}if(o.setUniformMatrix("MCPCMatrix",e.imagemat),a.getProperty().getUseLabelOutline()===!0){const g=c.getWorldToIndex(),d=c.getDimensions();let p=e.renderable.getClosestIJKAxis().ijkMode;p===ri.NONE&&(p=ri.K),o.setUniform3i("imageDimensions",d[0],d[1],d[2]),o.setUniformi("sliceAxis",p),o.setUniformMatrix("vWCtoIDX",g);const h=e.openGLCamera.getKeyMatrices(i);In(e.projectionToWorld,h.wcpc),e.openGLCamera.getKeyMatrices(i),o.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const m=t.getRenderTargetSize();o.setUniformf("vpWidth",m[0]),o.setUniformf("vpHeight",m[1]);const v=t.getRenderTargetOffset();o.setUniformf("vpOffsetX",v[0]/m[0]),o.setUniformf("vpOffsetY",v[1]/m[1])}},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),c=a.getProperty().getOpacity();o.setUniformf("opacity",c)},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),i.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.activate(),e.labelOutlineOpacityTexture.activate()),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),i.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.deactivate(),e.labelOutlineOpacityTexture.deactivate()),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){Vc("No input!");return}t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!e.openGLTexture?.getHandle()||!e.colorTexture?.getHandle()||i.getProperty().getUseLabelOutline()&&(!e.labelOutlineThicknessTexture?.getHandle()||!e.labelOutlineOpacityTexture?.getHandle())||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(!a)return;const o=a.getPointData()&&a.getPointData().getScalars();if(!o)return;const s=o.getDataType(),c=o.getNumberOfComponents(),l=i.getProperty(),f=l.getInterpolationType(),u=l.getIndependentComponents(),g=u?c:1,d=u?2*g:1,p=[];for(let U=0;U<g;++U)p.push(l.getRGBTransferFunction(U));const h=xa(p,u,g),m=l.getRGBTransferFunction(),v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!v?.oglObject?.getHandle()||v?.hash!==h){e.colorTexture=Xt.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let U=e.renderable.getColorTextureWidth();U<=0&&(U=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const H=U*d*3,W=new Uint8ClampedArray(H);if(f===ss.NEAREST?(e.colorTexture.setMinificationFilter(ze.NEAREST),e.colorTexture.setMagnificationFilter(ze.NEAREST)):(e.colorTexture.setMinificationFilter(ze.LINEAR),e.colorTexture.setMagnificationFilter(ze.LINEAR)),m){const J=new Float32Array(U*3);for(let ne=0;ne<g;ne++){const q=l.getRGBTransferFunction(ne),Q=q.getRange();if(q.getTable(Q[0],Q[1],U,J,1),u)for(let ae=0;ae<U*3;ae++)W[ne*U*6+ae]=255*J[ae],W[ne*U*6+ae+U*3]=255*J[ae];else for(let ae=0;ae<U*3;ae++)W[ne*U*6+ae]=255*J[ae]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:U,height:d,numComps:3,dataType:dt.UNSIGNED_CHAR,data:W})}else{for(let J=0;J<U*3;++J)W[J]=255*J/((U-1)*3),W[J+1]=255*J/((U-1)*3),W[J+2]=255*J/((U-1)*3);e.colorTexture.create2DFromRaw({width:U,height:1,numComps:3,dataType:dt.UNSIGNED_CHAR,data:W})}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,h),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;const T=[];for(let U=0;U<g;++U)T.push(l.getPiecewiseFunction(U));const C=xa(T,u,g),w=l.getPiecewiseFunction(),S=e._openGLRenderWindow.getGraphicsResourceForObject(w);if(!S?.oglObject?.getHandle()||S?.hash!==C){let U=e.renderable.getOpacityTextureWidth();U<=0&&(U=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const H=U*d,W=new Uint8ClampedArray(H);if(e.pwfTexture=Xt.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),f===ss.NEAREST?(e.pwfTexture.setMinificationFilter(ze.NEAREST),e.pwfTexture.setMagnificationFilter(ze.NEAREST)):(e.pwfTexture.setMinificationFilter(ze.LINEAR),e.pwfTexture.setMagnificationFilter(ze.LINEAR)),w){const J=new Float32Array(H),ne=new Float32Array(U);for(let q=0;q<g;++q){const Q=l.getPiecewiseFunction(q);if(Q===null)J.fill(1);else{const ae=Q.getRange();if(Q.getTable(ae[0],ae[1],U,ne,1),u)for(let me=0;me<U;me++)J[q*U*2+me]=ne[me],J[q*U*2+me+U]=ne[me];else for(let me=0;me<U;me++)J[q*U*2+me]=ne[me]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:U,height:d,numComps:1,dataType:dt.FLOAT,data:J})}else W.fill(255),e.pwfTexture.create2DFromRaw({width:U,height:1,numComps:1,dataType:dt.UNSIGNED_CHAR,data:W});w&&(e._openGLRenderWindow.setGraphicsResourceForObject(w,e.pwfTexture,C),w!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(w,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=w)}else e.pwfTexture=S.oglObject;i.getProperty().getUseLabelOutline()&&(t.updatelabelOutlineThicknessTexture(i),t.updateLabelOutlineOpacityTexture(i));const{ijkMode:D}=e.renderable.getClosestIJKAxis();let N=e.renderable.getSlice();D!==e.renderable.getSlicingMode()&&(N=e.renderable.getSliceAtPosition(N));const P=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(N),F=a.getExtent();let B;D===ri.I&&(B=P-F[0]),D===ri.J&&(B=P-F[2]),(D===ri.K||D===ri.NONE)&&(B=P-F[4]);const k=`${N}A${a.getMTime()}A${o.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==k){const U=a.getDimensions();e.openGLTexture||(e.openGLTexture=Xt.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),f===ss.NEAREST?(new Set([1,3,4]).has(c)&&s===dt.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(ze.NEAREST),e.openGLTexture.setMagnificationFilter(ze.NEAREST)):(c===4&&s===dt.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(ze.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(ze.LINEAR),e.openGLTexture.setMagnificationFilter(ze.LINEAR)),e.openGLTexture.setWrapS(Wl.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Wl.CLAMP_TO_EDGE);const H=U[0]*U[1]*c,W=new Float32Array(12),J=new Float32Array(8);for(let qe=0;qe<4;qe++)J[qe*2]=qe%2?1:0,J[qe*2+1]=qe>1?1:0;const ne=[ri.X,ri.Y,ri.Z].includes(e.renderable.getSlicingMode())?N:P,q=a.getSpatialExtent(),Q=o.getData();let ae=null;if(D===ri.I){ae=new Q.constructor(U[2]*U[1]*c);let qe=0;for(let Qe=0;Qe<U[2];Qe++)for(let ut=0;ut<U[1];ut++){let ke=(B+ut*U[0]+Qe*U[0]*U[1])*c;qe=(Qe*U[1]+ut)*c;const Xe=ke+c;for(;ke<Xe;)ae[qe++]=Q[ke++]}U[0]=U[1],U[1]=U[2],W[0]=ne,W[1]=q[2],W[2]=q[4],W[3]=ne,W[4]=q[3],W[5]=q[4],W[6]=ne,W[7]=q[2],W[8]=q[5],W[9]=ne,W[10]=q[3],W[11]=q[5]}else if(D===ri.J){ae=new Q.constructor(U[2]*U[0]*c);let qe=0;for(let Qe=0;Qe<U[2];Qe++)for(let ut=0;ut<U[0];ut++){let ke=(ut+B*U[0]+Qe*U[0]*U[1])*c;qe=(Qe*U[0]+ut)*c;const Xe=ke+c;for(;ke<Xe;)ae[qe++]=Q[ke++]}U[1]=U[2],W[0]=q[0],W[1]=ne,W[2]=q[4],W[3]=q[1],W[4]=ne,W[5]=q[4],W[6]=q[0],W[7]=ne,W[8]=q[5],W[9]=q[1],W[10]=ne,W[11]=q[5]}else D===ri.K||D===ri.NONE?(ae=Q.subarray(B*H,(B+1)*H),W[0]=q[0],W[1]=q[2],W[2]=ne,W[3]=q[1],W[4]=q[2],W[5]=ne,W[6]=q[0],W[7]=q[3],W[8]=ne,W[9]=q[1],W[10]=q[3],W[11]=ne):Vc("Reformat slicing not yet supported.");const me=o.getRanges();e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw({width:U[0],height:U[1],numComps:c,dataType:o.getDataType(),data:ae,preferSizeOverAccuracy:!!e.renderable.getPreferSizeOverAccuracy?.(),ranges:me}),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const de=ot.newInstance({numberOfComponents:3,values:W});de.setName("points");const je=ot.newInstance({numberOfComponents:2,values:J});je.setName("tcoords");const $e=new Uint16Array(8);$e[0]=3,$e[1]=0,$e[2]=1,$e[3]=3,$e[4]=3,$e[5]=0,$e[6]=3,$e[7]=2;const Be=ot.newInstance({numberOfComponents:1,values:$e});e.tris.getCABO().createVBO(Be,"polys",gi.SURFACE,{points:de,tcoords:je,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=k}},t.updateLabelOutlineOpacityTexture=r=>{let i=r.getProperty().getLabelOutlineOpacity();typeof i=="number"&&(e._cachedLabelOutlineOpacityObj?.[0]===i?i=e._cachedLabelOutlineOpacityObj:i=[i],e._cachedLabelOutlineOpacityObj=i);const a=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!a?.oglObject?.getHandle()||a?.hash!==o){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const l=1,f=c*l,u=new Float32Array(f);for(let g=0;g<c;++g)u[g]=i[g]??i[0];e.labelOutlineOpacityTexture=Xt.newInstance({resizable:!1}),e.labelOutlineOpacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineOpacityTexture.resetFormatAndType(),e.labelOutlineOpacityTexture.setMinificationFilter(ze.NEAREST),e.labelOutlineOpacityTexture.setMagnificationFilter(ze.NEAREST),e.labelOutlineOpacityTexture.create2DFromRaw({width:c,height:l,numComps:1,dataType:dt.FLOAT,data:u}),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineOpacityTexture,o),i!==e._labelOutlineOpacity&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineOpacity,t)),e._labelOutlineOpacity=i)}else e.labelOutlineOpacityTexture=a.oglObject},t.updatelabelOutlineThicknessTexture=r=>{const i=r.getProperty().getLabelOutlineThicknessByReference(),a=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!a?.oglObject?.getHandle()||a?.hash!==o){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const l=1,f=c*l,u=new Uint8Array(f);for(let g=0;g<c;++g){const d=typeof i[g]<"u"?i[g]:i[0];u[g]=d}e.labelOutlineThicknessTexture=Xt.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(ze.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(ze.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw({width:c,height:l,numComps:1,dataType:dt.UNSIGNED_CHAR,data:u}),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,o),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=a.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.delete=tu(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const eI={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineOpacityTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function tI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eI,n),bn.extend(t,e,n),ms.implementReplaceShaderCoincidentOffset(t,e,n),ms.implementBuildShadersWithReplacements(t,e,n),e.tris=To.newInstance(),e.imagemat=Ze(new Float64Array(16)),e.imagematinv=Ze(new Float64Array(16)),e.projectionToWorld=Ze(new Float64Array(16)),e.idxToView=Ze(new Float64Array(16)),e.idxNormalMatrix=bi(new Float64Array(9)),e.modelToView=Ze(new Float64Array(16)),e.projectionToView=Ze(new Float64Array(16)),Gn(t,e,[]),e.VBOBuildTime={},an(e.VBOBuildTime),Q_(t,e)}const s9=Yt(tI,"vtkOpenGLImageMapper");var nI={newInstance:s9};rr("vtkAbstractImageMapper",s9);const Hs={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:Iu}=A;function rI(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function n(r){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()===Ki.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.renderPiece=(r,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i)},t.renderPieceDraw=(r,i)=>{const a=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),i.getProperty().getInterpolationType()===ss.NEAREST?(e.volumeTexture.setMinificationFilter(ze.NEAREST),e.volumeTexture.setMagnificationFilter(ze.NEAREST),e.colorTexture.setMinificationFilter(ze.NEAREST),e.colorTexture.setMagnificationFilter(ze.NEAREST),e.pwfTexture.setMinificationFilter(ze.NEAREST),e.pwfTexture.setMagnificationFilter(ze.NEAREST)):(e.volumeTexture.setMinificationFilter(ze.LINEAR),e.volumeTexture.setMagnificationFilter(ze.LINEAR),e.colorTexture.setMinificationFilter(ze.LINEAR),e.colorTexture.setMagnificationFilter(ze.LINEAR),e.pwfTexture.setMinificationFilter(ze.LINEAR),e.pwfTexture.setMagnificationFilter(ze.LINEAR))},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentImageDataInput.getMTime()||a<e.currentCenterlineInput.getMTime()||!e.volumeTexture?.getHandle()},t.buildBufferObjects=(r,i)=>{const a=e.currentImageDataInput,o=e.currentCenterlineInput,s=i.getProperty(),c=a?.getPointData()?.getScalars();if(!c)return;const l=e._openGLRenderWindow.getGraphicsResourceForObject(c),f=U2(a,c),u=!l?.oglObject?.getHandle()||l?.hash!==f,g=s.getUpdatedExtents(),d=!!g.length;if(u){e.volumeTexture=Xt.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const k=a.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray({width:k[0],height:k[1],depth:k[2],dataArray:c,preferSizeOverAccuracy:e.renderable.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(c,e.volumeTexture,f),c!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=c}else e.volumeTexture=l.oglObject;if(d){s.setUpdatedExtents([]);const k=a.getDimensions();e.volumeTexture.create3DFilterableFromDataArray({width:k[0],height:k[1],depth:k[2],dataArray:c,updatedExtents:g})}const p=c.getNumberOfComponents(),h=i.getProperty(),m=h.getIndependentComponents(),v=m?p:1,y=m?2*v:1,T=[];for(let k=0;k<v;++k)T.push(h.getRGBTransferFunction(k));const C=xa(T,m,v),w=h.getRGBTransferFunction(),S=e._openGLRenderWindow.getGraphicsResourceForObject(w);if(!S?.oglObject?.getHandle()||S?.hash!==C){let k=e.renderable.getColorTextureWidth();k<=0&&(k=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const U=k*y*3,H=new Uint8ClampedArray(U);if(e.colorTexture=Xt.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),w){const W=new Float32Array(k*3);for(let J=0;J<v;J++){const ne=h.getRGBTransferFunction(J),q=ne.getRange();if(ne.getTable(q[0],q[1],k,W,1),m)for(let Q=0;Q<k*3;Q++)H[J*k*6+Q]=255*W[Q],H[J*k*6+Q+k*3]=255*W[Q];else for(let Q=0;Q<k*3;Q++)H[J*k*6+Q]=255*W[Q]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:k,height:y,numComps:3,dataType:dt.UNSIGNED_CHAR,data:H})}else{for(let W=0;W<k*3;++W)H[W]=255*W/((k-1)*3),H[W+1]=255*W/((k-1)*3),H[W+2]=255*W/((k-1)*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:k,height:1,numComps:3,dataType:dt.UNSIGNED_CHAR,data:H})}w&&(e._openGLRenderWindow.setGraphicsResourceForObject(w,e.colorTexture,C),w!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(w,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=w)}else e.colorTexture=S.oglObject;const D=[];for(let k=0;k<v;++k)D.push(h.getPiecewiseFunction(k));const N=xa(D,m,v),P=h.getPiecewiseFunction(),F=e._openGLRenderWindow.getGraphicsResourceForObject(P);if(!F?.oglObject?.getHandle()||F?.hash!==N){let k=e.renderable.getOpacityTextureWidth();k<=0&&(k=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const U=k*y,H=new Uint8ClampedArray(U);if(e.pwfTexture=Xt.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),P){const W=new Float32Array(U),J=new Float32Array(k);for(let ne=0;ne<v;++ne){const q=h.getPiecewiseFunction(ne);if(q===null)W.fill(1);else{const Q=q.getRange();if(q.getTable(Q[0],Q[1],k,J,1),m)for(let ae=0;ae<k;ae++)W[ne*k*2+ae]=J[ae],W[ne*k*2+ae+k]=J[ae];else for(let ae=0;ae<k;ae++)W[ne*k*2+ae]=J[ae]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:k,height:y,numComps:1,dataType:dt.FLOAT,data:W})}else H.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:k,height:1,numComps:1,dataType:dt.UNSIGNED_CHAR,data:H});P&&(e._openGLRenderWindow.setGraphicsResourceForObject(P,e.pwfTexture,N),P!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(P,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=P)}else e.pwfTexture=F.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<o.getMTime()){const k=o.getNumberOfPoints(),U=k<=1?0:k-1,H=o.getDistancesToFirstPoint(),W=e.renderable.getHeight(),J=4*U,ne=new Float32Array(3*J),q=e.renderable.getWidth();for(let Xe=0,et=0;Xe<U;++Xe)ne.set([0,W-H[Xe],0],et),et+=3,ne.set([q,W-H[Xe],0],et),et+=3,ne.set([q,W-H[Xe+1],0],et),et+=3,ne.set([0,W-H[Xe+1],0],et),et+=3;const Q=ot.newInstance({numberOfComponents:3,values:ne});Q.setName("points");const ae=new Uint16Array(5*U);for(let Xe=0,et=0,$t=0;Xe<U;++Xe)ae.set([4,$t+3,$t+2,$t+1,$t],et),et+=5,$t+=4;const me=ot.newInstance({numberOfComponents:1,values:ae}),de=o.getPoints(),je=new Float32Array(3*J),$e=new Array(3),Be=new Array(3);for(let Xe=0,et=0;Xe<U;++Xe)de.getPoint(Xe,$e),de.getPoint(Xe+1,Be),je.set($e,et),et+=3,je.set($e,et),et+=3,je.set(Be,et),et+=3,je.set(Be,et),et+=3;const qe=ot.newInstance({numberOfComponents:3,values:je,name:"centerlinePosition"}),Qe=new Float32Array(J);for(let Xe=0,et=0;Xe<U;++Xe)Qe.set([0,1,3,2],et),et+=4;const ut=ot.newInstance({numberOfComponents:1,values:Qe,name:"quadIndex"}),ke=[qe,ut];if(!e.renderable.getUseUniformOrientation()){const Xe=e.renderable.getOrientedCenterline().getOrientations()??[],et=new Float32Array(4*J),$t=new Float32Array(4*J);for(let Jt=0;Jt<U;++Jt){const qt=Xe[Jt],on=Xe[Jt+1];for(let tn=0;tn<4;++tn){const $=4*(tn+4*Jt);et.set(qt,$),$t.set(on,$)}}const Zt=ot.newInstance({numberOfComponents:4,values:et,name:"centerlineTopOrientation"}),Kt=ot.newInstance({numberOfComponents:4,values:$t,name:"centerlineBotOrientation"});ke.push(Zt,Kt)}e.tris.getCABO().createVBO(me,"polys",gi.SURFACE,{points:Q,customAttributes:ke}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(r,i,a)=>{const o=e.volumeTexture.getComponents(),s=a.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),f=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return r.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=f,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(r,i,a)=>{t.getShaderTemplate(r,i,a),t.replaceShaderValues(r,i,a)},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];o=ce.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=ce.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],f=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),f&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),o=ce.substitute(o,"//VTK::Color::Dec",l).result;const g=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(g.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),f&&g.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):g.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),o=ce.substitute(o,"//VTK::Color::Impl",g).result;const d=e.volumeTexture.getComponents(),p=a.getProperty().getIndependentComponents();let h=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];f&&h.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(h.push("in vec3 samplingDirVSOutput;"),f&&h.push("in vec3 projectionDirVSOutput;")):(h.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),f&&h.push("uniform vec3 bitangentDirection;"));const m=e.renderable.getCenterPoint();if(m&&h.push("uniform vec3 globalCenterPoint;"),p){for(let y=1;y<d;y++)h=h.concat([`uniform float cshift${y};`,`uniform float cscale${y};`,`uniform float pwfshift${y};`,`uniform float pwfscale${y};`]);switch(d){case 1:h=h.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:h=h.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:h=h.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:h=h.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Iu("Unsupported number of independent coordinates.")}}s=ce.substitute(s,"//VTK::TCoord::Dec",h).result;let v=[];if(u?(v.push("vec3 samplingDirection = samplingDirVSOutput;"),f&&v.push("vec3 projectionDirection = projectionDirVSOutput;")):(v.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),f&&v.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?v.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):v.push("float horizontalOffset = quadOffsetVSOutput.x;"),v.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),f){const y=e.renderable.getProjectionMode();switch(y){case Hs.MIN:v.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case Hs.MAX:case Hs.AVERAGE:default:v.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(v.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),y){case Hs.MAX:v.push("  tvalue = max(tvalue, sampledTextureValue);");break;case Hs.MIN:v.push("  tvalue = min(tvalue, sampledTextureValue);");break;case Hs.AVERAGE:default:v.push("  tvalue = tvalue + sampledTextureValue;");break}v.push("}"),y===Hs.AVERAGE&&v.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else v.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(p){const y=["r","g","b","a"];for(let T=0;T<d;++T)v=v.concat([`vec3 tcolor${T} = mix${T} * texture2D(colorTexture1, vec2(tvalue.${y[T]} * cscale${T} + cshift${T}, height${T})).rgb;`,`float compWeight${T} = mix${T} * texture2D(pwfTexture1, vec2(tvalue.${y[T]} * pwfscale${T} + pwfshift${T}, height${T})).r;`]);switch(d){case 1:v=v.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:v=v.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Iu("Unsupported number of independent coordinates.")}}else switch(d){case 1:v=v.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:v=v.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=ce.substitute(s,"//VTK::TCoord::Impl",v).result,e.haveSeenDepthRequest&&(s=ce.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=ce.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(A.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),o=ce.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=ce.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=ce.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=ce.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getShaderTemplate=(r,i,a)=>{r.Vertex=G2,r.Fragment=ou,r.Geometry=""},t.setMapperShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=r.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(o,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||Iu("Error setting vertexMC in shader VAO.")),r.getCABO().getCustomData().forEach(d=>{d&&o.isAttributeUsed(d.name)&&!r.getVAO().addAttributeArray(o,s,d.name,d.offset,s.getStride(),e.context.FLOAT,d.components,e.context.FALSE)&&Iu(`Error setting ${d.name} in shader VAO.`)}),r.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(o.setUniformi("volumeTexture",c),o.setUniformf("width",e.renderable.getWidth()),r.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),o.isUniformUsed("tangentDirection")){const d=e.renderable.getTangentDirection();r.getProgram().setUniform3fArray("tangentDirection",d)}if(o.isUniformUsed("bitangentDirection")){const d=e.renderable.getBitangentDirection();r.getProgram().setUniform3fArray("bitangentDirection",d)}if(o.isUniformUsed("centerlineOrientation")){const d=e.renderable.getUniformOrientation();r.getProgram().setUniform4fv("centerlineOrientation",d)}if(o.isUniformUsed("globalCenterPoint")){const d=e.renderable.getCenterPoint();o.setUniform3fArray("globalCenterPoint",d)}if(e.renderable.isProjectionEnabled()){const d=e.currentImageDataInput,p=d.getSpacing(),h=d.getDimensions(),m=e.renderable.getProjectionSlabThickness(),v=e.renderable.getProjectionSlabNumberOfSamples(),y=wO([],p,h);o.setUniform3fArray("volumeSizeMC",y),o.setUniformi("projectionSlabNumberOfSamples",v);const T=-.5*m;o.setUniformf("projectionConstantOffset",T);const C=m/(v-1);o.setUniformf("projectionStepLength",C)}const l=e.currentImageDataInput,f=l.getWorldToIndex(),u=Ug(new Float32Array(16),Zf([],l.getDimensions())),g=Xf(u,u,f);if(o.setUniformMatrix("MCTCMatrix",g),e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let d=e.renderable.getNumberOfClippingPlanes();d>6&&(A.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),d=6);const h=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,m=h?mn(e.imagematinv,a.getMatrix()):a.getMatrix();h&&(bt(m,m),rt(m,m,h),bt(m,m)),bt(e.imagemat,e.currentImageDataInput.getIndexToWorld()),rt(e.imagematinv,m,e.imagemat);const v=[];for(let y=0;y<d;y++){const T=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,y,T);for(let C=0;C<4;C++)v.push(T[C])}o.setUniformi("numClipPlanes",d),o.setUniform4fv("clipPlanes",v)}if(o.isUniformUsed("coffset")){const d=t.getCoincidentParameters(i,a);o.setUniformf("coffset",d.offset),o.isUniformUsed("cfactor")&&o.setUniformf("cfactor",d.factor)}},t.setCameraShaderParameters=(r,i,a)=>{const o=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(rt(e.imagemat,s,o),r.getCABO().getCoordShiftAndScaleEnabled()){const c=r.getCABO().getInverseShiftAndScaleMatrix();rt(e.imagemat,e.imagemat,c)}r.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=a.getProperty(),c=s.getOpacity();o.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),f=s.getIndependentComponents();if(f)for(let p=0;p<l;++p)o.setUniformf(`mix${p}`,s.getComponentWeight(p));const u=e.volumeTexture.getVolumeInfo();for(let p=0;p<l;p++){let h=s.getColorWindow(),m=s.getColorLevel();const v=f?p:0,y=s.getRGBTransferFunction(v);if(y&&s.getUseLookupTableScalarRange()){const w=y.getRange();h=w[1]-w[0],m=.5*(w[1]+w[0])}const T=u.scale[p]/h,C=(u.offset[p]-m)/h+.5;o.setUniformf(`cshift${p}`,C),o.setUniformf(`cscale${p}`,T)}const g=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",g);for(let p=0;p<l;p++){let h=1,m=0;const v=f?p:0,y=s.getPiecewiseFunction(v);if(y){const T=y.getRange(),C=T[1]-T[0],w=.5*(T[0]+T[1]);h=u.scale[p]/C,m=(u.offset[p]-w)/C+.5}o.setUniformf(`pwfshift${p}`,m),o.setUniformf(`pwfscale${p}`,h)}const d=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",d)},t.updateShaders=(r,i,a)=>{if(t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.delete=A.chain(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const iI={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function aI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iI,n),bn.extend(t,e,n),ms.implementReplaceShaderCoincidentOffset(t,e,n),A.algo(t,e,2,0),e.tris=To.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=Ze(new Float64Array(16)),e.imagematinv=Ze(new Float64Array(16)),e.VBOBuildTime={},A.obj(e.VBOBuildTime,{mtime:0}),rI(t,e)}const c9=A.newInstance(aI,"vtkOpenGLImageCPRMapper"),oI={};var sI={newInstance:c9,...oI};rr("vtkImageCPRMapper",c9);function cI(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(mn(e.keyMatrices.mcwc,e.renderable.getMatrix()),bt(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const lI={context:null,keyMatrixTime:null,keyMatrices:null};function uI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lI,n),bn.extend(t,e,n),e.keyMatrixTime={},an(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:Ze(new Float64Array(16))},Gn(t,e,["context"]),cI(t,e)}const l9=Yt(uI,"vtkOpenGLImageSlice");var fI={newInstance:l9};rr("vtkImageSlice",l9);function gI(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),mn(e.MCWCMatrix,e.renderable.getMatrix()),bt(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?bi(e.normalMatrix):(uc(e.normalMatrix,e.MCWCMatrix),ds(e.normalMatrix,e.normalMatrix),Gl(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const dI={};function hI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dI,n),bn.extend(t,e,n),e.keyMatrixTime={},an(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Gn(t,e,["context"]),gI(t,e)}const u9=Yt(hI,"vtkOpenGLVolume");var pI={newInstance:u9};rr("vtkVolume",u9);function mI(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){yt("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){yt("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){yt("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){yt("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let a=i.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{yt("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){yt("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{yt("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,i,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){yt("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else yt("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){yt("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else yt("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){yt("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=Xt.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(ze.LINEAR),r.setMagnificationFilter(ze.LINEAR),r.create2DFromRaw({width:e.glFramebuffer.width,height:e.glFramebuffer.height,numComps:4,dataType:dt.UNSIGNED_CHAR,data:null}),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const vI={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function f9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vI,n),an(t,e),e.colorBuffers&&yt("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],I0(t,e,["colorBuffers"]),mI(t,e)}const yI=Yt(f9,"vtkFramebuffer");var su={newInstance:yI,extend:f9},TI=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,CI=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

const float infinity = 3.402823466e38;

// the output of this shader
//VTK::Output::Dec

in vec3 vertexVCVSOutput;

// From Sources\\Rendering\\Core\\VolumeProperty\\Constants.js
#define COMPOSITE_BLEND 0
#define MAXIMUM_INTENSITY_BLEND 1
#define MINIMUM_INTENSITY_BLEND 2
#define AVERAGE_INTENSITY_BLEND 3
#define ADDITIVE_INTENSITY_BLEND 4
#define RADON_TRANSFORM_BLEND 5
#define LABELMAP_EDGE_PROJECTION_BLEND 6

#define vtkNumberOfLights //VTK::NumberOfLights
#define vtkMaxLaoKernelSize //VTK::MaxLaoKernelSize
#define vtkNumberOfComponents //VTK::NumberOfComponents
#define vtkBlendMode //VTK::BlendMode
#define vtkMaximumNumberOfSamples //VTK::MaximumNumberOfSamples

//VTK::EnabledColorFunctions

//VTK::EnabledLightings

//VTK::EnabledMultiTexturePerVolume

//VTK::EnabledGradientOpacity

//VTK::EnabledIndependentComponents

//VTK::vtkProportionalComponents

//VTK::vtkForceNearestComponents

uniform int twoSidedLighting;

#if vtkMaxLaoKernelSize > 0
  vec2 kernelSample[vtkMaxLaoKernelSize];
#endif

// Textures
#ifdef EnabledMultiTexturePerVolume
  #define vtkNumberOfVolumeTextures vtkNumberOfComponents
#else
  #define vtkNumberOfVolumeTextures 1
#endif
uniform highp sampler3D volumeTexture[vtkNumberOfVolumeTextures];
uniform sampler2D colorTexture;
uniform sampler2D opacityTexture;
uniform sampler2D jtexture;
uniform sampler2D labelOutlineThicknessTexture;

struct Volume {
  // ---- Volume geometry settings ----

  vec3 originVC;          // in VC
  vec3 spacing;           // in VC per IC
  vec3 inverseSpacing;    // 1/spacing
  ivec3 dimensions;       // in IC
  vec3 inverseDimensions; // 1/vec3(dimensions)
  mat3 vecISToVCMatrix;   // convert from IS to VC without translation
  mat3 vecVCToISMatrix;   // convert from VC to IS without translation
  mat4 PCWCMatrix;
  mat4 worldToIndex;
  float diagonalLength; // in VC, this is: length(size)

  // ---- Texture settings ----

  // Texture shift and scale
  vec4 colorTextureScale;
  vec4 colorTextureShift;
  vec4 opacityTextureScale;
  vec4 opacityTextureShift;

  // The heights defined below are the locations for the up to four components
  // of the transfer functions. The transfer functions have a height of (2 *
  // numberOfComponents) pixels so the values are computed to hit the middle of
  // the two rows for that component
  vec4 transferFunctionsSampleHeight;

  // ---- Mode specific settings ----

  // Independent component default preset settings per component
  vec4 independentComponentMix;

  // Additive / average blending mode settings
  vec4 ipScalarRangeMin;
  vec4 ipScalarRangeMax;

  // ---- Rendering settings ----

  // Lighting
  float ambient;
  float diffuse;
  float specular;
  float specularPower;
  int computeNormalFromOpacity;

  // Gradient opacity
  vec4 gradientOpacityScale;
  vec4 gradientOpacityShift;
  vec4 gradientOpacityMin;
  vec4 gradientOpacityMax;

  // Volume shadow
  float volumetricScatteringBlending;
  float globalIlluminationReach;
  float anisotropy;
  float anisotropySquared;

  // LAO
  int kernelSize;
  int kernelRadius;

  // Label outline
  float outlineOpacity;
};
uniform Volume volume;

struct Light {
  vec3 color;
  vec3 positionVC;
  vec3 directionVC; // normalized
  vec3 halfAngleVC;
  vec3 attenuation;
  float exponent;
  float coneAngle;
  int isPositional;
};
#if vtkNumberOfLights > 0
  uniform Light lights[vtkNumberOfLights];
#endif

uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;

// Bitmasks for label outline
const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
#define MAX_SEGMENTS 256
#define UINT_SIZE 32
// We add UINT_SIZE - 1, as we want the ceil of the division instead of the
// floor
#define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)
uint labelOutlineBitmasks[BITMASK_SIZE];

// Set the corresponding bit in the bitmask
void setLabelOutlineBit(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  labelOutlineBitmasks[arrayIndex] |= 1u << bitIndex;
}

// Check if a bit is set in the bitmask
bool isLabelOutlineBitSet(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  return ((labelOutlineBitmasks[arrayIndex] & (1u << bitIndex)) != 0u);
}

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

//VTK::ClipPlane::Dec

// A random number between 0 and 1 that only depends on the fragment
// It uses the jtexture, so this random seed repeats by blocks of 32 fragments
// in screen space
float fragmentSeed;

// sample texture is global
uniform float sampleDistance;
uniform float volumeShadowSampleDistance;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics
// rendering module is complete)
vec3 rayDirVC;

#define INV4PI 0.0796
#define EPSILON 0.001
#define PI 3.1415
#define PI2 9.8696

vec4 rawSampleTexture(vec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    rawSample[0] = texture(volumeTexture[0], pos)[0];
  #if vtkNumberOfComponents > 1
    rawSample[1] = texture(volumeTexture[1], pos)[0];
  #endif
  #if vtkNumberOfComponents > 2
    rawSample[2] = texture(volumeTexture[2], pos)[0];
  #endif
  #if vtkNumberOfComponents > 3
    rawSample[3] = texture(volumeTexture[3], pos)[0];
  #endif
    return rawSample;
  #else
    return texture(volumeTexture[0], pos);
  #endif
}

vec4 rawFetchTexture(ivec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    #if vtkNumberOfComponents > 0
      rawSample[0] = texelFetch(volumeTexture[0], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 1
      rawSample[1] = texelFetch(volumeTexture[1], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 2
      rawSample[2] = texelFetch(volumeTexture[2], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 3
      rawSample[3] = texelFetch(volumeTexture[3], pos, 0)[0];
    #endif
    return rawSample;
  #else
    return texelFetch(volumeTexture[0], pos, 0);
  #endif
}

vec4 getTextureValue(vec3 pos) {
  vec4 tmp = rawSampleTexture(pos);

  // Force nearest
  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volume.dimensions)) + 0.5) *
                      volume.inverseDimensions;
    vec4 nearestValue = rawSampleTexture(nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  // Set alpha when using dependent components
  #ifndef EnabledIndependentComponents
    #if vtkNumberOfComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumberOfComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumberOfComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

// \`height\` is usually \`volume.transferFunctionsSampleHeight[component]\`
// when using independent component and \`0.5\` otherwise. Don't move the if
// statement in these function, as the callers usually already knows if it is
// using independent component or not
float getOpacityFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.opacityTextureScale[component] +
                       volume.opacityTextureShift[component];
  return texture2D(opacityTexture, vec2(scaledScalar, height)).r;
}
vec3 getColorFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.colorTextureScale[component] +
                       volume.colorTextureShift[component];
  return texture2D(colorTexture, vec2(scaledScalar, height)).rgb;
}

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
vec3 posIStoVC(vec3 posIS) {
  return volume.vecISToVCMatrix * posIS + volume.originVC;
}

// convert vector position from vc to idx
vec3 posVCtoIS(vec3 posVC) {
  return volume.vecVCToISMatrix * (posVC - volume.originVC);
}

// Rotate vector to view coordinate
vec3 vecISToVC(vec3 dirIS) {
  return volume.vecISToVCMatrix * dirIS;
}

// Rotate vector to idx coordinate
vec3 vecVCToIS(vec3 dirVC) {
  return volume.vecVCToISMatrix * dirVC;
}

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(float normalMag, int component) {
  float goscale = volume.gradientOpacityScale[component];
  float goshift = volume.gradientOpacityShift[component];
  float gomin = volume.gradientOpacityMin[component];
  float gomax = volume.gradientOpacityMax[component];
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

#ifdef vtkClippingPlanesOn
  bool isPointClipped(vec3 posVC) {
    for (int i = 0; i < clip_numPlanes; ++i) {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0) {
        return true;
      }
    }
    return false;
  }
#endif

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward
// difference

// The output normal is in VC
vec4 computeDensityNormal(vec3 opacityUCoords[2], float opacityTextureHeight,
                          float gradientOpacity, int component) {
  // Pass the scalars through the opacity functions
  vec4 opacityG;
  opacityG.x += getOpacityFromTexture(opacityUCoords[0].x, component,
                                      opacityTextureHeight);
  opacityG.y += getOpacityFromTexture(opacityUCoords[0].y, component,
                                      opacityTextureHeight);
  opacityG.z += getOpacityFromTexture(opacityUCoords[0].z, component,
                                      opacityTextureHeight);
  opacityG.x -= getOpacityFromTexture(opacityUCoords[1].x, component,
                                      opacityTextureHeight);
  opacityG.y -= getOpacityFromTexture(opacityUCoords[1].y, component,
                                      opacityTextureHeight);
  opacityG.z -= getOpacityFromTexture(opacityUCoords[1].z, component,
                                      opacityTextureHeight);

  // Divide by spacing and convert to VC
  opacityG.xyz *= gradientOpacity * volume.inverseSpacing;
  opacityG.w = length(opacityG.xyz);
  if (opacityG.w == 0.0) {
    return vec4(0.0);
  }

  // Normalize
  opacityG.xyz = normalize(vecISToVC(opacityG.xyz));

  return opacityG;
}

// The output normal is in VC
vec4 computeNormalForDensity(vec3 posIS, out vec3 scalarInterp[2],
                             const int opacityComponent) {
  vec3 offsetedPosIS;
  for (int axis = 0; axis < 3; ++axis) {
    // Positive direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] += volume.inverseDimensions[axis];
    scalarInterp[0][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[0][axis] = 0.0;
      }
    #endif

    // Negative direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] -= volume.inverseDimensions[axis];
    scalarInterp[1][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[1][axis] = 0.0;
      }
    #endif
  }

  vec4 result;
  result.xyz = (scalarInterp[0] - scalarInterp[1]) * volume.inverseSpacing;
  result.w = length(result.xyz);
  if (result.w == 0.0) {
    return vec4(0.0);
  }
  result.xyz = normalize(vecISToVC(result.xyz));
  return result;
}

vec4 fragCoordToPCPos(vec4 fragCoord) {
  return vec4((fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
              (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
              (fragCoord.z - 0.5) * 2.0, 1.0);
}

vec4 pcPosToWorldCoord(vec4 pcPos) {
  return volume.PCWCMatrix * pcPos;
}

vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  vec4 vertex = (worldCoord / worldCoord.w);

  vec3 index = (volume.worldToIndex * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) * volume.inverseDimensions;
}

vec3 fragCoordToWorld(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  return worldCoord.xyz;
}

//=======================================================================
// Compute the normals and gradient magnitudes for a position for independent
// components The output normals are in VC
mat4 computeMat4Normal(vec3 posIS, vec4 tValue) {
  vec3 xvec = vec3(volume.inverseDimensions.x, 0.0, 0.0);
  vec3 yvec = vec3(0.0, volume.inverseDimensions.y, 0.0);
  vec3 zvec = vec3(0.0, 0.0, volume.inverseDimensions.z);

  vec4 distX = getTextureValue(posIS + xvec) - getTextureValue(posIS - xvec);
  vec4 distY = getTextureValue(posIS + yvec) - getTextureValue(posIS - yvec);
  vec4 distZ = getTextureValue(posIS + zvec) - getTextureValue(posIS - zvec);

  // divide by spacing
  distX *= 0.5 * volume.inverseSpacing.x;
  distY *= 0.5 * volume.inverseSpacing.y;
  distZ *= 0.5 * volume.inverseSpacing.z;

  mat4 result;

  // optionally compute the 1st component
  #if vtkNumberOfComponents > 0 && !defined(vtkComponent0Proportional)
    {
      const int component = 0;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 2nd component
  #if vtkNumberOfComponents > 1 && !defined(vtkComponent1Proportional)
    {
      const int component = 1;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 3rd component
  #if vtkNumberOfComponents > 2 && !defined(vtkComponent2Proportional)
    {
      const int component = 2;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 4th component
  #if vtkNumberOfComponents > 3 && !defined(vtkComponent3Proportional)
    {
      const int component = 3;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  return result;
}

//=======================================================================
// global shadow - secondary ray

// henyey greenstein phase function
float phaseFunction(float cos_angle) {
  // divide by 2.0 instead of 4pi to increase intensity
  float anisotropy = volume.anisotropy;
  if (abs(anisotropy) <= EPSILON) {
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    return 0.5;
  }
  float anisotropy2 = volume.anisotropySquared;
  return ((1.0 - anisotropy2) /
          pow(1.0 + anisotropy2 - 2.0 * anisotropy * cos_angle, 1.5)) /
         2.0;
}

// Compute the two intersection distances of the ray with the volume in VC
// The entry point is \`rayOriginVC + distanceMin * rayDirVC\` and the exit point
// is \`rayOriginVC + distanceMax * rayDirVC\` If distanceMin < distanceMax, the
// volume is not intersected The ray origin is inside the box when distanceMin <
// 0.0 < distanceMax
vec2 rayIntersectVolumeDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  // Compute origin and direction in IS
  vec3 rayOriginIS = posVCtoIS(rayOriginVC);
  vec3 rayDirIS = vecVCToIS(rayDirVC);
  // Don't check for infinity as the min/max combination afterward will always
  // find an intersection before infinity
  vec3 invDir = 1.0 / rayDirIS;

  // We have: bound = origin + t * dir
  // So: t = (1/dir) * (bound - origin)
  vec3 distancesTo0 = invDir * (vec3(0.0) - rayOriginIS);
  vec3 distancesTo1 = invDir * (vec3(1.0) - rayOriginIS);
  // Min and max distances to plane intersection per plane
  vec3 dMinPerAxis = min(distancesTo0, distancesTo1);
  vec3 dMaxPerAxis = max(distancesTo0, distancesTo1);
  // Overall first and last intersection
  float distanceMin = max(dMinPerAxis.x, max(dMinPerAxis.y, dMinPerAxis.z));
  float distanceMax = min(dMaxPerAxis.x, min(dMaxPerAxis.y, dMaxPerAxis.z));
  return vec2(distanceMin, distanceMax);
}

//=======================================================================
// local ambient occlusion
#if vtkMaxLaoKernelSize > 0

  // Return a random point on the unit sphere
  vec3 sampleDirectionUniform(int rayIndex) {
    // Each ray of each fragment should be different, two sources of randomness
    // are used. Only depends on ray index
    vec2 rayRandomness = kernelSample[rayIndex];
    // Only depends on fragment
    float fragmentRandomness = fragmentSeed;
    // Merge both source of randomness in a single uniform random variable using
    // the formula (x+y < 1 ? x+y : x+y-1). The simpler formula (x+y)/2 doesn't
    // result in a uniform distribution
    vec2 mergedRandom = rayRandomness + vec2(fragmentRandomness);
    mergedRandom -= vec2(greaterThanEqual(mergedRandom, vec2(1.0)));

    // Insipred by:
    // https://karthikkaranth.me/blog/generating-random-points-in-a-sphere/#better-choice-of-spherical-coordinates
    float u = mergedRandom[0];
    float v = mergedRandom[1];
    float theta = u * 2.0 * PI;
    float phi = acos(2.0 * v - 1.0);
    float sinTheta = sin(theta);
    float cosTheta = cos(theta);
    float sinPhi = sin(phi);
    float cosPhi = cos(phi);
    return vec3(sinPhi * cosTheta, sinPhi * sinTheta, cosPhi);
  }

  float computeLAO(vec3 posVC, vec4 normalVC, float originalOpacity) {
    // apply LAO only at selected locations, otherwise return full brightness
    if (normalVC.w <= 0.0 || originalOpacity <= 0.05) {
      return 1.0;
    }

    #ifdef EnabledGradientOpacity
      float gradientOpacityFactor = computeGradientOpacityFactor(normalVC.w, 0);
    #endif

    float visibilitySum = 0.0;
    float weightSum = 0.0;
    for (int i = 0; i < volume.kernelSize; i++) {
      // Only sample on an hemisphere around the normalVC.xyz axis, so
      // normalDotRay should be negative
      vec3 rayDirectionVC = sampleDirectionUniform(i);
      float normalDotRay = dot(normalVC.xyz, rayDirectionVC);
      if (normalDotRay > 0.0) {
        // Flip rayDirectionVC when it is in the wrong hemisphere
        rayDirectionVC = -rayDirectionVC;
        normalDotRay = -normalDotRay;
      }

      vec3 currPosIS = posVCtoIS(posVC);
      float visibility = 1.0;
      vec3 randomDirStepIS = vecVCToIS(rayDirectionVC * sampleDistance);
      for (int j = 0; j < volume.kernelRadius; j++) {
        currPosIS += randomDirStepIS;
        // If out of the volume, we are done
        if (any(lessThan(currPosIS, vec3(0.0))) ||
            any(greaterThan(currPosIS, vec3(1.0)))) {
          break;
        }
        float opacity = getOpacityFromTexture(getTextureValue(currPosIS).r, 0, 0.5);
        #ifdef EnabledGradientOpacity
          opacity *= gradientOpacityFactor;
        #endif
        visibility *= 1.0 - opacity;
        // If visibility is less than EPSILON, consider it to be 0
        if (visibility < EPSILON) {
          visibility = 0.0;
          break;
        }
      }
      float rayWeight = -normalDotRay;
      visibilitySum += visibility * rayWeight;
      weightSum += rayWeight;
    }

    // If no sample, LAO factor is one
    if (weightSum == 0.0) {
      return 1.0;
    }

    // LAO factor is the average visibility:
    // - visibility low => ambient low
    // - visibility high => ambient high
    float lao = visibilitySum / weightSum;

    // Reduce variance by clamping
    return clamp(lao, 0.3, 1.0);
  }
#endif

//=======================================================================
// Volume shadows
#if vtkNumberOfLights > 0

  // Non-memoised version
  float computeVolumeShadowWithoutCache(vec3 posVC, vec3 lightDirNormVC) {
    // modify sample distance with a random number between 1.5 and 3.0
    float rayStepLength =
        volumeShadowSampleDistance * mix(1.5, 3.0, fragmentSeed);

    // in case the first sample near surface has a very tiled light ray, we need
    // to offset start position
    vec3 initialPosVC = posVC + rayStepLength * lightDirNormVC;

    #ifdef vtkClippingPlanesOn
      float clippingPlanesMaxDistance = infinity;
      for (int i = 0; i < clip_numPlanes; ++i) {
        // Find distance of intersection with the plane
        // Points are clipped when:
        // dot(planeOrigin - (rayOrigin + distance * rayDirection), planeNormal) > 0
        // This is equivalent to:
        // dot(planeOrigin - rayOrigin, planeNormal) - distance * dot(rayDirection,
        // planeNormal) > 0.0
        // We precompute the dot products, so we clip ray points when:
        // dotOrigin - distance * dotDirection > 0.0
        float dotOrigin =
            dot(vClipPlaneOrigins[i] - initialPosVC, vClipPlaneNormals[i]);
        if (dotOrigin > 0.0) {
          // The initialPosVC is clipped by this plane
          return 1.0;
        }
        float dotDirection = dot(lightDirNormVC, vClipPlaneNormals[i]);
        if (dotDirection < 0.0) {
          // We only hit the plane if dotDirection is negative, as (distance is
          // positive)
          float intersectionDistance =
              dotOrigin / dotDirection; // negative divided by negative => positive
          clippingPlanesMaxDistance =
              min(clippingPlanesMaxDistance, intersectionDistance);
        }
      }
    #endif

    vec2 intersectionDistances =
        rayIntersectVolumeDistances(initialPosVC, lightDirNormVC);

    if (intersectionDistances[1] <= intersectionDistances[0] ||
        intersectionDistances[1] <= 0.0) {
      // Volume not hit or behind the ray
      return 1.0;
    }

    // When globalIlluminationReach is 0, no sample at all
    // When globalIlluminationReach is 1, the ray will go through the whole
    // volume
    float maxTravelDistance = mix(0.0, volume.diagonalLength,
                                  volume.globalIlluminationReach);
    float startDistance = max(intersectionDistances[0], 0.0);
    float endDistance = min(intersectionDistances[1], startDistance + maxTravelDistance);
    #ifdef vtkClippingPlanesOn
      endDistance = min(endDistance, clippingPlanesMaxDistance);
    #endif
    if (endDistance - startDistance < 0.0) {
      return 1.0;
    }

    // These two variables are used to compute posIS, without having to call
    // VCtoIS at each step
    vec3 initialPosIS = posVCtoIS(initialPosVC);
    // The light dir is scaled and rotated, but not translated, as it is a
    // vector (w = 0)
    vec3 scaledLightDirIS = vecVCToIS(lightDirNormVC);

    float shadow = 1.0;
    for (float currentDistance = startDistance; currentDistance <= endDistance;
          currentDistance += rayStepLength) {
      vec3 posIS = initialPosIS + currentDistance * scaledLightDirIS;
      vec4 scalar = getTextureValue(posIS);
      float opacity = getOpacityFromTexture(scalar.r, 0, 0.5);
      #if defined(EnabledGradientOpacity) && !defined(EnabledIndependentComponents)
        vec3 scalarInterp[2];
        vec4 normal = computeNormalForDensity(posIS, scalarInterp, 3);
        float opacityFactor = computeGradientOpacityFactor(normal.w, 0);
        opacity *= opacityFactor;
      #endif
      shadow *= 1.0 - opacity;

      // Early termination if shadow coeff is near 0.0
      if (shadow < EPSILON) {
        return 0.0;
      }
    }
    return shadow;
  }

  // Some cache for volume shadows
  struct {
    vec3 posVC;
    float shadow;
  } cachedShadows[vtkNumberOfLights];

  // Memoised version
  float computeVolumeShadow(vec3 posVC, vec3 lightDirNormVC, int lightIdx) {
    if (posVC == cachedShadows[lightIdx].posVC) {
      return cachedShadows[lightIdx].shadow;
    }
    float shadow = computeVolumeShadowWithoutCache(posVC, lightDirNormVC);
    cachedShadows[lightIdx].posVC = posVC;
    cachedShadows[lightIdx].shadow = shadow;
    return shadow;
  }

#endif

//=======================================================================
// surface light contribution
#if vtkNumberOfLights > 0
  vec3 applyLighting(vec3 tColor, vec4 normalVC) {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      float df = dot(normalVC.xyz, lights[lightIdx].directionVC);
      if (df > 0.0) {
        diffuse += df * lights[lightIdx].color;
        float sf = dot(normalVC.xyz, -lights[lightIdx].halfAngleVC);
        if (sf > 0.0) {
          specular += pow(sf, volume.specularPower) * lights[lightIdx].color;
        }
      }
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient) +
          specular * volume.specular;
  }

  vec3 applySurfaceShadowLighting(vec3 tColor, float alpha, vec3 posVC,
                                  vec4 normalVC) {
    // everything in VC
    vec3 diffuse = vec3(0.0);
    vec3 specular = vec3(0.0);
    for (int ligthIdx = 0; ligthIdx < vtkNumberOfLights; ligthIdx++) {
      vec3 vertLightDirection;
      float attenuation;
      if (lights[ligthIdx].isPositional == 1) {
        vertLightDirection = posVC - lights[ligthIdx].positionVC;
        float lightDistance = length(vertLightDirection);
        // Normalize with precomputed length
        vertLightDirection = vertLightDirection / lightDistance;
        // Base attenuation
        vec3 attenuationPolynom = lights[ligthIdx].attenuation;
        attenuation =
            1.0 / (attenuationPolynom[0] +
                  lightDistance * (attenuationPolynom[1] +
                                    lightDistance * attenuationPolynom[2]));
        // Cone attenuation
        float coneDot = dot(vertLightDirection, lights[ligthIdx].directionVC);
        // Per OpenGL standard cone angle is 90 or less for a spot light
        if (lights[ligthIdx].coneAngle <= 90.0) {
          if (coneDot >= cos(radians(lights[ligthIdx].coneAngle))) {
            // Inside the cone
            attenuation *= pow(coneDot, lights[ligthIdx].exponent);
          } else {
            // Outside the cone
            attenuation = 0.0;
          }
        }
      } else {
        vertLightDirection = lights[ligthIdx].directionVC;
        attenuation = 1.0;
      }

      float ndotL = dot(normalVC.xyz, vertLightDirection);
      if (ndotL < 0.0 && twoSidedLighting == 1) {
        ndotL = -ndotL;
      }
      if (ndotL > 0.0) {
        // Diffuse
        diffuse += ndotL * attenuation * lights[ligthIdx].color;
        // Specular
        float vdotR =
            dot(-rayDirVC, normalize(vertLightDirection - 2.0 * ndotL * normalVC.xyz));
        if (vdotR > 0.0) {
          specular += pow(vdotR, volume.specularPower) * attenuation *
                      lights[ligthIdx].color;
        }
      }
    }
    #if vtkMaxLaoKernelSize > 0
      float laoFactor = computeLAO(posVC, normalVC, alpha);
    #else
      const float laoFactor = 1.0;
    #endif
    return tColor * (diffuse * volume.diffuse +
                    volume.ambient * laoFactor) +
          specular * volume.specular;
  }

  vec3 applyVolumeShadowLighting(vec3 tColor, vec3 posVC) {
    // Here we have no effect of cones and no attenuation
    vec3 diffuse = vec3(0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      vec3 lightDirVC = lights[lightIdx].isPositional == 1
                            ? normalize(lights[lightIdx].positionVC - posVC)
                            : -lights[lightIdx].directionVC;
      float shadowCoeff = computeVolumeShadow(posVC, lightDirVC, lightIdx);
      float phaseAttenuation = phaseFunction(dot(rayDirVC, lightDirVC));
      diffuse += phaseAttenuation * shadowCoeff * lights[lightIdx].color;
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient);
  }
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posVC,
                       vec4 surfaceNormalVC) {
  #if vtkNumberOfLights > 0
    // 0 <= volCoeff < EPSILON => only surface shadows
    // EPSILON <= volCoeff < 1 - EPSILON => mix of surface and volume shadows
    // 1 - EPSILON <= volCoeff => only volume shadows
    float volCoeff = volume.volumetricScatteringBlending *
                    (1.0 - alpha / 2.0) *
                    (1.0 - atan(surfaceNormalVC.w) * INV4PI);

    // Compute surface lighting if needed
    vec3 surfaceShadedColor = tColor;
    #ifdef EnableSurfaceLighting
      if (volCoeff < 1.0 - EPSILON) {
        surfaceShadedColor =
            applySurfaceShadowLighting(tColor, alpha, posVC, surfaceNormalVC);
      }
    #endif

    // Compute volume lighting if needed
    vec3 volumeShadedColor = tColor;
    #ifdef EnableVolumeLighting
      if (volCoeff >= EPSILON) {
        volumeShadedColor = applyVolumeShadowLighting(tColor, posVC);
      }
    #endif

    // Return the right mix
    if (volCoeff < EPSILON) {
      // Surface shadows
      return surfaceShadedColor;
    }
    if (volCoeff >= 1.0 - EPSILON) {
      // Volume shadows
      return volumeShadedColor;
    }
    // Mix of surface and volume shadows
    return mix(surfaceShadedColor, volumeShadedColor, volCoeff);
  #endif
  return tColor;
}

vec4 getColorForLabelOutline() {
  vec3 centerPosIS =
      fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = vec4(getColorFromTexture(centerValue.r, 0, 0.5),
                     getOpacityFromTexture(centerValue.r, 0, 0.5));

  int segmentIndex = int(centerValue.r * 255.0);

  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue =
      texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;
  int actualThickness = int(textureValue * 255.0);

  // If it is the background (segment index 0), we should quickly bail out.
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0) {
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't
  // invisible. Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord =
          vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j),
               gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = volume.outlineOpacity;
  }

  return tColor;
}

vec4 getColorForAdditivePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLights[2];
  normalLights[0] = normalMat[0];
  normalLights[1] = normalMat[1];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      for (int component = 0; component < 2; ++component) {
        vec3 scalarInterp[2];
        float height = volume.transferFunctionsSampleHeight[component];
        computeNormalForDensity(posIS, scalarInterp, component);
        normalLights[component] =
            computeDensityNormal(scalarInterp, height, 1.0, component);
      }
    }
  #endif

  // compute opacities
  float opacities[2];
  opacities[0] = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  opacities[1] = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);
  #ifdef EnabledGradientOpacity
    for (int component = 0; component < 2; ++component) {
      opacities[component] *=
          computeGradientOpacityFactor(normalMat[component].a, component);
    }
  #endif
  float opacitySum = opacities[0] + opacities[1];
  if (opacitySum <= 0.0) {
    return vec4(0.0);
  }

  // mix the colors and opacities
  vec3 colors[2];
  for (int component = 0; component < 2; ++component) {
    float sampleHeight = volume.transferFunctionsSampleHeight[component];
    vec3 color = getColorFromTexture(tValue[component], component, sampleHeight);
    color = applyAllLightning(color, opacities[component], posVC,
                              normalLights[component]);
    colors[component] = color;
  }
  vec3 mixedColor =
      (opacities[0] * colors[0] + opacities[1] * colors[1]) / opacitySum;
  return vec4(mixedColor, min(1.0, opacitySum));
}

vec4 getColorForColorizePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLight = normalMat[0];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      vec3 scalarInterp[2];
      float height = volume.transferFunctionsSampleHeight[0];
      computeNormalForDensity(posIS, scalarInterp, 0);
      normalLight = computeDensityNormal(scalarInterp, height, 1.0, 0);
    }
  #endif

  // compute opacities
  float opacity = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  #ifdef EnabledGradientOpacity
    opacity *= computeGradientOpacityFactor(normalMat[0].a, 0);
  #endif

  // colorizing component
  vec3 colorizingColor = getColorFromTexture(
      tValue[0], 1, volume.transferFunctionsSampleHeight[1]);
  float colorizingOpacity = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);

  // mix the colors and opacities
  vec3 color =
      getColorFromTexture(tValue[0], 0,
                          volume.transferFunctionsSampleHeight[0]) *
      mix(vec3(1.0), colorizingColor, colorizingOpacity);
  color = applyAllLightning(color, opacity, posVC, normalLight);
  return vec4(color, opacity);
}

vec4 getColorForDefaultIndependentPreset(vec4 tValue, vec3 posIS) {

  // compute the normal vectors as needed
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    mat4 normalMat = computeMat4Normal(posIS, tValue);
  #endif

  // process color and opacity for each component
  // initial value of alpha is determined by wether the first component is
  // proportional or not
  #if defined(vtkComponent0Proportional)
    // when it is proportional, it starts at 1 (neutral for multiplications)
    float alpha = 1.0;
  #else
    // when it is not proportional, it starts at 0 (neutral for additions)
    float alpha = 0.0;
  #endif

  vec3 mixedColor = vec3(0.0);
  #if vtkNumberOfComponents > 0
    {
      const int component = 0;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent0Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 1
    {
      const int component = 1;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent1Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 2
    {
      const int component = 2;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent2Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 3
    {
      const int component = 3;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent3Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif

  return vec4(mixedColor, alpha);
}

vec4 getColorForDependentComponents(vec4 tValue, vec3 posVC, vec3 posIS) {
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    // use component 3 of the opacity texture as getTextureValue() sets alpha to
    // the opacity value
    vec3 scalarInterp[2];
    vec4 normal0 = computeNormalForDensity(posIS, scalarInterp, 3);
    float gradientOpacity = computeGradientOpacityFactor(normal0.a, 0);
  #endif

  // get color and opacity
  #if vtkNumberOfComponents == 1
    vec3 tColor = getColorFromTexture(tValue.r, 0, 0.5);
    float alpha = getOpacityFromTexture(tValue.r, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 2
    vec3 tColor = vec3(tValue.r * volume.colorTextureScale[0] +
                  volume.colorTextureShift[0]);
    float alpha = getOpacityFromTexture(tValue.a, 1, 0.5);
  #endif
  #if vtkNumberOfComponents == 3
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 4
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 3, 0.5);
  #endif

  // Apply gradient opacity
  #if defined(EnabledGradientOpacity)
    alpha *= gradientOpacity;
  #endif

  #if vtkNumberOfComponents == 1
    if (alpha < EPSILON) {
      return vec4(0.0);
    }
  #endif

  // lighting
  #if vtkNumberOfLights > 0
    vec4 normalLight;
    if (volume.computeNormalFromOpacity == 1) {
      if (normal0[3] != 0.0) {
        normalLight =
            computeDensityNormal(scalarInterp, 0.5, gradientOpacity, 0);
        if (normalLight[3] == 0.0) {
          normalLight = normal0;
        }
      }
    } else {
      normalLight = normal0;
    }
    tColor = applyAllLightning(tColor, alpha, posVC, normalLight);
  #endif

  return vec4(tColor, alpha);
}

vec4 getColorForValue(vec4 tValue, vec3 posVC, vec3 posIS) {
  #ifdef EnableColorForValueFunctionId0
    return getColorForDependentComponents(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId1
    return getColorForAdditivePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId2
    return getColorForColorizePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId3
    /*
      * Mix the color information from all the independent components to get a
      * single rgba output. See other shader functions like
      * \`getColorForAdditivePreset\` to learn how to create a custom color mix.
      * The custom color mix should return a value, but if it doesn't, it will
      * fallback on the default shading
      */
    //VTK::CustomColorMix
  #endif

  #if defined(EnableColorForValueFunctionId4) || defined(EnableColorForValueFunctionId3)
    return getColorForDefaultIndependentPreset(tValue, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId5
    return getColorForLabelOutline();
  #endif
}

bool valueWithinScalarRange(vec4 val) {
  #if vtkNumberOfComponents > 1 && !defined(EnabledIndependentComponents)
    return false;
  #endif
  vec4 rangeMin = volume.ipScalarRangeMin;
  vec4 rangeMax = volume.ipScalarRangeMax;
  for (int component = 0; component < vtkNumberOfComponents; ++component) {
    if (val[component] < rangeMin[component] ||
        rangeMax[component] < val[component]) {
      return false;
    }
  }
  return true;
}

#if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
  bool checkOnEdgeForNeighbor(int xFragmentOffset, int yFragmentOffset,
                              int segmentIndex, vec3 stepIS) {
    vec3 volumeDimensions = vec3(volume.dimensions);
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(xFragmentOffset),
                                  gl_FragCoord.y + float(yFragmentOffset),
                                  gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    vec3 neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS += stepIS;
    }

    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS -= stepIS;
    }

    // onedge
    float sampleHeight = volume.transferFunctionsSampleHeight[1];
    vec3 tColorSegment =
        getColorFromTexture(float(segmentIndex), 1, sampleHeight);
    float pwfValueSegment =
        getOpacityFromTexture(float(segmentIndex), 1, sampleHeight);
    gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
    return true;
  }
#endif

vec4 getColorAtPos(vec3 posVC) {
  vec3 posIS = posVCtoIS(posVC);
  vec4 texValue = getTextureValue(posIS);
  return getColorForValue(texValue, posVC, posIS);
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 rayOriginVC, vec3 rayDirVC, float minDistance,
                float maxDistance) {
  // start slightly inside and apply some jitter
  vec3 stepVC = rayDirVC * sampleDistance;
  float raySteps = (maxDistance - minDistance) / sampleDistance;

  // Avoid 0.0 jitter
  float jitter = 0.01 + 0.99 * fragmentSeed;

  #if vtkBlendMode == COMPOSITE_BLEND
    // now map through opacity and color
    vec3 firstPosVC = rayOriginVC + minDistance * rayDirVC;
    vec4 firstColor = getColorAtPos(firstPosVC);

    // handle very thin volumes
    if (raySteps <= 1.0) {
      firstColor.a = 1.0 - pow(1.0 - firstColor.a, raySteps);
      gl_FragData[0] = firstColor;
      return;
    }

    // first color only counts for \`jitter\` factor of the step
    firstColor.a = 1.0 - pow(1.0 - firstColor.a, jitter);
    vec4 color = vec4(firstColor.rgb * firstColor.a, firstColor.a);
    vec3 posVC = firstPosVC + jitter * stepVC;
    float stepsTraveled = jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }
      vec4 tColor = getColorAtPos(posVC);

      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * (1.0 - color.a);
      stepsTraveled++;
      posVC += stepVC;
      if (color.a > 0.99) {
        color.a = 1.0;
        break;
      }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0) {
      vec3 endPosVC = rayOriginVC + maxDistance * rayDirVC;
      vec4 tColor = getColorAtPos(endPosVC);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * mix;
    }

    gl_FragData[0] = vec4(color.rgb / color.a, color.a);
  #endif

  #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND ||                                 \\
      vtkBlendMode == MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND
      #define OP max
    #else
      #define OP min
    #endif

    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // Find a value to initialize the selected variables
    vec4 selectedValue;
    vec3 selectedPosVC;
    vec3 selectedPosIS;
    {
      vec3 posIS = posVCtoIS(posVC);
      selectedValue = getTextureValue(posIS);
      selectedPosVC = posVC;
      selectedPosIS = posIS;
    }

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // Get selected values
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    {
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }
    }

    gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
  #endif

  #if vtkBlendMode == ADDITIVE_INTENSITY_BLEND ||                                \\
      vtkBlendMode == AVERAGE_INTENSITY_BLEND
    vec4 sum = vec4(0.);
    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      float totalWeight = 0.0;
    #endif
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    vec3 posIS = posVCtoIS(posVC);
    vec4 value = getTextureValue(posIS);

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(value * raySteps, posVC, posIS);
      return;
    }

    if (valueWithinScalarRange(value)) {
      sum += value * jitter;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += jitter;
      #endif
    }
    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      posIS = posVCtoIS(posVC);
      value = getTextureValue(posIS);
      // One can control the scalar range by setting the AverageIPScalarRange to
      // disregard scalar values, not in the range of interest, from the average
      // computation. Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(value)) {
        sum += value;
        #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
          totalWeight++;
        #endif
      }

      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    posIS = posVCtoIS(posVC);
    value = getTextureValue(posIS);
    if (valueWithinScalarRange(value)) {
      sum += value;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += raySteps - stepsTraveled;
      #endif
    }

    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      sum /= vec4(totalWeight, totalWeight, totalWeight, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posVC, posIS);
  #endif

  #if vtkBlendMode == RADON_TRANSFORM_BLEND
    float normalizedRayIntensity = 1.0;
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // handle very thin volumes
    if (raySteps <= 1.0) {
      vec3 posIS = posVCtoIS(posVC);
      vec4 tValue = getTextureValue(posIS);
      normalizedRayIntensity -= raySteps * sampleDistance *
                                getOpacityFromTexture(tValue.r, 0, 0.5);
      gl_FragData[0] =
          vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      vec3 posIS = posVCtoIS(posVC);
      vec4 value = getTextureValue(posIS);
      // Convert scalar value to normalizedRayIntensity coefficient and
      // accumulate normalizedRayIntensity
      normalizedRayIntensity -=
          sampleDistance * getOpacityFromTexture(value.r, 0, 0.5);

      posVC += stepVC;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] =
        vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
  #endif

  #if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
    // Only works with a single volume
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;
    vec3 posIS = posVCtoIS(posVC);
    vec4 tValue = getTextureValue(posIS);
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(tValue, posVC, posIS);
      return;
    }

    vec3 stepIS = vecVCToIS(stepVC);
    vec4 value = tValue;
    posIS += jitter * stepIS;
    stepsTraveled += jitter;
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the
      // segment index and later check if the bit is set via bit operations
      setLabelOutlineBit(segmentIndex);
    }

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setLabelOutlineBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value = tValue;   // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = posVCtoIS(rayOriginVC + maxDistance * rayDirVC);
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue;   // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      vec3 maxPosVC = posIStoVC(maxPosIS);
      gl_FragData[0] = getColorForValue(value, maxPosVC, maxPosIS);
      return;
    }

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    vec3 volumeSpacings = volume.spacing;
    float minVoxelSpacing =
        min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base =
        vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z,
                          gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z,
                          gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not
      // been seen by the center segment
      if (!isLabelOutlineBitSet(s)) {
        continue;
      }

      // Use texture sampling for outlineThickness so that we can have
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue =
          texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out
      // faster if we find the edge
      bool onEdge = checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s,
                                          stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety
      // of the all the fragments inside. i.e., this happens when we zoom out,
      if (minVoxelSpacing >
          (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }

      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
        for (int j = -actualThickness; j <= actualThickness; j++) {
          if (i == 0 && j == 0)
            continue; // Skip the center
          if (abs(i) == actualThickness && abs(j) == actualThickness)
            continue; // Skip corners
          if (checkOnEdgeForNeighbor(i, j, s, stepIS)) {
            return;
          }
        }
      }
    }

    float sampleHeight = volume.transferFunctionsSampleHeight[0];
    vec3 tColor0 = getColorFromTexture(value.r, 0, sampleHeight);
    float pwfValue0 = getOpacityFromTexture(value.r, 0, sampleHeight);
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  vec2 dists = rayIntersectVolumeDistances(rayOriginVC, rayDirVC);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0, dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick / rayDirVC.z;
  dists.y = min(farDist, dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

float getFragmentSeed() {
  // This first noise has a diagonal pattern
  float firstNoise =
      fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);
  // This second noise is made out of blocks of CPU generated noise
  float secondNoise = texture2D(jtexture, gl_FragCoord.xy / 32.0).r;
  // Combine the two sources of noise in a way that the distribution is uniform
  // in [0,1[
  float noiseSum = firstNoise + secondNoise;
  return noiseSum < 1.0 ? noiseSum : noiseSum - 1.0;
}

void main() {
  fragmentSeed = getFragmentSeed();

  if (cameraParallel == 1) {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 rayOriginVC = vertexVCVSOutput;
  vec2 rayStartEndDistancesVC = computeRayDistances(rayOriginVC, rayDirVC);
  if (rayStartEndDistancesVC[1] <= rayStartEndDistancesVC[0] ||
      rayStartEndDistancesVC[1] <= 0.0) {
    // Volume not hit or behind the ray
    discard;
  }

  // Perform the blending operation along the ray
  applyBlend(rayOriginVC, rayDirVC, rayStartEndDistancesVC[0], rayStartEndDistancesVC[1]);
}
`;const{vtkWarningMacro:wI,vtkErrorMacro:lm}=Dr,SI={idxToView:Ze(new Float64Array(16)),vecISToVCMatrix:bi(new Float64Array(9)),modelToView:Ze(new Float64Array(16)),projectionToView:Ze(new Float64Array(16)),projectionToWorld:Ze(new Float64Array(16))};function xI(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function n(l,f){const u=l.getIndependentComponents(),g=l.getColorMixPreset();return u&&f>=2||!!g}function r(l){return l.getUseLabelOutline()||e.renderable.getBlendMode()===ml.LABELMAP_EDGE_PROJECTION_BLEND}const i=new Map;function a(l,f){if(!f)return;const g=(i.get(f)??0)-1;g<=0?(l.unregisterGraphicsResourceUser(f,t),i.delete(f)):i.set(f,g)}function o(l,f){if(!f)return;const u=i.get(f)??0,g=u+1;i.set(f,g),u<=0&&l.registerGraphicsResourceUser(f,t)}function s(l,f,u){f!==u&&(a(l,f),o(l,u))}function c(l){[...i.keys()].forEach(f=>l.unregisterGraphicsResourceUser(f,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(l,f)=>{if(l){const u=f.getZBufferTexture();u!==e.zBufferTexture&&(e.zBufferTexture=u)}},t.opaqueZBufferPass=(l,f)=>t.zBufferPass(l,f),t.volumePass=(l,f)=>{if(l){const u=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),u&&!u.isDeleted()&&u!==e._openGLRenderWindow&&c(u),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const g=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const d=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(d.getActiveCamera()),t.renderPiece(d,g)}},t.getShaderTemplate=(l,f,u)=>{l.Vertex=TI,l.Fragment=CI,l.Geometry=""},t.replaceShaderValues=(l,f,u)=>{let g=l.Fragment;g=ce.substitute(g,"//VTK::EnabledColorFunctions",`#define EnableColorForValueFunctionId${e.previousState.colorForValueFunctionId}`).result;const d=[];e.previousState.surfaceLightingEnabled&&d.push("Surface"),e.previousState.volumeLightingEnabled&&d.push("Volume"),g=ce.substitute(g,"//VTK::EnabledLightings",d.map(h=>`#define Enable${h}Lighting`)).result,e.previousState.multiTexturePerVolumeEnabled&&(g=ce.substitute(g,"//VTK::EnabledMultiTexturePerVolume","#define EnabledMultiTexturePerVolume").result),e.previousState.useIndependentComponents&&(g=ce.substitute(g,"//VTK::EnabledIndependentComponents","#define EnabledIndependentComponents").result),e.previousState.gradientOpacityEnabled&&(g=ce.substitute(g,"//VTK::EnabledGradientOpacity","#define EnabledGradientOpacity").result),g=ce.substitute(g,"//VTK::vtkProportionalComponents",e.previousState.proportionalComponents.map(h=>`#define vtkComponent${h}Proportional`).join(`
`)).result,g=ce.substitute(g,"//VTK::vtkForceNearestComponents",e.previousState.forceNearestComponents.map(h=>`#define vtkComponent${h}ForceNearest`).join(`
`)).result,e.previousState.hasZBufferTexture&&(g=ce.substitute(g,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,g=ce.substitute(g,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDirVC.z;","dists.y = min(zdepth,dists.y);"]).result),g=ce.substitute(g,"//VTK::BlendMode",`${e.previousState.blendMode}`).result,g=ce.substitute(g,"//VTK::NumberOfLights",`${e.previousState.numberOfLights}`).result,g=ce.substitute(g,"//VTK::MaxLaoKernelSize",`${e.previousState.maxLaoKernelSize}`).result,g=ce.substitute(g,"//VTK::NumberOfComponents",`${e.previousState.numberOfComponents}`).result,g=ce.substitute(g,"//VTK::MaximumNumberOfSamples",`${e.previousState.maximumNumberOfSamples}`).result,l.Fragment=g;const p=e.previousState.numberOfClippingPlanes;p>0&&(g=ce.substitute(g,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,g=ce.substitute(g,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${p}; i++) {`,"  float rayDirRatio = dot(rayDirVC, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result),l.Fragment=g},t.getNeedToRebuildShaders=(l,f,u)=>{const g=!!e.zBufferTexture,d=e.currentValidInputs.length,p=e.numberOfLights,h=e.numberOfComponents,m=e.useIndependentComponents,v=u.getProperties(),y=e.currentValidInputs[0],T=v[y.inputIndex],C=d>1,w=y.imageData.getBounds(),S=xt.getDiagonalLength(w),_=Math.ceil(S/t.getCurrentSampleDistance(f));_>e.renderable.getMaximumSamplesPerRay()&&wI(`The number of steps required ${_} is larger than the specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
Please either change the volumeMapper sampleDistance or its maximum number of samples.`);const D=m?h:1;let N=!1;for(let de=0;de<D;++de)if(T.getUseGradientOpacity(de)){N=!0;break}let P=0;const F=T.getLAOKernelSize();F>P&&T.getLocalAmbientOcclusion()&&T.getAmbient()>0&&(P=F);const B=e.renderable.getClippingPlanes().length,k=e.renderable.getViewSpecificProperties().OpenGL?.ShaderReplacements,U=e.currentRenderPass?.getShaderReplacement(),H=e.renderable.getBlendMode(),W=(()=>{if(H!==ml.LABELMAP_EDGE_PROJECTION_BLEND&&r(T))return 5;if(m)switch(T.getColorMixPreset()){case pf.ADDITIVE:return 1;case pf.COLORIZE:return 2;case pf.CUSTOM:return 3;default:return 4}return 0})(),J=T.getVolumetricScatteringBlending()<1,ne=T.getVolumetricScatteringBlending()>0;let q=!1;for(let de=0;de<h;++de)if(T.getForceNearestInterpolation(de)){q=!0;break}const Q=[],ae=[];for(let de=0;de<h;de++)T.getOpacityMode(de)===s6.PROPORTIONAL&&Q.push(de),T.getForceNearestInterpolation(de)&&ae.push(de);const me={numberOfComponents:h,useIndependentComponents:m,proportionalComponents:Q,forceNearestComponents:ae,blendMode:H,numberOfLights:p,numberOfValidInputs:d,maximumNumberOfSamples:_,hasZBufferTexture:g,maxLaoKernelSize:P,numberOfClippingPlanes:B,mapperShaderReplacements:k,renderPassShaderReplacements:U,colorForValueFunctionId:W,surfaceLightingEnabled:J,volumeLightingEnabled:ne,forceNearestInterpolationEnabled:q,multiTexturePerVolumeEnabled:C,gradientOpacityEnabled:N};return l.getProgram()?.getHandle()===0||!e.previousState||!zh(e.previousState,me)?(e.previousState=me,!0):!1},t.updateShaders=(l,f,u)=>{if(t.getNeedToRebuildShaders(l,f,u)){const g={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(g,f,u);const d=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(g.Vertex,g.Fragment,g.Geometry);d!==l.getProgram()&&(l.setProgram(d),l.getVAO().releaseGraphicsResources()),l.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(l.getProgram());l.getVAO().bind(),t.setMapperShaderParameters(l,f,u),t.setCameraShaderParameters(l,f,u),t.setPropertyShaderParameters(l,f,u),t.getClippingPlaneShaderParameters(l,f,u)},t.setMapperShaderParameters=(l,f,u)=>{const g=l.getProgram();l.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>l.getAttributeUpdateTime().getMTime()||l.getShaderSourceTime().getMTime()>l.getAttributeUpdateTime().getMTime())&&(g.isAttributeUsed("vertexDC")&&(l.getVAO().addAttributeArray(g,l.getCABO(),"vertexDC",l.getCABO().getVertexOffset(),l.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||lm("Error setting vertexDC in shader VAO.")),l.getAttributeUpdateTime().modified());const d=t.getCurrentSampleDistance(f);g.setUniformf("sampleDistance",d);const p=d*e.renderable.getVolumeShadowSamplingDistFactor();g.setUniformf("volumeShadowSampleDistance",p),e.scalarTextures.forEach((_,D)=>{g.setUniformi(`volumeTexture[${D}]`,_.getTextureUnit())});const h=u.getProperties(),m=e.currentValidInputs[0],y=h[m.inputIndex].getIpScalarRange(),T=new Float32Array(4),C=new Float32Array(4),w=(_,D,N)=>{D?.dataComputedScale?.length&&(T[_]=y[0]*D.dataComputedScale[N]+D.dataComputedOffset[N],C[_]=y[1]*D.dataComputedScale[N]+D.dataComputedOffset[N],T[_]=(T[_]-D.offset[N])/D.scale[N],C[_]=(C[_]-D.offset[N])/D.scale[N])};if(e.previousState.multiTexturePerVolumeEnabled)e.scalarTextures.forEach((_,D)=>{const N=_.getVolumeInfo();w(D,N,0)});else{const _=e.scalarTextures[0].getVolumeInfo();for(let D=0;D<4;++D)w(D,_,D)}const S="volume";if(g.setUniform4f(`${S}.ipScalarRangeMin`,T[0],T[1],T[2],T[3]),g.setUniform4f(`${S}.ipScalarRangeMax`,C[0],C[1],C[2],C[3]),e.zBufferTexture!==null){g.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const _=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();g.setUniformf("vpZWidth",_[0]),g.setUniformf("vpZHeight",_[1])}},t.setCameraShaderParameters=(l,f,u)=>{const{idxToView:g,vecISToVCMatrix:d,modelToView:p,projectionToView:h,projectionToWorld:m}=SI,v=e.openGLCamera.getKeyMatrices(f),y=e.openGLVolume.getKeyMatrices();rt(p,v.wcvc,y.mcwc);const T=l.getProgram(),C=e.openGLCamera.getRenderable(),w=C.getParallelProjection(),S=C.getClippingRange();T.setUniformf("camThick",S[1]-S[0]),T.setUniformf("camNear",S[0]),T.setUniformf("camFar",S[1]),T.setUniformi("cameraParallel",w);const _=e.currentValidInputs[0],D=_.imageData.getBounds(),P=xt.getCorners(D,[]).map(ke=>{if(At(ke,ke,p),!w){const Xe=-S[0]/(ke[2]*hs(ke));zi(ke,ke,Xe)}return At(ke,ke,v.vcpc),ke}),F=xt.addPoints([...xt.INIT_BOUNDS],P);T.setUniformf("dcxmin",F[0]),T.setUniformf("dcxmax",F[1]),T.setUniformf("dcymin",F[2]),T.setUniformf("dcymax",F[3]);const B=t.getRenderTargetSize();T.setUniformf("vpWidth",B[0]),T.setUniformf("vpHeight",B[1]);const k=t.getRenderTargetOffset();T.setUniformf("vpOffsetX",k[0]/B[0]),T.setUniformf("vpOffsetY",k[1]/B[1]),In(h,v.vcpc),T.setUniformMatrix("PCVCMatrix",h),T.setUniformi("twoSidedLighting",f.getTwoSidedLighting());const U=new Array(2*e.previousState.maxLaoKernelSize);for(let ke=0;ke<e.previousState.maxLaoKernelSize;ke++)U[ke*2]=Math.random(),U[ke*2+1]=Math.random();if(T.setUniform2fv("kernelSample",U),e.numberOfLights>0){let ke=0;f.getLights().forEach(Xe=>{if(Xe.getSwitch()>0){const et=`lights[${ke}]`,$t=Xe.getColor(),Zt=Xe.getIntensity(),Kt=zi([],$t,Zt);T.setUniform3fv(`${et}.color`,Kt);const Jt=Xe.getTransformedPosition();At(Jt,Jt,p),T.setUniform3fv(`${et}.positionVC`,Jt);const qt=[...Xe.getDirection()];Jf(qt,qt,v.normalMatrix),Ht(qt,qt),T.setUniform3fv(`${et}.directionVC`,qt);const on=[-.5*qt[0],-.5*qt[1],-.5*(qt[2]-1)];T.setUniform3fv(`${et}.halfAngleVC`,on);const tn=Xe.getAttenuationValues();T.setUniform3fv(`${et}.attenuation`,tn);const ir=Xe.getExponent();T.setUniformf(`${et}.exponent`,ir);const $=Xe.getConeAngle();T.setUniformf(`${et}.coneAngle`,$);const j=Xe.getPositional();T.setUniformi(`${et}.isPositional`,j),ke++}})}const H="volume",J=u.getProperties()[_.inputIndex],ne=_.imageData,q=ne.getSpatialExtent(),Q=ne.getSpacing(),ae=ne.getDimensions(),me=ne.getIndexToWorld(),de=ne.getWorldToIndex(),je=ne.getDirectionByReference();rt(g,p,me),T.setUniform3fv(`${H}.spacing`,Q);const $e=Zf([],Q);T.setUniform3fv(`${H}.inverseSpacing`,$e),T.setUniform3iv(`${H}.dimensions`,ae),T.setUniform3fv(`${H}.inverseDimensions`,Zf([],ae)),T.setUniformMatrix(`${H}.worldToIndex`,de),d.fill(0);const Be=p8(new Float64Array(3),ae,Q);d[0]=Be[0],d[4]=Be[1],d[8]=Be[2],fc(d,je,d),fc(d,y.normalMatrix,d),fc(d,v.normalMatrix,d),T.setUniformMatrix3x3(`${H}.vecISToVCMatrix`,d),T.setUniformMatrix3x3(`${H}.vecVCToISMatrix`,ds(new Float32Array(9),d));const qe=Et(q[0],q[2],q[4]),Qe=At(new Float64Array(3),qe,g);T.setUniform3fv(`${H}.originVC`,Qe);const ut=hs(Be);if(T.setUniformf(`${H}.diagonalLength`,ut),r(J)){const ke=C.getDistance();C.setClippingRange(ke,ke+.1);const Xe=e.openGLCamera.getKeyMatrices(f);In(m,Xe.wcpc),C.setClippingRange(S[0],S[1]),e.openGLCamera.getKeyMatrices(f),T.setUniformMatrix(`${H}.PCWCMatrix`,m)}if(J.getVolumetricScatteringBlending()>0&&(T.setUniformf(`${H}.globalIlluminationReach`,J.getGlobalIlluminationReach()),T.setUniformf(`${H}.volumetricScatteringBlending`,J.getVolumetricScatteringBlending()),T.setUniformf(`${H}.anisotropy`,J.getAnisotropy()),T.setUniformf(`${H}.anisotropySquared`,J.getAnisotropy()**2)),J.getLocalAmbientOcclusion()&&J.getAmbient()>0){const ke=J.getLAOKernelSize();T.setUniformi(`${H}.kernelSize`,ke);const Xe=J.getLAOKernelRadius();T.setUniformi(`${H}.kernelRadius`,Xe)}else T.setUniformi(`${H}.kernelSize`,0)},t.setPropertyShaderParameters=(l,f,u)=>{const g=l.getProgram();g.setUniformi("jtexture",e.jitterTexture.getTextureUnit());const d=u.getProperties();g.setUniformi("labelOutlineThicknessTexture",e.labelOutlineThicknessTexture.getTextureUnit()),g.setUniformi("opacityTexture",e.opacityTexture.getTextureUnit()),g.setUniformi("colorTexture",e.colorTexture.getTextureUnit());const p="volume",h=e.currentValidInputs[0],m=d[h.inputIndex],v=e.previousState.numberOfComponents,y=e.previousState.useIndependentComponents;if(y){const P=new Float32Array(4);for(let k=0;k<v;k++)P[k]=m.getComponentWeight(k);g.setUniform4fv(`${p}.independentComponentMix`,P);const F=new Float32Array(4),B=1/v;for(let k=0;k<v;++k)F[k]=(k+.5)*B;g.setUniform4fv(`${p}.transferFunctionsSampleHeight`,F)}const T=e.colorForValueFunctionId;g.setUniformi(`${p}.colorForValueFunctionId`,T);const C=m.getComputeNormalFromOpacity();g.setUniformi(`${p}.computeNormalFromOpacity`,C);const w=new Float32Array(4),S=new Float32Array(4),_=new Float32Array(4),D=new Float32Array(4);for(let P=0;P<v;P++){const F=e.previousState.multiTexturePerVolumeEnabled,B=F?P:0,k=F?0:P,H=e.scalarTextures[B].getVolumeInfo(),W=y?P:0,J=H.scale[k],q=m.getRGBTransferFunction(W).getRange();w[P]=J/(q[1]-q[0]),S[P]=(H.offset[k]-q[0])/(q[1]-q[0]);const ae=m.getScalarOpacity(W).getRange();_[P]=J/(ae[1]-ae[0]),D[P]=(H.offset[k]-ae[0])/(ae[1]-ae[0])}if(g.setUniform4fv(`${p}.colorTextureScale`,w),g.setUniform4fv(`${p}.colorTextureShift`,S),g.setUniform4fv(`${p}.opacityTextureScale`,_),g.setUniform4fv(`${p}.opacityTextureShift`,D),e.previousState.gradientOpacityEnabled){const P=new Array(4),F=new Array(4),B=new Array(4),k=new Array(4);if(y)for(let U=0;U<v;++U){const H=e.previousState.multiTexturePerVolumeEnabled,W=H?U:0,J=H?0:U,Q=e.scalarTextures[W].getVolumeInfo().scale[J];if(m.getUseGradientOpacity(U)){const me=[m.getGradientOpacityMinimumOpacity(U),m.getGradientOpacityMaximumOpacity(U)],de=[m.getGradientOpacityMinimumValue(U),m.getGradientOpacityMaximumValue(U)];B[U]=me[0],k[U]=me[1],P[U]=Q*(me[1]-me[0])/(de[1]-de[0]),F[U]=-de[0]*(me[1]-me[0])/(de[1]-de[0])+me[0]}else B[U]=1,k[U]=1,P[U]=0,F[U]=1}else{const U=v-1,H=e.previousState.multiTexturePerVolumeEnabled,W=H?U:0,J=H?0:U,Q=e.scalarTextures[W].getVolumeInfo().scale[J],ae=[m.getGradientOpacityMinimumOpacity(0),m.getGradientOpacityMaximumOpacity(0)],me=[m.getGradientOpacityMinimumValue(0),m.getGradientOpacityMaximumValue(0)];B[0]=ae[0],k[0]=ae[1],P[0]=Q*(ae[1]-ae[0])/(me[1]-me[0]),F[0]=-me[0]*(ae[1]-ae[0])/(me[1]-me[0])+ae[0]}g.setUniform4f(`${p}.gradientOpacityScale`,P),g.setUniform4f(`${p}.gradientOpacityShift`,F),g.setUniform4f(`${p}.gradientOpacityMin`,B),g.setUniform4f(`${p}.gradientOpacityMax`,k)}const N=m.getLabelOutlineOpacity();if(g.setUniformf(`${p}.outlineOpacity`,N),e.numberOfLights>0){g.setUniformf(`${p}.ambient`,m.getAmbient()),g.setUniformf(`${p}.diffuse`,m.getDiffuse()),g.setUniformf(`${p}.specular`,m.getSpecular());const P=m.getSpecularPower();g.setUniformf(`${p}.specularPower`,P===0?1:P)}},t.getClippingPlaneShaderParameters=(l,f,u)=>{if(e.renderable.getClippingPlanes().length>0){const g=e.openGLCamera.getKeyMatrices(f),d=[],p=[],h=[],m=e.renderable.getClippingPlanes(),v=m.length;for(let T=0;T<v;++T){const C=m[T].getNormal(),w=m[T].getOrigin();Jf(C,C,g.normalMatrix),At(w,w,g.wcvc);const S=-1*He(w,C);d.push(C[0]),d.push(C[1]),d.push(C[2]),p.push(S),h.push(w[0]),h.push(w[1]),h.push(w[2])}const y=l.getProgram();y.setUniform3fv("vClipPlaneNormals",d),y.setUniformfv("vClipPlaneDistances",p),y.setUniform3fv("vClipPlaneOrigins",h),y.setUniformi("clip_numPlanes",v)}},t.delete=tu(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&c(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:l,vsize:f}=e._openGLRenderer.getTiledSizeAndOrigin();return[l,f]},t.getRenderTargetOffset=()=>{const{lowerLeftU:l,lowerLeftV:f}=e._openGLRenderer.getTiledSizeAndOrigin();return[l,f]},t.getCurrentSampleDistance=l=>{const f=l.getVTKWindow().getInteractor(),u=e.renderable.getSampleDistance();if(f.isAnimating()){const g=e.renderable.getInteractionSampleDistanceFactor();return u*g}return u},t.renderPieceStart=(l,f)=>{const u=l.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,u.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=u.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const d=u.getRecentAnimationFrameRate(),p=u.getDesiredUpdateRate()/d;(p>1.15||p<.85)&&(e._lastScale*=p),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const d=e._openGLRenderWindow.getFramebufferSize(),p=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(p*d[0]),e._smallViewportHeight=Math.ceil(p*d[1]),e._smallViewportHeight>d[1]&&(e._smallViewportHeight=d[1]),e._smallViewportWidth>d[0]&&(e._smallViewportWidth=d[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(d[0],d[1]),e.framebuffer.populateFramebuffer();else{const m=e.framebuffer.getSize();(!m||m[0]!==d[0]||m[1]!==d[1])&&(e.framebuffer.create(d[0],d[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const h=e.context;h.clearColor(0,0,0,0),h.colorMask(!0,!0,!0,!0),h.clear(h.COLOR_BUFFER_BIT),h.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/d[0],e._smallViewportHeight/d[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(l,f);const g=f.getProperties();e.currentValidInputs.forEach(d=>{let{inputIndex:p}=d;const m=g[p].getInterpolationType(),v=e.scalarTextures[p];m===o6.NEAREST?(v.setMinificationFilter(ze.NEAREST),v.setMagnificationFilter(ze.NEAREST)):(v.setMinificationFilter(ze.LINEAR),v.setMagnificationFilter(ze.LINEAR))}),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(l,f)=>{const u=e.context,g=[...e.scalarTextures,e.colorTexture,e.opacityTexture,e.labelOutlineThicknessTexture,e.jitterTexture];g.forEach(d=>d.activate()),t.updateShaders(e.tris,l,f),u.drawArrays(u.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),g.forEach(d=>d.deactivate())},t.renderPieceFinish=(l,f)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const p=e.copyShader;e.copyVAO=zg.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(p,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||lm("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const u=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,u[0],u[1]);const g=e.framebuffer.getColorTexture();g.activate(),e.copyShader.setUniformi("texture",g.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const d=e.context;d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),g.deactivate(),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(l,f)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const u=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let d=0;d<u;++d){const p=e.renderable.getInputData(d);p&&!p.isDeleted()&&e.currentValidInputs.push({imageData:p,inputIndex:d})}let g=0;if(e.currentValidInputs.length>0){const d=f.getProperties(),p=e.currentValidInputs[0],m=p.imageData.getPointData().getScalars(),v=d[p.inputIndex];v.getShade()&&e.renderable.getBlendMode()===ml.COMPOSITE_BLEND&&l.getLights().forEach(C=>{C.getSwitch()>0&&g++});const y=e.currentValidInputs.length,T=y>1;e.numberOfComponents=T?y:m.getNumberOfComponents(),e.useIndependentComponents=n(v,e.numberOfComponents)}g!==e.numberOfLights&&(e.numberOfLights=g,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(l,f),t.renderPieceDraw(l,f),t.renderPieceFinish(l,f))},t.updateBufferObjects=(l,f)=>{t.getNeedToRebuildBufferObjects(l,f)&&t.buildBufferObjects(l,f)},t.getNeedToRebuildBufferObjects=(l,f)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<f.getMTime()||e.VBOBuildTime.getMTime()<f.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.currentValidInputs.some(u=>{let{imageData:g}=u;return e.VBOBuildTime.getMTime()<g.getMTime()})||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(u=>!!u?.getHandle())||!e.colorTexture?.getHandle()||!e.opacityTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle()||!e.jitterTexture?.getHandle(),t.buildBufferObjects=(l,f)=>{if(!e.jitterTexture.getHandle()){const H=new Float32Array(1024);for(let W=0;W<1024;++W)H[W]=Math.random();e.jitterTexture.setMinificationFilter(ze.NEAREST),e.jitterTexture.setMagnificationFilter(ze.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:dt.FLOAT,data:H})}const u=f.getProperties(),g=e.currentValidInputs[0],d=u[g.inputIndex],p=e.numberOfComponents,h=e.useIndependentComponents,m=h?p:1,v=[];for(let H=0;H<m;++H)v.push(d.getScalarOpacity(H));const y=xa(v,h,m),T=d.getScalarOpacity(),C=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!C?.oglObject?.getHandle()||C.hash!==y){const H=Xt.newInstance();H.setOpenGLRenderWindow(e._openGLRenderWindow);let W=e.renderable.getOpacityTextureWidth();W<=0&&(W=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const J=W*2*m,ne=new Float32Array(J),q=new Float32Array(W);for(let Q=0;Q<m;++Q){const ae=d.getScalarOpacity(Q),me=t.getCurrentSampleDistance(l)/d.getScalarOpacityUnitDistance(Q),de=ae.getRange();ae.getTable(de[0],de[1],W,q,1);for(let je=0;je<W;++je)ne[Q*W*2+je]=1-(1-q[je])**me,ne[Q*W*2+je+W]=ne[Q*W*2+je]}if(H.resetFormatAndType(),H.setMinificationFilter(ze.LINEAR),H.setMagnificationFilter(ze.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))H.create2DFromRaw({width:W,height:2*m,numComps:1,dataType:dt.FLOAT,data:ne});else{const Q=new Uint8ClampedArray(J);for(let ae=0;ae<J;++ae)Q[ae]=255*ne[ae];H.create2DFromRaw({width:W,height:2*m,numComps:1,dataType:dt.UNSIGNED_CHAR,data:Q})}T&&e._openGLRenderWindow.setGraphicsResourceForObject(T,H,y),e.opacityTexture=H}else e.opacityTexture=C.oglObject;s(e._openGLRenderWindow,e._opacityTextureCore,T),e._opacityTextureCore=T;const S=[];for(let H=0;H<m;++H)S.push(d.getRGBTransferFunction(H));const _=xa(S,h,m),D=d.getRGBTransferFunction(),N=e._openGLRenderWindow.getGraphicsResourceForObject(D);if(!N?.oglObject?.getHandle()||N?.hash!==_){const H=Xt.newInstance();H.setOpenGLRenderWindow(e._openGLRenderWindow);let W=e.renderable.getColorTextureWidth();W<=0&&(W=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const J=W*2*m*3,ne=new Uint8ClampedArray(J),q=new Float32Array(W*3);for(let Q=0;Q<m;++Q){const ae=d.getRGBTransferFunction(Q),me=ae.getRange();ae.getTable(me[0],me[1],W,q,1);for(let de=0;de<W*3;++de)ne[Q*W*6+de]=255*q[de],ne[Q*W*6+de+W*3]=255*q[de]}H.resetFormatAndType(),H.setMinificationFilter(ze.LINEAR),H.setMagnificationFilter(ze.LINEAR),H.create2DFromRaw({width:W,height:2*m,numComps:3,dataType:dt.UNSIGNED_CHAR,data:ne}),e._openGLRenderWindow.setGraphicsResourceForObject(D,H,_),e.colorTexture=H}else e.colorTexture=N.oglObject;s(e._openGLRenderWindow,e._colorTextureCore,D),e._colorTextureCore=D,e.currentValidInputs.forEach((H,W)=>{let{imageData:J,inputIndex:ne}=H;const q=u[ne],Q=J.getPointData().getScalars(),ae=e._openGLRenderWindow.getGraphicsResourceForObject(Q),me=U2(J,Q),de=!ae?.oglObject?.getHandle()||ae?.hash!==me,je=q.getUpdatedExtents(),$e=!!je.length;if(de&&!$e){const Be=Xt.newInstance();Be.setOpenGLRenderWindow(e._openGLRenderWindow);const qe=J.getDimensions();Be.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),Be.resetFormatAndType(),Be.create3DFilterableFromDataArray({width:qe[0],height:qe[1],depth:qe[2],dataArray:Q,preferSizeOverAccuracy:q.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(Q,Be,me),e.scalarTextures[W]=Be}else e.scalarTextures[W]=ae.oglObject;if($e){q.setUpdatedExtents([]);const Be=J.getDimensions();e.scalarTextures[W].create3DFilterableFromDataArray({width:Be[0],height:Be[1],depth:Be[2],dataArray:Q,updatedExtents:je})}s(e._openGLRenderWindow,e._scalarTexturesCore[W],Q),e._scalarTexturesCore[W]=Q});const F=d.getLabelOutlineThickness(),B=e._openGLRenderWindow.getGraphicsResourceForObject(F),k=F.join("-");if(!B?.oglObject?.getHandle()||B?.hash!==k){const H=Xt.newInstance();H.setOpenGLRenderWindow(e._openGLRenderWindow);let W=e.renderable.getLabelOutlineTextureWidth();W<=0&&(W=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const J=1,ne=W*J,q=new Uint8Array(ne);for(let Q=0;Q<W;++Q){const ae=typeof F[Q]<"u"?F[Q]:F[0];q[Q]=ae}H.resetFormatAndType(),H.setMinificationFilter(ze.NEAREST),H.setMagnificationFilter(ze.NEAREST),H.create2DFromRaw({width:W,height:J,numComps:1,dataType:dt.UNSIGNED_CHAR,data:q}),F&&e._openGLRenderWindow.setGraphicsResourceForObject(F,H,k),e.labelOutlineThicknessTexture=H}else e.labelOutlineThicknessTexture=B.oglObject;if(s(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,F),e._labelOutlineThicknessTextureCore=F,!e.tris.getCABO().getElementCount()){const H=new Float32Array(12);for(let q=0;q<4;q++)H[q*3]=q%2*2-1,H[q*3+1]=q>1?1:-1,H[q*3+2]=-1;const W=new Uint16Array(8);W[0]=3,W[1]=0,W[2]=1,W[3]=3,W[4]=3,W[5]=0,W[6]=3,W[7]=2;const J=ot.newInstance({numberOfComponents:3,values:H});J.setName("points");const ne=ot.newInstance({numberOfComponents:1,values:W});e.tris.getCABO().createVBO(ne,"polys",gi.SURFACE,{points:J,cellOffset:0})}e.VBOBuildTime.modified()}}const EI={context:null,VBOBuildTime:null,scalarTextures:[],_scalarTexturesCore:[],opacityTexture:null,_opacityTextureCore:null,colorTexture:null,_colorTextureCore:null,labelOutlineThicknessTexture:null,_labelOutlineThicknessTextureCore:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,fullViewportTime:1,idxToView:null,vecISToVCMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function g9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EI,n),bn.extend(t,e,n),ms.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},an(e.VBOBuildTime,{mtime:0}),e.tris=To.newInstance(),e.jitterTexture=Xt.newInstance(),e.jitterTexture.setWrapS(Wl.REPEAT),e.jitterTexture.setWrapT(Wl.REPEAT),e.framebuffer=su.newInstance(),Gn(t,e,["context"]),xI(t,e)}const d9=Yt(g9,"vtkOpenGLVolumeMapper");var h9={newInstance:d9,extend:g9};rr("vtkVolumeMapper",d9);const{vtkDebugMacro:OI}=Dr;function RI(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),l=Math.floor(c.getWidth()),f=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const g=r.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():OI("No framebuffer to save/restore");const d=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,d),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(l*f*4),u.viewport(0,0,l,f),u.readPixels(0,0,l,f,u.RGBA,u.UNSIGNED_BYTE,s)),g&&g.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(d)}e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const DI={};function MI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DI,n),bn.extend(t,e,n),RI(t,e)}const p9=Yt(MI,"vtkOpenGLPixelSpaceCallbackMapper");var _I={newInstance:p9};rr("vtkPixelSpaceCallbackMapper",p9);const m9=Object.create(null);function V0(t,e){m9[t]=e}function II(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const bI={};function LI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bI,n),e.overrides=m9,V2.extend(t,e,n),II(t,e)}A.newInstance(LI,"vtkWebGPUViewNodeFactory");function VI(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,i,a)=>{if(Ze(n),e.renderable.getParallelProjection()){const o=e.renderable.getParallelScale(),s=o*r,c=o,l=(a[0]-1)*s,f=(a[0]+1)*s,u=(a[1]-1)*c,g=(a[1]+1)*c,d=1/(f-l),p=1/(g-u);n[0]=2*d,n[5]=2*p,n[10]=1/(i[1]-i[0]),n[12]=(f+l)*d,n[13]=(g+u)*p,n[14]=i[1]/(i[1]-i[0])}else{const o=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*o,c=i[0]*o/r):(s=i[0]*o*r,c=i[0]*o);const l=(a[0]-1)*s,f=(a[0]+1)*s,u=(a[1]-1)*c,g=(a[1]+1)*c;n[0]=2*i[0]/(f-l),n[5]=2*i[0]/(g-u),n[12]=(l+f)/(f-l),n[13]=(u+g)/(g-u),n[10]=0,n[14]=i[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let i=-r[0]/n;return i=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(i*(r[1]-r[0])),.5*i+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),i=n.getParent();if(Math.max(i.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const a=e.renderable.getViewMatrix();mn(e.keyMatrices.normalMatrix,a),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,In(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),bt(e.keyMatrices.wcvc,a);const o=n.getStabilizedCenterByReference();Mn(e.keyMatrices.scvc,e.keyMatrices.wcvc,o);const s=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),rt(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),In(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const PI={keyMatrixTime:null,keyMatrices:null};function NI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PI,n),bn.extend(t,e,n),e.keyMatrixTime={},A.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},A.setGet(t,e,["keyMatrixTime"]),VI(t,e)}const AI=A.newInstance(NI);V0("vtkCamera",AI);function FI(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==n[i]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupLayoutEntry();a.binding=i,r.push(a)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupTime().getMTime();r=o>r?o:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupEntry();o.binding=a,i.push(o)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],i=n.getBindGroupLayoutCount(e.label);for(let a=0;a<e.bindables.length;a++)r.push(e.bindables[a].getShaderCode(a,i));return r.join(`
`)}}const UI={device:null,handle:null,label:null};function v9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UI,n),A.obj(t,e),e.bindables=[],e.bindGroupTime={},A.obj(e.bindGroupTime,{mtime:0}),A.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),A.setGet(t,e,["label","device","arrayInformation"]),FI(t,e)}const kI=A.newInstance(v9);var y9={newInstance:kI,extend:v9};function GI(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const BI={device:null,handle:null};function T9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BI,n),A.obj(t,e),A.get(t,e,["lastCameraMTime"]),A.setGet(t,e,["device","handle"]),GI(t,e)}const $I=A.newInstance(T9,"vtkWebGPUShaderModule");var WI={newInstance:$I,extend:T9};function zI(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(n)?n.join(`
`):n;let a=!1;t.search(e)!==-1&&(a=!0);let o="";r&&(o="g");const s=new RegExp(e,o),c=t.replace(s,i);return{replace:a,result:c}}function HI(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),i=n.getHash(),a=e._shaderModules.keys();for(let s=0;s<a.length;s++){const c=a[s];if(c.getHash()===i&&c.getType()===r)return e._shaderModules.get(c)}const o=WI.newInstance();return o.initialize(e.device,n),e._shaderModules.set(n,o),o}}const jI={shaderModules:null,device:null,window:null};function C9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jI,n),e._shaderModules=new Map,A.obj(t,e),A.setGet(t,e,["device","window"]),HI(t,e)}const KI=A.newInstance(C9,"vtkWebGPUShaderCache");var li={newInstance:KI,extend:C9,substitute:zI};function qI(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const i=[];for(let a=0;a<e.layouts.length;a++)i.push(e.layouts[a].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let a=0;a<e.shaderDescriptions.length;a++){const o=e.shaderDescriptions[a],s=n.getShaderModule(o);o.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),o.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const XI={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function w9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XI,n),an(t,e),e.layouts=[],e.shaderDescriptions=[],$r(t,e,["handle","pipelineDescription"]),Gn(t,e,["device","renderEncoder","topology","vertexState"]),qI(t,e)}const YI=Yt(w9,"vtkWebGPUPipeline");var ZI={newInstance:YI,extend:w9};function JI(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(i)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const i=[];let a=[];if(r&&i.push(r.getShaderCode()),n||e.builtinInputNames.length){const o=[];if(o.push(`struct ${e.type}Input
{`),n){const s=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),l=n.getOutputInterpolationsByReference();for(let f=0;f<s.length;f++)l[f]!==void 0?o.push(`  @location(${f}) @interpolate(${l[f]}) ${s[f]} : ${c[f]},`):o.push(`  @location(${f}) ${s[f]} : ${c[f]},`)}for(let s=0;s<e.builtinInputNames.length;s++)o.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);o.length>1&&(o.push("};"),a=o,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=li.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const o=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?o.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):o.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)o.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);o.push("};"),a=a.concat(o),e.code=li.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=li.substitute(e.code,"//VTK::IOStructs::Dec",a).result}}const QI={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function S9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QI,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],A.obj(t,e),A.setGet(t,e,["type","hash","code"]),A.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),JI(t,e)}const eb=A.newInstance(S9,"vtkWebGPUShaderDescription");var um={newInstance:eb,extend:S9};const fm={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function tb(t){return!t||t.length<6?0:t in fm?fm[t]:(yt(`unknown format ${t}`),null)}function nb(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return yt(`unknown format ${t}`),0;const i=5-r/2;return e*i}function rb(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function ib(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{yt(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){yt(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function ab(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{yt(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function ob(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function sb(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";yt(`unknown format ${t}`)}}var ha={getDetailsFromTextureFormat:tb,getByteStrideFromBufferFormat:nb,getNumberOfComponentsFromBufferFormat:rb,getNativeTypeFromBufferFormat:ib,getShaderTypeFromBufferFormat:ab,getByteStrideFromShaderFormat:ob,getNativeTypeFromShaderFormat:sb};function cb(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function lb(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",a=r;Array.isArray(a)||(a=[a]);for(let o=0;o<e.inputs.length;o++)if(cb(e.inputs[o].names,a)){if(e.inputs[o].buffer===n)return;e.inputs[o].buffer=n;return}e.inputs.push({buffer:n,stepMode:i,names:a}),e.inputs=e.inputs.sort((o,s)=>o.names[0]<s.names[0]?-1:o.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let i=0;i<e.inputs.length;i++)for(let a=0;a<e.inputs[i].names.length;a++){const o=e.inputs[i].buffer.getArrayInformation()[a],s=ha.getShaderTypeFromBufferFormat(o.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[i].names[a]} : ${s}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let i=0;for(let a=0;a<e.inputs.length;a++){const o=e.inputs[a].buffer,s={arrayStride:o.getStrideInBytes(),stepMode:e.inputs[a].stepMode,attributes:[]},c=o.getArrayInformation();for(let l=0;l<e.inputs[a].names.length;l++)s.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;r.push(s)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const ub={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function x9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ub,n),an(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Gn(t,e,["created","device","handle","indexBuffer"]),lb(t,e)}const fb=Yt(x9,"vtkWebGPUVertexInput");var gb={newInstance:fb,extend:x9};const db=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,hb=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function pb(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,i)=>{const a=um.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),o=um.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(a),s.push(o);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((g,d,p)=>p.indexOf(g)===d).map(g=>`replaceShader${g.substring(7,g.length-2)}`);for(let g=0;g<u.length;g++){const d=u[g];d!=="replaceShaderIOStructs"&&e.shaderReplacements.has(d)&&e.shaderReplacements.get(d)(n,r,i)}t.replaceShaderIOStructs(n,r,i)},t.replaceShaderIOStructs=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.replaceShaderCode(null,i),r.getShaderDescription("fragment").replaceShaderCode(a)},t.replaceShaderRenderEncoder=(n,r,i)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,i)=>{if(!e.WebGPURenderer)return;const a=e.WebGPURenderer.getBindGroup().getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=li.substitute(s,"//VTK::Renderer::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");s=c.getCode(),s=li.substitute(s,"//VTK::Renderer::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,i)=>{const a=e.bindGroup.getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=li.substitute(s,"//VTK::Mapper::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=li.substitute(s,"//VTK::Mapper::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let o=a.getCode();o=li.substitute(o,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,i)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?n.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const i=e.textureViews[r].getSampler();i&&n.push(i)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=ZI.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const mb={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function E9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mb,n),bn.extend(t,e,n),e.textureViews=[],e.vertexInput=gb.newInstance(),e.bindGroup=y9.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||hb,e.vertexShaderTemplate=e.vertexShaderTemplate||db,e.shaderReplacements=new Map,A.get(t,e,["pipeline","vertexInput"]),A.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),pb(t,e)}const vb=A.newInstance(E9,"vtkWebGPUSimpleMapper");var yb={newInstance:vb,extend:E9};function Tb(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();o=li.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const Cb={};function O9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cb,n),yb.extend(t,e,n),Tb(t,e)}const wb=A.newInstance(O9,"vtkWebGPUFullScreenQuad");var ph={newInstance:wb,extend:O9};const Sb={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},xb={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var cu={BufferUsage:Sb,PrimitiveTypes:xb};const J1=["getMappedRange","mapAsync","unmap"];function Eb(t,e,n,r){const i=r.byteLength,a=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),o=a.getMappedRange(0,i);new Uint8Array(o).set(new Uint8Array(r)),a.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(a,0,e,n,i);const c=s.finish();t.queue.submit([c]),a.destroy()}function Ob(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{Eb(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{const i=Math.ceil(n.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:i,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=i,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<J1.length;n++)t[J1[n]]=function(){return e.handle[J1[n]](...arguments)}}const Rb={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function R9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rb,n),A.obj(t,e),A.get(t,e,["handle","sizeInBytes","usage"]),A.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),Ob(t,e)}const Db=A.newInstance(R9);var mh={newInstance:Db,extend:R9,...cu};const{Representation:fl,Interpolation:gl}=j6;function gm(t){return()=>A.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function Mb(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,i)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==i)&&(e.color[0]=n,e.color[1]=r,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=gm("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=gm("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(gl.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(gl.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(gl.PHONG),t.getInterpolationAsString=()=>A.enumToString(gl,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(fl.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(fl.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(fl.POINTS),t.getRepresentationAsString=()=>A.enumToString(fl,e.representation)}const _b={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:gl.GOURAUD,representation:fl.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function Ib(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_b,n),A.obj(t,e),A.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),A.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),Mb(t,e)}const bb=A.newInstance(Ib,"vtkProperty");var lu={newInstance:bb,...j6};const{Representation:dm}=lu,{PrimitiveTypes:Xo}=cu;class Lb{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function Vb(t){switch(t){case Xo.Points:return"points";case Xo.Lines:return"lines";case Xo.Triangles:case Xo.TriangleEdges:return"polys";case Xo.TriangleStripEdges:case Xo.TriangleStrips:return"strips";default:return""}}function bu(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function Pb(t,e,n){const r=t.length;for(let o=0;o<r;o++){let s=t[o];if(n.cellProvokedMap.has(s)){n.ibo[n.iboId++]=n.cellProvokedMap.get(s);for(let c=o+1;c<o+r;c++){s=t[c%r];const l=bu(n,s,e);n.ibo[n.iboId++]=l}return}}for(let o=0;o<r;o++){let s=t[o];if(!n.provokedPointIds[s]){let c=bu(n,s,e);n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let l=o+1;l<o+r;l++)s=t[l%r],c=bu(n,s,e),n.ibo[n.iboId++]=c;return}}let i=t[0],a=n.flatId;n.cellProvokedMap.set(i,a),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=a;for(let o=1;o<r;o++)i=t[o],a=bu(n,i,e),n.ibo[n.iboId++]=a}function Nb(t,e,n){const r=t.length;n.iboSize+=r;for(let i=0;i<r;i++){const a=t[i];if(n.cellProvokedMap.has(a))return}for(let i=0;i<r;i++){const a=t[i];if(!n.provokedPointIds[a]){n.provokedPointIds[a]=1,n.cellProvokedMap.set(a,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let Ja;const hm=new Uint32Array(1),Ei=new Uint32Array(2),Wo=new Uint32Array(3),Q1={anythingToPoints(t,e,n,r,i){for(let a=0;a<t;++a)hm[0]=e[n+a],Ja(hm,r,i)},linesToWireframe(t,e,n,r,i){for(let a=0;a<t-1;++a)Ei[0]=e[n+a],Ei[1]=e[n+a+1],Ja(Ei,r,i)},polysToWireframe(t,e,n,r,i){if(t>2)for(let a=0;a<t;++a)Ei[0]=e[n+a],Ei[1]=e[n+(a+1)%t],Ja(Ei,r,i)},stripsToWireframe(t,e,n,r,i){if(t>2){for(let a=0;a<t-1;++a)Ei[0]=e[n+a],Ei[1]=e[n+a+1],Ja(Ei,r,i);for(let a=0;a<t-2;a++)Ei[0]=e[n+a],Ei[1]=e[n+a+2],Ja(Ei,r,i)}},polysToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)Wo[0]=e[n],Wo[1]=e[n+a+1],Wo[2]=e[n+a+2],Ja(Wo,r,i)},stripsToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)Wo[0]=e[n+a],Wo[1]=e[n+a+1+a%2],Wo[2]=e[n+a+1+(a+1)%2],Ja(Wo,r,i)}};function Ab(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,i=n.primitiveType,a=n.representation,o=n.cellOffset,s=r.getData(),c=s.length,l=Vb(i),f=n.numberOfPoints,u={provokedPointIds:new Uint8Array(f),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new Lb};let g=null;a===dm.POINTS||i===Xo.Points?g=Q1.anythingToPoints:a===dm.WIREFRAME||i===Xo.Lines?g=Q1[`${l}ToWireframe`]:g=Q1[`${l}ToSurface`],Ja=Nb;let d=o||0;for(let p=0;p<c;)u.cellProvokedMap.clear(),g(s[p],s,p+1,d,u),p+=s[p]+1,d++;f<=65535?u.flatIdToPointId=new Uint16Array(f+u.extraPoints):u.flatIdToPointId=new Uint32Array(f+u.extraPoints),f+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(f):u.pointIdToFlatId=new Int32Array(f),f+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),n.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),n.format="uint32"),d<=65535?u.flatIdToCellId=new Uint16Array(f+u.extraPoints):u.flatIdToCellId=new Uint32Array(f+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),Ja=Pb,d=o||0;for(let p=0;p<c;)u.cellProvokedMap.clear(),g(s[p],s,p+1,d,u),p+=s[p]+1,d++;delete u.provokedPointIds,delete u.pointIdToFlatId,n.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const Fb={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function D9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fb,n),mh.extend(t,e,n),A.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),Ab(t,e)}const Ub=A.newInstance(D9);var kb={newInstance:Ub,extend:D9,...cu};const{BufferUsage:zo}=cu,{vtkErrorMacro:Gb}=Dr,{VtkDataTypes:js}=ot,Bb={};function $b(t){let e;switch(t.getDataType()){case js.UNSIGNED_CHAR:e="uint8";break;case js.FLOAT:e="float32";break;case js.UNSIGNED_INT:e="uint32";break;case js.INT:e="sint32";break;case js.DOUBLE:e="float32";break;case js.UNSIGNED_SHORT:e="uint16";break;case js.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||Gb(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function pm(t,e,n,r,i){const a={},o=t.getFlatSize();if(!o)return a;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let f,u=0;const g=n+(l?1:0),d=_0(r,o*g);let p=t.getFlatIdToPointId();i.cellData&&(p=t.getFlatIdToCellId()),n===1?f=function(m){d[u++]=c[0]*e[m]+s[0]}:n===2?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1]}:n===3&&!l?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2]}:n===3&&l?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2],d[u++]=c[3]*1+s[3]}:n===4&&(f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2],d[u++]=c[3]*e[m+3]+s[3]});for(let h=0;h<o;h++){const m=n*p[h];f(m)}return a.nativeArray=d,a}function Wb(t,e,n,r){const i=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],a=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],o=[];return kr(i,a,o),hi(o),o}function zb(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const i=new Int8Array(t.getNumberOfCells()*4),a=r.length;let o=0;for(let s=0;s<a;){const c=Wb(n,r[s+1],r[s+2],r[s+3]);i[o++]=127*c[0],i[o++]=127*c[1],i[o++]=127*c[2],i[o++]=127,s+=r[s]+1}return i}function Hb(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let i,a;if(r.usage===zo.Index&&(i=kb.newInstance({label:r.label}),i.setDevice(e.device),a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(r),i.createAndWrite(r.nativeArray,a),i.setArrayInformation([{format:r.format}])),i||(i=mh.newInstance({label:r.label}),i.setDevice(e.device)),r.usage===zo.UniformArray&&(a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===zo.Storage&&(a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===zo.Texture&&(a=GPUBufferUsage.COPY_SRC,i.createAndWrite(r.nativeArray,a)),r.usage===zo.PointArray){a=GPUBufferUsage.VERTEX;const o=ha.getNativeTypeFromBufferFormat(r.format),s=pm(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),o,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});i.createAndWrite(s.nativeArray,a),i.setStrideInBytes(ha.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===zo.NormalsFromPoints){a=GPUBufferUsage.VERTEX;const o=ha.getNativeTypeFromBufferFormat(r.format),s=zb(r.cells,r.dataArray),c=pm(r.indexBuffer,s,4,o,{cellData:!0});i.createAndWrite(c.nativeArray,a),i.setStrideInBytes(ha.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===zo.RawVertex&&(a=GPUBufferUsage.VERTEX,i.createAndWrite(r.nativeArray,a),i.setStrideInBytes(ha.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format}])),i.setSourceTime(r.time),i}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,i)=>{const a=$b(r),o={hash:`${r.getMTime()}I${i.getMTime()}${a}`,usage:zo.PointArray,format:a,dataArray:r,indexBuffer:i};return t.getBuffer(o)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=mh.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const jb={device:null,fullScreenQuadBuffer:null};function Kb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jb,n),an(t,e),Gn(t,e,["device"]),Hb(t,e)}Yt(Kb);var M9={...Bb,...cu};const{BufferUsage:qb}=M9,{vtkErrorMacro:Pc}=A;function Xb(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Pc(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const i=ha.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:i,offset:e.sizeInBytes,nativeType:ha.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=i},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:qb.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=A.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Pc(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType];s[(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Pc(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType],c=(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)s[c+l]=i[l]},t.setAllInstancesFromArray=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Pc(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)o[l+f]=r[c*s+f]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Pc(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)o[l+f]=r[c*s+f]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Pc(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<3;f++)for(let u=0;u<3;u++)o[l+f*4+u]=r[c*s+f*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const i=[`struct ${e.label}StructEntry
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const Yb={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function _9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yb,n),A.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},A.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},A.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},A.get(t,e,["bindGroupTime"]),A.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),Xb(t,e)}const Zb=A.newInstance(_9,"vtkWebGPUStorageBuffer");var Jb={newInstance:Zb,extend:_9};const{BufferUsage:Qb}=M9,{vtkErrorMacro:ed}=A;function eL(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){ed(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:ha.getByteStrideFromShaderFormat(r),offset:-1,nativeType:ha.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let i=4;for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.sizeInBytes%16===0&&(i=Math.max(16,i)),o.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed===!1&&o.sizeInBytes%16===0&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(o.packed===!1&&o.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0)for(let s=a+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let f=c+1;f<e.bufferEntries.length;f++){const u=e.bufferEntries[f];if(!u.packed&&u.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,s=!0;break}}}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];!o.packed&&o.sizeInBytes>4&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed||(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let a=0;a<e.bufferEntries.length;a++)e._bufferEntryNames.set(e.bufferEntries[a].name,a);e.sizeInBytes=n,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:Qb.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=A.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){ed(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];a.lastValue!==r&&(o[a.offset/o.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),a.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){ed(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];let s=!1;for(let c=0;c<r.length;c++)(!a.lastValue||a.lastValue[c]!==r[c])&&(o[a.offset/o.BYTES_PER_ELEMENT+c]=r[c],s=!0);s&&(e.sendDirty=!0,a.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const tL={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function I9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tL,n),A.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},A.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},A.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,A.get(t,e,["binding","bindGroupTime"]),A.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),eL(t,e)}const nL=A.newInstance(I9,"vtkWebGPUUniformBuffer");var Sl={newInstance:nL,extend:I9};const{vtkDebugMacro:rL}=Dr,mm=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,iL=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Lu=new Float64Array(16),vm=new Float64Array(16);function aL(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function oL(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),a=[],o=[];zi(o,i,.5*(n[0]+n[1])),co(a,r,o),Ut(o,a,e.stabilizedCenter),Qf(o)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=a,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(rL("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const r=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",r.wcvc),e.UBO.setArray("SCPCMatrix",r.scpc),e.UBO.setArray("PCSCMatrix",r.pcsc),e.UBO.setArray("SCVCMatrix",r.scvc),e.UBO.setArray("VCPCMatrix",r.vcpc),e.UBO.setArray("WCVCNormals",r.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",e.renderable.getEnvironmentTexture()?.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const i=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[i.usize,i.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const a=e._parent.getDevice();e.UBO.sendIfNeeded(a)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let a=0;a<n.length;a++)i+=n[a].getMTime();if(i!==e.lightTimeString){const a=new Float32Array(n.length*4),o=new Float32Array(n.length*4),s=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let f=0;f<n.length;f++){const u=f*4,g=n[f].getPosition();At(g,g,r.wcvc),a[u]=g[0],a[u+1]=g[1],a[u+2]=g[2],a[u+3]=0,o[u]=-n[f].getDirection()[0],o[u+1]=-n[f].getDirection()[1],o[u+2]=-n[f].getDirection()[2],o[u+3]=0,s[u]=n[f].getColor()[0],s[u+1]=n[f].getColor()[1],s[u+2]=n[f].getColor()[2],s[u+3]=n[f].getIntensity()*5,c[u]=aL(n[f]),c[u+1]=Math.cos(gn(n[f].getConeAngle())),c[u+2]=Math.cos(gn(n[f].getConeAngle()+n[f].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",a),e.SSBO.setAllInstancesFromArray("LightDir",o),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=ph.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(mm);const a=Sl.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&e.backgroundTex?.getImageLoaded()){e.clearFSQ.setFragmentShaderTemplate(iL);const a=Sl.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex,"EnvironmentTexture");if(o.getReady()){const s=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([s]),e.backgroundTexLoaded=!0;const c=e.backgroundTex.getInterpolate()?"linear":"nearest";s.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:c,magFilter:c,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=ph.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(mm);const a=Sl.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a)}const r=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),bt(vm,r.normalMatrix),Xf(Lu,r.scvc,r.pcsc),Xf(Lu,vm,Lu),e.clearFSQ.getUBO().setArray("FSQMatrix",Lu),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-s,d=Math.round(u[1])-c;return g<0&&(g=0),d<0&&(d=0),{usize:g,vsize:d,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const sL={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function cL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sL,n),bn.extend(t,e,n),e.UBO=Sl.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=Jb.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=y9.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=Ze(new Float64Array(16)),e.stabilizedTime={},an(e.stabilizedTime,{mtime:0}),$r(t,e,["bindGroup","stabilizedTime"]),I0(t,e,["stabilizedCenter"]),Gn(t,e,["renderEncoder","selector","suppressClear","UBO"]),oL(t,e)}const lL=Yt(cL,"vtkWebGPURenderer");V0("vtkRenderer",lL);function uL(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const fL={device:null,handle:null,label:null,options:null};function b9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fL,n),A.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},A.obj(e.bindGroupTime,{mtime:0}),A.get(t,e,["bindGroupTime","handle","options"]),A.setGet(t,e,["bindGroupLayoutEntry","device","label"]),uL(t,e)}const gL=A.newInstance(b9);var dL={newInstance:gL,extend:b9};const{SlicingMode:ym}=Kg,hL=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function pL(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}const ii=new Float64Array(16),ca=new Float64Array(16),Vu=new Float64Array(16),Ka=new Float64Array(4),Nn=new Float64Array(4);function mL(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const a=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),a=e.WebGPUImageSlice.getRenderable(),o=a.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||a.getProperty().getMTime()>i){const s=o.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();Ze(ii),Mn(ii,ii,c);const l=a.getMatrix();bt(ca,l),In(ca,ca),rt(ii,ca,ii);const f=s.getWorldToIndex();rt(ii,f,ii),In(Vu,ii),b0(ca,[.5,.5,.5]),rt(ii,ca,ii);const u=s.getDimensions();Ze(ca),Sa(ca,ca,[1/u[0],1/u[1],1/u[2]]),rt(ii,ca,ii),e.UBO.setArray("SCTCMatrix",ii);const g=e.currentInput.getExtent(),{ijkMode:d}=e.renderable.getClosestIJKAxis();let p=e.renderable.getSlice();d!==e.renderable.getSlicingMode()&&(p=e.renderable.getSliceAtPosition(p));let h=2,m=0,v=1;d===ym.I?(h=0,m=1,v=2):d===ym.J&&(h=1,m=2,v=0),Ka[h]=p,Ka[m]=g[m*2]-.5,Ka[v]=g[v*2]-.5,Ka[3]=1,Zo(Ka,Ka,Vu),e.UBO.setArray("Origin",Ka),Nn[h]=p,Nn[m]=g[m*2+1]+.5,Nn[v]=g[v*2]-.5,Nn[3]=1,Zo(Nn,Nn,Vu),$5(Nn,Nn,Ka),Nn[3]=1,e.UBO.setArray("Axis1",Nn),Nn[h]=p,Nn[m]=g[m*2]-.5,Nn[v]=g[v*2+1]+.5,Nn[3]=1,Zo(Nn,Nn,Vu),$5(Nn,Nn,Ka),Nn[3]=1,e.UBO.setArray("Axis2",Nn);const y=[1,1,1,1],T=[0,0,0,0],C=e.textureViews[0],w=C.getTexture().getScale(),S=C.getTexture().getNumberOfComponents();for(let _=0;_<S;_++){let D=a.getProperty().getColorWindow(),N=a.getProperty().getColorLevel();const F=a.getProperty().getRGBTransferFunction(0);if(F){const B=F.getRange();D=B[1]-B[0],N=.5*(B[1]+B[0])}y[_]=w/D,T[_]=-N/D+.5}e.UBO.setArray("cScale",y),e.UBO.setArray("cShift",T),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const o=1,s=pL(i,i.getRGBTransferFunction,o);if(e.colorTextureString!==s){e.numRows=o;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const f=new Float32Array(e.rowLength*3);for(let u=0;u<o;u++){l=i.getRGBTransferFunction(u);const g=l.getRange();l.getTable(g[0],g[1],e.rowLength,f,1);for(let d=0;d<e.rowLength;d++){const p=u*e.rowLength*8+d*4;c[p]=255*f[d*3],c[p+1]=255*f[d*3+1],c[p+2]=255*f[d*3+2],c[p+3]=255;for(let h=0;h<4;h++)c[p+e.rowLength*4+h]=c[p+h]}}}else for(let f=0;f<e.rowLength;++f){const u=255*f/(e.rowLength-1);c[f*4]=u,c[f*4+1]=u,c[f*4+2]=u,c[f*4+3]=255;for(let g=0;g<4;g++)c[f*4+e.rowLength*4+g]=c[f*4+g]}{const f={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=e.device.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[1]=g}e.colorTextureString=s}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),a=e.textureViews;if(!a[0]||a[0].getTexture()!==i){const c=i.createView("imgTexture");a[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===ss.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=dL.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(i,a,o)=>{const s=a.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=li.substitute(c,"//VTK::Position::Impl",l).result,s.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,a,o)=>{const s=a.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,a,o)=>{const s=a.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=li.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=li.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=li.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}const vL={rowLength:1024};function yL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vL,n),ph.extend(t,e,n),t.setFragmentShaderTemplate(hL),e.UBO=Sl.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},an(e.lutBuildTime,{mtime:0}),e.imagemat=Ze(new Float64Array(16)),e.imagematinv=Ze(new Float64Array(16)),e.VBOBuildTime={},an(e.VBOBuildTime),mL(t,e)}const TL=Yt(yL,"vtkWebGPUImageMapper");V0("vtkImageMapper",TL);function CL(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),i=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-i[0],e.bufferShift[1]=r[7]-i[1],e.bufferShift[2]=r[11]-i[2],bt(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?Ze(e.keyMatrices.normalMatrix):(mn(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,In(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),bt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Mn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),Mn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const wL={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function SL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wL,n),bn.extend(t,e,n),e.keyMatricesTime={},an(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},an(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:Ze(new Float64Array(16))},e.bufferShift=[0,0,0,0],$r(t,e,["propID","keyMatricesTime"]),CL(t,e)}const xL=Yt(SL,"vtkWebGPUImageSlice");V0("vtkImageSlice",xL);function EL(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,a)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const o=e.renderable.getMapper().getBounds();if(!o||o.length!==6||o[0]>o[1])return;a.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(i,a)=>{const o=e.renderable.getMapper().getInputData();if(!o)return;const s=o.getExtent(),c=e.renderable.getMatrix();let l=0;for(let f=4;f<6;f++){n[2]=s[f];for(let u=2;u<4;u++){n[1]=s[u];for(let g=0;g<2;g++){n[0]=s[g],o.indexToWorld(n,r);let d=a+l*3;i[d++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],i[d++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],i[d++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const a=e.renderable.getMatrix(),o=i.getStabilizedCenterByReference();bt(e.keyMatrices.bcwc,a),Mn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-o[0],-o[1],-o[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const OL={propID:void 0,keyMatricesTime:null};function RL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OL,n),bn.extend(t,e,n),e.keyMatricesTime={},A.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},A.get(t,e,["propID","keyMatricesTime"]),EL(t,e)}const DL=A.newInstance(RL,"vtkWebGPUVolume");V0("vtkVolume",DL);function ML(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)}}const _L={};function IL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_L,n),bn.extend(t,e,n),ML(t,e)}const bL=A.newInstance(IL,"vtkWebGPUPixelSpaceCallbackMapper");V0("vtkPixelSpaceCallbackMapper",bL);const Ri={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var L9={StructuredType:Ri};const{StructuredType:qa}=L9;function LL(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?qa.EMPTY:e===3?qa.XYZ_GRID:e===2?t[0]===t[1]?qa.YZ_PLANE:t[2]===t[3]?qa.XZ_PLANE:qa.XY_PLANE:e===1?t[0]<t[1]?qa.X_LINE:t[2]<t[3]?qa.Y_LINE:qa.Z_LINE:qa.SINGLE_POINT}var VL={getDataDescriptionFromExtent:LL,...L9};const{vtkErrorMacro:Ks}=A;function PL(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Ks("instance deleted - cannot call any method"),!1;for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];const o=i.length===1?i[0]:i;if(o.length!==6)return!1;const s=e.extent.some((c,l)=>c!==o[l]);return s&&(e.extent=o.slice(),e.dataDescription=VL.getDataDescriptionFromExtent(e.extent),t.modified()),s},t.setDimensions=function(){let r,i,a;if(e.deleted){Ks("instance deleted - cannot call any method");return}if(arguments.length===1){const o=arguments.length<=0?void 0:arguments[0];r=o[0],i=o[1],a=o[2]}else if(arguments.length===3)r=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];else{Ks("Bad dimension specification");return}t.setExtent(0,r-1,0,i-1,0,a-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const r=t.getDimensions();let i=1;for(let a=0;a<3;a++){if(r[a]===0)return 0;r[a]>1&&(i*=r[a]-1)}return i},t.getNumberOfPoints=()=>{const r=t.getDimensions();return r[0]*r[1]*r[2]},t.getPoint=r=>{const i=t.getDimensions();if(i[0]===0||i[1]===0||i[2]===0)return Ks("Requesting a point from an empty image."),null;const a=new Float64Array(3);switch(e.dataDescription){case Ri.EMPTY:return null;case Ri.SINGLE_POINT:break;case Ri.X_LINE:a[0]=r;break;case Ri.Y_LINE:a[1]=r;break;case Ri.Z_LINE:a[2]=r;break;case Ri.XY_PLANE:a[0]=r%i[0],a[1]=r/i[0];break;case Ri.YZ_PLANE:a[1]=r%i[1],a[2]=r/i[1];break;case Ri.XZ_PLANE:a[0]=r%i[0],a[2]=r/i[0];break;case Ri.XYZ_GRID:a[0]=r%i[0],a[1]=r/i[0]%i[1],a[2]=r/(i[0]*i[1]);break;default:Ks("Invalid dataDescription");break}const o=[0,0,0];return t.indexToWorld(a,o),o},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=r=>xt.transformBounds(r,e.indexToWorld),t.getSpatialExtent=()=>xt.inflate([...e.extent],.5),t.computeTransforms=()=>{b0(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Sa(e.indexToWorld,e.indexToWorld,e.spacing),In(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return At(i,r,e.indexToWorld),i},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return At(i,r,e.worldToIndex),i},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return xt.transformBounds(r,e.indexToWorld,i)},t.worldToIndexBounds=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return xt.transformBounds(r,e.worldToIndex,i)},e._onOriginChanged=t.computeTransforms,e._onDirectionChanged=t.computeTransforms,e._onSpacingChanged=t.computeTransforms,t.computeTransforms(),t.getCenter=()=>xt.getCenter(t.getBounds()),t.computeHistogram=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const a=[0,0,0,0,0,0];t.worldToIndexBounds(r,a);const o=[0,0,0],s=[0,0,0];xt.computeCornerPoints(a,o,s),nh(o,o),nh(s,s);const c=t.getDimensions();ih(o,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],o),ih(s,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],s);const l=c[0],f=c[0]*c[1],u=t.getPointData().getScalars().getData();let g=-1/0,d=1/0,p=0,h=0,m=0;for(let C=o[2];C<=s[2];C++)for(let w=o[1];w<=s[1];w++){let S=o[0]+w*l+C*f;for(let _=o[0];_<=s[0];_++){if(!i||i([_,w,C],a)){const D=u[S];D>g&&(g=D),D<d&&(d=D),p+=D*D,h+=D,m+=1}++S}}const v=m>0?h/m:0,y=m?Math.abs(p/m-v*v):0,T=Math.sqrt(y);return{minimum:d,maximum:g,average:v,variance:y,sigma:T,count:m}},t.computeIncrements=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=[];let o=i;for(let s=0;s<3;++s)a[s]=o,o*=r[s*2+1]-r[s*2]+1;return a},t.computeOffsetIndex=r=>{let[i,a,o]=r;const s=t.getExtent(),c=t.getPointData().getScalars().getNumberOfComponents(),l=t.computeIncrements(s,c);return Math.floor((Math.round(i)-s[0])*l[0]+(Math.round(a)-s[2])*l[1]+(Math.round(o)-s[4])*l[2])},t.getOffsetIndexFromWorld=r=>{const i=t.getExtent(),a=t.worldToIndex(r);for(let o=0;o<3;++o)if(a[o]<i[o*2]||a[o]>i[o*2+1])return Ks(`GetScalarPointer: Pixel ${a} is not in memory. Current extent = ${i}`),NaN;return t.computeOffsetIndex(a)},t.getScalarValueFromWorld=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getPointData().getScalars().getNumberOfComponents();if(i<0||i>=a)return Ks(`GetScalarPointer: Scalar Component ${i} is not within bounds. Current Scalar numberOfComponents: ${a}`),NaN;const o=t.getOffsetIndexFromWorld(r);return Number.isNaN(o)?o:t.getPointData().getScalars().getComponent(o,i)};const n=t.initialize;t.initialize=()=>(t.set({direction:bi(e.direction),spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Ri.EMPTY}),n())}const NL={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Ri.EMPTY};function V9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NL,n),L0.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=bi(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),A.get(t,e,["indexToWorld","worldToIndex"]),A.setGetArray(t,e,["origin","spacing"],3),A.setGetArray(t,e,["direction"],9),A.getArray(t,e,["extent"],6),PL(t,e)}const AL=A.newInstance(V9,"vtkImageData");var qg={newInstance:AL,extend:V9};const Tm=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],Cm=[[0,-1,0],[0,1,0]],FL=[[0,-1,0],[0,1,0],[0,0,-1]],UL=[[0,-1,0],[0,1,0],[0,0,1]],qp=class qp{static copyMap(e,n){for(const[r,i]of n.rows)e.rows.set(r,structuredClone(i))}constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const a=(o,s,c)=>{const{start:l,end:f,value:u}=s;for(let g=l;g<f;g++)i[o+g]=u};this.forEach(a)},this.get=i=>{const a=i%this.jMultiple,o=(i-a)/this.jMultiple;return this.getRLE(a,o)?.value??this.defaultValue},this.getRun=(i,a)=>{const o=i+a*this.height;return this.rows.get(o)},this.set=(i,a)=>{if(a===void 0)return;const o=i%this.width,s=(i-o)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:o,end:o+1,value:a}]);return}const l=this.findIndex(c,o),f=c[l],u=c[l-1];if(!f){if(!u||u.value!==a||u.end!==o){c[l]={start:o,end:o+1,value:a};return}u.end++;return}const{start:g,end:d,value:p}=f;if(a===p&&o>=g)return;const h={start:o,end:o+1,value:a},m=o>g,v=m?l+1:l,y=m?f:u;let T=m?c[l+1]:f;if(y?.value===a&&y?.end===o){y.end++,T?.value===a&&T.start===o+1?(y.end=T.end,c.splice(l,1)):T?.start===o&&(T.start++,T.start===T.end&&(c.splice(l,1),T=c[l],T?.start===o+1&&T.value===a&&(y.end=T.end,c.splice(l,1))));return}if(T?.value===a&&T.start===o+1){T.start--,y?.end>o&&(y.end=o,y.end===y.start&&c.splice(l,1));return}if(T?.start===o&&T.end===o+1){T.value=a;const C=c[l+1];C?.start==o+1&&C.value===a&&(c.splice(l+1,1),T.end=C.end);return}o===T?.start&&T.start++,m&&d>o+1?c.splice(v,0,h,{start:o+1,end:y.end,value:y.value}):c.splice(v,0,h),y?.end>o&&(y.end=o)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}toIJK(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[n,r,i]}toIndex([e,n,r]){return e+r*this.kMultiple+n*this.jMultiple}getRLE(e,n,r=0){const i=this.rows.get(n+r*this.height);if(!i)return;const a=this.findIndex(i,e),o=i[a];return e>=o?.start?o:void 0}has(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple;return this.getRLE(n,r)?.value!==void 0}delete(e){const n=e%this.width,r=(e-n)/this.width,i=this.rows.get(r);if(!i)return;const a=this.findIndex(i,n),o=i[a];if(!o||o.start>n)return;if(o.end===n+1){o.end--,o.start>=o.end&&(i.splice(a,1),i.length||this.rows.delete(r));return}if(o.start===n){o.start++;return}const s={value:o.value,start:n+1,end:o.end};o.end=n,i.splice(a+1,0,s)}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:i}=e[r];if(n<i)return r}return e.length}forEach(e,n){const r=n?.rowModified;for(const[i,a]of this.rows){const o=r?[...a]:a;for(const s of o)e(i*this.width,s,a)}}forEachRow(e){for(const[n,r]of this.rows)e(n*this.width,r)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:r,height:i,numComps:a}=this;for(let o=0;o<i;o++){const s=this.getRun(o,e);if(s)if(a===1)for(const c of s){const l=o*r,{start:f,end:u,value:g}=c;for(let d=f;d<u;d++)n[l+d]=g}else for(const c of s){const l=o*r*a,{start:f,end:u,value:g}=c;for(let d=f;d<u;d+=a)for(let p=0;p<a;p++)n[l+d+p]=g[p]}}return n}floodFill(e,n,r,i,a){const o=this.getRLE(e,n,r);if(!o)throw new Error(`Initial point ${e},${n},${r} isn't in the RLE`);const s=[[o,n,r]],c=o.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(s,c,i,a)}flood(e,n,r,i){let a=0;const{planar:o=!0,diagonals:s=!0,singlePlane:c=!1}=i||{},l={planar:o,diagonals:s,singlePlane:c};for(;e.length;){const f=e.pop(),[u]=f;if(u.value!==n)continue;u.value=r,a+=u.end-u.start;const g=this.findAdjacents(f,l).filter(d=>d&&d[0].value===n);e.push(...g)}return a}fillFrom(e,n){for(let r=n[2][0];r<=n[2][1];r++)for(let i=n[1][0];i<=n[1][1];i++){let a,o;for(let s=n[0][0];s<=n[0][1];s++){const c=e(s,i,r);if(c===void 0){a=void 0;continue}o||(o=[],this.rows.set(i+r*this.height,o)),a&&a.value!==c&&(a=void 0),a||(a={start:s,end:s,value:c},o.push(a)),a.end++}}}findAdjacents(e,{diagonals:n=!0,planar:r=!0,singlePlane:i=!1}){const[a,o,s,c]=e,{start:l,end:f}=a,u=l>0&&this.getRLE(l-1,o,s),g=f<this.width&&this.getRLE(f,o,s),d=n?[l>0?l-1:l,f<this.width?f+1:f]:[l,f],p=[];u&&p.push([u,o,s]),g&&p.push([g,o,s]);for(const h of c||(i?Cm:Tm)){const[,m,v]=h,y=m+o,T=v+s;if(y<0||y>=this.height||T<0||T>=this.depth)continue;const C=this.getRun(y,T);if(C)for(const w of C){const S=c||i&&Cm||r&&v>0&&UL||r&&v<0&&FL||Tm;w.end<=d[0]||w.start>=d[1]||p.push([w,y,T,S])}}return p}};qp.getScalarData=function(e=Uint8ClampedArray){const n=new e(this.frameSize);return this.map.updateScalarData(n),n};let Jo=qp,Tf=class dl{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:i=128}=e,a=n*r;this.growSize=i,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let i=0;i<this._dimensions;i++)n.push(this.data[i+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,i=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(i);a.set(this.data),this.data=a,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,i=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const o=this.data[r+a];this.data[r+a]=this.data[i+a],this.data[i+a]=o}}}getTypedArray(){return this.data}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:i}=e;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),i&&i.push(a[2])}),e}static fromXYZ({x:e,y:n,z:r}){const i=dl.create3(e.length);let a=0;for(let o=0;o<e.length;o++)i.data[a++]=e[o],i.data[a++]=n[o],i.data[a++]=r?r[o]:0;return i._length=e.length,i}subselect(e=10,n=0){const r=new dl({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const a=(n+Math.floor(this.length*i/e))%this.length;r.push(this.getPoint(a))}return r}static create3(e=128,n){e=Math.max(e,n?.length||0);const r=new dl({initialSize:e,dimensions:3});return n&&n.forEach(i=>r.push(i)),r}static create2(e=128){return new dl({initialSize:e,dimensions:2})}};function P9(t){const e=Ie(),n=t.getDimensions(),r=Tf.create3(n[0]),i=Tf.create3(n[1]),a=Tf.create3(n[2]),o=t.getDirection(),s=o.slice(0,3),c=o.slice(3,6),l=o.slice(6,9),f=t.getSpacing(),[u,g,d]=f,p=t.indexToWorld([0,0,0]),h=Et(s[0]*u,s[1]*u,s[2]*u),m=Et(c[0]*g,c[1]*g,c[2]*g),v=Et(l[0]*d,l[1]*d,l[2]*d),y=Ie();for(let S=0;S<n[0];S++)r.push(co(y,p,zi(y,h,S)));for(let S=0;S<n[1];S++)i.push(zi(y,m,S));for(let S=0;S<n[2];S++)a.push(zi(y,v,S));const T=r.getTypedArray(),C=i.getTypedArray(),w=a.getTypedArray();return(S,_=e)=>{const[D,N,P]=S,F=D*3,B=N*3,k=P*3;return _[0]=T[F]+C[B]+w[k],_[1]=T[F+1]+C[B+1]+w[k+1],_[2]=T[F+2]+C[B+2]+w[k+2],_}}function N9(t,e){const{pointInShapeFn:n,callback:r,boundsIJK:i,returnPoints:a=!1}=e;let o;if(t.getScalarData)o=t.getScalarData();else{const u=t.getPointData().getScalars();if(u)o=u.getData();else{const{voxelManager:g}=t.get("voxelManager")||{};g&&(o=g.getCompleteScalarDataArray())}}const s=t.getDimensions(),c=[[0,s[0]],[0,s[1]],[0,s[2]]],f=kL({imageData:t,bounds:i||c,scalarData:o,pointInShapeFn:n,callback:r});return a?f:void 0}function kL({imageData:t,bounds:e,scalarData:n,pointInShapeFn:r,callback:i}){const[[a,o],[s,c],[l,f]]=e,{numComps:u}=t,g=t.getDimensions(),d=P9(t),p=[0,0,0],h=u||n.length/g[2]/g[1]/g[0],m=g[0]*h,v=g[1]*m,y=[];for(let T=l;T<=f;T++){p[2]=T;const C=T*v;for(let w=s;w<=c;w++){p[1]=w;const S=C+w*m;for(let _=a;_<=o;_++){p[0]=_;const D=d(p);if(r(D,p)){const N=S+_*h;let P;h>2?P=[n[N],n[N+1],n[N+2]]:P=n[N],y.push({value:P,index:N,pointIJK:p,pointLPS:D.slice()}),i({value:P,index:N,pointIJK:p,pointLPS:D})}}}}return y}function GL({voxelManager:t,bounds:e,imageData:n,pointInShapeFn:r,callback:i,returnPoints:a}){const[[o,s],[c,l],[f,u]]=e,g=P9(n),d=[0,0,0],p=[];for(let h=f;h<=u;h++){d[2]=h;for(let m=c;m<=l;m++){d[1]=m;for(let v=o;v<=s;v++){d[0]=v;const y=g(d);if(r(y,d)){const T=t.toIndex(d),C=t.getAtIndex(T);a&&p.push({value:C,index:T,pointIJK:[...d],pointLPS:y.slice()}),i?.({value:C,index:T,pointIJK:d,pointLPS:y})}}}}return p}const BL=5*1024;class en{get id(){return this._id}constructor(e,n){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(r,i,a)=>{const o=this.toIndex([r,i,a]);return this._get(o)},this.setAtIJK=(r,i,a,o)=>{const s=this.toIndex([r,i,a]),c=this._set(s,o);return c!==!1&&(this.modifiedSlices.add(a),en.addBounds(this.boundsIJK,[r,i,a])),c},this.getAtIJKPoint=([r,i,a])=>this.getAtIJK(r,i,a),this.setAtIJKPoint=([r,i,a],o)=>{this.setAtIJK(r,i,a,o)},this.getAtIndex=r=>this._get(r),this.setAtIndex=(r,i)=>{const a=this._set(r,i);if(a!==!1){const o=this.toIJK(r);this.modifiedSlices.add(o[2]),en.addBounds(this.boundsIJK,o)}return a},this.getMiddleSliceData=()=>{const r=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:r,slicePlane:2})},this.forEach=(r,i={})=>{const a=i.boundsIJK||this.getBoundsIJK(),o=i.isInObject||this.isInObject||(()=>!0),s=i.returnPoints||!1,c=i.imageData,l=Math.min(a[0][0],a[0][1]),f=Math.max(a[0][0],a[0][1]),u=Math.min(a[1][0],a[1][1]),g=Math.max(a[1][0],a[1][1]),d=Math.min(a[2][0],a[2][1]),p=Math.max(a[2][0],a[2][1]),h=[];if(c)return GL({voxelManager:this,imageData:i.imageData,bounds:[[l,f],[u,g],[d,p]],pointInShapeFn:o,callback:r,returnPoints:s});if(this.map){if(this.map instanceof Jo)return this.rleForEach(r,i);for(const m of this.map.keys()){const v=this.toIJK(m);if(!o(null,v))continue;const y=this._get(m);s&&h.push({value:y,index:m,pointIJK:v,pointLPS:null}),r({value:y,index:m,pointIJK:v,pointLPS:null})}return h}else{for(let m=d;m<=p;m++){const v=m*this.frameSize;for(let y=u;y<=g;y++){const T=v+y*this.width;for(let C=l,w=T+C;C<=f;C++,w++){const S=this.getAtIndex(w),_=[C,y,m];o(null,_)&&(s&&h.push({value:S,index:w,pointIJK:_,pointLPS:null}),r({value:S,index:w,pointIJK:[C,y,m],pointLPS:null}))}}}return h}},this.getSliceData=({sliceIndex:r,slicePlane:i})=>{const[a,o,s]=this.dimensions,c=a*o,l=r*c;let f;const u=this.getConstructor();function g(p){return typeof p=="function"}if(!g(u))return new Uint8Array(0);let d;switch(i){case 0:f=o*s,d=new u(f);for(let p=0;p<o;p++)for(let h=0;h<s;h++){const m=r+p*a+h*c;this.setSliceDataValue(d,p*s+h,this._get(m))}break;case 1:f=a*s,d=new u(f);for(let p=0;p<a;p++)for(let h=0;h<s;h++){const m=p+r*a+h*c;this.setSliceDataValue(d,p+h*a,this._get(m))}break;case 2:f=a*o,d=new u(f);for(let p=0;p<f;p++)this.setSliceDataValue(d,p,this._get(l+p));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return d},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n._get,this._set=n._set,this._id=n._id||"",this._getConstructor=n._getConstructor,this.numberOfComponents=n.numberOfComponents||1,this.scalarData=n.scalarData,this._getScalarData=n._getScalarData,this._updateScalarData=n._updateScalarData}getMinMax(){let e,n;const r=({value:i})=>{const a=Array.isArray(i);if(e===void 0&&(e=a?[...i]:i,n=a?[...i]:i),a)for(let o=0;o<i.length;o++)e[o]=Math.min(e[o],i[o]),n[o]=Math.max(n[o],i[o]);else e=Math.min(e,i),n=Math.max(n,i)};return this.forEach(r,{boundsIJK:this.getDefaultBounds()}),{min:e,max:n}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,n){const r=n?.boundsIJK||this.getBoundsIJK(),{isWithinObject:i}=n||{},a=this.map;if(!a){console.warn("No map found, you need to use a map voxel manager to use rleForEach");return}a.defaultValue=void 0;for(let o=r[2][0];o<=r[2][1];o++)for(let s=r[1][0];s<=r[1][1];s++){const c=a.getRun(s,o);if(c)for(const l of c){const{start:f,end:u,value:g}=l,d=this.toIndex([0,s,o]);for(let p=f;p<u;p++){const h={value:g,index:d+p,pointIJK:[p,s,o]};i?.(h)!==!1&&e(h)}}}}getScalarData(e=!1){if(this.scalarData)return this._updateScalarData?.(this.scalarData),this.scalarData;if(this._getScalarData){const n=this._getScalarData();return e&&console.log("Not transient, should store value",n),n}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clearBounds(){this.boundsIJK.map(e=>{e[0]=1/0,e[1]=-1/0})}clear(){this.map?.clear(),this.clearBounds(),this.modifiedSlices.clear(),this.points?.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}setBounds(e){this.boundsIJK=e}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,n,r){if(Array.isArray(r))for(let i=0;i<r.length;i++)e[n*r.length+i]=this.toNumber(r[i]);else e[n]=this.toNumber(r)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=3,id:i}){const a=new en(e,{_get:o=>(o*=r,[n[o++],n[o++],n[o++]]),_id:i||"_createRGBScalarVolumeVoxelManager",_set:(o,s)=>{o*=3;const c=!Wt(n[o],s);return n[o++]=s[0],n[o++]=s[1],n[o++]=s[2],c},numberOfComponents:r,scalarData:n});return a.clear=()=>{n.fill(0)},a}static createImageVolumeVoxelManager({dimensions:e,imageIds:n,numberOfComponents:r=1,id:i}){const a=e[0]*e[1];function o(u){const g=Math.floor(u/a);if(g<0||g>=e[2])return{};const d=n[g];if(!d)return console.warn(`ImageId not found for sliceIndex: ${g}`),{pixelData:null,pixelIndex:null};const p=Ve.getImage(d);if(!p)return console.warn(`Image not found for imageId: ${d}`),{pixelData:null,pixelIndex:null};const h=p.voxelManager,m=u%a;return{voxelManager:h,pixelIndex:m}}function s(u){const{voxelManager:g,pixelIndex:d}=o(u);return!g||d===null?null:g.getAtIndex(d)}function c(u,g){const{voxelManager:d,pixelIndex:p}=o(u);if(!d||p===null)return!1;const h=d.getAtIndex(p),m=!Wt(g,h);return m&&(d.setAtIndex(p,g),!0)}const l=()=>{const{voxelManager:u,pixelIndex:g}=o(0);return!u||g===null?null:u.getConstructor()},f=new en(e,{_get:s,_set:c,numberOfComponents:r,_getConstructor:l,_id:i||"createImageVolumeVoxelManager"});return f.getMiddleSliceData=()=>{const u=Math.floor(e[2]/2);return f.getSliceData({sliceIndex:u,slicePlane:2})},f.clear=()=>{for(const u of n)Ve.getImage(u).voxelManager.clear()},f.getRange=()=>{let u=1/0,g=-1/0;for(const d of n){const p=Ve.getImage(d);p&&(p.minPixelValue<u&&(u=p.minPixelValue),p.maxPixelValue>g&&(g=p.maxPixelValue))}return u===1/0&&g===-1/0?[0,0]:[u,g]},f._getScalarDataLength=()=>{const{voxelManager:u,pixelIndex:g}=o(0);return!u||g===null?0:u.getScalarDataLength()*e[2]},f.getCompleteScalarDataArray=()=>{const u=f._getConstructor();if(!u)return new Uint8Array(0);const g=f.getScalarDataLength(),d=new u(g),p=e[0]*e[1]*r;for(let h=0;h<e[2];h++){const{voxelManager:m,pixelIndex:v}=o(h*p/r);if(m&&v!==null){const y=h*p,T=m.getScalarData();if(r===1)d.set(T,y);else for(let C=0;C<T.length;C+=r)for(let w=0;w<r;w++)d[y+C+w]=T[C+w]}}return d},f.setCompleteScalarDataArray=u=>{const g=e[0]*e[1]*r,d=f._getConstructor();let p=1/0,h=-1/0;for(let m=0;m<e[2];m++){const{voxelManager:v}=o(m*g/r);if(v&&d){const y=m*g,T=y+g,C=new d(g);if(C.set(u.subarray(y,T)),v.scalarData)v.scalarData.set(C),v.modifiedSlices.add(m);else for(let _=0;_<g;_++)v.setAtIndex(_,C[_]);for(let _=0;_<C.length;_++){const D=C[_];p=Math.min(p,D),h=Math.max(h,D)}const w=n[m],S=Ve.getImage(w);S&&(S.minPixelValue=p,S.maxPixelValue=h)}}for(let m=0;m<e[2];m++)f.modifiedSlices.add(m);f.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},f}static createScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r,id:i}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?en._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r,id:i}):en._createNumberVolumeVoxelManager({dimensions:e,scalarData:n,id:i})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:n,dimensionGroupNumber:r=1,timePoint:i=0,numberOfComponents:a=1,id:o}){let s=0;if(r!==void 0?s=r-1:i!==void 0&&(console.warn("Warning: timePoint parameter is deprecated. Please use dimensionGroupNumber instead. timePoint is zero-based while dimensionGroupNumber starts at 1."),s=i),!a){const f=Ve.getImage(e[0][0]);if(!f)throw new Error("Unable to determine number of components: No image found");if(a=f.getPixelData().length/(n[0]*n[1]),a>4||a<1||a===2)throw new Error(`Number of components ${a} must be 1, 3 or 4`)}const c=e.map(f=>en.createImageVolumeVoxelManager({dimensions:n,imageIds:f,numberOfComponents:a,id:o})),l=new en(n,{_get:f=>c[s]._get(f),_set:(f,u)=>c[s]._set(f,u),numberOfComponents:a,_id:o||"createScalarDynamicVolumeVoxelManager"});return l.getScalarDataLength=()=>c[s].getScalarDataLength(),l.getConstructor=()=>c[s].getConstructor(),l.getRange=()=>c[s].getRange(),l.getMiddleSliceData=()=>c[s].getMiddleSliceData(),l.setTimePoint=f=>{console.warn("Warning: setTimePoint is deprecated. Please use setDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.setDimensionGroupNumber(f+1)},l.setDimensionGroupNumber=f=>{s=f-1,l._get=u=>c[s]._get(u),l._set=(u,g)=>c[s]._set(u,g)},l.getAtIndexAndTimePoint=(f,u)=>(console.warn("Warning: getAtIndexAndTimePoint is deprecated. Please use getAtIndexAndDimensionGroup instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.getAtIndexAndDimensionGroup(f,u+1)),l.getAtIndexAndDimensionGroup=(f,u)=>c[u-1]._get(f),l.getTimePointScalarData=f=>(console.warn("Warning: getTimePointScalarData is deprecated. Please use getDimensionGroupScalarData instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.getDimensionGroupScalarData(f+1)),l.getDimensionGroupScalarData=f=>c[f-1].getCompleteScalarDataArray(),l.getCurrentTimePointScalarData=()=>(console.warn("Warning: getCurrentTimePointScalarData is deprecated. Please use getCurrentDimensionGroupScalarData instead."),l.getCurrentDimensionGroupScalarData()),l.getCurrentDimensionGroupScalarData=()=>c[s].getCompleteScalarDataArray(),l.getCurrentTimePoint=()=>(console.warn("Warning: getCurrentTimePoint is deprecated. Please use getCurrentDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),s),l.getCurrentDimensionGroupNumber=()=>s+1,l}static createImageVoxelManager({width:e,height:n,scalarData:r,numberOfComponents:i=1,id:a}){const o=[e,n,1];if(!i&&(i=r.length/e/n,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?en._createRGBScalarVolumeVoxelManager({dimensions:o,scalarData:r,numberOfComponents:i,id:a}):en._createNumberVolumeVoxelManager({dimensions:o,scalarData:r,id:a})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:n,id:r}){const i=new en(e,{_get:a=>n[a],_set:(a,o)=>{const s=n[a]!==o;return n[a]=o,s},_getConstructor:()=>n.constructor,_id:r||"_createNumberVolumeVoxelManager"});return i.scalarData=n,i.clear=()=>{i.scalarData.fill(0)},i.getMiddleSliceData=()=>{const a=Math.floor(e[2]/2);return i.getSliceData({sliceIndex:a,slicePlane:2})},i}static createMapVoxelManager({dimension:e,id:n}){const r=new Map,i=new en(e,{_get:r.get.bind(r),_set:(a,o)=>r.set(a,o)&&!0,_id:n||"createMapVoxelManager"});return i.map=r,i}static createHistoryVoxelManager(e,n){const r=new Map,{dimensions:i}=e,a=new en(i,{_get:o=>r.get(o),_set:function(o,s){if(r.has(o))s===r.get(o)&&r.delete(o);else{const c=this.sourceVoxelManager.getAtIndex(o);if(c===s)return!1;r.set(o,c)}this.sourceVoxelManager.setAtIndex(o,s)},_id:n||"createHistoryVoxelManager"});return a.map=r,a.scalarData=e.scalarData,a.sourceVoxelManager=e,a}static createRLEHistoryVoxelManager(e,n){const{dimensions:r}=e,i=new Jo(r[0],r[1],r[2]),a=new en(r,{_get:o=>i.get(o),_set:function(o,s){const c=i.get(o);if(c===void 0){const l=this.sourceVoxelManager.getAtIndex(o);if(l===s||l===void 0&&s===0||s===null)return!1;i.set(o,l??0)}else(s===c||s===null)&&(i.delete(o),s=c);this.sourceVoxelManager.setAtIndex(o,s)},_getScalarData:Jo.getScalarData,_updateScalarData:o=>(i.updateScalarData(o),o),_id:n||"createRLEHistoryVoxelManager"});return a.map=i,a.sourceVoxelManager=e,a}static createLazyVoxelManager({dimensions:e,planeFactory:n,id:r}){const i=new Map,[a,o]=e,s=a*o,c=new en(e,{_get:l=>i.get(Math.floor(l/s))[l%s],_set:(l,f)=>{const u=Math.floor(l/s);let g=i.get(u);return g||(g=n(a,o),i.set(u,g)),g[l%s]=f,!0},_id:r||"createLazyVoxelManager"});return c.map=i,c}static createRLEVolumeVoxelManager({dimensions:e,id:n}){const[r,i,a]=e,o=new Jo(r,i,a),s=new en(e,{_get:c=>o.get(c),_set:(c,l)=>(o.set(c,l),!0),_getScalarData:Jo.getScalarData,_updateScalarData:c=>(o.updateScalarData(c),c),_id:n||"createRLEVolumeVoxelManager"});return s.map=o,s.getPixelData=o.getPixelData.bind(o),s}static createRLEImageVoxelManager({dimensions:e,id:n}){const[r,i]=e;return en.createRLEVolumeVoxelManager({dimensions:[r,i,1],id:n})}static addInstanceToImage(e){const{width:n,height:r}=e,i=e.voxelManager.getScalarData();if(i.length>=n*r){e.voxelManager=en.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:i});return}e.voxelManager=en.createRLEVolumeVoxelManager({dimensions:[n,r,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=BL}}const $L="WebGL",sg=Object.create(null);function A9(t,e){sg[t]=e}function WL(){return Object.keys(sg)}function F9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sg[t]&&sg[t](e)}function zL(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return F9(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const i=r.getViewProps(),a=e._views[0].getViewNodeFor(r);i.forEach(o=>{if(o.getVisibility()){n.propCount+=1;const s=o.getMapper&&o.getMapper();if(s&&s.getPrimitiveCount){const c=a.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=s.getPrimitiveCount();Object.keys(l).forEach(f=>{n[f]||(n[f]=0),n[f]+=l[f]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return A.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(n,r):void 0).filter(i=>!!i)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(i=>i===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const HL={defaultViewAPI:$L,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function U9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HL,n),A.obj(t,e),A.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),A.get(t,e,["neverRendered"]),A.getArray(t,e,["renderers","childRenderWindows"]),A.moveToProtected(t,e,["views"]),A.event(t,e,"completion"),zL(t,e)}const jL=A.newInstance(U9,"vtkRenderWindow");var KL={newInstance:jL,extend:U9,registerViewConstructor:A9,listViewAPIs:WL,newAPISpecificView:F9};function qL(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${A.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}),e.delegates.forEach(i=>{i.traverse(n,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}))}}const XL={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function k9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XL,n),A.obj(t,e),A.get(t,e,["currentOperation"]),A.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),A.moveToProtected(t,e,["currentParent"]),qL(t,e)}const YL=A.newInstance(k9,"vtkRenderPass");var Xg={newInstance:YL,extend:k9};const{Representation:ZL}=lu,{vtkErrorMacro:wm}=A;function JL(t){const e=ce.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const QL=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function eV(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),a=ot.newInstance({numberOfComponents:3,values:n});a.setName("points");const o=ot.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");const s=ot.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",ZL.SURFACE,{points:a,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),i=n.getContext();e.framebuffer=su.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Xt.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw({width:r[0],height:r[1],numComps:4,dataType:"Float32Array",data:null}),e.translucentRTexture=Xt.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw({width:r[0],height:r[1],numComps:1,dataType:"Float32Array",data:null}),e.translucentZTexture=Xt.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw({width:r[0],height:r[1],dataType:"Float32Array",data:null}),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),QL,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||wm("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||wm("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,i)=>{if(e.deleted)return;const a=n.getSize(),o=n.getContext();if(e._supported=!1,r.getSelector()||!o||!n.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==a[0]||c[1]!==a[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),r.traverse(i)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=zg.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=r.getTiledSizeAndOrigin();o.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),o.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?JL:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const tV={framebuffer:null,copyShader:null,tris:null};function G9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tV,n),Xg.extend(t,e,n),e.VBOBuildTime={},A.obj(e.VBOBuildTime,{mtime:0}),e.tris=To.newInstance(),A.get(t,e,["framebuffer"]),eV(t,e)}const nV=A.newInstance(G9,"vtkOpenGLOrderIndependentTranslucentPass");var rV={newInstance:nV,extend:G9};function iV(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const i=n.getRenderable().getNumberOfLayers(),a=n.getRenderable().getRenderersByReference();for(let o=0;o<i;o++)for(let s=0;s<a.length;s++){const c=a[s],l=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const f=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=su.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==f[0]||u[1]!==f[1])&&(e.framebuffer.create(f[0],f[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=rV.newInstance()),e.translucentPass.traverse(n,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const aV={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function B9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aV,n),Xg.extend(t,e,n),A.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),iV(t,e)}const oV=A.newInstance(B9,"vtkForwardPass");var B2={newInstance:oV,extend:B9};const Ar={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var $9={PassTypes:Ar};const{FieldAssociations:sV}=L0;function cV(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,i,a,o)=>{},t.selectAsync=async(n,r,i,a,o)=>{const s=await t.getSourceDataAsync(n,r,i,a,o);return s?s.generateSelection(r,i,a,o):[]}}const lV={fieldAssociation:sV.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function W9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lV,n),A.obj(t,e),A.setGet(t,e,["fieldAssociation","captureZValues"]),cV(t,e)}const uV=A.newInstance(W9,"vtkHardwareSelector");var fV={newInstance:uV,extend:W9};const gV={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},dV={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var hV={SelectionContent:gV,SelectionField:dV};function pV(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const mV={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function z9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mV,n),A.obj(t,e),e.properties={},A.setGet(t,e,["contentType","fieldType","properties","selectionList"]),pV(t,e)}const vV=A.newInstance(z9,"vtkSelectionNode");var H9={newInstance:vV,extend:z9,...hV};const{PassTypes:Rn}=$9,{SelectionContent:yV,SelectionField:Sm}=H9,{FieldAssociations:xl}=L0,{vtkErrorMacro:j9}=A,Qo=1;function K9(t){return`${t.propID} ${t.compositeID}`}function q9(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4;return n[i+3]}function ro(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4,a=n[i],o=n[i+1];return(n[i+2]*256+o)*256+a}function X9(t,e){let n=e;return n<<=24,n|=t,n}function TV(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],a=ro(i[0],i[1],t.pixBuffer[Rn.ACTOR_PASS],t.area);if(a<=0||a-Qo>=t.props.length)return null;const o={};o.valid=!0,o.propID=a-Qo,o.prop=t.props[o.propID];let s=ro(i[0],i[1],t.pixBuffer[Rn.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),o.compositeID=s-Qo,t.captureZValues){const f=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;o.zValue=(256*t.zBuffer[f]+t.zBuffer[f+1])/65535,o.displayPosition=e}if(t.pixBuffer[Rn.ID_LOW24]&&q9(i[0],i[1],t.pixBuffer[Rn.ID_LOW24],t.area)===0)return o;const c=ro(i[0],i[1],t.pixBuffer[Rn.ID_LOW24],t.area),l=ro(i[0],i[1],t.pixBuffer[Rn.ID_HIGH24],t.area);return o.attributeID=X9(c,l),o}}function Y9(t,e,n,r,i){const a=[];let o=0;return e.forEach((s,c)=>{const l=H9.newInstance();switch(l.setContentType(yV.INDICES),t){case xl.FIELD_ASSOCIATION_CELLS:l.setFieldType(Sm.CELL);break;case xl.FIELD_ASSOCIATION_POINTS:l.setFieldType(Sm.POINT);break;default:j9("Unknown field association")}l.getProperties().propID=s.info.propID,l.getProperties().prop=s.info.prop,l.getProperties().compositeID=s.info.compositeID,l.getProperties().attributeID=s.info.attributeID,l.getProperties().pixelCount=s.pixelCount,n&&(l.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],l.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r)),l.setSelectionList(s.attributeIDs),a[o]=l,o++}),a}function CV(t,e,n,r,i){const a=Math.floor(e),o=Math.floor(n),s=Math.floor(r),c=Math.floor(i),l=new Map,f=[0,0];for(let u=o;u<=c;u++)for(let g=a;g<=s;g++){const p=TV(t,[g,u],0,f);if(p&&p.valid){const h=K9(p);if(!l.has(h))l.set(h,{info:p,pixelCount:1,attributeIDs:[p.attributeID]});else{const m=l.get(h);m.pixelCount++,t.captureZValues&&p.zValue<m.info.zValue&&(m.info=p),m.attributeIDs.indexOf(p.attributeID)===-1&&m.attributeIDs.push(p.attributeID)}}}return Y9(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function wV(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=su.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==r[0]||i[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===xl.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),a=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),a&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,i,a,o,s)=>{if(e._renderer=r,i===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(i,a,o,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,f=new Array(l),u=0;u<l;u++)f[u]=arguments[u];return CV(c,...f)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return j9("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=Rn.MIN_KNOWN_PASS;e.currentPass<=Rn.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Rn.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(a=>{e.currentPass=a,t.processPixelBuffers()}),e.currentPass=Rn.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,i)=>{t.isPropHit(i)&&r.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=r=>{if(r===Rn.ID_HIGH24){if(e.fieldAssociation===xl.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===xl.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(i),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===Rn.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const a=i[0].getFramebuffer();a.saveCurrentBindingsAndBuffers(),a.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),a.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let i=0;for(let a=0;a<=e.area[3]-e.area[1];a++)for(let o=0;o<=e.area[2]-e.area[0];o++){let s=ro(o,a,r,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=r=>{e.currentPass===Rn.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Qo),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===Rn.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Qo)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>A.enumToString(Rn,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,i,a)=>{const o=i<0?0:i;if(console.log("getPixelInformation called",o),o===0){if(a[0]=r[0],a[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;console.log(r),console.log(e.area);const f=[r[0]-e.area[0],r[1]-e.area[1]];console.log("adjusted displayPosition",f);const u=ro(f[0],f[1],e.pixBuffer[Rn.ACTOR_PASS],e.area);if(console.log("actorid",u),u<=0||u-Qo>=e.props.length)return null;const g={};g.valid=!0,g.propID=u-Qo,g.prop=e.props[g.propID];let d=ro(f[0],f[1],e.pixBuffer[Rn.COMPOSITE_INDEX_PASS],e.area);if((d<0||d>16777215)&&(d=0),g.compositeID=d-Qo,e.captureZValues){const m=(f[1]*(e.area[2]-e.area[0]+1)+f[0])*4;g.zValue=(256*e.zBuffer[m]+e.zBuffer[m+1])/65535,g.displayPosition=r}if(e.pixBuffer[Rn.ID_LOW24]&&q9(f[0],f[1],e.pixBuffer[Rn.ID_LOW24],e.area)===0)return g;const p=ro(f[0],f[1],e.pixBuffer[Rn.ID_LOW24],e.area),h=ro(f[0],f[1],e.pixBuffer[Rn.ID_HIGH24],e.area);return g.attributeID=X9(p,h),g}const s=[r[0],r[1]],c=[0,0];let l=t.getPixelInformation(r,0,a);if(l&&l.valid)return l;for(let f=1;f<o;++f){for(let u=s[1]>f?s[1]-f:0;u<=s[1]+f;++u)if(c[1]=u,s[0]>=f&&(c[0]=s[0]-f,l=t.getPixelInformation(c,0,a),l&&l.valid)||(c[0]=s[0]+f,l=t.getPixelInformation(c,0,a),l&&l.valid))return l;for(let u=s[0]>=f?s[0]-(f-1):0;u<=s[0]+(f-1);++u)if(c[0]=u,s[1]>=f&&(c[1]=s[1]-f,l=t.getPixelInformation(c,0,a),l&&l.valid)||(c[1]=s[1]+f,l=t.getPixelInformation(c,0,a),l&&l.valid))return l}return a[0]=r[0],a[1]=r[1],null},t.generateSelection=(r,i,a,o)=>{const s=Math.floor(r),c=Math.floor(i),l=Math.floor(a),f=Math.floor(o),u=new Map,g=[0,0];for(let d=c;d<=f;d++)for(let p=s;p<=l;p++){const h=[p,d],m=t.getPixelInformation(h,0,g);if(m&&m.valid){const v=K9(m);if(!u.has(v))u.set(v,{info:m,pixelCount:1,attributeIDs:[m.attributeID]});else{const y=u.get(v);y.pixelCount++,e.captureZValues&&m.zValue<y.info.zValue&&(y.info=m),y.attributeIDs.indexOf(m.attributeID)===-1&&y.attributeIDs.push(m.attributeID)}}}return Y9(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,i)=>{e._openGLRenderWindow=r,e._renderer=i};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const SV={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function Z9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SV,n),fV.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),A.setGetArray(t,e,["area"],4),A.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),A.setGetArray(t,e,["propColorValue"],3),A.moveToProtected(t,e,["renderer","openGLRenderWindow"]),A.event(t,e,"event"),wV(t,e)}const xV=A.newInstance(Z9,"vtkOpenGLHardwareSelector");var $2={newInstance:xV,extend:Z9,...$9},td={exports:{}},xm;function EV(){return xm||(xm=1,(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(v,y){var T=v[0],C=v[1],w=v[2],S=v[3];T+=(C&w|~C&S)+y[0]-680876936|0,T=(T<<7|T>>>25)+C|0,S+=(T&C|~T&w)+y[1]-389564586|0,S=(S<<12|S>>>20)+T|0,w+=(S&T|~S&C)+y[2]+606105819|0,w=(w<<17|w>>>15)+S|0,C+=(w&S|~w&T)+y[3]-1044525330|0,C=(C<<22|C>>>10)+w|0,T+=(C&w|~C&S)+y[4]-176418897|0,T=(T<<7|T>>>25)+C|0,S+=(T&C|~T&w)+y[5]+1200080426|0,S=(S<<12|S>>>20)+T|0,w+=(S&T|~S&C)+y[6]-1473231341|0,w=(w<<17|w>>>15)+S|0,C+=(w&S|~w&T)+y[7]-45705983|0,C=(C<<22|C>>>10)+w|0,T+=(C&w|~C&S)+y[8]+1770035416|0,T=(T<<7|T>>>25)+C|0,S+=(T&C|~T&w)+y[9]-1958414417|0,S=(S<<12|S>>>20)+T|0,w+=(S&T|~S&C)+y[10]-42063|0,w=(w<<17|w>>>15)+S|0,C+=(w&S|~w&T)+y[11]-1990404162|0,C=(C<<22|C>>>10)+w|0,T+=(C&w|~C&S)+y[12]+1804603682|0,T=(T<<7|T>>>25)+C|0,S+=(T&C|~T&w)+y[13]-40341101|0,S=(S<<12|S>>>20)+T|0,w+=(S&T|~S&C)+y[14]-1502002290|0,w=(w<<17|w>>>15)+S|0,C+=(w&S|~w&T)+y[15]+1236535329|0,C=(C<<22|C>>>10)+w|0,T+=(C&S|w&~S)+y[1]-165796510|0,T=(T<<5|T>>>27)+C|0,S+=(T&w|C&~w)+y[6]-1069501632|0,S=(S<<9|S>>>23)+T|0,w+=(S&C|T&~C)+y[11]+643717713|0,w=(w<<14|w>>>18)+S|0,C+=(w&T|S&~T)+y[0]-373897302|0,C=(C<<20|C>>>12)+w|0,T+=(C&S|w&~S)+y[5]-701558691|0,T=(T<<5|T>>>27)+C|0,S+=(T&w|C&~w)+y[10]+38016083|0,S=(S<<9|S>>>23)+T|0,w+=(S&C|T&~C)+y[15]-660478335|0,w=(w<<14|w>>>18)+S|0,C+=(w&T|S&~T)+y[4]-405537848|0,C=(C<<20|C>>>12)+w|0,T+=(C&S|w&~S)+y[9]+568446438|0,T=(T<<5|T>>>27)+C|0,S+=(T&w|C&~w)+y[14]-1019803690|0,S=(S<<9|S>>>23)+T|0,w+=(S&C|T&~C)+y[3]-187363961|0,w=(w<<14|w>>>18)+S|0,C+=(w&T|S&~T)+y[8]+1163531501|0,C=(C<<20|C>>>12)+w|0,T+=(C&S|w&~S)+y[13]-1444681467|0,T=(T<<5|T>>>27)+C|0,S+=(T&w|C&~w)+y[2]-51403784|0,S=(S<<9|S>>>23)+T|0,w+=(S&C|T&~C)+y[7]+1735328473|0,w=(w<<14|w>>>18)+S|0,C+=(w&T|S&~T)+y[12]-1926607734|0,C=(C<<20|C>>>12)+w|0,T+=(C^w^S)+y[5]-378558|0,T=(T<<4|T>>>28)+C|0,S+=(T^C^w)+y[8]-2022574463|0,S=(S<<11|S>>>21)+T|0,w+=(S^T^C)+y[11]+1839030562|0,w=(w<<16|w>>>16)+S|0,C+=(w^S^T)+y[14]-35309556|0,C=(C<<23|C>>>9)+w|0,T+=(C^w^S)+y[1]-1530992060|0,T=(T<<4|T>>>28)+C|0,S+=(T^C^w)+y[4]+1272893353|0,S=(S<<11|S>>>21)+T|0,w+=(S^T^C)+y[7]-155497632|0,w=(w<<16|w>>>16)+S|0,C+=(w^S^T)+y[10]-1094730640|0,C=(C<<23|C>>>9)+w|0,T+=(C^w^S)+y[13]+681279174|0,T=(T<<4|T>>>28)+C|0,S+=(T^C^w)+y[0]-358537222|0,S=(S<<11|S>>>21)+T|0,w+=(S^T^C)+y[3]-722521979|0,w=(w<<16|w>>>16)+S|0,C+=(w^S^T)+y[6]+76029189|0,C=(C<<23|C>>>9)+w|0,T+=(C^w^S)+y[9]-640364487|0,T=(T<<4|T>>>28)+C|0,S+=(T^C^w)+y[12]-421815835|0,S=(S<<11|S>>>21)+T|0,w+=(S^T^C)+y[15]+530742520|0,w=(w<<16|w>>>16)+S|0,C+=(w^S^T)+y[2]-995338651|0,C=(C<<23|C>>>9)+w|0,T+=(w^(C|~S))+y[0]-198630844|0,T=(T<<6|T>>>26)+C|0,S+=(C^(T|~w))+y[7]+1126891415|0,S=(S<<10|S>>>22)+T|0,w+=(T^(S|~C))+y[14]-1416354905|0,w=(w<<15|w>>>17)+S|0,C+=(S^(w|~T))+y[5]-57434055|0,C=(C<<21|C>>>11)+w|0,T+=(w^(C|~S))+y[12]+1700485571|0,T=(T<<6|T>>>26)+C|0,S+=(C^(T|~w))+y[3]-1894986606|0,S=(S<<10|S>>>22)+T|0,w+=(T^(S|~C))+y[10]-1051523|0,w=(w<<15|w>>>17)+S|0,C+=(S^(w|~T))+y[1]-2054922799|0,C=(C<<21|C>>>11)+w|0,T+=(w^(C|~S))+y[8]+1873313359|0,T=(T<<6|T>>>26)+C|0,S+=(C^(T|~w))+y[15]-30611744|0,S=(S<<10|S>>>22)+T|0,w+=(T^(S|~C))+y[6]-1560198380|0,w=(w<<15|w>>>17)+S|0,C+=(S^(w|~T))+y[13]+1309151649|0,C=(C<<21|C>>>11)+w|0,T+=(w^(C|~S))+y[4]-145523070|0,T=(T<<6|T>>>26)+C|0,S+=(C^(T|~w))+y[11]-1120210379|0,S=(S<<10|S>>>22)+T|0,w+=(T^(S|~C))+y[2]+718787259|0,w=(w<<15|w>>>17)+S|0,C+=(S^(w|~T))+y[9]-343485551|0,C=(C<<21|C>>>11)+w|0,v[0]=T+v[0]|0,v[1]=C+v[1]|0,v[2]=w+v[2]|0,v[3]=S+v[3]|0}function a(v){var y=[],T;for(T=0;T<64;T+=4)y[T>>2]=v.charCodeAt(T)+(v.charCodeAt(T+1)<<8)+(v.charCodeAt(T+2)<<16)+(v.charCodeAt(T+3)<<24);return y}function o(v){var y=[],T;for(T=0;T<64;T+=4)y[T>>2]=v[T]+(v[T+1]<<8)+(v[T+2]<<16)+(v[T+3]<<24);return y}function s(v){var y=v.length,T=[1732584193,-271733879,-1732584194,271733878],C,w,S,_,D,N;for(C=64;C<=y;C+=64)i(T,a(v.substring(C-64,C)));for(v=v.substring(C-64),w=v.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<w;C+=1)S[C>>2]|=v.charCodeAt(C)<<(C%4<<3);if(S[C>>2]|=128<<(C%4<<3),C>55)for(i(T,S),C=0;C<16;C+=1)S[C]=0;return _=y*8,_=_.toString(16).match(/(.*?)(.{0,8})$/),D=parseInt(_[2],16),N=parseInt(_[1],16)||0,S[14]=D,S[15]=N,i(T,S),T}function c(v){var y=v.length,T=[1732584193,-271733879,-1732584194,271733878],C,w,S,_,D,N;for(C=64;C<=y;C+=64)i(T,o(v.subarray(C-64,C)));for(v=C-64<y?v.subarray(C-64):new Uint8Array(0),w=v.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<w;C+=1)S[C>>2]|=v[C]<<(C%4<<3);if(S[C>>2]|=128<<(C%4<<3),C>55)for(i(T,S),C=0;C<16;C+=1)S[C]=0;return _=y*8,_=_.toString(16).match(/(.*?)(.{0,8})$/),D=parseInt(_[2],16),N=parseInt(_[1],16)||0,S[14]=D,S[15]=N,i(T,S),T}function l(v){var y="",T;for(T=0;T<4;T+=1)y+=r[v>>T*8+4&15]+r[v>>T*8&15];return y}function f(v){var y;for(y=0;y<v.length;y+=1)v[y]=l(v[y]);return v.join("")}f(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function v(y,T){return y=y|0||0,y<0?Math.max(y+T,0):Math.min(y,T)}ArrayBuffer.prototype.slice=function(y,T){var C=this.byteLength,w=v(y,C),S=C,_,D,N,P;return T!==n&&(S=v(T,C)),w>S?new ArrayBuffer(0):(_=S-w,D=new ArrayBuffer(_),N=new Uint8Array(D),P=new Uint8Array(this,w,_),N.set(P),D)}})();function u(v){return/[\u0080-\uFFFF]/.test(v)&&(v=unescape(encodeURIComponent(v))),v}function g(v,y){var T=v.length,C=new ArrayBuffer(T),w=new Uint8Array(C),S;for(S=0;S<T;S+=1)w[S]=v.charCodeAt(S);return y?w:C}function d(v){return String.fromCharCode.apply(null,new Uint8Array(v))}function p(v,y,T){var C=new Uint8Array(v.byteLength+y.byteLength);return C.set(new Uint8Array(v)),C.set(new Uint8Array(y),v.byteLength),C}function h(v){var y=[],T=v.length,C;for(C=0;C<T-1;C+=2)y.push(parseInt(v.substr(C,2),16));return String.fromCharCode.apply(String,y)}function m(){this.reset()}return m.prototype.append=function(v){return this.appendBinary(u(v)),this},m.prototype.appendBinary=function(v){this._buff+=v,this._length+=v.length;var y=this._buff.length,T;for(T=64;T<=y;T+=64)i(this._hash,a(this._buff.substring(T-64,T)));return this._buff=this._buff.substring(T-64),this},m.prototype.end=function(v){var y=this._buff,T=y.length,C,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S;for(C=0;C<T;C+=1)w[C>>2]|=y.charCodeAt(C)<<(C%4<<3);return this._finish(w,T),S=f(this._hash),v&&(S=h(S)),this.reset(),S},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(v){return this._buff=v.buff,this._length=v.length,this._hash=v.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(v,y){var T=y,C,w,S;if(v[T>>2]|=128<<(T%4<<3),T>55)for(i(this._hash,v),T=0;T<16;T+=1)v[T]=0;C=this._length*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(C[2],16),S=parseInt(C[1],16)||0,v[14]=w,v[15]=S,i(this._hash,v)},m.hash=function(v,y){return m.hashBinary(u(v),y)},m.hashBinary=function(v,y){var T=s(v),C=f(T);return y?h(C):C},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(v){var y=p(this._buff.buffer,v),T=y.length,C;for(this._length+=v.byteLength,C=64;C<=T;C+=64)i(this._hash,o(y.subarray(C-64,C)));return this._buff=C-64<T?new Uint8Array(y.buffer.slice(C-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(v){var y=this._buff,T=y.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,S;for(w=0;w<T;w+=1)C[w>>2]|=y[w]<<(w%4<<3);return this._finish(C,T),S=f(this._hash),v&&(S=h(S)),this.reset(),S},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var v=m.prototype.getState.call(this);return v.buff=d(v.buff),v},m.ArrayBuffer.prototype.setState=function(v){return v.buff=g(v.buff,!0),m.prototype.setState.call(this,v)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(v,y){var T=c(new Uint8Array(v)),C=f(T);return y?h(C):C},m})})(td)),td.exports}var OV=EV();const RV=ji(OV),DV=["lastShaderProgramBound","context","_openGLRenderWindow"];function MV(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,i)=>{let a=r;i.length>0&&(a=ce.substitute(a,"VSOut","GSOut").result);const o=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;o?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),a=ce.substitute(a,"//VTK::System::Dec",[`${c}
`,o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=ce.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){l=ce.substitute(l,"varying","out").result,a=ce.substitute(a,"varying","in").result;let u="",g=0;for(;a.includes(`gl_FragData[${g}]`);)a=ce.substitute(a,`gl_FragData\\[${g}\\]`,`fragOutput${g}`).result,u+=`layout(location = ${g}) out vec4 fragOutput${g};
`,g++;a=ce.substitute(a,"//VTK::Output::Dec",u).result}const f=ce.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:a,GSSource:f}},t.readyShaderProgramArray=(n,r,i)=>{const a=t.replaceShaderValues(n,r,i),o=t.getShaderProgram(a.VSSource,a.FSSource,a.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,i)=>{const a=`${n}${r}${i}`,o=RV.hash(a);if(!(o in e.shaderPrograms)){const s=ce.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(n),s.getFragmentShader().setSource(r),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(o),e.shaderPrograms[o]=s,s}return e.shaderPrograms[o]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const _V={lastShaderProgramBound:null,shaderPrograms:null,context:null};function J9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_V,n),e.shaderPrograms={},A.obj(t,e),A.setGet(t,e,DV),A.moveToProtected(t,e,["openGLRenderWindow"]),MV(t,e)}const IV=A.newInstance(J9,"vtkShaderCache");var bV={newInstance:IV,extend:J9};const{vtkErrorMacro:LV}=A;function VV(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&LV("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const PV={context:null,numberOfTextureUnits:0,textureUnits:0};function Q9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PV,n),A.obj(t,e),e.textureUnits=[],A.get(t,e,["numberOfTextureUnits"]),A.setGet(t,e,["context"]),VV(t,e)}const NV=A.newInstance(Q9,"vtkOpenGLTextureUnitManager");var AV={newInstance:NV,extend:Q9};function FV(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,i)=>{const a=i.getViewportByReference(),o=t.getFramebufferSize();return a[0]*o[0]<=n&&a[2]*o[0]>=n&&a[1]*o[1]<=r&&a[3]*o[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),i=t.getFramebufferSize();return[(r[2]-r[0])*i[0],(r[3]-r[1])*i[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n/a[0],r/a[1],i]},t.normalizedDisplayToDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n*a[0],r*a[1],i]},t.worldToView=(n,r,i,a)=>a.worldToView(n,r,i),t.viewToWorld=(n,r,i,a)=>a.viewToWorld(n,r,i),t.worldToDisplay=(n,r,i,a)=>{const o=a.worldToView(n,r,i),s=t.getViewportSize(a),c=a.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),l=a.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(n,r,i,a)=>{const o=t.displayToNormalizedDisplay(n,r,i),s=a.normalizedDisplayToProjection(o[0],o[1],o[2]),c=t.getViewportSize(a),l=a.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return a.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=t.normalizedDisplayToDisplay(n,r,i);return[s[0]-o[0]-.5,s[1]-o[1]-.5,i]},t.viewportToNormalizedViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return o&&o[0]!==0&&o[1]!==0?[n/(o[0]-1),r/(o[1]-1),i]:[n,r,i]},t.normalizedViewportToViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return[n*(o[0]-1),r*(o[1]-1),i]},t.displayToLocalDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n,a[1]-r-1,i]},t.viewportToNormalizedDisplay=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=n+o[0]+.5,c=r+o[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{A.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,i,a)=>{A.vtkErrorMacro("not implemented")},t.createSelector=()=>{A.vtkErrorMacro("not implemented")}}const UV={size:void 0,selector:void 0};function ey(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UV,n),e.size||(e.size=[300,300]),A.getArray(t,e,["size"],2),A.get(t,e,["selector"]),bn.extend(t,e,n),FV(t,e)}const kV=A.newInstance(ey,"vtkRenderWindowViewNode");var GV={newInstance:kV,extend:ey};const BV="__getUnderlyingContext";function $V(){const t=new Map,e={apply(i,a,o){return t.has(o[0])?t.get(o[0]):i.apply(a,o)}};function n(i){return{apply(a,o,s){return t.set(i,s[0]),a.apply(o,s)}}}const r=Object.create(null);return r.getParameter=(i,a,o,s)=>new Proxy(s.bind(i),e),r.depthMask=(i,a,o,s)=>new Proxy(s.bind(i),n(i.DEPTH_WRITEMASK)),{get(i,a,o){if(a===BV)return()=>i;let s=Reflect.get(i,a,i);s instanceof Function&&(s=s.bind(i));const c=r[a];return c?c(i,a,o,s):s}}}const{vtkDebugMacro:Em,vtkErrorMacro:Om}=A,WV={position:"absolute",top:0,left:0,width:"100%",height:"100%"},zV=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Pr(t,e,n){const r=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),a===t.FRAMEBUFFER_COMPLETE}let cg=0;const Yg=[];function HV(){cg++,Yg.forEach(t=>t(cg))}function jV(){cg--,Yg.forEach(t=>t(cg))}function KV(t){Yg.push(t)}function qV(t){return Yg.pop()}function Rm(t){t.preventDefault()}function XV(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=$V()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Rm,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function a(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(a),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(g=>{g.setOpenGLRenderWindow?.(t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&HV(),e.textureUnitManager=AV.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&Om("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:g}=e.el.getBoundingClientRect();e.containerSize=[u,g]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.activeFramebuffer?.getSize()||e.size,t.getPixelData=(u,g,d,p)=>{const h=new Uint8Array((d-u+1)*(p-g+1)*4);return e.context.readPixels(u,g,d-u+1,p-g+1,e.context.RGBA,e.context.UNSIGNED_BYTE,h),h},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},g=null;const d=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&d&&(g=e.canvas.getContext("webgl2",u),g&&(e.webgl2=!0,Em("using webgl2"))),g||(Em("using webgl1"),g=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(g,r())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=Xg.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const g=e._textureResourceIds.get(u);if(g!==void 0){e.context.activeTexture(e.context.TEXTURE0+g);return}const d=t.getTextureUnitManager().allocate();if(d<0){Om("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,d),e.context.activeTexture(e.context.TEXTURE0+d)},t.deactivateTexture=u=>{const g=e._textureResourceIds.get(u);g!==void 0&&(t.getTextureUnitManager().free(g),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const g=e._textureResourceIds.get(u);return g!==void 0?g:-1},t.getDefaultTextureByteSize=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case dt.CHAR:case dt.SIGNED_CHAR:case dt.UNSIGNED_CHAR:return 1;case g:case d:case dt.UNSIGNED_SHORT:case dt.SHORT:case dt.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,g){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case dt.UNSIGNED_CHAR:switch(g){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(d&&!p&&dt.UNSIGNED_SHORT):switch(g){case 1:return d.R16_EXT;case 2:return d.RG16_EXT;case 3:return d.RGB16_EXT;case 4:default:return d.RGBA16_EXT}case(d&&!p&&dt.SHORT):switch(g){case 1:return d.R16_SNORM_EXT;case 2:return d.RG16_SNORM_EXT;case 3:return d.RGB16_SNORM_EXT;case 4:default:return d.RGBA16_SNORM_EXT}case dt.UNSIGNED_SHORT:case dt.SHORT:case dt.FLOAT:default:switch(g){case 1:return p?e.context.R16F:e.context.R32F;case 2:return p?e.context.RG16F:e.context.RG32F;case 3:return p?e.context.RGB16F:e.context.RGB32F;case 4:default:return p?e.context.RGBA16F:e.context.RGBA32F}}switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const g=document.createElement("canvas"),d=g.getContext("2d");g.width=e.canvas.width,g.height=e.canvas.height,d.drawImage(e.canvas,0,0);const p=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(y=>{y.getViewProps().forEach(C=>{if(C.getContainer){const S=C.getContainer().getElementsByTagName("canvas");for(let _=0;_<S.length;_++){const D=S[_],N=D.getBoundingClientRect(),P=N.x-p.x,F=N.y-p.y;d.drawImage(D,P,F)}}})});const v=g.toDataURL(u);g.remove(),t.invokeImageReady(v)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:g=!1,size:d=null,scale:p=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const h=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:d||p!==1?d||e.size.map(m=>m*p):null},new Promise((m,v)=>{const y=t.onImageReady(T=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=h,y.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(C=>{let{restoreParamsFn:w,arg:S}=C;return w(S)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),m(T);else{const C=document.createElement("img");if(C.style=WV,C.src=T,e._screenshot.placeHolder=e.el.appendChild(C),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e.rootOpenGLRenderWindow?.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),g){const w=g!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(S=>{const _=S.getActiveCamera(),D=_.get("focalPoint","position","parallelScale");return{resetCameraArgs:w?{renderer:S}:void 0,resetCameraFn:w?g:S.resetCamera,restoreParamsFn:_.set,arg:JSON.parse(JSON.stringify(D))}}),e._screenshot.cameras.forEach(S=>{let{resetCameraFn:_,resetCameraArgs:D}=S;return _(D)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const u=t.get3DContext(),g=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=g[1],g[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),g=u.getExtension("OES_texture_float"),d=u.getExtension("OES_texture_half_float"),p=u.getExtension("WEBGL_debug_renderer_info"),h=u.getExtension("WEBGL_draw_buffers"),m=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),v=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",m&&u.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[g&&Pr(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",g&&Pr(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",g&&Pr(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",g&&Pr(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",g&&Pr(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[d&&Pr(u,u.RGBA,d.HALF_FLOAT_OES)?"RGBA":"",d&&Pr(u,u.RGB,d.HALF_FLOAT_OES)?"RGB":"",d&&Pr(u,u.LUMINANCE,d.HALF_FLOAT_OES)?"LUMINANCE":"",d&&Pr(u,u.ALPHA,d.HALF_FLOAT_OES)?"ALPHA":"",d&&Pr(u,u.LUMINANCE_ALPHA,d.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[g&&Pr(u,u.RGBA,u.FLOAT)?"RGBA":"",g&&Pr(u,u.RGB,u.FLOAT)?"RGB":"",g&&Pr(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",g&&Pr(u,u.ALPHA,u.FLOAT)?"ALPHA":"",g&&Pr(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",h?u.getParameter(h.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",p&&u.getParameter(p.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",p&&u.getParameter(p.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],y={};for(;v.length;){const[T,C,w]=v.pop();C&&(y[C]={label:T,value:w})}return e._glInformation=y,y},t.traverseAllPasses=()=>{if(e.renderPasses)for(let g=0;g<e.renderPasses.length;++g)e.renderPasses[g].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&o();const u=e.renderable.getChildRenderWindowsByReference();for(let g=0;g<u.length;++g)t.getViewNodeFor(u[g])?.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(p=>!!p.getSelector?.()))return;const g=u.getCanvas(),d=e.canvas;e.context2D.drawImage(g,0,g.height-d.height,d.width,d.height,0,0,d.width,d.height)},t.resizeFromChildRenderWindows=()=>{const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const g=[0,0];for(let d=0;d<u.length;++d){const p=t.getViewNodeFor(u[d])?.getSize();p&&(g[0]=p[0]>g[0]?p[0]:g[0],g[1]=p[1]>g[1]?p[1]:g[1])}t.setSize(...g)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const g=e.renderable.getRenderers()[0];g.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(d=>t.setBackgroundImage(d.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=$2.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",Rm),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=A.chain(()=>{e.context&&jV(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,g)=>{const d=l(u,g);return d&&t.invokeWindowResizeEvent({width:u,height:g}),d},t.registerGraphicsResourceUser=(u,g)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null),e._graphicsResources.get(u)?.users.add(g)},t.unregisterGraphicsResourceUser=(u,g)=>{const d=e._graphicsResources.get(u);d&&(d.users.delete(g),d.users.size||(d.oglObject?.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,g,d)=>{if(!u)return;const p=e._graphicsResources.get(u);p?.oglObject?.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:g,hash:d,users:p?.users??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(g=>{let{oglObject:d}=g;u+=d.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:g}=u;g.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{t.getViewNodeFor(u)?.releaseGraphicsResources()})};const f={...t};zV.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):f[u](...arguments)}})}const YV={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function ty(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YV,n),GV.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=$2.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=IR.newInstance(),e.shaderCache=bV.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=B2.newInstance(),A.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),A.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),A.setGetArray(t,e,["size"],2),A.event(t,e,"imageReady"),A.event(t,e,"windowResizeEvent"),XV(t,e)}const W2=A.newInstance(ty,"vtkOpenGLRenderWindow");A9("WebGL",W2);var ZV={newInstance:W2,extend:ty,pushMonitorGLContextCount:KV,popMonitorGLContextCount:qV};rr("vtkRenderWindow",W2);function JV(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),mn(e.keyMatrices.mcwc,e.renderable.getMatrix()),bt(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?bi(e.keyMatrices.normalMatrix):(uc(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),ds(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Gl(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const QV={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function eP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QV,n),bn.extend(t,e,n),e.keyMatrixTime={},an(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:bi(new Float64Array(9)),mcwc:Ze(new Float64Array(16))},Gn(t,e,["context"]),$r(t,e,["activeTextures"]),JV(t,e)}const ny=Yt(eP);var tP={newInstance:ny};rr("vtkActor",ny);function nP(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const rP={context:null,activeTextures:null};function iP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rP,n),bn.extend(t,e,n),Gn(t,e,["context"]),$r(t,e,["activeTextures"]),nP(t,e)}const ry=Yt(iP);var aP={newInstance:ry};rr("vtkActor2D",ry);function oP(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let i=0;i<r&&i<6;i++)t.addClippingPlane(n[i])}},t.getClippingPlaneInDataCoords=(n,r,i)=>{const a=e.clippingPlanes,o=n;if(a){const s=a.length;if(r>=0&&r<s){const c=a[r],l=c.getNormal(),f=c.getOrigin(),u=l[0],g=l[1],d=l[2],p=-(u*f[0]+g*f[1]+d*f[2]);i[0]=u*o[0]+g*o[4]+d*o[8]+p*o[12],i[1]=u*o[1]+g*o[5]+d*o[9]+p*o[13],i[2]=u*o[2]+g*o[6]+d*o[10]+p*o[14],i[3]=u*o[3]+g*o[7]+d*o[11]+p*o[15];return}}A.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const sP={clippingPlanes:[]};function cP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sP,n),A.obj(t,e),A.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),oP(t,e)}var lP={extend:cP};function uP(t,e){t.getBounds=()=>(A.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Tc()),t.getCenter=()=>{const n=t.getBounds();return e.center=xt.isValid(n)?xt.getCenter(n):null,e.center?.slice()},t.getLength=()=>{const n=t.getBounds();return xt.getDiagonalLength(n)}}const fP=t=>({bounds:[...xt.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function gP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fP(n)),lP.extend(t,e,n),A.setGet(t,e,["viewSpecificProperties"]),uP(t,e)}var z2={extend:gP};const{vtkErrorMacro:Dm}=A,Mm=0,_m=1,nd=2;function dP(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let i=0;const a=Number(n);return a<r.range[0]?i=r.maxIndex+Mm+1.5:a>r.range[1]?i=r.maxIndex+_m+1.5:(i=(a+r.shift)*r.scale,i=i<r.maxIndex?i:r.maxIndex),Math.floor(i)},t.linearLookup=(n,r,i)=>{let a=0;Kf(n)?a=Math.floor(i.maxIndex+1.5+nd):a=t.linearIndexLookup(n,i);const o=4*a;return r.slice(o,o+4)},t.indexedLookupFunction=(n,r,i)=>{let a=t.getAnnotatedValueIndexInternal(n);a===-1&&(a=e.numberOfColors+nd);const o=4*a;return[r[o],r[o+1],r[o+2],r[o+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,i,a)=>{let o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const l=t.getAlpha(),f=n.getNumberOfTuples(),u=n.getNumberOfComponents(),g=r.getData(),d=n.getData();if(l>=1){if(i===sh.RGBA)for(let p=0;p<f;p++){const h=o(d[p*u+a],e.table,c);g[p*4]=h[0],g[p*4+1]=h[1],g[p*4+2]=h[2],g[p*4+3]=h[3]}}else if(i===sh.RGBA)for(let p=0;p<f;p++){const h=o(d[p*u+a],e.table,c);g[p*4]=h[0],g[p*4+1]=h[1],g[p*4+2]=h[2],g[p*4+3]=Math.floor(h[3]*l+.5)}},t.forceBuild=()=>{let n=0,r=0,i=0,a=0;const o=e.numberOfColors-1;o&&(n=(e.hueRange[1]-e.hueRange[0])/o,r=(e.saturationRange[1]-e.saturationRange[0])/o,i=(e.valueRange[1]-e.valueRange[0])/o,a=(e.alphaRange[1]-e.alphaRange[0])/o),e.table.length=4*o+16;const s=[],c=[];for(let l=0;l<=o;l++)s[0]=e.hueRange[0]+l*n,s[1]=e.saturationRange[0]+l*r,s[2]=e.valueRange[0]+l*i,ac(s,c),c[3]=e.alphaRange[0]+l*a,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const i=n[0].length;e.numberOfColors=n.length;const a=4-i;let o=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<n.length;s++){const c=n[s];for(let l=0;l<i;l++)e.table[o++]=c[l];o+=a}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return Dm("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==dt.UNSIGNED_CHAR)return Dm("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let i=0;i<r.length;i++)e.table[i]=r[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let i=(n+Mm)*4;e.useBelowRangeColor||n===0?(r[i]=e.belowRangeColor[0]*255+.5,r[i+1]=e.belowRangeColor[1]*255+.5,r[i+2]=e.belowRangeColor[2]*255+.5,r[i+3]=e.belowRangeColor[3]*255+.5):(r[i]=r[0],r[i+1]=r[1],r[i+2]=r[2],r[i+3]=r[3]),i=(n+_m)*4,e.useAboveRangeColor||n===0?(r[i]=e.aboveRangeColor[0]*255+.5,r[i+1]=e.aboveRangeColor[1]*255+.5,r[i+2]=e.aboveRangeColor[2]*255+.5,r[i+3]=e.aboveRangeColor[3]*255+.5):(r[i]=r[4*(n-1)+0],r[i+1]=r[4*(n-1)+1],r[i+2]=r[4*(n-1)+2],r[i+3]=r[4*(n-1)+3]),i=(n+nd)*4,r[i]=e.nanColor[0]*255+.5,r[i+1]=e.nanColor[1]*255+.5,r[i+2]=e.nanColor[2]*255+.5,r[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const hP={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function iy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hP,n),l2.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},A.obj(e.buildTime),e.opaqueFlagBuildTime={},A.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},A.obj(e.insertTime,{mtime:0}),A.get(t,e,["buildTime"]),A.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),A.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),A.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),A.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),dP(t,e)}const pP=A.newInstance(iy,"vtkLookupTable");var mP={newInstance:pP,extend:iy};const{FieldAssociations:Im}=L0,{staticOffsetAPI:vP,otherStaticMethods:yP}=jg,{ColorMode:Pu,ScalarMode:qs,GetArray:rd}=c2,{VectorMode:TP}=s2,{VtkDataTypes:CP}=ot;function j0(t){return()=>A.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function wP(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function SP(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function bm(t,e,n){const r=Math.floor(e),i=r%(2*n[0]);let a,o;i<n[0]?(t[0]=i,a=1,o=t[0]===n[0]-1):(t[0]=2*n[0]-1-i,a=-1,o=t[0]===0);const s=Math.floor(r/n[0]),c=s%(2*n[1]);let l,f;c<n[1]?(t[1]=c,l=1,f=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,l=-1,f=t[1]===0),t[2]=Math.floor(s/n[1]);const u=e-r;o?f?t[2]+=u:t[1]+=l*u:t[0]+=a*u,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const Lm=new WeakMap;function xP(t,e,n,r,i,a,o){const s=new Array(arguments.length);for(let B=0;B<arguments.length;++B){const k=arguments[B];s[B]=k.getMTime?.()??k}const c=s.join("/"),l=Lm.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const f=(n[1]-n[0])/(i-1),[u,g]=[n[0]-f,n[1]+f],d=u-.5*f,p=1/(g-u+f),h=u,m=(i+1)/(g-u),v=t.getData(),y=t.getNumberOfTuples(),T=t.getNumberOfComponents(),C=e<0||e>=T,w=a[2]<=1?2:3,S=ot.newInstance({numberOfComponents:w,values:new Float32Array(y*w)}),_=S.getData(),D=[0,0,0];bm(D,i+2,a);let N=0,P=0;const F=[.5,.5,.5];for(let B=0;B<y;++B){let k;if(C){let U=0;for(let H=0;H<T;++H){const W=Number(v[N+H]);U+=W*W}k=Math.sqrt(U)}else k=Number(v[N+e]);if(r&&(k=Math.log10(k)),N+=T,Kf(k))F[0]=D[0],F[1]=D[1],F[2]=D[2];else if(o){let U=(k-h)*m;U<1?U=0:U>i&&(U=i+1),bm(F,U,a)}else{F[1]=.49;const U=(k-d)*p;U>1e3?F[0]=1e3:U<-1e3?F[0]=-1e3:F[0]=U}for(let U=0;U<w;++U)_[P++]=F[U]}return Lm.set(t,{stringHash:c,textureCoordinates:S}),S}function EP(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=Tc(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=mP.newInstance()},t.getColorModeAsString=()=>A.enumToString(Pu,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>A.enumToString(qs,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(r===qs.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===qs.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===qs.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===qs.USE_POINT_FIELD_DATA){const l=n.getPointData();i===rd.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===qs.USE_CELL_FIELD_DATA){const l=n.getCellData();c=!0,i===rd.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===qs.USE_FIELD_DATA){const l=n.getFieldData();i===rd.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:i,cellFlag:a}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=a,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const o=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString!==o){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,a))e.mapScalarsToTexture(i,a,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,i)=>{const a=e.lookupTable.getRange(),o=e.lookupTable.usingLogScale(),s=e.lookupTable.getAlpha(),c=o?[Math.log10(a[0]),Math.log10(a[1])]:a;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const f=e.lookupTable.getNumberOfAvailableColors(),u=2048,g=u**3-3,p=4096-2,h=2,m=r?g:p;e.numberOfColorsInRange=Math.min(Math.max(f,h),m);const v=e.numberOfColorsInRange+3,y=e.numberOfColorsInRange+2,T=r?[Math.min(Math.ceil(v/u**0),u),Math.min(Math.ceil(v/u**1),u),Math.min(Math.ceil(v/u**2),u)]:[y,2,1],C=T[0]*T[1]*T[2],w=new Float64Array(C);w.fill(NaN);const S=e.numberOfColorsInRange,_=S+2,D=[0,0,0],N=c[0],P=c[1]-c[0];for(let k=0;k<_;++k){const U=SP(D,T),H=N+P*(k-1)/(S-1),W=o?10**H:H;w[U]=W,wP(D,T)}const F=ot.newInstance({numberOfComponents:1,values:w}),B=e.lookupTable.mapScalars(F,e.colorMode,0);e.colorTextureMap=qg.newInstance(),e.colorTextureMap.setDimensions(T),e.colorTextureMap.getPointData().setScalars(B),e.lookupTable.setAlpha(s)}const l=e.lookupTable.getVectorMode()===TP.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=xP(n,l,c,o,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),r)},t.getIsOpaque=()=>{const n=t.getInputData(),i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const a=t.getLookupTable();return a?(a.build(),a.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==Pu.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===Pu.DEFAULT&&n.getDataType()===CP.UNSIGNED_CHAR||e.colorMode===Pu.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=j0("AcquireInvertibleLookupTable"),t.valueToColor=j0("ValueToColor"),t.colorToValue=j0("ColorToValue"),t.useInvertibleColorFor=j0("UseInvertibleColorFor"),t.clearInvertibleColor=j0("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=n.getRawPixelBuffer(Ar.ID_LOW24),a=n.getRawPixelBuffer(Ar.ID_HIGH24),o=n.getCurrentPass(),s=n.getFieldAssociation();let c=null;s===Im.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===Im.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(l=>{if(o===Ar.ID_LOW24){let f=0;a&&(f+=a[l],f*=256),f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],g=n.getPixelBuffer(Ar.ID_LOW24);g[l]=u&255,g[l+1]=(u&65280)>>8,g[l+2]=(u&16711680)>>16}else if(o===Ar.ID_HIGH24&&a){let f=0;f+=a[l],f*=256,f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],g=n.getPixelBuffer(Ar.ID_HIGH24);g[l]=(u&4278190080)>>24}})}}const OP={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function ay(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OP,n),z2.extend(t,e,n),A.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),A.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),A.setGetArray(t,e,["scalarRange"],2),jg.implementCoincidentTopologyMethods(t,e),EP(t,e)}const RP=A.newInstance(ay,"vtkMapper");var oy={newInstance:RP,extend:ay,...vP,...yP,...c2};const{FieldAssociations:id}=L0,{primTypes:jn}=To,{Representation:Nc,Shading:Vm}=lu,{ScalarMode:Nu}=oy,{Filter:Pm,Wrap:Nm}=Xt,{vtkErrorMacro:Xs}=Dr,DP={type:"StartEvent"},MP={type:"EndEvent"},{CoordinateSystem:_P}=i6;function IP(t){const e=t.getSelector();return e?e.getCurrentPass():Ar.MIN_KNOWN_PASS-1}function bP(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=jn.Start;o<jn.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=G2,r.Fragment=ou,r.Geometry=""},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(f=f.concat(["varying vec4 vertexColorVSOutput;"]),o=ce.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=ce.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=ce.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=ce.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=ce.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=ce.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(a.getBackfaceProperty()&&!e.drawingEdges&&(f=f.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(f=f.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(f=f.concat(["uniform samplerBuffer texture1;"])),c=ce.substitute(c,"//VTK::Color::Impl",u).result),c=ce.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderLight=(r,i,a)=>{let o=r.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let f=[];switch(c){case 0:o=ce.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=ce.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);o=ce.substitute(o,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)f=f.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${s}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=ce.substitute(o,"//VTK::Light::Impl",f,!1).result;break;case 3:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);o=ce.substitute(o,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)f=f.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=ce.substitute(o,"//VTK::Light::Impl",f,!1).result;break;default:Xs("bad light complexity")}r.Fragment=o},t.replaceShaderNormal=(r,i,a)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex,c=r.Geometry,l=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=ce.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=ce.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=ce.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=ce.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=ce.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=ce.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=ce.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=ce.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES?(l=ce.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=ce.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=ce.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=ce.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=ce.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=s,r.Geometry=c,r.Fragment=l}},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a);let o=r.Vertex,s=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=ce.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=ce.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=ce.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=ce.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=ce.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=ce.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=ce.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=ce.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=ce.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;o=ce.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let f=2,u=2;if(l&&l.length>0&&(f=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(f=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(o=ce.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=ce.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=ce.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=ce.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(f){case 1:c=ce.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=ce.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=ce.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=ce.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=ce.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=ce.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=ce.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,f){case 1:c=ce.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=ce.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=ce.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();o=ce.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,o=ce.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=ce.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=ce.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getCoincidentParameters=(r,i)=>{let a={factor:0,offset:0};const o=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==Ki.PolygonOffset||o.getEdgeVisibility()&&o.getRepresentation()===Nc.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===jn.Points||o.getRepresentation()===Nc.POINTS?a=e.renderable.getCoincidentTopologyPointOffsetParameter():c===jn.Lines||o.getRepresentation()===Nc.WIREFRAME?a=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===jn.Tris||c===jn.TriStrips)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===jn.TrisEdges||c===jn.TriStripsEdges)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),a.factor/=2,a.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===id.FIELD_ASSOCIATION_POINTS&&(a.offset-=2),a},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment,s=r.Vertex;if(o=ce.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===Ar.ID_LOW24||e.lastSelectionState===Ar.ID_HIGH24)&&(s=ce.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=ce.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=ce.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=ce.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case Ar.ID_LOW24:o=ce.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case Ar.ID_HIGH24:o=ce.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=ce.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=ce.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=o,r.Vertex=s}},t.replaceShaderValues=(r,i,a)=>{if(t.replaceShaderColor(r,i,a),t.replaceShaderNormal(r,i,a),t.replaceShaderLight(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a),t.replaceShaderPositionVC(r,i,a),e.haveSeenDepthRequest){let o=r.Fragment;o=ce.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=ce.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}},t.getNeedToRebuildShaders=(r,i,a)=>{let o=0,s=0;const c=r.getPrimitiveType(),l=e.currentInput;let f=!1;const u=l.getPointData().getNormals(),g=l.getCellData().getNormals(),d=a.getProperty().getInterpolation()===Vm.FLAT,p=a.getProperty().getRepresentation(),h=r.getOpenGLMode(p,c);if((h===e.context.TRIANGLES||g&&!u||!d&&u||!d&&h===e.context.LINES)&&(f=!0),a.getProperty().getLighting()&&f){o=0;const T=i.getLightsByReference();for(let C=0;C<T.length;++C){const w=T[C];w.getSwitch()>0&&(s++,o===0&&(o=1)),o===1&&(s>1||w.getIntensity()!==1||!w.lightTypeIsHeadLight())&&(o=2),o<3&&w.getPositional()&&(o=3)}}let m=!1;const v=e.lastBoundBO.getReferenceByName("lastLightComplexity"),y=e.lastBoundBO.getReferenceByName("lastLightCount");return(v!==o||y!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),m=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(m=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||m?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Xs("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Xs("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,f)=>{r.getProgram().isAttributeUsed(`${l}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${l}MC`,r.getCABO().getCustomData()[f].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[f].components,!1)||Xs(`Error setting ${l}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||Xs("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Xs("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=u?mn(e.tmpMat4,a.getMatrix()):a.getMatrix();u&&(bt(g,g),rt(g,g,u),bt(g,g));for(let d=0;d<c;d++){const p=[];e.renderable.getClippingPlaneInDataCoords(g,d,p);for(let h=0;h<4;h++)l.push(p[h])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor.getActiveTextures();if(o)for(let c=0;c<o.length;++c){const f=o[c].getTextureUnit(),u=`texture${f+1}`;r.getProgram().isUniformUsed(u)&&r.getProgram().setUniformi(u,f)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,i,a)=>{const o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o<2)return;const s=r.getProgram();let c=0;const l=i.getLightsByReference();for(let g=0;g<l.length;++g){const d=l[g];if(d.getSwitch()>0){const h=d.getColorByReference(),m=d.getIntensity();e.lightColor[0]=h[0]*m,e.lightColor[1]=h[1]*m,e.lightColor[2]=h[2]*m;const v=d.getDirection(),y=i.getActiveCamera().getViewMatrix(),T=[...v];d.lightTypeIsSceneLight()&&(T[0]=y[0]*v[0]+y[1]*v[1]+y[2]*v[2],T[1]=y[4]*v[0]+y[5]*v[1]+y[6]*v[2],T[2]=y[8]*v[0]+y[9]*v[1]+y[10]*v[2],hi(T)),e.lightDirection[0]=T[0],e.lightDirection[1]=T[1],e.lightDirection[2]=T[2],hi(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(o<3)return;const u=i.getActiveCamera().getViewMatrix();bt(u,u),c=0;for(let g=0;g<l.length;++g){const d=l[g];if(d.getSwitch()>0){const h=d.getTransformedPosition(),m=new Float64Array(3);At(m,h,u),s.setUniform3fArray(`lightAttenuation${c}`,d.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,d.getPositional()),s.setUniformf(`lightExponent${c}`,d.getExponent()),s.setUniformf(`lightConeAngle${c}`,d.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[m[0],m[1],m[2]]),c++}}};function n(r,i,a){return i.identity(a),r.reduce((o,s,c)=>c===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),f=o.getLastCameraMTime(),g=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,d=a.getIsIdentity(),p=d?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(a.getCoordinateSystem()===_P.DISPLAY){const h=e._openGLRenderer.getTiledSizeAndOrigin();Ze(e.tmpMat4),e.tmpMat4[0]=2/h.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/h.vsize,e.tmpMat4[13]=-1,rt(e.tmpMat4,e.tmpMat4,g),o.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else o.setUniformMatrix("MCPCMatrix",n([s.wcpc,p.mcwc,g],Yf,e.tmpMat4));o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",n([s.wcvc,p.mcwc,g],Yf,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,p.normalMatrix],XE,e.tmpMat3)),f!==l&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",c.getParallelProjection()),o.setLastCameraMTime(l)),d||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram();let s=a.getProperty(),c=s.getOpacity(),l=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),f=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),u=e.drawingEdges?1:s.getAmbient(),g=e.drawingEdges?0:s.getDiffuse(),d=e.drawingEdges?0:s.getSpecular();const p=s.getSpecularPower();o.setUniformf("opacityUniform",c),o.setUniform3fArray("ambientColorUniform",l),o.setUniform3fArray("diffuseColorUniform",f),o.setUniformf("ambient",u),o.setUniformf("diffuse",g);const h=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(h<1)return;let m=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",m),o.setUniformf("specularPowerUniform",p),o.setUniformf("specular",d),o.isUniformUsed("ambientIntensityBF")){if(s=a.getBackfaceProperty(),c=s.getOpacity(),l=s.getAmbientColor(),u=s.getAmbient(),f=s.getDiffuseColor(),g=s.getDiffuse(),m=s.getSpecularColor(),d=s.getSpecular(),o.setUniformf("ambientIntensityBF",u),o.setUniformf("diffuseIntensityBF",g),o.setUniformf("opacityUniformBF",c),o.setUniform3fArray("ambientColorUniformBF",l),o.setUniform3fArray("diffuseColorUniformBF",f),h<1)return;o.setUniformf("specularIntensityBF",d),o.setUniform3fArray("specularColorUniformBF",m),o.setUniformf("specularPowerUniformBF",p)}},t.updateMaximumPointCellIds=(r,i)=>{const a=e._openGLRenderer.getSelector();if(!a)return;if(e.selectionWebGLIdsToVTKIds?.points?.length){const s=e.selectionWebGLIdsToVTKIds.points.length;a.setMaximumPointId(s-1)}if(e.selectionWebGLIdsToVTKIds?.cells?.length){const s=e.selectionWebGLIdsToVTKIds.cells.length;a.setMaximumCellId(s-1)}a.getFieldAssociation()===id.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const a=IP(e._openGLRenderer);e.lastSelectionState!==a&&(e.selectionStateChanged.modified(),e.lastSelectionState=a),e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().renderProp(i),t.updateBufferObjects(r,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=i.getProperty().getEdgeVisibility()&&a===Nc.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===id.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===Ar.ID_LOW24||e.lastSelectionState===Ar.ID_HIGH24);for(let l=jn.Start;l<jn.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=o&&(l===jn.TrisEdges||l===jn.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(r,i,a,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(r,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,i)=>{if(t.invokeEvent(DP),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(MP),!e.currentInput){Xs("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context,o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Nu.USE_CELL_DATA||s===Nu.USE_CELL_FIELD_DATA||s===Nu.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==Nu.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==Vm.FLAT?a.getPointData().getNormals():null;c===null&&a.getCellData().getNormals()&&(e.haveCellNormals=!0,c=a.getCellData().getNormals());const l=i.getProperty().getRepresentation();let f=a.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(f=null);let u=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Xt.newInstance({resizable:!0}));const d=e.internalColorTexture;d.setMinificationFilter(Pm.NEAREST),d.setMagnificationFilter(Pm.NEAREST),d.setWrapS(Nm.CLAMP_TO_EDGE),d.setWrapT(Nm.CLAMP_TO_EDGE),d.setOpenGLRenderWindow(e._openGLRenderWindow);const p=e.renderable.getColorTextureMap(),h=p.getExtent(),m=p.getPointData().getScalars();d.create2DFromRaw({width:h[1]-h[0]+1,height:h[3]-h[2]+1,numComps:m.getNumberOfComponents(),dataType:m.getDataType(),data:m.getData()}),d.activate(),d.sendParameters(),d.deactivate()}const g=`${a.getMTime()}A${l}B${a.getMTime()}C${c?c.getMTime():1}D${o?o.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${f?f.getMTime():1}`;if(e.VBOBuildString!==g){const p={points:a.getPoints(),normals:c,tcoords:f,colors:o,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>a.getPointData().getArrayByName(v))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const h=[{inRep:"verts",cells:a.getVerts()},{inRep:"lines",cells:a.getLines()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()}],m=i.getProperty().getEdgeVisibility()&&l===Nc.SURFACE;for(let v=jn.Start;v<jn.End;v++)v!==jn.TrisEdges&&v!==jn.TriStripsEdges?(p.cellOffset+=e.primitives[v].getCABO().createVBO(h[v].cells,h[v].inRep,l,p,e.selectionWebGLIdsToVTKIds),p.vertexOffset+=e.primitives[v].getCABO().getElementCount()):m?e.primitives[v].getCABO().createVBO(h[v].cells,h[v].inRep,Nc.WIREFRAME,{...p,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[v].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=g}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const LP={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:Ar.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function sy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LP,n),bn.extend(t,e,n),ms.implementReplaceShaderCoincidentOffset(t,e,n),ms.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=jn,e.tmpMat3=bi(new Float64Array(9)),e.tmpMat4=Ze(new Float64Array(16));for(let r=jn.Start;r<jn.End;r++)e.primitives[r]=To.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Gn(t,e,["context"]),e.VBOBuildTime={},an(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},an(e.selectionStateChanged,{mtime:0}),bP(t,e)}const cy=Yt(sy,"vtkOpenGLPolyDataMapper");var Zg={newInstance:cy,extend:sy};rr("vtkMapper",cy);const{vtkErrorMacro:K0}=Dr,{Representation:VP}=lu,{ObjectType:Au}=so,{PassTypes:PP}=$2,NP={type:"StartEvent"},AP={type:"EndEvent"},FP=64,UP=16;function kP(t,e,n){t[12]=(t[12]-e[0])*n[0],t[13]=(t[13]-e[1])*n[1],t[14]=(t[14]-e[2])*n[2],t[0]*=n[0],t[5]*=n[1],t[10]*=n[2]}function GP(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...t};t.renderPiece=(r,i)=>{if(t.invokeEvent(NP),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(AP),!e.currentInput){K0("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.multiply4x4WithOffset=(r,i,a,o)=>{const s=i[0],c=i[1],l=i[2],f=i[3],u=i[4],g=i[5],d=i[6],p=i[7],h=i[8],m=i[9],v=i[10],y=i[11],T=i[12],C=i[13],w=i[14],S=i[15];let _=a[o],D=a[o+1],N=a[o+2],P=a[o+3];r[0]=_*s+D*u+N*h+P*T,r[1]=_*c+D*g+N*m+P*C,r[2]=_*l+D*d+N*v+P*w,r[3]=_*f+D*p+N*y+P*S,_=a[o+4],D=a[o+5],N=a[o+6],P=a[o+7],r[4]=_*s+D*u+N*h+P*T,r[5]=_*c+D*g+N*m+P*C,r[6]=_*l+D*d+N*v+P*w,r[7]=_*f+D*p+N*y+P*S,_=a[o+8],D=a[o+9],N=a[o+10],P=a[o+11],r[8]=_*s+D*u+N*h+P*T,r[9]=_*c+D*g+N*m+P*C,r[10]=_*l+D*d+N*v+P*w,r[11]=_*f+D*p+N*y+P*S,_=a[o+12],D=a[o+13],N=a[o+14],P=a[o+15],r[12]=_*s+D*u+N*h+P*T,r[13]=_*c+D*g+N*m+P*C,r[14]=_*l+D*d+N*v+P*w,r[15]=_*f+D*p+N*y+P*S},t.replaceShaderNormal=(r,i,a)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=ce.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=ce.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=s}n.replaceShaderNormal(r,i,a)},t.replaceShaderClip=(r,i,a)=>{if(e.hardwareSupport){let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();o=ce.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,o=ce.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    vec4 gVertex = gMatrix * vertexMC;","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], gVertex);","    }"]).result,s=ce.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=ce.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s}n.replaceShaderClip(r,i,a)},t.replaceShaderColor=(r,i,a)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(f=f.concat(["varying vec4 vertexColorVSOutput;"]),o=ce.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=ce.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=ce.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=ce.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=ce.substitute(c,"//VTK::Color::Impl",u).result,c=ce.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=o,r.Geometry=s,r.Fragment=c}n.replaceShaderColor(r,i,a)},t.replaceShaderPositionVC=(r,i,a)=>{if(e.hardwareSupport){let o=r.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=ce.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=ce.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=ce.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=ce.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=o}n.replaceShaderPositionVC(r,i,a)},t.replaceShaderPicking=(r,i,a)=>{if(e.hardwareSupport){let o=r.Fragment,s=r.Vertex;s=ce.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=ce.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=s,o=ce.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=ce.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=o}else n.replaceShaderPicking(r,i,a)},t.updateGlyphShaderParameters=(r,i,a,o,s,c,l,f)=>{const u=a.getProgram();if(r){const g=e.normalMatrix,d=c,p=l*9,h=e.tmpMat3,m=g[0],v=g[1],y=g[2],T=g[3],C=g[4],w=g[5],S=g[6],_=g[7],D=g[8],N=d[p],P=d[p+1],F=d[p+2],B=d[p+3],k=d[p+4],U=d[p+5],H=d[p+6],W=d[p+7],J=d[p+8];h[0]=N*m+P*T+F*S,h[1]=N*v+P*C+F*_,h[2]=N*y+P*w+F*D,h[3]=B*m+k*T+U*S,h[4]=B*v+k*C+U*_,h[5]=B*y+k*w+U*D,h[6]=H*m+W*T+J*S,h[7]=H*v+W*C+J*_,h[8]=H*y+W*w+J*D,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){const g=o.getData();e.tmpColor[0]=g[l*4]/255,e.tmpColor[1]=g[l*4+1]/255,e.tmpColor[2]=g[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}f&&u.setUniform3fArray("mapperIndex",f.getPropColorValue())},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=e.context,s=i.getProperty().getEdgeVisibility()&&a===VP.SURFACE,c=e.openGLCamera.getKeyMatrices(r),l=e.openGLActor.getKeyMatrices();fc(e.normalMatrix,c.normalMatrix,l.normalMatrix),rt(e.mcpcMatrix,c.wcpc,l.mcwc),rt(e.mcvcMatrix,c.wcvc,l.mcwc);const f=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),g=e.renderable.getColorArray(),d=f.length/16;let p=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===PP.COMPOSITE_INDEX_PASS&&(p=!0);for(let h=e.primTypes.Start;h<e.primTypes.End;h++){const m=e.primitives[h].getCABO();if(m.getElementCount()){e.drawingEdges=s&&(h===e.primTypes.TrisEdges||h===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[h],e.primitives[h].updateShaders(r,i,t);const v=e.primitives[h].getProgram(),y=e.primitives[h].getOpenGLMode(a),T=v.isUniformUsed("normalMatrix"),C=v.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(y,0,m.getElementCount(),d):o.drawArraysInstanced(y,0,m.getElementCount(),d);else for(let w=0;w<d;++w)p&&e._openGLRenderer.getSelector().renderCompositeIndex(w),t.updateGlyphShaderParameters(T,C,e.primitives[h],g,f,u,w,p?e._openGLRenderer.getSelector():null),o.drawArrays(y,0,m.getElementCount())}}},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||K0("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||K0("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||K0("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||K0("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,i,a),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,i,a)},t.getNeedToRebuildBufferObjects=(r,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,i)),t.getNeedToRebuildShaders=(r,i,a)=>!!(n.getNeedToRebuildShaders(r,i,a)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(r,i)=>{const a=e.renderable.getMatrixArray(),o=e.renderable.getInputData(0).getPoints(),{useShiftAndScale:s,coordShift:c,coordScale:l}=A2(o);if(e.hardwareSupport){const f=e.renderable.getNormalArray(),u=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=so.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=so.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=so.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=so.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),s){const g=a.buffer;for(let d=0;d<a.byteLength;d+=FP){const p=new Float32Array(g,d,UP);kP(p,c,l)}}if(e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(a,Au.ARRAY_BUFFER),e.normalBuffer.upload(f,Au.ARRAY_BUFFER),u?e.colorBuffer.upload(u.getData(),Au.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const g=a.length/16,d=new Uint8Array(4*g);for(let p=0;p<g;++p){let h=p+1;const m=p*4;d[m]=h%256,h-=d[m],h/=256,d[m+1]=h%256,h-=d[m+1],h/=256,d[m+2]=h%256,d[m+3]=255}e.pickBuffer.upload(d,Au.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}if(n.buildBufferObjects(r,i),s)for(let f=fa.Start;f<fa.End;f++)e.primitives[f].getCABO().setCoordShiftAndScale(c,l)}}const BP={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function $P(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BP,n),Zg.extend(t,e,n),e.tmpMat3=bi(new Float64Array(9)),e.normalMatrix=bi(new Float64Array(9)),e.mcpcMatrix=Ze(new Float64Array(16)),e.mcvcMatrix=Ze(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},an(e.glyphBOBuildTime,{mtime:0}),GP(t,e)}const ly=Yt($P,"vtkOpenGLGlyph3DMapper");var WP={newInstance:ly};rr("vtkGlyph3DMapper",ly);const{vtkErrorMacro:Am}=Dr;function zP(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const a=e._openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(a),s=new Float64Array(16);if(In(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=a.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let s=0;s<4;s++)r[s*3]=s%2*2-1,r[s*3+1]=s>1?1:-1,r[s*3+2]=1;const i=ot.newInstance({numberOfComponents:3,values:r});i.setName("points");const a=new Uint16Array(8);a[0]=3,a[1]=0,a[2]=1,a[3]=3,a[4]=3,a[5]=0,a[6]=3,a[7]=2;const o=ot.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",gi.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Am("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||Am("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const HP={context:null};function jP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HP,n),bn.extend(t,e,n),e.openGLTexture=Xt.newInstance(),e.tris=To.newInstance(),e.keyMatrixTime={},an(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:bi(new Float64Array(9)),mcwc:Ze(new Float64Array(16))},Gn(t,e,["context"]),$r(t,e,["activeTextures"]),zP(t,e)}const uy=Yt(jP);var KP={newInstance:uy};rr("vtkSkybox",uy);var qP=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:XP}=Dr;function YP(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=qP,r.Fragment=ou,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=ce.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=ce.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=ce.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=ce.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=ce.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=ce.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=ce.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||XP("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),r.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?r.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):r.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc);const l=new Float64Array(16);if(o.isUniformUsed("MCVCMatrix"))if(a.getIsIdentity())mn(l,c.wcvc),r.getCABO().getCoordShiftAndScaleEnabled()&&rt(l,l,r.getCABO().getInverseShiftAndScaleMatrix()),o.setUniformMatrix("MCVCMatrix",l);else{const f=e.openGLActor.getKeyMatrices();rt(l,c.wcvc,f.mcwc),r.getCABO().getCoordShiftAndScaleEnabled()&&rt(l,l,r.getCABO().getInverseShiftAndScaleMatrix()),o.setUniformMatrix("MCVCMatrix",l)}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),l=a.getPoints(),f=l.getNumberOfPoints(),u=l.getData(),g=5;let d=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(d=c.getArray(e.renderable.getScaleArray()).getData());let p=null,h=0,m=null;o?(h=o.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),p=o.getData(),m=new Uint8Array(3*f*4),s.getColorBO()||s.setColorBO(so.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(h);const v=new Float32Array(g*f*3);s.setStride(g*4);const y=Math.cos(gn(30));let T=0,C=0;const{useShiftAndScale:w,coordShift:S,coordScale:_}=A2(l);w&&s.setCoordShiftAndScale(S,_);let D=0,N=0;for(let P=0;P<f;++P){let F=e.renderable.getRadius();d&&(F=d[P]),T=P*3;const B=(u[T++]-S[0])*_[0],k=(u[T++]-S[1])*_[1],U=(u[T++]-S[2])*_[2];v[D++]=B,v[D++]=k,v[D++]=U,v[D++]=-2*F*y,v[D++]=-F,p&&(C=P*h,m[N++]=p[C],m[N++]=p[C+1],m[N++]=p[C+2],m[N++]=p[C+3]),v[D++]=B,v[D++]=k,v[D++]=U,v[D++]=2*F*y,v[D++]=-F,p&&(m[N++]=p[C],m[N++]=p[C+1],m[N++]=p[C+2],m[N++]=p[C+3]),v[D++]=B,v[D++]=k,v[D++]=U,v[D++]=0,v[D++]=2*F,p&&(m[N++]=p[C],m[N++]=p[C+1],m[N++]=p[C+2],m[N++]=p[C+3])}s.setElementCount(D/g),s.upload(v,fo.ARRAY_BUFFER),o&&s.getColorBO().upload(m,fo.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const ZP={};function JP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZP,n),Zg.extend(t,e,n),YP(t,e)}const fy=Yt(JP,"vtkOpenGLSphereMapper");var QP={newInstance:fy};rr("vtkSphereMapper",fy);var eN=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:Fu}=Dr;function tN(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=eN,r.Fragment=ou,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=ce.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=ce.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=ce.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=ce.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=ce.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=ce.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=ce.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||Fu("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||Fu("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||Fu("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),a.getIsIdentity())o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",c.wcvc),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(o.isUniformUsed("MCVCMatrix")){const f=new Float64Array(16);rt(f,c.wcvc,l.mcwc),o.setUniformMatrix("MCVCMatrix",f)}if(o.isUniformUsed("normalMatrix")){const f=new Float64Array(9);fc(f,c.normalMatrix,l.normalMatrix),o.setUniformMatrix3x3("normalMatrix",f)}}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),l=a.getPoints(),f=l.getNumberOfPoints(),u=l.getData();let g=3;g+=4;let d=null,p=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(so.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),o&&(p=o.getNumberOfComponents(),s.setColorOffset(4),d=o.getData(),s.setColorBOStride(8)),s.setColorComponents(p),s.setStride(g*4);const h=new Float32Array(g*f*12),m=new Uint8Array(12*f*(d?8:4));let v=null,y=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(v=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?y=c.getArray(e.renderable.getOrientationArray()).getData():Fu([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const T=[0,1,3,0,3,2,2,3,5,2,5,4];let C=0,w=0,S=0,_=0;for(let D=0;D<f;++D){let N=e.renderable.getLength(),P=e.renderable.getRadius();v&&(N=v[D*2],P=v[D*2+1]);for(let F=0;F<T.length;++F)C=D*3,h[S++]=u[C++],h[S++]=u[C++],h[S++]=u[C++],C=D*3,h[S++]=y[C++]*N,h[S++]=y[C++]*N,h[S++]=y[C++]*N,h[S++]=P,m[_++]=255*(T[F]%2),m[_++]=T[F]>=4?255:0,m[_++]=T[F]>=2?255:0,m[_++]=255,w=D*p,d&&(m[_++]=d[w],m[_++]=d[w+1],m[_++]=d[w+2],m[_++]=d[w+3])}s.setElementCount(S/g),s.upload(h,fo.ARRAY_BUFFER),s.getColorBO().upload(m,fo.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const nN={};function rN(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nN,n),Zg.extend(t,e,n),tN(t,e)}const gy=Yt(rN,"vtkOpenGLStickMapper");var iN={newInstance:gy};rr("vtkStickMapper",gy);function aN(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper");const n=new Map;function r(o,s){if(!s)return;const l=(n.get(s)??0)-1;l<=0?(o.unregisterGraphicsResourceUser(s,t),n.delete(s)):n.set(s,l)}function i(o,s){if(!s)return;const c=n.get(s)??0,l=c+1;n.set(s,l),c<=0&&o.registerGraphicsResourceUser(s,t)}function a(o,s,c){s!==c&&(r(o,s),i(o,c))}t.renderPiece=(o,s)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const c=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let f=0;f<c;++f){const u=e.renderable.getInputData(f);u&&!u.isDeleted()&&e.currentValidInputs.push({imageData:u,inputIndex:f})}let l=0;if(e.currentValidInputs.length>0){const f=s.getProperties(),u=e.currentValidInputs[0],g=u.imageData,d=f[u.inputIndex];d.getShade()&&e.renderable.getBlendMode()===ml.COMPOSITE_BLEND&&o.getLights().forEach(v=>{v.getSwitch()>0&&l++});const p=e.currentValidInputs.length,h=p>1,{numberOfComponents:m}=g.get("numberOfComponents");e.numberOfComponents=h?p:m,e.numberOfComponents>1?e.useIndependentComponents=d.getIndependentComponents():e.useIndependentComponents=!1}l!==e.numberOfLights&&(e.numberOfLights=l,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(o,s),t.renderPieceDraw(o,s),t.renderPieceFinish(o,s))},t.buildBufferObjects=(o,s)=>{if(!e.jitterTexture.getHandle()){const B=new Float32Array(1024);for(let k=0;k<1024;++k)B[k]=Math.random();e.jitterTexture.setMinificationFilter(ze.NEAREST),e.jitterTexture.setMagnificationFilter(ze.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:dt.FLOAT,data:B})}const c=s.getProperties(),l=e.currentValidInputs[0],f=c[l.inputIndex],u=e.numberOfComponents,g=e.useIndependentComponents,d=g?u:1,p=[];for(let B=0;B<d;++B)p.push(f.getScalarOpacity(B));const h=xa(p,g,d),m=f.getScalarOpacity(),v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!v?.oglObject?.getHandle()||v.hash!==h){const B=Xt.newInstance();B.setOpenGLRenderWindow(e._openGLRenderWindow);let k=e.renderable.getOpacityTextureWidth();k<=0&&(k=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const U=k*2*d,H=new Float32Array(U),W=new Float32Array(k);for(let J=0;J<d;++J){const ne=f.getScalarOpacity(J),q=t.getCurrentSampleDistance(o)/f.getScalarOpacityUnitDistance(J),Q=ne.getRange();ne.getTable(Q[0],Q[1],k,W,1);for(let ae=0;ae<k;++ae)H[J*k*2+ae]=1-(1-W[ae])**q,H[J*k*2+ae+k]=H[J*k*2+ae]}if(B.resetFormatAndType(),B.setMinificationFilter(ze.LINEAR),B.setMagnificationFilter(ze.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))B.create2DFromRaw({width:k,height:2*d,numComps:1,dataType:dt.FLOAT,data:H});else{const J=new Uint8ClampedArray(U);for(let ne=0;ne<U;++ne)J[ne]=255*H[ne];B.create2DFromRaw({width:k,height:2*d,numComps:1,dataType:dt.UNSIGNED_CHAR,data:J})}m&&e._openGLRenderWindow.setGraphicsResourceForObject(m,B,h),e.opacityTexture=B}else e.opacityTexture=v.oglObject;a(e._openGLRenderWindow,e._opacityTextureCore,m),e._opacityTextureCore=m;const T=[];for(let B=0;B<d;++B)T.push(f.getRGBTransferFunction(B));const C=xa(T,g,d),w=f.getRGBTransferFunction(),S=e._openGLRenderWindow.getGraphicsResourceForObject(w);if(!S?.oglObject?.getHandle()||S?.hash!==C){const B=Xt.newInstance();B.setOpenGLRenderWindow(e._openGLRenderWindow);let k=e.renderable.getColorTextureWidth();k<=0&&(k=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const U=k*2*d*3,H=new Uint8ClampedArray(U),W=new Float32Array(k*3);for(let J=0;J<d;++J){const ne=f.getRGBTransferFunction(J),q=ne.getRange();ne.getTable(q[0],q[1],k,W,1);for(let Q=0;Q<k*3;++Q)H[J*k*6+Q]=255*W[Q],H[J*k*6+Q+k*3]=255*W[Q]}B.resetFormatAndType(),B.setMinificationFilter(ze.LINEAR),B.setMagnificationFilter(ze.LINEAR),B.create2DFromRaw({width:k,height:2*d,numComps:3,dataType:dt.UNSIGNED_CHAR,data:H}),e._openGLRenderWindow.setGraphicsResourceForObject(w,B,C),e.colorTexture=B}else e.colorTexture=S.oglObject;a(e._openGLRenderWindow,e._colorTextureCore,w),e._colorTextureCore=w,e.currentValidInputs.forEach(({imageData:B,inputIndex:k},U)=>{if(e.scalarTextures||(e.scalarTextures=[]),!e.scalarTextures[U]){console.warn(`ScalarTexture for component ${U} not initialized, skipping.`);return}const H=e.scalarTextures[U],W=`${B.getMTime()}-${H.getMTime()}`;if(e.scalarTextureStrings||(e.scalarTextureStrings=[]),e.scalarTextureStrings[U]!==W){const J=B.getDimensions();H.setOpenGLRenderWindow(e._openGLRenderWindow),H.enableUseHalfFloat(!1);const ne=H.getTextureParameters(),q=B.get("dataType").dataType;let Q=!0;if(ne?.dataType===q&&ne?.width===J[0]&&ne?.height===J[1]&&ne?.depth===J[2]&&(Q=!1),Q){const ae=e.context.getExtension("EXT_texture_norm16");H.setOglNorm16Ext(qw()?ae:null),H.resetFormatAndType(),H.setTextureParameters({width:J[0],height:J[1],depth:J[2],numberOfComponents:d,dataType:q}),H.create3DFromRaw({width:J[0],height:J[1],depth:J[2],numComps:d,dataType:q,data:null}),H.update3DFromRaw()}else H.deactivate(),H.update3DFromRaw();e.scalarTextureStrings[U]=W}e._scalarTexturesCore||(e._scalarTexturesCore=[])});const D=f.getLabelOutlineThickness(),N=e._openGLRenderWindow.getGraphicsResourceForObject(D),P=D.join("-");if(!N?.oglObject?.getHandle()||N?.hash!==P){const B=Xt.newInstance();B.setOpenGLRenderWindow(e._openGLRenderWindow);let k=e.renderable.getLabelOutlineTextureWidth();k<=0&&(k=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const U=1,H=k*U,W=new Uint8Array(H);for(let J=0;J<k;++J){const ne=typeof D[J]<"u"?D[J]:D[0];W[J]=ne}B.resetFormatAndType(),B.setMinificationFilter(ze.NEAREST),B.setMagnificationFilter(ze.NEAREST),B.create2DFromRaw({width:k,height:U,numComps:1,dataType:dt.UNSIGNED_CHAR,data:W}),D&&e._openGLRenderWindow.setGraphicsResourceForObject(D,B,P),e.labelOutlineThicknessTexture=B}else e.labelOutlineThicknessTexture=N.oglObject;if(a(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,D),e._labelOutlineThicknessTextureCore=D,!e.tris.getCABO().getElementCount()){const B=new Float32Array(12);for(let W=0;W<4;W++)B[W*3]=W%2*2-1,B[W*3+1]=W>1?1:-1,B[W*3+2]=-1;const k=new Uint16Array(8);k[0]=3,k[1]=0,k[2]=1,k[3]=3,k[4]=3,k[5]=0,k[6]=3,k[7]=2;const U=ot.newInstance({numberOfComponents:3,values:B});U.setName("points");const H=ot.newInstance({numberOfComponents:1,values:k});e.tris.getCABO().createVBO(H,"polys",gi.SURFACE,{points:U,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(o,s)=>{if(e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<s.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<s.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.colorTexture?.getMTime()||e.VBOBuildTime.getMTime()<e.labelOutlineThicknessTexture?.getMTime()||!e.colorTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle())return!0;if(e.scalarTextures&&e.scalarTextures.length>0)for(let c=0;c<e.scalarTextures.length;c++){const l=e.scalarTextures[c];if(l&&(e.VBOBuildTime.getMTime()<l.getMTime()||!l.getHandle()))return!0}if(e.currentValidInputs&&e.currentValidInputs.length>0)for(let c=0;c<e.currentValidInputs.length;c++){const l=e.currentValidInputs[c];if(l&&l.imageData&&e.VBOBuildTime.getMTime()<l.imageData.getMTime())return!0}return!1}}const oN={};function sN(t,e,n={}){Object.assign(e,oN,n),h9.extend(t,e,n),n.scalarTexture?e.scalarTextures=[n.scalarTexture]:e.scalarTextures=[],e.scalarTextureStrings=[],e._scalarTexturesCore=[],e.previousState={},aN(t,e)}const cN=A.newInstance(sN,"vtkStreamingOpenGLVolumeMapper"),lN={newInstance:cN},dy=Object.create(null);function Zn(t,e){dy[t]=e}function uN(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.includes(i)?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.getModelInitialValues(n),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=dy,e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const fN={};function hy(t,e,n={}){Object.assign(e,fN,n),V2.extend(t,e,n),uN(t,e),Zn("vtkActor",tP.newInstance),Zn("vtkActor2D",aP.newInstance),Zn("vtkCamera",PR.newInstance),Zn("vtkGlyph3DMapper",WP.newInstance),Zn("vtkImageMapper",nI.newInstance),Zn("vtkImageCPRMapper",sI.newInstance),Zn("vtkImageSlice",fI.newInstance),Zn("vtkMapper",Zg.newInstance),Zn("vtkPixelSpaceCallbackMapper",_I.newInstance),Zn("vtkRenderer",kR.newInstance),Zn("vtkSkybox",KP.newInstance),Zn("vtkSphereMapper",QP.newInstance),Zn("vtkStickMapper",iN.newInstance),Zn("vtkTexture",Xt.newInstance),Zn("vtkVolume",pI.newInstance),Zn("vtkVolumeMapper",h9.newInstance),Zn("vtkSharedVolumeMapper",lN.newInstance)}const gN=A.newInstance(hy,"vtkStreamingOpenGLViewNodeFactory"),dN={newInstance:gN,extend:hy};function hN(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function py(t,e,n={}){Object.assign(e,n),ZV.extend(t,e,n),e.myFactory=dN.newInstance(),Zn("vtkRenderWindow",my),hN(t,e)}const my=A.newInstance(py,"vtkStreamingOpenGLRenderWindow"),pN={newInstance:my,extend:py},{vtkDebugMacro:Uu}=A;function mN(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),a=Ze(new Float64Array(16)),o=Ze(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),f=Ze(new Float64Array(16)),u=Ze(new Float64Array(16)),g=new Float64Array(3),d=new Float64Array(3);function p(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const h=t.getViewMatrix();e.viewUp[0]=h[4],e.viewUp[1]=h[5],e.viewUp[2]=h[6],t.modified()},t.setPosition=(h,m,v)=>{h===e.position[0]&&m===e.position[1]&&v===e.position[2]||(e.position[0]=h,e.position[1]=m,e.position[2]=v,t.computeDistance(),t.modified())},t.setFocalPoint=(h,m,v)=>{h===e.focalPoint[0]&&m===e.focalPoint[1]&&v===e.focalPoint[2]||(e.focalPoint[0]=h,e.focalPoint[1]=m,e.focalPoint[2]=v,t.computeDistance(),t.modified())},t.setDistance=h=>{if(e.distance===h)return;e.distance=h,e.distance<1e-20&&(e.distance=1e-20,Uu("Distance is set to minimum."));const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,t.modified()},t.computeDistance=()=>{const h=e.focalPoint[0]-e.position[0],m=e.focalPoint[1]-e.position[1],v=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(h*h+m*m+v*v),e.distance<1e-20){e.distance=1e-20,Uu("Distance is set to minimum.");const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance}e.directionOfProjection[0]=h/e.distance,e.directionOfProjection[1]=m/e.distance,e.directionOfProjection[2]=v/e.distance,p()},t.dolly=h=>{if(h<=0)return;const m=e.distance/h;t.setPosition(e.focalPoint[0]-m*e.directionOfProjection[0],e.focalPoint[1]-m*e.directionOfProjection[1],e.focalPoint[2]-m*e.directionOfProjection[2])},t.roll=h=>{const m=e.position,v=e.focalPoint,y=e.viewUp,T=new Float64Array([y[0],y[1],y[2],0]);Ze(f);const C=new Float64Array([v[0]-m[0],v[1]-m[1],v[2]-m[2]]);Ui(f,f,gn(h),C),Zo(T,T,f),e.viewUp[0]=T[0],e.viewUp[1]=T[1],e.viewUp[2]=T[2],t.modified()},t.azimuth=h=>{const m=e.focalPoint;Ze(u),Mn(u,u,m),Ui(u,u,gn(h),e.viewUp),Mn(u,u,[-m[0],-m[1],-m[2]]),At(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.yaw=h=>{const m=e.position;Ze(u),Mn(u,u,m),Ui(u,u,gn(h),e.viewUp),Mn(u,u,[-m[0],-m[1],-m[2]]),At(d,e.focalPoint,u),t.setFocalPoint(d[0],d[1],d[2])},t.elevation=h=>{const m=e.focalPoint,v=t.getViewMatrix(),y=[-v[0],-v[1],-v[2]];Ze(u),Mn(u,u,m),Ui(u,u,gn(h),y),Mn(u,u,[-m[0],-m[1],-m[2]]),At(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.pitch=h=>{const m=e.position,v=t.getViewMatrix(),y=[v[0],v[1],v[2]];Ze(u),Mn(u,u,m),Ui(u,u,gn(h),y),Mn(u,u,[-m[0],-m[1],-m[2]]),At(d,e.focalPoint,u),t.setFocalPoint(...d)},t.zoom=h=>{h<=0||(e.parallelProjection?e.parallelScale/=h:e.viewAngle/=h,t.modified())},t.translate=(h,m,v)=>{const y=[h,m,v];d0(e.position,y,e.position),d0(e.focalPoint,y,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=h=>{const m=[...e.viewUp,1],v=[],y=[],T=[];m[0]+=e.position[0],m[1]+=e.position[1],m[2]+=e.position[2],Zo(v,[...e.position,1],h),Zo(y,[...e.focalPoint,1],h),Zo(T,m,h),T[0]-=v[0],T[1]-=v[1],T[2]-=v[2],t.setPosition(...v.slice(0,3)),t.setFocalPoint(...y.slice(0,3)),t.setViewUp(...T.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=h=>{let m=h;m<1e-20&&(m=1e-20,Uu("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+m)},t.setThicknessFromFocalPoint=h=>{let m=h;m<1e-20&&(m=1e-20,Uu("Thickness is set to minimum.")),t.setClippingRange(e.distance-m/2,e.distance+m/2)},t.setRoll=h=>{},t.getRoll=()=>{},t.setObliqueAngles=(h,m)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Float64Array(24);const v=[[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1],[0,0,1,1],[0,0,-1,1]],y=t.getCompositeProjectionMatrix(h,-1,1);for(let T=0;T<6;T++)Zo(v[T],v[T],y),sx(v[T]),m[4*T+0]=v[T][0],m[4*T+1]=v[T][1],m[4*T+2]=v[T][2],m[4*T+3]=v[T][3];return m},t.getCameraLightTransformMatrix=h=>(mn(h,e.cameraLightTransform),h),t.computeCameraLightTransform=()=>{mn(a,t.getViewMatrix()),In(a,a),Ug(o,[e.distance,e.distance,e.distance]),rt(a,a,o),Ze(e.cameraLightTransform),Mn(e.cameraLightTransform,a,[0,0,-1])},t.deepCopy=h=>{},t.physicalOrientationToWorldDirection=h=>{const m=z5(h[0],h[1],h[2],h[3]),v=ps(),y=z5(0,0,1,0);return DO(v,m),W5(y,m,y),W5(y,y,v),[y[0],y[1],y[2]]},t.getPhysicalToWorldMatrix=h=>{t.getWorldToPhysicalMatrix(h),In(h,h)},t.getWorldToPhysicalMatrix=h=>{Ze(h);const m=[3];kr(e.physicalViewNorth,e.physicalViewUp,m),h[0]=m[0],h[1]=m[1],h[2]=m[2],h[4]=e.physicalViewUp[0],h[5]=e.physicalViewUp[1],h[6]=e.physicalViewUp[2],h[8]=-e.physicalViewNorth[0],h[9]=-e.physicalViewNorth[1],h[10]=-e.physicalViewNorth[2],bt(h,h),Yr(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Sa(h,h,s),Mn(h,h,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=h=>{In(a,h),At(s,n,a),t.computeDistance();const m=e.distance;t.setPosition(s[0],s[1],s[2]),At(c,r,a),_n(c,c,s),Ht(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),At(l,i,a),_n(l,l,s),Ht(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(m)},t.computeViewParametersFromPhysicalMatrix=h=>{t.getWorldToPhysicalMatrix(a),rt(a,h,a),t.computeViewParametersFromViewMatrix(a)},t.setModelTransformMatrix=h=>{e.modelTransformMatrix=h},t.getModelTransformMatrix=()=>e.modelTransformMatrix,t.setViewMatrix=h=>{e.viewMatrix=h,e.viewMatrix&&(mn(a,e.viewMatrix),t.computeViewParametersFromViewMatrix(a),bt(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.modelTransformMatrix?(rt(a,e.viewMatrix,e.modelTransformMatrix),a):e.viewMatrix;f8(a,e.position,e.focalPoint,e.viewUp),bt(a,a);const h=new Float64Array(16);return e.modelTransformMatrix?rt(h,a,e.modelTransformMatrix):mn(h,a),h},t.setProjectionMatrix=h=>{e.projectionMatrix=h},t.getProjectionMatrix=(h,m,v)=>{const y=new Float64Array(16);if(Ze(y),e.projectionMatrix){const w=1/e.physicalScale;return Yr(s,w,w,w),mn(y,e.projectionMatrix),Sa(y,y,s),bt(y,y),y}Ze(a);const T=e.clippingRange[1]-e.clippingRange[0],C=[e.clippingRange[0]+(m+1)*T/2,e.clippingRange[0]+(v+1)*T/2];if(e.parallelProjection){const w=e.parallelScale*h,S=e.parallelScale,_=(e.windowCenter[0]-1)*w,D=(e.windowCenter[0]+1)*w,N=(e.windowCenter[1]-1)*S,P=(e.windowCenter[1]+1)*S;p2(a,_,D,N,P,C[0],C[1]),bt(a,a)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const w=Math.tan(gn(e.viewAngle)/2);let S,_;e.useHorizontalViewAngle===!0?(S=e.clippingRange[0]*w,_=e.clippingRange[0]*w/h):(S=e.clippingRange[0]*w*h,_=e.clippingRange[0]*w);const D=(e.windowCenter[0]-1)*S,N=(e.windowCenter[0]+1)*S,P=(e.windowCenter[1]-1)*_,F=(e.windowCenter[1]+1)*_,B=C[0],k=C[1];a[0]=2*B/(N-D),a[5]=2*B/(F-P),a[2]=(D+N)/(N-D),a[6]=(P+F)/(F-P),a[10]=-(B+k)/(k-B),a[14]=-1,a[11]=-2*B*k/(k-B),a[15]=0}}return mn(y,a),y},t.getCompositeProjectionMatrix=(h,m,v)=>{const y=t.getViewMatrix(),T=t.getProjectionMatrix(h,m,v);return rt(T,y,T),T},t.setDirectionOfProjection=(h,m,v)=>{if(e.directionOfProjection[0]===h&&e.directionOfProjection[1]===m&&e.directionOfProjection[2]===v)return;e.directionOfProjection[0]=h,e.directionOfProjection[1]=m,e.directionOfProjection[2]=v;const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,p()},t.setDeviceAngles=(h,m,v,y)=>{const T=[3];kr(e.physicalViewNorth,e.physicalViewUp,T);const C=Ze(new Float64Array(16));Ui(C,C,gn(h),e.physicalViewUp),Ui(C,C,gn(m),T),Ui(C,C,gn(v),e.physicalViewNorth),Ui(C,C,gn(-y),e.physicalViewUp);const w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),S=new Float64Array(e.physicalViewNorth);At(w,w,C),At(S,S,C),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(S[0],S[1],S[2]),t.modified()},t.setOrientationWXYZ=(h,m,v,y)=>{const T=Ze(new Float64Array(16));if(h!==0&&(m!==0||v!==0||y!==0)){const S=gn(h),_=ps();kg(_,[m,v,y],S),r0(T,_)}const C=new Float64Array(3);At(C,[0,0,-1],T);const w=new Float64Array(3);At(w,[0,1,0],T),t.setDirectionOfProjection(...C),t.setViewUp(...w),t.modified()},t.computeClippingRange=h=>{let m=null,v=null;m=e.viewPlaneNormal,v=e.position;const y=-m[0],T=-m[1],C=-m[2],w=-(y*v[0]+T*v[1]+C*v[2]),S=[y*h[0]+T*h[2]+C*h[4]+w,1e-18];for(let _=0;_<2;_++)for(let D=0;D<2;D++)for(let N=0;N<2;N++){const P=y*h[N]+T*h[2+D]+C*h[4+_]+w;S[0]=P<S[0]?P:S[0],S[1]=P>S[1]?P:S[1]}return S}}const vN={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,modelTransformMatrix:null,cameraLightTransform:pi(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function vy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vN,n),A.obj(t,e),A.get(t,e,["distance"]),A.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),A.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),A.setGetArray(t,e,["clippingRange","windowCenter"],2),A.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),mN(t,e)}const yN=A.newInstance(vy,"vtkCamera");var H2={newInstance:yN,extend:vy};function TN(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?At(n,e.position,e.transformMatrix):Yr(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?At(n,e.focalPoint,e.transformMatrix):Yr(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(Ut(e.direction,e.focalPoint,e.position),hi(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const i=new Float64Array(3);Ut(i,e.position,r),e.focalPoint=i},t.setDirectionAngle=(r,i)=>{const a=gn(r),o=gn(i);t.setPosition(Math.cos(a)*Math.sin(o),Math.sin(a),Math.cos(a)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const CN={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function wN(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CN,n),A.obj(t,e),A.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),A.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),TN(t,e)}const SN=A.newInstance(wN,"vtkLight");var xN={newInstance:SN};const{vtkErrorMacro:Cf}=A;function EN(t){return()=>Cf(`vtkViewport::${t} - NOT IMPLEMENTED`)}function ON(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const i=e.props.filter(a=>a!==r);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(r);const a=r.getNestedProps();if(a&&a.length)for(let o=0;o<a.length;o++)n(a[o],i);return i}t.getViewPropsWithNestedProps=()=>{let r=[];const i=t.getActors2D();i.sort((o,s)=>o.getLayerNumber()-s.getLayerNumber());const a=e.props.filter(o=>!i.includes(o));for(let o=0;o<a.length;o++)n(a[o],r);return r=r.concat(i),r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>Cf("call displayToView on your view instead"),t.viewToDisplay=()=>Cf("callviewtodisplay on your view instead"),t.getSize=()=>Cf("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,i,a)=>{const o=t.normalizedDisplayToNormalizedViewport(r,i,a);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/o[0],(i-e.viewport[1])/o[1],a]},t.normalizedViewportToProjection=(r,i,a)=>[r*2-1,i*2-1,a*2-1],t.projectionToNormalizedDisplay=(r,i,a)=>{const o=t.projectionToNormalizedViewport(r,i,a);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*o[0]+e.viewport[0],i*o[1]+e.viewport[1],a]},t.projectionToNormalizedViewport=(r,i,a)=>[(r+1)*.5,(i+1)*.5,(a+1)*.5],t.PickPropFrom=EN("PickPropFrom")}const RN={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function yy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RN,n),A.obj(t,e),A.event(t,e,"event"),A.setGetArray(t,e,["viewport"],4),A.setGetArray(t,e,["background","background2"],3),ON(t,e)}const DN=A.newInstance(yy,"vtkViewport");var MN={newInstance:DN,extend:yy};const{vtkDebugMacro:q0,vtkErrorMacro:jo,vtkWarningMacro:_N}=Dr;function Fm(t){return()=>jo(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function IN(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(q0("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const a=t.getActiveCameraAndResetIfCreated();e.lights.forEach(o=>{o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(a.getPositionByReference()),o.setFocalPointFrom(a.getFocalPointByReference()),o.modified(a.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(a.getCameraLightTransformMatrix(pi())):jo("light has unknown light type",o.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=Fm("allocateTime"),t.updateGeometry=Fm("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=a=>{q0(t.getClassName(),t,"setting Layer to ",a),e.layer!==a&&(e.layer=a,t.modified()),t.setPreserveColorBuffer(!!a)},t.setActiveCamera=a=>e.activeCamera===a?!1:(e.activeCamera=a,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:a}),!0),t.makeCamera=()=>{const a=H2.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:a}),a},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(a=>{e.actors=e.actors.concat(a.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=a=>{e.actors=e.actors.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(o=>{t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(a=>{e.volumes=e.volumes.concat(a.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=a=>{e.volumes=e.volumes.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(o=>{t.removeViewProp(o)}),e.volumes=[],t.modified()},t.hasLight=a=>e.lights.includes(a),t.addLight=a=>{a&&!t.hasLight(a)&&(e.lights.push(a),t.modified())},t.removeLight=a=>{e.lights=e.lights.filter(o=>o!==a),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=a=>{e.lights=a,t.modified()},t.makeLight=xN.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(a,o,s,c)=>{let l=t.normalizedDisplayToProjection(a,o,s);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(a,o,s,c)=>{let l=t.worldToView(a,o,s);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(a,o,s)=>{if(e.activeCamera===null)return jo("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();In(c,c),bt(c,c);const l=new Float64Array([a,o,s]);return At(l,l,c),l},t.projectionToView=(a,o,s,c)=>{if(e.activeCamera===null)return jo("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);In(l,l),bt(l,l);const f=new Float64Array([a,o,s]);return At(f,f,l),f},t.worldToView=(a,o,s)=>{if(e.activeCamera===null)return jo("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();bt(c,c);const l=new Float64Array([a,o,s]);return At(l,l,c),l},t.viewToProjection=(a,o,s,c)=>{if(e.activeCamera===null)return jo("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);bt(l,l);const f=new Float64Array([a,o,s]);return At(f,f,l),f},t.computeVisiblePropBounds=()=>{e.allBounds[0]=xt.INIT_BOUNDS[0],e.allBounds[1]=xt.INIT_BOUNDS[1],e.allBounds[2]=xt.INIT_BOUNDS[2],e.allBounds[3]=xt.INIT_BOUNDS[3],e.allBounds[4]=xt.INIT_BOUNDS[4],e.allBounds[5]=xt.INIT_BOUNDS[5];let a=!0;t.invokeEvent(n);for(let o=0;o<e.props.length;++o){const s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&ff(c)&&(a=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return a&&(a2(e.allBounds),q0("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!ff(o))return q0("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return jo("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;let l=o[1]-o[0],f=o[3]-o[2],u=o[5]-o[4];l*=l,f*=f,u*=u;let g=l+f+u;g=g===0?1:g,g=Math.sqrt(g)*.5;const d=gn(e.activeCamera.getViewAngle()),p=g,h=g/Math.sin(d*.5),m=e.activeCamera.getViewUp();return Math.abs(at(m,c))>.999&&(_N("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-m[2],m[0],m[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+h*c[0],s[1]+h*c[1],s[2]+h*c[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(p),e.activeCamera.setPhysicalScale(g),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!ff(o))return q0("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return jo("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(o);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=gn(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(r),!1},t.setRenderWindow=a=>{a!==e._renderWindow&&(e._vtkWindow=a,e._renderWindow=a)},t.visibleActorCount=()=>e.props.filter(a=>a.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let a=e.mtime;const o=e.activeCamera?e.activeCamera.getMTime():0;o>a&&(a=o);const s=e._createdLight?e._createdLight.getMTime():0;return s>a&&(a=s),a},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const bN={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Tc(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function Ty(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,bN,n),MN.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),$r(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Gn(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),I0(t,e,["actors","volumes","lights"]),Kh(t,e,["background"],4,1),eu(t,e,["renderWindow"]),IN(t,e)}const LN=Yt(Ty,"vtkRenderer");var VN={newInstance:LN,extend:Ty};const PN={Unknown:0,LeftController:1,RightController:2},NN={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},AN={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},FN={LeftButton:1,MiddleButton:2,RightButton:3};var Cy={Device:PN,Input:NN,Axis:AN,MouseButton:FN};const{Device:ku,Input:ec}=Cy,{vtkWarningMacro:Gu,vtkErrorMacro:Bu,normalizeWheel:UN,vtkOnceErrorMacro:kN}=A,Ac={ctrlKey:!1,altKey:!1,shiftKey:!1},ad={"xr-standard":[ec.Trigger,ec.Grip,ec.TrackPad,ec.Thumbstick,ec.A,ec.B]},j2=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function X0(t){t.cancelable&&t.preventDefault()}function $u(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:i}=n;e[r]=i}),e}function GN(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,i=new Map;let a=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=h=>{Bu("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=h=>{e.interactorStyle!==h&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=h,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>Gu("empty event loop");function o(h,m){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(h,m))}t.getCurrentRenderer=()=>(e.currentRenderer||o(0,0),e.currentRenderer);function s(h){const m=e._view.getCanvas(),v=m.getBoundingClientRect(),y=m.width/v.width,T=m.height/v.height,C={x:y*(h.clientX-v.left),y:T*(v.height-h.clientY+v.top),z:0,movementX:y*h.movementX,movementY:T*h.movementY};return(i.size<=1||!e.currentRenderer)&&o(C.x,C.y),C}const c=e._getScreenEventPositionFor||s;function l(h){return{controlKey:h.ctrlKey,altKey:h.altKey,shiftKey:h.shiftKey}}function f(h){const m=l(h);return{key:h.key,keyCode:h.charCode,...m}}function u(h){return h.pointerType||""}const g=()=>{if(e.container===null)return;const{container:h}=e;h.addEventListener("contextmenu",X0),h.addEventListener("wheel",t.handleWheel),h.addEventListener("DOMMouseScroll",t.handleWheel),h.addEventListener("pointerenter",t.handlePointerEnter),h.addEventListener("pointerleave",t.handlePointerLeave),h.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.addEventListener("pointerup",t.handlePointerUp),h.addEventListener("pointercancel",t.handlePointerCancel),h.addEventListener("keypress",t.handleKeyPress),h.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),h.tabIndex=0,h.style.touchAction="none",h.style.userSelect="none",h.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=h=>{if(h===null)return;n.setContainer(h)&&g()};const d=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,a=1;const{container:h}=e;h&&(h.removeEventListener("contextmenu",X0),h.removeEventListener("wheel",t.handleWheel),h.removeEventListener("DOMMouseScroll",t.handleWheel),h.removeEventListener("pointerenter",t.handlePointerEnter),h.removeEventListener("pointerleave",t.handlePointerLeave),h.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.removeEventListener("pointerup",t.handlePointerUp),h.removeEventListener("pointercancel",t.handlePointerCancel),h.removeEventListener("keypress",t.handleKeyPress),h.removeEventListener("keydown",t.handleKeyDown)),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{d(),n.setContainer(null)},t.handleKeyPress=h=>{const m=f(h);t.keyPressEvent(m)},t.handleKeyDown=h=>{const m=f(h);t.keyDownEvent(m)},t.handleKeyUp=h=>{const m=f(h);t.keyUpEvent(m)},t.handlePointerEnter=h=>{const m={...l(h),position:c(h),deviceType:u(h)};t.pointerEnterEvent(m),m.deviceType==="mouse"&&t.mouseEnterEvent(m)},t.handlePointerLeave=h=>{const m={...l(h),position:c(h),deviceType:u(h)};t.pointerLeaveEvent(m),m.deviceType==="mouse"&&t.mouseLeaveEvent(m)},t.handlePointerDown=h=>{if(!(h.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&X0(h),h.target.hasPointerCapture(h.pointerId)&&h.target.releasePointerCapture(h.pointerId),e.container.setPointerCapture(h.pointerId),i.has(h.pointerId)&&Gu("[RenderWindowInteractor] duplicate pointerId detected"),i.set(h.pointerId,{pointerId:h.pointerId,position:c(h)}),h.pointerType){case"pen":case"touch":t.handleTouchStart(h);break;case"mouse":default:t.handleMouseDown(h);break}},t.handlePointerUp=h=>{if(i.has(h.pointerId))switch(e.preventDefaultOnPointerUp&&X0(h),i.delete(h.pointerId),e.container.releasePointerCapture(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerCancel=h=>{if(i.has(h.pointerId))switch(i.delete(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerMove=h=>{if(i.has(h.pointerId)){const m=i.get(h.pointerId);m.position=c(h)}switch(h.pointerType){case"pen":case"touch":t.handleTouchMove(h);break;case"mouse":default:t.handleMouseMove(h);break}},t.handleMouseDown=h=>{const m={...l(h),position:c(h),deviceType:u(h)};switch(h.button){case 0:t.leftButtonPressEvent(m);break;case 1:t.middleButtonPressEvent(m);break;case 2:t.rightButtonPressEvent(m);break;default:Bu(`Unknown mouse button pressed: ${h.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>document.exitPointerLock?.(),t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function p(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=h=>{if(h===void 0){Bu("undefined requester, can not start animating");return}if(r.has(h)){Gu("requester is already registered for animating");return}r.add(h),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=h=>{const m=Date.now()+h;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,m),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(h){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(h)){if(!m){const v=h&&h.getClassName?h.getClassName():h;Gu(`${v} did not request an animation`)}return}r.delete(h),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(h,m,v)=>{h.inputSources.forEach(y=>{const T=y.gripSpace==null?null:m.getPose(y.gripSpace,v),C=y.gripSpace==null?null:m.getPose(y.targetRaySpace,v),w=y.gamepad,S=y.handedness;if(w){w.index in e.lastGamepadValues||(e.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let _=0;_<w.buttons.length;++_)_ in e.lastGamepadValues[w.index][S].buttons||(e.lastGamepadValues[w.index][S].buttons[_]=!1),e.lastGamepadValues[w.index][S].buttons[_]!==w.buttons[_].pressed&&T!=null&&(t.button3DEvent({gamepad:w,position:T.transform.position,orientation:T.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,pressed:w.buttons[_].pressed,device:y.handedness==="left"?ku.LeftController:ku.RightController,input:ad[w.mapping]&&ad[w.mapping][_]?ad[w.mapping][_]:ec.Trigger}),e.lastGamepadValues[w.index][S].buttons[_]=w.buttons[_].pressed),e.lastGamepadValues[w.index][S].buttons[_]&&T!=null&&t.move3DEvent({gamepad:w,position:T.transform.position,orientation:T.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,device:y.handedness==="left"?ku.LeftController:ku.RightController})}})},t.handleMouseMove=h=>{const m={...l(h),position:c(h),deviceType:u(h)};e.moveTimeoutID===0?t.startMouseMoveEvent(m):(t.mouseMoveEvent(m),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const h=Date.now();e._animationFrameCount++,h-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(h-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=h,e._animationFrameCount=1),t.animationEvent(),p(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=h=>{X0(h);const m={...UN(h),...l(h),position:c(h),deviceType:u(h)};e.wheelTimeoutID===0&&(Math.abs(m.spinY)>=.3?a=Math.abs(m.spinY):a=1),m.spinY/=a,e.wheelTimeoutID===0?(t.startMouseWheelEvent(m),t.mouseWheelEvent(m)):(t.mouseWheelEvent(m),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=h=>{const m={...l(h),position:c(h),deviceType:u(h)};switch(h.button){case 0:t.leftButtonReleaseEvent(m);break;case 1:t.middleButtonReleaseEvent(m);break;case 2:t.rightButtonReleaseEvent(m);break;default:Bu(`Unknown mouse button released: ${h.button}`);break}},t.handleTouchStart=h=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const v=$u(i);if(m.length===2){const y={...l(Ac),position:m[0].position,deviceType:u(h)};t.leftButtonReleaseEvent(y)}t.recognizeGesture("TouchStart",v)}else if(m.length===1){const v={...l(Ac),position:c(h),deviceType:u(h)};t.leftButtonPressEvent(v)}},t.handleTouchMove=h=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const v=$u(i);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(Ac),position:m[0].position,deviceType:u(h)};t.mouseMoveEvent(v)}},t.handleTouchEnd=h=>{const m=[...i.values()];if(e.recognizeGestures)if(m.length===0){const v={...l(Ac),position:c(h),deviceType:u(h)};t.leftButtonReleaseEvent(v)}else if(m.length===1){const v=$u(i);t.recognizeGesture("TouchEnd",v);const y={...l(Ac),position:m[0].position,deviceType:u(h)};t.leftButtonPressEvent(y)}else{const v=$u(i);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(Ac),position:m[0].position,deviceType:u(h)};t.leftButtonReleaseEvent(v)}},t.setView=h=>{e._view!==h&&(e._view=h,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>e._view?.getRenderable()?.getRenderersByReference()?.[0],t.findPokedRenderer=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const v=e._view?.getRenderable()?.getRenderers();if(!v||v.length===0)return null;v.sort((S,_)=>S.getLayer()-_.getLayer());let y=null,T=null,C=null,w=v.length;for(;w--;){const S=v[w];if(e._view.isInViewport(h,m,S)&&S.getInteractive()){C=S;break}y===null&&S.getInteractive()&&(y=S),T===null&&e._view.isInViewport(h,m,S)&&(T=S)}return C===null&&(C=y),C===null&&(C=T),C==null&&(C=v[0]),C},t.render=()=>{!t.isAnimating()&&!e.inRender&&p()},j2.forEach(h=>{const m=h.charAt(0).toLowerCase()+h.slice(1);t[`${m}Event`]=v=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){kN(`
          Can not forward events without a current renderer on the interactor.
        `);return}const T={type:h,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...v};t[`invoke${h}`](T)}}),t.recognizeGesture=(h,m)=>{if(Object.keys(m).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),h==="TouchStart"){Object.keys(m).forEach(P=>{e.startingEventPositions[P]=m[P]}),e.currentGesture="Start";return}if(h==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let v=0;const y=[],T=[];Object.keys(m).forEach(P=>{y[v]=m[P],T[v]=e.startingEventPositions[P],v++});const C=Math.sqrt((T[0].x-T[1].x)*(T[0].x-T[1].x)+(T[0].y-T[1].y)*(T[0].y-T[1].y)),w=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y));let S=Hf(Math.atan2(T[1].y-T[0].y,T[1].x-T[0].x)),_=Hf(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),D=_-S;_=_+180>=360?_-180:_+180,S=S+180>=360?S-180:S+180,Math.abs(_-S)<Math.abs(D)&&(D=_-S);const N=[];if(N[0]=(y[0].x-T[0].x+y[1].x-T[1].x)/2,N[1]=(y[0].y-T[0].y+y[1].y-T[1].y)/2,h==="TouchMove")if(e.currentGesture==="Start"){let P=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);P<15&&(P=15);const F=Math.abs(w-C),B=w*3.1415926*Math.abs(D)/360,k=Math.sqrt(N[0]*N[0]+N[1]*N[1]);if(F>P&&F>B&&F>k){e.currentGesture="Pinch";const U={scale:1,touches:m};t.startPinchEvent(U)}else if(B>P&&B>k){e.currentGesture="Rotate";const U={rotation:0,touches:m};t.startRotateEvent(U)}else if(k>P){e.currentGesture="Pan";const U={translation:[0,0],touches:m};t.startPanEvent(U)}}else{if(e.currentGesture==="Rotate"){const P={rotation:D,touches:m};t.rotateEvent(P)}if(e.currentGesture==="Pinch"){const P={scale:w/C,touches:m};t.pinchEvent(P)}if(e.currentGesture==="Pan"){const P={translation:N,touches:m};t.panEvent(P)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=h=>{e._forcedRenderer=!!h,e.currentRenderer=h},t.setContainer=h=>{d();const m=n.setContainer(h??null);return m&&g(),m},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const BN={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function wy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BN,n),A.obj(t,e),e._animationExtendedEnd=0,A.event(t,e,"RenderEvent"),j2.forEach(r=>A.event(t,e,r)),A.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),A.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),A.moveToProtected(t,e,["view"]),GN(t,e)}const $N=A.newInstance(wy,"vtkRenderWindowInteractor");var WN={newInstance:$N,extend:wy,handledEvents:j2,...Cy};function zN(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let r=e.properties[0].getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.properties[0]||t.getProperty(),!t.getIsOpaque()),t.makeProperty=lu.newInstance,t.getMTime=()=>{let r=n.getMTime();if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();r=i>r?i:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();r=i>r?i:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),r=i>r?i:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,i)}}const HN={mapper:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1};function Sy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HN,n),L2.extend(t,e,n),e.boundsMTime={},A.obj(e.boundsMTime),A.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),zN(t,e)}const jN=A.newInstance(Sy,"vtkActor");var KN={newInstance:jN,extend:Sy};function qN(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=KL.newInstance(),e.rendererMap={},e.openGLRenderWindow=pN.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=WN.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:i,background:a})=>{const o=VN.newInstance({viewport:r,background:a||e.background});e.renderWindow.addRenderer(o),e.rendererMap[i]=o},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=r=>{const i=t.getRenderer(r);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(a=>({id:a,renderer:r[a]}))},t.resize=()=>{if(e.container){const{width:r,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(i)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=A.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const XN={background:[0,0,0],container:null};function xy(t,e,n={}){Object.assign(e,XN,n),A.obj(t,e),A.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),A.event(t,e,"resize"),qN(t,e)}const YN=A.newInstance(xy),Ey={newInstance:YN,extend:xy},{BlendMode:Ko}=B4;function ZN(t,e,n,r,i){let a=null;return i?(a=i,a.removeAllPoints()):a=Cc.newInstance(),a.addPointLong(-1024,0,1,1),a.addPoint(t,e),a.addPoint(n,r),a}const JN=["getAnisotropy","getComputeNormalFromOpacity","getFilterMode","getFilterModeAsString","getGlobalIlluminationReach","getIpScalarRange","getIpScalarRangeByReference","getLAOKernelRadius","getLAOKernelSize","getLocalAmbientOcclusion","getPreferSizeOverAccuracy","getVolumetricScatteringBlending","setAnisotropy","setAverageIPScalarRange","setComputeNormalFromOpacity","setFilterMode","setFilterModeToNormalized","setFilterModeToOff","setFilterModeToRaw","setGlobalIlluminationReach","setIpScalarRange","setIpScalarRangeFrom","setLAOKernelRadius","setLAOKernelSize","setLocalAmbientOcclusion","setPreferSizeOverAccuracy","setVolumetricScatteringBlending"],QN={createRadonTransferFunction:ZN};function eA(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>(e.static||t.update(),e.bounds=[...t.getInputData().getBounds()],e.bounds),t.setBlendModeToComposite=()=>{t.setBlendMode(Ko.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(Ko.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(Ko.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(Ko.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(Ko.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(Ko.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>A.enumToString(Ko,e.blendMode),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),JN.forEach(r=>{const i=()=>{throw new Error(`The method "volumeMapper.${r}()" doesn't exist anymore. It is a rendering property that has been moved to the volume property. Replace your code with:
volumeActor.getProperty().${r}()
`)};t[r]=i})}const tA=t=>({bounds:[...xt.INIT_BOUNDS],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:Ko.COMPOSITE_BLEND,volumeShadowSamplingDistFactor:5,colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024,...t});function Oy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tA(n)),z2.extend(t,e,n),A.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","volumeShadowSamplingDistFactor","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),A.event(t,e,"lightingActivated"),eA(t,e)}const nA=A.newInstance(Oy,"vtkVolumeMapper");var Ry={newInstance:nA,extend:Oy,...QN};function rA(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const iA={scalarTexture:null};function Dy(t,e,n={}){Object.assign(e,iA,n),Ry.extend(t,e,n),A.setGet(t,e,["scalarTexture"]),rA(t,e)}const aA=A.newInstance(Dy,"vtkSharedVolumeMapper"),oA={newInstance:aA,extend:Dy};function K2(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint32Array":return Uint32Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, Int16Array, or Uint32Array");return Float32Array}}function My(t,e,n={}){const{isVolumeBuffer:r=!1}=n,i=K2(t,r),a=i.BYTES_PER_ELEMENT;return{numBytes:e*a,TypedArrayConstructor:i}}function Um(t,e){const n=K2(e),r=new n(t.length);return r.set(t),r}function sA(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=({width:s,height:c,depth:l,numberOfComponents:f,dataType:u,data:g,preferSizeOverAccuracy:d})=>{e.inputDataType=u,e.inputNumComps=f,n({width:s,height:c,depth:l,numberOfComponents:f,dataType:u,data:g,preferSizeOverAccuracy:d})};const r=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(s,c)=>{const l=r(s,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],l},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const c=Ve.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){o();return}return t.hasUpdatedFrames()&&a()};const i=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,i()},t.modified=()=>{i();const s=Ve.getVolume(e.volumeId);if(!s)return;const c=s.imageIds;for(let l=0;l<c.length;l++)e.updatedFrames[l]=!0};function a(){const s=Ve.getVolume(e.volumeId),c=s.imageIds;for(let l=0;l<e.updatedFrames.length;l++)if(e.updatedFrames[l]){const f=Ve.getImage(c[l]);if(!f)continue;let u=f.voxelManager.getScalarData();const g=e.context;s.dataType!==u.constructor.name&&(u=Um(u,s.dataType));const[d]=t.updateArrayDataTypeForGL(s.dataType,[u]);t.bind();const p=l;g.texSubImage3D(e.target,0,0,0,p,e.width,e.height,1,e.format,e.openGLDataType,d),t.deactivate(),e.updatedFrames[l]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function o(){const s=Ve.getVolume(e.volumeId),c=s.getCurrentDimensionGroupImageIds();if(!c.length)return!1;let l;for(let f=0;f<c.length;f++){const u=c[f],g=Ve.getImage(u);let d;g?(d=g.voxelManager.getScalarData(),l=d.constructor):(l=K2(s.dataType,!0),d=new l(e.width*e.height));const p=e.context;s.dataType!==d.constructor.name&&(d=Um(d,s.dataType));const[h]=t.updateArrayDataTypeForGL(s.dataType,[d]);t.bind();let m=f;p.texSubImage3D(e.target,0,0,0,m,e.width,e.height,1,e.format,e.openGLDataType,h),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:c,depth:l,numberOfComponents:f,dataType:u})=>{e.width??=s,e.height??=c,e.depth??=l,e.inputNumComps??=f,e.inputDataType??=u},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const cA={updatedFrames:[]};function _y(t,e,n={}){Object.assign(e,cA,n),Xt.extend(t,e,n),sA(t,e)}const lA=A.newInstance(_y,"vtkStreamingOpenGLTexture"),uA={newInstance:lA,extend:_y},fA={isPerformingCoordinateTransformation:!1};function Iy(t,e,n={}){Object.assign(e,fA,n),H2.extend(t,e,n),A.setGet(t,e,["isPerformingCoordinateTransformation"]),dA(t,e)}const gA=A.newInstance(Iy,"vtkSlabCamera");function dA(t,e){e.classHierarchy.push("vtkSlabCamera");const n=Ze(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(i,a,o)=>{const s=pi();if(e.projectionMatrix){const g=1/e.physicalScale;return Yr(r,g,g,g),mn(s,e.projectionMatrix),Sa(s,s,r),bt(s,s),s}Ze(n);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const f=l-c,u=[c+(a+1)*f/2,c+(o+1)*f/2];if(e.parallelProjection){const g=e.parallelScale*i,d=e.parallelScale,p=(e.windowCenter[0]-1)*g,h=(e.windowCenter[0]+1)*g,m=(e.windowCenter[1]-1)*d,v=(e.windowCenter[1]+1)*d;p2(n,p,h,m,v,u[0],u[1]),bt(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const g=Math.tan(Tn.radiansFromDegrees(e.viewAngle)/2);let d,p;e.useHorizontalViewAngle===!0?(d=c*g,p=c*g/i):(d=c*g*i,p=c*g);const h=(e.windowCenter[0]-1)*d,m=(e.windowCenter[0]+1)*d,v=(e.windowCenter[1]-1)*p,y=(e.windowCenter[1]+1)*p,T=u[0],C=u[1];n[0]=2*T/(m-h),n[5]=2*T/(y-v),n[2]=(h+m)/(m-h),n[6]=(v+y)/(y-v),n[10]=-(T+C)/(C-T),n[14]=-1,n[11]=-2*T*C/(C-T),n[15]=0}}return mn(s,n),s}}const hA={newInstance:gA,extend:Iy};class Jg{get numTimePoints(){return typeof this.numDimensionGroups=="number"?this.numDimensionGroups:1}constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numFrames=null;const{imageIds:n,scaling:r,dimensions:i,spacing:a,origin:o,direction:s,dataType:c,volumeId:l,referencedVolumeId:f,metadata:u,referencedImageIds:g,additionalDetails:d,voxelManager:p,numberOfComponents:h}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:m}=e;this.suppressWarnings=!0,this.imageIds=n,this.volumeId=l,this.metadata=u,this.dimensions=i,this.spacing=a,this.origin=o,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=uA.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=p??en.createImageVolumeVoxelManager({dimensions:i,imageIds:n,numberOfComponents:h,id:l}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],m||(m=qg.newInstance(),m.setDimensions(i),m.setSpacing(a),m.setDirection(s),m.setOrigin(o)),m.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:h||1},this.suppressWarnings),m.set({hasScalarVolume:!1},this.suppressWarnings),this.imageData=m,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),r&&(this.scaling=r),f&&(this.referencedVolumeId=f),g&&(this.referencedImageIds=g),d&&(this.additionalDetails=d)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=hr(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return this.numTimePoints?this.numTimePoints>1:!1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){Ve.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(n=>Ve.getImage(n))}}const va=[];function P0(t,e=0){let n;for(n=0;n<va.length&&!(va[n].priority<=e);n++);va.splice(n,0,{priority:e,provider:t})}function pA(t){for(let e=0;e<va.length;e++)if(va[e].provider===t){va.splice(e,1);break}}function mA(){for(;va.length>0;)va.pop()}function Pe(t,...e){for(let n=0;n<va.length;n++){const r=va[n].provider(t,...e);if(r!==void 0)return r}}function q2(t,e,n=Pe){const r={};for(const i of e)try{const a=n(i,t);if(a){const o={};for(const s in a)if(s in a){const c=by(s);o[c]=a[s]}Object.assign(r,o)}}catch(a){console.error(`Error retrieving ${i} data:`,a)}return r}const by=t=>t.startsWith("sop")?`SOP${t.substring(3)}`:(t.endsWith("Id")&&(t=`${t.substring(0,t.length-2)}ID`),t.charAt(0).toUpperCase()+t.slice(1)),vA=t=>t.startsWith("SOP")?`sop${t.substring(3)}`:(t.endsWith("ID")&&(t=`${t.substring(0,t.length-2)}Id`),t.charAt(0).toLowerCase()+t.slice(1)),yA=Object.freeze(Object.defineProperty({__proto__:null,addProvider:P0,get:Pe,getNormalized:q2,removeAllProviders:mA,removeProvider:pA,toLowerCamelTag:vA,toUpperCamelTag:by},Symbol.toStringTag,{value:"Module"}));let Y0={};const Qg={add:(t,e)=>{Qg.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;Y0[t]||(Y0[t]={}),Y0[t][n]=e.metadata},get:(t,e)=>Y0[e]?.[t],clear:()=>{Y0={}}};P0(Qg.get);const Ea=new $h("imageLoadPool");Ea.grabDelay=0;Ea.setMaxSimultaneousRequests(gt.Interaction,1e3);Ea.setMaxSimultaneousRequests(gt.Thumbnail,1e3);Ea.setMaxSimultaneousRequests(gt.Prefetch,1e3);const Ly={};let TA;function Vy(t,e){const n=Ve.getImageLoadObject(t);if(n)return km(n.promise,t),n;const r=t.split(":")[0],i=Ly[r]||TA;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const a=i(t,e);return km(a.promise,t),a}function km(t,e){Promise.resolve(t).then(n=>{CA(n),Oe(Me,Ee.IMAGE_LOADED,{image:n})}).catch(n=>{const r={imageId:e,error:n};Oe(Me,Ee.IMAGE_LOAD_FAILED,r)})}function CA(t){if(!t.voxelManager){const{width:e,height:n,numberOfComponents:r}=t,i=en.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:n,numberOfComponents:r});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function wA(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return Vy(t,e).promise}function T0(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=Vy(t,e);return Ve.getImageLoadObject(t)||Ve.putImageLoadObject(t,n),n.promise}function SA(t,e){const{scalarData:n,origin:r,direction:i,targetBuffer:a,skipCreateBuffer:o,onCacheAdd:s,frameOfReferenceUID:c,voxelRepresentation:l,referencedImageId:f}=e,u=e.dimensions,g=e.spacing;if(!u||!g)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const d=u[0],p=u[1],h=g[0],m=g[1],v={frameOfReferenceUID:c,rows:p,columns:d,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:r??[0,0,0],pixelSpacing:[m,h],rowPixelSpacing:m,columnPixelSpacing:h},y=d*p,T=n.length/y;let C;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");C=n}else if(!o){const{TypedArrayConstructor:H}=My(a?.type,y);C=new H(y)}let w,S,_;if(C instanceof Uint8Array)w=8,S=8,_=7;else if(C instanceof Uint16Array)w=16,S=16,_=15;else if(C instanceof Int16Array)w=16,S=16,_=15;else if(C instanceof Float32Array)w=32,S=32,_=31;else throw new Error("Unsupported scalarData type");const D={samplesPerPixel:1,photometricInterpretation:C.length>u[0]*u[1]?"RGB":"MONOCHROME2",rows:p,columns:d,bitsAllocated:w,bitsStored:S,highBit:_},N={imagePlaneModule:v,imagePixelModule:D};["imagePlaneModule","imagePixelModule"].forEach(H=>{Qg.add(t,{type:H,metadata:N[H]||{}})});const P=t,F=l===Uf.RLE&&en.createRLEImageVoxelManager({dimensions:u,id:P})||en.createImageVoxelManager({height:p,width:d,numberOfComponents:T,scalarData:C,id:P});let B=C[0],k=C[0];for(let H=1;H<C.length;H++)C[H]<B&&(B=C[H]),C[H]>k&&(k=C[H]);const U={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:D.photometricInterpretation==="RGB",numberOfComponents:D.samplesPerPixel,dataType:a?.type,slope:1,minPixelValue:B,maxPixelValue:k,rows:D.rows,columns:D.columns,getCanvas:void 0,height:D.rows,width:D.columns,rgba:void 0,columnPixelSpacing:v.columnPixelSpacing,rowPixelSpacing:v.rowPixelSpacing,FrameOfReferenceUID:v.frameOfReferenceUID,invert:!1,getPixelData:()=>F.getScalarData(),voxelManager:F,sizeInBytes:n.byteLength,referencedImageId:f};return s?.(U),Ve.putImageSync(U.imageId,U),U}function wf(t,e){Ly[t]=e}function Py(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=Pe("imagePixelModule",e),c=[],l=Pe("voiLutModule",e);let f;if(l){const{windowWidth:y,windowCenter:T}=l;if(f=l?.voiLUTFunction,Array.isArray(y))for(let C=0;C<y.length;C++)c.push({windowWidth:y[C],windowCenter:T[C]});else c.push({windowWidth:y,windowCenter:T})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:g}=Pe("generalSeriesModule",e),{imageOrientationPatient:d,pixelSpacing:p,frameOfReferenceUID:h,columns:m,rows:v}=Pe("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:s,HighBit:a,PhotometricInterpretation:o,PixelRepresentation:n,Modality:u,ImageOrientationPatient:d,PixelSpacing:p,FrameOfReferenceUID:h,Columns:m,Rows:v,voiLut:c,VOILUTFunction:f,SeriesInstanceUID:g}}const od=1;function Gm(t){if(t.columnPixelSpacing!==void 0)return t.columnPixelSpacing;if(t.rowPixelSpacing!==void 0)return t.rowPixelSpacing;if(t.pixelSpacing?.[1]!==void 0)return t.pixelSpacing[1];if(t.pixelSpacing?.[0]!==void 0)return t.pixelSpacing[0]}function Ny(t){const{imagePositionPatient:e,imageOrientationPatient:n}=Pe("imagePlaneModule",t[0]);if(t.length===1){const{sliceThickness:m,spacingBetweenSlices:v,columnPixelSpacing:y,rowPixelSpacing:T,pixelSpacing:C}=Pe("imagePlaneModule",t[0]);if(m)return m;if(v)return v;const w=Gm({columnPixelSpacing:y,rowPixelSpacing:T,pixelSpacing:C});return w!==void 0?w:od}const r=Et(n[0],n[1],n[2]),i=Et(n[3],n[4],n[5]),a=Ie();zt(a,r,i);const o=Et(e[0],e[1],e[2]),s=t[0].split(":")[0]==="wadouri";let c;function l(m){const{imagePositionPatient:v}=Pe("imagePlaneModule",m),y=Ie(),T=Et(v[0],v[1],v[2]);return Ut(y,o,T),He(y,a)}if(s){const m=[t[0],t[Math.floor(t.length/2)]],v=Pe("imagePlaneModule",m[1]);if(!v)throw new Error("Incomplete metadata required for volume construction.");const y=Ie(),T=Et(v.imagePositionPatient[0],v.imagePositionPatient[1],v.imagePositionPatient[2]);Ut(y,o,T);const C=He(y,a);c=Math.abs(C)/Math.floor(t.length/2)}else{const m=t.map(y=>({distance:l(y),imageId:y}));m.sort((y,T)=>T.distance-y.distance);const v=m.length;c=Math.abs(m[v-1].distance-m[0].distance)/(v-1)}const{sliceThickness:f,spacingBetweenSlices:u,columnPixelSpacing:g,rowPixelSpacing:d,pixelSpacing:p}=Pe("imagePlaneModule",t[0]),{strictZSpacingForVolumeViewport:h}=wa().rendering;if((c===0||isNaN(c))&&!h)if(u)console.debug("Could not calculate spacing. Using spacingBetweenSlices"),c=u;else if(f)console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),c=f;else{const m=Gm({columnPixelSpacing:g,rowPixelSpacing:d,pixelSpacing:p});m?c=m:(console.debug(`Could not calculate spacing and no pixel spacing found. Using default thickness (${od} mm)`),c=od)}return c}function Ay(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=Pe("imagePlaneModule",t[0]);if(!e){const f=Et(r[0],r[1],r[2]),u=Et(r[3],r[4],r[5]);e=Ie(),zt(e,f,u)}const i=t[0].split(":")[0]==="wadouri",a=Ny(t);let o;function s(f){const{imagePositionPatient:u}=Pe("imagePlaneModule",f),g=Ie();return Ut(g,n,u),He(g,e)}if(i){const f=[t[0],t[Math.floor(t.length/2)]];o=t;const u=s(f[0]),g=s(f[1]);u-g<0&&o.reverse()}else{const f=t.map(u=>({distance:s(u),imageId:u}));f.sort((u,g)=>g.distance-u.distance),o=f.map(u=>u.imageId)}const{imagePositionPatient:c}=Pe("imagePlaneModule",o[0]);return{zSpacing:a,origin:c,sortedImageIds:o}}function Fy(t){const e=Pe("modalityLutModule",t)||{},n=Pe("generalSeriesModule",t)||{},{modality:r}=n,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},a=Pe("scalingModule",t)||{};return{...i,...r==="PT"&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm},...r==="RTDOSE"&&{doseGridScaling:a.DoseGridScaling,doseSummation:a.DoseSummation,doseType:a.DoseType,doseUnit:a.DoseUnit}}}const X2=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n)),Bm={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function Y2(t,e){const n=Py(t),{ImageOrientationPatient:r,PixelSpacing:i,Columns:a,Rows:o}=n,s=Et(r[0],r[1],r[2]),c=Et(r[3],r[4],r[5]),l=Ie();zt(l,s,c);const{zSpacing:f,origin:u,sortedImageIds:g}=Ay(t,l),d=t.length,p=[i[1],i[0],f],h=[a,o,d].map(v=>Math.floor(v)),m=[...s,...c,...l];return{dimensions:h,spacing:p,origin:u,dataType:xA(g,n),direction:m,metadata:n,imageIds:g,volumeId:e,voxelManager:null,numberOfComponents:n.PhotometricInterpretation==="RGB"?3:1}}function xA(t,e){const{BitsAllocated:n,PixelRepresentation:r}=e,i=r===1,a=EA(t);if(a)return a;const[o,s,c]=[0,Math.floor(t.length/2),t.length-1],l=[o,s,c].map(d=>Fy(t[d])),f=l.some(d=>d.rescaleIntercept<0||d.rescaleSlope<0),u=l.some(d=>X2(d)),g=Wh();switch(n){case 8:return"Uint8Array";case 16:return g&&u?"Float32Array":i||f?"Int16Array":!i&&!f?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";case 64:return"Float64Array";default:throw new Error(`Bits allocated of ${n} is not defined to generate scalarData for the volume.`)}}function EA(t){const n=[0,Math.floor(t.length/2),t.length-1].map(i=>Ve.getImage(t[i]));if(!n.every(Boolean))return null;const r=n[0].getPixelData().constructor.name;return n.every(i=>i.getPixelData().constructor.name===r)&&r in Bm?Bm[r]:null}let lg=class Uy{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new Uy("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(i){n.reject(i)}},r=>{n.reject(r)}),n}add(e,n=!1){this.nextValue=e,this.done||=n,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const i of this){const{done:a}=this;try{await e(i,a,r),r++}catch(o){if(!a){console.warn("Caught exception in intermediate value",o);continue}if(n)n(o,a);else throw o}}}catch(i){if(n)n(i,!0);else throw i}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const Fc=new Map,$m="imageRetrieveConfiguration",C0={IMAGE_RETRIEVE_CONFIGURATION:$m,clear:()=>{Fc.clear()},add:(t,e)=>{Fc.set(t,e)},clone:()=>new Map(Fc),restore:t=>{Fc.clear(),t.forEach((e,n)=>{Fc.set(n,e)})},get:(t,...e)=>{if(t===$m)return e.map(n=>Fc.get(n)).find(n=>n!==void 0)}};P0(C0.get.bind(C0));function e1(t){const e=Da(),n=[];return e.forEach(r=>{const a=r.getVolumeViewports().filter(o=>o.hasVolumeId(t));n.push(...a)}),n}const vh=t=>{const e=OA(t);e?.length&&e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function OA(t){const e=Da(),n=[];return e.forEach(r=>{const i=e1(t);i.length&&n.push({renderingEngine:r,viewportIds:i.map(a=>a.id)})}),n}const Wm=[{id:"initialImages",retrieveType:"single"}],RA=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],sd=[{offset:-1,imageQualityStatus:ui.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:ui.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:ui.FAR_REPLICATE}],DA=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:gt.Thumbnail,priority:5,nearbyFrames:sd},{id:"quarterThumb",decimate:4,offset:3,requestType:gt.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:sd},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:gt.Thumbnail,retrieveType:"multipleFast",nearbyFrames:sd},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:gt.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:gt.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:gt.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:gt.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function ky(t,e,n=0){const r=[];for(let i=n;i<t.length;i+=e)r.push(i);return r}function MA(t,e,n){if(e?.nearbyRequests?.length)for(const r of e.nearbyRequests)try{const{itemId:i,imageQualityStatus:a}=r,o=Ve.getImageQuality(i);if(o!==void 0&&o>=a)continue;const s={...n,imageId:i,imageQualityStatus:a};Ve.setPartialImage(i,s),t.successCallback(i,s)}catch(i){console.warn("Couldn't fill nearby item ",r.itemId,i)}}const e0=class e0{constructor(e){this.stages=e.stages||Wm,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new _A(this,e,n).loadImages()}};e0.createProgressive=Gy,e0.interleavedRetrieveStages={stages:DA},e0.singleRetrieveStages={stages:Wm},e0.sequentialRetrieveStages={stages:RA};let ug=e0;class _A{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new lg("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:i}=e,a=(f,u)=>{this.listener.errorCallback(r,c||!i,f),u&&this.updateStageStatus(e.stage,f)},o=(n.loader||T0)(r,n),s=lg.as(o);let c=!1;return s.forEach(async(f,u)=>{const g=Ve.getImageQuality(r);if(!f){console.warn("No image retrieved",r);return}const{imageQualityStatus:d}=f;if(c||=d===ui.FULL_RESOLUTION,g!==void 0&&g>d){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,f),this.displayedIterator.add(f),u&&this.updateStageStatus(e.stage),MA(this.listener,e,f)},a).finally(()=>{if(!c&&i)Ve.setPartialImage(r),this.addRequest(i,n.streamingData);else{c||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let f=i;f;f=f.next)this.updateStageStatus(f.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(f=>null)}addRequest(e,n={}){const{imageId:r,stage:i}=e,a=this.listener.getLoaderImageOptions(r);if(!a)return;const{retrieveType:o="default"}=i,{retrieveOptions:s}=this,c=s[o]||s.default,l={...a,retrieveType:o,retrieveOptions:c,streamingData:n},f=i.priority??-5,u=i.requestType||gt.Interaction,g={imageId:r};Ea.addRequest(this.sendRequest.bind(this,e,l),u,g,f)}updateStageStatus(e,n,r=!1){const{id:i}=e,a=this.stageStatusMap.get(i);if(a&&(a.imageLoadPendingCount--,n?a.imageLoadFailedCount++:r||a.totalImageCount++,!r&&!a.stageStartTime&&(a.stageStartTime=Date.now()),!a.imageLoadPendingCount)){const{imageLoadFailedCount:o,totalImageCount:s,stageStartTime:c=Date.now(),startTime:l}=a,f={stageId:i,numberOfFailures:o,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};Oe(Me,Ee.IMAGE_RETRIEVAL_STAGE,f),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,n=new Map,r=(i,a)=>{const o=a<0?this.imageIds.length+a:a<1?Math.floor((this.imageIds.length-1)*a):a,s=this.imageIds[o];if(!s)throw new Error(`No value found to add to requests at ${a}`);const c={imageId:s,stage:i,index:o,nearbyRequests:this.findNearbyRequests(o,i)};this.addStageStatus(i);const l=n.get(s);l?l.next=c:e.push(c),n.set(s,c)};for(const i of this.stages)(i.positions||ky(this.imageIds,i.decimate||1,i.offset??0)).forEach(o=>{r(i,o)});return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const i of n.nearbyFrames){const a=e+i.offset;a<0||a>=this.imageIds.length||r.push({itemId:this.imageIds[a],imageQualityStatus:i.imageQualityStatus,index:a})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function Gy(t){return new ug(t)}const zm=gt.Prefetch;class IA extends Jg{constructor(e,n){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:r}=this;if(!r||!r.loading)return;r.loading=!1,r.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:a})=>a.volumeId!==this.volumeId;Ea.filterRequests(i)},this.loadStatus=n.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:n}=this,{numFrames:r}=this;for(let i=0;i<r;i++)n.setUpdatedFrame(i);this.modified(),e&&vh(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:n,framesProcessed:r,totalNumFrames:i}=e,{volumeId:a,reRenderFraction:o,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(n>this.reRenderTarget||r===i)&&(this.reRenderTarget+=o,vh(a)),r===i){s.callbacks.forEach(u=>u(e));const f={FrameOfReferenceUID:l,volumeId:a};Oe(Me,Ee.IMAGE_VOLUME_LOADING_COMPLETED,f)}}updateTextureAndTriggerEvents(e,n,r=ui.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:a,numFrames:o,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(a[i]>r||a[i]===ui.FULL_RESOLUTION)return;const f=r===ui.FULL_RESOLUTION;a[e]=r,this.framesUpdated++,f&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:o,framesProcessed:this.framesProcessed};Oe(Me,Ee.IMAGE_VOLUME_MODIFIED,u),f&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:s,complete:f,imageQualityStatus:r}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,n){const r=this.getImageIdIndex(e),{imageQualityStatus:i}=n;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",r);return}this.updateTextureAndTriggerEvents(r,e,i),this.isDynamicVolume()&&this.checkDimensionGroupCompletion(r)}errorCallback(e,n,r){if(!n)return;const{totalNumFrames:i,numFrames:a}=this,o=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:o,error:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:r,imageIdIndex:o,imageId:e};Oe(Me,Ee.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:n,loadStatus:r,numFrames:i}=this,{transferSyntaxUID:a}=Pe("transferSyntax",n[0])||{},o=Pe(C0.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,a,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:o?(o.create||ug.createProgressive)(o):this,r.loading===!0)return;const{loaded:s}=this.loadStatus,c=n.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:n}=Pe("transferSyntax",e)||{},r=Pe("imagePlaneModule",e)||{},{rows:i,columns:a}=r,o=this.getImageIdIndex(e),s=Pe("modalityLutModule",e)||{},c=Pe("generalSeriesModule",e)||{},l={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality},f=l.modality;if(f==="PT"||f==="RTDOSE"){const p=Pe("scalingModule",e);p&&(this._addScalingToVolume(p),Object.assign(l,p))}const u=X2(l),g=Wh();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:p,rescaleIntercept:h}=l;this.isPreScaled=typeof p=="number"&&typeof h=="number"}return!g&&u&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:a},allowFloatRendering:g,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:zm,transferSyntaxUID:n,additionalDetails:{imageId:e,imageIdIndex:o,volumeId:this.volumeId},retrieveOptions:void 0}}callLoadImage(e,n,r){const{cachedFrames:i}=this;if(i[n]===ui.FULL_RESOLUTION)return;const a=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(n),Me.removeEventListener(Ee.IMAGE_CACHE_IMAGE_ADDED,a))};return Me.addEventListener(Ee.IMAGE_CACHE_IMAGE_ADDED,a),lg.as(T0(e,r)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,n,e))}getImageIdsRequests(e,n){this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),e.map(a=>{const o=this.getImageIdIndex(a),s=zm,c=n,l=this.getLoaderImageOptions(a),{retrieveOptions:f={}}=Pe(C0.IMAGE_RETRIEVE_CONFIGURATION,a,"volume")||{};return l.retrieveOptions={...l.retrieveOptions,...f.default||Object.values(f)?.[0]||{}},{callLoadImage:this.callLoadImage.bind(this),imageId:a,imageIdIndex:o,options:l,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(n=>{if(!n)return;const{callLoadImage:r,imageId:i,imageIdIndex:a,options:o,priority:s,requestType:c,additionalDetails:l}=n;Ea.addRequest(r.bind(this,i,a,o),c,l,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(r=>{console.debug("progressive loading failed to complete",r)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),n&&(a.suvbw=n),this.scaling={PT:a}}checkDimensionGroupCompletion(e){}}class bA extends IA{constructor(e,n){e.imageIds||(e.imageIds=n.imageIds),super(e,n),this.getImageIdsToLoad=()=>{const{imageIds:r}=this;return this.numFrames=r.length,r}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:n}=this;return this.getImageIdsRequests(n,e)}}function LA(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function n(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[p,h]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],m=[0,p,h];await Promise.all(m.map(v=>Ve.isLoaded(e.imageIds[v])?Promise.resolve(!0):new Promise((y,T)=>{const C=e.imageIds[v];Ea.addRequest(async()=>{wA(C).then(()=>{console.log(`Prefetched imageId: ${C}`),y(!0)}).catch(w=>{T(w)})},gt.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=Y2(e.imageIds,t),{dimensions:a,spacing:o,origin:s,direction:c,metadata:l,imageIds:f,dataType:u,numberOfComponents:g}=i;return new bA({volumeId:t,metadata:l,dimensions:a,spacing:o,origin:s,direction:c,imageIds:f,dataType:u,numberOfComponents:g},{imageIds:f,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const r=n();return{promise:r,decache:()=>{r.then(i=>{i.destroy(),i=null})},cancel:()=>{r.then(i=>{i.cancelLoading()})}}}const By={};let Sf=LA;function $y(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let i=By[r];if(i==null){if(Sf==null||typeof Sf!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);i=Sf}const a=i(t,e);return a.promise.then(function(o){Oe(Me,Ee.VOLUME_LOADED,{volume:o})},function(o){const s={volumeId:t,error:o};Oe(Me,Ee.VOLUME_LOADED_FAILED,s)}),a}function Wy(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=Ve.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=$y(t,e),n.promise.then(r=>r))}async function zy(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=Ve.getVolumeLoadObject(t);return n!==void 0||(n=$y(t,e),Ve.putVolumeLoadObject(t,n)),n.promise}async function VA(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const n=Ve.getVolume(t);return n||(e.filter(a=>!Ve.getImage(a)).length===0?PA(t,e):await zy(t,{imageIds:e}))}function PA(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const n=Ve.getVolume(t);if(n)return n;const r=Y2(e,t),i=new Jg({volumeId:t,dataType:r.dataType,metadata:structuredClone(r.metadata),dimensions:r.dimensions,spacing:r.spacing,origin:r.origin,direction:r.direction,referencedVolumeId:r.referencedVolumeId,imageIds:r.imageIds,referencedImageIds:r.referencedImageIds});return Ve.putVolumeSync(t,i),i}function NA(t,e={}){const{metadata:n,dimensions:r,spacing:i,origin:a,direction:o,scalarData:s,targetBuffer:c,preventCache:l=!1}=e,f=Ve.getVolume(t);if(f)return f;const u=r[0]*r[1],g=s?s.constructor.name:c?.type??"Float32Array",d=u*r[2];let p;switch(g){case"Uint8Array":case"Int8Array":p=d;break;case"Uint16Array":case"Int16Array":p=d*2;break;case"Float32Array":p=d*4;break}if(!Ve.isCacheable(p))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const m=[];for(let T=0;T<r[2];T++){const C=`${t}_slice_${T}`;m.push(C);const w=s.subarray(T*u,(T+1)*u);SA(C,{scalarData:w,dimensions:[r[0],r[1]],spacing:[i[0],i[1]],origin:a,direction:o,targetBuffer:{type:g}})}const v=new Jg({volumeId:t,metadata:structuredClone(n),dimensions:[r[0],r[1],r[2]],spacing:i,origin:a,direction:o,imageIds:m,dataType:g}),y=en.createImageVolumeVoxelManager({imageIds:m,dimensions:r,numberOfComponents:1,id:t});return v.voxelManager=y,l||Ve.putVolumeSync(t,v),v}function AA(){return Object.keys(By)}function FA(){return Sf.name}function UA(t,e){const n=oA.newInstance();n.setInputData(t);const r=t.getSpacing(),a=(wa().rendering?.volumeRendering?.sampleDistanceMultiplier||1)*(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(a),n.setScalarTexture(e),n}function kA(t){const e=Ry.newInstance();e.setBlendMode(t.getBlendMode());const n=t.getInputData(),{voxelManager:r}=n.get("voxelManager"),i=r.getCompleteScalarDataArray(),a=ot.newInstance({name:"Pixels",values:i});return n.getPointData().setScalars(a),e.setInputData(n),e.setMaximumSamplesPerRay(t.getMaximumSamplesPerRay()),e.setSampleDistance(t.getSampleDistance()),e}const GA=0,BA=gt.Prefetch;async function Z2(t,e){let n=WA(e);!n&&e.imageIds.length&&(n=await zA(e),n=$A(e,n)),!(n.lower===0&&n.upper===0||n.lower===void 0||n.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(n.lower,n.upper)}function $A(t,e){const n=t.imageIds,r=Math.floor(n.length/2),i=n[r],a=Pe("generalSeriesModule",i)||{};return HA(a.modality,t)?{lower:0,upper:5}:e}function WA(t){const{imageIds:e,metadata:n}=t;let r;if(e?.length){const i=Math.floor(e.length/2),a=e[i],o=Pe("voiLutModule",a);if(o&&o.windowWidth&&o.windowCenter){o?.voiLUTFunction&&(r={},r.voiLUTFunction=o?.voiLUTFunction);const{windowWidth:s,windowCenter:c}=o,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;l!==0&&(r={windowWidth:l,windowCenter:f})}}else r=n.voiLut[0];if(r&&(r.windowWidth!==0||r.windowCenter!==0)){const{lower:i,upper:a}=a0(Number(r.windowWidth),Number(r.windowCenter),r.voiLUTFunction);return isNaN(i)||isNaN(a)?void 0:{lower:i,upper:a}}}async function zA(t){const{imageIds:e}=t,n=Math.floor(e.length/2),r=t.imageIds[n],i=Pe("generalSeriesModule",r)||{},{modality:a}=i,o=Pe("modalityLutModule",r)||{},s={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:a};let c;if(a==="PT"){const d=Pe("scalingModule",r);d&&(c={...s,suvbw:d.suvbw})}const l={priority:GA,requestType:BA,preScale:{scalingParameters:c}};let f=Ve.getImage(r);t.referencedImageIds?.length||(f=await T0(r,{...l,ignoreCache:!0}));let{min:u,max:g}=f.voxelManager.getMinMax();return u?.length>1&&(u=Math.min(...u),g=Math.max(...g)),{lower:u,upper:g}}function HA(t,e){return!(t!=="PT"||!e.isPreScaled||!e.scaling?.PT.suvbw)}async function yh(t,e,n,r=!1){const{volumeId:i,callback:a,blendMode:o}=t,s=await Wy(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=s,f=UA(c,l);o&&f.setBlendMode(o);const u=yR.newInstance();u.setMapper(f);const{numberOfComponents:g}=c.get("numberOfComponents"),d=u.getProperty();return d.set({viewportId:n},!0),wa().rendering.preferSizeOverAccuracy&&d.setPreferSizeOverAccuracy(!0),g===3&&u.getProperty().setIndependentComponents(!1),await Z2(u,s),a&&a({volumeActor:u,volumeId:i}),r||jA(e,n,u,i),u}function jA(t,e,n,r){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:r};Oe(t,Ee.VOI_MODIFIED,a)}function Hy(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}const KA=Ii*Ii,cd=t=>Math.abs(Math.abs(t)-1)<KA,ld=(t,e)=>cd(t[e])||cd(t[e+1])||cd(t[e+2]),qA=t=>ld(t,0)&&ld(t,3)&&ld(t,6);function t1(t,e,n){const r=t.getMapper().getInputData();let i;const a=r.getDirection();if(qA(a))i=Hy(t);else{const[u,g,d]=r.getDimensions();i=[[0,0,0],[u-1,0,0],[0,g-1,0],[u-1,g-1,0],[0,0,d-1],[u-1,0,d-1],[0,g-1,d-1],[u-1,g-1,d-1]].map(h=>r.indexToWorld(h))}const o=lc.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(u=>o.apply(u));const s=[...n];o.apply(s);const c=s[0];let l=1/0,f=-1/0;for(let u=0;u<8;u++){const g=i[u][0];g>f&&(f=g),g<l&&(l=g)}return{min:l,max:f,current:c,actor:t,viewPlaneNormal:e,focalPoint:n}}function uu(t,e){const{direction:n,spacing:r}=t,i=n.slice(0,3),a=n.slice(3,6),o=n.slice(6,9),s=[He(i,e),He(a,e),He(o,e)],c=Ie();return Yr(c,s[0]*r[0],s[1]*r[1],s[2]*r[2]),hs(c)}const N0=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},XA=1+Ii,YA=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),Hm=t=>!!AA().find(e=>YA(t.volumeId,e));function fu(t,e,n,r=!1){const{viewPlaneNormal:i}=e,a=t.getActors();if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o=a.map(l=>{const f=l.referencedId??l.uid;return Ve.getVolume(f)}).filter(l=>!!l);if(n){const l=N0(n),f=o.findIndex(p=>l.includes(p.volumeId)),u=o[f],{uid:g}=a[f],d=jm(u,i,t,r);return{imageVolume:u,spacingInNormalDirection:d,actorUID:g}}if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=o.find(Hm);for(let l=0;l<o.length;l++){const f=o[l];if(c&&!Hm(f))continue;const u=jm(f,i,t);u*XA<s.spacingInNormalDirection&&(s.spacingInNormalDirection=u,s.imageVolume=f,s.actorUID=a[l].uid)}return s}function jm(t,e,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return(!i||!r)&&(a=uu(t,e)),a}function fg(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=fu(t,e);if(!r)return;const{viewPlaneNormal:i,focalPoint:a}=e,o=t.getActors().find(p=>p.referencedId===r.volumeId||p.uid===r.volumeId);o||console.warn("No actor found for with actorUID of",r.volumeId);const s=o.actor,c=t1(s,i,a),{min:l,max:f,current:u}=c,g=Math.round((f-l)/n)+1;let d=(u-l)/(f-l)*g;return d=Math.floor(d),d>g-1?d=g-1:d<0&&(d=0),{numberOfSlices:g,imageIndex:d}}const Xc={};function ZA(t){Xc[t]!==void 0&&delete Xc[t]}function JA(t){const{renderingEngineId:e,viewportId:n}=t.detail,i=_c(e).getViewport(n);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");Xc[i.id]===void 0&&(Xc[i.id]=0);const a=fg(i);if(!a){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:o,imageIndex:s}=a;if(Xc[i.id]===s)return;Xc[i.id]=s;const c={imageIndex:s,viewportId:n,renderingEngineId:e,numberOfSlices:o};Oe(i.element,Ee.VOLUME_NEW_IMAGE,c)}function jy(t,e,n){const[r,i,a]=t,[o,s,c]=e,[l,f,u,g]=n,d=o-r,p=s-i,h=c-a,m=-1*(l*r+f*i+u*a-g)/(l*d+f*p+u*h),v=d*m+r,y=p*m+i,T=h*m+a;return[v,y,T]}function Ky(t,e,n=!1){const[r,i,a]=t,o=r*e[0]+i*e[1]+a*e[2];if(n){const s=Math.sqrt(r*r+i*i+a*a);return[r/s,i/s,a/s,o/s]}return[r,i,a,o]}function QA(t,e,n){const[r,i,a,o]=t,[s,c,l,f]=e,[u,g,d,p]=n,h=sl(r,s,u,i,c,g,a,l,d),m=sl(o,f,p,i,c,g,a,l,d),v=sl(r,s,u,o,f,p,a,l,d),y=sl(r,s,u,i,c,g,o,f,p),T=Zs(m)/Zs(h),C=Zs(v)/Zs(h),w=Zs(y)/Zs(h);return[T,C,w]}function J2(t,e,n=!1){const[r,i,a,o]=t,[s,c,l]=e,f=r*s+i*c+a*l-o,u=Math.abs(f)/Math.sqrt(r*r+i*i+a*a);return(n?Math.sign(f):1)*u}function eF(t,e,n=Ii){return J2(e,t)<n}const tF=Object.freeze(Object.defineProperty({__proto__:null,isPointOnPlane:eF,linePlaneIntersection:jy,planeDistanceToPoint:J2,planeEquation:Ky,threePlaneIntersection:QA},Symbol.toStringTag,{value:"Module"}));function Th(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function Bi(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(Bi);{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Bi(t[n]));return e}}const nF=.95;function qy(t,e){if(!t?.length||!e.FrameOfReferenceUID)return;e.planeRestriction||={FrameOfReferenceUID:e.FrameOfReferenceUID,point:t[0],inPlaneVector1:null,inPlaneVector2:null};const{planeRestriction:n}=e;if(t.length===1)return n.inPlaneVector1=null,n.inPlaneVector2=null,n;const r=Ut(Ie(),t[0],t[Math.floor(t.length/2)]);Ht(r,r),n.inPlaneVector1=r,n.inPlaneVector2=null;const i=t.length;if(i>2)for(let a=Math.floor(i/3);a<i;a++){const o=Ut(Ie(),t[a],t[0]),s=hs(o);if(!Wt(s,0)&&He(o,n.inPlaneVector1)<s*nF)return Ht(o,o),n.inPlaneVector2=o,n}return n}const bl=class bl{constructor(e){this.insetImageMultiplier=wa().rendering?.useLegacyCameraFOV?1.1:1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=Or.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.getRenderPasses=()=>null,this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const i=r.getActor(),a=r.getRenderer();a&&i&&a.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=Bi(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=Bi(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===Or.NO_DATA||this.viewportStatus===Or.LOADING||(this.viewportStatus=Or.RENDERED)}setColorTransform(e,n){let r=null;if(!e&&!n)return;const i=n||[255,255,255],a=Math.max(...i),o=i.map(u=>a/u),{lower:s=0,upper:c=255}=e||{},l=(c-s+1)/255,f=s/255;return r=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${o[0]*l} 0 0 0 ${f}           0 ${o[1]*l} 0 0 ${f}           0 0 ${o[2]*l} 0 ${f}           0 0 0 1 0" />        </filter>      </svg>#colour')`,r}getRenderingEngine(){return Fl.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){this.options=structuredClone(e),this.options?.displayArea&&this.setDisplayArea(this.options?.displayArea),n&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const i=this.getCamera(),{viewPlaneNormal:a,viewUp:o,focalPoint:s,position:c}=i,l=zt(Ie(),a,o);let f=h8(Ie(),o);const u=lo(Ie(),a),g=v0(c,s),p=r.getDimensions().map(w=>Math.floor(w/2)),h=[p[0],p[1],p[2]],m=r.indexToWorld(h,Ie()),v=this._getFocalPointForResetCamera(m,i,{resetPan:!0,resetToCenter:!1}),y=_n(Ie(),s,v),T=hs(y),C=w=>{const S=zi(Ie(),w,2*He(y,w));return _n(S,S,y),Ht(S,S),S};if(e){const w=C(f),S=Qn(Ie(),v,w,T),_=Qn(Ie(),S,u,g);this.setCamera({viewPlaneNormal:u,position:_,focalPoint:S}),this.flipHorizontal=!this.flipHorizontal}if(n){f=lo(f,o);const w=C(l),S=Qn(Ie(),v,w,T),_=Qn(Ie(),S,u,g);this.setCamera({focalPoint:S,viewPlaneNormal:u,viewUp:f,position:_}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&Mi(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const n=this.getActors();let r=n[0];return e&&(r=n.find(a=>a.referencedId===e)),!r||!Mi(r)?null:r.actor}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){const n=this.getActors();this.removeAllActors(),this.addActors(e,{resetCamera:!0}),Oe(this.element,Ee.ACTORS_CHANGED,{viewportId:this.id,removedActors:n,addedActors:e,currentActors:e})}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist in ${this.id}, can't remove`);return}return this.getRenderer().removeActor(n.actor),this._actors.delete(e),n}removeActors(e){const n=[];e.forEach(i=>{const a=this._removeActor(i);a&&n.push(a)});const r=this.getActors();Oe(this.element,Ee.ACTORS_CHANGED,{viewportId:this.id,removedActors:n,addedActors:[],currentActors:r})}addActors(e,n={}){const{resetCamera:r=!1}=n,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}if(e.forEach(a=>{this.addActor(a)}),r)this.resetCamera();else{const a=this.getViewPresentation(),o=this.getViewReference();this.resetCamera(),this.setViewReference(o),this.setViewPresentation(a)}Oe(this.element,Ee.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:e,currentActors:this.getActors()})}addActor(e){const{uid:n,actor:r}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}this.getRenderer()?.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange(),Oe(this.element,Ee.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:[e],currentActors:this.getActors()})}removeAllActors(){const e=this.getActors();this.getRenderer()?.removeAllViewProps(),this._actors=new Map,Oe(this.element,Ee.ACTORS_CHANGED,{viewportId:this.id,removedActors:e,addedActors:[],currentActors:[]})}resetCameraNoEvent(){const e=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=e}setCameraNoEvent(e){const n=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=n}_getViewImageDataIntersections(e,n,r){const i=r[0],a=r[1],o=r[2],s=i*n[0]+a*n[1]+o*n[2],c=e.getBounds(),l=this._getEdges(c),f=[];for(const u of l){const[[g,d,p],[h,m,v]]=u;if(i*(h-g)+a*(m-d)+o*(v-p)===0)continue;const y=jy([g,d,p],[h,m,v],[i,a,o,s]);this._isInBounds(y,c)&&f.push(y)}return f}setInterpolationType(e,n){}setDisplayArea(e,n=!1){if(!e)return;const{storeAsInitialCamera:r,type:i}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:a}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(this.getProperties()?.interpolationType??ao.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=a,!n&&!a){const o={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};Oe(this.element,Ee.DISPLAY_AREA_MODIFIED,o),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,i=r.height,a=r.width;if(i<8||a<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(ao.NEAREST),this.setCamera({parallelScale:i*c/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:f,viewUp:u,viewPlaneNormal:g}=this.getCamera(),d=Ie();if(r.height%2&&Qn(d,d,u,n*.5*c),r.width%2){const p=zt(Ie(),u,g);Qn(d,d,p,n*.5*c)}!d[0]&&!d[1]&&!d[2]||this.setCamera({focalPoint:co(Ie(),l,d),position:co(Ie(),f,d)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,i=window?.devicePixelRatio||1,a=this.getDefaultImageData();if(!a)return;const o=this.sWidth/i,s=this.sHeight/i,c=a.getDimensions(),l=this.worldToCanvas(a.indexToWorld([0,0,0])),f=this.worldToCanvas(a.indexToWorld([c[0],c[1],c[2]])),u=[Math.abs(f[0]-l[0]),Math.abs(f[1]-l[1])],[g,d]=u;let p=this.getZoom()/this.insetImageMultiplier;if(n){const[h,m]=n,v=Math.max(Math.abs(g/o),Math.abs(d/s)),y=Math.abs(h*g/o),T=Math.abs(m*d/s),C=this.getZoom(),w=this.getZoom(this.fitToCanvasCamera);p=(y>T?v/y:v/T)*C/w,this.setZoom(this.insetImageMultiplier*p,!1)}if(r){const{imagePoint:h,canvasPoint:m=h||[.5,.5]}=r,[v,y]=m,T=o*(v-.5),C=s*(y-.5),[w,S]=h||m,_=p,D=this.insetImageMultiplier*_*g*(.5-w),N=this.insetImageMultiplier*_*d*(.5-S),P=D+T,F=N+C,B=[P,F];m2(B,B,this.getPan()),this.setPan(B,!1)}}getDisplayArea(){return this.options?.displayArea}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetToCenter:i=!0,storeAsInitialCamera:a=!0}=e||{},o=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera();let c;const l=this.getDefaultActor();l&&Mi(l)?c=l.actor.getMapper().getInputData().getBounds():c=o.computeVisiblePropBounds();const f=[0,0,0],u=this.getDefaultImageData();if(u){const W=u.getSpacing();c[0]=c[0]+W[0]/2,c[1]=c[1]-W[0]/2,c[2]=c[2]+W[1]/2,c[3]=c[3]-W[1]/2,c[4]=c[4]+W[2]/2,c[5]=c[5]-W[2]/2}const g=this.getVtkActiveCamera(),d=g.getViewPlaneNormal(),p=g.getViewUp();if(f[0]=(c[0]+c[1])/2,f[1]=(c[2]+c[3])/2,f[2]=(c[4]+c[5])/2,u){const J=u.getDimensions().map(q=>Math.floor(q/2)),ne=[J[0],J[1],J[2]];u.indexToWorld(ne,f)}let h,m;const y=wa().rendering?.useLegacyCameraFOV??!1;if(u&&!y){const W=u.getExtent(),J=u.getSpacing();h=(W[1]-W[0])*J[0],m=(W[3]-W[2])*J[1]}else({widthWorld:h,heightWorld:m}=this._getWorldDistanceViewUpAndViewRight(c,p,d));const T=[this.sWidth,this.sHeight],C=h/m,w=T[0]/T[1],S=C/w,_=S<1?this.insetImageMultiplier*m/2:this.insetImageMultiplier*m*S/2,D=bl.boundsRadius(c)*(this.type===Bt.VOLUME_3D?10:1),N=this.insetImageMultiplier*D,P=Math.abs(Tn.dot(p,d))>.999?[-p[2],p[0],p[1]]:p,F=this._getFocalPointForResetCamera(f,s,{resetPan:n,resetToCenter:i}),B=[F[0]+N*d[0],F[1]+N*d[1],F[2]+N*d[2]];o.resetCameraClippingRange(c);const k=[-dn.MAXIMUM_RAY_DISTANCE,dn.MAXIMUM_RAY_DISTANCE];g.setPhysicalScale(D),g.setPhysicalTranslation(-F[0],-F[1],-F[2]),this.setCamera({parallelScale:r?_:s.parallelScale,focalPoint:F,position:B,viewAngle:90,viewUp:P,clippingRange:k});const U=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),a&&this.setInitialCamera(U),r&&this.setZoom(1,a);const H={type:"ResetCameraEvent",renderer:o};return o.invokeEvent(H),this.triggerCameraModifiedEventIfNecessary(s,U),u&&this.options.displayArea&&r&&n&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const r=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),a=this.worldToCanvas(_n([0,0,0],e.focalPoint,i)),o=this.worldToCanvas(_n([0,0,0],r,i));return gr([0,0],a,o)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:i,position:a}=r,o=this.canvasToWorld([0,0]),s=gr([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!n)return;const c=_n(Ie(),this.canvasToWorld(s),o),l=_n(Ie(),i,c),f=_n(Ie(),a,c);this.setCamera({...r,focalPoint:l,position:f},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:i}=this.initialCamera,a=i/e;r.parallelScale===a&&!n||this.setCamera({...r,parallelScale:a},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),i=this._getViewImageDataIntersections(e,n,r);let a=0,o=0,s=0;return i.forEach(([l,f,u])=>{a+=l,o+=f,s+=u}),[a/i.length,o/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),n=(s,c)=>s.some(l=>isNaN(l))?c:s,r=n([...e.getViewUp()],[0,1,0]),i=n([...e.getViewPlaneNormal()],[0,0,-1]),a=n([...e.getPosition()],[0,0,1]),o=n([...e.getFocalPoint()],[0,0,0]);return{viewUp:r,viewPlaneNormal:i,position:a,focalPoint:o,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),i=this.getCamera(),a=Object.assign({},i,e),{viewUp:o,viewPlaneNormal:s,position:c,focalPoint:l,parallelScale:f,viewAngle:u,flipHorizontal:g,flipVertical:d,clippingRange:p}=e;if(g!==void 0){const v=g&&!this.flipHorizontal||!g&&this.flipHorizontal;v&&this.flip({flipHorizontal:v})}if(d!==void 0){const v=d&&!this.flipVertical||!d&&this.flipVertical;v&&this.flip({flipVertical:v})}o!==void 0&&r.setViewUp(o),s!==void 0&&r.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&r.setPosition(...c),l!==void 0&&r.setFocalPoint(...l),f!==void 0&&r.setParallelScale(f),u!==void 0&&r.setViewAngle(u),p!==void 0&&r.setClippingRange(p);const h=i.focalPoint,m=i.viewUp;if(h&&l||m&&o){const v=r.getViewPlaneNormal(),y=r.getViewUp();let T=!1,C=!1;if(l){const w=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];T=Math.abs(Tn.dot(w,v))>0}if(o&&(C=!Wt(y,m)),T||C){const w=this.getDefaultActor();if(!w?.actor)return;Gr(w,"vtkActor")||this.updateClippingPlanesForActors(a),(Gr(w,"vtkImageSlice")||this.type===Bt.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(a),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Oe(this.element,Ee.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const i=r.actor.getMapper();let a=r?.clippingFilter?r?.clippingFilter.getClippingPlanes():i.getClippingPlanes();a.length===0&&r?.clippingFilter&&(a=[tr.newInstance(),tr.newInstance()]);let o=dn.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(o=r.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(a,o,s,c),Oe(this.element,Ee.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:c,vtkPlanes:a,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,i){if(e.length<2)return;const a=[r[0],r[1],r[2]];Tn.multiplyScalar(a,n),e[0].setNormal(r);const o=[0,0,0];Tn.subtract(i,a,o),e[0].setOrigin(o),e[1].setNormal(-r[0],-r[1],-r[2]);const s=[0,0,0];Tn.add(i,a,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e?.clippingFilter?e?.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&e?.clippingFilter&&(r=[tr.newInstance(),tr.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const i=this._getCorners(e),a=this._getCorners(e),o=zt(Ie(),n,r);let s=lc.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);i.forEach(g=>s.apply(g));let c=1/0,l=-1/0;for(let g=0;g<8;g++){const d=i[g][0];d>l&&(l=d),d<c&&(c=d)}s=lc.buildFromDegree().identity().rotateFromDirections([o[0],o[1],o[2]],[1,0,0]),a.forEach(g=>s.apply(g));let f=1/0,u=-1/0;for(let g=0;g<8;g++){const d=a[g][0];d>u&&(u=d),d<f&&(f=d)}return{widthWorld:u-f,heightWorld:l-c}}getViewReference(e){const{focalPoint:n,viewPlaneNormal:r,viewUp:i}=this.getCamera(),a=this.getFrameOfReferenceUID(),o={FrameOfReferenceUID:a,cameraFocalPoint:n,viewPlaneNormal:r,viewUp:i,sliceIndex:e?.sliceIndex??this.getSliceIndex(),planeRestriction:{FrameOfReferenceUID:a,point:e?.points?.[0]||n,inPlaneVector1:i,inPlaneVector2:zt(Ie(),i,r)}};return e?.points&&qy(e.points,o.planeRestriction),o}isPlaneViewable(e,n){if(e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{focalPoint:r,viewPlaneNormal:i}=this.getCamera(),{point:a,inPlaneVector1:o,inPlaneVector2:s}=e;if(n?.withOrientation)return!0;if(o&&!Wt(0,He(i,o))||s&&!Wt(0,He(i,s)))return!1;if(n?.withNavigation)return!0;const c=Ut(Ie(),a,r);return Wt(0,He(c,i))}isReferenceViewable(e,n){if(e.planeRestriction)return this.isPlaneViewable(e.planeRestriction,n);if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,i=this.getCamera();return r&&!Wt(r,i.viewPlaneNormal)&&!Wt(lo(i.viewPlaneNormal,i.viewPlaneNormal),r)?n?.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0,flipHorizontal:!0,flipVertical:!0}){const n={},{rotation:r,displayArea:i,zoom:a,pan:o,flipHorizontal:s,flipVertical:c}=e;r&&(n.rotation=this.getRotation()),i&&(n.displayArea=this.getDisplayArea());const l=this.getZoom();return a&&(n.zoom=l),o&&(n.pan=this.getPan(),j5(n.pan,n.pan,1/l)),s&&(n.flipHorizontal=this.flipHorizontal),c&&(n.flipVertical=this.flipVertical),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:i,rotation:a,flipHorizontal:o=this.flipHorizontal,flipVertical:s=this.flipVertical}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),i&&this.setPan(j5([0,0],i,r)),o!==void 0&&o!==this.flipHorizontal&&this.flip({flipHorizontal:o}),s!==void 0&&s!==this.flipVertical&&this.flip({flipVertical:s}),a>=0&&this.setRotation(a)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:i=!0}){if(i&&r)return e;if(i&&!r)return Th(n.focalPoint)?e:n.focalPoint;if(!i&&r){const a=n,o=a.focalPoint,s=a.viewPlaneNormal,c=_n(Ie(),e,o),l=He(c,s),f=Qn(Ie(),e,s,-1*l);return[f[0],f[1],f[2]]}if(!r&&!i)return Th(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,i,a,o,s,c]=n,[l,f,u]=e;return!(l<r||l>i||f<a||f>o||u<s||u>c)}_getEdges(e){const[n,r,i,a,o,s,c,l]=this._getCorners(e);return[[n,r],[n,o],[n,i],[r,a],[r,s],[i,a],[i,c],[a,l],[o,c],[o,s],[s,l],[c,l]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(n+r+i||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};bl.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},bl.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let w0=bl;function Xy(t,e,n=!1){const r=t.getCamera(),{focalPoint:i,viewPlaneNormal:a}=r,{spacingInNormalDirection:o,actorUID:s}=fu(t,r,e,n);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const l=c.actor;return{sliceRange:t1(l,a,i),spacingInNormalDirection:o,camera:r}}function o0(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:a}=Xy(t,e,n),{min:o,max:s,current:c}=r,l=Math.round((s-o)/i),u=(c-o)/(s-o)*l,g=Math.round(u);return{numScrollSteps:l,currentStepIndex:g,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:a}}}function s0(t,e,n,r,i,a){const{min:o,max:s,current:c}=n,l=Ie();Ut(l,e,t);const f=Math.round((s-o)/i),g=(c-o)/(s-o)*f;let d=Math.round(g),p=[t[0]-r[0]*g*i,t[1]-r[1]*g*i,t[2]-r[2]*g*i];d+=a,d>f?d=f:d<0&&(d=0);const h=d*i;p=[p[0]+r[0]*h,p[1]+r[1]*h,p[2]+r[2]*h];const m=[p[0]+l[0],p[1]+l[1],p[2]+l[2]];return{newFocalPoint:p,newPosition:m}}function Yy(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((d,p)=>p%3===0);const i=[...Array(1024).keys()].map((d,p)=>n+(r-n)/1023*p),a=e[256],o=Math.log((1-a)/a),s=i[256],c=e[256*3],l=Math.log((1-c)/c),f=i[256*3],u=Math.round(4*(f-s)/(o-l)),g=Math.round(s+u*o/4);return[Math.round(g-u/2),Math.round(g+u/2)]}function Zy(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=rF(n),i=r[0],a=r[1]-r[0],o=po.newInstance(),s=[];for(let C=0;C<n.length;C+=4){let w=n[C];const S=n[C+1],_=n[C+2],D=n[C+3];w=(w-i)/a,s.push([w,S,_,D])}iF(s,r,o),t.getProperty().setRGBTransferFunction(0,o);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=Cc.newInstance(),f=[];for(let C=0;C<c.length;C+=2){let w=c[C];const S=c[C+1];w=(w-i)/a,f.push([w,S])}aF(f,r,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[g,d,p,h]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,g),u.setGradientOpacityMinimumOpacity(0,d),u.setGradientOpacityMaximumValue(0,p),u.setGradientOpacityMaximumOpacity(0,h),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const m=parseFloat(e.ambient),v=parseFloat(e.diffuse),y=parseFloat(e.specular),T=parseFloat(e.specularPower);u.setAmbient(m),u.setDiffuse(v),u.setSpecular(y),u.setSpecularPower(T)}function rF(t){let e=1/0,n=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),n=Math.max(n,t[i]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function iF(t,e,n){const r=e[1]-e[0],i=t.map(([a,o,s,c])=>[a*r+e[0],o,s,c]);return n.removeAllPoints(),i.forEach(([a,o,s,c])=>n.addRGBPoint(a,o,s,c)),i}function aF(t,e,n){const r=e[1]-e[0],i=t.map(([a,o])=>[a*r+e[0],o]);return n.removeAllPoints(),i.forEach(([a,o])=>n.addPoint(a,o)),i}const{MPR_CAMERA_VALUES:oi}=Gh,{OrientationAxis:to}=Ra;function Jy(t,e,n,r){let i;switch(r){case to.AXIAL:case to.AXIAL_REFORMAT:i=oi.axial;break;case to.SAGITTAL:case to.SAGITTAL_REFORMAT:i=oi.sagittal;break;case to.CORONAL:case to.CORONAL_REFORMAT:i=oi.coronal;break;default:i=oi.axial;break}const a=Ht(Ie(),t),o=Ht(Ie(),e),s=Ht(Ie(),n),c=[a,o,s],l=[Et(i.viewRight[0],i.viewRight[1],i.viewRight[2]),Et(i.viewUp[0],i.viewUp[1],i.viewUp[2]),Et(i.viewPlaneNormal[0],i.viewPlaneNormal[1],i.viewPlaneNormal[2])],f=new Set,u=h=>{let m=0,v=-2,y=!1;c.forEach((C,w)=>{if(f.has(w))return;const S=He(h,C),_=Math.abs(S);_>v&&(v=_,m=w,y=S<0)}),f.add(m);const T=d8(c[m]);return y&&lo(T,T),T},g=u(l[0]),d=u(l[1]),p=u(l[2]);return{viewPlaneNormal:[p[0],p[1],p[2]],viewUp:[d[0],d[1],d[2]],viewRight:[g[0],g[1],g[2]]}}function Qy(t,e){if(!t.getActors()?.length)return;t.type!==Bt.ORTHOGRAPHIC&&console.warn("Viewport should be a volume viewport");let n=t.getCurrentImageId();if(n||(n=t.getImageIds()?.[0]),!n)return;const{imageOrientationPatient:r}=Pe("imagePlaneModule",n),i=Et(r[0],r[1],r[2]),a=Et(r[3],r[4],r[5]),o=zt(Ie(),i,a);let{orientation:s}=e||{};const{useViewportNormal:c}=e||{};let l=o;return c&&(l=t.getCamera().viewPlaneNormal),s||(s=oF(l)),Jy(i,a,o,s)}function oF(t){const e=Ht(Ie(),t),n=Et(oi.axial.viewPlaneNormal[0],oi.axial.viewPlaneNormal[1],oi.axial.viewPlaneNormal[2]),r=Et(oi.sagittal.viewPlaneNormal[0],oi.sagittal.viewPlaneNormal[1],oi.sagittal.viewPlaneNormal[2]),i=Et(oi.coronal.viewPlaneNormal[0],oi.coronal.viewPlaneNormal[1],oi.coronal.viewPlaneNormal[2]),a=Math.abs(He(e,n)),o=Math.abs(He(e,r)),s=Math.abs(He(e,i));return a>=o&&a>=s?to.AXIAL:o>=s?to.SAGITTAL:to.CORONAL}function e7(){return wa()?.rendering?.renderingEngineMode===vc.ContextPool}const sF=t=>!(typeof t=="number"&&Number.isFinite(t)),{vtkErrorMacro:Wu}=A;function cF(t,e){e.classHierarchy.push("vtkConvolution2DPass"),t.computeKernelWeight=function(r){const i=r.reduce((a,o)=>a+o);return i<=0?1:i},t.traverse=function(n){if(e.deleted)return;if(e.kernelDimension%2!==1){Wu("Invalid kernel dimension! Kernel dimension must be odd (e.g. 3, 5, 7, ...).");return}e.kernel===null&&(e.kernel=new Float32Array(e.kernelDimension),e.kernel[Math.floor(e.kernelDimension/2)]=1);const r=e.kernelDimension*e.kernelDimension;if(e.kernel.length!==r){Wu(`The given kernel is invalid. 2D convolution kernels have to be 1D arrays with ${r} components representing the ${e.kernelDimension}x${e.kernelDimension} kernel in row-major form.`);return}e.framebuffer===null&&(e.framebuffer=su.newInstance());const i=n.getSize(),a=n.getContext();if(a===null){e.delegates.forEach(c=>{c.traverse(n,t)});return}e.VBOBuildTime.getMTime()<t.getMTime()&&(e.tris.setOpenGLRenderWindow(n),t.buildVertexBuffer()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const o=e.framebuffer.getSize();if((o===null||o[0]!==i[0]||o[1]!==i[1])&&(e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),e.delegates.forEach(c=>{c.traverse(n,t)}),e.framebuffer.restorePreviousBindingsAndBuffers(),e.convolutionShader!==null&&e.oldKernelDimension!==e.kernelDimension&&(e.convolutionShader=null,e.oldKernelDimension=e.kernelDimension),e.convolutionShader===null){e.convolutionShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),t.getFragmentShaderCode(e.kernelDimension),"");const c=e.convolutionShader;e.copyVAO=zg.newInstance(),e.copyVAO.setOpenGLRenderWindow(n),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(c,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),a.FLOAT,3,a.FALSE)||Wu("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(c,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),a.FLOAT,2,a.FALSE)||Wu("Error setting vertexDC in copy shader VAO.")}else n.getShaderCache().readyShaderProgram(e.convolutionShader);a.viewport(0,0,i[0],i[1]),a.scissor(0,0,i[0],i[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.convolutionShader.setUniformi("u_image",s.getTextureUnit()),e.convolutionShader.setUniform2f("u_textureSize",s.getWidth(),s.getHeight()),e.convolutionShader.setUniformfv("u_kernel",e.kernel),e.convolutionShader.setUniformf("u_kernelWeight",t.computeKernelWeight(e.kernel)),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate()},t.getFragmentShaderCode=n=>{const r=n*n;let i=["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D u_image;","uniform vec2 u_textureSize;",`uniform float u_kernel[${r}];`,"uniform float u_kernelWeight;","varying vec2 tcoord;","void main(){","    vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;",`    vec4 colorSum =
`].join(`
`);const a=Math.floor(n/2);let o=0;for(let s=-a;s<=a;++s)for(let c=-a;c<=a;++c)i+=`        texture2D(u_image, tcoord + onePixel * vec2(${c}, ${s})) * u_kernel[${o}]`,++o,o!==r&&(i+=` +
`);return i+=[";","    gl_FragData[0] = vec4((colorSum / u_kernelWeight).rgb, texture2D(u_image, tcoord).a);","}"].join(`
`),i},t.buildVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),a=ot.newInstance({numberOfComponents:3,values:n});a.setName("points");const o=ot.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");const s=ot.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",gi.SURFACE,{points:a,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()}}const lF={framebuffer:null,convolutionShader:null,tris:null,kernel:[0,0,0,0,1,0,0,0,0],oldKernelDimension:3,kernelDimension:3};function t7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lF,n),Xg.extend(t,e,n),e.VBOBuildTime={},A.obj(e.VBOBuildTime,{mtime:0}),e.tris=To.newInstance(),A.setGet(t,e,["kernel","kernelDimension"]),A.get(t,e,["framebuffer"]),cF(t,e)}const uF=A.newInstance(t7,"vtkConvolution2DPass");var n7={newInstance:uF,extend:t7};function r7(t){let e=B2.newInstance();if(t>0){const n=n7.newInstance();n.setDelegates([e]);const r=Math.max(0,t);n.setKernelDimension(3),n.setKernel([-r,-r,-r,-r,1+8*r,-r,-r,-r,-r]),e=n}return e}function i7(t){let e=B2.newInstance();if(t>0){const n=n7.newInstance();n.setDelegates([e]);const r=Math.min(t,1e3),i=15,o=fF(i,5),s=i*i,c=Math.floor(s/2),l=Array(s).fill(0);l[c]=1;const f=Math.min(r/10,1),u=o.map((g,d)=>(1-f)*l[d]+f*g);n.setKernelDimension(15),n.setKernel(u),e=n}return e}function fF(t,e){const n=[],r=(t-1)/2;let i=0;for(let a=0;a<t;a++)for(let o=0;o<t;o++){const s=o-r,c=a-r,l=Math.exp(-(s*s+c*c)/(2*Math.pow(e,2)));n.push(l),i+=l}return n.map(a=>a/i)}class mi extends w0{constructor(e){if(super(e),this.useCPURendering=!1,this.sharpening=0,this.smoothing=0,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const a=this.getPan(this.fitToCanvasCamera),o=this.getPan(),s=this.getCamera(),c=eg([0,0],a,o);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),f=l?lo([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:f}),this.rotateCamera(i);const u=this.getPan(),g=this.getPan(this.fitToCanvasCamera),d=eg([0,0],u,g),p=m2([0,0],a,d);if(this.setPan(p,!1),this._suppressCameraModifiedEvents)return;const h=this.getCamera(),m={previousCamera:s,camera:h,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Oe(this.element,Ee.CAMERA_MODIFIED,m)},this.setSharpening=i=>{this.sharpening=i,this.render()},this.setSmoothing=i=>{this.smoothing=i,this.render()},this.getRenderPasses=()=>{if(!this.shouldUseCustomRenderPass())return null;const i=[];try{return this.smoothing>0&&i.push(i7(this.smoothing)),this.sharpening>0&&i.push(r7(this.sharpening)),i.length?i:null}catch(a){return console.warn("Failed to create custom render passes:",a),null}},this.getDefaultProperties=i=>{let a;return i!==void 0&&(a=this.perVolumeIdDefaultProperties.get(i)),a!==void 0?a:{...this.globalDefaultProperties}},this.getProperties=i=>{if(!this._getApplicableVolumeActor(i))return;const{colormap:o,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}=this.viewportProperties;if(i||=this.getVolumeId(),!Ve.getVolume(i))return null;const d=this.getActors().find(w=>w.referencedId===i);if(!d)return;const h=d.actor.getProperty().getRGBTransferFunction(0),[m,v]=this.viewportProperties?.VOILUTFunction==="SIGMOID"?Yy(h):h.getRange(),y={lower:m,upper:v},T=this.getColormap(i);return{colormap:i&&T?T:o,voiRange:y,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u,sharpening:this.sharpening,smoothing:this.smoothing}},this.getColormap=i=>{const a=this._getApplicableVolumeActor(i);if(!a)return;const{volumeActor:o}=a,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),l=c.reduce((d,p)=>(d.push(p.x,p.r,p.g,p.b),d),[]),f=T2(l,o)||{},u=w2(o),g=S2(o);return f.threshold=u,f.opacity=g,f},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:a,flipVertical:o}=this.getCameraNoRotation(),s=o?lo([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=m8(s,i)*180/Math.PI,l=zt([0,0,0],s,i);return He(l,a)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorldTiled=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),s=this.getVtkDisplayCoordsTiled(i),f=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().displayToWorld(s[0],s[1],s[2],o);return a.setIsPerformingCoordinateTransformation?.(!1),[f[0],f[1],f[2]]},this.canvasToWorldContextPool=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,f=c/l,[u,g,d,p]=o.getViewport(),h=d-u,m=p-g,v=[i[0]*s,i[1]*s],y=[u+v[0]/c*h,g+(1-v[1]/l)*m,0],T=o.normalizedDisplayToProjection(y[0],y[1],y[2]),C=o.projectionToView(T[0],T[1],T[2],f),w=o.viewToWorld(C[0],C[1],C[2]);return a.setIsPerformingCoordinateTransformation?.(!1),[w[0],w[1],w[2]]},this.getVtkDisplayCoordsTiled=i=>{const a=window.devicePixelRatio||1,o=[i[0]*a,i[1]*a],l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().getSize(),f=[o[0]+this.sx,o[1]+this.sy];return f[1]=l[1]-f[1],[f[0],f[1],0]},this.getVtkDisplayCoordsContextPool=i=>{const a=window.devicePixelRatio||1,o=[i[0]*a,i[1]*a],s=this.getRenderer(),{width:c,height:l}=this.canvas,[f,u,g,d]=s.getViewport(),p=g-f,h=d-u,m=o[0]/c*p*c,v=o[1]/l*h*l,y=[m,h*l-v];return[y[0],y[1],0]},this.worldToCanvasTiled=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...i,o);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy],g=window.devicePixelRatio||1,d=[u[0]/g,u[1]/g];return a.setIsPerformingCoordinateTransformation(!1),d},this.worldToCanvasContextPool=i=>{const a=this.getVtkActiveCamera();a.setIsPerformingCoordinateTransformation?.(!0);const o=this.getRenderer(),{width:s,height:c}=this.canvas,l=s/c,[f,u,g,d]=o.getViewport(),p=g-f,h=d-u,m=o.worldToView(i[0],i[1],i[2]),v=o.viewToProjection(m[0],m[1],m[2],l),y=o.projectionToNormalizedDisplay(v[0],v[1],v[2]),T=(y[0]-f)/p,C=(y[1]-u)/h,w=T*s,S=(1-C)*c,_=window.devicePixelRatio||1,D=[w/_,S/_];return a.setIsPerformingCoordinateTransformation(!1),D},this.hasImageURI=i=>this.getActors().filter(o=>Gr(o,"vtkVolume")).some(({uid:o,referencedId:s})=>{const c=Ve.getVolume(s||o);return c?.getImageIdIndex?c.getImageIdIndex(i)!==void 0||c.getImageURIIndex(i)!==void 0:!1}),this.getImageIds=i=>{const a=this._getApplicableVolumeActor(i);if(!a)throw new Error(`No actor found for the given volumeId: ${i}`);const o=a.volumeId,s=Ve.getVolume(o);if(!s)throw new Error(`imageVolume with id: ${o} does not exist in cache`);return s.imageIds},this.renderingPipelineFunctions={worldToCanvas:{tiled:this.worldToCanvasTiled,contextPool:this.worldToCanvasContextPool},canvasToWorld:{tiled:this.canvasToWorldTiled,contextPool:this.canvasToWorldContextPool},getVtkDisplayCoords:{tiled:this.getVtkDisplayCoordsTiled,contextPool:this.getVtkDisplayCoordsContextPool},getRenderer:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},this.useCPURendering=yl(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");this._configureRenderingPipeline();const n=this.getRenderer(),r=hA.newInstance();switch(n.setActiveCamera(r),this.type){case Bt.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case Bt.VOLUME_3D:r.setParallelProjection(!0);break;case Bt.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:i}=this._getOrientationVectors(e)||{};if(!r||!i)return;const a=this.getVtkActiveCamera();a.setDirectionOfProjection(-r[0],-r[1],-r[2]),a.setViewUpFrom(i),this.initialViewUp=i,n&&this.resetCamera({resetOrientation:!1,resetRotation:!1})}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=i.bind(this);function r(a){const{viewportId:o}=a.detail;o!==this.id||this.isDisabled||!this.getImageData()||JA(a)}function i(a){const{viewportId:o}=a.detail;o===this.id&&(this.element.removeEventListener(Ee.CAMERA_MODIFIED,e),Me.removeEventListener(Ee.ELEMENT_DISABLED,n),ZA(o))}this.element.removeEventListener(Ee.CAMERA_MODIFIED,e),this.element.addEventListener(Ee.CAMERA_MODIFIED,e),Me.addEventListener(Ee.ELEMENT_DISABLED,n)}setVOILUTFunction(e,n,r){Object.values(dr).includes(e)||(e=dr.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=po.newInstance();let s=Bl(e.name);const{name:c}=e;if(s||(s=kl.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const l=a.getProperty().getRGBTransferFunction(0).getRange();if(o.applyColorMap(s),o.setMappingRange(l[0],l[1]),a.getProperty().setRGBTransferFunction(0,o),this.viewportProperties.colormap=e,!r){const f=this.getColormap(n),u={viewportId:this.id,colormap:f,volumeId:n};Oe(this.element,Ee.VOI_MODIFIED,u),Oe(this.element,Ee.COLORMAP_MODIFIED,u)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r,a=Cc.newInstance();typeof e.opacity=="number"?E8(i,e.opacity):(e.opacity.forEach(({opacity:c,value:l})=>{a.addPoint(l,c)}),i.getProperty().setScalarOpacity(0,a)),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity;const o=this.getColormap(n),s={viewportId:this.id,colormap:o,volumeId:n};Oe(this.element,Ee.COLORMAP_MODIFIED,s)}setInvert(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const a=i.volumeId,o=this._getOrCreateColorTransferFunction(a);if(Cl(o),this.viewportProperties.invert=e,!r){const s={...this.getVOIModifiedEventDetail(a),invertStateChanged:!0};Oe(this.element,Ee.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const a=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),o=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:a[0],upper:a[1]},volumeId:n.volumeId,VOILUTFunction:s,colormap:o,invert:c}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,i=r.getProperty().getRGBTransferFunction(0);if(i)return i;const a=po.newInstance();return r.getProperty().setRGBTransferFunction(0,a),a}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");if([s.lower,s.upper].some(sF)){console.warn("VOI range contains invalid values, ignoring setVOI request",s);return}const{VOILUTFunction:c}=this.getProperties(o);if(c===dr.SAMPLED_SIGMOID){const l=x2(s);a.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:f}=s;a.getProperty().getRGBTransferFunction(0).setRange(l,f)}if(!r){const l={...this.getVOIModifiedEventDetail(o)};Oe(this.element,Ee.VOI_MODIFIED,l)}this.viewportProperties.voiRange=s}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if(e?.forFrameOfReference!==!1&&(n.volumeId=r),typeof e?.sliceIndex!="number")return n;const{viewPlaneNormal:i}=n,a=e?.sliceIndex-this.getSliceIndex(),{sliceRangeInfo:o}=o0(this,r,!0),{sliceRange:s,spacingInNormalDirection:c,camera:l}=o,{focalPoint:f,position:u}=l,{newFocalPoint:g}=s0(f,u,s,i,c,a);return n.cameraFocalPoint=g,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n?.withNavigation){const{referencedImageId:a}=e;return!a||this.hasImageURI(a)}const r=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=r&&r<=i[1]:i===void 0||i===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=o0(this,n,!0);if(!r)return;const{sliceRange:i,spacingInNormalDirection:a,camera:o}=r,{focalPoint:s,viewPlaneNormal:c,position:l}=o,{newFocalPoint:f,newPosition:u}=s0(s,l,i,c,a,e);this.setCamera({focalPoint:f,position:u}),this.render()}setBestOrentation(e,n){if(!e&&!n)return;const{viewPlaneNormal:r}=this.getCamera();if(Uc(r,n)&&Uc(r,e))return;const i=this._getAcquisitionPlaneOrientation();if(Uc(i.viewPlaneNormal,n)&&Uc(i.viewPlaneNormal,e)){this.setOrientation(i);return}for(const o of Object.values(oo))if(Uc(o.viewPlaneNormal,n)&&Uc(o.viewPlaneNormal,e)){this.setOrientation(o);return}const a=zt(Ie(),n||i.viewPlaneNormal,e);Ht(a,a),this.setOrientation({viewPlaneNormal:a})}setViewPlane(e){const{point:n,inPlaneVector1:r,inPlaneVector2:i,FrameOfReferenceUID:a}=e;this.setBestOrentation(r,i),this.setViewReference({FrameOfReferenceUID:a,cameraFocalPoint:n,viewPlaneNormal:this.getCamera().viewPlaneNormal})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{FrameOfReferenceUID:r,cameraFocalPoint:i,referencedImageId:a,planeRestriction:o,viewPlaneNormal:s,viewUp:c}=e;let{sliceIndex:l}=e;if(o&&!s)return this.setViewPlane(o);const{focalPoint:f,viewPlaneNormal:u,position:g}=this.getCamera(),d=S8(u,s),p=Wt(u,s);if(typeof l=="number"&&n!==void 0&&e.volumeId===n&&(d||p)){const{currentStepIndex:h,sliceRangeInfo:m,numScrollSteps:v}=o0(this,n,!0),{sliceRange:y,spacingInNormalDirection:T}=m;d&&(l=v-l-1);const C=l-h,{newFocalPoint:w,newPosition:S}=s0(f,g,y,u,T,C);this.setCamera({focalPoint:w,position:S})}else if(r===this.getFrameOfReferenceUID()){if(s&&!d&&!p){this.setOrientation({viewPlaneNormal:s,viewUp:c}),this.setViewReference(e);return}if(a&&this.isInAcquisitionPlane()){const h=Pe(Ur.IMAGE_PLANE,a),{imagePositionPatient:m}=h,{focalPoint:v}=this.getCamera(),y=_n(Ie(),v,m),T=He(y,u),C=Qn(Ie(),v,[-u[0],-u[1],-u[2]],T),w=_n(Ie(),C,v),S=co(Ie(),g,w);this.setCamera({focalPoint:C,position:S}),this.render();return}if(i){const h=_n([0,0,0],i,f),m=s??u,v=He(h,m);Wt(v,0)||zi(h,m,v);const y=co([0,0,0],f,h),T=co([0,0,0],g,h);this.setCamera({focalPoint:y,position:T})}}else throw new Error(`Incompatible view refs: ${r}!==${this.getFrameOfReferenceUID()}`)}setThreshold(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;O8(i,e.threshold),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.threshold=e.threshold;const a=this.getColormap(n),o={viewportId:this.id,colormap:a,volumeId:n};Oe(this.element,Ee.COLORMAP_MODIFIED,o)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,interpolationType:o,slabThickness:s,sampleDistanceMultiplier:c,sharpening:l,smoothing:f}={},u,g=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,slabThickness:s}),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,u,g),i?.name&&this.setColormap(i,u,g),i?.opacity!=null&&this.setOpacity(i,u),i?.threshold!=null&&this.setThreshold(i,u),e!==void 0&&this.setVOI(e,u,g),typeof o<"u"&&this.setInterpolationType(o),n!==void 0&&this.setVOILUTFunction(n,u,g),a!==void 0&&this.setPreset(a,u,g),s!==void 0&&this.setSlabThickness(s),c!==void 0&&this.setSampleDistanceMultiplier(c),typeof l<"u"&&this.setSharpening(l),typeof f<"u"&&this.setSmoothing(f)}shouldUseCustomRenderPass(){return!this.useCPURendering}resetToDefaultProperties(e){const n=this.globalDefaultProperties;n.colormap?.name&&this.setColormap(n.colormap,e),n.colormap?.opacity!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.sampleDistanceMultiplier!==void 0&&this.setSampleDistanceMultiplier(n.sampleDistanceMultiplier),n.preset!==void 0&&this.setPreset(n.preset,e,!1),this.render()}setPreset(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i;let o=e;typeof o=="string"&&(o=W4.find(s=>s.name===e)),o&&(Zy(a,o),this.viewportProperties.preset=o,this.render(),r||Oe(this.element,Ee.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:a,presetName:o.name}))}setSampleDistanceMultiplier(e){}async setVolumes(e,n=!1,r=!1){const i=e[0].volumeId,a=Ve.getVolume(i);if(!a)throw new Error(`imageVolume with id: ${i} does not exist, you need to create/allocate the volume first`);const o=a.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,o),this._FrameOfReferenceUID=o,e.forEach(c=>{this._addVolumeId(c.volumeId)});const s=[];for(let c=0;c<e.length;c++){const{volumeId:l,actorUID:f,slabThickness:u,...g}=e[c],d=await yh(e[c],this.element,this.id,r),p=f||nr();s.push({uid:p,actor:d,slabThickness:u,referencedId:l,...g})}this._setVolumeActors(s),this.viewportStatus=Or.PRE_RENDER,this.initializeColorTransferFunction(e),Oe(this.element,Ee.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:s}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const i=Ve.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(o=>{this._addVolumeId(o.volumeId)});for(let o=0;o<e.length;o++){const{volumeId:s,visibility:c,actorUID:l,slabThickness:f,...u}=e[o],g=await yh(e[o],this.element,this.id,r);c||g.setVisibility(!1);const d=l||nr();a.push({uid:d,actor:g,slabThickness:f,referencedId:s,...u})}this.addActors(a),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);!this.initialTransferFunctionNodes&&r&&(this.initialTransferFunctionNodes=tg(r))}_getApplicableVolumeActor(e){const n=this.getActors();if(!n?.length)return;if(e){const i=n.find(a=>a.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const r=n[0];return{volumeActor:r.actor,volumeId:r.referencedId,actorUID:r.uid}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let i=1;i<r;i++){const a=Ve.getVolume(e[i].volumeId);if(n!==a.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const n of this.volumeIds)if(n.includes(e))return!0;return!1}getImageData(e){if(!this.getDefaultActor())return;e||=this.getVolumeId();const r=this.getActors()?.find(s=>s.referencedId===e);if(!Gr(r,"vtkVolume"))return;const i=r.actor,a=Ve.getVolume(e),o=i.getMapper().getInputData();return{dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:a?.metadata?.Modality,FrameOfReferenceUID:a?.metadata?.FrameOfReferenceUID},get scalarData(){return a?.voxelManager?.getScalarData()},scaling:a?.scaling,hasPixelSpacing:!0,voxelManager:a?.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,n){super.setCamera(e,n),this.setCameraClippingRange()}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getViewUp(e){const{viewUp:n}=this.getCamera(),r=He(n,e);if(Wt(r,0))return n;if(df(e[0],1))return[0,0,1];if(df(e[1],1))return[0,0,1];if(df(e[2],1))return[0,-1,0];const i=Qn(Ie(),n,e,-r);return Ht(i,i),i}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal)return{...e,viewUp:e.viewUp||this._getViewUp(e.viewPlaneNormal)};throw new Error("Invalid orientation object. It must contain viewPlaneNormal")}else if(typeof e=="string"){if(e==="acquisition")return this._getAcquisitionPlaneOrientation();if(e==="reformat"||e.includes("_reformat"))return Qy(this,{useViewportNormal:!0});if(oo[e])return this.viewportProperties.orientation=e,oo[e]}throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(oo).join(", ")}`)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const n=this.getVolumeId(),r=Ve.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:i}=r,a=i.slice(6,9).map(s=>-s),o=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:a,viewUp:o}}getSlabThickness(){const e=this.getActors();let n=dn.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!Gr(n,"vtkVolume"))return;const{actor:r}=n,i=r.getMapper().getInputData(),a=Ve.getVolume(this.getVolumeId()),o=y0(i,e);return a.voxelManager.getAtIJKPoint(o)}getVolumeId(e){const n=this.getActors();if(!n)return;if(!e?.volumeId){const i=n.find(a=>a.actor.getClassName()==="vtkVolume");return i?.referencedId||i?.uid}const r=n.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===e?.volumeId);return r?.referencedId||r?.uid}getViewReferenceId(e={}){let{volumeId:n,sliceIndex:r}=e;if(!n){const l=this.getActors();if(!l)return;n=l.find(f=>f.actor.getClassName()==="vtkVolume")?.referencedId}const i=this.getSliceIndex();r??=i;const{viewPlaneNormal:a,focalPoint:o}=this.getCamera(),s=n.includes("?")?"&":"?",c=a.map(l=>l.toFixed(3)).join(",");return`volumeId:${n}${s}sliceIndex=${r}&viewPlaneNormal=${c}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}_configureRenderingPipeline(){const e=e7();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const r=this.renderingPipelineFunctions[n];this[n]=e?r.contextPool:r.tiled}}}function Uc(t,e){return!e||Wt(He(t,e),0)}function gF(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(A.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),Tc())}const dF={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1],colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024};function hF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dF,n),z2.extend(t,e,n),A.setGet(t,e,["slice","useCustomExtents","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),A.setGetArray(t,e,["customDisplayExtent"],6),A.setGetArray(t,e,["backgroundColor"],4),gF(t,e)}var pF={extend:hF};function a7(t,e,n){const r=n.getCurrentImage(),i=r.getExtent(),a=[i[0],i[2],i[4]],{ijkMode:o}=n.getClosestIJKAxis();let s=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();o!==n.getSlicingMode()&&(s=n.getSliceAtPosition(s)),a[o]+=s;const c=[0,0,0];r.indexToWorld(a,c),a[o]+=1;const l=[0,0,0];r.indexToWorld(a,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],Ht(l,l);const f=tr.intersectWithLine(t,e,c,l);if(f.intersection){const u=f.x,g=[0,0,0];return r.worldToIndex(u,g),{t:f.t,absoluteIJK:g}}return null}function mF(t,e,n){const r=a7(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return o[0]<a[0]||o[0]>a[1]||o[1]<a[2]||o[1]>a[3]||o[2]<a[4]||o[2]>a[5]?null:{t:r.t,ijk:o}}return null}function vF(t,e,n){const r=a7(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=r.absoluteIJK,s=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])];if(s[0]<a[0]||s[0]>a[1]-1||s[1]<a[2]||s[1]>a[3]-1||s[2]<a[4]||s[2]>(a[5]?a[5]-1:a[5]))return null;const c=[o[0]-s[0],o[1]-s[1],o[2]-s[2]];return{t:r.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:yF,otherStaticMethods:TF}=jg,{SlicingMode:Dt}=Kg;function CF(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const i=t.getCurrentImage();let a;if(r.length===3)a=r;else if(Number.isFinite(r)){const f=i.getBounds();switch(e.slicingMode){case Dt.X:a=[r,(f[3]+f[2])/2,(f[5]+f[4])/2];break;case Dt.Y:a=[(f[1]+f[0])/2,r,(f[5]+f[4])/2];break;case Dt.Z:a=[(f[1]+f[0])/2,(f[3]+f[2])/2,r];break}}const o=[0,0,0];i.worldToIndex(a,o);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case Dt.I:l=Wi(o[0],s[0],s[1]);break;case Dt.J:l=Wi(o[1],s[2],s[3]);break;case Dt.K:l=Wi(o[2],s[4],s[5]);break;default:return 0}return l},t.setSliceFromCamera=r=>{const i=r.getFocalPoint();switch(e.slicingMode){case Dt.I:case Dt.J:case Dt.K:{const a=t.getSliceAtPosition(i);t.setSlice(a)}break;case Dt.X:t.setSlice(i[0]);break;case Dt.Y:t.setSlice(i[1]);break;case Dt.Z:t.setSlice(i[2]);break}},t.setXSlice=r=>{t.setSlicingMode(Dt.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(Dt.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(Dt.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(Dt.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(Dt.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(Dt.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case Dt.X:r[0]=1;break;case Dt.Y:r[1]=1;break;case Dt.Z:r[2]=1;break;case Dt.I:lf(i,[1,0,0],r);break;case Dt.J:lf(i,[0,1,0],r);break;case Dt.K:lf(i,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case Dt.X:r=0;break;case Dt.Y:r=1;break;case Dt.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),a=Kv(i);let o=0;for(;o<3&&a[r+3*o]===0;++o);const s=a[r+3*o]<0;e.closestIJKAxis={ijkMode:o,flip:s}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Dt.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return Tc();if(!e.useCustomExtents)return r.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:a}=t.getClosestIJKAxis();let o=e.slice;switch(a!==e.slicingMode&&(o=t.getSliceAtPosition(e.slice)),a){case Dt.I:i[0]=o,i[1]=o;break;case Dt.J:i[2]=o,i[3]=o;break;case Dt.K:i[4]=o,i[5]=o;break}return r.extentToBounds(i)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getCurrentImage();if(!a)return Tc();const o=a.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=r;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(r)),s){case Dt.I:o[0]=c-i,o[1]=c+i;break;case Dt.J:o[2]=c-i,o[3]=c+i;break;case Dt.K:o[4]=c-i,o[5]=c+i;break}return a.extentToBounds(o)},t.intersectWithLineForPointPicking=(r,i)=>mF(r,i,t),t.intersectWithLineForCellPicking=(r,i)=>vF(r,i,t),t.getCurrentImage=()=>t.getInputData()}const wF={slicingMode:Dt.NONE,closestIJKAxis:{ijkMode:Dt.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function o7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wF,n),pF.extend(t,e,n),A.get(t,e,["slicingMode"]),A.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),jg.implementCoincidentTopologyMethods(t,e),CF(t,e)}const SF=A.newInstance(o7,"vtkImageMapper");var xF={newInstance:SF,extend:o7,...yF,...TF,...Kg};const{InterpolationType:xf}=N_,{vtkErrorMacro:Km}=A,Ef=4;function EF(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let i=0;i<Ef;i++)e.componentData[i].rGBTransferFunction&&(r=e.componentData[i].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[i].piecewiseFunction&&(r=e.componentData[i].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].rGBTransferFunction!==a?(e.componentData[i].rGBTransferFunction=a,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].piecewiseFunction!==a?(e.componentData[i].piecewiseFunction=a,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),t.setPiecewiseFunction(i,a)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=Ef)return Km("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==i?(e.componentData[n].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=Ef?(Km("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(xf.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(xf.LINEAR),t.getInterpolationTypeAsString=()=>A.enumToString(xf,e.interpolationType)}const OF=t=>({independentComponents:!1,interpolationType:xf.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,updatedExtents:[],...t});function RF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,OF(n)),A.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<Ef;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}A.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity","updatedExtents"]),A.setGetArray(t,e,["labelOutlineThickness"]),EF(t,e)}const DF=A.newInstance(RF,"vtkImageProperty");var MF={newInstance:DF};function _F(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let n=e.properties[0].getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=MF.newInstance,t.getBoundsForSlice=(n,r)=>{const i=e.mapper.getBoundsForSlice(n,r);if(!xt.isValid(i))return i;t.computeMatrix();const a=new Float64Array(16);return bt(a,e.matrix),xt.transformBounds(i,a)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return e.properties.forEach(r=>{n=Math.max(n,r.getMTime());const i=r.getRGBTransferFunction();i!==null&&(n=Math.max(n,i.getMTime()))}),n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const IF={mapper:null,forceOpaque:!1,forceTranslucent:!1};function s7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IF,n),L2.extend(t,e,n),e.boundsMTime={},A.obj(e.boundsMTime),A.setGet(t,e,["mapper","forceOpaque","forceTranslucent"]),_F(t,e)}const bF=A.newInstance(s7,"vtkImageSlice");var LF={newInstance:bF,extend:s7};function VF(t){return Object.values(dr).includes(t)?t:dr.LINEAR}function c7(t){const n={...Pe(Ur.IMAGE_PLANE,t)};return n.columnPixelSpacing||(n.columnPixelSpacing=1),n.rowPixelSpacing||(n.rowPixelSpacing=1),n.columnCosines||(n.columnCosines=[0,1,0]),n.rowCosines||(n.rowCosines=[1,0,0]),n.imagePositionPatient||(n.imagePositionPatient=[0,0,0]),n.imageOrientationPatient||(n.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),n}function l7(t){const e=t.imageId,{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=Pe("imagePixelModule",e),{windowWidth:c,windowCenter:l,voiLUTFunction:f}=t,{modality:u}=Pe("generalSeriesModule",e),g=Pe("scalingModule",e),d=Pe(Ur.CALIBRATION,e),p=VF(f),h=c7(e);return{calibration:d,scalingFactor:g,voiLUTFunction:p,modality:u,imagePlaneModule:h,imagePixelModule:{bitsAllocated:r,bitsStored:i,samplesPerPixel:s,highBit:a,photometricInterpretation:o,pixelRepresentation:n,windowWidth:c,windowCenter:l,modality:u,voiLUTFunction:p}}}function u7(t){const{imagePlaneModule:e,imagePixelModule:n,voiLUTFunction:r,modality:i,scalingFactor:a,calibration:o}=l7(t);let{rowCosines:s,columnCosines:c}=e;(s==null||c==null)&&(s=[1,0,0],c=[0,1,0]);const l=Et(s[0],s[1],s[2]),f=Et(c[0],c[1],c[2]),u=Ie();zt(u,l,f);let g=e.imagePositionPatient;g==null&&(g=[0,0,0]);const d=e.columnPixelSpacing||t.columnPixelSpacing,p=e.rowPixelSpacing||t.rowPixelSpacing,h=t.columns,m=t.rows,v=Ii,y=1;return!n.photometricInterpretation&&t.sizeInBytes===3*t.width*t.height&&(t.numberOfComponents=3),{numberOfComponents:t.numberOfComponents||PF(n.photometricInterpretation),origin:g,direction:[...l,...f,...u],dimensions:[h,m,y],spacing:[d,p,v],numVoxels:h*m*y,imagePlaneModule:e,imagePixelModule:n,bitsAllocated:n.bitsAllocated,voiLUTFunction:r,modality:i,scalingFactor:a,calibration:o,scanAxisNormal:u}}function PF(t){let e=1;return(t==="RGB"||t?.includes("YBR")||t==="PALETTE COLOR")&&(e=3),e}var Of={exports:{}},NF=Of.exports,qm;function AF(){return qm||(qm=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(NF,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],a={},o=null;function s(h,m){var v=h[m];if(typeof v.bind=="function")return v.bind(h);try{return Function.prototype.bind.call(v,h)}catch{return function(){return Function.prototype.apply.apply(v,[h,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(h){return h==="debug"&&(h="log"),typeof console===n?!1:h==="trace"&&r?c:console[h]!==void 0?s(console,h):console.log!==void 0?s(console,"log"):e}function f(){for(var h=this.getLevel(),m=0;m<i.length;m++){var v=i[m];this[v]=m<h?e:this.methodFactory(v,h,this.name)}if(this.log=this.debug,typeof console===n&&h<this.levels.SILENT)return"No console available for logging"}function u(h){return function(){typeof console!==n&&(f.call(this),this[h].apply(this,arguments))}}function g(h,m,v){return l(h)||u.apply(this,arguments)}function d(h,m){var v=this,y,T,C,w="loglevel";typeof h=="string"?w+=":"+h:typeof h=="symbol"&&(w=void 0);function S(F){var B=(i[F]||"silent").toUpperCase();if(!(typeof window===n||!w)){try{window.localStorage[w]=B;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+B+";"}catch{}}}function _(){var F;if(!(typeof window===n||!w)){try{F=window.localStorage[w]}catch{}if(typeof F===n)try{var B=window.document.cookie,k=encodeURIComponent(w),U=B.indexOf(k+"=");U!==-1&&(F=/^([^;]+)/.exec(B.slice(U+k.length+1))[1])}catch{}return v.levels[F]===void 0&&(F=void 0),F}}function D(){if(!(typeof window===n||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(F){var B=F;if(typeof B=="string"&&v.levels[B.toUpperCase()]!==void 0&&(B=v.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=v.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+F)}v.name=h,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=m||g,v.getLevel=function(){return C??T??y},v.setLevel=function(F,B){return C=N(F),B!==!1&&S(C),f.call(v)},v.setDefaultLevel=function(F){T=N(F),_()||v.setLevel(F,!1)},v.resetLevel=function(){C=null,D(),f.call(v)},v.enableAll=function(F){v.setLevel(v.levels.TRACE,F)},v.disableAll=function(F){v.setLevel(v.levels.SILENT,F)},v.rebuild=function(){if(o!==v&&(y=N(o.getLevel())),f.call(v),o===v)for(var F in a)a[F].rebuild()},y=N(o?o.getLevel():"WARN");var P=_();P!=null&&(C=N(P)),f.call(v)}o=new d,o.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var v=a[m];return v||(v=a[m]=new d(m,o.methodFactory)),v};var p=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=p),o},o.getLoggers=function(){return a},o.default=o,o})})(Of)),Of.exports}var FF=AF();const UF=ji(FF),f7=UF.noConflict();typeof window<"u"&&(window.log=f7);function n1(t){const e=f7.getLogger(t[0]);return e.getLogger=(...n)=>n1(`${t}.${n.join(".")}`),e}function Q2(...t){return n1(t.join("."))}const A0=n1("cs3d"),ep=A0.getLogger("core"),kF=A0.getLogger("tools"),GF=A0.getLogger("dicomImageLoader"),BF=A0.getLogger("ai"),$F=A0.getLogger("examples"),WF=Q2("consistency","dicom"),zF=Q2("consistency","image"),HF=Object.freeze(Object.defineProperty({__proto__:null,aiLog:BF,coreLog:ep,cs3dLog:A0,dicomConsistencyLog:WF,examplesLog:$F,getLogger:Q2,getRootLogger:n1,imageConsistencyLog:zF,loaderLog:GF,toolsLog:kF},Symbol.toStringTag,{value:"Module"}));function g7(t){const e=po.newInstance();let n=0,r=1024;return t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function r1(t,e){const n=e.voxelManager.getScalarData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let a=0;a<e.columns*e.rows;a++)i[a*3]=n[a*4],i[a*3+1]=n[a*4+1],i[a*3+2]=n[a*4+2];e.rgba=!1,e.getPixelData=()=>i,r.set(i)}else r.set(n);t.modified()}function mt(){return window.performance?performance.now():Date.now()}function jF(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function KF(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,i=t.lut[t.lut.length-1]>>n,a=t.firstValueMapped+t.lut.length-1;return function(o){return o<t.firstValueMapped?r:o>=a?i:t.lut[o-t.firstValueMapped]>>n}}function d7(t,e,n){return n?KF(n):jF(t,e)}function qF(t,e,n,r,i){const a=t.maxPixelValue,o=t.minPixelValue,s=Math.min(o,0);if(t.cachedLut===void 0){const f=a-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const c=t.cachedLut.lutArray,l=d7(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,i);if(r)for(let f=o;f<=a;f++)c[f+-s]=255-l(f);else for(let f=o;f<=a;f++)c[f+-s]=l(f);return c}function XF(t,e,n){let r=mt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=mt()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=mt(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=255;else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-r}function YF(t,e,n){let r=mt();const i=t.getPixelData();t.stats.lastGetPixelDataTime=mt()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=mt(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=i[s++];else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-r}class F0{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new F0;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],a=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.m[0]*n+this.m[2]*r,a=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,s=this.m[1]*-r+this.m[3]*n;this.m[0]=i,this.m[1]=a,this.m[2]=o,this.m[3]=s}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function zl(t,e){const n=new F0;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let i=t.viewport.scale,a=t.viewport.scale;const o=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(a*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,a=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*a),l=t.canvas.width/(o*i);i=a=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(a*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(i,a),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-o/2,-s/2),n}function tp(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=zl(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function np(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function gg(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=i}function rp(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}const h7="viewport-element",p7="cornerstone-canvas",Xm=1e-4;function i1(t,e=512,n=512){const r=document.createElement("canvas");return t&&(r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style.imageRendering="pixelated",r.classList.add(p7),t.appendChild(r)),r}function ZF(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(h7),t.appendChild(e),e}function _i(t){const e=`canvas.${p7}`,n=`div.${h7}`,r=t.querySelector(n)||ZF(t),i=r.querySelector(e);if(i)return i;const a=i1(r),o=r.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(o.width*s),l=Math.ceil(o.height*s);return a.width=c,a.height=l,a}function JF(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(qF(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function QF(t,e,n){const r=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=i1(null,e.width,e.height));const i=t.renderingTools.renderCanvas,{windowWidth:a,windowCenter:o}=t.viewport.voi;if((a===256||a===255)&&(o===128||o===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!np(t,e)&&!n)return i;(!t.renderingTools.renderCanvasContext||i.width!==e.width||i.height!==e.height)&&gg(t,e);let s=mt();const c=JF(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=mt()-s;const l=t.renderingTools.renderCanvasData,f=t.renderingTools.renderCanvasContext;return e.rgba?YF(e,c,l.data):XF(e,c,l.data),s=mt(),f.putImageData(l,0,0),e.stats.lastPutImageDataTime=mt()-s,i}function eU(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,tp(t,r);const i=QF(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=rp(t)}function tU(t,e,n){let r=mt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=mt()-r;const a=i.length,o=t.minPixelValue;let s=3,c=0;if(r=mt(),i instanceof Int16Array)if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<a;)n[s]=e[i[c++]],s+=4;else if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-r}function nU(t,e,n){let r=mt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=mt()-r;const a=i.length;let o=3,s=0;for(r=mt();s<a;)n[o]=e(i[s++]),o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-r}function rU(t,e,n){let r=mt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=mt()-r;const a=i.length,o=t.minPixelValue;let s=0,c=0,l;if(r=mt(),i instanceof Int16Array)if(o<0)for(;c<a;)l=e[i[c++]+-o],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else if(i instanceof Uint16Array)for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else if(o<0)for(;c<a;)l=e[i[c++]+-o],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-r}function iU(t,e){if(aU(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,i=n-r,a=(n+r)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:a,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=a)}function aU(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function Ym(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function oU(t,e){return n=>n*t+e}function sU(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=r?n:t.lut[i]}function cU(t,e,n){return n?sU(n):oU(t,e)}function lU(t,e,n,r,i,a){const o=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const g=o-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(g)}const l=t.cachedLut.lutArray,f=cU(t.slope,t.intercept,i),u=d7(e,n,a);if(t.isPreScaled)if(r)for(let g=s;g<=o;g++)l[g+-c]=255-u(g);else for(let g=s;g<=o;g++)l[g+-c]=u(g);else if(r)for(let g=s;g<=o;g++)l[g+-c]=255-u(f(g));else for(let g=s;g<=o;g++)l[g+-c]=u(f(g));return l}function m7(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&Ym(t.cachedLut.modalityLUT,e.modalityLUT)&&Ym(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!n||(iU(e,t),lU(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function uU(t,e,n,r=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=i1(null,e.width,e.height),gg(t,e));const a=t.renderingTools.renderCanvas;if(!np(t,e)&&!n)return a;(a.width!==e.width||a.height!==e.height)&&gg(t,e),e.stats=e.stats||{};const o=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=mt();e.stats.lastLutGenerateTime=mt()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:f,windowCenter:u}=l.voi,g=u-f/2,h=255/(u+f/2-g);let m;l.invert?m=v=>255-(v-g)*h:m=v=>(v-g)*h,nU(e,m,o.data)}else{const f=m7(e,l,n);r?tU(e,f,o.data):rU(e,f,o.data)}return c=mt(),s.putImageData(o,0,0),e.stats.lastPutImageDataTime=mt()-c,a}function fU(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,tp(t,r);const i=uU(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=rp(t)}const Ch=0,wh=1,gU=2;function dU(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(t*6),a=6*t-i,o=n*(1-e),s=n*(1-e*a),c=n*(1-e*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=c,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=c;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=c,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s;break}return r}function hU(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+Ch+1.5:t>e.Range[1]?n=e.MaxIndex+wh+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class ip{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,i,a,o;n?(r=(this.HueRange[1]-this.HueRange[0])/n,i=(this.SaturationRange[1]-this.SaturationRange[0])/n,a=(this.ValueRange[1]-this.ValueRange[0])/n,o=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=i=a=o=0;for(let s=0;s<=n;s++){const c=this.HueRange[0]+s*r,l=this.SaturationRange[0]+s*i,f=this.ValueRange[0]+s*a,u=this.AlphaRange[0]+s*o,g=dU(c,l,f),d=[0,0,0,0];switch(this.Ramp){case"scurve":d[0]=Math.floor(127.5*(1+Math.cos((1-g[0])*Math.PI))),d[1]=Math.floor(127.5*(1+Math.cos((1-g[1])*Math.PI))),d[2]=Math.floor(127.5*(1+Math.cos((1-g[2])*Math.PI))),d[3]=Math.floor(u*255);break;case"linear":d[0]=Math.floor(g[0]*255+.5),d[1]=Math.floor(g[1]*255+.5),d[2]=Math.floor(g[2]*255+.5),d[3]=Math.floor(u*255+.5);break;case"sqrt":d[0]=Math.floor(Math.sqrt(g[0])*255+.5),d[1]=Math.floor(Math.sqrt(g[1])*255+.5),d[2]=Math.floor(Math.sqrt(g[2])*255+.5),d[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(d)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+Ch,r=e+wh,i=e+gU;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=hU(e,n);return r===this.NumberOfColors+Ch?r=0:r===this.NumberOfColors+wh&&(r=this.NumberOfColors-1),r}setTableValue(e,n,r,i,a){let o;if(typeof n=="number"&&r!==void 0&&i!==void 0&&a!==void 0)o=[n,r,i,a];else if(Array.isArray(n))o=n;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=o,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const Zm=[0,0,0,0];function pU(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),i=[];for(;n-- >0;)i.push(t),t+=r;return i[i.length-1]=e,i}function mU(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=n+Math.floor((r-n)/2),a=t[i];if(a===e)return i;e<a?r=i-1:n=i+1}return n}function vU(t,e){let n;const r=[],i=e.length;for(t.sort(function(a,o){return a-o}),n=0;n<i;n++)r[n]=mU(t,e[n]);return r}function ud(t,e,n){let r;const i=[],a=[],o=[],s=[];for(n=n===null?1:n,r=0;r<e.length;r++){const f=e[r];i.push((t-1)*f[0]),a.push(f[1]),o.push(f[1])}const c=pU(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const l=vU(i,c);for(r=1;r<t-1;r++){const f=l[r],u=(c[r]-i[f-1])/(i[f]-i[f-1]),g=a[f]-o[f-1];s[r]=u*g+o[f-1]}return s[0]=o[0],s[t-1]=a[e.length-1],s}function yU(t,e,n){let r;const i=[];e=e===null?256:e,n=n===null?1:n;const a=ud(e,t.red,n),o=ud(e,t.green,n),s=ud(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(a[r]*255),l=Math.round(o[r]*255),f=Math.round(s[r]*255),u=[c,l,f,255];i.push(u)}return i}function TU(t,e){let n=qd[t];return n||(n=qd[t]={name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=yU(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(i){n.name=i},getNumberOfColors(){return n.colors.length},setNumberOfColors(i){for(;n.colors.length<i;)n.colors.push(Zm);n.colors.length=i},getColor(i){return this.isValidIndex(i)?n.colors[i]:Zm},getColorRepeating(i){const a=n.colors.length;return i=a?i%a:0,this.getColor(i)},setColor(i,a){this.isValidIndex(i)&&(n.colors[i]=a)},addColor(i){n.colors.push(i)},insertColor(i,a){this.isValidIndex(i)&&n.colors.splice(i,1,a)},removeColor(i){this.isValidIndex(i)&&n.colors.splice(i,1)},clearColors(){n.colors=[]},buildLookupTable(i){if(!i)return;const a=n.colors.length;i.setNumberOfTableValues(a);for(let o=0;o<a;o++)i.setTableValue(o,n.colors[o])},createLookupTable(){const i=new ip;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<n.colors.length}}}function CU(t,e,n,r){let i=mt();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=mt()-i;const o=a.length,s=t.minPixelValue;let c=0,l=0,f,u,g;if(i=mt(),n instanceof ip?g=n.Table:g=n,s<0)for(;l<o;)f=e[a[l++]+-s],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<o;)f=e[a[l++]],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-i}function wU(t,e,n,r){let i=mt();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=mt()-i;const o=a.length,s=t.minPixelValue;let c=0,l=0,f,u,g;if(i=mt(),n instanceof ip?g=n.Table:g=n,s<0)for(;l<o;)f=e(a[l++]+-s),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<o;)f=e(a[l++]),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=mt()-i}function Sh(t,e,n){return Math.max(e,Math.min(n,t))}function SU(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=i1(null,e.width,e.height));const r=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=TU(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const a=i.getId();if(!np(t,e)&&!n&&t.renderingTools.colormapId===a)return r;(!t.renderingTools.renderCanvasContext||r.width!==e.width||r.height!==e.height)&&gg(t,e);let o=mt();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==a)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=a);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,f=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:g}=l.voi,d=g-u/2,m=255/(g+u/2-d);let v;l.invert?v=y=>Sh(Math.floor(255-(y-d)*m),0,255):v=y=>Sh(Math.floor((y-d)*m),0,255),wU(e,v,f,s.data)}else{const u=m7(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=mt()-o,CU(e,u,f,s.data)}return o=mt(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=mt()-o,r}function xU(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,tp(t,r);const i=SU(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=rp(t)}function v7(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=mt();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let a=n.render;a||(t.viewport.colormap?a=xU:n.color?a=eU:a=fU),a(t,e)}const i=mt()-r;n.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function y7(t){return zl(t)}function zu(t,e){const n=y7(t);return n.invert(),n.transformPoint(e)}const EU={viewport:{}};function OU(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function RU(){const t=OU(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:dr.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,EU.viewport)}function El(t,e){if(t==null)throw new Error(e)}function DU(t){return!(t==null||t===0||t===180)}function T7(t,e=null){return El(t,"getImageSize: parameter image must not be undefined"),El(t.width,"getImageSize: parameter image must have width"),El(t.height,"getImageSize: parameter image must have height"),DU(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function ap(t,e,n=null){El(t,"getImageScale: parameter canvas must not be undefined"),El(e,"getImageScale: parameter image must not be undefined");const r=T7(e,n),i=e.rowPixelSpacing||1,a=e.columnPixelSpacing||1;let o=1,s=1;i<a?s=a/i:o=i/a;const c=t.height/r.height/o,l=t.width/r.width/s;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function C7(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return RU();const i=ap(t,e,0).scaleFactor;let a;return n==="PT"&&e.isPreScaled?a={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(a={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:a,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function Jm(t,e){return y7(t).transformPoint(e)}function MU(t){const{image:e}=t;t.viewport.scale=ap(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function _U(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function IU(t,e,n){const r=t.viewport.scale,i=T7(t.image,t.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r),s=t.viewport.translation.x,c=t.viewport.translation.y;return a===e&&o<=n||a<=e&&o===n&&s===0&&c===0}function bU(t,e,n){const r=t.viewport.scale,i=t.canvas.width,a=t.canvas.height,o=i/e,s=a/n,c=Math.sqrt(o*s);t.viewport.scale=c*r}function LU(t,e=!1){const n=t.canvas.width,r=t.canvas.height;_U(t),t.image!==void 0&&(e||IU(t,n,r)?MU(t):bU(t,n,r))}function VU(t,e){const{hflip:n,vflip:r,rotation:i}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,i!==0){const a=i*Math.PI/180,o=Math.cos(a),s=Math.sin(a),c=t.x*o-t.y*s,l=t.x*s+t.y*o;t.x=c,t.y=l}return t}function PU(t,e=!0,n=!0){const{canvas:r,image:i,viewport:a}=t,o=ap(r,i,0).scaleFactor;a.vflip=!1,a.hflip=!1,e&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=i.columns,a.displayedArea.brhc.y=i.rows,a.scale=o)}const Qm=ep.getLogger("utilities","getClosestImageId");function Hl(t,e,n,r){const{direction:i,spacing:a,imageIds:o}=t,{ignoreSpacing:s=!1}=r||{};if(!o?.length)return;const c=i.slice(6,9),l=He(c,n);if(Math.abs(l)<1-Ii)return;let f;s||(f=uu({direction:i,spacing:a},n)/2);let u,g=1/0;for(let d=0;d<o.length;d++){const p=o[d],h=Pe("imagePlaneModule",p);if(!h?.imagePositionPatient){Qm.warn(`Missing imagePositionPatient for imageId: ${p}`);continue}const{imagePositionPatient:m}=h,v=Ie();Ut(v,e,m);const y=Math.abs(He(v,n));s?y<g&&(g=y,u=p):y<f&&y<g&&(g=y,u=p)}return u===void 0&&Qm.warn("No imageId found within the specified criteria (half spacing or absolute closest)."),u}function NU(t,e){const n=He(t,e),r=zi(Ie(),e,2*n);return Ut(Ie(),t,r)}function e3(t,e,n,r){let i=d8(t);if(n&&lo(i,i),e){const a=zt(Ie(),r,i);Ht(a,a),i=NU(i,a)}return i}const t3=ep.getLogger("RenderingEngine","StackViewport");class Jr extends w0{constructor(e){super(e),this.imageIds=[],this.imageKeyToIndexMap=new Map,this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.sharpening=0,this.smoothing=0,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.setSharpening=n=>{this.sharpening=n,this.render()},this.setSmoothing=n=>{this.smoothing=n,this.render()},this.getRenderPasses=()=>{if(!this.shouldUseCustomRenderPass())return null;const n=[];try{return this.smoothing>0&&n.push(i7(this.smoothing)),this.sharpening>0&&n.push(r7(this.sharpening)),n.length?n:null}catch(r){return console.warn("Failed to create custom render passes:",r),null}},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&LU(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>this.getImagePlaneReferenceData(n)?.FrameOfReferenceUID,this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=xF.newInstance();r.setInputData(n);const i=LF.newInstance();return i.setMapper(r),n.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,voiUpdatedWithSetProperties:s}=this;return{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,isComputedVOI:!s,sharpening:this.sharpening,smoothing:this.smoothing}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:i,flipHorizontal:a}=this.getCameraNoRotation(),o=e3(this.initialViewUp,a,i,r),c=m8(o,n)*180/Math.PI,l=zt(Ie(),o,n);return He(l,r)>=0?c:(360-c)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),a={previousCamera:r,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Oe(this.element,Ee.CAMERA_MODIFIED,a)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{n.isPreScaled=n.preScale?.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,a]=zu(this._cpuFallbackEnabledElement,n),{origin:o,spacing:s,direction:c}=this.getImageData(),l=c.slice(0,3),f=c.slice(3,6);return Qn(r,o,l,i*s[0]),Qn(r,r,f,a*s[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:i,origin:a}=this.getImageData(),o=i.slice(0,3),s=i.slice(3,6),c=_n(Ie(),n,a),l=[He(c,o)/r[0],He(c,s)/r[1]];return Jm(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPUContextPool=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,f=c/l,u=[n[0]*s,n[1]*s],g=r.getViewport(),[d,p,h,m]=g,v=h-d,y=m-p,T=[d+u[0]/c*v,p+(1-u[1]/l)*y,0],C=r.normalizedDisplayToProjection(T[0],T[1],T[2]),w=r.projectionToView(C[0],C[1],C[2],f),S=r.viewToWorld(w[0],w[1],w[2]);return i.setClippingRange(a[0],a[1]),[S[0],S[1],S[2]]},this.canvasToWorldGPUTiled=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[n[0]*f,n[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const d=c.displayToWorld(g[0],g[1],0,r);return i.setClippingRange(a[0],a[1]),[d[0],d[1],d[2]]},this.worldToCanvasGPUContextPool=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,f=c/l,u=r.worldToView(n[0],n[1],n[2]),g=r.viewToProjection(u[0],u[1],u[2],f),d=r.projectionToNormalizedDisplay(g[0],g[1],g[2]),p=r.getViewport(),[h,m,v,y]=p,T=v-h,C=y-m,w=(d[0]-h)/T*c,S=(1-(d[1]-m)/C)*l;return i.setClippingRange(a[0],a[1]),[w/s,S/s]},this.worldToCanvasGPUTiled=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...n,r);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy];i.setClippingRange(a[0],a[1]);const g=window.devicePixelRatio||1;return[u[0]/g,u[1]/g]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=(n=this.getCurrentImageIdIndex())=>this.imageIds[n],this.hasImageId=n=>this.imageKeyToIndexMap.has(n),this.hasImageURI=n=>this.imageKeyToIndexMap.has(n),this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(v7(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraCPU({resetPan:r,resetZoom:i}),!0},gpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraGPU({resetPan:r,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:{tiled:this.canvasToWorldGPUTiled,contextPool:this.canvasToWorldGPUContextPool}},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:{tiled:this.worldToCanvasGPUTiled,contextPool:this.worldToCanvasGPUContextPool}},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=yl(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return yl()}_configureRenderingPipeline(e){const n=e7();this.useCPURendering=e??yl();for(const r in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,r)){const i=this.renderingPipelineFunctions[r];this.useCPURendering?this[r]=i.cpu:typeof i.gpu=="object"&&i.gpu.tiled&&i.gpu.contextPool?this[r]=n?i.gpu.contextPool:i.gpu.tiled:this[r]=i.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new F0,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=H2.newInstance();e.setActiveCamera(n),this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-0,-0,1),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}shouldUseCustomRenderPass(){return!this.useCPURendering}initializeElementDisabledHandler(){Me.addEventListener(Ee.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),Me.removeEventListener(Ee.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!Mi(e))return;const{actor:n}=e,r=n.getMapper().getInputData(),i=this.csImage;return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),get scalarData(){return i?.voxelManager.getScalarData()},imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i?.calibration,...this.calibration},preScale:{...i?.preScale},voxelManager:i?.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const n=e.spacing,r=this.csImage;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:i=>{const a=this.worldToCanvasCPU(i),o=zu(this._cpuFallbackEnabledElement,a);return[o[0],o[1],0]},indexToWorld:(i,a)=>{const o=Jm(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(o,a)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...r?.calibration,...this.calibration},preScale:{...r?.preScale},voxelManager:r?.voxelManager}}calibrateIfNecessary(e,n){const r=Pe("calibratedPixelSpacing",e),i=this.calibration!==r,a=r?.scale;return this.hasPixelSpacing=a>0||!n.usingDefaultValues&&n.rowPixelSpacing>0,n.calibration=r,i&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:a,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a,sharpening:o,smoothing:s}={},c=!1){this.viewportStatus=this.csImage?Or.PRE_RENDER:Or.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??n,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??r,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??a,sharpening:this.globalDefaultProperties.sharpening??o,smoothing:this.globalDefaultProperties.smoothing??s},typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:c,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,c),typeof i<"u"&&this.setInvertColor(i),typeof a<"u"&&this.setInterpolationType(a),typeof o<"u"&&this.setSharpening(o),typeof s<"u"&&this.setSmoothing(s)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=Or.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;if(this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(ao.LINEAR),!this.useCPURendering){const n=this.getTransferFunction();Gg(n,this.initialTransferFunctionNodes);const i=tg(n).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),a=this.getDefaultActor(),o=T2(i,a.actor);this.setColormap(o)}}resetToDefaultProperties(){this.cpuRenderingInvalidated=!0,this.viewportStatus=Or.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;n.colormap?.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.setInterpolationType(ao.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:n,invert:r}=this;this.setVOI(e),this.setInterpolationType(n),this.setInvertColor(r)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:r}=e,i=r.slice(6,9).map(u=>-u);let a=r.slice(3,6).map(u=>-u);if(n.rotation){const u=h2(pi(),n.rotation*Math.PI/180,i);a=At(Ie(),a,u)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(o),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),f=v0(c,l)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:f,scale:n.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[a[0],a[1],a[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:a,parallelScale:o,scale:s,flipHorizontal:c,flipVertical:l}=e,{clientHeight:f}=this.element;if(a){const g=this.worldToCanvasCPU(a),d=zu(this._cpuFallbackEnabledElement,g),p=this.worldToCanvasCPU(i.focalPoint),h=zu(this._cpuFallbackEnabledElement,p),m=un();gr(m,H5(d[0],d[1]),H5(h[0],h[1]));const v=VU({x:m[0],y:m[1]},n);n.translation.x-=v.x,n.translation.y-=v.y}if(o){const{rowPixelSpacing:g}=r,d=f*g*.5/o;n.scale=d,n.parallelScale=o}if(s){const{rowPixelSpacing:g}=r;n.scale=s,n.parallelScale=f*g*.5/s}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=zl(this._cpuFallbackEnabledElement);const u={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Oe(this.element,Ee.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation?.x??0,e.translation?.y??0]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==r&&(i=!0),this.VOILUTFunction=r;const{voiRange:a}=this.getProperties();this.setVOI(a,{suppressEvents:n,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),i=eg([0,0],n,r);this.setPan(i,!1);const{flipVertical:a,flipHorizontal:o,viewPlaneNormal:s}=this.getCamera(),c=e3(this.initialViewUp,o,a,s);this.setCameraNoEvent({viewUp:c}),this.getVtkActiveCamera().roll(-e);const l=this.getPan(),f=this.getPan(this.fitToCanvasCamera),u=eg([0,0],l,f),g=m2([0,0],n,u);this.setPan(g,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!Mi(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==ao.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&Mi(n)){if(Gr(n,"vtkVolume")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Cl(i),this.invert=e}else if(Gr(n,"vtkImageSlice")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Cl(i),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:i,image:a}=this._cpuFallbackEnabledElement;if(!i||!a)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=a,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:f,voiLUTFunction:a.voiLUTFunction};const{lower:u,upper:g}=a0(l,f,a.voiLUTFunction);e={lower:u,upper:g}}else{const{lower:s,upper:c}=e,{windowCenter:l,windowWidth:f}=iu(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:a.voiLUTFunction}),i.voi.windowWidth=f,i.voi.windowCenter=l}this.voiRange=e;const o={viewportId:this.id,range:e};r||Oe(this.element,Ee.VOI_MODIFIED,o)}getTransferFunction(){const e=this.getDefaultActor();return!e||!Mi(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:a=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const o=this.getDefaultActor();if(!o||!Mi(o))return;const s=o.actor;let c=e;if(typeof c>"u"){const d=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:d[0],upper:d[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let l=s.getProperty().getRGBTransferFunction(0);const f=this.VOILUTFunction===dr.SAMPLED_SIGMOID;if((f||!l||i)&&(l=(f?x2:g7)(c),this.invert&&Cl(l),s.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=tg(l)),f||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=a),r)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};Oe(this.element,Ee.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),this.scaling.PT=a}getImageDataMetadata(e){const n=e.imageId,r=u7(e),{numberOfComponents:i,origin:a,direction:o,dimensions:s,spacing:c,numVoxels:l,imagePixelModule:f,voiLUTFunction:u,modality:g,scalingFactor:d,calibration:p}=r;g==="PT"&&d&&this._addScalingToViewport(d),this.modality=g;const h=this._getValidVOILUTFunction(u);this.VOILUTFunction=h,this.calibration=p;let m=this._getImagePlaneModule(n);return this.useCPURendering||(m=this.calibrateIfNecessary(n,m)),{bitsAllocated:f.bitsAllocated,numberOfComponents:i,origin:a,direction:o,dimensions:s,spacing:c,numVoxels:l,imagePlaneModule:m,imagePixelModule:f}}matchImagesForOverlay(e,n){return(i=>{const a=Pe(Ur.IMAGE_PLANE,n),o=Pe(Ur.IMAGE_PLANE,i),s=a.imageOrientationPatient,c=o.imageOrientationPatient;if(s&&c){if(Wt(a.imageOrientationPatient,o.imageOrientationPatient)){const f=a.imagePositionPatient,u=o.imagePositionPatient;if(f&&u&&Wt(f,u)){const d=a.rows,p=a.columns,h=o.rows,m=o.columns;if(d===h&&p===m)return i}}}else{const l=a.rows,f=a.columns,u=o.rows,g=o.columns;if(l===u&&f===g)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=Pe(Ur.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:i,frameOfReferenceUID:a}=r;let{rowCosines:o,columnCosines:s}=r;o||=[1,0,0],s||=[0,1,0];const c=zt([0,0,0],s,o);return{FrameOfReferenceUID:a,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(i=>-i),r=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){const s=new o.constructor(o.length),c=ot.newInstance({name:"Pixels",numberOfComponents:a,values:s}),l=qg.newInstance();return l.setDimensions(r),l.setSpacing(i),l.setDirection(n),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){try{this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o})}catch(s){t3.error(s)}}async setStack(e,n=0){if(this._throwIfDestroyed(),this.imageIds=e,n>e.length)throw new Error("Current image index is greater than the number of images in the stack");this.imageKeyToIndexMap.clear(),e.forEach((o,s)=>{this.imageKeyToIndexMap.set(o,s),this.imageKeyToIndexMap.set(hr(o),s)}),this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=Pe(C0.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||Gy)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=ao.LINEAR,this.invert=!1,this.viewportStatus=Or.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return Oe(this.element,Ee.VIEWPORT_NEW_IMAGE_SET,a),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,i]=n.getSpacing(),[a,o]=n.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=n.getDirection(),l=c.slice(0,3),f=c.slice(3,6),u=n.getPointData().getScalars().getDataType(),g=Wt(r,e.columnPixelSpacing),d=Wt(i,e.rowPixelSpacing),p=g||e.columnPixelSpacing===null&&r===1,h=d||e.rowPixelSpacing===null&&i===1,m=a===e.columns,v=o===e.rows,y=Wt(s.rowCosines,l),T=Wt(s.columnCosines,f),C=u===e.voxelManager.getScalarData().constructor.name;return p&&h&&m&&v&&y&&T&&C}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r);const i=this.getActor(this.id);i&&(i.referencedId=e.imageId),r1(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,i)=>{function a(d,p,h){if(this.currentImageIdIndex!==p)return;const m=d.voxelManager.getScalarData(),v=d.preScale,y=v?.scalingParameters,T=v?.scaled&&y?.rescaleIntercept%1!==0||y?.rescaleSlope%1!==0;if(m instanceof Float32Array&&T){const w={min:d.minPixelValue,max:d.maxPixelValue},D=Math.abs(w.max-w.min)/65535,N=w.min,P=m.length,F=new Uint16Array(P);let B=65535,k=0;for(let U=0;U<P;U++){const H=Math.floor((m[U]-N)/D);F[U]=H,B=Math.min(B,H),k=Math.max(k,H)}d.minPixelValue=B,d.maxPixelValue=k,d.slope=D,d.intercept=N,d.voxelManager?d.voxelManager.getScalarData=()=>F:d.getPixelData=()=>F,d.preScale={...d.preScale,scaled:!1}}this._setCSImage(d),this.viewportStatus=Or.PRE_RENDER;const C={image:d,imageId:h,imageIdIndex:p,viewportId:this.id,renderingEngineId:this.renderingEngineId};Oe(this.element,Ee.STACK_NEW_IMAGE,C),this._updateToDisplayImageCPU(d),this.render(),this.currentImageIdIndex=p,r(h)}function o(d,p,h){const m={error:d,imageIdIndex:p,imageId:h};this.suppressEvents||Oe(Me,Ee.IMAGE_LOAD_ERROR,m),i(d)}function s(d,p,h){return T0(d,h).then(m=>{a.call(this,m,p,d)},m=>{o.call(this,m,p,d)})}const c=-5,l=gt.Interaction,f={imageId:e,imageIdIndex:n},u={useRGBA:!0,requestType:l},g={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};Oe(this.element,Ee.PRE_STACK_NEW_IMAGE,g),Ea.addRequest(s.bind(this,e,n,u),l,f,c)})}successCallback(e,n){const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const i=this.csImage?.imageFrame,a=n?.imageFrame,o=i?.photometricInterpretation||this.csImage?.photometricInterpretation,s=a?.photometricInterpretation||n?.photometricInterpretation;o!==s&&(this.stackInvalidated=!0),this._setCSImage(n);const c={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),Oe(this.element,Ee.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const i=this.imageIds.indexOf(e),a={error:r,imageIdIndex:i,imageId:e};Oe(Me,Ee.IMAGE_LOAD_ERROR,a)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=Pe("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:r,priority:5,requestType:gt.Interaction,additionalDetails:{imageId:e,imageIdIndex:n}}}async loadImages(e,n){const r=await Promise.allSettled(e.map(a=>{const o=this.getLoaderImageOptions(a);return T0(a,o).then(s=>(n.successCallback(a,s),a),s=>(n.errorCallback(a,!0,s),a))})),i=r.filter(a=>a.status==="rejected");if(i&&i.length){const a=new CustomEvent(Ee.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});Me.dispatchEvent(a)}return r}_loadAndDisplayImageGPU(e,n){if(!e){console.warn("No image id set yet to load");return}const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Oe(this.element,Ee.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(()=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=C7(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:a,voiLUTFunction:o}=r.voi;this.voiRange=a0(a,i,o),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=zl(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const n=[];e.forEach(r=>{const{imageId:i,...a}=r,o=Ve.getImage(i),{origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u}=this.getImageDataMetadata(o),g=this.createVTKImageData({origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u,pixelArray:o.voxelManager.getScalarData()}),d=this.createActorMapper(g);d&&(n.push({uid:r.actorUID??nr(),actor:d,referencedId:i,...a}),r.callback&&r.callback({imageActor:d,imageId:r.imageId}))}),this.addActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getViewPresentation();if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(r),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),f=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),g=this.getActors();g.length&&g[0].uid===this.id?g[0].actor=u:g.unshift({uid:this.id,actor:u,referencedId:e.imageId}),this.setActors(g);const{viewPlaneNormal:d,viewUp:p}=this._getCameraOrientation(a),h=this.getCamera();this.setCameraNoEvent({viewUp:p,viewPlaneNormal:d}),this.initialViewUp=p,this.resetCameraNoEvent(),this.setViewPresentation(r),this.triggerCameraEvent(this.getCamera(),h);const m=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const v=this._getInitialVOIRange(e);this.setVOI(v,{forceRecreateLUTFunction:!!m}),this.initialInvert=!!m,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.voiRange;const{windowCenter:n,windowWidth:r,voiLUTFunction:i}=e;let a=this._getVOIRangeFromWindowLevel(r,n,i);return a=this._getPTPreScaledRange()||a,a}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){return!(this.modality!=="PT"||!this.csImage.isPreScaled||!this.csImage.preScale?.scalingParameters.suvbw)}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n,r=dr.LINEAR){let i,a;if(typeof n=="number"&&typeof e=="number"?(i=n,a=e):Array.isArray(n)&&Array.isArray(e)&&(i=n[0],a=e[0]),i!==void 0&&a!==void 0)return a0(a,i,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=Or.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU({resetPan:e=!0,resetZoom:n=!0}){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;PU(this._cpuFallbackEnabledElement,e,n);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:a,clientHeight:o}=this.element,s=[a/2,o/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:n}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:!0})}scroll(e,n=!0,r=!1){const i=this.imageIds;if(isNaN(this.targetImageIdIndex))return;const a=this.targetImageIdIndex,o=i.length;let s=a+e;r?s=(s+o)%o:s=Math.max(0,Math.min(o-1,s)),this.targetImageIdIndex=s;const c=i[s];Ve.isLoaded(c)||!n?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const f={newImageIdIndex:s,imageId:c,direction:e};s!==a&&Oe(this.element,Ee.STACK_VIEWPORT_SCROLL,f)}setImageIdIndex(e){if(this._throwIfDestroyed(),this.currentImageIdIndex===e)return Promise.resolve(this.getCurrentImageId());const n=this._setImageIdIndex(e);return this.targetImageIdIndex=e,n}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Oe(this.element,Ee.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Oe(this.element,Ee.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}jumpToWorld(e){const n=this.getImageIds(),r=this.getImageData(),{direction:i,spacing:a}=r,o=Hl({direction:i,spacing:a,imageIds:n},e,this.getCamera().viewPlaneNormal,{ignoreSpacing:!0}),s=n.indexOf(o);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n,voiLUTFunction:r}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e,r)}_getValidVOILUTFunction(e){return Object.values(dr).includes(e)?e:dr.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:n}=this.getImageData();return{width:n[0],height:n[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,n={}){const r=this.getCurrentImageIdIndex(),i=this.imageIds[r];if(!i||!e)return!1;const{referencedImageId:a,multiSliceReference:o}=e;if(a){if(a===i)return!0;e.referencedImageURI||=hr(a);const{referencedImageURI:c}=e,l=this.imageKeyToIndexMap.get(c);if(n.asOverlay&&this.matchImagesForOverlay(i,a))return!0;if(l===void 0)return!1;if(n.withNavigation)return!0;const f=o&&this.imageKeyToIndexMap.get(o.referencedImageId);return r<=f&&r>=l}if(!super.isReferenceViewable(e,{...n,withOrientation:n?.asVolume}))return!1;if(e.volumeId||e.FrameOfReferenceUID)return n.asVolume;const{cameraFocalPoint:s}=e;if(n.asNearbyProjection&&s){const{spacing:c,direction:l,origin:f}=this.getImageData(),u=l.slice(6,9),g=uu({direction:l,spacing:c},u),d=_n(Ie(),s,f),p=He(d,u),h=g/2;if(Math.abs(p)<=h)return!0}return!1}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),i=this.getCurrentImageId(n);if(i){if(r.referencedImageId=i,this.getCurrentImageIdIndex()!==n){const a=this.getImagePlaneReferenceData(n);if(!a)return;Object.assign(r,a)}return r}}setViewReference(e){if(!e?.referencedImageId){e?.sliceIndex!==void 0&&this.scroll(e.sliceIndex-this.targetImageIdIndex);return}const{referencedImageId:n}=e;e.referencedImageURI||=hr(n);const{referencedImageURI:r}=e,i=this.imageKeyToIndexMap.get(r);if(i===void 0){t3.error(`No image URI found for ${r}`);return}this.scroll(i-this.targetImageIdIndex)}getViewReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;return`imageId:${this.imageIds[n]}`}getSliceIndexForImage(e){if(e){if(typeof e=="string")return this.imageKeyToIndexMap.get(e);if(e.referencedImageId)return this.imageKeyToIndexMap.get(e.referencedImageId)}}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=Bl(e.name);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};Oe(this.element,Ee.COLORMAP_MODIFIED,r)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),a=i.getRGBTransferFunction(),o=Bl(e.name)||kl.getPresetByName(e.name);if(a)a.applyColorMap(o),a.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,a);else{const c=po.newInstance();c.applyColorMap(o),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};Oe(this.element,Ee.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){const n=c7(e);return this.hasPixelSpacing=!n.usingDefaultValues||this.calibration?.scale>0||this.calibration?.rowPixelSpacing>0,this.calibration||=n.calibration,n}isInAcquisitionPlane(){return!0}}function es(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return y0(n,r)}function dg(t,e){return t.indexToWorld(e)}function AU(t,e){const{imageData:n}=t.getImageData(),r=dg(n,e);return t.worldToCanvas(r)}class Br extends mi{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=fg(this)||{};return r},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(r,i=!0)=>{const{currentStepIndex:a}=o0(this,r||this.getVolumeId(),i);return a},this.getSliceIndex=()=>{const{imageIndex:r}=fg(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!Gr(r,"vtkVolume"))return;const i=Ve.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:a,focalPoint:o}=this.getCamera();return Hl(i,o,a)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!r?.actor)return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),a=Ve.getVolume(i),o=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:l}=o,f=uu(a,l),u=t1(r.actor,l,s),g=Math.round((u.current-u.min)/f),d=Math.round((u.max-u.current)/f),p=this.getSliceIndex(),h=[];for(let m=-g;m<=d;m++){const{newFocalPoint:v}=s0(s,c,u,l,f,m);h.push({sliceIndex:p+m,point:v})}return h};const{orientation:n}=this.options;if(n&&n!==os.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const i=e[0].volumeId,a=Ve.getVolume(i);if(!a)throw new Error(`imageVolume with id: ${i} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(a),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,a),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const i=Ve.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,i),super.addVolumes(e,n,r)}jumpToWorld(e){const{focalPoint:n}=this.getCamera(),r=[0,0,0];Ut(r,e,n);const i=this.getCamera(),a=i.viewPlaneNormal,o=He(r,a),s=Et(a[0],a[1],a[2]);if(zi(s,s,o),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],l=[0,0,0];co(c,i.focalPoint,s),co(l,i.position,s),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,n=!0){let r,i;if(typeof e=="string"){if(e===os.ACQUISITION)({viewPlaneNormal:r,viewUp:i}=super._getAcquisitionPlaneOrientation());else if(e===os.REFORMAT||e.includes("_reformat"))({viewPlaneNormal:r,viewUp:i}=Qy(this,{useViewportNormal:!0}));else if(oo[e])({viewPlaneNormal:r,viewUp:i}=oo[e]);else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:i}=e),this.applyViewOrientation(e);n&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-dn.MAXIMUM_RAY_DISTANCE,dn.MAXIMUM_RAY_DISTANCE):e.setClippingRange(dn.MINIMUM_SLAB_THICKNESS,dn.MAXIMUM_RAY_DISTANCE)}_setViewPlaneToReformatOrientation(e,n){let r,i;if(n){const{direction:a}=n;({viewPlaneNormal:r,viewUp:i}=Jy(a.slice(0,3),a.slice(3,6),a.slice(6,9),e))}else({viewPlaneNormal:r,viewUp:i}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:r,viewUp:i}),this.initialViewUp=i,this.resetCamera()}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:i}=e;n=i.slice(6,9).map(a=>-a),r=i.slice(3,6).map(a=>-a)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}getBlendMode(e){const n=this.getActors(),r=e?.length>0?n.find(i=>e.includes(i.uid)):n[0];return r?.blendMode||r?.actor.getMapper().getBlendMode()}setBlendMode(e,n=[],r=!1){let i=this.getActors();n?.length>0&&(i=i.filter(a=>n.includes(a.uid))),i.forEach(a=>{const{actor:o}=a;o.getMapper().setBlendMode?.(e),a.blendMode=e}),r&&this.render()}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetRotation:i=!0,resetToCenter:a=!0,suppressEvents:o=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:n,resetZoom:r,resetToCenter:a});const l=this.getVtkActiveCamera(),f=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(d=>{if(!d.actor)return;const p=d.actor.getMapper();if(p.getClippingPlanes().length===0&&!d?.clippingFilter){const m=tr.newInstance(),v=tr.newInstance(),y=[m,v];let T=dn.MINIMUM_SLAB_THICKNESS;d.slabThickness&&(T=d.slabThickness),this.setOrientationOfClippingPlanes(y,T,f,u),p.addClippingPlane(m),p.addClippingPlane(v)}}),i&&oo[this.viewportProperties.orientation]!==void 0){const d=oo[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:d.viewUp,viewPlaneNormal:d.viewPlaneNormal})}if(!o){const d={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Oe(this.element,Ee.CAMERA_RESET,d)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();n?.length>0&&(r=r.filter(a=>n.includes(a.uid))),r.forEach(a=>{Gr(a,"vtkVolume")&&(a.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{Gr(r,"vtkVolume")&&(r.slabThickness=dn.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}isInAcquisitionPlane(){const e=this.getImageData();if(!e)return!1;const{direction:n}=e,{viewPlaneNormal:r}=this.getCamera(),i=[n[6],n[7],n[8]];return Math.abs(He(r,i))>.99}getSliceViewInfo(){const{width:e,height:n}=this.getCanvas(),r=es(this,[0,0]),i=es(this,[e-1,0]),a=es(this,[0,n-1]),o=Ut(Ie(),i,r),s=Ut(Ie(),a,r),c=zt(Ie(),o,s);Ht(o,o),Ht(s,s),Ht(c,c);const{dimensions:l}=this.getImageData(),[f,u,g]=l,h=[[0,0,0],[f-1,0,0],[0,u-1,0],[f-1,u-1,0],[0,0,g-1],[f-1,0,g-1],[0,u-1,g-1],[f-1,u-1,g-1]].map(P=>AU(this,P)).reduce((P,F)=>(P.minX=Math.min(P.minX,F[0]),P.minY=Math.min(P.minY,F[1]),P.maxX=Math.max(P.maxX,F[0]),P.maxY=Math.max(P.maxY,F[1]),P),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),m=es(this,[h.minX,h.minY]),v=a8(o[0],o[1],o[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,m[0],m[1],m[2],1),y=es(this,[h.maxX,h.maxY]),T=Ut(Ie(),y,m),C=In(pi(),v),{viewPlaneNormal:w}=this.getCamera();if(w.filter(P=>Math.abs(P)>Ii).length>1)throw new Error("getSliceInfo is not supported for oblique views");const _=w.findIndex(P=>Math.abs(P)>1-Ii);if(_===-1)throw new Error("Unable to determine slice axis");const D=He(o,T)+1,N=He(s,T)+1;return{sliceIndex:this.getSliceIndex(),width:D,height:N,slicePlane:_,sliceToIndexMatrix:v,indexToSliceMatrix:C}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const n=super.getViewReference(e);if(!n?.volumeId)return;const r=Ve.getVolume(n.volumeId);return n.referencedImageId=Hl(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=dn.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const r=Ve.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(Z2(n.actor,r),Mi(n)){const l=n.actor.getProperty().getRGBTransferFunction(0);Gg(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),Oe(this.element,Ee.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=dn.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:a})=>{const o=[tr.newInstance(),tr.newInstance()];return this.setOrientationOfClippingPlanes(o,r,n,i),{sliceIndex:a,planes:o.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}class op extends mi{constructor(e){super(e),this.setSampleDistanceMultiplier=a=>{this.getActors().forEach(s=>{if(Gr(s,"vtkVolume")){const l=s.actor.getMapper();if(l&&l.getInputData){const f=l.getInputData();if(f){const u=f.getSpacing();let p=(u[0]+u[1]+u[2])/6*(a||1);p!==void 0&&l.setSampleDistance&&(l.getSampleDistance(),l.setSampleDistance(p))}}}}),this.render()},this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:n,orientation:r}=this.options,i=this.getVtkActiveCamera();n!=null&&i.setParallelProjection(n),r&&r!==os.ACQUISITION&&this.applyViewOrientation(r)}isInAcquisitionPlane(){return!1}resetCamera({resetPan:e=!0,resetZoom:n=!0,resetToCenter:r=!0}={}){super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:r});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-dn.MAXIMUM_RAY_DISTANCE,dn.MAXIMUM_RAY_DISTANCE):i.setClippingRange(dn.MINIMUM_SLAB_THICKNESS,dn.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=dn.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const r=Ve.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(Z2(n.actor,r),Mi(n)){const i=n.actor.getProperty().getRGBTransferFunction(0);Gg(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),Oe(this.element,Ee.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-dn.MAXIMUM_RAY_DISTANCE,dn.MAXIMUM_RAY_DISTANCE):e.setClippingRange(dn.MINIMUM_SLAB_THICKNESS,dn.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}async function FU(t,e,n,r=!1,i=!1){n.forEach(o=>{const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof mi))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async o=>{await t.getViewport(o).setVolumes(e,r,i)});await Promise.all(a)}async function UU(t,e,n,r=!1,i=!1){for(const o of n){const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof mi)){console.warn(`Viewport with Id ${o} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const a=n.map(async o=>{await t.getViewport(o).addVolumes(e,r,i)});await Promise.all(a)}function kU(t,e,n){for(const r of n){const i=t.getViewport(r);if(!i)throw new Error(`Viewport with Id ${r} does not exist`);if(!i.addImages){console.warn(`Viewport with Id ${r} does not have addImages. Cannot add image segmentation to this viewport.`);return}}n.forEach(r=>{t.getViewport(r).addImages(e)})}class GU{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),i=n.getGreenValue(e),a=n.getBlueValue(e);return[r,i,a,this.opacity]}}class BU{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class $U{constructor(e,n){this.canvasProperties=new GU(this),this.visibility=!1,this.mapper=new BU(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:i,height:a}=this.image;let{canvas:o}=this;(!o||o.width!==i||o.height!==a)&&(this.canvas=o=new window.OffscreenCanvas(i,a));const s=o.getContext("2d"),c=s.createImageData(i,a),{data:l}=c;l.fill(0);const{map:f}=r;let u=1/0,g=1/0,d=-1/0,p=-1/0;for(let v=0;v<a;v++){const y=f.getRun(v,0);if(!y)continue;g=Math.min(g,v),p=Math.max(p,v);const T=v*i<<2;let C;for(const w of y){const{start:S,end:_,value:D}=w;if(D===0){C||=[],C.push(y.indexOf(w));continue}u=Math.min(u,S),d=Math.max(d,_);const N=this.canvasProperties.getColor(D).map(F=>F*255);let P=T+(S<<2);for(let F=S;F<_;F++)l[P++]=N[0],l[P++]=N[1],l[P++]=N[2],l[P++]=N[3]}}if(u>i)return;const h=d-u,m=p-g;s.putImageData(c,0,0,u-1,g-1,h+2,m+2),n.drawImage(o,u,g,h,m,u,g,h,m)}setMapper(e){this.mapper=e}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:i,height:a}=r,o=r.getScalarData();if(!o)return;const{voxelManager:s}=r;if(s&&s.map.getRun){this.renderRLE(e,n,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==a)&&(this.canvas=c=new window.OffscreenCanvas(i,a));const l=c.getContext("2d"),f=l.createImageData(i,a),{data:u}=f;let g=0,d=0,p=1/0,h=1/0,m=-1/0,v=-1/0;for(let C=0;C<a;C++)for(let w=0;w<i;w++){const S=o[g++];if(S){p=Math.min(w,p),h=Math.min(C,h),m=Math.max(w,m),v=Math.max(C,v);const _=this.canvasProperties.getColor(S);u[d]=_[0]*255,u[d+1]=_[1]*255,u[d+2]=_[2]*255,u[d+3]=127}d+=4}if(p>i)return;const y=m-p+1,T=v-h+1;l.putImageData(f,0,0,p,h,y,T),n.drawImage(c,p,h,y,T,p,h,y,T)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>this.derivedImage?.getPixelData(),getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}const Xp=class Xp{static imageIdToFrames(e){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const r=n[2].split("-").map(i=>Number(i));return r.length===1?r[0]:r}static imageIdToFrameEnd(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[1]:n}static imageIdToFrameStart(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,n){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const i=this.framesToString(n);return e.replace(this.frameRangeExtractor,`${r[1]}${i}`)}};Xp.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let c0=Xp;const Ll=class Ll extends w0{constructor(e){super({...e,canvas:e.canvas||_i(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:i}=n;(n.width!==r||n.height!==i)&&(n.width=r,n.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const i=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio(),o=[i[0]*a,i[1]*a],s=[n[0]-o[0],n[1]-o[1]];return r.splice(0,2,s[0]/a,s[1]/a),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(n[0]+r[0])*i,(n[1]+r[1])*i]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(i=>i*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const n=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),a=this.canvasContext;a.resetTransform(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.transform(i[0]/n,i[1]/n,i[2]/n,i[3]/n,i[4]/n,i[5]/n),a.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const s of this.getActors())s.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Oe(this.element,Ee.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Oe(this.element,Ee.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const o=this.getFrameNumber();this.isPlaying&&(o<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):o>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(Ee.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(Ee.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=Pe(Ur.IMAGE_PLANE,n);let i=r.rowCosines,a=r.columnCosines;(r.usingDefaultValues||i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const s=Et(i[0],i[1],i[2]),c=Et(a[0],a[1],a[2]),{rows:l,columns:f}=r,u=Ie();zt(u,s,c);let g=r.imagePositionPatient;g==null&&(g=[0,0,0]);const d=r.columnPixelSpacing||1,p=r.rowPixelSpacing||1,h=r.columns,m=r.rows,v=1,y=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:g,rows:l,columns:f,direction:[...s,...c,...u],dimensions:[h,m,y],spacing:[d,p,v],hasPixelSpacing:this.hasPixelSpacing,numVoxels:h*m*y,imagePlaneModule:r}}setDataIds(e,n){this.setVideo(e[0],(n.viewReference?.sliceIndex||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=Pe(Ur.IMAGE_URL,e);if(!r?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=r,a=Pe(Ur.GENERAL_SERIES,e);this.modality=a?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:o,numberOfFrames:s}=Pe(Ur.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(o||30))),o||(o=Math.round(s/this.videoElement.duration)),this.fps=o,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(n||1),c(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,a=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=a;const o=s=>{r(),n.removeEventListener("seeked",o)};n.addEventListener("seeked",o)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const i=a=>{r(),n.removeEventListener("seeked",i)};n.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getSliceIndexForImage(e){if(e){if(typeof e=="string")return c0.imageIdToFrameStart(e);if(e.referencedImageId)return c0.imageIdToFrameStart(e.referencedImageId)}}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=Al.FRAME){this.scrollSpeed=n===Al.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0,voiRange:{lower:0,upper:255}})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const a=new Uint8ClampedArray;return a.getRange=()=>[0,255],a.frameNumber=-1,a}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const i=n.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,n=e.spacing,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const o=this.worldToCanvas(a),s=this.canvasToIndex(o);return[s[0],s[1],0]},indexToWorld:(a,o)=>{const s=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(s,o)}},i={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,o)=>N9(o.imageData,{pointInShapeFn:o.isInObject??(()=>!0),callback:a,boundsIJK:o.boundsIJK,returnPoints:o.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const n=e.match(Ll.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.includes(r)}setVOI(e){this.voiRange=e;const n=this.setColorTransform(e,this.averageWhite);this.canvas.style.filter=n}setWindowLevel(e=256,n=128){const r=n-e/2,i=n+e/2-1;this.setVOI({lower:r,upper:i}),this.setColorTransform({lower:r,upper:i},this.averageWhite)}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const i=this.worldToCanvas(r),a=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(i[0]-a[0])/this.videoCamera.parallelScale,(i[1]-a[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(e=this.getCurrentImageIdIndex()){return this.imageId?.replace("/frames/1",`/frames/${e+1}`)}getViewReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a,multiSliceReference:o}=e;if(!super.isReferenceViewable(e))return!1;const s=this.getCurrentImageId();if(!r){const g=s.indexOf(":");r=s.substring(g+1,s.length-1)}if(n.withNavigation)return!0;const c=this.getSliceIndex();if(o){const g=c0.imageIdToFrameEnd(o.referencedImageId);return c>=a&&c<=g}if(a!==void 0)return c===a;if(!i)return!1;const l=i.match(Ll.frameRangeExtractor);if(!l||!l[2])return!0;const f=l[2].split("-").map(g=>Number(g)),u=c+1;return f[0]<=u&&u<=(f[1]??f[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){const n=e?.sliceIndex??(this.isPlaying?this.frameRange[0]:this.getCurrentImageIdIndex()),r=e?.rangeEndSliceIndex??(this.isPlaying?this.frameRange[1]-1:void 0),i=r>n?{sliceIndex:r,referencedImageId:this.getCurrentImageId(r)}:void 0;return{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:n,multiSliceReference:i}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-n)/2,a=(this.canvas.offsetHeight-r)/2,o=i/e,s=a/e;this.videoCamera.panWorld=[o,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),a=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],o=[a[0]*i,a[1]*i],s=new F0;return s.scale(n,n),s.translate(a[0],a[1]),s.scale(r,r),s.translate(e[0],e[1]),s.translate(-o[0],-o[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const{imageId:i,...a}=r,o=Ve.getImage(i),s=this.createActorMapper(o),c=r.actorUID??nr();s&&(n.push({uid:c,actor:s,referencedId:i,...a}),r.callback&&r.callback({imageActor:s,imageId:i}))}),this.setActors(n)}createActorMapper(e){return new $U(this,e)}};Ll.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let xh=Ll;const WU=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`;let Z0=null;const zU="postrender",n3="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t0=class t0 extends w0{constructor(e){super({...e,canvas:e.canvas||_i(e.element)}),this.imageURISet=new Set,this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.annotationRemovedListener=r=>{const{detail:i}=r,a=i?.annotation?.metadata;if(!a){this.postrender();return}const o=a.referencedImageURI??(a.referencedImageId?hr(a.referencedImageId):null);if(o&&!this.hasImageURI(o))return;const s=a.FrameOfReferenceUID??null;s&&s!==this.frameOfReferenceUID||this.postrender()},this.voiRange={lower:0,upper:255},this.getProperties=()=>({voiRange:{...this.voiRange}}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:i,clientHeight:a}=r;(r.width!==i||r.height!==a)&&(r.width=i,r.height=a),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const i=this.canvasToIndex(r);return i[1]=-i[1],this.indexToWorld(i)},this.worldToCanvas=r=>{if(!this.metadata)return;const i=this.worldToIndex(r);return i[1]=-i[1],this.indexToCanvas([i[0],i[1],0])},this.postrender=()=>{this.refreshRenderValues(),Oe(this.element,Ee.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const i=this.getTransform();i.invert();const a=i.transformPoint(r.map(o=>o*devicePixelRatio));return[a[0],a[1],0]},this.indexToCanvas=r=>this.getTransform().transformPoint([r[0],r[1]]).map(a=>a/devicePixelRatio),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=nr(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(Ee.ELEMENT_DISABLED,this.elementDisabledHandler),Me.addEventListener(n3,this.annotationRemovedListener)}removeEventListeners(){this.canvas.removeEventListener(Ee.ELEMENT_DISABLED,this.elementDisabledHandler),Me.removeEventListener(n3,this.annotationRemovedListener)}elementDisabledHandler(){this.removeEventListeners(),this.viewer?.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null,this.imageURISet.clear()}getImageDataMetadata(e=0){const n=this.metadataDicomweb.reduce((N,P)=>N?.NumberOfFrames<P.NumberOfFrames?P:N),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:i,ImageOrientationSlide:a,ImagedVolumeWidth:o,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=n,l=Pe(Ur.IMAGE_PLANE,this.imageIds[e]);let f=a.slice(0,3),u=a.slice(3,6);(f==null||u==null)&&(f=[1,0,0],u=[0,1,0]);const g=Et(f[0],f[1],f[2]),d=Et(u[0],u[1],u[2]),p=Ie();zt(p,g,d);const{XOffsetInSlideCoordinateSystem:h=0,YOffsetInSlideCoordinateSystem:m=0,ZOffsetInSlideCoordinateSystem:v=0}=n.TotalPixelMatrixOriginSequence?.[0]||{},y=[h,m,v],T=o/r,C=s/i,w=r,S=i,_=c,D=1;return this.hasPixelSpacing=!!(o&&s),{bitsAllocated:8,numberOfComponents:3,origin:y,direction:[...g,...d,...p],dimensions:[w,S,D],spacing:[T,C,_],hasPixelSpacing:this.hasPixelSpacing,numVoxels:w*S*D,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){e.voiRange&&this.setVOI(e.voiRange)}resetProperties(){this.setProperties({voiRange:{lower:0,upper:255}})}setVOI(e){this.voiRange=e;const n=this.setColorTransform(e,this.averageWhite);this.map.getViewport().querySelectorAll(".ol-layers canvas").forEach(i=>{i.style.filter=n})}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}getScalarData(){return null}computeTransforms(){const e=pi(),n=pi();return b0(e,this.metadata.origin),e[0]=this.metadata.direction[0],e[1]=this.metadata.direction[1],e[2]=this.metadata.direction[2],e[4]=this.metadata.direction[3],e[5]=this.metadata.direction[4],e[6]=this.metadata.direction[5],e[8]=this.metadata.direction[6],e[9]=this.metadata.direction[7],e[10]=this.metadata.direction[8],Sa(e,e,this.metadata.spacing),In(n,e),{indexToWorld:e,worldToIndex:n}}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:n}=e,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>this.worldToIndex(a),indexToWorld:a=>this.indexToWorld(a)};return{dimensions:e.dimensions,spacing:n,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:r}}hasImageURI(e){return e?this.imageURISet.has(e):!1}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:i}=e,a=this.getView(),{xSpacing:o}=this.internalCamera;if(r){const c=this.element.clientHeight/r,l=1/o/c;a.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);a.setCenter(l)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n,centerIndex:r}=this.internalCamera,i=e*n,a=this.indexToCanvas([r[0],r[1],0]),o=this.canvasToWorld(a);return{parallelProjection:!0,focalPoint:o,position:o,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*i,viewPlaneNormal:[0,0,1]}}worldToIndexWSI(e){if(!Z0)return;const n=this.viewer.getAffine(),r=Z0.applyInverseTransform({coordinate:[e[0],e[1]],affine:n});return[r[0],r[1]]}indexToWorldWSI(e){if(!Z0)return;const n=Z0.applyTransform({coordinate:[e[0],e[1]],affine:this.viewer.getAffine()});return[n[0],n[1],0]}worldToIndex(e){const{worldToIndex:n}=this.computeTransforms(),r=Ie();return At(r,e,n),r}indexToWorld(e){const{indexToWorld:n}=this.computeTransforms(),r=Ie(),i=Et(...e);return At(r,i,n),[r[0],r[1],r[2]]}setDataIds(e,n){n?.miniNavigationOverlay!==!1&&t0.addMiniNavigationOverlayCss();const r=n?.webClient||Pe(Ur.WADO_WEB_CLIENT,e[0]);if(!r)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}.`);return this.setWSI(e,r)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e,this.imageURISet=new Set(e.map(s=>hr(s)));const r=await t0.getDicomMicroscopyViewer();Z0||=r.utils,this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{const c=n.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=c["00080008"]?.Value;l?.length===1&&(c["00080008"].Value=l[0].split("\\"));const f=c["00200052"]?.Value?.[0];return this.frameOfReferenceUID?f!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=f,c}),a=[];i.forEach(s=>{const c=new r.metadata.VLWholeSlideMicroscopyImage({metadata:s}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?a.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=a;const o=new r.viewer.VolumeImageViewer({client:n,metadata:a,controls:["overview","position"],retrieveRendered:!1,bindings:{}});o.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),o.deactivateDragPanInteraction(),this.viewer=o,this.map=o.getMap(),this.map.on(zU,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer.getMap(),n=window;return n.map=e,n.viewer=this.viewer,n.view=e?.getView(),n.wsi=this,e?.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<Ii)return;const r=e.getCenter(),i=e.getProjection().getExtent(),a=e.getRotation(),o=e.getZoom(),{metadata:{spacing:[s,c]}}=this,l=1/n/s;Object.assign(this.internalCamera,{extent:i,centerIndex:r,worldToCanvasRatio:l,xSpacing:s,ySpacing:c,resolution:n,rotation:a,zoom:o})}getZoom(){return this.getView()?.getZoom()}setZoom(e){this.getView()?.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],a=new F0;return a.translate(i[0],i[1]),a.rotate(r),a.scale(1/n,-1/n),a.translate(-e[0],-e[1]),a}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=WU,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};t0.getDicomMicroscopyViewer=async()=>Yw("dicom-microscopy-viewer"),t0.overlayCssId="overlayCss";let Eh=t0;const w7={[Bt.ORTHOGRAPHIC]:Br,[Bt.PERSPECTIVE]:Br,[Bt.STACK]:Jr,[Bt.VOLUME_3D]:op,[Bt.VIDEO]:xh,[Bt.WHOLE_SLIDE]:Eh};function ma(t){return w7[t].useCustomRenderingPipeline}const Kr={WIDTH:160,HEIGHT:96,TEXT_PADDING:3,TEXT_Y_OFFSET:2,GRAPH_Y_OFFSET:15,GRAPH_WIDTH:150,GRAPH_HEIGHT:70,FONT_SIZE:9,FONT_FAMILY:"Helvetica,Arial,sans-serif",GRAPH_ALPHA:.9},Hu={UPDATE_INTERVAL:1e3,MAX_MS_VALUE:200,MAX_FPS_VALUE:300,OVERLAY_STYLES:{position:"fixed",top:"0px",right:"0px",left:"auto",zIndex:"9999",cursor:"pointer",opacity:"0.9"}},fd={BYTES_TO_MB:1048576,MS_PER_SECOND:1e3},Xa=[{name:"FPS",foregroundColor:"#0ff",backgroundColor:"#002"},{name:"MS",foregroundColor:"#0f0",backgroundColor:"#020"},{name:"MB",foregroundColor:"#f08",backgroundColor:"#201"}];class gd{constructor(e,n,r){this.minValue=1/0,this.maxValue=0,this.name=e,this.foregroundColor=n,this.backgroundColor=r,this.devicePixelRatio=Math.round(window.devicePixelRatio||1),this.dimensions=this.calculateDimensions(),this.dom=this.createCanvas(),this.context=this.initializeContext(),this.drawInitialPanel()}update(e,n){this.updateMinMax(e),this.clearTextArea(),this.drawText(e),this.scrollGraph(),this.drawNewValue(e,n)}calculateDimensions(){const e=this.devicePixelRatio;return{width:Kr.WIDTH*e,height:Kr.HEIGHT*e,textX:Kr.TEXT_PADDING*e,textY:Kr.TEXT_Y_OFFSET*e,graphX:Kr.TEXT_PADDING*e,graphY:Kr.GRAPH_Y_OFFSET*e,graphWidth:Kr.GRAPH_WIDTH*e,graphHeight:Kr.GRAPH_HEIGHT*e}}createCanvas(){const e=document.createElement("canvas");return e.width=this.dimensions.width,e.height=this.dimensions.height,e.style.cssText=`width:${Kr.WIDTH}px;height:${Kr.HEIGHT}px`,e}initializeContext(){const e=this.dom.getContext("2d");if(!e)throw new Error("Failed to get 2D context");return e.font=`bold ${Kr.FONT_SIZE*this.devicePixelRatio}px ${Kr.FONT_FAMILY}`,e.textBaseline="top",e}drawInitialPanel(){const{width:e,height:n,textX:r,textY:i,graphX:a,graphY:o,graphWidth:s,graphHeight:c}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,n),this.context.fillStyle=this.foregroundColor,this.context.fillText(this.name,r,i),this.context.fillRect(a,o,s,c),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=Kr.GRAPH_ALPHA,this.context.fillRect(a,o,s,c),this.context.globalAlpha=1}updateMinMax(e){this.minValue=Math.min(this.minValue,e),this.maxValue=Math.max(this.maxValue,e)}clearTextArea(){const{width:e,graphY:n}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,n)}drawText(e){const{textX:n,textY:r}=this.dimensions,i=this.formatText(e);this.context.fillStyle=this.foregroundColor,this.context.fillText(i,n,r)}formatText(e){const n=Math.round(e),r=Math.round(this.minValue),i=Math.round(this.maxValue);return`${n} ${this.name} (${r}-${i})`}scrollGraph(){const{graphX:e,graphY:n,graphWidth:r,graphHeight:i}=this.dimensions,a=this.devicePixelRatio;this.context.drawImage(this.dom,e+a,n,r-a,i,e,n,r-a,i)}drawNewValue(e,n){const{graphX:r,graphY:i,graphWidth:a,graphHeight:o}=this.dimensions,s=this.devicePixelRatio,c=r+a-s;this.context.fillStyle=this.foregroundColor,this.context.fillRect(c,i,s,o);const l=Math.round((1-e/n)*o);this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=Kr.GRAPH_ALPHA,this.context.fillRect(c,i,s,l),this.context.globalAlpha=1}}var Jn;(function(t){t[t.FPS=0]="FPS",t[t.MS=1]="MS",t[t.MEMORY=2]="MEMORY"})(Jn||(Jn={}));var pa;let HU=(pa=class{constructor(){this.dom=null,this.currentMode=0,this.startTime=0,this.lastUpdateTime=0,this.frameCount=0,this.panels=new Map,this.animationFrameId=null,this.isSetup=!1}static getInstance(){return pa.instance||(pa.instance=new pa),pa.instance}setup(){if(!this.isSetup)try{this.dom=this.createOverlayElement(),this.startTime=performance.now(),this.lastUpdateTime=this.startTime,this.initializePanels(),this.showPanel(Jn.FPS),this.applyOverlayStyles(),document.body.appendChild(this.dom),this.startLoop(),this.isSetup=!0}catch(e){console.warn("Failed to setup stats overlay:",e)}}cleanup(){this.stopLoop(),this.dom&&this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.dom=null,this.panels.clear(),this.isSetup=!1}showPanel(e){Array.from(this.dom.children).forEach((r,i)=>{r.style.display=i===e?"block":"none"}),this.currentMode=e}update(){this.startTime=this.updateStats()}createOverlayElement(){const e=document.createElement("div");return e.addEventListener("click",this.handleClick.bind(this),!1),e}applyOverlayStyles(){Object.assign(this.dom.style,Hu.OVERLAY_STYLES)}handleClick(e){e.preventDefault();const n=this.dom.children.length;this.showPanel((this.currentMode+1)%n)}initializePanels(){const e=new gd(Xa[Jn.FPS].name,Xa[Jn.FPS].foregroundColor,Xa[Jn.FPS].backgroundColor);this.addPanel(Jn.FPS,e);const n=new gd(Xa[Jn.MS].name,Xa[Jn.MS].foregroundColor,Xa[Jn.MS].backgroundColor);if(this.addPanel(Jn.MS,n),this.isMemoryAvailable()){const r=new gd(Xa[Jn.MEMORY].name,Xa[Jn.MEMORY].foregroundColor,Xa[Jn.MEMORY].backgroundColor);this.addPanel(Jn.MEMORY,r)}}isMemoryAvailable(){return performance.memory!==void 0}addPanel(e,n){this.dom.appendChild(n.dom),this.panels.set(e,n)}startLoop(){const e=()=>{this.update(),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}updateStats(){this.frameCount++;const e=performance.now(),n=e-this.startTime,r=this.panels.get(Jn.MS);if(r&&r.update(n,Hu.MAX_MS_VALUE),e>=this.lastUpdateTime+Hu.UPDATE_INTERVAL){const i=this.frameCount*fd.MS_PER_SECOND/(e-this.lastUpdateTime),a=this.panels.get(Jn.FPS);a&&a.update(i,Hu.MAX_FPS_VALUE),this.lastUpdateTime=e,this.frameCount=0,this.updateMemoryPanel()}return e}updateMemoryPanel(){const e=this.panels.get(Jn.MEMORY);if(!e)return;const n=performance;if(n.memory){const r=n.memory.usedJSHeapSize/fd.BYTES_TO_MB,i=n.memory.jsHeapSizeLimit/fd.BYTES_TO_MB;e.update(r,i)}}},pa.instance=null,pa);const r3=HU.getInstance(),hg=2;class S7{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=r=>{const a=this._getViewportsAsArray().map(o=>{if(o.getFrameOfReferenceUID()===r)return o.id});this.renderViewports(a)},this.id=e||nr(),this.useCPURendering=yl(),Fl.set(this),!Xw())throw new Error("@cornerstonejs/core is not initialized, run init() first");this._viewports=new Map,this.hasBeenDestroyed=!1,wa()?.debug?.statsOverlay&&r3.setup()}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:i}=n;if(!r)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:o}=n,s=ma(o);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=_i(r),{background:l}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!ma(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],i=[];n.forEach(a=>{!this.useCPURendering&&!ma(a.type)?r.push(a):i.push(a)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(i),n.forEach(a=>{const o=_i(a.element),{background:s}=a.defaultOptions;this.fillCanvasWithBackgroundColor(o,s)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),i=[],a=[];r.forEach(o=>{ma(o.type)?a.push(o):i.push(o)}),i.length&&this._resizeVTKViewports(i,n,e),a.length&&this._resizeUsingCustomResizeHandler(a,n,e)}getViewport(e){return this._viewports?.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n)throw new Error(`Viewport with Id ${e} does not exist`);if(!(n instanceof Jr))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return n}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(n=>n instanceof Jr)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof mi;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(r3.cleanup(),this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),Fl.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let i;if(n){const a=n.map(o=>Math.floor(255*o));i=`rgb(${a[0]}, ${a[1]}, ${a[2]})`}else i="black";r.fillStyle=i,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let i=r;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},n===Bt.ORTHOGRAPHIC&&(i={...i,orientation:os.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const a=i.getCamera();i.resetCamera(),n&&i.setCamera(a)}),r&&this.render()}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addCustomViewport(e){const{element:n,viewportId:r,type:i,defaultOptions:a}=e;n.tabIndex=-1;const o=_i(n),{clientWidth:s,clientHeight:c}=o;(o.width!==s||o.height!==c)&&(o.width=s,o.height=c);const l={id:r,renderingEngineId:this.id,element:n,type:i,canvas:o,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:a||{}},f=w7[i],u=new f(l);this._viewports.set(r,u);const g={element:n,viewportId:r,renderingEngineId:this.id};Oe(Me,Ee.ELEMENT_ENABLED,g)}getRenderer(e){return this.offscreenMultiRenderWindow.getRenderer(e)}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");return this.offscreenMultiRenderWindow}setCustomViewports(e){e.forEach(n=>{this.addCustomViewport(n)})}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_resetViewport(e){const n=this.id,{element:r,canvas:i,id:a}=e,o={element:r,viewportId:a,renderingEngineId:n};e.removeWidgets(),Oe(Me,Ee.ELEMENT_DISABLED,o),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}}class x7 extends S7{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let i=0;i<n.length;i++){const a=n[i];if(this._needsRender.has(a.id)){const o=this.renderViewportUsingCustomOrVtkPipeline(a);if(r.push(o),a.setRendered(),this._needsRender.delete(a.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(i=>{i?.element&&Oe(i.element,Ee.IMAGE_RENDERED,i)})},this.useCPURendering||(this.offscreenMultiRenderWindow=Ey.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer))}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(f=>ma(f.type)===!1),i=r.map(f=>f.canvas),a=_i(e.element);i.push(a);const{offScreenCanvasWidth:o,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(r,o,s),l={...e,canvas:a};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:o,offScreenCanvasHeight:s,xOffset:c})}addVtkjsDrivenViewport(e,n){const{element:r,canvas:i,viewportId:a,type:o,defaultOptions:s}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:f}=n,{sxStartDisplayCoords:u,syStartDisplayCoords:g,sxEndDisplayCoords:d,syEndDisplayCoords:p,sx:h,sy:m,sWidth:v,sHeight:y}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,f);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,g,d,p],id:a,background:s.background?s.background:[0,0,0]});const T={id:a,element:r,renderingEngineId:this.id,type:o,canvas:i,sx:h,sy:m,sWidth:v,sHeight:y,defaultOptions:s||{}};let C;if(o===Bt.STACK)C=new Jr(T);else if(o===Bt.ORTHOGRAPHIC||o===Bt.PERSPECTIVE)C=new Br(T);else if(o===Bt.VOLUME_3D)C=new op(T);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(a,C);const w={element:r,viewportId:a,renderingEngineId:this.id};C.suppressEvents||Oe(Me,Ee.ELEMENT_ENABLED,w)}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(o=>_i(o.element));n.forEach(o=>{const s=window.devicePixelRatio||1,c=o.getBoundingClientRect();o.width=c.width*s,o.height=c.height*s});const{offScreenCanvasWidth:r,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(n);let a=0;for(let o=0;o<e.length;o++){const s=e[o],c=n[o],l={...s,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:r,offScreenCanvasHeight:i,xOffset:a}),a+=c.width}}}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>_i(a.element));if(i.forEach(a=>{const o=window.devicePixelRatio||1;a.width=a.clientWidth*o,a.height=a.clientHeight*o}),i.length){const{offScreenCanvasWidth:a,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(i);this._resize(e,a,o)}e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:c}=o;a.resetCameraForResize();const l=a.getDisplayArea();n&&(l?(c&&a.setCamera({flipHorizontal:c}),s&&a.setViewPresentation({rotation:s})):a.setCamera(o))}),r&&this.render()}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let i=0;i<r.length;i++){const{renderer:a,id:o}=r[i];this._needsRender.has(o)?a.setDraw(!0):a.setDraw(!1)}n.render();for(let i=0;i<r.length;i++)r[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<hg||e.sHeight<hg){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(ma(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,o=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,o)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:i,sx:a,sy:o,sWidth:s,sHeight:c,id:l,renderingEngineId:f,suppressEvents:u}=e,{width:g,height:d}=i;return i.getContext("2d").drawImage(n,a,o,s,c,0,0,g,d),{element:r,suppressEvents:u,viewportId:l,renderingEngineId:f,viewportStatus:e.viewportStatus}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,i=Math.max(...e.map(o=>o.height));let a=0;return e.forEach(o=>{a+=o.width}),n.width=a,n.height=i,r.resize(),{offScreenCanvasWidth:a,offScreenCanvasHeight:i}}_resize(e,n,r){let i=0;for(let a=0;a<e.length;a++){const o=e[a],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:f,sx:u,sy:g,sWidth:d,sHeight:p}=this._getViewportCoordsOnOffScreenCanvas(o,n,r,i);i+=o.canvas.width,o.sx=u,o.sy=g,o.sWidth=d,o.sHeight=p,this.offscreenMultiRenderWindow.getRenderer(o.id).setViewport(s,c,l,f)}return i}_getViewportCoordsOnOffScreenCanvas(e,n,r,i){const{canvas:a}=e,{width:o,height:s}=a,c=i,l=0,f=c/n,u=l+(r-s)/r,g=o/n,d=s/r;return{sxStartDisplayCoords:f,syStartDisplayCoords:u,sxEndDisplayCoords:f+g,syEndDisplayCoords:u+d,sx:c,sy:l,sWidth:o,sHeight:s}}}class jU{constructor(e){this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext=new Map,this.viewportSizes=new Map,this.contextMaxSizes=new Map;for(let n=0;n<e;n++){const r=Ey.newInstance(),i=document.createElement("div");r.setContainer(i),this.contexts.push(r),this.offScreenCanvasContainers.push(i)}}getContextByIndex(e){return e>=0&&e<this.contexts.length?{context:this.contexts[e],container:this.offScreenCanvasContainers[e]}:null}assignViewportToContext(e,n){this.viewportToContext.set(e,n)}getContextIndexForViewport(e){return this.viewportToContext.get(e)}getAllContexts(){return this.contexts}getContextCount(){return this.contexts.length}updateViewportSize(e,n,r){const i=this.viewportToContext.get(e);if(i===void 0)return!1;this.viewportSizes.set(e,{width:n,height:r});const a=this.contextMaxSizes.get(i),o=this.calculateMaxSizeForContext(i);return this.contextMaxSizes.set(i,o),!a||a.width!==o.width||a.height!==o.height}getMaxSizeForContext(e){return this.contextMaxSizes.get(e)}calculateMaxSizeForContext(e){let n=0,r=0;return this.viewportToContext.forEach((i,a)=>{if(i===e){const o=this.viewportSizes.get(a);o&&(n=Math.max(n,o.width),r=Math.max(r,o.height))}}),{width:n,height:r}}removeViewport(e){const n=this.viewportToContext.get(e);if(this.viewportToContext.delete(e),this.viewportSizes.delete(e),n!==void 0){const r=this.calculateMaxSizeForContext(n);this.contextMaxSizes.set(n,r)}}destroy(){this.contexts.forEach(e=>{e.delete()}),this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext.clear(),this.viewportSizes.clear(),this.contextMaxSizes.clear()}}class i3 extends S7{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const a=this._getViewportsAsArray().filter(s=>this._needsRender.has(s.id));if(a.length===0){this._animationFrameSet=!1,this._animationFrameHandle=null;return}const o=a.map(s=>{const c=this.renderViewportUsingCustomOrVtkPipeline(s);return s.setRendered(),this._needsRender.delete(s.id),c});this._animationFrameSet=!1,this._animationFrameHandle=null,o.forEach(s=>{s?.element&&Oe(s.element,Ee.IMAGE_RENDERED,s)})};const{rendering:n}=wa(),{webGlContextCount:r}=n;this.useCPURendering||(this.contextPool=new jU(r))}enableVTKjsDrivenViewport(e){const i=this._getViewportsAsArray().filter(s=>ma(s.type)===!1).map(s=>s.canvas),a=_i(e.element);i.push(a);const o={...e,canvas:a};this.addVtkjsDrivenViewport(o)}addVtkjsDrivenViewport(e){const{element:n,canvas:r,viewportId:i,type:a,defaultOptions:o}=e;n.tabIndex=-1;let s=0;if(a===Bt.STACK){const h=this.contextPool.getAllContexts();s=this._viewports.size%h.length}this.contextPool.assignViewportToContext(i,s),this.contextPool.updateViewportSize(i,r.width,r.height);const c=this.contextPool.getContextByIndex(s),{context:l,container:f}=c,u=this.contextPool.getMaxSizeForContext(s);f.width=u.width,f.height=u.height,l.resize(),l.addRenderer({viewport:[0,0,1,1],id:i,background:o.background?o.background:[0,0,0]});const g={id:i,element:n,renderingEngineId:this.id,type:a,canvas:r,sx:0,sy:0,sWidth:r.width,sHeight:r.height,defaultOptions:o||{}};let d;if(a===Bt.STACK)d=new Jr(g);else if(a===Bt.ORTHOGRAPHIC||a===Bt.PERSPECTIVE)d=new Br(g);else if(a===Bt.VOLUME_3D)d=new op(g);else throw new Error(`Viewport Type ${a} is not supported`);this._viewports.set(i,d);const p={element:n,viewportId:i,renderingEngineId:this.id};d.suppressEvents||Oe(Me,Ee.ELEMENT_ENABLED,p)}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(r=>_i(r.element));n.forEach(r=>{const i=window.devicePixelRatio||1,a=r.getBoundingClientRect();r.width=a.width*i,r.height=a.height*i});for(let r=0;r<e.length;r++){const i=e[r],a=n[r],o={...i,canvas:a};this.addVtkjsDrivenViewport(o)}}}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>_i(a.element));i.forEach(a=>{const o=window.devicePixelRatio||1;a.width=a.clientWidth*o,a.height=a.clientHeight*o}),i.length&&this._resize(e),e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:c}=o;a.resetCameraForResize();const l=a.getDisplayArea();n&&(l?(c&&a.setCamera({flipHorizontal:c}),s&&a.setViewPresentation({rotation:s})):a.setCamera(o))}),r&&this.render()}renderViewportUsingCustomOrVtkPipeline(e){if(ma(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const n=this.contextPool.getContextIndexForViewport(e.id),r=this.contextPool.getContextByIndex(n),{context:i,container:a}=r;return this._renderViewportWithContext(e,i,a)}_renderViewportWithContext(e,n,r){if(e.sWidth<hg||e.sHeight<hg){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(ma(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");n.getRenderer(e.id)||n.addRenderer({viewport:[0,0,1,1],id:e.id,background:e.defaultOptions?.background||[0,0,0]});const i=n.getRenderWindow(),a=i.getViews()[0],o=a.getRenderPasses(),s=this.getViewportRenderPasses(e.id);s&&a.setRenderPasses(s),this._resizeOffScreenCanvasForViewport(e,r,n);const c=n.getRenderer(e.id),l=this.contextPool.getContextIndexForViewport(e.id),f=this.contextPool.getMaxSizeForContext(l),u=e.canvas.width,g=e.canvas.height,d=Math.min(1,u/f.width),p=Math.min(1,g/f.height);c.setViewport(0,0,d,p);const h=n.getRenderers();h.forEach(({renderer:w,id:S})=>{w.setDraw(S===e.id)});const m=this.getWidgetRenderers();m.forEach((w,S)=>{S.setDraw(w===e.id)}),i.render(),h.forEach(({renderer:w})=>w.setDraw(!1)),m.forEach((w,S)=>{S.setDraw(!1)}),o&&a.setRenderPasses(o);const T=n.getOpenGLRenderWindow().get3DContext().canvas;return this._copyToOnscreenCanvas(e,T)}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){return this._copyToOnscreenCanvas(e,n)}_resizeOffScreenCanvasForViewport(e,n,r){const i=this.contextPool.getContextIndexForViewport(e.id);if(i===void 0||!this.contextPool.updateViewportSize(e.id,e.canvas.width,e.canvas.height))return;const o=this.contextPool.getMaxSizeForContext(i);n.width===o.width&&n.height===o.height||(n.width=o.width,n.height=o.height,r.resize())}_copyToOnscreenCanvas(e,n){const{element:r,canvas:i,id:a,renderingEngineId:o,suppressEvents:s}=e,{width:c,height:l}=i,f=i.getContext("2d"),u=this.contextPool.getContextIndexForViewport(a),d=this.contextPool.getMaxSizeForContext(u).height-l;return f.drawImage(n,0,d,c,l,0,0,c,l),{element:r,suppressEvents:s,viewportId:a,renderingEngineId:o,viewportStatus:e.viewportStatus}}_resize(e){const n=new Set;for(const r of e){r.sx=0,r.sy=0,r.sWidth=r.canvas.width,r.sHeight=r.canvas.height;const i=this.contextPool.getContextIndexForViewport(r.id);this.contextPool.updateViewportSize(r.id,r.canvas.width,r.canvas.height)&&n.add(i);const o=this.contextPool.getContextByIndex(i),{context:s}=o,c=s.getRenderer(r.id),l=this.contextPool.getMaxSizeForContext(i),f=Math.min(1,r.canvas.width/l.width),u=Math.min(1,r.canvas.height/l.height);c.setViewport(0,0,f,u)}n.forEach(r=>{const i=this.contextPool.getContextByIndex(r);if(i){const{context:a,container:o}=i,s=this.contextPool.getMaxSizeForContext(r);o.width=s.width,o.height=s.height,a.resize()}})}getWidgetRenderers(){const e=this._getViewportsAsArray(),n=new Map;return e.forEach(r=>{(r.getWidgets?r.getWidgets():[]).forEach(a=>{const o=a.getRenderer?a.getRenderer():null;o&&n.set(o,r.id)})}),n}getViewportRenderPasses(e){const n=this.getViewport(e);return n?.getRenderPasses?n.getRenderPasses():null}getRenderer(e){const n=this.contextPool?.getContextIndexForViewport(e),r=this.contextPool.getContextByIndex(n),{context:i}=r;return i.getRenderer(e)}disableElement(e){const n=this.getViewport(e);if(n&&(super.disableElement(e),!ma(n.type)&&!this.useCPURendering)){const r=this.contextPool.getContextIndexForViewport(e);if(r!==void 0){const i=this.contextPool.getContextByIndex(r);if(i){const{context:a}=i;a.removeRenderer(e)}}this.contextPool.removeViewport(e)}}destroy(){this.contextPool&&this.contextPool.destroy(),super.destroy()}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");const n=this.contextPool.getContextIndexForViewport(e);return this.contextPool.getContextByIndex(n).context}}class KU{constructor(e){const r=wa()?.rendering?.renderingEngineMode;switch(r){case vc.Tiled:this._implementation=new x7(e);break;case vc.ContextPool:this._implementation=new i3(e);break;default:console.warn(`RenderingEngine: Unknown rendering engine mode "${r}". Defaulting to Next rendering engine.`),this._implementation=new i3(e);break}}get id(){return this._implementation.id}enableElement(e){return this._implementation.enableElement(e)}disableElement(e){return this._implementation.disableElement(e)}setViewports(e){return this._implementation.setViewports(e)}resize(e=!0,n=!0){return this._implementation.resize(e,n)}getViewport(e){return this._implementation.getViewport(e)}getViewports(){return this._implementation.getViewports()}getStackViewport(e){return this._implementation.getStackViewport(e)}getStackViewports(){return this._implementation.getStackViewports()}getVolumeViewports(){return this._implementation.getVolumeViewports()}getRenderer(e){return this._implementation.getRenderer(e)}fillCanvasWithBackgroundColor(e,n){return this._implementation.fillCanvasWithBackgroundColor(e,n)}render(){return this._implementation.render()}renderViewports(e){return this._implementation.renderViewports(e)}renderViewport(e){return this._implementation.renderViewport(e)}destroy(){return this._implementation.destroy()}getOffscreenMultiRenderWindow(e){return this._implementation.getOffscreenMultiRenderWindow(e)}}var ki;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(ki||(ki={}));class a1{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i);let s=this._children.get(o);s||(s=new a1(this._target),this._children.set(o,s)),e=e.substring(i+1),s.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i),s=this._children.get(o);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,n,r),s.isEmpty&&this._children.delete(o)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=r?.capture??!1?ki.Capture:ki.Bubble,s=i.get(n)??ki.None;if(s&o){console.warn("A listener is already registered for this phase");return}i.set(n,s|o),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const a=r?.capture??!1?ki.Capture:ki.Bubble,o=this._eventListeners.get(e);if(!o)return;(n?[n]:Array.from(o.keys())).forEach(c=>{const l=o.get(c)??ki.None;if(!!!(l&a))return;this._target.removeEventListener(e,c,r);const u=l^a;u===ki.None?o.delete(c):o.set(c,u)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,i])=>{const a=ki.Capture;for(let o=a;i;o<<=1){if(!(i&o))continue;const s=o===ki.Capture;this.removeEventListener(e,r,{capture:s}),i^=o}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>{this._unregisterAllListeners(e,n)})}}class qU{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,i){let a=this._targetsEventListeners.get(e);a||(a=new a1(e),this._targetsEventListeners.set(e,a)),a.addEventListener(n,r,i)}removeEventListener(e,n,r,i){const a=this._targetsEventListeners.get(e);a&&(a.removeEventListener(n,r,i),a.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}const XU=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:qU,TargetEventListeners:a1},Symbol.toStringTag,{value:"Module"}));function YU(t,e){const n=t.getSize();for(let r=0;r<n;r++){const i=[];t.getNodeValue(r,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(r,i)}}function ZU(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const JU=Symbol("LastRuntimeId"),QU={},ek=4294967295,tk="-";function E7(t,e,n){return nk(t!==null&&typeof t=="object"?t:QU,JU,(typeof n=="number"&&n>0?n:ek)>>>0).join(typeof e=="string"?e:tk)}function nk(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let i=!0,a=0;i&&a<r.length;++a){let o=r[a]|0;o<n?(i=!1,o=o+1):(o=0,a+1===r.length&&r.push(0)),r[a]=o}return r}const a3={},rk={add:(t,e)=>{const n=hr(t);a3[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=hr(e);return a3[n]}}};function ik(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function O7(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function ak(t,e){let n;e?n=[_c(e)]:n=Da();const r=[];return n.forEach(i=>{const a=t.getActors(),o=i.getVolumeViewports();for(const s of o){const c=s.getActors();if(c.length!==a.length)continue;a.every(({uid:f})=>c.find(u=>f===u.uid))&&r.push(s)}}),r}const R7=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function D7(t,e,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!e.imageId,o=!a&&e,s=a&&e,l=`renderGPUViewport-${o.imageId||s.volumeId}`,f=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const g=t.width,d=t.height;f.style.width=`${g/u+Xm}px`,f.style.height=`${d/u+Xm}px`,f.style.visibility="hidden",f.style.position="absolute",document.body.appendChild(f);const p=l.split(":").join("-");f.setAttribute("viewport-id-for-remove",p);const h=_i(f),m=_c(r)||new x7(r);let v=m.getViewport(l);if(!v){const y={viewportId:l,type:a?Bt.ORTHOGRAPHIC:Bt.STACK,element:f,defaultOptions:{...i,suppressEvents:!0}};m.enableElement(y),v=m.getViewport(l)}return new Promise(y=>{let T=!1,{viewReference:C}=i;const w=S=>{if(T)return;if(C){const U=C;C=null,v.setViewReference(U),v.render();return}t.getContext("2d").drawImage(h,0,0,h.width,h.height,0,0,t.width,t.height);const D=v.canvasToWorld([0,0]),N=v.canvasToWorld([h.width/u,0]),P=v.canvasToWorld([0,h.height/u]),F=Ut([0,0,0],v.canvasToWorld([1/u,0]),D),B=Ut([0,0,0],v.canvasToWorld([0,1/u]),D),k=1;T=!0,f.removeEventListener(Ee.IMAGE_RENDERED,w),setTimeout(()=>{m.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${p}"]`).forEach(H=>{H.remove()})},0),y({origin:D,bottomLeft:P,topRight:N,thicknessMm:k,rightVector:F,downVector:B})};f.addEventListener(Ee.IMAGE_RENDERED,w),a?v.setVolumes([s],!1,!0):v.renderImageObject(e),v.resetCamera(),n==="PT"&&!R7(o)&&v.setProperties({voiRange:{lower:o.minPixelValue,upper:o.maxPixelValue}}),v.render()})}function M7(t,e,n,r,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=e,s=C7(t,o,n),c={canvas:t,viewport:s,image:o,renderingTools:{}};c.transform=zl(c);const l=!0;return new Promise((f,u)=>{v7(c,l),f(null)})}function ok(t){const{canvas:e,imageId:n,viewReference:r,requestType:i=gt.Thumbnail,priority:a=-5,renderingEngineId:o="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:f}=t,u=r?.volumeId,g=u&&!n,d=r&&f?{...f,viewReference:r}:f,p=s?M7:D7;return new Promise((h,m)=>{function v(w,S){const{modality:_}=Pe("generalSeriesModule",S)||{},D=!g&&w,N=g&&w;D&&(D.isPreScaled=D.isPreScaled||D.preScale?.scaled),c&&(e.height=256,e.width=256),l&&D&&(e.width=D&&e.height*D.width/D.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,N&&s&&m(new Error("CPU rendering of volume not supported")),p(e,w,_,o,d).then(h)}function y(w,S){console.error(w,S),m(w)}function T(w,S,_){return T0(w,_).then(D=>{v.call(this,D,w)},D=>{y.call(this,D,w)})}const C={useRGBA:!!s,requestType:i};if(u){const w=Ve.getVolume(u);w||m(new Error(`Volume id ${u} not found in cache`));const S=w.imageIds[0];v(w,S)}else Ea.addRequest(T.bind(null,n,null,C),i,{imageId:n},a)})}function Oh(t){return Array.isArray(t)?t:[t]}const o3={HISTORY_UNDO:"CORNERSTONE_TOOLS_HISTORY_UNDO",HISTORY_REDO:"CORNERSTONE_TOOLS_HISTORY_REDO"};class _7{constructor(e="Tools",n=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.isRecordingGrouped=!1,this.label=e,this._size=n}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}get canUndo(){return this.undoAvailable>0}get canRedo(){return this.redoAvailable>0}undo(e=1){for(;e>0&&this.undoAvailable>0;){const n=this.ring[this.position];for(const r of Oh(n).reverse())r.restoreMemo(!0),this.dispatchHistoryEvent({item:r,isUndo:!0});e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}}undoIf(e){return this.undoAvailable>0&&e(this.ring[this.position])?(this.undo(),!0):!1}dispatchHistoryEvent({item:e,isUndo:n}){e.id&&Me.dispatchEvent(new CustomEvent(n?o3.HISTORY_UNDO:o3.HISTORY_REDO,{detail:{isUndo:n,id:e.id,operationType:e.operationType||"annotation",memo:e}}))}redo(e=1){for(;e>0&&this.redoAvailable>0;){const n=(this.position+1)%this.size,r=this.ring[n];for(const i of Oh(r).reverse())i.restoreMemo(!1),this.dispatchHistoryEvent({item:i,isUndo:!1});e--,this.position=n,this.undoAvailable++,this.redoAvailable--}}initializeGroupItem(){this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=[]}startGroupRecording(){this.isRecordingGrouped=!0,this.initializeGroupItem()}rollbackUnusedGroupItem(){this.ring[this.position]=void 0,this.position=(this.position-1)%this._size,this.undoAvailable--}endGroupRecording(){this.isRecordingGrouped=!1;const e=this.ring[this.position];Array.isArray(e)&&e.length===0&&this.rollbackUnusedGroupItem()}pushGrouped(e){const n=this.ring[this.position];if(Array.isArray(n))return n.push(e),e;throw new Error("Last item should be an array for grouped memos.")}push(e){if(!e)return;const n=e.restoreMemo?e:e.createMemo?.();if(n)return this.isRecordingGrouped?this.pushGrouped(n):(this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=n,n)}}const sk=new _7,sp=Object.freeze(Object.defineProperty({__proto__:null,DefaultHistoryMemo:sk,HistoryMemo:_7},Symbol.toStringTag,{value:"Module"}));function ck(t,e){const n=Pe("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||=1,s||=1;const c=Ie();Qn(c,a,r,-o/2),Qn(c,c,i,-s/2);const l=Ie();Ut(l,e,c);const f=He(l,i),u=He(l,r);return[f/s,u/o]}function lk(t,e){const n=Pe("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||=1,s||=1;const c=Ie();return Qn(c,a,i,s*(e[0]-.5)),Qn(c,c,r,o*(e[1]-.5)),Array.from(c)}function Rh(t){const e=Da(),n=[];return e.forEach(r=>{r.getViewports().forEach(a=>{a.hasImageURI(t)&&n.push(a)})}),n}function I7(t,e){const n=uk(t,e);return n?n.index:null}function uk(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const i=c=>{const l=fk(c);if(!l)return null;const f=Ky(l.planeNormal,l.imagePositionPatient);return J2(f,t)},a={distance:i(n[r])??1/0,index:r},o=n.slice(r+1);for(let c=0;c<o.length;c++){const l=o[c],f=i(l);if(f!==null)if(f<=a.distance)a.distance=f,a.index=c+r+1;else break}const s=n.slice(0,r);for(let c=s.length-1;c>=0;c--){const l=s[c],f=i(l);if(!(f===null||f===a.distance))if(f<a.distance)a.distance=f,a.index=c;else break}return a.distance===1/0?null:a}function fk(t){const e=Pe("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=e,a=Yr(Ie(),...n),o=Yr(Ie(),...r),s=zt(Ie(),a,o);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:s}}function gk(t){const{width:e,height:n}=t.getCanvas(),{sliceToIndexMatrix:r,indexToSliceMatrix:i}=t.getSliceViewInfo(),a=es(t,[0,0]),o=es(t,[e-1,0]),s=es(t,[0,n-1]),c=Ut(Ie(),o,a),l=Ut(Ie(),s,a),f=zt(Ie(),c,l);Ht(c,c),Ht(l,l),Ht(f,f);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!qf(1,u)||!qf(1,g))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:d}=t.getImageData(),p=t.getSliceViewInfo(),h=d.getSliceData(p);return{width:p.width,height:p.height,scalarData:h,sliceToIndexMatrix:r,indexToSliceMatrix:i}}const Ys={},pg={add:(t,e)=>{const[n,r]=t,i=`${n}_${r}`;Ys[i]||(Ys[i]={}),Ys[i]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(Ys[r])return Ys[r];const i=`${n}_${e}`;if(Ys[i])return In(pi(),Ys[i])}};P0(pg.get.bind(pg));const dk=.05;function hk(t,e){const n=t.getSliceIndex(),r=e.getSliceIndex(),i=Pe("imagePlaneModule",n.toString()),a=Pe("imagePlaneModule",r.toString());if(!i||!a){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:o}=a;if(!i.imageOrientationPatient.every((g,d)=>Math.abs(g-o[d])<dk)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i?.imageOrientationPatient,a?.imageOrientationPatient);return}const c=i.imagePositionPatient,l=a.imagePositionPatient,f=_n(Ie(),c,l),u=b0(pi(),f);pg.add([t.id,e.id],u)}function pk(t){const{imageData:e,dimensions:n}=t.getImageData()||{};if(!e||!n)return[];const{canvas:r}=t,i=window.devicePixelRatio,a=[0,0],o=[r.width/i,0],s=[r.width/i,r.height/i],c=[0,r.height/i],l=t.canvasToWorld(a),f=t.canvasToWorld(o),u=t.canvasToWorld(s),g=t.canvasToWorld(c),d=e.worldToIndex(l),p=e.worldToIndex(f),h=e.worldToIndex(u),m=e.worldToIndex(g);return mk({dimensions:n,imageData:e,topLeftImage:d,topRightImage:p,bottomRightImage:h,bottomLeftImage:m,topLeftWorld:l,topRightWorld:f,bottomRightWorld:u,bottomLeftWorld:g})}function mk({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:o,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:l}){const f=ju(n,t)?o:e.indexToWorld([0,0,0]),u=ju(r,t)?s:e.indexToWorld([t[0]-1,0,0]),g=ju(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),d=ju(a,t)?l:e.indexToWorld([0,t[1]-1,0]);return[f,u,d,g]}function ju(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function Ke(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return U0(e,n)}function U0(t,e){if(!e||!t)return;const n=_c(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function Un(t){const e=Da();for(let n=0;n<e.length;n++){const r=e[n];if(r.getViewport(t))return U0(t,r.id)}}function vk(){const t=[];return Da().forEach(n=>{n.getViewports().forEach(({element:i})=>{t.push(Ke(i))})}),t}function yk(t){const e=Ke(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof Jr))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function Tk(t){if(!t.length)return!1;const e=t[0],{modality:n,seriesInstanceUID:r}=Pe("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:o,columns:s,rows:c,usingDefaultValues:l}=Pe("imagePlaneModule",e);if(l)return!1;const f={modality:n,imageOrientationPatient:i,pixelSpacing:a,columns:s,rows:c,seriesInstanceUID:r};let u=!0;for(let g=0;g<t.length;g++){const d=t[g],{modality:p,seriesInstanceUID:h}=Pe("generalSeriesModule",d),{imageOrientationPatient:m,pixelSpacing:v,columns:y,rows:T}=Pe("imagePlaneModule",d);if(h!==f.seriesInstanceUID){u=!1;break}if(p!==f.modality){u=!1;break}if(y!==f.columns){u=!1;break}if(T!==f.rows){u=!1;break}if(!Wt(m,f.imageOrientationPatient)){u=!1;break}if(!Wt(v,f.pixelSpacing)){u=!1;break}}return u}const Ck=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function b7(t){return t?(Array.isArray(t)?t:[t]).find(n=>Ck.has(n)):!1}async function wk({viewport:t,options:e={}}){const n=t.getRenderingEngine();let r=e.volumeId||`${nr()}`;r.split(":").length===0&&(r=`${FA()}:${r}`);const{id:i,element:a}=t,o=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();n.enableElement({viewportId:o,type:Bt.ORTHOGRAPHIC,element:a,defaultOptions:{background:e.background,orientation:e.orientation}}),(await zy(r,{imageIds:s})).load();const u=n.getViewport(o);await FU(n,[{volumeId:r}],[o]);const g=()=>{u.render(),a.removeEventListener(Ee.VOLUME_VIEWPORT_NEW_VOLUME,g)};return a.addEventListener(Ee.VOLUME_VIEWPORT_NEW_VOLUME,g),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function Sk({viewport:t,options:e}){const n=t,{id:r,element:i}=n,a=t.getRenderingEngine(),{background:o}=e,s=e.viewportId||r,c=Ve.getVolume(n.getVolumeId());if(!(c instanceof Jg))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:s,type:Bt.STACK,element:i,defaultOptions:{background:o}},f=n.getViewReference();a.enableElement(l);const u=a.getViewport(s);return await u.setStack(c.imageIds),u.setViewReference(f),u.render(),u}function ga(t,e=2){if(Array.isArray(t))return t.map(i=>ga(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function xk(t){return Math.round(t/Ii)*Ii}function Ek(t,e,n){const r=t.length===e*n*4,i=t.length===e*n*3;if(r||i){const a=new Float32Array(e*n);let o=0,s=0;const c=r?4:3;for(let l=0;l<e;l++)for(let f=0;f<n;f++){const u=t[o],g=t[o+1],d=t[o+2];a[s]=(u+g+d)/3,o+=c,s++}return a}else return t}function Ok(t){if(t instanceof Br)return Ve.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function cp(t,e){const n=[...t];return e>=n.length?(s3(n),n):(s3(n),n.slice(0,e))}function s3(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function dd(t){const e=t.toString(16);return e.length==1?"0"+e:e}function Rk(t,e,n){return"#"+dd(t)+dd(e)+dd(n)}function Dk(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const Mk=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:Dk,rgbToHex:Rk},Symbol.toStringTag,{value:"Module"}));function L7(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),t===e}}function _k(t,e,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!n?void 0:n(e).metadata.Modality;throw new Error("Invalid viewport type")}const Ik=(t,e)=>t.reduce((n,r)=>((n[r[e]]=n[r[e]]||[]).push(r),n),{});function bk(t){const e=t.map(o=>{const{imagePositionPatient:s}=Pe("imagePlaneModule",o)||{};return{imageId:o,imagePositionPatient:s}});if(!e.every(o=>o.imagePositionPatient))return null;const n=Ik(e,"imagePositionPatient"),r=Object.keys(n),i=n[r[0]].length;return i===1||!r.every(o=>n[o].length===i)?null:n}function Lk(t,e){const n={};let r=[];const i=Object.keys(t);for(let a=0;a<i.length;a++){const o=new Set,s=t[i[a]];for(let c=0;c<s.length;c++){const l=e(s[c].imageId)||0;if(n[l]=n[l]||[],n[l].push({imageId:s[c].imageId}),o.add(l),o.size-1<c)return}if(a==0)r=Array.from(o);else if(!Ak(r,o))return}return n}function J0(t,e){const n=Pe(e,t);try{return parseFloat(n)}catch{return}}function Vk(t){const e=Pe("20011003",t);try{const{InlineBinary:n}=e;if(n){const r=atob(n),i=new ArrayBuffer(r.length),a=new DataView(i);for(let o=0;o<r.length;o++)a.setUint8(o,r.charCodeAt(o));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function Pk(t){let e=Pe("0019100c",t)||Pe("0019100C",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n)),parseFloat(e)}catch{return}}function Nk(t){let e=Pe("00431039",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n).split("//")),parseFloat(e[0])%1e5}catch{return}}function Ak(t,e){if(t.length!=e.size)return!1;for(let n=0;n<t.length;n++)if(!e.has(t[n]))return!1;return!0}function Fk(t){const e=Pe("petImageModule",t);return e?e.frameReferenceTime:0}function V7(t){const e=bk(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],r=[i=>J0(i,n[0]),i=>J0(i,n[1]),i=>J0(i,n[2]),i=>J0(i,n[3]),i=>J0(i,n[4]),Vk,Pk,Nk,Fk];for(let i=0;i<r.length;i++){const a=Lk(e,r[i]);if(a)return{imageIdGroups:Object.keys(a).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>a[c].map(l=>l.imageId)),splittingTag:n[i]}}return{imageIdGroups:[t],splittingTag:null}}function Uk(t){const{imageIdGroups:e,splittingTag:n}=V7(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:n}}function kk(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a}=e;if(e.modality==="PT"&&typeof a=="number")for(let o=0;o<n;o++)t[o]=a*(t[o]*r+i);else for(let o=0;o<n;o++)t[o]=t[o]*r+i;return t}function P7(t,e,n){return Math.min(Math.max(e,t),n)}function mg(t,e){if(!Ke(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof Jr&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:r,delta:i,scrollSlabs:a}=e;if(t instanceof Br)Gk(t,r,i,a);else{const o=t.getCurrentImageIdIndex();if(o+i>t.getImageIds().length-1||o+i<0){const s={imageIdIndex:o,direction:i};Oe(Me,Ee.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function Gk(t,e,n,r=!1){const i=r,{numScrollSteps:a,currentStepIndex:o,sliceRangeInfo:s}=o0(t,e,i);if(a===0||!s)return;const{sliceRange:c,spacingInNormalDirection:l,camera:f}=s,{focalPoint:u,viewPlaneNormal:g,position:d}=f,{newFocalPoint:p,newPosition:h}=s0(u,d,c,g,l,n);t.setCamera({focalPoint:p,position:h}),t.render();const m=o+n,v={volumeId:e,viewport:t,delta:n,desiredStepIndex:m,currentStepIndex:o,numScrollSteps:a,currentImageId:t.getCurrentImageId()};(m>a||m<0)&&t.getCurrentImageId()?Oe(Me,Ee.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,v):Oe(Me,Ee.VOLUME_VIEWPORT_SCROLL,v)}async function Bk(t,e={}){const{imageIndex:n,debounceLoading:r,volumeId:i}=e,a=Ke(t);if(!a)throw new Error("Element has been disabled");const{viewport:o}=a,{imageIndex:s,numberOfSlices:c}=$k(o,r),f=Wk(c,n)-s;mg(o,{delta:f,debounceLoading:r,volumeId:i})}function $k(t,e){return t instanceof Jr?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function Wk(t,e){const n=t-1;return P7(e,0,n)}function zk(t,e,n={}){const r=Ve.getVolume(t);if(!r)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:a,direction:o,dimensions:s}=r,{minX:c,maxX:l,minY:f,maxY:u,minZ:g,maxZ:d}=e,p=[Math.min(c,l),Math.min(f,u),Math.min(g,d)],h=dg(r.imageData,p),m=[Math.abs(l-c)+1,Math.abs(u-f)+1,Math.abs(d-g)+1],{targetBuffer:v}=n,y={metadata:i,dimensions:m,spacing:a,origin:h,direction:o,targetBuffer:v,scalarData:v?.type==="Float32Array"?new Float32Array(m[0]*m[1]*m[2]):void 0},T=NA(nr(),y),C=T.voxelManager.getCompleteScalarDataArray(),w=m[0]*m[1],S=s[0]*s[1],_=r.voxelManager.getCompleteScalarDataArray();for(let D=0;D<m[2];D++)for(let N=0;N<m[1];N++){const P=dg(T.imageData,[0,N,D]),F=y0(r.imageData,P),B=F[2]*S+F[1]*s[0]+F[0],k=_.slice(B,B+m[0]),U=D*w+N*m[0];C.set(k,U)}return T.voxelManager.setCompleteScalarDataArray(C),T}function Hk(t,e){const{viewUp:n,viewPlaneNormal:r}=e,i=hf(t,[0,0,0]),a=lo(Ie(),n),o=lo(Ie(),r),s=zt(Ie(),a,o),c=Ut(Ie(),hf(t,a),i),l=Ut(Ie(),hf(t,o),i);Ht(c,c),Ht(l,l);const f=zt(Ie(),c,l);return{worldVecRowDir:s,worldVecColDir:a,worldVecSliceDir:o,ijkVecRowDir:f,ijkVecColDir:c,ijkVecSliceDir:l}}function jk(t,e,n,r){const[i,a,o]=e,s=i*a;let c=0,l=0,f=0;const[u,g,d]=n.map(Math.round);for(let v=d-r;v<=d+r;v++)if(!(v<0||v>=o)){for(let y=g-r;y<=g+r;y++)if(!(y<0||y>=a))for(let T=u-r;T<=u+r;T++){if(T<0||T>=i)continue;const C=v*s+y*i+T,w=t[C];c+=w,l+=w*w,f++}}if(f===0){const v=d*s+g*i+u;return v>=0&&v<t.length?{mean:t[v],stdDev:0,count:1}:{mean:0,stdDev:0,count:0}}const p=c/f,h=l/f-p*p,m=Math.sqrt(Math.max(0,h));return{mean:p,stdDev:m,count:f}}const Kk=new Set(["1.2.840.10008.5.1.4.1.1.1","1.2.840.10008.5.1.4.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.2","1.2.840.10008.5.1.4.1.1.1.2.1","1.2.840.10008.5.1.4.1.1.1.3","1.2.840.10008.5.1.4.1.1.1.3.1","1.2.840.10008.5.1.4.1.1.12.1","1.2.840.10008.5.1.4.1.1.12.1.1","1.2.840.10008.5.1.4.1.1.12.2","1.2.840.10008.5.1.4.1.1.12.2.1","1.2.840.10008.5.1.4.1.1.12.3"]);function N7(t){const{PixelSpacing:e,ImagerPixelSpacing:n,EstimatedRadiographicMagnificationFactor:r,DistanceSourceToDetector:i,DistanceSourceToPatient:a}=t;if(r)return r;if(a<i)return i/a;if(n?.[0]>e?.[0])return!0}function A7(t){const{PixelSpacing:e,ImagerPixelSpacing:n,PixelSpacingCalibrationType:r}=t,i=!0;if(e&&r==="GEOMETRY")return Wt(e,n)&&console.warn("Calibration type is geometry, but pixel spacing and imager pixel spacing identical",e,n),{PixelSpacing:e,type:da.ERMF,isProjection:i};if(e&&r==="FIDUCIAL")return{PixelSpacing:e,type:da.CALIBRATED,isProjection:i};if(n){const a=N7(t);return a>1?{PixelSpacing:n.map(s=>s/a),type:da.ERMF,isProjection:i}:a===!0?{PixelSpacing:e,type:da.ERMF,isProjection:i}:(a&&console.error("Illegal ERMF value:",a),{PixelSpacing:e||n,type:da.PROJECTION,isProjection:i})}return{PixelSpacing:e,type:da.UNKNOWN,isProjection:i}}function qk(t){const{PixelSpacing:e,SOPClassUID:n}=t;return Kk.has(n)?A7(t):{PixelSpacing:e,type:da.NOT_APPLICABLE,isProjection:!1}}const Xk=(t,e)=>_k(t,e,Ve.getVolume),Ma=Object.freeze(Object.defineProperty({__proto__:null,FrameRange:c0,HistoryMemo:sp,PointsManager:Tf,ProgressiveIterator:lg,RLEVoxelMap:Jo,VoxelManager:en,actorIsA:Gr,applyPreset:Zy,asArray:Oh,autoLoad:vh,buildMetadata:l7,calculateNeighborhoodStats:jk,calculateRadiographicPixelSpacing:A7,calculateSpacingBetweenImageIds:Ny,calculateViewportsSpatialRegistration:hk,calibratedPixelSpacingMetadataProvider:rk,clamp:Sh,clip:P7,color:Mk,colormap:PO,convertStackToVolumeViewport:wk,convertToGrayscale:Ek,convertVolumeToStackViewport:Sk,createLinearRGBTransferFunction:g7,createSigmoidRGBTransferFunction:x2,createSubVolume:zk,decimate:ky,deepClone:Bi,deepEqual:L7,deepMerge:Zr,eventListener:XU,fnv1aHash:T8,generateVolumePropsFromImageIds:Y2,genericMetadataProvider:Qg,getBufferConfiguration:My,getClosestImageId:Hl,getClosestStackImageIndexForPoint:I7,getCurrentVolumeViewportSlice:gk,getDynamicVolumeInfo:Uk,getERMF:N7,getImageDataMetadata:u7,getImageLegacy:yk,getImageSliceDataForVolumeViewport:fg,getMinMax:ZU,getPixelSpacingInformation:qk,getRandomSampleFromArray:cp,getRuntimeId:E7,getScalingParameters:Fy,getSliceRange:t1,getSpacingInNormalDirection:uu,getTargetVolumeAndSpacingInNormalDir:fu,getViewportImageCornersInWorld:pk,getViewportImageIds:Ok,getViewportModality:Xk,getViewportsWithImageURI:Rh,getViewportsWithVolumeId:e1,getVoiFromSigmoidRGBTransferFunction:Yy,getVolumeActorCorners:Hy,getVolumeDirectionVectors:Hk,getVolumeId:N0,getVolumeSliceRangeInfo:Xy,getVolumeViewportScrollInfo:o0,getVolumeViewportsContainingSameVolumes:ak,hasFloatScalingParameters:X2,hasNaNValues:Th,imageIdToURI:hr,imageRetrieveMetadataProvider:C0,imageToWorldCoords:lk,indexWithinDimensions:O7,invertRgbTransferFunction:Cl,isEqual:Wt,isEqualAbs:df,isEqualNegative:S8,isImageActor:Mi,isNumber:Za,isOpposite:ik,isPTPrescaledWithSUV:R7,isValidVolume:Tk,isVideoTransferSyntax:b7,jumpToSlice:Bk,loadImageToCanvas:ok,logger:HF,makeVolumeMetadata:Py,planar:tF,pointInShapeCallback:N9,renderToCanvasCPU:M7,renderToCanvasGPU:D7,roundNumber:ga,roundToPrecision:xk,scaleArray:kk,scaleRgbTransferFunction:YU,scroll:mg,snapFocalPointToSlice:s0,sortImageIdsAndGetSpacing:Ay,spatialRegistrationMetadataProvider:pg,splitImageIdsBy4DTags:V7,transferFunctionUtils:FO,transformIndexToWorld:dg,transformWorldToIndex:y0,transformWorldToIndexContinuous:hf,triggerEvent:Oe,updatePlaneRestriction:qy,updateVTKImageDataWithCornerstoneImage:r1,uuidv4:nr,windowLevel:AO,worldToImageCoords:ck},Symbol.toStringTag,{value:"Module"})),gu=new $h("imageRetrievalPool");gu.setMaxSimultaneousRequests(gt.Interaction,200);gu.setMaxSimultaneousRequests(gt.Thumbnail,200);gu.setMaxSimultaneousRequests(gt.Prefetch,200);gu.grabDelay=0;const c3=Symbol("DefaultSettings"),l3=Symbol("RuntimeSettings"),u3=Symbol("ObjectSettingsMap"),Ya=Symbol("Dictionary");class cn{constructor(e){const n=Object.create(e instanceof cn&&Ya in e?e[Ya]:null);Object.seal(Object.defineProperty(this,Ya,{value:n}))}set(e,n){return vg(this[Ya],e,n,null)}get(e){return Jk(this[Ya],e)}unset(e){return Yk(this[Ya],e+"")}forEach(e){f3(this[Ya],e)}extend(){return new cn(this)}import(e){F7(e)&&Object.keys(e).forEach(n=>{vg(this[Ya],n,e[n],null)})}dump(){const e={};return f3(this[Ya],(n,r)=>{typeof r<"u"&&U7(e,n,r)}),e}static assert(e){return e instanceof cn?e:cn.getRuntimeSettings()}static getDefaultSettings(e=null){let n=cn[c3];if(n instanceof cn||(n=new cn,cn[c3]=n),e){const r={};return n.forEach(i=>{if(i.startsWith(e)){const a=i.split(`${e}.`)[1];r[a]=n.get(i)}}),r}return n}static getRuntimeSettings(){let e=cn[l3];return e instanceof cn||(e=new cn(cn.getDefaultSettings()),cn[l3]=e),e}static getObjectSettings(e,n){let r=null;if(e instanceof cn)r=e;else if(typeof e=="object"&&e!==null){let i=cn[u3];i instanceof WeakMap||(i=new WeakMap,cn[u3]=i),r=i.get(e),r instanceof cn||(r=new cn(cn.assert(cn.getObjectSettings(n))),i.set(e,r))}return r}static extendRuntimeSettings(){return cn.getRuntimeSettings().extend()}}function Yk(t,e){if(e.endsWith(".")){let n=0;const r=e,i=r.slice(0,-1),a=i.length===0;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a||o.startsWith(r)||o===i)&&(delete t[o],++n);return n>0}return delete t[e]}function f3(t,e){for(const n in t)e(n,t[n])}function Zk(t,e,n,r){let i;if(r.has(n))return vg(t,e,null,r);r.add(n),i=0;for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)){const o=a.length===0?e:`${e}.${a}`;vg(t,o,n[a],r)||++i}return r.delete(n),i===0}function vg(t,e,n,r){return Qk(e)?F7(n)?Zk(t,e,n,r instanceof WeakSet?r:new WeakSet):(t[e]=n,!0):!1}function Jk(t,e){return t[e]}function Qk(t){let e,n,r;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(r=-1;(n=t.indexOf(".",r+1))>=0;){if(n-r<2||n===e)return!1;r=n}return!0}function F7(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function U7(t,e,n){const r=e.indexOf(".");if(r>=0){const i=e.slice(0,r);let a=t[i];if(typeof a!="object"||a===null){const o=a;a={},typeof o<"u"&&(a[""]=o),t[i]=a}U7(a,e.slice(r+1,e.length),n)}else t[e]=n}cn.getDefaultSettings().set("useCursors",!0);function eG(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function tG(t){if(!(a=t.length))return[];for(var e=-1,n=eG(t,nG),r=new Array(n);++e<n;)for(var i=-1,a,o=r[e]=new Array(a);++i<a;)o[i]=t[i][e];return r}function nG(t){return t.length}function g3(){return tG(arguments)}function rG(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}function hd(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,s=r<e-1?t[r+2]:2*a-i;return rG((n-r/e)*e,o,i,a,s)}}function Q0(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}var S0;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(S0||(S0={}));var ai;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})(ai||(ai={}));var rn;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(rn||(rn={}));var ts;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(ts||(ts={}));var fe;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",t.VOLUMECROPPINGCONTROL_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPINGCONTROL_TOOL_CHANGED",t.VOLUMECROPPING_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPING_TOOL_CHANGED",t.STACK_PREFETCH_COMPLETE="CORNERSTONE_TOOLS_STACK_PREFETCH_COMPLETE",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",t.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(fe||(fe={}));var nt;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(nt||(nt={}));var Yc;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(Yc||(Yc={}));var Li;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated",t.History="History",t.MetadataReferenceModified="MetadataReferenceModified",t.LabelChange="LabelChange"})(Li||(Li={}));var l0;(function(t){t.Linear="Linear",t.Area="Area",t.Volume="Volume",t.Pixel="Pixel"})(l0||(l0={}));let iG={},Ye={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:iG,enabledElements:[]};var pd,d3;function aG(){if(d3)return pd;d3=1;var t="Expected a function",e="__lodash_hash_undefined__",n="[object Function]",r="[object GeneratorFunction]",i="[object Symbol]",a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/,s=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/[\\^$.*+?()[\]{}|]/g,f=/\\(\\)?/g,u=/^\[object .+?Constructor\]$/,g=typeof no=="object"&&no&&no.Object===Object&&no,d=typeof self=="object"&&self&&self.Object===Object&&self,p=g||d||Function("return this")();function h(ge,Re){return ge?.[Re]}function m(ge){var Re=!1;if(ge!=null&&typeof ge.toString!="function")try{Re=!!(ge+"")}catch{}return Re}var v=Array.prototype,y=Function.prototype,T=Object.prototype,C=p["__core-js_shared__"],w=(function(){var ge=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||"");return ge?"Symbol(src)_1."+ge:""})(),S=y.toString,_=T.hasOwnProperty,D=T.toString,N=RegExp("^"+S.call(_).replace(l,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=p.Symbol,F=v.splice,B=ir(p,"Map"),k=ir(Object,"create"),U=P?P.prototype:void 0,H=U?U.toString:void 0;function W(ge){var Re=-1,Fe=ge?ge.length:0;for(this.clear();++Re<Fe;){var It=ge[Re];this.set(It[0],It[1])}}function J(){this.__data__=k?k(null):{}}function ne(ge){return this.has(ge)&&delete this.__data__[ge]}function q(ge){var Re=this.__data__;if(k){var Fe=Re[ge];return Fe===e?void 0:Fe}return _.call(Re,ge)?Re[ge]:void 0}function Q(ge){var Re=this.__data__;return k?Re[ge]!==void 0:_.call(Re,ge)}function ae(ge,Re){var Fe=this.__data__;return Fe[ge]=k&&Re===void 0?e:Re,this}W.prototype.clear=J,W.prototype.delete=ne,W.prototype.get=q,W.prototype.has=Q,W.prototype.set=ae;function me(ge){var Re=-1,Fe=ge?ge.length:0;for(this.clear();++Re<Fe;){var It=ge[Re];this.set(It[0],It[1])}}function de(){this.__data__=[]}function je(ge){var Re=this.__data__,Fe=Zt(Re,ge);if(Fe<0)return!1;var It=Re.length-1;return Fe==It?Re.pop():F.call(Re,Fe,1),!0}function $e(ge){var Re=this.__data__,Fe=Zt(Re,ge);return Fe<0?void 0:Re[Fe][1]}function Be(ge){return Zt(this.__data__,ge)>-1}function qe(ge,Re){var Fe=this.__data__,It=Zt(Fe,ge);return It<0?Fe.push([ge,Re]):Fe[It][1]=Re,this}me.prototype.clear=de,me.prototype.delete=je,me.prototype.get=$e,me.prototype.has=Be,me.prototype.set=qe;function Qe(ge){var Re=-1,Fe=ge?ge.length:0;for(this.clear();++Re<Fe;){var It=ge[Re];this.set(It[0],It[1])}}function ut(){this.__data__={hash:new W,map:new(B||me),string:new W}}function ke(ge){return tn(this,ge).delete(ge)}function Xe(ge){return tn(this,ge).get(ge)}function et(ge){return tn(this,ge).has(ge)}function $t(ge,Re){return tn(this,ge).set(ge,Re),this}Qe.prototype.clear=ut,Qe.prototype.delete=ke,Qe.prototype.get=Xe,Qe.prototype.has=et,Qe.prototype.set=$t;function Zt(ge,Re){for(var Fe=ge.length;Fe--;)if(st(ge[Fe][0],Re))return Fe;return-1}function Kt(ge,Re){Re=$(Re,ge)?[Re]:on(Re);for(var Fe=0,It=Re.length;ge!=null&&Fe<It;)ge=ge[oe(Re[Fe++])];return Fe&&Fe==It?ge:void 0}function Jt(ge){if(!_t(ge)||re(ge))return!1;var Re=kt(ge)||m(ge)?N:u;return Re.test(we(ge))}function qt(ge){if(typeof ge=="string")return ge;if(pt(ge))return H?H.call(ge):"";var Re=ge+"";return Re=="0"&&1/ge==-1/0?"-0":Re}function on(ge){return St(ge)?ge:K(ge)}function tn(ge,Re){var Fe=ge.__data__;return j(Re)?Fe[typeof Re=="string"?"string":"hash"]:Fe.map}function ir(ge,Re){var Fe=h(ge,Re);return Jt(Fe)?Fe:void 0}function $(ge,Re){if(St(ge))return!1;var Fe=typeof ge;return Fe=="number"||Fe=="symbol"||Fe=="boolean"||ge==null||pt(ge)?!0:o.test(ge)||!a.test(ge)||Re!=null&&ge in Object(Re)}function j(ge){var Re=typeof ge;return Re=="string"||Re=="number"||Re=="symbol"||Re=="boolean"?ge!=="__proto__":ge===null}function re(ge){return!!w&&w in ge}var K=Ae(function(ge){ge=Lt(ge);var Re=[];return s.test(ge)&&Re.push(""),ge.replace(c,function(Fe,It,_r,vr){Re.push(_r?vr.replace(f,"$1"):It||Fe)}),Re});function oe(ge){if(typeof ge=="string"||pt(ge))return ge;var Re=ge+"";return Re=="0"&&1/ge==-1/0?"-0":Re}function we(ge){if(ge!=null){try{return S.call(ge)}catch{}try{return ge+""}catch{}}return""}function Ae(ge,Re){if(typeof ge!="function"||Re&&typeof Re!="function")throw new TypeError(t);var Fe=function(){var It=arguments,_r=Re?Re.apply(this,It):It[0],vr=Fe.cache;if(vr.has(_r))return vr.get(_r);var yr=ge.apply(this,It);return Fe.cache=vr.set(_r,yr),yr};return Fe.cache=new(Ae.Cache||Qe),Fe}Ae.Cache=Qe;function st(ge,Re){return ge===Re||ge!==ge&&Re!==Re}var St=Array.isArray;function kt(ge){var Re=_t(ge)?D.call(ge):"";return Re==n||Re==r}function _t(ge){var Re=typeof ge;return!!ge&&(Re=="object"||Re=="function")}function xn(ge){return!!ge&&typeof ge=="object"}function pt(ge){return typeof ge=="symbol"||xn(ge)&&D.call(ge)==i}function Lt(ge){return ge==null?"":qt(ge)}function jt(ge,Re,Fe){var It=ge==null?void 0:Kt(ge,Re);return It===void 0?Fe:It}return pd=jt,pd}var oG=aG();const sG=ji(oG),h3=Symbol("DefinedCursors"),k7=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class ci{constructor(e,n){this.name=e+"",this.fallback=n}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:n}=this;return n instanceof ci?`${e}, ${n.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const n=p3(ci,h3);let r=n.get(e);if(r instanceof ci)return r;if(k7.has(e))return r=new ci(e),n.set(e,r),r}static setDefinedCursor(e,n){return n instanceof ci?(p3(ci,h3).set(e,n),!0):!1}}function p3(t,e){let n=t[e];return n instanceof Map||(n=new Map,Object.defineProperty(t,e,{value:n})),n}const cG=k7.values(),lG="image-cursor";class yg extends ci{constructor(e,n,r,i,a){super(i||yg.getUniqueInstanceName(lG),a),this.url=e,this.x=Number(n)||0,this.y=Number(r)||0}getStyleProperty(){const{url:e,x:n,y:r}=this;let i=`url('${e}')`;return n>=0&&r>=0&&(n>0||r>0)&&(i+=` ${n} ${r}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${E7(yg)}`}}const Ot={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},qr={x:127,y:60},kc=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,Ho=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,Ku='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Gc='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',qu='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',G7={Angle:Rt(Ot,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:Rt(Ot,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:Rt(Ot,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:Rt(Ot,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:Rt(Ot,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:Rt(Ot,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:Rt(Ot,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:Rt(Ot,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:Rt(Ot,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:Rt(Ot,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:Rt(Ot,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:Rt(Ot,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),Label:Rt(Ot,{name:"Label",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:Rt(Ot,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:Rt(Ot,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:Rt(Ot,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:Rt(Ot,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:Rt(Ot,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:Rt(Ot,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:Rt(Ot,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:Rt(Ot,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:Rt(Ot,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:Rt(Ot,{name:"SegmentationFreeHandEraseInside",iconContent:`${Ku} ${kc}`,viewBox:qr}),SegmentationFreeHandFillInside:Rt(Ot,{name:"SegmentationFreeHandFillInside",iconContent:`${Ku} ${Ho}`,viewBox:qr}),SegmentationFreeHandEraseOutside:Rt(Ot,{name:"SegmentationFreeHandEraseOutside",iconContent:`${Ku} ${kc}`,viewBox:qr}),SegmentationFreeHandFillOutside:Rt(Ot,{name:"SegmentationFreeHandFillOutside",iconContent:`${Ku} ${Ho}`,viewBox:qr}),SegmentationRectangleEraseInside:Rt(Ot,{name:"SegmentationRectangleEraseInside",iconContent:`${Gc} ${kc}`,viewBox:qr}),RectangleScissor:Rt(Ot,{name:"RectangleScissor",iconContent:`${Gc} ${Ho}`,viewBox:qr}),"RectangleScissor.FILL_INSIDE":Rt(Ot,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${Gc} ${Ho}`,viewBox:qr}),"RectangleScissor.FILL_OUTSIDE":Rt(Ot,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${Gc} ${Ho}`,viewBox:qr}),"RectangleScissor.ERASE_OUTSIDE":Rt(Ot,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${Gc} ${kc}`,viewBox:qr}),"RectangleScissor.ERASE_INSIDE":Rt(Ot,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${Gc} ${kc}`,viewBox:qr}),CircleScissor:Rt(Ot,{name:"CircleScissor",iconContent:`${qu} ${Ho}`,viewBox:qr}),"CircleScissor.FILL_INSIDE":Rt(Ot,{name:"CircleScissor.FILL_INSIDE",iconContent:`${qu} ${Ho}`,viewBox:qr}),"CircleScissor.ERASE_OUTSIDE":Rt(Ot,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${qu} ${kc}`,viewBox:qr}),"CircleScissor.FILL_OUTSIDE":Rt(Ot,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${qu} ${Ho}`,viewBox:qr})};function Rt(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function uG(t){return G7[t]}const fG=Object.keys(G7);class gG{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0,markerSize:"10",angleArcLineDash:""};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,n){let r=this.config.annotations;r||(this.config={...this.config,annotations:{}},r=this.config.annotations),r[e]=n}setViewportToolStyles(e,n){let r=this.config.viewports;r||(this.config={...this.config,viewports:{}},r=this.config.viewports),r[e]=n}setToolGroupToolStyles(e,n){let r=this.config.toolGroups;r||(this.config={...this.config,toolGroups:{}},r=this.config.toolGroups),r[e]=n}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,n){const{annotationUID:r,viewportId:i,toolGroupId:a,toolName:o}=n;return this._getToolStyle(e,r,i,a,o)}_getToolStyle(e,n,r,i,a){if(n){const s=this.getAnnotationToolStyles(n);if(s&&s[e]!==void 0)return s[e]}if(r){const s=this.getViewportToolStyles(r);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const o=this.getDefaultToolStyles();if(o[a]&&o[a][e]!==void 0)return o[a][e];if(o.global&&o.global[e]!==void 0)return o.global[e]}_initializeConfig(e){const n={};for(const r in e)n[r]=e[r];this.config={default:{global:n}}}}const dG=new gG;function hG(t,e,n){const r=[`${t}`];return e&&r.push(`${r[0]}${e}`),n&&r.push(`${r[r.length-1]}${n}`),r}function Tg(t,e,n,r){const i=hG(t,n,r);for(let a=i.length-1;a>=0;--a){const o=dG.getStyleProperty(i[a],e);if(o!==void 0)return o}}const pG="color",mG=ts.Highlighted,vG=rn.Active;class Rf extends yg{constructor(e,n,r,i,a){super(e,n,r,i,a)}static getDefinedCursor(e,n=!1,r){r||(r=Tg(pG,{},mG,vG));const i=yG(e,n,r);let a=super.getDefinedCursor(i);const o=Number(Tg("pointerStrokeWidth",{}));if(!a){const s=uG(e);s&&(a=TG(s,i,n,r,o,super.getDefinedCursor("default")),super.setDefinedCursor(i,a))}return a}}function B7(t,e){const n=Object(e),r=Object.prototype.hasOwnProperty.bind(n);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,a)=>r(a)?n[a]+"":"")}function yG(t,e,n){return`${e?"pointer":"cursor"}:${t}/${n}`}function TG(t,e,n,r,i,a){const{x:o,y:s}=t.mousePoint;return new Rf(CG(t,n,{color:r,pointerStrokeWidth:i}),o,s,e,a)}function CG(t,e,n){const r=wG(t,e,n);return`${URL.createObjectURL(r)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function wG(t,e,n){const r=(e?xG:SG)(t,n);return new Blob([r],{type:"image/svg+xml"})}function SG(t,e){const{iconContent:n,iconSize:r,viewBox:i}=t,a=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${r}" height="${r}" viewBox="0 0
      ${i.x} ${i.y}">
      ${n}
    </svg>`;return B7(a,e)}function xG(t,e){const{iconContent:n,iconSize:r,viewBox:i,mousePointerGroupString:a}=t,o=r/Math.max(i.x,i.y,1),s=16+r,c=e.pointerStrokeWidth||1,l=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g stroke-width="${c}">${a}</g>
      <g transform="translate(16, 16) scale(${o})">${n}</g>
    </svg>`;return B7(l,e)}const m3=Symbol("ElementCursorsMap");function EG(t,e){Kl(t)[0]=e,lp(t,e)}function lp(t,e){const n=Kl(t);n[1]=n[0],n[0]=e,t.style.cursor=(e instanceof ci?e:ci.getDefinedCursor("auto")).getStyleProperty()}function jl(t){lp(t,Kl(t)[1])}function gc(t){lp(t,ci.getDefinedCursor("none"))}function Kl(t){let e=Kl[m3];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(Kl,m3,{value:e}));let n=e.get(t);return n||(n=[null,null],e.set(t,n)),n}[...fG,...cG];function $7(t){return Ye.toolGroups.find(e=>e.id===t)}const{Active:el,Passive:md,Enabled:vd,Disabled:yd}=rn,OG=[{mouseButton:S0.Primary}];class up{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const n=this._toolInstances[e];if(!n){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return n}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,n={}){const r=Ye.tools[e],i=typeof e<"u"&&e!=="",a=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",n);return}if(!r){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(a){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:o}=r,s={name:e,toolGroupId:this.id,configuration:n},c=new o(s);this._toolInstances[e]=c}addToolInstance(e,n,r={}){let i=Ye.tools[e]?.toolClass;if(!i){const a=Ye.tools[n].toolClass;class o extends a{}o.toolName=e,i=o,Ye.tools[e]={toolClass:o}}this.addTool(i.toolName,r)}addViewport(e,n){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const r=this._findRenderingEngine(e,n);this.viewportsInfo.some(({viewportId:o})=>o===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:r});const i=this.getActivePrimaryMouseButtonTool();this.setViewportsCursorByToolName(i);const a={toolGroupId:this.id,viewportId:e,renderingEngineId:r};Oe(Me,fe.TOOLGROUP_VIEWPORT_ADDED,a)}removeViewports(e,n){const r=[];if(this.viewportsInfo.forEach((a,o)=>{let s=!1;a.renderingEngineId===e&&(s=!0,n&&a.viewportId!==n&&(s=!1)),s&&r.push(o)}),r.length)for(let a=r.length-1;a>=0;a--)this.viewportsInfo.splice(r[a],1);const i={toolGroupId:this.id,viewportId:n,renderingEngineId:e};Oe(Me,fe.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}r.setActiveStrategy(n)}setToolMode(e,n,r={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(n===rn.Active){this.setToolActive(e,r||this.restoreToolOptions[e]);return}if(n===rn.Passive){this.setToolPassive(e);return}if(n===rn.Enabled){this.setToolEnabled(e);return}if(n===rn.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,n={}){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!r){console.warn(`'${e}' instance ${r} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],a=n.bindings?n.bindings:[],s={bindings:[...i,...a].reduce((l,f)=>{const u=f.numTouchPoints!==void 0,g=f.mouseButton!==void 0;return!l.some(d=>Td(d,f))&&(u||g)&&l.push(f),l},[]),mode:el};if(this.toolOptions[e]=s,this._toolInstances[e].mode=el,this._hasMousePrimaryButtonBinding(n))this.setViewportsCursorByToolName(e),r.isPrimary=!0;else{if(!this.getActivePrimaryMouseButtonTool()){const f=ci.getDefinedCursor("default");this._setCursorForViewports(f)}r.isPrimary=!1}this._hasMousePrimaryButtonBinding(n)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof r.onSetToolActive=="function"&&r.onSetToolActive(),this._renderViewports();const c={toolGroupId:this.id,toolName:e,toolBindingsOptions:n};Oe(Me,fe.TOOL_ACTIVATED,c),this._triggerToolModeChangedEvent(e,el,n)}setToolPassive(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),a=Object.assign({bindings:i?i.bindings:[]},i,{mode:md}),o=Array.isArray(n?.removeAllBindings)?n.removeAllBindings:this.getDefaultPrimaryBindings();a.bindings=a.bindings.filter(c=>n?.removeAllBindings!==!0&&!o.some(l=>Td(c,l)));let s=md;a.bindings.length!==0&&(s=el,a.mode=s),this.toolOptions[e]=a,r.mode=s,r.isPrimary=!1,typeof r.onSetToolPassive=="function"&&r.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,md)}setToolEnabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:vd};this.toolOptions[e]=r,n.mode=vd,typeof n.onSetToolEnabled=="function"&&n.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,vd)}setToolDisabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:yd};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=r,n.mode=yd,typeof n.onSetToolDisabled=="function"&&n.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,yd)}getToolOptions(e){const n=this.toolOptions[e];if(n!==void 0)return n}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const n=this.toolOptions[e];return n.mode===el&&this._hasMousePrimaryButtonBinding(n)})}setViewportsCursorByToolName(e,n){const r=this._getCursor(e,n);this._setCursorForViewports(r)}_getCursor(e,n){let r,i;return n&&(r=`${e}.${n}`,i=Rf.getDefinedCursor(r,!0),i)||(r=`${e}`,i=Rf.getDefinedCursor(r,!0),i)||(r=e,i=Rf.getDefinedCursor(r,!0),i)?i:ci.getDefinedCursor("default")}_setCursorForViewports(e){cn.getRuntimeSettings().get("useCursors")&&this.viewportsInfo.forEach(({renderingEngineId:r,viewportId:i})=>{const a=U0(i,r);if(!a)return;const{viewport:o}=a;EG(o.element,e)})}setToolConfiguration(e,n,r){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let a;return r?a=n:a=Object.assign(i.configuration,n),i.configuration=a,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return S0.Primary}getDefaultPrimaryBindings(){return OG}getToolConfiguration(e,n){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const r=sG(this._toolInstances[e].configuration,n)||this._toolInstances[e].configuration;return Bi(r)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const n=this.getCurrentActivePrimaryToolName();this.setToolDisabled(n),this.setToolActive(e,{bindings:[{mouseButton:S0.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,n=null){let r=$7(e);return r?(console.debug(`ToolGroup ${e} already exists`),r):(r=new up(e),Ye.toolGroups.push(r),n=n??(()=>!0),Object.keys(this._toolInstances).filter(n).forEach(i=>{const a=this._toolInstances[i],o=this.toolOptions[i],s=a.mode;r.addTool(i),r.setToolMode(i,s,{bindings:o.bindings??[]})}),r)}_hasMousePrimaryButtonBinding(e){const n=this.getDefaultPrimaryBindings();return e?.bindings?.some(r=>n.some(i=>Td(r,i)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:n})=>{_c(e).renderViewport(n)})}_triggerToolModeChangedEvent(e,n,r){const i={toolGroupId:this.id,toolName:e,mode:n,toolBindingsOptions:r};Oe(Me,fe.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,n){const r=Da();if(r?.length===0)throw new Error("No rendering engines found.");if(n)return n;const i=r.filter(a=>a.getViewport(e));if(i.length===0){if(r.length===1)return r[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function Td(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function RG(t){if(Ye.toolGroups.some(r=>r.id===t)){console.warn(`'${t}' already exists.`);return}const n=new up(t);return Ye.toolGroups.push(n),n}function Mr(t,e){e||(e=Da().find(r=>r.getViewports().find(i=>i.id===t))?.id);const n=Ye.toolGroups.filter(r=>r.viewportsInfo.some(i=>i.renderingEngineId===e&&(!i.viewportId||i.viewportId===t)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return n[0]}}const DG=[rn.Active,rn.Passive,rn.Enabled];function MG(t){return Ye.toolGroups.filter(({toolOptions:e})=>{const n=Object.keys(e);for(let r=0;r<n.length;r++)if(t===n[r]&&e[t]&&DG.includes(e[t].mode))return!0;return!1})}function W7(t,e){const n=Ke(e),{renderingEngine:r,viewportId:i}=n,a=fe.ANNOTATION_ADDED,o={annotation:t,viewportId:i,renderingEngineId:r.id};Oe(Me,a,o)}function z7(t){const{toolName:e}=t.metadata,n=MG(e);if(!n.length)return;const r=[];n.forEach(o=>{o.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:l}=s,{FrameOfReferenceUID:f}=U0(l,c);t.metadata.FrameOfReferenceUID===f&&r.push(s)})});const i=fe.ANNOTATION_ADDED,a={annotation:t};if(!r.length){Oe(Me,i,a);return}r.forEach(({renderingEngineId:o,viewportId:s})=>{a.viewportId=s,a.renderingEngineId=o,Oe(Me,i,a)})}function o1(t){const e=fe.ANNOTATION_REMOVED;Oe(Me,e,t)}function Qr(t,e,n=Li.HandlesUpdated){const r=e&&Ke(e),{viewportId:i,renderingEngineId:a}=r||{},o=fe.ANNOTATION_MODIFIED;Oe(Me,o,{annotation:t,viewportId:i,renderingEngineId:a,changeType:n})}function Dh(t){H7({annotation:t})}function fp(t,e=!1){H7({annotation:t,contourHoleProcessingEnabled:e})}function H7(t){const e=fe.ANNOTATION_COMPLETED;Oe(Me,e,t)}const _G=Object.freeze(Object.defineProperty({__proto__:null,triggerAnnotationAddedForElement:W7,triggerAnnotationAddedForFOR:z7,triggerAnnotationCompleted:Dh,triggerAnnotationModified:Qr,triggerAnnotationRemoved:o1,triggerContourAnnotationCompleted:fp},Symbol.toStringTag,{value:"Module"}));let j7;function _a(){return j7}function gp(t){j7=t}function x0(t,e){const n=_a(),r=n.getGroupKey(e);return n.getAnnotations(r,t)}function mr(t){return _a().getAnnotation(t)}function dp(){return _a().getAllAnnotations()}function s1(t){const{annotationUID:e,parentAnnotationUID:n}=t;if(!n)return;const r=mr(n),i=r.childAnnotationUIDs.indexOf(e);r.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function du(t,e){const{annotationUID:n}=t,{annotationUID:r}=e;s1(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(r)&&(t.childAnnotationUIDs.push(r),e.parentAnnotationUID=n)}function K7(t){return t.parentAnnotationUID?mr(t.parentAnnotationUID):void 0}function c1(t){return t.childAnnotationUIDs?.map(e=>mr(e))??[]}function vo(t,e){t.annotationUID||(t.annotationUID=nr());const n=_a();if(e instanceof HTMLDivElement){const r=n.getGroupKey(e);n.addAnnotation(t,r),W7(t,e)}else n.addAnnotation(t,void 0),z7(t);return t.annotationUID}function IG(t,e){const n=_a(),r=n.getGroupKey(e);return n.getNumberOfAnnotations(r,t)}function yo(t){if(!t)return;const e=_a(),n=e.getAnnotation(t);n&&(n.childAnnotationUIDs?.forEach(r=>yo(r)),e.removeAnnotation(t),o1({annotation:n,annotationManagerUID:e.uid}))}function bG(){const t=_a(),e=t.removeAllAnnotations();for(const n of e)o1({annotation:n,annotationManagerUID:t.uid})}function LG(t,e){const n=_a(),r=n.getGroupKey(e),i=n.removeAnnotations(r,t);for(const a of i)o1({annotation:a,annotationManagerUID:n.uid})}function q7(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?mr(e.parentAnnotationUID):void 0}const VG=Object.freeze(Object.defineProperty({__proto__:null,addAnnotation:vo,addChildAnnotation:du,clearParentAnnotation:s1,getAllAnnotations:dp,getAnnotation:mr,getAnnotationManager:_a,getAnnotations:x0,getChildAnnotations:c1,getNumberOfAnnotations:IG,getParentAnnotation:K7,invalidateAnnotation:q7,removeAllAnnotations:bG,removeAnnotation:yo,removeAnnotations:LG,setAnnotationManager:gp},Symbol.toStringTag,{value:"Module"}));function Kc(t){const e=t.toolName;if(!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);Ye.tools[e]||(Ye.tools[e]={toolClass:t})}function l1(t){return!!(t&&Ye.tools[t])}function Ic(t,e){const n=e||t.currentTarget,{viewport:r}=Ke(n)||{};if(!r)return;const i=AG(t),a=NG(t),o=PG(n,a),s=r.canvasToWorld(o);return{page:a,client:i,canvas:o,world:s}}function PG(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function NG(t){return[t.pageX,t.pageY]}function AG(t){return[t.clientX,t.clientY]}function X7(t){const e=t.currentTarget,{viewportId:n,renderingEngineId:r}=Ke(e),i=Ic(t,e),a={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},o={event:t,eventName:fe.MOUSE_DOUBLE_CLICK,viewportId:n,renderingEngineId:r,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:a};!Oe(e,fe.MOUSE_DOUBLE_CLICK,o)&&(t.stopImmediatePropagation(),t.preventDefault())}const v3=fe.MOUSE_MOVE;function hu(t){const e=t.currentTarget,n=Ke(e);if(!n)return;const{renderingEngineId:r,viewportId:i}=n,a=Ic(t);!Oe(e,v3,{renderingEngineId:r,viewportId:i,camera:{},element:e,currentPoints:a,eventName:v3,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:y3,MOUSE_DOWN_ACTIVATE:FG,MOUSE_CLICK:UG,MOUSE_UP:kG,MOUSE_DRAG:T3}=fe,GG=400,BG=150,$G=3,WG={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let tt={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const kn={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function Y7(t){if(kn.doubleClickTimeout){if(t.buttons===kn.mouseDownEvent.buttons)return;kn.mouseDownEvent=t,Cg();return}kn.doubleClickTimeout=setTimeout(Cg,t.buttons===1?GG:BG),kn.mouseDownEvent=t,kn.ignoreDoubleClick=!1,tt.element=t.currentTarget,tt.mouseButton=t.buttons;const e=Ke(tt.element),{renderingEngineId:n,viewportId:r}=e;tt.renderingEngineId=n,tt.viewportId=r,tt.preventClickTimeout=setTimeout(HG,tt.clickDelay),tt.element.removeEventListener("mousemove",hu);const i=Ic(t,tt.element);tt.startPoints=cs(i),tt.lastPoints=cs(i),document.addEventListener("mouseup",hp),document.addEventListener("mousemove",Z7)}function zG(t){const e=u1(tt.startPoints,tt.startPoints),n={event:t,eventName:y3,element:tt.element,mouseButton:tt.mouseButton,renderingEngineId:tt.renderingEngineId,viewportId:tt.viewportId,camera:{},startPoints:tt.startPoints,lastPoints:tt.startPoints,currentPoints:tt.startPoints,deltaPoints:e};tt.lastPoints=cs(n.lastPoints),Oe(n.element,y3,n)&&Oe(n.element,FG,n)}function Z7(t){if(!Ke(tt.element)?.viewport)return;const n=Ic(t,tt.element),r=tT(tt.element,tt.lastPoints),i=u1(n,r);if(kn.doubleClickTimeout)if(Q7(i.canvas))Cg();else return;const a={event:t,eventName:T3,mouseButton:tt.mouseButton,renderingEngineId:tt.renderingEngineId,viewportId:tt.viewportId,camera:{},element:tt.element,startPoints:cs(tt.startPoints),lastPoints:cs(r),currentPoints:n,deltaPoints:i};!Oe(tt.element,T3,a)&&(t.stopImmediatePropagation(),t.preventDefault()),tt.lastPoints=cs(n)}function hp(t){if(clearTimeout(tt.preventClickTimeout),kn.doubleClickTimeout)kn.mouseUpEvent?Mh():(kn.mouseUpEvent=t,tt.element.addEventListener("mousemove",J7));else{const e=tt.isClickEvent?UG:kG,n=Ic(t,tt.element),r=u1(n,tt.lastPoints),i={event:t,eventName:e,mouseButton:tt.mouseButton,element:tt.element,renderingEngineId:tt.renderingEngineId,viewportId:tt.viewportId,camera:{},startPoints:cs(tt.startPoints),lastPoints:cs(tt.lastPoints),currentPoints:n,deltaPoints:r};Oe(i.element,e,i),Mh()}document.removeEventListener("mousemove",Z7)}function J7(t){const e=Ic(t,tt.element),n=tT(tt.element,tt.lastPoints),r=u1(e,n);Q7(r.canvas)&&(Cg(),hu(t))}function Q7(t){return Math.abs(t[0])+Math.abs(t[1])>$G}function HG(){tt.isClickEvent=!1}function Cg(){kn.ignoreDoubleClick=!0;const t=kn.mouseDownEvent,e=kn.mouseUpEvent;eT(),zG(t),e&&hp(e)}function eT(){kn.doubleClickTimeout&&(clearTimeout(kn.doubleClickTimeout),kn.doubleClickTimeout=null),kn.mouseDownEvent=null,kn.mouseUpEvent=null}function Mh(){document.removeEventListener("mouseup",hp),tt.element?.removeEventListener("mousemove",J7),tt.element?.addEventListener("mousemove",hu),eT(),tt=JSON.parse(JSON.stringify(WG))}function cs(t){return JSON.parse(JSON.stringify(t))}function tT(t,e){const{viewport:n}=Ke(t)||{};if(!n)return e;const r=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:r}}function u1(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:Cd(t.page,e.page),client:Cd(t.client,e.client),canvas:Cd(t.canvas,e.canvas),world:jG(t.world,e.world)}}function Cd(t,e){return[t[0]-e[0],t[1]-e[1]]}function jG(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function KG(){return tt.mouseButton}function nT(t){kn.ignoreDoubleClick?(kn.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):Mh()}function rT(t){t.removeEventListener("dblclick",X7),t.removeEventListener("mousedown",Y7),t.removeEventListener("mousemove",hu),t.removeEventListener("dblclick",nT,{capture:!0})}function qG(t){rT(t),t.addEventListener("dblclick",X7),t.addEventListener("mousedown",Y7),t.addEventListener("mousemove",hu),t.addEventListener("dblclick",nT,{capture:!0})}const iT={enable:qG,disable:rT},XG=2e3,E0={mouse:0,touch:1};let C3,w3;function aT(t,e){const n=Date.now();if(t!==C3){if(n-w3<=XG)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;C3=t}w3=n}const oT=aT.bind(null,E0.mouse),sT=aT.bind(null,E0.touch);function S3(t,e,n){const r=n?oT:sT;e.forEach(function(i){t.addEventListener(i,r,{passive:!1})})}function x3(t,e,n){const r=n?oT:sT;e.forEach(function(i){t.removeEventListener(i,r)})}const cT=["mousedown","mouseup","mousemove"],lT=["touchstart","touchend"];function uT(t){x3(t,cT,E0.mouse),x3(t,lT,E0.touch)}function YG(t){uT(t),S3(t,cT,E0.mouse),S3(t,lT,E0.touch)}const fT={enable:YG,disable:uT};function f1(t,e){const n=e||t.currentTarget,r=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(r).map(i=>{const a=QG(r[i]),o=JG(r[i]),s=ZG(n,o),{viewport:c}=Ke(n),l=c.canvasToWorld(s);return{page:o,client:a,canvas:s,world:l,touch:{identifier:i,radiusX:r[i].radiusX,radiusY:r[i].radiusY,force:r[i].force,rotationAngle:r[i].rotationAngle}}})}function ZG(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function JG(t){return[t.pageX,t.pageY]}function QG(t){return[t.clientX,t.clientY]}function _h(t,e){const n=wg(t),r=wg(e);return{page:wd(n.page,r.page),client:wd(n.client,r.client),canvas:wd(n.canvas,r.canvas),world:eB(n.world,r.world)}}function gT(t,e){const n=wg(t),r=wg(e);return{page:u0(n.page,r.page),client:u0(n.client,r.client),canvas:u0(n.canvas,r.canvas),world:dT(n.world,r.world)}}function Ih(t,e){const n=O3(t),r=O3(e);return{page:n.page-r.page,client:n.client-r.client,canvas:n.canvas-r.canvas,world:n.world-r.world}}function go(t){return JSON.parse(JSON.stringify(t))}function E3(t){return JSON.parse(JSON.stringify(t))}function wg(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function ya(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+n.touch.radiusX/t.length,radiusY:e.touch.radiusY+n.touch.radiusY/t.length,force:e.touch.force+n.touch.force/t.length,rotationAngle:e.touch.rotationAngle+n.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function wd(t,e){return[t[0]-e[0],t[1]-e[1]]}function eB(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function O3(t){const e=[];for(let n=0;n<t.length;n++)for(let r=0;r<t.length;r++)n<r&&e.push({page:u0(t[n].page,t[r].page),client:u0(t[n].client,t[r].client),canvas:u0(t[n].canvas,t[r].canvas),world:dT(t[n].world,t[r].world)});return e.reduce((n,r)=>({page:n.page+r.page/e.length,client:n.client+r.client/e.length,canvas:n.canvas+r.canvas/e.length,world:n.world+r.world/e.length}),{page:0,client:0,canvas:0,world:0})}function u0(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function dT(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}cn.getRuntimeSettings();const{TOUCH_START:R3,TOUCH_START_ACTIVATE:tB,TOUCH_PRESS:D3,TOUCH_DRAG:M3,TOUCH_END:_3,TOUCH_TAP:I3,TOUCH_SWIPE:Sd}=fe,ql={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},Sg={page:0,client:0,canvas:0,world:0},hT={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...ql,touch:null}],lastPointsList:[{...ql,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:Sg,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},pT={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...ql,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let Ue=JSON.parse(JSON.stringify(hT)),yn=JSON.parse(JSON.stringify(pT));function vs(t,e,n){return Oe(t,e,n)}function mT(t){Ue.element=t.currentTarget;const e=Ke(Ue.element),{renderingEngineId:n,viewportId:r}=e;Ue.renderingEngineId=n,Ue.viewportId=r,!Ue.isTouchStart&&(clearTimeout(Ue.pressTimeout),Ue.pressTimeout=setTimeout(()=>nB(t),Ue.pressDelay),rB(t),document.addEventListener("touchmove",vT),document.addEventListener("touchend",yT))}function nB(t){if(Ue.accumulatedDistance.canvas>Ue.pressMaxDistance)return;const n={event:t,eventName:D3,renderingEngineId:Ue.renderingEngineId,viewportId:Ue.viewportId,camera:{},element:Ue.element,startPointsList:go(Ue.startPointsList),lastPointsList:go(Ue.lastPointsList),startPoints:E3(ya(Ue.startPointsList)),lastPoints:E3(ya(Ue.lastPointsList))};vs(n.element,D3,n)}function rB(t){Ue.isTouchStart=!0,Ue.startTime=new Date;const e=f1(t,Ue.element),n=ya(e),r=ql,i=Sg,a={event:t,eventName:R3,element:Ue.element,renderingEngineId:Ue.renderingEngineId,viewportId:Ue.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:r,deltaDistance:i};Ue.startPointsList=go(a.startPointsList),Ue.lastPointsList=go(a.lastPointsList),vs(a.element,R3,a)&&vs(a.element,tB,a)}function vT(t){const e=f1(t,Ue.element),n=TT(Ue.element,Ue.lastPointsList),r=e.length===n.length?_h(e,n):ql,i=e.length===n.length?Ih(e,n):Sg,a=e.length===n.length?gT(e,Ue.lastPointsList):Sg;Ue.accumulatedDistance={page:Ue.accumulatedDistance.page+a.page,client:Ue.accumulatedDistance.client+a.client,canvas:Ue.accumulatedDistance.canvas+a.canvas,world:Ue.accumulatedDistance.world+a.world};const o={event:t,eventName:M3,renderingEngineId:Ue.renderingEngineId,viewportId:Ue.viewportId,camera:{},element:Ue.element,startPoints:ya(Ue.startPointsList),lastPoints:ya(n),currentPoints:ya(e),startPointsList:go(Ue.startPointsList),lastPointsList:go(n),currentPointsList:e,deltaPoints:r,deltaDistance:i};vs(Ue.element,M3,o),aB(t,r),Ue.lastPointsList=go(e)}function yT(t){clearTimeout(Ue.pressTimeout);const e=f1(t,Ue.element),n=TT(Ue.element,Ue.lastPointsList),r=e.length===n.length?_h(e,n):_h(e,e),i=e.length===n.length?Ih(e,n):Ih(e,e),a={event:t,eventName:_3,element:Ue.element,renderingEngineId:Ue.renderingEngineId,viewportId:Ue.viewportId,camera:{},startPointsList:go(Ue.startPointsList),lastPointsList:go(n),currentPointsList:e,startPoints:ya(Ue.startPointsList),lastPoints:ya(n),currentPoints:ya(e),deltaPoints:r,deltaDistance:i};vs(a.element,_3,a),iB(t),Ue=JSON.parse(JSON.stringify(hT)),document.removeEventListener("touchmove",vT),document.removeEventListener("touchend",yT)}function iB(t){const e=new Date().getTime(),n=Ue.startTime.getTime();if(e-n>yn.tapToleranceMs||(yn.taps===0&&(yn.element=Ue.element,yn.renderingEngineId=Ue.renderingEngineId,yn.viewportId=Ue.viewportId,yn.startPointsList=Ue.startPointsList),yn.taps>0&&!(yn.element==Ue.element&&yn.renderingEngineId==Ue.renderingEngineId&&yn.viewportId==Ue.viewportId)))return;const r=f1(t,yn.element);gT(r,yn.startPointsList).canvas>yn.tapMaxDistance||(clearTimeout(yn.tapTimeout),yn.taps+=1,yn.tapTimeout=setTimeout(()=>{const a={event:t,eventName:I3,element:yn.element,renderingEngineId:yn.renderingEngineId,viewportId:yn.viewportId,camera:{},currentPointsList:r,currentPoints:ya(r),taps:yn.taps};vs(a.element,I3,a),yn=JSON.parse(JSON.stringify(pT))},yn.tapToleranceMs))}function aB(t,e){const n=new Date().getTime(),r=Ue.startTime.getTime();if(Ue.swiped||n-r>Ue.swipeToleranceMs)return;const[i,a]=e.canvas,o={event:t,eventName:Sd,renderingEngineId:Ue.renderingEngineId,viewportId:Ue.viewportId,camera:{},element:Ue.element,swipe:null};Math.abs(i)>Ue.swipeDistanceThreshold&&(o.swipe=i>0?Yc.RIGHT:Yc.LEFT,vs(o.element,Sd,o),Ue.swiped=!0),Math.abs(a)>Ue.swipeDistanceThreshold&&(o.swipe=a>0?Yc.DOWN:Yc.UP,vs(o.element,Sd,o),Ue.swiped=!0)}function TT(t,e){const{viewport:n}=Ke(t);return e.map(r=>{const i=n.canvasToWorld(r.canvas);return{page:r.page,client:r.client,canvas:r.canvas,world:i,touch:r.touch}})}function CT(t){fT.disable(t),t.removeEventListener("touchstart",mT)}function oB(t){CT(t),fT.enable(t),t.addEventListener("touchstart",mT,{passive:!1})}const wT={enable:oB,disable:CT},b3=10,L3=40,V3=800;function sB(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),r=e*b3,i=n*b3,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=L3,i*=L3):(r*=V3,i*=V3)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:i}}function ST(t){const e=t.currentTarget,n=Ke(e),{renderingEngineId:r,viewportId:i}=n;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:a,spinY:o,pixelX:s,pixelY:c}=sB(t),l=o<0?-1:1,f={event:t,eventName:fe.MOUSE_WHEEL,renderingEngineId:r,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:a,spinY:o,pixelX:s,pixelY:c,direction:l},points:Ic(t)};Oe(e,fe.MOUSE_WHEEL,f)}function cB(t){xT(t),t.addEventListener("wheel",ST,{passive:!1})}function xT(t){t.removeEventListener("wheel",ST)}const ET={enable:cB,disable:xT},lB={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Dn={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function g1(t){Dn.element=t.currentTarget;const e=Ke(Dn.element),{renderingEngineId:n,viewportId:r}=e;Dn.renderingEngineId=n,Dn.viewportId=r,Dn.key=t.key,Dn.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:Dn.renderingEngineId,viewportId:Dn.viewportId,element:Dn.element,key:Dn.key,keyCode:Dn.keyCode};Oe(i.element,fe.KEY_DOWN,i),document.addEventListener("keyup",OT),document.addEventListener("visibilitychange",pp),Dn.element.removeEventListener("keydown",g1)}function pp(){document.removeEventListener("visibilitychange",pp),document.visibilityState==="hidden"&&RT()}function OT(t){const e={renderingEngineId:Dn.renderingEngineId,viewportId:Dn.viewportId,element:Dn.element,key:Dn.key,keyCode:Dn.keyCode};document.removeEventListener("keyup",OT),document.removeEventListener("visibilitychange",pp),Dn.element.addEventListener("keydown",g1),Dn=structuredClone(lB),Oe(e.element,fe.KEY_UP,e)}function uB(){return Dn.keyCode}function RT(){Dn.keyCode=void 0}function fB(t){DT(t),t.addEventListener("keydown",g1)}function DT(t){t.removeEventListener("keydown",g1)}const k0={enable:fB,disable:DT,getModifierKey:uB},mp=new Map,gB=t=>{const e=mp.get(t);e&&(e.isDirty=!0)},dB=t=>{const e=mp.get(t);return e&&!e.isDirty?e.indices:null},hB=(t,e)=>{mp.set(t,{indices:e,isDirty:!1})};function d1(t,e,n){const r={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:n};gB(t),Oe(Me,fe.SEGMENTATION_DATA_MODIFIED,r)}function vp(t){const e={segmentationId:t};Oe(Me,fe.SEGMENTATION_MODIFIED,e)}function pB(t){const e={segmentationId:t};Oe(Me,fe.SEGMENTATION_REMOVED,e)}function Xu(t,e,n){const r={segmentationId:e,type:n,viewportId:t};Oe(Me,fe.SEGMENTATION_REPRESENTATION_MODIFIED,r)}function P3(t,e,n){const r={viewportId:t,segmentationId:e,type:n};Oe(Me,fe.SEGMENTATION_REPRESENTATION_REMOVED,r)}const mB={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function vB(){return mB}const yB={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function TB(){return yB}class CB{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,n,r=!0){const{viewportId:i,segmentationId:a,type:o,segmentIndex:s}=e,c=this.getStyle(e),l=r?{...c,...n}:n;let f;if(!i&&!a?f=l:r?f=this.copyActiveToInactiveIfNotProvided(l,o):f=l,!o)throw new Error("Type is required to set a style");if(i){this.config.viewportsStyle[i]||(this.config.viewportsStyle[i]={renderInactiveSegmentations:!1,representations:{}});const u=this.config.viewportsStyle[i].representations;if(a){u[a]||(u[a]={}),u[a][o]||(u[a][o]={});const g=u[a][o];s!==void 0?(g.perSegment||(g.perSegment={}),g.perSegment[s]=f):g.allSegments=f}else{const g="__allSegmentations__";u[g]||(u[g]={}),u[g][o]||(u[g][o]={}),u[g][o].allSegments=f}}else if(a){this.config.segmentations[a]||(this.config.segmentations[a]={}),this.config.segmentations[a][o]||(this.config.segmentations[a][o]={});const u=this.config.segmentations[a][o];s!==void 0?(u.perSegment||(u.perSegment={}),u.perSegment[s]=f):u.allSegments=f}else this.config.global[o]=f}copyActiveToInactiveIfNotProvided(e,n){const r={...e};if(n===nt.Labelmap){const i=r;i.renderOutlineInactive??=i.renderOutline,i.outlineWidthInactive??=i.outlineWidth,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha,i.outlineOpacityInactive??=i.outlineOpacity}else if(n===nt.Contour){const i=r;i.outlineWidthInactive??=i.outlineWidth,i.outlineOpacityInactive??=i.outlineOpacity,i.outlineDashInactive??=i.outlineDash,i.renderOutlineInactive??=i.renderOutline,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha}return r}getStyle(e){const{viewportId:n,segmentationId:r,type:i,segmentIndex:a}=e;let o=this.getDefaultStyle(i);if(this.config.global[i]&&(o={...o,...this.config.global[i]}),this.config.segmentations[r]?.[i]&&(o={...o,...this.config.segmentations[r][i].allSegments},a!==void 0&&this.config.segmentations[r][i].perSegment?.[a]&&(o={...o,...this.config.segmentations[r][i].perSegment[a]})),n&&this.config.viewportsStyle[n]){this.config.viewportsStyle[n].renderInactiveSegmentations;const s="__allSegmentations__";this.config.viewportsStyle[n].representations[s]?.[i]&&(o={...o,...this.config.viewportsStyle[n].representations[s][i].allSegments}),r&&this.config.viewportsStyle[n].representations[r]?.[i]&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].allSegments},a!==void 0&&this.config.viewportsStyle[n].representations[r][i].perSegment?.[a]&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].perSegment[a]}))}return o}getRenderInactiveSegmentations(e){return this.config.viewportsStyle[e]?.renderInactiveSegmentations}setRenderInactiveSegmentations(e,n){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=n}getDefaultStyle(e){switch(e){case nt.Labelmap:return TB();case nt.Contour:return vB();case nt.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const r=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:r,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:n}=e,r=this.getStyle(e),i=this.getDefaultStyle(n);return!L7(r,i)}}const dc=new CB;function wB(t){const e={segmentationId:t};Oe(Me,fe.SEGMENTATION_ADDED,e)}const N3={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class SB{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,this._labelmapImageIdReferenceMap=new Map,e||=nr(),this.state=Object.freeze(Bi(N3)),this.uid=e}getState(){return this.state}updateState(e){const n=Bi(this.state);e(n),this.state=Object.freeze(n)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this._stackLabelmapImageIdReferenceMap.clear(),this._labelmapImageIdReferenceMap.clear(),this.state=Object.freeze(Bi(N3))}getSegmentation(e){return this.state.segmentations.find(n=>n.segmentationId===e)}updateSegmentation(e,n){this.updateState(r=>{const i=r.segmentations.find(a=>a.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,n)}),vp(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(n=>{const r=Bi(e);if(r.representationData.Labelmap&&"volumeId"in r.representationData.Labelmap&&!("imageIds"in r.representationData.Labelmap)){const i=this.getLabelmapImageIds(r.representationData);r.representationData.Labelmap.imageIds=i}n.segmentations.push(r)}),wB(e.segmentationId)}removeSegmentation(e){this.updateState(n=>{const r=n.segmentations.filter(i=>i.segmentationId!==e);n.segmentations.splice(0,n.segmentations.length,...r)}),pB(e)}addSegmentationRepresentation(e,n,r,i){if(!Un(e))return;if(this.getSegmentationRepresentations(e,{type:r,segmentationId:n}).length>0){console.debug("A segmentation representation of type",r,"already exists in viewport",e,"for segmentation",n);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],dc.setRenderInactiveSegmentations(e,!0)),r!==nt.Labelmap?this.addDefaultSegmentationRepresentation(s,e,n,r,i):this.addLabelmapRepresentation(s,e,n,i)}),Xu(e,n,r)}addDefaultSegmentationRepresentation(e,n,r,i,a){const o=e.segmentations.find(c=>c.segmentationId===r);if(!o)return;const s={};Object.keys(o.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[n].push({segmentationId:r,type:i,active:!0,visible:!0,colorLUTIndex:a?.colorLUTIndex||0,segments:s,config:{...A3(i),...a}}),this._setActiveSegmentation(e,n,r)}addLabelmapRepresentation(e,n,r,i=A3(nt.Labelmap)){if(!Un(n))return;const o=this.getSegmentation(r);if(!o)return;const{representationData:s}=o;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,n,r,nt.Labelmap,i);this.processLabelmapRepresentationAddition(n,r),this.addDefaultSegmentationRepresentation(e,n,r,nt.Labelmap,i)}async processLabelmapRepresentationAddition(e,n){const r=Un(e);if(!r)return;const i=this.getSegmentation(n);if(!i)return;const a=r.viewport instanceof mi,{representationData:o}=i,s="volumeId"in o.Labelmap;r.viewport,!a&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,n,r,i){const a=n.getCurrentImageId();let o=!1;for(const s of r)n.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(o=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(a,s),this._updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:a,labelmapImageId:s}));return i&&i(n,e,r),o?this._stackLabelmapImageIdReferenceMap.get(e).get(a):void 0}updateLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=Un(e).viewport;return this._updateLabelmapSegmentationReferences(n,s,a,null)}_updateAllLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=Un(e).viewport;this._updateLabelmapSegmentationReferences(n,s,a,(c,l,f)=>{c.getImageIds().forEach((g,d)=>{for(const p of f)c.isReferenceViewable({referencedImageId:p,sliceIndex:d},{asOverlay:!0,withNavigation:!0})&&(this._stackLabelmapImageIdReferenceMap.get(l).set(g,p),this._updateLabelmapImageIdReferenceMap({segmentationId:l,referenceImageId:g,labelmapImageId:p}))})})}getLabelmapImageIds(e){const n=e.Labelmap;let r;if(n.imageIds)r=n.imageIds;else if(!r&&n.volumeId){const i=n.volumeId;r=Ve.getVolume(i).imageIds}return r}getLabelmapImageIdsForImageId(e,n){const r=this._generateMapKey({segmentationId:n,referenceImageId:e});return this._labelmapImageIdReferenceMap.get(r)}getCurrentLabelmapImageIdsForViewport(e,n){const r=Un(e);if(!r)return;const a=r.viewport.getCurrentImageId();return this.getLabelmapImageIdsForImageId(a,n)}getCurrentLabelmapImageIdForViewport(e,n){const r=Un(e);if(!r||!this._stackLabelmapImageIdReferenceMap.has(n))return;const a=r.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(n).get(a)}getStackSegmentationImageIdsForViewport(e,n){if(!this.getSegmentation(n))return[];this._updateAllLabelmapSegmentationImageReferences(e,n);const{viewport:i}=Un(e),a=i.getImageIds(),o=this._stackLabelmapImageIdReferenceMap.get(n);return a.map(s=>o.get(s))}removeSegmentationRepresentationsInternal(e,n){const r=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const a=i.viewportSegRepresentations[e];let o=!1;if(!n||Object.values(n).every(s=>s===void 0))r.push(...a),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=n;i.viewportSegRepresentations[e]=a.filter(l=>{const f=s&&c&&l.segmentationId===s&&l.type===c||s&&!c&&l.segmentationId===s||!s&&c&&l.type===c;return f&&(r.push(l),l.active&&(o=!0)),!f}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:o&&(i.viewportSegRepresentations[e][0].active=!0)}}),r}removeSegmentationRepresentations(e,n){const r=this.removeSegmentationRepresentationsInternal(e,n);r.forEach(a=>{P3(e,a.segmentationId,a.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&Xu(e,i[0].segmentationId,i[0].type),r}removeSegmentationRepresentation(e,n,r){const i=this.removeSegmentationRepresentationsInternal(e,n);return r||i.forEach(({segmentationId:a,type:o})=>{P3(e,a,o)}),i}_updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:n,labelmapImageId:r}){const i=this._generateMapKey({segmentationId:e,referenceImageId:n});if(!this._labelmapImageIdReferenceMap.has(i)){this._labelmapImageIdReferenceMap.set(i,[r]);return}const a=this._labelmapImageIdReferenceMap.get(i),o=Array.from(new Set([...a,r]));this._labelmapImageIdReferenceMap.set(i,o)}_setActiveSegmentation(e,n,r){const i=e.viewportSegRepresentations[n];i&&i.forEach(a=>{a.active=a.segmentationId===r})}setActiveSegmentation(e,n){this.updateState(r=>{const i=r.viewportSegRepresentations[e];i&&i.forEach(a=>{a.active=a.segmentationId===n})}),Xu(e,n)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const n=this.state.viewportSegRepresentations[e].find(r=>r.active);if(n)return this.getSegmentation(n.segmentationId)}getSegmentationRepresentations(e,n={}){const r=this.state.viewportSegRepresentations[e];return r?!n.type&&!n.segmentationId?r:r.filter(i=>{const a=n.type?i.type===n.type:!0,o=n.segmentationId?i.segmentationId===n.segmentationId:!0;return a&&o}):[]}getSegmentationRepresentation(e,n){return this.getSegmentationRepresentations(e,n)[0]}getSegmentationRepresentationVisibility(e,n){return this.getSegmentationRepresentation(e,n)?.visible}setSegmentationRepresentationVisibility(e,n,r){this.updateState(i=>{const a=this.getSegmentationRepresentations(e,n);a&&a.forEach(o=>{o.visible=r,Object.entries(o.segments).forEach(([s,c])=>{c.visible=r})})}),Xu(e,n.segmentationId,n.type)}addColorLUT(e,n){this.updateState(r=>{r.colorLUT[n]&&console.warn("Color LUT table already exists, overwriting"),r.colorLUT[n]=Bi(e)})}removeColorLUT(e){this.updateState(n=>{delete n.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(n=>n.slice(-Math.round(n.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,n])=>({viewportId:e,representations:n}))}getSegmentationRepresentationsBySegmentationId(e){const n=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([r,i])=>{const a=i.filter(o=>o.segmentationId===e);a.length>0&&n.push({viewportId:r,representations:a})}),n}_generateMapKey({segmentationId:e,referenceImageId:n}){return`${e}-${n}`}}function A3(t){const e=po.newInstance(),n=Cc.newInstance();return n.addPoint(0,0),t===nt.Labelmap?{cfun:e,ofun:n}:{}}const qi=new SB("DEFAULT");function Wr(t){return qi.getSegmentation(t)}function hc(t,e={}){return qi.getSegmentationRepresentations(t,e)}function xB(t,e){const n=qi;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");return n.getSegmentationRepresentations(t,e)?.[0]}function EB(t,e){const n=Ke(t),{viewport:r}=n,a=r.getActors().filter(o=>o.representationUID&&typeof o.representationUID=="string"&&o.representationUID.startsWith(e));r.removeActors(a.map(o=>o.uid))}function MT(t,e,n){const r=Un(t);if(!r)return;const{renderingEngine:i,viewport:a}=r;if(!i||!a)return;const s=a.getActors().filter(n);return s.length>0?s[0]:void 0}function OB(t,e){const n=Un(t);if(!n)return;const{renderingEngine:r,viewport:i}=n;if(!r||!i)return;const o=i.getActors().filter(e);return o.length>0?o:void 0}function RB(t,e){return DB(t,e)?.uid}function Ol(t,e){return OB(t,n=>n.representationUID?.startsWith(`${e}-${nt.Labelmap}`))}function DB(t,e){return MT(t,e,n=>n.representationUID?.startsWith(`${e}-${nt.Labelmap}`))}function MB(t,e,n){return MT(t,e,r=>r.representationUID===_T(e,n))}function _T(t,e){return`${t}-${nt.Surface}-${e}`}function _B(t,e,n){const i=MB(t.id,n,e.segmentIndex)?.actor,a=e.visible;if(i){if(i.setVisibility(a),!a)return;const h=i.getMapper(),m=h.getInputData(),v=e.points,y=e.polys,T=m.getPoints().getData(),C=m.getPolys().getData();if(v.length===T.length&&y.length===C.length)return;const w=uo.newInstance();w.getPoints().setData(v,3);const S=wc.newInstance({values:Float32Array.from(y)});w.setPolys(S),h.setInputData(w),h.modified(),t.getRenderer().resetCameraClippingRange();return}const o=e.points,s=e.polys,c=e.color,l=uo.newInstance();l.getPoints().setData(o,3);const f=wc.newInstance({values:Float32Array.from(s)});l.setPolys(f);const u=oy.newInstance({});let g;u.setInputData(l);const d=KN.newInstance();d.setMapper(u),d.getProperty().setColor(c[0]/255,c[1]/255,c[2]/255),d.getProperty().setLineWidth(2);const p=_T(n,e.segmentIndex);t.addActor({uid:nr(),actor:d,clippingFilter:g,representationUID:p}),t.resetCamera(),t.getRenderer().resetCameraClippingRange(),t.render()}function yp(t){return qi.getColorLUT(t)}let bh={};function IB(t){bh=t}let F3=!1;function Ta(){if(!bh.addons?.polySeg)return console.warn("PolySeg add-on not configured. This will prevent automatic conversion between segmentation representations (labelmap, contour, surface). To enable these features, install @cornerstonejs/polymorphic-segmentation and register it during initialization: cornerstoneTools.init({ addons: { polySeg } })."),null;const t=bh.addons.polySeg;return F3||(t.init(),F3=!0),t}function bB({segmentationId:t,type:e,data:n}){const r=Wr(t);if(!r)throw new Error(`Segmentation ${t} not found`);switch(r.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case nt.Labelmap:n&&(r.representationData[e]=n);break;case nt.Contour:n&&(r.representationData[e]=n);break;case nt.Surface:n&&(r.representationData[e]=n);break;default:throw new Error(`Invalid representation type ${e}`)}}async function Tp(t,e,n,r){const i=await n();return bB({segmentationId:t,type:e,data:i}),r?.(),i}function Cp(t,e){const n=xB(t,e);return n?Object.entries(n.segments).reduce((i,[a,o])=>(o.visible||i.add(Number(a)),i),new Set):new Set}function LB(t,e,n=!1){const r=Un(t);if(!r)return;const{viewport:i}=r;EB(i.element,e),n&&i.render()}async function VB(t,e){const{segmentationId:n,type:r}=e,i=Wr(n);if(!i)return;let a=i.representationData[nt.Surface];if(!a&&Ta()?.canComputeRequestedRepresentation(n,nt.Surface)){const l=Ta();if(a=await Tp(n,nt.Surface,()=>l.computeSurfaceData(n,{viewport:t})),!a)throw new Error(`No Surface data found for segmentationId ${n} even we tried to compute it`)}else!a&&!Ta()&&console.debug(`No surface data found for segmentationId ${n} and PolySeg add-on is not configured. Unable to convert from other representations to surface. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(!a){console.warn(`No Surface data found for segmentationId ${n}. Skipping render.`);return}const{geometryIds:o}=a;o?.size||console.warn(`No Surfaces found for segmentationId ${n}. Skipping render.`);const{colorLUTIndex:s}=e,c=yp(s);o.forEach(l=>{const f=Ve.getGeometry(l);if(!f?.data){console.warn(`No Surfaces found for geometryId ${l}. Skipping render.`);return}const{segmentIndex:u}=f.data,d=Cp(t.id,{segmentationId:n,type:r}).has(u),p=f.data,h=c[u];p.color=h.slice(0,3),p.visible=!d,_B(t,p,n)}),t.render()}function PB(t){const e=Ta();return n=>e.updateSurfaceData(n,{viewport:t})}const IT={getUpdateFunction:PB,render:VB,removeRepresentation:LB};function NB(t,e,n){const r=t.getImageIds();if(!r||!r.length)return;const i=r.map(a=>{const{imagePositionPatient:o}=Pe("imagePlaneModule",a),s=AB(e,o,n);return{imageId:a,distance:s}});return i.sort((a,o)=>a.distance-o.distance),i[0].imageId}function AB(t,e,n){const r=Ie();Ut(r,t,e);const i=He(r,n);return Math.abs(i)}function FB(t,e){const{segmentation:n}=t.data,{segmentation:r}=e.data;return n.segmentationId===r.segmentationId&&n.segmentIndex===r.segmentIndex}class UB{constructor(e){this.getGroupKey=n=>{if(typeof n=="string")return n;const i=Ke(n);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=n=>{const r=n.detail,{FrameOfReferenceUID:i}=r,o=this.annotations[i];o&&Object.keys(o).forEach(s=>{o[s].forEach(l=>{l.invalidated!==void 0&&(l.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(n,r)=>{const i=this.annotations;return i[n]?r?i[n][r]?i[n][r]:[]:i[n]:[]},this.getAnnotation=n=>{const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];for(const c of s)if(n===c.annotationUID)return c}}},this.getNumberOfAnnotations=(n,r)=>{const i=this.getAnnotations(n,r);if(!i.length)return 0;if(r)return i.length;let a=0;for(const o in i)a+=i[o].length;return a},this.addAnnotation=(n,r)=>{const{metadata:i}=n,{FrameOfReferenceUID:a,toolName:o}=i;r=r||a;const s=this.annotations;let c=s[r];c||(s[r]={},c=s[r]);let l=c[o];l||(c[o]=[],l=c[o]),this.preprocessingFn&&(n=this.preprocessingFn(n)),l.push(n)},this.removeAnnotation=n=>{const{annotations:r}=this;for(const i in r){const a=r[i];for(const o in a){const s=a[o],c=s.findIndex(l=>l.annotationUID===n);c!==-1&&(s.splice(c,1),s.length===0&&delete a[o])}Object.keys(a).length===0&&delete r[i]}},this.removeAnnotations=(n,r)=>{const i=this.annotations,a=[];if(!i[n])return a;if(r){const o=i[n][r];if(o)for(const s of o)this.removeAnnotation(s.annotationUID),a.push(s)}else for(const o in i[n]){const s=i[n][o];for(const c of s)this.removeAnnotation(c.annotationUID),a.push(c)}return a},this.saveAnnotations=(n,r)=>{const i=this.annotations;if(n&&r){const a=i[n];if(!a)return;const o=a[r];return structuredClone(o)}else if(n){const a=i[n];return structuredClone(a)}return structuredClone(i)},this.restoreAnnotations=(n,r,i)=>{const a=this.annotations;if(r&&i){let o=a[r];o||(a[r]={},o=a[r]),o[i]=n}else r?a[r]=n:this.annotations=structuredClone(n)},this.getAllAnnotations=()=>Object.values(this.annotations).map(n=>Object.values(n)).flat(2),this.getNumberOfAllAnnotations=()=>{let n=0;const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];n+=s.length}}return n},this.removeAllAnnotations=()=>{const n=[];for(const r of this.getAllAnnotations())this.removeAnnotation(r.annotationUID),n.push(r);return n},e||(e=nr()),this.annotations={},this.uid=e,Me.addEventListener(Ee.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const kB=new UB("DEFAULT"),Df=new Set;function bT(t,e=!0){const n=BB();t&&(e?$B(t,Df,n):WB(t,Df,n)),zB(n,Df)}function xc(t){return Df.has(t)}function GB(t){const e=xc(t);return bT(t,e),e}function BB(){return Object.freeze({added:[],removed:[],locked:[]})}function $B(t,e,n){if(!e.has(t)){e.add(t),n.added.push(t);const r=mr(t);r&&(r.isLocked=!0)}}function WB(t,e,n){if(e.delete(t)){n.removed.push(t);const r=mr(t);r&&(r.isLocked=!1)}}function zB(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>{t.locked.push(n)}),Oe(Me,fe.ANNOTATION_LOCK_CHANGE,t))}const rs=new Set;function Ca(t,e=!0,n=!1){e?HB(t,n):LT(t)}function HB(t,e=!1){const n=VT();if(!e){PT(rs,n);const r=mr(t);r&&(r.isSelected=!0)}if(t&&!rs.has(t)){rs.add(t),n.added.push(t);const r=mr(t);r&&(r.isSelected=!0)}NT(n,rs)}function LT(t){const e=VT();if(t){if(rs.delete(t)){e.removed.push(t);const n=mr(t);n.isSelected=!1}}else PT(rs,e);NT(e,rs)}function h1(t){return rs.has(t)}function VT(){return Object.freeze({added:[],removed:[],selection:[]})}function PT(t,e){t.forEach(n=>{if(t.delete(n)){e.removed.push(n);const r=mr(n);r&&(r.isSelected=!1)}})}function NT(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>{t.selection.push(n)}),Oe(Me,fe.ANNOTATION_SELECTION_CHANGE,t))}const jB=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),KB=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),Xl=new Set;function qB(t,e=!0){const n=XB();t&&(e?YB(t,Xl,n):ZB(t,Xl,n)),JB(n)}function Yl(t){if(mr(t))return!Xl.has(t)}function XB(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function YB(t,e,n){if(e.delete(t)){n.lastVisible.push(t);const r=mr(t);r.isVisible=!0}}function ZB(t,e,n){if(!e.has(t)){e.add(t),h1(t)&&LT(t),n.lastHidden.push(t);const r=mr(t);r.isVisible=!1}}function JB(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(Xl.forEach(e=>{t.hidden.push(e)}),Oe(Me,fe.ANNOTATION_VISIBILITY_CHANGE,t))}function QB(t){const e=!Xl.has(t);return qB(t,e),e}const wp=kB,e$=t=>{t=jB(t),t=KB(t);const e=t.annotationUID,n=GB(e);t.isLocked=n;const r=QB(e);return t.isVisible=r,t};wp.setPreprocessingFn(e$);gp(wp);function t$(){gp(wp)}function Ec(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=Wr(e),{annotationUIDsMap:i}=r?.representationData.Contour||{},a=i?.get(n);a&&(a.delete(t.annotationUID),a.size||i.delete(n))}function Oc(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=Wr(e);r.representationData.Contour||(r.representationData.Contour={annotationUIDsMap:new Map});let{annotationUIDsMap:i}=r.representationData.Contour;i||(i=new Map);let a=i?.get(n);a||(a=new Set,i.set(n,a)),r.segments[n].locked&&bT(t.annotationUID,!0),i.set(n,a.add(t.annotationUID))}function AT(t){const r=qi.getState().viewportSegRepresentations;return Object.entries(r).filter(([,a])=>a.some(o=>o.segmentationId===t)).map(([a])=>a)}var di;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(di||(di={}));function n$(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}class r${}const{PointsManager:i$}=Ma;function Lh(t){return{max:[-1/0],min:[1/0],sum:[0],count:0,maxIJK:null,maxLPS:null,minIJK:null,minLPS:null,runMean:[0],m2:[0],m3:[0],m4:[0],allValues:[[]],pointsInShape:t?i$.create3(1024):null,sumLPS:[0,0,0]}}function a$(t,e,n=null,r=null){Array.isArray(e)&&e.length>1&&t.max.length===1&&(t.max.push(t.max[0],t.max[0]),t.min.push(t.min[0],t.min[0]),t.sum.push(t.sum[0],t.sum[0]),t.runMean.push(0,0),t.m2.push(t.m2[0],t.m2[0]),t.m3.push(t.m3[0],t.m3[0]),t.m4.push(t.m4[0],t.m4[0]),t.allValues.push([],[])),t?.pointsInShape&&n&&t.pointsInShape.push(n);const i=Array.isArray(e)?e:[e];t.count+=1,n&&(t.sumLPS[0]+=n[0],t.sumLPS[1]+=n[1],t.sumLPS[2]+=n[2]),t.max.forEach((a,o)=>{const s=i[o];t.allValues[o].push(s);const c=t.count,l=s-t.runMean[o],f=l/c,u=l*f*(c-1);t.sum[o]+=s,t.runMean[o]+=f,t.m4[o]+=u*f*f*(c*c-3*c+3)+6*f*f*t.m2[o]-4*f*t.m3[o],t.m3[o]+=u*f*(c-2)-3*f*t.m2[o],t.m2[o]+=u,s<t.min[o]&&(t.min[o]=s,o===0&&(t.minIJK=r?[...r]:null,t.minLPS=n?[...n]:null)),s>t.max[o]&&(t.max[o]=s,o===0&&(t.maxIJK=r?[...r]:null,t.maxLPS=n?[...n]:null))})}function o$(t){if(t.length===0)return 0;const e=[...t].sort((r,i)=>r-i),n=Math.floor(e.length/2);return e.length%2===0?(e[n-1]+e[n])/2:e[n]}function s$(t,e){const n=t.sum.map(u=>u/t.count),r=t.m2.map(u=>Math.sqrt(u/t.count)),i=t.sumLPS.map(u=>u/t.count),a=t.m3.map((u,g)=>{const d=t.m2[g]/t.count;return d===0?0:u/(t.count*Math.pow(d,1.5))}),o=t.m4.map((u,g)=>{const d=t.m2[g]/t.count;return d===0?0:u/(t.count*d*d)-3}),s=t.allValues.map(u=>o$(u)),c={max:{name:"max",label:"Max Pixel",value:t.max.length===1?t.max[0]:t.max,unit:e,pointIJK:t.maxIJK?[...t.maxIJK]:null,pointLPS:t.maxLPS?[...t.maxLPS]:null},min:{name:"min",label:"Min Pixel",value:t.min.length===1?t.min[0]:t.min,unit:e,pointIJK:t.minIJK?[...t.minIJK]:null,pointLPS:t.minLPS?[...t.minLPS]:null},mean:{name:"mean",label:"Mean Pixel",value:n.length===1?n[0]:n,unit:e},stdDev:{name:"stdDev",label:"Standard Deviation",value:r.length===1?r[0]:r,unit:e},count:{name:"count",label:"Voxel Count",value:t.count,unit:null},median:{name:"median",label:"Median",value:s.length===1?s[0]:s,unit:e},skewness:{name:"skewness",label:"Skewness",value:a.length===1?a[0]:a,unit:null},kurtosis:{name:"kurtosis",label:"Kurtosis",value:o.length===1?o[0]:o,unit:null},maxLPS:{name:"maxLPS",label:"Max LPS",value:t.maxLPS?Array.from(t.maxLPS):null,unit:null},minLPS:{name:"minLPS",label:"Min LPS",value:t.minLPS?Array.from(t.minLPS):null,unit:null},pointsInShape:t.pointsInShape,center:{name:"center",label:"Center",value:i?[...i]:null,unit:null},array:[]};c.array.push(c.min,c.max,c.mean,c.stdDev,c.median,c.skewness,c.kurtosis,c.count,c.maxLPS,c.minLPS),c.center.value&&c.array.push(c.center);const l=t.pointsInShape!==null,f=Lh(l);return t.max=f.max,t.min=f.min,t.sum=f.sum,t.count=f.count,t.maxIJK=f.maxIJK,t.maxLPS=f.maxLPS,t.minIJK=f.minIJK,t.minLPS=f.minLPS,t.runMean=f.runMean,t.m2=f.m2,t.m3=f.m3,t.m4=f.m4,t.allValues=f.allValues,t.pointsInShape=f.pointsInShape,t.sumLPS=f.sumLPS,c}const sc=class sc extends r${static statsInit(e){e.storePointData||(this.state.pointsInShape=null),this.state=Lh(e.storePointData)}};sc.state=Lh(!0),sc.statsCallback=({value:e,pointLPS:n=null,pointIJK:r=null})=>{a$(sc.state,e,n,r)},sc.getStatistics=e=>s$(sc.state,e?.unit);let Vh=sc;function Rc(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[n,r,i=0]=t,[a,o,s=0]=e,c=a-n,l=o-r,f=s-i;return c*c+l*l+f*f}function FT(t,e){return Math.sqrt(Rc(t,e))}function c$(t,e,n){let r;const i=Rc(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(r=t),!r){const a=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/i;a<0?r=t:a>1?r=e:r=[t[0]+a*(e[0]-t[0]),t[1]+a*(e[1]-t[1])]}return{point:[...r],distanceSquared:Rc(n,r)}}function UT(t,e,n){return c$(t,e,n).distanceSquared}function l$(t,e,n){if(t.length!==2||e.length!==2||n.length!==2)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(UT(t,e,n))}const tl=.01;function xd(t,e,n){const r=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],a=t[1]<=e[1]?t[1]:e[1],o=t[1]>=e[1]?t[1]:e[1];if(!(n[0]>=r-tl&&n[0]<=i+tl&&n[1]>=a-tl&&n[1]<=o+tl))return!1;const c=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return(c>=0?c:-c)<=tl}function kT(t){if(t.length<3)return!1;const e=t.length,n=t[0],r=t[e-1],i=Rc(n,r);return qf(0,i)}function Fr(t,e,n={closed:void 0}){if(t.length<3)return!1;const r=t.length;let i=0;const{closed:a,holes:o}=n;if(o?.length){for(const l of o)if(Fr(l,e))return!1}const s=!(a===void 0?kT(t):a),c=t.length-(s?1:2);for(let l=0;l<=c;l++){const f=t[l],u=l===r-1?0:l+1,g=t[u],d=f[0]>=g[0]?f[0]:g[0],p=f[1]>=g[1]?f[1]:g[1],h=f[1]<=g[1]?f[1]:g[1];if(e[0]<=d&&e[1]>=h&&e[1]<p){let y=f[0]===g[0];if(!y){const T=(e[1]-f[1])*(g[0]-f[0])/(g[1]-f[1])+f[0];y=e[0]<=T}i+=y?1:0}}return!!(i%2)}function pu(t,e){for(let n=0,r=e.length;n<r;n++)if(!Fr(t,e[n]))return!1;return!0}function xg(t,e){let n=t;const r=e?.numDimensions||2,i=r===3;if(!Array.isArray(t[0])){const u=t,g=u.length/r;n=new Array(u.length/r);for(let d=0,p=g;d<p;d++)n[d]=[u[d*r],u[d*r+1]],i&&n[d].push(u[d*r+2])}let a=1/0,o=1/0,s=-1/0,c=-1/0,l=1/0,f=-1/0;n=n;for(let u=0,g=n.length;u<g;u++){const[d,p,h]=n[u];a=a<d?a:d,o=o<p?o:p,s=s>d?s:d,c=c>p?c:p,i&&(l=l<h?l:h,f=f>h?f:h)}return i?{minX:a,maxX:s,minY:o,maxY:c,minZ:l,maxZ:f}:{minX:a,maxX:s,minY:o,maxY:c}}function Sp(t){const e=t.length;let n=0,r=e-1;for(let i=0;i<e;i++)n+=(t[r][0]+t[i][0])*(t[r][1]-t[i][1]),r=i;return Math.abs(n/2)}function ls(t){if(t.length<3)return 0;const e=t[0];let n=0;for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-e[0],l=a[1]-e[1],f=s[0]-e[0],u=s[1]-e[1];n+=c*u-l*f}return n*=.5,n}function Mf(t){return ls(t)>=0?1:-1}function u$(t){const e=Ie(),n=t[0];for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-n[0],l=a[1]-n[1],f=a[2]-n[2],u=s[0]-n[0],g=s[1]-n[1],d=s[2]-n[2];e[0]+=l*d-f*g,e[1]+=f*u-c*d,e[2]+=c*g-l*u}return zi(e,e,.5),e}function f$(t){const e=u$(t);return Ht(e,e)}function Ph(t){const e=ls(t);return[0,0,e/Math.abs(e)]}const Fn=1e-7;function Ed(t,e){return t[0]*e[1]-t[1]*e[0]}function pn(t,e){return Wt(t,e,Fn)}function GT(t,e,n,r){const i=gr(un(),e,t),a=gr(un(),r,n),o=Ed(i,a),s=gr(un(),n,t),c=Ed(s,i);if(Math.abs(o)<Fn){if(Math.abs(c)<Fn){const u=Js(i,i),g=Js(a,a);if(u<Fn||g<Fn)return pn(t,n)||pn(t,r)?t:pn(e,n)||pn(e,r)?e:null;const d=Js(gr(un(),n,t),i)/u,p=Js(gr(un(),r,t),i)/u,h=Js(gr(un(),t,n),a)/g,m=Js(gr(un(),e,n),a)/g,v=y=>y>=-Fn&&y<=1+Fn;if(v(d)){const y=Ru(un(),t,i,d);if(pn(n,y))return n}if(v(p)){const y=Ru(un(),t,i,p);if(pn(r,y))return r}if(v(h)){const y=Ru(un(),n,a,h);if(pn(t,y))return t}if(v(m)){const y=Ru(un(),n,a,m);if(pn(e,y))return e}}return null}const l=Ed(s,a)/o,f=c/o;return l>=-Fn&&l<=1+Fn&&f>=-Fn&&f<=1+Fn?[t[0]+l*i[0],t[1]+l*i[1]]:null}var io;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(io||(io={}));var xr;(function(t){t[t.Entering=0]="Entering",t[t.Exiting=1]="Exiting",t[t.Unknown=2]="Unknown"})(xr||(xr={}));function BT(t,e){if(t.length!==e.length)return!1;const n=t.length;if(n===0)return!0;let r=!0;for(let a=0;a<n;a++)if(!pn(t[a],e[a])){r=!1;break}if(r)return!0;let i=!0;for(let a=0;a<n;a++)if(!pn(t[a],e[n-1-a])){i=!1;break}if(i)return!0;for(let a=1;a<n;a++){let o=!0;for(let c=0;c<n;c++)if(!pn(t[c],e[(c+a)%n])){o=!1;break}if(o)return!0;let s=!0;for(let c=0;c<n;c++)if(!pn(t[c],e[(n-1-c+a)%n])){s=!1;break}if(s)return!0}return!1}function xp(t,e){if(t.length<3)return[];if(e.length<3)return[t.slice()];const n=e.slice();if(BT(t,e))return[];const r=ls(t),i=ls(n);Math.sign(r)===Math.sign(i)&&Math.abs(i)>Fn&&n.reverse();const a=[];for(let f=0;f<t.length;f++){const u=t[f],g=t[(f+1)%t.length];for(let d=0;d<n.length;d++){const p=n[d],h=n[(d+1)%n.length],m=GT(u,g,p,h);if(m){const v=Math.sqrt(ns(u,g)),y=Math.sqrt(ns(p,h));a.push({coord:m,seg1Idx:f,seg2Idx:d,alpha1:v<Fn?0:Math.sqrt(ns(u,m))/v,alpha2:y<Fn?0:Math.sqrt(ns(p,m))/y})}}}const o=(f,u,g)=>{const d=[];let p=0;for(let m=0;m<f.length;m++){const v=f[m];d.push({id:`${u}_v${p++}`,coordinates:v,type:io.Vertex,originalPolyIndex:u,originalVertexIndex:m,next:null,prev:null,isIntersection:!1,visited:!1});const y=g.filter(T=>(u===0?T.seg1Idx:T.seg2Idx)===m).sort((T,C)=>(u===0?T.alpha1:T.alpha2)-(u===0?C.alpha1:C.alpha2));for(const T of y){if(d.length>0&&pn(d[d.length-1].coordinates,T.coord)){d[d.length-1].isIntersection||(d[d.length-1].isIntersection=!0,d[d.length-1].intersectionInfo=T,d[d.length-1].alpha=u===0?T.alpha1:T.alpha2);continue}d.push({id:`${u}_i${p++}`,coordinates:T.coord,type:io.Intersection,originalPolyIndex:u,next:null,prev:null,isIntersection:!0,visited:!1,alpha:u===0?T.alpha1:T.alpha2,intersectionInfo:T})}}const h=[];if(d.length>0){h.push(d[0]);for(let m=1;m<d.length;m++)pn(d[m].coordinates,h[h.length-1].coordinates)?d[m].isIntersection&&(h[h.length-1].isIntersection=!0,h[h.length-1].intersectionInfo=d[m].intersectionInfo,h[h.length-1].alpha=d[m].alpha):h.push(d[m])}if(h.length>0)for(let m=0;m<h.length;m++)h[m].next=h[(m+1)%h.length],h[m].prev=h[(m-1+h.length)%h.length];return h},s=o(t,0,a),c=o(n,1,a);s.forEach(f=>{if(f.isIntersection){const u=f.intersectionInfo,g=c.find(d=>d.isIntersection&&pn(d.coordinates,f.coordinates)&&d.intersectionInfo.seg1Idx===u.seg1Idx&&d.intersectionInfo.seg2Idx===u.seg2Idx);if(g){f.partnerNode=g,g.partnerNode=f;const d=f.prev.coordinates,p=f.coordinates,h=g.next.coordinates;gr(un(),p,d),gr(un(),h,p);const m=[(f.prev.coordinates[0]+f.coordinates[0])/2,(f.prev.coordinates[1]+f.coordinates[1])/2];Fr(e,m)?f.intersectionDir=xr.Exiting:f.intersectionDir=xr.Entering}else f.isIntersection=!1}}),s.forEach(f=>delete f.intersectionInfo),c.forEach(f=>delete f.intersectionInfo);const l=[];for(let f=0;f<s.length;f++){const u=s[f];if(u.visited||u.isIntersection||Fr(e,u.coordinates))continue;const g=[];let d=u,p=!0,h=0;const m=(s.length+c.length)*2;do{if(h++>m){console.warn("Subtraction: Max iterations reached, possible infinite loop.");break}d.visited=!0,(g.length===0||!pn(g[g.length-1],d.coordinates))&&g.push(d.coordinates),d.isIntersection&&(p?d.intersectionDir===xr.Entering&&d.partnerNode&&(d=d.partnerNode,p=!1):d.partnerNode?(d=d.partnerNode,p=!0):console.warn("Subtraction: Intersection on source without partner.")),d=d.next}while(d!==u||!p);g.length>=3&&(pn(g[0],g[g.length-1])&&g.pop(),g.length>=3&&l.push(g))}return l}function g$(t,e){if(t.length<3||e.length<3)return[];let n=e.slice();const r=ls(t),i=ls(n);if(Math.abs(r)<Fn||Math.abs(i)<Fn)return[];r<0&&(t=t.slice().reverse()),i<0&&(n=n.slice().reverse());const a=n,o=[];for(let u=0;u<t.length;u++){const g=t[u],d=t[(u+1)%t.length];for(let p=0;p<n.length;p++){const h=n[p],m=n[(p+1)%n.length],v=GT(g,d,h,m);if(v){const y=Math.sqrt(ns(g,d)),T=Math.sqrt(ns(h,m));o.push({coord:[...v],seg1Idx:u,seg2Idx:p,alpha1:y<Fn?0:Math.sqrt(ns(g,v))/y,alpha2:T<Fn?0:Math.sqrt(ns(h,v))/T})}}}if(o.length===0)return Fr(a,t[0])&&t.every(u=>Fr(a,u))?[[...t.map(u=>[...u])]]:Fr(t,n[0])&&n.every(u=>Fr(t,u))?[[...n.map(u=>[...u])]]:[];const s=(u,g,d)=>{const p=[];let h=0;for(let v=0;v<u.length;v++){const y=u[v];p.push({id:`${g}_v${h++}`,coordinates:[...y],type:io.Vertex,originalPolyIndex:g,originalVertexIndex:v,next:null,prev:null,isIntersection:!1,visited:!1,processedInPath:!1,intersectionDir:xr.Unknown});const T=d.filter(C=>(g===0?C.seg1Idx:C.seg2Idx)===v).sort((C,w)=>(g===0?C.alpha1:C.alpha2)-(g===0?w.alpha1:w.alpha2));for(const C of T){if(p.length>0&&pn(p[p.length-1].coordinates,C.coord)){const w=p[p.length-1];w.isIntersection||(w.isIntersection=!0,w.intersectionInfo=C,w.alpha=g===0?C.alpha1:C.alpha2,w.type=io.Intersection);continue}p.push({id:`${g}_i${h++}`,coordinates:[...C.coord],type:io.Intersection,originalPolyIndex:g,next:null,prev:null,isIntersection:!0,visited:!1,processedInPath:!1,alpha:g===0?C.alpha1:C.alpha2,intersectionInfo:C,intersectionDir:xr.Unknown})}}const m=[];if(p.length>0){m.push(p[0]);for(let v=1;v<p.length;v++)if(!pn(p[v].coordinates,m[m.length-1].coordinates))m.push(p[v]);else{const y=m[m.length-1];p[v].isIntersection&&p[v].intersectionInfo&&(y.isIntersection=!0,y.intersectionInfo=p[v].intersectionInfo,y.alpha=p[v].alpha,y.type=io.Intersection)}}if(m.length>1&&pn(m[0].coordinates,m[m.length-1].coordinates)){const v=m[0],y=m.pop();y.isIntersection&&!v.isIntersection&&y.intersectionInfo&&(v.isIntersection=!0,v.intersectionInfo=y.intersectionInfo,v.alpha=y.alpha,v.type=io.Intersection)}if(m.length>0)for(let v=0;v<m.length;v++)m[v].next=m[(v+1)%m.length],m[v].prev=m[(v-1+m.length)%m.length];return m},c=s(t,0,o),l=s(n,1,o);if(c.length===0||l.length===0)return[];c.forEach(u=>{if(u.isIntersection&&u.intersectionInfo){const g=u.intersectionInfo,d=l.find(p=>p.isIntersection&&p.intersectionInfo&&pn(p.coordinates,u.coordinates)&&p.intersectionInfo.seg1Idx===g.seg1Idx&&p.intersectionInfo.seg2Idx===g.seg2Idx);if(d){u.partnerNode=d,d.partnerNode=u;const p=gr(un(),u.coordinates,u.prev.coordinates),h=gr(un(),d.next.coordinates,d.coordinates),m=p[0]*h[1]-p[1]*h[0];if(m>Fn)u.intersectionDir=xr.Entering,d.intersectionDir=xr.Exiting;else if(m<-Fn)u.intersectionDir=xr.Exiting,d.intersectionDir=xr.Entering;else{const v=[(u.prev.coordinates[0]+u.coordinates[0])/2,(u.prev.coordinates[1]+u.coordinates[1])/2];Fr(a,v)?(u.intersectionDir=xr.Exiting,d.intersectionDir=xr.Entering):(u.intersectionDir=xr.Entering,d.intersectionDir=xr.Exiting)}}else u.isIntersection=!1,u.intersectionInfo=void 0}});const f=[];for(const u of c){if(!u.isIntersection||u.visited||u.intersectionDir!==xr.Entering)continue;let g=[],d=u,p=!0;const h=u;let m=0;const v=(c.length+l.length)*2;c.forEach(y=>y.processedInPath=!1),l.forEach(y=>y.processedInPath=!1);do{if(m++>v){console.warn("Intersection: Max iterations in path tracing.",h.id,d.id),g=[];break}if(d.processedInPath&&d!==h){console.warn("Intersection: Path processing loop detected, discarding path segment.",h.id,d.id),g=[];break}d.processedInPath=!0,d.visited=!0,(g.length===0||!pn(g[g.length-1],d.coordinates))&&g.push([...d.coordinates]);let y=!1;d.isIntersection&&d.partnerNode&&(p?(d=d.partnerNode,p=!1,y=!0):(d=d.partnerNode,p=!0,y=!0)),d=d.next}while(d!==h||p&&d.originalPolyIndex!==0||!p&&d.originalPolyIndex!==1);if(m>v||g.length===0||g.length>0&&pn(g[0],g[g.length-1])&&g.pop(),g.length>=3){const y=ls(g);(r>0&&y<0||r<0&&y>0)&&g.reverse(),f.push(g.map(T=>[...T]))}}return f}function Ep(t,e,n,r){let i=!1;const a=t[0]<e[0]?t[0]:e[0],o=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],l=n[0]<r[0]?n[0]:r[0],f=n[1]<r[1]?n[1]:r[1],u=n[0]>r[0]?n[0]:r[0],g=n[1]>r[1]?n[1]:r[1];if(a>u||s<l||o>g||c<f)return!1;const d=[Yu(t,e,n),Yu(t,e,r),Yu(n,r,t),Yu(n,r,e)];return d[0]!==d[1]&&d[2]!==d[3]?!0:((d[0]===0&&Zu(t,n,e)||d[1]===0&&Zu(t,r,e)||d[2]===0&&Zu(n,t,r)||d[3]===0&&Zu(n,e,r))&&(i=!0),i)}function Yu(t,e,n){const r=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return r===0?0:r>0?1:2}function Zu(t,e,n){return e[0]<=Math.max(t[0],n[0])&&e[0]>=Math.min(t[0],n[0])&&e[1]<=Math.max(t[1],n[1])&&e[1]>=Math.min(t[1],n[1])}function Op(t,e,n,r=!0){const i=[],a=t.length,o=a-(r?1:2);for(let s=0;s<=o;s++){const c=t[s],l=s===a-1?0:s+1,f=t[l];Ep(e,n,c,f)&&i.push([s,l])}return i}function $T(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);for(let o=i;o<t.length;o++){const s=t[a],c=t[o];if(Ep(e,n,s,c))return[a,o];a=o}}function Rp(t,e){for(let n=0,r=t.length;n<r;n++){const i=t[n],a=n===r-1?0:n+1,o=t[a];if($T(e,i,o)?.length===2)return!0}return!1}const d$=.01;function WT(t,e,n,r){const i=[e[0]-t[0],e[1]-t[1]],a=[r[0]-n[0],r[1]-n[1]],o=a[1]*i[0]-a[0]*i[1];if((o>=0?o:-o)<d$){const p=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],h=[n[0]<r[0]?n[0]:r[0],n[0]>r[0]?n[0]:r[0],n[1]<r[1]?n[1]:r[1],n[1]>r[1]?n[1]:r[1]];if(!(p[0]<=h[1]&&p[1]>=h[0]&&p[2]<=h[3]&&p[3]>=h[2])||!(xd(t,e,n)||xd(t,e,r)||xd(n,r,t)))return;const y=p[0]>h[0]?p[0]:h[0],T=p[1]<h[1]?p[1]:h[1],C=p[2]>h[2]?p[2]:h[2],w=p[3]<h[3]?p[3]:h[3],S=(y+T)*.5,_=(C+w)*.5;return[S,_]}let c=t[1]-n[1],l=t[0]-n[0];const f=a[0]*c-a[1]*l,u=i[0]*c-i[1]*l;c=f/o,l=u/o;const g=t[0]+c*i[0],d=t[1]+c*i[1];return[g,d]}var pc;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(pc||(pc={}));var mc;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})(mc||(mc={}));var Zc;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(Zc||(Zc={}));function U3(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];r.next||(r.next=t[e===n-1?0:e+1])}}function h$(t,e){const n=[],r=[],i=new Map;let o=Fr(e,t[0])?Zc.Exiting:Zc.Entering;for(let s=0,c=t.length;s<c;s++){const l=t[s],f=Fr(e,l),u={type:pc.Vertex,coordinates:l,position:f?mc.Inside:mc.Outside,visited:!1,next:null};n.push(u);const g=t[s===c-1?0:s+1],d=Op(e,l,g).map(p=>{const h=p[0],m=e[p[0]],v=e[p[1]],y=WT(l,g,m,v),T=Rc(l,y);return{sourceLineSegmentId:h,coordinate:y,targetStartPointDistSquared:T}});d.sort((p,h)=>p.targetStartPointDistSquared-h.targetStartPointDistSquared),d.forEach(p=>{const{sourceLineSegmentId:h,coordinate:m}=p,v={type:pc.Intersection,coordinates:m,position:mc.Edge,direction:o,visited:!1,next:null},y={...v,direction:Zc.Unknown,cloned:!0};o===Zc.Entering?v.next=y:y.next=v;let T=i.get(h);T||(T=[],i.set(h,T)),n.push(v),T.push(y),o*=-1})}for(let s=0,c=e.length;s<c;s++){const l=s,f=e[s],u={type:pc.Vertex,coordinates:f,visited:!1,next:null};r.push(u);const g=i.get(l);g?.length&&g.map(d=>({intersectionPoint:d,lineSegStartDistSquared:Rc(f,d.coordinates)})).sort((d,p)=>d.lineSegStartDistSquared-p.lineSegStartDistSquared).map(({intersectionPoint:d})=>d).forEach(d=>r.push(d))}return U3(n),U3(r),{targetPolylinePoints:n,sourcePolylinePoints:r}}function p$(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];if(!r.visited&&r.position===mc.Outside&&r.type===pc.Vertex)return r}for(let e=0,n=t.length;e<n;e++){const r=t[e];if(!r.visited&&r.position===mc.Outside)return r}}function Dp(t,e){const n=Ph(t),r=Ph(e),i=He(r,n);if(qf(1,i)||(e=e.slice().reverse()),!Rp(e,t)&&pu(e,t))return e.slice();const{targetPolylinePoints:s}=h$(t,e),c=p$(s);if(!c)return t.slice();const l=[c.coordinates];let f=c.next,u=0;const g=t.length+e.length+1e3;for(;f!==c&&u<g;){if(u++,f.type===pc.Intersection&&f.cloned){f=f.next;continue}if(l.push(f.coordinates),f=f.next,!f){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}}return u>=g&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),l}const m$=.1;function zT(t,e=m$){const n=t.length;if(n<3)return t;const r=e*e,i=[[0,n-1]],a=new Array(n).fill(!1);let o=2;for(a[0]=!0,a[n-1]=!0;i.length;){const[c,l]=i.pop();if(l-c===1)continue;const f=t[c],u=t[l];let g=-1/0,d=-1;for(let p=c+1;p<l;p++){const h=t[p],m=UT(f,u,h);m>g&&(g=m,d=p)}g<r||(a[d]=!0,o++,i.push([d,l]),i.push([c,d]))}const s=new Array(o);for(let c=0,l=0;c<n;c++)a[c]&&(s[l++]=t[c]);return s}function HT(t,e,n,r=!0){const i=[],a=Op(t,e,n,r);for(let o=0;o<a.length;o++){const s=t[a[o][0]],c=t[a[o][1]],l=WT(e,n,s,c);i.push(l)}return i}function v$(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);const o=[];for(let f=i;f<t.length;f++){const u=t[a],g=t[f];Ep(e,n,u,g)&&o.push([a,f]),a=f}if(o.length===0)return;const s=[];o.forEach(f=>{const u=[t[f[0]],t[f[1]]],g=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2];s.push(er(g,e))});const c=Math.min(...s),l=s.indexOf(c);return{segment:o[l],distance:c}}const Bc=.001,y$=(t,e)=>{let n,r,i;if(t instanceof Jr){const o=t.getImageData();if(!o)return;r=o.direction.slice(0,3),i=o.direction.slice(3,6),n=o.spacing}else{const o=t.getImageData(),{direction:s,spacing:c}=o,{viewPlaneNormal:l,viewUp:f}=t.getCamera(),u=s.slice(0,3),g=s.slice(3,6),d=s.slice(6,9),p=Ie();zt(p,f,l);const h=Math.abs(He(p,u)),m=Math.abs(He(p,g)),v=Math.abs(He(p,d));let y;if(Math.abs(1-h)<Bc)y=c[0],r=u;else if(Math.abs(1-m)<Bc)y=c[1],r=g;else if(Math.abs(1-v)<Bc)y=c[2],r=d;else throw new Error("No support yet for oblique plane planar contours");const T=Math.abs(He(f,u)),C=Math.abs(He(f,g)),w=Math.abs(He(f,d));let S;if(Math.abs(1-T)<Bc)S=c[0],i=u;else if(Math.abs(1-C)<Bc)S=c[1],i=g;else if(Math.abs(1-w)<Bc)S=c[2],i=d;else throw new Error("No support yet for oblique plane planar contours");n=[y,S]}return{spacing:[n[0]/e,n[1]/e],xDir:r,yDir:i}},T$=(t,e,n)=>v2(t,e)<n,C$=(t,e,n,r)=>{const{xDir:i,yDir:a,spacing:o}=r,s=Ke(t),{viewport:c}=s;if(!e.length)return e.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const l=c.canvasToWorld(e[e.length-1]),f=c.canvasToWorld(n),u=Ie();_n(u,f,l);const g=Math.abs(He(u,i)),d=Math.abs(He(u,a)),p=Math.max(Math.floor(g/o[0]),Math.floor(d/o[0]));if(p>1){const h=e[e.length-1],m=v2(h,n),v=un();gr(v,n,h),i0(v,v[0]/m,v[1]/m);const y=m/p;for(let T=1;T<=p;T++)e.push([h[0]+y*v[0]*T,h[1]+y*v[1]*T])}else e.push(n);return p},w$=(t,e,n,r)=>{const i=[t[0]-e[0],t[1]-e[1]],a=[n[0]-e[0],n[1]-e[1]],o=i[0]*a[0]+i[1]*a[1];if(o<0)return!1;const s=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(s===0)return!1;const c=o/s,l=[a[0]/s,a[1]/s],f=[l[0]*c,l[1]*c],u=[e[0]+f[0],e[1]+f[1]];return!(er(t,u)>r||er(e,u)>er(e,n))},S$=1e-6;function jT(t){let e;const n=cp(t,50);for(let o=0;o<3;o++)if(n.every((s,c,l)=>Math.abs(s[o]-l[0][o])<S$)){e=o;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const r=[],i=(e+1)%3,a=(e+2)%3;for(let o=0;o<t.length;o++)r.push([t[o][i],t[o][a]]);return{sharedDimensionIndex:e,projectedPolyline:r}}function x$(t,e,n={}){const{sharedDimensionIndex:r,projectedPolyline:i}=jT(e),{holes:a}=n,o=[];if(a)for(let c=0;c<a.length;c++){const l=a[c],f=[];for(let u=0;u<l.length;u++)f.push([l[u][(r+1)%3],l[u][(r+2)%3]]);o.push(f)}const s=[t[(r+1)%3],t[(r+2)%3]];return Fr(i,s,{holes:o})}function E$(t){if(t.length<3)return t.slice();const e=t.map(a=>[a[0],a[1]]).sort((a,o)=>a[0]===o[0]?a[1]-o[1]:a[0]-o[0]);function n(a,o,s){return(o[0]-a[0])*(s[1]-a[1])-(o[1]-a[1])*(s[0]-a[0])}const r=[];for(const a of e){for(;r.length>=2&&n(r[r.length-2],r[r.length-1],a)<=0;)r.pop();r.push(a)}const i=[];for(let a=e.length-1;a>=0;a--){const o=e[a];for(;i.length>=2&&n(i[i.length-2],i[i.length-1],o)<=0;)i.pop();i.push(o)}return r.pop(),i.pop(),r.concat(i)}const bc=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:C$,arePolylinesIdentical:BT,containsPoint:Fr,containsPoints:pu,convexHull:E$,decimate:zT,getAABB:xg,getArea:Sp,getClosestLineSegmentIntersection:v$,getFirstLineSegmentIntersectionIndexes:$T,getLineSegmentIntersectionsCoordinates:HT,getLineSegmentIntersectionsIndexes:Op,getNormal2:Ph,getNormal3:f$,getSignedArea:ls,getSubPixelSpacingAndXYDirections:y$,getWindingDirection:Mf,intersectPolyline:Rp,intersectPolylines:g$,isClosed:kT,isPointInsidePolyline3D:x$,mergePolylines:Dp,pointCanProjectOnLine:w$,pointsAreWithinCloseContourProximity:T$,projectTo2D:jT,subtractPolylines:xp},Symbol.toStringTag,{value:"Module"}));function k3(t,e){let n=[0,0],r=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const a=O$(e,i);a<r&&(r=a,n=[...i])}),n}function O$(t,e){const[n,r]=t,[i,a]=e;return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-a,2))}function Ia(t,e,n,r){const{canvasToWorld:i,worldToCanvas:a}=n,{data:o}=t,{targetWindingDirection:s}=e;let{points:c}=e,l=Mf(c);r?.decimate?.enabled&&(c=zT(e.points,r?.decimate?.epsilon));let{closed:f}=e;const u=c.length,g=new Array(u);Mf(c);const d=K7(t);if(f===void 0){let p=!1;if(c.length>3){const h=Rc(c[0],c[u-1]);p=Wt(0,h)}f=p}if(r?.updateWindingDirection!==!1){let p=d?d.data.contour.windingDirection*-1:s;p===void 0&&(p=l),p!==l&&c.reverse();const h=(o.handles?.points??[]).map(a);h.length>2&&Mf(h)!==p&&o.handles.points.reverse(),l=p}for(let p=0;p<u;p++)g[p]=i(c[p]);o.contour.polyline=g,o.contour.closed=f,o.contour.windingDirection=l,q7(t)}const R$="viewport-element";function D$(t){const e=Ke(t),{viewportId:n,renderingEngineId:r}=e,i=`${n}:${r}`,a=M$(t);return Object.keys(Ye.svgNodeCache[i]).forEach(o=>{Ye.svgNodeCache[i][o].touched=!1}),{svgLayerElement:a,svgNodeCacheForCanvas:Ye.svgNodeCache,getSvgNode:_$.bind(this,i),appendNode:I$.bind(this,a,i),setNodeTouched:b$.bind(this,i),clearUntouched:L$.bind(this,a,i)}}function M$(t){const e=`.${R$}`;return t.querySelector(e)?.querySelector(":scope > .svg-layer")}function _$(t,e){if(Ye.svgNodeCache[t]&&Ye.svgNodeCache[t][e])return Ye.svgNodeCache[t][e].domRef}function I$(t,e,n,r){if(!Ye.svgNodeCache[e])return null;Ye.svgNodeCache[e][r]={touched:!0,domRef:n},t.appendChild(n)}function b$(t,e){Ye.svgNodeCache[t]&&Ye.svgNodeCache[t][e]&&(Ye.svgNodeCache[t][e].touched=!0)}function L$(t,e){Ye.svgNodeCache[e]&&Object.keys(Ye.svgNodeCache[e]).forEach(n=>{const r=Ye.svgNodeCache[e][n];!r.touched&&r.domRef&&(t.removeChild(r.domRef),delete Ye.svgNodeCache[e][n])})}function V$(t,e){const n=D$(t);e(n),n.clearUntouched()}function mu(t,e,n){return`${t}::${e}::${n}`}function Dc(t,e){Object.keys(t).forEach(n=>{const r=e.getAttribute(n),i=t[n];i===void 0||i===""?e.removeAttribute(n):r!==i&&e.setAttribute(n,i)})}function p1(t,e){Object.keys(t).forEach(n=>{const r=t[n];r!==void 0&&r!==""&&e.setAttribute(n,r)})}function P$(t,e,n,r,i={},a){const{color:o,handleRadius:s,width:c,lineWidth:l,fill:f,type:u,opacity:g}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),d=l||c,p="http://www.w3.org/2000/svg",h=mu(e,"handle",`hg-${n}-index-${a}`);let m;if(u==="circle")m={cx:`${r[0]}`,cy:`${r[1]}`,r:s,stroke:o,fill:f,"stroke-width":d,opacity:g};else if(u==="rect"){const T=parseFloat(s)*1.5,C=r[0]-T*.5,w=r[1]-T*.5;m={x:`${C}`,y:`${w}`,width:`${T}`,height:`${T}`,stroke:o,fill:f,"stroke-width":d,rx:`${T*.1}`,opacity:g}}else throw new Error(`Unsupported handle type: ${u}`);const v=t.getSvgNode(h);if(v)Dc(m,v),t.setNodeTouched(h);else{const y=document.createElementNS(p,u);p1(m,y),t.appendNode(y,h)}}function Eg(t,e,n,r,i={}){r.forEach((a,o)=>{P$(t,e,n,a,i,o)})}function KT(t,e,n,r,i,a={},o=""){if(isNaN(r[0])||isNaN(r[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s="rgb(0, 255, 0)",width:c=10,lineWidth:l,lineDash:f,markerStartId:u=null,markerEndId:g=null,shadow:d=!1,strokeOpacity:p=1,textBoxLinkLineColor:h}=a,m=l||c,v="http://www.w3.org/2000/svg",y=mu(e,"line",n),T=t.getSvgNode(y),C=t.svgLayerElement.id,w=d?`filter:url(#shadow-${C});`:"",S={x1:`${r[0]}`,y1:`${r[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:h||s,style:w,"stroke-width":m,"stroke-dasharray":f,"marker-start":u?`url(#${u})`:"","marker-end":g?`url(#${g})`:"","stroke-opacity":p};if(T)Dc(S,T),t.setNodeTouched(y);else{const _=document.createElementNS(v,"line");o!==""&&_.setAttribute("data-id",o),p1(S,_),t.appendNode(_,y)}}function O0(t,e,n,r,i){if(r.length<2)return;const{color:a="rgb(0, 255, 0)",width:o=10,fillColor:s="none",fillOpacity:c=0,lineWidth:l,lineDash:f,closePath:u=!1,markerStartId:g=null,markerEndId:d=null}=i,p=l||o,h="http://www.w3.org/2000/svg",m=mu(e,"polyline",n),v=t.getSvgNode(m);let y="";for(const C of r)y+=`${C[0].toFixed(1)}, ${C[1].toFixed(1)} `;if(u){const C=r[0];y+=`${C[0]}, ${C[1]}`}const T={points:y,stroke:a,fill:s,"fill-opacity":c,"stroke-width":p,"stroke-dasharray":f,"marker-start":g?`url(#${g})`:"","marker-end":d?`url(#${d})`:""};if(v)Dc(T,v),t.setNodeTouched(m);else{const C=document.createElementNS(h,"polyline");p1(T,C),t.appendNode(C,m)}}function f0(t,e,n,r,i){const o=r.length&&r[0].length&&Array.isArray(r[0][0])?r:[r],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:l="none",fillOpacity:f=0,lineWidth:u,lineDash:g,closePath:d=!1}=i,p=u||c,h="http://www.w3.org/2000/svg",m=mu(e,"path",n),v=t.getSvgNode(m);let y="";for(let C=0,w=o.length;C<w;C++){const S=o[C],_=S.length;if(!(_<2)){for(let D=0;D<_;D++){const N=S[D];y+=`${D?"L":"M"} ${N[0].toFixed(1)}, ${N[1].toFixed(1)} `}d&&(y+="Z ")}}if(!y)return;const T={d:y,stroke:s,fill:l,"fill-opacity":f,"stroke-width":p,"stroke-dasharray":g};if(v)Dc(T,v),t.setNodeTouched(m);else{const C=document.createElementNS(h,"path");p1(T,C),t.appendNode(C,m)}}function N$(t,e,n,r,i,a={}){const o=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},a);return A$(t,e,n,r,i,o)}function A$(t,e,n,r=[""],i,a){const{padding:o,color:s,fontFamily:c,fontSize:l,background:f,textBoxBorderRadius:u,textBoxMargin:g}=a;let d;const[p,h]=[i[0]+o,i[1]+o],m={color:f,textBoxBorderRadius:u,textBoxMargin:g},v="http://www.w3.org/2000/svg",y=mu(e,"text",n),T=t.getSvgNode(y);if(T){const C=T.querySelector("text"),w=Array.from(C.children);for(let D=0;D<w.length;D++){const N=w[D],P=r[D]||"";N.textContent=P}if(r.length>w.length){for(let D=0;D<r.length-w.length;D++){const N=r[D+w.length],P=G3(N);C.appendChild(P)}T.appendChild(C),t.appendNode(T,y)}const S={fill:s,"font-size":l,"font-family":c},_={transform:`translate(${p} ${h})`};Dc(S,C),Dc(_,T),T.setAttribute("data-annotation-uid",e),d=B3(T,m),t.setNodeTouched(y)}else{const C=document.createElementNS(v,"g");C.setAttribute("data-annotation-uid",e),C.setAttribute("transform",`translate(${p} ${h})`);const w=F$(t,a);for(let S=0;S<r.length;S++){const _=r[S],D=G3(_);w.appendChild(D)}C.appendChild(w),t.appendNode(C,y),d=B3(C,m)}return Object.assign({},d,{x:p,y:h,height:d.height+o,width:d.width+o})}function F$(t,e){const{color:n,fontFamily:r,fontSize:i}=e,o=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,l=`${s}${c}`;return o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("fill",n),o.setAttribute("font-family",r),o.setAttribute("font-size",i),o.setAttribute("style",l),o.setAttribute("pointer-events","visible"),o}function G3(t){const n=document.createElementNS("http://www.w3.org/2000/svg","tspan");return n.setAttribute("x","0"),n.setAttribute("dy","1.2em"),n.textContent=t,n}function B3(t,e){const{color:n,textBoxBorderRadius:r=0,textBoxMargin:i=0}=e;let a=t.querySelector("rect.background");const o=t.querySelector("text").getBBox();if(!n)return a&&t.removeChild(a),t.getBBox();a||(a=document.createElementNS("http://www.w3.org/2000/svg","rect"),a.setAttribute("class","background"),t.insertBefore(a,t.firstChild));const s=t.getBBox(),c={x:`${s.x}`,y:`${s.y}`,width:`${o.width+Number(i)*2}`,height:`${o.height+Number(i)*2}`,fill:n,rx:r,ry:r};return i&&Array.from(t.querySelector("text").querySelectorAll("tspan")).forEach((f,u)=>{u===0&&f.setAttribute("y",i),f.setAttribute("x",i)}),Dc(c,a),s}function U$(t,e,n,r,i,a,o={}){const s=r.length>0?k3(r,i):i,c=k$(a),l=k3(c,s),f=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},o);KT(t,e,`link-${n}`,s,l,f)}function k$(t){const{x:e,y:n,height:r,width:i}=t,a=i/2,o=r/2,s=[e+a,n],c=[e,n+o],l=[e+a,n+r],f=[e+i,n+o];return[s,c,l,f]}function qT(t,e,n,r,i,a,o,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),l=N$(t,e,n,r,i,c);return U$(t,e,n,a,i,l,c),l}function G$(t,e){const n=Ke(t),{renderingEngineId:r,viewportId:i}=n,a=Mr(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l];if(f&&e.includes(f.mode)){const u=a.getToolInstance(l);o.push(u)}}return o}const{Active:B$,Passive:$$,Enabled:W$}=rn;class z${constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let n=0;n<e.length;n++){const r=e[n];if(this._needsRender.has(r)&&(this._triggerRender(r),this._needsRender.delete(r),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,n){this._viewportElements.set(e,n)}removeViewportElement(e,n){this._viewportElements.delete(e),this._needsRender.delete(n),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(n=>{this._needsRender.add(n)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const n=[...this._viewportElements.values()];e.forEach(r=>{n.indexOf(r)!==-1&&this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const n=Ke(e);if(!n)return;if(!_c(n.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=G$(e,[B$,$$,W$]),{renderingEngineId:a,viewportId:o}=n,s={element:e,renderingEngineId:a,viewportId:o};V$(e,c=>{let l=!1;const f=u=>{if(u.renderAnnotation){const g=u.renderAnnotation(n,c);l=l||g}};i.forEach(f),l&&Oe(e,fe.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const Mp=new z$;function vu(t){Mp.renderViewport(t)}function Cn(t){t.length&&t.forEach(e=>{const n=Un(e);if(!n){console.warn(`Viewport not available for ${e}`);return}const{viewport:r}=n;if(!r){console.warn(`Viewport not available for ${e}`);return}const i=r.element;vu(i)})}function H$(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i];a.getFrameOfReferenceUID()===e&&r.push(a)}return r}const{Active:j$,Passive:K$,Enabled:q$}=rn;function X$(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i],o=Mr(a.id,a.renderingEngineId);if(!o)continue;Y$(o,e)&&r.push(a)}return r}function Y$(t,e){const{toolOptions:n}=t,r=n[e];if(!r)return!1;const i=r.mode;return i===j$||i===K$||i===q$}function Z$(t,e,n=.999){return t.filter(r=>{const i=r.getCamera();return Math.abs(He(i.viewPlaneNormal,e.viewPlaneNormal))>n})}function us(t,e,n=!0){const r=Ke(t),{renderingEngine:i,FrameOfReferenceUID:a}=r;let o=i.getViewports();o=H$(o,a),o=X$(o,e);const s=i.getViewport(r.viewportId);return n&&(o=Z$(o,s.getCamera())),o.map(l=>l.id)}const Og="PlanarFreehandContourSegmentationTool";function _p(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}function J$(t,e){return c1(e).map(n=>{const r=n,i=_p(r.data.contour.polyline,t);return{annotation:r,polyline:i}})}function XT(t,e,n){du(e,n),Ec(n);const{contour:r}=n.data,i=_p(r.polyline,t);Ia(n,{points:i,closed:r.closed,targetWindingDirection:e.data.contour.windingDirection===di.Clockwise?di.CounterClockwise:di.Clockwise},t);const{element:a}=t;YT(t,[e,n])}function Q$(t,e,n,r,i){if(!l1(Og)){console.warn(`${Og} is not registered in cornerstone. Cannot combine polylines.`);return}const a=i[0],o=Fr(n,a),s=J$(t,e),c=new Set(s),l=new Map,f=(y,T)=>{let C=l.get(y);C||(C=[],l.set(y,C)),C.push(T),c.delete(T)},u=[];if(o){const y=Dp(n,i);u.push(y),Array.from(c.keys()).forEach(T=>f(y,T))}else xp(n,i).forEach(T=>{u.push(T),Array.from(c.keys()).forEach(C=>{pu(T,C.polyline)&&f(T,C)})});Array.from(l.values()).forEach(y=>y.forEach(T=>s1(T.annotation)));const{element:g}=t,{metadata:d,data:p}=e,{handles:h,segmentation:m}=p,{textBox:v}=h;yo(r.annotationUID),yo(e.annotationUID),Ec(r),Ec(e);for(let y=0;y<u.length;y++){const T=u[y];if(!T||T.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",T);continue}const C=eW(t,e,T);vo(C,g),Oc(C),Qr(C,t.element),l.get(T)?.forEach(w=>du(C,w.annotation))}YT(t,[e,r])}function eW(t,e,n){const r=t.canvasToWorld(n[0]),i=t.canvasToWorld(n[n.length-1]),a={metadata:{...e.metadata,toolName:Og,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[r,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:nr(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Ia(a,{points:n,closed:!0,targetWindingDirection:di.Clockwise},t),a}function YT(t,e){const{element:n}=t,r=new Set([Og]);e.forEach(i=>{r.add(i.metadata.toolName)});for(const i of r.values())if(l1(i)){const a=us(n,i);Cn(a)}}function m1(t){return!!t.data?.segmentation}function tW(t,e,n){const r=[],i=xg(e);for(let a=0;a<n.length;a++){const o=n[a],s=nW(o.data.contour.polyline,t),c=xg(s);if(!n$(i,c))continue;const f=Rp(e,s),u=!f&&pu(s,e);(f||u)&&r.push({targetAnnotation:o,targetPolyline:s,isContourHole:u})}return r}function nW(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}const Rg="PlanarFreehandContourSegmentationTool";function rW(t,e,n,r){const i=r.filter(o=>o.isContourHole),a=r.filter(o=>!o.isContourHole);if(i.length>0){const o=i[0];cW(t,o.targetAnnotation,e),ZT(t,[e,o.targetAnnotation]);return}if(a.length!==0){if(!l1(Rg)){console.warn(`${Rg} is not registered in cornerstone. Cannot process multiple intersections.`);return}iW(t,e,n,a)}}function iW(t,e,n,r){const{element:i}=t,a=[e],o=[],s=[];r.forEach(({targetAnnotation:g})=>{const d=sW(t,g);s.push(...d),a.push(g)});const c=n[0];if(r.some(({targetPolyline:g})=>Fr(g,c))){let g=n;r.forEach(({targetPolyline:d})=>{g=Dp(g,d)}),o.push(g)}else r.forEach(({targetPolyline:g})=>{const d=xp(g,n);o.push(...d)});a.forEach(g=>{yo(g.annotationUID),Ec(g)}),s.forEach(g=>s1(g.annotation));const f=r[0].targetAnnotation,u=[];o.forEach(g=>{if(!g||g.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",g);return}const d=aW(t,f,g);vo(d,i),Oc(d),Qr(d,t.element),u.push(d)}),oW(t,s,u),ZT(t,a)}function aW(t,e,n){const r=t.canvasToWorld(n[0]),i=t.canvasToWorld(n[n.length-1]),a={metadata:{...e.metadata,toolName:Rg,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[r,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:nr(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Ia(a,{points:n,closed:!0,targetWindingDirection:di.Clockwise},t),a}function oW(t,e,n){e.forEach(r=>{const i=n.find(a=>{const o=Ip(a.data.contour.polyline,t);return pu(o,r.polyline)});i&&du(i,r.annotation)})}function sW(t,e){return c1(e).map(n=>{const r=n,i=Ip(r.data.contour.polyline,t);return{annotation:r,polyline:i}})}function cW(t,e,n){du(e,n),Ec(n);const{contour:r}=n.data,i=Ip(r.polyline,t);Ia(n,{points:i,closed:r.closed,targetWindingDirection:e.data.contour.windingDirection===di.Clockwise?di.CounterClockwise:di.Clockwise},t)}function Ip(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}function ZT(t,e){const{element:n}=t,r=new Set([Rg]);e.forEach(i=>{r.add(i.metadata.toolName)});for(const i of r.values())if(l1(i)){const a=us(n,i);Cn(a)}}const{isEqual:$3}=Ma;function JT(t){const{metadata:e}=t;return vk().filter(n=>{if(n.FrameOfReferenceUID===e.FrameOfReferenceUID){const r=n.viewport,{viewPlaneNormal:i,viewUp:a}=r.getCamera();return $3(i,e.viewPlaneNormal)&&(!e.viewUp||$3(a,e.viewUp))}}).map(n=>n.viewport)}function lW(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==Ff.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function uW(t,e,n,r){n.size?t.render():fW(t,e,r)}function fW(t,e,n){const{segmentationId:r}=n,i=new Map;e.forEach(a=>{const o=Ve.getGeometry(a);if(!o){console.warn(`No geometry found for geometryId ${a}. Skipping render.`);return}const s=o.data.segmentIndex;lW(o);const c=dc.getStyle({viewportId:t.id,segmentationId:r,type:nt.Contour,segmentIndex:s}),l=o.data,f=t.getCamera().viewPlaneNormal;l.contours.forEach(u=>{const{points:g,color:d,id:p}=u,h=NB(t,g[0],f),m={annotationUID:nr(),data:{contour:{closed:!0,polyline:g},segmentation:{segmentationId:r,segmentIndex:s,color:d,id:p},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:h,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},v=t.element;vo(m,v),Oc(m)}),c&&i.set(s,c)}),t.render()}function gW(t){const e=dB(t);if(e)return e;const n=Wr(t);if(!n)throw new Error(`No segmentation found for segmentationId ${t}`);let r;if(n.representationData.Labelmap)r=dW(n,t);else if(n.representationData.Contour)r=mW(n);else if(n.representationData.Surface)r=vW(n);else throw new Error(`Unsupported segmentation type: ${n.representationData}`);return hB(t,r),r}function dW(t,e){const n=t.representationData[nt.Labelmap],r=new Set;return n.imageIds?pW(r,n.imageIds):hW(r,e),Array.from(r).map(Number).sort((i,a)=>i-a)}function hW(t,e){Ve.getVolume(e).voxelManager.forEach(({value:r})=>{r!==0&&t.add(r)})}function pW(t,e){e.forEach(n=>{Ve.getImage(n).voxelManager.getScalarData().forEach(a=>{a!==0&&t.add(a)})})}function mW(t){const{annotationUIDsMap:e,geometryIds:n}=t.representationData.Contour||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const r=new Set([...e.keys()]);return n.forEach(i=>{const a=Ve.getGeometry(i);r.add(a.data.segmentIndex)}),Array.from(r).sort((i,a)=>i-a)}function vW(t){const e=t.representationData.Surface?.geometryIds??[];return Array.from(e.keys()).map(Number).sort((n,r)=>n-r)}const $c=new Map,W3=new Map;function yW(t,e,n=!1){const r=Un(t);if(!r)return;const{viewport:i}=r;n&&i.render()}async function TW(t,e){const{segmentationId:n}=e,r=Wr(n);if(!r)return;let i=r.representationData[nt.Contour];const a=Ta();if(!i&&Ta()?.canComputeRequestedRepresentation(n,nt.Contour)&&!$c.get(t.id)?($c.set(t.id,!0),i=await Tp(n,nt.Contour,()=>a.computeContourData(n,{viewport:t})),$c.set(t.id,!1)):!i&&!Ta()&&console.debug(`No contour data found for segmentationId ${n} and PolySeg add-on is not configured. Unable to convert from other representations to contour. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`),!i||!i.geometryIds?.length)return;let o=!1;const s=t.getCamera().viewPlaneNormal;i.annotationUIDsMap&&(o=!wW(i.annotationUIDsMap,s)),i.geometryIds.length>0&&(o=!CW(i.geometryIds,s));const c=W3.get(t.id)||new Set;if(o&&!$c.get(t.id)&&!c.has(n)&&t.viewportStatus===Or.RENDERED){$c.set(t.id,!0);const l=gW(n),u=(await a.computeSurfaceData(n,{segmentIndices:l,viewport:t})).geometryIds,g=[];for(const m of u.values()){const y=Ve.getGeometry(m).data;g.push({points:y.points,polys:y.polys,segmentIndex:y.segmentIndex,id:y.segmentIndex})}const d=await a.clipAndCacheSurfacesForViewport(g,t),p=a.extractContourData(d),h=a.createAndAddContourSegmentationsFromClippedSurfaces(p,t,n);i.annotationUIDsMap=new Map([...i.annotationUIDsMap,...h]),c.add(n),W3.set(t.id,c),$c.set(t.id,!1)}uW(t,i.geometryIds,i.annotationUIDsMap,e)}function CW(t,e){let n=null,r=null;for(const f of t){const u=Ve.getGeometry(f);if(!u)continue;const g=u.data;if(g.contours?.[0]?.points?.length>=3){n=u,r=g;break}}if(!n||!r)return!1;const i=r.contours,{points:a}=i[0],[o]=a,s=Ie(),{length:c}=a,l=Math.ceil(c/25);for(let f=1;f<c;f+=l){const u=a[f];if(Ut(s,o,u),Ht(s,s),He(e,s)>.1)return!1}return!0}function wW(t,e){const n=Array.from(t.values()).flat().map(i=>Array.from(i)).flat(),r=cp(n,3);for(const i of r){const a=mr(i);if(a?.metadata){if(!a.metadata.viewPlaneNormal)continue;const o=a.metadata.viewPlaneNormal,s=Math.abs(e[0]*o[0]+e[1]*o[1]+e[2]*o[2]);if(Math.abs(s-1)>.01)return!1}}return!0}function SW(t){return null}const QT={getUpdateFunction:SW,render:TW,removeRepresentation:yW};function Zl(t,e){return qi.getCurrentLabelmapImageIdsForViewport(t,e)}const z3=new Map,xW=({cfun:t,ofun:e,actor:n})=>{n.getProperty().setRGBTransferFunction(1,t),n.getProperty().setScalarOpacity(1,e)};async function EW({viewport:t,volumeInputs:e,segmentationId:n}){const r=t.getDefaultActor(),{actor:i}=r,{uid:a,callback:o}=r,s=t.getVolumeId();if(z3.get(a)?.added)return{uid:a,actor:i};const c=e,l=Ve.getVolume(c[0].volumeId);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{volumeId:f}=c[0],u=await Wy(f);if(!u)throw new Error(`segImageVolume with id: ${u.volumeId} does not exist`);const d=u.voxelManager.getCompleteScalarDataArray(),{imageData:p}=u,h=Ve.getVolume(s),v=h.voxelManager.getCompleteScalarDataArray(),y=2,T=new Float32Array(y*h.voxelManager.getScalarDataLength()),C=p.getDimensions();for(let N=0;N<C[2];++N)for(let P=0;P<C[1];++P)for(let F=0;F<C[0];++F){const B=F+C[0]*(P+C[1]*N);T[B*y+0]=v[B],T[B*y+1]=d[B]}t.removeActors([a]);const w=i.getMapper(),S=kA(w);i.setMapper(S),S.setBlendMode(as.LABELMAP_EDGE_PROJECTION_BLEND);const _=S.getInputData().getPointData().getArray(0);_.setData(T),_.setNumberOfComponents(2),i.getProperty().setColorMixPreset(1),i.getProperty().setForceNearestInterpolation(1,!0),i.getProperty().setIndependentComponents(!0),t.addActor({actor:i,uid:a,callback:o,referencedId:s,representationUID:`${n}-${nt.Labelmap}`}),z3.set(a,{added:!0,segmentationRepresentationUID:`${n}`,originalBlendMode:t.getBlendMode()}),i.set({preLoad:xW});function D(N){const{segmentationId:P}=N.detail,{representationData:F}=Wr(P),{volumeId:B}=F.Labelmap;if(B!==u.volumeId)return;const U=Ve.getVolume(B).voxelManager,H=S.getInputData(),W=H.getPointData().getArray(0),J=W.getData(),ne=2,q=p.getDimensions(),Q=Array.from({length:q[2]},(ae,me)=>me);for(const ae of Q)for(let me=0;me<q[1];++me)for(let de=0;de<q[0];++de){const je=de+q[0]*(me+q[1]*ae);J[je*ne+1]=U.getAtIndex(je)}W.setData(J),H.modified(),t.render()}return Me.addEventListenerDebounced(fe.SEGMENTATION_DATA_MODIFIED,D,200),Me.addEventListener(fe.SEGMENTATION_REPRESENTATION_REMOVED,async N=>{Me.removeEventListener(fe.SEGMENTATION_DATA_MODIFIED,D);const P=t.getActor(a),{element:F,id:B}=t;t.removeActors([a]);const k=await yh({volumeId:a,blendMode:as.MAXIMUM_INTENSITY_BLEND,callback:({volumeActor:U})=>{P.callback&&P.callback({volumeActor:U,volumeId:f})}},F,B);t.addActor({actor:k,uid:a}),t.render()}),{uid:a,actor:i}}const{uuidv4:eC}=Ma;async function OW(t,e,n,r){const i=Ke(t),{renderingEngine:a,viewport:o}=i,{id:s}=o,c=!0,l=!1,f=!0;if(o instanceof mi){const g=RW(e,n);Ve.getVolume(g)||await DW(e);let d=r?.blendMode??as.MAXIMUM_INTENSITY_BLEND,p=d===as.LABELMAP_EDGE_PROJECTION_BLEND;if(p){const m=o.getVolumeId(),v=Ve.getVolume(m),T=Ve.getVolume(g).dimensions,C=v.dimensions;(T[0]!==C[0]||T[1]!==C[1]||T[2]!==C[2])&&(p=!1,d=as.MAXIMUM_INTENSITY_BLEND,console.debug("Dimensions mismatch - falling back to regular volume addition"))}const h=[{volumeId:g,visibility:c,representationUID:`${n}-${nt.Labelmap}`,useIndependentComponents:p,blendMode:d}];if(!h[0].useIndependentComponents)await UU(a,h,[s],l,f);else return await EW({viewport:o,volumeInputs:h,segmentationId:n})}else{const g=Zl(o.id,n).map(d=>({imageId:d,representationUID:`${n}-${nt.Labelmap}-${d}`}));kU(a,g,[s])}d1(n)}function RW(t,e){let{volumeId:n}=t;if(!n){n=eC();const r=Wr(e);r.representationData.Labelmap={...r.representationData.Labelmap,volumeId:n},t.volumeId=n,vp(e)}return n}async function DW(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await VA(t.volumeId||eC(),e.imageIds)}function MW(t,e){const n=Ke(t),{viewport:r}=n;r.removeActors([RB(r.id,e)])}function bp(t){return qi.getActiveSegmentation(t)}function _W(t){return bp(t)}function Lp(t){const e=Wr(t);if(e){const n=Object.keys(e.segments).find(r=>e.segments[r].active);return n?Number(n):void 0}}const Od=255,Rl=new Map;let Rd=!1;function IW(t,e,n=!1){const r=Un(t);if(Rl.forEach((a,o)=>{o.includes(e)&&Rl.delete(o)}),!r)return;const{viewport:i}=r;MW(i.element,e),n&&i.render()}async function bW(t,e){const{segmentationId:n,config:r}=e,i=Wr(n);if(!i){console.warn("No segmentation found for segmentationId: ",n);return}let a=i.representationData[nt.Labelmap],o=Ol(t.id,n);if(!a&&Ta()?.canComputeRequestedRepresentation(n,nt.Labelmap)&&!Rd){Rd=!0;const s=Ta();if(a=await Tp(n,nt.Labelmap,()=>s.computeLabelmapData(n,{viewport:t}),()=>{qi.processLabelmapRepresentationAddition(t.id,n),setTimeout(()=>{d1(n)},0)}),!a)throw new Error(`No labelmap data found for segmentationId ${n}.`);Rd=!1}else!a&&!Ta()&&console.debug(`No labelmap data found for segmentationId ${n} and PolySeg add-on is not configured. Unable to convert from other representations to labelmap. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(a){if(t instanceof Br)o?.length||await j3(t,a,n,r),o=Ol(t.id,n);else{if(!Zl(t.id,n)?.length)return;o||await j3(t,a,n,r),o=Ol(t.id,n)}if(o?.length)for(const s of o)LW(t.id,s,e)}}function LW(t,e,n){const{segmentationId:r}=n,{cfun:i,ofun:a}=n.config,{colorLUTIndex:o}=n,c=_W(t)?.segmentationId===r,l=dc.getStyle({viewportId:t,type:nt.Labelmap,segmentationId:r}),f=dc.getRenderInactiveSegmentations(t),u=yp(o),g=Math.min(256,u.length),{outlineWidth:d,renderOutline:p,outlineOpacity:h,activeSegmentOutlineWidthDelta:m}=H3(l,c),v=Cp(t,{segmentationId:r,type:nt.Labelmap});for(let w=0;w<g;w++){const S=w,_=u[S],N=dc.getStyle({viewportId:t,type:nt.Labelmap,segmentationId:r,segmentIndex:S}),{fillAlpha:P,outlineWidth:F,renderFill:B,renderOutline:k}=H3(l,c,N),{forceOpacityUpdate:U,forceColorUpdate:H}=VW(t,r,S,{fillAlpha:P,renderFill:B,renderOutline:k,segmentColor:_,outlineWidth:F,segmentsHidden:v,cfun:i,ofun:a});if(H&&i.addRGBPoint(S,_[0]/Od,_[1]/Od,_[2]/Od),U)if(B){const W=v.has(S)?0:_[3]/255*P;a.removePoint(S),a.addPointLong(S,W,.5,1)}else a.addPointLong(S,.01,.5,1)}a.setClamping(!1);const y=e.actor,{preLoad:T}=y.get?.("preLoad")||{preLoad:null};if(T?T({cfun:i,ofun:a,actor:y}):(y.getProperty().setRGBTransferFunction(0,i),y.getProperty().setScalarOpacity(0,a),y.getProperty().setInterpolationTypeToNearest()),p){y.getProperty().setUseLabelOutline(p),y.getProperty().setLabelOutlineOpacity(h);const w=Lp(n.segmentationId),S=new Array(g-1);for(let _=1;_<g;_++){if(v.has(_)){S[_-1]=0;continue}S[_-1]=_===w?d+m:d}y.getProperty().setLabelOutlineThickness(S),y.modified(),y.getProperty().modified(),y.getMapper().modified()}else y.getProperty().setLabelOutlineThickness(new Array(g-1).fill(0));const C=c||f;y.setVisibility(C)}function H3(t,e,n){const i={...t,...n||{}},a=e?i.fillAlpha:i.fillAlphaInactive,o=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,l=e?i.outlineOpacity:i.outlineOpacityInactive,f=i.activeSegmentOutlineWidthDelta;return{fillAlpha:a,outlineWidth:o,renderFill:s,renderOutline:c,outlineOpacity:l,activeSegmentOutlineWidthDelta:f}}function VW(t,e,n,{fillAlpha:r,renderFill:i,renderOutline:a,segmentColor:o,outlineWidth:s,segmentsHidden:c,cfun:l,ofun:f}){const u=`${t}-${e}-${n}`,g=Rl.get(u);if(!g)return Rl.set(u,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:d,renderFill:p,renderOutline:h,outlineWidth:m,segmentColor:v,segmentsHidden:y,cfunMTime:T,ofunMTime:C}=g,w=v[0]!==o[0]||v[1]!==o[1]||v[2]!==o[2],S=v[3]!==o[3]||d!==r||p!==i||h!==a||m!==s||y!==c;return(S||w)&&Rl.set(u,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:S,forceColorUpdate:w}}async function j3(t,e,n,r){return await OW(t.element,e,n,r)||void 0}function PW(t){}const tC={getUpdateFunction:PW,render:bW,removeRepresentation:IW},{CalibrationTypes:tc}=Ra,Dd="px",K3="voxels",NW=[1,2,3,4],AW={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},Md="",FW=[tc.ERMF,tc.USER,tc.ERROR,tc.PROJECTION,tc.CALIBRATED,tc.UNKNOWN],nC=(t,e)=>{const{calibration:n,hasPixelSpacing:r,spacing:i=[1,1,1]}=t;let a=r?"mm":Dd;const o=r?"mm":K3;let s=a+Md;const c=n?.scale||1;let l=c/(n?.columnPixelSpacing||i[0]),f=c/(n?.rowPixelSpacing||i[1]),u=c/i[2],g="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:a,areaUnit:s,scale:l,scaleY:f,scaleZ:u,volumeUnit:o};if(FW.includes(n?.type)&&(g=n.type),n.type===tc.UNCALIBRATED)return{unit:Dd,areaUnit:Dd+Md,scale:l,scaleY:f,scaleZ:u,volumeUnit:K3};if(n.sequenceOfUltrasoundRegions){const d=n.sequenceOfUltrasoundRegions.find(p=>e.every(h=>h[0]>=p.regionLocationMinX0&&h[0]<=p.regionLocationMaxX1&&h[1]>=p.regionLocationMinY0&&h[1]<=p.regionLocationMaxY1)&&NW.includes(p.regionDataType));if(d&&d.physicalUnitsXDirection===d.physicalUnitsYDirection){const p=Math.abs(d.physicalDeltaX),h=Math.abs(d.physicalDeltaY);l=1/p,f=1/h,g="US Region",a=AW[d.physicalUnitsXDirection]||"unknown",s=a+Md}}else n.scale&&(l=n.scale);return{unit:a+(g?` ${g}`:""),areaUnit:s+(g?` ${g}`:""),volumeUnit:o+(g?` ${g}`:""),scale:l,scaleY:f,scaleZ:u}},{isEqual:_d}=Ma,{EPSILON:UW}=Gh,kW=1-UW;function GW(t,e,n){const{viewPlaneNormal:r}=e,i=t.filter(c=>{const{planeRestriction:l,referencedImageId:f}=c.metadata;let{viewPlaneNormal:u}=c.metadata;if(l){const{inPlaneVector1:d,inPlaneVector2:p}=l;return!(d&&!_d(0,He(r,d))||p&&!_d(0,He(r,p)))}if(!c.metadata.referencedImageId&&!u&&c.metadata.FrameOfReferenceUID){for(const d of c.data.handles.points){const p=Ut(Ie(),d,e.focalPoint),h=He(p,r);if(!_d(h,0))return!1}return c.metadata.viewPlaneNormal=r,c.metadata.cameraFocalPoint=e.focalPoint,!0}if(!u&&f){const{imageOrientationPatient:d}=Pe("imagePlaneModule",f),p=Et(d[0],d[1],d[2]),h=Et(d[3],d[4],d[5]);u=Ie(),zt(u,p,h),c.metadata.viewPlaneNormal=u}const g=Math.abs(He(r,u))>kW;return u&&g});if(!i.length)return[];const a=n/2,{focalPoint:o}=e,s=[];for(const c of i){const{data:l,metadata:f,isVisible:u}=c;if(!u)continue;const g=f.planeRestriction?.point||l.handles?.points?.[0]||l.contour?.polyline[0];if(!g){s.push(c);continue}const d=Ut(Ie(),o,g);Math.abs(He(d,r))<a&&s.push(c)}return s}function rC(t,e,n={}){if(t instanceof Br){const r=t.getCamera(),{spacingInNormalDirection:i}=fu(t,r);return GW(e,r,i)}if(t instanceof Jr){const r=t.getCurrentImageId();if(!r)return[];const i=r.indexOf(":");n.imageURI=r.substring(i+1)}return e.filter(r=>r.isVisible?r.data.isCanvasAnnotation?!0:t.isReferenceViewable(r.metadata,n):!1)}function iC(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function aC(t,e,n){let r,i,a,o,s,c,l=0,f=!1,u=!1,g=!0;const d=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,iC(n)&&(f=!!n.leading,u="maxWait"in n,a=u?Math.max(Number(n.maxWait)||0,e):a,g="trailing"in n?!!n.trailing:g);function p(P){const F=r,B=i;return r=i=void 0,l=P,o=t.apply(B,F),o}function h(P,F){return d?window.requestAnimationFrame(P):setTimeout(P,F)}function m(P){if(d)return window.cancelAnimationFrame(P);clearTimeout(P)}function v(P){return l=P,s=h(C,e),f?p(P):o}function y(P){const F=P-c,B=P-l,k=e-F;return u?Math.min(k,a-B):k}function T(P){const F=P-c,B=P-l;return c===void 0||F>=e||F<0||u&&B>=a}function C(){const P=Date.now();if(T(P))return w(P);s=h(C,y(P))}function w(P){return s=void 0,g&&r?p(P):(r=i=void 0,o)}function S(){s!==void 0&&m(s),l=0,r=c=i=s=void 0}function _(){return s===void 0?o:w(Date.now())}function D(){return s!==void 0}function N(...P){const F=Date.now(),B=T(F);if(r=P,i=this,c=F,B){if(s===void 0)return v(c);if(u)return s=h(C,e),p(c)}return s===void 0&&(s=h(C,e)),o}return N.cancel=S,N.flush=_,N.pending=D,N}function oC(t,e,n){let r=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return iC(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),aC(t,e,{leading:r,trailing:i,maxWait:e})}function BW(t){return t[0]?.length===3}function $W(t,e){if(!e||e.length===0||e.length===t.length)return t;const n=e[e.length-1]-e[0]+1,r=hd(e.map(a=>t[a][0])),i=hd(e.map(a=>t[a][1]));if(BW(t)){const a=hd(e.map(o=>t[o][2]));return g3(Q0(r,n),Q0(i,n),Q0(a,n))}else return g3(Q0(r,n),Q0(i,n))}function WW(t,e){const n=[],[r,i]=e,a=i-r+1,o=Math.floor(a/t);let s=0,c=Math.round((a-1)/(o-1)*s)+r;for(;c<=i;)n.push(c),s++,c=Math.round((a-1)/(o-1)*s)+r;return n}function zW(t,e,n,r){const i=n-e+1,a=Math.floor(r/100*i)??1,o=Math.floor(i/a)??1;if(isNaN(i)||!i||!o||i/o<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,n),l=t.slice(0,s),f=t.slice(c+1,t.length),u=WW(o,[s,c]),g=$W(t,u);return[...l,...g,...f]}function v1(t,e){return e?.autoGenerated?!1:t?.smoothing?.smoothOnAdd===!0||t?.smoothing?.smoothOnEdit===!0}function HW(t,e){return FT(t,e)<.001}function jW(t,e){return FT(t,e)===0}function KW(t,e){for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(jW(t[n],e[r]))return[n,r]}function Jc(t,e,n){return(t+e+n)%e}function q3(t,e,n,r){const[,i,a]=t,[,o,s]=e,c=a.length,l=s.length;let f=t[0],u=e[0];if(!a[f]||!s[u]||!a[i]||!s[o])return[void 0,void 0];for(;f!==i&&u!==o;){if(n(s[u],a[f]))return[f,u];f=Jc(f,c,r),u=Jc(u,l,r)}return[void 0,void 0]}function qW(t,e){const[n,r]=KW(t,e)||[],i=(c,l)=>HW(c,l)===!1,[a,o]=q3([Jc(n,t.length,1),n,t],[Jc(r,e.length,1),r,e],i,1),[s]=q3([Jc(a,t.length,-1),a,t],[Jc(o,e.length,-1),o,e],i,-1);return[a,s]}function y1(t,e,n){const{interpolation:r,smoothing:i}=t,a=e;if(r){const{knotsRatioPercentageOnAdd:o,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:l=!1}=i,f=n?s:o;if(n?l:c){const[g,d]=n?qW(e,n):[0,e.length-1];return!e[g]||!e[d]?e:zW(e,g,d,f)}}return a}const T1=t=>{if(t.shiftKey)return t.ctrlKey?ai.ShiftCtrl:t.altKey?ai.ShiftAlt:t.metaKey?ai.ShiftMeta:ai.Shift;if(t.ctrlKey)return t.altKey?ai.CtrlAlt:t.metaKey?ai.CtrlMeta:ai.Ctrl;if(t.altKey)return t.metaKey&&ai.AltMeta||ai.Alt;if(t.metaKey)return ai.Meta};function Vp(t,e){const n=t[0],r=t[t.length-1],i=un();i0(i,r[0]-n[0],r[1]-n[1]),y8(i,i);const a=un(),o=un();i0(a,-i[1],i[0]),i0(o,i[1],-i[0]);const s=[(n[0]+r[0])/2,(n[1]+r[1])/2],c={dist:0,index:null};for(let u=0;u<t.length;u++){const g=t[u],d=v2(g,s);d>c.dist&&(c.dist=d,c.index=u)}return[t[c.index],s].map(e.canvasToWorld)}function XW(t,e){const{viewport:n}=t,r=e.data.contour.polyline.map(n.worldToCanvas);return Vp(r,n)}const{addCanvasPointsToArray:Pp,pointsAreWithinCloseContourProximity:sC,getFirstLineSegmentIntersectionIndexes:cC,getSubPixelSpacingAndXYDirections:YW}=bc;function ZW(t,e,n){this.isDrawing=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=Ke(a),{viewport:c}=s,l=T1(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:f,xDir:u,yDir:g}=YW(c,this.configuration.subPixelResolution)||{};!f||!u||!g||(this.drawData={canvasPoints:[o],polylineIndex:0,contourHoleProcessingEnabled:l,newAnnotation:!0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},Ye.isInteractingWithTool=!0,a.addEventListener(fe.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(fe.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(fe.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(fe.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(fe.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(fe.TOUCH_TAP,this.mouseUpDrawCallback),gc(a))}function JW(t){Ye.isInteractingWithTool=!1,t.removeEventListener(fe.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(fe.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(fe.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(fe.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(fe.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(fe.TOUCH_TAP,this.mouseUpDrawCallback),jl(t)}function QW(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=Ke(r),{viewport:s}=o,{annotation:c,viewportIdsToRender:l,xDir:f,yDir:u,spacing:g,movingTextBox:d}=this.commonData,{polylineIndex:p,canvasPoints:h,newAnnotation:m}=this.drawData;this.createMemo(r,c,{newAnnotation:m});const v=h[h.length-1],y=s.canvasToWorld(v),T=Ie();_n(T,i,y);const C=Math.abs(He(T,f)),w=Math.abs(He(T,u));if(!(C<=g[0]&&w<=g[1])){if(d){this.isDrawing=!1;const{deltaPoints:S}=e,_=S.world,{textBox:D}=c.data.handles,{worldPosition:N}=D;N[0]+=_[0],N[1]+=_[1],N[2]+=_[2],D.hasMoved=!0}else{const S=this.findCrossingIndexDuringCreate(t);if(S!==void 0)this.applyCreateOnCross(t,S);else{const _=Pp(r,h,a,this.commonData);this.drawData.polylineIndex=p+_}c.invalidated=!0}Cn(l),c.invalidated&&Qr(c,r,Li.HandlesUpdated)}}function ez(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1],o=t.detail,{element:s}=o;this.doneEditMemo(),this.drawData.newAnnotation=!1,e&&!sC(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:r})}function tz(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r,minPointsToSave:i}=e??{};if(i&&n.length<i||this.haltDrawing(t,n))return!1;const{annotation:a,viewportIdsToRender:o}=this.commonData,s=Ke(t),{viewport:c,renderingEngine:l}=s;Pp(t,n,n[0],this.commonData),n.pop();const f=v1(this.configuration,a)?y1(this.configuration,n):n;this.updateContourPolyline(a,{points:f,closed:!0,targetWindingDirection:di.Clockwise},c);const{textBox:u}=a.data.handles;return u?.hasMoved||fp(a,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Cn(o),this.deactivateDraw(t),!0}function nz(){const{canvasPoints:t}=this.drawData,e=t.length,n=[t[0],t[e-1]],r=t.slice(0,-1).slice(1),i=cC(r,n[0],n[1],!1);if(i){const a=i[1];a===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,a)}}function rz(t,e){const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r}=e??{};if(this.haltDrawing(t,n))return!1;const{annotation:i,viewportIdsToRender:a}=this.commonData,o=Ke(t),{viewport:s,renderingEngine:c}=o,l=v1(this.configuration,i)?y1(this.configuration,n):n;this.updateContourPolyline(i,{points:l,closed:!1},s);const{textBox:f}=i.data.handles,u=i.data.contour.polyline;return i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=Vp(n,s)),f.hasMoved||fp(i,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Cn(a),this.deactivateDraw(t),!0}function iz(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{canvasPoints:o}=this.drawData,s=o.slice(0,-1),c=cC(s,i,a,!1);return c===void 0?void 0:c[0]}function az(t,e){const n=t.detail,{element:r}=n,{canvasPoints:i,contourHoleProcessingEnabled:a}=this.drawData,{annotation:o,viewportIdsToRender:s}=this.commonData;Pp(r,i,i[e],this.commonData),i.pop();const c=i.slice(e),l=Sp(c);if(Wt(l,0)){i.splice(e+1);return}i.splice(0,e);const f={contourHoleProcessingEnabled:a,minPointsToSave:3};this.completeDrawClosedContour(r,f)&&this.activateClosedContourEdit(t,o,s)}function oz(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1];e&&!sC(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:r})}function sz(t,e){const n=Math.max(e*3,3);return t.length<n}function cz(t,e){const{subPixelResolution:n}=this.configuration;if(sz(e,n)){const{annotation:r,viewportIdsToRender:i}=this.commonData,a=Ke(t),{renderingEngine:o}=a;return yo(r.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Cn(i),this.deactivateDraw(t),!0}return!1}function lz(t){t.activateDraw=ZW.bind(t),t.deactivateDraw=JW.bind(t),t.applyCreateOnCross=az.bind(t),t.findCrossingIndexDuringCreate=iz.bind(t),t.completeDrawOpenContour=rz.bind(t),t.removeCrossedLinesOnCompleteDraw=nz.bind(t),t.mouseDragDrawCallback=QW.bind(t),t.mouseUpDrawCallback=ez.bind(t),t.completeDrawClosedContour=tz.bind(t),t.cancelDrawing=oz.bind(t),t.haltDrawing=cz.bind(t)}const{addCanvasPointsToArray:uz,getFirstLineSegmentIntersectionIndexes:Mc}=bc;function fz(t,e){const n=t.detail,{element:r,currentPoints:i,lastPoints:a}=n,o=i.canvas,s=a.canvas,{editCanvasPoints:c,prevCanvasPoints:l}=this.editData,f=Mc(l,o,s,e);if(f)this.editData.startCrossingIndex=f[0],this.removePointsUpUntilFirstCrossing(e);else if(l.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const u=c[0],g=[];for(let h=0;h<l.length;h++){const m=l[h],v=er(m,u);g.push({distance:v,index:h})}g.sort((h,m)=>h.distance-m.distance);const d=[g[0],g[1]],p=Math.min(d[0].index,d[1].index);this.editData.startCrossingIndex=p}else{const u=un();gr(u,c[1],c[0]),y8(u,u);const g=6,d=[c[0][0]-u[0]*g,c[0][1]-u[1]*g],p=Mc(l,d,c[0],e);if(p){const h=[d];uz(r,h,c[0],this.commonData),c.unshift(...h),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=p[0]}}}function gz(t){const{editCanvasPoints:e,prevCanvasPoints:n}=this.editData;let r=0;for(let i=0;i<e.length-1;i++){const a=[e[i],e[i+1]],o=!!Mc(n,a[0],a[1],t);if(r++,o)break}e.splice(0,r),this.editData.editIndex=e.length-1}function dz(t,e){const n=t.detail,{currentPoints:r,lastPoints:i}=n,a=r.canvas,o=i.canvas,{prevCanvasPoints:s}=this.editData;return!!Mc(s,a,o,e)}function hz(t){const{prevCanvasPoints:e,editCanvasPoints:n}=this.editData;for(let r=n.length-1;r>0;r--){const i=[n[r],n[r-1]],a=!!Mc(e,i[0],i[1],t);if(n.pop(),a)break}}function pz(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:n}=this.editData;if(n===void 0)return;const r=t[t.length-1],i=[];for(let o=0;o<e.length;o++){const s=e[o],c=er(s,r);i.push({distance:c,index:o})}i.sort((o,s)=>o.distance-s.distance);const a=t.slice(0,-1);for(let o=0;o<i.length;o++){const{index:s}=i[o],c=e[s],l=t[t.length-1];if(!Mc(a,c,l,!1))return s}return-1}function mz(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{editCanvasPoints:o}=this.editData,s=o.slice(0,-2),c=Mc(s,i,a,!1);if(!c)return;const l=c[0],f=o.length-l;for(let u=0;u<f;u++)o.pop()}function vz(t){t.checkForFirstCrossing=fz.bind(t),t.removePointsUpUntilFirstCrossing=gz.bind(t),t.checkForSecondCrossing=dz.bind(t),t.findSnapIndex=pz.bind(t),t.removePointsAfterSecondCrossing=hz.bind(t),t.checkAndRemoveCrossesOnEditLine=mz.bind(t)}const{getSubPixelSpacingAndXYDirections:yz,addCanvasPointsToArray:lC,getArea:X3}=bc;function Tz(t,e,n){this.isEditingClosed=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=Ke(a);if(!s)return;const{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:g}=yz(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0,annotation:e},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},Ye.isInteractingWithTool=!0,a.addEventListener(fe.MOUSE_UP,this.mouseUpClosedContourEditCallback),a.addEventListener(fe.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(fe.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),a.addEventListener(fe.TOUCH_END,this.mouseUpClosedContourEditCallback),a.addEventListener(fe.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(fe.TOUCH_TAP,this.mouseUpClosedContourEditCallback),gc(a)}function Cz(t){Ye.isInteractingWithTool=!1,t.removeEventListener(fe.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(fe.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(fe.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(fe.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(fe.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(fe.TOUCH_TAP,this.mouseUpClosedContourEditCallback),jl(t)}function wz(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=Ke(r),{viewport:s}=o,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:g,editCanvasPoints:d,startCrossingIndex:p,annotation:h}=this.editData;this.createMemo(r,h);const m=d[d.length-1],v=s.canvasToWorld(m),y=Ie();_n(y,i,v);const T=Math.abs(He(y,l)),C=Math.abs(He(y,f));if(T<=u[0]&&C<=u[1])return;p!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const w=lC(r,d,a,this.commonData),S=g+w;if(this.editData.editIndex=S,p===void 0&&d.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),p!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),Cn(c)}function Sz(t){const e=t.detail,{element:n}=e,r=Ke(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Ia(o,{points:c,closed:!0,targetWindingDirection:di.Clockwise},i),o.autoGenerated&&(o.autoGenerated=!1),Qr(o,n);const f=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[f],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0,annotation:o},Cn(s)}function xz(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];lC(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,l;r>i?(c=i,l=r):(c=r,l=i);const f=er(e[c],s[0]),u=er(e[c],s[s.length-1]),g=er(e[l],s[0]),d=er(e[l],s[s.length-1]),p=[];for(let w=0;w<c;w++){const S=e[w];p.push([S[0],S[1]])}let h=f+d,m=u+g;if(h<m)for(let w=0;w<s.length;w++){const S=s[w];p.push([S[0],S[1]])}else for(let w=s.length-1;w>=0;w--){const S=s[w];p.push([S[0],S[1]])}for(let w=l;w<e.length;w++){const S=e[w];p.push([S[0],S[1]])}const v=[];for(let w=c;w<l;w++){const S=e[w];v.push([S[0],S[1]])}if(h=g+u,m=d+f,h<m)for(let w=0;w<s.length;w++){const S=s[w];v.push([S[0],S[1]])}else for(let w=s.length-1;w>=0;w--){const S=s[w];v.push([S[0],S[1]])}const y=X3(p),T=X3(v);return y>T?p:v}function Ez(t){const e=t.detail,{element:n}=e;this.completeClosedContourEdit(n)}function Oz(t){const e=Ke(t),{viewport:n}=e,{annotation:r,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:a,prevCanvasPoints:o}=this.editData;if(a){const s=v1(this.configuration,r)?y1(this.configuration,a,o):a,c=this.configuration?.decimate||{};Ia(r,{points:s,closed:!0,targetWindingDirection:di.Clockwise},n,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}}),r.autoGenerated&&(r.autoGenerated=!1),Qr(r,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,Cn(i),this.deactivateClosedContourEdit(t)}function Rz(t){this.completeClosedContourEdit(t)}function Dz(t){t.activateClosedContourEdit=Tz.bind(t),t.deactivateClosedContourEdit=Cz.bind(t),t.mouseDragClosedContourEditCallback=wz.bind(t),t.mouseUpClosedContourEditCallback=Ez.bind(t),t.finishEditAndStartNewEdit=Sz.bind(t),t.fuseEditPointsWithClosedContour=xz.bind(t),t.cancelClosedContourEdit=Rz.bind(t),t.completeClosedContourEdit=Oz.bind(t)}const{addCanvasPointsToArray:uC,getSubPixelSpacingAndXYDirections:Mz}=bc;function _z(t,e,n){this.isEditingOpen=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=Ke(a),{viewport:c}=s;this.doneEditMemo();const l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:g}=Mz(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},Ye.isInteractingWithTool=!0,a.addEventListener(fe.MOUSE_UP,this.mouseUpOpenContourEditCallback),a.addEventListener(fe.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(fe.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),a.addEventListener(fe.TOUCH_END,this.mouseUpOpenContourEditCallback),a.addEventListener(fe.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(fe.TOUCH_TAP,this.mouseUpOpenContourEditCallback),gc(a)}function Iz(t){Ye.isInteractingWithTool=!1,t.removeEventListener(fe.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(fe.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(fe.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(fe.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(fe.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(fe.TOUCH_TAP,this.mouseUpOpenContourEditCallback),jl(t)}function bz(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=Ke(r),{viewport:s}=o,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:g,editCanvasPoints:d,startCrossingIndex:p}=this.editData,h=d[d.length-1],m=s.canvasToWorld(h),v=Ie();this.createMemo(r,this.commonData.annotation),_n(v,i,m);const y=Math.abs(He(v,l)),T=Math.abs(He(v,f));if(y<=u[0]&&T<=u[1])return;p!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const C=uC(r,d,a,this.commonData),w=g+C;this.editData.editIndex=w,p===void 0&&d.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),p!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),Cn(c)}function Lz(t){const e=t.detail,{element:n}=e,r=Ke(n),{viewport:i}=r,{annotation:a,viewportIdsToRender:o}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Ia(a,{points:s,closed:!1},i);const c=a.data.contour.polyline;a.data.handles.points=[c[0],c[c.length-1]],a.data.handles.activeHandleIndex=1,Qr(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.doneEditMemo(),this.deactivateOpenContourEdit(n),this.activateOpenContourEndEdit(t,a,o,null)}function Vz(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{snapIndex:o,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||o===void 0)return!1;if(o===-1)return!0;if(o!==0&&o!==s.length-1)return!1;const l=i,f=a,u=s[o],g=un(),d=un();i0(g,l[0]-f[0],l[1]-f[1]),i0(d,l[0]-u[0],l[1]-u[1]);const p=Js(g,d),h=Math.sqrt(g[0]*g[0]+g[1]*g[1]),m=Math.sqrt(d[0]*d[0]+d[1]*d[1]);return Math.acos(p/(h*m))<Math.PI/2}function Pz(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=r;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<r;s++){const c=e[s];i.push([c[0],c[1]])}const a=er(e[r],n[0]),o=er(e[r],n[n.length-1]);if(a<o)for(let s=0;s<n.length;s++){const c=n[s];i.push([c[0],c[1]])}else for(let s=n.length-1;s>=0;s--){const c=n[s];i.push([c[0],c[1]])}return i}function Nz(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];uC(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,l;r>i?(c=i,l=r):(c=r,l=i);const f=er(e[c],s[0]),u=er(e[c],s[s.length-1]),g=er(e[l],s[0]),d=er(e[l],s[s.length-1]),p=[];for(let v=0;v<c;v++){const y=e[v];p.push([y[0],y[1]])}const h=f+d,m=u+g;if(h<m)for(let v=0;v<s.length;v++){const y=s[v];p.push([y[0],y[1]])}else for(let v=s.length-1;v>=0;v--){const y=s[v];p.push([y[0],y[1]])}for(let v=l;v<e.length;v++){const y=e[v];p.push([y[0],y[1]])}return p}function Az(t){const e=t.detail,{element:n}=e,r=Ke(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Ia(o,{points:c,closed:!1},i);const f=o.data.contour.polyline;o.data.handles.points=[f[0],f[f.length-1]],Qr(o,n);const u=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},Cn(s)}function Fz(t){const e=t.detail,{element:n}=e;this.completeOpenContourEdit(n)}function Uz(t){const e=Ke(t),{viewport:n}=e,{annotation:r,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:a,prevCanvasPoints:o}=this.editData;if(a){const s=v1(this.configuration)?y1(this.configuration,a,o):a,c=this.configuration?.decimate||{};Ia(r,{points:s,closed:!1},n,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}});const l=r.data.contour.polyline;r.data.handles.points=[l[0],l[l.length-1]],r.data.isOpenUShapeContour&&(r.data.openUShapeContourVectorToPeak=Vp(a,n)),Qr(r,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,Cn(i),this.deactivateOpenContourEdit(t)}function kz(t){this.completeOpenContourEdit(t)}function Gz(t){t.activateOpenContourEdit=_z.bind(t),t.deactivateOpenContourEdit=Iz.bind(t),t.mouseDragOpenContourEditCallback=bz.bind(t),t.mouseUpOpenContourEditCallback=Fz.bind(t),t.fuseEditPointsWithOpenContour=Nz.bind(t),t.finishEditOpenOnSecondCrossing=Az.bind(t),t.checkIfShouldOverwriteAnEnd=Vz.bind(t),t.fuseEditPointsForOpenContourEndEdit=Pz.bind(t),t.openContourEditOverwriteEnd=Lz.bind(t),t.cancelOpenContourEdit=kz.bind(t),t.completeOpenContourEdit=Uz.bind(t)}const{getSubPixelSpacingAndXYDirections:Bz}=bc;function $z(t,e,n,r){this.isDrawing=!0;const i=t.detail,{element:a}=i,o=Ke(a),{viewport:s}=o,{spacing:c,xDir:l,yDir:f}=Bz(s,this.configuration.subPixelResolution),u=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&u.reverse();let d=!1;r?.worldPosition&&(d=!0),this.drawData={canvasPoints:u,polylineIndex:u.length-1},this.commonData={annotation:e,viewportIdsToRender:n,spacing:c,xDir:l,yDir:f,movingTextBox:d},Ye.isInteractingWithTool=!0,a.addEventListener(fe.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(fe.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(fe.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(fe.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(fe.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(fe.TOUCH_TAP,this.mouseUpDrawCallback),gc(a)}function Wz(t){t.activateOpenContourEndEdit=$z.bind(t)}function zz(t){return(t.childAnnotationUIDs??[]).map(n=>mr(n).data.contour.polyline)}function C1(t,e){const n=zz(t),r=[];return n.forEach(i=>{const a=i.length,o=new Array(a);for(let s=0;s<a;s++)o[s]=e.worldToCanvas(i[s]);r.push(o)}),r}const{pointsAreWithinCloseContourProximity:Hz}=bc;function jz(t,e){const n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:r,lineDash:i,color:a,fillColor:o,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:n}),{closed:c}=e.data.contour;return{color:a,width:r,lineDash:i,fillColor:o,fillOpacity:s,closePath:c}}function Kz(t,e,n){t?.viewport?.getImageData()&&(n.data.contour.closed?this.renderClosedContour(t,e,n):n.data.isOpenUShapeContour?(qz(t,n),this.renderOpenUShapedContour(t,e,n)):this.renderOpenContour(t,e,n))}function qz(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=XW(t,e))}function Xz(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(l=>r.worldToCanvas(l)),o=C1(n,r),s=[a,...o];f0(e,n.annotationUID,"1",s,i)}function Yz(t,e,n){const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(c=>r.worldToCanvas(c));O0(e,n.annotationUID,"1",a,i);const s=n.data.handles.activeHandleIndex;if(this.configuration.alwaysRenderOpenContourHandles?.enabled===!0){const c=this.configuration.alwaysRenderOpenContourHandles.radius,l="0",f=[a[0],a[a.length-1]];s===0?f.shift():s===1&&f.pop(),Eg(e,n.annotationUID,l,f,{color:i.color,handleRadius:c})}if(s!==null){const l=s===0?0:a.length-1,f=a[l];Eg(e,n.annotationUID,"1",[f],{color:i.color})}}function Zz(t,e,n){const{viewport:r}=t,{openUShapeContourVectorToPeak:i}=n.data,{polyline:a}=n.data.contour;if(this.renderOpenContour(t,e,n),!i)return;const o=r.worldToCanvas(a[0]),s=r.worldToCanvas(a[a.length-1]),c=[r.worldToCanvas(i[0]),r.worldToCanvas(i[1])],l=this._getRenderingOptions(t,n);O0(e,n.annotationUID,"first-to-last",[o,s],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"}),O0(e,n.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"})}function Jz(t,e,n){const r=this._getRenderingOptions(t,n),{allowOpenContours:i}=this.configuration,{canvasPoints:a}=this.drawData;if(r.closePath=!1,O0(e,n.annotationUID,"1",a,r),i){const o=a[0],s=a[a.length-1];Hz(o,s,this.configuration.closeContourProximity)?O0(e,n.annotationUID,"2",[s,o],r):Eg(e,n.annotationUID,"0",[o],{color:r.color,handleRadius:2})}}function Qz(t,e,n){const{viewport:r}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,n);return}const a=C1(n,r),o=[i,...a],s=this._getRenderingOptions(t,n),c="preview-1";n.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),f0(e,n.annotationUID,c,o,s)}function eH(t,e,n){const{fusedCanvasPoints:r}=this.editData;if(r===void 0){this.renderOpenContour(t,e,n);return}const i=this._getRenderingOptions(t,n);O0(e,n.annotationUID,"preview-1",r,i)}function tH(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(p=>r.worldToCanvas(p)),o=C1(n,r),s="1",c=a[0],l=6,f=100,u=[];for(let p=0;p<f;p++){const h=p/f*2*Math.PI,m=c[0]+l*Math.cos(h),v=c[1]+l*Math.sin(h);u.push([m,v])}const g=[[c[0]-l*2,c[1]],[c[0]+l*2,c[1]],[c[0],c[1]-l*2],[c[0],c[1]+l*2]];f0(e,n.annotationUID,s+"-crosshair_v",[g[0],g[1]],i),f0(e,n.annotationUID,s+"-crosshair_h",[g[2],g[3]],i);const d=[u,...o];f0(e,n.annotationUID,s,d,i)}function nH(t){t.renderContour=Kz.bind(t),t.renderClosedContour=Xz.bind(t),t.renderOpenContour=Yz.bind(t),t.renderPointContourWithMarker=tH.bind(t),t.renderOpenUShapedContour=Zz.bind(t),t.renderContourBeingDrawn=Jz.bind(t),t.renderClosedContourBeingEdited=Qz.bind(t),t.renderOpenContourBeingEdited=eH.bind(t),t._getRenderingOptions=jz.bind(t)}function fC(t){const e=rH(t),n=(e.top[1]+e.bottom[1])/2;return[e.right[0],n]}function rH(t){const e=[t[0],t[1]].sort(o),n=[t[0],t[1]].sort(s),r=e[e.length-1],i=n[0],a=n[n.length-1];return{top:i,bottom:a,right:r};function o(c,l){return c[0]<l[0]?-1:1}function s(c,l){return c[1]<l[1]?-1:1}}function iH(t,e){if(t instanceof mi){const n=N0(e),r=Ve.getVolume(n);return!!r?.scaling&&Object.keys(r.scaling).length>0}else if(t instanceof Jr){const{preScale:n}=t.getImageData()||{};return!!n?.scaled}else return!1}const{DefaultHistoryMemo:Wc}=sp,Vl=class Vl{constructor(e,n){this.isPrimary=!1;const r=Vl.mergeDefaultProps(Vl.defaults,n),i=Zr(r,e),{configuration:a={},supportedInteractionTypes:o,toolGroupId:s}=i;this.toolGroupId=s,this.supportedInteractionTypes=o||[],this.configuration=Object.assign({},a),this.mode=rn.Disabled}static mergeDefaultProps(e={},n){return n?Zr(e,n):e}get toolName(){return this.getToolName()}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,n){const{strategies:r,activeStrategy:i}=this.configuration;return r[i]?.call(this,e,n)}applyActiveStrategyCallback(e,n,r,...i){const{strategies:a,activeStrategy:o}=this.configuration;if(!a[o])throw new Error(`applyActiveStrategyCallback: active strategy ${o} not found, check tool configuration or spellings`);return a[o][r]?.call(this,e,n,...i)}setConfiguration(e){this.configuration=Zr(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const n=e.split("imageId:")[1],r=hr(n);let i=Rh(r);return!i||!i.length||(i=i.filter(a=>a.getCurrentImageId()===n),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const n=N0(e),r=e1(n);return!r||!r.length?void 0:r[0].getImageData()}else if(e.startsWith("videoId:")){const n=hr(e),r=Rh(n);return!r||!r.length?void 0:r[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const n=e.getViewReferenceId?.();if(n)return n;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}undo(){this.doneEditMemo(),Wc.undo()}redo(){Wc.redo()}static createZoomPanMemo(e){const n={pan:e.getPan(),zoom:e.getZoom()},r={restoreMemo:()=>{const i=e.getPan(),a=e.getZoom();e.setZoom(n.zoom),e.setPan(n.pan),e.render(),n.pan=i,n.zoom=a}};return Wc.push(r),r}doneEditMemo(){this.memo?.commitMemo?.()&&Wc.push(this.memo),this.memo=null}static startGroupRecording(){Wc.startGroupRecording()}static endGroupRecording(){Wc.endGroupRecording()}static calculateLengthInIndex(e,n,r=!1){const i=e?.scale||1,a=e?.scaleY||i,o=e?.scaleZ||i;let s=0;const c=n.length,l=r?0:1;let f=r?n[c-1]:n[0];for(let u=l;u<c;u++){const g=n[u],d=(g[0]-f[0])/i,p=(g[1]-f[1])/a,h=(g[2]-f[2])/o;s+=Math.sqrt(d*d+p*p+h*h),f=g}return s}static isInsideVolume(e,n){const{length:r}=n;for(let i=0;i<r;i++)if(!O7(n[i],e))return!1;return!0}};Vl.defaults={configuration:{strategies:{},defaultStrategy:void 0,activeStrategy:void 0,strategyOptions:{}}};let ys=Vl;ys.toolName="BaseTool";function aH(t){if(t){if(t.data&&t.highlighted)return ts.Highlighted;if(h1(t.annotationUID))return ts.Selected;if(xc(t.annotationUID))return ts.Locked;if(t.data&&t.autoGenerated)return ts.AutoGenerated}return ts.Default}class w1 extends ys{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:n,imageId:r}=e.detail,i=hr(r),a=_a();a.getFramesOfReference().forEach(s=>{const l=a.getAnnotations(s)[this.getToolName()];!l||!l.length||(l.forEach(f=>{if(!f.metadata?.referencedImageId)return;hr(f.metadata.referencedImageId)===i&&(f.invalidated=!0,f.data.cachedStats={})}),vu(n))})}}filterInteractableAnnotationsForElement(e,n){if(!n?.length)return[];const r=Ke(e),{viewport:i}=r;return rC(i,n)}static createAnnotation(...e){let n={annotationUID:null,highlighted:!0,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:this.toolName},data:{handles:{points:new Array,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{},label:""}};for(const r of e)n=Zr(n,r);return n}createAnnotation(e,n,...r){const i=e.detail,{currentPoints:a,element:o}=i,{world:s}=a,c=Ke(o),{viewport:l}=c,f=l.getCamera(),{viewPlaneNormal:u,viewUp:g,position:d}=f,p=this.getReferencedImageId(l,s,u,g),h=l.getViewReference({points:[s]});return w1.createAnnotation({metadata:{toolName:this.getToolName(),...h,referencedImageId:p,viewUp:g,cameraPosition:d},data:{handles:{points:n||[]}}},...r)}getReferencedImageId(e,n,r,i){const a=this.getTargetId(e);let o=a.split(/^[a-zA-Z]+:/)[1];if(e instanceof mi){const s=N0(a),c=Ve.getVolume(s);o=Hl(c,n,r)}return o}getStyle(e,n,r){return Tg(e,n,aH(r),this.mode)}}w1.toolName="AnnotationDisplayTool";const{DefaultHistoryMemo:Id}=sp,{PointsManager:oH}=Ma;class is extends w1{static createAnnotationForViewport(e,...n){return this.createAnnotation({metadata:e.getViewReference()},...n)}static createAndAddAnnotation(e,...n){const r=this.createAnnotationForViewport(e,...n);vo(r,e.element),Qr(r,e.element)}constructor(e,n){super(e,n),this.mouseMoveCallback=(r,i)=>{if(!i)return!1;const{element:a,currentPoints:o}=r.detail,s=o.canvas;let c=!1;for(const l of i){if(xc(l.annotationUID)||!Yl(l.annotationUID))continue;const{data:f}=l,u=f.handles?f.handles.activeHandleIndex:void 0,g=this._imagePointNearToolOrHandle(a,l,s,6),d=g&&!l.highlighted,p=!g&&l.highlighted;d||p?(l.highlighted=!l.highlighted,c=!0):f.handles&&f.handles.activeHandleIndex!==u&&(c=!0)}return c},this.isSuvScaled=is.isSuvScaled,e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,n,r,i){const a=Ke(e),{viewport:o}=a,{data:s}=n,{isCanvasAnnotation:c}=s,{points:l,textBox:f}=s.handles;if(f){const{worldBoundingBox:u}=f;if(u){const g={topLeft:o.worldToCanvas(u.topLeft),topRight:o.worldToCanvas(u.topRight),bottomLeft:o.worldToCanvas(u.bottomLeft),bottomRight:o.worldToCanvas(u.bottomRight)};if(r[0]>=g.topLeft[0]&&r[0]<=g.bottomRight[0]&&r[1]>=g.topLeft[1]&&r[1]<=g.bottomRight[1])return s.handles.activeHandleIndex=null,f}}for(let u=0;u<l?.length;u++){const g=l[u],d=c?g.slice(0,2):o.worldToCanvas(g);if(er(r,d)<i===!0)return s.handles.activeHandleIndex=u,g}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,n){return{visibility:this.getStyle("textBoxVisibility",e,n),fontFamily:this.getStyle("textBoxFontFamily",e,n),fontSize:this.getStyle("textBoxFontSize",e,n),color:this.getStyle("textBoxColor",e,n),shadow:this.getStyle("textBoxShadow",e,n),background:this.getStyle("textBoxBackground",e,n),lineWidth:this.getStyle("textBoxLinkLineWidth",e,n),lineDash:this.getStyle("textBoxLinkLineDash",e,n),textBoxBorderRadius:this.getStyle("textBoxBorderRadius",e,n),textBoxMargin:this.getStyle("textBoxMargin",e,n),textBoxLinkLineColor:this.getStyle("textBoxLinkLineColor",e,n)}}static isSuvScaled(e,n,r){if(e instanceof mi){const a=N0(n);return Ve.getVolume(a)?.scaling?.PT!==void 0}return typeof(r&&Pe("scalingModule",r))?.suvbw=="number"}getAnnotationStyle(e){const{annotation:n,styleSpecifier:r}=e,i=h=>this.getStyle(h,r,n),{annotationUID:a}=n,o=Yl(a),s=xc(a),c=i("lineWidth"),l=i("lineDash"),f=i("angleArcLineDash"),u=i("color"),g=i("markerSize"),d=i("shadow"),p=this.getLinkedTextBoxStyle(r,n);return{visibility:o,locked:s,color:u,lineWidth:c,lineDash:l,lineOpacity:1,fillColor:u,fillOpacity:0,shadow:d,textbox:p,markerSize:g,angleArcLineDash:f}}_imagePointNearToolOrHandle(e,n,r,i){if(this.getHandleNearImagePoint(e,n,r,i)||this.isPointNearTool(e,n,r,i,"mouse"))return!0}static createAnnotationState(e,n){const{data:r,annotationUID:i}=e,a={...r,cachedStats:{}};delete a.contour,delete a.spline;const o={annotationUID:i,data:structuredClone(a),deleting:n},s=r.contour;return s&&(o.data.contour={...s,polyline:null,pointsManager:oH.create3(s.polyline.length,s.polyline)}),o}static createAnnotationMemo(e,n,r){if(!n)return;const{newAnnotation:i,deleting:a=i?!1:void 0}=r||{},{annotationUID:o}=n,s=is.createAnnotationState(n,a),c={restoreMemo:()=>{const l=is.createAnnotationState(n,a),{viewport:f}=Ke(e)||{};if(f?.setViewReference(n.metadata),s.deleting===!0){if(s.deleting=!1,Object.assign(n.data,s.data),n.data.contour){const g=n.data;g.contour.polyline=s.data.contour.pointsManager.points,delete s.data.contour.pointsManager,g.segmentation&&Oc(n)}s.data=l.data,vo(n,e),Ca(n.annotationUID,!0),f?.render();return}if(s.deleting===!1){s.deleting=!0,s.data=l.data,Ca(n.annotationUID),yo(n.annotationUID),f?.render();return}const u=mr(o);if(!u){console.warn("No current annotation");return}Object.assign(u.data,s.data),u.data.contour&&(u.data.contour.polyline=s.data.contour.pointsManager.points),s.data=l.data,u.invalidated=!0,Qr(u,e,Li.History)},id:o,operationType:"annotation"};return Id.push(c),c}createMemo(e,n,r){this.memo||=is.createAnnotationMemo(e,n,r)}startGroupRecording(){Id.startGroupRecording()}endGroupRecording(){Id.endGroupRecording()}static hydrateBase(e,n,r,i={}){if(!n)return null;const{viewport:a}=n,o=a.getFrameOfReferenceUID(),s=a.getCamera(),c=i.viewplaneNormal??s.viewPlaneNormal,l=i.viewUp??s.viewUp,f=i.toolInstance||new e;let u,g=c,d=l;if(i.referencedImageId)u=i.referencedImageId,g=void 0,d=void 0;else if(a instanceof Jr){const p=I7(r[0],a);p!==void 0&&(u=a.getImageIds()[p])}else if(a instanceof mi)u=f.getReferencedImageId(a,r[0],c,l);else throw new Error("Unsupported viewport type");return{FrameOfReferenceUID:o,referencedImageId:u,viewPlaneNormal:g,viewUp:d,instance:f,viewport:a}}}is.toolName="AnnotationTool";class sH extends is{constructor(e,n){super(e,n)}static getContourSequence(e,n){const{data:r}=e,i=[];for(const s of r.contour.polyline)for(const c of s)i.push(c.toFixed(2));const{referencedImageId:a}=e.metadata,o=n.get("ImageSopInstanceReference",a);return{NumberOfContourPoints:i.length/3,ContourImageSequence:o,ContourGeometricType:"CLOSED_PLANAR",ContourData:i}}renderAnnotation(e,n){let r=!1;const{viewport:i}=e,{element:a}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),r;let o=x0(this.getToolName(),a);if(!o?.length||(o=this.filterInteractableAnnotationsForElement(a,o),!o?.length))return r;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let l=0;l<o.length;l++){const f=o[l];c.annotationUID=f.annotationUID;const u=this.getAnnotationStyle({annotation:f,styleSpecifier:c});if(!u.visibility)continue;const g=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:f,annotationStyle:u,svgDrawingHelper:n});r||=g,f.invalidated=!1}return r}createAnnotation(e){const n=super.createAnnotation(e);return Object.assign(n.data,{contour:{polyline:[],closed:!1}}),Object.assign(n,{interpolationUID:"",autoGenerated:!1}),n}addAnnotation(e,n){return vo(e,n)}cancelAnnotation(e){}moveAnnotation(e,n){const{points:r}=e.data.handles;for(let i=0,a=r.length;i<a;i++){const o=r[i];o[0]+=n[0],o[1]+=n[1],o[2]+=n[2]}e.invalidated=!0,c1(e).forEach(i=>this.moveAnnotation(i,n))}updateContourPolyline(e,n,r,i){const a=this.configuration?.decimate||{};Ia(e,n,r,{decimate:{enabled:!!a.enabled,epsilon:a.epsilon},updateWindingDirection:i?.updateWindingDirection})}getPolylinePoints(e){return e.data.contour?.polyline??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:n,annotationStyle:r,svgDrawingHelper:i}=e,a=e.annotation;if(a.parentAnnotationUID)return;const{annotationUID:o}=a,{viewport:s}=n,{worldToCanvas:c}=s,l=this.getPolylinePoints(a).map(v=>c(v)),{lineWidth:f,lineDash:u,color:g,fillColor:d,fillOpacity:p}=r,h=C1(a,s),m=[l,...h];return f0(i,o,"contourPolyline",m,{color:g,lineDash:u,lineWidth:Math.max(.1,f),fillColor:d,fillOpacity:p}),!0}}const R0={...VG,..._G,resetAnnotationManager:t$},Y3="PlanarFreehandContourSegmentationTool";function Np(t,e=[]){const{viewport:n,sliceData:r,annotation:i}=t,a=new Map,{toolName:o,originalToolName:s}=i.metadata,c=s||o,l=(x0(c,n.element)||[]).filter(f=>!f.metadata.originalToolName||f.metadata.originalToolName===c);if(c!==Y3){const f=x0(Y3,n.element);f?.length&&f.forEach(u=>{const{metadata:g}=u;g.originalToolName===c&&g.originalToolName!==g.toolName&&l.push(u)})}if(!l?.length)return a;for(let f=0;f<r.numberOfSlices;f++){const u=l.filter(d=>d.metadata.sliceIndex===f);if(!u?.length)continue;const g=u.filter(d=>e.every(p=>{const m=(p.parentKey?p.parentKey(d):d)?.[p.key];return Array.isArray(m)?m.every((v,y)=>v===p.value[y]):m===p.value}));g.length&&a.set(f,g)}return a}function cH(t,e){const n=Np(t,e),r=[];if(!n?.size)return r;for(const i of n.values())i.forEach(a=>{r.push(a)});return r}function gC(t,e,n){const r=Zr({data:{},metadata:{}},n);return Object.assign(r,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(r.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...n.data.contour,polyline:t}}),r}function lH(t,e){const n=Np(e,[{key:"interpolationUID",value:e.interpolationUID}]),r=uH(n);if(!r){console.warn("No annotations found to interpolate",n);return}const i=fH(n,t.annotationUID),a=[];for(let o=r[0]+1;o<r[1];o++)if(gH(n,o)){const s=hH(o,r,n);(s?.[0]===i||s?.[1]===i)&&dH(s,a,o)}return{interpolationData:n,interpolationList:a}}function uH(t){let e=1/0,n=-1/0,r=!1;for(const[i,a]of t.entries())a.length&&(e=Math.min(i,e),n=Math.max(i,n),r=!0);if(r)return[e,n]}function fH(t,e){for(const[n,r]of t)for(let i=0;i<r.length;i++)if(r[i].annotationUID===e)return n}function gH(t,e){const n=t.get(e);return!n?.length||n.length===1&&n[0].autoGenerated}function dH(t,e,n){const[r]=t;e[r]||={pair:t,list:[]},e[r].list.push(n)}function hH(t,e,n){const r=[];let i=!0;for(let a=t-1;a>=e[0];a--){const o=n.get(a);if(o?.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||!r.length)){for(let a=t+1;a<=e[1];a++){const o=n.get(a);if(o?.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||r.length<2))return r}}const{PointsManager:Z3}=Ma;function pH(t,e=12){const n=Z3.create3(e);n.sources=[];const{sources:r}=n,{length:i,sources:a=[]}=t,o=5;if(i<o*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,o*2));a.forEach(()=>r.push(Z3.create3(e)));const c=mH(t,o),l=vH(c,e),f=[];if(l?.length>2){let u=-1;const g=s/3;l.forEach(h=>{const[m,,v]=h,y=Math.ceil((m+v)/2);v-u<g||(y-m>2*g?(zc(f,u,m,s,i),u=zc(f,m,y,s,i)):u=zc(f,u,y,s,i),v-u>g&&(u=zc(f,u,v,s,i)))});const d=f[0];Nh(d+i-u,i)>2*g&&zc(f,u,d-g,s,i)}else{const u=Math.floor(i/e);zc(f,-1,i-u,u,i)}return f.forEach(u=>{const g=t.getPointArray(u);n.push(g),a.forEach((d,p)=>r[p].push(d.getPoint(u)))}),n}function mH(t,e=6){const{length:n}=t,r=Ie(),i=Ie(),a=new Float32Array(n);for(let o=0;o<n;o++){const s=t.getPoint(o),c=t.getPoint(o-e),l=t.getPoint((o+e)%n);Ut(r,s,c),Ut(i,l,s);const f=He(r,i)/(Qf(r)*Qf(i));a[o]=f}return a}function vH(t,e){const{max:n,deviation:r}=yH(t),{length:i}=t;if(r<.01||i<e*3)return[];const a=[];let o=null,s,c=0;for(let l=0;l<i;l++){const f=t[l];f<n-r?o?(o[2]=l,f<s&&(s=f,c=l),o[1]=c):(s=f,c=l,o=[l,l,l]):o&&(a.push(o),o=null)}return o&&(a[0][0]===0?a[0][0]=o[0]:(o[1]=c,o[2]=i-1,a.push(o))),a}function zc(t,e,n,r,i){n<e&&(n+=i);const a=n-e,o=Math.ceil(a/r);if(o<=0)return t[t.length-1]!==n&&t.push(Nh(n,i)),n;for(let s=1;s<=o;s++){const c=Nh(e+s*a/o,i);t.push(c)}return t[t.length-1]}function Nh(t,e){return(Math.round(t)+e)%e}function yH(t){const{length:e}=t;let n=0,r=1/0,i=-1/0,a=0;for(let s=0;s<e;s++){const c=t[s];n+=c,r=Math.min(r,c),i=Math.max(i,c)}const o=n/e;for(let s=0;s<e;s++){const c=t[s]-o;a+=c*c}return{mean:o,max:i,min:r,sumSq:a,deviation:Math.sqrt(a/e)}}function TH(t){const{parentAnnotationUID:e,annotationUID:n}=t;if(!e)return t.interpolationUID;const r=R0.getAnnotation(e),{interpolationUID:i}=r,a=r.childAnnotationUIDs.indexOf(n);return t.interpolationUID=`${i}-${a}`,t.interpolationUID}const{PointsManager:nl}=Ma,J3=.2;function _f(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:n}=t;queueMicrotask(()=>{try{e&&(n.isInterpolationUpdate=!0,n.autoGenerated=!1),CH(t)}finally{e&&(n.autoGenerated=!0)}})}function CH(t){const{annotation:e}=t;TH(e);const{interpolationData:n,interpolationList:r}=lH(e,t)||{};if(!n||!r)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let l=0;l<r.length;l++)r[l]&&wH(r[l].list,r[l].pair,n,i);const{id:a,renderingEngineId:o,element:s}=t.viewport,c={annotation:e,element:s,viewportId:a,renderingEngineId:o};r.length&&(Oe(t.viewport.element,fe.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c),Oe(Me,fe.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c))}function wH(t,e,n,r){const i=n.get(e[0])[0],a=n.get(e[1])[0],o=a4(i.data.contour.polyline),s=a4(a.data.contour.polyline),{c1Interp:c,c2Interp:l}=RH(o,s);c.kIndex=e[0],l.kIndex=e[1],t.forEach(function(f){SH(c,l,f,e,n,o.x.length>s.x.length,r)})}function SH(t,e,n,r,i,a,o){const[s,c]=r,l=(n-s)/(c-s),f=i.get(s)[0],u=i.get(c)[0],g=OH(t,e,l,a),d=l>.5?u:f,p=pH(g);i.has(n)?EH(g,p,n,d,o):xH(g,p,n,d,o)}function xH(t,e,n,r,i){const a=t.points,{viewport:o}=i,s=gC(a,e,r),c=o.getViewReference({sliceIndex:n});if(!c)throw new Error(`Can't find slice ${n}`);Object.assign(s.metadata,c),R0.addAnnotation(s,o.element),r.onInterpolationComplete?.(s,r);const{parentAnnotationUID:l}=r;if(l){const f=R0.getAnnotation(l),u=dC(f,n,i);XT(o,u,s)}}function dC(t,e,n){const{viewport:r}=n,i=R0.getAnnotations(t.metadata.toolName,r.element);for(let a=0;a<i.length;a++){const o=i[a];if(o.interpolationUID===t.interpolationUID&&o.metadata.sliceIndex===e)return o}}function EH(t,e,n,r,i){const a=dC(r,n,i),o=t.points,s=gC(o,e,a);Object.assign(a,{metadata:s.metadata,data:s.data})}function OH(t,e,n,r){const i=r?t.I:e.I,a=nl.fromXYZ(t),o=nl.fromXYZ(e),{length:s}=a,c=nl.create3(s),l=Ie(),f=Ie(),u=nl.create3(s);u.kIndex=t.kIndex;const g=nl.create3(s);g.kIndex=e.kIndex;for(let d=0;d<t.x.length;d++)if(i[d]){const p=a.getPoint(d),h=o.getPoint(d);u.push(p),g.push(h),Ut(l,h,p),c.push(Qn(f,p,l,n))}return c.sources=[u,g],c}function RH(t,e){const n=i4(t),r=i4(e),i=Math.max(Math.ceil(n[n.length-1]/J3),Math.ceil(r[r.length-1]/J3)),a=r4(n),o=r4(r),s=i+e.x.length,c=i+t.x.length,l=n4(s,a),f=n4(c,o),u=t4(s-2,t.x.length),g=t4(c-2,e.x.length),d=e4(l,u),p=e4(f,g),h=Q3(t,d),m=Q3(e,p);return MH(h,m),DH(h,m)}function DH(t,e){const n={x:[],y:[],z:[],I:[]},r={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(n.x.push(t.x[i]),n.y.push(t.y[i]),n.z.push(t.z[i]),n.I.push(t.I[i]),r.x.push(e.x[i]),r.y.push(e.y[i]),r.z.push(e.z[i]),r.I.push(e.I[i]));return{c1Interp:n,c2Interp:r}}function MH(t,e){const n=t.x.length,r={startingNode:0,totalSquaredXYLengths:1/0};for(let a=0;a<n;a++){let o=a,s=0;for(let c=0;c<n;c++)s+=(t.x[o]-e.x[c])**2+(t.y[o]-e.y[c])**2+(t.z[o]-e.z[c])**2,o++,o===n&&(o=0);s<r.totalSquaredXYLengths&&(r.totalSquaredXYLengths=s,r.startingNode=a)}const i=r.startingNode;Ju(t.x,i),Ju(t.y,i),Ju(t.z,i),Ju(t.I,i)}function Ju(t,e){e-=t.length*Math.floor(e/t.length);const n=t.splice(0,e);return t.push(...n),t}function Q3(t,e){const n={x:[],y:[],z:[],I:[]};for(let r=0;r<t.x.length-1;r++){n.x.push(t.x[r]),n.y.push(t.y[r]),n.z.push(t.z[r]),n.I.push(!0);const i=(t.x[r+1]-t.x[r])/(e[r]+1),a=(t.y[r+1]-t.y[r])/(e[r]+1),o=(t.z[r+1]-t.z[r])/(e[r]+1);for(let s=0;s<e[r]-1;s++)n.x.push(n.x[n.x.length-1]+i),n.y.push(n.y[n.y.length-1]+a),n.z.push(n.z[n.z.length-1]+o),n.I.push(!1)}return n}function e4(t,e){const n=[];for(let o=0;o<t.length;++o)n[o]=o;n.sort(function(o,s){return t[o]<t[s]?-1:1});const r=[];for(let o=0;o<e.length;o++)r.push(e[n[o]]);const i=r.reduce(function(o,s,c){return s&&o.push(c),o},[]),a=[];for(let o=0;o<i.length-1;o++)a.push(i[o+1]-i[o]);return a}function t4(t,e){const n=new Array(t+e);return n.fill(!1,0,t),n.fill(!0,t,t+e),n}function n4(t,e){const n=1/(t-1),r=[n];for(let i=1;i<t-2;i++)r.push(r[r.length-1]+n);return r.concat(e)}function r4(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n]/t[t.length-1]);return e}function i4(t){const e=[0];for(let n=1;n<t.x.length;n++){const r=Math.sqrt((t.x[n]-t.x[n-1])**2+(t.y[n]-t.y[n-1])**2+(t.z[n]-t.z[n-1])**2);e.push(e[n-1]+r)}return e}function a4(t){const e={x:[],y:[],z:[]};for(let n=0;n<t.length;n++)e.x[n]=t[n][0],e.y[n]=t[n][1],e.z[n]=t[n][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function o4(t){const{annotation:e}=t,n=Np(t,[{key:"interpolationUID",value:t.interpolationUID}]),r=e.metadata.sliceIndex;let i=-1,a=t.sliceData.numberOfSlices;for(const[s,c]of n.entries())s===r||!c.find(f=>!f.autoGenerated)||(s<r?i=Math.max(s,i):a=Math.min(s,a));const o=[];for(const[s,c]of n.entries())s<=i||s>=a||s===r||c.forEach(l=>{l.autoGenerated&&(R0.removeAnnotation(l.annotationUID),o.push(l))});if(o.length){const s={annotations:o,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};Oe(t.viewport.element,fe.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&a<t.sliceData.numberOfSlices){const s=n.get(a)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};_f(c)}}function bd(t){const e=JT(t);return e?.length?e.find(r=>r.getImageIds().some(i=>i===t.metadata.referencedImageId))??e[0]:void 0}const{uuidv4:_H}=Ma,IH=[Li.HandlesUpdated,Li.InterpolationUpdated],Di=class Di{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static removeTool(e){this.toolNames.includes(e)&&(this.toolNames=this.toolNames.filter(n=>n!==e))}static acceptAutoGenerated(e,n={}){const{toolNames:r,segmentationId:i,segmentIndex:a,sliceIndex:o}=n;for(const s of r||Di.toolNames){const c=R0.getAnnotations(s,e);if(c?.length)for(const l of c){const{interpolationUID:f,data:u,autoGenerated:g,metadata:d}=l;f&&(l.interpolationCompleted=!0),g&&(a&&a!==u.segmentation.segmentIndex||o!==void 0&&d&&o!==d.sliceIndex||i&&i!==u.segmentation.segmentationId||(Oc(l),l.autoGenerated=!1))}}}};Di.toolNames=[],Di.handleAnnotationCompleted=e=>{const n=e.detail.annotation;if(!n?.metadata)return;const{toolName:r,originalToolName:i}=n.metadata;if(!Di.toolNames.includes(r)&&!Di.toolNames.includes(i))return;const a=bd(n);if(!a){console.warn("Unable to find viewport for",n);return}const o=Ld(a),s={viewport:a,sliceData:o,annotation:n,interpolationUID:n.interpolationUID},c=!!n.interpolationUID;if(n.autoGenerated=!1,c){o4(s),_f(s);return}const l=[{key:"segmentIndex",value:n.data.segmentation.segmentIndex,parentKey:d=>d.data.segmentation},{key:"viewPlaneNormal",value:n.metadata.viewPlaneNormal,parentKey:d=>d.metadata},{key:"viewUp",value:n.metadata.viewUp,parentKey:d=>d.metadata}];let f=cH(s,l);const{sliceIndex:u}=n.metadata,g=new Set;f.forEach(d=>{if(d.interpolationCompleted||d.metadata.sliceIndex===u){const{interpolationUID:p}=d;g.add(p)}}),f=f.filter(d=>!g.has(d.interpolationUID)),n.interpolationUID=f[0]?.interpolationUID||_H(),s.interpolationUID=n.interpolationUID,_f(s)},Di.handleAnnotationUpdate=e=>{const n=e.detail.annotation,{changeType:r=Li.HandlesUpdated}=e.detail;if(!n?.metadata)return;const{toolName:i,originalToolName:a}=n.metadata;if(!Di.toolNames.includes(i)&&!Di.toolNames.includes(a)||!IH.includes(r))return;const o=bd(n);if(!o){console.warn("Unable to find matching viewport for annotation interpolation",n);return}n.autoGenerated&&(Oc(n),n.autoGenerated=!1);const s=Ld(o),c={viewport:o,sliceData:s,annotation:n,interpolationUID:n.interpolationUID,isInterpolationUpdate:r===Li.InterpolationUpdated};_f(c)},Di.handleAnnotationDelete=e=>{const n=e.detail.annotation;if(!n?.metadata)return;const{toolName:r}=n.metadata;if(!Di.toolNames.includes(r)||n.autoGenerated)return;const i=bd(n);if(!i){console.warn("No viewport, can't delete interpolated results",n);return}const a=Ld(i),o={viewport:i,sliceData:a,annotation:n,interpolationUID:n.interpolationUID};n.autoGenerated=!1,o4(o)};let Hi=Di;function Ld(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function bH(t){t.forEach(e=>{const n=$7(e);if(!n){console.warn(`ToolGroup not available for ${e}`);return}n.getViewportsInfo().forEach(i=>{const{renderingEngineId:a,viewportId:o}=i,s=_c(a);if(!s){console.warn(`RenderingEngine not available for ${a}`);return}const c=s.getViewport(o);vu(c.element)})})}const LH={[nt.Labelmap]:tC,[nt.Contour]:QT,[nt.Surface]:IT},If=new Map;function VH(t,e,n){const r=LH[n].getUpdateFunction(t);r&&PH(e,n,r)}function PH(t,e,n){If.has(t)||If.set(t,new Map);const r=If.get(t);r.has(e)&&NH(t,e);const i=AH(t,e,n);Me.addEventListener(fe.SEGMENTATION_DATA_MODIFIED,i),r.set(e,i)}function NH(t,e){const n=If.get(t);if(!n)return;const r=n.get(e);r&&(Me.removeEventListener(fe.SEGMENTATION_DATA_MODIFIED,r),n.delete(e))}function AH(t,e,n){const r=aC(i=>{const a=i.detail?.segmentationId,o=Wr(a);a===t&&o?.representationData?.[e]&&(n(t),vp(t))},300);return(i=>{r(i)})}function FH(t,e){return qi.updateLabelmapSegmentationImageReferences(t,e)}class hC{constructor(){}static getContourSequence(e,n){const{data:r}=e,{projectionPoints:i,projectionPointsImageIds:a}=r.cachedStats;return i.map((o,s)=>{const c=UH(o),l=kH(a[s],n);return{NumberOfContourPoints:c.length/3,ContourImageSequence:l,ContourGeometricType:"CLOSED_PLANAR",ContourData:c}})}}hC.toolName="RectangleROIStartEndThreshold";function UH(t){return[...t[0],...t[1],...t[3],...t[2]].flat().map(i=>i.toFixed(2))}function kH(t,e){const n=e.get("sopCommonModule",t);return{ReferencedSOPClassUID:n.sopClassUID,ReferencedSOPInstanceUID:n.sopInstanceUID}}function GH(t){if(!t?.data)throw new Error("Tool data is empty");if(!t.metadata||!t.metadata.referencedImageId)throw new Error("Tool data is not associated with any imageId")}const Pl=class Pl{constructor(){}static convert(e,n,r){GH(e);const{toolName:i}=e.metadata,a=Pl.TOOL_NAMES[i];if(!a)throw new Error(`Unknown tool type: ${i}, cannot convert to RTSSReport`);const o=a.getContourSequence(e,r),s=n.color?.slice(0,3)||[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255)];return{ReferencedROINumber:n.segmentIndex,ROIDisplayColor:s,ContourSequence:Array.isArray(o)?o:[o]}}static register(e){Pl.TOOL_NAMES[e.toolName]=e}};Pl.TOOL_NAMES={};let Dg=Pl;Dg.register(hC);function BH(t){const e=Wr(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=e;return Object.keys(n).filter(i=>n[i].locked).map(i=>parseInt(i))}function $H(t,e,n){const r=hc(t,{segmentationId:e});if(!r||r.length===0)return null;const i=r[0],{colorLUTIndex:a}=i,o=yp(a);let s=o[n];if(!s){if(typeof n!="number")return console.warn(`Can't create colour for LUT index ${n}`),null;s=o[n]=[0,0,0,0]}return s}function WH(t,e){return qi.getSegmentationRepresentationVisibility(t,e)}function zH({segmentationId:t,segmentIndex:e,viewportId:n,autoGenerated:r=!1}){const i=$H(n,t,e),a=WH(n,{segmentationId:t,type:nt.Contour}),s=bp(n)?.segmentationId===t,c=dc.getRenderInactiveSegmentations(n),f=dc.getStyle({viewportId:n,segmentationId:t,type:nt.Contour,segmentIndex:e});let u=1,g,d=1,p=0,h=f.renderFill??!0,m=f.renderOutline??!0;r?(u=f.outlineWidthAutoGenerated??u,g=f.outlineDashAutoGenerated??g,d=f.outlineOpacity??d,p=f.fillAlphaAutoGenerated??p):s?(u=f.outlineWidth??u,g=f.outlineDash??g,d=f.outlineOpacity??d,p=f.fillAlpha??p):(u=f.outlineWidthInactive??u,g=f.outlineDashInactive??g,d=f.outlineOpacityInactive??d,p=f.fillAlphaInactive??p,h=f.renderFillInactive??h,m=f.renderOutlineInactive??m),Lp(t)===e&&(u+=f.activeSegmentOutlineWidthDelta),u=m?u:0,p=h?p:0;const v=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${d})`,y=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,C=!Cp(n,{segmentationId:t,type:nt.Contour}).has(e);return{color:v,fillColor:y,lineWidth:u,fillOpacity:p,lineDash:g,textbox:{color:v},visibility:s?a&&C:c}}const Yp=class Yp extends sH{constructor(e,n){super(e,n),this.configuration.interpolation?.enabled&&Hi.addTool(this.getToolName())}onSetToolConfiguration(){this.configuration.interpolation?.enabled?Hi.addTool(this.getToolName()):Hi.removeTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const n=e.detail,{element:r}=n,i=Ke(r);if(!i)return;const{viewport:a}=i,o=super.createAnnotation(e);if(!this.isContourSegmentationTool())return o;const s=bp(a.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,l=Lp(c);return Zr(o,{data:{segmentation:{segmentationId:c,segmentIndex:l}}})}addAnnotation(e,n){const r=super.addAnnotation(e,n);return this.isContourSegmentationTool()&&Oc(e),r}cancelAnnotation(e){this.isContourSegmentationTool()&&Ec(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const n=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return n;const r=this._getContourSegmentationStyle(e);return Zr(n,r)}renderAnnotationInstance(e){const{annotation:n}=e,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r&&this.isContourSegmentationTool()){const{segmentationId:a}=n.data.segmentation;d1(a);const s=AT(a).map(c=>Mr(c).id);bH(s)}return i}filterInteractableAnnotationsForElement(e,n){if(!n||!n.length)return;const r=super.filterInteractableAnnotationsForElement(e,n);if(!r||!r.length)return;const i=Ke(e),{viewport:a}=i;return r.filter(o=>{const s=o?.data?.segmentation?.segmentationId;return s?!!qi.getSegmentationRepresentation(a.id,{segmentationId:s,type:nt.Contour}):!0})}_getContourSegmentationStyle(e){const n=e.annotation,{segmentationId:r,segmentIndex:i}=n.data.segmentation,{viewportId:a}=e.styleSpecifier,o=hc(a,{segmentationId:r});if(!o?.length)return{};o.length>1?o.find(m=>m.segmentationId===r&&m.type===nt.Contour):o[0];const{autoGenerated:s}=n,l=BH(r).includes(i),{color:f,fillColor:u,lineWidth:g,fillOpacity:d,lineDash:p,visibility:h}=zH({segmentationId:r,segmentIndex:i,viewportId:a,autoGenerated:s});return{color:f,fillColor:u,lineWidth:g,fillOpacity:d,lineDash:p,textbox:{color:f},visibility:h,locked:l}}};Yp.PreviewSegmentIndex=255;let Ah=Yp;function HH(t,e,n){return t==="CT"?"HU":t==="PT"?jH(e,n):""}function jH(t,e){return e.isPreScaled?e.isSuvScaled?"SUV":Pe("generalSeriesModule",t)?.modality==="PT"?Pe("petSeriesModule",t)?.units||"unitless":"unknown":"raw"}const{pointCanProjectOnLine:s4}=bc,{EPSILON:KH}=Gh,qH=1-KH,Nl=class Nl extends Ah{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:ai.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:XH,statsCalculator:Vh}}){super(e,n),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=r=>{const i=r.detail,{element:a}=i,o=this.createAnnotation(r);this.addAnnotation(o,a);const s=us(a,this.getToolName());return this.activateDraw(r,o,s),r.preventDefault(),Cn(s),o},this.handleSelectedCallback=(r,i,a)=>{const o=r.detail,{element:s}=o,c=us(s,this.getToolName());this.activateOpenContourEndEdit(r,i,c,a)},this.toolSelectedCallback=(r,i)=>{const a=r.detail,{element:o}=a,s=us(o,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(r,i,s):this.activateOpenContourEdit(r,i,s),r.preventDefault()},this.isPointNearTool=(r,i,a,o)=>{const s=Ke(r),{viewport:c}=s,{polyline:l}=i.data.contour;let f=c.worldToCanvas(l[0]);for(let d=1;d<l.length;d++){const p=f,h=c.worldToCanvas(l[d]);if(s4(a,p,h,o))return!0;f=h}if(!i.data.contour.closed)return!1;const u=c.worldToCanvas(l[0]),g=c.worldToCanvas(l[l.length-1]);return s4(a,u,g,o)},this.cancel=r=>{const i=this.isDrawing,a=this.isEditingOpen,o=this.isEditingClosed;i?this.cancelDrawing(r):a?this.cancelOpenContourEdit(r):o&&this.cancelClosedContourEdit(r)},this._calculateCachedStats=(r,i,a,o)=>{const{data:s}=r,{cachedStats:c}=s,{polyline:l,closed:f}=s.contour,u=Object.keys(c);for(let d=0;d<u.length;d++){const p=u[d],h=this.getTargetImageData(p);if(!h)continue;const{imageData:m,metadata:v}=h,y=l.map($e=>i.worldToCanvas($e)),T={isPreScaled:iH(i,p),isSuvScaled:this.isSuvScaled(i,p,r.metadata.referencedImageId)},C=HH(v.Modality,r.metadata.referencedImageId,T),w=s.contour.polyline,S=w.length,_=new Array(S);for(let $e=0;$e<S;$e++)_[$e]=i.worldToCanvas(w[$e]);const{maxX:D,maxY:N,minX:P,minY:F}=xg(_),B=i.canvasToWorld([P,F]),k=y0(m,B),U=i.canvasToWorld([D,N]),H=y0(m,U),J=nC(h,[k,H]),ne=y[0],q=i.canvasToWorld(ne),Q=i.canvasToWorld([ne[0]+1,ne[1]]),ae=i.canvasToWorld([ne[0],ne[1]+1]),me=v0(q,Q),de=v0(q,ae),je={targetId:p,viewport:i,canvasCoordinates:y,points:l,imageData:m,metadata:v,cachedStats:c,modalityUnit:C,calibratedScale:J,deltaInX:me,deltaInY:de};f?this.updateClosedCachedStats(je):this.updateOpenCachedStats(je)}const g=r.invalidated;return r.invalidated=!1,g&&Qr(r,o.viewport.element,Li.StatsUpdated),c},this._renderStats=(r,i,a,o)=>{const{data:s}=r,c=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:a.viewport.id,annotationUID:r.annotationUID},f=this.getLinkedTextBoxStyle(l,r);if(!f.visibility)return;const u=this.configuration.getTextLines(s,c);if(!u||u.length===0)return;const g=s.contour.polyline.map(C=>i.worldToCanvas(C));if(!s.handles.textBox.hasMoved){const C=fC(g);s.handles.textBox.worldPosition=i.canvasToWorld(C)}const d=i.worldToCanvas(s.handles.textBox.worldPosition),h=qT(o,r.annotationUID??"","1",u,d,g,{},f),{x:m,y:v,width:y,height:T}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([m,v]),topRight:i.canvasToWorld([m+y,v]),bottomLeft:i.canvasToWorld([m,v+T]),bottomRight:i.canvasToWorld([m+y,v+T])}},lz(this),vz(this),Dz(this),Gz(this),Wz(this),nH(this),this._throttledCalculateCachedStats=oC(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,n){if(!n?.length)return[];const r=super.filterInteractableAnnotationsForElement(e,n);if(!r?.length)return[];const i=Ke(e),{viewport:a}=i;let o;if(a instanceof Br){const s=a.getCamera(),{spacingInNormalDirection:c}=fu(a,s);o=this.filterAnnotationsWithinSlice(r,s,c)}else o=rC(a,n);return o}filterAnnotationsWithinSlice(e,n,r){const{viewPlaneNormal:i}=n,a=e.filter(l=>{let f=l.metadata.viewPlaneNormal;if(!l.metadata.referencedImageId&&!f&&l.metadata.FrameOfReferenceUID){for(const g of l.data.contour.polyline){const d=Ut(Ie(),g,n.focalPoint),p=He(d,n.viewPlaneNormal);if(!Wt(p,0))return!1}return l.metadata.viewPlaneNormal=n.viewPlaneNormal,l.metadata.cameraFocalPoint=n.focalPoint,!0}if(!f){const{referencedImageId:g}=l.metadata,{imageOrientationPatient:d}=Pe("imagePlaneModule",g),p=Et(d[0],d[1],d[2]),h=Et(d[3],d[4],d[5]);f=Ie(),zt(f,p,h),l.metadata.viewPlaneNormal=f}const u=Math.abs(He(i,f))>qH;return f&&u});if(!a.length)return[];const o=r/2,{focalPoint:s}=n,c=[];for(const l of a){const u=l.data.contour.polyline[0];if(!l.isVisible)continue;const g=Ie();Ut(g,s,u);const d=He(g,i);Math.abs(d)<o&&c.push(l)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const n=e.detail.currentPoints.world,r=super.createAnnotation(e),i=o=>{o.data.handles.points.length=0};return Zr(r,{data:{contour:{polyline:[[...n]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:n,targetId:r,svgDrawingHelper:i}=e,a=e.annotation;let o=!1;const{viewport:s,renderingEngine:c}=n,l=this.isDrawing,f=this.isEditingOpen,u=this.isEditingClosed;if(!(l||f||u))this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);else{const g=this.commonData.annotation.annotationUID;if(a.annotationUID===g)if(l)this.renderContourBeingDrawn(n,i,a);else if(u)this.renderClosedContourBeingEdited(n,i,a);else if(f)this.renderOpenContourBeingEdited(n,i,a);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);o=!0}if(this.configuration.calculateStats)return a.invalidated&&this._calculateStatsIfActive(a,r,s,c,n),this._renderStats(a,s,n,i),o}_calculateStatsIfActive(e,n,r,i,a){const o=this.commonData?.annotation.annotationUID;if(!(e.annotationUID===o&&!this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:s}=e;s.cachedStats[n]?.unit?e.invalidated&&this._throttledCalculateCachedStats(e,r,i,a):(s.cachedStats[n]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,unit:null},this._calculateCachedStats(e,r,i,a))}}updateClosedCachedStats({viewport:e,points:n,imageData:r,metadata:i,cachedStats:a,targetId:o,modalityUnit:s,canvasCoordinates:c,calibratedScale:l,deltaInX:f,deltaInY:u}){const{scale:g,areaUnit:d,unit:p}=l,{voxelManager:h}=e.getImageData(),m=n.map(me=>r.worldToIndex(me));let v=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,T=Number.MAX_SAFE_INTEGER,C=Number.MIN_SAFE_INTEGER,w=Number.MAX_SAFE_INTEGER,S=Number.MIN_SAFE_INTEGER;for(let me=0;me<n.length;me++){const de=m[me].map(Math.floor);v=Math.min(v,de[0]),y=Math.max(y,de[0]),T=Math.min(T,de[1]),C=Math.max(C,de[1]),w=Math.min(w,de[2]),S=Math.max(S,de[2])}let _=Sp(c)/g/g;_*=f*u;const D=Nl.calculateLengthInIndex(l,m,closed),N=.01*(y-v),P=.01*(C-T),F=.01*(S-w);v=Math.floor(v-N),y=Math.ceil(y+N),T=Math.floor(T-P),C=Math.ceil(C+P),w=Math.floor(w-F),S=Math.ceil(S+F);const B=[[v,y],[T,C],[w,S]],k=r.indexToWorld([y,C,S]),U=e.worldToCanvas(k);let H=0,W=[],J=0,ne;h&&(ne=h.forEach(this.configuration.statsCalculator.statsCallback,{imageData:r,isInObject:(me,de)=>{let je=!0;const $e=e.worldToCanvas(me);return $e[1]!=H&&(J=0,H=$e[1],W=HT(c,$e,[U[0],$e[1]]),W.sort((function(Be){return function(qe,Qe){return qe[Be]===Qe[Be]?0:qe[Be]<Qe[Be]?-1:1}})(0))),W.length&&$e[0]>W[0][0]&&(W.shift(),J++),J%2===0&&(je=!1),je},boundsIJK:B,returnPoints:this.configuration.storePointData}));const q=this.configuration.statsCalculator.getStatistics(),Q={name:"area",value:_,unit:d,type:l0.Area},ae={name:"perimeter",value:D,unit:p,type:l0.Linear};a[o]={Modality:i.Modality,area:_,perimeter:D,mean:q.mean?.value,max:q.max?.value,min:q.min?.value,stdDev:q.stdDev?.value,statsArray:[Q,ae,...q.array],pointsInShape:ne,areaUnit:d,modalityUnit:s,unit:p}}updateOpenCachedStats({targetId:e,metadata:n,cachedStats:r,modalityUnit:i,calibratedScale:a,imageData:o,points:s}){const{unit:c}=a,l=s.map(g=>o.worldToIndex(g)),f=Nl.calculateLengthInIndex(a,l),u={name:"length",value:f,unit:c,type:l0.Linear};r[e]={Modality:n.Modality,length:f,modalityUnit:i,unit:c,statArray:[u]}}};Nl.toolName="PlanarFreehandROI";let Fh=Nl;function XH(t,e){const n=t.cachedStats[e],{area:r,mean:i,stdDev:a,length:o,perimeter:s,max:c,min:l,isEmptyArea:f,unit:u,areaUnit:g,modalityUnit:d}=n||{},p=[];if(Za(r)){const h=f?"Area: Oblique not supported":`Area: ${ga(r)} ${g}`;p.push(h)}return Za(i)&&p.push(`Mean: ${ga(i)} ${d}`),Za(c)&&p.push(`Max: ${ga(c)} ${d}`),Za(l)&&p.push(`Min: ${ga(l)} ${d}`),Za(a)&&p.push(`Std Dev: ${ga(a)} ${d}`),Za(s)&&p.push(`Perimeter: ${ga(s)} ${u}`),Za(o)&&p.push(`${ga(o)} ${u}`),p}const Vg=class Vg extends Fh{constructor(e){const n=Zr({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(n)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const n=e.annotation,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r){const{segmentationId:a}=n.data.segmentation;d1(a)}return i}};Vg.toolName="PlanarFreehandContourSegmentationTool",Dg.register(Vg);let Mg=Vg;const YH={[nt.Labelmap]:tC,[nt.Contour]:QT,[nt.Surface]:IT},Qu=Mg.toolName;class ZH{constructor(){this._needsRender=new Set,this._pendingRenderQueue=[],this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>Da().flatMap(n=>n.getViewports()),this._renderFlaggedSegmentations=()=>{if(this._throwIfDestroyed(),Array.from(this._needsRender).forEach(n=>{this._triggerRender(n)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._pendingRenderQueue.length>0){const n=this._pendingRenderQueue.shift();n&&n.length>0&&this._setViewportsToBeRenderedNextFrame(n)}}}renderSegmentationsForViewport(e){const n=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(n)}renderSegmentation(e){const n=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(n)}_getViewportIdsForSegmentation(e){const n=this._getAllViewports(),r=[];for(const i of n){const a=i.id;e?hc(a,{segmentationId:e})?.length>0&&r.push(a):hc(a)?.length>0&&r.push(a)}return r}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){if(this._animationFrameSet){this._pendingRenderQueue.push(e);return}e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const n=hc(e);if(!n?.length)return;const{viewport:r}=Un(e)||{};if(!r)return;const i=n.map(a=>{a.type===nt.Contour&&this._addPlanarFreeHandToolIfAbsent(r);const o=YH[a.type],c=Wr(a.segmentationId).representationData[a.type]!==void 0;try{o.render(r,a).then(()=>{c||VH(r,a.segmentationId,a.type)})}catch(l){console.error(l)}return Promise.resolve({segmentationId:a.segmentationId,type:a.type})});Promise.allSettled(i).then(a=>{const o=a.filter(l=>l.status==="fulfilled").map(l=>l.value);function s(l){const{element:f,viewportId:u}=l.detail;f.removeEventListener(Ee.IMAGE_RENDERED,s),o.forEach(g=>{const d={viewportId:u,segmentationId:g.segmentationId,type:g.type};Oe(Me,fe.SEGMENTATION_RENDERED,{...d})})}r.element.addEventListener(Ee.IMAGE_RENDERED,s),r.render()})}_addPlanarFreeHandToolIfAbsent(e){Qu in Ye.tools||Kc(Mg);const n=Mr(e.id);n.hasTool(Qu)||(n.addTool(Qu),n.setToolPassive(Qu))}}function pC(t){vC.renderSegmentationsForViewport(t)}function mC(t){vC.renderSegmentation(t)}const vC=new ZH;function JH({modifiedSlicesToUse:t,representationData:e,type:n}){const r=Ve.getVolume(e[n].volumeId);if(!r){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:a}=r;let o;if(t?.length>0)o=t;else{const s=i.getDimensions()[2];o=[...Array(s).keys()]}o.forEach(s=>{a.setUpdatedFrame(s)}),i.modified()}function QH({viewportIds:t,segmentationId:e}){t.forEach(n=>{let r=hc(n,{segmentationId:e});r=r.filter(i=>i.type===nt.Labelmap),r.forEach(i=>{if(i.segmentationId!==e)return;const a=Un(n);if(!a)return;const{viewport:o}=a;if(o instanceof Br)return;const s=Ol(n,e);s?.length&&s.forEach((c,l)=>{const f=c.actor.getMapper().getInputData(),u=Zl(n,e),g=Ve.getImage(u[l]);f.modified(),r1(f,g)})})})}const ej=function(t){const{segmentationId:e,modifiedSlicesToUse:n}=t.detail,{representationData:r}=Wr(e),i=AT(e),a=i.some(c=>{const{viewport:l}=Un(c);return l instanceof Br}),o=i.some(c=>{const{viewport:l}=Un(c);return l instanceof Jr}),s=a&&o;i.forEach(c=>{const{viewport:l}=Un(c);l instanceof Br&&JH({modifiedSlicesToUse:s?[]:n,representationData:r,type:nt.Labelmap}),l instanceof Jr&&QH({viewportIds:i,segmentationId:e})})},yC=function(t){const{segmentationId:e}=t.detail,{representationData:n}=Wr(e);n.Labelmap&&ej(t),mC(e)},TC=function(t){const{segmentationId:e}=t.detail;mC(e)},tj=function(t){if(!t)return;const e=Ke(t);if(!e)return;const{viewport:n}=e;n instanceof mi||(t.addEventListener(Ee.PRE_STACK_NEW_IMAGE,Jl),t.addEventListener(Ee.IMAGE_RENDERED,Jl))},nj=function(t){t.removeEventListener(Ee.PRE_STACK_NEW_IMAGE,Jl),t.removeEventListener(Ee.IMAGE_RENDERED,Jl)};function Jl(t){const e=t.detail,{viewportId:n,renderingEngineId:r}=e,{viewport:i}=U0(n,r),a=hc(n);if(!a?.length)return;const o=a.filter(l=>l.type===nt.Labelmap),s=i.getActors();o.forEach(l=>{const{segmentationId:f}=l;FH(n,f)});const c=o.flatMap(l=>Ol(n,l.segmentationId)).filter(l=>l!==void 0);c.length&&(c.forEach(l=>{o.find(u=>Zl(n,u.segmentationId)?.includes(l.referencedId))||i.removeActors([l.uid])}),o.forEach(l=>{const{segmentationId:f}=l,u=i.getCurrentImageId(),g=Zl(n,f);if(!g)return;let d=!1;const p=h=>{const m=Ve.getImage(h);if(!m){console.warn("No derived image found in the cache for segmentation representation",l);return}const v=s.find(y=>y.referencedId===h);if(v){const y=v.actor.getMapper().getInputData();y.setDerivedImage?y.setDerivedImage(m):r1(y,m)}else{const{dimensions:y,spacing:T,direction:C}=i.getImageDataMetadata(m),w=Ve.getImage(u)||{imageId:u},{origin:S}=i.getImageDataMetadata(w),_=S,D=m.voxelManager.getConstructor(),N=m.voxelManager.getScalarData(),P=ot.newInstance({name:"Pixels",numberOfComponents:1,values:new D(N)}),F=qg.newInstance();F.setDimensions(y[0],y[1],1),F.setSpacing(T),F.setDirection(C),F.setOrigin(_),F.getPointData().setScalars(P),F.modified(),i.addImages([{imageId:h,representationUID:`${f}-${nt.Labelmap}-${m.imageId}`,callback:({imageActor:B})=>{B.getMapper().setInputData(F)}}]),d=!0;return}};g.forEach(p),d&&pC(n),i.render(),t.type===Ee.IMAGE_RENDERED&&i.element.removeEventListener(Ee.IMAGE_RENDERED,Jl)}))}const CC={enable:tj,disable:nj};async function rj(t){const e=t.detail.annotation;if(!m1(e))return;const n=aj(e),r=oj(n,e);if(!r.length){Oe(Me,fe.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:n.element,sourceAnnotation:e});return}const i=_p(e.data.contour.polyline,n),a=tW(n,i,r);if(!a.length){Oe(Me,fe.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:n.element,sourceAnnotation:e});return}if(a.length>1){rW(n,e,i,a);return}const{targetAnnotation:o,targetPolyline:s,isContourHole:c}=a[0];if(c){const{contourHoleProcessingEnabled:l=!1}=t.detail;if(!l)return;XT(n,o,e)}else Q$(n,o,s,e,i)}function ij(t,e=!1){const n="PlanarFreehandContourSegmentationTool",r=Mr(t.id,t.renderingEngineId);let i;return r?r.hasTool(n)?r.getToolOptions(n)||(i=`Tool ${n} must be in active/passive state in ${r.id} toolGroup`):i=`Tool ${n} not added to ${r.id} toolGroup`:i=`ToolGroup not found for viewport ${t.id}`,i&&!e&&console.warn(i),!i}function aj(t){const e=JT(t);return e.find(r=>ij(r,!0))??e[0]}function oj(t,e){const{annotationUID:n}=e;return dp().filter(i=>i.annotationUID&&i.annotationUID!==n&&m1(i)&&FB(i,e)&&t.isReferenceViewable(i.metadata))}function sj(t){const e=t.detail.annotation;Ec(e)}function wC(t){const e=t.detail.annotation;m1(e)&&rj(t)}function _g(t){if(!t.detail.removed.length)return;Da().forEach(r=>{const a=r.getViewports().map(o=>o.id);Cn(a)})}function SC(t){const{viewportId:e}=t.detail;Cn([e])}function xC(t){const e=t.detail.annotation;m1(e)&&sj(t)}const EC=function(t){vu(t.detail.element)},cj=function(t){t.addEventListener(Ee.IMAGE_RENDERED,EC)},lj=function(t){t.removeEventListener(Ee.IMAGE_RENDERED,EC)},OC={enable:cj,disable:lj},{Active:uj}=rn;function G0(t,e,n){if(Ye.isInteractingWithTool)return!1;const{renderingEngineId:r,viewportId:i}=n.detail,a=Mr(i,r);if(!a)return!1;let o;const s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=a.getToolInstance(l);if(f.mode===uj&&typeof u[e]=="function"){o=a.getToolInstance(l);break}}o&&o[e](n)}const RC=G0.bind(null,"Mouse","mouseClickCallback"),DC=G0.bind(null,"Mouse","doubleClickCallback");function MC(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const l=o.getHandleNearImagePoint(t,c,n,i);if(l){a.push({tool:o,annotation:c,handle:l});break}}}),a}function S1(t,e){const n=[];for(let r=0;r<e.length;r++){const i=e[r];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let a=x0(i.constructor.toolName,t);a?.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(a=i.filterInteractableAnnotationsForElement(t,a)),a?.length>0&&n.push({tool:i,annotations:a}))}return n}function Ap(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(o.isPointNearTool(t,c,n,i,r)){a.push({tool:o,annotation:c});break}}}),a}const{Active:fj}=rn;function x1(t){const{renderingEngineId:e,viewportId:n,event:r}=t.detail,i=T1(r)||k0.getModifierKey(),a=Mr(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.buttons??r?.buttons??s;for(let l=0;l<o.length;l++){const f=o[l],u=a.toolOptions[f],g=u.bindings.length&&u.bindings.some(d=>d.mouseButton===c&&d.modifierKey===i);if(u.mode===fj&&g)return a.getToolInstance(f)}}function D0(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=Mr(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=n!=null&&f.bindings.length&&f.bindings.some(g=>g.mouseButton===n);if(e.includes(f.mode)&&(!n||u)){const g=a.getToolInstance(l);o.push(g)}}return o}function gj(t,e){const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=Mr(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.event,l=c?.buttons??s,f=T1(c)||k0.getModifierKey();for(let u=0;u<o.length;u++){const g=o[u],d=a.getToolInstance(g),p=d.configuration?.actions??{},h=Object.values(p);if(!h?.length||!e.includes(d.mode))continue;const m=h.find(v=>v.bindings?.length&&v.bindings.some(y=>y.mouseButton===l&&y.modifierKey===f));m&&n.set(d,m)}return n}const{Active:dj,Passive:hj}=rn;function pj(t){if(Ye.isInteractingWithTool)return!1;const e=t.detail,{element:n}=e,r=Ke(n),{canvas:i}=e.currentPoints;if(!r)return!1;const a=gj(t,[dj,hj]),o=Array.from(a.keys()),s=S1(n,o),c=Ap(n,s,i);if(c.length>0){const{tool:l,annotation:f}=c[0],u=a.get(l);return(typeof u.method=="string"?l[u.method]:u.method).call(l,t,f),!0}return!1}const{Active:mj,Passive:vj}=rn;function _C(t){if(Ye.isInteractingWithTool)return;const e=x1(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const n=t.detail.event.buttons===1,r=D0(t,[mj],t.detail.event.buttons),i=n?D0(t,[vj]):void 0,a=[...r||[],...i||[]];if(pj(t))return;const s=t.detail,{element:c}=s,l=S1(c,a),f=s.currentPoints.canvas,u=MC(c,l,f,"mouse"),g=!!t.detail.event.shiftKey;if(u.length>0){const{tool:p,annotation:h,handle:m}=c4(u);l4(h.annotationUID,g),p.handleSelectedCallback(t,h,m,"Mouse");return}const d=Ap(c,l,f,"mouse");if(d.length>0){const{tool:p,annotation:h}=c4(d);l4(h.annotationUID,g),p.toolSelectedCallback(t,h,"Mouse",f);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function c4(t){if(t.length>1){const e=t.find(n=>{const r=!xc(n.annotation.annotationUID),i=Yl(n.annotation.annotationUID);return r&&i});if(e)return e}return t[0]}function l4(t,e=!1){e?h1(t)?Ca(t,!1):Ca(t,!0,!0):Ca(t,!0,!1)}function IC(t){if(Ye.isInteractingWithTool)return;const e=x1(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"mouse");Ca(n.annotationUID)}}function bC(t){if(Ye.isInteractingWithTool)return;const e=x1(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:yj,Passive:Tj}=rn;function LC(t){if(Ye.isInteractingWithTool||Ye.isMultiPartToolActive)return;const e=D0(t,[yj,Tj]),n=t.detail,{element:r}=n,i=S1(r,e),a=e.filter(s=>!i.some(l=>l.tool.getToolName()===s.getToolName()));let o=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(o=s.mouseMoveCallback(t,c)||o);a.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),o===!0&&vu(r)}const VC=G0.bind(null,"Mouse","mouseUpCallback");function PC(t){if(Ye.isInteractingWithTool)return;t.detail.buttons=S0.Wheel|(t.detail.event.buttons||0);const e=x1(t);if(e)return e.mouseWheelCallback(t)}const Cj=function(t){t.addEventListener(fe.MOUSE_CLICK,RC),t.addEventListener(fe.MOUSE_DOWN,_C),t.addEventListener(fe.MOUSE_DOWN_ACTIVATE,IC),t.addEventListener(fe.MOUSE_DOUBLE_CLICK,DC),t.addEventListener(fe.MOUSE_DRAG,bC),t.addEventListener(fe.MOUSE_MOVE,LC),t.addEventListener(fe.MOUSE_UP,VC),t.addEventListener(fe.MOUSE_WHEEL,PC)},wj=function(t){t.removeEventListener(fe.MOUSE_CLICK,RC),t.removeEventListener(fe.MOUSE_DOWN,_C),t.removeEventListener(fe.MOUSE_DOWN_ACTIVATE,IC),t.removeEventListener(fe.MOUSE_DOUBLE_CLICK,DC),t.removeEventListener(fe.MOUSE_DRAG,bC),t.removeEventListener(fe.MOUSE_MOVE,LC),t.removeEventListener(fe.MOUSE_UP,VC),t.removeEventListener(fe.MOUSE_WHEEL,PC)},NC={enable:Cj,disable:wj},{Active:Sj}=rn;function AC(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=KG(),i=k0.getModifierKey(),a=Mr(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary();for(let c=0;c<o.length;c++){const l=o[c],f=a.toolOptions[l];if(f.mode!==Sj)continue;if(f.bindings.length&&f.bindings.some(g=>g.mouseButton===(r??s)&&g.modifierKey===i))return a.getToolInstance(l)}}function xj(t,e){const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=Mr(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=t.detail.key;for(let c=0;c<o.length;c++){const l=o[c],f=a.getToolInstance(l),u=f.configuration?.actions;if(!u)continue;const g=Object.values(u);if(!g?.length||!e.includes(f.mode))continue;const d=g.find(p=>p.bindings?.some(h=>h.key===s));d&&n.set(f,d)}return n}function FC(t){const e=AC(t);if(e){const{renderingEngineId:r,viewportId:i}=t.detail,a=Mr(i,r),o=e.getToolName();Object.keys(a.toolOptions).includes(o)&&a.setViewportsCursorByToolName(o)}const n=xj(t,[rn.Active]);if(n?.size){const{element:r}=t.detail;for(const[i,a]of[...n.entries()])(typeof a.method=="function"?a.method:i[a.method]).call(i,r,a,t)}}function UC(t){const e=AC(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=t.detail,i=Mr(r,n);RT();const a=e.getToolName();Object.keys(i.toolOptions).includes(a)&&i.setViewportsCursorByToolName(a)}const Ej=function(t){t.addEventListener(fe.KEY_DOWN,FC),t.addEventListener(fe.KEY_UP,UC)},Oj=function(t){t.removeEventListener(fe.KEY_DOWN,FC),t.removeEventListener(fe.KEY_UP,UC)},kC={enable:Ej,disable:Oj},{Active:Rj,Passive:Dj,Enabled:Mj}=rn,GC=function(t){D0(t,[Rj,Dj,Mj]).forEach(n=>{n.onCameraModified&&n.onCameraModified(t)})},_j=function(t){t.addEventListener(Ee.CAMERA_MODIFIED,GC)},Ij=function(t){t.removeEventListener(Ee.CAMERA_MODIFIED,GC)},BC={enable:_j,disable:Ij},{Active:bj,Passive:Lj,Enabled:Vj}=rn,$C=function(t){D0(t,[bj,Lj,Vj]).forEach(n=>{n.onImageSpacingCalibrated&&n.onImageSpacingCalibrated(t)})},Pj=function(t){t.addEventListener(Ee.IMAGE_SPACING_CALIBRATED,$C)},Nj=function(t){t.removeEventListener(Ee.IMAGE_SPACING_CALIBRATED,$C)},WC={enable:Pj,disable:Nj},{Active:Aj}=rn;function Fp(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=t.detail.event,i=Mr(n,e);if(!i)return null;const a=Object.keys(i.toolOptions),o=Object.keys(r.touches).length,s=T1(r)||k0.getModifierKey(),c=i.getDefaultMousePrimary();for(let l=0;l<a.length;l++){const f=a[l],u=i.toolOptions[f],g=u.bindings.length&&u.bindings.some(d=>(d.numTouchPoints===o||o===1&&d.mouseButton===c)&&d.modifierKey===s);if(u.mode===Aj&&g)return i.getToolInstance(f)}}function u4(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=Mr(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=n!=null&&f.bindings.length&&f.bindings.some(g=>g.numTouchPoints===n);if(e.includes(f.mode)&&(!n||u)){const g=a.getToolInstance(l);o.push(g)}}return o}const{Active:Fj,Passive:Uj}=rn;function zC(t){if(Ye.isInteractingWithTool)return;const e=Fp(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const n=Object.keys(t.detail.event.touches).length===1,r=u4(t,[Fj],Object.keys(t.detail.event.touches).length),i=n?u4(t,[Uj]):void 0,a=[...r||[],...i||[],e],o=t.detail,{element:s}=o,c=S1(s,a),l=o.currentPoints.canvas,f=MC(s,c,l,"touch"),u=!1;if(f.length>0){const{tool:d,annotation:p,handle:h}=f4(f);g4(p.annotationUID,u),d.handleSelectedCallback(t,p,h,"Touch");return}const g=Ap(s,c,l,"touch");if(g.length>0){const{tool:d,annotation:p}=f4(g);g4(p.annotationUID,u),d.toolSelectedCallback(t,p,"Touch",l);return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function f4(t){return t.length>1&&t.find(e=>!xc(e.annotation.annotationUID)&&Yl(e.annotation.annotationUID))||t[0]}function g4(t,e=!1){e?h1(t)?Ca(t,!1):Ca(t,!0,!0):Ca(t,!0,!1)}function HC(t){if(Ye.isInteractingWithTool)return;const e=Fp(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"touch");Ca(n.annotationUID)}}function jC(t){if(Ye.isInteractingWithTool)return;const e=Fp(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const KC=G0.bind(null,"Touch","touchEndCallback"),kj=G0.bind(null,"Touch","touchTapCallback"),qC=G0.bind(null,"Touch","touchPressCallback"),Gj=function(t){t.addEventListener(fe.TOUCH_START,zC),t.addEventListener(fe.TOUCH_START_ACTIVATE,HC),t.addEventListener(fe.TOUCH_DRAG,jC),t.addEventListener(fe.TOUCH_END,KC),t.addEventListener(fe.TOUCH_TAP,kj),t.addEventListener(fe.TOUCH_PRESS,qC)},Bj=function(t){t.removeEventListener(fe.TOUCH_START,zC),t.removeEventListener(fe.TOUCH_START_ACTIVATE,HC),t.removeEventListener(fe.TOUCH_DRAG,jC),t.removeEventListener(fe.TOUCH_END,KC),t.removeEventListener(fe.TOUCH_PRESS,qC)},XC={enable:Gj,disable:Bj},$j=function(){Me.addEventListener(fe.ANNOTATION_COMPLETED,Hi.handleAnnotationCompleted),Me.addEventListener(fe.ANNOTATION_MODIFIED,Hi.handleAnnotationUpdate),Me.addEventListener(fe.ANNOTATION_REMOVED,Hi.handleAnnotationDelete)},Wj=function(){Me.removeEventListener(fe.ANNOTATION_COMPLETED,Hi.handleAnnotationCompleted),Me.removeEventListener(fe.ANNOTATION_MODIFIED,Hi.handleAnnotationUpdate),Me.removeEventListener(fe.ANNOTATION_REMOVED,Hi.handleAnnotationDelete)},YC={enable:$j,disable:Wj},{Active:zj,Passive:Hj,Enabled:jj}=rn,ZC=function(t){D0(t,[zj,Hj,jj]).forEach(n=>{n.onResetCamera&&n.onResetCamera(t)})},Kj=function(t){t.addEventListener(Ee.CAMERA_RESET,ZC)},qj=function(t){t.removeEventListener(Ee.CAMERA_RESET,ZC)},JC={enable:Kj,disable:qj};function QC(t){const{element:e,viewportId:n}=t.detail,r=Xj(n);Yj(e),Zj(r,e),Mp.addViewportElement(n,e),iT.enable(e),ET.enable(e),wT.enable(e),k0.enable(e),CC.enable(e),OC.enable(e),BC.enable(e),WC.enable(e),JC.enable(e),NC.enable(e),kC.enable(e),XC.enable(e),Ye.enabledElements.push(e)}function Xj(t){const e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg"),r=`svg-layer-${t}`;n.classList.add("svg-layer"),n.setAttribute("id",r),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.position="absolute";const i=document.createElementNS(e,"defs"),a=document.createElementNS(e,"filter"),o=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return a.setAttribute("id",`shadow-${r}`),a.setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("result","offOut"),o.setAttribute("in","SourceGraphic"),o.setAttribute("dx","0.5"),o.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),a.appendChild(o),a.appendChild(s),a.appendChild(c),i.appendChild(a),n.appendChild(i),n}function Yj(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;Ye.svgNodeCache[r]={}}function Zj(t,e){e.querySelector("div.viewport-element").appendChild(t)}function Jj(t,e){const n=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let r=0;r<Ye.synchronizers.length;r++){const i=Ye.synchronizers[r],a=!i.isDisabled(),o=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);a&&(o||s)&&n.push(i)}return n}const Qj="viewport-element";function ew(t){const{element:e,viewportId:n}=t.detail;nK(e),rK(e),Mp.removeViewportElement(n,e),iT.disable(e),ET.disable(e),wT.disable(e),k0.disable(e),CC.disable(e),OC.disable(e),BC.disable(e),WC.disable(e),JC.disable(e),NC.disable(e),kC.disable(e),XC.disable(e),eK(e),tK(e),iK(e)}const eK=t=>{const e=Ke(t);if(!e)return;Jj(e.viewportId,e.renderingEngineId).forEach(r=>{r.remove(e)})},tK=t=>{const e=Ke(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=e,i=Mr(r,n);i&&i.removeViewports(n,r)};function nK(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;delete Ye.svgNodeCache[r]}function rK(t){const e=t.querySelector(`div.${Qj}`),n=e.querySelector("svg");n&&e.removeChild(n)}const iK=function(t){const e=Ye.enabledElements.findIndex(n=>n===t);e>-1&&Ye.enabledElements.splice(e,1)},Ig=function(t){const{viewportId:e}=t.detail;pC(e)},tw=function(t){const{segmentationId:e}=t.detail;dp().filter(r=>e===r?.data?.segmentation?.segmentationId).forEach(r=>{yo(r.annotationUID)})};let d4=!1;function aK(t={}){d4||(IB(t),oK(),cK(),d4=!0)}function oK(){sK();const t=Ee.ELEMENT_ENABLED,e=Ee.ELEMENT_DISABLED;Me.addEventListener(t,QC),Me.addEventListener(e,ew),YC.enable()}function sK(){const t=Ee.ELEMENT_ENABLED,e=Ee.ELEMENT_DISABLED;Me.removeEventListener(t,QC),Me.removeEventListener(e,ew),YC.disable()}function cK(){lK(),Me.addEventListener(fe.ANNOTATION_COMPLETED,wC),Me.addEventListener(fe.ANNOTATION_MODIFIED,SC),Me.addEventListener(fe.ANNOTATION_SELECTION_CHANGE,_g),Me.addEventListener(fe.ANNOTATION_SELECTION_CHANGE,_g),Me.addEventListener(fe.ANNOTATION_REMOVED,xC),Me.addEventListener(fe.SEGMENTATION_MODIFIED,TC),Me.addEventListener(fe.SEGMENTATION_DATA_MODIFIED,yC),Me.addEventListener(fe.SEGMENTATION_REPRESENTATION_MODIFIED,Ig),Me.addEventListener(fe.SEGMENTATION_REPRESENTATION_ADDED,Ig),Me.addEventListener(fe.SEGMENTATION_REMOVED,tw)}function lK(){Me.removeEventListener(fe.ANNOTATION_COMPLETED,wC),Me.removeEventListener(fe.ANNOTATION_MODIFIED,SC),Me.removeEventListener(fe.ANNOTATION_SELECTION_CHANGE,_g),Me.removeEventListener(fe.ANNOTATION_SELECTION_CHANGE,_g),Me.removeEventListener(fe.ANNOTATION_REMOVED,xC),Me.removeEventListener(fe.SEGMENTATION_MODIFIED,TC),Me.removeEventListener(fe.SEGMENTATION_DATA_MODIFIED,yC),Me.removeEventListener(fe.SEGMENTATION_REPRESENTATION_MODIFIED,Ig),Me.removeEventListener(fe.SEGMENTATION_REPRESENTATION_ADDED,Ig),Me.removeEventListener(fe.SEGMENTATION_REMOVED,tw)}class bf extends ys{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{limitToViewport:!1,ignoreX:!1,ignoreY:!1,ignoreZ:!1}}){super(e,n)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_checkImageInViewport(e,n){const{canvas:r}=e,i=window.devicePixelRatio,a=0,o=r.width/i,s=0,c=r.height/i,l=e.getDefaultActor(),f=e.getRenderer();let u;l&&Mi(l)?u=l.actor.getMapper().getInputData().getBounds():u=f.computeVisiblePropBounds();const[g,d]=e.worldToCanvas([u[0],u[2],u[4]]),[p,h]=e.worldToCanvas([u[1],u[3],u[5]]);if(e.getZoom()<=1){if(g+n[0]<a&&n[0]<0||p+n[0]>o&&n[0]>0||d+n[1]<s&&n[1]<0||h+n[1]>c&&n[1]>0)return!1}else if(g+n[0]>a&&n[0]>0||p+n[0]<o&&n[0]<0||d+n[1]>s&&n[1]>0||h+n[1]<c&&n[1]<0)return!1;return!0}_dragCallback(e){const{element:n,deltaPoints:r}=e.detail,i=Ke(n),a=r.world,o=r.canvas;if(a[0]===0&&a[1]===0&&a[2]===0)return;this.configuration.ignoreX&&(a[0]=0),this.configuration.ignoreY&&(a[1]=0),this.configuration.ignoreZ&&(a[2]=0);const s=i.viewport,c=s.getCamera(),{focalPoint:l,position:f}=c;if(this.configuration.limitToViewport&&!this._checkImageInViewport(s,o))return;const u=[f[0]-a[0],f[1]-a[1],f[2]-a[2]],g=[l[0]-a[0],l[1]-a[1],l[2]-a[2]];s.setCamera({focalPoint:g,position:u}),s.render()}}bf.toolName="Pan";const Vd=4,h4=1024,uK="PT";class Lf extends ys{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"]}){super(e,n),this._getImageDynamicRangeFromMiddleSlice=(r,i)=>{const a=Math.floor(i[2]/2),o=i[0]*i[1];let s,c;r instanceof Float32Array?(s=4,c=Float32Array):r instanceof Uint8Array?(s=1,c=Uint8Array):r instanceof Uint16Array?(s=2,c=Uint16Array):r instanceof Int16Array&&(s=2,c=Int16Array);const l=r.buffer,f=a*o*s,u=new c(l,f,o),{max:g,min:d}=this._getMinMax(u,o);return g-d}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){const{element:n,deltaPoints:r}=e.detail,i=Ke(n),{viewport:a}=i;let o,s,c,l,f,u,g=!1;const d=a.getProperties();if(a instanceof Br){o=a.getVolumeId(),u=e1(o),{lower:s,upper:c}=d.voiRange;const p=Ve.getVolume(o);if(!p)throw new Error("Volume not found "+o);l=p.metadata.Modality,g=p.scaling&&Object.keys(p.scaling).length>0}else if(d.voiRange){l=a.modality,{lower:s,upper:c}=d.voiRange;const{preScale:p={scaled:!1}}=a.getImageData?.()||{};g=p.scaled&&p.scalingParameters?.suvbw!==void 0}else throw new Error("Viewport is not a valid type");if(l===uK&&g?f=this.getPTScaledNewRange({deltaPointsCanvas:r.canvas,lower:s,upper:c,clientHeight:n.clientHeight,isPreScaled:g,viewport:a,volumeId:o}):f=this.getNewRange({viewport:a,deltaPointsCanvas:r.canvas,volumeId:o,lower:s,upper:c}),!(f.lower>=f.upper)&&(a.setProperties({voiRange:f}),a.render(),a instanceof Br)){u.forEach(p=>{a!==p&&p.render()});return}}getPTScaledNewRange({deltaPointsCanvas:e,lower:n,upper:r,clientHeight:i,viewport:a,volumeId:o,isPreScaled:s}){let c=Vd;s?c=5/i:c=this._getMultiplierFromDynamicRange(a,o)||Vd;const f=e[1]*c;return r-=f,r=s?Math.max(r,.1):r,{lower:n,upper:r}}getNewRange({viewport:e,deltaPointsCanvas:n,volumeId:r,lower:i,upper:a}){const o=this._getMultiplierFromDynamicRange(e,r)||Vd,s=n[0]*o,c=n[1]*o;let{windowWidth:l,windowCenter:f}=iu(i,a);l+=s,f+=c,l=Math.max(l,1);const u=e.getProperties().VOILUTFunction;return a0(l,f,u)}_getMultiplierFromDynamicRange(e,n){let r;if(n){const a=Ve.getVolume(n),{voxelManager:o}=e.getImageData(),c=o.getMiddleSliceData().reduce((g,d)=>[Math.min(g[0],d),Math.max(g[1],d)],[1/0,-1/0]),l=a?.metadata?.BitsStored,f=l?2**l:1/0,u=c[1]-c[0];r=Number.isFinite(u)?Math.min(u,f):f}else r=this._getImageDynamicRangeFromViewport(e);const i=r/h4;return Number.isFinite(i)?i>1?Math.round(i):i:h4}_getImageDynamicRangeFromViewport(e){const{imageData:n,voxelManager:r}=e.getImageData();if(r?.getRange){const s=r.getRange();return s[1]-s[0]}const i=n.getDimensions();if(n.getRange){const s=n.getRange();return s[1]-s[0]}let a;if(n.getScalarData?a=n.getScalarData():a=n.getPointData().getScalars().getData(),i[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(a,i);let o;if(a.getRange)o=a.getRange();else{const{min:s,max:c}=this._getMinMax(a,a.length);o=[s,c]}return o[1]-o[0]}_getMinMax(e,n){let r=1/0,i=-1/0;for(let a=0;a<n;a++){const o=e[a];o<r&&(r=o),o>i&&(i=o)}return{max:i,min:r}}}Lf.toolName="WindowLevel";class Vf extends ys{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,n),this.deltaY=1}mouseWheelCallback(e){this._scroll(e)}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){this._scrollDrag(e)}_scrollDrag(e){const{deltaPoints:n,viewportId:r,renderingEngineId:i}=e.detail,{viewport:a}=U0(r,i),{debounceIfNotLoaded:o,invert:s,loop:c}=this.configuration,l=n.canvas[1];let f;a instanceof Br&&(f=a.getVolumeId());const u=this._getPixelPerImage(a),g=l+this.deltaY;if(u)if(Math.abs(g)>=u){const d=Math.round(g/u);mg(a,{delta:s?-d:d,volumeId:f,debounceLoading:o,loop:c}),this.deltaY=g%u}else this.deltaY=g}_scroll(e){const{wheel:n,element:r}=e.detail,{direction:i}=n,{invert:a}=this.configuration,{viewport:o}=Ke(r),s=i*(a?-1:1);mg(o,{delta:s,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:o instanceof mi?o.getVolumeId():void 0,scrollSlabs:this.configuration.scrollSlabs})}_getPixelPerImage(e){const{element:n}=e,r=e.getNumberOfSlices();return Math.max(2,n.offsetHeight/Math.max(r,8))}}Vf.toolName="StackScroll";class Pf extends ys{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,n),this.preMouseDownCallback=r=>{const i=r.detail,{element:a,currentPoints:o}=i,s=o.world,l=Ke(a).viewport.getCamera(),{focalPoint:f}=l;this.initialMousePosWorld=s;let u=Et(f[0]-s[0],f[1]-s[1],f[2]-s[2]);return u=Ht(Ie(),u),this.dirVec=u,!1},this.preTouchStartCallback=r=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(r)},this._dragParallelProjection=(r,i,a,o=!1)=>{const{element:s,deltaPoints:c}=r.detail,l=o?r.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{parallelScale:u,focalPoint:g,position:d}=a,p=5/f[1],h=l*p*(this.configuration.invert?-1:1),m=(1-h)*u;let v=g,y=d;if(!this.configuration.zoomToCenter){const _=v0(g,this.initialMousePosWorld);y=Qn(Ie(),d,this.dirVec,-_*h),v=Qn(Ie(),g,this.dirVec,-_*h)}const T=i.getImageData();let C=[1,1,1],w=m,S=!1;if(T){C=T.spacing;const{dimensions:_}=T,D=_[0]*C[0],N=_[1]*C[1],P=f[0]/f[1],F=wa().rendering?.useLegacyCameraFOV?1.1:1,B=i.options?.displayArea,k=B?.imageArea?.[0]??F,U=B?.imageArea?.[1]??F,H=D*k,W=N*U,J=H/W;let ne;J>P?ne=H/P*.5:ne=W*.5;const{minZoomScale:q,maxZoomScale:Q}=this.configuration,ae=ne/Q,me=ne/q;m<ae?(w=ae,S=!0):m>me&&(w=me,S=!0)}i.setCamera({parallelScale:w,focalPoint:S?g:v,position:S?d:y})},this._dragPerspectiveProjection=(r,i,a,o=!1)=>{const{element:s,deltaPoints:c}=r.detail,l=o?r.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{position:u,focalPoint:g,viewPlaneNormal:d}=a,p=Tn.distance2BetweenPoints(u,g),h=Math.sqrt(p)/f[1],m=[-d[0],-d[1],-d[2]],v=this.configuration.invert?l/h:l*h;let y=v*m[0];u[0]+=y,g[0]+=y,y=v*m[1],u[1]+=y,g[1]+=y,y=v*m[2],u[2]+=y,g[2]+=y,i.setCamera({position:u,focalPoint:g})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}mouseWheelCallback(e){this._zoom(e)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:r,currentPoints:i}=e.detail,a=Ke(r),{viewport:o}=a,s=o.getCamera(),c=i.world,{focalPoint:l}=s;this.initialMousePosWorld=c;let f=Et(l[0]-c[0],l[1]-c[1],l[2]-c[2]);f=Ht(Ie(),f),this.dirVec=f,s.parallelProjection?this._dragParallelProjection(e,o,s,!0):this._dragPerspectiveProjection(e,o,s,!0),o.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:n}=e.detail,r=Ke(n),{viewport:i}=r,a=i.getCamera();a.parallelProjection?this._dragParallelProjection(e,i,a):this._dragPerspectiveProjection(e,i,a),i.render()}_zoom(e){const{element:n,points:r}=e.detail,i=Ke(n),{viewport:a}=i;a.getCamera();const s=e.detail.wheel.direction,c={detail:{element:n,eventName:fe.MOUSE_WHEEL,renderingEngineId:i.renderingEngineId,viewportId:a.id,camera:{},deltaPoints:{page:r.page,client:r.client,world:r.world,canvas:[0,-s*5]},startPoints:r,lastPoints:r,currentPoints:r}};a.type===Bt.STACK&&this.preMouseDownCallback(c),this._dragCallback(c)}_panCallback(e){const{element:n,deltaPoints:r}=e.detail,i=Ke(n),a=r.world,o=i.viewport.getCamera(),{focalPoint:s,position:c}=o,l=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],f=[s[0]-a[0],s[1]-a[1],s[2]-a[2]];i.viewport.setCamera({focalPoint:f,position:l}),i.viewport.render()}}Pf.toolName="Zoom";const Yo=class Yo extends is{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:fK,actions:{undo:{method:"undo",bindings:[{key:"z"}]},redo:{method:"redo",bindings:[{key:"y"}]}}}}){super(e,n),this.addNewAnnotation=r=>{const i=r.detail,{currentPoints:a,element:o}=i,s=a.world;gc(o),this.isDrawing=!0;const c=this.createAnnotation(r,[[...s],[...s]]);vo(c,o);const l=us(o,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),r.preventDefault(),Cn(l),c},this.isPointNearTool=(r,i,a,o)=>{const s=Ke(r),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,g=c.worldToCanvas(f),d=c.worldToCanvas(u),p={start:{x:g[0],y:g[1]},end:{x:d[0],y:d[1]}};return l$([p.start.x,p.start.y],[p.end.x,p.end.y],[a[0],a[1]])<=o},this.toolSelectedCallback=(r,i)=>{const a=r.detail,{element:o}=a;i.highlighted=!0;const s=us(o,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(o),gc(o),Cn(s),r.preventDefault()},this._endCallback=r=>{const i=r.detail,{element:a}=i,{annotation:o,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=o;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(a),this._deactivateDraw(a),jl(a),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&yo(o.annotationUID),Cn(s),this.doneEditMemo(),c&&Dh(o),this.editData=null,this.isDrawing=!1)},this._dragCallback=r=>{this.isDrawing=!0;const i=r.detail,{element:a}=i,{annotation:o,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=o;if(this.createMemo(a,o,{newAnnotation:f}),l){const{deltaPoints:g}=i,d=g.world,{textBox:p}=u.handles,{worldPosition:h}=p;h[0]+=d[0],h[1]+=d[1],h[2]+=d[2],p.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,d=g.world;u.handles.points.forEach(h=>{h[0]+=d[0],h[1]+=d[1],h[2]+=d[2]}),o.invalidated=!0}else{const{currentPoints:g}=i,d=g.world;u.handles.points[c]=[...d],o.invalidated=!0}this.editData.hasMoved=!0,Cn(s),o.invalidated&&Qr(o,a,Li.HandlesUpdated)},this.cancel=r=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(r),this._deactivateModify(r),jl(r);const{annotation:i,viewportIdsToRender:a,newAnnotation:o}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Cn(a),o&&Dh(i),this.editData=null,i.annotationUID}},this._activateModify=r=>{Ye.isInteractingWithTool=!0,r.addEventListener(fe.MOUSE_UP,this._endCallback),r.addEventListener(fe.MOUSE_DRAG,this._dragCallback),r.addEventListener(fe.MOUSE_CLICK,this._endCallback),r.addEventListener(fe.TOUCH_END,this._endCallback),r.addEventListener(fe.TOUCH_DRAG,this._dragCallback),r.addEventListener(fe.TOUCH_TAP,this._endCallback)},this._deactivateModify=r=>{Ye.isInteractingWithTool=!1,r.removeEventListener(fe.MOUSE_UP,this._endCallback),r.removeEventListener(fe.MOUSE_DRAG,this._dragCallback),r.removeEventListener(fe.MOUSE_CLICK,this._endCallback),r.removeEventListener(fe.TOUCH_END,this._endCallback),r.removeEventListener(fe.TOUCH_DRAG,this._dragCallback),r.removeEventListener(fe.TOUCH_TAP,this._endCallback)},this._activateDraw=r=>{Ye.isInteractingWithTool=!0,r.addEventListener(fe.MOUSE_UP,this._endCallback),r.addEventListener(fe.MOUSE_DRAG,this._dragCallback),r.addEventListener(fe.MOUSE_MOVE,this._dragCallback),r.addEventListener(fe.MOUSE_CLICK,this._endCallback),r.addEventListener(fe.TOUCH_END,this._endCallback),r.addEventListener(fe.TOUCH_DRAG,this._dragCallback),r.addEventListener(fe.TOUCH_TAP,this._endCallback)},this._deactivateDraw=r=>{Ye.isInteractingWithTool=!1,r.removeEventListener(fe.MOUSE_UP,this._endCallback),r.removeEventListener(fe.MOUSE_DRAG,this._dragCallback),r.removeEventListener(fe.MOUSE_MOVE,this._dragCallback),r.removeEventListener(fe.MOUSE_CLICK,this._endCallback),r.removeEventListener(fe.TOUCH_END,this._endCallback),r.removeEventListener(fe.TOUCH_DRAG,this._dragCallback),r.removeEventListener(fe.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(r,i)=>{let a=!1;const{viewport:o}=r,{element:s}=o;let c=x0(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return a;const l=this.getTargetId(o),f=o.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:r.viewport.id};for(let g=0;g<c.length;g++){const d=c[g],{annotationUID:p,data:h}=d,{points:m,activeHandleIndex:v}=h.handles;u.annotationUID=p;const{color:y,lineWidth:T,lineDash:C,shadow:w}=this.getAnnotationStyle({annotation:d,styleSpecifier:u}),S=m.map(Q=>o.worldToCanvas(Q));if(!h.cachedStats[l]||h.cachedStats[l].unit==null?(h.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(d,f,r)):d.invalidated&&this._throttledCalculateCachedStats(d,f,r),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;let _;if(!Yl(p))continue;!xc(p)&&!this.editData&&v!==null&&(_=[S[v]]);const D=!!Tg("showHandlesAlways",{});(_||D)&&Eg(i,p,"0",S,{color:y,lineDash:C,lineWidth:T});const N=`${p}-line`;if(KT(i,p,"1",S[0],S[1],{color:y,width:T,lineDash:C,shadow:w},N),a=!0,!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;const F=this.getLinkedTextBoxStyle(u,d);if(!F.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const B=this.configuration.getTextLines(h,l);if(!h.handles.textBox.hasMoved){const Q=fC(S);h.handles.textBox.worldPosition=o.canvasToWorld(Q)}const k=o.worldToCanvas(h.handles.textBox.worldPosition),H=qT(i,p,"1",B,k,S,{},F),{x:W,y:J,width:ne,height:q}=H;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([W,J]),topRight:o.canvasToWorld([W+ne,J]),bottomLeft:o.canvasToWorld([W,J+q]),bottomRight:o.canvasToWorld([W+ne,J+q])}}return a},this._throttledCalculateCachedStats=oC(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,n,r){const i=e.detail,{element:a}=i,{data:o}=n;n.highlighted=!0;let s=!1,c;r.worldPosition?s=!0:c=o.handles.points.findIndex(f=>f===r);const l=us(a,this.getToolName());this.editData={annotation:n,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(a),gc(a),Cn(l),e.preventDefault()}_calculateCachedStats(e,n,r){const i=e.data,{element:a}=r.viewport,{cachedStats:o}=i,s=Object.keys(o);for(let l=0;l<s.length;l++){const f=s[l],u=this.getTargetImageData(f);if(!u)continue;const{imageData:g,dimensions:d}=u,p=i.handles.points.map(T=>g.worldToIndex(T)),h=nC(u,p),{unit:m}=h,v=Yo.calculateLengthInIndex(h,p);this.isHandleOutsideImage=!Yo.isInsideVolume(d,p);const y={name:"length",value:v,unit:m,type:l0.Linear};o[f]={length:v,unit:m,statsArray:[y]}}const c=e.invalidated;return e.invalidated=!1,c&&Qr(e,a,Li.StatsUpdated),o}};Yo.toolName="Length",Yo.hydrate=(e,n,r)=>{const i=Un(e);if(!i)return;const{FrameOfReferenceUID:a,referencedImageId:o,viewPlaneNormal:s,instance:c,viewport:l}=Yo.hydrateBase(Yo,i,n,r),{toolInstance:f,...u}=r||{},g={annotationUID:r?.annotationUID||nr(),data:{handles:{points:n}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:o,...u}};vo(g,l.element),Cn([l.id])};let Dl=Yo;function fK(t,e){const n=t.cachedStats[e],{length:r,unit:i}=n;return r==null||isNaN(r)?void 0:[`${ga(r)} ${i}`]}function nw(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++)e[a++]=t[i++],e[a++]=t[i++],e[a++]=t[i++],e[a++]=255;return}e.set(t)}function gK(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n)for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++]}function dK(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++){const s=t[i++],c=t[i++],l=t[i++];e[a++]=s+1.402*(l-128),e[a++]=s-.34414*(c-128)-.71414*(l-128),e[a++]=s+1.772*(c-128),e[a++]=255}return}for(let o=0;o<r;o++){const s=t[i++],c=t[i++],l=t[i++];e[a++]=s+1.402*(l-128),e[a++]=s-.34414*(c-128)-.71414*(l-128),e[a++]=s+1.772*(c-128)}}function hK(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n){for(let c=0;c<r;c++){const l=t[a++],f=t[o++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128),e[i++]=255}return}for(let c=0;c<r;c++){const l=t[a++],f=t[o++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128)}}function pK(t,e,n){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const r=t.length/2;let i=0,a=0;if(n){for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[a++]=s+1.402*(f-128),e[a++]=s-.34414*(l-128)-.71414*(f-128),e[a++]=s+1.772*(l-128),e[a++]=255,e[a++]=c+1.402*(f-128),e[a++]=c-.34414*(l-128)-.71414*(f-128),e[a++]=c+1.772*(l-128),e[a++]=255}return}for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[a++]=s+1.402*(f-128),e[a++]=s-.34414*(l-128)-.71414*(f-128),e[a++]=s+1.772*(l-128),e[a++]=c+1.402*(f-128),e[a++]=c-.34414*(l-128)-.71414*(f-128),e[a++]=c+1.772*(l-128)}}function Pd(t,e){const n=t.length,r=new Uint8ClampedArray(n);for(let i=0;i<n;++i)r[i]=t[i]>>e;return r}function Nd(t,e,n){const r=t[`${e}PaletteColorLookupTableData`];if(r)return Promise.resolve(r);const i=Pe("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(a=>a?a[`${e}PaletteColorLookupTableData`]:n):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:n)}function mK(t,e,n){const r=t.columns*t.rows,i=t.pixelData;Promise.all([Nd(t,"red",null),Nd(t,"green",null),Nd(t,"blue",null)]).then(([a,o,s])=>{if(!a||!o||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=a.length;let l=0,f=0;const u=t.redPaletteColorLookupTableDescriptor[1],g=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,d=Pd(a,g),p=Pd(o,g),h=Pd(s,g);if(n){for(let m=0;m<r;++m){let v=i[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=d[v],e[f++]=p[v],e[f++]=h[v],e[f++]=255}return}for(let m=0;m<r;++m){let v=i[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=d[v],e[f++]=p[v],e[f++]=h[v]}})}function Ad(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function Fd(t,e,n){const r=[],i=t.elements[e];for(let a=0;a<n[0];a++)n[2]===16?r[a]=t.uint16(e,a):r[a]=t.byteArray[a+i.dataOffset];return r}function vK(t,e){e.redPaletteColorLookupTableDescriptor=Ad(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=Ad(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=Ad(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const n=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===n?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=Fd(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=Fd(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=Fd(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function yK(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function TK(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return yK(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&vK(t,e),e}function CK(t,e){let n=e.uint16("x00283002",0);n===0&&(n=65535);let r=0;t===0?r=e.uint16("x00283002",1):r=e.int16("x00283002",1);const i=e.uint16("x00283002",2),a={id:"1",firstValueMapped:r,numBitsPerEntry:i,lut:[]};for(let o=0;o<n;o++)t===0?a.lut[o]=e.uint16("x00283006",o):a.lut[o]=e.int16("x00283006",o);return a}function p4(t,e){if(!e||!e.items||!e.items.length)return;const n=[];for(let r=0;r<e.items.length;r++){const i=e.items[r].dataSet,a=CK(t,i);a&&n.push(a)}return n}function wK(t){const e=t.uint16("x00280103"),n=t.uint16("x00280101");return e===0?0:-1<<n-1}function SK(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const n=t.floatString("x00281052"),r=t.floatString("x00281053");return n!==void 0&&r!==void 0?wK(t)*r+n<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function Oa(t,e,n){const r=[],i=t.string(e);if(!i)return;const a=i.split("\\");if(!(n&&a.length<n)){for(let o=0;o<a.length;o++)r.push(parseFloat(a[o]));return r}}var Nf={exports:{}};var xK=Nf.exports,m4;function EK(){return m4||(m4=1,(function(t,e){(function(n,r){t.exports=r(ho)})(xK,function(n){return i=[function(o,s){o.exports=n},function(o,s,c){c.r(s),c.d(s,"isStringVr",function(){return f}),c.d(s,"isPrivateTag",function(){return u}),c.d(s,"parsePN",function(){return g}),c.d(s,"parseTM",function(){return d}),c.d(s,"parseDA",function(){return h}),c.d(s,"explicitElementToString",function(){return m}),c.d(s,"explicitDataSetToJS",function(){return v}),c.d(s,"createJPEGBasicOffsetTable",function(){return C}),c.d(s,"parseDicomDataSetExplicit",function(){return me}),c.d(s,"parseDicomDataSetImplicit",function(){return de}),c.d(s,"readFixedString",function(){return D}),c.d(s,"alloc",function(){return je}),c.d(s,"version",function(){return $e}),c.d(s,"bigEndianByteArrayParser",function(){return Be}),c.d(s,"ByteStream",function(){return ut}),c.d(s,"sharedCopy",function(){return qe}),c.d(s,"DataSet",function(){return F}),c.d(s,"findAndSetUNElementLength",function(){return _}),c.d(s,"findEndOfEncapsulatedElement",function(){return S}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return B}),c.d(s,"littleEndianByteArrayParser",function(){return ke}),c.d(s,"parseDicom",function(){return $t}),c.d(s,"readDicomElementExplicit",function(){return ae}),c.d(s,"readDicomElementImplicit",function(){return U}),c.d(s,"readEncapsulatedImageFrame",function(){return on}),c.d(s,"readEncapsulatedPixelData",function(){return ir}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return Kt}),c.d(s,"readPart10Header",function(){return Xe}),c.d(s,"readSequenceItemsExplicit",function(){return q}),c.d(s,"readSequenceItemsImplicit",function(){return J}),c.d(s,"readSequenceItem",function(){return H}),c.d(s,"readTag",function(){return w});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},f=function($){return l[$]},u=function($){if($=parseInt($[4],16),isNaN($))throw"dicomParser.isPrivateTag: cannot parse last character of group";return $%2==1},g=function($){if($!==void 0)return $=$.split("^"),{familyName:$[0],givenName:$[1],middleName:$[2],prefix:$[3],suffix:$[4]}};function d($,j){if(2<=$.length){var re=parseInt($.substring(0,2),10),K=4<=$.length?parseInt($.substring(2,4),10):void 0,oe=6<=$.length?parseInt($.substring(4,6),10):void 0,we=8<=$.length?$.substring(7,13):void 0,we=we?parseInt(we,10)*Math.pow(10,6-we.length):void 0;if(j&&(isNaN(re)||K!==void 0&&isNaN(K)||oe!==void 0&&isNaN(oe)||we!==void 0&&isNaN(we)||re<0||23<re||K&&(K<0||59<K)||oe&&(oe<0||59<oe)||we&&(we<0||999999<we)))throw"invalid TM '".concat($,"'");return{hours:re,minutes:K,seconds:oe,fractionalSeconds:we}}if(j)throw"invalid TM '".concat($,"'")}function p($,j,re){return!isNaN(re)&&0<j&&j<=12&&0<$&&$<=(function(K,oe){switch(K){case 2:return oe%4==0&&oe%100||oe%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}})(j,re)}function h($,j){if($&&$.length===8){var re=parseInt($.substring(0,4),10),K=parseInt($.substring(4,6),10),oe=parseInt($.substring(6,8),10);if(j&&p(oe,K,re)!==!0)throw"invalid DA '".concat($,"'");return{year:re,month:K,day:oe}}if(j)throw"invalid DA '".concat($,"'")}function m($,j){if($===void 0||j===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(j.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var re,K=j.vr,oe=j.tag;function we(st,St){for(var kt="",_t=0;_t<st;_t++)_t!==0&&(kt+="/"),kt+=St.call($,oe,_t).toString();return kt}if(f(K)===!0)re=$.string(oe);else{if(K==="AT"){var Ae=$.uint32(oe);return Ae===void 0?void 0:"x".concat((Ae=Ae<0?4294967295+Ae+1:Ae).toString(16).toUpperCase())}K==="US"?re=we(j.length/2,$.uint16):K==="SS"?re=we(j.length/2,$.int16):K==="UL"?re=we(j.length/4,$.uint32):K==="SL"?re=we(j.length/4,$.int32):K==="FD"?re=we(j.length/8,$.double):K==="FL"&&(re=we(j.length/4,$.float))}return re}function v($,j){if($===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";j=j||{omitPrivateAttibutes:!0,maxElementLength:128};var re,K={};for(re in $.elements){var oe=$.elements[re];if(j.omitPrivateAttibutes!==!0||!u(re))if(oe.items){for(var we=[],Ae=0;Ae<oe.items.length;Ae++)we.push(v(oe.items[Ae].dataSet,j));K[re]=we}else{var st=void 0;oe.length<j.maxElementLength&&(st=m($,oe)),K[re]=st!==void 0?st:{dataOffset:oe.dataOffset,length:oe.length}}}return K}function y($,j){return $.byteArray[j]===255&&$.byteArray[j+1]===217}function T($,j,re){for(var K,oe,we=re;we<j.fragments.length;we++)if(K=$,oe=we,oe=j.fragments[oe],!(!y(K,oe.position+oe.length-2)&&!y(K,oe.position+oe.length-3)))return we}function C($,j,re){if($===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(j===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(j.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(j.encapsulatedPixelData!==!0||j.hadUndefinedLength!==!0||j.basicOffsetTable===void 0||j.fragments===void 0||j.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(re&&re.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";re=re||j.fragments;for(var K=[],oe=0;;){K.push(j.fragments[oe].offset);var we=T($,j,oe);if(we===void 0||we===j.fragments.length-1)return K;oe=we+1}}function w(re){if(re===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var j=256*re.readUint16()*256,re=re.readUint16();return"x".concat("00000000".concat((j+re).toString(16)).substr(-8))}function S($,j,re){if($===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(j===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(j.encapsulatedPixelData=!0,j.basicOffsetTable=[],j.fragments=[],w($)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var K=$.readUint32()/4,oe=0;oe<K;oe++){var we=$.readUint32();j.basicOffsetTable.push(we)}for(var Ae=$.position;$.position<$.byteArray.length;){var st=w($),St=$.readUint32();if(st==="xfffee0dd")return $.seek(St),void(j.length=$.position-j.dataOffset);if(st!=="xfffee000")return re&&re.push("unexpected tag ".concat(st," while searching for end of pixel data element with undefined length")),St>$.byteArray.length-$.position&&(St=$.byteArray.length-$.position),j.fragments.push({offset:$.position-Ae-8,position:$.position,length:St}),$.seek(St),void(j.length=$.position-j.dataOffset);j.fragments.push({offset:$.position-Ae-8,position:$.position,length:St}),$.seek(St)}re&&re.push("pixel data element ".concat(j.tag," missing sequence delimiter tag xfffee0dd"))}function _($,j){if($===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var re=$.byteArray.length-8;$.position<=re;)if($.readUint16()===65534){var K=$.readUint16();if(K===57565)return $.readUint32()!==0&&$.warnings("encountered non zero length following item delimiter at position ".concat($.position-4," while reading element of undefined length with tag ").concat(j.tag)),void(j.length=$.position-j.dataOffset)}j.length=$.byteArray.length-j.dataOffset,$.seek($.byteArray.length-$.position)}function D($,j,re){if(re<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(j+re>$.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var K,oe="",we=0;we<re;we++){if((K=$[j+we])===0)return j+=re,oe;oe+=String.fromCharCode(K)}return oe}function N($,j){for(var re=0;re<j.length;re++){var K=j[re];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty($,K.key,K)}}function P($,j){return $.parser!==void 0?$.parser:j}var F=(function(){function $(K,oe,we){(function(Ae,st){if(!(Ae instanceof st))throw new TypeError("Cannot call a class as a function")})(this,$),this.byteArrayParser=K,this.byteArray=oe,this.elements=we}var j,re;return j=$,(re=[{key:"uint16",value:function(K,oe){if(K=this.elements[K],oe=oe!==void 0?oe:0,K&&K.length!==0)return P(K,this.byteArrayParser).readUint16(this.byteArray,K.dataOffset+2*oe)}},{key:"int16",value:function(K,oe){if(K=this.elements[K],oe=oe!==void 0?oe:0,K&&K.length!==0)return P(K,this.byteArrayParser).readInt16(this.byteArray,K.dataOffset+2*oe)}},{key:"uint32",value:function(K,oe){if(K=this.elements[K],oe=oe!==void 0?oe:0,K&&K.length!==0)return P(K,this.byteArrayParser).readUint32(this.byteArray,K.dataOffset+4*oe)}},{key:"int32",value:function(K,oe){if(K=this.elements[K],oe=oe!==void 0?oe:0,K&&K.length!==0)return P(K,this.byteArrayParser).readInt32(this.byteArray,K.dataOffset+4*oe)}},{key:"float",value:function(K,oe){if(K=this.elements[K],oe=oe!==void 0?oe:0,K&&K.length!==0)return P(K,this.byteArrayParser).readFloat(this.byteArray,K.dataOffset+4*oe)}},{key:"double",value:function(K,oe){if(K=this.elements[K],oe=oe!==void 0?oe:0,K&&K.length!==0)return P(K,this.byteArrayParser).readDouble(this.byteArray,K.dataOffset+8*oe)}},{key:"numStringValues",value:function(K){if(K=this.elements[K],K&&0<K.length)return K=D(this.byteArray,K.dataOffset,K.length).match(/\\/g),K===null?1:K.length+1}},{key:"string",value:function(K,oe){if(K=this.elements[K],K&&K.Value)return K.Value;if(K&&0<K.length)return K=D(this.byteArray,K.dataOffset,K.length),0<=oe?K.split("\\")[oe].trim():K.trim()}},{key:"text",value:function(K,oe){if(K=this.elements[K],K&&0<K.length)return K=D(this.byteArray,K.dataOffset,K.length),0<=oe?K.split("\\")[oe].replace(/ +$/,""):K.replace(/ +$/,"")}},{key:"floatString",value:function(K,oe){var we=this.elements[K];if(we&&0<we.length&&(oe=this.string(K,oe=oe!==void 0?oe:0),oe!==void 0))return parseFloat(oe)}},{key:"intString",value:function(K,oe){var we=this.elements[K];if(we&&0<we.length&&(oe=this.string(K,oe=oe!==void 0?oe:0),oe!==void 0))return parseInt(oe)}},{key:"attributeTag",value:function(K){var oe=this.elements[K];if(oe&&oe.length===4){var we=P(oe,this.byteArrayParser).readUint16,K=this.byteArray,oe=oe.dataOffset;return"x".concat("00000000".concat((256*we(K,oe)*256+we(K,oe+2)).toString(16)).substr(-8))}}}])&&N(j.prototype,re),Object.defineProperty(j,"prototype",{writable:!1}),$})();function B($,j){if($===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var re=$.byteArray.length-8;$.position<=re;)if($.readUint16()===65534){var K=$.readUint16();if(K===57357)return $.readUint32()!==0&&$.warnings("encountered non zero length following item delimiter at position ".concat($.position-4," while reading element of undefined length with tag ").concat(j.tag)),void(j.length=$.position-j.dataOffset)}j.length=$.byteArray.length-j.dataOffset,$.seek($.byteArray.length-$.position)}var k=function($,j){return $.vr!==void 0?$.vr==="SQ":j.position+4<=j.byteArray.length?($=w(j),j.seek(-4),$==="xfffee000"||$==="xfffee0dd"):(j.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function U($,j,re){if($===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var K=w($),K={tag:K,vr:re!==void 0?re(K):void 0,length:$.readUint32(),dataOffset:$.position};return K.length===4294967295&&(K.hadUndefinedLength=!0),K.tag===j||(!k(K,$)||u(K.tag)&&!K.hadUndefinedLength?K.hadUndefinedLength?B($,K):$.seek(K.length):(J($,K,re),u(K.tag)&&(K.items=void 0))),K}function H($){if($===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var j={tag:w($),length:$.readUint32(),dataOffset:$.position};if(j.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat($.position);return j}function W($,j){var re=H($);return re.length===4294967295?(re.hadUndefinedLength=!0,re.dataSet=(function(K,oe){for(var we={};K.position<K.byteArray.length;){var Ae=U(K,void 0,oe);if((we[Ae.tag]=Ae).tag==="xfffee00d")return new F(K.byteArrayParser,K.byteArray,we)}return K.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new F(K.byteArrayParser,K.byteArray,we)})($,j),re.length=$.position-re.dataOffset):(re.dataSet=new F($.byteArrayParser,$.byteArray,{}),de(re.dataSet,$,$.position+re.length,{vrCallback:j})),re}function J($,j,re){if($===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(j===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";j.items=[],(j.length===4294967295?function(K,oe,we){for(;K.position+4<=K.byteArray.length;){var Ae=w(K);if(K.seek(-4),Ae==="xfffee0dd")return oe.length=K.position-oe.dataOffset,K.seek(8);Ae=W(K,we),oe.items.push(Ae)}K.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),oe.length=K.byteArray.length-oe.dataOffset}:function(K,oe,we){for(var Ae=oe.dataOffset+oe.length;K.position<Ae;){var st=W(K,we);oe.items.push(st)}})($,j,re)}function ne($,j){var re=H($);return re.length===4294967295?(re.hadUndefinedLength=!0,re.dataSet=(function(K,oe){for(var we={};K.position<K.byteArray.length;){var Ae=ae(K,oe);if((we[Ae.tag]=Ae).tag==="xfffee00d")return new F(K.byteArrayParser,K.byteArray,we)}return oe.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new F(K.byteArrayParser,K.byteArray,we)})($,j),re.length=$.position-re.dataOffset):(re.dataSet=new F($.byteArrayParser,$.byteArray,{}),me(re.dataSet,$,$.position+re.length)),re}function q($,j,re){if($===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(j===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";j.items=[],(j.length===4294967295?function(K,oe,we){for(;K.position+4<=K.byteArray.length;){var Ae=w(K);if(K.seek(-4),Ae==="xfffee0dd")return oe.length=K.position-oe.dataOffset,K.seek(8);Ae=ne(K,we),oe.items.push(Ae)}we.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),oe.length=K.position-oe.dataOffset}:function(K,oe,we){for(var Ae=oe.dataOffset+oe.length;K.position<Ae;){var st=ne(K,we);oe.items.push(st)}})($,j,re)}var Q=function($){return $==="OB"||$==="OD"||$==="OL"||$==="OW"||$==="SQ"||$==="OF"||$==="UC"||$==="UR"||$==="UT"||$==="UN"?4:2};function ae($,j,re){if($===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var K={tag:w($),vr:$.readFixedString(2)};return Q(K.vr)===2?K.length=$.readUint16():($.seek(2),K.length=$.readUint32()),K.dataOffset=$.position,K.length===4294967295&&(K.hadUndefinedLength=!0),K.tag===re||(K.vr==="SQ"?q($,K,j):K.length===4294967295?K.tag==="x7fe00010"?S($,K,j):(K.vr==="UN"?J:B)($,K):$.seek(K.length)),K}function me($,j,re){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(re=re===void 0?j.byteArray.length:re,j===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(re<j.position||re>j.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var oe=$.elements;j.position<re;){var we=ae(j,$.warnings,K.untilTag);if((oe[we.tag]=we).tag===K.untilTag)return}if(j.position>re)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function de($,j,re){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(re=re===void 0?$.byteArray.length:re,j===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(re<j.position||re>j.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var oe=$.elements;j.position<re;){var we=U(j,K.untilTag,K.vrCallback);if((oe[we.tag]=we).tag===K.untilTag)return}}function je($,j){if(typeof Buffer<"u"&&$ instanceof Buffer)return Buffer.alloc(j);if($ instanceof Uint8Array)return new Uint8Array(j);throw"dicomParser.alloc: unknown type for byteArray"}var $e="1.8.12",Be={readUint16:function($,j){if(j<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(j+2>$.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return($[j]<<8)+$[j+1]},readInt16:function($,j){if(j<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(j+2>$.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return j=($[j]<<8)+$[j+1],j=32768&j?j-65535-1:j},readUint32:function($,j){if(j<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(j+4>$.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*$[j]+$[j+1])+$[j+2])+$[j+3]},readInt32:function($,j){if(j<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(j+4>$.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return($[j]<<24)+($[j+1]<<16)+($[j+2]<<8)+$[j+3]},readFloat:function($,j){if(j<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(j+4>$.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var re=new Uint8Array(4);return re[3]=$[j],re[2]=$[j+1],re[1]=$[j+2],re[0]=$[j+3],new Float32Array(re.buffer)[0]},readDouble:function($,j){if(j<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(j+8>$.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var re=new Uint8Array(8);return re[7]=$[j],re[6]=$[j+1],re[5]=$[j+2],re[4]=$[j+3],re[3]=$[j+4],re[2]=$[j+5],re[1]=$[j+6],re[0]=$[j+7],new Float64Array(re.buffer)[0]}};function qe($,j,re){if(typeof Buffer<"u"&&$ instanceof Buffer)return $.slice(j,j+re);if($ instanceof Uint8Array)return new Uint8Array($.buffer,$.byteOffset+j,re);throw"dicomParser.from: unknown type for byteArray"}function Qe($,j){for(var re=0;re<j.length;re++){var K=j[re];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty($,K.key,K)}}var ut=(function(){function $(K,oe,we){if((function(Ae,st){if(!(Ae instanceof st))throw new TypeError("Cannot call a class as a function")})(this,$),K===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(oe===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(oe instanceof Uint8Array)&&(typeof Buffer>"u"||!(oe instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(we<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(we>=oe.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=K,this.byteArray=oe,this.position=we||0,this.warnings=[]}var j,re;return j=$,(re=[{key:"seek",value:function(K){if(this.position+K<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=K}},{key:"readByteStream",value:function(K){if(this.position+K>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var oe=qe(this.byteArray,this.position,K);return this.position+=K,new $(this.byteArrayParser,oe)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var K=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,K}},{key:"readUint32",value:function(){var K=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,K}},{key:"readFixedString",value:function(K){var oe=D(this.byteArray,this.position,K);return this.position+=K,oe}}])&&Qe(j.prototype,re),Object.defineProperty(j,"prototype",{writable:!1}),$})(),ke={readUint16:function($,j){if(j<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(j+2>$.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return $[j]+256*$[j+1]},readInt16:function($,j){if(j<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(j+2>$.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return j=$[j]+($[j+1]<<8),j=32768&j?j-65535-1:j},readUint32:function($,j){if(j<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(j+4>$.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return $[j]+256*$[j+1]+256*$[j+2]*256+256*$[j+3]*256*256},readInt32:function($,j){if(j<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(j+4>$.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return $[j]+($[j+1]<<8)+($[j+2]<<16)+($[j+3]<<24)},readFloat:function($,j){if(j<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(j+4>$.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var re=new Uint8Array(4);return re[0]=$[j],re[1]=$[j+1],re[2]=$[j+2],re[3]=$[j+3],new Float32Array(re.buffer)[0]},readDouble:function($,j){if(j<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(j+8>$.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var re=new Uint8Array(8);return re[0]=$[j],re[1]=$[j+1],re[2]=$[j+2],re[3]=$[j+3],re[4]=$[j+4],re[5]=$[j+5],re[6]=$[j+6],re[7]=$[j+7],new Float64Array(re.buffer)[0]}};function Xe($){var j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if($===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var re=j.TransferSyntaxUID,K=new ut(ke,$);return(function(){var oe=(function(){if(K.getSize()<=132&&re)return!1;if(K.seek(128),K.readFixedString(4)==="DICM")return!0;if(!(j||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return K.seek(0),!1})(),we=[],Ae={};if(!oe)return K.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:re}},warnings:we};for(;K.position<K.byteArray.length;){var st=K.position,St=ae(K,we);if("x0002ffff"<St.tag){K.position=st;break}St.parser=ke,Ae[St.tag]=St}return(oe=new F(K.byteArrayParser,K.byteArray,Ae)).warnings=K.warnings,oe.position=K.position,oe})()}var et="1.2.840.10008.1.2.2";function $t($){var j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if($===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var re,K=function(we){if(we.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return we=we.elements.x00020010,we&&we.Value||D($,we.dataOffset,we.length)};function oe(St){var st=K(St),Ae=st!=="1.2.840.10008.1.2",st=(function(kt,_t){var xn=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(kt!=="1.2.840.10008.1.2.1.99")return new ut(kt===et?Be:ke,$,_t);if(j&&j.inflater)return kt=j.inflater($,_t),new ut(ke,kt,0);if(xn==!0){var pt=c(0),Lt=qe($,_t,$.length-_t),pt=pt.inflateRawSync(Lt),Lt=je($,pt.length+_t);return $.copy(Lt,0,0,_t),pt.copy(Lt,_t),new ut(ke,Lt,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return pt=$.slice(_t),Lt=pako.inflateRaw(pt),(pt=je($,Lt.length+_t)).set($.slice(0,_t),0),pt.set(Lt,_t),new ut(ke,pt,0)})(st,St.position),St=new F(st.byteArrayParser,st.byteArray,{});St.warnings=st.warnings;try{(Ae?me:de)(St,st,st.byteArray.length,j)}catch(kt){throw{exception:kt,dataSet:St}}return St}return(function(we,Ae){for(var st in we.elements)we.elements.hasOwnProperty(st)&&(Ae.elements[st]=we.elements[st]);return we.warnings!==void 0&&(Ae.warnings=we.warnings.concat(Ae.warnings)),Ae})(re=Xe($,j),oe(re))}var Zt=function($,j,re){for(var K=0,oe=j;oe<j+re;oe++)K+=$[oe].length;return K};function Kt($,Ae,re,K,oe){if(oe=oe||Ae.fragments,$===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(Ae===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(re===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((K=K||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(Ae.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(Ae.encapsulatedPixelData!==!0||Ae.hadUndefinedLength!==!0||Ae.basicOffsetTable===void 0||Ae.fragments===void 0||Ae.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(re<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(re>=Ae.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(K<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(re+K>Ae.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var we=new ut($.byteArrayParser,$.byteArray,Ae.dataOffset),Ae=H(we);if(Ae.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";we.seek(Ae.length);var st=we.position;if(K===1)return qe(we.byteArray,st+oe[re].offset+8,oe[re].length);for(var Ae=Zt(oe,re,K),St=je(we.byteArray,Ae),kt=0,_t=re;_t<re+K;_t++)for(var xn=st+oe[_t].offset+8,pt=0;pt<oe[_t].length;pt++)St[kt++]=we.byteArray[xn++];return St}var Jt=function($,j){for(var re=0;re<$.length;re++)if($[re].offset===j)return re},qt=function($,j,re,K){if($===j.length-1)return re.length-K;for(var oe=j[$+1],we=K+1;we<re.length;we++)if(re[we].offset===oe)return we-K;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function on($,j,re,K,oe){if(K=K||j.basicOffsetTable,oe=oe||j.fragments,$===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(j===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(re===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(K===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(j.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(j.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(j.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(j.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(K.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(re<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(re>=K.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var we=K[re],we=Jt(oe,we);if(we===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Kt($,j,we,qt(re,K,oe,we),oe)}var tn=!1;function ir($,j,re){if(tn||(tn=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),$===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(j===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(re===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(j.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(j.encapsulatedPixelData!==!0||j.hadUndefinedLength!==!0||j.basicOffsetTable===void 0||j.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(re<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return j.basicOffsetTable.length!==0?on($,j,re):Kt($,j,0,j.fragments.length)}s.default={isStringVr:f,isPrivateTag:u,parsePN:g,parseTM:d,parseDA:h,explicitElementToString:m,explicitDataSetToJS:v,createJPEGBasicOffsetTable:C,parseDicomDataSetExplicit:me,parseDicomDataSetImplicit:de,readFixedString:D,alloc:je,version:$e,bigEndianByteArrayParser:Be,ByteStream:ut,sharedCopy:qe,DataSet:F,findAndSetUNElementLength:_,findEndOfEncapsulatedElement:S,findItemDelimitationItemAndSetElementLength:B,littleEndianByteArrayParser:ke,parseDicom:$t,readDicomElementExplicit:ae,readDicomElementImplicit:U,readEncapsulatedImageFrame:on,readEncapsulatedPixelData:ir,readEncapsulatedPixelDataFromFragments:Kt,readPart10Header:Xe,readSequenceItemsExplicit:q,readSequenceItemsImplicit:J,readSequenceItem:H,readTag:w,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],a={},r.m=i,r.c=a,r.d=function(o,s,c){r.o(o,s)||Object.defineProperty(o,s,{enumerable:!0,get:c})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,s){if(1&s&&(o=r(o)),8&s||4&s&&typeof o=="object"&&o&&o.__esModule)return o;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:o}),2&s&&typeof o!="string")for(var l in o)r.d(c,l,(function(f){return o[f]}).bind(null,l));return c},r.n=function(o){var s=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(s,"a",s),s},r.o=function(o,s){return Object.prototype.hasOwnProperty.call(o,s)},r.p="",r(r.s=1);function r(o){if(a[o])return a[o].exports;var s=a[o]={i:o,l:!1,exports:{}};return i[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}var i,a})})(Nf)),Nf.exports}var Rr=EK();const OK=ji(Rr);function E1(t){const e=t.indexOf(":");let n=t.substring(e+1);const r=n.indexOf("frame=");let i;if(r!==-1){const s=n.substring(r+6);i=parseInt(s,10),n=n.substring(0,r-1)}const a=t.substring(0,e),o=i!==void 0?i-1:void 0;return{scheme:a,url:n,frame:i,pixelDataFrame:o}}let Uh={open(t,e){t.open("get",e,!0)},beforeSend:async()=>{},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function RK(t){Uh=Object.assign(Uh,t)}function O1(){return Uh}function Up(t,e,n={},r={}){const i=O1(),a=c=>{if(typeof i.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,i.errorInterceptor(l)}},o=new XMLHttpRequest,s=new Promise(async(c,l)=>{i.open(o,t,n,r);const f=await i.beforeSend(o,e,n,r);o.responseType="arraybuffer";const u=Object.assign({},n,f);Object.keys(u).forEach(function(g){u[g]!==null&&(g==="Accept"&&t.indexOf("accept=")!==-1||o.setRequestHeader(g,u[g]))}),r.deferred={resolve:c,reject:l},r.url=t,r.imageId=e,o.onloadstart=function(g){i.onloadstart&&i.onloadstart(g,r),Oe(Me,"cornerstoneimageloadstart",{url:t,imageId:e})},o.onloadend=function(g){i.onloadend&&i.onloadend(g,r),Oe(Me,"cornerstoneimageloadend",{url:t,imageId:e})},o.onreadystatechange=function(g){i.onreadystatechange&&i.onreadystatechange(g,r),o.readyState===4&&(o.status===200||o.status===206?i.beforeProcessing(o).then(c).catch(()=>{a(o),l(o)}):(a(o),l(o)))},o.onprogress=function(g){const d=g.loaded;let p,h;g.lengthComputable&&(p=g.total,h=Math.round(d/p*100)),Oe(Me,"cornerstoneimageloadprogress",{url:t,imageId:e,loaded:d,total:p,percentComplete:h}),i.onprogress&&i.onprogress(g,r)},o.onerror=function(){a(o),l(o)},o.onabort=function(){a(o),l(o)},o.send()});return s.xhr=o,s}function DK(t,e,n){if(n+t.length>e.length)return!1;let r=n;for(let i=0;i<t.length;i++)if(t[i]!==e[r++])return!1;return!0}function MK(t){const e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}function v4(t,e,n){n=n||0;const r=MK(e);for(let i=n;i<t.length;i++)if(r[0]===t[i]&&DK(r,t,i))return i;return-1}const{ImageQualityStatus:y4}=Ra;function kp(t,e,n){n||={};const r=new Uint8Array(e),i=!!n?.isPartial;if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?y4.SUBRESOLUTION:y4.FULL_RESOLUTION,pixelData:r};let{tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c}=n;if(a||=v4(r,`\r
\r
`),a===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(o=bK(r,0,a).split(`\r
`),s=_K(o),!s))throw new Error("invalid response - no boundary marker");const l=a+4,f=v4(r,s,l);if(f===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||=IK(o),n.tokenIndex=a,n.boundary=s,n.responseHeaders=o,n.multipartContentType=c,n.isPartial=f===-1,{contentType:c,extractDone:!i||f!==-1,tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c,pixelData:e.slice(l,f-2)}}function _K(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function IK(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function bK(t,e,n){e=e||0,n=n||t.length-e;let r="";for(let i=e;i<e+n;i++)r+=String.fromCharCode(t[i]);return r}const{ImageQualityStatus:T4}=Ra;function Gp(t,e=!0){return e?t.imageQualityStatus??T4.FULL_RESOLUTION:T4.SUBRESOLUTION}const{ProgressiveIterator:LK}=Ma;function VK(t,e,n={},r={}){const i=O1(),{retrieveOptions:a={},streamingData:o={}}=r,s=a.minChunkSize||128*1024,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}},l=new LK("streamRequest");return l.generate(async(f,u)=>{const g=await i.beforeSend?.(null,t,n,{}),d=Object.assign({},n,g);Object.keys(d).forEach(function(p){d[p]===null&&(d[p]=void 0),p==="Accept"&&t.indexOf("accept=")!==-1&&(d[p]=void 0)});try{const p=await fetch(t,{headers:d,signal:void 0});if(p.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${p.status}`);const h=p.body.getReader(),m=p.headers,v=m.get("content-type"),y=Number(m.get("Content-Length"));let T=!1,C=o.encodedData,w=o.lastSize||0;for(o.isPartial=!0;!T;){const{done:S,value:_}=await h.read();if(C=PK(C,_),!C){if(T)throw new Error(`Done but no image frame available ${e}`);continue}if(T=S||C.byteLength===y,!T&&C.length<w+s)continue;w=C.length,o.isPartial=!S;const D=kp(v,C,o),N=Gp(a,T),P={url:t,imageId:e,...D,percentComplete:S?100:D.pixelData?.length*100/y,imageQualityStatus:N,done:T};f.add(P,T)}}catch(p){c(),console.error(p),u(p)}}),l.getNextPromise()}function PK(t,e){if(!t)return e;if(!e)return t;const n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function NK(t){const e=t.elements.x7fe00010.fragments,n=t.byteArray.length;for(const r of e){const{position:i,length:a}=r;a>n-i&&(console.log(`Truncated fragment, changing fragment length from ${r.length} to ${n-i}`),r.length=n-i)}return t}function AK(t){let e=Rr.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let n;try{n=Rr.parseDicom(t)}catch(r){console.error(r),console.log("pixel data dataset:",r.dataSet),n=r.dataSet}return e.elements.x7fe00010=n.elements.x7fe00010,e=NK(e),e}async function rw(t,e,n){const r=AK(t),{uri:i,imageId:a,fileTotalLength:o}=n;return r.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:a,fetchedLength:t.length,lengthToFetch:o-t.length},s),{fetchedLength:l,lengthToFetch:f}=c,{arrayBuffer:u}=await e(i,a,{byteRange:`${l}-${l+f}`}),g=new Uint8Array(u),d=new Uint8Array(r.byteArray.length+g.length);return d.set(r.byteArray),d.set(g,r.byteArray.length),rw(d,e,n)},r}function FK(t,e){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i}=aw(t);if(r||n>1){const{shared:a,perFrame:o}=iw(r,i,e);return{NumberOfFrames:n,PerFrameFunctionalInformation:o,SharedFunctionalInformation:a}}return{NumberOfFrames:n}}function iw(t,e,n){const r={};(e?Object.values(e.items[0].dataSet.elements):[]).map(a=>r[a.tag]=a);const i={};return(t?Object.values(t.items[n-1].dataSet.elements):[]).map(a=>i[a.tag]=a),{shared:r,perFrame:i}}function aw(t){if(!t)return;const{elements:e,...n}=t,{x52009230:r,x52009229:i,...a}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a,otherAttributtes:n}}function UK(t,e){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a}=aw(e);if(r||n>1){const{shared:o,perFrame:s}=iw(r,i,t),c={elements:{...a,...o,...s}},l=Object.create(e);return Object.assign(l,c)}return e}let qn={};const kK=()=>{qn={}};function Bp(t){if(qn[t])return qn[t]}function GK(t){const e=Bp(t);return ow(e)}function ow(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function BK(t){return t.indexOf("&frame=")}function $K(t){const e=BK(t),n=e===-1?t:t.slice(0,e),r=parseInt(t.slice(e+7),10)||1;let i;return qn[n]?i=qn[n].dataSet:i=void 0,{dataSet:i,frame:r}}function WK(t){const e=[],n=Bp(t);if(ow(n)){const r=n.intString("x00280008");for(let i=1;i<=r;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const sw={_get:Bp,generateMultiframeWADOURIs:WK,retrieveMultiframeDataset:$K,isMultiframeDataset:GK};let M0=0,nc={};function zK(t){return qn[t]!==void 0}function HK(t){let e;if(t.includes("&frame=")){const{frame:n,dataSet:r}=sw.retrieveMultiframeDataset(t);e=UK(n,r)}else qn[t]&&(e=qn[t].dataSet);return e}function jK(t,e){const n=qn[t];if(!n){console.error(`No loaded dataSet for uri ${t}`);return}M0-=n.dataSet.byteArray.length,n.dataSet=e,M0+=e.byteArray.length,Oe(Me,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:R1()})}function KK(t,e=Up,n){if(qn[t])return new Promise(a=>{qn[t].cacheCount++,a(qn[t].dataSet)});if(nc[t])return nc[t].cacheCount++,nc[t];const r=e(t,n),i=new Promise((a,o)=>{r.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return o(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const l=new Uint8Array(s);let f;try{c.isPartialContent?f=await rw(l,e,{uri:t,imageId:n,fileTotalLength:c.fileTotalLength}):f=Rr.parseDicom(l)}catch(u){return o(u)}qn[t]={dataSet:f,cacheCount:i.cacheCount},M0+=f.byteArray.length,a(f),Oe(Me,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:R1()})},o).then(()=>{delete nc[t]},()=>{delete nc[t]})});return i.cacheCount=1,nc[t]=i,i}function qK(t){qn[t]&&(qn[t].cacheCount--,qn[t].cacheCount===0&&(M0-=qn[t].dataSet.byteArray.length,delete qn[t],Oe(Me,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:R1()})))}function R1(){return{cacheSizeInBytes:M0,numberOfDataSetsCached:Object.keys(qn).length}}function XK(){kK(),nc={},M0=0}const Ml={isLoaded:zK,load:KK,unload:qK,getInfo:R1,purge:XK,get:HK,update:jK};function YK(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=t.elements[`${r}3000`];if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:t.uint16(`${r}0010`),columns:t.uint16(`${r}0011`),type:t.string(`${r}0040`),x:t.int16(`${r}0050`,1)-1,y:t.int16(`${r}0050`,0)-1,pixelData:a,description:t.string(`${r}0022`),label:t.string(`${r}1500`),roiArea:t.string(`${r}1301`),roiMean:t.string(`${r}1302`),roiStandardDeviation:t.string(`${r}1303`)})}return{overlays:e}}function B0(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function $p(t,e){const n=t.string("x00080008");if(n){const r=n.split("\\");if(r.length>e)return r[e]}}function ZK(t){let e;if(t.string("x00080060")?.includes("NM")){const r=$p(t,2);r&&B0(r)&&t.elements.x00540022&&(e=Oa(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function JK(t){let e;if(t.string("x00080060")?.includes("NM")){const r=$p(t,2);r&&B0(r)&&t.elements.x00540022&&(e=Oa(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function C4(t){let e=Oa(t,"x00200037",6);return!e&&t.elements.x00209116?.items?.[0]?.dataSet&&(e=Oa(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=ZK(t)),e}function w4(t){let e=Oa(t,"x00200032",3);return!e&&t.elements.x00209113?.items?.[0]?.dataSet&&(e=Oa(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=JK(t)),e}function S4(t){let e=Oa(t,"x00280030",2);return!e&&t.elements.x00289110?.items?.[0]?.dataSet&&(e=Oa(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function x4(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}const cw=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function E4(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(r=>{const i=r.dataSet.double("x0018602c"),a=r.dataSet.double("x0018602e"),o=r.dataSet.uint16("x00186024"),s=r.dataSet.uint16("x00186026"),c=r.dataSet.uint16("x0018601a"),l=r.dataSet.uint16("x0018601e"),f=r.dataSet.uint16("x00186018"),u=r.dataSet.uint16("x0018601c"),g=r.dataSet.int32("x00186020")||null,d=r.dataSet.int32("x00186022")||null,p=r.dataSet.uint16("x0018602a"),h=r.dataSet.uint16("x00186028"),m=r.dataSet.uint16("x00186012"),v=r.dataSet.uint16("x00186014"),y=r.dataSet.uint16("x00186016"),T=r.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:d,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:p,referencePhysicalPixelValueX:h,regionSpatialFormat:m,regionDataType:v,regionFlags:y,transducerFrequency:T}})}function QK(t,e){const{MetadataModules:n}=Ra;if(Array.isArray(e))return;const r=E1(e);if(t===n.MULTIFRAME){const o=sw.retrieveMultiframeDataset(r.url);return o.dataSet?FK(o.dataSet,o.frame):void 0}let i=r.url;r.frame&&(i=`${i}&frame=${r.frame}`);const a=Ml.get(i);if(a)return eq(t,e,a)}function eq(t,e,n){const{MetadataModules:r}=Ra;if(t===r.GENERAL_STUDY)return{studyDescription:n.string("x00081030"),studyDate:Rr.parseDA(n.string("x00080020")),studyTime:Rr.parseTM(n.string("x00080030")||""),accessionNumber:n.string("x00080050")};if(t===r.GENERAL_SERIES)return{modality:n.string("x00080060"),seriesInstanceUID:n.string("x0020000e"),seriesDescription:n.string("x0008103e"),seriesNumber:n.intString("x00200011"),studyInstanceUID:n.string("x0020000d"),seriesDate:Rr.parseDA(n.string("x00080021")),seriesTime:Rr.parseTM(n.string("x00080031")||""),acquisitionDate:Rr.parseDA(n.string("x00080022")),acquisitionTime:Rr.parseTM(n.string("x00080032")||"")};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:n.string("x00080018"),instanceNumber:n.intString("x00200013"),lossyImageCompression:n.string("x00282110"),lossyImageCompressionRatio:n.floatString("x00282112"),lossyImageCompressionMethod:n.string("x00282114")};if(t===r.PATIENT)return{patientID:n.string("x00100020"),patientName:n.string("x00100010")};if(t===r.PATIENT_STUDY)return{patientAge:n.intString("x00101010"),patientSize:n.floatString("x00101020"),patientSex:n.string("x00100040"),patientWeight:n.floatString("x00101030")};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=n.string("x00080060"),a=$p(n,2);return{modality:i,imageType:n.string("x00080008"),imageSubType:a,imageOrientationPatient:C4(n),imagePositionPatient:w4(n),sliceThickness:x4(n),pixelSpacing:S4(n),numberOfFrames:n.uint16("x00280008"),isNMReconstructable:B0(a)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){const i=C4(n),a=w4(n),o=S4(n),s=x4(n);let c=null,l=null,f=!1;o?(l=o[0],c=o[1]):(f=!0,l=1,c=1);let u=null,g=null;return i&&(u=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],g=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:n.string("x00200052"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),imageOrientationPatient:i,rowCosines:u,columnCosines:g,imagePositionPatient:a,sliceThickness:s,sliceLocation:n.floatString("x00201041"),pixelSpacing:o,rowPixelSpacing:l,columnPixelSpacing:c,usingDefaultValues:f}}if(t===r.CINE)return{frameTime:n.floatString("x00181063")};if(t===r.IMAGE_PIXEL)return TK(n);if(t===r.VOI_LUT){const i=SK(n);return{windowCenter:Oa(n,"x00281050",1),windowWidth:Oa(n,"x00281051",1),voiLUTSequence:p4(i,n.elements.x00283010),voiLUTFunction:n.string("x00281056")}}if(t===r.MODALITY_LUT)return{rescaleIntercept:n.floatString("x00281052"),rescaleSlope:n.floatString("x00281053"),rescaleType:n.string("x00281054"),modalityLUTSequence:p4(n.uint16("x00280103"),n.elements.x00283000)};if(t===r.SOP_COMMON)return{sopClassUID:n.string("x00080016"),sopInstanceUID:n.string("x00080018")};if(t===r.PET_ISOTOPE){const i=n.elements.x00540016;if(i===void 0)return;const a=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Rr.parseTM(a.string("x00181072")||""),radionuclideTotalDose:a.floatString("x00181074"),radionuclideHalfLife:a.floatString("x00181075")}}}if(t===r.OVERLAY_PLANE)return YK(n);if(t==="transferSyntax"){let i;try{i=n.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===r.PET_SERIES)return{correctedImage:n.string("x00280051"),units:n.string("x00541001"),decayCorrection:n.string("x00541102")};if(t===r.PET_IMAGE)return{frameReferenceTime:n.floatString(n.string("x00541300")||""),actualFrameDuration:n.intString(n.string("x00181242"))};if(t===r.ULTRASOUND_ENHANCED_REGION)return E4(n);if(t===r.CALIBRATION&&n.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:E4(n)};if(t==="instance")return q2(e,cw)}let D1=[];function tq(t){return`dicomfile:${D1.push(t)-1}`}function nq(t){return D1[t]}function rq(t){D1[t]=void 0}function iq(){D1=[]}const lw={add:tq,get:nq,remove:rq,purge:iq};function aq(t){const e=t.intString("x00280008"),n=t.elements.x7fe00010;return e!==n.fragments.length}function oq(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return Rr.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(aq(t)){const l=Rr.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return Rr.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const n=t.elements.x7fe00010.fragments,r=new Rr.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=Rr.readSequenceItem(r);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";r.seek(i.length);const a=r.position;if(e+1>n.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=a+n[e].offset+8,c=n[e].length;return new Uint8Array(r.byteArray.buffer.slice(r.byteArray.byteOffset+s,r.byteArray.byteOffset+s+c))}function sq(t,e){return t&1<<e}function cq(t,e,n){const r=new Uint8Array(n);for(let i=0;i<n;i++){const a=Math.floor(i/8),o=t[a+e],s=i%8;r[i]=sq(o,s)?1:0}return r}function lq(t,e){const n=t.elements.x7fe00010||t.elements.x7fe00008,r=t.uint16("x00280100"),i=t.uint16("x00280010"),a=t.uint16("x00280011");let o=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(o=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=n.dataOffset,l=i*a*o;let f;if(r===8){if(f=c+e*l,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l))}else if(r===16){if(f=c+e*l*2,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*2))}else if(r===1){if(f=c+e*l*.125,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return cq(t.byteArray,f,l)}else if(r===32){if(f=c+e*l*4,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*4))}throw new Error("unsupported pixel format")}function uq(t){const e=E1(t),n=parseInt(e.url,10),r=lw.get(n);return new Promise((i,a)=>{const o=new FileReader;o.onload=s=>{const c=s.target.result;i(c)},o.onerror=a,o.readAsArrayBuffer(r)})}function uw(t,e=0){const n=t.elements.x7fe00010||t.elements.x7fe00008;return n?n.encapsulatedPixelData?oq(t,e):lq(t,e):null}function Wp(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}function fq(t,e,n){t.planarConfiguration===0?nw(t.pixelData,e,n):gK(t.pixelData,e,n)}function gq(t,e,n){t.planarConfiguration===0?dK(t.pixelData,e,n):hK(t.pixelData,e,n)}function dq(t,e,n){const{photometricInterpretation:r}=t;if(t.photometricInterpretation==="RGB")fq(t,e,n);else if(r==="YBR_RCT"||r==="YBR_ICT"||r==="YBR_PARTIAL_420")nw(t.pixelData,e,n);else if(t.photometricInterpretation==="PALETTE COLOR")mK(t,e,n);else if(t.photometricInterpretation==="YBR_FULL_422")pK(t.pixelData,e,n);else if(t.photometricInterpretation==="YBR_FULL")gq(t,e,n);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function hq(t){if(t===void 0)return!1;const{rows:e,columns:n,photometricInterpretation:r,pixelDataLength:i,planarConfiguration:a}=t;return i===4*n*e?!1:r==="PALETTE COLOR"?!0:r.endsWith("420")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*e:r.endsWith("422")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*Math.ceil(e/2)+Math.floor(e/2)*n:r!=="RGB"||a===1}function pq(t){return mq(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function mq(t){let e;try{return decodeURIComponent(escape(t))}catch(n){if(e=n,e instanceof URIError)return t;throw e}}function vq(t,e,n){const r=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((a,o)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){n.height=c.height,n.width=c.width,t.rows=c.height,t.columns=c.width;const l=n.getContext("2d");l.drawImage(this,0,0);const f=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(f.data.buffer),t.imageData=f,t.decodeTimeInMS=u-r;const g=Wp(t.pixelData);t.smallestPixelValue=g.min,t.largestPixelValue=g.max,t.pixelDataLength=t.pixelData.length,a(t)},c.onerror=function(l){o(l)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(pq(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{o(c)}})}function Xr(t,e,n,r,i){const a={...r};delete a.loader,delete a.streamingData;const o=tv(),s=a.priority||void 0;return a.transferPixelData&&n.buffer,o.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:n,options:a,decodeConfig:i},{priority:s,requestType:a?.requestType})}function yq(t,e,n,r,i={},a){switch(e){case"1.2.840.10008.1.2":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.1":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.2":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.1.99":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.5":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?vq(t,n,r):Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.51":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.57":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.70":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.80":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.81":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.90":return Xr(t,e,n,i,a);case"1.2.840.10008.1.2.4.91":return Xr(t,e,n,i,a);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return Xr(t,e,n,i,a)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function Tq(t){const e=Pe("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function Cq(t,e){const n=t.get("modalityLutModule",e)||{},r=t.get("generalSeriesModule",e)||{},{modality:i}=r,a={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:i},o=t.get("scalingModule",e)||{};return{...a,...i==="PT"&&{suvbw:o.suvbw},...i==="RTDOSE"&&{doseGridScaling:o.DoseGridScaling,doseSummation:o.DoseSummation,doseType:o.DoseType,doseUnit:o.DoseUnit}}}function fw(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}function wq(t,e){const n=t.length/4;let r=0,i=0;for(let a=0;a<n;a++)e[i++]=t[r++],e[i++]=t[r++],e[i++]=t[r++],r++;return e}function Sq(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function zp(t,e){let n;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?n=Uint8Array:e<=65535?n=Uint16Array:e<=4294967295&&(n=Uint32Array):t>=-128&&e<=127?n=Int8Array:t>=-32768&&e<=32767&&(n=Int16Array)),n||Float32Array}function xq(t,e,n){return zp(t,e)===n}function Eq(t){const e=t.smallestPixelValue,n=t.largestPixelValue,r=zp(e,n);if(r){const i=new r(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}let O4="";function Hp(t,e,n,r={}){const i=r.useRGBA;if(r.preScale={enabled:r.preScale&&r.preScale.enabled!==void 0?r.preScale.enabled:!0},!e?.length)return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:a}=Ra,o=document.createElement("canvas"),s=Tq(t);if(s.decodeLevel=r.decodeLevel,r.allowFloatRendering=Wh(),r.preScale.enabled){const u=Cq(yA,t);u&&(r.preScale={...r.preScale,scalingParameters:u})}const{decodeConfig:c}=O1();Object.keys(s).forEach(u=>{(typeof s[u]=="function"||s[u]instanceof Promise)&&delete s[u]});const l=yq(s,n,e,o,r,c),f=fw(s.photometricInterpretation);return new Promise((u,g)=>{l.then(function(d){let p=!1;if(r.targetBuffer&&r.targetBuffer.type&&!f){const{arrayBuffer:N,type:P,offset:F=0,length:B}=r.targetBuffer,k=d.pixelDataLength,U=F,H=B??k-U,W={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};if(H!==d.pixelDataLength)throw new Error(`target array for image does not have the same length (${H}) as the decoded image length (${d.pixelDataLength}).`);const J=W[P],ne=N?new J(N,U,H):new J(d.pixelData);if(H!==d.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");d.pixelData=ne,p=!0}p||Eq(d);const h=Pe(a.IMAGE_PLANE,t)||{},m=Pe(a.VOI_LUT,t)||{},v=Pe(a.MODALITY_LUT,t)||{},y=Pe(a.SOP_COMMON,t)||{},T=Pe(a.CALIBRATION,t)||{},{rows:C,columns:w}=d;if(f){if(hq(d)){o.height=d.rows,o.width=d.columns;let F=o.getContext("2d").createImageData(d.columns,d.rows);i||(F={...F,data:new Uint8ClampedArray(3*d.columns*d.rows)}),dq(d,F.data,i),d.imageData=F,d.pixelData=F.data,d.pixelDataLength=F.data.length}else if(!i&&d.pixelDataLength===4*C*w){const P=new Uint8Array(d.pixelData.length/4*3);d.pixelData=wq(d.pixelData,P),d.pixelDataLength=d.pixelData.length}const N=Wp(d.pixelData);d.smallestPixelValue=N.min,d.largestPixelValue=N.max}let S=d.samplesPerPixel;d.photometricInterpretation==="PALETTE COLOR"&&(S=i?4:3);const _=en.createImageVoxelManager({scalarData:d.pixelData,width:d.columns,height:d.rows,numberOfComponents:S}),D={imageId:t,dataType:d.pixelData.constructor.name,color:f,calibration:T,columnPixelSpacing:h.columnPixelSpacing,columns:d.columns,height:d.rows,preScale:d.preScale,intercept:v.rescaleIntercept?v.rescaleIntercept:0,slope:v.rescaleSlope?v.rescaleSlope:1,invert:d.photometricInterpretation==="MONOCHROME1",minPixelValue:d.smallestPixelValue,maxPixelValue:d.largestPixelValue,rowPixelSpacing:h.rowPixelSpacing,rows:d.rows,sizeInBytes:d.pixelData.byteLength,width:d.columns,windowCenter:m.windowCenter?m.windowCenter[0]:void 0,windowWidth:m.windowWidth?m.windowWidth[0]:void 0,voiLUTFunction:m.voiLUTFunction?m.voiLUTFunction:void 0,decodeTimeInMS:d.decodeTimeInMS,floatPixelData:void 0,imageFrame:d,voxelManager:_,rgba:f&&i,getPixelData:()=>d.pixelData,getCanvas:void 0,numberOfComponents:S};if(D.color&&(D.getCanvas=function(){if(O4===t)return o;const N=D.columns,P=D.rows;o.height=P,o.width=N;const F=o.getContext("2d"),B=F.createImageData(N,P),k=d.pixelData;if(k.length===N*P*4)for(let U=0;U<k.length;U++)B.data[U]=k[U];else if(k.length===N*P*3){let U=0;for(let H=0;H<k.length;H+=3)B.data[U++]=k[H],B.data[U++]=k[H+1],B.data[U++]=k[H+2],B.data[U++]=255}return d.pixelData=B.data,d.pixelDataLength=B.data.length,d.imageData=B,F.putImageData(d.imageData,0,0),O4=t,o}),v.modalityLUTSequence&&v.modalityLUTSequence.length>0&&Sq(y.sopClassUID)&&(D.modalityLUT=v.modalityLUTSequence[0]),m.voiLUTSequence&&m.voiLUTSequence.length>0&&(D.voiLUT=m.voiLUTSequence[0]),D.color&&(D.windowWidth=256,D.windowCenter=128),D.windowCenter===void 0||D.windowWidth===void 0){const N=iu(D.imageFrame.smallestPixelValue,D.imageFrame.largestPixelValue);D.windowWidth=N.windowWidth,D.windowCenter=N.windowCenter}u(D)},g)})}const{ImageQualityStatus:gw}=Ra;function Oq(t,e){t.decache=function(){const n=E1(e);Ml.unload(n.url)}}function Rq(t,e,n=0,r,i,a){const o=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,l)=>{t.then(f=>{const u=uw(f,n),g=f.string("x00020010"),d=new Date().getTime(),p=Hp(e,u,g,i);Oq(s,e),p.then(h=>{h=h,h.data=f,h.sharedCacheKey=r;const m=new Date().getTime();h.loadTimeInMS=d-o,h.totalTimeInMS=m-o,h.imageQualityStatus=gw.FULL_RESOLUTION,a!==void 0&&a.imageDoneCallback!==void 0&&a.imageDoneCallback(h),c(h)},function(h){l({error:h,dataSet:f})})},function(f){l({error:f})})}),s}function Dq(t,e,n=0,r,i){const a=new Date().getTime();return{promise:new Promise((s,c)=>{const l=new Date().getTime();let f;try{const u=uw(t,n),g=t.string("x00020010");f=Hp(e,u,g,i)}catch(u){c({error:u,dataSet:t});return}f.then(u=>{u=u,u.data=t;const g=new Date().getTime();u.loadTimeInMS=l-a,u.totalTimeInMS=g-a,u.imageQualityStatus=gw.FULL_RESOLUTION,s(u)},c)}),cancelFn:void 0}}function Mq(t){if(t==="dicomweb"||t==="wadouri")return Up;if(t==="dicomfile")return uq}function Ud(t,e={}){const n=E1(t);e=Object.assign({},e),delete e.loader;const r=Mq(n.scheme);if(Ml.isLoaded(n.url)){const a=Ml.get(n.url,r,t);return Dq(a,t,n.pixelDataFrame,n.url,e)}const i=Ml.load(n.url,r,t);return Rq(i,t,n.frame,n.url,e)}function _q(){wf("dicomweb",Ud),wf("wadouri",Ud),wf("dicomfile",Ud),P0(QK)}const Iq={fileManager:lw};function it(t,e,n){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?n:t.Value[e]}function Nt(t,e){const n=it(t,e);if(n!==void 0)return parseFloat(n)}function Nr(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const n=[];for(let r=0;r<t.Value.length;r++)n.push(parseFloat(t.Value[r]));return n}function bq(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=it(t[`${r}3000`]);if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:Nt(t[`${r}0010`]),columns:Nt(t[`${r}0011`]),type:it(t[`${r}0040`]),x:Nt(t[`${r}0050`],1)-1,y:Nt(t[`${r}0050`],0)-1,pixelData:a,description:it(t[`${r}0022`]),label:it(t[`${r}1500`]),roiArea:it(t[`${r}1301`]),roiMean:it(t[`${r}1302`]),roiStandardDeviation:it(t[`${r}1303`])})}return{overlays:e}}function M1(t){const e=t.indexOf(":");return t.substring(e+1)}function g0(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function dw(t,e,n){const r=(e?Object.values(e[0]):[]).map(a=>a.Value?.[0]).filter(a=>a!==void 0&&typeof a=="object"),i=(t?Object.values(t[n-1]):[]).map(a=>a.Value?.[0]).filter(a=>a!==void 0&&typeof a=="object");return{shared:r,perFrame:i}}function hw(t){let{52009230:e,52009229:n,"00280008":r,...i}=t;return e=g0(e,!1),n=g0(n,!1),r=g0(r),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:n,NumberOfFrames:r,rest:i}}function Lq(t,e){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:r,NumberOfFrames:i,rest:a}=hw(e);if(n||i>1){const{shared:o,perFrame:s}=dw(n,r,t),c=Object.assign(e,{frameNumber:t});return[...o,...s].forEach(l=>{Object.entries(l).forEach(([f,u])=>{c[f]=u})}),Object.assign(a,{"00280008":i},c)}return e}let yu=[],bg={};function pw(t){const e=t.indexOf("/frames/")+8,n=t.slice(0,e),r=parseInt(t.slice(e),10);return{metadata:yu[`${n}1`],frame:r}}function Vq(t){const e=M1(t);return pw(e)}function Pq(t){if(t[52009230]!==void 0||t[52009229]!==void 0)return!0;const e=it(t["00280008"]);return e&&e>1}function Nq(t,e){const n=M1(t);Object.defineProperty(e,"isMultiframe",{value:Pq(e),enumerable:!1}),yu[n]=e}function Aq(t){const e=M1(t),n=yu[e];if(n&&!n?.isMultiframe)return n;const r=bg[e];if(r)return r;const i=pw(e);if(!i||!i.metadata)return;const{metadata:a,frame:o}=i;if(a){const s=Lq(o,a);return bg[e]=s,s}}function Fq(t){const e=M1(t);yu[e]=void 0,bg[e]=void 0}function Uq(){yu=[],bg={}}const mw={add:Nq,get:Aq,remove:Fq,purge:Uq};function vw(t){return it(t["00080060"]).includes("NM")}function jp(t,e){const n=g0(t["00080008"],!1);if(n)return n[e]}function kq(t){let e;const n=jp(t,2);if(n&&B0(n)){const r=g0(t["00540022"]);r&&(e=Nr(r["00200037"],6))}return e}function Gq(t){let e;const n=jp(t,2);if(n&&B0(n)){const r=g0(t["00540022"]);r&&(e=Nr(r["00200032"],3))}return e}function R4(t){let e=Nr(t["00200037"],6);return!e&&vw(t)&&(e=kq(t)),e}function D4(t){let e=Nr(t["00200032"],3);return!e&&vw(t)&&(e=Gq(t)),e}function Sr(t,e){const n=Nr(t[e]);return n?n[0]:null}function Bq(t){return t?.Value?.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function M4(t){const e=Bq(t["00186011"]);return!e||!e.length?null:e.map(r=>{const i=Sr(r,"0018602C"),a=Sr(r,"0018602E"),o=Sr(r,"00186024"),s=Sr(r,"00186026"),c=Sr(r,"0018601A"),l=Sr(r,"0018601E"),f=Sr(r,"00186018"),u=Sr(r,"0018601C"),g=Sr(r,"00186020"),d=Sr(r,"00186022"),p=Sr(r,"0018602A"),h=Sr(r,"00186028"),m=Sr(r,"00186012"),v=Sr(r,"00186014"),y=Sr(r,"00186016"),T=Sr(r,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:d,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:p,referencePhysicalPixelValueX:h,regionSpatialFormat:m,regionDataType:v,regionFlags:y,transducerFrequency:T}})}function $q(t,e){const{MetadataModules:n}=Ra;if(t===n.MULTIFRAME){const{metadata:i,frame:a}=Vq(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=hw(i);if(o||c>1){const{shared:l,perFrame:f}=dw(o,s,a);return{NumberOfFrames:c,PerFrameFunctionalInformation:f,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const r=mw.get(e);if(r){if(t===n.GENERAL_STUDY)return{studyDescription:it(r["00081030"]),studyDate:it(r["00080020"]),studyTime:it(r["00080030"]),accessionNumber:it(r["00080050"])};if(t===n.GENERAL_SERIES)return{modality:it(r["00080060"]),seriesInstanceUID:it(r["0020000E"]),seriesDescription:it(r["0008103E"]),seriesNumber:Nt(r["00200011"]),studyInstanceUID:it(r["0020000D"]),seriesDate:it(r["00080021"]),seriesTime:it(r["00080031"]),acquisitionDate:it(r["00080022"]),acquisitionTime:it(r["00080032"])};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:it(r["00080018"]),instanceNumber:Nt(r["00200013"]),lossyImageCompression:it(r["00282110"]),lossyImageCompressionRatio:Nt(r["00282112"]),lossyImageCompressionMethod:it(r["00282114"])};if(t===n.PATIENT)return{patientID:it(r["00100020"]),patientName:it(r["00100010"])};if(t===n.PATIENT_STUDY)return{patientAge:Nt(r["00101010"]),patientSize:Nt(r["00101020"]),patientSex:it(r["00100040"]),patientWeight:Nt(r["00101030"])};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=it(r["00080060"]),a=jp(r,2);return{modality:i,imageType:it(r["00080008"]),imageSubType:a,imageOrientationPatient:R4(r),imagePositionPatient:D4(r),sliceThickness:Nt(r["00180050"]),spacingBetweenSlices:Nt(r["00180088"]),pixelSpacing:Nr(r["00280030"],2),numberOfFrames:Nt(r["00280008"]),isNMReconstructable:B0(a)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){let i=R4(r),a=D4(r);const o=Nr(r["00280030"],2);let s=null,c=null,l=null,f=null,u=!1;return o?(c=o[0],s=o[1]):(u=!0,c=1,s=1),i?(l=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],f=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(l=[1,0,0],f=[0,1,0],u=!0,i=[...l,...f]),a||(a=[0,0,0],u=!0),{frameOfReferenceUID:it(r["00200052"]),rows:Nt(r["00280010"]),columns:Nt(r["00280011"]),imageOrientationPatient:i,rowCosines:l,columnCosines:f,imagePositionPatient:a,sliceThickness:Nt(r["00180050"]),sliceLocation:Nt(r["00201041"]),pixelSpacing:o,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:u}}if(t===n.ULTRASOUND_ENHANCED_REGION)return M4(r);if(t===n.CALIBRATION&&it(r["00080060"])==="US")return{sequenceOfUltrasoundRegions:M4(r)};if(t===n.IMAGE_URL)return Wq(e,r);if(t===n.CINE)return zq(e,r);if(t===n.IMAGE_PIXEL)return{samplesPerPixel:Nt(r["00280002"]),photometricInterpretation:it(r["00280004"]),rows:Nt(r["00280010"]),columns:Nt(r["00280011"]),bitsAllocated:Nt(r["00280100"]),bitsStored:Nt(r["00280101"]),highBit:it(r["00280102"]),pixelRepresentation:Nt(r["00280103"]),planarConfiguration:Nt(r["00280006"]),pixelAspectRatio:it(r["00280034"]),smallestPixelValue:Nt(r["00280106"]),largestPixelValue:Nt(r["00280107"]),redPaletteColorLookupTableDescriptor:Nr(r["00281101"]),greenPaletteColorLookupTableDescriptor:Nr(r["00281102"]),bluePaletteColorLookupTableDescriptor:Nr(r["00281103"]),redPaletteColorLookupTableData:Nr(r["00281201"]),greenPaletteColorLookupTableData:Nr(r["00281202"]),bluePaletteColorLookupTableData:Nr(r["00281203"])};if(t===n.VOI_LUT)return{windowCenter:Nr(r["00281050"],1),windowWidth:Nr(r["00281051"],1),voiLUTFunction:it(r["00281056"])};if(t===n.MODALITY_LUT)return{rescaleIntercept:Nt(r["00281052"]),rescaleSlope:Nt(r["00281053"]),rescaleType:it(r["00281054"])};if(t===n.SOP_COMMON)return{sopClassUID:it(r["00080016"]),sopInstanceUID:it(r["00080018"])};if(t===n.PET_ISOTOPE){const i=it(r["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:it(i["00181072"],0,""),radiopharmaceuticalStartDateTime:it(i["00181078"],0,""),radionuclideTotalDose:Nt(i["00181074"]),radionuclideHalfLife:Nt(i["00181075"])}}}if(t===n.OVERLAY_PLANE)return bq(r);if(t==="transferSyntax")return yw(e,r);if(t===n.PET_SERIES){let i=r["00280051"],a=it(r["00280051"]);return i&&i.Value&&Array.isArray(i.Value)&&(a=i.Value.join("\\")),{correctedImage:a,units:it(r["00541001"]),decayCorrection:it(r["00541102"])}}if(t===n.PET_IMAGE)return{frameReferenceTime:Nt(r["00541300"]),actualFrameDuration:Nt(r["00181242"])};if(t==="instance")return q2(e,cw)}}function Wq(t,e){const{transferSyntaxUID:n}=yw(t,e),r=b7(n),i=t.substring(7),a=i.replace("/frames/","/thumbnail/");let o=i.replace("/frames/","/rendered/");return r&&(o=o.replace("/rendered/1","/rendered")),{isVideo:r,rendered:o,thumbnail:a}}function zq(t,e){return{cineRate:it(e["00180040"]),numberOfFrames:Nt(e["00280008"])}}function yw(t,e){return{transferSyntaxUID:it(e["00020010"])||it(e["00083002"])}}function Hq(t,e,n={},r={}){const i=O1(),{retrieveOptions:a={},streamingData:o}=r,s=o.chunkSize||Kq(e,a,"chunkSize")||65536,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}else console.warn("rangeRequest:Caught",f)};return new Promise(async(f,u)=>{const g=Object.assign({},n);Object.keys(g).forEach(function(d){(g[d]===null||g[d]===void 0)&&delete g[d]});try{o.encodedData||(o.chunkSize=s,o.rangesFetched=0);const d=qq(o,a),{encodedData:p,responseHeaders:h}=await jq(t,g,d,o),m=h.get("content-type"),{totalBytes:v}=o,y=v===p.byteLength,T=kp(m,p,{isPartial:!0}),C=Gp(a,y||T.extractDone===!0);f({...T,imageQualityStatus:C,percentComplete:T.extractDone?100:p.byteLength*100/v})}catch(d){c(d),console.error(d),u(d)}})}async function jq(t,e,n,r){n&&(e=Object.assign(e,{Range:`bytes=${n[0]}-${n[1]}`}));let{encodedData:i}=r;if(n[1]&&i?.byteLength>n[1])return r;const a=await fetch(t,{headers:e,signal:void 0}),o=await a.arrayBuffer(),s=new Uint8Array(o),{status:c}=a;let l;i?(l=new Uint8Array(i.length+s.length),l.set(i,0),l.set(s,i.length),r.rangesFetched=1):(l=new Uint8Array(s.length),l.set(s,0),r.rangesFetched++),r.encodedData=i=l,r.responseHeaders=a.headers;const f=a.headers.get("Content-Range");return f?r.totalBytes=Number(f.split("/")[1]):c!==206||!n?r.totalBytes=i?.byteLength:n[1]===""||i?.length<n[1]?r.totalBytes=i.byteLength:r.totalBytes=Number.MAX_SAFE_INTEGER,r}function Kq(t,e,n){const r=e[n];if(typeof r!="function")return r;const i=mw.get(t);return r(i,t)}function qq(t,e){const{totalBytes:n,encodedData:r,chunkSize:i=65536}=t,{rangeIndex:a=0}=e;return a===-1&&(!n||!r)?[0,""]:a===-1||r?.byteLength>n-i?[r?.byteLength||0,""]:[r?.byteLength||0,i*(a+1)-1]}function Xq(t,e,n="application/octet-stream",r){const{streamingData:i,retrieveOptions:a={}}=r||{},o={Accept:n};let s=a.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${a.urlArguments}`:t;if(a.framesPath&&(s=s.replace("/frames/",a.framesPath)),i?.url!==s&&(r.streamingData={url:s}),a.rangeIndex!==void 0)return Hq(s,e,o,r);if(a.streaming)return VK(s,e,o,r);const c=Up(s,e,o),{xhr:l}=c;return c.then(function(f){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",g=kp(u,new Uint8Array(f));return g.imageQualityStatus=Gp(a,!0),g})}const{ProgressiveIterator:_4}=Ma,{ImageQualityStatus:I4}=Ra,Yq=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function Zq(t){const e="1.2.840.10008.1.2";if(!t)return e;const n=t.split(";"),r={};n.forEach(a=>{const o=a.split("=");if(o.length!==2)return;const s=o[1].trim().replace(/"/g,"");r[o[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:t&&!Object.keys(r).length&&i[t]?i[t]:r.type&&i[r.type]?i[r.type]:i[t]?i[t]:e}function Jq(){return gu}const Qq="multipart/related; type=application/octet-stream; transfer-syntax=*";function eX(t,e={}){const n=Jq(),r=new Date().getTime(),i=new _4("decompress");async function a(f,u,g){i.generate(async d=>{const p=_4.as(Xq(f,u,g,e));let h=10;for await(const m of p){const{pixelData:v,imageQualityStatus:y=I4.FULL_RESOLUTION,percentComplete:T,done:C=!0,extractDone:w=!0}=m,S=Zq(m.contentType);if(!w&&!Yq.has(S))continue;const _=m.decodeLevel??(y===I4.FULL_RESOLUTION?0:tX(T,e.retrieveOptions?.decodeLevel));if(!(!C&&h<=_))try{const D={...e,decodeLevel:_},N=await Hp(u,v,S,D),P=new Date().getTime();N.loadTimeInMS=P-r,N.transferSyntaxUID=S,N.imageQualityStatus=y,d.add(N,C),h=_}catch(D){if(w)throw console.warn("Couldn't decode",D),D}}})}const o=e.requestType||gt.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return n.addRequest(a.bind(this,l,t,Qq),o,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function tX(t,e=4){const n=t/100-.02;return n>1/4?Math.min(e,0):n>1/16?Math.min(e,1):n>1/64?Math.min(e,2):Math.min(e,3)}function nX(){wf("wadors",eX),P0($q)}function rX(){nX(),_q()}const iX=()=>new Worker(new URL("/radiology-ai-viewer/assets/decodeImageFrameWorker-C6Q2UkgP.js",import.meta.url),{type:"module"});function aX(t={}){RK(t),rX();const e=tv(),n=t?.maxWebWorkers||oX();e.registerWorker("dicomImageLoader",iX,{maxWorkerInstances:n})}function oX(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function sX(t,e){const{rows:n,columns:r,data:i}=t,{rows:a,columns:o,data:s}=e,c=[],l=[],f=[];for(let u=0;u<o;u++){const g=u*(r-1)/(o-1);c[u]=Math.floor(g),l[u]=Math.min(c[u]+1,r-1),f[u]=g-c[u]}for(let u=0;u<a;u++){const g=u*(n-1)/(a-1),d=Math.floor(g)*r,p=Math.min(d+r,(n-1)*r),h=g-Math.floor(g),m=1-h,v=u*o;for(let y=0;y<o;y++){const T=i[d+c[y]],C=i[d+l[y]],w=i[p+c[y]],S=i[p+l[y]],_=1-f[y];s[v+y]=(T*_+C*f[y])*m+(w*_+S*f[y])*h}}return s}function cX(t,e){const{rows:n,columns:r,pixelData:i,samplesPerPixel:a=1}=t,{rows:o,columns:s,pixelData:c}=e,l=[];for(let f=0;f<s;f++){const u=f*(r-1)/(s-1);l[f]=Math.floor(u)*a}for(let f=0;f<o;f++){const u=f*(n-1)/(o-1),g=Math.floor(u)*r*a,d=f*s;for(let p=0;p<s;p++)for(let h=0;h<a;h++)c[d+p+h]=i[g+l[p]+h]}return c}async function b4(t,e){let n=e.buffer,r=e.byteOffset;const i=e.length;if(t.bitsAllocated===16)r%2&&(n=n.slice(r),r=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(n,r,i/2):t.pixelData=new Int16Array(n,r,i/2);else if(t.bitsAllocated===8||t.bitsAllocated===1)t.pixelData=e;else if(t.bitsAllocated===32){if(r%2&&(n=n.slice(r),r=0),t.floatPixelData||t.doubleFloatPixelData)throw new Error("Float pixel data is not supported for parsing into ImageFrame");t.pixelRepresentation===0?t.pixelData=new Uint32Array(n,r,i/4):t.pixelRepresentation===1?t.pixelData=new Int32Array(n,r,i/4):t.pixelData=new Float32Array(n,r,i/4)}return t}function lX(t){return(t&255)<<8|t>>8&255}async function uX(t,e){if(t.bitsAllocated===16){let n=e.buffer,r=e.byteOffset;const i=e.length;r%2&&(n=n.slice(r),r=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(n,r,i/2):t.pixelData=new Int16Array(n,r,i/2);for(let a=0;a<t.pixelData.length;a++)t.pixelData[a]=lX(t.pixelData[a])}else t.bitsAllocated===8&&(t.pixelData=e);return t}async function fX(t,e){if(t.bitsAllocated===8)return t.planarConfiguration?dX(t,e):gX(t,e);if(t.bitsAllocated===16)return hX(t,e);throw new Error("unsupported pixel format for RLE")}function gX(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let c=0;const l=a.getInt32(0,!0);for(let f=0;f<l;++f){c=f;let u=a.getInt32((f+1)*4,!0),g=a.getInt32((f+2)*4,!0);g===0&&(g=n.length);const d=r*l;for(;u<g;){const p=o[u++];if(p>=0&&p<=127)for(let h=0;h<p+1&&c<d;++h)s[c]=o[u++],c+=t.samplesPerPixel;else if(p<=-1&&p>=-127){const h=o[u++];for(let m=0;m<-p+1&&c<d;++m)s[c]=h,c+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(i),t}function dX(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i);let c=0;const l=a.getInt32(0,!0);for(let f=0;f<l;++f){c=f*r;let u=a.getInt32((f+1)*4,!0),g=a.getInt32((f+2)*4,!0);g===0&&(g=n.length);const d=r*l;for(;u<g;){const p=o[u++];if(p>=0&&p<=127)for(let h=0;h<p+1&&c<d;++h)s[c]=o[u++],c++;else if(p<=-1&&p>=-127){const h=o[u++];for(let m=0;m<-p+1&&c<d;++m)s[c]=h,c++}}}return t.pixelData=new Uint8Array(i),t}function hX(t,e){const n=e,r=t.rows*t.columns,i=new ArrayBuffer(r*t.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),c=a.getInt32(0,!0);for(let l=0;l<c;++l){let f=0;const u=l===0?1:0;let g=a.getInt32((l+1)*4,!0),d=a.getInt32((l+2)*4,!0);for(d===0&&(d=n.length);g<d;){const p=o[g++];if(p>=0&&p<=127)for(let h=0;h<p+1&&f<r;++h)s[f*2+u]=o[g++],f++;else if(p<=-1&&p>=-127){const h=o[g++];for(let m=0;m<-p+1&&f<r;++m)s[f*2+u]=h,f++}}}return t.pixelRepresentation===0?t.pixelData=new Uint16Array(i):t.pixelData=new Int16Array(i),t}var kd={exports:{}},L4;function pX(){return L4||(L4=1,(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),(function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(x,E){o=x,s=E});var c=Object.assign({},a),l="./this.program",f=(x,E)=>{throw E},u=typeof window=="object",g=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",p="";function h(x){return a.locateFile?a.locateFile(x,p):p+x}var m,v,y;if(d){var T=ho,C=ho;g?p=C.dirname(p)+"/":p=__dirname+"/",m=(x,E)=>(x=K(x)?new URL(x):C.normalize(x),T.readFileSync(x,E?void 0:"utf8")),y=x=>{var E=m(x,!0);return E.buffer||(E=new Uint8Array(E)),E},v=(x,E,b)=>{x=K(x)?new URL(x):C.normalize(x),T.readFile(x,function(G,X){G?b(G):E(X.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(x){if(!(x instanceof St))throw x}),process.on("unhandledRejection",function(x){throw x}),f=(x,E)=>{throw process.exitCode=x,E},a.inspect=function(){return"[Emscripten Module object]"}}else(u||g)&&(g?p=self.location.href:typeof document<"u"&&document.currentScript&&(p=document.currentScript.src),r&&(p=r),p.indexOf("blob:")!==0?p=p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1):p="",m=x=>{var E=new XMLHttpRequest;return E.open("GET",x,!1),E.send(null),E.responseText},g&&(y=x=>{var E=new XMLHttpRequest;return E.open("GET",x,!1),E.responseType="arraybuffer",E.send(null),new Uint8Array(E.response)}),v=(x,E,b)=>{var G=new XMLHttpRequest;G.open("GET",x,!0),G.responseType="arraybuffer",G.onload=()=>{if(G.status==200||G.status==0&&G.response){E(G.response);return}b()},G.onerror=b,G.send(null)});var w=a.print||console.log.bind(console),S=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&(l=a.thisProgram),a.quit&&(f=a.quit);var _;a.wasmBinary&&(_=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&$("no native wasm support detected");var D,N=!1;function P(x,E){x||$(E)}var F=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function B(x,E,b){for(var G=E+b,X=E;x[X]&&!(X>=G);)++X;if(X-E>16&&x.buffer&&F)return F.decode(x.subarray(E,X));for(var Z="";E<X;){var ee=x[E++];if(!(ee&128)){Z+=String.fromCharCode(ee);continue}var ie=x[E++]&63;if((ee&224)==192){Z+=String.fromCharCode((ee&31)<<6|ie);continue}var le=x[E++]&63;if((ee&240)==224?ee=(ee&15)<<12|ie<<6|le:ee=(ee&7)<<18|ie<<12|le<<6|x[E++]&63,ee<65536)Z+=String.fromCharCode(ee);else{var Ce=ee-65536;Z+=String.fromCharCode(55296|Ce>>10,56320|Ce&1023)}}return Z}function k(x,E){return x?B(q,x,E):""}function U(x,E,b,G){if(!(G>0))return 0;for(var X=b,Z=b+G-1,ee=0;ee<x.length;++ee){var ie=x.charCodeAt(ee);if(ie>=55296&&ie<=57343){var le=x.charCodeAt(++ee);ie=65536+((ie&1023)<<10)|le&1023}if(ie<=127){if(b>=Z)break;E[b++]=ie}else if(ie<=2047){if(b+1>=Z)break;E[b++]=192|ie>>6,E[b++]=128|ie&63}else if(ie<=65535){if(b+2>=Z)break;E[b++]=224|ie>>12,E[b++]=128|ie>>6&63,E[b++]=128|ie&63}else{if(b+3>=Z)break;E[b++]=240|ie>>18,E[b++]=128|ie>>12&63,E[b++]=128|ie>>6&63,E[b++]=128|ie&63}}return E[b]=0,b-X}function H(x,E,b){return U(x,q,E,b)}function W(x){for(var E=0,b=0;b<x.length;++b){var G=x.charCodeAt(b);G<=127?E++:G<=2047?E+=2:G>=55296&&G<=57343?(E+=4,++b):E+=3}return E}var J,ne,q,Q,ae,me,de,je,$e;function Be(x){J=x,a.HEAP8=ne=new Int8Array(x),a.HEAP16=Q=new Int16Array(x),a.HEAP32=me=new Int32Array(x),a.HEAPU8=q=new Uint8Array(x),a.HEAPU16=ae=new Uint16Array(x),a.HEAPU32=de=new Uint32Array(x),a.HEAPF32=je=new Float32Array(x),a.HEAPF64=$e=new Float64Array(x)}a.INITIAL_MEMORY;var qe,Qe=[],ut=[],ke=[];function Xe(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Zt(a.preRun.shift());kt(Qe)}function et(){kt(ut)}function $t(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Jt(a.postRun.shift());kt(ke)}function Zt(x){Qe.unshift(x)}function Kt(x){ut.unshift(x)}function Jt(x){ke.unshift(x)}var qt=0,on=null;function tn(x){qt++,a.monitorRunDependencies&&a.monitorRunDependencies(qt)}function ir(x){if(qt--,a.monitorRunDependencies&&a.monitorRunDependencies(qt),qt==0&&on){var E=on;on=null,E()}}function $(x){a.onAbort&&a.onAbort(x),x="Aborted("+x+")",S(x),N=!0,x+=". Build with -sASSERTIONS for more info.";var E=new WebAssembly.RuntimeError(x);throw s(E),E}var j="data:application/octet-stream;base64,";function re(x){return x.startsWith(j)}function K(x){return x.startsWith("file://")}var oe;oe="libjpegturbowasm_decode.wasm",re(oe)||(oe=h(oe));function we(x){try{if(x==oe&&_)return new Uint8Array(_);if(y)return y(x);throw"both async and sync fetching of the wasm failed"}catch(E){$(E)}}function Ae(){if(!_&&(u||g)){if(typeof fetch=="function"&&!K(oe))return fetch(oe,{credentials:"same-origin"}).then(function(x){if(!x.ok)throw"failed to load wasm binary file at '"+oe+"'";return x.arrayBuffer()}).catch(function(){return we(oe)});if(v)return new Promise(function(x,E){v(oe,function(b){x(new Uint8Array(b))},E)})}return Promise.resolve().then(function(){return we(oe)})}function st(){var x={a:pe};function E(ee,ie){var le=ee.exports;a.asm=le,D=a.asm.K,Be(D.buffer),qe=a.asm.M,Kt(a.asm.L),ir()}tn();function b(ee){E(ee.instance)}function G(ee){return Ae().then(function(ie){return WebAssembly.instantiate(ie,x)}).then(function(ie){return ie}).then(ee,function(ie){S("failed to asynchronously prepare wasm: "+ie),$(ie)})}function X(){return!_&&typeof WebAssembly.instantiateStreaming=="function"&&!re(oe)&&!K(oe)&&!d&&typeof fetch=="function"?fetch(oe,{credentials:"same-origin"}).then(function(ee){var ie=WebAssembly.instantiateStreaming(ee,x);return ie.then(b,function(le){return S("wasm streaming compile failed: "+le),S("falling back to ArrayBuffer instantiation"),G(b)})}):G(b)}if(a.instantiateWasm)try{var Z=a.instantiateWasm(x,E);return Z}catch(ee){S("Module.instantiateWasm callback failed with error: "+ee),s(ee)}return X().catch(s),{}}function St(x){this.name="ExitStatus",this.message="Program terminated with exit("+x+")",this.status=x}function kt(x){for(;x.length>0;)x.shift()(a)}function _t(x){this.excPtr=x,this.ptr=x-24,this.set_type=function(E){de[this.ptr+4>>2]=E},this.get_type=function(){return de[this.ptr+4>>2]},this.set_destructor=function(E){de[this.ptr+8>>2]=E},this.get_destructor=function(){return de[this.ptr+8>>2]},this.set_refcount=function(E){me[this.ptr>>2]=E},this.set_caught=function(E){E=E?1:0,ne[this.ptr+12>>0]=E},this.get_caught=function(){return ne[this.ptr+12>>0]!=0},this.set_rethrown=function(E){E=E?1:0,ne[this.ptr+13>>0]=E},this.get_rethrown=function(){return ne[this.ptr+13>>0]!=0},this.init=function(E,b){this.set_adjusted_ptr(0),this.set_type(E),this.set_destructor(b),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var E=me[this.ptr>>2];me[this.ptr>>2]=E+1},this.release_ref=function(){var E=me[this.ptr>>2];return me[this.ptr>>2]=E-1,E===1},this.set_adjusted_ptr=function(E){de[this.ptr+16>>2]=E},this.get_adjusted_ptr=function(){return de[this.ptr+16>>2]},this.get_exception_ptr=function(){var E=te(this.get_type());if(E)return de[this.excPtr>>2];var b=this.get_adjusted_ptr();return b!==0?b:this.excPtr}}function xn(x,E,b){var G=new _t(x);throw G.init(E,b),x}var pt={};function Lt(x){for(;x.length;){var E=x.pop(),b=x.pop();b(E)}}function jt(x){return this.fromWireType(me[x>>2])}var ge={},Re={},Fe={},It=48,_r=57;function vr(x){if(x===void 0)return"_unknown";x=x.replace(/[^a-zA-Z0-9_]/g,"$");var E=x.charCodeAt(0);return E>=It&&E<=_r?"_"+x:x}function yr(x,E){return x=vr(x),new Function("body","return function "+x+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(E)}function Gt(x,E){var b=yr(E,function(G){this.name=E,this.message=G;var X=new Error(G).stack;X!==void 0&&(this.stack=this.toString()+`
`+X.replace(/^Error(:[^\n]*)?\n/,""))});return b.prototype=Object.create(x.prototype),b.prototype.constructor=b,b.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},b}var zr=void 0;function ft(x){throw new zr(x)}function Bn(x,E,b){x.forEach(function(ie){Fe[ie]=E});function G(ie){var le=b(ie);le.length!==x.length&&ft("Mismatched type converter count");for(var Ce=0;Ce<x.length;++Ce)Wn(x[Ce],le[Ce])}var X=new Array(E.length),Z=[],ee=0;E.forEach((ie,le)=>{Re.hasOwnProperty(ie)?X[le]=Re[ie]:(Z.push(ie),ge.hasOwnProperty(ie)||(ge[ie]=[]),ge[ie].push(()=>{X[le]=Re[ie],++ee,ee===Z.length&&G(X)}))}),Z.length===0&&G(X)}function En(x){var E=pt[x];delete pt[x];var b=E.rawConstructor,G=E.rawDestructor,X=E.fields,Z=X.map(ee=>ee.getterReturnType).concat(X.map(ee=>ee.setterArgumentType));Bn([x],Z,ee=>{var ie={};return X.forEach((le,Ce)=>{var be=le.fieldName,Ge=ee[Ce],Ne=le.getter,lt=le.getterContext,ct=ee[Ce+X.length],Pt=le.setter,On=le.setterContext;ie[be]={read:Pn=>Ge.fromWireType(Ne(lt,Pn)),write:(Pn,Bs)=>{var xi=[];Pt(On,Pn,ct.toWireType(xi,Bs)),Lt(xi)}}}),[{name:E.name,fromWireType:function(le){var Ce={};for(var be in ie)Ce[be]=ie[be].read(le);return G(le),Ce},toWireType:function(le,Ce){for(var be in ie)if(!(be in Ce))throw new TypeError('Missing field:  "'+be+'"');var Ge=b();for(be in ie)ie[be].write(Ge,Ce[be]);return le!==null&&le.push(G,Ge),Ge},argPackAdvance:8,readValueFromPointer:jt,destructorFunction:G}]})}function $n(x,E,b,G,X){}function ln(x){switch(x){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+x)}}function vi(){for(var x=new Array(256),E=0;E<256;++E)x[E]=String.fromCharCode(E);ht=x}var ht=void 0;function Vt(x){for(var E="",b=x;q[b];)E+=ht[q[b++]];return E}var Ir=void 0;function Tt(x){throw new Ir(x)}function Wn(x,E,b={}){if(!("argPackAdvance"in E))throw new TypeError("registerType registeredInstance requires argPackAdvance");var G=E.name;if(x||Tt('type "'+G+'" must have a positive integer typeid pointer'),Re.hasOwnProperty(x)){if(b.ignoreDuplicateRegistrations)return;Tt("Cannot register type '"+G+"' twice")}if(Re[x]=E,delete Fe[x],ge.hasOwnProperty(x)){var X=ge[x];delete ge[x],X.forEach(Z=>Z())}}function Tr(x,E,b,G,X){var Z=ln(b);E=Vt(E),Wn(x,{name:E,fromWireType:function(ee){return!!ee},toWireType:function(ee,ie){return ie?G:X},argPackAdvance:8,readValueFromPointer:function(ee){var ie;if(b===1)ie=ne;else if(b===2)ie=Q;else if(b===4)ie=me;else throw new TypeError("Unknown boolean type size: "+E);return this.fromWireType(ie[ee>>Z])},destructorFunction:null})}function Xi(x){if(!(this instanceof Hr)||!(x instanceof Hr))return!1;for(var E=this.$$.ptrType.registeredClass,b=this.$$.ptr,G=x.$$.ptrType.registeredClass,X=x.$$.ptr;E.baseClass;)b=E.upcast(b),E=E.baseClass;for(;G.baseClass;)X=G.upcast(X),G=G.baseClass;return E===G&&b===X}function Co(x){return{count:x.count,deleteScheduled:x.deleteScheduled,preservePointerOnDelete:x.preservePointerOnDelete,ptr:x.ptr,ptrType:x.ptrType,smartPtr:x.smartPtr,smartPtrType:x.smartPtrType}}function Vi(x){function E(b){return b.$$.ptrType.registeredClass.name}Tt(E(x)+" instance already deleted")}var Yi=!1;function ei(x){}function vn(x){x.smartPtr?x.smartPtrType.rawDestructor(x.smartPtr):x.ptrType.registeredClass.rawDestructor(x.ptr)}function ar(x){x.count.value-=1;var E=x.count.value===0;E&&vn(x)}function Ct(x,E,b){if(E===b)return x;if(b.baseClass===void 0)return null;var G=Ct(x,E,b.baseClass);return G===null?null:b.downcast(G)}var fn={};function ti(){return Object.keys(sr).length}function yi(){var x=[];for(var E in sr)sr.hasOwnProperty(E)&&x.push(sr[E]);return x}var Pi=[];function Ni(){for(;Pi.length;){var x=Pi.pop();x.$$.deleteScheduled=!1,x.delete()}}var or=void 0;function wo(x){or=x,Pi.length&&or&&or(Ni)}function Ts(){a.getInheritedInstanceCount=ti,a.getLiveInheritedInstances=yi,a.flushPendingDeletes=Ni,a.setDelayFunction=wo}var sr={};function So(x,E){for(E===void 0&&Tt("ptr should not be undefined");x.baseClass;)E=x.upcast(E),x=x.baseClass;return E}function Ti(x,E){return E=So(x,E),sr[E]}function Zi(x,E){(!E.ptrType||!E.ptr)&&ft("makeClassHandle requires ptr and ptrType");var b=!!E.smartPtrType,G=!!E.smartPtr;return b!==G&&ft("Both smartPtrType and smartPtr must be specified"),E.count={value:1},Xn(Object.create(x,{$$:{value:E}}))}function Cs(x){var E=this.getPointee(x);if(!E)return this.destructor(x),null;var b=Ti(this.registeredClass,E);if(b!==void 0){if(b.$$.count.value===0)return b.$$.ptr=E,b.$$.smartPtr=x,b.clone();var G=b.clone();return this.destructor(x),G}function X(){return this.isSmartPointer?Zi(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:E,smartPtrType:this,smartPtr:x}):Zi(this.registeredClass.instancePrototype,{ptrType:this,ptr:x})}var Z=this.registeredClass.getActualType(E),ee=fn[Z];if(!ee)return X.call(this);var ie;this.isConst?ie=ee.constPointerType:ie=ee.pointerType;var le=Ct(E,this.registeredClass,ie.registeredClass);return le===null?X.call(this):this.isSmartPointer?Zi(ie.registeredClass.instancePrototype,{ptrType:ie,ptr:le,smartPtrType:this,smartPtr:x}):Zi(ie.registeredClass.instancePrototype,{ptrType:ie,ptr:le})}function Xn(x){return typeof FinalizationRegistry>"u"?(Xn=E=>E,x):(Yi=new FinalizationRegistry(E=>{ar(E.$$)}),Xn=E=>{var b=E.$$,G=!!b.smartPtr;if(G){var X={$$:b};Yi.register(E,X,E)}return E},ei=E=>Yi.unregister(E),Xn(x))}function ba(){if(this.$$.ptr||Vi(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var x=Xn(Object.create(Object.getPrototypeOf(this),{$$:{value:Co(this.$$)}}));return x.$$.count.value+=1,x.$$.deleteScheduled=!1,x}function Ai(){this.$$.ptr||Vi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Tt("Object already scheduled for deletion"),ei(this),ar(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function cr(){return!this.$$.ptr}function La(){return this.$$.ptr||Vi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Tt("Object already scheduled for deletion"),Pi.push(this),Pi.length===1&&or&&or(Ni),this.$$.deleteScheduled=!0,this}function ni(){Hr.prototype.isAliasOf=Xi,Hr.prototype.clone=ba,Hr.prototype.delete=Ai,Hr.prototype.isDeleted=cr,Hr.prototype.deleteLater=La}function Hr(){}function Ji(x,E,b){if(x[E].overloadTable===void 0){var G=x[E];x[E]=function(){return x[E].overloadTable.hasOwnProperty(arguments.length)||Tt("Function '"+b+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+x[E].overloadTable+")!"),x[E].overloadTable[arguments.length].apply(this,arguments)},x[E].overloadTable=[],x[E].overloadTable[G.argCount]=G}}function zn(x,E,b){a.hasOwnProperty(x)?(Tt("Cannot register public name '"+x+"' twice"),Ji(a,x,x),a.hasOwnProperty(b)&&Tt("Cannot register multiple overloads of a function with the same number of arguments ("+b+")!"),a[x].overloadTable[b]=E):a[x]=E}function ws(x,E,b,G,X,Z,ee,ie){this.name=x,this.constructor=E,this.instancePrototype=b,this.rawDestructor=G,this.baseClass=X,this.getActualType=Z,this.upcast=ee,this.downcast=ie,this.pureVirtualFunctions=[]}function jr(x,E,b){for(;E!==b;)E.upcast||Tt("Expected null or instance of "+b.name+", got an instance of "+E.name),x=E.upcast(x),E=E.baseClass;return x}function xo(x,E){if(E===null)return this.isReference&&Tt("null is not a valid "+this.name),0;E.$$||Tt('Cannot pass "'+wi(E)+'" as a '+this.name),E.$$.ptr||Tt("Cannot pass deleted object as a pointer of type "+this.name);var b=E.$$.ptrType.registeredClass,G=jr(E.$$.ptr,b,this.registeredClass);return G}function Va(x,E){var b;if(E===null)return this.isReference&&Tt("null is not a valid "+this.name),this.isSmartPointer?(b=this.rawConstructor(),x!==null&&x.push(this.rawDestructor,b),b):0;E.$$||Tt('Cannot pass "'+wi(E)+'" as a '+this.name),E.$$.ptr||Tt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&E.$$.ptrType.isConst&&Tt("Cannot convert argument of type "+(E.$$.smartPtrType?E.$$.smartPtrType.name:E.$$.ptrType.name)+" to parameter type "+this.name);var G=E.$$.ptrType.registeredClass;if(b=jr(E.$$.ptr,G,this.registeredClass),this.isSmartPointer)switch(E.$$.smartPtr===void 0&&Tt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:E.$$.smartPtrType===this?b=E.$$.smartPtr:Tt("Cannot convert argument of type "+(E.$$.smartPtrType?E.$$.smartPtrType.name:E.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:b=E.$$.smartPtr;break;case 2:if(E.$$.smartPtrType===this)b=E.$$.smartPtr;else{var X=E.clone();b=this.rawShare(b,Lr.toHandle(function(){X.delete()})),x!==null&&x.push(this.rawDestructor,b)}break;default:Tt("Unsupporting sharing policy")}return b}function Ss(x,E){if(E===null)return this.isReference&&Tt("null is not a valid "+this.name),0;E.$$||Tt('Cannot pass "'+wi(E)+'" as a '+this.name),E.$$.ptr||Tt("Cannot pass deleted object as a pointer of type "+this.name),E.$$.ptrType.isConst&&Tt("Cannot convert argument of type "+E.$$.ptrType.name+" to parameter type "+this.name);var b=E.$$.ptrType.registeredClass,G=jr(E.$$.ptr,b,this.registeredClass);return G}function Eo(x){return this.rawGetPointee&&(x=this.rawGetPointee(x)),x}function Cr(x){this.rawDestructor&&this.rawDestructor(x)}function wr(x){x!==null&&x.delete()}function Oo(){Ln.prototype.getPointee=Eo,Ln.prototype.destructor=Cr,Ln.prototype.argPackAdvance=8,Ln.prototype.readValueFromPointer=jt,Ln.prototype.deleteObject=wr,Ln.prototype.fromWireType=Cs}function Ln(x,E,b,G,X,Z,ee,ie,le,Ce,be){this.name=x,this.registeredClass=E,this.isReference=b,this.isConst=G,this.isSmartPointer=X,this.pointeeType=Z,this.sharingPolicy=ee,this.rawGetPointee=ie,this.rawConstructor=le,this.rawShare=Ce,this.rawDestructor=be,!X&&E.baseClass===void 0?G?(this.toWireType=xo,this.destructorFunction=null):(this.toWireType=Ss,this.destructorFunction=null):this.toWireType=Va}function Ro(x,E,b){a.hasOwnProperty(x)||ft("Replacing nonexistant public symbol"),a[x].overloadTable!==void 0&&b!==void 0||(a[x]=E,a[x].argCount=b)}function Pa(x,E,b){var G=a["dynCall_"+x];return b&&b.length?G.apply(null,[E].concat(b)):G.call(null,E)}var Qi=[];function sn(x){var E=Qi[x];return E||(x>=Qi.length&&(Qi.length=x+1),Qi[x]=E=qe.get(x)),E}function br(x,E,b){if(x.includes("j"))return Pa(x,E,b);var G=sn(E).apply(null,b);return G}function ea(x,E){var b=[];return function(){return b.length=0,Object.assign(b,arguments),br(x,E,b)}}function Hn(x,E){x=Vt(x);function b(){return x.includes("j")?ea(x,E):sn(E)}var G=b();return typeof G!="function"&&Tt("unknown function pointer with signature "+x+": "+E),G}var Do=void 0;function Yn(x){var E=We(x),b=Vt(E);return Le(E),b}function lr(x,E){var b=[],G={};function X(Z){if(!G[Z]&&!Re[Z]){if(Fe[Z]){Fe[Z].forEach(X);return}b.push(Z),G[Z]=!0}}throw E.forEach(X),new Do(x+": "+b.map(Yn).join([", "]))}function ta(x,E,b,G,X,Z,ee,ie,le,Ce,be,Ge,Ne){be=Vt(be),Z=Hn(X,Z),ie&&(ie=Hn(ee,ie)),Ce&&(Ce=Hn(le,Ce)),Ne=Hn(Ge,Ne);var lt=vr(be);zn(lt,function(){lr("Cannot construct "+be+" due to unbound types",[G])}),Bn([x,E,b],G?[G]:[],function(ct){ct=ct[0];var Pt,On;G?(Pt=ct.registeredClass,On=Pt.instancePrototype):On=Hr.prototype;var Pn=yr(lt,function(){if(Object.getPrototypeOf(this)!==Bs)throw new Ir("Use 'new' to construct "+be);if(xi.constructor_body===void 0)throw new Ir(be+" has no accessible constructor");var Jp=xi.constructor_body[arguments.length];if(Jp===void 0)throw new Ir("Tried to invoke ctor of "+be+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(xi.constructor_body).toString()+") parameters instead!");return Jp.apply(this,arguments)}),Bs=Object.create(On,{constructor:{value:Pn}});Pn.prototype=Bs;var xi=new ws(be,Pn,Bs,Ne,Pt,Z,ie,Ce),Tu=new Ln(be,xi,!0,!1,!1),$0=new Ln(be+"*",xi,!1,!1,!1),Zp=new Ln(be+" const*",xi,!1,!0,!1);return fn[x]={pointerType:$0,constPointerType:Zp},Ro(lt,Pn),[Tu,$0,Zp]})}function na(x,E){for(var b=[],G=0;G<x;G++)b.push(de[E+G*4>>2]);return b}function xs(x,E){if(!(x instanceof Function))throw new TypeError("new_ called with constructor type "+typeof x+" which is not a function");var b=yr(x.name||"unknownFunctionName",function(){});b.prototype=x.prototype;var G=new b,X=x.apply(G,E);return X instanceof Object?X:G}function ra(x,E,b,G,X){var Z=E.length;Z<2&&Tt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var ee=E[1]!==null&&b!==null,ie=!1,le=1;le<E.length;++le)if(E[le]!==null&&E[le].destructorFunction===void 0){ie=!0;break}for(var Ce=E[0].name!=="void",be="",Ge="",le=0;le<Z-2;++le)be+=(le!==0?", ":"")+"arg"+le,Ge+=(le!==0?", ":"")+"arg"+le+"Wired";var Ne="return function "+vr(x)+"("+be+`) {
if (arguments.length !== `+(Z-2)+`) {
throwBindingError('function `+x+" called with ' + arguments.length + ' arguments, expected "+(Z-2)+` args!');
}
`;ie&&(Ne+=`var destructors = [];
`);var lt=ie?"destructors":"null",ct=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Pt=[Tt,G,X,Lt,E[0],E[1]];ee&&(Ne+="var thisWired = classParam.toWireType("+lt+`, this);
`);for(var le=0;le<Z-2;++le)Ne+="var arg"+le+"Wired = argType"+le+".toWireType("+lt+", arg"+le+"); // "+E[le+2].name+`
`,ct.push("argType"+le),Pt.push(E[le+2]);if(ee&&(Ge="thisWired"+(Ge.length>0?", ":"")+Ge),Ne+=(Ce?"var rv = ":"")+"invoker(fn"+(Ge.length>0?", ":"")+Ge+`);
`,ie)Ne+=`runDestructors(destructors);
`;else for(var le=ee?1:2;le<E.length;++le){var On=le===1?"thisWired":"arg"+(le-2)+"Wired";E[le].destructorFunction!==null&&(Ne+=On+"_dtor("+On+"); // "+E[le].name+`
`,ct.push(On+"_dtor"),Pt.push(E[le].destructorFunction))}Ce&&(Ne+=`var ret = retType.fromWireType(rv);
return ret;
`),Ne+=`}
`,ct.push(Ne);var Pn=xs(Function,ct).apply(null,Pt);return Pn}function Qt(x,E,b,G,X,Z){P(E>0);var ee=na(E,b);X=Hn(G,X),Bn([],[x],function(ie){ie=ie[0];var le="constructor "+ie.name;if(ie.registeredClass.constructor_body===void 0&&(ie.registeredClass.constructor_body=[]),ie.registeredClass.constructor_body[E-1]!==void 0)throw new Ir("Cannot register multiple constructors with identical number of parameters ("+(E-1)+") for class '"+ie.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return ie.registeredClass.constructor_body[E-1]=()=>{lr("Cannot construct "+ie.name+" due to unbound types",ee)},Bn([],ee,function(Ce){return Ce.splice(1,0,null),ie.registeredClass.constructor_body[E-1]=ra(le,Ce,null,X,Z),[]}),[]})}function Na(x,E,b,G,X,Z,ee,ie){var le=na(b,G);E=Vt(E),Z=Hn(X,Z),Bn([],[x],function(Ce){Ce=Ce[0];var be=Ce.name+"."+E;E.startsWith("@@")&&(E=Symbol[E.substring(2)]),ie&&Ce.registeredClass.pureVirtualFunctions.push(E);function Ge(){lr("Cannot call "+be+" due to unbound types",le)}var Ne=Ce.registeredClass.instancePrototype,lt=Ne[E];return lt===void 0||lt.overloadTable===void 0&&lt.className!==Ce.name&&lt.argCount===b-2?(Ge.argCount=b-2,Ge.className=Ce.name,Ne[E]=Ge):(Ji(Ne,E,be),Ne[E].overloadTable[b-2]=Ge),Bn([],le,function(ct){var Pt=ra(be,ct,Ce,Z,ee);return Ne[E].overloadTable===void 0?(Pt.argCount=b-2,Ne[E]=Pt):Ne[E].overloadTable[b-2]=Pt,[]}),[]})}var ia=[],Vn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Aa(x){x>4&&--Vn[x].refcount===0&&(Vn[x]=void 0,ia.push(x))}function ur(){for(var x=0,E=5;E<Vn.length;++E)Vn[E]!==void 0&&++x;return x}function Mo(){for(var x=5;x<Vn.length;++x)if(Vn[x]!==void 0)return Vn[x];return null}function Ci(){a.count_emval_handles=ur,a.get_first_emval=Mo}var Lr={toValue:x=>(x||Tt("Cannot use deleted val. handle = "+x),Vn[x].value),toHandle:x=>{switch(x){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var E=ia.length?ia.pop():Vn.length;return Vn[E]={refcount:1,value:x},E}}}};function Es(x,E){E=Vt(E),Wn(x,{name:E,fromWireType:function(b){var G=Lr.toValue(b);return Aa(b),G},toWireType:function(b,G){return Lr.toHandle(G)},argPackAdvance:8,readValueFromPointer:jt,destructorFunction:null})}function wi(x){if(x===null)return"null";var E=typeof x;return E==="object"||E==="array"||E==="function"?x.toString():""+x}function fr(x,E){switch(E){case 2:return function(b){return this.fromWireType(je[b>>2])};case 3:return function(b){return this.fromWireType($e[b>>3])};default:throw new TypeError("Unknown float type: "+x)}}function _o(x,E,b){var G=ln(b);E=Vt(E),Wn(x,{name:E,fromWireType:function(X){return X},toWireType:function(X,Z){return Z},argPackAdvance:8,readValueFromPointer:fr(E,G),destructorFunction:null})}function Os(x,E,b){switch(E){case 0:return b?function(X){return ne[X]}:function(X){return q[X]};case 1:return b?function(X){return Q[X>>1]}:function(X){return ae[X>>1]};case 2:return b?function(X){return me[X>>2]}:function(X){return de[X>>2]};default:throw new TypeError("Unknown integer type: "+x)}}function Rs(x,E,b,G,X){E=Vt(E);var Z=ln(b),ee=Ge=>Ge;if(G===0){var ie=32-8*b;ee=Ge=>Ge<<ie>>>ie}var le=E.includes("unsigned"),Ce=(Ge,Ne)=>{},be;le?be=function(Ge,Ne){return Ce(Ne,this.name),Ne>>>0}:be=function(Ge,Ne){return Ce(Ne,this.name),Ne},Wn(x,{name:E,fromWireType:ee,toWireType:be,argPackAdvance:8,readValueFromPointer:Os(E,Z,G!==0),destructorFunction:null})}function Io(x,E,b){var G=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],X=G[E];function Z(ee){ee=ee>>2;var ie=de,le=ie[ee],Ce=ie[ee+1];return new X(J,Ce,le)}b=Vt(b),Wn(x,{name:b,fromWireType:Z,argPackAdvance:8,readValueFromPointer:Z},{ignoreDuplicateRegistrations:!0})}function aa(x,E){E=Vt(E);var b=E==="std::string";Wn(x,{name:E,fromWireType:function(G){var X=de[G>>2],Z=G+4,ee;if(b)for(var ie=Z,le=0;le<=X;++le){var Ce=Z+le;if(le==X||q[Ce]==0){var be=Ce-ie,Ge=k(ie,be);ee===void 0?ee=Ge:(ee+="\0",ee+=Ge),ie=Ce+1}}else{for(var Ne=new Array(X),le=0;le<X;++le)Ne[le]=String.fromCharCode(q[Z+le]);ee=Ne.join("")}return Le(G),ee},toWireType:function(G,X){X instanceof ArrayBuffer&&(X=new Uint8Array(X));var Z,ee=typeof X=="string";ee||X instanceof Uint8Array||X instanceof Uint8ClampedArray||X instanceof Int8Array||Tt("Cannot pass non-string to std::string"),b&&ee?Z=W(X):Z=X.length;var ie=Se(4+Z+1),le=ie+4;if(de[ie>>2]=Z,b&&ee)H(X,le,Z+1);else if(ee)for(var Ce=0;Ce<Z;++Ce){var be=X.charCodeAt(Ce);be>255&&(Le(le),Tt("String has UTF-16 code units that do not fit in 8 bits")),q[le+Ce]=be}else for(var Ce=0;Ce<Z;++Ce)q[le+Ce]=X[Ce];return G!==null&&G.push(Le,ie),ie},argPackAdvance:8,readValueFromPointer:jt,destructorFunction:function(G){Le(G)}})}var bo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Fa(x,E){for(var b=x,G=b>>1,X=G+E/2;!(G>=X)&&ae[G];)++G;if(b=G<<1,b-x>32&&bo)return bo.decode(q.subarray(x,b));for(var Z="",ee=0;!(ee>=E/2);++ee){var ie=Q[x+ee*2>>1];if(ie==0)break;Z+=String.fromCharCode(ie)}return Z}function Ds(x,E,b){if(b===void 0&&(b=2147483647),b<2)return 0;b-=2;for(var G=E,X=b<x.length*2?b/2:x.length,Z=0;Z<X;++Z){var ee=x.charCodeAt(Z);Q[E>>1]=ee,E+=2}return Q[E>>1]=0,E-G}function Ms(x){return x.length*2}function _s(x,E){for(var b=0,G="";!(b>=E/4);){var X=me[x+b*4>>2];if(X==0)break;if(++b,X>=65536){var Z=X-65536;G+=String.fromCharCode(55296|Z>>10,56320|Z&1023)}else G+=String.fromCharCode(X)}return G}function Ua(x,E,b){if(b===void 0&&(b=2147483647),b<4)return 0;for(var G=E,X=G+b-4,Z=0;Z<x.length;++Z){var ee=x.charCodeAt(Z);if(ee>=55296&&ee<=57343){var ie=x.charCodeAt(++Z);ee=65536+((ee&1023)<<10)|ie&1023}if(me[E>>2]=ee,E+=4,E+4>X)break}return me[E>>2]=0,E-G}function Is(x){for(var E=0,b=0;b<x.length;++b){var G=x.charCodeAt(b);G>=55296&&G<=57343&&++b,E+=4}return E}function bs(x,E,b){b=Vt(b);var G,X,Z,ee,ie;E===2?(G=Fa,X=Ds,ee=Ms,Z=()=>ae,ie=1):E===4&&(G=_s,X=Ua,ee=Is,Z=()=>de,ie=2),Wn(x,{name:b,fromWireType:function(le){for(var Ce=de[le>>2],be=Z(),Ge,Ne=le+4,lt=0;lt<=Ce;++lt){var ct=le+4+lt*E;if(lt==Ce||be[ct>>ie]==0){var Pt=ct-Ne,On=G(Ne,Pt);Ge===void 0?Ge=On:(Ge+="\0",Ge+=On),Ne=ct+E}}return Le(le),Ge},toWireType:function(le,Ce){typeof Ce!="string"&&Tt("Cannot pass non-string to C++ string type "+b);var be=ee(Ce),Ge=Se(4+be+E);return de[Ge>>2]=be>>ie,X(Ce,Ge+4,be+E),le!==null&&le.push(Le,Ge),Ge},argPackAdvance:8,readValueFromPointer:jt,destructorFunction:function(le){Le(le)}})}function Ls(x,E,b,G,X,Z){pt[x]={name:Vt(E),rawConstructor:Hn(b,G),rawDestructor:Hn(X,Z),fields:[]}}function ka(x,E,b,G,X,Z,ee,ie,le,Ce){pt[x].fields.push({fieldName:Vt(E),getterReturnType:b,getter:Hn(G,X),getterContext:Z,setterArgumentType:ee,setter:Hn(ie,le),setterContext:Ce})}function Vs(x,E){E=Vt(E),Wn(x,{isVoid:!0,name:E,argPackAdvance:0,fromWireType:function(){},toWireType:function(b,G){}})}function Lo(){throw 1/0}var Vo={};function Ps(x){var E=Vo[x];return E===void 0?Vt(x):E}function Ga(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function Ns(x){return x===0?Lr.toHandle(Ga()):(x=Ps(x),Lr.toHandle(Ga()[x]))}function Po(x){x>4&&(Vn[x].refcount+=1)}function No(x,E){var b=Re[x];return b===void 0&&Tt(E+" has unknown type "+Yn(x)),b}function Ao(x){for(var E="",b=0;b<x;++b)E+=(b!==0?", ":"")+"arg"+b;for(var G=()=>de,X="return function emval_allocator_"+x+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,b=0;b<x;++b)X+="var argType"+b+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+b+`');
var arg`+b+" = argType"+b+`.readValueFromPointer(args);
args += argType`+b+`['argPackAdvance'];
argTypes += 4;
`;return X+="var obj = new constructor("+E+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",X)(No,a,Lr.toHandle,G)}var Fo={};function As(x,E,b,G){x=Lr.toValue(x);var X=Fo[E];return X||(X=Ao(E),Fo[E]=X),X(x,b,G)}function Fs(x,E){x=No(x,"_emval_take_value");var b=x.readValueFromPointer(E);return Lr.toHandle(b)}function Us(){$("")}function Ba(x,E,b){q.copyWithin(x,E,E+b)}function ks(){return 2147483648}function Fi(x){try{return D.grow(x-J.byteLength+65535>>>16),Be(D.buffer),1}catch{}}function Gs(x){var E=q.length;x=x>>>0;var b=ks();if(x>b)return!1;let G=(le,Ce)=>le+(Ce-le%Ce)%Ce;for(var X=1;X<=4;X*=2){var Z=E*(1+.2/X);Z=Math.min(Z,x+100663296);var ee=Math.min(b,G(Math.max(x,Z),65536)),ie=Fi(ee);if(ie)return!0}return!1}var $a={};function Wa(){return l||"./this.program"}function Si(){if(!Si.strings){var x=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",E={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:x,_:Wa()};for(var b in $a)$a[b]===void 0?delete E[b]:E[b]=$a[b];var G=[];for(var b in E)G.push(b+"="+E[b]);Si.strings=G}return Si.strings}function Vr(x,E,b){for(var G=0;G<x.length;++G)ne[E++>>0]=x.charCodeAt(G);ne[E>>0]=0}function Uo(x,E){var b=0;return Si().forEach(function(G,X){var Z=E+b;de[x+X*4>>2]=Z,Vr(G,Z),b+=G.length+1}),0}function ko(x,E){var b=Si();de[x>>2]=b.length;var G=0;return b.forEach(function(X){G+=X.length+1}),de[E>>2]=G,0}function za(x){f(x,new St(x))}function Go(x,E){za(x)}var oa=Go;function Ha(x){return 52}function L(x,E,b,G,X){return 70}var V=[null,[],[]];function Y(x,E){var b=V[x];E===0||E===10?((x===1?w:S)(B(b,0)),b.length=0):b.push(E)}function se(x,E,b,G){for(var X=0,Z=0;Z<b;Z++){var ee=de[E>>2],ie=de[E+4>>2];E+=8;for(var le=0;le<ie;le++)Y(x,q[ee+le]);X+=ie}return de[G>>2]=X,0}function he(x){var E=a["_"+x];return E}function xe(x,E){ne.set(x,E)}function ye(x,E,b,G,X){var Z={string:ct=>{var Pt=0;if(ct!=null&&ct!==0){var On=(ct.length<<2)+1;Pt=z(On),H(ct,Pt,On)}return Pt},array:ct=>{var Pt=z(ct.length);return xe(ct,Pt),Pt}};function ee(ct){return E==="string"?k(ct):E==="boolean"?!!ct:ct}var ie=he(x),le=[],Ce=0;if(G)for(var be=0;be<G.length;be++){var Ge=Z[b[be]];Ge?(Ce===0&&(Ce=M()),le[be]=Ge(G[be])):le[be]=G[be]}var Ne=ie.apply(null,le);function lt(ct){return Ce!==0&&I(Ce),ee(ct)}return Ne=lt(Ne),Ne}zr=a.InternalError=Gt(Error,"InternalError"),vi(),Ir=a.BindingError=Gt(Error,"BindingError"),ni(),Ts(),Oo(),Do=a.UnboundTypeError=Gt(Error,"UnboundTypeError"),Ci();var pe={g:xn,A:En,w:$n,F:Tr,u:ta,t:Qt,c:Na,E:Es,m:_o,b:Rs,a:Io,l:aa,h:bs,J:Ls,d:ka,G:Vs,x:Lo,i:Aa,r:Ns,p:Po,q:As,s:Fs,j:Us,D:Ba,y:Gs,z:Uo,B:ko,I:oa,C:Ha,v:L,k:se,o:Te,n:_e,H:ve,f:ue,e:De};st(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.L).apply(null,arguments)};var Se=a._malloc=function(){return(Se=a._malloc=a.asm.N).apply(null,arguments)},Le=a._free=function(){return(Le=a._free=a.asm.O).apply(null,arguments)},We=a.___getTypeName=function(){return(We=a.___getTypeName=a.asm.P).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.Q).apply(null,arguments)};var Je=a._setThrew=function(){return(Je=a._setThrew=a.asm.R).apply(null,arguments)},M=a.stackSave=function(){return(M=a.stackSave=a.asm.S).apply(null,arguments)},I=a.stackRestore=function(){return(I=a.stackRestore=a.asm.T).apply(null,arguments)},z=a.stackAlloc=function(){return(z=a.stackAlloc=a.asm.U).apply(null,arguments)},te=a.___cxa_is_pointer_type=function(){return(te=a.___cxa_is_pointer_type=a.asm.V).apply(null,arguments)};a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.W).apply(null,arguments)};function ue(x,E){var b=M();try{sn(x)(E)}catch(G){if(I(b),G!==G+0)throw G;Je(1,0)}}function Te(x,E){var b=M();try{return sn(x)(E)}catch(G){if(I(b),G!==G+0)throw G;Je(1,0)}}function De(x,E,b,G){var X=M();try{sn(x)(E,b,G)}catch(Z){if(I(X),Z!==Z+0)throw Z;Je(1,0)}}function ve(x,E,b,G){var X=M();try{return sn(x)(E,b,G)}catch(Z){if(I(X),Z!==Z+0)throw Z;Je(1,0)}}function _e(x,E,b){var G=M();try{return sn(x)(E,b)}catch(X){if(I(G),X!==X+0)throw X;Je(1,0)}}a.ccall=ye;var O;on=function x(){O||R(),O||(on=x)};function R(x){if(qt>0||(Xe(),qt>0))return;function E(){O||(O=!0,a.calledRun=!0,!N&&(et(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),$t()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),E()},1)):E()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return R(),i.ready})})();t.exports=n})(kd)),kd.exports}var mX=pX();const vX=ji(mX),yX=new URL("/radiology-ai-viewer/assets/libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url),Af={codec:void 0,decoder:void 0};function TX(){if(Af.codec)return Promise.resolve();const t=vX({locateFile:e=>e.endsWith(".wasm")?yX.toString():e});return new Promise((e,n)=>{t.then(r=>{Af.codec=r,Af.decoder=new r.JPEGDecoder,e()},n)})}async function CX(t,e){await TX();const n=Af.decoder;n.getEncodedBuffer(t.length).set(t),n.decode();const i=n.getFrameInfo(),a=n.getDecodedBuffer(),o={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},s=wX(i,a),c={frameInfo:i};return{...e,pixelData:s,imageInfo:o,encodeOptions:c,...c,...o}}function wX(t,e){return t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const SX="modulepreload",xX=function(t){return"/radiology-ai-viewer/"+t},V4={},Tw=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(l){return Promise.all(l.map(f=>Promise.resolve(f).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=o?.nonce||o?.getAttribute("nonce");i=c(n.map(l=>{if(l=xX(l),l in V4)return;V4[l]=!0;const f=l.endsWith(".css"),u=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":SX,f||(g.as="script"),g.crossOrigin="",g.href=l,s&&g.setAttribute("nonce",s),document.head.appendChild(g),f)return new Promise((d,p)=>{g.addEventListener("load",d),g.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return i.then(o=>{for(const s of o||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})},_l={JpegImage:void 0,decodeConfig:{}};function EX(t){return _l.decodeConfig=t,_l.JpegImage?Promise.resolve():new Promise((e,n)=>{Tw(()=>import("./jpeg-B-x1txLf.js"),[]).then(r=>{_l.JpegImage=r.default,e()}).catch(n)})}async function OX(t,e){if(await EX(),typeof _l.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const n=new _l.JpegImage;if(n.parse(e),n.colorTransform=!1,t.bitsAllocated===8)return t.pixelData=n.getData(t.columns,t.rows),t;if(t.bitsAllocated===16)return t.pixelData=n.getData16(t.columns,t.rows),t}const Il={DecoderClass:void 0,decodeConfig:{}};function RX(t){return Il.decodeConfig=t,Il.DecoderClass?Promise.resolve():new Promise((e,n)=>{Tw(async()=>{const{Decoder:r}=await import("./lossless-CyYqoyFe.js");return{Decoder:r}},[]).then(({Decoder:r})=>{Il.DecoderClass=r,e()},n)})}async function P4(t,e){if(await RX(),typeof Il.DecoderClass>"u")throw new Error("No JPEG Lossless decoder loaded");const n=new Il.DecoderClass,r=t.bitsAllocated<=8?1:2,i=e.buffer,a=n.decode(i,e.byteOffset,e.length,r);return t.pixelRepresentation===0?t.bitsAllocated===16?(t.pixelData=new Uint16Array(a.buffer),t):(t.pixelData=new Uint8Array(a.buffer),t):(t.pixelData=new Int16Array(a.buffer),t)}var Gd={exports:{}},N4;function DX(){return N4||(N4=1,(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),(function(i){i=i||{};var a=typeof i<"u"?i:{},o,s;a.ready=new Promise(function(L,V){o=L,s=V});var c=Object.assign({},a),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function d(L){return a.locateFile?a.locateFile(L,g):g+L}var p,h,m;if(u){var v=ho,y=ho;f?g=y.dirname(g)+"/":g=__dirname+"/",p=(L,V)=>(L=$(L)?new URL(L):y.normalize(L),v.readFileSync(L,V?void 0:"utf8")),m=L=>{var V=p(L,!0);return V.buffer||(V=new Uint8Array(V)),V},h=(L,V,Y)=>{L=$(L)?new URL(L):y.normalize(L),v.readFile(L,function(se,he){se?Y(se):V(he.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(L){if(!(L instanceof we))throw L}),process.on("unhandledRejection",function(L){throw L}),a.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),r&&(g=r),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",p=L=>{var V=new XMLHttpRequest;return V.open("GET",L,!1),V.send(null),V.responseText},f&&(m=L=>{var V=new XMLHttpRequest;return V.open("GET",L,!1),V.responseType="arraybuffer",V.send(null),new Uint8Array(V.response)}),h=(L,V,Y)=>{var se=new XMLHttpRequest;se.open("GET",L,!0),se.responseType="arraybuffer",se.onload=()=>{if(se.status==200||se.status==0&&se.response){V(se.response);return}Y()},se.onerror=Y,se.send(null)});a.print||console.log.bind(console);var T=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit;var C;a.wasmBinary&&(C=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&on("no native wasm support detected");var w,S=!1;function _(L,V){L||on(V)}var D=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function N(L,V,Y){for(var se=V+Y,he=V;L[he]&&!(he>=se);)++he;if(he-V>16&&L.buffer&&D)return D.decode(L.subarray(V,he));for(var xe="";V<he;){var ye=L[V++];if(!(ye&128)){xe+=String.fromCharCode(ye);continue}var pe=L[V++]&63;if((ye&224)==192){xe+=String.fromCharCode((ye&31)<<6|pe);continue}var Se=L[V++]&63;if((ye&240)==224?ye=(ye&15)<<12|pe<<6|Se:ye=(ye&7)<<18|pe<<12|Se<<6|L[V++]&63,ye<65536)xe+=String.fromCharCode(ye);else{var Le=ye-65536;xe+=String.fromCharCode(55296|Le>>10,56320|Le&1023)}}return xe}function P(L,V){return L?N(W,L,V):""}function F(L,V,Y,se){if(!(se>0))return 0;for(var he=Y,xe=Y+se-1,ye=0;ye<L.length;++ye){var pe=L.charCodeAt(ye);if(pe>=55296&&pe<=57343){var Se=L.charCodeAt(++ye);pe=65536+((pe&1023)<<10)|Se&1023}if(pe<=127){if(Y>=xe)break;V[Y++]=pe}else if(pe<=2047){if(Y+1>=xe)break;V[Y++]=192|pe>>6,V[Y++]=128|pe&63}else if(pe<=65535){if(Y+2>=xe)break;V[Y++]=224|pe>>12,V[Y++]=128|pe>>6&63,V[Y++]=128|pe&63}else{if(Y+3>=xe)break;V[Y++]=240|pe>>18,V[Y++]=128|pe>>12&63,V[Y++]=128|pe>>6&63,V[Y++]=128|pe&63}}return V[Y]=0,Y-he}function B(L,V,Y){return F(L,W,V,Y)}function k(L){for(var V=0,Y=0;Y<L.length;++Y){var se=L.charCodeAt(Y);se<=127?V++:se<=2047?V+=2:se>=55296&&se<=57343?(V+=4,++Y):V+=3}return V}var U,H,W,J,ne,q,Q,ae,me;function de(L){U=L,a.HEAP8=H=new Int8Array(L),a.HEAP16=J=new Int16Array(L),a.HEAP32=q=new Int32Array(L),a.HEAPU8=W=new Uint8Array(L),a.HEAPU16=ne=new Uint16Array(L),a.HEAPU32=Q=new Uint32Array(L),a.HEAPF32=ae=new Float32Array(L),a.HEAPF64=me=new Float64Array(L)}a.INITIAL_MEMORY;var je,$e=[],Be=[],qe=[];function Qe(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Xe(a.preRun.shift());Ae($e)}function ut(){Ae(Be)}function ke(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)$t(a.postRun.shift());Ae(qe)}function Xe(L){$e.unshift(L)}function et(L){Be.unshift(L)}function $t(L){qe.unshift(L)}var Zt=0,Kt=null;function Jt(L){Zt++,a.monitorRunDependencies&&a.monitorRunDependencies(Zt)}function qt(L){if(Zt--,a.monitorRunDependencies&&a.monitorRunDependencies(Zt),Zt==0&&Kt){var V=Kt;Kt=null,V()}}function on(L){a.onAbort&&a.onAbort(L),L="Aborted("+L+")",T(L),S=!0,L+=". Build with -sASSERTIONS for more info.";var V=new WebAssembly.RuntimeError(L);throw s(V),V}var tn="data:application/octet-stream;base64,";function ir(L){return L.startsWith(tn)}function $(L){return L.startsWith("file://")}var j;j="charlswasm_decode.wasm",ir(j)||(j=d(j));function re(L){try{if(L==j&&C)return new Uint8Array(C);if(m)return m(L);throw"both async and sync fetching of the wasm failed"}catch(V){on(V)}}function K(){if(!C&&(l||f)){if(typeof fetch=="function"&&!$(j))return fetch(j,{credentials:"same-origin"}).then(function(L){if(!L.ok)throw"failed to load wasm binary file at '"+j+"'";return L.arrayBuffer()}).catch(function(){return re(j)});if(h)return new Promise(function(L,V){h(j,function(Y){L(new Uint8Array(Y))},V)})}return Promise.resolve().then(function(){return re(j)})}function oe(){var L={a:$a};function V(ye,pe){var Se=ye.exports;a.asm=Se,w=a.asm.z,de(w.buffer),je=a.asm.C,et(a.asm.A),qt()}Jt();function Y(ye){V(ye.instance)}function se(ye){return K().then(function(pe){return WebAssembly.instantiate(pe,L)}).then(function(pe){return pe}).then(ye,function(pe){T("failed to asynchronously prepare wasm: "+pe),on(pe)})}function he(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!ir(j)&&!$(j)&&!u&&typeof fetch=="function"?fetch(j,{credentials:"same-origin"}).then(function(ye){var pe=WebAssembly.instantiateStreaming(ye,L);return pe.then(Y,function(Se){return T("wasm streaming compile failed: "+Se),T("falling back to ArrayBuffer instantiation"),se(Y)})}):se(Y)}if(a.instantiateWasm)try{var xe=a.instantiateWasm(L,V);return xe}catch(ye){T("Module.instantiateWasm callback failed with error: "+ye),s(ye)}return he().catch(s),{}}function we(L){this.name="ExitStatus",this.message="Program terminated with exit("+L+")",this.status=L}function Ae(L){for(;L.length>0;)L.shift()(a)}function st(L){this.excPtr=L,this.ptr=L-24,this.set_type=function(V){Q[this.ptr+4>>2]=V},this.get_type=function(){return Q[this.ptr+4>>2]},this.set_destructor=function(V){Q[this.ptr+8>>2]=V},this.get_destructor=function(){return Q[this.ptr+8>>2]},this.set_refcount=function(V){q[this.ptr>>2]=V},this.set_caught=function(V){V=V?1:0,H[this.ptr+12>>0]=V},this.get_caught=function(){return H[this.ptr+12>>0]!=0},this.set_rethrown=function(V){V=V?1:0,H[this.ptr+13>>0]=V},this.get_rethrown=function(){return H[this.ptr+13>>0]!=0},this.init=function(V,Y){this.set_adjusted_ptr(0),this.set_type(V),this.set_destructor(Y),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var V=q[this.ptr>>2];q[this.ptr>>2]=V+1},this.release_ref=function(){var V=q[this.ptr>>2];return q[this.ptr>>2]=V-1,V===1},this.set_adjusted_ptr=function(V){Q[this.ptr+16>>2]=V},this.get_adjusted_ptr=function(){return Q[this.ptr+16>>2]},this.get_exception_ptr=function(){var V=Go(this.get_type());if(V)return Q[this.excPtr>>2];var Y=this.get_adjusted_ptr();return Y!==0?Y:this.excPtr}}function St(L,V,Y){var se=new st(L);throw se.init(V,Y),L}var kt={};function _t(L){for(;L.length;){var V=L.pop(),Y=L.pop();Y(V)}}function xn(L){return this.fromWireType(q[L>>2])}var pt={},Lt={},jt={},ge=48,Re=57;function Fe(L){if(L===void 0)return"_unknown";L=L.replace(/[^a-zA-Z0-9_]/g,"$");var V=L.charCodeAt(0);return V>=ge&&V<=Re?"_"+L:L}function It(L,V){return L=Fe(L),new Function("body","return function "+L+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(V)}function _r(L,V){var Y=It(V,function(se){this.name=V,this.message=se;var he=new Error(se).stack;he!==void 0&&(this.stack=this.toString()+`
`+he.replace(/^Error(:[^\n]*)?\n/,""))});return Y.prototype=Object.create(L.prototype),Y.prototype.constructor=Y,Y.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},Y}var vr=void 0;function yr(L){throw new vr(L)}function Gt(L,V,Y){L.forEach(function(pe){jt[pe]=V});function se(pe){var Se=Y(pe);Se.length!==L.length&&yr("Mismatched type converter count");for(var Le=0;Le<L.length;++Le)Vt(L[Le],Se[Le])}var he=new Array(V.length),xe=[],ye=0;V.forEach((pe,Se)=>{Lt.hasOwnProperty(pe)?he[Se]=Lt[pe]:(xe.push(pe),pt.hasOwnProperty(pe)||(pt[pe]=[]),pt[pe].push(()=>{he[Se]=Lt[pe],++ye,ye===xe.length&&se(he)}))}),xe.length===0&&se(he)}function zr(L){var V=kt[L];delete kt[L];var Y=V.rawConstructor,se=V.rawDestructor,he=V.fields,xe=he.map(ye=>ye.getterReturnType).concat(he.map(ye=>ye.setterArgumentType));Gt([L],xe,ye=>{var pe={};return he.forEach((Se,Le)=>{var We=Se.fieldName,Je=ye[Le],M=Se.getter,I=Se.getterContext,z=ye[Le+he.length],te=Se.setter,ue=Se.setterContext;pe[We]={read:Te=>Je.fromWireType(M(I,Te)),write:(Te,De)=>{var ve=[];te(ue,Te,z.toWireType(ve,De)),_t(ve)}}}),[{name:V.name,fromWireType:function(Se){var Le={};for(var We in pe)Le[We]=pe[We].read(Se);return se(Se),Le},toWireType:function(Se,Le){for(var We in pe)if(!(We in Le))throw new TypeError('Missing field:  "'+We+'"');var Je=Y();for(We in pe)pe[We].write(Je,Le[We]);return Se!==null&&Se.push(se,Je),Je},argPackAdvance:8,readValueFromPointer:xn,destructorFunction:se}]})}function ft(L,V,Y,se,he){}function Bn(L){switch(L){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+L)}}function En(){for(var L=new Array(256),V=0;V<256;++V)L[V]=String.fromCharCode(V);$n=L}var $n=void 0;function ln(L){for(var V="",Y=L;W[Y];)V+=$n[W[Y++]];return V}var vi=void 0;function ht(L){throw new vi(L)}function Vt(L,V,Y={}){if(!("argPackAdvance"in V))throw new TypeError("registerType registeredInstance requires argPackAdvance");var se=V.name;if(L||ht('type "'+se+'" must have a positive integer typeid pointer'),Lt.hasOwnProperty(L)){if(Y.ignoreDuplicateRegistrations)return;ht("Cannot register type '"+se+"' twice")}if(Lt[L]=V,delete jt[L],pt.hasOwnProperty(L)){var he=pt[L];delete pt[L],he.forEach(xe=>xe())}}function Ir(L,V,Y,se,he){var xe=Bn(Y);V=ln(V),Vt(L,{name:V,fromWireType:function(ye){return!!ye},toWireType:function(ye,pe){return pe?se:he},argPackAdvance:8,readValueFromPointer:function(ye){var pe;if(Y===1)pe=H;else if(Y===2)pe=J;else if(Y===4)pe=q;else throw new TypeError("Unknown boolean type size: "+V);return this.fromWireType(pe[ye>>xe])},destructorFunction:null})}function Tt(L){if(!(this instanceof cr)||!(L instanceof cr))return!1;for(var V=this.$$.ptrType.registeredClass,Y=this.$$.ptr,se=L.$$.ptrType.registeredClass,he=L.$$.ptr;V.baseClass;)Y=V.upcast(Y),V=V.baseClass;for(;se.baseClass;)he=se.upcast(he),se=se.baseClass;return V===se&&Y===he}function Wn(L){return{count:L.count,deleteScheduled:L.deleteScheduled,preservePointerOnDelete:L.preservePointerOnDelete,ptr:L.ptr,ptrType:L.ptrType,smartPtr:L.smartPtr,smartPtrType:L.smartPtrType}}function Tr(L){function V(Y){return Y.$$.ptrType.registeredClass.name}ht(V(L)+" instance already deleted")}var Xi=!1;function Co(L){}function Vi(L){L.smartPtr?L.smartPtrType.rawDestructor(L.smartPtr):L.ptrType.registeredClass.rawDestructor(L.ptr)}function Yi(L){L.count.value-=1;var V=L.count.value===0;V&&Vi(L)}function ei(L,V,Y){if(V===Y)return L;if(Y.baseClass===void 0)return null;var se=ei(L,V,Y.baseClass);return se===null?null:Y.downcast(se)}var vn={};function ar(){return Object.keys(or).length}function Ct(){var L=[];for(var V in or)or.hasOwnProperty(V)&&L.push(or[V]);return L}var fn=[];function ti(){for(;fn.length;){var L=fn.pop();L.$$.deleteScheduled=!1,L.delete()}}var yi=void 0;function Pi(L){yi=L,fn.length&&yi&&yi(ti)}function Ni(){a.getInheritedInstanceCount=ar,a.getLiveInheritedInstances=Ct,a.flushPendingDeletes=ti,a.setDelayFunction=Pi}var or={};function wo(L,V){for(V===void 0&&ht("ptr should not be undefined");L.baseClass;)V=L.upcast(V),L=L.baseClass;return V}function Ts(L,V){return V=wo(L,V),or[V]}function sr(L,V){(!V.ptrType||!V.ptr)&&yr("makeClassHandle requires ptr and ptrType");var Y=!!V.smartPtrType,se=!!V.smartPtr;return Y!==se&&yr("Both smartPtrType and smartPtr must be specified"),V.count={value:1},Ti(Object.create(L,{$$:{value:V}}))}function So(L){var V=this.getPointee(L);if(!V)return this.destructor(L),null;var Y=Ts(this.registeredClass,V);if(Y!==void 0){if(Y.$$.count.value===0)return Y.$$.ptr=V,Y.$$.smartPtr=L,Y.clone();var se=Y.clone();return this.destructor(L),se}function he(){return this.isSmartPointer?sr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:V,smartPtrType:this,smartPtr:L}):sr(this.registeredClass.instancePrototype,{ptrType:this,ptr:L})}var xe=this.registeredClass.getActualType(V),ye=vn[xe];if(!ye)return he.call(this);var pe;this.isConst?pe=ye.constPointerType:pe=ye.pointerType;var Se=ei(V,this.registeredClass,pe.registeredClass);return Se===null?he.call(this):this.isSmartPointer?sr(pe.registeredClass.instancePrototype,{ptrType:pe,ptr:Se,smartPtrType:this,smartPtr:L}):sr(pe.registeredClass.instancePrototype,{ptrType:pe,ptr:Se})}function Ti(L){return typeof FinalizationRegistry>"u"?(Ti=V=>V,L):(Xi=new FinalizationRegistry(V=>{Yi(V.$$)}),Ti=V=>{var Y=V.$$,se=!!Y.smartPtr;if(se){var he={$$:Y};Xi.register(V,he,V)}return V},Co=V=>Xi.unregister(V),Ti(L))}function Zi(){if(this.$$.ptr||Tr(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var L=Ti(Object.create(Object.getPrototypeOf(this),{$$:{value:Wn(this.$$)}}));return L.$$.count.value+=1,L.$$.deleteScheduled=!1,L}function Cs(){this.$$.ptr||Tr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ht("Object already scheduled for deletion"),Co(this),Yi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Xn(){return!this.$$.ptr}function ba(){return this.$$.ptr||Tr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ht("Object already scheduled for deletion"),fn.push(this),fn.length===1&&yi&&yi(ti),this.$$.deleteScheduled=!0,this}function Ai(){cr.prototype.isAliasOf=Tt,cr.prototype.clone=Zi,cr.prototype.delete=Cs,cr.prototype.isDeleted=Xn,cr.prototype.deleteLater=ba}function cr(){}function La(L,V,Y){if(L[V].overloadTable===void 0){var se=L[V];L[V]=function(){return L[V].overloadTable.hasOwnProperty(arguments.length)||ht("Function '"+Y+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+L[V].overloadTable+")!"),L[V].overloadTable[arguments.length].apply(this,arguments)},L[V].overloadTable=[],L[V].overloadTable[se.argCount]=se}}function ni(L,V,Y){a.hasOwnProperty(L)?((Y===void 0||a[L].overloadTable!==void 0&&a[L].overloadTable[Y]!==void 0)&&ht("Cannot register public name '"+L+"' twice"),La(a,L,L),a.hasOwnProperty(Y)&&ht("Cannot register multiple overloads of a function with the same number of arguments ("+Y+")!"),a[L].overloadTable[Y]=V):(a[L]=V,Y!==void 0&&(a[L].numArguments=Y))}function Hr(L,V,Y,se,he,xe,ye,pe){this.name=L,this.constructor=V,this.instancePrototype=Y,this.rawDestructor=se,this.baseClass=he,this.getActualType=xe,this.upcast=ye,this.downcast=pe,this.pureVirtualFunctions=[]}function Ji(L,V,Y){for(;V!==Y;)V.upcast||ht("Expected null or instance of "+Y.name+", got an instance of "+V.name),L=V.upcast(L),V=V.baseClass;return L}function zn(L,V){if(V===null)return this.isReference&&ht("null is not a valid "+this.name),0;V.$$||ht('Cannot pass "'+Ci(V)+'" as a '+this.name),V.$$.ptr||ht("Cannot pass deleted object as a pointer of type "+this.name);var Y=V.$$.ptrType.registeredClass,se=Ji(V.$$.ptr,Y,this.registeredClass);return se}function ws(L,V){var Y;if(V===null)return this.isReference&&ht("null is not a valid "+this.name),this.isSmartPointer?(Y=this.rawConstructor(),L!==null&&L.push(this.rawDestructor,Y),Y):0;V.$$||ht('Cannot pass "'+Ci(V)+'" as a '+this.name),V.$$.ptr||ht("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&V.$$.ptrType.isConst&&ht("Cannot convert argument of type "+(V.$$.smartPtrType?V.$$.smartPtrType.name:V.$$.ptrType.name)+" to parameter type "+this.name);var se=V.$$.ptrType.registeredClass;if(Y=Ji(V.$$.ptr,se,this.registeredClass),this.isSmartPointer)switch(V.$$.smartPtr===void 0&&ht("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:V.$$.smartPtrType===this?Y=V.$$.smartPtr:ht("Cannot convert argument of type "+(V.$$.smartPtrType?V.$$.smartPtrType.name:V.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:Y=V.$$.smartPtr;break;case 2:if(V.$$.smartPtrType===this)Y=V.$$.smartPtr;else{var he=V.clone();Y=this.rawShare(Y,ur.toHandle(function(){he.delete()})),L!==null&&L.push(this.rawDestructor,Y)}break;default:ht("Unsupporting sharing policy")}return Y}function jr(L,V){if(V===null)return this.isReference&&ht("null is not a valid "+this.name),0;V.$$||ht('Cannot pass "'+Ci(V)+'" as a '+this.name),V.$$.ptr||ht("Cannot pass deleted object as a pointer of type "+this.name),V.$$.ptrType.isConst&&ht("Cannot convert argument of type "+V.$$.ptrType.name+" to parameter type "+this.name);var Y=V.$$.ptrType.registeredClass,se=Ji(V.$$.ptr,Y,this.registeredClass);return se}function xo(L){return this.rawGetPointee&&(L=this.rawGetPointee(L)),L}function Va(L){this.rawDestructor&&this.rawDestructor(L)}function Ss(L){L!==null&&L.delete()}function Eo(){Cr.prototype.getPointee=xo,Cr.prototype.destructor=Va,Cr.prototype.argPackAdvance=8,Cr.prototype.readValueFromPointer=xn,Cr.prototype.deleteObject=Ss,Cr.prototype.fromWireType=So}function Cr(L,V,Y,se,he,xe,ye,pe,Se,Le,We){this.name=L,this.registeredClass=V,this.isReference=Y,this.isConst=se,this.isSmartPointer=he,this.pointeeType=xe,this.sharingPolicy=ye,this.rawGetPointee=pe,this.rawConstructor=Se,this.rawShare=Le,this.rawDestructor=We,!he&&V.baseClass===void 0?se?(this.toWireType=zn,this.destructorFunction=null):(this.toWireType=jr,this.destructorFunction=null):this.toWireType=ws}function wr(L,V,Y){a.hasOwnProperty(L)||yr("Replacing nonexistant public symbol"),a[L].overloadTable!==void 0&&Y!==void 0?a[L].overloadTable[Y]=V:(a[L]=V,a[L].argCount=Y)}function Oo(L,V,Y){var se=a["dynCall_"+L];return Y&&Y.length?se.apply(null,[V].concat(Y)):se.call(null,V)}var Ln=[];function Ro(L){var V=Ln[L];return V||(L>=Ln.length&&(Ln.length=L+1),Ln[L]=V=je.get(L)),V}function Pa(L,V,Y){if(L.includes("j"))return Oo(L,V,Y);var se=Ro(V).apply(null,Y);return se}function Qi(L,V){var Y=[];return function(){return Y.length=0,Object.assign(Y,arguments),Pa(L,V,Y)}}function sn(L,V){L=ln(L);function Y(){return L.includes("j")?Qi(L,V):Ro(V)}var se=Y();return typeof se!="function"&&ht("unknown function pointer with signature "+L+": "+V),se}var br=void 0;function ea(L){var V=Si(L),Y=ln(V);return Vr(V),Y}function Hn(L,V){var Y=[],se={};function he(xe){if(!se[xe]&&!Lt[xe]){if(jt[xe]){jt[xe].forEach(he);return}Y.push(xe),se[xe]=!0}}throw V.forEach(he),new br(L+": "+Y.map(ea).join([", "]))}function Do(L,V,Y,se,he,xe,ye,pe,Se,Le,We,Je,M){We=ln(We),xe=sn(he,xe),pe&&(pe=sn(ye,pe)),Le&&(Le=sn(Se,Le)),M=sn(Je,M);var I=Fe(We);ni(I,function(){Hn("Cannot construct "+We+" due to unbound types",[se])}),Gt([L,V,Y],se?[se]:[],function(z){z=z[0];var te,ue;se?(te=z.registeredClass,ue=te.instancePrototype):ue=cr.prototype;var Te=It(I,function(){if(Object.getPrototypeOf(this)!==De)throw new vi("Use 'new' to construct "+We);if(ve.constructor_body===void 0)throw new vi(We+" has no accessible constructor");var x=ve.constructor_body[arguments.length];if(x===void 0)throw new vi("Tried to invoke ctor of "+We+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(ve.constructor_body).toString()+") parameters instead!");return x.apply(this,arguments)}),De=Object.create(ue,{constructor:{value:Te}});Te.prototype=De;var ve=new Hr(We,Te,De,M,te,xe,pe,Le),_e=new Cr(We,ve,!0,!1,!1),O=new Cr(We+"*",ve,!1,!1,!1),R=new Cr(We+" const*",ve,!1,!0,!1);return vn[L]={pointerType:O,constPointerType:R},wr(I,Te),[_e,O,R]})}function Yn(L,V){for(var Y=[],se=0;se<L;se++)Y.push(Q[V+se*4>>2]);return Y}function lr(L,V){if(!(L instanceof Function))throw new TypeError("new_ called with constructor type "+typeof L+" which is not a function");var Y=It(L.name||"unknownFunctionName",function(){});Y.prototype=L.prototype;var se=new Y,he=L.apply(se,V);return he instanceof Object?he:se}function ta(L,V,Y,se,he){var xe=V.length;xe<2&&ht("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var ye=V[1]!==null&&Y!==null,pe=!1,Se=1;Se<V.length;++Se)if(V[Se]!==null&&V[Se].destructorFunction===void 0){pe=!0;break}for(var Le=V[0].name!=="void",We="",Je="",Se=0;Se<xe-2;++Se)We+=(Se!==0?", ":"")+"arg"+Se,Je+=(Se!==0?", ":"")+"arg"+Se+"Wired";var M="return function "+Fe(L)+"("+We+`) {
if (arguments.length !== `+(xe-2)+`) {
throwBindingError('function `+L+" called with ' + arguments.length + ' arguments, expected "+(xe-2)+` args!');
}
`;pe&&(M+=`var destructors = [];
`);var I=pe?"destructors":"null",z=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],te=[ht,se,he,_t,V[0],V[1]];ye&&(M+="var thisWired = classParam.toWireType("+I+`, this);
`);for(var Se=0;Se<xe-2;++Se)M+="var arg"+Se+"Wired = argType"+Se+".toWireType("+I+", arg"+Se+"); // "+V[Se+2].name+`
`,z.push("argType"+Se),te.push(V[Se+2]);if(ye&&(Je="thisWired"+(Je.length>0?", ":"")+Je),M+=(Le?"var rv = ":"")+"invoker(fn"+(Je.length>0?", ":"")+Je+`);
`,pe)M+=`runDestructors(destructors);
`;else for(var Se=ye?1:2;Se<V.length;++Se){var ue=Se===1?"thisWired":"arg"+(Se-2)+"Wired";V[Se].destructorFunction!==null&&(M+=ue+"_dtor("+ue+"); // "+V[Se].name+`
`,z.push(ue+"_dtor"),te.push(V[Se].destructorFunction))}Le&&(M+=`var ret = retType.fromWireType(rv);
return ret;
`),M+=`}
`,z.push(M);var Te=lr(Function,z).apply(null,te);return Te}function na(L,V,Y,se,he,xe){_(V>0);var ye=Yn(V,Y);he=sn(se,he),Gt([],[L],function(pe){pe=pe[0];var Se="constructor "+pe.name;if(pe.registeredClass.constructor_body===void 0&&(pe.registeredClass.constructor_body=[]),pe.registeredClass.constructor_body[V-1]!==void 0)throw new vi("Cannot register multiple constructors with identical number of parameters ("+(V-1)+") for class '"+pe.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return pe.registeredClass.constructor_body[V-1]=()=>{Hn("Cannot construct "+pe.name+" due to unbound types",ye)},Gt([],ye,function(Le){return Le.splice(1,0,null),pe.registeredClass.constructor_body[V-1]=ta(Se,Le,null,he,xe),[]}),[]})}function xs(L,V,Y,se,he,xe,ye,pe){var Se=Yn(Y,se);V=ln(V),xe=sn(he,xe),Gt([],[L],function(Le){Le=Le[0];var We=Le.name+"."+V;V.startsWith("@@")&&(V=Symbol[V.substring(2)]),pe&&Le.registeredClass.pureVirtualFunctions.push(V);function Je(){Hn("Cannot call "+We+" due to unbound types",Se)}var M=Le.registeredClass.instancePrototype,I=M[V];return I===void 0||I.overloadTable===void 0&&I.className!==Le.name&&I.argCount===Y-2?(Je.argCount=Y-2,Je.className=Le.name,M[V]=Je):(La(M,V,We),M[V].overloadTable[Y-2]=Je),Gt([],Se,function(z){var te=ta(We,z,Le,xe,ye);return M[V].overloadTable===void 0?(te.argCount=Y-2,M[V]=te):M[V].overloadTable[Y-2]=te,[]}),[]})}var ra=[],Qt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Na(L){L>4&&--Qt[L].refcount===0&&(Qt[L]=void 0,ra.push(L))}function ia(){for(var L=0,V=5;V<Qt.length;++V)Qt[V]!==void 0&&++L;return L}function Vn(){for(var L=5;L<Qt.length;++L)if(Qt[L]!==void 0)return Qt[L];return null}function Aa(){a.count_emval_handles=ia,a.get_first_emval=Vn}var ur={toValue:L=>(L||ht("Cannot use deleted val. handle = "+L),Qt[L].value),toHandle:L=>{switch(L){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var V=ra.length?ra.pop():Qt.length;return Qt[V]={refcount:1,value:L},V}}}};function Mo(L,V){V=ln(V),Vt(L,{name:V,fromWireType:function(Y){var se=ur.toValue(Y);return Na(Y),se},toWireType:function(Y,se){return ur.toHandle(se)},argPackAdvance:8,readValueFromPointer:xn,destructorFunction:null})}function Ci(L){if(L===null)return"null";var V=typeof L;return V==="object"||V==="array"||V==="function"?L.toString():""+L}function Lr(L,V){switch(V){case 2:return function(Y){return this.fromWireType(ae[Y>>2])};case 3:return function(Y){return this.fromWireType(me[Y>>3])};default:throw new TypeError("Unknown float type: "+L)}}function Es(L,V,Y){var se=Bn(Y);V=ln(V),Vt(L,{name:V,fromWireType:function(he){return he},toWireType:function(he,xe){return xe},argPackAdvance:8,readValueFromPointer:Lr(V,se),destructorFunction:null})}function wi(L,V,Y,se,he,xe){var ye=Yn(V,Y);L=ln(L),he=sn(se,he),ni(L,function(){Hn("Cannot call "+L+" due to unbound types",ye)},V-1),Gt([],ye,function(pe){var Se=[pe[0],null].concat(pe.slice(1));return wr(L,ta(L,Se,null,he,xe),V-1),[]})}function fr(L,V,Y){switch(V){case 0:return Y?function(he){return H[he]}:function(he){return W[he]};case 1:return Y?function(he){return J[he>>1]}:function(he){return ne[he>>1]};case 2:return Y?function(he){return q[he>>2]}:function(he){return Q[he>>2]};default:throw new TypeError("Unknown integer type: "+L)}}function _o(L,V,Y,se,he){V=ln(V);var xe=Bn(Y),ye=Je=>Je;if(se===0){var pe=32-8*Y;ye=Je=>Je<<pe>>>pe}var Se=V.includes("unsigned"),Le=(Je,M)=>{},We;Se?We=function(Je,M){return Le(M,this.name),M>>>0}:We=function(Je,M){return Le(M,this.name),M},Vt(L,{name:V,fromWireType:ye,toWireType:We,argPackAdvance:8,readValueFromPointer:fr(V,xe,se!==0),destructorFunction:null})}function Os(L,V,Y){var se=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],he=se[V];function xe(ye){ye=ye>>2;var pe=Q,Se=pe[ye],Le=pe[ye+1];return new he(U,Le,Se)}Y=ln(Y),Vt(L,{name:Y,fromWireType:xe,argPackAdvance:8,readValueFromPointer:xe},{ignoreDuplicateRegistrations:!0})}function Rs(L,V){V=ln(V);var Y=V==="std::string";Vt(L,{name:V,fromWireType:function(se){var he=Q[se>>2],xe=se+4,ye;if(Y)for(var pe=xe,Se=0;Se<=he;++Se){var Le=xe+Se;if(Se==he||W[Le]==0){var We=Le-pe,Je=P(pe,We);ye===void 0?ye=Je:(ye+="\0",ye+=Je),pe=Le+1}}else{for(var M=new Array(he),Se=0;Se<he;++Se)M[Se]=String.fromCharCode(W[xe+Se]);ye=M.join("")}return Vr(se),ye},toWireType:function(se,he){he instanceof ArrayBuffer&&(he=new Uint8Array(he));var xe,ye=typeof he=="string";ye||he instanceof Uint8Array||he instanceof Uint8ClampedArray||he instanceof Int8Array||ht("Cannot pass non-string to std::string"),Y&&ye?xe=k(he):xe=he.length;var pe=Wa(4+xe+1),Se=pe+4;if(Q[pe>>2]=xe,Y&&ye)B(he,Se,xe+1);else if(ye)for(var Le=0;Le<xe;++Le){var We=he.charCodeAt(Le);We>255&&(Vr(Se),ht("String has UTF-16 code units that do not fit in 8 bits")),W[Se+Le]=We}else for(var Le=0;Le<xe;++Le)W[Se+Le]=he[Le];return se!==null&&se.push(Vr,pe),pe},argPackAdvance:8,readValueFromPointer:xn,destructorFunction:function(se){Vr(se)}})}var Io=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function aa(L,V){for(var Y=L,se=Y>>1,he=se+V/2;!(se>=he)&&ne[se];)++se;if(Y=se<<1,Y-L>32&&Io)return Io.decode(W.subarray(L,Y));for(var xe="",ye=0;!(ye>=V/2);++ye){var pe=J[L+ye*2>>1];if(pe==0)break;xe+=String.fromCharCode(pe)}return xe}function bo(L,V,Y){if(Y===void 0&&(Y=2147483647),Y<2)return 0;Y-=2;for(var se=V,he=Y<L.length*2?Y/2:L.length,xe=0;xe<he;++xe){var ye=L.charCodeAt(xe);J[V>>1]=ye,V+=2}return J[V>>1]=0,V-se}function Fa(L){return L.length*2}function Ds(L,V){for(var Y=0,se="";!(Y>=V/4);){var he=q[L+Y*4>>2];if(he==0)break;if(++Y,he>=65536){var xe=he-65536;se+=String.fromCharCode(55296|xe>>10,56320|xe&1023)}else se+=String.fromCharCode(he)}return se}function Ms(L,V,Y){if(Y===void 0&&(Y=2147483647),Y<4)return 0;for(var se=V,he=se+Y-4,xe=0;xe<L.length;++xe){var ye=L.charCodeAt(xe);if(ye>=55296&&ye<=57343){var pe=L.charCodeAt(++xe);ye=65536+((ye&1023)<<10)|pe&1023}if(q[V>>2]=ye,V+=4,V+4>he)break}return q[V>>2]=0,V-se}function _s(L){for(var V=0,Y=0;Y<L.length;++Y){var se=L.charCodeAt(Y);se>=55296&&se<=57343&&++Y,V+=4}return V}function Ua(L,V,Y){Y=ln(Y);var se,he,xe,ye,pe;V===2?(se=aa,he=bo,ye=Fa,xe=()=>ne,pe=1):V===4&&(se=Ds,he=Ms,ye=_s,xe=()=>Q,pe=2),Vt(L,{name:Y,fromWireType:function(Se){for(var Le=Q[Se>>2],We=xe(),Je,M=Se+4,I=0;I<=Le;++I){var z=Se+4+I*V;if(I==Le||We[z>>pe]==0){var te=z-M,ue=se(M,te);Je===void 0?Je=ue:(Je+="\0",Je+=ue),M=z+V}}return Vr(Se),Je},toWireType:function(Se,Le){typeof Le!="string"&&ht("Cannot pass non-string to C++ string type "+Y);var We=ye(Le),Je=Wa(4+We+V);return Q[Je>>2]=We>>pe,he(Le,Je+4,We+V),Se!==null&&Se.push(Vr,Je),Je},argPackAdvance:8,readValueFromPointer:xn,destructorFunction:function(Se){Vr(Se)}})}function Is(L,V,Y,se,he,xe){kt[L]={name:ln(V),rawConstructor:sn(Y,se),rawDestructor:sn(he,xe),fields:[]}}function bs(L,V,Y,se,he,xe,ye,pe,Se,Le){kt[L].fields.push({fieldName:ln(V),getterReturnType:Y,getter:sn(se,he),getterContext:xe,setterArgumentType:ye,setter:sn(pe,Se),setterContext:Le})}function Ls(L,V){V=ln(V),Vt(L,{isVoid:!0,name:V,argPackAdvance:0,fromWireType:function(){},toWireType:function(Y,se){}})}var ka={};function Vs(L){var V=ka[L];return V===void 0?ln(L):V}function Lo(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function Vo(L){return L===0?ur.toHandle(Lo()):(L=Vs(L),ur.toHandle(Lo()[L]))}function Ps(L){L>4&&(Qt[L].refcount+=1)}function Ga(L,V){var Y=Lt[L];return Y===void 0&&ht(V+" has unknown type "+ea(L)),Y}function Ns(L){for(var V="",Y=0;Y<L;++Y)V+=(Y!==0?", ":"")+"arg"+Y;for(var se=()=>Q,he="return function emval_allocator_"+L+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,Y=0;Y<L;++Y)he+="var argType"+Y+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+Y+`');
var arg`+Y+" = argType"+Y+`.readValueFromPointer(args);
args += argType`+Y+`['argPackAdvance'];
argTypes += 4;
`;return he+="var obj = new constructor("+V+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",he)(Ga,a,ur.toHandle,se)}var Po={};function No(L,V,Y,se){L=ur.toValue(L);var he=Po[V];return he||(he=Ns(V),Po[V]=he),he(L,Y,se)}function Ao(L,V){L=Ga(L,"_emval_take_value");var Y=L.readValueFromPointer(V);return ur.toHandle(Y)}function Fo(){on("")}function As(L,V,Y){W.copyWithin(L,V,V+Y)}function Fs(){return 2147483648}function Us(L){try{return w.grow(L-U.byteLength+65535>>>16),de(w.buffer),1}catch{}}function Ba(L){var V=W.length;L=L>>>0;var Y=Fs();if(L>Y)return!1;let se=(Se,Le)=>Se+(Le-Se%Le)%Le;for(var he=1;he<=4;he*=2){var xe=V*(1+.2/he);xe=Math.min(xe,L+100663296);var ye=Math.min(Y,se(Math.max(L,xe),65536)),pe=Us(ye);if(pe)return!0}return!1}function ks(L){var V=a["_"+L];return V}function Fi(L,V){H.set(L,V)}function Gs(L,V,Y,se,he){var xe={string:z=>{var te=0;if(z!=null&&z!==0){var ue=(z.length<<2)+1;te=za(ue),B(z,te,ue)}return te},array:z=>{var te=za(z.length);return Fi(z,te),te}};function ye(z){return V==="string"?P(z):V==="boolean"?!!z:z}var pe=ks(L),Se=[],Le=0;if(se)for(var We=0;We<se.length;We++){var Je=xe[Y[We]];Je?(Le===0&&(Le=Uo()),Se[We]=Je(se[We])):Se[We]=se[We]}var M=pe.apply(null,Se);function I(z){return Le!==0&&ko(Le),ye(z)}return M=I(M),M}vr=a.InternalError=_r(Error,"InternalError"),En(),vi=a.BindingError=_r(Error,"BindingError"),Ai(),Ni(),Eo(),br=a.UnboundTypeError=_r(Error,"UnboundTypeError"),Aa();var $a={h:St,q:zr,r:ft,w:Ir,p:Do,o:na,c:xs,v:Mo,k:Es,e:wi,b:_o,a:Os,j:Rs,g:Ua,u:Is,d:bs,x:Ls,i:Na,m:Vo,l:Ps,y:No,n:Ao,f:Fo,t:As,s:Ba};oe(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.A).apply(null,arguments)};var Wa=a._malloc=function(){return(Wa=a._malloc=a.asm.B).apply(null,arguments)},Si=a.___getTypeName=function(){return(Si=a.___getTypeName=a.asm.D).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.E).apply(null,arguments)};var Vr=a._free=function(){return(Vr=a._free=a.asm.F).apply(null,arguments)},Uo=a.stackSave=function(){return(Uo=a.stackSave=a.asm.G).apply(null,arguments)},ko=a.stackRestore=function(){return(ko=a.stackRestore=a.asm.H).apply(null,arguments)},za=a.stackAlloc=function(){return(za=a.stackAlloc=a.asm.I).apply(null,arguments)},Go=a.___cxa_is_pointer_type=function(){return(Go=a.___cxa_is_pointer_type=a.asm.J).apply(null,arguments)};a.ccall=Gs;var oa;Kt=function L(){oa||Ha(),oa||(Kt=L)};function Ha(L){if(Zt>0||(Qe(),Zt>0))return;function V(){oa||(oa=!0,a.calledRun=!0,!S&&(ut(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),ke()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),V()},1)):V()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Ha(),i.ready})})();t.exports=n})(Gd)),Gd.exports}var MX=DX();const _X=ji(MX),IX=new URL("/radiology-ai-viewer/assets/charlswasm_decode-484ovEoR.wasm",import.meta.url),Qc={codec:void 0,decoder:void 0,decodeConfig:{}};function bX(t){return typeof t=="number"?Qc.codec.getExceptionMessage(t):t}function LX(t){if(Qc.decodeConfig=t,Qc.codec)return Promise.resolve();const e=_X({locateFile:n=>n.endsWith(".wasm")?IX.toString():n});return new Promise((n,r)=>{e.then(i=>{Qc.codec=i,Qc.decoder=new i.JpegLSDecoder,n()},r)})}async function A4(t,e){try{await LX();const n=Qc.decoder;n.getEncodedBuffer(t.length).set(t),n.decode();const i=n.getFrameInfo(),a=n.getInterleaveMode(),o=n.getNearLossless(),s=n.getDecodedBuffer(),c={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},l=VX(i,s,e.signed),f={nearLossless:o,interleaveMode:a,frameInfo:i};return{...e,pixelData:l,imageInfo:c,encodeOptions:f,...f,...c}}catch(n){throw bX(n)}}function VX(t,e,n){return t.bitsPerSample>8?n?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):n?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var Bd={exports:{}},F4;function PX(){return F4||(F4=1,(function(t,e){var n=(()=>{var r=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(r=r||__filename),(function(i={}){var a,o=i,s,c,l=new Promise((M,I)=>{s=M,c=I}),f=typeof window=="object",u=typeof WorkerGlobalScope<"u",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",d=Object.assign({},o),p="./this.program",h="";function m(M){return o.locateFile?o.locateFile(M,h):h+M}var v,y;if(g){var T=ho;h=__dirname+"/",y=M=>{M=Zt(M)?new URL(M):M;var I=T.readFileSync(M);return I},v=async(M,I=!0)=>{M=Zt(M)?new URL(M):M;var z=T.readFileSync(M,I?void 0:"utf8");return z},!o.thisProgram&&process.argv.length>1&&(p=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else(f||u)&&(u?h=self.location.href:typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),r&&(h=r),h.startsWith("blob:")?h="":h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(y=M=>{var I=new XMLHttpRequest;return I.open("GET",M,!1),I.responseType="arraybuffer",I.send(null),new Uint8Array(I.response)}),v=async M=>{if(Zt(M))return new Promise((z,te)=>{var ue=new XMLHttpRequest;ue.open("GET",M,!0),ue.responseType="arraybuffer",ue.onload=()=>{if(ue.status==200||ue.status==0&&ue.response){z(ue.response);return}te(ue.status)},ue.onerror=te,ue.send(null)});var I=await fetch(M,{credentials:"same-origin"});if(I.ok)return I.arrayBuffer();throw new Error(I.status+" : "+I.url)});var C=o.print||console.log.bind(console),w=o.printErr||console.error.bind(console);Object.assign(o,d),d=null,o.arguments&&o.arguments,o.thisProgram&&(p=o.thisProgram);var S=o.wasmBinary,_,D=!1,N,P,F,B,k,U,H,W;function J(){var M=_.buffer;o.HEAP8=N=new Int8Array(M),o.HEAP16=F=new Int16Array(M),o.HEAPU8=P=new Uint8Array(M),o.HEAPU16=B=new Uint16Array(M),o.HEAP32=k=new Int32Array(M),o.HEAPU32=U=new Uint32Array(M),o.HEAPF32=H=new Float32Array(M),o.HEAPF64=W=new Float64Array(M)}var ne=[],q=[],Q=[];function ae(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)je(o.preRun.shift());re(ne)}function me(){re(q)}function de(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)Be(o.postRun.shift());re(Q)}function je(M){ne.unshift(M)}function $e(M){q.unshift(M)}function Be(M){Q.unshift(M)}var qe=0,Qe=null;function ut(M){qe++,o.monitorRunDependencies?.(qe)}function ke(M){if(qe--,o.monitorRunDependencies?.(qe),qe==0&&Qe){var I=Qe;Qe=null,I()}}function Xe(M){o.onAbort?.(M),M="Aborted("+M+")",w(M),D=!0,M+=". Build with -sASSERTIONS for more info.";var I=new WebAssembly.RuntimeError(M);throw c(I),I}var et="data:application/octet-stream;base64,",$t=M=>M.startsWith(et),Zt=M=>M.startsWith("file://");function Kt(){var M="openjpegwasm_decode.wasm";return $t(M)?M:m(M)}var Jt;function qt(M){if(M==Jt&&S)return new Uint8Array(S);if(y)return y(M);throw"both async and sync fetching of the wasm failed"}async function on(M){if(!S)try{var I=await v(M);return new Uint8Array(I)}catch{}return qt(M)}async function tn(M,I){try{var z=await on(M),te=await WebAssembly.instantiate(z,I);return te}catch(ue){w(`failed to asynchronously prepare wasm: ${ue}`),Xe(ue)}}async function ir(M,I,z){if(!M&&typeof WebAssembly.instantiateStreaming=="function"&&!$t(I)&&!Zt(I)&&!g&&typeof fetch=="function")try{var te=fetch(I,{credentials:"same-origin"}),ue=await WebAssembly.instantiateStreaming(te,z);return ue}catch(Te){w(`wasm streaming compile failed: ${Te}`),w("falling back to ArrayBuffer instantiation")}return tn(I,z)}function $(){return{a:Y}}async function j(){function M(ue,Te){return se=ue.exports,_=se.F,J(),La=se.I,$e(se.G),ke(),se}ut();function I(ue){M(ue.instance)}var z=$();if(o.instantiateWasm)try{return o.instantiateWasm(z,M)}catch(ue){w(`Module.instantiateWasm callback failed with error: ${ue}`),c(ue)}Jt??=Kt();try{var te=await ir(S,Jt,z);return I(te),te}catch(ue){c(ue);return}}var re=M=>{for(;M.length>0;)M.shift()(o)};o.noExitRuntime;var K=M=>pe(M),oe=()=>Le();class we{constructor(I){this.excPtr=I,this.ptr=I-24}set_type(I){U[this.ptr+4>>2]=I}get_type(){return U[this.ptr+4>>2]}set_destructor(I){U[this.ptr+8>>2]=I}get_destructor(){return U[this.ptr+8>>2]}set_caught(I){I=I?1:0,N[this.ptr+12]=I}get_caught(){return N[this.ptr+12]!=0}set_rethrown(I){I=I?1:0,N[this.ptr+13]=I}get_rethrown(){return N[this.ptr+13]!=0}init(I,z){this.set_adjusted_ptr(0),this.set_type(I),this.set_destructor(z)}set_adjusted_ptr(I){U[this.ptr+16>>2]=I}get_adjusted_ptr(){return U[this.ptr+16>>2]}}var Ae=0,st=(M,I,z)=>{var te=new we(M);throw te.init(I,z),Ae=M,Ae},St=()=>Xe(""),kt={},_t=M=>{for(;M.length;){var I=M.pop(),z=M.pop();z(I)}};function xn(M){return this.fromWireType(U[M>>2])}var pt={},Lt={},jt={},ge,Re=M=>{throw new ge(M)},Fe=(M,I,z)=>{M.forEach(ve=>jt[ve]=I);function te(ve){var _e=z(ve);_e.length!==M.length&&Re("Mismatched type converter count");for(var O=0;O<M.length;++O)En(M[O],_e[O])}var ue=new Array(I.length),Te=[],De=0;I.forEach((ve,_e)=>{Lt.hasOwnProperty(ve)?ue[_e]=Lt[ve]:(Te.push(ve),pt.hasOwnProperty(ve)||(pt[ve]=[]),pt[ve].push(()=>{ue[_e]=Lt[ve],++De,De===Te.length&&te(ue)}))}),Te.length===0&&te(ue)},It=M=>{var I=kt[M];delete kt[M];var z=I.rawConstructor,te=I.rawDestructor,ue=I.fields,Te=ue.map(De=>De.getterReturnType).concat(ue.map(De=>De.setterArgumentType));Fe([M],Te,De=>{var ve={};return ue.forEach((_e,O)=>{var R=_e.fieldName,x=De[O],E=_e.getter,b=_e.getterContext,G=De[O+ue.length],X=_e.setter,Z=_e.setterContext;ve[R]={read:ee=>x.fromWireType(E(b,ee)),write:(ee,ie)=>{var le=[];X(Z,ee,G.toWireType(le,ie)),_t(le)}}}),[{name:I.name,fromWireType:_e=>{var O={};for(var R in ve)O[R]=ve[R].read(_e);return te(_e),O},toWireType:(_e,O)=>{for(var R in ve)if(!(R in O))throw new TypeError(`Missing field: "${R}"`);var x=z();for(R in ve)ve[R].write(x,O[R]);return _e!==null&&_e.push(te,x),x},argPackAdvance:$n,readValueFromPointer:xn,destructorFunction:te}]})},_r=(M,I,z,te,ue)=>{},vr=()=>{for(var M=new Array(256),I=0;I<256;++I)M[I]=String.fromCharCode(I);yr=M},yr,Gt=M=>{for(var I="",z=M;P[z];)I+=yr[P[z++]];return I},zr,ft=M=>{throw new zr(M)};function Bn(M,I,z={}){var te=I.name;if(M||ft(`type "${te}" must have a positive integer typeid pointer`),Lt.hasOwnProperty(M)){if(z.ignoreDuplicateRegistrations)return;ft(`Cannot register type '${te}' twice`)}if(Lt[M]=I,delete jt[M],pt.hasOwnProperty(M)){var ue=pt[M];delete pt[M],ue.forEach(Te=>Te())}}function En(M,I,z={}){return Bn(M,I,z)}var $n=8,ln=(M,I,z,te)=>{I=Gt(I),En(M,{name:I,fromWireType:function(ue){return!!ue},toWireType:function(ue,Te){return Te?z:te},argPackAdvance:$n,readValueFromPointer:function(ue){return this.fromWireType(P[ue])},destructorFunction:null})},vi=M=>({count:M.count,deleteScheduled:M.deleteScheduled,preservePointerOnDelete:M.preservePointerOnDelete,ptr:M.ptr,ptrType:M.ptrType,smartPtr:M.smartPtr,smartPtrType:M.smartPtrType}),ht=M=>{function I(z){return z.$$.ptrType.registeredClass.name}ft(I(M)+" instance already deleted")},Vt=!1,Ir=M=>{},Tt=M=>{M.smartPtr?M.smartPtrType.rawDestructor(M.smartPtr):M.ptrType.registeredClass.rawDestructor(M.ptr)},Wn=M=>{M.count.value-=1;var I=M.count.value===0;I&&Tt(M)},Tr=(M,I,z)=>{if(I===z)return M;if(z.baseClass===void 0)return null;var te=Tr(M,I,z.baseClass);return te===null?null:z.downcast(te)},Xi={},Co={},Vi=(M,I)=>{for(I===void 0&&ft("ptr should not be undefined");M.baseClass;)I=M.upcast(I),M=M.baseClass;return I},Yi=(M,I)=>(I=Vi(M,I),Co[I]),ei=(M,I)=>{(!I.ptrType||!I.ptr)&&Re("makeClassHandle requires ptr and ptrType");var z=!!I.smartPtrType,te=!!I.smartPtr;return z!==te&&Re("Both smartPtrType and smartPtr must be specified"),I.count={value:1},ar(Object.create(M,{$$:{value:I,writable:!0}}))};function vn(M){var I=this.getPointee(M);if(!I)return this.destructor(M),null;var z=Yi(this.registeredClass,I);if(z!==void 0){if(z.$$.count.value===0)return z.$$.ptr=I,z.$$.smartPtr=M,z.clone();var te=z.clone();return this.destructor(M),te}function ue(){return this.isSmartPointer?ei(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:I,smartPtrType:this,smartPtr:M}):ei(this.registeredClass.instancePrototype,{ptrType:this,ptr:M})}var Te=this.registeredClass.getActualType(I),De=Xi[Te];if(!De)return ue.call(this);var ve;this.isConst?ve=De.constPointerType:ve=De.pointerType;var _e=Tr(I,this.registeredClass,ve.registeredClass);return _e===null?ue.call(this):this.isSmartPointer?ei(ve.registeredClass.instancePrototype,{ptrType:ve,ptr:_e,smartPtrType:this,smartPtr:M}):ei(ve.registeredClass.instancePrototype,{ptrType:ve,ptr:_e})}var ar=M=>typeof FinalizationRegistry>"u"?(ar=I=>I,M):(Vt=new FinalizationRegistry(I=>{Wn(I.$$)}),ar=I=>{var z=I.$$,te=!!z.smartPtr;if(te){var ue={$$:z};Vt.register(I,ue,I)}return I},Ir=I=>Vt.unregister(I),ar(M)),Ct=()=>{Object.assign(fn.prototype,{isAliasOf(M){if(!(this instanceof fn)||!(M instanceof fn))return!1;var I=this.$$.ptrType.registeredClass,z=this.$$.ptr;M.$$=M.$$;for(var te=M.$$.ptrType.registeredClass,ue=M.$$.ptr;I.baseClass;)z=I.upcast(z),I=I.baseClass;for(;te.baseClass;)ue=te.upcast(ue),te=te.baseClass;return I===te&&z===ue},clone(){if(this.$$.ptr||ht(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var M=ar(Object.create(Object.getPrototypeOf(this),{$$:{value:vi(this.$$)}}));return M.$$.count.value+=1,M.$$.deleteScheduled=!1,M},delete(){this.$$.ptr||ht(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ft("Object already scheduled for deletion"),Ir(this),Wn(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||ht(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ft("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}})};function fn(){}var ti=(M,I)=>Object.defineProperty(I,"name",{value:M}),yi=(M,I,z)=>{if(M[I].overloadTable===void 0){var te=M[I];M[I]=function(...ue){return M[I].overloadTable.hasOwnProperty(ue.length)||ft(`Function '${z}' called with an invalid number of arguments (${ue.length}) - expects one of (${M[I].overloadTable})!`),M[I].overloadTable[ue.length].apply(this,ue)},M[I].overloadTable=[],M[I].overloadTable[te.argCount]=te}},Pi=(M,I,z)=>{o.hasOwnProperty(M)?(ft(`Cannot register public name '${M}' twice`),yi(o,M,M),o[M].overloadTable.hasOwnProperty(z)&&ft(`Cannot register multiple overloads of a function with the same number of arguments (${z})!`),o[M].overloadTable[z]=I):(o[M]=I,o[M].argCount=z)},Ni=48,or=57,wo=M=>{M=M.replace(/[^a-zA-Z0-9_]/g,"$");var I=M.charCodeAt(0);return I>=Ni&&I<=or?`_${M}`:M};function Ts(M,I,z,te,ue,Te,De,ve){this.name=M,this.constructor=I,this.instancePrototype=z,this.rawDestructor=te,this.baseClass=ue,this.getActualType=Te,this.upcast=De,this.downcast=ve,this.pureVirtualFunctions=[]}var sr=(M,I,z)=>{for(;I!==z;)I.upcast||ft(`Expected null or instance of ${z.name}, got an instance of ${I.name}`),M=I.upcast(M),I=I.baseClass;return M};function So(M,I){if(I===null)return this.isReference&&ft(`null is not a valid ${this.name}`),0;I.$$||ft(`Cannot pass "${na(I)}" as a ${this.name}`),I.$$.ptr||ft(`Cannot pass deleted object as a pointer of type ${this.name}`);var z=I.$$.ptrType.registeredClass,te=sr(I.$$.ptr,z,this.registeredClass);return te}function Ti(M,I){var z;if(I===null)return this.isReference&&ft(`null is not a valid ${this.name}`),this.isSmartPointer?(z=this.rawConstructor(),M!==null&&M.push(this.rawDestructor,z),z):0;(!I||!I.$$)&&ft(`Cannot pass "${na(I)}" as a ${this.name}`),I.$$.ptr||ft(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&I.$$.ptrType.isConst&&ft(`Cannot convert argument of type ${I.$$.smartPtrType?I.$$.smartPtrType.name:I.$$.ptrType.name} to parameter type ${this.name}`);var te=I.$$.ptrType.registeredClass;if(z=sr(I.$$.ptr,te,this.registeredClass),this.isSmartPointer)switch(I.$$.smartPtr===void 0&&ft("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:I.$$.smartPtrType===this?z=I.$$.smartPtr:ft(`Cannot convert argument of type ${I.$$.smartPtrType?I.$$.smartPtrType.name:I.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:z=I.$$.smartPtr;break;case 2:if(I.$$.smartPtrType===this)z=I.$$.smartPtr;else{var ue=I.clone();z=this.rawShare(z,Yn.toHandle(()=>ue.delete())),M!==null&&M.push(this.rawDestructor,z)}break;default:ft("Unsupporting sharing policy")}return z}function Zi(M,I){if(I===null)return this.isReference&&ft(`null is not a valid ${this.name}`),0;I.$$||ft(`Cannot pass "${na(I)}" as a ${this.name}`),I.$$.ptr||ft(`Cannot pass deleted object as a pointer of type ${this.name}`),I.$$.ptrType.isConst&&ft(`Cannot convert argument of type ${I.$$.ptrType.name} to parameter type ${this.name}`);var z=I.$$.ptrType.registeredClass,te=sr(I.$$.ptr,z,this.registeredClass);return te}var Cs=()=>{Object.assign(Xn.prototype,{getPointee(M){return this.rawGetPointee&&(M=this.rawGetPointee(M)),M},destructor(M){this.rawDestructor?.(M)},argPackAdvance:$n,readValueFromPointer:xn,fromWireType:vn})};function Xn(M,I,z,te,ue,Te,De,ve,_e,O,R){this.name=M,this.registeredClass=I,this.isReference=z,this.isConst=te,this.isSmartPointer=ue,this.pointeeType=Te,this.sharingPolicy=De,this.rawGetPointee=ve,this.rawConstructor=_e,this.rawShare=O,this.rawDestructor=R,!ue&&I.baseClass===void 0?te?(this.toWireType=So,this.destructorFunction=null):(this.toWireType=Zi,this.destructorFunction=null):this.toWireType=Ti}var ba=(M,I,z)=>{o.hasOwnProperty(M)||Re("Replacing nonexistent public symbol"),o[M].overloadTable!==void 0&&z!==void 0||(o[M]=I,o[M].argCount=z)},Ai=(M,I,z)=>{M=M.replace(/p/g,"i");var te=o["dynCall_"+M];return te(I,...z)},cr=[],La,ni=M=>{var I=cr[M];return I||(M>=cr.length&&(cr.length=M+1),cr[M]=I=La.get(M)),I},Hr=(M,I,z=[])=>{if(M.includes("j"))return Ai(M,I,z);var te=ni(I)(...z);return te},Ji=(M,I)=>(...z)=>Hr(M,I,z),zn=(M,I)=>{M=Gt(M);function z(){return M.includes("j")?Ji(M,I):ni(I)}var te=z();return typeof te!="function"&&ft(`unknown function pointer with signature ${M}: ${I}`),te},ws=(M,I)=>{var z=ti(I,function(te){this.name=I,this.message=te;var ue=new Error(te).stack;ue!==void 0&&(this.stack=this.toString()+`
`+ue.replace(/^Error(:[^\n]*)?\n/,""))});return z.prototype=Object.create(M.prototype),z.prototype.constructor=z,z.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},z},jr,xo=M=>{var I=he(M),z=Gt(I);return ye(I),z},Va=(M,I)=>{var z=[],te={};function ue(Te){if(!te[Te]&&!Lt[Te]){if(jt[Te]){jt[Te].forEach(ue);return}z.push(Te),te[Te]=!0}}throw I.forEach(ue),new jr(`${M}: `+z.map(xo).join([", "]))},Ss=(M,I,z,te,ue,Te,De,ve,_e,O,R,x,E)=>{R=Gt(R),Te=zn(ue,Te),ve&&=zn(De,ve),O&&=zn(_e,O),E=zn(x,E);var b=wo(R);Pi(b,function(){Va(`Cannot construct ${R} due to unbound types`,[te])}),Fe([M,I,z],te?[te]:[],G=>{G=G[0];var X,Z;te?(X=G.registeredClass,Z=X.instancePrototype):Z=fn.prototype;var ee=ti(R,function(...Ne){if(Object.getPrototypeOf(this)!==ie)throw new zr("Use 'new' to construct "+R);if(le.constructor_body===void 0)throw new zr(R+" has no accessible constructor");var lt=le.constructor_body[Ne.length];if(lt===void 0)throw new zr(`Tried to invoke ctor of ${R} with invalid number of parameters (${Ne.length}) - expected (${Object.keys(le.constructor_body).toString()}) parameters instead!`);return lt.apply(this,Ne)}),ie=Object.create(Z,{constructor:{value:ee}});ee.prototype=ie;var le=new Ts(R,ee,ie,E,X,Te,ve,O);le.baseClass&&(le.baseClass.__derivedClasses??=[],le.baseClass.__derivedClasses.push(le));var Ce=new Xn(R,le,!0,!1,!1),be=new Xn(R+"*",le,!1,!1,!1),Ge=new Xn(R+" const*",le,!1,!0,!1);return Xi[M]={pointerType:be,constPointerType:Ge},ba(b,ee),[Ce,be,Ge]})},Eo=(M,I)=>{for(var z=[],te=0;te<M;te++)z.push(U[I+te*4>>2]);return z};function Cr(M){for(var I=1;I<M.length;++I)if(M[I]!==null&&M[I].destructorFunction===void 0)return!0;return!1}function wr(M,I){if(!(M instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof M} which is not a function`);var z=ti(M.name||"unknownFunctionName",function(){});z.prototype=M.prototype;var te=new z,ue=M.apply(te,I);return ue instanceof Object?ue:te}function Oo(M,I,z,te){var ue=Cr(M),Te=M.length-2,De=[],ve=["fn"];I&&ve.push("thisWired");for(var _e=0;_e<Te;++_e)De.push(`arg${_e}`),ve.push(`arg${_e}Wired`);De=De.join(","),ve=ve.join(",");var O=`return function (${De}) {
`;ue&&(O+=`var destructors = [];
`);var R=ue?"destructors":"null",x=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];I&&(O+=`var thisWired = classParam['toWireType'](${R}, this);
`);for(var _e=0;_e<Te;++_e)O+=`var arg${_e}Wired = argType${_e}['toWireType'](${R}, arg${_e});
`,x.push(`argType${_e}`);if(O+=(z||te?"var rv = ":"")+`invoker(${ve});
`,ue)O+=`runDestructors(destructors);
`;else for(var _e=I?1:2;_e<M.length;++_e){var E=_e===1?"thisWired":"arg"+(_e-2)+"Wired";M[_e].destructorFunction!==null&&(O+=`${E}_dtor(${E});
`,x.push(`${E}_dtor`))}return z&&(O+=`var ret = retType['fromWireType'](rv);
return ret;
`),O+=`}
`,[x,O]}function Ln(M,I,z,te,ue,Te){var De=I.length;De<2&&ft("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var ve=I[1]!==null&&z!==null,_e=Cr(I),O=I[0].name!=="void",R=[M,ft,te,ue,_t,I[0],I[1]],x=0;x<De-2;++x)R.push(I[x+2]);if(!_e)for(var x=ve?1:2;x<I.length;++x)I[x].destructorFunction!==null&&R.push(I[x].destructorFunction);let[E,b]=Oo(I,ve,O,Te);E.push(b);var G=wr(Function,E)(...R);return ti(M,G)}var Ro=(M,I,z,te,ue,Te)=>{var De=Eo(I,z);ue=zn(te,ue),Fe([],[M],ve=>{ve=ve[0];var _e=`constructor ${ve.name}`;if(ve.registeredClass.constructor_body===void 0&&(ve.registeredClass.constructor_body=[]),ve.registeredClass.constructor_body[I-1]!==void 0)throw new zr(`Cannot register multiple constructors with identical number of parameters (${I-1}) for class '${ve.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return ve.registeredClass.constructor_body[I-1]=()=>{Va(`Cannot construct ${ve.name} due to unbound types`,De)},Fe([],De,O=>(O.splice(1,0,null),ve.registeredClass.constructor_body[I-1]=Ln(_e,O,null,ue,Te),[])),[]})},Pa=M=>{M=M.trim();const I=M.indexOf("(");return I!==-1?M.substr(0,I):M},Qi=(M,I,z,te,ue,Te,De,ve,_e,O)=>{var R=Eo(z,te);I=Gt(I),I=Pa(I),Te=zn(ue,Te),Fe([],[M],x=>{x=x[0];var E=`${x.name}.${I}`;I.startsWith("@@")&&(I=Symbol[I.substring(2)]),ve&&x.registeredClass.pureVirtualFunctions.push(I);function b(){Va(`Cannot call ${E} due to unbound types`,R)}var G=x.registeredClass.instancePrototype,X=G[I];return X===void 0||X.overloadTable===void 0&&X.className!==x.name&&X.argCount===z-2?(b.argCount=z-2,b.className=x.name,G[I]=b):(yi(G,I,E),G[I].overloadTable[z-2]=b),Fe([],R,Z=>{var ee=Ln(E,Z,x,Te,De,_e);return G[I].overloadTable===void 0?(ee.argCount=z-2,G[I]=ee):G[I].overloadTable[z-2]=ee,[]}),[]})},sn=[],br=[],ea=M=>{M>9&&--br[M+1]===0&&(br[M]=void 0,sn.push(M))},Hn=()=>br.length/2-5-sn.length,Do=()=>{br.push(0,1,void 0,1,null,1,!0,1,!1,1),o.count_emval_handles=Hn},Yn={toValue:M=>(M||ft("Cannot use deleted val. handle = "+M),br[M]),toHandle:M=>{switch(M){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const I=sn.pop()||br.length;return br[I]=M,br[I+1]=1,I}}}},lr={name:"emscripten::val",fromWireType:M=>{var I=Yn.toValue(M);return ea(M),I},toWireType:(M,I)=>Yn.toHandle(I),argPackAdvance:$n,readValueFromPointer:xn,destructorFunction:null},ta=M=>En(M,lr),na=M=>{if(M===null)return"null";var I=typeof M;return I==="object"||I==="array"||I==="function"?M.toString():""+M},xs=(M,I)=>{switch(I){case 4:return function(z){return this.fromWireType(H[z>>2])};case 8:return function(z){return this.fromWireType(W[z>>3])};default:throw new TypeError(`invalid float width (${I}): ${M}`)}},ra=(M,I,z)=>{I=Gt(I),En(M,{name:I,fromWireType:te=>te,toWireType:(te,ue)=>ue,argPackAdvance:$n,readValueFromPointer:xs(I,z),destructorFunction:null})},Qt=(M,I,z)=>{switch(I){case 1:return z?te=>N[te]:te=>P[te];case 2:return z?te=>F[te>>1]:te=>B[te>>1];case 4:return z?te=>k[te>>2]:te=>U[te>>2];default:throw new TypeError(`invalid integer width (${I}): ${M}`)}},Na=(M,I,z,te,ue)=>{I=Gt(I);var Te=R=>R;if(te===0){var De=32-8*z;Te=R=>R<<De>>>De}var ve=I.includes("unsigned"),_e=(R,x)=>{},O;ve?O=function(R,x){return _e(x,this.name),x>>>0}:O=function(R,x){return _e(x,this.name),x},En(M,{name:I,fromWireType:Te,toWireType:O,argPackAdvance:$n,readValueFromPointer:Qt(I,z,te!==0),destructorFunction:null})},ia=(M,I,z)=>{var te=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],ue=te[I];function Te(De){var ve=U[De>>2],_e=U[De+4>>2];return new ue(N.buffer,_e,ve)}z=Gt(z),En(M,{name:z,fromWireType:Te,argPackAdvance:$n,readValueFromPointer:Te},{ignoreDuplicateRegistrations:!0})},Vn=(M,I,z,te)=>{if(!(te>0))return 0;for(var ue=z,Te=z+te-1,De=0;De<M.length;++De){var ve=M.charCodeAt(De);if(ve>=55296&&ve<=57343){var _e=M.charCodeAt(++De);ve=65536+((ve&1023)<<10)|_e&1023}if(ve<=127){if(z>=Te)break;I[z++]=ve}else if(ve<=2047){if(z+1>=Te)break;I[z++]=192|ve>>6,I[z++]=128|ve&63}else if(ve<=65535){if(z+2>=Te)break;I[z++]=224|ve>>12,I[z++]=128|ve>>6&63,I[z++]=128|ve&63}else{if(z+3>=Te)break;I[z++]=240|ve>>18,I[z++]=128|ve>>12&63,I[z++]=128|ve>>6&63,I[z++]=128|ve&63}}return I[z]=0,z-ue},Aa=(M,I,z)=>Vn(M,P,I,z),ur=M=>{for(var I=0,z=0;z<M.length;++z){var te=M.charCodeAt(z);te<=127?I++:te<=2047?I+=2:te>=55296&&te<=57343?(I+=4,++z):I+=3}return I},Mo=typeof TextDecoder<"u"?new TextDecoder:void 0,Ci=(M,I=0,z=NaN)=>{for(var te=I+z,ue=I;M[ue]&&!(ue>=te);)++ue;if(ue-I>16&&M.buffer&&Mo)return Mo.decode(M.subarray(I,ue));for(var Te="";I<ue;){var De=M[I++];if(!(De&128)){Te+=String.fromCharCode(De);continue}var ve=M[I++]&63;if((De&224)==192){Te+=String.fromCharCode((De&31)<<6|ve);continue}var _e=M[I++]&63;if((De&240)==224?De=(De&15)<<12|ve<<6|_e:De=(De&7)<<18|ve<<12|_e<<6|M[I++]&63,De<65536)Te+=String.fromCharCode(De);else{var O=De-65536;Te+=String.fromCharCode(55296|O>>10,56320|O&1023)}}return Te},Lr=(M,I)=>M?Ci(P,M,I):"",Es=(M,I)=>{I=Gt(I),En(M,{name:I,fromWireType(z){for(var te=U[z>>2],ue=z+4,Te,De,ve=ue,De=0;De<=te;++De){var _e=ue+De;if(De==te||P[_e]==0){var O=_e-ve,R=Lr(ve,O);Te===void 0?Te=R:(Te+="\0",Te+=R),ve=_e+1}}return ye(z),Te},toWireType(z,te){te instanceof ArrayBuffer&&(te=new Uint8Array(te));var ue,Te=typeof te=="string";Te||te instanceof Uint8Array||te instanceof Uint8ClampedArray||te instanceof Int8Array||ft("Cannot pass non-string to std::string"),Te?ue=ur(te):ue=te.length;var De=xe(4+ue+1),ve=De+4;if(U[De>>2]=ue,Te)Aa(te,ve,ue+1);else if(Te)for(var _e=0;_e<ue;++_e){var O=te.charCodeAt(_e);O>255&&(ye(ve),ft("String has UTF-16 code units that do not fit in 8 bits")),P[ve+_e]=O}else for(var _e=0;_e<ue;++_e)P[ve+_e]=te[_e];return z!==null&&z.push(ye,De),De},argPackAdvance:$n,readValueFromPointer:xn,destructorFunction(z){ye(z)}})},wi=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,fr=(M,I)=>{for(var z=M,te=z>>1,ue=te+I/2;!(te>=ue)&&B[te];)++te;if(z=te<<1,z-M>32&&wi)return wi.decode(P.subarray(M,z));for(var Te="",De=0;!(De>=I/2);++De){var ve=F[M+De*2>>1];if(ve==0)break;Te+=String.fromCharCode(ve)}return Te},_o=(M,I,z)=>{if(z??=2147483647,z<2)return 0;z-=2;for(var te=I,ue=z<M.length*2?z/2:M.length,Te=0;Te<ue;++Te){var De=M.charCodeAt(Te);F[I>>1]=De,I+=2}return F[I>>1]=0,I-te},Os=M=>M.length*2,Rs=(M,I)=>{for(var z=0,te="";!(z>=I/4);){var ue=k[M+z*4>>2];if(ue==0)break;if(++z,ue>=65536){var Te=ue-65536;te+=String.fromCharCode(55296|Te>>10,56320|Te&1023)}else te+=String.fromCharCode(ue)}return te},Io=(M,I,z)=>{if(z??=2147483647,z<4)return 0;for(var te=I,ue=te+z-4,Te=0;Te<M.length;++Te){var De=M.charCodeAt(Te);if(De>=55296&&De<=57343){var ve=M.charCodeAt(++Te);De=65536+((De&1023)<<10)|ve&1023}if(k[I>>2]=De,I+=4,I+4>ue)break}return k[I>>2]=0,I-te},aa=M=>{for(var I=0,z=0;z<M.length;++z){var te=M.charCodeAt(z);te>=55296&&te<=57343&&++z,I+=4}return I},bo=(M,I,z)=>{z=Gt(z);var te,ue,Te,De;I===2?(te=fr,ue=_o,De=Os,Te=ve=>B[ve>>1]):I===4&&(te=Rs,ue=Io,De=aa,Te=ve=>U[ve>>2]),En(M,{name:z,fromWireType:ve=>{for(var _e=U[ve>>2],O,R=ve+4,x=0;x<=_e;++x){var E=ve+4+x*I;if(x==_e||Te(E)==0){var b=E-R,G=te(R,b);O===void 0?O=G:(O+="\0",O+=G),R=E+I}}return ye(ve),O},toWireType:(ve,_e)=>{typeof _e!="string"&&ft(`Cannot pass non-string to C++ string type ${z}`);var O=De(_e),R=xe(4+O+I);return U[R>>2]=O/I,ue(_e,R+4,O+I),ve!==null&&ve.push(ye,R),R},argPackAdvance:$n,readValueFromPointer:xn,destructorFunction(ve){ye(ve)}})},Fa=(M,I,z,te,ue,Te)=>{kt[M]={name:Gt(I),rawConstructor:zn(z,te),rawDestructor:zn(ue,Te),fields:[]}},Ds=(M,I,z,te,ue,Te,De,ve,_e,O)=>{kt[M].fields.push({fieldName:Gt(I),getterReturnType:z,getter:zn(te,ue),getterContext:Te,setterArgumentType:De,setter:zn(ve,_e),setterContext:O})},Ms=(M,I)=>{I=Gt(I),En(M,{isVoid:!0,name:I,argPackAdvance:0,fromWireType:()=>{},toWireType:(z,te)=>{}})},_s=(M,I,z)=>P.copyWithin(M,I,I+z),Ua=[],Is=(M,I,z,te)=>(M=Ua[M],I=Yn.toValue(I),M(null,I,z,te)),bs={},Ls=M=>{var I=bs[M];return I===void 0?Gt(M):I},ka=()=>typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")(),Vs=M=>M===0?Yn.toHandle(ka()):(M=Ls(M),Yn.toHandle(ka()[M])),Lo=M=>{var I=Ua.length;return Ua.push(M),I},Vo=(M,I)=>{var z=Lt[M];return z===void 0&&ft(`${I} has unknown type ${xo(M)}`),z},Ps=(M,I)=>{for(var z=new Array(M),te=0;te<M;++te)z[te]=Vo(U[I+te*4>>2],"parameter "+te);return z},Ga=(M,I,z)=>{var te=[],ue=M.toWireType(te,z);return te.length&&(U[I>>2]=Yn.toHandle(te)),ue},Ns=(M,I,z)=>{var te=Ps(M,I),ue=te.shift();M--;var Te=`return function (obj, func, destructorsRef, args) {
`,De=0,ve=[];z===0&&ve.push("obj");for(var _e=["retType"],O=[ue],R=0;R<M;++R)ve.push("arg"+R),_e.push("argType"+R),O.push(te[R]),Te+=`  var arg${R} = argType${R}.readValueFromPointer(args${De?"+"+De:""});
`,De+=te[R].argPackAdvance;var x=z===1?"new func":"func.call";Te+=`  var rv = ${x}(${ve.join(", ")});
`,ue.isVoid||(_e.push("emval_returnValue"),O.push(Ga),Te+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Te+=`};
`,_e.push(Te);var E=wr(Function,_e)(...O),b=`methodCaller<(${te.map(G=>G.name).join(", ")}) => ${ue.name}>`;return Lo(ti(b,E))},Po=M=>{var I=Yn.toValue(M);_t(I),ea(M)},No=(M,I)=>{M=Vo(M,"_emval_take_value");var z=M.readValueFromPointer(I);return Yn.toHandle(z)},Ao=()=>2147483648,Fo=()=>Ao(),As=(M,I)=>Math.ceil(M/I)*I,Fs=M=>{var I=_.buffer,z=(M-I.byteLength+65535)/65536|0;try{return _.grow(z),J(),1}catch{}},Us=M=>{var I=P.length;M>>>=0;var z=Ao();if(M>z)return!1;for(var te=1;te<=4;te*=2){var ue=I*(1+.2/te);ue=Math.min(ue,M+100663296);var Te=Math.min(z,As(Math.max(M,ue),65536)),De=Fs(Te);if(De)return!0}return!1},Ba={},ks=()=>p||"./this.program",Fi=()=>{if(!Fi.strings){var M=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",I={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:M,_:ks()};for(var z in Ba)Ba[z]===void 0?delete I[z]:I[z]=Ba[z];var te=[];for(var z in I)te.push(`${z}=${I[z]}`);Fi.strings=te}return Fi.strings},Gs=(M,I)=>{for(var z=0;z<M.length;++z)N[I++]=M.charCodeAt(z);N[I]=0},$a=(M,I)=>{var z=0;return Fi().forEach((te,ue)=>{var Te=I+z;U[M+ue*4>>2]=Te,Gs(te,Te),z+=te.length+1}),0},Wa=(M,I)=>{var z=Fi();U[M>>2]=z.length;var te=0;return z.forEach(ue=>te+=ue.length+1),U[I>>2]=te,0},Si=M=>52;function Vr(M,I,z,te,ue){return 70}var Uo=[null,[],[]],ko=(M,I)=>{var z=Uo[M];I===0||I===10?((M===1?C:w)(Ci(z)),z.length=0):z.push(I)},za=(M,I,z,te)=>{for(var ue=0,Te=0;Te<z;Te++){var De=U[I>>2],ve=U[I+4>>2];I+=8;for(var _e=0;_e<ve;_e++)ko(M,P[De+_e]);ue+=ve}return U[te>>2]=ue,0},Go=M=>{var I=o["_"+M];return I},oa=(M,I)=>{N.set(M,I)},Ha=M=>Se(M),L=M=>{var I=ur(M)+1,z=Ha(I);return Aa(M,z,I),z},V=(M,I,z,te,ue)=>{var Te={string:G=>{var X=0;return G!=null&&G!==0&&(X=L(G)),X},array:G=>{var X=Ha(G.length);return oa(G,X),X}};function De(G){return I==="string"?Lr(G):I==="boolean"?!!G:G}var ve=Go(M),_e=[],O=0;if(te)for(var R=0;R<te.length;R++){var x=Te[z[R]];x?(O===0&&(O=oe()),_e[R]=x(te[R])):_e[R]=te[R]}var E=ve(..._e);function b(G){return O!==0&&K(O),De(G)}return E=b(E),E};ge=o.InternalError=class extends Error{constructor(I){super(I),this.name="InternalError"}},vr(),zr=o.BindingError=class extends Error{constructor(I){super(I),this.name="BindingError"}},Ct(),Cs(),jr=o.UnboundTypeError=ws(Error,"UnboundTypeError"),Do();var Y={A:st,p:St,e:It,o:_r,y:ln,m:Ss,l:Ro,b:Qi,w:ta,i:ra,d:Na,a:ia,x:Es,g:bo,f:Fa,c:Ds,z:Ms,v:_s,C:Is,D:ea,E:Vs,j:Ns,B:Po,k:No,r:Fo,q:Us,s:$a,t:Wa,u:Si,n:Vr,h:za},se;j();var he=M=>(he=se.H)(M),xe=M=>(xe=se.J)(M),ye=M=>(ye=se.K)(M),pe=M=>(pe=se.L)(M),Se=M=>(Se=se.M)(M),Le=()=>(Le=se.N)();o.dynCall_iji=(M,I,z,te)=>(o.dynCall_iji=se.O)(M,I,z,te),o.dynCall_jji=(M,I,z,te)=>(o.dynCall_jji=se.P)(M,I,z,te),o.dynCall_iiji=(M,I,z,te,ue)=>(o.dynCall_iiji=se.Q)(M,I,z,te,ue),o.dynCall_jiji=(M,I,z,te,ue)=>(o.dynCall_jiji=se.R)(M,I,z,te,ue),o.ccall=V;var We;Qe=function M(){We||Je(),We||(Qe=M)};function Je(){if(qe>0||(ae(),qe>0))return;function M(){We||(We=!0,o.calledRun=!0,!D&&(me(),s(o),o.onRuntimeInitialized?.(),de()))}o.setStatus?(o.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>o.setStatus(""),1),M()},1)):M()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return Je(),a=l,a})})();t.exports=n,t.exports.default=n})(Bd)),Bd.exports}var NX=PX();const AX=ji(NX),FX=new URL("/radiology-ai-viewer/assets/openjpegwasm_decode-B3gWTHpv.wasm",import.meta.url),hl={codec:void 0,decoder:void 0,decodeConfig:{}};function UX(t){if(hl.decodeConfig=t,hl.codec)return Promise.resolve();const e=AX({locateFile:n=>n.endsWith(".wasm")?FX.toString():n});return new Promise((n,r)=>{e.then(i=>{hl.codec=i,hl.decoder=new i.J2KDecoder,n()},r)})}async function U4(t,e){await UX();const n=hl.decoder,r=n.getEncodedBuffer(t.length);r.set(t),n.decode();const i=n.getFrameInfo(),a=n.getDecodedBuffer();new Uint8Array(a.length).set(a);const s=`x: ${n.getImageOffset().x}, y: ${n.getImageOffset().y}`,c=n.getNumDecompositions(),l=n.getNumLayers(),f=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][n.getProgressionOrder()+1],u=n.getIsReversible(),g=`${n.getBlockDimensions().width} x ${n.getBlockDimensions().height}`,d=`${n.getTileSize().width} x ${n.getTileSize().height}`,p=`${n.getTileOffset().x}, ${n.getTileOffset().y}`,h=n.getColorSpace(),m=`${a.length.toLocaleString()} bytes`,v=`${(a.length/r.length).toFixed(2)}:1`,y={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:i.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},T=kX(i,a),C={imageOffset:s,numDecompositions:c,numLayers:l,progessionOrder:f,reversible:u,blockDimensions:g,tileSize:d,tileOffset:p,colorTransform:h,decodedSize:m,compressionRatio:v};return{...e,pixelData:T,imageInfo:y,encodeOptions:C,...C,...y}}function kX(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var $d={exports:{}},k4;function GX(){return k4||(k4=1,(function(t,e){var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),(function(a){a=a||{};var a=typeof a<"u"?a:{},o,s;a.ready=new Promise(function(O,R){o=O,s=R});var c=Object.assign({},a),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function d(O){return a.locateFile?a.locateFile(O,g):g+O}var p,h,m;if(u){var v=ho,y=ho;f?g=y.dirname(g)+"/":g=__dirname+"/",p=(O,R)=>(O=j(O)?new URL(O):y.normalize(O),v.readFileSync(O,R?void 0:"utf8")),m=O=>{var R=p(O,!0);return R.buffer||(R=new Uint8Array(R)),R},h=(O,R,x)=>{O=j(O)?new URL(O):y.normalize(O),v.readFile(O,function(E,b){E?x(E):R(b.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(O){if(!(O instanceof Ae))throw O}),process.on("unhandledRejection",function(O){throw O}),a.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),r&&(g=r),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",p=O=>{var R=new XMLHttpRequest;return R.open("GET",O,!1),R.send(null),R.responseText},f&&(m=O=>{var R=new XMLHttpRequest;return R.open("GET",O,!1),R.responseType="arraybuffer",R.send(null),new Uint8Array(R.response)}),h=(O,R,x)=>{var E=new XMLHttpRequest;E.open("GET",O,!0),E.responseType="arraybuffer",E.onload=()=>{if(E.status==200||E.status==0&&E.response){R(E.response);return}x()},E.onerror=x,E.send(null)});var T=a.print||console.log.bind(console),C=a.printErr||console.warn.bind(console);Object.assign(a,c),c=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit;var w;a.wasmBinary&&(w=a.wasmBinary),a.noExitRuntime,typeof WebAssembly!="object"&&tn("no native wasm support detected");var S,_=!1;function D(O,R){O||tn(R)}var N=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function P(O,R,x){for(var E=R+x,b=R;O[b]&&!(b>=E);)++b;if(b-R>16&&O.buffer&&N)return N.decode(O.subarray(R,b));for(var G="";R<b;){var X=O[R++];if(!(X&128)){G+=String.fromCharCode(X);continue}var Z=O[R++]&63;if((X&224)==192){G+=String.fromCharCode((X&31)<<6|Z);continue}var ee=O[R++]&63;if((X&240)==224?X=(X&15)<<12|Z<<6|ee:X=(X&7)<<18|Z<<12|ee<<6|O[R++]&63,X<65536)G+=String.fromCharCode(X);else{var ie=X-65536;G+=String.fromCharCode(55296|ie>>10,56320|ie&1023)}}return G}function F(O,R){return O?P(J,O,R):""}function B(O,R,x,E){if(!(E>0))return 0;for(var b=x,G=x+E-1,X=0;X<O.length;++X){var Z=O.charCodeAt(X);if(Z>=55296&&Z<=57343){var ee=O.charCodeAt(++X);Z=65536+((Z&1023)<<10)|ee&1023}if(Z<=127){if(x>=G)break;R[x++]=Z}else if(Z<=2047){if(x+1>=G)break;R[x++]=192|Z>>6,R[x++]=128|Z&63}else if(Z<=65535){if(x+2>=G)break;R[x++]=224|Z>>12,R[x++]=128|Z>>6&63,R[x++]=128|Z&63}else{if(x+3>=G)break;R[x++]=240|Z>>18,R[x++]=128|Z>>12&63,R[x++]=128|Z>>6&63,R[x++]=128|Z&63}}return R[x]=0,x-b}function k(O,R,x){return B(O,J,R,x)}function U(O){for(var R=0,x=0;x<O.length;++x){var E=O.charCodeAt(x);E<=127?R++:E<=2047?R+=2:E>=55296&&E<=57343?(R+=4,++x):R+=3}return R}var H,W,J,ne,q,Q,ae,me,de;function je(O){H=O,a.HEAP8=W=new Int8Array(O),a.HEAP16=ne=new Int16Array(O),a.HEAP32=Q=new Int32Array(O),a.HEAPU8=J=new Uint8Array(O),a.HEAPU16=q=new Uint16Array(O),a.HEAPU32=ae=new Uint32Array(O),a.HEAPF32=me=new Float32Array(O),a.HEAPF64=de=new Float64Array(O)}a.INITIAL_MEMORY;var $e,Be=[],qe=[],Qe=[];function ut(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)et(a.preRun.shift());st(Be)}function ke(){st(qe)}function Xe(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Zt(a.postRun.shift());st(Qe)}function et(O){Be.unshift(O)}function $t(O){qe.unshift(O)}function Zt(O){Qe.unshift(O)}var Kt=0,Jt=null;function qt(O){Kt++,a.monitorRunDependencies&&a.monitorRunDependencies(Kt)}function on(O){if(Kt--,a.monitorRunDependencies&&a.monitorRunDependencies(Kt),Kt==0&&Jt){var R=Jt;Jt=null,R()}}function tn(O){a.onAbort&&a.onAbort(O),O="Aborted("+O+")",C(O),_=!0,O+=". Build with -sASSERTIONS for more info.";var R=new WebAssembly.RuntimeError(O);throw s(R),R}var ir="data:application/octet-stream;base64,";function $(O){return O.startsWith(ir)}function j(O){return O.startsWith("file://")}var re;re="openjphjs.wasm",$(re)||(re=d(re));function K(O){try{if(O==re&&w)return new Uint8Array(w);if(m)return m(O);throw"both async and sync fetching of the wasm failed"}catch(R){tn(R)}}function oe(){if(!w&&(l||f)){if(typeof fetch=="function"&&!j(re))return fetch(re,{credentials:"same-origin"}).then(function(O){if(!O.ok)throw"failed to load wasm binary file at '"+re+"'";return O.arrayBuffer()}).catch(function(){return K(re)});if(h)return new Promise(function(O,R){h(re,function(x){O(new Uint8Array(x))},R)})}return Promise.resolve().then(function(){return K(re)})}function we(){var O={env:L,wasi_snapshot_preview1:L};function R(X,Z){var ee=X.exports;a.asm=ee,S=a.asm.memory,je(S.buffer),$e=a.asm.__indirect_function_table,$t(a.asm.__wasm_call_ctors),on()}qt();function x(X){R(X.instance)}function E(X){return oe().then(function(Z){return WebAssembly.instantiate(Z,O)}).then(function(Z){return Z}).then(X,function(Z){C("failed to asynchronously prepare wasm: "+Z),tn(Z)})}function b(){return!w&&typeof WebAssembly.instantiateStreaming=="function"&&!$(re)&&!j(re)&&!u&&typeof fetch=="function"?fetch(re,{credentials:"same-origin"}).then(function(X){var Z=WebAssembly.instantiateStreaming(X,O);return Z.then(x,function(ee){return C("wasm streaming compile failed: "+ee),C("falling back to ArrayBuffer instantiation"),E(x)})}):E(x)}if(a.instantiateWasm)try{var G=a.instantiateWasm(O,R);return G}catch(X){C("Module.instantiateWasm callback failed with error: "+X),s(X)}return b().catch(s),{}}function Ae(O){this.name="ExitStatus",this.message="Program terminated with exit("+O+")",this.status=O}function st(O){for(;O.length>0;)O.shift()(a)}function St(O,R,x,E){tn("Assertion failed: "+F(O)+", at: "+[R?F(R):"unknown filename",x,E?F(E):"unknown function"])}var kt=[];function _t(O){O.add_ref()}function xn(O){var R=new Fe(O);return R.get_caught()||R.set_caught(!0),R.set_rethrown(!1),kt.push(R),_t(R),R.get_exception_ptr()}var pt=0,Lt=[];function jt(O){var R=Lt[O];return R||(O>=Lt.length&&(Lt.length=O+1),Lt[O]=R=$e.get(O)),R}function ge(O){if(O.release_ref()&&!O.get_rethrown()){var R=O.get_destructor();R&&jt(R)(O.excPtr),se(O.excPtr)}}function Re(){_setThrew(0);var O=kt.pop();ge(O),pt=0}function Fe(O){this.excPtr=O,this.ptr=O-24,this.set_type=function(R){ae[this.ptr+4>>2]=R},this.get_type=function(){return ae[this.ptr+4>>2]},this.set_destructor=function(R){ae[this.ptr+8>>2]=R},this.get_destructor=function(){return ae[this.ptr+8>>2]},this.set_refcount=function(R){Q[this.ptr>>2]=R},this.set_caught=function(R){R=R?1:0,W[this.ptr+12>>0]=R},this.get_caught=function(){return W[this.ptr+12>>0]!=0},this.set_rethrown=function(R){R=R?1:0,W[this.ptr+13>>0]=R},this.get_rethrown=function(){return W[this.ptr+13>>0]!=0},this.init=function(R,x){this.set_adjusted_ptr(0),this.set_type(R),this.set_destructor(x),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var R=Q[this.ptr>>2];Q[this.ptr>>2]=R+1},this.release_ref=function(){var R=Q[this.ptr>>2];return Q[this.ptr>>2]=R-1,R===1},this.set_adjusted_ptr=function(R){ae[this.ptr+16>>2]=R},this.get_adjusted_ptr=function(){return ae[this.ptr+16>>2]},this.get_exception_ptr=function(){var R=We(this.get_type());if(R)return ae[this.excPtr>>2];var x=this.get_adjusted_ptr();return x!==0?x:this.excPtr}}function It(O){throw pt||(pt=O),O}function _r(){var O=pt;if(!O)return xe(0),0;var R=new Fe(O);R.set_adjusted_ptr(O);var x=R.get_type();if(!x)return xe(0),O;for(var E=0;E<arguments.length;E++){var b=arguments[E];if(b===0||b===x)break;var G=R.ptr+16;if(Le(b,x,G))return xe(b),O}return xe(x),O}function vr(){var O=pt;if(!O)return xe(0),0;var R=new Fe(O);R.set_adjusted_ptr(O);var x=R.get_type();if(!x)return xe(0),O;for(var E=0;E<arguments.length;E++){var b=arguments[E];if(b===0||b===x)break;var G=R.ptr+16;if(Le(b,x,G))return xe(b),O}return xe(x),O}function yr(O,R,x){var E=new Fe(O);throw E.init(R,x),pt=O,O}var Gt={};function zr(O){for(;O.length;){var R=O.pop(),x=O.pop();x(R)}}function ft(O){return this.fromWireType(Q[O>>2])}var Bn={},En={},$n={},ln=48,vi=57;function ht(O){if(O===void 0)return"_unknown";O=O.replace(/[^a-zA-Z0-9_]/g,"$");var R=O.charCodeAt(0);return R>=ln&&R<=vi?"_"+O:O}function Vt(O,R){return O=ht(O),new Function("body","return function "+O+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(R)}function Ir(O,R){var x=Vt(R,function(E){this.name=R,this.message=E;var b=new Error(E).stack;b!==void 0&&(this.stack=this.toString()+`
`+b.replace(/^Error(:[^\n]*)?\n/,""))});return x.prototype=Object.create(O.prototype),x.prototype.constructor=x,x.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},x}var Tt=void 0;function Wn(O){throw new Tt(O)}function Tr(O,R,x){O.forEach(function(Z){$n[Z]=R});function E(Z){var ee=x(Z);ee.length!==O.length&&Wn("Mismatched type converter count");for(var ie=0;ie<O.length;++ie)fn(O[ie],ee[ie])}var b=new Array(R.length),G=[],X=0;R.forEach((Z,ee)=>{En.hasOwnProperty(Z)?b[ee]=En[Z]:(G.push(Z),Bn.hasOwnProperty(Z)||(Bn[Z]=[]),Bn[Z].push(()=>{b[ee]=En[Z],++X,X===G.length&&E(b)}))}),G.length===0&&E(b)}function Xi(O){var R=Gt[O];delete Gt[O];var x=R.rawConstructor,E=R.rawDestructor,b=R.fields,G=b.map(X=>X.getterReturnType).concat(b.map(X=>X.setterArgumentType));Tr([O],G,X=>{var Z={};return b.forEach((ee,ie)=>{var le=ee.fieldName,Ce=X[ie],be=ee.getter,Ge=ee.getterContext,Ne=X[ie+b.length],lt=ee.setter,ct=ee.setterContext;Z[le]={read:Pt=>Ce.fromWireType(be(Ge,Pt)),write:(Pt,On)=>{var Pn=[];lt(ct,Pt,Ne.toWireType(Pn,On)),zr(Pn)}}}),[{name:R.name,fromWireType:function(ee){var ie={};for(var le in Z)ie[le]=Z[le].read(ee);return E(ee),ie},toWireType:function(ee,ie){for(var le in Z)if(!(le in ie))throw new TypeError('Missing field:  "'+le+'"');var Ce=x();for(le in Z)Z[le].write(Ce,ie[le]);return ee!==null&&ee.push(E,Ce),Ce},argPackAdvance:8,readValueFromPointer:ft,destructorFunction:E}]})}function Co(O,R,x,E,b){}function Vi(O){switch(O){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+O)}}function Yi(){for(var O=new Array(256),R=0;R<256;++R)O[R]=String.fromCharCode(R);ei=O}var ei=void 0;function vn(O){for(var R="",x=O;J[x];)R+=ei[J[x++]];return R}var ar=void 0;function Ct(O){throw new ar(O)}function fn(O,R,x={}){if(!("argPackAdvance"in R))throw new TypeError("registerType registeredInstance requires argPackAdvance");var E=R.name;if(O||Ct('type "'+E+'" must have a positive integer typeid pointer'),En.hasOwnProperty(O)){if(x.ignoreDuplicateRegistrations)return;Ct("Cannot register type '"+E+"' twice")}if(En[O]=R,delete $n[O],Bn.hasOwnProperty(O)){var b=Bn[O];delete Bn[O],b.forEach(G=>G())}}function ti(O,R,x,E,b){var G=Vi(x);R=vn(R),fn(O,{name:R,fromWireType:function(X){return!!X},toWireType:function(X,Z){return Z?E:b},argPackAdvance:8,readValueFromPointer:function(X){var Z;if(x===1)Z=W;else if(x===2)Z=ne;else if(x===4)Z=Q;else throw new TypeError("Unknown boolean type size: "+R);return this.fromWireType(Z[X>>G])},destructorFunction:null})}function yi(O){if(!(this instanceof wr)||!(O instanceof wr))return!1;for(var R=this.$$.ptrType.registeredClass,x=this.$$.ptr,E=O.$$.ptrType.registeredClass,b=O.$$.ptr;R.baseClass;)x=R.upcast(x),R=R.baseClass;for(;E.baseClass;)b=E.upcast(b),E=E.baseClass;return R===E&&x===b}function Pi(O){return{count:O.count,deleteScheduled:O.deleteScheduled,preservePointerOnDelete:O.preservePointerOnDelete,ptr:O.ptr,ptrType:O.ptrType,smartPtr:O.smartPtr,smartPtrType:O.smartPtrType}}function Ni(O){function R(x){return x.$$.ptrType.registeredClass.name}Ct(R(O)+" instance already deleted")}var or=!1;function wo(O){}function Ts(O){O.smartPtr?O.smartPtrType.rawDestructor(O.smartPtr):O.ptrType.registeredClass.rawDestructor(O.ptr)}function sr(O){O.count.value-=1;var R=O.count.value===0;R&&Ts(O)}function So(O,R,x){if(R===x)return O;if(x.baseClass===void 0)return null;var E=So(O,R,x.baseClass);return E===null?null:x.downcast(E)}var Ti={};function Zi(){return Object.keys(ni).length}function Cs(){var O=[];for(var R in ni)ni.hasOwnProperty(R)&&O.push(ni[R]);return O}var Xn=[];function ba(){for(;Xn.length;){var O=Xn.pop();O.$$.deleteScheduled=!1,O.delete()}}var Ai=void 0;function cr(O){Ai=O,Xn.length&&Ai&&Ai(ba)}function La(){a.getInheritedInstanceCount=Zi,a.getLiveInheritedInstances=Cs,a.flushPendingDeletes=ba,a.setDelayFunction=cr}var ni={};function Hr(O,R){for(R===void 0&&Ct("ptr should not be undefined");O.baseClass;)R=O.upcast(R),O=O.baseClass;return R}function Ji(O,R){return R=Hr(O,R),ni[R]}function zn(O,R){(!R.ptrType||!R.ptr)&&Wn("makeClassHandle requires ptr and ptrType");var x=!!R.smartPtrType,E=!!R.smartPtr;return x!==E&&Wn("Both smartPtrType and smartPtr must be specified"),R.count={value:1},jr(Object.create(O,{$$:{value:R}}))}function ws(O){var R=this.getPointee(O);if(!R)return this.destructor(O),null;var x=Ji(this.registeredClass,R);if(x!==void 0){if(x.$$.count.value===0)return x.$$.ptr=R,x.$$.smartPtr=O,x.clone();var E=x.clone();return this.destructor(O),E}function b(){return this.isSmartPointer?zn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:R,smartPtrType:this,smartPtr:O}):zn(this.registeredClass.instancePrototype,{ptrType:this,ptr:O})}var G=this.registeredClass.getActualType(R),X=Ti[G];if(!X)return b.call(this);var Z;this.isConst?Z=X.constPointerType:Z=X.pointerType;var ee=So(R,this.registeredClass,Z.registeredClass);return ee===null?b.call(this):this.isSmartPointer?zn(Z.registeredClass.instancePrototype,{ptrType:Z,ptr:ee,smartPtrType:this,smartPtr:O}):zn(Z.registeredClass.instancePrototype,{ptrType:Z,ptr:ee})}function jr(O){return typeof FinalizationRegistry>"u"?(jr=R=>R,O):(or=new FinalizationRegistry(R=>{sr(R.$$)}),jr=R=>{var x=R.$$,E=!!x.smartPtr;if(E){var b={$$:x};or.register(R,b,R)}return R},wo=R=>or.unregister(R),jr(O))}function xo(){if(this.$$.ptr||Ni(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var O=jr(Object.create(Object.getPrototypeOf(this),{$$:{value:Pi(this.$$)}}));return O.$$.count.value+=1,O.$$.deleteScheduled=!1,O}function Va(){this.$$.ptr||Ni(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ct("Object already scheduled for deletion"),wo(this),sr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Ss(){return!this.$$.ptr}function Eo(){return this.$$.ptr||Ni(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ct("Object already scheduled for deletion"),Xn.push(this),Xn.length===1&&Ai&&Ai(ba),this.$$.deleteScheduled=!0,this}function Cr(){wr.prototype.isAliasOf=yi,wr.prototype.clone=xo,wr.prototype.delete=Va,wr.prototype.isDeleted=Ss,wr.prototype.deleteLater=Eo}function wr(){}function Oo(O,R,x){if(O[R].overloadTable===void 0){var E=O[R];O[R]=function(){return O[R].overloadTable.hasOwnProperty(arguments.length)||Ct("Function '"+x+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+O[R].overloadTable+")!"),O[R].overloadTable[arguments.length].apply(this,arguments)},O[R].overloadTable=[],O[R].overloadTable[E.argCount]=E}}function Ln(O,R,x){a.hasOwnProperty(O)?((x===void 0||a[O].overloadTable!==void 0&&a[O].overloadTable[x]!==void 0)&&Ct("Cannot register public name '"+O+"' twice"),Oo(a,O,O),a.hasOwnProperty(x)&&Ct("Cannot register multiple overloads of a function with the same number of arguments ("+x+")!"),a[O].overloadTable[x]=R):(a[O]=R,x!==void 0&&(a[O].numArguments=x))}function Ro(O,R,x,E,b,G,X,Z){this.name=O,this.constructor=R,this.instancePrototype=x,this.rawDestructor=E,this.baseClass=b,this.getActualType=G,this.upcast=X,this.downcast=Z,this.pureVirtualFunctions=[]}function Pa(O,R,x){for(;R!==x;)R.upcast||Ct("Expected null or instance of "+x.name+", got an instance of "+R.name),O=R.upcast(O),R=R.baseClass;return O}function Qi(O,R){if(R===null)return this.isReference&&Ct("null is not a valid "+this.name),0;R.$$||Ct('Cannot pass "'+Fa(R)+'" as a '+this.name),R.$$.ptr||Ct("Cannot pass deleted object as a pointer of type "+this.name);var x=R.$$.ptrType.registeredClass,E=Pa(R.$$.ptr,x,this.registeredClass);return E}function sn(O,R){var x;if(R===null)return this.isReference&&Ct("null is not a valid "+this.name),this.isSmartPointer?(x=this.rawConstructor(),O!==null&&O.push(this.rawDestructor,x),x):0;R.$$||Ct('Cannot pass "'+Fa(R)+'" as a '+this.name),R.$$.ptr||Ct("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&R.$$.ptrType.isConst&&Ct("Cannot convert argument of type "+(R.$$.smartPtrType?R.$$.smartPtrType.name:R.$$.ptrType.name)+" to parameter type "+this.name);var E=R.$$.ptrType.registeredClass;if(x=Pa(R.$$.ptr,E,this.registeredClass),this.isSmartPointer)switch(R.$$.smartPtr===void 0&&Ct("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:R.$$.smartPtrType===this?x=R.$$.smartPtr:Ct("Cannot convert argument of type "+(R.$$.smartPtrType?R.$$.smartPtrType.name:R.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:x=R.$$.smartPtr;break;case 2:if(R.$$.smartPtrType===this)x=R.$$.smartPtr;else{var b=R.clone();x=this.rawShare(x,aa.toHandle(function(){b.delete()})),O!==null&&O.push(this.rawDestructor,x)}break;default:Ct("Unsupporting sharing policy")}return x}function br(O,R){if(R===null)return this.isReference&&Ct("null is not a valid "+this.name),0;R.$$||Ct('Cannot pass "'+Fa(R)+'" as a '+this.name),R.$$.ptr||Ct("Cannot pass deleted object as a pointer of type "+this.name),R.$$.ptrType.isConst&&Ct("Cannot convert argument of type "+R.$$.ptrType.name+" to parameter type "+this.name);var x=R.$$.ptrType.registeredClass,E=Pa(R.$$.ptr,x,this.registeredClass);return E}function ea(O){return this.rawGetPointee&&(O=this.rawGetPointee(O)),O}function Hn(O){this.rawDestructor&&this.rawDestructor(O)}function Do(O){O!==null&&O.delete()}function Yn(){lr.prototype.getPointee=ea,lr.prototype.destructor=Hn,lr.prototype.argPackAdvance=8,lr.prototype.readValueFromPointer=ft,lr.prototype.deleteObject=Do,lr.prototype.fromWireType=ws}function lr(O,R,x,E,b,G,X,Z,ee,ie,le){this.name=O,this.registeredClass=R,this.isReference=x,this.isConst=E,this.isSmartPointer=b,this.pointeeType=G,this.sharingPolicy=X,this.rawGetPointee=Z,this.rawConstructor=ee,this.rawShare=ie,this.rawDestructor=le,!b&&R.baseClass===void 0?E?(this.toWireType=Qi,this.destructorFunction=null):(this.toWireType=br,this.destructorFunction=null):this.toWireType=sn}function ta(O,R,x){a.hasOwnProperty(O)||Wn("Replacing nonexistant public symbol"),a[O].overloadTable!==void 0&&x!==void 0?a[O].overloadTable[x]=R:(a[O]=R,a[O].argCount=x)}function na(O,R,x){var E=a["dynCall_"+O];return x&&x.length?E.apply(null,[R].concat(x)):E.call(null,R)}function xs(O,R,x){if(O.includes("j"))return na(O,R,x);var E=jt(R).apply(null,x);return E}function ra(O,R){var x=[];return function(){return x.length=0,Object.assign(x,arguments),xs(O,R,x)}}function Qt(O,R){O=vn(O);function x(){return O.includes("j")?ra(O,R):jt(R)}var E=x();return typeof E!="function"&&Ct("unknown function pointer with signature "+O+": "+R),E}var Na=void 0;function ia(O){var R=he(O),x=vn(R);return Y(R),x}function Vn(O,R){var x=[],E={};function b(G){if(!E[G]&&!En[G]){if($n[G]){$n[G].forEach(b);return}x.push(G),E[G]=!0}}throw R.forEach(b),new Na(O+": "+x.map(ia).join([", "]))}function Aa(O,R,x,E,b,G,X,Z,ee,ie,le,Ce,be){le=vn(le),G=Qt(b,G),Z&&(Z=Qt(X,Z)),ie&&(ie=Qt(ee,ie)),be=Qt(Ce,be);var Ge=ht(le);Ln(Ge,function(){Vn("Cannot construct "+le+" due to unbound types",[E])}),Tr([O,R,x],E?[E]:[],function(Ne){Ne=Ne[0];var lt,ct;E?(lt=Ne.registeredClass,ct=lt.instancePrototype):ct=wr.prototype;var Pt=Vt(Ge,function(){if(Object.getPrototypeOf(this)!==On)throw new ar("Use 'new' to construct "+le);if(Pn.constructor_body===void 0)throw new ar(le+" has no accessible constructor");var $0=Pn.constructor_body[arguments.length];if($0===void 0)throw new ar("Tried to invoke ctor of "+le+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Pn.constructor_body).toString()+") parameters instead!");return $0.apply(this,arguments)}),On=Object.create(ct,{constructor:{value:Pt}});Pt.prototype=On;var Pn=new Ro(le,Pt,On,be,lt,G,Z,ie),Bs=new lr(le,Pn,!0,!1,!1),xi=new lr(le+"*",Pn,!1,!1,!1),Tu=new lr(le+" const*",Pn,!1,!0,!1);return Ti[O]={pointerType:xi,constPointerType:Tu},ta(Ge,Pt),[Bs,xi,Tu]})}function ur(O,R){for(var x=[],E=0;E<O;E++)x.push(ae[R+E*4>>2]);return x}function Mo(O,R){if(!(O instanceof Function))throw new TypeError("new_ called with constructor type "+typeof O+" which is not a function");var x=Vt(O.name||"unknownFunctionName",function(){});x.prototype=O.prototype;var E=new x,b=O.apply(E,R);return b instanceof Object?b:E}function Ci(O,R,x,E,b){var G=R.length;G<2&&Ct("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var X=R[1]!==null&&x!==null,Z=!1,ee=1;ee<R.length;++ee)if(R[ee]!==null&&R[ee].destructorFunction===void 0){Z=!0;break}for(var ie=R[0].name!=="void",le="",Ce="",ee=0;ee<G-2;++ee)le+=(ee!==0?", ":"")+"arg"+ee,Ce+=(ee!==0?", ":"")+"arg"+ee+"Wired";var be="return function "+ht(O)+"("+le+`) {
if (arguments.length !== `+(G-2)+`) {
throwBindingError('function `+O+" called with ' + arguments.length + ' arguments, expected "+(G-2)+` args!');
}
`;Z&&(be+=`var destructors = [];
`);var Ge=Z?"destructors":"null",Ne=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],lt=[Ct,E,b,zr,R[0],R[1]];X&&(be+="var thisWired = classParam.toWireType("+Ge+`, this);
`);for(var ee=0;ee<G-2;++ee)be+="var arg"+ee+"Wired = argType"+ee+".toWireType("+Ge+", arg"+ee+"); // "+R[ee+2].name+`
`,Ne.push("argType"+ee),lt.push(R[ee+2]);if(X&&(Ce="thisWired"+(Ce.length>0?", ":"")+Ce),be+=(ie?"var rv = ":"")+"invoker(fn"+(Ce.length>0?", ":"")+Ce+`);
`,Z)be+=`runDestructors(destructors);
`;else for(var ee=X?1:2;ee<R.length;++ee){var ct=ee===1?"thisWired":"arg"+(ee-2)+"Wired";R[ee].destructorFunction!==null&&(be+=ct+"_dtor("+ct+"); // "+R[ee].name+`
`,Ne.push(ct+"_dtor"),lt.push(R[ee].destructorFunction))}ie&&(be+=`var ret = retType.fromWireType(rv);
return ret;
`),be+=`}
`,Ne.push(be);var Pt=Mo(Function,Ne).apply(null,lt);return Pt}function Lr(O,R,x,E,b,G){D(R>0);var X=ur(R,x);b=Qt(E,b),Tr([],[O],function(Z){Z=Z[0];var ee="constructor "+Z.name;if(Z.registeredClass.constructor_body===void 0&&(Z.registeredClass.constructor_body=[]),Z.registeredClass.constructor_body[R-1]!==void 0)throw new ar("Cannot register multiple constructors with identical number of parameters ("+(R-1)+") for class '"+Z.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return Z.registeredClass.constructor_body[R-1]=()=>{Vn("Cannot construct "+Z.name+" due to unbound types",X)},Tr([],X,function(ie){return ie.splice(1,0,null),Z.registeredClass.constructor_body[R-1]=Ci(ee,ie,null,b,G),[]}),[]})}function Es(O,R,x,E,b,G,X,Z){var ee=ur(x,E);R=vn(R),G=Qt(b,G),Tr([],[O],function(ie){ie=ie[0];var le=ie.name+"."+R;R.startsWith("@@")&&(R=Symbol[R.substring(2)]),Z&&ie.registeredClass.pureVirtualFunctions.push(R);function Ce(){Vn("Cannot call "+le+" due to unbound types",ee)}var be=ie.registeredClass.instancePrototype,Ge=be[R];return Ge===void 0||Ge.overloadTable===void 0&&Ge.className!==ie.name&&Ge.argCount===x-2?(Ce.argCount=x-2,Ce.className=ie.name,be[R]=Ce):(Oo(be,R,le),be[R].overloadTable[x-2]=Ce),Tr([],ee,function(Ne){var lt=Ci(le,Ne,ie,G,X);return be[R].overloadTable===void 0?(lt.argCount=x-2,be[R]=lt):be[R].overloadTable[x-2]=lt,[]}),[]})}var wi=[],fr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function _o(O){O>4&&--fr[O].refcount===0&&(fr[O]=void 0,wi.push(O))}function Os(){for(var O=0,R=5;R<fr.length;++R)fr[R]!==void 0&&++O;return O}function Rs(){for(var O=5;O<fr.length;++O)if(fr[O]!==void 0)return fr[O];return null}function Io(){a.count_emval_handles=Os,a.get_first_emval=Rs}var aa={toValue:O=>(O||Ct("Cannot use deleted val. handle = "+O),fr[O].value),toHandle:O=>{switch(O){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var R=wi.length?wi.pop():fr.length;return fr[R]={refcount:1,value:O},R}}}};function bo(O,R){R=vn(R),fn(O,{name:R,fromWireType:function(x){var E=aa.toValue(x);return _o(x),E},toWireType:function(x,E){return aa.toHandle(E)},argPackAdvance:8,readValueFromPointer:ft,destructorFunction:null})}function Fa(O){if(O===null)return"null";var R=typeof O;return R==="object"||R==="array"||R==="function"?O.toString():""+O}function Ds(O,R){switch(R){case 2:return function(x){return this.fromWireType(me[x>>2])};case 3:return function(x){return this.fromWireType(de[x>>3])};default:throw new TypeError("Unknown float type: "+O)}}function Ms(O,R,x){var E=Vi(x);R=vn(R),fn(O,{name:R,fromWireType:function(b){return b},toWireType:function(b,G){return G},argPackAdvance:8,readValueFromPointer:Ds(R,E),destructorFunction:null})}function _s(O,R,x,E,b,G){var X=ur(R,x);O=vn(O),b=Qt(E,b),Ln(O,function(){Vn("Cannot call "+O+" due to unbound types",X)},R-1),Tr([],X,function(Z){var ee=[Z[0],null].concat(Z.slice(1));return ta(O,Ci(O,ee,null,b,G),R-1),[]})}function Ua(O,R,x){switch(R){case 0:return x?function(b){return W[b]}:function(b){return J[b]};case 1:return x?function(b){return ne[b>>1]}:function(b){return q[b>>1]};case 2:return x?function(b){return Q[b>>2]}:function(b){return ae[b>>2]};default:throw new TypeError("Unknown integer type: "+O)}}function Is(O,R,x,E,b){R=vn(R);var G=Vi(x),X=Ce=>Ce;if(E===0){var Z=32-8*x;X=Ce=>Ce<<Z>>>Z}var ee=R.includes("unsigned"),ie=(Ce,be)=>{},le;ee?le=function(Ce,be){return ie(be,this.name),be>>>0}:le=function(Ce,be){return ie(be,this.name),be},fn(O,{name:R,fromWireType:X,toWireType:le,argPackAdvance:8,readValueFromPointer:Ua(R,G,E!==0),destructorFunction:null})}function bs(O,R,x){var E=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],b=E[R];function G(X){X=X>>2;var Z=ae,ee=Z[X],ie=Z[X+1];return new b(H,ie,ee)}x=vn(x),fn(O,{name:x,fromWireType:G,argPackAdvance:8,readValueFromPointer:G},{ignoreDuplicateRegistrations:!0})}function Ls(O,R){R=vn(R);var x=R==="std::string";fn(O,{name:R,fromWireType:function(E){var b=ae[E>>2],G=E+4,X;if(x)for(var Z=G,ee=0;ee<=b;++ee){var ie=G+ee;if(ee==b||J[ie]==0){var le=ie-Z,Ce=F(Z,le);X===void 0?X=Ce:(X+="\0",X+=Ce),Z=ie+1}}else{for(var be=new Array(b),ee=0;ee<b;++ee)be[ee]=String.fromCharCode(J[G+ee]);X=be.join("")}return Y(E),X},toWireType:function(E,b){b instanceof ArrayBuffer&&(b=new Uint8Array(b));var G,X=typeof b=="string";X||b instanceof Uint8Array||b instanceof Uint8ClampedArray||b instanceof Int8Array||Ct("Cannot pass non-string to std::string"),x&&X?G=U(b):G=b.length;var Z=V(4+G+1),ee=Z+4;if(ae[Z>>2]=G,x&&X)k(b,ee,G+1);else if(X)for(var ie=0;ie<G;++ie){var le=b.charCodeAt(ie);le>255&&(Y(ee),Ct("String has UTF-16 code units that do not fit in 8 bits")),J[ee+ie]=le}else for(var ie=0;ie<G;++ie)J[ee+ie]=b[ie];return E!==null&&E.push(Y,Z),Z},argPackAdvance:8,readValueFromPointer:ft,destructorFunction:function(E){Y(E)}})}var ka=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Vs(O,R){for(var x=O,E=x>>1,b=E+R/2;!(E>=b)&&q[E];)++E;if(x=E<<1,x-O>32&&ka)return ka.decode(J.subarray(O,x));for(var G="",X=0;!(X>=R/2);++X){var Z=ne[O+X*2>>1];if(Z==0)break;G+=String.fromCharCode(Z)}return G}function Lo(O,R,x){if(x===void 0&&(x=2147483647),x<2)return 0;x-=2;for(var E=R,b=x<O.length*2?x/2:O.length,G=0;G<b;++G){var X=O.charCodeAt(G);ne[R>>1]=X,R+=2}return ne[R>>1]=0,R-E}function Vo(O){return O.length*2}function Ps(O,R){for(var x=0,E="";!(x>=R/4);){var b=Q[O+x*4>>2];if(b==0)break;if(++x,b>=65536){var G=b-65536;E+=String.fromCharCode(55296|G>>10,56320|G&1023)}else E+=String.fromCharCode(b)}return E}function Ga(O,R,x){if(x===void 0&&(x=2147483647),x<4)return 0;for(var E=R,b=E+x-4,G=0;G<O.length;++G){var X=O.charCodeAt(G);if(X>=55296&&X<=57343){var Z=O.charCodeAt(++G);X=65536+((X&1023)<<10)|Z&1023}if(Q[R>>2]=X,R+=4,R+4>b)break}return Q[R>>2]=0,R-E}function Ns(O){for(var R=0,x=0;x<O.length;++x){var E=O.charCodeAt(x);E>=55296&&E<=57343&&++x,R+=4}return R}function Po(O,R,x){x=vn(x);var E,b,G,X,Z;R===2?(E=Vs,b=Lo,X=Vo,G=()=>q,Z=1):R===4&&(E=Ps,b=Ga,X=Ns,G=()=>ae,Z=2),fn(O,{name:x,fromWireType:function(ee){for(var ie=ae[ee>>2],le=G(),Ce,be=ee+4,Ge=0;Ge<=ie;++Ge){var Ne=ee+4+Ge*R;if(Ge==ie||le[Ne>>Z]==0){var lt=Ne-be,ct=E(be,lt);Ce===void 0?Ce=ct:(Ce+="\0",Ce+=ct),be=Ne+R}}return Y(ee),Ce},toWireType:function(ee,ie){typeof ie!="string"&&Ct("Cannot pass non-string to C++ string type "+x);var le=X(ie),Ce=V(4+le+R);return ae[Ce>>2]=le>>Z,b(ie,Ce+4,le+R),ee!==null&&ee.push(Y,Ce),Ce},argPackAdvance:8,readValueFromPointer:ft,destructorFunction:function(ee){Y(ee)}})}function No(O,R,x,E,b,G){Gt[O]={name:vn(R),rawConstructor:Qt(x,E),rawDestructor:Qt(b,G),fields:[]}}function Ao(O,R,x,E,b,G,X,Z,ee,ie){Gt[O].fields.push({fieldName:vn(R),getterReturnType:x,getter:Qt(E,b),getterContext:G,setterArgumentType:X,setter:Qt(Z,ee),setterContext:ie})}function Fo(O,R){R=vn(R),fn(O,{isVoid:!0,name:R,argPackAdvance:0,fromWireType:function(){},toWireType:function(x,E){}})}function As(O){O>4&&(fr[O].refcount+=1)}function Fs(O,R){var x=En[O];return x===void 0&&Ct(R+" has unknown type "+ia(O)),x}function Us(O,R){O=Fs(O,"_emval_take_value");var x=O.readValueFromPointer(R);return aa.toHandle(x)}function Ba(){tn("")}function ks(O,R,x){J.copyWithin(O,R,R+x)}function Fi(){return 2147483648}function Gs(O){try{return S.grow(O-H.byteLength+65535>>>16),je(S.buffer),1}catch{}}function $a(O){var R=J.length;O=O>>>0;var x=Fi();if(O>x)return!1;let E=(ee,ie)=>ee+(ie-ee%ie)%ie;for(var b=1;b<=4;b*=2){var G=R*(1+.2/b);G=Math.min(G,O+100663296);var X=Math.min(x,E(Math.max(O,G),65536)),Z=Gs(X);if(Z)return!0}return!1}function Wa(O){return 52}function Si(O,R,x,E,b){return 70}var Vr=[null,[],[]];function Uo(O,R){var x=Vr[O];R===0||R===10?((O===1?T:C)(P(x,0)),x.length=0):x.push(R)}function ko(O,R,x,E){for(var b=0,G=0;G<x;G++){var X=ae[R>>2],Z=ae[R+4>>2];R+=8;for(var ee=0;ee<Z;ee++)Uo(O,J[X+ee]);b+=Z}return ae[E>>2]=b,0}function za(O){return O}function Go(O){var R=a["_"+O];return R}function oa(O,R){W.set(O,R)}function Ha(O,R,x,E,b){var G={string:Ne=>{var lt=0;if(Ne!=null&&Ne!==0){var ct=(Ne.length<<2)+1;lt=Se(ct),k(Ne,lt,ct)}return lt},array:Ne=>{var lt=Se(Ne.length);return oa(Ne,lt),lt}};function X(Ne){return R==="string"?F(Ne):R==="boolean"?!!Ne:Ne}var Z=Go(O),ee=[],ie=0;if(E)for(var le=0;le<E.length;le++){var Ce=G[x[le]];Ce?(ie===0&&(ie=ye()),ee[le]=Ce(E[le])):ee[le]=E[le]}var be=Z.apply(null,ee);function Ge(Ne){return ie!==0&&pe(ie),X(Ne)}return be=Ge(be),be}Tt=a.InternalError=Ir(Error,"InternalError"),Yi(),ar=a.BindingError=Ir(Error,"BindingError"),Cr(),La(),Yn(),Na=a.UnboundTypeError=Ir(Error,"UnboundTypeError"),Io();var L={__assert_fail:St,__cxa_begin_catch:xn,__cxa_end_catch:Re,__cxa_find_matching_catch_2:_r,__cxa_find_matching_catch_3:vr,__cxa_throw:yr,__resumeException:It,_embind_finalize_value_object:Xi,_embind_register_bigint:Co,_embind_register_bool:ti,_embind_register_class:Aa,_embind_register_class_constructor:Lr,_embind_register_class_function:Es,_embind_register_emval:bo,_embind_register_float:Ms,_embind_register_function:_s,_embind_register_integer:Is,_embind_register_memory_view:bs,_embind_register_std_string:Ls,_embind_register_std_wstring:Po,_embind_register_value_object:No,_embind_register_value_object_field:Ao,_embind_register_void:Fo,_emval_decref:_o,_emval_incref:As,_emval_take_value:Us,abort:Ba,emscripten_memcpy_big:ks,emscripten_resize_heap:$a,fd_close:Wa,fd_seek:Si,fd_write:ko,invoke_i:ue,invoke_ii:Je,invoke_iii:De,invoke_iiii:te,invoke_v:z,invoke_vi:M,invoke_viiii:I,invoke_viiiiii:Te,llvm_eh_typeid_for:za};we(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.__wasm_call_ctors).apply(null,arguments)};var V=a._malloc=function(){return(V=a._malloc=a.asm.malloc).apply(null,arguments)},Y=a._free=function(){return(Y=a._free=a.asm.free).apply(null,arguments)},se=a.___cxa_free_exception=function(){return(se=a.___cxa_free_exception=a.asm.__cxa_free_exception).apply(null,arguments)},he=a.___getTypeName=function(){return(he=a.___getTypeName=a.asm.__getTypeName).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm._embind_initialize_bindings).apply(null,arguments)},a.___errno_location=function(){return(a.___errno_location=a.asm.__errno_location).apply(null,arguments)};var xe=a.setTempRet0=function(){return(xe=a.setTempRet0=a.asm.setTempRet0).apply(null,arguments)},ye=a.stackSave=function(){return(ye=a.stackSave=a.asm.stackSave).apply(null,arguments)},pe=a.stackRestore=function(){return(pe=a.stackRestore=a.asm.stackRestore).apply(null,arguments)},Se=a.stackAlloc=function(){return(Se=a.stackAlloc=a.asm.stackAlloc).apply(null,arguments)},Le=a.___cxa_can_catch=function(){return(Le=a.___cxa_can_catch=a.asm.__cxa_can_catch).apply(null,arguments)},We=a.___cxa_is_pointer_type=function(){return(We=a.___cxa_is_pointer_type=a.asm.__cxa_is_pointer_type).apply(null,arguments)};a.dynCall_ji=function(){return(a.dynCall_ji=a.asm.dynCall_ji).apply(null,arguments)},a.dynCall_iiji=function(){return(a.dynCall_iiji=a.asm.dynCall_iiji).apply(null,arguments)},a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.dynCall_jiji).apply(null,arguments)};function Je(O,R){var x=ye();try{return jt(O)(R)}catch(E){if(pe(x),E!==E+0)throw E;_setThrew(1,0)}}function M(O,R){var x=ye();try{jt(O)(R)}catch(E){if(pe(x),E!==E+0)throw E;_setThrew(1,0)}}function I(O,R,x,E,b){var G=ye();try{jt(O)(R,x,E,b)}catch(X){if(pe(G),X!==X+0)throw X;_setThrew(1,0)}}function z(O){var R=ye();try{jt(O)()}catch(x){if(pe(R),x!==x+0)throw x;_setThrew(1,0)}}function te(O,R,x,E){var b=ye();try{return jt(O)(R,x,E)}catch(G){if(pe(b),G!==G+0)throw G;_setThrew(1,0)}}function ue(O){var R=ye();try{return jt(O)()}catch(x){if(pe(R),x!==x+0)throw x;_setThrew(1,0)}}function Te(O,R,x,E,b,G,X){var Z=ye();try{jt(O)(R,x,E,b,G,X)}catch(ee){if(pe(Z),ee!==ee+0)throw ee;_setThrew(1,0)}}function De(O,R,x){var E=ye();try{return jt(O)(R,x)}catch(b){if(pe(E),b!==b+0)throw b;_setThrew(1,0)}}a.ccall=Ha;var ve;Jt=function O(){ve||_e(),ve||(Jt=O)};function _e(O){if(Kt>0||(ut(),Kt>0))return;function R(){ve||(ve=!0,a.calledRun=!0,!_&&(ke(),o(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),Xe()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),R()},1)):R()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return _e(),a.ready})})();t.exports=n})($d)),$d.exports}var BX=GX();const $X=ji(BX),WX=new URL("/radiology-ai-viewer/assets/openjphjs-C-BUUy4a.wasm",import.meta.url),pl={codec:void 0,decoder:void 0,decodeConfig:{}};function zX(t,e,n){const r={width:e,height:n};for(;t>0;)r.width=Math.ceil(r.width/2),r.height=Math.ceil(r.height/2),t--;return r}function HX(t){if(pl.decodeConfig=t,pl.codec)return Promise.resolve();const e=$X({locateFile:n=>n.endsWith(".wasm")?WX.toString():n});return new Promise((n,r)=>{e.then(i=>{pl.codec=i,pl.decoder=new i.HTJ2KDecoder,n()},r)})}async function jX(t,e){await HX();const n=new pl.codec.HTJ2KDecoder,r=n.getEncodedBuffer(t.length);r.set(t);const i=e.decodeLevel||0;n.decodeSubResolution(i);const a=n.getFrameInfo();if(e.decodeLevel>0){const{width:N,height:P}=zX(e.decodeLevel,a.width,a.height);a.width=N,a.height=P}const o=n.getDecodedBuffer();new Uint8Array(o.length).set(o);const c=`x: ${n.getImageOffset().x}, y: ${n.getImageOffset().y}`,l=n.getNumDecompositions(),f=n.getNumLayers(),u=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][n.getProgressionOrder()+1],g=n.getIsReversible(),d=`${n.getBlockDimensions().width} x ${n.getBlockDimensions().height}`,p=`${n.getTileSize().width} x ${n.getTileSize().height}`,h=`${n.getTileOffset().x}, ${n.getTileOffset().y}`,m=`${o.length.toLocaleString()} bytes`,v=`${(o.length/r.length).toFixed(2)}:1`,y={columns:a.width,rows:a.height,bitsPerPixel:a.bitsPerSample,signed:a.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:a.componentCount};let T=KX(a,o);const{buffer:C,byteOffset:w,byteLength:S}=T,_=C.slice(w,w+S);T=new T.constructor(_);const D={imageOffset:c,numDecompositions:l,numLayers:f,progessionOrder:u,reversible:g,blockDimensions:d,tileSize:p,tileOffset:h,decodedSize:m,compressionRatio:v};return{...e,pixelData:T,imageInfo:y,encodeOptions:D,...D,...y}}function KX(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function qX(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a,doseGridScaling:o}=e;if(e.modality==="PT"&&typeof a=="number"&&!isNaN(a))for(let s=0;s<n;s++)t[s]=a*(t[s]*r+i);else if(e.modality==="RTDOSE"&&typeof o=="number"&&!isNaN(o))for(let s=0;s<n;s++)t[s]=t[s]*o;else for(let s=0;s<n;s++)t[s]=t[s]*r+i;return!0}const XX={bilinear:sX,replicate:cX},G4={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};function YX(t,e,n,r){const i=t.pixelRepresentation!==void 0&&t.pixelRepresentation===1,a=i&&t.bitsStored!==void 0?32-t.bitsStored:void 0;if(i&&a!==void 0)for(let y=0;y<t.pixelData.length;y++)t.pixelData[y]=t.pixelData[y]<<a>>a;let o=t.pixelData;t.pixelDataLength=t.pixelData.length;const{min:s,max:c}=Wp(t.pixelData),l=typeof e.allowFloatRendering<"u"?e.allowFloatRendering:!0;let f=fw(t.photometricInterpretation)&&e.targetBuffer?.offset===void 0;const g=e.preScale?.enabled&&Object.values(e.preScale.scalingParameters).some(y=>typeof y=="number"&&!Number.isInteger(y)),d=!e.preScale.enabled||!l&&g,p=e.targetBuffer?.type;if(p&&e.preScale.enabled&&!d){const y=e.preScale.scalingParameters,T=kh(s,c,y);f=!xq(T.min,T.max,G4[p])}p&&!f?o=JX(e,t,G4,o):e.preScale.enabled&&!d?o=QX(e,s,c,t):o=Cw(s,c,t);let h=s,m=c;if(e.preScale.enabled&&!d){const y=e.preScale.scalingParameters;if(ww(y),ZX(y)){qX(o,y),t.preScale={...e.preScale,scaled:!0};const C=kh(s,c,y);h=C.min,m=C.max}}else d&&(t.preScale={enabled:!0,scaled:!1},h=s,m=c);t.pixelData=o,t.smallestPixelValue=h,t.largestPixelValue=m;const v=new Date().getTime();return t.decodeTimeInMS=v-n,t}function ZX(t){const{rescaleSlope:e,rescaleIntercept:n,modality:r,doseGridScaling:i,suvbw:a}=t;return typeof e=="number"&&typeof n=="number"||r==="RTDOSE"&&typeof i=="number"||r==="PT"&&typeof a=="number"}function JX(t,e,n,r){const{arrayBuffer:i,type:a,offset:o=0,length:s,rows:c}=t.targetBuffer,l=n[a];if(!l)throw new Error(`target array ${a} is not supported, or doesn't exist.`);c&&c!=e.rows&&tY(e,t.targetBuffer,l);const f=e.pixelDataLength,u=o,g=s??f-u,d=e.pixelData;if(g!==d.length)throw new Error(`target array for image does not have the same length (${g}) as the decoded image length (${d.length}).`);const p=i?new l(i,u,g):new l(g);return p.set(d,0),r=p,r}function QX(t,e,n,r){const i=t.preScale.scalingParameters;ww(i);const a=kh(e,n,i);return Cw(a.min,a.max,r)}function Cw(t,e,n){const r=zp(t,e),i=new r(n.pixelData.length);return i.set(n.pixelData,0),i}function kh(t,e,n){const{rescaleSlope:r,rescaleIntercept:i,modality:a,doseGridScaling:o,suvbw:s}=n;return a==="PT"&&typeof s=="number"&&!isNaN(s)?{min:s*(t*r+i),max:s*(e*r+i)}:a==="RTDOSE"&&typeof o=="number"&&!isNaN(o)?{min:t*o,max:e*o}:typeof r=="number"&&typeof i=="number"?{min:r*t+i,max:r*e+i}:{min:t,max:e}}function ww(t){if(!t)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function eY(t,e,n){const{samplesPerPixel:r}=t,{rows:i,columns:a}=e,o=i*a*r,s=new n(o),c=s.byteLength/o;return{pixelData:s,rows:i,columns:a,frameInfo:{...t.frameInfo,rows:i,columns:a},imageInfo:{...t.imageInfo,rows:i,columns:a,bytesPerPixel:c}}}function tY(t,e,n){const r=eY(t,e,n),{scalingType:i="replicate"}=e;return XX[i](t,r),Object.assign(t,r),t.pixelDataLength=t.pixelData.length,t}async function nY(t,e,n,r,i,a){const o=new Date().getTime();let s=null,c;switch(e){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":s=b4(t,n);break;case"1.2.840.10008.1.2.2":s=uX(t,n);break;case"1.2.840.10008.1.2.1.99":s=b4(t,n);break;case"1.2.840.10008.1.2.5":s=fX(t,n);break;case"1.2.840.10008.1.2.4.50":c={...t},s=CX(n,c);break;case"1.2.840.10008.1.2.4.51":s=OX(t,n);break;case"1.2.840.10008.1.2.4.57":s=P4(t,n);break;case"1.2.840.10008.1.2.4.70":s=P4(t,n);break;case"1.2.840.10008.1.2.4.80":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=A4(n,c);break;case"1.2.840.10008.1.2.4.81":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=A4(n,c);break;case"1.2.840.10008.1.2.4.90":c={...t},s=U4(n,c);break;case"1.2.840.10008.1.2.4.91":c={...t},s=U4(n,c);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":c={...t},s=jX(n,c);break;default:throw new Error(`no decoder for transfer syntax ${e}`)}if(!s)throw new Error("decodePromise not defined");const l=await s,f=YX(l,i,o);return a?.(f),f}const rY={decodeTask({imageFrame:t,transferSyntax:e,decodeConfig:n,options:r,pixelData:i,callbackFn:a}){return nY(t,e,i,n,r,a)}};Bh(rY);const Kp=document.getElementById("dicomViewport"),iY=document.getElementById("status"),aY=document.getElementById("dicomFiles");let Wd,Lg;function fs(t){iY.textContent=t}async function oY(){fs("Initializing Cornerstone..."),await Kw(),await aK(),aX({dicomParser:OK}),Kc(bf),Kc(Pf),Kc(Lf),Kc(Vf),Kc(Dl);const t="re1",e="vp1";Wd=new KU(t),Wd.enableElement({viewportId:e,type:Bt.STACK,element:Kp}),Lg=Wd.getViewport(e);const r=RG("tg1");r.addTool(Vf.toolName),r.addTool(Lf.toolName),r.addTool(bf.toolName),r.addTool(Pf.toolName),r.addTool(Dl.toolName),r.addViewport(e,t),r.setToolActive(Lf.toolName,{bindings:[{mouseButton:(void 0).Primary}]}),r.setToolActive(bf.toolName,{bindings:[{mouseButton:(void 0).Auxiliary}]}),r.setToolActive(Pf.toolName,{bindings:[{mouseButton:(void 0).Secondary}]}),r.setToolActive(Vf.toolName),r.setToolActive(Dl.toolName,{bindings:[{mouseButton:(void 0).Primary,modifierKey:(void 0).Shift}]}),Lg.render(),fs("Ready. Choose DICOM files (one series) to load.")}async function Sw(t){const e=Array.from(t||[]).filter(r=>r&&r.size>0);if(e.length===0)return;fs("Indexing files...");const n=e.map(r=>Iq.fileManager.add(r));fs("Loading stack..."),await Lg.setStack(n),Lg.render(),fs("Loaded "+n.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom, Shift+left length.")}aY.addEventListener("change",async t=>{try{await Sw(t.target.files)}catch(e){console.error(e),fs("Load failed. Try selecting only one series.")}});Kp.addEventListener("dragover",t=>{t.preventDefault()});Kp.addEventListener("drop",async t=>{t.preventDefault();try{await Sw(t.dataTransfer.files)}catch(e){console.error(e),fs("Drop failed. Try selecting only one series.")}});oY().catch(t=>{console.error(t),fs("Initialization failed. Check console.")});
