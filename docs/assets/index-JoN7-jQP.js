const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DdKylV0O.js","assets/index-Cp4iUYqv.js","assets/Texture-C9D3AFRO.js","assets/imageRetrievalPoolManager-DiP2nqZv.js","assets/index-BFl08faP.js","assets/index-BuNzIIEl.js"])))=>i.map(i=>d[i]);
(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))f(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&f(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function f(o){if(o.ep)return;o.ep=!0;const t=s(o);fetch(o.href,t)}})();const z="modulepreload",R=function(i){return"/radiology-ai-viewer/"+i},C={},S=function(l,s,f){let o=Promise.resolve();if(s&&s.length>0){let y=function(a){return Promise.all(a.map(g=>Promise.resolve(g).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),e=c?.nonce||c?.getAttribute("nonce");o=y(s.map(a=>{if(a=R(a),a in C)return;C[a]=!0;const g=a.endsWith(".css"),h=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${h}`))return;const u=document.createElement("link");if(u.rel=g?"stylesheet":z,g||(u.as="script"),u.crossOrigin="",u.href=a,e&&u.setAttribute("nonce",e),document.head.appendChild(u),g)return new Promise((P,d)=>{u.addEventListener("load",P),u.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${a}`)))})}))}function t(c){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=c,window.dispatchEvent(e),!e.defaultPrevented)throw c}return o.then(c=>{for(const e of c||[])e.status==="rejected"&&t(e.reason);return l().catch(t)})};function D(i){const l=i&&i.viewport,s=i&&i.container;if(!s)throw new Error("setupAIMockOverlay: container is required");window.getComputedStyle(s).position==="static"&&(s.style.position="relative");const o=document.createElement("canvas");o.style.position="absolute",o.style.inset="0",o.style.pointerEvents="none",o.style.zIndex="9998",o.style.width="100%",o.style.height="100%",s.appendChild(o);const t=o.getContext("2d");let c=!1,e=[],y=[],a=[];const g=!!(l&&typeof l.canvasToWorld=="function"&&typeof l.worldToCanvas=="function"),h=(n,r)=>g?l.canvasToWorld([n,r]):[n,r,0],u=n=>g?l.worldToCanvas(n):[n[0],n[1]],P=(n,r)=>Math.hypot(n[0]-r[0],n[1]-r[1],(n[2]||0)-(r[2]||0));function d(){const n=l&&typeof l.getCanvas=="function"&&l.getCanvas()||s.querySelector("canvas"),r=n&&n.width?n.width:s.clientWidth,p=n&&n.height?n.height:s.clientHeight;o.width!==r&&(o.width=r),o.height!==p&&(o.height=p)}function m(n,r){d();const p=n*o.width,v=r*o.height;return h(p,v)}function _(){e=[{a:m(.28,.3),b:m(.55,.58),label:"Nodule 0.87"},{a:m(.62,.22),b:m(.82,.4),label:"Mass 0.73"}],y=[(()=>{const n=m(.48,.52),r=m(.56,.52);return{c:n,e:r,w:.55}})(),(()=>{const n=m(.7,.35),r=m(.76,.35);return{c:n,e:r,w:.35}})()],a=[(()=>{const n=m(.3,.72),r=m(.52,.72);return{p1:n,p2:r,label:"AI length"}})()]}function O(){t.clearRect(0,0,o.width,o.height)}function L(){if(d(),O(),!!c){t.save(),t.lineWidth=2,t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial",t.textBaseline="top";for(const n of y){const r=u(n.c),p=u(n.e),v=Math.hypot(r[0]-p[0],r[1]-p[1]),E=t.createRadialGradient(r[0],r[1],0,r[0],r[1],v);E.addColorStop(0,"rgba(255,0,0,"+.35*n.w+")"),E.addColorStop(1,"rgba(255,0,0,0)"),t.fillStyle=E,t.beginPath(),t.arc(r[0],r[1],v,0,Math.PI*2),t.fill()}t.strokeStyle="rgba(0,255,0,0.9)",t.fillStyle="rgba(0,255,0,0.9)";for(const n of e){const r=u(n.a),p=u(n.b),v=Math.min(r[0],p[0]),E=Math.min(r[1],p[1]),B=Math.abs(r[0]-p[0]),W=Math.abs(r[1]-p[1]);t.strokeRect(v,E,B,W),t.fillText(n.label,v+3,E+3)}t.strokeStyle="rgba(255,255,0,0.95)",t.fillStyle="rgba(255,255,0,0.95)";for(const n of a){const r=u(n.p1),p=u(n.p2);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(p[0],p[1]),t.stroke();const v=P(n.p1,n.p2).toFixed(1);t.fillText(n.label+": "+v+" mm",(r[0]+p[0])/2+6,(r[1]+p[1])/2+6)}t.restore()}}const T=()=>window.requestAnimationFrame(L);return window.addEventListener("resize",T,{passive:!0}),s.addEventListener("wheel",T,{passive:!0}),s.addEventListener("pointermove",T,{passive:!0}),s.addEventListener("pointerup",T,{passive:!0}),{start(){c=!0,_(),L()},stop(){c=!1,L()},toggle(){c?this.stop():this.start()},redraw:L,destroy(){try{o.remove()}catch{}window.removeEventListener("resize",T)}}}const I=document.getElementById("dicomViewport"),x=document.getElementById("status"),V=document.getElementById("dicomFiles");let M,b,A;function w(i){x&&(x.textContent=i)}function N(i){return i?.stack||i?.message||String(i)}w("main.js running. Loading Cornerstone modules...");async function q(){try{const i=await S(()=>import("./index-DdKylV0O.js"),__vite__mapDeps([0,1,2,3])),l=await S(()=>import("./index-BFl08faP.js"),__vite__mapDeps([4,1,2])),s=await S(()=>import("./index-BuNzIIEl.js"),__vite__mapDeps([5,1,3]));if(w("Initializing Cornerstone..."),await i.init(),await l.init(),s.init({maxWebWorkers:navigator.hardwareConcurrency||1}),A=s.wadouri,!A?.fileManager?.add)throw new Error("wadouri.fileManager.add is missing. DICOM image loader did not initialize.");const{addTool:f,ToolGroupManager:o,PanTool:t,ZoomTool:c,WindowLevelTool:e,StackScrollTool:y,LengthTool:a,Enums:g}=l;f(t),f(c),f(e),f(y),f(a);const h="re1",u="vp1";M=new i.RenderingEngine(h),M.enableElement({viewportId:u,type:i.Enums.ViewportType.STACK,element:I}),b=M.getViewport(u),window.__rav_viewport=b;const d=o.createToolGroup("tg1");d.addTool(y.toolName),d.addTool(e.toolName),d.addTool(t.toolName),d.addTool(c.toolName),d.addTool(a.toolName),d.addViewport(u,h);const m=g?.MouseBindings??null,_=g?.KeyboardBindings??null;m?(d.setToolActive(e.toolName,{bindings:[{mouseButton:m.Primary}]}),d.setToolActive(t.toolName,{bindings:[{mouseButton:m.Auxiliary}]}),d.setToolActive(c.toolName,{bindings:[{mouseButton:m.Secondary}]}),d.setToolActive(y.toolName,{bindings:[{mouseButton:m.Wheel}]}),_?.Shift!=null?d.setToolActive(a.toolName,{bindings:[{mouseButton:m.Primary,modifierKey:_.Shift}]}):d.setToolPassive(a.toolName)):(d.setToolActive(y.toolName),d.setToolActive(e.toolName),d.setToolPassive(t.toolName),d.setToolPassive(c.toolName),d.setToolPassive(a.toolName)),b.render(),w("Ready. Choose DICOM files (one series) to load.")}catch(i){console.error(i),w("Initialization failed:\\n"+N(i))}}async function k(i){const l=Array.from(i||[]).filter(s=>s&&s.size>0);if(l.length!==0){if(!b){w("Viewer not initialized yet. See error above.");return}try{l.sort((f,o)=>f.name.localeCompare(o.name,void 0,{numeric:!0,sensitivity:"base"})),w("Indexing files...");const s=l.map(f=>A.fileManager.add(f));w("Loading stack..."),await b.setStack(s),b.render(),w("Loaded "+s.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom.")}catch(s){console.error(s),w("Load failed:\\n"+N(s)+"\\nTry selecting only one series.")}}}V?.addEventListener("change",i=>k(i.target.files));I?.addEventListener("dragover",i=>{i.preventDefault()});I?.addEventListener("drop",i=>{i.preventDefault(),k(i.dataTransfer.files)});q();(()=>{function i(){return typeof I<"u"&&I||document.getElementById("dicomViewport")||document.getElementById("viewport")||document.querySelector("[data-viewport]")||(document.querySelector("canvas")?document.querySelector("canvas").parentElement:null)}function l(){try{if(window.__rav_viewport)return window.__rav_viewport;if(typeof b<"u"&&b)return b}catch{}return null}function s(e){try{if(e&&typeof e.getImageIds=="function")return(e.getImageIds()||[]).length>0}catch{}return!1}function f(){let e=document.getElementById("btnAIMock");return e||(e=document.createElement("button"),e.id="btnAIMock",e.type="button",e.textContent="AI Overlay",e.setAttribute("aria-label","Toggle AI overlay"),document.body.appendChild(e)),e.style.setProperty("position","fixed","important"),e.style.setProperty("top","56px","important"),e.style.setProperty("right","12px","important"),e.style.setProperty("z-index","1000000","important"),e.style.setProperty("padding","8px 10px","important"),e.style.setProperty("border-radius","10px","important"),e.style.setProperty("border","1px solid rgba(255,255,255,0.35)","important"),e.style.setProperty("background","rgba(255,255,255,0.92)","important"),e.style.setProperty("color","#111","important"),e.style.setProperty("font-weight","700","important"),e.style.setProperty("font-size","13px","important"),e.style.setProperty("line-height","1","important"),e.style.setProperty("cursor","pointer","important"),e.style.setProperty("backdrop-filter","blur(6px)","important"),e}function o(){const e=i();!e||e.__ravWheelGuard||(e.__ravWheelGuard=!0,e.addEventListener("wheel",y=>{const a=l();s(a)||(y.preventDefault(),y.stopImmediatePropagation())},{capture:!0,passive:!1}))}function t(){if(window.__aiMock)return window.__aiMock;const e=i();if(!e)return null;const y=l();try{const a=D({viewport:y,container:e});return window.__aiMock=a,a}catch(a){return console.warn("AI overlay install failed:",a),null}}function c(){const e=f();o(),e.addEventListener("click",()=>{const a=t();if(!a){alert("Load a DICOM series first, then click AI Overlay again.");return}a.toggle()}),new MutationObserver(()=>{o();const a=l();!window.__aiMock&&s(a)&&t()}).observe(document.documentElement,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c()})();export{S as _};
