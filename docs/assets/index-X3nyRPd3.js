const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DdKylV0O.js","assets/index-Cp4iUYqv.js","assets/Texture-C9D3AFRO.js","assets/imageRetrievalPoolManager-DiP2nqZv.js","assets/index-BFl08faP.js","assets/index-BEkGlwwC.js"])))=>i.map(i=>d[i]);
(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();const R="modulepreload",W=function(r){return"/radiology-ai-viewer/"+r},k={},L=function(a,s,u){let e=Promise.resolve();if(s&&s.length>0){let y=function(c){return Promise.all(c.map(v=>Promise.resolve(v).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),m=i?.nonce||i?.getAttribute("nonce");e=y(s.map(c=>{if(c=W(c),c in k)return;k[c]=!0;const v=c.endsWith(".css"),w=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${w}`))return;const d=document.createElement("link");if(d.rel=v?"stylesheet":R,v||(d.as="script"),d.crossOrigin="",d.href=c,m&&d.setAttribute("nonce",m),document.head.appendChild(d),v)return new Promise((M,l)=>{d.addEventListener("load",M),d.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${c}`)))})}))}function t(i){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=i,window.dispatchEvent(m),!m.defaultPrevented)throw i}return e.then(i=>{for(const m of i||[])m.status==="rejected"&&t(m.reason);return a().catch(t)})};function P(r){const a=r&&r.viewport,s=r&&r.container;if(!s)throw new Error("setupAIMockOverlay: container is required");window.getComputedStyle(s).position==="static"&&(s.style.position="relative");const e=document.createElement("canvas");e.style.position="absolute",e.style.inset="0",e.style.pointerEvents="none",e.style.zIndex="9998",e.style.width="100%",e.style.height="100%",s.appendChild(e);const t=e.getContext("2d");let i=!1,m=[],y=[],c=[];const v=!!(a&&typeof a.canvasToWorld=="function"&&typeof a.worldToCanvas=="function"),w=(o,n)=>v?a.canvasToWorld([o,n]):[o,n,0],d=o=>v?a.worldToCanvas(o):[o[0],o[1]],M=(o,n)=>Math.hypot(o[0]-n[0],o[1]-n[1],(o[2]||0)-(n[2]||0));function l(){const o=a&&typeof a.getCanvas=="function"&&a.getCanvas()||s.querySelector("canvas"),n=o&&o.width?o.width:s.clientWidth,p=o&&o.height?o.height:s.clientHeight;e.width!==n&&(e.width=n),e.height!==p&&(e.height=p)}function f(o,n){l();const p=o*e.width,h=n*e.height;return w(p,h)}function S(){m=[{a:f(.28,.3),b:f(.55,.58),label:"Nodule 0.87"},{a:f(.62,.22),b:f(.82,.4),label:"Mass 0.73"}],y=[(()=>{const o=f(.48,.52),n=f(.56,.52);return{c:o,e:n,w:.55}})(),(()=>{const o=f(.7,.35),n=f(.76,.35);return{c:o,e:n,w:.35}})()],c=[(()=>{const o=f(.3,.72),n=f(.52,.72);return{p1:o,p2:n,label:"AI length"}})()]}function g(){t.clearRect(0,0,e.width,e.height)}function T(){if(l(),g(),!!i){t.save(),t.lineWidth=2,t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial",t.textBaseline="top";for(const o of y){const n=d(o.c),p=d(o.e),h=Math.hypot(n[0]-p[0],n[1]-p[1]),_=t.createRadialGradient(n[0],n[1],0,n[0],n[1],h);_.addColorStop(0,"rgba(255,0,0,"+.35*o.w+")"),_.addColorStop(1,"rgba(255,0,0,0)"),t.fillStyle=_,t.beginPath(),t.arc(n[0],n[1],h,0,Math.PI*2),t.fill()}t.strokeStyle="rgba(0,255,0,0.9)",t.fillStyle="rgba(0,255,0,0.9)";for(const o of m){const n=d(o.a),p=d(o.b),h=Math.min(n[0],p[0]),_=Math.min(n[1],p[1]),q=Math.abs(n[0]-p[0]),z=Math.abs(n[1]-p[1]);t.strokeRect(h,_,q,z),t.fillText(o.label,h+3,_+3)}t.strokeStyle="rgba(255,255,0,0.95)",t.fillStyle="rgba(255,255,0,0.95)";for(const o of c){const n=d(o.p1),p=d(o.p2);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(p[0],p[1]),t.stroke();const h=M(o.p1,o.p2).toFixed(1);t.fillText(o.label+": "+h+" mm",(n[0]+p[0])/2+6,(n[1]+p[1])/2+6)}t.restore()}}const E=()=>window.requestAnimationFrame(T);return window.addEventListener("resize",E,{passive:!0}),s.addEventListener("wheel",E,{passive:!0}),s.addEventListener("pointermove",E,{passive:!0}),s.addEventListener("pointerup",E,{passive:!0}),{start(){i=!0,S(),T()},stop(){i=!1,T()},toggle(){i?this.stop():this.start()},redraw:T,destroy(){try{e.remove()}catch{}window.removeEventListener("resize",E)}}}const I=document.getElementById("dicomViewport"),N=document.getElementById("status"),V=document.getElementById("dicomFiles");let A,x,C;function b(r){N&&(N.textContent=r)}function B(r){return r?.stack||r?.message||String(r)}b("main.js running. Loading Cornerstone modules...");async function D(){try{const r=await L(()=>import("./index-DdKylV0O.js"),__vite__mapDeps([0,1,2,3])),a=await L(()=>import("./index-BFl08faP.js"),__vite__mapDeps([4,1,2])),s=await L(()=>import("./index-BEkGlwwC.js"),__vite__mapDeps([5,1,3]));if(b("Initializing Cornerstone..."),await r.init(),await a.init(),s.init({maxWebWorkers:navigator.hardwareConcurrency||1}),C=s.wadouri,!C?.fileManager?.add)throw new Error("wadouri.fileManager.add is missing. DICOM image loader did not initialize.");const{addTool:u,ToolGroupManager:e,PanTool:t,ZoomTool:i,WindowLevelTool:m,StackScrollTool:y,LengthTool:c,Enums:v}=a;u(t),u(i),u(m),u(y),u(c);const w="re1",d="vp1";A=new r.RenderingEngine(w),A.enableElement({viewportId:d,type:r.Enums.ViewportType.STACK,element:I}),x=A.getViewport(d),(()=>{try{if(window.__aiMock)return;let g=document.getElementById("btnAIMock");g||(g=document.createElement("button"),g.id="btnAIMock",g.type="button",g.textContent="AI Overlay (mock)",g.style.cssText="position:fixed; top:12px; right:12px; z-index:9999; padding:8px 10px; border-radius:10px; border:1px solid #999; background:#fff; cursor:pointer;",document.body.appendChild(g));const T=document.querySelector("canvas"),E=typeof viewportElement<"u"&&viewportElement||typeof I<"u"&&I||document.getElementById("viewport")||document.querySelector("[data-viewport]")||(T?T.parentElement:null);if(!E){console.warn("AI overlay: could not find viewport container");return}window.__rav_viewport=I;const o=P({viewport:I,container:E});g.addEventListener("click",()=>o.toggle()),window.__aiMock=o}catch(g){console.warn("AI overlay init failed:",g)}})();const l=e.createToolGroup("tg1");l.addTool(y.toolName),l.addTool(m.toolName),l.addTool(t.toolName),l.addTool(i.toolName),l.addTool(c.toolName),l.addViewport(d,w);const f=v?.MouseBindings??null,S=v?.KeyboardBindings??null;f?(l.setToolActive(m.toolName,{bindings:[{mouseButton:f.Primary}]}),l.setToolActive(t.toolName,{bindings:[{mouseButton:f.Auxiliary}]}),l.setToolActive(i.toolName,{bindings:[{mouseButton:f.Secondary}]}),l.setToolActive(y.toolName,{bindings:[{mouseButton:f.Wheel}]}),S?.Shift!=null?l.setToolActive(c.toolName,{bindings:[{mouseButton:f.Primary,modifierKey:S.Shift}]}):l.setToolPassive(c.toolName)):(l.setToolActive(y.toolName),l.setToolActive(m.toolName),l.setToolPassive(t.toolName),l.setToolPassive(i.toolName),l.setToolPassive(c.toolName)),x.render(),b("Ready. Choose DICOM files (one series) to load.")}catch(r){console.error(r),b("Initialization failed:\\n"+B(r))}}async function O(r){const a=Array.from(r||[]).filter(s=>s&&s.size>0);if(a.length!==0){if(!x){b("Viewer not initialized yet. See error above.");return}try{a.sort((u,e)=>u.name.localeCompare(e.name,void 0,{numeric:!0,sensitivity:"base"})),b("Indexing files...");const s=a.map(u=>C.fileManager.add(u));b("Loading stack..."),await x.setStack(s),x.render(),b("Loaded "+s.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom.")}catch(s){console.error(s),b("Load failed:\\n"+B(s)+"\\nTry selecting only one series.")}}}V?.addEventListener("change",r=>O(r.target.files));I?.addEventListener("dragover",r=>{r.preventDefault()});I?.addEventListener("drop",r=>{r.preventDefault(),O(r.dataTransfer.files)});D();(()=>{function r(){let e=document.getElementById("btnAIMock");return e||(e=document.createElement("button"),e.id="btnAIMock",e.type="button",e.textContent="AI Overlay (mock)",e.style.cssText="position:fixed; top:12px; right:12px; z-index:999999; padding:8px 10px; border-radius:10px; border:1px solid #999; background:#fff; cursor:pointer;",document.body.appendChild(e)),e}function a(){const e=document.querySelector("#viewport canvas")||document.querySelector("[data-viewport] canvas")||document.querySelector("canvas");return document.getElementById("viewport")||document.querySelector("[data-viewport]")||(e?e.parentElement:null)}function s(){if(window.__aiMock)return window.__aiMock;const e=a();if(!e)return null;const t=window.__rav_viewport||window.__cornerstoneViewport||null;try{const i=P({viewport:t,container:e});return window.__aiMock=i,i}catch(i){return console.warn("AI overlay install failed:",i),null}}function u(){r().addEventListener("click",()=>{const i=s();if(!i){alert("Viewport not ready yet. Load a DICOM series first, then click again.");return}i.toggle()}),new MutationObserver(()=>{if(!window.__aiMock){const i=a();i&&i.querySelector("canvas")&&s()}}).observe(document.documentElement,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u()})();export{L as _};
