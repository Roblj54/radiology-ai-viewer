(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Ge;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED="DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED="DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOAD_PROGRESS="GEOMETRY_LOAD_PROGRESS",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED",t.ACTORS_CHANGED="CORNERSTONE_ACTORS_CHANGED"})(Ge||(Ge={}));var Zt;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(Zt||(Zt={}));var Fn;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(Fn||(Fn={}));var dc;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(dc||(dc={}));const Fd={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6};var lb={BlendMode:Fd};const{BlendMode:rd}=lb;var ds;(function(t){t[t.COMPOSITE=rd.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=rd.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=rd.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=rd.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",t[t.LABELMAP_EDGE_PROJECTION_BLEND=rd.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"})(ds||(ds={}));var Ma;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition",t.AXIAL_REFORMAT="axial_reformat",t.CORONAL_REFORMAT="coronal_reformat",t.SAGITTAL_REFORMAT="sagittal_reformat",t.REFORMAT="reformat"})(Ma||(Ma={}));var hs;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE",t.MESH="MESH"})(hs||(hs={}));var Wy;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(Wy||(Wy={}));const cN=Wy;var bo;(function(t){t.PLY="PLY",t.STL="STL",t.OBJ="OBJ",t.VTP="VTP"})(bo||(bo={}));var Ci;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(Ci||(Ci={}));var $y;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})($y||($y={}));const lN=$y;var xa;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated",t.CALIBRATED="Calibrated",t.UNKNOWN="Unknown"})(xa||(xa={}));var Ni;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(Ni||(Ni={}));var lo;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(lo||(lo={}));var hh;(function(t){t.FRAME="f",t.SECOND="s"})(hh||(hh={}));const uN=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return hh}},Symbol.toStringTag,{value:"Module"}));var Zi;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.FRAME_MODULE="frameModule",t.WADO_WEB_CLIENT="wadoWebClient",t.INSTANCE="instance",t.IMAGE_SOP_INSTANCE_REFERENCE="ImageSopInstanceReference",t.REFERENCED_SERIES_REFERENCE="ReferencedSeriesReference",t.PREDECESSOR_SEQUENCE="PredecessorSequence",t.STUDY_DATA="StudyData",t.SERIES_DATA="SeriesData",t.IMAGE_DATA="ImageData",t.RTSS_INSTANCE_DATA="RtssInstanceData",t.NEW_INSTANCE_DATA="NewInstanceData",t.RTSS_CONTOUR="metaRTSSContour",t.SEG_BIT="metaSegBitmap",t.SR_ANNOTATION="metaSrAnnotation"})(Zi||(Zi={}));var Kf;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(Kf||(Kf={}));var gm;(function(t){t.RLE="RLE",t.Volume="Volume"})(gm||(gm={}));var Hu;(function(t){t.Tiled="tiled",t.ContextPool="contextPool"})(Hu||(Hu={}));const go=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:ds,CalibrationTypes:xa,ContourType:cN,DynamicOperatorType:lN,Events:Ge,get GenerateImageType(){return Kf},GeometryType:hs,ImageQualityStatus:lo,InterpolationType:dc,MeshType:bo,MetadataModules:Zi,OrientationAxis:Ma,RenderingEngineModeEnum:Hu,RequestType:Zt,VOILUTFunctionType:Ci,VideoEnums:uN,ViewportStatus:Ni,ViewportType:Fn,VoxelManagerEnum:gm},Symbol.toStringTag,{value:"Module"})),zy={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},Cr={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(Cr);const Po=.001;function ub(t){const e=Object.getOwnPropertyNames(t);for(const r of e){const n=t[r];n&&typeof n=="object"&&ub(n)}return Object.freeze(t)}const fN={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},hc=ub(fN),fb=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],dN={slicer3D:[160/255,164/255,217/255]},Mc=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:dN,CPU_COLORMAPS:zy,EPSILON:Po,MPR_CAMERA_VALUES:hc,RENDERING_DEFAULTS:Cr,VIEWPORT_PRESETS:fb},Symbol.toStringTag,{value:"Module"})),id={},gh={get:t=>id[t],set:t=>{const e=t.id;id[e]=t},delete:t=>delete id[t],getAll:()=>{const e=Object.keys(id).map(r=>id[r]);return e.sort((r,n)=>r.id[0]==="_"&&n.id[0]!=="_"?1:r.id[0]!=="_"&&n.id[0]==="_"?-1:0),e}};function Bn(t){return gh.get(t)}function Bi(){return gh.getAll()}const pm=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",hN=t=>Array.isArray(t)?[]:{},ph=(t,e)=>e&&e.clone===!0&&pm(t)?jr(hN(t),t,e):t,dT=(t,e,r)=>{const n=t.slice();return e.forEach(function(i,o){typeof n[o]>"u"?n[o]=ph(i,r):pm(i)?n[o]=jr(t[o],i,r):t.indexOf(i)===-1&&(n[o]=ph(i,r))}),n},gN=(t,e,r)=>{const n={};return pm(t)&&Object.keys(t).forEach(function(i){n[i]=ph(t[i],r)}),Object.keys(e).forEach(function(i){!pm(e[i])||!t[i]?n[i]=ph(e[i],r):n[i]=jr(t[i],e[i],r)}),n},jr=(t={},e={},r=void 0)=>{const n=Array.isArray(e),o=(r||{arrayMerge:dT}).arrayMerge||dT;return n?Array.isArray(t)?o(t,e,r):ph(e,r):gN(t,e,r)};const db=Symbol("Comlink.proxy"),pN=Symbol("Comlink.endpoint"),hb=Symbol("Comlink.releaseProxy"),q2=Symbol("Comlink.finalizer"),Vp=Symbol("Comlink.thrown"),gb=t=>typeof t=="object"&&t!==null||typeof t=="function",mN={canHandle:t=>gb(t)&&t[db],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Ew(t,e),[r,[r]]},deserialize(t){return t.start(),jy(t)}},vN={canHandle:t=>gb(t)&&Vp in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},pb=new Map([["proxy",mN],["throw",vN]]);function yN(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Ew(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!yN(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:a,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(Su);let l;try{const f=s.slice(0,-1).reduce((d,h)=>d[h],t),u=s.reduce((d,h)=>d[h],t);switch(a){case"GET":l=u;break;case"SET":f[s.slice(-1)[0]]=Su(i.data.value),l=!0;break;case"APPLY":l=u.apply(f,c);break;case"CONSTRUCT":{const d=new u(...c);l=wb(d)}break;case"ENDPOINT":{const{port1:d,port2:h}=new MessageChannel;Ew(t,h),l=SN(d,[d])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[Vp]:0}}Promise.resolve(l).catch(f=>({value:f,[Vp]:0})).then(f=>{const[u,d]=ym(f);e.postMessage(Object.assign(Object.assign({},u),{id:o}),d),a==="RELEASE"&&(e.removeEventListener("message",n),mb(e),q2 in t&&typeof t[q2]=="function"&&t[q2]())}).catch(f=>{const[u,d]=ym({value:new TypeError("Unserializable return value"),[Vp]:0});e.postMessage(Object.assign(Object.assign({},u),{id:o}),d)})}),e.start&&e.start()}function wN(t){return t.constructor.name==="MessagePort"}function mb(t){wN(t)&&t.close()}function jy(t,e){const r=new Map;return t.addEventListener("message",function(i){const{data:o}=i;if(!o||!o.id)return;const a=r.get(o.id);if(a)try{a(o)}finally{r.delete(o.id)}}),Hy(t,r,[],e)}function Ug(t){if(t)throw new Error("Proxy has been released and is not useable")}function vb(t){return Of(t,new Map,{type:"RELEASE"}).then(()=>{mb(t)})}const mm=new WeakMap,vm="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(mm.get(t)||0)-1;mm.set(t,e),e===0&&vb(t)});function CN(t,e){const r=(mm.get(e)||0)+1;mm.set(e,r),vm&&vm.register(t,e,t)}function xN(t){vm&&vm.unregister(t)}function Hy(t,e,r=[],n=function(){}){let i=!1;const o=new Proxy(n,{get(a,s){if(Ug(i),s===hb)return()=>{xN(o),vb(t),e.clear(),i=!0};if(s==="then"){if(r.length===0)return{then:()=>o};const c=Of(t,e,{type:"GET",path:r.map(l=>l.toString())}).then(Su);return c.then.bind(c)}return Hy(t,e,[...r,s])},set(a,s,c){Ug(i);const[l,f]=ym(c);return Of(t,e,{type:"SET",path:[...r,s].map(u=>u.toString()),value:l},f).then(Su)},apply(a,s,c){Ug(i);const l=r[r.length-1];if(l===pN)return Of(t,e,{type:"ENDPOINT"}).then(Su);if(l==="bind")return Hy(t,e,r.slice(0,-1));const[f,u]=hT(c);return Of(t,e,{type:"APPLY",path:r.map(d=>d.toString()),argumentList:f},u).then(Su)},construct(a,s){Ug(i);const[c,l]=hT(s);return Of(t,e,{type:"CONSTRUCT",path:r.map(f=>f.toString()),argumentList:c},l).then(Su)}});return CN(o,t),o}function TN(t){return Array.prototype.concat.apply([],t)}function hT(t){const e=t.map(ym);return[e.map(r=>r[0]),TN(e.map(r=>r[1]))]}const yb=new WeakMap;function SN(t,e){return yb.set(t,e),t}function wb(t){return Object.assign(t,{[db]:!0})}function ym(t){for(const[e,r]of pb)if(r.canHandle(t)){const[n,i]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:t},yb.get(t)||[]]}function Su(t){switch(t.type){case"HANDLER":return pb.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Of(t,e,r,n){return new Promise(i=>{const o=_N();e.set(o,i),t.start&&t.start(),t.postMessage(Object.assign({id:o},r),n)})}function _N(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function un(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}class bw{constructor(e){this.numRequests={[Zt.Interaction]:0,[Zt.Thumbnail]:0,[Zt.Prefetch]:0,[Zt.Compute]:0},this.id=e||un(),this.requestPool={[Zt.Interaction]:{0:[]},[Zt.Thumbnail]:{0:[]},[Zt.Prefetch]:{0:[]},[Zt.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[Zt.Interaction]:0,[Zt.Thumbnail]:0,[Zt.Prefetch]:0,[Zt.Compute]:0},this.maxNumRequests={[Zt.Interaction]:6,[Zt.Thumbnail]:6,[Zt.Prefetch]:5,[Zt.Compute]:1e3}}setMaxSimultaneousRequests(e,r){this.maxNumRequests[e]=r}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,r,n,i=0){const o={requestFn:e,type:r,additionalDetails:n};this.requestPool[r][i]===void 0&&(this.requestPool[r][i]=[]),this.requestPool[r][i].push(o),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(r=>{const n=this.requestPool[r];Object.keys(n).forEach(i=>{n[i]=n[i].filter(o=>e(o))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const r=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let i=0;i<r;i++){const o=this.getNextRequest(e);if(o===null)return!1;if(o){this.numRequests[e]++,this.awake=!0;let a;try{a=o.requestFn()}catch(s){console.warn("sendRequest failed",s)}a?.finally?a.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const r=this.getSortedPriorityGroups(e);for(const n of r)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(Zt.Interaction),r=this.sendRequests(Zt.Thumbnail),n=this.sendRequests(Zt.Prefetch),i=this.sendRequests(Zt.Compute);!e&&!r&&!n&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(n=>this.requestPool[e][n].length).sort((n,i)=>n-i)}getRequestPool(){return this.requestPool}}class Cb{constructor(){this.workerRegistry={},this.workerPoolManager=new bw("webworker")}registerWorker(e,r,n={}){const{maxWorkerInstances:i=1,overwrite:o=!1,autoTerminateOnIdle:a={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!o){console.warn(`Worker type '${e}' is already registered...`);return}o&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:a.enabled,idleCheckIntervalId:null,idleTimeThreshold:a.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let c=0;c<i;c++){const l=r();s.instances.push(jy(l)),s.nativeWorkers.push(l),s.workerFn=r}this.workerRegistry[e]=s}getNextWorkerAPI(e){const r=this.workerRegistry[e];if(!r)return console.error(`Worker type '${e}' is not registered.`),null;const n=r.instances.filter(a=>a!==null);let i=0,o=r.loadCounters[0]||0;for(let a=1;a<n.length;a++){const s=r.loadCounters[a]||0;s<o&&(i=a,o=s)}if(r.instances[i]===null){const a=r.workerFn();r.instances[i]=jy(a),r.nativeWorkers[i]=a}return r.loadCounters[i]+=1,{api:r.instances[i],index:i}}executeTask(e,r,n={},{requestType:i=Zt.Compute,priority:o=0,options:a={},callbacks:s=[]}={}){return new Promise((c,l)=>{const f=async()=>{const{api:u,index:d}=this.getNextWorkerAPI(e);if(!u){const h=new Error(`No available worker instance for '${e}'`);console.error(h),l(h);return}try{let h=[];s.length&&(h=s.map(m=>wb(m)));const g=this.workerRegistry[e];g.processing=!0;const p=await u[r](n,...h);g.processing=!1,g.lastActiveTime[d]=Date.now(),g.autoTerminateOnIdle&&!g.idleCheckIntervalId&&g.idleTimeThreshold&&(g.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,g.idleTimeThreshold)},g.idleTimeThreshold)),c(p)}catch(h){console.error(`Error executing method '${r}' on worker '${e}':`,h),l(h)}finally{this.workerRegistry[e].loadCounters[d]--}};this.workerPoolManager.addRequest(f,i,a,o)})}terminateIdleWorkers(e,r){const n=this.workerRegistry[e];if(n.processing)return;const i=Date.now();n.instances.forEach((o,a)=>{const s=n.lastActiveTime[a],c=s!==null&&n.loadCounters[a]>0,l=i-s;!c&&l>r&&this.terminateWorkerInstance(e,a)})}terminate(e){const r=this.workerRegistry[e];if(!r){console.error(`Worker type '${e}' is not registered.`);return}r.instances.forEach((n,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,r){const n=this.workerRegistry[e],i=n.instances[r];i!==null&&(i[hb](),n.nativeWorkers[r].terminate(),n.instances[r]=null,n.lastActiveTime[r]=null)}}const Y2=4,EN=5,bN=1,gT=[1,1];function pT({ext:t,filterType:e,texData:r,internalFormat:n,glDataType:i}){try{const o=document.createElement("canvas");o.width=Y2,o.height=Y2;const a=o.getContext("webgl2");if(!a)return!1;const s=`#version 300 es
    void main() {
      gl_PointSize = ${Y2.toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,c=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `;let l;if(t&&(l=a.getExtension(t),!l))return!1;const f=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(f,s),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))return!1;const u=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(u,c),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))return!1;const d=a.createProgram();if(a.attachShader(d,f),a.attachShader(d,u),a.linkProgram(d),!a.getProgramParameter(d,a.LINK_STATUS))return!1;const h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,n(a,l),EN,bN,0,a.RED,i(a,l),r);const g=e==="LINEAR"?a.LINEAR:a.NEAREST;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,g),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,g),a.useProgram(d),a.drawArrays(a.POINTS,0,1);const p=new Uint8Array(4);a.readPixels(gT[0],gT[1],1,1,a.RGBA,a.UNSIGNED_BYTE,p);const[m,w,v]=p,y=a.getExtension("WEBGL_lose_context");return y&&y.loseContext(),m===w&&w===v&&m!==0}catch{return!1}}function DN(){const t=new Int16Array([32767,2e3,3e3,4e3,5e3,16784,7e3,8e3,9e3,32767]);return{norm16:pT({ext:"EXT_texture_norm16",filterType:"NEAREST",texData:t,internalFormat:(e,r)=>r.R16_SNORM_EXT,glDataType:e=>e.SHORT}),norm16Linear:pT({ext:"EXT_texture_norm16",filterType:"LINEAR",texData:t,internalFormat:(e,r)=>r.R16_SNORM_EXT,glDataType:e=>e.SHORT})}}let ml=!1;const Ky={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useLegacyCameraFOV:!1,strictZSpacingForVolumeViewport:!0,renderingEngineMode:Hu.ContextPool,webGlContextCount:7,volumeRendering:{sampleDistanceMultiplier:1}},debug:{statsOverlay:!1},peerImport:t=>null};let _o={...Ky,rendering:{...Ky.rendering}},Ud=null,xb=!1;function IN(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function Tb(){const t=IN();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function MN(){const t=DN();return t.norm16&&t.norm16Linear}function Sb(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function _b(t=_o){return ml||(xb=MN(),_o=jr(Ky,t),_o.isMobile&&(_o.rendering.webGlContextCount=1),Sb()&&(t.rendering?.preferSizeOverAccuracy?_o.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),Tb()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),_o.rendering.useCPURendering=!0),ml=!0,Ud||(Ud=new Cb),ml)}function ON(){return xb}function PN(t,e=!0){_o.rendering.useCPURendering=t,ml=!0,e&&V1()}function RN(t){_o.rendering.preferSizeOverAccuracy=t,ml=!0,V1()}function N1(){return!Sb()}function AN(){_o.rendering.useCPURendering=!Tb(),V1()}function Xf(){return _o.rendering.useCPURendering}function Eb(){return ml}function LN(){ml=!1}function Aa(){return _o}function NN(t){_o=t,V1()}function V1(){Bi().forEach(t=>{t.getViewports().forEach(e=>{e.updateRenderingPipeline()})})}function Is(){return Ud||(Ud=new Cb),Ud}async function bb(t){return _o.peerImport(t)}class VN{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,r){const n=i=>{this.removeEventListener(e,n),r.call(this,i)};this.addEventListener(e,n)}addEventListener(e,r){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(r)===-1&&this.listeners[e].push(r)}addEventListenerDebounced(e,r,n){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[r]){const o=a=>{i[r]&&clearTimeout(i[r].timeoutId),i[r].timeoutId=setTimeout(()=>{r.call(this,a)},n)};i[r]={original:r,handle:o,timeoutId:null},this.addEventListener(e,o)}}removeEventListenerDebounced(e,r){if(this.debouncedListeners[e]?.[r]){const n=this.debouncedListeners[e][r];this.removeEventListener(e,n.handle),clearTimeout(n.timeoutId),delete this.debouncedListeners[e][r]}}removeEventListener(e,r){if(!this.listeners[e])return;const n=this.listeners[e],i=n.length;for(let o=0;o<i;o++)if(n[o]===r){n.splice(o,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const r=this.listeners[e.type].slice(),n=r.length;for(let i=0;i<n;i++)try{r[i].call(this,e)}catch(o){console.error(`error in event listener of type:  ${e.type}`,o)}return!e.defaultPrevented}}const ke=new VN;function Xe(t=ke,e,r=null){if(!e)throw new Error("Event type was not defined");const n=new CustomEvent(e,{detail:r,cancelable:!0});return t?.dispatchEvent(n)}var cc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ka(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function kN(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var J2,mT;function FN(){return mT||(mT=1,J2=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(i=n;i--!==0;)if(!t(e[i],r[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;i--!==0;){var a=o[i];if(!t(e[a],r[a]))return!1}return!0}return e!==e&&r!==r}),J2}var UN=FN();const Dw=ka(UN);var Z2,vT;function Db(){if(vT)return Z2;vT=1;var t=Object.prototype.toString;return Z2=function(r){var n=t.call(r),i=n==="[object Arguments]";return i||(i=n!=="[object Array]"&&r!==null&&typeof r=="object"&&typeof r.length=="number"&&r.length>=0&&t.call(r.callee)==="[object Function]"),i},Z2}var Q2,yT;function BN(){if(yT)return Q2;yT=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Db(),i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),a=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(d){var h=d.constructor;return h&&h.prototype===d},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=(function(){if(typeof window>"u")return!1;for(var d in window)try{if(!l["$"+d]&&e.call(window,d)&&window[d]!==null&&typeof window[d]=="object")try{c(window[d])}catch{return!0}}catch{return!0}return!1})(),u=function(d){if(typeof window>"u"||!f)return c(d);try{return c(d)}catch{return!1}};t=function(h){var g=h!==null&&typeof h=="object",p=r.call(h)==="[object Function]",m=n(h),w=g&&r.call(h)==="[object String]",v=[];if(!g&&!p&&!m)throw new TypeError("Object.keys called on a non-object");var y=a&&p;if(w&&h.length>0&&!e.call(h,0))for(var C=0;C<h.length;++C)v.push(String(C));if(m&&h.length>0)for(var x=0;x<h.length;++x)v.push(String(x));else for(var T in h)!(y&&T==="prototype")&&e.call(h,T)&&v.push(String(T));if(o)for(var S=u(h),_=0;_<s.length;++_)!(S&&s[_]==="constructor")&&e.call(h,s[_])&&v.push(s[_]);return v}}return Q2=t,Q2}var ev,wT;function GN(){if(wT)return ev;wT=1;var t=Array.prototype.slice,e=Db(),r=Object.keys,n=r?function(a){return r(a)}:BN(),i=Object.keys;return n.shim=function(){if(Object.keys){var a=(function(){var s=Object.keys(arguments);return s&&s.length===arguments.length})(1,2);a||(Object.keys=function(c){return e(c)?i(t.call(c)):i(c)})}else Object.keys=n;return Object.keys||n},ev=n,ev}var tv,CT;function Ib(){if(CT)return tv;CT=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return tv=t,tv}var nv,xT;function WN(){return xT||(xT=1,nv=SyntaxError),nv}var rv,TT;function $N(){return TT||(TT=1,rv=TypeError),rv}var iv,ST;function zN(){return ST||(ST=1,iv=Object.getOwnPropertyDescriptor),iv}var ov,_T;function jN(){if(_T)return ov;_T=1;var t=zN();if(t)try{t([],"length")}catch{t=null}return ov=t,ov}var av,ET;function HN(){if(ET)return av;ET=1;var t=Ib(),e=WN(),r=$N(),n=jN();return av=function(o,a,s){if(!o||typeof o!="object"&&typeof o!="function")throw new r("`obj` must be an object or a function`");if(typeof a!="string"&&typeof a!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,f=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,d=!!n&&n(o,a);if(t)t(o,a,{configurable:f===null&&d?d.configurable:!f,enumerable:c===null&&d?d.enumerable:!c,value:s,writable:l===null&&d?d.writable:!l});else if(u||!c&&!l&&!f)o[a]=s;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},av}var sv,bT;function KN(){if(bT)return sv;bT=1;var t=Ib(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},sv=e,sv}var cv,DT;function Mb(){if(DT)return cv;DT=1;var t=GN(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",r=Object.prototype.toString,n=Array.prototype.concat,i=HN(),o=function(l){return typeof l=="function"&&r.call(l)==="[object Function]"},a=KN()(),s=function(l,f,u,d){if(f in l){if(d===!0){if(l[f]===u)return}else if(!o(d)||!d())return}a?i(l,f,u,!0):i(l,f,u)},c=function(l,f){var u=arguments.length>2?arguments[2]:{},d=t(f);e&&(d=n.call(d,Object.getOwnPropertySymbols(f)));for(var h=0;h<d.length;h+=1)s(l,d[h],f[d[h]],u[d[h]])};return c.supportsDescriptors=!!a,cv=c,cv}var od={exports:{}},IT;function Ob(){return IT||(IT=1,typeof self<"u"?od.exports=self:typeof window<"u"?od.exports=window:od.exports=Function("return this")()),od.exports}var lv,MT;function Pb(){if(MT)return lv;MT=1;var t=Ob();return lv=function(){return typeof cc!="object"||!cc||cc.Math!==Math||cc.Array!==Array?t:cc},lv}var uv,OT;function XN(){if(OT)return uv;OT=1;var t=Mb(),e=Pb();return uv=function(){var n=e();if(t.supportsDescriptors){var i=Object.getOwnPropertyDescriptor(n,"globalThis");(!i||i.configurable&&(i.enumerable||!i.writable||globalThis!==n))&&Object.defineProperty(n,"globalThis",{configurable:!0,enumerable:!1,value:n,writable:!0})}else(typeof globalThis!="object"||globalThis!==n)&&(n.globalThis=n);return n},uv}var fv,PT;function qN(){if(PT)return fv;PT=1;var t=Mb(),e=Ob(),r=Pb(),n=XN(),i=r(),o=function(){return i};return t(o,{getPolyfill:r,implementation:e,shim:n}),fv=o,fv}var YN=qN();const JN=ka(YN),Ta=JN(),Rb={vtkObject:()=>null};function Ea(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Ta.console&&Ta.console.error&&Ta.console.error("Invalid VTK object"),null;const e=Rb[t.vtkClass];if(!e)return Ta.console&&Ta.console.error&&Ta.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const r={...t};Object.keys(r).forEach(i=>{r[i]&&typeof r[i]=="object"&&r[i].vtkClass&&(r[i]=Ea(r[i]))});const n=e(r);return n&&n.modified&&n.modified(),n}function ZN(t,e){Rb[t]=e}Ea.register=ZN;class dv extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let Xy=0;const Ab=t=>{throw new Error(`Named parameter '${t}' is missing`)},Lb=Symbol("void");function QN(){return Xy}const Nb={};function _u(){}const eV=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];eV.forEach(t=>{Nb[t]=_u});Ta.console=console.hasOwnProperty("log")?console:Nb;const Il={debug:_u,error:Ta.console.error||_u,info:Ta.console.info||_u,log:Ta.console.log||_u,warn:Ta.console.warn||_u};function Vb(t,e){Il[t]&&(Il[t]=e||_u)}function kb(){Il.log(...arguments)}function Fb(){Il.info(...arguments)}function wm(){Il.debug(...arguments)}function dn(){Il.error(...arguments)}function k1(){Il.warn(...arguments)}const RT={};function Ub(t){RT[t]||(Il.error(t),RT[t]=!0)}const xi=Object.create(null);xi.Float32Array=Float32Array;xi.Float64Array=Float64Array;xi.Uint8Array=Uint8Array;xi.Int8Array=Int8Array;xi.Uint16Array=Uint16Array;xi.Int16Array=Int16Array;xi.Uint32Array=Uint32Array;xi.Int32Array=Int32Array;xi.Uint8ClampedArray=Uint8ClampedArray;try{xi.BigInt64Array=BigInt64Array,xi.BigUint64Array=BigUint64Array}catch{}function M0(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(xi[t]||Float64Array)(...r)}function F1(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return(xi[t]||Float64Array).from(...r)}function U1(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Mr(t){return U1(t[0]==="_"?t.slice(1):t)}function Bb(t){return t.charAt(0).toLowerCase()+t.slice(1)}function Gb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const n=["TB","GB","MB","KB"];let i=Number(t),o="B";for(;i>r;)i/=r,o=n.pop();return`${i.toFixed(e)} ${o}`}function Wb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const r=[];let n=t;for(;n>1e3;)r.push(`000${n%1e3}`.slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function $b(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function tV(t){return Object.values(xi).some(e=>t instanceof e)}function nV(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function rV(t,e){return Object.keys(t).find(r=>t[r]===e)}function zb(t){return t&&t.isA?t.getState():t}function Iw(t){setTimeout(t,0)}function jb(t,e){const r=performance.now();t.finally(()=>{const n=performance.now()-r;e(n)})}function Zn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$b(e);const r=[];if(Number.isInteger(e.mtime)||(e.mtime=++Xy),!("classHierarchy"in e))e.classHierarchy=new dv("vtkObject");else if(!(e.classHierarchy instanceof dv)){const o=new dv;for(let a=0;a<e.classHierarchy.length;a++)o.push(e.classHierarchy[a]);e.classHierarchy=o}function n(o){r[o]=null}function i(o){function a(){n(o)}return Object.freeze({unsubscribe:a})}return t.isDeleted=()=>!!e.deleted,t.modified=o=>{if(e.deleted){dn("instance deleted - cannot call any method");return}o&&o<t.getMTime()||(e.mtime=++Xy,r.forEach(a=>a&&a(t)))},t.onModified=o=>{if(e.deleted)return dn("instance deleted - cannot call any method"),null;const a=r.length;return r.push(o),i(a)},t.getMTime=()=>e.mtime,t.isA=o=>{let a=e.classHierarchy.length;for(;a--;)if(e.classHierarchy[a]===o)return!0;return!1},t.getClassName=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-o]},t.set=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(o).forEach(l=>{const f=s?null:t[`set${U1(l)}`];f&&Array.isArray(o[l])&&f.length>1?c=f(...o[l])||c:f?c=f(o[l])||c:(["mtime"].indexOf(l)===-1&&!a&&k1(`Warning: Set value to model directly ${l}, ${o[l]}`),c=e[l]!==o[l]||c,e[l]=o[l])}),c},t.get=function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];if(!a.length)return e;const c={};return a.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=o=>e[o],t.delete=()=>{Object.keys(e).forEach(o=>delete e[o]),r.forEach((o,a)=>n(a)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const o={...e,vtkClass:t.getClassName()};Object.keys(o).forEach(s=>{o[s]===null||o[s]===void 0||s[0]==="_"?delete o[s]:o[s].isA?o[s]=o[s].getState():Array.isArray(o[s])?o[s]=o[s].map(zb):tV(o[s])&&(o[s]=Array.from(o[s]))});const a={};return Object.keys(o).sort().forEach(s=>{a[s]=o[s]}),a.mtime&&delete a.mtime,a},t.shallowCopy=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(o.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${o.getClassName()} into ${t.getClassName()}`);const s=o.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(f=>{const u=c.indexOf(f);u===-1?a&&wm(`add ${f} in shallowCopy`):c.splice(u,1),e[f]=s[f]}),c.length&&a&&wm(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const iV={object(t,e,r){return function(){return{...e[r.name]}}}};function Wi(t,e,r){r.forEach(n=>{if(typeof n=="object"){const i=iV[n.type];i?t[`get${Mr(n.name)}`]=i(t,e,n):t[`get${Mr(n.name)}`]=()=>e[n.name]}else t[`get${Mr(n)}`]=()=>e[n]})}const Hb={enum(t,e,r){const n=`_on${Mr(r.name)}Changed`;return i=>{if(typeof i=="string"){if(r.enum[i]!==void 0)return e[r.name]!==r.enum[i]?(e[r.name]=r.enum[i],t.modified(),!0):!1;throw dn(`Set Enum with invalid argument ${r}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[r.name]!==i){if(Object.keys(r.enum).map(o=>r.enum[o]).indexOf(i)!==-1){const o=e[r.name];return e[r.name]=i,e[n]?.(t,e,i,o),t.modified(),!0}throw dn(`Set Enum outside numeric range ${r}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw dn(`Set Enum with invalid argument (String/Number) ${r}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,r){r.params?.length===1&&k1('Setter of type "object" with a single "param" field is not supported');const n=`_on${Mr(r.name)}Changed`;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];let s;if(o.length>1&&r.params?.length?s=r.params.reduce((c,l,f)=>Object.assign(c,{[l]:o[f]}),{}):s=o[0],!Dw(e[r.name],s)){const c=e[r.name];return e[r.name]=s,e[n]?.(t,e,s,c),t.modified(),!0}return!1}}};function AT(t){if(typeof t=="object"){const e=Hb[t.type];if(e)return(r,n)=>e(r,n,t);throw dn(`No setter for field ${t}`),new TypeError("No setter for field")}return function(r,n){const i=`_on${Mr(t)}Changed`;return function(a){if(n.deleted)return dn("instance deleted - cannot call any method"),!1;if(n[t]!==a){const s=n[t.name];return n[t]=a,n[i]?.(r,n,a,s),r.modified(),!0}return!1}}}function eg(t,e,r){r.forEach(n=>{typeof n=="object"?t[`set${Mr(n.name)}`]=AT(n)(t,e):t[`set${Mr(n)}`]=AT(n)(t,e)})}function Er(t,e,r){Wi(t,e,r),eg(t,e,r)}function O0(t,e,r){r.forEach(n=>{t[`get${Mr(n)}`]=()=>e[n]?Array.from(e[n]):e[n],t[`get${Mr(n)}ByReference`]=()=>e[n]})}function Mw(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(o=>{if(e[o]&&n&&e[o].length!==n)throw new RangeError(`Invalid initial number of values for array (${o})`);const a=`_on${Mr(o)}Changed`;t[`set${Mr(o)}`]=function(){if(e.deleted)return dn("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let f=c,u,d=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],d=!0),f==null)u=e[o]!==f;else{if(n&&f.length!==n)if(f.length<n&&i!==void 0)for(f=Array.from(f),d=!1;f.length<n;)f.push(i);else throw new RangeError(`Invalid number of values for array setter (${o})`);u=e[o]==null||e[o].length!==f.length;for(let h=0;!u&&h<f.length;++h)u=e[o][h]!==f[h];u&&d&&(f=Array.from(f))}if(u){const h=e[o.name];e[o]=f,e[a]?.(t,e,f,h),t.modified()}return u},t[`set${Mr(o)}From`]=s=>{const c=e[o];s.forEach((l,f)=>{c[f]=l})}})}function Ow(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;O0(t,e,r),Mw(t,e,r,n,i)}function tg(t,e,r){for(let n=0;n<r.length;n++){const i=r[n];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function Pw(t,e,r,n){e.inputData?e.inputData=e.inputData.map(Ea):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Ea):e.inputConnection=[],e.output?e.output=e.output.map(Ea):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Ea):e.inputArrayToProcess=[],e.numberOfInputs=r;function i(h){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){dn("instance deleted - cannot call any method");return}if(g>=e.numberOfInputs){dn(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[g]!==h||e.inputConnection[g])&&(e.inputData[g]=h,e.inputConnection[g]=null,t.modified&&t.modified())}function o(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]&&(e.inputData[h]=e.inputConnection[h]()),e.inputData[h]}function a(h){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){dn("instance deleted - cannot call any method");return}if(g>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",dn(p);return}e.inputData[g]=null,e.inputConnection[g]=h}function s(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]}function c(){let h=e.numberOfInputs;for(;h&&!e.inputData[h-1]&&!e.inputConnection[h-1];)h--;return h===e.numberOfInputs&&e.numberOfInputs++,h}function l(h){if(e.deleted){dn("instance deleted - cannot call any method");return}a(h,c())}function f(h){if(e.deleted){dn("instance deleted - cannot call any method");return}i(h,c())}function u(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(dn("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[h])}t.shouldUpdate=()=>{const h=t.getMTime();let g=1/0,p=n;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const m=e.output[p].getMTime();if(m<h)return!0;m<g&&(g=m)}for(p=e.numberOfInputs;p--;)if(e.inputConnection[p]?.filter.shouldUpdate()||t.getInputData(p)?.getMTime()>g)return!0;return!1};function d(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const g=()=>u(h);return g.filter=t,g}if(e.numberOfInputs){let h=e.numberOfInputs;for(;h--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=a,t.addInputData=f,t.addInputConnection=l,t.getInputData=o,t.getInputConnection=s}n&&(t.getOutputData=u,t.getOutputPort=d),t.update=()=>{const h=[];if(e.numberOfInputs){let g=0;for(;g<e.numberOfInputs;)h[g]=t.getInputData(g),g++}t.requestData&&!t.isDeleted()&&t.shouldUpdate()&&t.requestData(h,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>n||e.output.length,t.getInputArrayToProcess=h=>{const g=e.inputArrayToProcess[h],p=e.inputData[h];return g&&p?p[`get${g.fieldAssociation}`]().getArray(g.arrayName):null},t.setInputArrayToProcess=function(h,g,p){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<h;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[h]={arrayName:g,fieldAssociation:p,attributeType:m}}}const Rw=Symbol("Event abort");function Aw(t,e,r){const n=[],i=t.delete;let o=1;function a(l){for(let f=0;f<n.length;++f){const[u]=n[f];if(u===l){n.splice(f,1);return}}}function s(l){function f(){a(l)}return Object.freeze({unsubscribe:f})}function c(){if(e.deleted){dn("instance deleted - cannot call any method");return}const l=n.slice();for(let f=0;f<l.length;++f){const[,u,d]=l[f];if(u){if(d<0)setTimeout(()=>u.apply(t,arguments),1-d);else if(u.apply(t,arguments)===Rw)break}}}t[`invoke${Mr(r)}`]=c,t[`on${Mr(r)}`]=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${r}`),null;if(e.deleted)return dn("instance deleted - cannot call any method"),null;const u=o++;return n.push([u,l,f]),n.sort((d,h)=>h[2]-d[2]),s(u)},t.delete=()=>{i(),n.forEach(l=>{let[f]=l;return a(f)})}}function On(t,e){const r=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},o={};return t(o,i,n),Object.freeze(o)};return e&&Ea.register(e,r),r}function ng(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e.filter(a=>!!a).map(a=>a(...i))}}function Lw(t){return t&&t.isA&&t.isA("vtkObject")}function Cm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Lw(t)){if(n.indexOf(t)>=0)return r;n.push(t);const i=e(t);i!==void 0&&r.push(i);const o=t.get();Object.keys(o).forEach(a=>{const s=o[a];Array.isArray(s)?s.forEach(c=>{Cm(c,e,r,n)}):Cm(s,e,r,n)})}return r}function Kb(t,e,r){var n=this;let i;const o=function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];const l=n,f=()=>{i=null,r||t.apply(l,s)},u=r&&!i;clearTimeout(i),i=setTimeout(f,e),u&&t.apply(l,s)};return o.cancel=()=>clearTimeout(i),o}function Xb(t,e){let r=!1,n=null;function i(){r=!1,n!==null&&(o(...n),n=null)}function o(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];if(r){n=s;return}r=!0,t(...s),setTimeout(i,e)}return o}function Nw(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=(n,i)=>{e.keystore[n]=i},t.getKey=n=>e.keystore[n],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=n=>delete e.keystore[n],t.clearKeystore=()=>t.getAllKeys().forEach(n=>delete e.keystore[n])}let oV=1;const Bg="__root__";function qb(t,e){Nw(t,e);const r=t.delete;e.proxyId=`${oV++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Wi(t,e,["proxyId","proxyGroup","proxyName"]),Er(t,e,["proxyManager"]);const n={},i={};function o(l,f){i[f]||(i[f]=[]);const u=i[f];for(let d=0;d<l.length;d++)u.push(l[d].name),n[l[d].name]=l[d],l[d].children&&l[d].children.length&&o(l[d].children,l[d].name)}o(e.ui,Bg),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(n).forEach(f=>delete n[f]),Object.keys(i).forEach(f=>delete i[f]),o(e.ui,Bg),t.modified()};function a(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Bg;return i[l]}t.updateProxyProperty=(l,f)=>{const u=n[l];u?Object.assign(u,f):n[l]={...f}},t.activate=()=>{if(e.proxyManager){const l=`setActive${Mr(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,f)=>{f in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[f]=[]),e.propertyLinkSubscribers[f].push(l)},t.gcPropertyLinks=l=>{const f=e.propertyLinkSubscribers[l]||[];for(;f.length;)f.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const d=[];let h=0,g=!1;function p(C){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(g)return null;const T=[];let S=null;for(h=d.length;h--;){const E=d[h];E.instance===C?S=E:T.push(E)}if(!S)return null;const _=S.instance[`get${Mr(S.propertyName)}`]();if(!nV(_,u)||x){for(u=_,g=!0;T.length;){const E=T.pop();E.instance.set({[E.propertyName]:u})}g=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=_),_}function m(C,x){const T=[];for(h=d.length;h--;){const S=d[h];S.instance===C&&(S.propertyName===x||x===void 0)&&(S.subscription.unsubscribe(),T.push(h))}for(;T.length;)d.splice(T.pop(),1)}function w(C,x){let T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const S=C.onModified(p),_=d[0];return d.push({instance:C,propertyName:x,subscription:S}),T&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?C.set({[x]:e.propertyLinkMap[l].value}):_&&p(_.instance,!0)),{unsubscribe:()=>m(C,x)}}function v(){for(;d.length;)d.pop().subscription.unsubscribe()}const y={bind:w,unbind:m,unsubscribe:v,persistent:f};return e.propertyLinkMap[l]=y,y};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Bg;const f=[],u=e.proxyId,d=a(l)||[];for(let h=0;h<d.length;h++){const g=d[h],p=t[`get${Mr(g)}`],m=p?p():void 0,w={id:u,name:g,value:m},v=s(g);v.length&&(w.children=v),f.push(w)}return f}t.listPropertyNames=()=>s().map(l=>l.name),t.getPropertyByName=l=>s().find(f=>f.name===l),t.getPropertyDomainByName=l=>(n[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let f=l.length;for(;f--;)e.propertyLinkMap[l[f]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:f,property:u,persistent:d,updateOnBind:h,type:g}=e.links[l];if(g==="application"){const p=e.proxyManager.getPropertyLink(f,d);t.registerPropertyLinkForGC(p,"application"),p.bind(t,u,h)}}}Iw(c)}function Yb(t,e,r){const n=t.delete,i=[],o=Object.keys(r);let a=o.length;for(;a--;){const s=o[a],{modelKey:c,property:l,modified:f=!0}=r[s],u=Mr(l),d=Mr(s);t[`get${d}`]=e[c][`get${u}`],t[`set${d}`]=e[c][`set${u}`],f&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();n()}}function Jb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let l=c.length;for(;l--;){const f=c[l];e[f].set(s[f])}}const o=Object.keys(n);let a=o.length;for(;a--;){const s=o[a];e[s]=n[s];const c=r[s];t[`set${Mr(s)}`]=l=>{if(l!==e[s]){e[s]=l;const f=c[l];i(f),t.modified()}}}o.length&&Wi(t,e,o)}const LT=10,NT=40,VT=800;function Zb(t){let e=0,r=0,n=0,i=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*LT,i=r*LT,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||i)&&t.deltaMode&&(t.deltaMode===1?(n*=NT,i*=NT):(n*=VT,i*=VT)),n&&!e&&(e=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:e,spinY:r||e,pixelX:n,pixelY:i||n}}var K={algo:Pw,capitalize:U1,chain:ng,debounce:Kb,enumToString:rV,event:Aw,EVENT_ABORT:Rw,formatBytesToProperUnit:Gb,formatNumbersWithThousandSeparator:Wb,get:Wi,getArray:O0,getCurrentGlobalMTime:QN,getStateArrayMapFunc:zb,isVtkObject:Lw,keystore:Nw,measurePromiseExecution:jb,moveToProtected:tg,newInstance:On,newTypedArray:M0,newTypedArrayFrom:F1,normalizeWheel:Zb,obj:Zn,proxy:qb,proxyPropertyMapping:Yb,proxyPropertyState:Jb,safeArrays:$b,set:eg,setArray:Mw,setGet:Er,setGetArray:Ow,setImmediate:Iw,setLoggerFunction:Vb,throttle:Xb,traverseInstanceTree:Cm,TYPED_ARRAYS:xi,uncapitalize:Bb,VOID:Lb,vtkDebugMacro:wm,vtkErrorMacro:dn,vtkInfoMacro:Fb,vtkLogMacro:kb,vtkOnceErrorMacro:Ub,vtkWarningMacro:k1,objectSetterMap:Hb,requiredParam:Ab},_i=Object.freeze({__proto__:null,requiredParam:Ab,VOID:Lb,setLoggerFunction:Vb,vtkLogMacro:kb,vtkInfoMacro:Fb,vtkDebugMacro:wm,vtkErrorMacro:dn,vtkWarningMacro:k1,vtkOnceErrorMacro:Ub,TYPED_ARRAYS:xi,newTypedArray:M0,newTypedArrayFrom:F1,capitalize:U1,_capitalize:Mr,uncapitalize:Bb,formatBytesToProperUnit:Gb,formatNumbersWithThousandSeparator:Wb,setImmediateVTK:Iw,measurePromiseExecution:jb,obj:Zn,get:Wi,set:eg,setGet:Er,getArray:O0,setArray:Mw,setGetArray:Ow,moveToProtected:tg,algo:Pw,EVENT_ABORT:Rw,event:Aw,newInstance:On,chain:ng,isVtkObject:Lw,traverseInstanceTree:Cm,debounce:Kb,throttle:Xb,keystore:Nw,proxy:qb,proxyPropertyMapping:Yb,proxyPropertyState:Jb,normalizeWheel:Zb,default:K}),kp={exports:{}},aV=kp.exports,kT;function sV(){return kT||(kT=1,(function(t){(function(e,r,n){function i(c){var l=this,f=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(c),l.s0<0&&(l.s0+=1),l.s1-=f(c),l.s1<0&&(l.s1+=1),l.s2-=f(c),l.s2<0&&(l.s2+=1),f=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function a(c,l){var f=new i(c),u=l&&l.state,d=f.next;return d.int32=function(){return f.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,f),d.state=function(){return o(f,{})}),d}function s(){var c=4022871197,l=function(f){f=String(f);for(var u=0;u<f.length;u++){c+=f.charCodeAt(u);var d=.02519603282416938*c;c=d>>>0,d-=c,d*=c,c=d>>>0,d-=c,c+=d*4294967296}return(c>>>0)*23283064365386963e-26};return l}r&&r.exports?r.exports=a:this.alea=a})(aV,t)})(kp)),kp.exports}var Fp={exports:{}},cV=Fp.exports,FT;function lV(){return FT||(FT=1,(function(t){(function(e,r,n){function i(s){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function a(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&o(f,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xor128=a})(cV,t)})(Fp)),Fp.exports}var Up={exports:{}},uV=Up.exports,UT;function fV(){return UT||(UT=1,(function(t){(function(e,r,n){function i(s){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,f==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function a(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&o(f,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xorwow=a})(uV,t)})(Up)),Up.exports}var Bp={exports:{}},dV=Bp.exports,BT;function hV(){return BT||(BT=1,(function(t){(function(e,r,n){function i(s){var c=this;c.next=function(){var f=c.x,u=c.i,d,h;return d=f[u],d^=d>>>7,h=d^d<<24,d=f[u+1&7],h^=d^d>>>10,d=f[u+3&7],h^=d^d>>>3,d=f[u+4&7],h^=d^d<<7,d=f[u+7&7],d=d^d<<13,h^=d^d<<9,f[u]=h,c.i=u+1&7,h};function l(f,u){var d,h=[];if(u===(u|0))h[0]=u;else for(u=""+u,d=0;d<u.length;++d)h[d&7]=h[d&7]<<15^u.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&h[d]===0;++d);for(d==8?h[7]=-1:h[d],f.x=h,f.i=0,d=256;d>0;--d)f.next()}l(c,s)}function o(s,c){return c.x=s.x.slice(),c.i=s.i,c}function a(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(f.x&&o(f,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xorshift7=a})(dV,t)})(Bp)),Bp.exports}var Gp={exports:{}},gV=Gp.exports,GT;function pV(){return GT||(GT=1,(function(t){(function(e,r,n){function i(s){var c=this;c.next=function(){var f=c.w,u=c.X,d=c.i,h,g;return c.w=f=f+1640531527|0,g=u[d+34&127],h=u[d=d+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=u[d]=g^h,c.i=d,g+(f^f>>>16)|0};function l(f,u){var d,h,g,p,m,w=[],v=128;for(u===(u|0)?(h=u,u=null):(u=u+"\0",h=0,v=Math.max(v,u.length)),g=0,p=-32;p<v;++p)u&&(h^=u.charCodeAt((p+32)%u.length)),p===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(m=m+1640531527|0,d=w[p&127]^=h+m,g=d==0?g+1:0);for(g>=128&&(w[(u&&u.length||0)&127]=-1),g=127,p=512;p>0;--p)h=w[g+34&127],d=w[g=g+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,w[g]=h^d;f.w=m,f.X=w,f.i=g}l(c,s)}function o(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function a(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(f.X&&o(f,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xor4096=a})(gV,t)})(Gp)),Gp.exports}var Wp={exports:{}},mV=Wp.exports,WT;function vV(){return WT||(WT=1,(function(t){(function(e,r,n){function i(s){var c=this,l="";c.next=function(){var u=c.b,d=c.c,h=c.d,g=c.a;return u=u<<25^u>>>7^d,d=d-h|0,h=h<<24^h>>>8^g,g=g-u|0,c.b=u=u<<20^u>>>12^d,c.c=d=d-h|0,c.d=h<<16^d>>>16^g,c.a=g-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):l+=s;for(var f=0;f<l.length+20;f++)c.b^=l.charCodeAt(f)|0,c.next()}function o(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function a(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&o(f,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.tychei=a})(mV,t)})(Wp)),Wp.exports}var $p={exports:{}};const yV={},wV=Object.freeze(Object.defineProperty({__proto__:null,default:yV},Symbol.toStringTag,{value:"Module"})),wc=kN(wV);var CV=$p.exports,$T;function xV(){return $T||($T=1,(function(t){(function(e,r,n){var i=256,o=6,a=52,s="random",c=n.pow(i,o),l=n.pow(2,a),f=l*2,u=i-1,d;function h(C,x,T){var S=[];x=x==!0?{entropy:!0}:x||{};var _=w(m(x.entropy?[C,y(r)]:C??v(),3),S),E=new g(S),D=function(){for(var b=E.g(o),I=c,O=0;b<l;)b=(b+O)*i,I*=i,O=E.g(1);for(;b>=f;)b/=2,I/=2,O>>>=1;return(b+O)/I};return D.int32=function(){return E.g(4)|0},D.quick=function(){return E.g(4)/4294967296},D.double=D,w(y(E.S),r),(x.pass||T||function(b,I,O,M){return M&&(M.S&&p(M,E),b.state=function(){return p(E,{})}),O?(n[s]=b,I):b})(D,_,"global"in x?x.global:this==n,x.state)}function g(C){var x,T=C.length,S=this,_=0,E=S.i=S.j=0,D=S.S=[];for(T||(C=[T++]);_<i;)D[_]=_++;for(_=0;_<i;_++)D[_]=D[E=u&E+C[_%T]+(x=D[_])],D[E]=x;(S.g=function(b){for(var I,O=0,M=S.i,R=S.j,A=S.S;b--;)I=A[M=u&M+1],O=O*i+A[u&(A[M]=A[R=u&R+I])+(A[R]=I)];return S.i=M,S.j=R,O})(i)}function p(C,x){return x.i=C.i,x.j=C.j,x.S=C.S.slice(),x}function m(C,x){var T=[],S=typeof C,_;if(x&&S=="object")for(_ in C)try{T.push(m(C[_],x-1))}catch{}return T.length?T:S=="string"?C:C+"\0"}function w(C,x){for(var T=C+"",S,_=0;_<T.length;)x[u&_]=u&(S^=x[u&_]*19)+T.charCodeAt(_++);return y(x)}function v(){try{var C;return d&&(C=d.randomBytes)?C=C(i):(C=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(C)),y(C)}catch{var x=e.navigator,T=x&&x.plugins;return[+new Date,e,T,e.screen,y(r)]}}function y(C){return String.fromCharCode.apply(0,C)}if(w(n.random(),r),t.exports){t.exports=h;try{d=wc}catch{}}else n["seed"+s]=h})(typeof self<"u"?self:CV,[],Math)})($p)),$p.exports}var hv,zT;function TV(){if(zT)return hv;zT=1;var t=sV(),e=lV(),r=fV(),n=hV(),i=pV(),o=vV(),a=xV();return a.alea=t,a.xor128=e,a.xorwow=r,a.xorshift7=n,a.xor4096=i,a.tychei=o,hv=a,hv}var SV=TV();const _V=ka(SV),Vw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],EV=[1,0,0,0,1,0,0,0,1],kw=1e-6,Fw=1e-12,{vtkErrorMacro:Qb,vtkWarningMacro:Ku}=K;let e8=0;const jT=20;function rg(t){return()=>Qb(`vtkMath::${t} - NOT IMPLEMENTED`)}function Bd(t,e,r,n){let i;for(let o=0;o<e;o++)i=t[r*e+o],t[r*e+o]=t[n*e+o],t[n*e+o]=i}function xd(t,e,r,n){let i;for(let o=0;o<e;o++)i=t[o*e+r],t[o*e+r]=t[o*e+n],t[o*e+n]=i}function ar(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let r=0;r<t;++r)e[r]=0;return e}const bV=()=>Math.PI;function DV(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function wr(t){return t/180*Math.PI}function xm(t){return t*180/Math.PI}const{round:Td,floor:Uw,ceil:IV,min:MV,max:OV}=Math;function PV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0;for(let i=e,o=t.length;i<o;i+=r)t[i]<n&&(n=t[i]);return n}function RV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=-1/0;for(let i=e,o=t.length;i<o;i+=r)n<t[i]&&(n=t[i]);return n}function AV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,i=-1/0;for(let o=e,a=t.length;o<a;o+=r)t[o]<n&&(n=t[o]),i<t[o]&&(i=t[o]);return[n,i]}const LV=rg("ceilLog2"),NV=rg("factorial");function Zo(t){let e=1;for(;e<t;)e*=2;return e}function Sd(t){return t===Zo(t)}function VV(t,e){let r=1;for(let n=1;n<=e;++n)r*=(t-n+1)/n;return Math.floor(r)}function kV(t,e){if(t<e)return 0;const r=ar(e);for(let n=0;n<e;++n)r[n]=n;return r}function FV(t,e,r){let n=0;for(let i=e-1;i>=0;--i)if(r[i]<t-e+i){let o=r[i]+1;for(;i<e;)r[i++]=o++;n=1;break}return n}function UV(t){_V(`${t}`,{global:!0}),e8=t}function BV(){return e8}function GV(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+r*Math.random()}const WV=rg("gaussian");function u0(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function ei(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function t8(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function n8(t,e){return t[0]*=e,t[1]*=e,t}function qy(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function $V(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function jt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zV(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[0]*e[2],r[3]=t[1]*e[0],r[4]=t[1]*e[1],r[5]=t[1]*e[2],r[6]=t[2]*e[0],r[7]=t[2]*e[1],r[8]=t[2]*e[2]}function Qi(t,e,r){const n=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],o=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=i,r[2]=o,r}function Do(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function Ro(t){const e=Do(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function jV(t){const e=Do(t,3);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e),e}function HV(t,e,r,n){const i=t[0]*t[0],o=t[1]*t[1],a=t[2]*t[2],s=Math.sqrt(i+o+a);let c,l,f;i>o&&i>a?(c=0,l=1,f=2):o>a?(c=1,l=2,f=0):(c=2,l=0,f=1);const u=t[c]/s,d=t[l]/s,h=t[f]/s,g=Math.sqrt(u*u+h*h);if(n!==0){const p=Math.sin(n),m=Math.cos(n);e&&(e[c]=(h*m-u*d*p)/g,e[l]=p*g,e[f]=(-(u*m)-d*h*p)/g),r&&(r[c]=(-(h*p)-u*d*m)/g,r[l]=m*g,r[f]=(u*p-d*h*m)/g)}else e&&(e[c]=h/g,e[l]=0,e[f]=-u/g),r&&(r[c]=-u*d/g,r[l]=g,r[f]=-d*h/g)}function KV(t,e,r){const n=jt(e,e);if(n===0)return r[0]=0,r[1]=0,r[2]=0,!1;const i=jt(t,e)/n;for(let o=0;o<3;o++)r[o]=e[o];return t8(r,i),!0}function Yy(t,e){return t[0]*e[0]+t[1]*e[1]}function XV(t,e,r){const n=Yy(e,e);if(n===0)return r[0]=0,r[1]=0,!1;const i=Yy(t,e)/n;for(let o=0;o<2;o++)r[o]=e[o];return n8(r,i),!0}function So(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function qV(t,e){const r=[0,0,0];return Qi(t,e,r),Math.atan2(Do(r),jt(t,e))}function YV(t,e,r){const n=Math.abs(t-r);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(n**2)/(2*e))}function JV(t,e,r){const n=Math.abs(t-r);return Math.exp(-(n**2)/(2*e))}function ZV(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[1]*e[0],r[3]=t[1]*e[1]}function r8(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function i8(t){const e=r8(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function xr(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function QV(t,e){let r,n,i;const o=[0,0,0];for(let a=0;a<3;a++)i=Math.abs(t[a*3]),(n=Math.abs(t[a*3+1]))>i&&(i=n),(n=Math.abs(t[a*3+2]))>i&&(i=n),o[a]=1/i;i=o[0]*Math.abs(t[0]),r=0,(n=o[1]*Math.abs(t[3]))>=i&&(i=n,r=1),(n=o[2]*Math.abs(t[6]))>=i&&(r=2),r!==0&&(Bd(t,3,r,0),o[r]=o[0]),e[0]=r,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=o[1]*Math.abs(t[4]),r=1,(n=o[2]*Math.abs(t[7]))>=i&&(r=2,Bd(t,3,1,2),o[2]=o[1]),e[1]=r,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function ek(t,e,r){let n=r[e[0]];r[e[0]]=r[0],r[0]=n,n=r[e[1]],r[e[1]]=r[1],r[1]=n-t[3]*r[0],n=r[e[2]],r[e[2]]=r[2],r[2]=n-t[6]*r[0]-t[7]*r[1],r[2]/=t[8],r[1]=(r[1]-t[5]*r[2])/t[4],r[0]=(r[0]-t[1]*r[1]-t[2]*r[2])/t[0]}function tk(t,e,r){const n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],l=t[6],f=t[7],u=t[8],d=+xr(s,f,c,u),h=-xr(a,l,c,u),g=+xr(a,l,s,f),p=-xr(i,f,o,u),m=+xr(n,l,o,u),w=-xr(n,l,i,f),v=+xr(i,s,o,c),y=-xr(n,a,o,c),C=+xr(n,a,i,s),x=n*d+i*h+o*g,T=d*e[0]+p*e[1]+v*e[2],S=h*e[0]+m*e[1]+y*e[2],_=g*e[0]+w*e[1]+C*e[2];r[0]=T/x,r[1]=S/x,r[2]=_/x}function zp(t,e,r){const n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],o=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];r[0]=n,r[1]=i,r[2]=o}function Jy(t,e,r){const n=[...t],i=[...e];for(let o=0;o<3;o++)r[o]=n[0]*i[o]+n[1]*i[o+3]+n[2]*i[o+6],r[o+3]=n[3]*i[o]+n[4]*i[o+3]+n[5]*i[o+6],r[o+6]=n[6]*i[o]+n[7]*i[o+3]+n[8]*i[o+6]}function nk(t,e,r,n,i,o,a){n!==i&&Qb("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let l=0;l<r;l++)for(let f=0;f<o;f++){a[l*o+f]=0;for(let u=0;u<n;u++)a[l*o+f]+=s[l*n+u]*c[f+o*u]}}function qf(t,e){let r;r=t[3],e[3]=t[1],e[1]=r,r=t[6],e[6]=t[2],e[2]=r,r=t[7],e[7]=t[5],e[5]=r,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function rk(t,e){const r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=+xr(a,l,s,f),d=-xr(o,c,s,f),h=+xr(o,c,a,l),g=-xr(n,l,i,f),p=+xr(r,c,i,f),m=-xr(r,c,n,l),w=+xr(n,a,i,s),v=-xr(r,o,i,s),y=+xr(r,o,n,a),C=r*u+n*d+i*h;C===0&&Ku("Matrix has 0 determinant"),e[0]=u/C,e[3]=d/C,e[6]=h/C,e[1]=g/C,e[4]=p/C,e[7]=m/C,e[2]=w/C,e[5]=v/C,e[8]=y/C}function B1(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function o8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:kw;if(t.length!==e.length)return!1;function n(i,o){return Math.abs(i-e[o])<=r}return t.every(n)}const f0=o8;function a8(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function s8(t,e){for(let r=0;r<t;r++){for(let n=0;n<t;n++)e[r*t+n]=0;e[r*t+r]=1}return e}function ik(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kw;return f0(t,Vw,e)}function ok(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kw;return f0(t,EV,e)}function c8(t,e){const r=t[0]*t[0],n=t[0]*t[1],i=t[0]*t[2],o=t[0]*t[3],a=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],f=t[1]*t[3],u=t[2]*t[3],d=a+s+c;let h=1/(r+d);const g=(r-d)*h;h*=2,e[0]=a*h+g,e[3]=(l+o)*h,e[6]=(f-i)*h,e[1]=(l-o)*h,e[4]=s*h+g,e[7]=(u+n)*h,e[2]=(f+i)*h,e[5]=(u-n)*h,e[8]=c*h+g}function jp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const r=`${t}`.split("e");let n="";return+r[1]+e>0&&(n="+"),+`${Math.round(`${+r[0]}e${n}${+r[1]+e}`)}e-${e}`}function Zy(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=jp(t[0],r),e[1]=jp(t[1],r),e[2]=jp(t[2],r),e}function ig(t,e,r,n){let i,o,a,s,c,l,f,u,d,h,g,p,m,w,v,y;const C=ar(e),x=ar(e),T=(_,E,D)=>{w=_[E],m=_[D],_[E]=w-p*(m+w*h),_[D]=m+p*(w-m*h)};for(s8(e,n),c=0;c<e;c++)C[c]=r[c]=t[c+c*e],x[c]=0;for(i=0;i<jT;i++){for(g=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)g+=Math.abs(t[c*e+s]);if(g===0)break;for(i<3?f=.2*g/(e*e):f=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(w=100*Math.abs(t[c*e+s]),i>3&&Math.abs(r[c])+w===Math.abs(r[c])&&Math.abs(r[s])+w===Math.abs(r[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>f){for(m=r[s]-r[c],Math.abs(m)+w===Math.abs(m)?d=t[c*e+s]/m:(u=.5*m/t[c*e+s],d=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(d=-d)),v=1/Math.sqrt(1+d*d),p=d*v,h=p/(1+v),m=d*t[c*e+s],x[c]-=m,x[s]+=m,r[c]-=m,r[s]+=m,t[c*e+s]=0,o=0;o<=c-1;o++)T(t,o*e+c,o*e+s);for(o=c+1;o<=s-1;o++)T(t,c*e+o,o*e+s);for(o=s+1;o<e;o++)T(t,c*e+o,s*e+o);for(o=0;o<e;o++)T(n,o*e+c,o*e+s)}for(c=0;c<e;c++)C[c]+=x[c],r[c]=C[c],x[c]=0}if(i>=jT)return Ku("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(o=0;o<e-1;o++){for(a=o,y=r[a],i=o+1;i<e;i++)(r[i]>=y||Math.abs(r[i]-y)<Fw)&&(a=i,y=r[a]);a!==o&&(r[a]=r[o],r[o]=y,xd(n,e,o,a))}const S=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)n[i]>=0&&l++;if(l<S)for(i=0;i<e;i++)n[i*e+o]*=-1;return 1}function l8(t,e){const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r[0]=t[0]+t[4]+t[8],r[5]=t[0]-t[4]-t[8],r[10]=-t[0]+t[4]-t[8],r[15]=-t[0]-t[4]+t[8],r[1]=r[4]=t[7]-t[5],r[2]=r[8]=t[2]-t[6],r[3]=r[12]=t[3]-t[1],r[6]=r[9]=t[3]+t[1],r[7]=r[13]=t[2]+t[6],r[11]=r[14]=t[7]+t[5];const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],o=[...r];ig(o,4,i,n),e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12]}function ak(t,e,r){const n=t[0]*e[0],i=t[0]*e[1],o=t[0]*e[2],a=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],f=t[1]*e[3],u=t[2]*e[0],d=t[2]*e[1],h=t[2]*e[2],g=t[2]*e[3],p=t[3]*e[0],m=t[3]*e[1],w=t[3]*e[2],v=t[3]*e[3];r[0]=n-c-h-v,r[1]=i+s+g-w,r[2]=o-f+u+m,r[3]=a+l-d+p}function u8(t,e){for(let d=0;d<9;d++)e[d]=t[d];const r=ar(3),n=ar(3);let i;for(let d=0;d<3;d++){const h=Math.abs(e[d*3]),g=Math.abs(e[d*3+1]),p=Math.abs(e[d*3+2]);i=g>h?g:h,i=p>i?p:i,r[d]=1,i!==0&&(r[d]/=i)}const o=Math.abs(e[0])*r[0],a=Math.abs(e[3])*r[1],s=Math.abs(e[6])*r[2];n[0]=0,i=o,a>=i&&(i=a,n[0]=1),s>=i&&(n[0]=2),n[0]!==0&&(xd(e,3,n[0],0),r[n[0]]=r[0]);const c=Math.abs(e[4])*r[1],l=Math.abs(e[7])*r[2];n[1]=1,i=c,l>=i&&(n[1]=2,xd(e,3,1,2)),n[2]=2;let f=0;if(B1(e)<0){f=1;for(let d=0;d<9;d++)e[d]=-e[d]}const u=ar(4);if(l8(e,u),c8(u,e),f)for(let d=0;d<9;d++)e[d]=-e[d];n[1]!==1&&xd(e,3,n[1],1),n[0]!==0&&xd(e,3,n[0],0)}function f8(t,e,r){let n,i,o,a,s,c;const l=[...t];if(ig(l,3,e,r),e[0]===e[1]&&e[0]===e[2]){a8(r);return}for(qf(r,r),n=0;n<3;n++)if(e[(n+1)%3]===e[(n+2)%3]){for(c=Math.abs(r[n*3]),a=0,i=1;i<3;i++)c<(s=Math.abs(r[n*3+i]))&&(c=s,a=i);a!==n&&(s=e[a],e[a]=e[n],e[n]=s,Bd(r,3,n,a)),r[a*3+a]<0&&(r[a*3]=-r[a*3],r[a*3+1]=-r[a*3+1],r[a*3+2]=-r[a*3+2]),i=(a+1)%3,o=(a+2)%3,r[i*3]=0,r[i*3+1]=0,r[i*3+2]=0,r[i*3+i]=1;const f=Qi([r[a*3],r[a*3+1],r[a*3+2]],[r[i*3],r[i*3+1],r[i*3+2]],[]);Ro(f);const u=Qi(f,[r[a*3],r[a*3+1],r[a*3+2]],[]);for(let d=0;d<3;d++)r[o*3+d]=f[d],r[i*3+d]=u[d];qf(r,r);return}for(c=Math.abs(r[0]),a=0,n=1;n<3;n++)c<(s=Math.abs(r[n*3]))&&(c=s,a=n);if(a!==0){const f=e[a];e[a]=e[0],e[0]=f,Bd(r,3,a,0)}if(Math.abs(r[4])<Math.abs(r[7])){const f=e[2];e[2]=e[1],e[1]=f,Bd(r,3,1,2)}for(n=0;n<2;n++)r[n*3+n]<0&&(r[n*3]=-r[n*3],r[n*3+1]=-r[n*3+1],r[n*3+2]=-r[n*3+2]);B1(r)<0&&(r[6]=-r[6],r[7]=-r[7],r[8]=-r[8]),qf(r,r)}function sk(t,e,r,n){let i;const o=[...t],a=B1(o);if(a<0)for(i=0;i<9;i++)o[i]=-o[i];u8(o,e),qf(o,o),Jy(o,e,n),f8(n,r,n),Jy(e,n,e),qf(n,n),a<0&&(r[0]=-r[0],r[1]=-r[1],r[2]=-r[2])}function Bw(t,e,r){let n,i,o,a,s=0,c,l,f;const u=ar(r);for(n=0;n<r;n++){for(a=0,i=0;i<r;i++)(f=Math.abs(t[n*r+i]))>a&&(a=f);if(a===0)return Ku("Unable to factor linear system"),0;u[n]=1/a}for(i=0;i<r;i++){for(n=0;n<i;n++){for(c=t[n*r+i],o=0;o<n;o++)c-=t[n*r+o]*t[o*r+i];t[n*r+i]=c}for(a=0,n=i;n<r;n++){for(c=t[n*r+i],o=0;o<i;o++)c-=t[n*r+o]*t[o*r+i];t[n*r+i]=c,(l=u[n]*Math.abs(c))>=a&&(a=l,s=n)}if(i!==s){for(o=0;o<r;o++)l=t[s*r+o],t[s*r+o]=t[i*r+o],t[i*r+o]=l;u[s]=u[i]}if(e[i]=s,Math.abs(t[i*r+i])<=Fw)return Ku("Unable to factor linear system"),0;if(i!==r-1)for(l=1/t[i*r+i],n=i+1;n<r;n++)t[n*r+i]*=l}return 1}function Gw(t,e,r,n){let i,o,a,s,c;for(a=-1,i=0;i<n;i++){if(s=e[i],c=r[s],r[s]=r[i],a>=0)for(o=a;o<=i-1;o++)c-=t[i*n+o]*r[o];else c!==0&&(a=i);r[i]=c}for(i=n-1;i>=0;i--){for(c=r[i],o=i+1;o<n;o++)c-=t[i*n+o]*r[o];r[i]=c/t[i*n+i]}}function d8(t,e,r){if(r===2){const i=ar(2),o=xr(t[0],t[1],t[2],t[3]);return o===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/o,i[1]=(-(t[2]*e[0])+t[0]*e[1])/o,e[0]=i[0],e[1]=i[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);const n=ar(r);return Bw(t,n,r)===0?0:(Gw(t,n,e,r),1)}function Ww(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const o=n||ar(r),a=i||ar(r);if(Bw(t,o,r)===0)return null;for(let s=0;s<r;s++){for(let c=0;c<r;c++)a[c]=0;a[s]=1,Gw(t,o,a,r);for(let c=0;c<r;c++)e[c*r+s]=a[c]}return e}function ck(t,e){let r=+Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let o=i;o<e;o++)Math.abs(t[i*e+o])>n&&(n=Math.abs(t[i*e+o]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<r&&(r=Math.abs(t[i*e+i]));return r===0?Number.MAX_VALUE:n/r}function lk(t,e,r){return ig(t,3,e,r)}function Qy(t,e,r,n){if(t<r)return Ku("Insufficient number of samples. Underdetermined."),0;let i,o,a;const s=ar(r*r),c=ar(r),l=ar(r*r);for(a=0;a<t;a++)for(i=0;i<r;i++)for(o=i;o<r;o++)s[i*r+o]+=e[a*r+i]*e[a*r+o];for(i=0;i<r;i++)for(o=0;o<i;o++)s[i*r+o]=s[o*r+i];for(ig(s,r,c,l),i=0;i<r;i++)n[i]=l[i*r+r-1];return 1}function uk(t,e,r,n,i,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<r||t<i)return Ku("Insufficient number of samples. Underdetermined."),0;const s=ar(i);let c=1,l,f=0,u,d,h,g=0;if(a){for(d=0;d<i;d++)s[d]=1;for(u=0;u<t;u++)for(d=0;d<i;d++)Math.abs(n[u*i+d])>Fw&&(c=0,s[d]=0);if(c&&i===1)return Ku("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Qy(t,e,r,o);if(c)g=1;else for(d=0;d<i;d++)s[d]&&(g=1)}g&&(l=ar(r),f=Qy(t,e,r,l));const p=ar(r*r),m=ar(r*r),w=ar(r*i);for(h=0;h<t;h++)for(u=0;u<r;u++){for(d=u;d<r;d++)p[u*r+d]+=e[h*r+u]*e[h*r+d];for(d=0;d<i;d++)w[u*i+d]+=e[h*r+u]*n[h*i+d]}for(u=0;u<r;u++)for(d=0;d<u;d++)p[u*r+d]=p[d*r+u];const v=Ww(p,m,r);if(v)for(u=0;u<r;u++)for(d=0;d<i;d++)for(o[u*i+d]=0,h=0;h<r;h++)o[u*i+d]+=m[u*r+h]*w[h*i+d];if(g){for(d=0;d<i;d++)if(s[d])for(u=0;u<r;u++)o[u*i+d]=l[u*i]}return g?f&&v:v}function fk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function _d(t,e){let r,n;const[i,o,a]=t,s=1/3,c=1/6,l=2/3;let f=i,u=i;o>f?f=o:o<u&&(u=o),a>f?f=a:a<u&&(u=a);const d=f;d>0?n=(f-u)/f:n=0,n>0?(i===f?r=c*(o-a)/(f-u):o===f?r=s+c*(a-i)/(f-u):r=l+c*(i-o)/(f-u),r<0&&(r+=1)):r=0,e[0]=r,e[1]=n,e[2]=d}function Eu(t,e){const[r,n,i]=t,o=1/3,a=1/6,s=2/3,c=5/6;let l,f,u;r>a&&r<=o?(f=1,l=(o-r)/a,u=0):r>o&&r<=.5?(f=1,u=(r-o)/a,l=0):r>.5&&r<=s?(u=1,f=(s-r)/a,l=0):r>s&&r<=c?(u=1,l=(r-s)/a,f=0):r>c&&r<=1?(l=1,u=(1-r)/a,f=0):(l=1,f=r/a,u=0),l=n*l+(1-n),f=n*f+(1-n),u=n*u+(1-n),l*=i,f*=i,u*=i,e[0]=l,e[1]=f,e[2]=u}function h8(t,e){const[r,n,i]=t;let o=(r+16)/116,a=n/500+o,s=o-i/200;o**3>.008856?o**=3:o=(o-16/116)/7.787,a**3>.008856?a**=3:a=(a-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,l=1,f=1.089;e[0]=c*a,e[1]=l*o,e[2]=f*s}function g8(t,e){const[r,n,i]=t,o=.9505,a=1,s=1.089;let c=r/o,l=n/a,f=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-f)}function p8(t,e){const[r,n,i]=t;let o=r*3.2406+n*-1.5372+i*-.4986,a=r*-.9689+n*1.8758+i*.0415,s=r*.0557+n*-.204+i*1.057;o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=o;c<a&&(c=a),c<s&&(c=s),c>1&&(o/=c,a/=c,s/=c),o<0&&(o=0),a<0&&(a=0),s<0&&(s=0),e[0]=o,e[1]=a,e[2]=s}function m8(t,e){let[r,n,i]=t;r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=r*.4124+n*.3576+i*.1805,e[1]=r*.2126+n*.7152+i*.0722,e[2]=r*.0193+n*.1192+i*.9505}function Au(t,e){const r=[0,0,0];m8(t,r),g8(r,e)}function Tm(t,e){const r=[0,0,0];h8(t,r),p8(r,e)}function $w(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Hp(t){return!(t[1]-t[0]<0)}function dk(t,e,r){return r[0]=Math.min(t[0],e[0]),r[1]=Math.max(t[0],e[0]),r[2]=Math.min(t[1],e[1]),r[3]=Math.max(t[1],e[1]),r[4]=Math.min(t[2],e[2]),r[5]=Math.max(t[2],e[2]),r}function ba(t,e,r){return t<e?e:t>r?r:t}function e5(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=ba(t[0],e[0],r[0]),n[1]=ba(t[1],e[1],r[1]),n[2]=ba(t[2],e[2],r[2]),n}function hk(t,e){let r=0;return e[0]!==e[1]&&(t<e[0]?r=e[0]:t>e[1]?r=e[1]:r=t,r=(r-e[0])/(e[1]-e[0])),r}const gk=rg("GetScalarTypeFittingRange"),pk=rg("GetAdjustedScalarRange");function mk(t,e){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]<e[r]||t[r]>e[r+1]||t[r+1]<e[r]||t[r+1]>e[r+1])return 0;return 1}function vk(t,e,r){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]+r[n/2]<e[n]||t[n]-r[n/2]>e[n+1]||t[n+1]+r[n/2]<e[n]||t[n+1]-r[n/2]>e[n+1])return 0;return 1}function yk(t,e,r){if(!t||!e||!r)return 0;for(let n=0;n<3;n++)if(t[n]+r[n]<e[2*n]||t[n]-r[n]>e[2*n+1])return 0;return 1}function wk(t,e,r,n){const i=ar(3),o=ar(3),a=ar(3),s=ar(3),c=ar(3),l=ar(3);for(let C=0;C<3;++C)i[C]=t[C]-e[C],o[C]=e[C]-r[C],a[C]=r[C]-t[C],s[C]=-i[C],c[C]=-o[C],l[C]=-a[C];const f=Do(s),u=Do(c),d=Do(a),h=ar(3);Qi(i,o,h);const g=Do(h),p=f*u*d/(2*g),m=2*g*g,w=u*u*jt(i,l)/m,v=d*d*jt(s,o)/m,y=f*f*jt(a,c)/m;for(let C=0;C<3;++C)n[C]=w*t[C]+v*e[C]+y*r[C];return p}const Ck=1/0,xk=-1/0,v8=t=>!Number.isFinite(t),{isFinite:Tk,isNaN:t5}=Number,Sm=t5;function Xu(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function Sk(t){let e=-1,r=-1;for(let n=0;n<t.length;n++){const i=Math.abs(t[n]);i>e&&(r=n,e=i)}return r}function y8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const r=new Array(e),n=new Array(e);for(let o=0;o<e;++o)r[o]=o,n[o]=o;for(let o=e-1;o>0;o--){let a=-1/0,s=0,c=0;for(let l=0;l<=o;++l){const f=r[l];for(let u=0;u<=o;++u){const d=n[u],h=Math.abs(t[f+e*d]);h>a&&(a=h,s=l,c=u)}}[r[o],r[s]]=[r[s],r[o]],[n[o],n[c]]=[n[c],n[o]]}const i=new Array(e*e).fill(0);for(let o=0;o<e;++o){const a=r[o]+e*n[o];i[a]=t[a]<0?-1:1}return i}function w8(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function _k(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(w8).join("")}`}function Gg(t){return Math.round(t*255)}function Ek(t){return t.length===3?`rgb(${t.map(Gg).join(", ")})`:`rgba(${Gg(t[0]||0)}, ${Gg(t[1]||0)}, ${Gg(t[2]||0)}, ${t[3]||0})`}var pt={Pi:bV,ldexp:DV,radiansFromDegrees:wr,degreesFromRadians:xm,round:Td,floor:Uw,ceil:IV,ceilLog2:LV,min:MV,max:OV,arrayMin:PV,arrayMax:RV,arrayRange:AV,isPowerOfTwo:Sd,nearestPowerOfTwo:Zo,factorial:NV,binomial:VV,beginCombination:kV,nextCombination:FV,randomSeed:UV,getSeed:BV,random:GV,gaussian:WV,add:u0,subtract:ei,multiplyScalar:t8,multiplyScalar2D:n8,multiplyAccumulate:qy,multiplyAccumulate2D:$V,dot:jt,outer:zV,cross:Qi,norm:Do,normalize:Ro,perpendiculars:HV,projectVector:KV,projectVector2D:XV,distance2BetweenPoints:So,angleBetweenVectors:qV,gaussianAmplitude:YV,gaussianWeight:JV,dot2D:Yy,outer2D:ZV,norm2D:r8,normalize2D:i8,determinant2x2:xr,LUFactor3x3:QV,LUSolve3x3:ek,linearSolve3x3:tk,multiply3x3_vect3:zp,multiply3x3_mat3:Jy,multiplyMatrix:nk,transpose3x3:qf,invert3x3:rk,identity3x3:a8,identity:s8,isIdentity:ik,isIdentity3x3:ok,determinant3x3:B1,quaternionToMatrix3x3:c8,areEquals:o8,areMatricesEqual:f0,roundNumber:jp,roundVector:Zy,matrix3x3ToQuaternion:l8,multiplyQuaternion:ak,orthogonalize3x3:u8,diagonalize3x3:f8,singularValueDecomposition3x3:sk,solveLinearSystem:d8,invertMatrix:Ww,luFactorLinearSystem:Bw,luSolveLinearSystem:Gw,estimateMatrixCondition:ck,jacobi:lk,jacobiN:ig,solveHomogeneousLeastSquares:Qy,solveLeastSquares:uk,hex2float:fk,rgb2hsv:_d,hsv2rgb:Eu,lab2xyz:h8,xyz2lab:g8,xyz2rgb:p8,rgb2xyz:m8,rgb2lab:Au,lab2rgb:Tm,uninitializeBounds:$w,areBoundsInitialized:Hp,computeBoundsFromPoints:dk,clampValue:ba,clampVector:e5,clampAndNormalizeValue:hk,getScalarTypeFittingRange:gk,getAdjustedScalarRange:pk,extentIsWithinOtherExtent:mk,boundsIsWithinOtherBounds:vk,pointIsWithinBounds:yk,solve3PointCircle:wk,inf:Ck,negInf:xk,isInf:v8,isNan:t5,isNaN:t5,isFinite:Tk,createUninitializedBounds:Xu,getMajorAxisIndex:Sk,getSparseOrthogonalMatrix:y8,floatToHex2:w8,floatRGB2HexCode:_k,float2CssRGBA:Ek};const C8={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Qt={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},bk=Qt.FLOAT;var x8={DefaultDataType:bk,DataTypeByteSize:C8,VtkDataTypes:Qt};const{vtkErrorMacro:Dk}=_i,{DefaultDataType:Ik}=x8,Mk=1e-6;function n5(t,e,r){const n=t.length;let i=Number.MAX_VALUE,o=-Number.MAX_VALUE,a,s;for(s=e;s<n;s+=r)if(!Number.isNaN(t[s])){i=t[s],o=i;break}for(;s<n;s+=r)a=t[s],a<i?i=a:a>o&&(o=a);return{min:i,max:o}}function Ok(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add(i){t>i&&(t=i),e<i&&(e=i),r++,n+=i},get(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange(){return{min:t,max:e}}}}function T8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){const i=t.length/r,o=new Float64Array(i);for(let a=0,s=0;a<i;++a){for(let c=s+r;s<c;++s)o[a]+=t[s]*t[s];o[a]**=.5}return n5(o,0,1)}return n5(t,e<0?0:e,r)}function HT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=t||[];for(;r.length<=e;)r.push(null);return r}function zw(t){return Object.prototype.toString.call(t).slice(8,-1)}function Pk(t){const e=t.getNumberOfComponents();let r=0;const n=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,n);const o=Do(n,e);o>r&&(r=o)}return r}const Rk={computeRange:T8,createRangeHelper:Ok,fastComputeRange:n5,getDataType:zw,getMaxNorm:Pk};function Ak(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;const i=t.getNumberOfComponents(),o=e.values.length/(i>0?i:1);if(n===o)return!0;if(n>o){const a=e.values;return e.values=M0(e.dataType,(n+o)*i),e.values.set(a),!0}return e.size>n*i&&(e.size=n*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.allocate=n=>{r(t.getNumberOfTuples()+n)},t.resize=n=>{r(n);const i=n*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>(t.resize(0),t),t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+i]},t.setComponent=(n,i,o)=>{o!==e.values[n*e.numberOfComponents+i]&&(e.values[n*e.numberOfComponents+i]=o,t.dataChange())},t.getValue=n=>{const i=n/e.numberOfComponents,o=n%e.numberOfComponents;return t.getComponent(i,o)},t.setValue=(n,i)=>{const o=n/e.numberOfComponents,a=n%e.numberOfComponents;t.setComponent(o,a,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=n;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let o=null;return e.ranges||(e.ranges=HT(e.ranges,e.numberOfComponents)),o=e.ranges[i],o?(e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple):(o=T8(t.getData(),n,e.numberOfComponents),e.ranges[i]=o,e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple)},t.setRange=(n,i)=>{e.ranges||(e.ranges=HT(e.ranges,e.numberOfComponents));const o={min:n.min,max:n.max};return e.ranges[i]=o,e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);const i=[];for(let o=0;o<e.numberOfComponents;o++){const[a,s]=t.getRange(o),c={min:a,max:s};i.push(c)}if(e.numberOfComponents>1){const[o,a]=t.getRange(-1),s={min:o,max:a};i.push(s)}return i},t.setTuple=(n,i)=>{const o=n*e.numberOfComponents;for(let a=0;a<e.numberOfComponents;a++)e.values[o+a]=i[a]},t.setTuples=(n,i)=>{let o=n*e.numberOfComponents;const a=Math.min(i.length,e.size-o);for(let s=0;s<a;)e.values[o++]=i[s++]},t.insertTuple=(n,i)=>(e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,i),n),t.insertTuples=(n,i)=>{const o=n+i.length/e.numberOfComponents;return e.size<o*e.numberOfComponents&&(e.size=o*e.numberOfComponents,r(o)),t.setTuples(n,i),o},t.insertNextTuple=n=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,n)},t.insertNextTuples=n=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,n)},t.findTuple=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mk;for(let o=0;o<e.size;o+=e.numberOfComponents)if(Math.abs(n[0]-e.values[o])<=i){let a=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(n[s]-e.values[o+s])>i){a=!1;break}if(a)return o/e.numberOfComponents}return-1},t.getTuple=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const o=e.numberOfComponents||1,a=n*o;switch(o){case 4:i[3]=e.values[a+3];case 3:i[2]=e.values[a+2];case 2:i[1]=e.values[a+1];case 1:i[0]=e.values[a];break;default:for(let s=o-1;s>=0;--s)i[s]=e.values[a+s]}return i},t.getTuples=(n,i)=>{const o=(n??0)*e.numberOfComponents,a=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(o,a);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>_8({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(n,i)=>{e.values=n,e.size=n.length,e.dataType=zw(n),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const n={...e,vtkClass:t.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(o=>{n[o]||delete n[o]});const i={};return Object.keys(n).sort().forEach(o=>{i[o]=n[o]}),i.mtime&&delete i.mtime,i},t.deepCopy=n=>{const i=t.getDataType(),o=e.values;t.shallowCopy(n),e.ranges=structuredClone(n.getRanges()),o?.length>=n.getNumberOfValues()&&i===n.getDataType()?(o.set(n.getData()),e.values=o,t.dataChange()):t.setData(n.getData().slice())},t.interpolateTuple=(n,i,o,a,s,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==a.getNumberOfComponents())&&Dk("numberOfComponents must match");const f=i.getTuple(o),u=a.getTuple(s),d=[];switch(d.length=l,l){case 4:d[3]=f[3]+(u[3]-f[3])*c;case 3:d[2]=f[2]+(u[2]-f[2])*c;case 2:d[1]=f[1]+(u[1]-f[1])*c;case 1:d[0]=f[0]+(u[0]-f[0])*c;break;default:for(let h=0;h<l;h++)d[h]=f[h]+(u[h]-f[h])*c}return t.insertTuple(n,d)}}const Lk={name:"",numberOfComponents:1,dataType:Ik,rangeTuple:[0,0]};function S8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Lk,r),Array.isArray(r.values)&&r.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=F1(e.dataType,e.values)):e.values=M0(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=zw(e.values)),Zn(t,e),eg(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");Ak(t,e)}const _8=On(S8,"vtkDataArray");var Tt={newInstance:_8,extend:S8,...Rk,...x8};const Nk={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},r5={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},Vk={LINEAR:0,LOG10:1};var jw={VectorMode:Nk,ScalarMappingTarget:r5,Scale:Vk};const kk={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},Fk={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},Uk={BY_ID:0,BY_NAME:1};var Hw={ColorMode:kk,GetArray:Uk,ScalarMode:Fk};const{ScalarMappingTarget:KT,Scale:Bk,VectorMode:ns}=jw,{VtkDataTypes:el}=Tt,{ColorMode:Wg}=Hw,{vtkErrorMacro:XT}=K;function Gk(t){return t}function qT(t){return Math.floor(t*255+.5)}function Wk(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(ns.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(ns.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(ns.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(r,n)=>{if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){XT("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r){const i=n.length;for(let o=0;o<i;o++)e.annotationArray.push({value:r[o],annotation:String(n[o])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(r,n)=>{let i=t.checkForAnnotatedValue(r),o=!1;return i>=0?e.annotationArray[i].annotation!==n&&(e.annotationArray[i].annotation=n,o=!0):(e.annotationArray.push({value:r,annotation:n}),i=e.annotationArray.length-1,o=!0),o&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=r=>r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value,t.getAnnotation=r=>e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation,t.getAnnotatedValueIndex=r=>e.annotationArray.length?t.checkForAnnotatedValue(r):-1,t.removeAnnotation=r=>{const n=t.checkForAnnotatedValue(r),i=n>=0;return i&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(r,n)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(r);t.getIndexedColor(i,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=r=>t.getAnnotatedValueIndexInternal(r),t.getAnnotatedValueIndexInternal=r=>{if(e.annotatedValueMap[r]!==void 0){const n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=(r,n)=>{n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const r=e.annotationArray.length;for(let n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=(r,n,i)=>{const o=r.getNumberOfComponents();let a=null;if(n===Wg.DEFAULT&&(r.getDataType()===el.UNSIGNED_CHAR||r.getDataType()===el.UNSIGNED_CHAR_CLAMPED)||n===Wg.DIRECT_SCALARS&&r)a=t.convertToRGBA(r,o,r.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:el.UNSIGNED_CHAR},c=K.newTypedArray(s.dataType,4*r.getNumberOfTuples());s.values=c,s.size=c.length,a=Tt.newInstance(s);let l=i;l<0&&o>1?t.mapVectorsThroughTable(r,a,KT.RGBA,-1,-1):(l<0&&(l=0),l>=o&&(l=o-1),t.mapScalarsThroughTable(r,a,KT.RGBA,l))}return a},t.mapVectorsToMagnitude=(r,n,i)=>{const o=r.getNumberOfTuples(),a=r.getNumberOfComponents(),s=n.getData(),c=r.getData();for(let l=0;l<o;l++){let f=0;for(let u=0;u<i;u++)f+=c[l*a+u]*c[l*a+u];s[l]=Math.sqrt(f)}},t.mapVectorsThroughTable=(r,n,i,o,a)=>{let s=t.getVectorMode(),c=a,l=o;const f=r.getNumberOfComponents();s===ns.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=f&&(l=f-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=f):(l<0&&(l=0),l>=f&&(l=f-1),l+c>f&&(c=f-l)),s===ns.MAGNITUDE&&(f===1||c===1)&&(s=ns.COMPONENT));let u=0;switch(l>0&&(u=l),s){case ns.COMPONENT:{t.mapScalarsThroughTable(r,n,i,u);break}case ns.RGBCOLORS:break;case ns.MAGNITUDE:default:{const d=Tt.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,d,c),t.mapScalarsThroughTable(d,n,i,0);break}}},t.luminanceToRGBA=(r,n,i,o)=>{const a=o(i),s=n.getData(),c=r.getData(),l=s.length,f=0,u=1;let d=0;for(let h=f;h<l;h+=u){const g=o(s[h]);c[d*4]=g,c[d*4+1]=g,c[d*4+2]=g,c[d*4+3]=a,d++}},t.luminanceAlphaToRGBA=(r,n,i,o)=>{const a=n.getData(),s=r.getData(),c=a.length,l=0,f=2;let u=0;for(let d=l;d<c;d+=f){const h=o(a[d]);s[u]=h,s[u+1]=h,s[u+2]=h,s[u+3]=o(a[d+1])*i,u+=4}},t.rGBToRGBA=(r,n,i,o)=>{const a=qT(i),s=n.getData(),c=r.getData(),l=s.length,f=0,u=3;let d=0;for(let h=f;h<l;h+=u)c[d*4]=o(s[h]),c[d*4+1]=o(s[h+1]),c[d*4+2]=o(s[h+2]),c[d*4+3]=a,d++},t.rGBAToRGBA=(r,n,i,o)=>{const a=n.getData(),s=r.getData(),c=a.length,l=0,f=4;let u=0;for(let d=l;d<c;d+=f)s[u*4]=o(a[d]),s[u*4+1]=o(a[d+1]),s[u*4+2]=o(a[d+2]),s[u*4+3]=o(a[d+3])*i,u++},t.convertToRGBA=(r,n,i)=>{let{alpha:o}=e;if(n===4&&o>=1&&r.getDataType()===el.UNSIGNED_CHAR)return r;const a=Tt.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:el.UNSIGNED_CHAR});if(i<=0)return a;o=o>0?o:0,o=o<1?o:1;let s=Gk;switch((r.getDataType()===el.FLOAT||r.getDataType()===el.DOUBLE)&&(s=qT),n){case 1:t.luminanceToRGBA(a,r,o,s);break;case 2:t.luminanceAlphaToRGBA(a,r,s);break;case 3:t.rGBToRGBA(a,r,o,s);break;case 4:t.rGBAToRGBA(a,r,o,s);break;default:return XT("Cannot convert colors"),null}return a},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(r,n)=>t.setMappingRange(r,n),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(r,n,i)=>{if(!r)return t.isOpaque();const o=r.getNumberOfComponents();return n===Wg.DEFAULT&&r.getDataType()===el.UNSIGNED_CHAR||n===Wg.DIRECT_SCALARS?o===3||o===1?e.alpha>=1:r.getRange(o-1)[0]===255:!0}}const $k={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:ns.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:Bk.LINEAR};function E8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$k,r),K.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],K.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),K.setArray(t,e,["mappingRange"],2),K.getArray(t,e,["mappingRange"]),Wk(t,e)}const zk=K.newInstance(E8,"vtkScalarsToColors");var G1={newInstance:zk,extend:E8,...jw};const jk={RGB:0,HSV:1,LAB:2,DIVERGING:3},Hk={LINEAR:0,LOG10:1};var b8={ColorSpace:jk,Scale:Hk};const{ColorSpace:Xo,Scale:Kw}=b8,{ScalarMappingTarget:$g}=G1,{vtkDebugMacro:Kk,vtkErrorMacro:qs,vtkWarningMacro:Xk}=K;function YT(t,e){const r=t[0],n=t[1],i=t[2],o=Math.sqrt(r*r+n*n+i*i),a=o>.001?Math.acos(r/o):0,s=a>.001?Math.atan2(i,n):0;e[0]=o,e[1]=a,e[2]=s}function qk(t,e){const r=t[0],n=t[1],i=t[2];e[0]=r*Math.cos(n),e[1]=r*Math.sin(n)*Math.cos(i),e[2]=r*Math.sin(n)*Math.sin(i)}function JT(t,e){if(t[0]>=e-.1)return t[2];const r=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+r:t[2]-r}function Yk(t,e){let r=t-e;for(r<0&&(r=-r);r>=2*Math.PI;)r-=2*Math.PI;return r>Math.PI&&(r=2*Math.PI-r),r}function ZT(t,e,r,n){const i=[],o=[];Au(e,i),Au(r,o);const a=[],s=[];YT(i,a),YT(o,s);let c=t;if(a[1]>.05&&s[1]>.05&&Yk(a[2],s[2])>.33*Math.PI){let u=Math.max(a[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(a[0]=u,a[1]=0,a[2]=0,c=2*c-1)}a[1]<.05&&s[1]>.05?a[2]=JT(s,a[0]):s[1]<.05&&a[1]>.05&&(s[2]=JT(a,s[0]));const l=[];l[0]=(1-c)*a[0]+c*s[0],l[1]=(1-c)*a[1]+c*s[1],l[2]=(1-c)*a[2]+c*s[2];const f=[];qk(l,f),Tm(f,n)}function Jk(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(r,n,i,o)=>t.addRGBPointLong(r,n,i,o,.5,0),t.addRGBPointLong=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(a<0||a>1)return qs("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return qs("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);const c={x:r,r:n,g:i,b:o,midpoint:a,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==r;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(r,n,i,o)=>t.addHSVPointLong(r,n,i,o,.5,0),t.addHSVPointLong=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return Eu([n,i,o],c),t.addRGBPoint(r,c[0],c[1],c[2],a,s)},t.setNodes=r=>{if(e.nodes!==r){const n=JSON.stringify(e.nodes);e.nodes=r;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||n!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const r=JSON.stringify(e.nodes);e.nodes.sort((o,a)=>o.x-a.x);const n=JSON.stringify(e.nodes),i=t.updateRange();return!i&&r!==n?(t.modified(),!0):i},t.updateRange=()=>{const r=[2];r[0]=e.mappingRange[0],r[1]=e.mappingRange[1];const n=e.nodes.length;return n?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[n-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),r[0]===e.mappingRange[0]&&r[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n=0;for(;n<e.nodes.length&&e.nodes[n].x!==r;n++);const i=n;if(n>=e.nodes.length)return-1;let o=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(o=t.updateRange()),o||t.modified(),i},t.movePoint=(r,n)=>{if(r!==n){t.removePoint(n);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===r){e.nodes[i].x=n,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(r,n,i,o,a,s,c,l)=>{t.sortAndUpdateRange();for(let f=0;f<e.nodes.length;)e.nodes[f].x>=r&&e.nodes[f].x<=a?e.nodes.splice(f,1):f++;t.addRGBPointLong(r,n,i,o,.5,0),t.addRGBPointLong(a,s,c,l,.5,0),t.modified()},t.addHSVSegment=(r,n,i,o,a,s,c,l)=>{const f=[n,i,o],u=[s,c,l],d=[],h=[];Eu(f,d),Eu(u,h),t.addRGBSegment(r,d[0],d[1],d[2],a,h[0],h[1],h[2])},t.mapValue=r=>{const n=[];return t.getColor(r,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},t.getColor=(r,n)=>{if(e.indexedLookup){const i=t.getSize(),o=t.getAnnotatedValueIndexInternal(r);if(o<0||i===0){const a=t.getNanColorByReference();n[0]=a[0],n[1]=a[1],n[2]=a[2]}else{const a=[];t.getNodeValue(o%i,a),n[0]=a[1],n[1]=a[2],n[2]=a[3]}return}t.getTable(r,r,1,n)},t.getRedValue=r=>{const n=[];return t.getColor(r,n),n[0]},t.getGreenValue=r=>{const n=[];return t.getColor(r,n),n[1]},t.getBlueValue=r=>{const n=[];return t.getColor(r,n),n[2]},t.logScaleEnabled=()=>e.scale===Kw.LOG10,t.usingLogScale=()=>t.logScaleEnabled()&&e.mappingRange[0]>0,t.getTable=(r,n,i,o)=>{const a=t.usingLogScale(),s=a?Math.log10(Number(r)):Number(r),c=a?Math.log10(Number(n)):Number(n);if(Sm(s)||Sm(c)){for(let S=0;S<i;S++)o[S*3+0]=e.nanColor[0],o[S*3+1]=e.nanColor[1],o[S*3+2]=e.nanColor[2];return}let l=0;const f=e.nodes.length;let u=0,d=0,h=0;f!==0&&(u=e.nodes[f-1].r,d=e.nodes[f-1].g,h=e.nodes[f-1].b);let g=0,p=0,m=0;const w=[0,0,0],v=[0,0,0];let y=0,C=0;const x=[];let T=e.mappingRange;a&&(T=[Math.log10(e.mappingRange[0]),Math.log10(e.mappingRange[1])]);for(let S=0;S<i;S++){const _=3*S;if(i>1?g=s+S/(i-1)*(c-s):g=.5*(s+c),e.discretize){const E=T;if(g>=E[0]&&g<=E[1]){const D=e.numberOfValues,b=E[1]-E[0];if(D<=1)g=E[0]+b/2;else{const I=(g-E[0])/b,O=Uw(D*I);g=E[0]+O/(D-1)*b}}}for(;l<f&&g>e.nodes[l].x;)l++,l<f&&(p=e.nodes[l-1].x,m=e.nodes[l].x,w[0]=e.nodes[l-1].r,v[0]=e.nodes[l].r,w[1]=e.nodes[l-1].g,v[1]=e.nodes[l].g,w[2]=e.nodes[l-1].b,v[2]=e.nodes[l].b,y=e.nodes[l-1].midpoint,C=e.nodes[l-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(g>T[1])o[_]=0,o[_+1]=0,o[_+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(o[_]=e.aboveRangeColor[0],o[_+1]=e.aboveRangeColor[1],o[_+2]=e.aboveRangeColor[2]):(o[_]=u,o[_+1]=d,o[_+2]=h));else if(g<T[0]||v8(g)&&g<0)o[_]=0,o[_+1]=0,o[_+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(o[_]=e.belowRangeColor[0],o[_+1]=e.belowRangeColor[1],o[_+2]=e.belowRangeColor[2]):f>0&&(o[_]=e.nodes[0].r,o[_+1]=e.nodes[0].g,o[_+2]=e.nodes[0].b));else if(l===0&&(Math.abs(g-s)<1e-6||e.discretize))f>0?(o[_]=e.nodes[0].r,o[_+1]=e.nodes[0].g,o[_+2]=e.nodes[0].b):(o[_]=0,o[_+1]=0,o[_+2]=0);else{let E=0;if(E=(g-p)/(m-p),E<y?E=.5*E/y:E=.5+.5*(E-y)/(1-y),C>.99)if(E<.5){o[_]=w[0],o[_+1]=w[1],o[_+2]=w[2];continue}else{o[_]=v[0],o[_+1]=v[1],o[_+2]=v[2];continue}if(C<.01){if(e.colorSpace===Xo.RGB)o[_]=(1-E)*w[0]+E*v[0],o[_+1]=(1-E)*w[1]+E*v[1],o[_+2]=(1-E)*w[2]+E*v[2];else if(e.colorSpace===Xo.HSV){const k=[],L=[];_d(w,k),_d(v,L),e.hSVWrap&&(k[0]-L[0]>.5||L[0]-k[0]>.5)&&(k[0]>L[0]?k[0]-=1:L[0]-=1);const F=[];F[0]=(1-E)*k[0]+E*L[0],F[0]<0&&(F[0]+=1),F[1]=(1-E)*k[1]+E*L[1],F[2]=(1-E)*k[2]+E*L[2],Eu(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else if(e.colorSpace===Xo.LAB){const k=[],L=[];Au(w,k),Au(v,L);const F=[];F[0]=(1-E)*k[0]+E*L[0],F[1]=(1-E)*k[1]+E*L[1],F[2]=(1-E)*k[2]+E*L[2],Tm(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else e.colorSpace===Xo.DIVERGING?(ZT(E,w,v,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]):qs("ColorSpace set to invalid value.",e.colorSpace);continue}E<.5?E=.5*(E*2)**(1+10*C):E>.5&&(E=1-.5*((1-E)*2)**(1+10*C));const D=E*E,b=D*E,I=2*b-3*D+1,O=-2*b+3*D,M=b-2*D+E,R=b-D;let A,B;if(e.colorSpace===Xo.RGB)for(let k=0;k<3;k++)A=v[k]-w[k],B=(1-C)*A,o[_+k]=I*w[k]+O*v[k]+M*B+R*B;else if(e.colorSpace===Xo.HSV){const k=[],L=[];_d(w,k),_d(v,L),e.hSVWrap&&(k[0]-L[0]>.5||L[0]-k[0]>.5)&&(k[0]>L[0]?k[0]-=1:L[0]-=1);const F=[];for(let j=0;j<3;j++)A=L[j]-k[j],B=(1-C)*A,F[j]=I*k[j]+O*L[j]+M*B+R*B,j===0&&F[j]<0&&(F[j]+=1);Eu(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else if(e.colorSpace===Xo.LAB){const k=[],L=[];Au(w,k),Au(v,L);const F=[];for(let j=0;j<3;j++)A=L[j]-k[j],B=(1-C)*A,F[j]=I*k[j]+O*L[j]+M*B+R*B;Tm(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else e.colorSpace===Xo.DIVERGING?(ZT(E,w,v,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]):qs("ColorSpace set to invalid value.");for(let k=0;k<3;k++)o[_+k]=o[_+k]<0?0:o[_+k],o[_+k]=o[_+k]>1?1:o[_+k]}}},t.getUint8Table=function(r,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==o)return e.table;if(e.nodes.length===0)return qs("Attempting to lookup a value with no points in the function"),e.table;const a=o?4:3;(e.tableSize!==i||e.tableWithAlpha!==o)&&(e.table=new Uint8Array(i*a),e.tableSize=i,e.tableWithAlpha=o);const s=[];t.getTable(r,n,i,s);for(let c=0;c<i;c++)e.table[c*a+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*a+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*a+2]=Math.floor(s[c*3+2]*255+.5),o&&(e.table[c*a+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=r=>{t.removeAllPoints();const n=r.getNumberOfComponents();for(let i=0;i<r.getNumberOfTuples();i++)switch(n){case 3:{e.nodes.push({x:i,r:r.getComponent(i,0),g:r.getComponent(i,1),b:r.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:r.getComponent(i,0),r:r.getComponent(i,1),g:r.getComponent(i,2),b:r.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:r.getComponent(i,0),g:r.getComponent(i,1),b:r.getComponent(i,2),midpoint:r.getComponent(i,4),sharpness:r.getComponent(i,5)});break}case 6:{e.nodes.push({x:r.getComponent(i,0),r:r.getComponent(i,1),g:r.getComponent(i,2),b:r.getComponent(i,3),midpoint:r.getComponent(i,4),sharpness:r.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(r,n,i,o)=>{let a=0;t.removeAllPoints(),i>1&&(a=(n-r)/(i-1));for(let s=0;s<i;s++){const c={x:r+a*s,r:o[s*3],g:o[s*3+1],b:o[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(r,n)=>r<0||r>=e.nodes.length?(qs("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].r,n[2]=e.nodes[r].g,n[3]=e.nodes[r].b,n[4]=e.nodes[r].midpoint,n[5]=e.nodes[r].sharpness,1),t.setNodeValue=(r,n)=>{if(r<0||r>=e.nodes.length)return qs("Index out of range!"),-1;const i=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].r=n[1],e.nodes[r].g=n[2],e.nodes[r].b=n[3],e.nodes[r].midpoint=n[4],e.nodes[r].sharpness=n[5],i!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const r=e.nodes?.length??0;return Math.max(4094,r)},t.getIndexedColor=(r,n)=>{const i=t.getSize();if(i>0&&r>=0){const a=[];t.getNodeValue(r%i,a);for(let s=0;s<3;++s)n[s]=a[s+1];n[3]=1;return}const o=t.getNanColorByReference();n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=1},t.fillFromDataPointer=(r,n)=>{if(!(r<=0||!n)){t.removeAllPoints();for(let i=0;i<r;i++)t.addRGBPoint(n[i*4],n[i*4+1],n[i*4+2],n[i*4+3])}},t.setMappingRange=(r,n)=>{const i=[r,n],o=[r,n],a=t.getRange(),s=t.logScaleEnabled();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){qs("attempt to set zero width color range");return}s&&(i[0]<=0?console.warn("attempt to set log scale color range with non-positive minimum"):(o[0]=Math.log10(i[0]),o[1]=Math.log10(i[1])));const c=(o[1]-o[0])/(a[1]-a[0]),l=o[0]-a[0]*c;for(let f=0;f<e.nodes.length;++f)e.nodes[f].x=e.nodes[f].x*c+l;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=r=>{const n=t.getRange(),i=[];n[0]<r[0]?(t.getColor(r[0],i),t.addRGBPoint(r[0],i[0],i[1],i[2])):(t.getColor(n[0],i),t.addRGBPoint(r[0],i[0],i[1],i[2])),n[1]>r[1]?(t.getColor(r[1],i),t.addRGBPoint(r[1],i[0],i[1],i[2])):(t.getColor(n[1],i),t.addRGBPoint(r[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=r[0]&&e.nodes[o].x<=r[1]?e.nodes.splice(o,1):++o;return 1},t.estimateMinNumberOfSamples=(r,n)=>{const i=t.findMinimumXDistance();return Math.ceil((n-r)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let r=Number.MAX_VALUE;for(let n=0;n<e.nodes.length-1;n++){const i=e.nodes[n+1].x-e.nodes[n].x;i<r&&(r=i)}return r},t.mapScalarsThroughTable=(r,n,i,o)=>{if(t.getSize()===0){Kk("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(r,n,i,o):t.mapData(r,n,i,o)},t.mapData=(r,n,i,o)=>{if(t.getSize()===0){Xk("Transfer Function Has No Points!");return}const a=Math.floor(t.getAlpha()*255+.5),s=r.getNumberOfTuples(),c=r.getNumberOfComponents(),l=n.getData(),f=r.getData(),u=[];if(i===$g.RGBA)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d*4]=Math.floor(u[0]*255+.5),l[d*4+1]=Math.floor(u[1]*255+.5),l[d*4+2]=Math.floor(u[2]*255+.5),l[d*4+3]=a}if(i===$g.RGB)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d*3]=Math.floor(u[0]*255+.5),l[d*3+1]=Math.floor(u[1]*255+.5),l[d*3+2]=Math.floor(u[2]*255+.5)}if(i===$g.LUMINANCE)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(i===$g.LUMINANCE_ALPHA)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[d*2+1]=a}},t.applyColorMap=r=>{const n=JSON.stringify(e.colorSpace);r.ColorSpace&&(e.colorSpace=Xo[r.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(qs(`ColorSpace ${r.ColorSpace} not supported, using RGB instead`),e.colorSpace=Xo.RGB));let i=n!==JSON.stringify(e.colorSpace);const o=i||JSON.stringify(e.nanColor);if(r.NanColor)for(e.nanColor=[].concat(r.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||o!==JSON.stringify(e.nanColor);const a=i||JSON.stringify(e.nodes);if(r.RGBPoints){const l=r.RGBPoints.length;e.nodes=[];const f=.5,u=0;for(let d=0;d<l;d+=4)e.nodes.push({x:r.RGBPoints[d],r:r.RGBPoints[d+1],g:r.RGBPoints[d+2],b:r.RGBPoints[d+3],midpoint:f,sharpness:u})}const s=t.sortAndUpdateRange(),c=!s&&(i||a!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const Zk={clamping:!0,colorSpace:Xo.RGB,hSVWrap:!0,scale:Kw.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function D8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zk,r),G1.extend(t,e,r),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},K.obj(e.buildTime),K.get(t,e,["buildTime","mappingRange"]),K.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:Xo},{type:"enum",name:"scale",enum:Kw}]),K.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),K.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),Jk(t,e)}const Qk=K.newInstance(D8,"vtkColorTransferFunction");var Cc={newInstance:Qk,extend:D8,...b8},eF=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const d0=Object.create(null);eF.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{d0[t.Name]=t});const h0=Object.keys(d0);h0.sort();function tF(t){return d0[t]}function nF(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(d0[t.Name]||(h0.push(t.Name),h0.sort()),d0[t.Name]=t)}function rF(t){const e=h0.indexOf(t);e>-1&&h0.splice(e,1),delete d0[t]}var mh={addPreset:nF,removePresetByName:rF,getPresetByName:tF,rgbPresetNames:h0};const{vtkErrorMacro:zg}=K;function iF(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let r,n=0,i=0;e.nodes.length>0&&(n=e.nodes[0].y);for(let o=1;o<e.nodes.length;o++){if(r=e.nodes[o].y,r!==n)if(r>n)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(n=r,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const r=e.nodes.length;if(e.function=null,r>0){e.function=[];for(let n=0;n<r;n++)e.function[2*n]=e.nodes[n].x,e.function[2*n+1]=e.nodes[n].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let r=1,n=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){r=0;break}return r?n=Number.MAX_VALUE:i>0?n=e.nodes[i-1].x:e.clamping?n=-Number.MAX_VALUE:n=e.nodes[0].x,n},t.getNodeValue=(r,n)=>{const i=e.nodes.length;return r<0||r>=i?(zg("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].y,n[2]=e.nodes[r].midpoint,n[3]=e.nodes[r].sharpness,1)},t.setNodeValue=(r,n)=>{const i=e.nodes.length;if(r<0||r>=i)return zg("Index out of range!"),-1;const o=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].y=n[1],e.nodes[r].midpoint=n[2],e.nodes[r].sharpness=n[3],o!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(r,n)=>t.addPointLong(r,n,.5,0),t.addPointLong=(r,n,i,o)=>{if(i<0||i>1)return zg("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return zg("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);const a={x:r,y:n,midpoint:i,sharpness:o};e.nodes.push(a),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==r;s++);return s<e.nodes.length?s:-1},t.setNodes=r=>{e.nodes!==r&&(e.nodes=r,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((n,i)=>n.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const r=e.range.slice(),n=e.nodes.length;return n?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[n-1].x):(e.range[0]=0,e.range[1]=0),r[0]===e.range[0]&&r[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n;for(n=0;n<e.nodes.length&&e.nodes[n].x!==r;n++);if(n>=e.nodes.length)return-1;const i=n;let o=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(o=t.updateRange()),o||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(r,n,i,o)=>{t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=r&&e.nodes[a].x<=i?e.nodes.splice(a,1):a++;t.addPoint(r,n,.5,0),t.addPoint(i,o,.5,0)},t.getValue=r=>{const n=[];return t.getTable(r,r,1,n),n[0]},t.adjustRange=r=>{if(r.length<2)return 0;const n=t.getRange();n[0]<r[0]?t.addPoint(r[0],t.getValue(r[0])):t.addPoint(r[0],t.getValue(n[0])),n[1]>r[1]?t.addPoint(r[1],t.getValue(r[1])):t.addPoint(r[1],t.getValue(n[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=r[0]&&e.nodes[i].x<=r[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(r,n)=>{const i=t.findMinimumXDistance();return Math.ceil((n-r)/i)},t.findMinimumXDistance=()=>{const r=e.nodes.length;if(r<2)return-1;let n=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<r-1;i++){const o=e.nodes[i+1].x-e.nodes[i].x;o<n&&(n=o)}return n},t.getTable=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const l=e.nodes.length;let f=0;l!==0&&(f=e.nodes[l-1].y);let u=0,d=0,h=0,g=0,p=0,m=0,w=0;for(s=0;s<i;s++){const v=a*s;for(i>1?u=r+s/(i-1)*(n-r):u=.5*(r+n);c<l&&u>e.nodes[c].x;)c++,c<l&&(d=e.nodes[c-1].x,h=e.nodes[c].x,g=e.nodes[c-1].y,p=e.nodes[c].y,m=e.nodes[c-1].midpoint,w=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(c>=l)o[v]=e.clamping?f:0;else if(c===0)o[v]=e.clamping?e.nodes[0].y:0;else{let y=(u-d)/(h-d);if(y<m?y=.5*y/m:y=.5+.5*(y-m)/(1-m),w>.99)if(y<.5){o[v]=g;continue}else{o[v]=p;continue}if(w<.01){o[v]=(1-y)*g+y*p;continue}y<.5?y=.5*(y*2)**(1+10*w):y>.5&&(y=1-.5*((1-y)*2)**(1+10*w));const C=y*y,x=C*y,T=2*x-3*C+1,S=-2*x+3*C,_=x-2*C+y,E=x-C,D=p-g,b=(1-w)*D;o[v]=T*g+S*p+_*b+E*b;const I=g<p?g:p,O=g>p?g:p;o[v]=o[v]<I?I:o[v],o[v]=o[v]>O?O:o[v]}}}}const oF={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function I8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oF,r),K.obj(t,e),e.nodes=[],K.setGet(t,e,["allowDuplicateScalars","clamping"]),K.setArray(t,e,["range"],2),K.getArray(t,e,["range"]),iF(t,e)}const aF=K.newInstance(I8,"vtkPiecewiseFunction");var qu={newInstance:aF,extend:I8},Rn=1e-6,Sr=typeof Float32Array<"u"?Float32Array:Array,sF=Math.PI/180;function cF(t){return t*sF}function Yu(t,e){return Math.abs(t-e)<=Rn*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Jo(){var t=new Sr(9);return Sr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function xl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function lF(t){var e=new Sr(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function uF(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ed(t,e,r,n,i,o,a,s,c){var l=new Sr(9);return l[0]=t,l[1]=e,l[2]=r,l[3]=n,l[4]=i,l[5]=o,l[6]=a,l[7]=s,l[8]=c,l}function M8(t,e,r,n,i,o,a,s,c,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t}function Ao(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function g0(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function xc(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=f*a-s*l,d=-f*o+s*c,h=l*o-a*c,g=r*u+n*d+i*h;return g?(g=1/g,t[0]=u*g,t[1]=(-f*n+i*l)*g,t[2]=(s*n-i*a)*g,t[3]=d*g,t[4]=(f*r-i*c)*g,t[5]=(-s*r+i*o)*g,t[6]=h*g,t[7]=(-l*r+n*c)*g,t[8]=(a*r-n*o)*g,t):null}function fF(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8];return t[0]=a*f-s*l,t[1]=i*l-n*f,t[2]=n*s-i*a,t[3]=s*c-o*f,t[4]=r*f-i*c,t[5]=i*o-r*s,t[6]=o*l-a*c,t[7]=n*c-r*l,t[8]=r*a-n*o,t}function yu(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],l=t[8];return e*(l*o-a*c)+r*(-l*i+a*s)+n*(c*i-o*s)}function Uu(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=r[0],h=r[1],g=r[2],p=r[3],m=r[4],w=r[5],v=r[6],y=r[7],C=r[8];return t[0]=d*n+h*a+g*l,t[1]=d*i+h*s+g*f,t[2]=d*o+h*c+g*u,t[3]=p*n+m*a+w*l,t[4]=p*i+m*s+w*f,t[5]=p*o+m*c+w*u,t[6]=v*n+y*a+C*l,t[7]=v*i+y*s+C*f,t[8]=v*o+y*c+C*u,t}function dF(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=r[0],h=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=c,t[6]=d*n+h*a+l,t[7]=d*i+h*s+f,t[8]=d*o+h*c+u,t}function hF(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=Math.sin(r),h=Math.cos(r);return t[0]=h*n+d*a,t[1]=h*i+d*s,t[2]=h*o+d*c,t[3]=h*a-d*n,t[4]=h*s-d*i,t[5]=h*c-d*o,t[6]=l,t[7]=f,t[8]=u,t}function gF(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function pF(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function mF(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function vF(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function yF(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function wF(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,c=i+i,l=r*a,f=n*a,u=n*s,d=i*a,h=i*s,g=i*c,p=o*a,m=o*s,w=o*c;return t[0]=1-u-g,t[3]=f-w,t[6]=d+m,t[1]=f+w,t[4]=1-l-g,t[7]=h-p,t[2]=d-m,t[5]=h+p,t[8]=1-l-u,t}function CF(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],d=e[10],h=e[11],g=e[12],p=e[13],m=e[14],w=e[15],v=r*s-n*a,y=r*c-i*a,C=r*l-o*a,x=n*c-i*s,T=n*l-o*s,S=i*l-o*c,_=f*p-u*g,E=f*m-d*g,D=f*w-h*g,b=u*m-d*p,I=u*w-h*p,O=d*w-h*m,M=v*O-y*I+C*b+x*D-T*E+S*_;return M?(M=1/M,t[0]=(s*O-c*I+l*b)*M,t[1]=(c*D-a*O-l*E)*M,t[2]=(a*I-s*D+l*_)*M,t[3]=(i*I-n*O-o*b)*M,t[4]=(r*O-i*D+o*E)*M,t[5]=(n*D-r*I-o*_)*M,t[6]=(p*S-m*T+w*x)*M,t[7]=(m*C-g*S-w*y)*M,t[8]=(g*T-p*C+w*v)*M,t):null}function xF(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function TF(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function SF(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _F(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function O8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function EF(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function bF(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function DF(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function IF(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=e[0],d=e[1],h=e[2],g=e[3],p=e[4],m=e[5],w=e[6],v=e[7],y=e[8];return Math.abs(r-u)<=Rn*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-d)<=Rn*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-h)<=Rn*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-g)<=Rn*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-p)<=Rn*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-m)<=Rn*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-w)<=Rn*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-v)<=Rn*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(f-y)<=Rn*Math.max(1,Math.abs(f),Math.abs(y))}var MF=Uu,OF=O8;const PF=Object.freeze(Object.defineProperty({__proto__:null,add:_F,adjoint:fF,clone:lF,copy:uF,create:Jo,determinant:yu,equals:IF,exactEquals:DF,frob:SF,fromMat2d:yF,fromMat4:xl,fromQuat:wF,fromRotation:mF,fromScaling:vF,fromTranslation:pF,fromValues:Ed,identity:Ao,invert:xc,mul:MF,multiply:Uu,multiplyScalar:EF,multiplyScalarAndAdd:bF,normalFromMat4:CF,projection:xF,rotate:hF,scale:gF,set:M8,str:TF,sub:OF,subtract:O8,translate:dF,transpose:g0},Symbol.toStringTag,{value:"Module"}));function Ti(){var t=new Sr(16);return Sr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function RF(t){var e=new Sr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xw(t,e,r,n,i,o,a,s,c,l,f,u,d,h,g,p){var m=new Sr(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=c,m[9]=l,m[10]=f,m[11]=u,m[12]=d,m[13]=h,m[14]=g,m[15]=p,m}function AF(t,e,r,n,i,o,a,s,c,l,f,u,d,h,g,p,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t[9]=f,t[10]=u,t[11]=d,t[12]=h,t[13]=g,t[14]=p,t[15]=m,t}function _t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mn(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function gr(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],d=e[10],h=e[11],g=e[12],p=e[13],m=e[14],w=e[15],v=r*s-n*a,y=r*c-i*a,C=r*l-o*a,x=n*c-i*s,T=n*l-o*s,S=i*l-o*c,_=f*p-u*g,E=f*m-d*g,D=f*w-h*g,b=u*m-d*p,I=u*w-h*p,O=d*w-h*m,M=v*O-y*I+C*b+x*D-T*E+S*_;return M?(M=1/M,t[0]=(s*O-c*I+l*b)*M,t[1]=(i*I-n*O-o*b)*M,t[2]=(p*S-m*T+w*x)*M,t[3]=(d*T-u*S-h*x)*M,t[4]=(c*D-a*O-l*E)*M,t[5]=(r*O-i*D+o*E)*M,t[6]=(m*C-g*S-w*y)*M,t[7]=(f*S-d*C+h*y)*M,t[8]=(a*I-s*D+l*_)*M,t[9]=(n*D-r*I-o*_)*M,t[10]=(g*T-p*C+w*v)*M,t[11]=(u*C-f*T-h*v)*M,t[12]=(s*E-a*b-c*_)*M,t[13]=(r*b-n*E+i*_)*M,t[14]=(p*y-g*x-m*v)*M,t[15]=(f*x-u*y+d*v)*M,t):null}function LF(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],d=e[10],h=e[11],g=e[12],p=e[13],m=e[14],w=e[15];return t[0]=s*(d*w-h*m)-u*(c*w-l*m)+p*(c*h-l*d),t[1]=-(n*(d*w-h*m)-u*(i*w-o*m)+p*(i*h-o*d)),t[2]=n*(c*w-l*m)-s*(i*w-o*m)+p*(i*l-o*c),t[3]=-(n*(c*h-l*d)-s*(i*h-o*d)+u*(i*l-o*c)),t[4]=-(a*(d*w-h*m)-f*(c*w-l*m)+g*(c*h-l*d)),t[5]=r*(d*w-h*m)-f*(i*w-o*m)+g*(i*h-o*d),t[6]=-(r*(c*w-l*m)-a*(i*w-o*m)+g*(i*l-o*c)),t[7]=r*(c*h-l*d)-a*(i*h-o*d)+f*(i*l-o*c),t[8]=a*(u*w-h*p)-f*(s*w-l*p)+g*(s*h-l*u),t[9]=-(r*(u*w-h*p)-f*(n*w-o*p)+g*(n*h-o*u)),t[10]=r*(s*w-l*p)-a*(n*w-o*p)+g*(n*l-o*s),t[11]=-(r*(s*h-l*u)-a*(n*h-o*u)+f*(n*l-o*s)),t[12]=-(a*(u*m-d*p)-f*(s*m-c*p)+g*(s*d-c*u)),t[13]=r*(u*m-d*p)-f*(n*m-i*p)+g*(n*d-i*u),t[14]=-(r*(s*m-c*p)-a*(n*m-i*p)+g*(n*c-i*s)),t[15]=r*(s*d-c*u)-a*(n*d-i*u)+f*(n*c-i*s),t}function NF(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],l=t[8],f=t[9],u=t[10],d=t[11],h=t[12],g=t[13],p=t[14],m=t[15],w=e*a-r*o,v=e*s-n*o,y=e*c-i*o,C=r*s-n*a,x=r*c-i*a,T=n*c-i*s,S=l*g-f*h,_=l*p-u*h,E=l*m-d*h,D=f*p-u*g,b=f*m-d*g,I=u*m-d*p;return w*I-v*b+y*D+C*E-x*_+T*S}function Wt(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=e[9],h=e[10],g=e[11],p=e[12],m=e[13],w=e[14],v=e[15],y=r[0],C=r[1],x=r[2],T=r[3];return t[0]=y*n+C*s+x*u+T*p,t[1]=y*i+C*c+x*d+T*m,t[2]=y*o+C*l+x*h+T*w,t[3]=y*a+C*f+x*g+T*v,y=r[4],C=r[5],x=r[6],T=r[7],t[4]=y*n+C*s+x*u+T*p,t[5]=y*i+C*c+x*d+T*m,t[6]=y*o+C*l+x*h+T*w,t[7]=y*a+C*f+x*g+T*v,y=r[8],C=r[9],x=r[10],T=r[11],t[8]=y*n+C*s+x*u+T*p,t[9]=y*i+C*c+x*d+T*m,t[10]=y*o+C*l+x*h+T*w,t[11]=y*a+C*f+x*g+T*v,y=r[12],C=r[13],x=r[14],T=r[15],t[12]=y*n+C*s+x*u+T*p,t[13]=y*i+C*c+x*d+T*m,t[14]=y*o+C*l+x*h+T*w,t[15]=y*a+C*f+x*g+T*v,t}function Gn(t,e,r){var n=r[0],i=r[1],o=r[2],a,s,c,l,f,u,d,h,g,p,m,w;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(a=e[0],s=e[1],c=e[2],l=e[3],f=e[4],u=e[5],d=e[6],h=e[7],g=e[8],p=e[9],m=e[10],w=e[11],t[0]=a,t[1]=s,t[2]=c,t[3]=l,t[4]=f,t[5]=u,t[6]=d,t[7]=h,t[8]=g,t[9]=p,t[10]=m,t[11]=w,t[12]=a*n+f*i+g*o+e[12],t[13]=s*n+u*i+p*o+e[13],t[14]=c*n+d*i+m*o+e[14],t[15]=l*n+h*i+w*o+e[15]),t}function ws(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ci(t,e,r,n){var i=n[0],o=n[1],a=n[2],s=Math.hypot(i,o,a),c,l,f,u,d,h,g,p,m,w,v,y,C,x,T,S,_,E,D,b,I,O,M,R;return s<Rn?null:(s=1/s,i*=s,o*=s,a*=s,c=Math.sin(r),l=Math.cos(r),f=1-l,u=e[0],d=e[1],h=e[2],g=e[3],p=e[4],m=e[5],w=e[6],v=e[7],y=e[8],C=e[9],x=e[10],T=e[11],S=i*i*f+l,_=o*i*f+a*c,E=a*i*f-o*c,D=i*o*f-a*c,b=o*o*f+l,I=a*o*f+i*c,O=i*a*f+o*c,M=o*a*f-i*c,R=a*a*f+l,t[0]=u*S+p*_+y*E,t[1]=d*S+m*_+C*E,t[2]=h*S+w*_+x*E,t[3]=g*S+v*_+T*E,t[4]=u*D+p*b+y*I,t[5]=d*D+m*b+C*I,t[6]=h*D+w*b+x*I,t[7]=g*D+v*b+T*I,t[8]=u*O+p*M+y*R,t[9]=d*O+m*M+C*R,t[10]=h*O+w*M+x*R,t[11]=g*O+v*M+T*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function qw(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],c=e[7],l=e[8],f=e[9],u=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+f*n,t[6]=s*i+u*n,t[7]=c*i+d*n,t[8]=l*i-o*n,t[9]=f*i-a*n,t[10]=u*i-s*n,t[11]=d*i-c*n,t}function Yw(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],c=e[3],l=e[8],f=e[9],u=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*n,t[1]=a*i-f*n,t[2]=s*i-u*n,t[3]=c*i-d*n,t[8]=o*n+l*i,t[9]=a*n+f*i,t[10]=s*n+u*i,t[11]=c*n+d*i,t}function Jw(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],c=e[3],l=e[4],f=e[5],u=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+f*n,t[2]=s*i+u*n,t[3]=c*i+d*n,t[4]=l*i-o*n,t[5]=f*i-a*n,t[6]=u*i-s*n,t[7]=d*i-c*n,t}function P0(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function W1(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zw(t,e,r){var n=r[0],i=r[1],o=r[2],a=Math.hypot(n,i,o),s,c,l;return a<Rn?null:(a=1/a,n*=a,i*=a,o*=a,s=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=n*n*l+c,t[1]=i*n*l+o*s,t[2]=o*n*l-i*s,t[3]=0,t[4]=n*i*l-o*s,t[5]=i*i*l+c,t[6]=o*i*l+n*s,t[7]=0,t[8]=n*o*l+i*s,t[9]=i*o*l-n*s,t[10]=o*o*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function VF(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kF(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function FF(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function P8(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,c=i+i,l=o+o,f=n*s,u=n*c,d=n*l,h=i*c,g=i*l,p=o*l,m=a*s,w=a*c,v=a*l;return t[0]=1-(h+p),t[1]=u+v,t[2]=d-w,t[3]=0,t[4]=u-v,t[5]=1-(f+p),t[6]=g+m,t[7]=0,t[8]=d+w,t[9]=g-m,t[10]=1-(f+h),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function UF(t,e){var r=new Sr(3),n=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=n*n+i*i+o*o+a*a;return u>0?(r[0]=(s*a+f*n+c*o-l*i)*2/u,r[1]=(c*a+f*i+l*n-s*o)*2/u,r[2]=(l*a+f*o+s*i-c*n)*2/u):(r[0]=(s*a+f*n+c*o-l*i)*2,r[1]=(c*a+f*i+l*n-s*o)*2,r[2]=(l*a+f*o+s*i-c*n)*2),P8(t,e,r),t}function BF(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function R8(t,e){var r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],s=e[6],c=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(c,l,f),t}function i5(t,e){var r=new Sr(3);R8(r,e);var n=1/r[0],i=1/r[1],o=1/r[2],a=e[0]*n,s=e[1]*i,c=e[2]*o,l=e[4]*n,f=e[5]*i,u=e[6]*o,d=e[8]*n,h=e[9]*i,g=e[10]*o,p=a+f+g,m=0;return p>0?(m=Math.sqrt(p+1)*2,t[3]=.25*m,t[0]=(u-h)/m,t[1]=(d-c)/m,t[2]=(s-l)/m):a>f&&a>g?(m=Math.sqrt(1+a-f-g)*2,t[3]=(u-h)/m,t[0]=.25*m,t[1]=(s+l)/m,t[2]=(d+c)/m):f>g?(m=Math.sqrt(1+f-a-g)*2,t[3]=(d-c)/m,t[0]=(s+l)/m,t[1]=.25*m,t[2]=(u+h)/m):(m=Math.sqrt(1+g-a-f)*2,t[3]=(s-l)/m,t[0]=(d+c)/m,t[1]=(u+h)/m,t[2]=.25*m),t}function A8(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],c=i+i,l=o+o,f=a+a,u=i*c,d=i*l,h=i*f,g=o*l,p=o*f,m=a*f,w=s*c,v=s*l,y=s*f,C=n[0],x=n[1],T=n[2];return t[0]=(1-(g+m))*C,t[1]=(d+y)*C,t[2]=(h-v)*C,t[3]=0,t[4]=(d-y)*x,t[5]=(1-(u+m))*x,t[6]=(p+w)*x,t[7]=0,t[8]=(h+v)*T,t[9]=(p-w)*T,t[10]=(1-(u+g))*T,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function GF(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],c=e[3],l=o+o,f=a+a,u=s+s,d=o*l,h=o*f,g=o*u,p=a*f,m=a*u,w=s*u,v=c*l,y=c*f,C=c*u,x=n[0],T=n[1],S=n[2],_=i[0],E=i[1],D=i[2],b=(1-(p+w))*x,I=(h+C)*x,O=(g-y)*x,M=(h-C)*T,R=(1-(d+w))*T,A=(m+v)*T,B=(g+y)*S,k=(m-v)*S,L=(1-(d+p))*S;return t[0]=b,t[1]=I,t[2]=O,t[3]=0,t[4]=M,t[5]=R,t[6]=A,t[7]=0,t[8]=B,t[9]=k,t[10]=L,t[11]=0,t[12]=r[0]+_-(b*_+M*E+B*D),t[13]=r[1]+E-(I*_+R*E+k*D),t[14]=r[2]+D-(O*_+A*E+L*D),t[15]=1,t}function Yf(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,c=i+i,l=r*a,f=n*a,u=n*s,d=i*a,h=i*s,g=i*c,p=o*a,m=o*s,w=o*c;return t[0]=1-u-g,t[1]=f+w,t[2]=d-m,t[3]=0,t[4]=f-w,t[5]=1-l-g,t[6]=h+p,t[7]=0,t[8]=d+m,t[9]=h-p,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function WF(t,e,r,n,i,o,a){var s=1/(r-e),c=1/(i-n),l=1/(o-a);return t[0]=o*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*c,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function L8(t,e,r,n,i){var o=1/Math.tan(e/2),a;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}var $F=L8;function zF(t,e,r,n,i){var o=1/Math.tan(e/2),a;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(n-i),t[10]=i*a,t[14]=i*n*a):(t[10]=-1,t[14]=-n),t}function jF(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+s),l=2/(i+o);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-s)*c*.5),t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function N8(t,e,r,n,i,o,a){var s=1/(e-r),c=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*c,t[14]=(a+o)*l,t[15]=1,t}var Qw=N8;function HF(t,e,r,n,i,o,a){var s=1/(e-r),c=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*c,t[14]=o*l,t[15]=1,t}function eC(t,e,r,n){var i,o,a,s,c,l,f,u,d,h,g=e[0],p=e[1],m=e[2],w=n[0],v=n[1],y=n[2],C=r[0],x=r[1],T=r[2];return Math.abs(g-C)<Rn&&Math.abs(p-x)<Rn&&Math.abs(m-T)<Rn?_t(t):(f=g-C,u=p-x,d=m-T,h=1/Math.hypot(f,u,d),f*=h,u*=h,d*=h,i=v*d-y*u,o=y*f-w*d,a=w*u-v*f,h=Math.hypot(i,o,a),h?(h=1/h,i*=h,o*=h,a*=h):(i=0,o=0,a=0),s=u*a-d*o,c=d*i-f*a,l=f*o-u*i,h=Math.hypot(s,c,l),h?(h=1/h,s*=h,c*=h,l*=h):(s=0,c=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=u,t[7]=0,t[8]=a,t[9]=l,t[10]=d,t[11]=0,t[12]=-(i*g+o*p+a*m),t[13]=-(s*g+c*p+l*m),t[14]=-(f*g+u*p+d*m),t[15]=1,t)}function KF(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=n[0],c=n[1],l=n[2],f=i-r[0],u=o-r[1],d=a-r[2],h=f*f+u*u+d*d;h>0&&(h=1/Math.sqrt(h),f*=h,u*=h,d*=h);var g=c*d-l*u,p=l*f-s*d,m=s*u-c*f;return h=g*g+p*p+m*m,h>0&&(h=1/Math.sqrt(h),g*=h,p*=h,m*=h),t[0]=g,t[1]=p,t[2]=m,t[3]=0,t[4]=u*m-d*p,t[5]=d*g-f*m,t[6]=f*p-u*g,t[7]=0,t[8]=f,t[9]=u,t[10]=d,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function XF(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function qF(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function YF(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function V8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function k8(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function JF(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function ZF(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function QF(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=t[9],d=t[10],h=t[11],g=t[12],p=t[13],m=t[14],w=t[15],v=e[0],y=e[1],C=e[2],x=e[3],T=e[4],S=e[5],_=e[6],E=e[7],D=e[8],b=e[9],I=e[10],O=e[11],M=e[12],R=e[13],A=e[14],B=e[15];return Math.abs(r-v)<=Rn*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-y)<=Rn*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-C)<=Rn*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(o-x)<=Rn*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-T)<=Rn*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-S)<=Rn*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(c-_)<=Rn*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-E)<=Rn*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-D)<=Rn*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(u-b)<=Rn*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-I)<=Rn*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(h-O)<=Rn*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(g-M)<=Rn*Math.max(1,Math.abs(g),Math.abs(M))&&Math.abs(p-R)<=Rn*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-A)<=Rn*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(w-B)<=Rn*Math.max(1,Math.abs(w),Math.abs(B))}var _m=Wt,eU=V8;const vh=Object.freeze(Object.defineProperty({__proto__:null,add:YF,adjoint:LF,clone:RF,copy:sr,create:Ti,determinant:NF,equals:QF,exactEquals:ZF,frob:qF,fromQuat:Yf,fromQuat2:UF,fromRotation:Zw,fromRotationTranslation:P8,fromRotationTranslationScale:A8,fromRotationTranslationScaleOrigin:GF,fromScaling:W1,fromTranslation:P0,fromValues:Xw,fromXRotation:VF,fromYRotation:kF,fromZRotation:FF,frustum:WF,getRotation:i5,getScaling:R8,getTranslation:BF,identity:_t,invert:gr,lookAt:eC,mul:_m,multiply:Wt,multiplyScalar:k8,multiplyScalarAndAdd:JF,ortho:Qw,orthoNO:N8,orthoZO:HF,perspective:$F,perspectiveFromFieldOfView:jF,perspectiveNO:L8,perspectiveZO:zF,rotate:ci,rotateX:qw,rotateY:Yw,rotateZ:Jw,scale:ws,set:AF,str:XF,sub:eU,subtract:V8,targetTo:KF,translate:Gn,transpose:mn},Symbol.toStringTag,{value:"Module"}));function Ie(){var t=new Sr(3);return Sr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ea(t){var e=new Sr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _r(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function mt(t,e,r){var n=new Sr(3);return n[0]=t,n[1]=e,n[2]=r,n}function $1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function co(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function nr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function qt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function F8(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function tU(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function nU(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function rU(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Jn(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function tn(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Nr(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function U8(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function Oa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Em(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function At(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nn(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],c=r[2];return t[0]=i*c-o*s,t[1]=o*a-n*c,t[2]=n*s-i*a,t}function Pt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function yh(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function iU(t,e,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=e[0],c=e[1],l=e[2],f=i*l-o*c,u=o*s-n*l,d=n*c-i*s,h=i*d-o*u,g=o*f-n*d,p=n*u-i*f,m=a*2;return f*=m,u*=m,d*=m,h*=2,g*=2,p*=2,t[0]=s+f+h,t[1]=c+u+g,t[2]=l+d+p,t}function tC(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2],c=Math.sqrt(r*r+n*n+i*i),l=Math.sqrt(o*o+a*a+s*s),f=c*l,u=f&&ft(t,e)/f;return Math.acos(Math.min(Math.max(u,-1),1))}function oU(t){return t[0]=0,t[1]=0,t[2]=0,t}function QT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function o5(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(r-o)<=Rn*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=Rn*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=Rn*Math.max(1,Math.abs(i),Math.abs(s))}var an=qt,aU=F8,sU=Nr,a5=U8,p0=_r;(function(){var t=Ie();return function(e,r,n,i,o,a){var s,c;for(r||(r=3),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function B8(){var t=new Sr(4);return Sr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Kp(t,e,r,n){var i=new Sr(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function eS(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function cU(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a,t}function tS(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function lc(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}(function(){var t=B8();return function(e,r,n,i,o,a){var s,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function Tc(){var t=new Sr(4);return Sr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function og(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function lU(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>Rn?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function nS(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],c=r[1],l=r[2],f=r[3];return t[0]=n*f+a*s+i*l-o*c,t[1]=i*f+a*c+o*s-n*l,t[2]=o*f+a*l+n*c-i*s,t[3]=a*f-n*s-i*c-o*l,t}function Xp(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],c=r[0],l=r[1],f=r[2],u=r[3],d,h,g,p,m;return h=i*c+o*l+a*f+s*u,h<0&&(h=-h,c=-c,l=-l,f=-f,u=-u),1-h>Rn?(d=Math.acos(h),g=Math.sin(d),p=Math.sin((1-n)*d)/g,m=Math.sin(n*d)/g):(p=1-n,m=n),t[0]=p*i+m*c,t[1]=p*o+m*l,t[2]=p*a+m*f,t[3]=p*s+m*u,t}function uU(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function fU(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[a*3+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[o*3+a]-e[a*3+o])*n,t[o]=(e[o*3+i]+e[i*3+o])*n,t[a]=(e[a*3+i]+e[i*3+a])*n}return t}var rS=Kp,G8=cU;(function(){var t=Ie(),e=mt(1,0,0),r=mt(0,1,0);return function(n,i,o){var a=ft(i,o);return a<-.999999?(nn(t,e,i),p0(t)<1e-6&&nn(t,r,i),At(t,t),og(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(nn(t,i,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,G8(n,n))}})();(function(){var t=Tc(),e=Tc();return function(r,n,i,o,a,s){return Xp(t,n,a,s),Xp(e,i,o,s),Xp(r,t,e,2*s*(1-s)),r}})();(function(){var t=Jo();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],G8(e,fU(e,t))}})();function xt(){var t=new Sr(2);return Sr!=Float32Array&&(t[0]=0,t[1]=0),t}function Da(t){var e=new Sr(2);return e[0]=t[0],e[1]=t[1],e}function iS(t,e){var r=new Sr(2);return r[0]=t,r[1]=e,r}function Qo(t,e,r){return t[0]=e,t[1]=r,t}function Zr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Mn(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function as(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function bd(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Xn(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function vl(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function bm(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function cs(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function oc(t,e){return t[0]*e[0]+t[1]*e[1]}function dU(t,e,r,n){var i=e[0]-r[0],o=e[1]-r[1],a=Math.sin(n),s=Math.cos(n);return t[0]=i*s-o*a+r[0],t[1]=i*a+o*s+r[1],t}function hU(t,e){var r=t[0],n=t[1],i=e[0],o=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+o*o),s=a&&(r*i+n*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}var gU=bm,Mo=Mn,nC=Xn;(function(){var t=xt();return function(e,r,n,i,o,a){var s,c;for(r||(r=2),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}})();function cr(t){const e=t.indexOf(":");return t.substring(e+1)}function W8(t){let e=2166136261;for(let r=0;r<t.length;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>>0).toString(36)}const pU=1073741824;class mU{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageIdsToVolumeIdCache=new Map,this._referencedImageIdToImageIdCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*pU,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const r=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(r)}this._maxCacheSize=e},this.isCacheable=e=>{const r=this.getBytesAvailable(),n=Array.from(this._imageCache.values()).reduce((o,a)=>a.sharedCacheKey?o:o+a.sizeInBytes,0);return r+n>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,r=!1)=>{const n=this._imageCache.get(e);if(!n)return;if(n.sharedCacheKey&&!r)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=n;n.image?.referencedImageId&&this._referencedImageIdToImageIdCache.delete(n.image.referencedImageId),i?.cancelFn&&i.cancelFn(),i?.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const r=this._volumeCache.get(e);if(!r)return;const{volumeLoadObject:n,volume:i}=r;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),n.cancelFn&&n.cancelFn(),i.imageIds&&i.imageIds.forEach(o=>{const a=this._imageCache.get(o);a&&a.sharedCacheKey===e&&(a.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:r,done:n}=e.next();if(n)break;this.removeImageLoadObject(r,{force:!0}),Xe(ke,Ge.IMAGE_CACHE_IMAGE_REMOVED,{imageId:r})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:r,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(r),Xe(ke,Ge.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:r})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const r=this._volumeCache.get(e);if(r)return r.timeStamp=Date.now(),r.volumeLoadObject},this.putGeometryLoadObject=(e,r)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(r.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(r.cancelFn&&typeof r.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const n={loaded:!1,geometryId:e,geometryLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),r.promise.then(i=>{try{this._putGeometryCommon(e,i,n)}catch(o){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,o),o}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const r=this._geometryCache.get(e);if(r)return r.timeStamp=Date.now(),r.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const r=this._geometryCache.get(e);if(!r)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(r.sizeInBytes);const n={geometry:r,geometryId:e};Xe(ke,Ge.GEOMETRY_CACHE_GEOMETRY_REMOVED,n),this._decacheGeometry(e)},this._decacheGeometry=e=>{const r=this._geometryCache.get(e);if(!r)return;const{geometryLoadObject:n}=r;n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImageByReferencedImageId=e=>{const r=this._referencedImageIdToImageIdCache.get(e);if(r)return this._imageCache.get(r)?.image},this.getImage=(e,r=lo.FAR_REPLICATE)=>{if(e===void 0)throw new Error("getImage: imageId must not be undefined");const n=this._imageCache.get(e);if(n&&(n.timeStamp=Date.now(),!(n.image?.imageQualityStatus<r)))return n.image},this.getVolume=(e,r=!1)=>{if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const n=this._volumeCache.get(e);return n?(n.timeStamp=Date.now(),n.volume):r?[...this._volumeCache.values()].find(i=>i.volumeId.includes(e))?.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(r=>r.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(n=>n.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:r=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(!n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,r),this.incrementImageCacheSize(-n.sizeInBytes);const i={image:n,imageId:e};Xe(ke,Ge.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const r=this._volumeCache.get(e);if(!r)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const n={volume:r,volumeId:e};Xe(ke,Ge.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const r=this._geometryCache.get(e);if(r)return r.timeStamp=Date.now(),r.geometryLoadObject}}generateVolumeId(e){const r=e.map(cr).sort();let n=2166136261;for(const i of r){const o=W8(i);for(let a=0;a<o.length;a++)n^=o.charCodeAt(a),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24)}return`volume-${(n>>>0).toString(36)}`}getImageIdsForVolumeId(e){return Array.from(this._imageIdsToVolumeIdCache.entries()).filter(([r,n])=>n===e).map(([r])=>r)}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,r){let n=this.getBytesAvailable();if(n>=e)return n;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function o(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(o);const a=i.map(c=>c.imageId);let s=a;r&&(s=a.filter(c=>!r.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),Xe(ke,Ge.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),n=this.getBytesAvailable(),n>=e)return n;for(const c of a)if(this.removeImageLoadObject(c),Xe(ke,Ge.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),n=this.getBytesAvailable(),n>=e)return n}_putImageCommon(e,r,n){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!r){console.warn("Image is undefined");return}if(r.sizeInBytes===void 0||Number.isNaN(r.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(r.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(r.sizeInBytes))throw new Error(Ge.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(r.sizeInBytes),n.loaded=!0,n.image=r,n.sizeInBytes=r.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const i={image:n};r.referencedImageId&&this._referencedImageIdToImageIdCache.set(r.referencedImageId,e),Xe(ke,Ge.IMAGE_CACHE_IMAGE_ADDED,i),n.sharedCacheKey=r.sharedCacheKey}async putImageLoadObject(e,r){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(r.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const n=this._imageCache.get(e);if(n?.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(r.cancelFn&&typeof r.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...n,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),r.promise.then(o=>{try{this._putImageCommon(e,o,i)}catch(a){throw console.debug(`Error in _putImageCommon for image ${e}:`,a),a}}).catch(o=>{throw console.debug(`Error caching image ${e}:`,o),this._imageCache.delete(e),o})}putImageSync(e,r){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,n);try{this._putImageCommon(e,r,n)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(r)return r.timeStamp=Date.now(),r.imageLoadObject}isLoaded(e){const r=this._imageCache.get(e);return r?r.loaded:!1}getVolumeContainingImageId(e){const r=Array.from(this._volumeCache.keys()),n=cr(e);for(const i of r){const o=this._volumeCache.get(i);if(!o)return;const{volume:a}=o;if(!a.imageIds.length)return;const s=a.getImageURIIndex(n);if(s>-1)return{volume:a,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const r=cr(e),i=Array.from(this._imageCache.keys()).find(o=>cr(o)===r);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,r,n){if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}n.loaded=!0,n.volume=r,r.imageIds?.forEach(o=>{const a=this._imageCache.get(o);a&&(a.sharedCacheKey=e)});const i={volume:n};Xe(ke,Ge.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,r){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const n={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,n);try{this._putVolumeCommon(e,r,n)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,r){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(r.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(r.cancelFn&&typeof r.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),r.promise.then(i=>{try{this._putVolumeCommon(e,i,n)}catch(o){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,o),this._volumeCache.delete(e),o}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,r,n){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!r){console.warn("Geometry is undefined");return}if(r.sizeInBytes===void 0||Number.isNaN(r.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(r.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(r.sizeInBytes))throw new Error(Ge.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(r.sizeInBytes),n.loaded=!0,n.geometry=r,n.sizeInBytes=r.sizeInBytes,this.incrementGeometryCacheSize(n.sizeInBytes);const i={geometry:n};Xe(ke,Ge.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,r){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const n={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,n);try{this._putGeometryCommon(e,r,n)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,r){const n=this._imageCache.get(e);if(!n){r&&this._imageCache.set(e,{image:r,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}n.loaded&&(n.loaded=!1,n.imageLoadObject=null,this.incrementImageCacheSize(-n.sizeInBytes),n.sizeInBytes=0),n.image=r||n.image}getImageQuality(e){const r=this._imageCache.get(e)?.image;return r?r.imageQualityStatus||lo.FULL_RESOLUTION:void 0}}const Ae=new mU;function $8(t,e,r){return Math.abs(t-e)<=r}function vU(t,e,r=1e-5){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!$8(t[n],e[n],r))return!1;return!0}function oS(t){return typeof t=="number"}function aS(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Dt(t,e,r=1e-5){return typeof t!=typeof e||t===null||e===null?!1:oS(t)&&oS(e)?$8(t,e,r):aS(t)&&aS(e)?vU(t,e,r):!1}const z8=t=>typeof t=="number"?-t:t?.map?t.map(z8):!t,s5=t=>typeof t=="number"?Math.abs(t):t?.map?t.map(s5):t,j8=(t,e,r=void 0)=>Dt(t,z8(e),r),qp=(t,e,r=void 0)=>Dt(s5(t),s5(e),r);function fr(t){return Array.isArray(t)?fr(t[0]):isFinite(t)&&!isNaN(t)}function ta(t){return eo(t,"vtkVolume")||eo(t,"vtkImageSlice")}function eo(t,e){const r="isA"in t?t:t.actor;return r?!!r.isA(e):!1}const rC=new Map;function yU(t){t.name=t.name||t.Name,rC.set(t.name,t)}function wh(t){return rC.get(t)}function H8(){return Array.from(rC.keys())}function iC(t,e){const r=mh.rgbPresetNames.map(c=>mh.getPresetByName(c)),n=H8().map(c=>wh(c)),o=r.concat(n).find(c=>{const{RGBPoints:l}=c;if(l.length!==t.length)return!1;for(let f=0;f<l.length;f+=4)if(!Dt(l.slice(f+1,f+4),t.slice(f+1,f+4)))return!1;return!0});if(!o)return null;const a=[];if(eo(e,"vtkVolume")){const c=e.getProperty().getScalarOpacity(0).getDataPointer();if(!c)return{name:o.Name};for(let l=0;l<c.length;l+=2)a.push({value:c[l],opacity:c[l+1]})}return{name:o.Name,...Array.isArray(a)&&a.length>0&&{opacity:a},...typeof a=="number"&&{opacity:a}}}function wU(t){const{volumeActor:e,preset:r,opacity:n=.9,threshold:i=null,colorRange:o=[0,5]}=t;e.getMapper().setSampleDistance(1);const s=Cc.newInstance(),c=r||mh.getPresetByName("hsv");s.applyColorMap(c),s.setMappingRange(o[0],o[1]),e.getProperty().setRGBTransferFunction(0,s),oC(e,n,i)}function K8(t,e){const r=aC(t);oC(t,e,r)}function X8(t,e){const r=sC(t);oC(t,r,e)}function oC(t,e,r){const n=t.getMapper().getInputData().get("voxelManager");if(!n?.voxelManager)throw new Error("No voxel manager was found for the volume actor, or you cannot yet update opacity with a threshold using stacked images");const i=n.voxelManager.getRange(),o=qu.newInstance();if(r!==null){const a=Math.abs(i[1]-i[0])*.001,s=Math.max(i[0],Math.min(i[1],r));o.addPoint(i[0],0),o.addPoint(s-a,0),o.addPoint(s,e),o.addPoint(i[1],e)}else o.addPoint(i[0],e),o.addPoint(i[1],e);t.getProperty().setScalarOpacity(0,o)}function aC(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return null;const r=e.getDataPointer();if(!r||r.length<=4)return null;for(let n=0;n<r.length-2;n+=2){r[n];const i=r[n+1],o=r[n+2],a=r[n+3];if(i===0&&a>0)return o}return null}function sC(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return 1;const r=e.getDataPointer();if(!r||r.length===0)return 1;let n=0;for(let i=1;i<r.length;i+=2)r[i]>n&&(n=r[i]);return n}const CU=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:iC,getColormap:wh,getColormapNames:H8,getMaxOpacity:sC,getThresholdValue:aC,registerColormap:yU,setColorMapTransferFunctionForVolumeActor:wU,updateOpacity:K8,updateThreshold:X8},Symbol.toStringTag,{value:"Module"}));function Gd(t){if(!t)return;const e=t.getSize();for(let r=0;r<e;r++){const n=[];t.getNodeValue(r,n),n[1]=1-n[1],n[2]=1-n[2],n[3]=1-n[3],t.setNodeValue(r,n)}}const xU=(t,e,r)=>e-r/4*Math.log((1-t)/t);function R0(t,e){const r=Math.abs(e-t)+1,n=(t+e+1)/2;return{windowWidth:r,windowCenter:n}}function Tl(t,e,r=Ci.LINEAR){if(r===Ci.LINEAR||r===Ci.SAMPLED_SIGMOID)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(r===Ci.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};throw new Error("Invalid VOI LUT function")}const TU=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:Tl,toWindowLevel:R0},Symbol.toStringTag,{value:"Module"}));function cC(t,e=1024){const{windowWidth:r,windowCenter:n}=R0(t.lower,t.upper),o=Array.from({length:e},(s,c)=>(c+1)/(e+2)).flatMap(s=>[xU(s,n,r),s,s,s,.5,0]),a=Cc.newInstance();return a.buildFunctionFromArray(Tt.newInstance({values:o,numberOfComponents:6})),a}function Lr(t,e){return t.worldToIndex(e).map(Math.round)}function Yp(t,e){return t.worldToIndex(e)}function Dm(t){const e=t.getSize(),r=[];for(let n=0;n<e;n++){const i=[];t.getNodeValue(n,i),r.push(i)}return r}function z1(t,e){e?.length&&(t.removeAllPoints(),e.forEach(r=>{t.addRGBPoint(...r)}))}const SU=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:Dm,setTransferFunctionNodes:z1},Symbol.toStringTag,{value:"Module"}));function _U(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=r=>{if(!e.transform)return t.evaluateFunction(r);const n=[];return e.transform.transformPoint(r,n),t.evaluateFunction(n)},t.evaluateFunction=r=>{K.vtkErrorMacro("not implemented")}}const EU={};function q8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EU,r),K.obj(t,e),K.setGet(t,e,["transform"]),_U(t,e)}const bU=K.newInstance(q8,"vtkImplicitFunction");var DU={newInstance:bU,extend:q8};const c5=1e-6,Y8="coincide",J8="disjoint";function IU(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function Z8(t,e,r){const n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function Q8(t,e,r,n){const i=[];ei(t,e,i);const o=jt(r,i);n[0]=t[0]-o*r[0],n[1]=t[1]-o*r[1],n[2]=t[2]-o*r[2]}function eD(t,e,r){const n=jt(t,e);let i=jt(e,e);return i===0&&(i=1),r[0]=t[0]-n*e[0]/i,r[1]=t[1]-n*e[1]/i,r[2]=t[2]-n*e[2]/i,r}function tD(t,e,r,n){const i=[];ei(t,e,i);const o=jt(r,i),a=jt(r,r);a!==0?(n[0]=t[0]-o*r[0]/a,n[1]=t[1]-o*r[1]/a,n[2]=t[2]-o*r[2]/a):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function nD(t,e,r,n){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},o=[],a=[];ei(e,t,o),ei(r,t,a);const s=jt(n,a),c=jt(n,o);let l,f;return c<0?l=-c:l=c,s<0?f=-s*c5:f=s*c5,l<=f||(i.t=s/c,i.x[0]=t[0]+i.t*o[0],i.x[1]=t[1]+i.t*o[1],i.x[2]=t[2]+i.t*o[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function rD(t,e,r,n){const i={intersection:!1,l0:[],l1:[],error:null},o=[];Qi(e,n,o);const a=o.map(u=>Math.abs(u));if(a[0]+a[1]+a[2]<c5){const u=[];return ei(t,r,u),jt(e,u)===0?i.error=Y8:i.error=J8,i}let s;a[0]>a[1]&&a[0]>a[2]?s="x":a[1]>a[2]?s="y":s="z";const c=[],l=-jt(e,t),f=-jt(n,r);switch(s){case"x":c[0]=0,c[1]=(f*e[2]-l*n[2])/o[0],c[2]=(l*n[1]-f*e[1])/o[0];break;case"y":c[0]=(l*n[2]-f*e[2])/o[1],c[1]=0,c[2]=(f*e[0]-l*n[0])/o[1];break;case"z":c[0]=(f*e[1]-l*n[1])/o[2],c[1]=(l*n[0]-f*e[0])/o[2],c[2]=0;break}return i.l0=c,u0(c,o,i.l1),i.intersection=!0,i}const MU={evaluate:IU,distanceToPlane:Z8,projectPoint:Q8,projectVector:eD,generalizedProjectPoint:tD,intersectWithLine:nD,intersectWithPlane:rD,DISJOINT:J8,COINCIDE:Y8};function OU(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=r=>Z8(r,e.origin,e.normal),t.projectPoint=(r,n)=>{Q8(r,e.origin,e.normal,n)},t.projectVector=(r,n)=>eD(r,e.normal,n),t.push=r=>{if(r!==0)for(let n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=(r,n)=>{tD(r,e.origin,e.normal,n)},t.evaluateFunction=(r,n,i)=>Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=r=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(r,n)=>nD(r,n,e.origin,e.normal),t.intersectWithPlane=(r,n)=>rD(r,n,e.origin,e.normal)}const PU={normal:[0,0,1],origin:[0,0,0]};function iD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PU,r),DU.extend(t,e,r),K.setGetArray(t,e,["normal","origin"],3),OU(t,e)}const RU=K.newInstance(iD,"vtkPlane");var tr={newInstance:RU,extend:iD,...MU};const j1=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function oD(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Sc(t){return t?.length>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function lC(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function uC(t){return lC(t,j1)}function Im(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=i<e?i:e,t[1]=o>e?o:e,t[2]=a<r?a:r,t[3]=s>r?s:r,t[4]=c<n?c:n,t[5]=l>n?l:n,t}function fC(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let r=0;r<e.length;++r)Im(t,...e[r]);else for(let r=0;r<e.length;r+=3)Im(t,...e.slice(r,r+3));return t}function aD(t,e,r,n,i,o,a){const[s,c,l,f,u,d]=t;return a===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],d)):(t[0]=Math.min(e,s),t[1]=Math.max(r,c),t[2]=Math.min(n,l),t[3]=Math.max(i,f),t[4]=Math.min(o,u),t[5]=Math.max(a,d)),t}function sD(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=e,t[1]=e>o?e:o,t[2]=r,t[3]=r>s?r:s,t[4]=n,t[5]=n>l?n:l,i!==e||a!==r||c!==n}function cD(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=r<a?r:a,t[3]=r,t[4]=n<c?n:c,t[5]=n,o!==e||s!==r||l!==n}function dC(t,e){return e==null?AU(t):(t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t)}function AU(t){const e=[0,0,0];let r=-1,n=0,i=0;for(let o=0;o<3;++o)i=t[o*2+1]-t[o*2],i>n&&(n=i,r=o),e[o]=i>0?1:0;if(r<0)return dC(t,.5);for(let o=0;o<3;++o)if(!e[o]){const a=.005*n;t[o*2]-=a,t[o*2+1]+=a}return t}function hC(t,e,r,n){return Sc(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function gC(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function LU(t,e,r,n){if(!Sc(t))return!1;const i=gC(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],hC(t,e,r,n),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function Wd(t,e){return t[e*2+1]-t[e*2]}function ag(t){return[Wd(t,0),Wd(t,1),Wd(t,2)]}function lD(t){return t.slice(0,2)}function uD(t){return t.slice(2,4)}function fD(t){return t.slice(4,6)}function dD(t){const e=ag(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function pC(t){if(Sc(t)){const e=ag(t);return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}return null}function hD(t){const e=pC(t);return e!==null?Math.sqrt(e):null}function H1(t){return[t[0],t[2],t[4]]}function K1(t){return[t[1],t[3],t[5]]}function jg(t,e){return t<=0&&e>=0||t>=0&&e<=0}function mC(t,e){return e[0]=[t[0],t[2],t[4]],e[1]=[t[0],t[2],t[5]],e[2]=[t[0],t[3],t[4]],e[3]=[t[0],t[3],t[5]],e[4]=[t[1],t[2],t[4]],e[5]=[t[1],t[2],t[5]],e[6]=[t[1],t[3],t[4]],e[7]=[t[1],t[3],t[5]],e}function gD(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function pD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const n=mC(t,[]);for(let i=0;i<n.length;++i)Pt(n[i],n[i],e);return uC(r),fC(r,n)}function mD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function vD(t,e,r,n){const i=[].concat(j1),o=t.getData();for(let a=0;a<o.length;a+=3){const s=[o[a],o[a+1],o[a+2]],c=jt(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=jt(s,r);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const f=jt(s,n);i[4]=Math.min(f,i[4]),i[5]=Math.max(f,i[5])}return i}function yD(t,e,r,n,i){let o=!0;const a=[];let s=0;const c=[],l=[0,0,0],f=0,u=1,d=2;for(let h=0;h<3;h++)e[h]<t[2*h]?(a[h]=u,l[h]=t[2*h],o=!1):e[h]>t[2*h+1]?(a[h]=f,l[h]=t[2*h+1],o=!1):a[h]=d;if(o)return n[0]=e[0],n[1]=e[1],n[2]=e[2],i[0]=0,1;for(let h=0;h<3;h++)a[h]!==d&&r[h]!==0?c[h]=(l[h]-e[h])/r[h]:c[h]=-1;for(let h=0;h<3;h++)c[s]<c[h]&&(s=h);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let h=0;h<3;h++)if(s!==h){if(n[h]=e[h]+c[s]*r[h],n[h]<t[2*h]||n[h]>t[2*h+1])return 0}else n[h]=l[h];return 1}function wD(t,e,r){const n=[];let i=0,o=1,a=1;for(let s=4;s<=5;++s){n[2]=t[s];for(let c=2;c<=3;++c){n[1]=t[c];for(let l=0;l<=1;++l)if(n[0]=t[l],i=tr.evaluate(r,e,n),a&&(o=i>=0?1:-1,a=0),i===0||o>0&&i<0||o<0&&i>0)return 1}}return 0}function CD(t,e){if(!(Sc(t)&&Sc(e)))return!1;const r=[0,0,0,0,0,0];let n;for(let i=0;i<3;i++)if(n=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(n=!0,r[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(n=!0,r[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(n=!0,r[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(n=!0,r[i*2+1]=t[i*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function Mm(t,e){if(!(Sc(t)&&Sc(e)))return!1;for(let r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function Om(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function NU(t,e){return!(!Mm(t,e)||!Om(t,...H1(e))||!Om(t,...K1(e)))}function xD(t,e,r){const n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let o=0;for(let u=0;u<2;u++)for(let d=2;d<4;d++)for(let h=4;h<6;h++){const g=[t[u],t[d],t[h]];i[o++]=tr.evaluate(r,e,g)}let a=2;for(;a--&&!(jg(i[n[a][0]],i[n[a][4]])&&jg(i[n[a][1]],i[n[a][5]])&&jg(i[n[a][2]],i[n[a][6]])&&jg(i[n[a][3]],i[n[a][7]])););if(a<0)return!1;const s=Math.sign(r[a]),c=Math.abs((t[a*2+1]-t[a*2])*r[a]);let l=s>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const d=Math.abs(i[n[a][u]])/c;s>0&&d<l&&(l=d),s<0&&d>l&&(l=d)}const f=(1-l)*t[a*2]+l*t[a*2+1];return s>0?t[a*2]=f:t[a*2+1]=f,!0}function TD(t,e){for(let n=0;n<3;++n)e[n]=e[n]<1?1:e[n];let r=e[0]*e[1]*e[2];for(;r>t;){for(let n=0;n<3;++n)e[n]=e[n]>1?e[n]-1:1;r=e[0]*e[1]*e[2]}}function SD(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];e=e<=0?1:e;let i=0;const o=[0,0,0];let a=-1,s=0;const c=ag(t),l=c[0]+c[1]+c[2],f=l*(.001/3);for(let p=0;p<3;++p)c[p]>s&&(a=p,s=c[p]),c[p]>f?(o[p]=1,i++):o[p]=0;const u=H1(t),d=K1(t);if(i<1)return r[0]=1,r[1]=1,r[2]=1,n[0]=u[0]-.5,n[1]=d[0]+.5,n[2]=u[1]-.5,n[3]=d[1]+.5,n[4]=u[2]-.5,n[5]=d[2]+.5,1;let h=e;h/=o[0]?c[0]/l:1,h/=o[1]?c[1]/l:1,h/=o[2]?c[2]/l:1,h**=1/i;for(let p=0;p<3;++p)r[p]=o[p]?Math.floor(h*c[p]/l):1,r[p]=r[p]<1?1:r[p];TD(e,r);const g=.5*c[a]/r[a];for(let p=0;p<3;++p)o[p]?(n[2*p]=u[p],n[2*p+1]=d[p]):(n[2*p]=u[p]-g,n[2*p+1]=d[p]+g);return r[0]*r[1]*r[2]}function _D(t,e){if(t[0]>=e[0]&&t[0]<=e[1]&&t[1]>=e[2]&&t[1]<=e[3]&&t[2]>=e[4]&&t[2]<=e[5])return 0;const r=[0,0,0];return t[0]<e[0]?r[0]=e[0]-t[0]:t[0]>e[1]&&(r[0]=t[0]-e[1]),t[1]<e[2]?r[1]=e[2]-t[1]:t[1]>e[3]&&(r[1]=t[1]-e[3]),t[2]<e[4]?r[2]=e[4]-t[2]:t[2]>e[5]&&(r[2]=t[2]-e[5]),jt(r,r)}class VU{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(j1))}getBounds(){return this.bounds}equals(e){return oD(this.bounds,e)}isValid(){return Sc(this.bounds)}setBounds(e){return lC(this.bounds,e)}reset(){return uC(this.bounds)}addPoint(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Im(this.bounds,...r)}addPoints(e){return fC(this.bounds,e)}addBounds(e,r,n,i,o,a){return aD(this.bounds,e,r,n,i,o,a)}setMinPoint(e,r,n){return sD(this.bounds,e,r,n)}setMaxPoint(e,r,n){return cD(this.bounds,e,r,n)}inflate(e){return dC(this.bounds,e)}scale(e,r,n){return hC(this.bounds,e,r,n)}getCenter(){return gC(this.bounds)}getLength(e){return Wd(this.bounds,e)}getLengths(){return ag(this.bounds)}getMaxLength(){return dD(this.bounds)}getDiagonalLength(){return hD(this.bounds)}getDiagonalLength2(){return pC(this.bounds)}getMinPoint(){return H1(this.bounds)}getMaxPoint(){return K1(this.bounds)}getXRange(){return lD(this.bounds)}getYRange(){return uD(this.bounds)}getZRange(){return fD(this.bounds)}getCorners(e){return mC(this.bounds,e)}computeCornerPoints(e,r){return gD(this.bounds,e,r)}computeLocalBounds(e,r,n){return vD(this.bounds,e,r,n)}transformBounds(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pD(this.bounds,e,r)}computeScale3(e){return mD(this.bounds,e)}cutWithPlane(e,r){return xD(this.bounds,e,r)}intersectBox(e,r,n,i){return yD(this.bounds,e,r,n,i)}intersectPlane(e,r){return wD(this.bounds,e,r)}intersect(e){return CD(this.bounds,e)}intersects(e){return Mm(this.bounds,e)}containsPoint(e,r,n){return Om(this.bounds,e,r,n)}contains(e){return Mm(this.bounds,e)}computeDivisions(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return SD(this.bounds,e,r,n)}distance2ToBounds(e){return _D(e,this.bounds)}}function kU(t){const e=t&&t.bounds;return new VU(e)}const FU={equals:oD,isValid:Sc,setBounds:lC,reset:uC,addPoint:Im,addPoints:fC,addBounds:aD,setMinPoint:sD,setMaxPoint:cD,inflate:dC,scale:hC,scaleAboutCenter:LU,getCenter:gC,getLength:Wd,getLengths:ag,getMaxLength:dD,getDiagonalLength:hD,getDiagonalLength2:pC,getMinPoint:H1,getMaxPoint:K1,getXRange:lD,getYRange:uD,getZRange:fD,getCorners:mC,computeCornerPoints:gD,computeLocalBounds:vD,transformBounds:pD,computeScale3:mD,cutWithPlane:xD,intersectBox:yD,intersectPlane:wD,intersect:CD,intersects:Mm,containsPoint:Om,contains:NU,computeDivisions:SD,clampDivisions:TD,distance2ToBounds:_D,INIT_BOUNDS:j1};var hn={newInstance:kU,...FU};const UU={DISPLAY:0,WORLD:1};var ED={CoordinateSystem:UU};const{CoordinateSystem:l5}=ED;function sS(t){return()=>K.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function BU(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let r=e.mtime;for(let n=0;n<e.textures.length;++n){const i=e.textures[n].getMTime();i>r&&(r=i)}return r},t.processSelectorPixelBuffers=(r,n)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=sS("pick"),t.hasKey=sS("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=r=>{e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=r=>{e.estimatedRenderTime+=r},t.setAllocatedRenderTime=r=>{e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=r=>e.textures.indexOf(r)!==-1,t.addTexture=r=>{r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=r=>{const n=e.textures.filter(i=>i!==r);e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(l5.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(l5.DISPLAY)}const GU={allocatedRenderTime:10,coordinateSystem:l5.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function bD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GU,r),K.obj(t,e),K.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),K.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),K.moveToProtected(t,e,["parentProp"]),BU(t,e)}const WU=K.newInstance(bD,"vtkProp");var sg={newInstance:WU,extend:bD,...ED};const $U=1e-6;function zU(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=n=>{e.position=e.position.map((i,o)=>i+n[o]),t.modified()},t.getOrientationWXYZ=()=>{const n=Tc();i5(n,e.rotation);const i=new Float64Array(3),o=lU(i,n);return[xm(o),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return i5(n,e.rotation)},t.rotateX=n=>{n!==0&&(qw(e.rotation,e.rotation,wr(n)),t.modified())},t.rotateY=n=>{n!==0&&(Yw(e.rotation,e.rotation,wr(n)),t.modified())},t.rotateZ=n=>{n!==0&&(Jw(e.rotation,e.rotation,wr(n)),t.modified())},t.rotateWXYZ=(n,i,o,a)=>{if(n===0||i===0&&o===0&&a===0)return;const s=wr(n),c=Tc();og(c,[i,o,a],s);const l=new Float64Array(16);Yf(l,c),Wt(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=n=>{if(Math.abs(n[3])>=1-$U)return;const i=Yf(new Float64Array(16),n);Wt(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(n,i,o)=>n===e.orientation[0]&&i===e.orientation[1]&&o===e.orientation[2]?!1:(e.orientation=[n,i,o],_t(e.rotation),t.rotateZ(o),t.rotateX(n),t.rotateY(i),t.modified(),!0),t.setOrientationFromQuaternion=n=>{const i=Ti();return Yf(i,n),f0(i,e.rotation)?!1:(e.rotation=i,t.modified(),!0)},t.setUserMatrix=n=>f0(e.userMatrix,n)?!1:(sr(e.userMatrix,n),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){_t(e.matrix),e.userMatrix&&Wt(e.matrix,e.matrix,e.userMatrix),Gn(e.matrix,e.matrix,e.origin),Gn(e.matrix,e.matrix,e.position),Wt(e.matrix,e.matrix,e.rotation),ws(e.matrix,e.matrix,e.scale),Gn(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),mn(e.matrix,e.matrix),e.isIdentity=!0;for(let n=0;n<4;++n)for(let i=0;i<4;++i)(n===i?1:0)!==e.matrix[n+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getBoundsByReference=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n,e.bounds=[...hn.INIT_BOUNDS],e.boundsMTime.modified(),n;if(!e.mapperBounds||!n.every((i,o)=>n[o]===e.mapperBounds[o])||t.getMTime()>e.boundsMTime.getMTime()){K.vtkDebugMacro("Recomputing bounds..."),e.mapperBounds=n,t.computeMatrix();const i=new Float64Array(16);mn(i,e.matrix),hn.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBounds=()=>{const n=t.getBoundsByReference();try{return[...n]}catch{return n}},t.getCenter=()=>hn.getCenter(e.bounds),t.getLength=()=>hn.getLength(e.bounds),t.getXRange=()=>hn.getXRange(e.bounds),t.getYRange=()=>hn.getYRange(e.bounds),t.getZRange=()=>hn.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function r(){t.computeMatrix()}t.onModified(r),t.getProperty=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.properties[n]==null&&(e.properties[n]=t.makeProperty?.()),e.properties[n]},t.getProperties=()=>(e.properties.length===0&&(e.properties[0]=t.makeProperty?.()),e.properties),t.setProperty=(n,i)=>{const o=Number.isInteger(n),[a,s]=o?[n,i]:[0,n];return e.properties[a]===s?!1:(e.properties[a]=s,!0)},t.getMTime=()=>{let n=e.mtime;return e.properties.forEach(i=>{if(i!==null){const o=i.getMTime();n=o>n?o:n}}),n}}const jU={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[...hn.INIT_BOUNDS],properties:[],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function DD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jU,r),sg.extend(t,e,r),e.matrixMTime={},K.obj(e.matrixMTime),K.get(t,e,["isIdentity"]),K.getArray(t,e,["orientation"]),K.setGetArray(t,e,["origin","position","scale"],3),K.setGet(t,e,["properties"]),e.matrix=_t(new Float64Array(16)),e.rotation=_t(new Float64Array(16)),e.userMatrix=_t(new Float64Array(16)),e.transform=null,zU(t,e)}const HU=K.newInstance(DD,"vtkProp3D");var vC={newInstance:HU,extend:DD};const ID={NEAREST:0,LINEAR:1,FAST_LINEAR:2},MD={FRACTIONAL:0,PROPORTIONAL:1},Jp={DEFAULT:0,ADDITIVE:1,COLORIZE:2,CUSTOM:3},KU={OFF:0,NORMALIZED:1,RAW:2};var OD={InterpolationType:ID,OpacityMode:MD,ColorMixPreset:Jp,FilterMode:KU};const{InterpolationType:Dd,OpacityMode:XU,FilterMode:Id,ColorMixPreset:qU}=OD,{vtkErrorMacro:gv}=K,Zp=4;function YU(t,e){e.classHierarchy.push("vtkVolumeProperty");const r={...t};t.getMTime=()=>{let o=e.mtime,a;for(let s=0;s<Zp;s++)e.componentData[s].colorChannels===1?e.componentData[s].grayTransferFunction&&(a=e.componentData[s].grayTransferFunction.getMTime(),o=o>a?o:a):e.componentData[s].colorChannels===3&&e.componentData[s].rGBTransferFunction&&(a=e.componentData[s].rGBTransferFunction.getMTime(),o=o>a?o:a),e.componentData[s].scalarOpacity&&(a=e.componentData[s].scalarOpacity.getMTime(),o=o>a?o:a),e.componentData[s].gradientOpacity&&(e.componentData[s].disableGradientOpacity||(a=e.componentData[s].gradientOpacity.getMTime(),o=o>a?o:a));return o},t.getColorChannels=o=>o<0||o>3?(gv("Bad index - must be between 0 and 3"),0):e.componentData[o].colorChannels,t.setGrayTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[o].grayTransferFunction!==a&&(e.componentData[o].grayTransferFunction=a,s=!0),e.componentData[o].colorChannels!==1&&(e.componentData[o].colorChannels=1,s=!0),s&&t.modified(),s},t.getGrayTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[o].grayTransferFunction===null&&(e.componentData[o].grayTransferFunction=qu.newInstance(),e.componentData[o].grayTransferFunction.addPoint(0,0),e.componentData[o].grayTransferFunction.addPoint(1024,1),e.componentData[o].colorChannels!==1&&(e.componentData[o].colorChannels=1),t.modified()),e.componentData[o].grayTransferFunction},t.setRGBTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[o].rGBTransferFunction!==a&&(e.componentData[o].rGBTransferFunction=a,s=!0),e.componentData[o].colorChannels!==3&&(e.componentData[o].colorChannels=3,s=!0),s&&t.modified(),s},t.getRGBTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[o].rGBTransferFunction===null&&(e.componentData[o].rGBTransferFunction=Cc.newInstance(),e.componentData[o].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[o].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[o].colorChannels!==3&&(e.componentData[o].colorChannels=3),t.modified()),e.componentData[o].rGBTransferFunction},t.setScalarOpacity=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[o].scalarOpacity!==a?(e.componentData[o].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[o].scalarOpacity===null&&(e.componentData[o].scalarOpacity=qu.newInstance(),e.componentData[o].scalarOpacity.addPoint(0,1),e.componentData[o].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[o].scalarOpacity},t.setComponentWeight=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(o<0||o>=Zp)return gv("Invalid index"),!1;const s=Math.min(1,Math.max(0,a));return e.componentData[o].componentWeight!==s?(e.componentData[o].componentWeight=s,t.modified(),!0):!1},t.getComponentWeight=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return o<0||o>=Zp?(gv("Invalid index"),0):e.componentData[o].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(Dd.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(Dd.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(Dd.FAST_LINEAR),t.getInterpolationTypeAsString=()=>K.enumToString(Dd,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(o=>{const a=K.capitalize(o);t[`set${a}`]=(s,c)=>e.componentData[s][`${o}`]!==c?(e.componentData[s][`${o}`]=c,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(o=>{const a=K.capitalize(o);t[`get${a}`]=s=>e.componentData[s][`${o}`]}),t.setAverageIPScalarRange=(o,a)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(o,a)},t.getFilterModeAsString=()=>K.enumToString(Id,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(Id.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(Id.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(Id.RAW)},t.setGlobalIlluminationReach=o=>r.setGlobalIlluminationReach(ba(o,0,1)),t.setVolumetricScatteringBlending=o=>r.setVolumetricScatteringBlending(ba(o,0,1)),t.setAnisotropy=o=>r.setAnisotropy(ba(o,-.99,.99)),t.setLAOKernelSize=o=>r.setLAOKernelSize(Uw(ba(o,1,32))),t.setLAOKernelRadius=o=>r.setLAOKernelRadius(o>=1?o:1)}const JU=t=>({colorMixPreset:qU.DEFAULT,independentComponents:!0,interpolationType:Dd.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,ipScalarRange:[-1e6,1e6],filterMode:Id.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7,updatedExtents:[],...t});function ZU(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,JU(r)),K.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<Zp;++n)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:XU.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}K.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius","updatedExtents"]),K.setGetArray(t,e,["ipScalarRange"],2),K.setGetArray(t,e,["labelOutlineThickness"]),YU(t,e)}const QU=K.newInstance(ZU,"vtkVolumeProperty");var eB={newInstance:QU,...OD};function tB(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>[t],t.makeProperty=eB.newInstance,t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return r}}const nB={mapper:null};function PD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nB,r),vC.extend(t,e,r),e.boundsMTime={},K.obj(e.boundsMTime),K.setGet(t,e,["mapper"]),tB(t,e)}const rB=K.newInstance(PD,"vtkVolume");var iB={newInstance:rB,extend:PD};const{vtkErrorMacro:oB}=K,aB=["Build","Render"];function sB(t,e){e.classHierarchy.push("vtkViewNode"),t.build=n=>{},t.render=n=>{},t.traverse=n=>{const i=n.getTraverseOperation(),o=t[i];if(o){o(n);return}t.apply(n,!0);for(let a=0;a<e.children.length;a++)e.children[a].traverse(n);t.apply(n,!1)},t.apply=(n,i)=>{const o=t[n.getOperation()];o&&o(i,n)},t.getViewNodeFor=n=>{if(e.renderable===n)return t;for(let i=0;i<e.children.length;++i){const a=e.children[i].getViewNodeFor(n);if(a)return a}},t.getFirstAncestorOfType=n=>e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null,t.getLastAncestorOfType=n=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(n);return i||(e._parent.isA(n)?e._parent:null)},t.addMissingNode=n=>{if(!n)return;const i=e._renderableChildMap.get(n);if(i!==void 0)return i.setVisited(!0),i;const o=t.createViewNode(n);if(o)return o.setParent(t),o.setVisited(!0),e._renderableChildMap.set(n,o),e.children.push(o),o},t.addMissingNodes=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!n||!n.length))for(let o=0;o<n.length;++o){const a=n[o],s=t.addMissingNode(a);if(i&&s!==void 0&&e.children[o]!==s){for(let c=o+1;c<e.children.length;++c)if(e.children[c]===s){e.children.splice(c,1),e.children.splice(o,0,s);break}}}},t.addMissingChildren=n=>{if(!(!n||!n.length))for(let i=0;i<n.length;++i){const o=n[i];if(e.children.indexOf(o)===-1){o.setParent(t),e.children.push(o);const s=o.getRenderable();s&&e._renderableChildMap.set(s,o)}o.setVisited(!0)}},t.removeNode=n=>{const i=e.children.findIndex(a=>a===n);if(i<0)return!1;const o=n.getRenderable();return o&&e._renderableChildMap.delete(o),n.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=n=>{e.visited=n},t.removeUnusedNodes=()=>{let n=0;for(let i=0;i<e.children.length;++i){const o=e.children[i];if(o.getVisited())e.children[n++]=o,o.setVisited(!1);else{const s=o.getRenderable();s&&e._renderableChildMap.delete(s),o.delete()}}e.children.length=n},t.createViewNode=n=>{if(!e.myFactory)return oB("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(n);return i&&i.setRenderable(n),i};const r=t.delete;t.delete=()=>{for(let n=0;n<e.children.length;n++)e.children[n].delete();r()}}const cB={renderable:null,myFactory:null,children:[],visited:!1};function RD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cB,r),K.obj(t,e),K.event(t,e,"event"),e._renderableChildMap=new Map,K.get(t,e,["visited"]),K.setGet(t,e,["_parent","renderable","myFactory"]),K.getArray(t,e,["children"]),K.moveToProtected(t,e,["parent"]),sB(t,e)}const lB=K.newInstance(RD,"vtkViewNode");var Yn={newInstance:lB,extend:RD,PASS_TYPES:aB};function uB(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,i=r.getClassName(n++),o=!1;const a=Object.keys(e.overrides);for(;i&&!o;)a.indexOf(i)!==-1?o=!0:i=r.getClassName(n++);if(!o)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const fB={};function AD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fB,r),K.obj(t,e),uB(t,e)}const dB=K.newInstance(AD,"vtkViewNodeFactory");var yC={newInstance:dB,extend:AD};const LD=Object.create(null);function Vr(t,e){LD[t]=e}function hB(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const gB={};function ND(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gB,r),e.overrides=LD,yC.extend(t,e,r),hB(t,e)}const pB=K.newInstance(ND,"vtkOpenGLViewNodeFactory");var mB={newInstance:pB,extend:ND};function vB(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=r=>{if(r){const n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=r=>{if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){sr(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),xl(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),xc(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),mn(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const n=e._openGLRenderer.getAspectRatio();sr(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),mn(e.keyMatrices.vcpc,e.keyMatrices.vcpc),Wt(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}const yB={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function wB(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yB,r),Yn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Er(t,e,["context","keyMatrixTime"]),vB(t,e)}const VD=On(wB);var CB={newInstance:VD};Vr("vtkCamera",VD);const{vtkDebugMacro:xB}=_i;function TB(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let i=0;i<n.length;++i)n[i].getSwitch()>0&&r++;return r||(xB("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=r=>{if(r){let n=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),n|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const o=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.colorMask(!0,!0,!0,!0),n&&i.clear(n),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.cameraPass=r=>{r&&t.clear()},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],i=r[0]-n[0],o=r[1]-n[1],a=e._parent.normalizedDisplayToDisplay(i,o),s=Math.round(a[0]),c=Math.round(a[1]),l=r[2]-n[0],f=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(l,f);let d=Math.round(u[0])-s,h=Math.round(u[1])-c;return d<0&&(d=0),h<0&&(h=0),{usize:d,vsize:h,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let r=0;const n=e.context;if(!e.renderable.getTransparent()){const o=e.renderable.getBackgroundByReference();n.clearColor(o[0],o[1],o[2],o[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,n.depthMask(!0)),n.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(r=>{r.modified()})},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const SB={context:null,_openGLRenderWindow:null,selector:null};function _B(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SB,r),Yn.extend(t,e,r),Wi(t,e,["shaderCache"]),Er(t,e,["selector"]),tg(t,e,["openGLRenderWindow"]),TB(t,e)}const kD=On(_B,"vtkOpenGLRenderer");var EB={newInstance:kD};Vr("vtkRenderer",kD);const{isVtkObject:bB}=K;function FD(t){let e=0;return t.filter((r,n)=>n===e?(e+=r+1,!0):!1)}function UD(t){let e=0;for(let r=0;r<t.length;)r+=t[r]+1,e++;return e}const DB={extractCellSizes:FD,getNumberOfCells:UD};function IB(t,e){e.classHierarchy.push("vtkCellArray");const r={...t};t.getNumberOfCells=n=>(e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=UD(t.getData())),e.numberOfCells),t.getCellSizes=n=>(e.cellSizes!==void 0&&!n||(e.cellSizes=FD(t.getData())),e.cellSizes),t.resize=n=>{const i=t.getNumberOfTuples();r.resize(n);const o=t.getNumberOfTuples();o<i&&(o===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=n=>{r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=n=>{let i=n;const o=e.values[i++];return e.values.subarray(i,i+o)},t.insertNextCell=n=>{let i;bB(n)?i=n.getPointsIds():i=n;const o=t.getNumberOfCells();return t.insertNextTuples([i.length,...i]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(i.length),o},t.getMaxCellSize=()=>t.getCellSizes().reduce((n,i)=>Math.max(n,i),0)}function MB(t){return{empty:!0,numberOfComponents:1,dataType:Qt.UNSIGNED_INT,...t}}function BD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Tt.extend(t,e,MB(r)),IB(t,e)}const OB=K.newInstance(BD,"vtkCellArray");var Ml={newInstance:OB,extend:BD,...DB};const{vtkErrorMacro:PB}=K;function RB(t,e){let r=0;e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==o&&(e.size=o*a,e.values=K.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(a),t.modified())},t.setPoint=function(o){for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];t.setTuple(o,s)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(o,a,s)=>t.insertNextTuple([o,a,s]),t.insertPoint=(o,a)=>t.insertTuple(o,a);const n=t.getBounds;t.getBounds=()=>(r<e.mtime&&t.computeBounds(),n());const i=t.getBoundsByReference;t.getBoundsByReference=()=>(r<e.mtime&&t.computeBounds(),i()),t.computeBounds=()=>{if(t.getNumberOfComponents()===3){const o=t.getRange(0);e.bounds[0]=o[0],e.bounds[1]=o[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const s=t.getRange(2);e.bounds[4]=s[0],e.bounds[5]=s[1]}else if(t.getNumberOfComponents()===2){const o=t.getRange(0);e.bounds[0]=o[0],e.bounds[1]=o[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1],e.bounds[4]=0,e.bounds[5]=0}else PB(`getBounds called on an array with components of ${t.getNumberOfComponents()}`),$w(e.bounds);r=K.getCurrentGlobalMTime()},t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const AB={empty:!0,numberOfComponents:3,dataType:Qt.FLOAT,bounds:[1,-1,1,-1,1,-1]};function GD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AB,r),Tt.extend(t,e,r),K.getArray(t,e,["bounds"],6),RB(t,e)}const LB=K.newInstance(GD,"vtkPoints");var Ju={newInstance:LB,extend:GD};function NB(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=K.newTypedArray(r.getDataType(),3*e.pointsIds.length));const o=r.getData();e.pointsIds.forEach((a,s)=>{let c=3*a,l=3*s;i[l]=o[c],i[++l]=o[++c],i[++l]=o[++c]}),e.points.setData(i)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(let i=r.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>e.points.getBounds(),t.getLength2=()=>{const r=hn.getLengths(t.getBounds());return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]},t.getParametricDistance=r=>{let n,i=0;for(let o=0;o<3;o++)r[o]<0?n=-r[o]:r[o]>1?n=r[o]-1:n=0,n>i&&(i=n);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=r=>{r.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(r,n,i,o,a,s,c)=>{},t.evaluatePosition=(r,n,i,o,a,s)=>{K.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const VB={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function WD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VB,r),K.obj(t,e),e.points||(e.points=Ju.newInstance()),K.get(t,e,["points","pointsIds"]),NB(t,e)}const kB=K.newInstance(WD,"vtkCell");var Zu={newInstance:kB,extend:WD};function FB(t,e){let r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function UB(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=r=>{const n=r.getPoints().getNumberOfPoints(),i=r.getNumberOfCells(),o=new Uint32Array(n);if(r.isA("vtkPolyData")){for(let a=0;a<i;++a){const{cellPointIds:s}=r.getCellPoints(a);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(n),e.maxId=n-1;for(let a=0;a<i;++a){const{cellPointIds:s}=r.getCellPoints(a);s.forEach(c=>{t.insertCellReference(c,o[c]++,a)})}}else{for(let a=0;a<i;a++)Zu.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(n),e.maxId=n-1;for(let a=0;a<i;++a)Zu.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,o[c]++,a)})}},t.allocate=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(()=>({ncells:0,cells:null})),e.extend=n,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=r=>e.array[r],t.getNcells=r=>e.array[r].ncells,t.getCells=r=>e.array[r].cells,t.insertNextPoint=r=>{e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=(r,n)=>{e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=r=>{e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=(r,n)=>{e.array[n].cells=e.array[n].cells.filter(i=>i!==r),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=(r,n)=>{e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=(r,n)=>{e.array[r].cells.length=n},t.squeeze=()=>{FB(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{e.array=[...r.array],e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=r=>{++e.array[r].ncells},t.allocateLinks=r=>{for(let n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=(r,n,i)=>{e.array[r].cells[n]=i}}const BB={array:null,maxId:0,extend:0};function $D(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BB,r),K.obj(t,e),UB(t,e)}const GB=K.newInstance($D,"vtkCellLinks");var WB={newInstance:GB,extend:$D};const Un={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},u5=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function $B(t){return t<u5.length?u5[t]:"UnknownClass"}function zB(t){return u5.findIndex(t)}function jB(t){return t<Un.VTK_QUADRATIC_EDGE||t===Un.VTK_CONVEX_POINT_SET||t===Un.VTK_POLYHEDRON}function HB(t){return t===Un.VTK_TRIANGLE_STRIP||t===Un.VTK_POLY_LINE||t===Un.VTK_POLY_VERTEX}const KB={getClassNameFromTypeId:$B,getTypeIdFromClassName:zB,isLinear:jB,hasSubCells:HB};function XB(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=(r,n,i)=>{e.typeArray[r]=n,e.locationArray[r]=i,r>e.maxId&&(e.maxId=r)},t.insertNextCell=(r,n)=>(t.insertCell(++e.maxId,r,n),e.maxId),t.setCellTypes=(r,n,i)=>{e.size=r,e.typeArray=n,e.locationArray=i,e.maxId=r-1},t.getCellLocation=r=>e.locationArray[r],t.deleteCell=r=>{e.typeArray[r]=Un.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=r=>{const n=t.getNumberOfTypes();for(let i=0;i<n;++i)if(r===t.getCellType(i))return!0;return!1},t.insertNextType=r=>t.insertNextCell(r,-1),t.getCellType=r=>e.typeArray[r],t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}const qB={size:0,maxId:-1,extend:1e3};function zD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qB,r),K.obj(t,e),K.get(t,e,["size","maxId","extend"]),K.getArray(t,e,["typeArray","locationArray"]),XB(t,e)}const YB=K.newInstance(zD,"vtkCellTypes");var JB={newInstance:YB,extend:zD,...KB};const jD={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var HD={IntersectionState:jD};const{IntersectionState:Qp}=HD;function Rf(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},o=[];let a;o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2];const s=o[0]*(t[0]-e[0])+o[1]*(t[1]-e[1])+o[2]*(t[2]-e[2]),c=jt(o,o);let l=1e-5*s;return c!==0&&(i.t=s/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?a=e:i.t>1?a=r:(a=o,o[0]=e[0]+i.t*o[0],o[1]=e[1]+i.t*o[1],o[2]=e[2]+i.t*o[2]),n&&(n[0]=a[0],n[1]=a[1],n[2]=a[2]),i.distance=So(a,t),i}function KD(t,e,r,n,i,o){const a=[],s=[],c=[];i[0]=0,o[0]=0,ei(e,t,a),ei(n,r,s),ei(r,t,c);const l=[jt(a,a),-jt(a,s),-jt(a,s),jt(s,s)],f=[];if(f[0]=jt(a,c),f[1]=-jt(s,c),d8(l,f,2)===0){let u=Number.MAX_VALUE;const d=[t,e,r,n],h=[r,r,t,t],g=[n,n,e,e];o[0],o[0],i[0],i[0],i[0],i[0],o[0],o[0];let p;for(let m=0;m<4;m++)p=Rf(d[m],h[m],g[m]),p.distance<u&&(u=p.distance,p.t);return Qp.ON_LINE}return i[0]=f[0],o[0]=f[1],i[0]>=0&&i[0]<=1&&o[0]>=0&&o[0]<=1?Qp.YES_INTERSECTION:Qp.NO_INTERSECTION}const ZB={distanceToLine:Rf,intersection:KD};function QB(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=()=>1,t.intersectWithLine=(n,i,o,a,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const l=[],f=[],u=[];e.points.getPoint(0,f),e.points.getPoint(1,u);const d=[],h=[],g=KD(n,i,f,u,d,h);if(c.t=d[0],c.betweenPoints=r(c.t),s[0]=h[0],g===Qp.YES_INTERSECTION){for(let p=0;p<3;p++)a[p]=f[p]+s[0]*(u[p]-f[p]),l[p]=n[p]+c.t*(i[p]-n[p]);if(So(a,l)<=o*o)return c.intersect=1,c}else{let p;if(c.t<0)return p=Rf(n,f,u,a),p.distance<=o*o&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=Rf(i,f,u,a),p.distance<=o*o&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,p=Rf(f,n,i,a),c.t=p.t,p.distance<=o*o&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,p=Rf(u,n,i,a),c.t=p.t,p.distance<=o*o&&(c.intersect=1),c}return c},t.evaluateLocation=(n,i,o)=>{const a=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=a[c]+n[0]*(s[c]-a[c]);o[0]=1-n[0],o[1]=n[0]},t.evaluateOrientation=(n,i,o)=>e.orientations?(Xp(i,e.orientations[0],e.orientations[1],n[0]),o[0]=1-n[0],o[1]=n[0],!0):!1}const eG={orientations:null};function XD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eG,r),Zu.extend(t,e,r),K.setGet(t,e,["orientations"]),QB(t,e)}const tG=K.newInstance(XD,"vtkLine");var Li={newInstance:tG,extend:XD,...ZB,...HD};const{vtkErrorMacro:cS,vtkWarningMacro:nG}=K;function rG(t,e){e.classHierarchy.push("vtkFieldData");const r=t.getState;e.arrays&&(e.arrays=e.arrays.map(n=>({data:Ea(n.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=n=>{t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(i=>i),e.arrays=n.getArrays().map(i=>({data:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=n=>{const i=n.getName(),{array:o,index:a}=t.getArrayWithIndex(i);return o!=null?(e.arrays[a]={data:n},a):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=n=>{const i=e.arrays.findIndex(o=>o.data.getName()===n);return t.removeArrayByIndex(i)},t.removeArrayByIndex=n=>n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1,t.getArrays=()=>e.arrays.map(n=>n.data),t.getArray=n=>typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n),t.getArrayByName=n=>e.arrays.reduce((i,o,a)=>o.data.getName()===n?o.data:i,null),t.getArrayWithIndex=n=>{const i=e.arrays.findIndex(o=>o.data.getName()===n);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=n=>n>=0&&n<e.arrays.length?e.arrays[n].data:null,t.hasArray=n=>t.getArrayWithIndex(n).index>=0,t.getArrayName=n=>{const i=e.arrays[n];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=n=>e.copyFieldFlags[n],t.passData=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(a=>{const s=t.getFlag(a.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&a){let c=t.getArrayByName(a.getName());if(c)if(a.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<a.getNumberOfTuples()){const l=o>-1?o:i;c.insertTuple(l,a.getTuple(i))}else c.insertTuples(0,a.getTuples());else cS("Unhandled case in passData");else if(i<0||i>a.getNumberOfTuples())t.addArray(a),n.getAttributes(a).forEach(l=>{t.setAttribute(a,l)});else{const l=a.getNumberOfComponents();let f=a.getNumberOfValues();const u=o>-1?o:i;f<=u*l&&(f=(u+1)*l),c=Tt.newInstance({name:a.getName(),dataType:a.getDataType(),numberOfComponents:l,values:K.newTypedArray(a.getDataType(),f),size:0}),c.insertTuple(u,a.getTuple(i)),t.addArray(c),n.getAttributes(a).forEach(d=>{t.setAttribute(c,d)})}}})},t.interpolateData=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let f=t.getArrayByName(c.getName());if(f)if(c.getNumberOfComponents()===f.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const u=a>-1?a:i;f.interpolateTuple(u,c,i,c,o,s),nG("Unexpected case in interpolateData")}else f.insertTuples(c.getTuples());else cS("Unhandled case in interpolateData");else if(i<0||o<0||i>c.getNumberOfTuples())t.addArray(c),n.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let d=c.getNumberOfValues();const h=a>-1?a:i;d<=h*u&&(d=(h+1)*u),f=Tt.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:K.newTypedArray(c.getDataType(),d),size:0}),f.interpolateTuple(h,c,i,c,o,s),t.addArray(f),n.getAttributes(c).forEach(g=>{t.setAttribute(f,g)})}}})},t.copyFieldOn=n=>{e.copyFieldFlags[n]=!0},t.copyFieldOff=n=>{e.copyFieldFlags[n]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=n=>{e.arrays=n.getArrays().map(i=>{const o=i.newClone();return o.deepCopy(i),{data:o}})},t.copyFlags=n=>n.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(n=>n.data.reset()),t.getMTime=()=>e.arrays.reduce((n,i)=>i.data.getMTime()>n?i.data.getMTime():n,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((n,i)=>n+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const n=r();return n&&(n.arrays=e.arrays.map(i=>({data:i.data.getState()}))),n}}const iG={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function qD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iG,r),K.obj(t,e),rG(t,e)}const oG=K.newInstance(qD,"vtkFieldData");var aG={newInstance:oG,extend:qD};const sG={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},cG={MAX:0,EXACT:1,NOLIMIT:2},lG={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},uG={DUPLICATEPOINT:1,HIDDENPOINT:2},fG={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},dG="vtkGhostType",Pm={DEFAULT:0,SINGLE:1,DOUBLE:2};var YD={AttributeCopyOperations:fG,AttributeLimitTypes:cG,AttributeTypes:sG,CellGhostTypes:lG,DesiredOutputPrecision:Pm,PointGhostTypes:uG,ghostArrayName:dG};const{AttributeTypes:tl,AttributeCopyOperations:su}=YD,{vtkWarningMacro:Hg}=K;function hG(t,e){const r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(a){let s=r.find(c=>tl[c.toUpperCase()]===a||typeof a!="number"&&c.toLowerCase()===a.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=a=>!0,t.setAttribute=(a,s)=>{const c=n(s);if(a&&c.toUpperCase()==="PEDIGREEIDS"&&!a.isA("vtkDataArray"))return Hg(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(a&&!t.checkNumberOfComponents(a,c))return Hg(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===a)return l;t.removeArrayByIndex(l)}return a?(l=t.addArray(a),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=a=>r.filter(s=>t[`get${s}`]()===a),t.setActiveAttributeByName=(a,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(a).index,s),t.setActiveAttributeByIndex=(a,s)=>{const c=n(s);if(a>=0&&a<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(a);if(!l.isA("vtkDataArray"))return Hg(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return Hg(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=a,t.modified(),a}return a===-1&&(e[`active${c}`]=a,t.modified()),-1},t.getActiveAttribute=a=>{const s=n(a);return t[`get${s}`]()},t.removeAllArrays=()=>{r.forEach(a=>{e[`active${a}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=a=>(a!==-1&&r.forEach(s=>{a===e[`active${s}`]?e[`active${s}`]=-1:a<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(a)),r.forEach(a=>{const s=`active${a}`;t[`get${a}`]=()=>t.getArrayByIndex(e[s]),t[`set${a}`]=c=>t.setAttribute(c,a),t[`setActive${a}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,a),t[`copy${a}Off`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[su.PASSDATA][tl[c]]=!1},t[`copy${a}On`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[su.PASSDATA][tl[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(su).filter(a=>a!=="ALLCOPY").forEach(a=>{e.copyAttributeFlags[su[a]]=Object.keys(tl).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[tl[c]]=!0,s),[])}),e.copyAttributeFlags[su.COPYTUPLE][tl.GLOBALIDS]=!1,e.copyAttributeFlags[su.INTERPOLATE][tl.GLOBALIDS]=!1,e.copyAttributeFlags[su.COPYTUPLE][tl.PEDIGREEIDS]=!1},t.initialize=K.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(a=>{!e.dataArrays[a].ref&&e.dataArrays[a].type==="vtkDataArray"&&t.addArray(Tt.newInstance(e.dataArrays[a]))});const o=t.shallowCopy;t.shallowCopy=(a,s)=>{o(a,s),e.arrays=a.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,s),{data:l}})},t.initializeAttributeCopyFlags()}const gG={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function JD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gG,r),aG.extend(t,e,r),K.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),hG(t,e)}const pG=K.newInstance(JD,"vtkDataSetAttributes");var lS={newInstance:pG,extend:JD,...YD};const mG={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},vG={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var yG={FieldDataTypes:mG,FieldAssociations:vG};const Md=["pointData","cellData","fieldData"];function wG(t,e){e.classHierarchy.push("vtkDataSet"),Md.forEach(i=>{e[i]?e[i]=Ea(e[i]):e[i]=lS.newInstance()}),t.computeBounds=()=>{if(e.modifiedTime&&e.computeTime&&e.modifiedTime>e.computeTime||!e.computeTime){const i=t.getPoints();i?.getNumberOfPoints()?hn.setBounds(e.bounds,i.getBoundsByReference()):e.bounds=pt.createUninitializedBounds(),e.computeTime=K.getCurrentGlobalMTime()}},t.getLength2=()=>{const i=t.getBoundsByReference();return!i||i.length!==6?0:hn.getDiagonalLength2(i)},t.getLength=()=>Math.sqrt(t.getLength2()),t.getCenter=()=>{const i=t.getBoundsByReference();return!i||i.length!==6?[0,0,0]:hn.getCenter(i)},t.getCellBounds=i=>{const o=t.getCell(i);return o?o.getBounds():pt.createUninitializedBounds()},t.getBounds=K.chain(()=>t.computeBounds,t.getBounds),t.getBoundsByReference=K.chain(()=>t.computeBounds,t.getBoundsByReference);const r=t.shallowCopy;t.shallowCopy=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,o),Md.forEach(a=>{e[a]=lS.newInstance(),e[a].shallowCopy(i.getReferenceByName(a))})};const n=t.getMTime;t.getMTime=()=>Md.reduce((i,o)=>Math.max(i,e[o]?.getMTime()??i),n()),t.initialize=()=>(Md.forEach(i=>e[i]?.initialize()),t)}const CG={};function ZD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CG,r),K.obj(t,e),K.setGet(t,e,Md),K.getArray(t,e,["bounds"],6),wG(t,e)}const xG=K.newInstance(ZD,"vtkDataSet");var A0={newInstance:xG,extend:ZD,...yG};function TG(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Ea(e.points):e.points=Ju.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const r=t.shallowCopy;t.shallowCopy=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(o,a),e.points=Ju.newInstance(),e.points.shallowCopy(o.getPoints())};const n=t.getMTime;t.getMTime=()=>{const o=n();return Math.max(o,e.points?.getMTime()??o)};const i=t.initialize;t.initialize=()=>(e.points?.initialize(),i())}const SG={};function QD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SG,r),A0.extend(t,e,r),K.setGet(t,e,["points"]),TG(t,e)}const _G=K.newInstance(QD,"vtkPointSet");var EG={newInstance:_G,extend:QD};function bG(t,e){e.classHierarchy.push("vtkPolyLine");const r=Li.newInstance();r.getPoints().setNumberOfPoints(2),t.getCellDimension=()=>1,t.intersectWithLine=(n,i,o,a,s,c,l)=>{const f={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null},u=t.getNumberOfPoints()-1;let d=Number.MAX_VALUE;for(let h=0;h<u;h++){const g=[0,0,0];r.getPoints().getData().set(e.points.getData().subarray(3*h,3*(h+2)));const p=r.intersectWithLine(o,a,s,c,l);if(p.intersect===1&&p.t<=f.t+s&&p.t>=n&&p.t<=i){f.intersect=1;const m=r.getParametricDistance(g);if(m<d||m===d&&p.t<f.t){f.subId=h,f.t=p.t,d=m;for(let w=0;w<3;w++)c[w],g[w]}}}return f},t.evaluateLocation=(n,i,o,a)=>(r.getPoints().getData().set(e.points.getData().subarray(3*n,3*(n+2))),r.evaluateLocation(i,o,a)),t.evaluateOrientation=(n,i,o,a)=>(e.orientations?r.setOrientations([e.orientations[n],e.orientations[n+1]]):r.setOrientations(null),r.evaluateOrientation(i,o,a)),t.getDistancesToFirstPoint=()=>{const n=e.distancesTime.getMTime();if(n<e.points.getMTime()||n<t.getMTime()){const i=t.getNumberOfPoints();if(e.distances?e.distances.length=i:e.distances=new Array(i),i>0){const o=new Array(3),a=new Array(3);let s=0;e.distances[0]=s,e.points.getPoint(0,o);for(let c=1;c<i;++c)e.points.getPoint(c,a),s+=e.distanceFunction(o,a),e.distances[c]=s,$1(o,a)}e.distancesTime.modified()}return e.distances},t.findPointIdAtDistanceFromFirstPoint=n=>{const i=t.getDistancesToFirstPoint();if(i.length<2)return-1;let o=0,a=i.length-1;if(n<i[o]||n>i[a]||i[a]===0)return-1;for(;a-o>1;){const s=Math.floor((o+a)/2);i[s]<=n?o=s:a=s}return o}}const DG={orientations:null,distanceFunction:sU};function e6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DG,r),Zu.extend(t,e,r),K.setGet(t,e,["orientations","distanceFunction"]),e.distancesTime={},K.obj(e.distancesTime,{mtime:0}),bG(t,e)}const IG=K.newInstance(e6,"vtkPolyLine");var MG={newInstance:IG,extend:e6};function OG(t,e){e.classHierarchy.push("vtkPriorityQueue"),t.push=(r,n)=>{const i=e.elements.findIndex(o=>o.priority>r);e.elements.splice(i,0,{priority:r,element:n})},t.pop=()=>e.elements.length>0?e.elements.shift().element:null,t.deleteById=r=>{e.elements=e.elements.filter(n=>{let{element:i}=n;return i.id!==r})},t.length=()=>e.elements.length}const PG={elements:[]};function t6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PG,r),K.obj(t,e),OG(t,e)}const RG=K.newInstance(t6,"vtkPriorityQueue");var AG={newInstance:RG,extend:t6};const Kg=1e-6,uS=11920929e-14,LG=1e-8,wu={FAILURE:-1,OUTSIDE:0,INSIDE:1,INTERSECTION:2,ON_LINE:3};function fS(t,e,r,n,i){return(n[t]-r[t])*(i[e]-r[e])-(i[t]-r[t])*(n[e]-r[e])}function NG(t,e,r,n){if(t[0]<r[0]||t[0]>r[1]||t[1]<r[2]||t[1]>r[3]||t[2]<r[4]||t[2]>r[5])return wu.OUTSIDE;if(Ro(n)<=uS)return wu.FAILURE;let i=LG*((r[1]-r[0])*(r[1]-r[0])+(r[3]-r[2])*(r[3]-r[2])+(r[5]-r[4])*(r[5]-r[4]));i*=i,i=i===0?uS:i;const o=[],a=[];for(let f=0;f<e.length;){if(o[0]=e[f++],o[1]=e[f++],o[2]=e[f++],So(t,o)<=i)return wu.INSIDE;const{distance:u,t:d}=Li.distanceToLine(t,o,a);if(u<=i&&d>0&&d<1)return wu.INSIDE}let s,c;Math.abs(n[0])>Math.abs(n[1])?Math.abs(n[0])>Math.abs(n[2])?(s=1,c=2):(s=0,c=1):Math.abs(n[1])>Math.abs(n[2])?(s=0,c=2):(s=0,c=1);let l=0;for(let f=0;f<e.length;)o[0]=e[f++],o[1]=e[f++],o[2]=e[f++],f<e.length?(a[0]=e[f],a[1]=e[f+1],a[2]=e[f+2]):(a[0]=e[0],a[1]=e[1],a[2]=e[2]),o[c]<=t[c]?a[c]>t[c]&&fS(s,c,o,a,t)>0&&++l:a[c]<=t[c]&&fS(s,c,o,a,t)<0&&--l;return l===0?wu.OUTSIDE:wu.INSIDE}function VG(t,e,r){const n=t.length,i=[];e.getPoint(t[0],i),r[0]=i[0],r[1]=i[0],r[2]=i[1],r[3]=i[1],r[4]=i[2],r[5]=i[2];for(let a=1;a<n;a++)e.getPoint(t[a],i),hn.addPoint(r,...i);const o=hn.getLengths(r);return jt(o,o)}function kG(t,e,r){r.length=3,r[0]=0,r[1]=0,r[2]=0;const n=[];let i=[],o=[];const a=[],s=[];e.getPoint(t[0],n),e.getPoint(t[1],i);for(let c=2;c<t.length;c++){e.getPoint(t[c],o),ei(o,i,a),ei(n,i,s);const l=[0,0,0];Qi(a,s,l),u0(r,l,r),[i,o]=[o,i]}return Ro(r)}function FG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];r[0]=0,r[1]=0,r[2]=0;const n=t.length,i=[];for(let o=0;o<n;o++)e.getPoint(t[o],i),r[0]+=i[0],r[1]+=i[1],r[2]+=i[2];return r[0]/=n,r[1]/=n,r[2]/=n,r}const UG={PolygonWithPointIntersectionState:wu,pointInPolygon:NG,getBounds:VG,getNormal:kG,computeCentroid:FG};function BG(t,e){e.classHierarchy.push("vtkPolygon");function r(){const s=[0,0,0],c=[0,0,0];e.normal=[0,0,0];const l=[...e.firstPoint.point];let f=e.firstPoint;for(let u=0;u<e.pointCount;u++){ei(f.point,l,s),ei(f.next.point,l,c);const d=[0,0,0];Qi(s,c,d),u0(e.normal,d,e.normal),f=f.next}return Ro(e.normal)}function n(s){const c=[0,0,0],l=[0,0,0],f=[0,0,0],u=[0,0,0];ei(s.point,s.previous.point,c),ei(s.next.point,s.point,l),ei(s.previous.point,s.next.point,f),Qi(c,l,u);const d=jt(u,e.normal);if(d<=0)return-1;const h=Do(c)+Do(l)+Do(f);return h*h/d}function i(s){if(e.pointCount<=3)return!0;const c=s.previous,l=s.next,f=[0,0,0];ei(l.point,c.point,f);const u=[0,0,0];if(Qi(f,e.normal,u),Ro(u),Do(u)===0)return!1;let d=tr.evaluate(u,c.point,l.next.point),h=d>Kg?1:d<-Kg?-1:0,g=h<0?1:0;for(let p=l.next.next;p.id!==c.id;p=p.next){const m=p.previous;d=tr.evaluate(u,c.point,p.point);const w=d>Kg?1:d<-Kg?-1:0;if(w!==h){if(g||(g=w<=0?1:0),Li.intersection(c.point,l.point,p.point,m.point,[0],[0])===jD.YES_INTERSECTION)return!1;h=w}}return g===1}function o(s,c){e.pointCount-=1;const l=s.previous,f=s.next;e.tris=e.tris.concat(s.point),e.tris=e.tris.concat(f.point),e.tris=e.tris.concat(l.point),l.next=f,f.previous=l,c.deleteById(l.id),c.deleteById(f.id);const u=n(l);u>0&&c.push(u,l);const d=n(f);d>0&&c.push(d,f),s.id===e.firstPoint.id&&(e.firstPoint=f)}function a(){r();const s=AG.newInstance();let c=e.firstPoint;for(let l=0;l<e.pointCount;l++){const f=n(c);f>0&&s.push(f,c),c=c.next}for(;e.pointCount>2&&s.length()>0;)if(e.pointCount===s.length()){const l=s.pop();o(l,s)}else{const l=s.pop();i(l)&&o(l,s)}return e.pointCount<=2}t.triangulate=()=>e.firstPoint?a():null,t.setPoints=s=>{e.pointCount=s.length,e.firstPoint={id:0,point:s[0],next:null,previous:null};let c=e.firstPoint;for(let l=1;l<e.pointCount;l++)c.next={id:l,point:s[l],next:null,previous:c},c=c.next;e.firstPoint.previous=c,c.next=e.firstPoint},t.getPointArray=()=>e.tris}const GG={firstPoint:null,pointCount:0,tris:[]};function n6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GG,r),K.obj(t,e),BG(t,e)}const WG=K.newInstance(n6,"vtkPolygon");var $G={newInstance:WG,extend:n6,...UG};function wC(t,e,r,n){const i=r[0]-e[0],o=r[1]-e[1],a=r[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];n[0]=o*l-a*c,n[1]=a*s-i*l,n[2]=i*c-o*s}function Ch(t,e,r,n){wC(t,e,r,n);const i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);i!==0&&(n[0]/=i,n[1]/=i,n[2]/=i)}function r6(t){t[0]=-1,t[1]=1,t[2]=0,t[3]=-1,t[4]=0,t[5]=1}function zG(t,e,r,n,i,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],l=[],f=[],u=[],d=[];Ch(t,e,r,u),Ch(n,i,o,d);const h=-jt(u,t),g=-jt(d,n),p=[jt(d,t)+g,jt(d,e)+g,jt(d,r)+g];if(p[0]*p[1]>a&&p[0]*p[2]>a)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const m=[jt(u,n)+h,jt(u,i)+h,jt(u,o)+h];if(m[0]*m[1]>a&&m[0]*m[2]>a)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Math.abs(u[0]-d[0])<1e-9&&Math.abs(u[1]-d[1])<1e-9&&Math.abs(u[2]-d[2])<1e-9&&Math.abs(h-g)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const w=[t,e,r],v=[n,i,o],y=jt(u,d),C=(h-g*y)/(y*y-1),x=(g-h*y)/(y*y-1),T=[C*u[0]+x*d[0],C*u[1]+x*d[1],C*u[2]+x*d[2]],S=Qi(u,d,[]);Ro(S);let _=0,E=0;const D=[],b=[];let I=50,O=50;for(let A=0;A<3;A++){const B=A,k=(A+1)%3,L=tr.intersectWithLine(w[B],w[k],n,d);L.intersection&&L.t>0-a&&L.t<1+a&&(L.t<1+a&&L.t>1-a&&(I=_),D[_++]=jt(L.x,S)-jt(T,S));const F=tr.intersectWithLine(v[B],v[k],t,u);F.intersection&&F.t>0-a&&F.t<1+a&&(F.t<1+a&&F.t>1-a&&(O=E),b[E++]=jt(F.x,S)-jt(T,S))}if(_>2){_--;const A=D[2];D[2]=D[I],D[I]=A}if(E>2){E--;const A=b[2];b[2]=b[O],b[O]=A}if(_!==2||E!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Number.isNaN(D[0])||Number.isNaN(D[1])||Number.isNaN(b[0])||Number.isNaN(b[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(D[0]>D[1]){const A=D[1];D[1]=D[0],D[0]=A}if(b[0]>b[1]){const A=b[1];b[1]=b[0],b[0]=A}let M,R;return D[1]<b[0]||b[1]<D[0]?{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f}:(D[0]<b[0]?D[1]<b[1]?(f[0]=2,f[1]=1,M=b[0],R=D[1]):(f[0]=2,f[1]=2,M=b[0],R=b[1]):D[1]<b[1]?(f[0]=1,f[1]=1,M=D[0],R=D[1]):(f[0]=1,f[1]=2,M=D[0],R=b[1]),qy(T,S,M,c),qy(T,S,R,l),{intersect:!0,coplanar:s,pt1:c,pt2:l,surfaceId:f})}const jG={computeNormalDirection:wC,computeNormal:Ch,interpolationDerivs:r6,intersectWithTriangle:zG};function HG(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(r,n,i,o,a)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};a[2]=0;const c=[],l=i*i,f=[],u=[],d=[];e.points.getPoint(0,f),e.points.getPoint(1,u),e.points.getPoint(2,d);const h=[],g=[];if(Ch(f,u,d,h),h[0]!==0||h[1]!==0||h[2]!==0){const y=tr.intersectWithLine(r,n,f,h);if(s.betweenPoints=y.betweenPoints,s.t=y.t,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],!y.intersection)return a[0]=0,a[1]=0,s.intersect=0,s;const C=t.evaluatePosition(o,c,a,g);if(C.evaluation>=0)return C.dist2<=l?(s.intersect=1,s):(s.intersect=C.evaluation,s)}const p=So(f,u),m=So(u,d),w=So(d,f);e.line||(e.line=Li.newInstance()),p>m&&p>w?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,u)):m>w&&m>p?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,d)):(e.line.getPoints().setPoint(0,d),e.line.getPoints().setPoint(1,f));const v=e.line.intersectWithLine(r,n,i,o,a);if(s.betweenPoints=v.betweenPoints,s.t=v.t,v.intersect){const y=[],C=[],x=[];for(let T=0;T<3;T++)y[T]=f[T]-d[T],C[T]=u[T]-d[T],x[T]=o[T]-d[T];return a[0]=jt(x,y)/w,a[1]=jt(x,C)/m,s.intersect=1,s}return a[0]=0,a[1]=0,s.intersect=0,s},t.evaluatePosition=(r,n,i,o)=>{const a={subId:0,dist2:0,evaluation:-1};let s,c;const l=[],f=[],u=[],d=[];let h;const g=[],p=[],m=[];let w=0,v=0;const y=[];let C,x,T,S=[];const _=[],E=[],D=[];a.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,f),e.points.getPoint(0,u),wC(l,f,u,d),tr.generalizedProjectPoint(r,l,d,D);let b=0;for(s=0;s<3;s++)d[s]<0?h=-d[s]:h=d[s],h>b&&(b=h,v=s);for(c=0,s=0;s<3;s++)s!==v&&(y[c++]=s);for(s=0;s<2;s++)g[s]=D[y[s]]-u[y[s]],p[s]=l[y[s]]-u[y[s]],m[s]=f[y[s]]-u[y[s]];if(w=xr(p,m),w===0)return i[0]=0,i[1]=0,a.evaluation=-1,a;if(i[0]=xr(g,m)/w,i[1]=xr(p,g)/w,o[0]=1-(i[0]+i[1]),o[1]=i[0],o[2]=i[1],o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1&&o[2]>=0&&o[2]<=1)n&&(a.dist2=So(D,r),n[0]=D[0],n[1]=D[1],n[2]=D[2]),a.evaluation=1;else{let I;if(n){if(o[1]<0&&o[2]<0)for(C=So(r,u),x=Li.distanceToLine(r,l,u,I,_),T=Li.distanceToLine(r,u,f,I,E),C<x?(a.dist2=C,S=u):(a.dist2=x,S=_),T<a.dist2&&(a.dist2=T,S=E),s=0;s<3;s++)n[s]=S[s];else if(o[2]<0&&o[0]<0)for(C=So(r,l),x=Li.distanceToLine(r,l,u,I,_),T=Li.distanceToLine(r,l,f,I,E),C<x?(a.dist2=C,S=l):(a.dist2=x,S=_),T<a.dist2&&(a.dist2=T,S=E),s=0;s<3;s++)n[s]=S[s];else if(o[1]<0&&o[0]<0)for(C=So(r,f),x=Li.distanceToLine(r,f,u,I,_),T=Li.distanceToLine(r,l,f,I,E),C<x?(a.dist2=C,S=f):(a.dist2=x,S=_),T<a.dist2&&(a.dist2=T,S=E),s=0;s<3;s++)n[s]=S[s];else if(o[0]<0){const O=Li.distanceToLine(r,l,f,n);a.dist2=O.distance}else if(o[1]<0){const O=Li.distanceToLine(r,f,u,n);a.dist2=O.distance}else if(o[2]<0){const O=Li.distanceToLine(r,l,u,n);a.dist2=O.distance}}a.evaluation=0}return a},t.evaluateLocation=(r,n,i)=>{const o=[],a=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,a),e.points.getPoint(2,s);const c=1-r[0]-r[1];for(let l=0;l<3;l++)n[l]=o[l]*c+a[l]*r[0]+s[l]*r[1];i[0]=c,i[1]=r[0],i[2]=r[1]},t.getParametricDistance=r=>{let n,i=0;const o=[];o[0]=r[0],o[1]=r[1],o[2]=1-r[0]-r[1];for(let a=0;a<3;a++)o[a]<0?n=-o[a]:o[a]>1?n=o[a]-1:n=0,n>i&&(i=n);return i},t.derivatives=(r,n,i,o,a)=>{const s=e.points.getPoint(0),c=e.points.getPoint(1),l=e.points.getPoint(2),f=[],u=[],d=[],h=[];Ch(s,c,l,f),ei(c,s,u),ei(l,s,h),Qi(f,u,d);const g=Ro(u);if(g<=0||Ro(d)<=0){for(let x=0;x<o;x++)for(let T=0;T<3;T++)a[x*o+T]=0;return}const p=[0,0],m=[g,0],w=[jt(h,u),jt(h,d)],v=new Array(6);r6(v);const y=[m[0]-p[0],m[1]-p[1],w[0]-p[0],w[1]-p[1]],C=K.newTypedArray(xi.Float64Array,4);Ww(y,C,2);for(let x=0;x<o;x++){let T=0,S=0;for(let D=0;D<3;D++)T+=v[D]*i[o*D+x],S+=v[3+D]*i[o*D+x];const _=T*C[0]+S*C[1],E=T*C[2]+S*C[3];a[3*x]=_*u[0]+E*d[0],a[3*x+1]=_*u[1]+E*d[1],a[3*x+2]=_*u[2]+E*d[2]}},t.cellBoundary=(r,n,i)=>{const o=n[0]-n[1],a=.5*(1-n[0])-n[1],s=2*n[0]+n[1]-1;return o>=0&&a>=0?(i[0]=e.pointsIds[0],i[1]=e.pointsIds[1]):a<0&&s>=0?(i[0]=e.pointsIds[1],i[1]=e.pointsIds[2]):(i[0]=e.pointsIds[2],i[1]=e.pointsIds[0]),!(n[0]<0||n[1]<0||n[0]>1||n[1]>1||1-n[0]-n[1]<0)}}const KG={};function i6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KG,r),Zu.extend(t,e,r),HG(t,e)}const XG=K.newInstance(i6,"vtkTriangle");var X1={newInstance:XG,extend:i6,...jG};function dS(){return{intersected:!1,subId:-1,x:[0,0,0],pCoords:[0,0,0],t:-1}}function qG(t,e){e.classHierarchy.push("vtkQuad"),t.getCellDimension=()=>2,t.getCellType=()=>Un.VTK_QUAD,t.getNumberOfEdges=()=>4,t.getNumberOfFaces=()=>0,t.intersectWithLine=(r,n,i,o,a)=>{let s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1},c;const l=e.points.getPoint(0,[]),f=e.points.getPoint(1,[]),u=e.points.getPoint(2,[]),d=e.points.getPoint(3,[]),h=So(l,u),g=So(f,d);if(h===g){let T,S=0,_=0;for(let E=0;E<4;E++)T=e.pointsIds[E],T>S&&(S=T,_=E);_===0||_===2?c=0:c=1}else h<g?c=0:c=1;let p=null;e.triangle?p=e.triangle.getPoints():(e.triangle=X1.newInstance(),p=Ju.newInstance(),p.setNumberOfPoints(3),e.triangle.initialize(p));let m;const w=dS();let v;const y=dS();let C,x;switch(c){case 0:p.setPoint(0,...l),p.setPoint(1,...f),p.setPoint(2,...u),m=e.triangle.intersectWithLine(r,n,i,w.x,w.pCoords),p.setPoint(0,...u),p.setPoint(1,...d),p.setPoint(2,...l),v=e.triangle.intersectWithLine(r,n,i,y.x,y.pCoords),C=m.intersect&&v.intersect?m.t<=v.t:m.intersect,x=m.intersect&&v.intersect?v.t<m.t:v.intersect,C?(s=m,o[0]=w.x[0],o[1]=w.x[1],o[2]=w.x[2],a[0]=w.pCoords[0]+w.pCoords[1],a[1]=w.pCoords[1],a[2]=w.pCoords[2]):x&&(s=v,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],a[0]=1-(y.pCoords[0]+y.pCoords[1]),a[1]=1-y.pCoords[1],a[2]=y.pCoords[2]);break;case 1:p.setPoint(0,...l),p.setPoint(1,...f),p.setPoint(2,...d),m=e.triangle.intersectWithLine(r,n,i,w.x,w.pCoords),p.setPoint(0,...u),p.setPoint(1,...d),p.setPoint(2,...f),v=e.triangle.intersectWithLine(r,n,i,y.x,y.pCoords),C=m.intersect&&v.intersect?m.t<=v.t:m.intersect,x=m.intersect&&v.intersect?v.t<m.t:v.intersect,C?(s=m,o[0]=w.x[0],o[1]=w.x[1],o[2]=w.x[2],a[0]=w.pCoords[0],a[1]=w.pCoords[1],a[2]=w.pCoords[2]):x&&(s=v,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],a[0]=1-y.pCoords[0],a[1]=1-y.pCoords[1],a[2]=y.pCoords[2]);break}return s},t.interpolationFunctions=(r,n)=>{const i=1-r[0],o=1-r[1];n[0]=i*o,n[1]=r[0]*o,n[2]=r[0]*r[1],n[3]=i*r[1]},t.evaluateLocation=(r,n,i)=>{const o=[];t.interpolationFunctions(r,i),n[0]=0,n[1]=0,n[2]=0;for(let a=0;a<4;a++){e.points.getPoint(a,o);for(let s=0;s<3;s++)n[s]+=o[s]*i[a]}}}const YG={};function o6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YG,r),Zu.extend(t,e,r),qG(t,e)}const JG=K.newInstance(o6,"vtkQuad");var ZG={newInstance:JG,extend:o6};const{vtkErrorMacro:a6}=K;function hS(t){return()=>a6(`vtkTriangleStrip.${t} - NOT IMPLEMENTED`)}function QG(t,e){if(!Array.isArray(t)||t.length<3){a6("decomposeStrip - Invalid points array");return}let r=t[0],n=t[1];for(let i=0;i<t.length-2;i++){const o=t[i+2];i%2?e.insertNextCell([n,r,o]):e.insertNextCell([r,n,o]),r=n,n=o}}const eW={decomposeStrip:QG};function tW(t,e){e.classHierarchy.push("vtkTriangleStrip");const r=t.initialize;t.initialize=(n,i)=>{e.triangle.initialize(n,i),r(n,i)},t.getCellType=()=>Un.VTK_TRIANGLE_STRIP,t.getCellDimension=()=>2,t.getNumberOfEdges=()=>e.pointsIds.length,t.getNumberOfFaces=()=>0,t.evaluatePosition=(n,i,o,a,s)=>{const c=[0,0,0];let l=Number.MAX_VALUE,f=0;const u=[],d=[],h=[];o[2]=0,d[0]=0,d[1]=0,d[2]=0;const g=e.triangle.getPoints();g.setNumberOfPoints(3);const m=e.triangle.getPointsIds().length;for(let w=0;w<m;w++)s[w]=0;for(let w=0;w<m-2;w++){const v=[];g.getPoint(w,v);const y=[];g.getPoint(w+1,y);const C=[];g.getPoint(w+2,C),g.setData(Float32Array.from([...v,...y,...C]),3);const x=e.triangle.evaluatePosition(n,h,c,u),T=x.dist2;x.evaluation>=0&&(T<l||T===l&&f===0)&&(f=x,i&&(i[0]=h[0],i[1]=h[1],i[2]=h[2]),o[0]=c[0],o[1]=c[1],l=T,d[0]=u[0],d[1]=u[1],d[2]=u[2])}return a[0]=l,s[0]=d[0],s[1]=d[1],s[2]=d[2],f},t.evaluateLocation=(n,i,o,a)=>{const s=[[0,1,2],[1,0,2]],c=n%2,l=e.pointsIds.length;for(let g=0;g<l;g++)a[g]=0;const f=1-i[0]-i[1];a[n]=f,a[n+1]=i[0],a[n+2]=i[1];const u=[];e.points.getPoint(n+s[c][0],u);const d=[];e.points.getPoint(n+s[c][1],d);const h=[];e.points.getPoint(n+s[c][2],h);for(let g=0;g<3;g++)o[g]=u[g]*a[n]+d[g]*a[n+1]+h[g]*a[n+2]},t.cellBoundary=(n,i,o)=>{const a=[[0,1,2],[1,0,2]],s=n%2,c=e.triangle.getPointsIds();return c[0]=e.pointsIds[a[s][0]],c[1]=e.pointsIds[a[s][1]],c[2]=e.pointsIds[a[s][2]],e.triangle.cellBoundary(0,i,o)},t.getEdge=n=>{let i,o;const a=e.pointsIds.length;return n===0?(i=0,o=1):n===a-1?(i=n-1,o=n):(i=n-1,o=n+1),e.line.getPointsIds()[0]=e.pointsIds[i],e.line.getPointsIds()[1]=e.pointsIds[o],e.line.getPoints().setPoint(0,e.points.getPoint(i)),e.line.getPoints().setPoint(1,e.points.getPoint(o)),e.line},t.intersectWithLine=(n,i,o,a,s)=>{const c=e.pointsIds.length-2,l=e.triangle.getPoints();l.setNumberOfPoints(3);for(let f=0;f<c;f++){const u=[];e.points.getPoint(e.pointsIds[f],u);const d=[];e.points.getPoint(e.pointsIds[f+1],d);const h=[];e.points.getPoint(e.pointsIds[f+2],h),l.setData(Float32Array.from([...u,...d,...h]),3);const g=e.triangle.intersectWithLine(n,i,o,a,s);if(g.intersect)return g}return!1},t.triangulate=()=>{const n=e.points.getNumberOfPoints()-2;e.tris=new Array(3*n);const i=[[0,1,2],[1,0,2]];for(let o=0;o<n;o++){const a=o%2;for(let s=0;s<3;s++)e.tris[o*3+s]=o+i[a][s]}return!0},t.getPointArray=()=>e.tris,t.derivatives=(n,i,o,a,s)=>{const c=[];e.points.getPoint(n,c);const l=[];e.points.getPoint(n+1,l);const f=[];e.points.getPoint(n+2,f);const u=e.triangle.getPoints();u.setPoint(0,...c),u.setPoint(1,...l),u.setPoint(2,...f),e.triangle.derivatives(0,i,o,a,s)},t.getParametricCenter=n=>(n[0]=.333333,n[1]=.333333,n[2]=0,Math.floor((e.pointsIds.length-2)/2)),t.contour=(n,i,o,a,s,c,l,f,u,d,h)=>hS("contour")(),t.clip=(n,i,o,a,s,c,l,f,u,d)=>hS("clip")()}const nW={line:null,triangle:null,tris:null};function s6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nW,r),Zu.extend(t,e,r),e.line||(e.line=Li.newInstance()),e.triangle||(e.triangle=X1.newInstance()),tW(t,e)}const rW=K.newInstance(s6,"vtkTriangleStrip");var iW={newInstance:rW,extend:s6,...eW};const pf=["verts","lines","polys","strips"],{vtkWarningMacro:gS}=K,oW={[Un.VTK_LINE]:Li,[Un.VTK_QUAD]:ZG,[Un.VTK_POLY_LINE]:Li,[Un.VTK_TRIANGLE]:X1,[Un.VTK_TRIANGLE_STRIP]:iW,[Un.VTK_POLY_LINE]:MG,[Un.VTK_POLYGON]:$G};function aW(t,e){e.classHierarchy.push("vtkPolyData");function r(s){return s.replace(/(?:^\w|[A-Z]|\b\w)/g,c=>c.toUpperCase()).replace(/\s+/g,"")}function n(){e.cells=void 0,e.links=void 0}pf.forEach(s=>{t[`getNumberOf${r(s)}`]=()=>e[s].getNumberOfCells(),e[s]?e[s]=Ea(e[s]):e[s]=Ml.newInstance(),e[`_on${r(s)}Changed`]=n}),t.getNumberOfCells=()=>pf.reduce((s,c)=>s+e[c].getNumberOfCells(),0);const i=t.shallowCopy;t.shallowCopy=function(s){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;i(s,c),pf.forEach(l=>{e[l]=Ml.newInstance(),e[l].shallowCopy(s.getReferenceByName(l))})};const o=t.getMTime;t.getMTime=()=>pf.reduce((s,c)=>Math.max(s,e[c]?.getMTime()??s),o());const a=t.initialize;t.initialize=()=>(pf.forEach(s=>e[s]?.initialize()),n(),a()),t.buildCells=()=>{const s=t.getNumberOfVerts(),c=t.getNumberOfLines(),l=t.getNumberOfPolys(),f=t.getNumberOfStrips(),u=s+c+l+f,d=new Uint8Array(u);let h=d;const g=new Uint32Array(u);let p=g;if(s){let m=0;e.verts.getCellSizes().forEach((w,v)=>{p[v]=m,h[v]=w>1?Un.VTK_POLY_VERTEX:Un.VTK_VERTEX,m+=w+1}),p=p.subarray(s),h=h.subarray(s)}if(c){let m=0;e.lines.getCellSizes().forEach((w,v)=>{p[v]=m,h[v]=w>2?Un.VTK_POLY_LINE:Un.VTK_LINE,w===1&&gS("Building VTK_LINE ",v," with only one point, but VTK_LINE needs at least two points. Check the input."),m+=w+1}),p=p.subarray(c),h=h.subarray(c)}if(l){let m=0;e.polys.getCellSizes().forEach((w,v)=>{switch(p[v]=m,w){case 3:h[v]=Un.VTK_TRIANGLE;break;case 4:h[v]=Un.VTK_QUAD;break;default:h[v]=Un.VTK_POLYGON;break}w<3&&gS("Building VTK_TRIANGLE ",v," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),m+=w+1}),p+=p.subarray(l),h+=h.subarray(l)}if(f){let m=0;h.fill(Un.VTK_TRIANGLE_STRIP,0,f),e.strips.getCellSizes().forEach((w,v)=>{p[v]=m,m+=w+1})}e.cells=JB.newInstance(),e.cells.setCellTypes(u,d,g)},t.buildLinks=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells==null&&t.buildCells(),e.links=WB.newInstance(),s>0?e.links.allocate(s):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=s=>e.cells.getCellType(s),t.getCellPoints=s=>{const c=t.getCellType(s);let l=null;switch(c){case Un.VTK_VERTEX:case Un.VTK_POLY_VERTEX:l=e.verts;break;case Un.VTK_LINE:case Un.VTK_POLY_LINE:l=e.lines;break;case Un.VTK_TRIANGLE:case Un.VTK_QUAD:case Un.VTK_POLYGON:l=e.polys;break;case Un.VTK_TRIANGLE_STRIP:l=e.strips;break;default:return l=null,{type:0,cellPointIds:null}}const f=e.cells.getCellLocation(s),u=l.getCell(f);return{cellType:c,cellPointIds:u}},t.getPointCells=s=>e.links.getCells(s),t.getCellEdgeNeighbors=(s,c,l)=>{const f=e.links.getLink(c),u=e.links.getLink(l);return f.cells.filter(d=>d!==s&&u.cells.indexOf(d)!==-1)},t.getCell=function(s){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const l=t.getCellPoints(s),f=c||oW[l.cellType].newInstance();return f.initialize(t.getPoints(),l.cellPointIds),f},t.getMaxCellSize=()=>pf.reduce((s,c)=>Math.max(s,e[c]?.getMaxCellSize?.()??0),0)}const sW={};function c6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sW,r),EG.extend(t,e,r),K.get(t,e,["cells","links"]),K.setGet(t,e,["verts","lines","polys","strips"]),aW(t,e)}const cW=K.newInstance(c6,"vtkPolyData");var rr={newInstance:cW,extend:c6};const{vtkErrorMacro:lW}=K;class uW{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const r=e[0],n=e[e.length-1];if(r===n||e.length<2)return;const i=this.segmentMapping[r],o=this.segmentMapping[n];if(i!==void 0&&o!==void 0)if(Math.abs(i)===Math.abs(o)){const a=i<o?o:i,s=this.segments[a];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[a]=null,this.segmentMapping[r]=void 0,this.segmentMapping[n]=void 0}else{const a=Math.abs(i),s=Math.abs(o),c=this.segments[a],l=this.segments[s];this.segments[a]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const a=this.segments[i];for(let s=1;s<e.length;s++)a.push(e[s]);this.segmentMapping[n]=i}else{const a=this.segments[-i];this.segmentMapping[n]=i;for(let s=1;s<e.length;s++)a.unshift(e[s])}this.segmentMapping[r]=void 0}else if(o!==void 0){if(o>0){const a=this.segments[o];for(let s=1;s<e.length;s++)a.push(e[e.length-1-s]);this.segmentMapping[r]=o}else{const a=this.segments[-o];this.segmentMapping[r]=o;for(let s=1;s<e.length;s++)a.unshift(e[e.length-s-1])}this.segmentMapping[n]=void 0}else{const a=this.segments.length;this.segments.push(e),this.segmentMapping[r]=-a,this.segmentMapping[n]=a}}}function fW(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(r,n)=>{const i=r[0];if(!i){lW("Invalid or missing input");return}const o=n[0]?.initialize()||rr.newInstance();o.shallowCopy(i);const a=new uW,s=i.getLines().getData();let c=0;for(;c<s.length;){const d=s[c++],h=[];for(let g=0;g<d;g++)h.push(s[c+g]);a.addSegment(h),c+=d}const{faces:l}=a;let f=l.length;for(let d=0;d<l.length;d++)f+=l[d].length;const u=new Uint16Array(f);c=0;for(let d=0;d<l.length;d++){const h=l[d];u[c++]=h.length;for(let g=0;g<h.length;g++)u[c++]=h[g]}o.setPolys(Ml.newInstance({values:u,name:"faces"})),n[0]=o}}const dW={};function l6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dW,r),K.obj(t,e),K.algo(t,e,1,1),fW(t,e)}const hW=K.newInstance(l6,"vtkClosedPolyLineToSurfaceFilter");var gW={newInstance:hW,extend:l6};const{vtkErrorMacro:pS}=_i;function pW(t){const e=t.getPolys().getData(),r=t.getStrips().getData(),n={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(n.polyIdx<e.length){n.cellSize=e[n.polyIdx];const i=n.polyIdx+1,o=i+n.cellSize;n.polyIdx=o;let a=0;for(let s=i;s<o;++s)n.cell[a++]=e[s]}else if(n.stripIdx<r.length){n.cellSize=3,n.remainingStripLength===0&&(n.remainingStripLength=r[n.stripIdx]-2,n.stripIdx+=3);const i=n.stripIdx-2,o=n.stripIdx+1;n.stripIdx++,n.remainingStripLength--;let a=0;for(let s=i;s<o;++s)n.cell[a++]=r[s]}else if(!n.done)n.done=!0;else throw new Error("Iterator is done")}};return n.next(),n}function mW(t,e){e.classHierarchy.push("vtkCutter");const r={...t};t.getMTime=()=>{let i=r.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function n(i,o){const a=i.getPoints(),s=a.getData(),c=i.getPointData(),l=a.getNumberOfPoints(),f=[],u=[],d=[],h={},g=c.getNumberOfArrays();for(let S=0;S<g;S++)h[c.getArrayName(S)]=[];(!e.cutScalars||e.cutScalars.length<l)&&(e.cutScalars=new Float32Array(l));let p=0,m=0;for(;p<s.length;)e.cutScalars[m++]=e.cutFunction.evaluateFunction(s[p++],s[p++],s[p++]);const w=[],v=new Array(3),y=new Array(3),C=[];for(const S=pW(i);!S.done;S.next()){if(S.cellSize<=2)continue;for(let I=0;I<S.cellSize;)C[I]=e.cutScalars[S.cell[I++]];const _=C[0]>0;let E=!0;for(let I=1;I<S.cell.length;I++)if(C[I]>0!==_){E=!1;break}if(E)continue;const D=[];for(let I=0;I<S.cellSize;I++){const O=I+1===S.cellSize?0:I+1,M=C[I]>0;if(C[O]>0===M)continue;let A=I,B=O,k=C[B]-C[A];k<=0&&(A=O,B=I,k*=-1);let L=0;k!==0&&(L=(e.cutValue-C[A])/k);const F=S.cell[A],j=S.cell[B];v[0]=s[F*3],v[1]=s[F*3+1],v[2]=s[F*3+2],y[0]=s[j*3],y[1]=s[j*3+1],y[2]=s[j*3+2];const J=[v[0]+L*(y[0]-v[0]),v[1]+L*(y[1]-v[1]),v[2]+L*(y[2]-v[2])],ie={};for(let fe=0;fe<g;fe++){const ae=c.getArrayByIndex(fe),de=c.getArrayName(fe),we=ae.getData(),_e=ae.getNumberOfComponents(),Te=new Array(_e);for(let G=0;G<_e;G++){const P=we[_e*F+G],$=we[_e*j+G];Te.push(P+L*($-P))}ie[de]=Te}D.push({pointEdge1:F,pointEdge2:j,intersectedPoint:J,intersectedArrays:ie,newPointID:-1})}for(let I=0;I<D.length;I++){const O=D[I];let M=!1;for(let R=0;R<w.length;R++){const A=w[R],B=O.pointEdge1===A.pointEdge1&&O.pointEdge2===A.pointEdge2,k=O.intersectedPoint[0]===A.intersectedPoint[0]&&O.intersectedPoint[1]===A.intersectedPoint[1]&&O.intersectedPoint[2]===A.intersectedPoint[2];if(B||k){M=!0,D[I].newPointID=w[R].newPointID;break}}M||(f.push(O.intersectedPoint[0]),f.push(O.intersectedPoint[1]),f.push(O.intersectedPoint[2]),Object.keys(O.intersectedArrays).forEach(R=>{h[R].push(...O.intersectedArrays[R])}),D[I].newPointID=f.length/3-1,w.push(D[I]))}const b=D.length;b===2?u.push(b,D[0].newPointID,D[1].newPointID):b>2&&(d.push(b),D.forEach(I=>{d.push(I.newPointID)}))}o.getPoints().setData(F1(a.getDataType(),f),3);const T=o.getPointData();for(let S=0;S<g;S++){const _=c.getArrayName(S),E=Tt.newInstance({name:_,dataType:c.getArrayByIndex(S).getDataType(),values:h[_],numberOfComponents:c.getArrayByIndex(S).getNumberOfComponents()});T.addArray(E)}u.length!==0&&o.getLines().setData(Uint16Array.from(u)),d.length!==0&&o.getPolys().setData(Uint16Array.from(d))}t.requestData=(i,o)=>{const a=i[0];if(!a){pS("Invalid or missing input");return}if(!e.cutFunction){pS("Missing cut function");return}const s=o[0]?.initialize()||rr.newInstance();n(a,s),o[0]=s}}const vW={cutFunction:null,cutScalars:null,cutValue:0};function u6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vW,r),Zn(t,e),Pw(t,e,1,1),Er(t,e,["cutFunction","cutValue"]),mW(t,e)}const yW=On(u6,"vtkCutter");var wW={newInstance:yW,extend:u6};const mc={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var f6={ObjectType:mc};const{ObjectType:em}=f6,CW={};function xW(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(s){switch(s){case em.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case em.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case em.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let n=null,i=null,o=!0,a="";t.getType=()=>n,t.setType=s=>{n=s},t.getHandle=()=>i,t.isReady=()=>o===!1,t.generateBuffer=s=>{const c=r(s);return i===null&&(i=e.context.createBuffer(),n=s),r(n)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(r(n),i),e.context.bufferData(r(n),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,o=!1,!0):(a="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(r(n),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(r(n),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>a}const TW={objectType:em.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function d6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TW,r),K.obj(t,e),K.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),K.moveToProtected(t,e,["openGLRenderWindow"]),xW(t,e)}const SW=K.newInstance(d6);var gc={newInstance:SW,extend:d6,...CW,...f6};const h6={FLAT:0,GOURAUD:1,PHONG:2},li={POINTS:0,WIREFRAME:1,SURFACE:2},_W=h6;var g6={Shading:h6,Representation:li,Interpolation:_W};function CC(t){let e=0,r=0;for(let i=0;i<3;++i){const o=t.getRange(i),a=o[1]-o[0];e+=a*a;const s=.5*(o[1]+o[0]);r+=s*s}const n=e>0&&(Math.abs(r)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&r>1e6);if(n){const i=new Float64Array(3),o=new Float64Array(3);for(let a=0;a<3;++a){const s=t.getRange(a),c=s[1]-s[0];i[a]=.5*(s[1]+s[0]),o[a]=c>0?1/c:1}return{useShiftAndScale:n,coordShift:i,coordScale:o}}return{useShiftAndScale:n,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}const{vtkErrorMacro:mS}=K;function EW(t,e){const r=new Float64Array(3);Em(r,e);const n=new Float64Array(16);return A8(n,Tc(),t,r),n}function bW(t,e){return t===null||e===null?!1:!(QT(t,[0,0,0])&&QT(e,[1,1,1]))}function DW(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(mc.ARRAY_BUFFER),t.createVBO=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=o.points.getData();let c=null,l=null,f=null;const u=o.colors?o.colors.getNumberOfComponents():0,d=o.tcoords?o.tcoords.getNumberOfComponents():0;o.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=o.normals.getData()),o.customAttributes&&o.customAttributes.forEach(L=>{L&&(e.customData.push({data:L.getData(),offset:4*e.blockSize,components:L.getNumberOfComponents(),name:L.getName()}),e.blockSize+=L.getNumberOfComponents())}),o.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=d,e.blockSize+=d,l=o.tcoords.getData()),o.colors?(e.colorComponents=o.colors.getNumberOfComponents(),e.colorOffset=0,f=o.colors.getData(),e.colorBO||(e.colorBO=gc.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let h=0,g=0,p=0,m=0,w=0,v=0,y;const C={anythingToPoints(L,F,j,J){for(let ie=0;ie<L;++ie)y(F[j+ie],J)},linesToWireframe(L,F,j,J){for(let ie=0;ie<L-1;++ie)y(F[j+ie],J),y(F[j+ie+1],J)},polysToWireframe(L,F,j,J){if(L>2)for(let ie=0;ie<L;++ie)y(F[j+ie],J),y(F[j+(ie+1)%L],J)},stripsToWireframe(L,F,j,J){if(L>2){for(let ie=0;ie<L-1;++ie)y(F[j+ie],J),y(F[j+ie+1],J);for(let ie=0;ie<L-2;ie++)y(F[j+ie],J),y(F[j+ie+2],J)}},polysToSurface(L,F,j,J){for(let ie=0;ie<L-2;ie++)y(F[j+0],J),y(F[j+ie+1],J),y(F[j+ie+2],J)},stripsToSurface(L,F,j,J){for(let ie=0;ie<L-2;ie++)y(F[j+ie],J),y(F[j+ie+1+ie%2],J),y(F[j+ie+1+(ie+1)%2],J)}},x={anythingToPoints(L,F){return L},linesToWireframe(L,F){return L>1?(L-1)*2:0},polysToWireframe(L,F){return L>2?L*2:0},stripsToWireframe(L,F){return L>2?L*4-6:0},polysToSurface(L,F){return L>2?(L-2)*3:0},stripsToSurface(L,F,j){return L>2?(L-2)*3:0}};let T=null,S=null;i===li.POINTS||n==="verts"?(T=C.anythingToPoints,S=x.anythingToPoints):i===li.WIREFRAME||n==="lines"?(T=C[`${n}ToWireframe`],S=x[`${n}ToWireframe`]):(T=C[`${n}ToSurface`],S=x[`${n}ToSurface`]);const _=r.getData(),E=_.length;let D=0;for(let L=0;L<E;)D+=S(_[L],_),L+=_[L]+1;let b=null;const I=new Float32Array(D*e.blockSize);f&&(b=new Uint8Array(D*4));let O=0,M=0;const{useShiftAndScale:R,coordShift:A,coordScale:B}=CC(o.points);if(R?t.setCoordShiftAndScale(A,B):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),a)if(!a.points&&!a.cells)a.points=new Int32Array(D),a.cells=new Int32Array(D);else{const L=new Int32Array(D+a.points.length);L.set(a.points),a.points=L;const F=new Int32Array(D+a.cells.length);F.set(a.cells),a.cells=F}let k=o.vertexOffset;y=function(F,j){if(a&&(a.points[k]=F,a.cells[k]=v+o.cellOffset),++k,h=F*3,e.coordShiftAndScaleEnabled?(I[O++]=(s[h++]-e.coordShift[0])*e.coordScale[0],I[O++]=(s[h++]-e.coordShift[1])*e.coordScale[1],I[O++]=(s[h++]-e.coordShift[2])*e.coordScale[2]):(I[O++]=s[h++],I[O++]=s[h++],I[O++]=s[h++]),c!==null&&(o.haveCellNormals?g=(v+o.cellOffset)*3:g=F*3,I[O++]=c[g++],I[O++]=c[g++],I[O++]=c[g++]),e.customData.forEach(J=>{w=F*J.components;for(let ie=0;ie<J.components;++ie)I[O++]=J.data[w++]}),l!==null){o.useTCoordsPerCell?p=j*d:p=F*d;for(let J=0;J<d;++J)I[O++]=l[p++]}f!==null&&(o.haveCellScalars?m=(v+o.cellOffset)*u:m=F*u,b[M++]=f[m++],b[M++]=f[m++],b[M++]=f[m++],b[M++]=u===4?f[m++]:255)};for(let L=0;L<E;L+=_[L]+1,v++)T(_[L],_,L+1,v+o.cellOffset);return e.elementCount=D,t.upload(I,mc.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(b,mc.ARRAY_BUFFER)),v},t.setCoordShiftAndScale=(r,n)=>{if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){mS("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){mS("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!o5(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!o5(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=bW(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=EW(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const IW={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function p6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IW,r),gc.extend(t,e,r),K.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),K.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),DW(t,e)}const MW=K.newInstance(p6);var OW={newInstance:MW,extend:p6};const{vtkErrorMacro:PW}=K;function RW(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return PW(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const AW={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function m6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AW,r),K.obj(t,e),K.setGet(t,e,["shaderType","source","error","handle","context"]),RW(t,e)}const LW=K.newInstance(m6,"vtkShader");var pv={newInstance:LW,extend:m6};const{vtkErrorMacro:es}=K;function NW(t,e,r,n){const i=typeof r=="string"?r:r.join(`
`),o=n===!1?e:new RegExp(e,"g"),a=t.replace(o,i);return{replace:a!==i,result:a}}function VW(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(es(e.error),0):t.link()?(t.setCompiled(!0),1):(es(`Links failed: ${e.error}`),0):(es(e.fragmentShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),es(e.fragmentShader.getError()),0):(es(e.vertexShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),es(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=r=>{e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const n=e.context.getProgramInfoLog(e.handle);return es(`Error linking shader ${n}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const o=new Float32Array(n);return e.context.uniformMatrix4fv(i,!1,o),!0},t.setUniformMatrix3x3=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const o=new Float32Array(n);return e.context.uniformMatrix3fv(i,!1,o),!0},t.setUniformf=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1f(i,n),!0)},t.setUniformfv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1fv(i,n),!0)},t.setUniformi=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1i(i,n),!0)},t.setUniformiv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1iv(i,n),!0)},t.setUniform2f=(r,n,i)=>{const o=t.findUniform(r);if(o===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(o,n,i),!0},t.setUniform2fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2fv(i,n),!0)},t.setUniform2i=(r,n,i)=>{const o=t.findUniform(r);if(o===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(o,n,i),!0},t.setUniform2iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2iv(i,n),!0)},t.setUniform3f=(r,n,i,o)=>{const a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(o===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n,i,o),!0},t.setUniform3fArray=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,n[0],n[1],n[2]),!0},t.setUniform3fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3fv(i,n),!0)},t.setUniform3i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,s[0],s[1],s[2]),!0},t.setUniform3iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3iv(i,n),!0)},t.setUniform4f=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4fv(i,n),!0)},t.setUniform4i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4iv(i,n),!0)},t.findUniform=r=>{if(!r||!e.linked)return-1;let n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error=`Uniform ${r} not found in current shader program.`,e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=r=>{if(!r)return!1;let n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):(es("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=r=>{if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return es("attempt to find uniform when the shader program is not linked"),!1;const n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=r=>{if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=r=>{if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=r=>{e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=r=>{e.lastCameraMTime=r}}const kW={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function v6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kW,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=pv.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=pv.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=pv.newInstance(),e.geometryShader.setShaderType("Geometry"),K.obj(t,e),K.get(t,e,["lastCameraMTime"]),K.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),VW(t,e)}const FW=K.newInstance(v6,"vtkShaderProgram");var Oe={newInstance:FW,extend:v6,substitute:NW};function UW(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,i.buffer);for(let o=0;o<i.attributes.length;++o){const a=i.attributes[o],s=a.isMatrix?a.size:1;for(let c=0;c<s;++c)r.enableVertexAttribArray(a.index+c),r.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,1):r.vertexAttribDivisor(a.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,i.buffer);for(let o=0;o<i.attributes.length;++o){const a=i.attributes[o],s=a.isMatrix?a.size:1;for(let c=0;c<s;++c)r.enableVertexAttribArray(a.index+c),r.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,0):r.vertexAttribDivisor(a.index+c,0)),r.disableVertexAttribArray(a.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(r,n,i,o,a,s,c,l)=>t.addAttributeArrayWithDivisor(r,n,i,o,a,s,c,l,0,!1),t.addAttributeArrayWithDivisor=(r,n,i,o,a,s,c,l,f,u)=>{if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==mc.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;const d=e.context,h={};if(h.name=i,h.index=d.getAttribLocation(e.handleProgram,i),h.offset=o,h.stride=a,h.type=s,h.size=c,h.normalize=l,h.isMatrix=u,h.divisor=f,h.Index===-1)return!1;if(n.bind(),d.enableVertexAttribArray(h.index),d.vertexAttribPointer(h.index,h.size,h.type,h.normalize,h.stride,h.offset),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h.index,1):d.vertexAttribDivisor(h.index,1)),h.buffer=n.getHandle(),!e.supported){let g=!1;for(let p=0;p<e.buffers.length;++p){const m=e.buffers[p];if(m.buffer===h.buffer){g=!0;let w=!1;for(let v=0;v<m.attributes.length;++v)m.attributes[v].name===i&&(w=!0,m.attributes[v]=h);w||m.attributes.push(h)}}g||e.buffers.push({buffer:h.buffer,attributes:[h]})}return!0},t.addAttributeMatrixWithDivisor=(r,n,i,o,a,s,c,l,f)=>{const u=t.addAttributeArrayWithDivisor(r,n,i,o,a,s,c,l,f,!0);if(!u)return u;const d=e.context,h=d.getAttribLocation(e.handleProgram,i);for(let g=1;g<c;g++)d.enableVertexAttribArray(h+g),d.vertexAttribPointer(h+g,c,s,l,a,o+a*g/c),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h+g,1):d.vertexAttribDivisor(h+g,1));return!0},t.removeAttributeArray=r=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];for(let o=0;o<i.attributes.length;++o)if(i.attributes[o].name===r)return i.attributes.splice(o,1),i.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const BW={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function y6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BW,r),e.buffers=[],K.obj(t,e),K.get(t,e,["supported"]),K.setGet(t,e,["forceEmulation"]),UW(t,e)}const GW=K.newInstance(y6,"vtkOpenGLVertexArrayObject");var q1={newInstance:GW,extend:y6};const os={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function WW(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=r=>{e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=r=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(r,n,i,o)=>{if(e.CABO.getElementCount()){const a=t.getOpenGLMode(i),s=t.haveWideLines(r,n),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),a===c.LINES&&s?(t.updateShaders(r,n,o),c.drawArraysInstanced(a,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(c.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,o),c.drawArrays(a,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(a===c.POINTS?1:0)||(a===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=r=>{if(e.pointPicking)return e.context.POINTS;const n=e.primitiveType;return r===li.POINTS||n===os.Points?e.context.POINTS:r===li.WIREFRAME||n===os.Lines||n===os.TrisEdges||n===os.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(r,n)=>n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(r,n,i)=>!!(i.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime()),t.updateShaders=(r,n,i)=>{if(t.getNeedToRebuildShaders(r,n,i)){const o={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(o,r,n);const a=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==t.getProgram()&&(t.setProgram(a),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,r,n),i.setPropertyShaderParameters(t,r,n),i.setCameraShaderParameters(t,r,n),i.setLightingShaderParameters(t,r,n),i.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=(r,n,i)=>{if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const o=parseFloat(n.getProperty().getLineWidth()),a=o/2;t.getProgram().setUniformf("lineWidthStepSize",o/Math.ceil(o)),t.getProgram().setUniformf("halfLineWidth",a)}e.primitiveType===os.Points||n.getProperty().getRepresentation()===li.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(r,n,i)=>{let o=r.Vertex;o=Oe.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,o=Oe.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,i)&&(o=Oe.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,o=Oe.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=o},t.getPointPickingPrimitiveSize=()=>e.primitiveType===os.Points?2:e.primitiveType===os.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const $W={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function w6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$W,r),K.obj(t,e),e.shaderSourceTime={},K.obj(e.shaderSourceTime),e.attributeUpdateTime={},K.obj(e.attributeUpdateTime),K.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=Oe.newInstance(),e.VAO=q1.newInstance(),e.CABO=OW.newInstance(),WW(t,e)}const zW=K.newInstance(w6);var Fa={newInstance:zW,extend:w6,primTypes:os};const jW=t=>t,vS=1e-6;let C6=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=_t(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?cF:jW}rotateFromDirections(e,r){const n=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16);co(n,e[0],e[1],e[2]),co(i,r[0],r[1],r[2]),At(n,n),At(i,i);const a=ft(n,i);return a>=1?this:(nn(this.tmp,n,i),_r(this.tmp)<vS&&(nn(this.tmp,[1,0,0],e),_r(this.tmp)<vS&&nn(this.tmp,[0,1,0],e)),Zw(o,Math.acos(a),this.tmp),Wt(this.matrix,this.matrix,o),this)}rotate(e,r){return co(this.tmp,...r),At(this.tmp,this.tmp),ci(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return qw(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return Yw(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return Jw(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,r,n){return co(this.tmp,e,r,n),Gn(this.matrix,this.matrix,this.tmp),this}scale(e,r,n){return co(this.tmp,e,r,n),ws(this.matrix,this.matrix,this.tmp),this}multiply(e){return Wt(this.matrix,this.matrix,e),this}multiply3x3(e){return Wt(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return gr(this.matrix,this.matrix),this}identity(){return _t(this.matrix),this}apply(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(f0(Vw,this.matrix))return this;const i=n===-1?e.length:r+n*3;for(let o=r;o<i;o+=3)co(this.tmp,e[o],e[o+1],e[o+2]),Pt(this.tmp,this.tmp,this.matrix),e[o]=this.tmp[0],e[o+1]=this.tmp[1],e[o+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&sr(this.matrix,e),this}};function HW(){return new C6(!0)}function KW(){return new C6(!1)}var ti={buildFromDegree:HW,buildFromRadian:KW};const XW=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],qW=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function YW(t,e){e.classHierarchy.push("vtkCubeSource"),t.requestData=(r,n)=>{const i=n[0]?.initialize()||rr.newInstance();n[0]=i;const o=24,a=K.newTypedArray(e.pointType,o*3);i.getPoints().setData(a,3);const s=K.newTypedArray(e.pointType,o*3),c=Tt.newInstance({name:"Normals",values:s,numberOfComponents:3});i.getPointData().setNormals(c);let l=2;e.generate3DTextureCoordinates===!0&&(l=3);const f=K.newTypedArray(e.pointType,o*l),u=Tt.newInstance({name:"TextureCoordinates",values:f,numberOfComponents:l});i.getPointData().setTCoords(u);const d=[0,0,0],h=[0,0,0],g=[0,0];let p=0;d[0]=-e.xLength/2,h[0]=-1,h[1]=0,h[2]=0;for(let m=0;m<2;m++){d[1]=-e.yLength/2;for(let w=0;w<2;w++){g[1]=d[1]+.5,d[2]=-e.zLength/2;for(let v=0;v<2;v++)g[0]=(d[2]+.5)*(1-2*m),a[p*3]=d[0],a[p*3+1]=d[1],a[p*3+2]=d[2],s[p*3]=h[0],s[p*3+1]=h[1],s[p*3+2]=h[2],l===2?(f[p*l]=g[0],f[p*l+1]=g[1]):(f[p*l]=2*m-1,f[p*l+1]=2*w-1,f[p*l+2]=2*v-1),p++,d[2]+=e.zLength;d[1]+=e.yLength}d[0]+=e.xLength,h[0]+=2}d[1]=-e.yLength/2,h[1]=-1,h[0]=0,h[2]=0;for(let m=0;m<2;m++){d[0]=-e.xLength/2;for(let w=0;w<2;w++){g[0]=(d[0]+.5)*(2*m-1),d[2]=-e.zLength/2;for(let v=0;v<2;v++)g[1]=(d[2]+.5)*-1,a[p*3]=d[0],a[p*3+1]=d[1],a[p*3+2]=d[2],s[p*3]=h[0],s[p*3+1]=h[1],s[p*3+2]=h[2],l===2?(f[p*l]=g[0],f[p*l+1]=g[1]):(f[p*l]=2*w-1,f[p*l+1]=2*m-1,f[p*l+2]=2*v-1),p++,d[2]+=e.zLength;d[0]+=e.xLength}d[1]+=e.yLength,h[1]+=2}d[2]=-e.zLength/2,h[2]=-1,h[0]=0,h[1]=0;for(let m=0;m<2;m++){d[1]=-e.yLength/2;for(let w=0;w<2;w++){g[1]=d[1]+.5,d[0]=-e.xLength/2;for(let v=0;v<2;v++)g[0]=(d[0]+.5)*(2*m-1),a[p*3]=d[0],a[p*3+1]=d[1],a[p*3+2]=d[2],s[p*3]=h[0],s[p*3+1]=h[1],s[p*3+2]=h[2],l===2?(f[p*l]=g[0],f[p*l+1]=g[1]):(f[p*l]=2*v-1,f[p*l+1]=2*w-1,f[p*l+2]=2*m-1),p++,d[0]+=e.xLength;d[1]+=e.yLength}d[2]+=e.zLength,h[2]+=2}if(e.rotations&&ti.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(a).apply(s),e.center&&ti.buildFromRadian().translate(...e.center).apply(a),e.matrix){ti.buildFromRadian().setMatrix(e.matrix).apply(a);const m=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];ti.buildFromRadian().setMatrix(m).apply(s)}e.generateFaces?i.getPolys().deepCopy(e._polys):i.getPolys().initialize(),e.generateLines?(i.getLines().deepCopy(e._lineCells),i.getPointData().setNormals(null)):i.getLines().initialize(),i.modified()},t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let n=0;n<arguments.length;n++)r.push(n<0||arguments.length<=n?void 0:arguments[n]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))}}const JW={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function x6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JW,r),K.obj(t,e),K.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),K.setGetArray(t,e,["center","rotations"],3),K.setGetArray(t,e,["matrix"],16),e._polys=Ml.newInstance({values:Uint16Array.from(qW)}),e._lineCells=Ml.newInstance({values:Uint16Array.from(XW)}),K.moveToProtected(t,e,["polys","lineCells"]),K.algo(t,e,0,1),YW(t,e)}const ZW=K.newInstance(x6,"vtkCubeSource");var T6={newInstance:ZW,extend:x6};const{vtkErrorMacro:yS}=K;function QW(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const r={...t};t.requestData=(n,i)=>{const o=n[0];if(!o||!o.isA("vtkImageData")){yS("Invalid or missing input");return}const a=o.getSpatialExtent();if(!a){yS("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(a),e._cubeSource.setMatrix(o.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(r.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const e$={};function S6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,e$,r),K.obj(t,e),K.algo(t,e,1,1),e._cubeSource=T6.newInstance(),K.moveToProtected(t,e,["cubeSource","tmpOut"]),QW(t,e)}const t$=K.newInstance(S6,"vtkImageDataOutlineFilter");var n$={newInstance:t$,extend:S6};const xh={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Mt={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var _6={Wrap:xh,Filter:Mt};const E6=new Float32Array(1),r$=new Int32Array(E6.buffer);function i$(t){E6[0]=t;const e=r$[0];let r=e>>16&32768,n=e>>12&2047;const i=e>>23&255;return i<103?r:i>142?(r|=31744,r|=(i===255?0:1)&&e&8388607,r):i<113?(n|=2048,r|=(n>>114-i)+(n>>113-i&1),r):(r|=i-112<<10|n>>1,r+=n&1,r)}function o$(t){const e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*2**-14*(n/2**10):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(r-15)*(1+n/2**10)}var bu={fromHalf:o$,toHalf:i$};function a$(){try{const n=new Int16Array([0,32767]),i=[1,1],o=document.createElement("canvas");o.width=4,o.height=4;const a=o.getContext("webgl2");if(!a)return!1;const s=a.getExtension("EXT_texture_norm16");if(!s)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,l=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,f=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(f,c),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))return!1;const u=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(u,l),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))return!1;const d=a.createProgram();if(a.attachShader(d,f),a.attachShader(d,u),a.linkProgram(d),!a.getProgramParameter(d,a.LINK_STATUS))return!1;const h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,s.R16_SNORM_EXT,2,1,0,a.RED,a.SHORT,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.useProgram(d),a.drawArrays(a.POINTS,0,1);const g=new Uint8Array(4);a.readPixels(i[0],i[1],1,1,a.RGBA,a.UNSIGNED_BYTE,g);const[p,m,w]=g,v=a.getExtension("WEBGL_lose_context");return v&&v.loseContext(),p===m&&m===w&&p!==0}catch{return!1}}let mv;function s$(){return mv===void 0&&(mv=a$()),mv}const{Wrap:ac,Filter:Wr}=_6,{VtkDataTypes:pn}=Tt,{vtkDebugMacro:vv,vtkErrorMacro:cu,vtkWarningMacro:wS,requiredParam:Sn}=_i,{toHalf:c$}=bu;function l$(t,e){e.classHierarchy.push("vtkOpenGLTexture");function r(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(g?e._openGLRenderWindow=g:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Wr.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Wr.LINEAR),t.setMagnificationFilter(Wr.LINEAR)):(t.setMinificationFilter(Wr.NEAREST),t.setMagnificationFilter(Wr.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(ac.REPEAT),t.setWrapS(ac.REPEAT),t.setWrapT(ac.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImageBitmap()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Wr.LINEAR_MIPMAP_LINEAR)),e.renderable.getImageBitmap()&&e.renderable.getImageLoaded()&&(t.create2DFromImageBitmap(e.renderable.getImageBitmap()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Wr.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Wr.LINEAR_MIPMAP_LINEAR));const m=e.renderable.getCanvas();t.create2DFromRaw({width:m.width,height:m.height,numComps:4,dataType:pn.UNSIGNED_CHAR,data:m,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const m=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Wr.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw({width:m.width,height:m.height,numComps:4,dataType:pn.UNSIGNED_CHAR,data:m.data,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const p=e.renderable.getInputData(0);if(p&&p.getPointData().getScalars()){const m=p.getExtent(),w=p.getPointData().getScalars(),v=[];for(let y=0;y<e.renderable.getNumberOfInputPorts();++y){const C=e.renderable.getInputData(y),x=C?C.getPointData().getScalars().getData():null;x&&v.push(x)}e.renderable.getInterpolate()&&w.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Wr.LINEAR_MIPMAP_LINEAR)),v.length%6===0?t.createCubeFromRaw({width:m[1]-m[0]+1,height:m[3]-m[2]+1,numComps:w.getNumberOfComponents(),dataType:w.getDataType(),data:v}):t.create2DFromRaw({width:m[1]-m[0]+1,height:m[3]-m[2]+1,numComps:w.getNumberOfComponents(),dataType:w.getDataType(),data:w.getData()}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const n=()=>{if(!((e.minificationFilter===Wr.LINEAR||e.magnificationFilter===Wr.LINEAR)&&!s$()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=g=>{g&&e.handle&&(g.activateTexture(t),g.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(g),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let g=!1;if(e.context&&e.handle){let p=0;switch(e.target){case e.context.TEXTURE_2D:p=e.context.TEXTURE_BINDING_2D;break;default:wS("impossible case");break}g=e.context.getIntegerv(p)===e.handle}return g},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(g,p)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(g,p)),e.internalFormat||vv(`Unable to find suitable internal format for T=${g} NC= ${p}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&wS("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(g,p)=>{let m=0;return m=e._openGLRenderWindow.getDefaultTextureInternalFormat(g,p,n(),t.useHalfFloat()),m||(m||(vv("Unsupported internal texture type!"),vv(`Unable to find suitable internal format for T=${g} NC= ${p}`)),m)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=g=>{e._forceInternalFormat=!0,g!==e.internalFormat&&(e.internalFormat=g,t.modified())},t.getFormat=(g,p)=>(e.format=t.getDefaultFormat(g,p),e.format),t.getDefaultFormat=(g,p)=>{if(e._openGLRenderWindow.getWebgl2())switch(p){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(p){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=g=>{const p=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(g){case pn.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!p&&pn.SHORT):return e.context.SHORT;case(n()&&!p&&pn.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(p&&pn.SHORT):return e.context.HALF_FLOAT;case(p&&pn.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case pn.FLOAT:case pn.VOID:default:return e.context.FLOAT}switch(g){case pn.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case pn.FLOAT:case pn.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const m=e.context.getExtension("OES_texture_half_float");if(m&&e.context.getExtension("OES_texture_half_float_linear"))return m.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(g){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||p)&&(e.openGLDataType=t.getDefaultDataType(g)),e.openGLDataType},t.getShiftAndScale=()=>{let g=0,p=1;switch(e.openGLDataType){case e.context.BYTE:p=127.5,g=p-128;break;case e.context.UNSIGNED_BYTE:p=255,g=0;break;case e.context.SHORT:p=32767.5,g=p-32768;break;case e.context.UNSIGNED_SHORT:p=65536,g=0;break;case e.context.INT:p=21474836475e-1,g=p-2147483648;break;case e.context.UNSIGNED_INT:p=4294967295,g=0;break;case e.context.FLOAT:}return{shift:g,scale:p}},t.getOpenGLFilterMode=g=>{switch(g){case Wr.NEAREST:return e.context.NEAREST;case Wr.LINEAR:return e.context.LINEAR;case Wr.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Wr.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Wr.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Wr.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=g=>{switch(g){case ac.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case ac.REPEAT:return e.context.REPEAT;case ac.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function i(g){const[p,m,w,v,y,C]=g;return[m-p+1,v-w+1,C-y+1]}function o(g){const[p,m,w]=i(g);return p*m*w}function a(g,p,m,w,v){const[y,C,x,T,S,_]=m,[E,D]=p,b=E*D;let I=v;for(let O=S;O<=_;O++){const M=O*b;for(let R=x;R<=T;R++){const A=M+R*E;for(let B=A+y,k=A+C;B<=k;B++,I++)w[I]=g[B]}}}function s(g,p){const w=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||g.constructor,v=p.reduce((T,S)=>T+o(S),0),y=new w(v),C=[e.width,e.height,e.depth];let x=0;return p.forEach(T=>{a(g,C,T,y,x),x+=o(T)}),y}t.updateArrayDataTypeForGL=function(g,p){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];const v=[];let y=e.width*e.height*e.components;m&&(y*=e.depth);const C=!!w.length;if(g!==pn.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let T=0;T<p.length;T++)if(p[T])if(C)v.push(s(p[T],w,Float32Array));else{const S=p[T].length>y?p[T].subarray(0,y):p[T];v.push(new Float32Array(S))}else v.push(null);if(g!==pn.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let T=0;T<p.length;T++)if(p[T])if(C)v.push(s(p[T],w,Uint8Array));else{const S=p[T].length>y?p[T].subarray(0,y):p[T];v.push(new Uint8Array(S))}else v.push(null);let x=!1;if(e._openGLRenderWindow.getWebgl2())x=e.openGLDataType===e.context.HALF_FLOAT;else{const T=e.context.getExtension("OES_texture_half_float");x=T&&e.openGLDataType===T.HALF_FLOAT_OES}if(x)for(let T=0;T<p.length;T++)if(p[T]){const S=C?s(p[T],w):p[T],_=new Uint16Array(C?S.length:y),E=_.length;for(let D=0;D<E;D++)_[D]=c$(S[D]);v.push(_)}else v.push(null);if(v.length===0)for(let T=0;T<p.length;T++)v.push(C&&p[T]?s(p[T],w):p[T]);return v};function c(g){if(e._openGLRenderWindow.getWebgl2())return g;const p=[],m=e.width,w=e.height,v=e.components;if(g&&(!Sd(m)||!Sd(w))){const y=e.context.getExtension("OES_texture_half_float"),C=Zo(m),x=Zo(w),T=C*x*e.components;for(let S=0;S<g.length;S++)if(g[S]!==null){let _=null;const E=w/x,D=m/C;let b=!1;e.openGLDataType===e.context.FLOAT?_=new Float32Array(T):y&&e.openGLDataType===y.HALF_FLOAT_OES?(_=new Uint16Array(T),b=!0):_=new Uint8Array(T);for(let I=0;I<x;I++){const O=I*C*v,M=I*E;let R=Math.floor(M),A=Math.ceil(M);A>=w&&(A=w-1);const B=M-R,k=1-B;R=R*m*v,A=A*m*v;for(let L=0;L<C;L++){const F=L*v,j=L*D;let J=Math.floor(j),ie=Math.ceil(j);ie>=m&&(ie=m-1);const fe=j-J;J*=v,ie*=v;for(let ae=0;ae<v;ae++)b?_[O+F+ae]=bu.toHalf(bu.fromHalf(g[S][R+J+ae])*k*(1-fe)+bu.fromHalf(g[S][R+ie+ae])*k*fe+bu.fromHalf(g[S][A+J+ae])*B*(1-fe)+bu.fromHalf(g[S][A+ie+ae])*B*fe):_[O+F+ae]=g[S][R+J+ae]*k*(1-fe)+g[S][R+ie+ae]*k*fe+g[S][A+J+ae]*B*(1-fe)+g[S][A+ie+ae]*B*fe}}p.push(_),e.width=C,e.height=x}else p.push(null)}if(p.length===0)for(let y=0;y<g.length;y++)p.push(g[y]);return p}function l(g){return e._openGLRenderWindow?e.resizable||e.renderable?.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(g===pn.UNSIGNED_SHORT||g===pn.SHORT)):!1:!1}t.create2DFromRaw=function(){let{width:g=Sn("width"),height:p=Sn("height"),numComps:m=Sn("numComps"),dataType:w=Sn("dataType"),data:v=Sn("data"),flip:y=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(w,!0),t.getInternalFormat(w,m),t.getFormat(w,m),!e.internalFormat||!e.format||!e.openGLDataType)return cu("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=m,e.width=g,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const C=[v],x=t.updateArrayDataTypeForGL(w,C),T=c(x);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,y),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(w)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),T[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,T[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,T[0]),e.generateMipmap&&e.context.generateMipmap(e.target),y&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*m*e._openGLRenderWindow.getDefaultTextureByteSize(w,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=function(){let{width:g=Sn("width"),height:p=Sn("height"),numComps:m=Sn("numComps"),dataType:w=Sn("dataType"),data:v=Sn("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(w),t.getInternalFormat(w,m),t.getFormat(w,m),!e.internalFormat||!e.format||!e.openGLDataType)return cu("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=m,e.width=g,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=v.length/6-1,t.createTexture(),t.bind();const y=t.updateArrayDataTypeForGL(w,v),C=c(y),x=[];let T=e.width,S=e.height;for(let _=0;_<C.length;_++){_%6===0&&_!==0&&(T/=2,S/=2),x[_]=M0(w,S*T*e.components);for(let E=0;E<S;++E){const D=E*T*e.components,b=(S-E-1)*T*e.components;x[_].set(C[_].slice(b,b+T*e.components),D)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(w)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let _=0;_<6;_++){let E=0,D=e.width,b=e.height;for(;D>=1&&b>=1;){let I=null;E<=e.maxLevel&&(I=x[6*E+_]),l(w)?I!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+_,E,0,0,D,b,e.format,e.openGLDataType,I):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+_,E,e.internalFormat,D,b,0,e.format,e.openGLDataType,I),E++,D/=2,b/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*m*e._openGLRenderWindow.getDefaultTextureByteSize(w,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=function(){let{width:g=Sn("width"),height:p=Sn("height"),dataType:m=Sn("dataType"),data:w=Sn("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.getOpenGLDataType(m),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?m===pn.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(cu("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=g,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(m)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),w!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,w)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,w),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(m,n(),t.useHalfFloat()),t.deactivate(),!0)},t.create2DFromImage=g=>{if(t.getOpenGLDataType(pn.UNSIGNED_CHAR),t.getInternalFormat(pn.UNSIGNED_CHAR,4),t.getFormat(pn.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return cu("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const p=!e._openGLRenderWindow.getWebgl2()&&(!Sd(g.width)||!Sd(g.height));let m=g,w=g.width,v=g.height,y=!0;const C=window.chrome;if(p||C){const x=new OffscreenCanvas(Zo(g.width),Zo(g.height));w=x.width,v=x.height;const T=x.getContext("2d");T.translate(0,x.height),T.scale(1,-1),T.drawImage(g,0,0,g.width,g.height,0,0,x.width,x.height),m=x,y=!1}return e.width=w,e.height=v,e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,y),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(pn.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,m)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,m),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(pn.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0},t.create2DFromImageBitmap=g=>(t.getOpenGLDataType(pn.UNSIGNED_CHAR),t.getInternalFormat(pn.UNSIGNED_CHAR,4),t.getFormat(pn.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType?(cu("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.width=g.width,e.height=g.height,l(pn.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(pn.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0));function f(g,p,m){const w=new Array(m),v=new Array(m);for(let y=0;y<m;++y)w[y]=g[y],v[y]=p[y]-g[y]||1;return{scale:v,offset:w}}function u(g,p){for(let m=0;m<g.length;m++){const w=g[m],v=p[m]+w;if(w<-2048||w>2048||v<-2048||v>2048)return!1}return!0}function d(g,p,m,w){t.getOpenGLDataType(g);const v=u(p,m)||w;let y=!1;if(e._openGLRenderWindow.getWebgl2())y=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&v||e.openGLDataType===e.context.HALF_FLOAT;else{const C=e.context.getExtension("OES_texture_half_float");y=C&&e.openGLDataType===C.HALF_FLOAT_OES}e.canUseHalfFloat=y&&v}function h(g,p){const m=g.getNumberOfComponents(),w=g.getDataType(),v=g.getData(),y=new Array(m),C=new Array(m);for(let T=0;T<m;++T){const[S,_]=g.getRange(T);y[T]=S,C[T]=_}const x=f(y,C,m);return d(w,x.offset,x.scale,p),t.useHalfFloat()||t.getOpenGLDataType(w,!0),{numComps:m,dataType:w,data:v,scaleOffsets:x}}t.create2DFilterableFromRaw=function(){let{width:g=Sn("width"),height:p=Sn("height"),numComps:m=Sn("numComps"),dataType:w=Sn("dataType"),data:v=Sn("data"),preferSizeOverAccuracy:y=!1,ranges:C=void 0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create2DFilterableFromDataArray({width:g,height:p,dataArray:Tt.newInstance({numberOfComponents:m,dataType:w,values:v,ranges:C}),preferSizeOverAccuracy:y})},t.create2DFilterableFromDataArray=function(){let{width:g=Sn("width"),height:p=Sn("height"),dataArray:m=Sn("dataArray"),preferSizeOverAccuracy:w=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:v,dataType:y,data:C}=h(m,w);t.create2DFromRaw({width:g,height:p,numComps:v,dataType:y,data:C})},t.updateVolumeInfoForGL=(g,p)=>{let m=!1;const w=t.useHalfFloat();(!e.volumeInfo?.scale||!e.volumeInfo?.offset)&&(e.volumeInfo={scale:new Array(p),offset:new Array(p)});for(let v=0;v<p;++v)e.volumeInfo.scale[v]=1,e.volumeInfo.offset[v]=0;if(n()&&!w&&g===pn.SHORT){for(let v=0;v<p;++v)e.volumeInfo.scale[v]=32767;m=!0}if(n()&&!w&&g===pn.UNSIGNED_SHORT){for(let v=0;v<p;++v)e.volumeInfo.scale[v]=65535;m=!0}if(g===pn.UNSIGNED_CHAR){for(let v=0;v<p;++v)e.volumeInfo.scale[v]=255;m=!0}return(g===pn.FLOAT||w&&(g===pn.SHORT||g===pn.UNSIGNED_SHORT))&&(m=!0),m},t.create3DFromRaw=function(){let{width:g=Sn("width"),height:p=Sn("height"),depth:m=Sn("depth"),numComps:w=Sn("numComps"),dataType:v=Sn("dataType"),data:y=Sn("data"),updatedExtents:C=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=v,T=y;if(!t.updateVolumeInfoForGL(x,w)&&T){const O=g*p*m,M=structuredClone(e.volumeInfo),R=new Float32Array(O*w);e.volumeInfo.offset=M.offset,e.volumeInfo.scale=M.scale;let A=0;const B=M.scale.map(k=>1/k);for(let k=0;k<O;k++)for(let L=0;L<w;L++)R[A]=(T[A]-M.offset[L])*B[L],A++;x=pn.FLOAT,T=R}if(t.getOpenGLDataType(x),t.getInternalFormat(x,w),t.getFormat(x,w),!e.internalFormat||!e.format||!e.openGLDataType)return cu("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=w,e.width=g,e.height=p,e.depth=m,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const S=C.length>0,_=!S||!Dw(e._prevTexParams,r()),E=[T],b=t.updateArrayDataTypeForGL(x,E,!0,_?[]:C),I=c(b);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),_)l(x)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),I[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,I[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,I[0]),e._prevTexParams=r();else if(S){const O=I[0];let M=0;for(let R=0;R<C.length;R++){const A=C[R],B=i(A),k=o(A),L=new O.constructor(O.buffer,M,k);M+=L.byteLength,e.context.texSubImage3D(e.target,0,A[0],A[2],A[4],B[0],B[1],B[2],e.format,e.openGLDataType,L)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(x,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(){let{width:g=Sn("width"),height:p=Sn("height"),depth:m=Sn("depth"),numComps:w=Sn("numComps"),dataType:v=Sn("dataType"),data:y=Sn("data"),preferSizeOverAccuracy:C=!1,ranges:x=void 0,updatedExtents:T=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create3DFilterableFromDataArray({width:g,height:p,depth:m,dataArray:Tt.newInstance({numberOfComponents:w,dataType:v,values:y,ranges:x}),preferSizeOverAccuracy:C,updatedExtents:T})},t.create3DFilterableFromDataArray=function(){let{width:g=Sn("width"),height:p=Sn("height"),depth:m=Sn("depth"),dataArray:w=Sn("dataArray"),preferSizeOverAccuracy:v=!1,updatedExtents:y=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:C,dataType:x,data:T,scaleOffsets:S}=h(w,v),_=[],E=[];for(let de=0;de<C;++de)_[de]=0,E[de]=1;if(e.volumeInfo={scale:E,offset:_,dataComputedScale:S.scale,dataComputedOffset:S.offset,width:g,height:p,depth:m},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw({width:g,height:p,depth:m,numComps:C,dataType:x,data:T,updatedExtents:y});const D=g*p*m,b=structuredClone(S);let I=(de,we,_e,Te,G)=>{de[we]=_e},O=pn.UNSIGNED_CHAR;if(x===pn.UNSIGNED_CHAR)for(let de=0;de<C;++de)b.offset[de]=0,b.scale[de]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(O=pn.FLOAT,I=(de,we,_e,Te,G)=>{de[we]=(_e-Te)/G}):(O=pn.UNSIGNED_CHAR,I=(de,we,_e,Te,G)=>{de[we]=255*(_e-Te)/G});if(t.getOpenGLDataType(O),t.getInternalFormat(O,C),t.getFormat(O,C),!e.internalFormat||!e.format||!e.openGLDataType)return cu("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=C,e.depth=1,e.numberOfDimensions=2;let M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);M>4096&&(O===pn.FLOAT||C>=3)&&(M=4096);let R=1,A=1;D>M*M&&(R=Math.ceil(Math.sqrt(D/(M*M))),A=R);let B=Math.sqrt(D)/R;B=Zo(B);const k=Math.floor(B*R/g),L=Math.ceil(m/k),F=Zo(p*L/A);e.width=B,e.height=F,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=k,e.volumeInfo.yreps=L,e.volumeInfo.xstride=R,e.volumeInfo.ystride=A,e.volumeInfo.offset=b.offset,e.volumeInfo.scale=b.scale;let j;const J=B*F*C;O===pn.FLOAT?j=new Float32Array(J):j=new Uint8Array(J);let ie=0;const fe=Math.floor(g/R),ae=Math.floor(p/A);for(let de=0;de<L;de++){const we=Math.min(k,m-de*k),_e=C*(e.width-we*Math.floor(g/R));for(let Te=0;Te<ae;Te++){for(let G=0;G<we;G++){const P=C*((de*k+G)*g*p+A*Te*g);for(let $=0;$<fe;$++)for(let W=0;W<C;W++)I(j,ie,T[P+R*$*C+W],b.offset[W],b.scale[W]),ie++}ie+=_e}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(O)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),j!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,j)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,j),t.deactivate(),!0},t.setOpenGLRenderWindow=g=>{e._openGLRenderWindow!==g&&(t.releaseGraphicsResources(),e._openGLRenderWindow=g,e.context=null,g&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=g=>g&&g.isCurrent()?g.getIntegerv(g.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=g=>{e.enableUseHalfFloat=g}}const u$={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:ac.CLAMP_TO_EDGE,wrapT:ac.CLAMP_TO_EDGE,wrapR:ac.CLAMP_TO_EDGE,minificationFilter:Wr.NEAREST,magnificationFilter:Wr.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function b6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,u$,r),Yn.extend(t,e,r),e.sendParametersTime={},Zn(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Zn(e.textureBuildTime,{mtime:0}),eg(t,e,["format","openGLDataType"]),Er(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Wi(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),tg(t,e,["openGLRenderWindow"]),l$(t,e)}const D6=On(b6,"vtkOpenGLTexture");var Kn={newInstance:D6,extend:b6,..._6};Vr("vtkTexture",D6);function f$(t,e){t.replaceShaderCoincidentOffset=(r,n,i)=>{const o=t.getCoincidentParameters(n,i);if(o&&(o.factor!==0||o.offset!==0)){let a=r.Fragment;a=Oe.substitute(a,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(o.factor!==0?(a=Oe.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=Oe.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=Oe.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(o.factor!==0?(a=Oe.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=Oe.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=Oe.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=a}}}function d$(t,e){t.applyShaderReplacements=(r,n,i)=>{let o=null;if(n&&(o=n.ShaderReplacements),o)for(let a=0;a<o.length;a++){const s=o[a];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,l=r[c],f=Oe.substitute(l,s.originalValue,s.replacementValue,s.replaceAll);r[c]=f.result}}},t.buildShaders=(r,n,i)=>{t.getReplacedShaderTemplate(r,n,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);const o=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,o,!0),t.replaceShaderValues(r,n,i),t.applyShaderReplacements(r,o)},t.getReplacedShaderTemplate=(r,n,i)=>{const o=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,i);let a=r.Vertex;if(o){const l=o.VertexShaderCode;l!==void 0&&l!==""&&(a=l)}r.Vertex=a;let s=r.Fragment;if(o){const l=o.FragmentShaderCode;l!==void 0&&l!==""&&(s=l)}r.Fragment=s;let c=r.Geometry;if(o){const l=o.GeometryShaderCode;l!==void 0&&(c=l)}r.Geometry=c}}var Cs={implementReplaceShaderCoincidentOffset:f$,implementBuildShadersWithReplacements:d$};const{vtkWarningMacro:h$}=K;let xC;function g$(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(r,n)=>(Pt(n,r,e.matrix),n),t.transformPoints=(r,n)=>{const i=new Float64Array(3),o=new Float64Array(3);for(let a=0;a<r.length;a+=3)i[0]=r[a],i[1]=r[a+1],i[2]=r[a+2],Pt(o,i,e.matrix),n[a]=o[0],n[a+1]=o[1],n[a+2]=o[2];return n},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(r,n)=>(e.preMultiplyFlag?Wt(n,e.matrix,r):Wt(n,r,e.matrix),n),t.transformMatrices=(r,n)=>{const i=new Float64Array(16),o=new Float64Array(16),a=e.preMultiplyFlag?()=>Wt(o,e.matrix,i):()=>Wt(o,i,e.matrix);for(let s=0;s<r.length;s+=16){for(let c=0;c<16;++c)i[c]=r[s+c];a();for(let c=0;c<16;++c)n[s+c]=o[c]}return n},t.getInverse=()=>xC({matrix:pt.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag}),t.translate=(r,n,i)=>{if(r===0&&n===0&&i===0)return;const o=Ti();P0(o,[r,n,i]),e.preMultiplyFlag?Wt(e.matrix,e.matrix,o):Wt(e.matrix,o,e.matrix),t.modified()},t.rotateWXYZ=(r,n,i,o)=>{if(n===0&&i===0&&o===0){h$("No rotation applied, axis is zero vector.");return}if(r===0)return;const a=pt.radiansFromDegrees(r),s=Tc();og(s,[n,i,o],a);const c=new Float64Array(16);Yf(c,s),e.preMultiplyFlag?Wt(e.matrix,e.matrix,c):Wt(e.matrix,c,e.matrix),t.modified()},t.rotateX=r=>{t.rotateWXYZ(r,1,0,0)},t.rotateY=r=>{t.rotateWXYZ(r,0,1,0)},t.rotateZ=r=>{t.rotateWXYZ(r,0,0,1)},t.scale=(r,n,i)=>{if(r===1&&n===1&&i===1)return;const o=Ti();W1(o,[r,n,i]),e.preMultiplyFlag?Wt(e.matrix,e.matrix,o):Wt(e.matrix,o,e.matrix),t.modified()},t.transformNormal=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=xl(Jo(),e.matrix),o=Jo();xc(o,i);const a=Jo();return g0(a,o),t.transformVector(r,n,a),pt.normalize(n),n},t.transformNormals=(r,n)=>{const i=r.getData(),o=n.getData(),a=[0,0,0],s=xl(Jo(),e.matrix),c=Jo();xc(c,s);const l=Jo();g0(l,c);for(let f=0;f<i.length;f+=3)a[0]=i[f],a[1]=i[f+1],a[2]=i[f+2],t.transformVector(a,a,l),pt.normalize(a),o[f]=a[0],o[f+1]=a[1],o[f+2]=a[2]},t.transformVector=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const o=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||xl(Jo(),e.matrix);return yh(n,r,o),n},t.transformVectors=(r,n)=>{const i=r.getData(),o=n.getData(),a=[0,0,0];for(let s=0;s<i.length;s+=3)a[0]=i[s],a[1]=i[s+1],a[2]=i[s+2],t.transformVector(a,a),pt.normalize(a),o[s]=a[0],o[s+1]=a[1],o[s+2]=a[2]},t.transformPointsNormalsVectors=function(r,n,i,o,a,s){let c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;const f=r.getNumberOfPoints(),u=c?.length??0,d=new Float64Array(3),h=new Float64Array(3),g=new Float64Array(3),p=new Float64Array(3);let m=!1,w=!1,v=!1;const y=[];for(let C=0;C<f;C++){if(r.getPoint(C,d),h.set(d),t.transformPoint(d,d),n.setPoint(C,...d),pt.areEquals(h,d)||(m=!0),a){const x=a.getData(),T=s.getData();d[0]=x[C*3],d[1]=x[C*3+1],d[2]=x[C*3+2],g.set(d),t.transformVector(d,d),T[C*3]=d[0],T[C*3+1]=d[1],T[C*3+2]=d[2],pt.areEquals(g,d)||(w=!0)}if(i){const x=i.getData(),T=o.getData();d[0]=x[C*3],d[1]=x[C*3+1],d[2]=x[C*3+2],p.set(d),t.transformNormal(d,d),T[C*3]=d[0],T[C*3+1]=d[1],T[C*3+2]=d[2],pt.areEquals(p,d)||(v=!0)}if(c)for(let x=0;x<u;x++){const T=c[x].getData(),S=l[x].getData();d[0]=T[C*3],d[1]=T[C*3+1],d[2]=T[C*3+2],g.set(d),t.transformVector(d,d),S[C*3]=d[0],S[C*3+1]=d[1],S[C*3+2]=d[2],!pt.arrayEqual(g,d)&&!y.includes(x)&&y.push(x)}}m&&n.modified(),w&&s.modified(),v&&o.modified(),y.forEach(C=>l[C].modified())}}const p$={preMultiplyFlag:!1,matrix:[...Vw]};function I6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,p$,r),K.obj(t,e),K.setGet(t,e,["preMultiplyFlag"]),K.setGetArray(t,e,["matrix"],16),g$(t,e)}xC=K.newInstance(I6,"vtkTransform");var m$={newInstance:xC,extend:I6};function xs(t,e,r){return t.length>0?`${t.map(n=>n?.getMTime()??"x").join("/")}-${e}-${r}`:"0"}function TC(t,e){return`${e.getMTime()}`}var v$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,y$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const Sl={NEAREST:0,LINEAR:1};var w$={InterpolationType:Sl};const Ua={Off:0,PolygonOffset:1};let f5=Ua.PolygonOffset,Rm=Ua.Off;const C$=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function x$(){return f5}function T$(t){const e=f5===t;return f5=t,e}function S$(){return Rm}function Y1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=Rm===t;return Rm=t,e}function _$(){return Y1(Ua.Off)}function E$(){return Y1(Ua.Off)}function b$(){return Y1(Ua.PolygonOffset)}function D$(){return C$[Rm]}var d5={Resolve:Ua,getResolveCoincidentTopologyAsString:D$,getResolveCoincidentTopologyPolygonOffsetFaces:x$,getResolveCoincidentTopology:S$,setResolveCoincidentTopology:Y1,setResolveCoincidentTopologyPolygonOffsetFaces:T$,setResolveCoincidentTopologyToDefault:_$,setResolveCoincidentTopologyToOff:E$,setResolveCoincidentTopologyToPolygonOffset:b$};function M6(t,e,r){r.forEach(n=>{t[`get${n.method}`]=()=>e[n.key],t[`set${n.method}`]=K.objectSetterMap.object(t,e,{name:n.key,params:["factor","offset"]})})}const SC=["Polygon","Line","Point"],I$={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},M$=()=>{},Du={modified:M$};M6(Du,I$,SC.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function O$(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),K.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(d5).forEach(r=>{t[r]=d5[r]}),Object.keys(Du).filter(r=>r!=="modified").forEach(r=>{t[r]=Du[r]}),M6(t,e.topologyOffset,SC.map(r=>({key:r,method:`RelativeCoincidentTopology${r}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const r=Du.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const r=Du.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const r=Du.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var J1={implementCoincidentTopologyMethods:O$,staticOffsetAPI:Du,otherStaticMethods:d5,CATEGORIES:SC,Resolve:Ua};const{vtkErrorMacro:lu}=_i;function CS(t,e,r){return e.identity(r),t.reduce((n,i,o)=>o===0?i?e.copy(n,i):e.identity(n):i?e.multiply(n,n,i):n,r)}function P$(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");const r=new Map;function n(c,l){if(!l)return;const u=(r.get(l)??0)-1;u<=0?(c.unregisterGraphicsResourceUser(l,t),r.delete(l)):r.set(l,u)}function i(c,l){if(!l)return;const f=r.get(l)??0,u=f+1;r.set(l,u),f<=0&&c.registerGraphicsResourceUser(l,t)}function o(c,l,f){l!==f&&(n(c,l),i(c,f))}function a(c){[...r.keys()].forEach(l=>c.unregisterGraphicsResourceUser(l,t))}t.buildPass=c=>{if(c){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const l=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(l.getActiveCamera());const f=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),f&&!f.isDeleted()&&f!==e._openGLRenderWindow&&a(f),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(c,l)=>{c&&(e.currentRenderPass=l,t.render())},t.zBufferPass=c=>{c&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=c=>t.zBufferPass(c),t.opaquePass=c=>{c&&t.render()},t.getCoincidentParameters=(c,l)=>e.renderable.getResolveCoincidentTopology()==Ua.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const c=e._openGLImageSlice.getRenderable(),l=e._openGLRenderer.getRenderable();t.renderPiece(l,c)},t.renderPiece=(c,l)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const f=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let g=0;g<f;++g){const p=e.renderable.getInputData(g);p&&!p.isDeleted()&&e.currentValidInputs.push({imageData:p,inputIndex:g})}const u=e.currentValidInputs.length;if(u<=0){lu("No input!");return}const h=e.currentValidInputs[0].imageData.getPointData().getScalars();e.multiTexturePerVolumeEnabled=u>1,e.numberOfComponents=e.multiTexturePerVolumeEnabled?u:h.getNumberOfComponents(),t.updateResliceGeometry(),t.renderPieceStart(c,l),t.renderPieceDraw(c,l),t.renderPieceFinish(c,l),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(c,l)=>{t.updateBufferObjects(c,l);const f=l.getProperties();e.currentValidInputs.forEach(g=>{let{inputIndex:p}=g;const w=f[p].getInterpolationType(),v=e.scalarTextures[p];w===Sl.NEAREST?(v.setMinificationFilter(Mt.NEAREST),v.setMagnificationFilter(Mt.NEAREST)):(v.setMinificationFilter(Mt.LINEAR),v.setMagnificationFilter(Mt.LINEAR))});const u=e.currentValidInputs[0];f[u.inputIndex].getInterpolationType()===Sl.NEAREST?(e.colorTexture.setMinificationFilter(Mt.NEAREST),e.colorTexture.setMagnificationFilter(Mt.NEAREST),e.pwfTexture.setMinificationFilter(Mt.NEAREST),e.pwfTexture.setMagnificationFilter(Mt.NEAREST)):(e.colorTexture.setMinificationFilter(Mt.LINEAR),e.colorTexture.setMagnificationFilter(Mt.LINEAR),e.pwfTexture.setMinificationFilter(Mt.LINEAR),e.pwfTexture.setMagnificationFilter(Mt.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(c,l)=>{const f=e.context,u=[...e.scalarTextures,e.colorTexture,e.pwfTexture];u.forEach(d=>d.activate()),t.updateShaders(e.tris,c,l),f.drawArrays(f.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),u.forEach(d=>d.deactivate())},t.renderPieceFinish=(c,l)=>{},t.updateBufferObjects=(c,l)=>{t.getNeedToRebuildBufferObjects(c,l)&&t.buildBufferObjects(c,l)},t.getNeedToRebuildBufferObjects=(c,l)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<l.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<l.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.currentValidInputs.some(f=>{let{imageData:u}=f;return e.VBOBuildTime.getMTime()<u.getMTime()})||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(f=>!!f?.getHandle())||!e.colorTexture?.getHandle()||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(c,l)=>{const f=l.getProperties();e.currentValidInputs.forEach((b,I)=>{let{imageData:O}=b;const M=O.getPointData().getScalars(),R=e._openGLRenderWindow.getGraphicsResourceForObject(M),A=TC(O,M),B=!R?.oglObject?.getHandle()||R?.hash!==A,k=f[I],L=k.getUpdatedExtents(),F=!!L.length;if(B&&!F){const j=Kn.newInstance();j.setOpenGLRenderWindow(e._openGLRenderWindow);const J=O.getDimensions();j.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),j.resetFormatAndType(),j.create3DFilterableFromDataArray({width:J[0],height:J[1],depth:J[2],dataArray:M}),e._openGLRenderWindow.setGraphicsResourceForObject(M,j,A),e.scalarTextures[I]=j}else e.scalarTextures[I]=R.oglObject;if(F){k.setUpdatedExtents([]);const j=O.getDimensions();e.scalarTextures[I].create3DFilterableFromDataArray({width:j[0],height:j[1],depth:j[2],dataArray:M,updatedExtents:L})}o(e._openGLRenderWindow,e._scalarTexturesCore[I],M),e._scalarTexturesCore[I]=M});const u=e.currentValidInputs[0],d=f[u.inputIndex],h=d.getIndependentComponents(),g=h?e.numberOfComponents:1,p=h?2*g:1,m=[];for(let b=0;b<g;++b)m.push(d.getRGBTransferFunction(b));const w=xs(m,h,g),v=d.getRGBTransferFunction(),y=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!y?.oglObject?.getHandle()||y?.hash!==w){let b=e.renderable.getColorTextureWidth();b<=0&&(b=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const I=b*p*3,O=new Uint8ClampedArray(I),M=Kn.newInstance();if(M.setOpenGLRenderWindow(e._openGLRenderWindow),v){const R=new Float32Array(b*3);for(let A=0;A<g;A++){const B=d.getRGBTransferFunction(A),k=B.getRange();if(B.getTable(k[0],k[1],b,R,1),h)for(let L=0;L<b*3;L++)O[A*b*6+L]=255*R[L],O[A*b*6+L+b*3]=255*R[L];else for(let L=0;L<b*3;L++)O[A*b*3+L]=255*R[L]}M.resetFormatAndType(),M.create2DFromRaw({width:b,height:p,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:O})}else{for(let R=0;R<b*3;++R){const A=255*R/((b-1)*3);for(let B=0;B<p;++B)O[B*b*3+R+0]=A,O[B*b*3+R+1]=A,O[B*b*3+R+2]=A}M.resetFormatAndType(),M.create2DFromRaw({width:b,height:1,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:O})}v&&e._openGLRenderWindow.setGraphicsResourceForObject(v,M,w),e.colorTexture=M}else e.colorTexture=y.oglObject;o(e._openGLRenderWindow,e._colorTextureCore,v),e._colorTextureCore=v;const x=[];for(let b=0;b<g;++b)x.push(d.getPiecewiseFunction(b));const T=xs(x,h,g),S=d.getPiecewiseFunction(),_=e._openGLRenderWindow.getGraphicsResourceForObject(S);if(!_?.oglObject?.getHandle()||_?.hash!==T){let b=e.renderable.getOpacityTextureWidth();b<=0&&(b=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const I=b*p,O=new Uint8ClampedArray(I),M=Kn.newInstance();if(M.setOpenGLRenderWindow(e._openGLRenderWindow),S){const R=new Float32Array(I),A=new Float32Array(b);for(let B=0;B<g;++B){const k=d.getPiecewiseFunction(B);if(k===null)R.fill(1);else{const L=k.getRange();if(k.getTable(L[0],L[1],b,A,1),h)for(let F=0;F<b;F++)R[B*b*2+F]=A[F],R[B*b*2+F+b]=A[F];else for(let F=0;F<b;F++)R[F]=A[F]}}M.resetFormatAndType(),M.create2DFromRaw({width:b,height:p,numComps:1,dataType:Qt.FLOAT,data:R})}else O.fill(255),M.resetFormatAndType(),M.create2DFromRaw({width:b,height:p,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:O});S&&e._openGLRenderWindow.setGraphicsResourceForObject(S,M,T),e.pwfTexture=M}else e.pwfTexture=_.oglObject;o(e._openGLRenderWindow,e._pwfTextureCore,S),e._pwfTextureCore=S;const D=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==D){const b=Tt.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});b.setName("points");const I=Tt.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),O={points:b,cellOffset:0};if(e.renderable.getSlabThickness()>0){const M=e.resliceGeom.getPointData().getNormals();M?O.normals=M:lu("Slab mode requested without normals")}e.tris.getCABO().createVBO(I,"polys",li.SURFACE,O)}e.VBOBuildString=D,e.VBOBuildTime.modified()},t.updateShaders=(c,l,f)=>{if(e.lastBoundBO=c,t.getNeedToRebuildShaders(c,l,f)){const u={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(u,l,f);const d=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(u.Vertex,u.Fragment,u.Geometry);d!==c.getProgram()&&(c.setProgram(d),c.getVAO().releaseGraphicsResources()),c.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(c.getProgram());c.getVAO().bind(),t.setMapperShaderParameters(c,l,f),t.setCameraShaderParameters(c,l,f),t.setPropertyShaderParameters(c,l,f)},t.setMapperShaderParameters=(c,l,f)=>{const u=c.getProgram(),d=e.currentValidInputs[0].imageData;if(c.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>c.getAttributeUpdateTime().getMTime()||c.getShaderSourceTime().getMTime()>c.getAttributeUpdateTime().getMTime())){e.scalarTextures.forEach((p,m)=>{u.setUniformi(`volumeTexture[${m}]`,p.getTextureUnit())}),u.isAttributeUsed("vertexWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"vertexWC",c.getCABO().getVertexOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||lu("Error setting vertexWC in shader VAO.")),u.isAttributeUsed("normalWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"normalWC",c.getCABO().getNormalOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||lu("Error setting normalWC in shader VAO.")),u.isUniformUsed("slabThickness")&&u.setUniformf("slabThickness",e.renderable.getSlabThickness()),u.isUniformUsed("spacing")&&u.setUniform3fv("spacing",d.getSpacing()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabTrapezoid")&&u.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const g=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null;if(u.isUniformUsed("WCTCMatrix")){const p=d.getDimensions();sr(e.tmpMat4,d.getIndexToWorld()),Gn(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),ws(e.tmpMat4,e.tmpMat4,p),gr(e.tmpMat4,e.tmpMat4),g&&Wt(e.tmpMat4,e.tmpMat4,g),u.setUniformMatrix("WCTCMatrix",e.tmpMat4)}u.isUniformUsed("vboScaling")&&u.setUniform3fv("vboScaling",c.getCABO().getCoordScale()??[1,1,1]),c.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&c.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),c.getProgram().isUniformUsed("coffset")){const h=t.getCoincidentParameters(l,f);c.getProgram().setUniformf("coffset",h.offset),c.getProgram().isUniformUsed("cfactor")&&c.getProgram().setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(c,l,f)=>{const u=e._openGLCamera.getKeyMatrices(l),d=e._openGLImageSlice.getKeyMatrices(),g=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null,p=c.getProgram();p.isUniformUsed("MCPCMatrix")&&(_t(e.tmpMat4),p.setUniformMatrix("MCPCMatrix",CS([u.wcpc,d.mcwc,g],vh,e.tmpMat4))),p.isUniformUsed("MCVCMatrix")&&(_t(e.tmpMat4),p.setUniformMatrix("MCVCMatrix",CS([u.wcvc,d.mcwc,g],vh,e.tmpMat4)))},t.setPropertyShaderParameters=(c,l,f)=>{const u=c.getProgram(),d=f.getProperty(e.currentValidInputs[0].inputIndex),h=d.getOpacity();u.setUniformf("opacity",h);const g=e.numberOfComponents,p=d.getIndependentComponents();if(p)for(let v=0;v<g;++v)u.setUniformf(`mix${v}`,d.getComponentWeight(v));for(let v=0;v<g;v++){const y=e.multiTexturePerVolumeEnabled,C=y?v:0,x=y?0:v,S=e.scalarTextures[C].getVolumeInfo(),_=S.scale[x],E=S.offset[x],D=p?v:0;let b=d.getColorWindow(),I=d.getColorLevel();const O=d.getRGBTransferFunction(D);if(O&&d.getUseLookupTableScalarRange()){const L=O.getRange();b=L[1]-L[0],I=.5*(L[1]+L[0])}const M=_/b,R=(E-I)/b+.5;u.setUniformf(`cshift${v}`,R),u.setUniformf(`cscale${v}`,M);let A=1,B=0;const k=d.getPiecewiseFunction(D);if(k){const L=k.getRange(),F=L[1]-L[0],j=.5*(L[0]+L[1]);A=_/F,B=(E-j)/F+.5}u.setUniformf(`pwfshift${v}`,B),u.setUniformf(`pwfscale${v}`,A)}const m=e.colorTexture.getTextureUnit();u.setUniformi("colorTexture1",m);const w=e.pwfTexture.getTextureUnit();u.setUniformi("pwfTexture1",w),u.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(c,l,f)=>{const u=f.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents(),d=e.renderable.getSlabThickness(),h=e.renderable.getSlabType(),g=e.renderable.getSlabTrapezoidIntegration();let p=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(p=!0),p||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastNumberOfComponents!==e.numberOfComponents||e.lastMultiTexturePerVolumeEnabled!==e.multiTexturePerVolumeEnabled||c.getProgram()?.getHandle()===0||e.lastIndependentComponents!==u||e.lastSlabThickness!==d||e.lastSlabType!==h||e.lastSlabTrapezoidIntegration!==g?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastNumberOfComponents=e.numberOfComponents,e.lastMultiTexturePerVolumeEnabled=e.multiTexturePerVolumeEnabled,e.lastIndependentComponents=u,e.lastSlabThickness=d,e.lastSlabType=h,e.lastSlabTrapezoidIntegration=g,!0):!1},t.getShaderTemplate=(c,l,f)=>{c.Vertex=v$,c.Fragment=y$,c.Geometry=""},t.replaceShaderValues=(c,l,f)=>{if(t.replaceShaderTCoord(c,l,f),t.replaceShaderPositionVC(c,l,f),e.haveSeenDepthRequest){let u=c.Fragment;u=Oe.substitute(u,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,u=Oe.substitute(u,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,c.Fragment=u}t.replaceShaderCoincidentOffset(c,l,f)},t.replaceShaderTCoord=(c,l,f)=>{let u=c.Vertex;const d=c.Geometry;let h=c.Fragment;const g=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],p=e.renderable.getSlabThickness();u=Oe.substitute(u,"//VTK::TCoord::Dec",g).result;const m=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];u=Oe.substitute(u,"//VTK::TCoord::Impl",m).result;const w=e.numberOfComponents,v=f.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents();let y=["in vec3 fragTexCoord;",`uniform highp sampler3D volumeTexture[${e.scalarTextures.length}];`,"uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(y.push("vec4 rawSampleTexture(vec3 pos) {"),!e.multiTexturePerVolumeEnabled)y.push("return texture(volumeTexture[0], pos);","}");else{y.push("vec4 rawSample;");for(let x=0;x<e.scalarTextures.length;++x)y.push(`rawSample[${x}] = texture(volumeTexture[${x}], pos)[0];`);y.push("return rawSample;","}")}if(v){for(let x=1;x<w;x++)y=y.concat([`uniform float cshift${x};`,`uniform float cscale${x};`,`uniform float pwfshift${x};`,`uniform float pwfscale${x};`]);switch(w){case 1:y=y.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:y=y.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:y=y.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:y=y.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:lu("Unsupported number of independent coordinates.")}}p>0&&(y=y.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),y=y.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),h=Oe.substitute(h,"//VTK::TCoord::Dec",y).result;let C=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = rawSampleTexture(fragTexCoord);"];if(p>0&&(C=C.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),v){const x=["r","g","b","a"];for(let T=0;T<w;++T)C=C.concat([`vec3 tcolor${T} = texture2D(colorTexture1, vec2(tvalue.${x[T]} * cscale${T} + cshift${T}, height${T})).rgb;`,`float compWeight${T} = mix${T} * texture2D(pwfTexture1, vec2(tvalue.${x[T]} * pwfscale${T} + pwfshift${T}, height${T})).r;`]);switch(w){case 1:C=C.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:C=C.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:lu("Unsupported number of independent coordinates.")}}else switch(w){case 1:C=C.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:C=C.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}h=Oe.substitute(h,"//VTK::TCoord::Impl",C).result,c.Vertex=u,c.Fragment=h,c.Geometry=d},t.replaceShaderPositionVC=(c,l,f)=>{let u=c.Vertex;const d=c.Geometry;let h=c.Fragment;const g=e.renderable.getSlabThickness();let p=["attribute vec4 vertexWC;"];p=p.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),g>0&&(p=p.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),u=Oe.substitute(u,"//VTK::PositionVC::Dec",p).result;let m=["gl_Position = MCPCMatrix * vertexWC;"];g>0&&(m=m.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),u=Oe.substitute(u,"//VTK::PositionVC::Impl",m).result,u=Oe.substitute(u,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let w=[];g>0&&(w=w.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),h=Oe.substitute(h,"//VTK::PositionVC::Dec",w).result,c.Vertex=u,c.Geometry=d,c.Fragment=h};function s(c){pt.normalize(c);const l=[0,0,0];for(let f=0;f<3;++f){oU(l),l[f]=1;const u=pt.dot(c,l);if(u<-.999999||u>.999999)return[!0,f]}return[!1,2]}t.updateResliceGeometry=()=>{let c="";const l=e.currentValidInputs[0].imageData,f=l?.getBounds();let u=!0,d=2;const h=e.renderable.getSlicePolyData(),g=e.renderable.getSlicePlane();if(h)c=c.concat(`PolyData${h.getMTime()}`);else if(g){c=c.concat(`Plane${g.getMTime()}`);const p=Jo();l&&(c=c.concat(`Image${l.getMTime()}`),M8(p,...l.getDirection()),xc(p,p));const m=[...g.getNormal()];yh(m,m,p),[u,d]=s(m)}else{const p=tr.newInstance();p.setNormal(0,0,1);let m=[0,1,0,1,0,1];l&&(m=f),p.setOrigin(m[0],m[2],.5*(m[5]+m[4])),e.renderable.setSlicePlane(p),c=c.concat(`Plane${g?.getMTime()}`),l&&(c=c.concat(`Image${l.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==c){if(h)e.resliceGeom||(e.resliceGeom=rr.newInstance()),e.resliceGeom.getPoints().setData(h.getPoints().getData(),3),e.resliceGeom.getPolys().setData(h.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(h.getPointData().getNormals());else if(g)if(u){const p=new Float32Array(12),m=l.worldToIndex(g.getOrigin(),[0,0,0]),w=[(d+1)%3,(d+2)%3].sort(),v=l.getSpatialExtent();let y=0;for(let _=0;_<2;++_)for(let E=0;E<2;++E)p[y+d]=m[d],p[y+w[0]]=v[2*w[0]+E],p[y+w[1]]=v[2*w[1]+_],y+=3;e.transform.setMatrix(l.getIndexToWorld()),e.transform.transformPoints(p,p);const C=new Uint16Array(8);C[0]=3,C[1]=0,C[2]=1,C[3]=3,C[4]=3,C[5]=0,C[6]=3,C[7]=2;const x=g.getNormal();pt.normalize(x);const T=new Float32Array(12);for(let _=0;_<4;++_)T[3*_]=x[0],T[3*_+1]=x[1],T[3*_+2]=x[2];e.resliceGeom||(e.resliceGeom=rr.newInstance()),e.resliceGeom.getPoints().setData(p,3),e.resliceGeom.getPolys().setData(C,1);const S=Tt.newInstance({numberOfComponents:3,values:T,name:"Normals"});e.resliceGeom.getPointData().setNormals(S)}else{e.outlineFilter.setInputData(l),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(g),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=rr.newInstance());const p=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(p.getPoints().getData(),3),e.resliceGeom.getPolys().setData(p.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(p.getPointData().getNormals());const m=g.getNormal(),w=e.resliceGeom.getNumberOfPoints();pt.normalize(m);const v=new Float32Array(w*3);for(let C=0;C<w;++C)v[3*C]=m[0],v[3*C+1]=m[1],v[3*C+2]=m[2];const y=Tt.newInstance({numberOfComponents:3,values:v,name:"Normals"});e.resliceGeom.getPointData().setNormals(y)}else lu("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=c,e.resliceGeom?.modified()}},t.setScalarTextures=c=>{e.scalarTextures=[...c],e._externalOpenGLTexture=!0},t.delete=ng(()=>{e._openGLRenderWindow&&a(e._openGLRenderWindow)},t.delete)}const R$={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastNumberOfComponents:0,lastMultiTexturePerVolumeEnabled:!1,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,scalarTextures:[],_scalarTexturesCore:[],colorTexture:null,_colorTextureCore:null,pwfTexture:null,_pwfTextureCore:null,_externalOpenGLTexture:!1,resliceGeom:null,resliceGeomUpdateString:null,tris:null};function A$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R$,r),Yn.extend(t,e,r),Cs.implementReplaceShaderCoincidentOffset(t,e,r),Cs.implementBuildShadersWithReplacements(t,e,r),e.tris=Fa.newInstance(),e.scalarTextures=[],e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},Zn(e.VBOBuildTime),e.tmpMat4=_t(new Float64Array(16)),e.outlineFilter=n$.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=rr.newInstance(),e.cutter=wW.newInstance(),e.lineToSurfaceFilter=gW.newInstance(),e.transform=m$.newInstance(),Wi(t,e,["scalarTextures"]),P$(t,e)}const L$=On(A$,"vtkOpenGLImageResliceMapper");Vr("vtkImageResliceMapper",L$);const N$={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Z1={SlicingMode:N$},_C=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,cg=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:mf}=_i,{SlicingMode:wo}=Z1;function V$(t){const e=t.split(`
`),r=[];for(let n=0;n<e.length;++n){const i=e[n].trim();i.length>0&&r.push(i)}return r}function k$(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function r(n){e.openGLTexture.releaseGraphicsResources(n),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray,e._labelOutlineOpacity].forEach(i=>n.unregisterGraphicsResourceUser(i,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&r(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const o=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(o.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(o.getActiveCamera())}},t.translucentPass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.getCoincidentParameters=(n,i)=>e.renderable.getResolveCoincidentTopology()==Ua.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,n)},t.getShaderTemplate=(n,i,o)=>{n.Vertex=_C,n.Fragment=cg,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Oe.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Oe.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Oe.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,a=Oe.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=o.getProperty().getIndependentComponents();let f=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(o.getProperty().getUseLabelOutline()&&(f=f.concat(["uniform sampler2D labelOutlineTexture1;","uniform sampler2D labelOutlineOpacityTexture1;"])),l){for(let d=1;d<c;d++)f=f.concat([`uniform float cshift${d};`,`uniform float cscale${d};`,`uniform float pwfshift${d};`,`uniform float pwfscale${d};`]);switch(c){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:mf("Unsupported number of independent coordinates.")}}if(s=Oe.substitute(s,"//VTK::TCoord::Dec",f).result,o.getProperty().getUseLabelOutline()===!0&&(s=Oe.substitute(s,"//VTK::LabelOutline::Dec",["uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,s=Oe.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=Oe.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),l){const d=["r","g","b","a"];let h=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let g=0;g<c;g++)h=h.concat([`vec3 tcolor${g} = mix${g} * texture2D(colorTexture1, vec2(tvalue.${d[g]} * cscale${g} + cshift${g}, height${g})).rgb;`,`float compWeight${g} = mix${g} * texture2D(pwfTexture1, vec2(tvalue.${d[g]} * pwfscale${g} + pwfshift${g}, height${g})).r;`]);switch(c){case 1:h=h.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:h=h.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:mf("Unsupported number of independent coordinates.")}s=Oe.substitute(s,"//VTK::TCoord::Impl",h).result}else switch(c){case 1:s=Oe.substitute(s,"//VTK::TCoord::Impl",[...V$(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  float outlineOpacity = texture2D(labelOutlineOpacityTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=Oe.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=Oe.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=Oe.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=Oe.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Oe.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o)},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(dn("OpenGL has a limit of 6 clipping planes"),c=6),a=Oe.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Oe.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Oe.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Oe.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getNeedToRebuildShaders=(n,i,o)=>{const a=e.openGLTexture.getComponents(),s=o.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getProgram()?.getHandle()===0||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<o.getProperty().getMTime()||e.lastTextureComponents!==a||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(n,i,o)=>{if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,i,o)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,i,o);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,i,o),t.setCameraShaderParameters(n,i,o),t.setPropertyShaderParameters(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||mf("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),e.context.FALSE)||mf("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());const a=e.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",a);const s=e.openGLTexture.getComponents(),c=o.getProperty().getIndependentComponents();if(c)for(let d=0;d<s;d++)n.getProgram().setUniformf(`mix${d}`,o.getProperty().getComponentWeight(d));const l=e.openGLTexture.getShiftAndScale();for(let d=0;d<s;d++){let h=o.getProperty().getColorWindow(),g=o.getProperty().getColorLevel();const p=c?d:0,m=o.getProperty().getRGBTransferFunction(p);if(m&&o.getProperty().getUseLookupTableScalarRange()){const y=m.getRange();h=y[1]-y[0],g=.5*(y[1]+y[0])}const w=l.scale/h,v=(l.shift-g)/h+.5;n.getProgram().setUniformf(`cshift${d}`,v),n.getProgram().setUniformf(`cscale${d}`,w)}for(let d=0;d<s;d++){let h=1,g=0;const p=c?d:0,m=o.getProperty().getPiecewiseFunction(p);if(m){const w=m.getRange(),v=w[1]-w[0],y=.5*(w[0]+w[1]);h=l.scale/v,g=(l.shift-y)/v+.5}n.getProgram().setUniformf(`pwfshift${d}`,g),n.getProgram().setUniformf(`pwfscale${d}`,h)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const d=t.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",d.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",d.factor)}const f=e.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",f);const u=e.pwfTexture.getTextureUnit();if(n.getProgram().setUniformi("pwfTexture1",u),o.getProperty().getUseLabelOutline()){const d=e.labelOutlineThicknessTexture.getTextureUnit();n.getProgram().setUniformi("labelOutlineTexture1",d);const h=e.labelOutlineOpacityTexture.getTextureUnit();n.getProgram().setUniformi("labelOutlineOpacityTexture1",h)}if(e.renderable.getNumberOfClippingPlanes()){let d=e.renderable.getNumberOfClippingPlanes();d>6&&(dn("OpenGL has a limit of 6 clipping planes"),d=6);const g=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,p=g?sr(e.imagematinv,o.getMatrix()):o.getMatrix();g&&(mn(p,p),Wt(p,p,g),mn(p,p)),mn(e.imagemat,e.currentInput.getIndexToWorld()),Wt(e.imagematinv,p,e.imagemat);const m=[];for(let w=0;w<d;w++){const v=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,w,v);for(let y=0;y<4;y++)m.push(v[y])}n.getProgram().setUniformi("numClipPlanes",d),n.getProgram().setUniform4fv("clipPlanes",m)}},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();Wt(e.imagemat,s.mcwc,l);const f=e.openGLCamera.getKeyMatrices(i);if(Wt(e.imagemat,f.wcpc,e.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){const d=n.getCABO().getInverseShiftAndScaleMatrix();Wt(e.imagemat,e.imagemat,d)}if(a.setUniformMatrix("MCPCMatrix",e.imagemat),o.getProperty().getUseLabelOutline()===!0){const d=c.getWorldToIndex(),h=c.getDimensions();let g=e.renderable.getClosestIJKAxis().ijkMode;g===wo.NONE&&(g=wo.K),a.setUniform3i("imageDimensions",h[0],h[1],h[2]),a.setUniformi("sliceAxis",g),a.setUniformMatrix("vWCtoIDX",d);const p=e.openGLCamera.getKeyMatrices(i);gr(e.projectionToWorld,p.wcpc),e.openGLCamera.getKeyMatrices(i),a.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const m=t.getRenderTargetSize();a.setUniformf("vpWidth",m[0]),a.setUniformf("vpHeight",m[1]);const w=t.getRenderTargetOffset();a.setUniformf("vpOffsetX",w[0]/m[0]),a.setUniformf("vpOffsetY",w[1]/m[1])}},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram(),c=o.getProperty().getOpacity();a.setUniformf("opacity",c)},t.renderPieceStart=(n,i)=>{t.updateBufferObjects(n,i),e.lastBoundBO=null},t.renderPieceDraw=(n,i)=>{const o=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),i.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.activate(),e.labelOutlineOpacityTexture.activate()),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,i),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),i.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.deactivate(),e.labelOutlineOpacityTexture.deactivate()),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,i)=>{},t.renderPiece=(n,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){mf("No input!");return}t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i)},t.getNeedToRebuildBufferObjects=(n,i)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!e.openGLTexture?.getHandle()||!e.colorTexture?.getHandle()||i.getProperty().getUseLabelOutline()&&(!e.labelOutlineThicknessTexture?.getHandle()||!e.labelOutlineOpacityTexture?.getHandle())||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(!o)return;const a=o.getPointData()&&o.getPointData().getScalars();if(!a)return;const s=a.getDataType(),c=a.getNumberOfComponents(),l=i.getProperty(),f=l.getInterpolationType(),u=l.getIndependentComponents(),d=u?c:1,h=u?2*d:1,g=[];for(let M=0;M<d;++M)g.push(l.getRGBTransferFunction(M));const p=xs(g,u,d),m=l.getRGBTransferFunction(),w=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!w?.oglObject?.getHandle()||w?.hash!==p){e.colorTexture=Kn.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let M=e.renderable.getColorTextureWidth();M<=0&&(M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const R=M*h*3,A=new Uint8ClampedArray(R);if(f===Sl.NEAREST?(e.colorTexture.setMinificationFilter(Mt.NEAREST),e.colorTexture.setMagnificationFilter(Mt.NEAREST)):(e.colorTexture.setMinificationFilter(Mt.LINEAR),e.colorTexture.setMagnificationFilter(Mt.LINEAR)),m){const B=new Float32Array(M*3);for(let k=0;k<d;k++){const L=l.getRGBTransferFunction(k),F=L.getRange();if(L.getTable(F[0],F[1],M,B,1),u)for(let j=0;j<M*3;j++)A[k*M*6+j]=255*B[j],A[k*M*6+j+M*3]=255*B[j];else for(let j=0;j<M*3;j++)A[k*M*6+j]=255*B[j]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:M,height:h,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:A})}else{for(let B=0;B<M*3;++B)A[B]=255*B/((M-1)*3),A[B+1]=255*B/((M-1)*3),A[B+2]=255*B/((M-1)*3);e.colorTexture.create2DFromRaw({width:M,height:1,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:A})}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,p),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=w.oglObject;const y=[];for(let M=0;M<d;++M)y.push(l.getPiecewiseFunction(M));const C=xs(y,u,d),x=l.getPiecewiseFunction(),T=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!T?.oglObject?.getHandle()||T?.hash!==C){let M=e.renderable.getOpacityTextureWidth();M<=0&&(M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const R=M*h,A=new Uint8ClampedArray(R);if(e.pwfTexture=Kn.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),f===Sl.NEAREST?(e.pwfTexture.setMinificationFilter(Mt.NEAREST),e.pwfTexture.setMagnificationFilter(Mt.NEAREST)):(e.pwfTexture.setMinificationFilter(Mt.LINEAR),e.pwfTexture.setMagnificationFilter(Mt.LINEAR)),x){const B=new Float32Array(R),k=new Float32Array(M);for(let L=0;L<d;++L){const F=l.getPiecewiseFunction(L);if(F===null)B.fill(1);else{const j=F.getRange();if(F.getTable(j[0],j[1],M,k,1),u)for(let J=0;J<M;J++)B[L*M*2+J]=k[J],B[L*M*2+J+M]=k[J];else for(let J=0;J<M;J++)B[L*M*2+J]=k[J]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:M,height:h,numComps:1,dataType:Qt.FLOAT,data:B})}else A.fill(255),e.pwfTexture.create2DFromRaw({width:M,height:1,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:A});x&&(e._openGLRenderWindow.setGraphicsResourceForObject(x,e.pwfTexture,C),x!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(x,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=x)}else e.pwfTexture=T.oglObject;i.getProperty().getUseLabelOutline()&&(t.updatelabelOutlineThicknessTexture(i),t.updateLabelOutlineOpacityTexture(i));const{ijkMode:_}=e.renderable.getClosestIJKAxis();let E=e.renderable.getSlice();_!==e.renderable.getSlicingMode()&&(E=e.renderable.getSliceAtPosition(E));const D=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(E),b=o.getExtent();let I;_===wo.I&&(I=D-b[0]),_===wo.J&&(I=D-b[2]),(_===wo.K||_===wo.NONE)&&(I=D-b[4]);const O=`${E}A${o.getMTime()}A${a.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==O){const M=o.getDimensions();e.openGLTexture||(e.openGLTexture=Kn.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),f===Sl.NEAREST?(new Set([1,3,4]).has(c)&&s===Qt.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Mt.NEAREST),e.openGLTexture.setMagnificationFilter(Mt.NEAREST)):(c===4&&s===Qt.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Mt.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(Mt.LINEAR),e.openGLTexture.setMagnificationFilter(Mt.LINEAR)),e.openGLTexture.setWrapS(xh.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(xh.CLAMP_TO_EDGE);const R=M[0]*M[1]*c,A=new Float32Array(12),B=new Float32Array(8);for(let we=0;we<4;we++)B[we*2]=we%2?1:0,B[we*2+1]=we>1?1:0;const k=[wo.X,wo.Y,wo.Z].includes(e.renderable.getSlicingMode())?E:D,L=o.getSpatialExtent(),F=a.getData();let j=null;if(_===wo.I){j=new F.constructor(M[2]*M[1]*c);let we=0;for(let _e=0;_e<M[2];_e++)for(let Te=0;Te<M[1];Te++){let G=(I+Te*M[0]+_e*M[0]*M[1])*c;we=(_e*M[1]+Te)*c;const P=G+c;for(;G<P;)j[we++]=F[G++]}M[0]=M[1],M[1]=M[2],A[0]=k,A[1]=L[2],A[2]=L[4],A[3]=k,A[4]=L[3],A[5]=L[4],A[6]=k,A[7]=L[2],A[8]=L[5],A[9]=k,A[10]=L[3],A[11]=L[5]}else if(_===wo.J){j=new F.constructor(M[2]*M[0]*c);let we=0;for(let _e=0;_e<M[2];_e++)for(let Te=0;Te<M[0];Te++){let G=(Te+I*M[0]+_e*M[0]*M[1])*c;we=(_e*M[0]+Te)*c;const P=G+c;for(;G<P;)j[we++]=F[G++]}M[1]=M[2],A[0]=L[0],A[1]=k,A[2]=L[4],A[3]=L[1],A[4]=k,A[5]=L[4],A[6]=L[0],A[7]=k,A[8]=L[5],A[9]=L[1],A[10]=k,A[11]=L[5]}else _===wo.K||_===wo.NONE?(j=F.subarray(I*R,(I+1)*R),A[0]=L[0],A[1]=L[2],A[2]=k,A[3]=L[1],A[4]=L[2],A[5]=k,A[6]=L[0],A[7]=L[3],A[8]=k,A[9]=L[1],A[10]=L[3],A[11]=k):mf("Reformat slicing not yet supported.");const J=a.getRanges();e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw({width:M[0],height:M[1],numComps:c,dataType:a.getDataType(),data:j,preferSizeOverAccuracy:!!e.renderable.getPreferSizeOverAccuracy?.(),ranges:J}),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const ie=Tt.newInstance({numberOfComponents:3,values:A});ie.setName("points");const fe=Tt.newInstance({numberOfComponents:2,values:B});fe.setName("tcoords");const ae=new Uint16Array(8);ae[0]=3,ae[1]=0,ae[2]=1,ae[3]=3,ae[4]=3,ae[5]=0,ae[6]=3,ae[7]=2;const de=Tt.newInstance({numberOfComponents:1,values:ae});e.tris.getCABO().createVBO(de,"polys",li.SURFACE,{points:ie,tcoords:fe,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=O}},t.updateLabelOutlineOpacityTexture=n=>{let i=n.getProperty().getLabelOutlineOpacity();typeof i=="number"&&(e._cachedLabelOutlineOpacityObj?.[0]===i?i=e._cachedLabelOutlineOpacityObj:i=[i],e._cachedLabelOutlineOpacityObj=i);const o=e._openGLRenderWindow.getGraphicsResourceForObject(i),a=`${i.join("-")}`;if(!o?.oglObject?.getHandle()||o?.hash!==a){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const l=1,f=c*l,u=new Float32Array(f);for(let d=0;d<c;++d)u[d]=i[d]??i[0];e.labelOutlineOpacityTexture=Kn.newInstance({resizable:!1}),e.labelOutlineOpacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineOpacityTexture.resetFormatAndType(),e.labelOutlineOpacityTexture.setMinificationFilter(Mt.NEAREST),e.labelOutlineOpacityTexture.setMagnificationFilter(Mt.NEAREST),e.labelOutlineOpacityTexture.create2DFromRaw({width:c,height:l,numComps:1,dataType:Qt.FLOAT,data:u}),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineOpacityTexture,a),i!==e._labelOutlineOpacity&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineOpacity,t)),e._labelOutlineOpacity=i)}else e.labelOutlineOpacityTexture=o.oglObject},t.updatelabelOutlineThicknessTexture=n=>{const i=n.getProperty().getLabelOutlineThicknessByReference(),o=e._openGLRenderWindow.getGraphicsResourceForObject(i),a=`${i.join("-")}`;if(!o?.oglObject?.getHandle()||o?.hash!==a){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const l=1,f=c*l,u=new Uint8Array(f);for(let d=0;d<c;++d){const h=typeof i[d]<"u"?i[d]:i[0];u[d]=h}e.labelOutlineThicknessTexture=Kn.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Mt.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Mt.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw({width:c,height:l,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:u}),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,a),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=o.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:n,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:n,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,i]},t.delete=ng(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const F$={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineOpacityTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function U$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,F$,r),Yn.extend(t,e,r),Cs.implementReplaceShaderCoincidentOffset(t,e,r),Cs.implementBuildShadersWithReplacements(t,e,r),e.tris=Fa.newInstance(),e.imagemat=_t(new Float64Array(16)),e.imagematinv=_t(new Float64Array(16)),e.projectionToWorld=_t(new Float64Array(16)),e.idxToView=_t(new Float64Array(16)),e.idxNormalMatrix=Ao(new Float64Array(9)),e.modelToView=_t(new Float64Array(16)),e.projectionToView=_t(new Float64Array(16)),Er(t,e,[]),e.VBOBuildTime={},Zn(e.VBOBuildTime),k$(t,e)}const O6=On(U$,"vtkOpenGLImageMapper");var B$={newInstance:O6};Vr("vtkAbstractImageMapper",O6);const uu={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:Xg}=K;function G$(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function r(n){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>n.unregisterGraphicsResourceUser(i,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&r(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(n,i)=>e.renderable.getResolveCoincidentTopology()===Ua.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,n)},t.renderPiece=(n,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i))},t.renderPieceStart=(n,i)=>{t.updateBufferObjects(n,i)},t.renderPieceDraw=(n,i)=>{const o=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,i),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,i)=>{},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i),i.getProperty().getInterpolationType()===Sl.NEAREST?(e.volumeTexture.setMinificationFilter(Mt.NEAREST),e.volumeTexture.setMagnificationFilter(Mt.NEAREST),e.colorTexture.setMinificationFilter(Mt.NEAREST),e.colorTexture.setMagnificationFilter(Mt.NEAREST),e.pwfTexture.setMinificationFilter(Mt.NEAREST),e.pwfTexture.setMagnificationFilter(Mt.NEAREST)):(e.volumeTexture.setMinificationFilter(Mt.LINEAR),e.volumeTexture.setMagnificationFilter(Mt.LINEAR),e.colorTexture.setMinificationFilter(Mt.LINEAR),e.colorTexture.setMagnificationFilter(Mt.LINEAR),e.pwfTexture.setMinificationFilter(Mt.LINEAR),e.pwfTexture.setMagnificationFilter(Mt.LINEAR))},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return o<t.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentImageDataInput.getMTime()||o<e.currentCenterlineInput.getMTime()||!e.volumeTexture?.getHandle()},t.buildBufferObjects=(n,i)=>{const o=e.currentImageDataInput,a=e.currentCenterlineInput,s=i.getProperty(),c=o?.getPointData()?.getScalars();if(!c)return;const l=e._openGLRenderWindow.getGraphicsResourceForObject(c),f=TC(o,c),u=!l?.oglObject?.getHandle()||l?.hash!==f,d=s.getUpdatedExtents(),h=!!d.length;if(u){e.volumeTexture=Kn.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const O=o.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray({width:O[0],height:O[1],depth:O[2],dataArray:c,preferSizeOverAccuracy:e.renderable.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(c,e.volumeTexture,f),c!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=c}else e.volumeTexture=l.oglObject;if(h){s.setUpdatedExtents([]);const O=o.getDimensions();e.volumeTexture.create3DFilterableFromDataArray({width:O[0],height:O[1],depth:O[2],dataArray:c,updatedExtents:d})}const g=c.getNumberOfComponents(),p=i.getProperty(),m=p.getIndependentComponents(),w=m?g:1,v=m?2*w:1,y=[];for(let O=0;O<w;++O)y.push(p.getRGBTransferFunction(O));const C=xs(y,m,w),x=p.getRGBTransferFunction(),T=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!T?.oglObject?.getHandle()||T?.hash!==C){let O=e.renderable.getColorTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*v*3,R=new Uint8ClampedArray(M);if(e.colorTexture=Kn.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),x){const A=new Float32Array(O*3);for(let B=0;B<w;B++){const k=p.getRGBTransferFunction(B),L=k.getRange();if(k.getTable(L[0],L[1],O,A,1),m)for(let F=0;F<O*3;F++)R[B*O*6+F]=255*A[F],R[B*O*6+F+O*3]=255*A[F];else for(let F=0;F<O*3;F++)R[B*O*6+F]=255*A[F]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:O,height:v,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:R})}else{for(let A=0;A<O*3;++A)R[A]=255*A/((O-1)*3),R[A+1]=255*A/((O-1)*3),R[A+2]=255*A/((O-1)*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:O,height:1,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:R})}x&&(e._openGLRenderWindow.setGraphicsResourceForObject(x,e.colorTexture,C),x!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(x,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=x)}else e.colorTexture=T.oglObject;const _=[];for(let O=0;O<w;++O)_.push(p.getPiecewiseFunction(O));const E=xs(_,m,w),D=p.getPiecewiseFunction(),b=e._openGLRenderWindow.getGraphicsResourceForObject(D);if(!b?.oglObject?.getHandle()||b?.hash!==E){let O=e.renderable.getOpacityTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*v,R=new Uint8ClampedArray(M);if(e.pwfTexture=Kn.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),D){const A=new Float32Array(M),B=new Float32Array(O);for(let k=0;k<w;++k){const L=p.getPiecewiseFunction(k);if(L===null)A.fill(1);else{const F=L.getRange();if(L.getTable(F[0],F[1],O,B,1),m)for(let j=0;j<O;j++)A[k*O*2+j]=B[j],A[k*O*2+j+O]=B[j];else for(let j=0;j<O;j++)A[k*O*2+j]=B[j]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:O,height:v,numComps:1,dataType:Qt.FLOAT,data:A})}else R.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:O,height:1,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:R});D&&(e._openGLRenderWindow.setGraphicsResourceForObject(D,e.pwfTexture,E),D!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(D,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=D)}else e.pwfTexture=b.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()){const O=a.getNumberOfPoints(),M=O<=1?0:O-1,R=a.getDistancesToFirstPoint(),A=e.renderable.getHeight(),B=4*M,k=new Float32Array(3*B),L=e.renderable.getWidth();for(let P=0,$=0;P<M;++P)k.set([0,A-R[P],0],$),$+=3,k.set([L,A-R[P],0],$),$+=3,k.set([L,A-R[P+1],0],$),$+=3,k.set([0,A-R[P+1],0],$),$+=3;const F=Tt.newInstance({numberOfComponents:3,values:k});F.setName("points");const j=new Uint16Array(5*M);for(let P=0,$=0,W=0;P<M;++P)j.set([4,W+3,W+2,W+1,W],$),$+=5,W+=4;const J=Tt.newInstance({numberOfComponents:1,values:j}),ie=a.getPoints(),fe=new Float32Array(3*B),ae=new Array(3),de=new Array(3);for(let P=0,$=0;P<M;++P)ie.getPoint(P,ae),ie.getPoint(P+1,de),fe.set(ae,$),$+=3,fe.set(ae,$),$+=3,fe.set(de,$),$+=3,fe.set(de,$),$+=3;const we=Tt.newInstance({numberOfComponents:3,values:fe,name:"centerlinePosition"}),_e=new Float32Array(B);for(let P=0,$=0;P<M;++P)_e.set([0,1,3,2],$),$+=4;const Te=Tt.newInstance({numberOfComponents:1,values:_e,name:"quadIndex"}),G=[we,Te];if(!e.renderable.getUseUniformOrientation()){const P=e.renderable.getOrientedCenterline().getOrientations()??[],$=new Float32Array(4*B),W=new Float32Array(4*B);for(let ee=0;ee<M;++ee){const ge=P[ee],De=P[ee+1];for(let Ne=0;Ne<4;++Ne){const re=4*(Ne+4*ee);$.set(ge,re),W.set(De,re)}}const q=Tt.newInstance({numberOfComponents:4,values:$,name:"centerlineTopOrientation"}),Q=Tt.newInstance({numberOfComponents:4,values:W,name:"centerlineBotOrientation"});G.push(q,Q)}e.tris.getCABO().createVBO(J,"polys",li.SURFACE,{points:F,customAttributes:G}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(n,i,o)=>{const a=e.volumeTexture.getComponents(),s=o.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),f=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return n.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==a||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=f,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(n,i,o)=>{t.getShaderTemplate(n,i,o),t.replaceShaderValues(n,i,o)},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];a=Oe.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Oe.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],f=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),f&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),a=Oe.substitute(a,"//VTK::Color::Dec",l).result;const d=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(d.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),f&&d.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):d.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),a=Oe.substitute(a,"//VTK::Color::Impl",d).result;const h=e.volumeTexture.getComponents(),g=o.getProperty().getIndependentComponents();let p=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];f&&p.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(p.push("in vec3 samplingDirVSOutput;"),f&&p.push("in vec3 projectionDirVSOutput;")):(p.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),f&&p.push("uniform vec3 bitangentDirection;"));const m=e.renderable.getCenterPoint();if(m&&p.push("uniform vec3 globalCenterPoint;"),g){for(let v=1;v<h;v++)p=p.concat([`uniform float cshift${v};`,`uniform float cscale${v};`,`uniform float pwfshift${v};`,`uniform float pwfscale${v};`]);switch(h){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Xg("Unsupported number of independent coordinates.")}}s=Oe.substitute(s,"//VTK::TCoord::Dec",p).result;let w=[];if(u?(w.push("vec3 samplingDirection = samplingDirVSOutput;"),f&&w.push("vec3 projectionDirection = projectionDirVSOutput;")):(w.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),f&&w.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?w.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):w.push("float horizontalOffset = quadOffsetVSOutput.x;"),w.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),f){const v=e.renderable.getProjectionMode();switch(v){case uu.MIN:w.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case uu.MAX:case uu.AVERAGE:default:w.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(w.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),v){case uu.MAX:w.push("  tvalue = max(tvalue, sampledTextureValue);");break;case uu.MIN:w.push("  tvalue = min(tvalue, sampledTextureValue);");break;case uu.AVERAGE:default:w.push("  tvalue = tvalue + sampledTextureValue;");break}w.push("}"),v===uu.AVERAGE&&w.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else w.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(g){const v=["r","g","b","a"];for(let y=0;y<h;++y)w=w.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${v[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${v[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(h){case 1:w=w.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:w=w.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:w=w.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:w=w.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Xg("Unsupported number of independent coordinates.")}}else switch(h){case 1:w=w.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:w=w.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:w=w.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:w=w.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=Oe.substitute(s,"//VTK::TCoord::Impl",w).result,e.haveSeenDepthRequest&&(s=Oe.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Oe.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o)},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(K.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),a=Oe.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Oe.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Oe.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Oe.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getShaderTemplate=(n,i,o)=>{n.Vertex=_C,n.Fragment=cg,n.Geometry=""},t.setMapperShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=n.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(a.isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(a,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||Xg("Error setting vertexMC in shader VAO.")),n.getCABO().getCustomData().forEach(h=>{h&&a.isAttributeUsed(h.name)&&!n.getVAO().addAttributeArray(a,s,h.name,h.offset,s.getStride(),e.context.FLOAT,h.components,e.context.FALSE)&&Xg(`Error setting ${h.name} in shader VAO.`)}),n.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(a.setUniformi("volumeTexture",c),a.setUniformf("width",e.renderable.getWidth()),n.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),a.isUniformUsed("tangentDirection")){const h=e.renderable.getTangentDirection();n.getProgram().setUniform3fArray("tangentDirection",h)}if(a.isUniformUsed("bitangentDirection")){const h=e.renderable.getBitangentDirection();n.getProgram().setUniform3fArray("bitangentDirection",h)}if(a.isUniformUsed("centerlineOrientation")){const h=e.renderable.getUniformOrientation();n.getProgram().setUniform4fv("centerlineOrientation",h)}if(a.isUniformUsed("globalCenterPoint")){const h=e.renderable.getCenterPoint();a.setUniform3fArray("globalCenterPoint",h)}if(e.renderable.isProjectionEnabled()){const h=e.currentImageDataInput,g=h.getSpacing(),p=h.getDimensions(),m=e.renderable.getProjectionSlabThickness(),w=e.renderable.getProjectionSlabNumberOfSamples(),v=aU([],g,p);a.setUniform3fArray("volumeSizeMC",v),a.setUniformi("projectionSlabNumberOfSamples",w);const y=-.5*m;a.setUniformf("projectionConstantOffset",y);const C=m/(w-1);a.setUniformf("projectionStepLength",C)}const l=e.currentImageDataInput,f=l.getWorldToIndex(),u=W1(new Float32Array(16),Em([],l.getDimensions())),d=_m(u,u,f);if(a.setUniformMatrix("MCTCMatrix",d),e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(K.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),h=6);const p=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,m=p?sr(e.imagematinv,o.getMatrix()):o.getMatrix();p&&(mn(m,m),Wt(m,m,p),mn(m,m)),mn(e.imagemat,e.currentImageDataInput.getIndexToWorld()),Wt(e.imagematinv,m,e.imagemat);const w=[];for(let v=0;v<h;v++){const y=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,v,y);for(let C=0;C<4;C++)w.push(y[C])}a.setUniformi("numClipPlanes",h),a.setUniform4fv("clipPlanes",w)}if(a.isUniformUsed("coffset")){const h=t.getCoincidentParameters(i,o);a.setUniformf("coffset",h.offset),a.isUniformUsed("cfactor")&&a.setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(n,i,o)=>{const a=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(Wt(e.imagemat,s,a),n.getCABO().getCoordShiftAndScaleEnabled()){const c=n.getCABO().getInverseShiftAndScaleMatrix();Wt(e.imagemat,e.imagemat,c)}n.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=o.getProperty(),c=s.getOpacity();a.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),f=s.getIndependentComponents();if(f)for(let g=0;g<l;++g)a.setUniformf(`mix${g}`,s.getComponentWeight(g));const u=e.volumeTexture.getVolumeInfo();for(let g=0;g<l;g++){let p=s.getColorWindow(),m=s.getColorLevel();const w=f?g:0,v=s.getRGBTransferFunction(w);if(v&&s.getUseLookupTableScalarRange()){const x=v.getRange();p=x[1]-x[0],m=.5*(x[1]+x[0])}const y=u.scale[g]/p,C=(u.offset[g]-m)/p+.5;a.setUniformf(`cshift${g}`,C),a.setUniformf(`cscale${g}`,y)}const d=e.colorTexture.getTextureUnit();a.setUniformi("colorTexture1",d);for(let g=0;g<l;g++){let p=1,m=0;const w=f?g:0,v=s.getPiecewiseFunction(w);if(v){const y=v.getRange(),C=y[1]-y[0],x=.5*(y[0]+y[1]);p=u.scale[g]/C,m=(u.offset[g]-x)/C+.5}a.setUniformf(`pwfshift${g}`,m),a.setUniformf(`pwfscale${g}`,p)}const h=e.pwfTexture.getTextureUnit();a.setUniformi("pwfTexture1",h)},t.updateShaders=(n,i,o)=>{if(t.getNeedToRebuildShaders(n,i,o)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,i,o);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,i,o),t.setCameraShaderParameters(n,i,o),t.setPropertyShaderParameters(n,i,o)},t.delete=K.chain(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const W$={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function $$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,W$,r),Yn.extend(t,e,r),Cs.implementReplaceShaderCoincidentOffset(t,e,r),K.algo(t,e,2,0),e.tris=Fa.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=_t(new Float64Array(16)),e.imagematinv=_t(new Float64Array(16)),e.VBOBuildTime={},K.obj(e.VBOBuildTime,{mtime:0}),G$(t,e)}const P6=K.newInstance($$,"vtkOpenGLImageCPRMapper"),z$={};var j$={newInstance:P6,...z$};Vr("vtkImageCPRMapper",P6);function H$(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{r&&e.context.depthMask(!0)},t.translucentPass=(r,n)=>{e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(sr(e.keyMatrices.mcwc,e.renderable.getMatrix()),mn(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const K$={context:null,keyMatrixTime:null,keyMatrices:null};function X$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K$,r),Yn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:_t(new Float64Array(16))},Er(t,e,["context"]),H$(t,e)}const R6=On(X$,"vtkOpenGLImageSlice");var q$={newInstance:R6};Vr("vtkImageSlice",R6);function Y$(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=r=>{!e.renderable||!e.renderable.getVisibility()||r&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementVolumeCount()}},t.traverseVolumePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0].traverse(r),t.apply(r,!1))},t.volumePass=r=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),sr(e.MCWCMatrix,e.renderable.getMatrix()),mn(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?Ao(e.normalMatrix):(xl(e.normalMatrix,e.MCWCMatrix),xc(e.normalMatrix,e.normalMatrix),g0(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const J$={};function Z$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,J$,r),Yn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Er(t,e,["context"]),Y$(t,e)}const A6=On(Z$,"vtkOpenGLVolume");var Q$={newInstance:A6};Vr("vtkVolume",A6);function ez(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=r=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=r=>{},t.restorePreviousBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=r=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=r=>{},t.bind=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(r,n)=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){dn("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let o=i.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())o+=n;else{dn("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,i.framebufferTexture2D(i.FRAMEBUFFER,o,i.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=e.context;if(!n){dn("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())i+=r;else{dn("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,i,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=r=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else dn("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else dn("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const r=e.context,n=Kn.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(Mt.LINEAR),n.setMagnificationFilter(Mt.LINEAR),n.create2DFromRaw({width:e.glFramebuffer.width,height:e.glFramebuffer.height,numComps:4,dataType:Qt.UNSIGNED_CHAR,data:null}),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const tz={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function L6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tz,r),Zn(t,e),e.colorBuffers&&dn("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],O0(t,e,["colorBuffers"]),ez(t,e)}const nz=On(L6,"vtkFramebuffer");var lg={newInstance:nz,extend:L6},rz=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,iz=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

const float infinity = 3.402823466e38;

// the output of this shader
//VTK::Output::Dec

in vec3 vertexVCVSOutput;

// From Sources\\Rendering\\Core\\VolumeProperty\\Constants.js
#define COMPOSITE_BLEND 0
#define MAXIMUM_INTENSITY_BLEND 1
#define MINIMUM_INTENSITY_BLEND 2
#define AVERAGE_INTENSITY_BLEND 3
#define ADDITIVE_INTENSITY_BLEND 4
#define RADON_TRANSFORM_BLEND 5
#define LABELMAP_EDGE_PROJECTION_BLEND 6

#define vtkNumberOfLights //VTK::NumberOfLights
#define vtkMaxLaoKernelSize //VTK::MaxLaoKernelSize
#define vtkNumberOfComponents //VTK::NumberOfComponents
#define vtkBlendMode //VTK::BlendMode
#define vtkMaximumNumberOfSamples //VTK::MaximumNumberOfSamples

//VTK::EnabledColorFunctions

//VTK::EnabledLightings

//VTK::EnabledMultiTexturePerVolume

//VTK::EnabledGradientOpacity

//VTK::EnabledIndependentComponents

//VTK::vtkProportionalComponents

//VTK::vtkForceNearestComponents

uniform int twoSidedLighting;

#if vtkMaxLaoKernelSize > 0
  vec2 kernelSample[vtkMaxLaoKernelSize];
#endif

// Textures
#ifdef EnabledMultiTexturePerVolume
  #define vtkNumberOfVolumeTextures vtkNumberOfComponents
#else
  #define vtkNumberOfVolumeTextures 1
#endif
uniform highp sampler3D volumeTexture[vtkNumberOfVolumeTextures];
uniform sampler2D colorTexture;
uniform sampler2D opacityTexture;
uniform sampler2D jtexture;
uniform sampler2D labelOutlineThicknessTexture;

struct Volume {
  // ---- Volume geometry settings ----

  vec3 originVC;          // in VC
  vec3 spacing;           // in VC per IC
  vec3 inverseSpacing;    // 1/spacing
  ivec3 dimensions;       // in IC
  vec3 inverseDimensions; // 1/vec3(dimensions)
  mat3 vecISToVCMatrix;   // convert from IS to VC without translation
  mat3 vecVCToISMatrix;   // convert from VC to IS without translation
  mat4 PCWCMatrix;
  mat4 worldToIndex;
  float diagonalLength; // in VC, this is: length(size)

  // ---- Texture settings ----

  // Texture shift and scale
  vec4 colorTextureScale;
  vec4 colorTextureShift;
  vec4 opacityTextureScale;
  vec4 opacityTextureShift;

  // The heights defined below are the locations for the up to four components
  // of the transfer functions. The transfer functions have a height of (2 *
  // numberOfComponents) pixels so the values are computed to hit the middle of
  // the two rows for that component
  vec4 transferFunctionsSampleHeight;

  // ---- Mode specific settings ----

  // Independent component default preset settings per component
  vec4 independentComponentMix;

  // Additive / average blending mode settings
  vec4 ipScalarRangeMin;
  vec4 ipScalarRangeMax;

  // ---- Rendering settings ----

  // Lighting
  float ambient;
  float diffuse;
  float specular;
  float specularPower;
  int computeNormalFromOpacity;

  // Gradient opacity
  vec4 gradientOpacityScale;
  vec4 gradientOpacityShift;
  vec4 gradientOpacityMin;
  vec4 gradientOpacityMax;

  // Volume shadow
  float volumetricScatteringBlending;
  float globalIlluminationReach;
  float anisotropy;
  float anisotropySquared;

  // LAO
  int kernelSize;
  int kernelRadius;

  // Label outline
  float outlineOpacity;
};
uniform Volume volume;

struct Light {
  vec3 color;
  vec3 positionVC;
  vec3 directionVC; // normalized
  vec3 halfAngleVC;
  vec3 attenuation;
  float exponent;
  float coneAngle;
  int isPositional;
};
#if vtkNumberOfLights > 0
  uniform Light lights[vtkNumberOfLights];
#endif

uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;

// Bitmasks for label outline
const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
#define MAX_SEGMENTS 256
#define UINT_SIZE 32
// We add UINT_SIZE - 1, as we want the ceil of the division instead of the
// floor
#define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)
uint labelOutlineBitmasks[BITMASK_SIZE];

// Set the corresponding bit in the bitmask
void setLabelOutlineBit(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  labelOutlineBitmasks[arrayIndex] |= 1u << bitIndex;
}

// Check if a bit is set in the bitmask
bool isLabelOutlineBitSet(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  return ((labelOutlineBitmasks[arrayIndex] & (1u << bitIndex)) != 0u);
}

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

//VTK::ClipPlane::Dec

// A random number between 0 and 1 that only depends on the fragment
// It uses the jtexture, so this random seed repeats by blocks of 32 fragments
// in screen space
float fragmentSeed;

// sample texture is global
uniform float sampleDistance;
uniform float volumeShadowSampleDistance;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics
// rendering module is complete)
vec3 rayDirVC;

#define INV4PI 0.0796
#define EPSILON 0.001
#define PI 3.1415
#define PI2 9.8696

vec4 rawSampleTexture(vec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    rawSample[0] = texture(volumeTexture[0], pos)[0];
  #if vtkNumberOfComponents > 1
    rawSample[1] = texture(volumeTexture[1], pos)[0];
  #endif
  #if vtkNumberOfComponents > 2
    rawSample[2] = texture(volumeTexture[2], pos)[0];
  #endif
  #if vtkNumberOfComponents > 3
    rawSample[3] = texture(volumeTexture[3], pos)[0];
  #endif
    return rawSample;
  #else
    return texture(volumeTexture[0], pos);
  #endif
}

vec4 rawFetchTexture(ivec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    #if vtkNumberOfComponents > 0
      rawSample[0] = texelFetch(volumeTexture[0], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 1
      rawSample[1] = texelFetch(volumeTexture[1], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 2
      rawSample[2] = texelFetch(volumeTexture[2], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 3
      rawSample[3] = texelFetch(volumeTexture[3], pos, 0)[0];
    #endif
    return rawSample;
  #else
    return texelFetch(volumeTexture[0], pos, 0);
  #endif
}

vec4 getTextureValue(vec3 pos) {
  vec4 tmp = rawSampleTexture(pos);

  // Force nearest
  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volume.dimensions)) + 0.5) *
                      volume.inverseDimensions;
    vec4 nearestValue = rawSampleTexture(nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  // Set alpha when using dependent components
  #ifndef EnabledIndependentComponents
    #if vtkNumberOfComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumberOfComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumberOfComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

// \`height\` is usually \`volume.transferFunctionsSampleHeight[component]\`
// when using independent component and \`0.5\` otherwise. Don't move the if
// statement in these function, as the callers usually already knows if it is
// using independent component or not
float getOpacityFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.opacityTextureScale[component] +
                       volume.opacityTextureShift[component];
  return texture2D(opacityTexture, vec2(scaledScalar, height)).r;
}
vec3 getColorFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.colorTextureScale[component] +
                       volume.colorTextureShift[component];
  return texture2D(colorTexture, vec2(scaledScalar, height)).rgb;
}

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
vec3 posIStoVC(vec3 posIS) {
  return volume.vecISToVCMatrix * posIS + volume.originVC;
}

// convert vector position from vc to idx
vec3 posVCtoIS(vec3 posVC) {
  return volume.vecVCToISMatrix * (posVC - volume.originVC);
}

// Rotate vector to view coordinate
vec3 vecISToVC(vec3 dirIS) {
  return volume.vecISToVCMatrix * dirIS;
}

// Rotate vector to idx coordinate
vec3 vecVCToIS(vec3 dirVC) {
  return volume.vecVCToISMatrix * dirVC;
}

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(float normalMag, int component) {
  float goscale = volume.gradientOpacityScale[component];
  float goshift = volume.gradientOpacityShift[component];
  float gomin = volume.gradientOpacityMin[component];
  float gomax = volume.gradientOpacityMax[component];
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

#ifdef vtkClippingPlanesOn
  bool isPointClipped(vec3 posVC) {
    for (int i = 0; i < clip_numPlanes; ++i) {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0) {
        return true;
      }
    }
    return false;
  }
#endif

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward
// difference

// The output normal is in VC
vec4 computeDensityNormal(vec3 opacityUCoords[2], float opacityTextureHeight,
                          float gradientOpacity, int component) {
  // Pass the scalars through the opacity functions
  vec4 opacityG;
  opacityG.x += getOpacityFromTexture(opacityUCoords[0].x, component,
                                      opacityTextureHeight);
  opacityG.y += getOpacityFromTexture(opacityUCoords[0].y, component,
                                      opacityTextureHeight);
  opacityG.z += getOpacityFromTexture(opacityUCoords[0].z, component,
                                      opacityTextureHeight);
  opacityG.x -= getOpacityFromTexture(opacityUCoords[1].x, component,
                                      opacityTextureHeight);
  opacityG.y -= getOpacityFromTexture(opacityUCoords[1].y, component,
                                      opacityTextureHeight);
  opacityG.z -= getOpacityFromTexture(opacityUCoords[1].z, component,
                                      opacityTextureHeight);

  // Divide by spacing and convert to VC
  opacityG.xyz *= gradientOpacity * volume.inverseSpacing;
  opacityG.w = length(opacityG.xyz);
  if (opacityG.w == 0.0) {
    return vec4(0.0);
  }

  // Normalize
  opacityG.xyz = normalize(vecISToVC(opacityG.xyz));

  return opacityG;
}

// The output normal is in VC
vec4 computeNormalForDensity(vec3 posIS, out vec3 scalarInterp[2],
                             const int opacityComponent) {
  vec3 offsetedPosIS;
  for (int axis = 0; axis < 3; ++axis) {
    // Positive direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] += volume.inverseDimensions[axis];
    scalarInterp[0][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[0][axis] = 0.0;
      }
    #endif

    // Negative direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] -= volume.inverseDimensions[axis];
    scalarInterp[1][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[1][axis] = 0.0;
      }
    #endif
  }

  vec4 result;
  result.xyz = (scalarInterp[0] - scalarInterp[1]) * volume.inverseSpacing;
  result.w = length(result.xyz);
  if (result.w == 0.0) {
    return vec4(0.0);
  }
  result.xyz = normalize(vecISToVC(result.xyz));
  return result;
}

vec4 fragCoordToPCPos(vec4 fragCoord) {
  return vec4((fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
              (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
              (fragCoord.z - 0.5) * 2.0, 1.0);
}

vec4 pcPosToWorldCoord(vec4 pcPos) {
  return volume.PCWCMatrix * pcPos;
}

vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  vec4 vertex = (worldCoord / worldCoord.w);

  vec3 index = (volume.worldToIndex * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) * volume.inverseDimensions;
}

vec3 fragCoordToWorld(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  return worldCoord.xyz;
}

//=======================================================================
// Compute the normals and gradient magnitudes for a position for independent
// components The output normals are in VC
mat4 computeMat4Normal(vec3 posIS, vec4 tValue) {
  vec3 xvec = vec3(volume.inverseDimensions.x, 0.0, 0.0);
  vec3 yvec = vec3(0.0, volume.inverseDimensions.y, 0.0);
  vec3 zvec = vec3(0.0, 0.0, volume.inverseDimensions.z);

  vec4 distX = getTextureValue(posIS + xvec) - getTextureValue(posIS - xvec);
  vec4 distY = getTextureValue(posIS + yvec) - getTextureValue(posIS - yvec);
  vec4 distZ = getTextureValue(posIS + zvec) - getTextureValue(posIS - zvec);

  // divide by spacing
  distX *= 0.5 * volume.inverseSpacing.x;
  distY *= 0.5 * volume.inverseSpacing.y;
  distZ *= 0.5 * volume.inverseSpacing.z;

  mat4 result;

  // optionally compute the 1st component
  #if vtkNumberOfComponents > 0 && !defined(vtkComponent0Proportional)
    {
      const int component = 0;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 2nd component
  #if vtkNumberOfComponents > 1 && !defined(vtkComponent1Proportional)
    {
      const int component = 1;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 3rd component
  #if vtkNumberOfComponents > 2 && !defined(vtkComponent2Proportional)
    {
      const int component = 2;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 4th component
  #if vtkNumberOfComponents > 3 && !defined(vtkComponent3Proportional)
    {
      const int component = 3;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  return result;
}

//=======================================================================
// global shadow - secondary ray

// henyey greenstein phase function
float phaseFunction(float cos_angle) {
  // divide by 2.0 instead of 4pi to increase intensity
  float anisotropy = volume.anisotropy;
  if (abs(anisotropy) <= EPSILON) {
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    return 0.5;
  }
  float anisotropy2 = volume.anisotropySquared;
  return ((1.0 - anisotropy2) /
          pow(1.0 + anisotropy2 - 2.0 * anisotropy * cos_angle, 1.5)) /
         2.0;
}

// Compute the two intersection distances of the ray with the volume in VC
// The entry point is \`rayOriginVC + distanceMin * rayDirVC\` and the exit point
// is \`rayOriginVC + distanceMax * rayDirVC\` If distanceMin < distanceMax, the
// volume is not intersected The ray origin is inside the box when distanceMin <
// 0.0 < distanceMax
vec2 rayIntersectVolumeDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  // Compute origin and direction in IS
  vec3 rayOriginIS = posVCtoIS(rayOriginVC);
  vec3 rayDirIS = vecVCToIS(rayDirVC);
  // Don't check for infinity as the min/max combination afterward will always
  // find an intersection before infinity
  vec3 invDir = 1.0 / rayDirIS;

  // We have: bound = origin + t * dir
  // So: t = (1/dir) * (bound - origin)
  vec3 distancesTo0 = invDir * (vec3(0.0) - rayOriginIS);
  vec3 distancesTo1 = invDir * (vec3(1.0) - rayOriginIS);
  // Min and max distances to plane intersection per plane
  vec3 dMinPerAxis = min(distancesTo0, distancesTo1);
  vec3 dMaxPerAxis = max(distancesTo0, distancesTo1);
  // Overall first and last intersection
  float distanceMin = max(dMinPerAxis.x, max(dMinPerAxis.y, dMinPerAxis.z));
  float distanceMax = min(dMaxPerAxis.x, min(dMaxPerAxis.y, dMaxPerAxis.z));
  return vec2(distanceMin, distanceMax);
}

//=======================================================================
// local ambient occlusion
#if vtkMaxLaoKernelSize > 0

  // Return a random point on the unit sphere
  vec3 sampleDirectionUniform(int rayIndex) {
    // Each ray of each fragment should be different, two sources of randomness
    // are used. Only depends on ray index
    vec2 rayRandomness = kernelSample[rayIndex];
    // Only depends on fragment
    float fragmentRandomness = fragmentSeed;
    // Merge both source of randomness in a single uniform random variable using
    // the formula (x+y < 1 ? x+y : x+y-1). The simpler formula (x+y)/2 doesn't
    // result in a uniform distribution
    vec2 mergedRandom = rayRandomness + vec2(fragmentRandomness);
    mergedRandom -= vec2(greaterThanEqual(mergedRandom, vec2(1.0)));

    // Insipred by:
    // https://karthikkaranth.me/blog/generating-random-points-in-a-sphere/#better-choice-of-spherical-coordinates
    float u = mergedRandom[0];
    float v = mergedRandom[1];
    float theta = u * 2.0 * PI;
    float phi = acos(2.0 * v - 1.0);
    float sinTheta = sin(theta);
    float cosTheta = cos(theta);
    float sinPhi = sin(phi);
    float cosPhi = cos(phi);
    return vec3(sinPhi * cosTheta, sinPhi * sinTheta, cosPhi);
  }

  float computeLAO(vec3 posVC, vec4 normalVC, float originalOpacity) {
    // apply LAO only at selected locations, otherwise return full brightness
    if (normalVC.w <= 0.0 || originalOpacity <= 0.05) {
      return 1.0;
    }

    #ifdef EnabledGradientOpacity
      float gradientOpacityFactor = computeGradientOpacityFactor(normalVC.w, 0);
    #endif

    float visibilitySum = 0.0;
    float weightSum = 0.0;
    for (int i = 0; i < volume.kernelSize; i++) {
      // Only sample on an hemisphere around the normalVC.xyz axis, so
      // normalDotRay should be negative
      vec3 rayDirectionVC = sampleDirectionUniform(i);
      float normalDotRay = dot(normalVC.xyz, rayDirectionVC);
      if (normalDotRay > 0.0) {
        // Flip rayDirectionVC when it is in the wrong hemisphere
        rayDirectionVC = -rayDirectionVC;
        normalDotRay = -normalDotRay;
      }

      vec3 currPosIS = posVCtoIS(posVC);
      float visibility = 1.0;
      vec3 randomDirStepIS = vecVCToIS(rayDirectionVC * sampleDistance);
      for (int j = 0; j < volume.kernelRadius; j++) {
        currPosIS += randomDirStepIS;
        // If out of the volume, we are done
        if (any(lessThan(currPosIS, vec3(0.0))) ||
            any(greaterThan(currPosIS, vec3(1.0)))) {
          break;
        }
        float opacity = getOpacityFromTexture(getTextureValue(currPosIS).r, 0, 0.5);
        #ifdef EnabledGradientOpacity
          opacity *= gradientOpacityFactor;
        #endif
        visibility *= 1.0 - opacity;
        // If visibility is less than EPSILON, consider it to be 0
        if (visibility < EPSILON) {
          visibility = 0.0;
          break;
        }
      }
      float rayWeight = -normalDotRay;
      visibilitySum += visibility * rayWeight;
      weightSum += rayWeight;
    }

    // If no sample, LAO factor is one
    if (weightSum == 0.0) {
      return 1.0;
    }

    // LAO factor is the average visibility:
    // - visibility low => ambient low
    // - visibility high => ambient high
    float lao = visibilitySum / weightSum;

    // Reduce variance by clamping
    return clamp(lao, 0.3, 1.0);
  }
#endif

//=======================================================================
// Volume shadows
#if vtkNumberOfLights > 0

  // Non-memoised version
  float computeVolumeShadowWithoutCache(vec3 posVC, vec3 lightDirNormVC) {
    // modify sample distance with a random number between 1.5 and 3.0
    float rayStepLength =
        volumeShadowSampleDistance * mix(1.5, 3.0, fragmentSeed);

    // in case the first sample near surface has a very tiled light ray, we need
    // to offset start position
    vec3 initialPosVC = posVC + rayStepLength * lightDirNormVC;

    #ifdef vtkClippingPlanesOn
      float clippingPlanesMaxDistance = infinity;
      for (int i = 0; i < clip_numPlanes; ++i) {
        // Find distance of intersection with the plane
        // Points are clipped when:
        // dot(planeOrigin - (rayOrigin + distance * rayDirection), planeNormal) > 0
        // This is equivalent to:
        // dot(planeOrigin - rayOrigin, planeNormal) - distance * dot(rayDirection,
        // planeNormal) > 0.0
        // We precompute the dot products, so we clip ray points when:
        // dotOrigin - distance * dotDirection > 0.0
        float dotOrigin =
            dot(vClipPlaneOrigins[i] - initialPosVC, vClipPlaneNormals[i]);
        if (dotOrigin > 0.0) {
          // The initialPosVC is clipped by this plane
          return 1.0;
        }
        float dotDirection = dot(lightDirNormVC, vClipPlaneNormals[i]);
        if (dotDirection < 0.0) {
          // We only hit the plane if dotDirection is negative, as (distance is
          // positive)
          float intersectionDistance =
              dotOrigin / dotDirection; // negative divided by negative => positive
          clippingPlanesMaxDistance =
              min(clippingPlanesMaxDistance, intersectionDistance);
        }
      }
    #endif

    vec2 intersectionDistances =
        rayIntersectVolumeDistances(initialPosVC, lightDirNormVC);

    if (intersectionDistances[1] <= intersectionDistances[0] ||
        intersectionDistances[1] <= 0.0) {
      // Volume not hit or behind the ray
      return 1.0;
    }

    // When globalIlluminationReach is 0, no sample at all
    // When globalIlluminationReach is 1, the ray will go through the whole
    // volume
    float maxTravelDistance = mix(0.0, volume.diagonalLength,
                                  volume.globalIlluminationReach);
    float startDistance = max(intersectionDistances[0], 0.0);
    float endDistance = min(intersectionDistances[1], startDistance + maxTravelDistance);
    #ifdef vtkClippingPlanesOn
      endDistance = min(endDistance, clippingPlanesMaxDistance);
    #endif
    if (endDistance - startDistance < 0.0) {
      return 1.0;
    }

    // These two variables are used to compute posIS, without having to call
    // VCtoIS at each step
    vec3 initialPosIS = posVCtoIS(initialPosVC);
    // The light dir is scaled and rotated, but not translated, as it is a
    // vector (w = 0)
    vec3 scaledLightDirIS = vecVCToIS(lightDirNormVC);

    float shadow = 1.0;
    for (float currentDistance = startDistance; currentDistance <= endDistance;
          currentDistance += rayStepLength) {
      vec3 posIS = initialPosIS + currentDistance * scaledLightDirIS;
      vec4 scalar = getTextureValue(posIS);
      float opacity = getOpacityFromTexture(scalar.r, 0, 0.5);
      #if defined(EnabledGradientOpacity) && !defined(EnabledIndependentComponents)
        vec3 scalarInterp[2];
        vec4 normal = computeNormalForDensity(posIS, scalarInterp, 3);
        float opacityFactor = computeGradientOpacityFactor(normal.w, 0);
        opacity *= opacityFactor;
      #endif
      shadow *= 1.0 - opacity;

      // Early termination if shadow coeff is near 0.0
      if (shadow < EPSILON) {
        return 0.0;
      }
    }
    return shadow;
  }

  // Some cache for volume shadows
  struct {
    vec3 posVC;
    float shadow;
  } cachedShadows[vtkNumberOfLights];

  // Memoised version
  float computeVolumeShadow(vec3 posVC, vec3 lightDirNormVC, int lightIdx) {
    if (posVC == cachedShadows[lightIdx].posVC) {
      return cachedShadows[lightIdx].shadow;
    }
    float shadow = computeVolumeShadowWithoutCache(posVC, lightDirNormVC);
    cachedShadows[lightIdx].posVC = posVC;
    cachedShadows[lightIdx].shadow = shadow;
    return shadow;
  }

#endif

//=======================================================================
// surface light contribution
#if vtkNumberOfLights > 0
  vec3 applyLighting(vec3 tColor, vec4 normalVC) {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      float df = dot(normalVC.xyz, lights[lightIdx].directionVC);
      if (df > 0.0) {
        diffuse += df * lights[lightIdx].color;
        float sf = dot(normalVC.xyz, -lights[lightIdx].halfAngleVC);
        if (sf > 0.0) {
          specular += pow(sf, volume.specularPower) * lights[lightIdx].color;
        }
      }
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient) +
          specular * volume.specular;
  }

  vec3 applySurfaceShadowLighting(vec3 tColor, float alpha, vec3 posVC,
                                  vec4 normalVC) {
    // everything in VC
    vec3 diffuse = vec3(0.0);
    vec3 specular = vec3(0.0);
    for (int ligthIdx = 0; ligthIdx < vtkNumberOfLights; ligthIdx++) {
      vec3 vertLightDirection;
      float attenuation;
      if (lights[ligthIdx].isPositional == 1) {
        vertLightDirection = posVC - lights[ligthIdx].positionVC;
        float lightDistance = length(vertLightDirection);
        // Normalize with precomputed length
        vertLightDirection = vertLightDirection / lightDistance;
        // Base attenuation
        vec3 attenuationPolynom = lights[ligthIdx].attenuation;
        attenuation =
            1.0 / (attenuationPolynom[0] +
                  lightDistance * (attenuationPolynom[1] +
                                    lightDistance * attenuationPolynom[2]));
        // Cone attenuation
        float coneDot = dot(vertLightDirection, lights[ligthIdx].directionVC);
        // Per OpenGL standard cone angle is 90 or less for a spot light
        if (lights[ligthIdx].coneAngle <= 90.0) {
          if (coneDot >= cos(radians(lights[ligthIdx].coneAngle))) {
            // Inside the cone
            attenuation *= pow(coneDot, lights[ligthIdx].exponent);
          } else {
            // Outside the cone
            attenuation = 0.0;
          }
        }
      } else {
        vertLightDirection = lights[ligthIdx].directionVC;
        attenuation = 1.0;
      }

      float ndotL = dot(normalVC.xyz, vertLightDirection);
      if (ndotL < 0.0 && twoSidedLighting == 1) {
        ndotL = -ndotL;
      }
      if (ndotL > 0.0) {
        // Diffuse
        diffuse += ndotL * attenuation * lights[ligthIdx].color;
        // Specular
        float vdotR =
            dot(-rayDirVC, normalize(vertLightDirection - 2.0 * ndotL * normalVC.xyz));
        if (vdotR > 0.0) {
          specular += pow(vdotR, volume.specularPower) * attenuation *
                      lights[ligthIdx].color;
        }
      }
    }
    #if vtkMaxLaoKernelSize > 0
      float laoFactor = computeLAO(posVC, normalVC, alpha);
    #else
      const float laoFactor = 1.0;
    #endif
    return tColor * (diffuse * volume.diffuse +
                    volume.ambient * laoFactor) +
          specular * volume.specular;
  }

  vec3 applyVolumeShadowLighting(vec3 tColor, vec3 posVC) {
    // Here we have no effect of cones and no attenuation
    vec3 diffuse = vec3(0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      vec3 lightDirVC = lights[lightIdx].isPositional == 1
                            ? normalize(lights[lightIdx].positionVC - posVC)
                            : -lights[lightIdx].directionVC;
      float shadowCoeff = computeVolumeShadow(posVC, lightDirVC, lightIdx);
      float phaseAttenuation = phaseFunction(dot(rayDirVC, lightDirVC));
      diffuse += phaseAttenuation * shadowCoeff * lights[lightIdx].color;
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient);
  }
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posVC,
                       vec4 surfaceNormalVC) {
  #if vtkNumberOfLights > 0
    // 0 <= volCoeff < EPSILON => only surface shadows
    // EPSILON <= volCoeff < 1 - EPSILON => mix of surface and volume shadows
    // 1 - EPSILON <= volCoeff => only volume shadows
    float volCoeff = volume.volumetricScatteringBlending *
                    (1.0 - alpha / 2.0) *
                    (1.0 - atan(surfaceNormalVC.w) * INV4PI);

    // Compute surface lighting if needed
    vec3 surfaceShadedColor = tColor;
    #ifdef EnableSurfaceLighting
      if (volCoeff < 1.0 - EPSILON) {
        surfaceShadedColor =
            applySurfaceShadowLighting(tColor, alpha, posVC, surfaceNormalVC);
      }
    #endif

    // Compute volume lighting if needed
    vec3 volumeShadedColor = tColor;
    #ifdef EnableVolumeLighting
      if (volCoeff >= EPSILON) {
        volumeShadedColor = applyVolumeShadowLighting(tColor, posVC);
      }
    #endif

    // Return the right mix
    if (volCoeff < EPSILON) {
      // Surface shadows
      return surfaceShadedColor;
    }
    if (volCoeff >= 1.0 - EPSILON) {
      // Volume shadows
      return volumeShadedColor;
    }
    // Mix of surface and volume shadows
    return mix(surfaceShadedColor, volumeShadedColor, volCoeff);
  #endif
  return tColor;
}

vec4 getColorForLabelOutline() {
  vec3 centerPosIS =
      fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = vec4(getColorFromTexture(centerValue.r, 0, 0.5),
                     getOpacityFromTexture(centerValue.r, 0, 0.5));

  int segmentIndex = int(centerValue.r * 255.0);

  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue =
      texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;
  int actualThickness = int(textureValue * 255.0);

  // If it is the background (segment index 0), we should quickly bail out.
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0) {
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't
  // invisible. Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord =
          vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j),
               gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = volume.outlineOpacity;
  }

  return tColor;
}

vec4 getColorForAdditivePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLights[2];
  normalLights[0] = normalMat[0];
  normalLights[1] = normalMat[1];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      for (int component = 0; component < 2; ++component) {
        vec3 scalarInterp[2];
        float height = volume.transferFunctionsSampleHeight[component];
        computeNormalForDensity(posIS, scalarInterp, component);
        normalLights[component] =
            computeDensityNormal(scalarInterp, height, 1.0, component);
      }
    }
  #endif

  // compute opacities
  float opacities[2];
  opacities[0] = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  opacities[1] = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);
  #ifdef EnabledGradientOpacity
    for (int component = 0; component < 2; ++component) {
      opacities[component] *=
          computeGradientOpacityFactor(normalMat[component].a, component);
    }
  #endif
  float opacitySum = opacities[0] + opacities[1];
  if (opacitySum <= 0.0) {
    return vec4(0.0);
  }

  // mix the colors and opacities
  vec3 colors[2];
  for (int component = 0; component < 2; ++component) {
    float sampleHeight = volume.transferFunctionsSampleHeight[component];
    vec3 color = getColorFromTexture(tValue[component], component, sampleHeight);
    color = applyAllLightning(color, opacities[component], posVC,
                              normalLights[component]);
    colors[component] = color;
  }
  vec3 mixedColor =
      (opacities[0] * colors[0] + opacities[1] * colors[1]) / opacitySum;
  return vec4(mixedColor, min(1.0, opacitySum));
}

vec4 getColorForColorizePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLight = normalMat[0];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      vec3 scalarInterp[2];
      float height = volume.transferFunctionsSampleHeight[0];
      computeNormalForDensity(posIS, scalarInterp, 0);
      normalLight = computeDensityNormal(scalarInterp, height, 1.0, 0);
    }
  #endif

  // compute opacities
  float opacity = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  #ifdef EnabledGradientOpacity
    opacity *= computeGradientOpacityFactor(normalMat[0].a, 0);
  #endif

  // colorizing component
  vec3 colorizingColor = getColorFromTexture(
      tValue[0], 1, volume.transferFunctionsSampleHeight[1]);
  float colorizingOpacity = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);

  // mix the colors and opacities
  vec3 color =
      getColorFromTexture(tValue[0], 0,
                          volume.transferFunctionsSampleHeight[0]) *
      mix(vec3(1.0), colorizingColor, colorizingOpacity);
  color = applyAllLightning(color, opacity, posVC, normalLight);
  return vec4(color, opacity);
}

vec4 getColorForDefaultIndependentPreset(vec4 tValue, vec3 posIS) {

  // compute the normal vectors as needed
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    mat4 normalMat = computeMat4Normal(posIS, tValue);
  #endif

  // process color and opacity for each component
  // initial value of alpha is determined by wether the first component is
  // proportional or not
  #if defined(vtkComponent0Proportional)
    // when it is proportional, it starts at 1 (neutral for multiplications)
    float alpha = 1.0;
  #else
    // when it is not proportional, it starts at 0 (neutral for additions)
    float alpha = 0.0;
  #endif

  vec3 mixedColor = vec3(0.0);
  #if vtkNumberOfComponents > 0
    {
      const int component = 0;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent0Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 1
    {
      const int component = 1;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent1Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 2
    {
      const int component = 2;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent2Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 3
    {
      const int component = 3;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent3Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif

  return vec4(mixedColor, alpha);
}

vec4 getColorForDependentComponents(vec4 tValue, vec3 posVC, vec3 posIS) {
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    // use component 3 of the opacity texture as getTextureValue() sets alpha to
    // the opacity value
    vec3 scalarInterp[2];
    vec4 normal0 = computeNormalForDensity(posIS, scalarInterp, 3);
    float gradientOpacity = computeGradientOpacityFactor(normal0.a, 0);
  #endif

  // get color and opacity
  #if vtkNumberOfComponents == 1
    vec3 tColor = getColorFromTexture(tValue.r, 0, 0.5);
    float alpha = getOpacityFromTexture(tValue.r, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 2
    vec3 tColor = vec3(tValue.r * volume.colorTextureScale[0] +
                  volume.colorTextureShift[0]);
    float alpha = getOpacityFromTexture(tValue.a, 1, 0.5);
  #endif
  #if vtkNumberOfComponents == 3
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 4
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 3, 0.5);
  #endif

  // Apply gradient opacity
  #if defined(EnabledGradientOpacity)
    alpha *= gradientOpacity;
  #endif

  #if vtkNumberOfComponents == 1
    if (alpha < EPSILON) {
      return vec4(0.0);
    }
  #endif

  // lighting
  #if vtkNumberOfLights > 0
    vec4 normalLight;
    if (volume.computeNormalFromOpacity == 1) {
      if (normal0[3] != 0.0) {
        normalLight =
            computeDensityNormal(scalarInterp, 0.5, gradientOpacity, 0);
        if (normalLight[3] == 0.0) {
          normalLight = normal0;
        }
      }
    } else {
      normalLight = normal0;
    }
    tColor = applyAllLightning(tColor, alpha, posVC, normalLight);
  #endif

  return vec4(tColor, alpha);
}

vec4 getColorForValue(vec4 tValue, vec3 posVC, vec3 posIS) {
  #ifdef EnableColorForValueFunctionId0
    return getColorForDependentComponents(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId1
    return getColorForAdditivePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId2
    return getColorForColorizePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId3
    /*
      * Mix the color information from all the independent components to get a
      * single rgba output. See other shader functions like
      * \`getColorForAdditivePreset\` to learn how to create a custom color mix.
      * The custom color mix should return a value, but if it doesn't, it will
      * fallback on the default shading
      */
    //VTK::CustomColorMix
  #endif

  #if defined(EnableColorForValueFunctionId4) || defined(EnableColorForValueFunctionId3)
    return getColorForDefaultIndependentPreset(tValue, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId5
    return getColorForLabelOutline();
  #endif
}

bool valueWithinScalarRange(vec4 val) {
  #if vtkNumberOfComponents > 1 && !defined(EnabledIndependentComponents)
    return false;
  #endif
  vec4 rangeMin = volume.ipScalarRangeMin;
  vec4 rangeMax = volume.ipScalarRangeMax;
  for (int component = 0; component < vtkNumberOfComponents; ++component) {
    if (val[component] < rangeMin[component] ||
        rangeMax[component] < val[component]) {
      return false;
    }
  }
  return true;
}

#if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
  bool checkOnEdgeForNeighbor(int xFragmentOffset, int yFragmentOffset,
                              int segmentIndex, vec3 stepIS) {
    vec3 volumeDimensions = vec3(volume.dimensions);
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(xFragmentOffset),
                                  gl_FragCoord.y + float(yFragmentOffset),
                                  gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    vec3 neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS += stepIS;
    }

    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS -= stepIS;
    }

    // onedge
    float sampleHeight = volume.transferFunctionsSampleHeight[1];
    vec3 tColorSegment =
        getColorFromTexture(float(segmentIndex), 1, sampleHeight);
    float pwfValueSegment =
        getOpacityFromTexture(float(segmentIndex), 1, sampleHeight);
    gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
    return true;
  }
#endif

vec4 getColorAtPos(vec3 posVC) {
  vec3 posIS = posVCtoIS(posVC);
  vec4 texValue = getTextureValue(posIS);
  return getColorForValue(texValue, posVC, posIS);
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 rayOriginVC, vec3 rayDirVC, float minDistance,
                float maxDistance) {
  // start slightly inside and apply some jitter
  vec3 stepVC = rayDirVC * sampleDistance;
  float raySteps = (maxDistance - minDistance) / sampleDistance;

  // Avoid 0.0 jitter
  float jitter = 0.01 + 0.99 * fragmentSeed;

  #if vtkBlendMode == COMPOSITE_BLEND
    // now map through opacity and color
    vec3 firstPosVC = rayOriginVC + minDistance * rayDirVC;
    vec4 firstColor = getColorAtPos(firstPosVC);

    // handle very thin volumes
    if (raySteps <= 1.0) {
      firstColor.a = 1.0 - pow(1.0 - firstColor.a, raySteps);
      gl_FragData[0] = firstColor;
      return;
    }

    // first color only counts for \`jitter\` factor of the step
    firstColor.a = 1.0 - pow(1.0 - firstColor.a, jitter);
    vec4 color = vec4(firstColor.rgb * firstColor.a, firstColor.a);
    vec3 posVC = firstPosVC + jitter * stepVC;
    float stepsTraveled = jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }
      vec4 tColor = getColorAtPos(posVC);

      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * (1.0 - color.a);
      stepsTraveled++;
      posVC += stepVC;
      if (color.a > 0.99) {
        color.a = 1.0;
        break;
      }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0) {
      vec3 endPosVC = rayOriginVC + maxDistance * rayDirVC;
      vec4 tColor = getColorAtPos(endPosVC);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * mix;
    }

    gl_FragData[0] = vec4(color.rgb / color.a, color.a);
  #endif

  #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND ||                                 \\
      vtkBlendMode == MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND
      #define OP max
    #else
      #define OP min
    #endif

    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // Find a value to initialize the selected variables
    vec4 selectedValue;
    vec3 selectedPosVC;
    vec3 selectedPosIS;
    {
      vec3 posIS = posVCtoIS(posVC);
      selectedValue = getTextureValue(posIS);
      selectedPosVC = posVC;
      selectedPosIS = posIS;
    }

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // Get selected values
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    {
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }
    }

    gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
  #endif

  #if vtkBlendMode == ADDITIVE_INTENSITY_BLEND ||                                \\
      vtkBlendMode == AVERAGE_INTENSITY_BLEND
    vec4 sum = vec4(0.);
    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      float totalWeight = 0.0;
    #endif
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    vec3 posIS = posVCtoIS(posVC);
    vec4 value = getTextureValue(posIS);

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(value * raySteps, posVC, posIS);
      return;
    }

    if (valueWithinScalarRange(value)) {
      sum += value * jitter;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += jitter;
      #endif
    }
    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      posIS = posVCtoIS(posVC);
      value = getTextureValue(posIS);
      // One can control the scalar range by setting the AverageIPScalarRange to
      // disregard scalar values, not in the range of interest, from the average
      // computation. Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(value)) {
        sum += value;
        #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
          totalWeight++;
        #endif
      }

      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    posIS = posVCtoIS(posVC);
    value = getTextureValue(posIS);
    if (valueWithinScalarRange(value)) {
      sum += value;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += raySteps - stepsTraveled;
      #endif
    }

    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      sum /= vec4(totalWeight, totalWeight, totalWeight, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posVC, posIS);
  #endif

  #if vtkBlendMode == RADON_TRANSFORM_BLEND
    float normalizedRayIntensity = 1.0;
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // handle very thin volumes
    if (raySteps <= 1.0) {
      vec3 posIS = posVCtoIS(posVC);
      vec4 tValue = getTextureValue(posIS);
      normalizedRayIntensity -= raySteps * sampleDistance *
                                getOpacityFromTexture(tValue.r, 0, 0.5);
      gl_FragData[0] =
          vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      vec3 posIS = posVCtoIS(posVC);
      vec4 value = getTextureValue(posIS);
      // Convert scalar value to normalizedRayIntensity coefficient and
      // accumulate normalizedRayIntensity
      normalizedRayIntensity -=
          sampleDistance * getOpacityFromTexture(value.r, 0, 0.5);

      posVC += stepVC;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] =
        vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
  #endif

  #if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
    // Only works with a single volume
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;
    vec3 posIS = posVCtoIS(posVC);
    vec4 tValue = getTextureValue(posIS);
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(tValue, posVC, posIS);
      return;
    }

    vec3 stepIS = vecVCToIS(stepVC);
    vec4 value = tValue;
    posIS += jitter * stepIS;
    stepsTraveled += jitter;
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the
      // segment index and later check if the bit is set via bit operations
      setLabelOutlineBit(segmentIndex);
    }

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setLabelOutlineBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value = tValue;   // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = posVCtoIS(rayOriginVC + maxDistance * rayDirVC);
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue;   // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      vec3 maxPosVC = posIStoVC(maxPosIS);
      gl_FragData[0] = getColorForValue(value, maxPosVC, maxPosIS);
      return;
    }

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    vec3 volumeSpacings = volume.spacing;
    float minVoxelSpacing =
        min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base =
        vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z,
                          gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z,
                          gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not
      // been seen by the center segment
      if (!isLabelOutlineBitSet(s)) {
        continue;
      }

      // Use texture sampling for outlineThickness so that we can have
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue =
          texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out
      // faster if we find the edge
      bool onEdge = checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s,
                                          stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety
      // of the all the fragments inside. i.e., this happens when we zoom out,
      if (minVoxelSpacing >
          (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }

      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
        for (int j = -actualThickness; j <= actualThickness; j++) {
          if (i == 0 && j == 0)
            continue; // Skip the center
          if (abs(i) == actualThickness && abs(j) == actualThickness)
            continue; // Skip corners
          if (checkOnEdgeForNeighbor(i, j, s, stepIS)) {
            return;
          }
        }
      }
    }

    float sampleHeight = volume.transferFunctionsSampleHeight[0];
    vec3 tColor0 = getColorFromTexture(value.r, 0, sampleHeight);
    float pwfValue0 = getOpacityFromTexture(value.r, 0, sampleHeight);
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  vec2 dists = rayIntersectVolumeDistances(rayOriginVC, rayDirVC);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0, dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick / rayDirVC.z;
  dists.y = min(farDist, dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

float getFragmentSeed() {
  // This first noise has a diagonal pattern
  float firstNoise =
      fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);
  // This second noise is made out of blocks of CPU generated noise
  float secondNoise = texture2D(jtexture, gl_FragCoord.xy / 32.0).r;
  // Combine the two sources of noise in a way that the distribution is uniform
  // in [0,1[
  float noiseSum = firstNoise + secondNoise;
  return noiseSum < 1.0 ? noiseSum : noiseSum - 1.0;
}

void main() {
  fragmentSeed = getFragmentSeed();

  if (cameraParallel == 1) {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 rayOriginVC = vertexVCVSOutput;
  vec2 rayStartEndDistancesVC = computeRayDistances(rayOriginVC, rayDirVC);
  if (rayStartEndDistancesVC[1] <= rayStartEndDistancesVC[0] ||
      rayStartEndDistancesVC[1] <= 0.0) {
    // Volume not hit or behind the ray
    discard;
  }

  // Perform the blending operation along the ray
  applyBlend(rayOriginVC, rayDirVC, rayStartEndDistancesVC[0], rayStartEndDistancesVC[1]);
}
`;const{vtkWarningMacro:oz,vtkErrorMacro:xS}=_i,az={idxToView:_t(new Float64Array(16)),vecISToVCMatrix:Ao(new Float64Array(9)),modelToView:_t(new Float64Array(16)),projectionToView:_t(new Float64Array(16)),projectionToWorld:_t(new Float64Array(16))};function sz(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function r(l,f){const u=l.getIndependentComponents(),d=l.getColorMixPreset();return u&&f>=2||!!d}function n(l){return l.getUseLabelOutline()||e.renderable.getBlendMode()===Fd.LABELMAP_EDGE_PROJECTION_BLEND}const i=new Map;function o(l,f){if(!f)return;const d=(i.get(f)??0)-1;d<=0?(l.unregisterGraphicsResourceUser(f,t),i.delete(f)):i.set(f,d)}function a(l,f){if(!f)return;const u=i.get(f)??0,d=u+1;i.set(f,d),u<=0&&l.registerGraphicsResourceUser(f,t)}function s(l,f,u){f!==u&&(o(l,f),a(l,u))}function c(l){[...i.keys()].forEach(f=>l.unregisterGraphicsResourceUser(f,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(l,f)=>{if(l){const u=f.getZBufferTexture();u!==e.zBufferTexture&&(e.zBufferTexture=u)}},t.opaqueZBufferPass=(l,f)=>t.zBufferPass(l,f),t.volumePass=(l,f)=>{if(l){const u=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),u&&!u.isDeleted()&&u!==e._openGLRenderWindow&&c(u),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const d=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const h=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(h.getActiveCamera()),t.renderPiece(h,d)}},t.getShaderTemplate=(l,f,u)=>{l.Vertex=rz,l.Fragment=iz,l.Geometry=""},t.replaceShaderValues=(l,f,u)=>{let d=l.Fragment;d=Oe.substitute(d,"//VTK::EnabledColorFunctions",`#define EnableColorForValueFunctionId${e.previousState.colorForValueFunctionId}`).result;const h=[];e.previousState.surfaceLightingEnabled&&h.push("Surface"),e.previousState.volumeLightingEnabled&&h.push("Volume"),d=Oe.substitute(d,"//VTK::EnabledLightings",h.map(p=>`#define Enable${p}Lighting`)).result,e.previousState.multiTexturePerVolumeEnabled&&(d=Oe.substitute(d,"//VTK::EnabledMultiTexturePerVolume","#define EnabledMultiTexturePerVolume").result),e.previousState.useIndependentComponents&&(d=Oe.substitute(d,"//VTK::EnabledIndependentComponents","#define EnabledIndependentComponents").result),e.previousState.gradientOpacityEnabled&&(d=Oe.substitute(d,"//VTK::EnabledGradientOpacity","#define EnabledGradientOpacity").result),d=Oe.substitute(d,"//VTK::vtkProportionalComponents",e.previousState.proportionalComponents.map(p=>`#define vtkComponent${p}Proportional`).join(`
`)).result,d=Oe.substitute(d,"//VTK::vtkForceNearestComponents",e.previousState.forceNearestComponents.map(p=>`#define vtkComponent${p}ForceNearest`).join(`
`)).result,e.previousState.hasZBufferTexture&&(d=Oe.substitute(d,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,d=Oe.substitute(d,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDirVC.z;","dists.y = min(zdepth,dists.y);"]).result),d=Oe.substitute(d,"//VTK::BlendMode",`${e.previousState.blendMode}`).result,d=Oe.substitute(d,"//VTK::NumberOfLights",`${e.previousState.numberOfLights}`).result,d=Oe.substitute(d,"//VTK::MaxLaoKernelSize",`${e.previousState.maxLaoKernelSize}`).result,d=Oe.substitute(d,"//VTK::NumberOfComponents",`${e.previousState.numberOfComponents}`).result,d=Oe.substitute(d,"//VTK::MaximumNumberOfSamples",`${e.previousState.maximumNumberOfSamples}`).result,l.Fragment=d;const g=e.previousState.numberOfClippingPlanes;g>0&&(d=Oe.substitute(d,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,d=Oe.substitute(d,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${g}; i++) {`,"  float rayDirRatio = dot(rayDirVC, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result),l.Fragment=d},t.getNeedToRebuildShaders=(l,f,u)=>{const d=!!e.zBufferTexture,h=e.currentValidInputs.length,g=e.numberOfLights,p=e.numberOfComponents,m=e.useIndependentComponents,w=u.getProperties(),v=e.currentValidInputs[0],y=w[v.inputIndex],C=h>1,x=v.imageData.getBounds(),T=hn.getDiagonalLength(x),S=Math.ceil(T/t.getCurrentSampleDistance(f));S>e.renderable.getMaximumSamplesPerRay()&&oz(`The number of steps required ${S} is larger than the specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
Please either change the volumeMapper sampleDistance or its maximum number of samples.`);const _=m?p:1;let E=!1;for(let ie=0;ie<_;++ie)if(y.getUseGradientOpacity(ie)){E=!0;break}let D=0;const b=y.getLAOKernelSize();b>D&&y.getLocalAmbientOcclusion()&&y.getAmbient()>0&&(D=b);const I=e.renderable.getClippingPlanes().length,O=e.renderable.getViewSpecificProperties().OpenGL?.ShaderReplacements,M=e.currentRenderPass?.getShaderReplacement(),R=e.renderable.getBlendMode(),A=(()=>{if(R!==Fd.LABELMAP_EDGE_PROJECTION_BLEND&&n(y))return 5;if(m)switch(y.getColorMixPreset()){case Jp.ADDITIVE:return 1;case Jp.COLORIZE:return 2;case Jp.CUSTOM:return 3;default:return 4}return 0})(),B=y.getVolumetricScatteringBlending()<1,k=y.getVolumetricScatteringBlending()>0;let L=!1;for(let ie=0;ie<p;++ie)if(y.getForceNearestInterpolation(ie)){L=!0;break}const F=[],j=[];for(let ie=0;ie<p;ie++)y.getOpacityMode(ie)===MD.PROPORTIONAL&&F.push(ie),y.getForceNearestInterpolation(ie)&&j.push(ie);const J={numberOfComponents:p,useIndependentComponents:m,proportionalComponents:F,forceNearestComponents:j,blendMode:R,numberOfLights:g,numberOfValidInputs:h,maximumNumberOfSamples:S,hasZBufferTexture:d,maxLaoKernelSize:D,numberOfClippingPlanes:I,mapperShaderReplacements:O,renderPassShaderReplacements:M,colorForValueFunctionId:A,surfaceLightingEnabled:B,volumeLightingEnabled:k,forceNearestInterpolationEnabled:L,multiTexturePerVolumeEnabled:C,gradientOpacityEnabled:E};return l.getProgram()?.getHandle()===0||!e.previousState||!Dw(e.previousState,J)?(e.previousState=J,!0):!1},t.updateShaders=(l,f,u)=>{if(t.getNeedToRebuildShaders(l,f,u)){const d={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(d,f,u);const h=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(d.Vertex,d.Fragment,d.Geometry);h!==l.getProgram()&&(l.setProgram(h),l.getVAO().releaseGraphicsResources()),l.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(l.getProgram());l.getVAO().bind(),t.setMapperShaderParameters(l,f,u),t.setCameraShaderParameters(l,f,u),t.setPropertyShaderParameters(l,f,u),t.getClippingPlaneShaderParameters(l,f,u)},t.setMapperShaderParameters=(l,f,u)=>{const d=l.getProgram();l.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>l.getAttributeUpdateTime().getMTime()||l.getShaderSourceTime().getMTime()>l.getAttributeUpdateTime().getMTime())&&(d.isAttributeUsed("vertexDC")&&(l.getVAO().addAttributeArray(d,l.getCABO(),"vertexDC",l.getCABO().getVertexOffset(),l.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||xS("Error setting vertexDC in shader VAO.")),l.getAttributeUpdateTime().modified());const h=t.getCurrentSampleDistance(f);d.setUniformf("sampleDistance",h);const g=h*e.renderable.getVolumeShadowSamplingDistFactor();d.setUniformf("volumeShadowSampleDistance",g),e.scalarTextures.forEach((S,_)=>{d.setUniformi(`volumeTexture[${_}]`,S.getTextureUnit())});const p=u.getProperties(),m=e.currentValidInputs[0],v=p[m.inputIndex].getIpScalarRange(),y=new Float32Array(4),C=new Float32Array(4),x=(S,_,E)=>{_?.dataComputedScale?.length&&(y[S]=v[0]*_.dataComputedScale[E]+_.dataComputedOffset[E],C[S]=v[1]*_.dataComputedScale[E]+_.dataComputedOffset[E],y[S]=(y[S]-_.offset[E])/_.scale[E],C[S]=(C[S]-_.offset[E])/_.scale[E])};if(e.previousState.multiTexturePerVolumeEnabled)e.scalarTextures.forEach((S,_)=>{const E=S.getVolumeInfo();x(_,E,0)});else{const S=e.scalarTextures[0].getVolumeInfo();for(let _=0;_<4;++_)x(_,S,_)}const T="volume";if(d.setUniform4f(`${T}.ipScalarRangeMin`,y[0],y[1],y[2],y[3]),d.setUniform4f(`${T}.ipScalarRangeMax`,C[0],C[1],C[2],C[3]),e.zBufferTexture!==null){d.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const S=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();d.setUniformf("vpZWidth",S[0]),d.setUniformf("vpZHeight",S[1])}},t.setCameraShaderParameters=(l,f,u)=>{const{idxToView:d,vecISToVCMatrix:h,modelToView:g,projectionToView:p,projectionToWorld:m}=az,w=e.openGLCamera.getKeyMatrices(f),v=e.openGLVolume.getKeyMatrices();Wt(g,w.wcvc,v.mcwc);const y=l.getProgram(),C=e.openGLCamera.getRenderable(),x=C.getParallelProjection(),T=C.getClippingRange();y.setUniformf("camThick",T[1]-T[0]),y.setUniformf("camNear",T[0]),y.setUniformf("camFar",T[1]),y.setUniformi("cameraParallel",x);const S=e.currentValidInputs[0],_=S.imageData.getBounds(),D=hn.getCorners(_,[]).map(G=>{if(Pt(G,G,g),!x){const P=-T[0]/(G[2]*_r(G));Jn(G,G,P)}return Pt(G,G,w.vcpc),G}),b=hn.addPoints([...hn.INIT_BOUNDS],D);y.setUniformf("dcxmin",b[0]),y.setUniformf("dcxmax",b[1]),y.setUniformf("dcymin",b[2]),y.setUniformf("dcymax",b[3]);const I=t.getRenderTargetSize();y.setUniformf("vpWidth",I[0]),y.setUniformf("vpHeight",I[1]);const O=t.getRenderTargetOffset();y.setUniformf("vpOffsetX",O[0]/I[0]),y.setUniformf("vpOffsetY",O[1]/I[1]),gr(p,w.vcpc),y.setUniformMatrix("PCVCMatrix",p),y.setUniformi("twoSidedLighting",f.getTwoSidedLighting());const M=new Array(2*e.previousState.maxLaoKernelSize);for(let G=0;G<e.previousState.maxLaoKernelSize;G++)M[G*2]=Math.random(),M[G*2+1]=Math.random();if(y.setUniform2fv("kernelSample",M),e.numberOfLights>0){let G=0;f.getLights().forEach(P=>{if(P.getSwitch()>0){const $=`lights[${G}]`,W=P.getColor(),q=P.getIntensity(),Q=Jn([],W,q);y.setUniform3fv(`${$}.color`,Q);const ee=P.getTransformedPosition();Pt(ee,ee,g),y.setUniform3fv(`${$}.positionVC`,ee);const ge=[...P.getDirection()];yh(ge,ge,w.normalMatrix),At(ge,ge),y.setUniform3fv(`${$}.directionVC`,ge);const De=[-.5*ge[0],-.5*ge[1],-.5*(ge[2]-1)];y.setUniform3fv(`${$}.halfAngleVC`,De);const Ne=P.getAttenuationValues();y.setUniform3fv(`${$}.attenuation`,Ne);const We=P.getExponent();y.setUniformf(`${$}.exponent`,We);const re=P.getConeAngle();y.setUniformf(`${$}.coneAngle`,re);const se=P.getPositional();y.setUniformi(`${$}.isPositional`,se),G++}})}const R="volume",B=u.getProperties()[S.inputIndex],k=S.imageData,L=k.getSpatialExtent(),F=k.getSpacing(),j=k.getDimensions(),J=k.getIndexToWorld(),ie=k.getWorldToIndex(),fe=k.getDirectionByReference();Wt(d,g,J),y.setUniform3fv(`${R}.spacing`,F);const ae=Em([],F);y.setUniform3fv(`${R}.inverseSpacing`,ae),y.setUniform3iv(`${R}.dimensions`,j),y.setUniform3fv(`${R}.inverseDimensions`,Em([],j)),y.setUniformMatrix(`${R}.worldToIndex`,ie),h.fill(0);const de=F8(new Float64Array(3),j,F);h[0]=de[0],h[4]=de[1],h[8]=de[2],Uu(h,fe,h),Uu(h,v.normalMatrix,h),Uu(h,w.normalMatrix,h),y.setUniformMatrix3x3(`${R}.vecISToVCMatrix`,h),y.setUniformMatrix3x3(`${R}.vecVCToISMatrix`,xc(new Float32Array(9),h));const we=mt(L[0],L[2],L[4]),_e=Pt(new Float64Array(3),we,d);y.setUniform3fv(`${R}.originVC`,_e);const Te=_r(de);if(y.setUniformf(`${R}.diagonalLength`,Te),n(B)){const G=C.getDistance();C.setClippingRange(G,G+.1);const P=e.openGLCamera.getKeyMatrices(f);gr(m,P.wcpc),C.setClippingRange(T[0],T[1]),e.openGLCamera.getKeyMatrices(f),y.setUniformMatrix(`${R}.PCWCMatrix`,m)}if(B.getVolumetricScatteringBlending()>0&&(y.setUniformf(`${R}.globalIlluminationReach`,B.getGlobalIlluminationReach()),y.setUniformf(`${R}.volumetricScatteringBlending`,B.getVolumetricScatteringBlending()),y.setUniformf(`${R}.anisotropy`,B.getAnisotropy()),y.setUniformf(`${R}.anisotropySquared`,B.getAnisotropy()**2)),B.getLocalAmbientOcclusion()&&B.getAmbient()>0){const G=B.getLAOKernelSize();y.setUniformi(`${R}.kernelSize`,G);const P=B.getLAOKernelRadius();y.setUniformi(`${R}.kernelRadius`,P)}else y.setUniformi(`${R}.kernelSize`,0)},t.setPropertyShaderParameters=(l,f,u)=>{const d=l.getProgram();d.setUniformi("jtexture",e.jitterTexture.getTextureUnit());const h=u.getProperties();d.setUniformi("labelOutlineThicknessTexture",e.labelOutlineThicknessTexture.getTextureUnit()),d.setUniformi("opacityTexture",e.opacityTexture.getTextureUnit()),d.setUniformi("colorTexture",e.colorTexture.getTextureUnit());const g="volume",p=e.currentValidInputs[0],m=h[p.inputIndex],w=e.previousState.numberOfComponents,v=e.previousState.useIndependentComponents;if(v){const D=new Float32Array(4);for(let O=0;O<w;O++)D[O]=m.getComponentWeight(O);d.setUniform4fv(`${g}.independentComponentMix`,D);const b=new Float32Array(4),I=1/w;for(let O=0;O<w;++O)b[O]=(O+.5)*I;d.setUniform4fv(`${g}.transferFunctionsSampleHeight`,b)}const y=e.colorForValueFunctionId;d.setUniformi(`${g}.colorForValueFunctionId`,y);const C=m.getComputeNormalFromOpacity();d.setUniformi(`${g}.computeNormalFromOpacity`,C);const x=new Float32Array(4),T=new Float32Array(4),S=new Float32Array(4),_=new Float32Array(4);for(let D=0;D<w;D++){const b=e.previousState.multiTexturePerVolumeEnabled,I=b?D:0,O=b?0:D,R=e.scalarTextures[I].getVolumeInfo(),A=v?D:0,B=R.scale[O],L=m.getRGBTransferFunction(A).getRange();x[D]=B/(L[1]-L[0]),T[D]=(R.offset[O]-L[0])/(L[1]-L[0]);const j=m.getScalarOpacity(A).getRange();S[D]=B/(j[1]-j[0]),_[D]=(R.offset[O]-j[0])/(j[1]-j[0])}if(d.setUniform4fv(`${g}.colorTextureScale`,x),d.setUniform4fv(`${g}.colorTextureShift`,T),d.setUniform4fv(`${g}.opacityTextureScale`,S),d.setUniform4fv(`${g}.opacityTextureShift`,_),e.previousState.gradientOpacityEnabled){const D=new Array(4),b=new Array(4),I=new Array(4),O=new Array(4);if(v)for(let M=0;M<w;++M){const R=e.previousState.multiTexturePerVolumeEnabled,A=R?M:0,B=R?0:M,F=e.scalarTextures[A].getVolumeInfo().scale[B];if(m.getUseGradientOpacity(M)){const J=[m.getGradientOpacityMinimumOpacity(M),m.getGradientOpacityMaximumOpacity(M)],ie=[m.getGradientOpacityMinimumValue(M),m.getGradientOpacityMaximumValue(M)];I[M]=J[0],O[M]=J[1],D[M]=F*(J[1]-J[0])/(ie[1]-ie[0]),b[M]=-ie[0]*(J[1]-J[0])/(ie[1]-ie[0])+J[0]}else I[M]=1,O[M]=1,D[M]=0,b[M]=1}else{const M=w-1,R=e.previousState.multiTexturePerVolumeEnabled,A=R?M:0,B=R?0:M,F=e.scalarTextures[A].getVolumeInfo().scale[B],j=[m.getGradientOpacityMinimumOpacity(0),m.getGradientOpacityMaximumOpacity(0)],J=[m.getGradientOpacityMinimumValue(0),m.getGradientOpacityMaximumValue(0)];I[0]=j[0],O[0]=j[1],D[0]=F*(j[1]-j[0])/(J[1]-J[0]),b[0]=-J[0]*(j[1]-j[0])/(J[1]-J[0])+j[0]}d.setUniform4f(`${g}.gradientOpacityScale`,D),d.setUniform4f(`${g}.gradientOpacityShift`,b),d.setUniform4f(`${g}.gradientOpacityMin`,I),d.setUniform4f(`${g}.gradientOpacityMax`,O)}const E=m.getLabelOutlineOpacity();if(d.setUniformf(`${g}.outlineOpacity`,E),e.numberOfLights>0){d.setUniformf(`${g}.ambient`,m.getAmbient()),d.setUniformf(`${g}.diffuse`,m.getDiffuse()),d.setUniformf(`${g}.specular`,m.getSpecular());const D=m.getSpecularPower();d.setUniformf(`${g}.specularPower`,D===0?1:D)}},t.getClippingPlaneShaderParameters=(l,f,u)=>{if(e.renderable.getClippingPlanes().length>0){const d=e.openGLCamera.getKeyMatrices(f),h=[],g=[],p=[],m=e.renderable.getClippingPlanes(),w=m.length;for(let y=0;y<w;++y){const C=m[y].getNormal(),x=m[y].getOrigin();yh(C,C,d.normalMatrix),Pt(x,x,d.wcvc);const T=-1*ft(x,C);h.push(C[0]),h.push(C[1]),h.push(C[2]),g.push(T),p.push(x[0]),p.push(x[1]),p.push(x[2])}const v=l.getProgram();v.setUniform3fv("vClipPlaneNormals",h),v.setUniformfv("vClipPlaneDistances",g),v.setUniform3fv("vClipPlaneOrigins",p),v.setUniformi("clip_numPlanes",w)}},t.delete=ng(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&c(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:l,vsize:f}=e._openGLRenderer.getTiledSizeAndOrigin();return[l,f]},t.getRenderTargetOffset=()=>{const{lowerLeftU:l,lowerLeftV:f}=e._openGLRenderer.getTiledSizeAndOrigin();return[l,f]},t.getCurrentSampleDistance=l=>{const f=l.getVTKWindow().getInteractor(),u=e.renderable.getSampleDistance();if(f.isAnimating()){const d=e.renderable.getInteractionSampleDistanceFactor();return u*d}return u},t.renderPieceStart=(l,f)=>{const u=l.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,u.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=u.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const h=u.getRecentAnimationFrameRate(),g=u.getDesiredUpdateRate()/h;(g>1.15||g<.85)&&(e._lastScale*=g),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const h=e._openGLRenderWindow.getFramebufferSize(),g=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(g*h[0]),e._smallViewportHeight=Math.ceil(g*h[1]),e._smallViewportHeight>h[1]&&(e._smallViewportHeight=h[1]),e._smallViewportWidth>h[0]&&(e._smallViewportWidth=h[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(h[0],h[1]),e.framebuffer.populateFramebuffer();else{const m=e.framebuffer.getSize();(!m||m[0]!==h[0]||m[1]!==h[1])&&(e.framebuffer.create(h[0],h[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const p=e.context;p.clearColor(0,0,0,0),p.colorMask(!0,!0,!0,!0),p.clear(p.COLOR_BUFFER_BIT),p.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/h[0],e._smallViewportHeight/h[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(l,f);const d=f.getProperties();e.currentValidInputs.forEach(h=>{let{inputIndex:g}=h;const m=d[g].getInterpolationType(),w=e.scalarTextures[g];m===ID.NEAREST?(w.setMinificationFilter(Mt.NEAREST),w.setMagnificationFilter(Mt.NEAREST)):(w.setMinificationFilter(Mt.LINEAR),w.setMagnificationFilter(Mt.LINEAR))}),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(l,f)=>{const u=e.context,d=[...e.scalarTextures,e.colorTexture,e.opacityTexture,e.labelOutlineThicknessTexture,e.jitterTexture];d.forEach(h=>h.activate()),t.updateShaders(e.tris,l,f),u.drawArrays(u.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),d.forEach(h=>h.deactivate())},t.renderPieceFinish=(l,f)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const g=e.copyShader;e.copyVAO=q1.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(g,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||xS("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const u=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,u[0],u[1]);const d=e.framebuffer.getColorTexture();d.activate(),e.copyShader.setUniformi("texture",d.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const h=e.context;h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),d.deactivate(),h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(l,f)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const u=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let h=0;h<u;++h){const g=e.renderable.getInputData(h);g&&!g.isDeleted()&&e.currentValidInputs.push({imageData:g,inputIndex:h})}let d=0;if(e.currentValidInputs.length>0){const h=f.getProperties(),g=e.currentValidInputs[0],m=g.imageData.getPointData().getScalars(),w=h[g.inputIndex];w.getShade()&&e.renderable.getBlendMode()===Fd.COMPOSITE_BLEND&&l.getLights().forEach(C=>{C.getSwitch()>0&&d++});const v=e.currentValidInputs.length,y=v>1;e.numberOfComponents=y?v:m.getNumberOfComponents(),e.useIndependentComponents=r(w,e.numberOfComponents)}d!==e.numberOfLights&&(e.numberOfLights=d,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(l,f),t.renderPieceDraw(l,f),t.renderPieceFinish(l,f))},t.updateBufferObjects=(l,f)=>{t.getNeedToRebuildBufferObjects(l,f)&&t.buildBufferObjects(l,f)},t.getNeedToRebuildBufferObjects=(l,f)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<f.getMTime()||e.VBOBuildTime.getMTime()<f.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.currentValidInputs.some(u=>{let{imageData:d}=u;return e.VBOBuildTime.getMTime()<d.getMTime()})||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(u=>!!u?.getHandle())||!e.colorTexture?.getHandle()||!e.opacityTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle()||!e.jitterTexture?.getHandle(),t.buildBufferObjects=(l,f)=>{if(!e.jitterTexture.getHandle()){const R=new Float32Array(1024);for(let A=0;A<1024;++A)R[A]=Math.random();e.jitterTexture.setMinificationFilter(Mt.NEAREST),e.jitterTexture.setMagnificationFilter(Mt.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:Qt.FLOAT,data:R})}const u=f.getProperties(),d=e.currentValidInputs[0],h=u[d.inputIndex],g=e.numberOfComponents,p=e.useIndependentComponents,m=p?g:1,w=[];for(let R=0;R<m;++R)w.push(h.getScalarOpacity(R));const v=xs(w,p,m),y=h.getScalarOpacity(),C=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!C?.oglObject?.getHandle()||C.hash!==v){const R=Kn.newInstance();R.setOpenGLRenderWindow(e._openGLRenderWindow);let A=e.renderable.getOpacityTextureWidth();A<=0&&(A=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const B=A*2*m,k=new Float32Array(B),L=new Float32Array(A);for(let F=0;F<m;++F){const j=h.getScalarOpacity(F),J=t.getCurrentSampleDistance(l)/h.getScalarOpacityUnitDistance(F),ie=j.getRange();j.getTable(ie[0],ie[1],A,L,1);for(let fe=0;fe<A;++fe)k[F*A*2+fe]=1-(1-L[fe])**J,k[F*A*2+fe+A]=k[F*A*2+fe]}if(R.resetFormatAndType(),R.setMinificationFilter(Mt.LINEAR),R.setMagnificationFilter(Mt.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))R.create2DFromRaw({width:A,height:2*m,numComps:1,dataType:Qt.FLOAT,data:k});else{const F=new Uint8ClampedArray(B);for(let j=0;j<B;++j)F[j]=255*k[j];R.create2DFromRaw({width:A,height:2*m,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:F})}y&&e._openGLRenderWindow.setGraphicsResourceForObject(y,R,v),e.opacityTexture=R}else e.opacityTexture=C.oglObject;s(e._openGLRenderWindow,e._opacityTextureCore,y),e._opacityTextureCore=y;const T=[];for(let R=0;R<m;++R)T.push(h.getRGBTransferFunction(R));const S=xs(T,p,m),_=h.getRGBTransferFunction(),E=e._openGLRenderWindow.getGraphicsResourceForObject(_);if(!E?.oglObject?.getHandle()||E?.hash!==S){const R=Kn.newInstance();R.setOpenGLRenderWindow(e._openGLRenderWindow);let A=e.renderable.getColorTextureWidth();A<=0&&(A=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const B=A*2*m*3,k=new Uint8ClampedArray(B),L=new Float32Array(A*3);for(let F=0;F<m;++F){const j=h.getRGBTransferFunction(F),J=j.getRange();j.getTable(J[0],J[1],A,L,1);for(let ie=0;ie<A*3;++ie)k[F*A*6+ie]=255*L[ie],k[F*A*6+ie+A*3]=255*L[ie]}R.resetFormatAndType(),R.setMinificationFilter(Mt.LINEAR),R.setMagnificationFilter(Mt.LINEAR),R.create2DFromRaw({width:A,height:2*m,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:k}),e._openGLRenderWindow.setGraphicsResourceForObject(_,R,S),e.colorTexture=R}else e.colorTexture=E.oglObject;s(e._openGLRenderWindow,e._colorTextureCore,_),e._colorTextureCore=_,e.currentValidInputs.forEach((R,A)=>{let{imageData:B,inputIndex:k}=R;const L=u[k],F=B.getPointData().getScalars(),j=e._openGLRenderWindow.getGraphicsResourceForObject(F),J=TC(B,F),ie=!j?.oglObject?.getHandle()||j?.hash!==J,fe=L.getUpdatedExtents(),ae=!!fe.length;if(ie&&!ae){const de=Kn.newInstance();de.setOpenGLRenderWindow(e._openGLRenderWindow);const we=B.getDimensions();de.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),de.resetFormatAndType(),de.create3DFilterableFromDataArray({width:we[0],height:we[1],depth:we[2],dataArray:F,preferSizeOverAccuracy:L.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(F,de,J),e.scalarTextures[A]=de}else e.scalarTextures[A]=j.oglObject;if(ae){L.setUpdatedExtents([]);const de=B.getDimensions();e.scalarTextures[A].create3DFilterableFromDataArray({width:de[0],height:de[1],depth:de[2],dataArray:F,updatedExtents:fe})}s(e._openGLRenderWindow,e._scalarTexturesCore[A],F),e._scalarTexturesCore[A]=F});const b=h.getLabelOutlineThickness(),I=e._openGLRenderWindow.getGraphicsResourceForObject(b),O=b.join("-");if(!I?.oglObject?.getHandle()||I?.hash!==O){const R=Kn.newInstance();R.setOpenGLRenderWindow(e._openGLRenderWindow);let A=e.renderable.getLabelOutlineTextureWidth();A<=0&&(A=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const B=1,k=A*B,L=new Uint8Array(k);for(let F=0;F<A;++F){const j=typeof b[F]<"u"?b[F]:b[0];L[F]=j}R.resetFormatAndType(),R.setMinificationFilter(Mt.NEAREST),R.setMagnificationFilter(Mt.NEAREST),R.create2DFromRaw({width:A,height:B,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:L}),b&&e._openGLRenderWindow.setGraphicsResourceForObject(b,R,O),e.labelOutlineThicknessTexture=R}else e.labelOutlineThicknessTexture=I.oglObject;if(s(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,b),e._labelOutlineThicknessTextureCore=b,!e.tris.getCABO().getElementCount()){const R=new Float32Array(12);for(let L=0;L<4;L++)R[L*3]=L%2*2-1,R[L*3+1]=L>1?1:-1,R[L*3+2]=-1;const A=new Uint16Array(8);A[0]=3,A[1]=0,A[2]=1,A[3]=3,A[4]=3,A[5]=0,A[6]=3,A[7]=2;const B=Tt.newInstance({numberOfComponents:3,values:R});B.setName("points");const k=Tt.newInstance({numberOfComponents:1,values:A});e.tris.getCABO().createVBO(k,"polys",li.SURFACE,{points:B,cellOffset:0})}e.VBOBuildTime.modified()}}const cz={context:null,VBOBuildTime:null,scalarTextures:[],_scalarTexturesCore:[],opacityTexture:null,_opacityTextureCore:null,colorTexture:null,_colorTextureCore:null,labelOutlineThicknessTexture:null,_labelOutlineThicknessTextureCore:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,fullViewportTime:1,idxToView:null,vecISToVCMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function N6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cz,r),Yn.extend(t,e,r),Cs.implementBuildShadersWithReplacements(t,e,r),e.VBOBuildTime={},Zn(e.VBOBuildTime,{mtime:0}),e.tris=Fa.newInstance(),e.jitterTexture=Kn.newInstance(),e.jitterTexture.setWrapS(xh.REPEAT),e.jitterTexture.setWrapT(xh.REPEAT),e.framebuffer=lg.newInstance(),Er(t,e,["context"]),sz(t,e)}const V6=On(N6,"vtkOpenGLVolumeMapper");var k6={newInstance:V6,extend:N6};Vr("vtkVolumeMapper",V6);const{vtkDebugMacro:lz}=_i;function uz(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),o=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=n.getZBufferTexture(),l=Math.floor(c.getWidth()),f=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const d=n.getFramebuffer();d?d.saveCurrentBindingsAndBuffers():lz("No framebuffer to save/restore");const h=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,h),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(l*f*4),u.viewport(0,0,l,f),u.readPixels(0,0,l,f,u.RGBA,u.UNSIGNED_BYTE,s)),d&&d.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(h)}e.renderable.invokeCallback(e.renderable.getInputData(),o,i,a,s)},t.queryPass=(r,n)=>{r&&e.renderable.getUseZValues()&&n.requestDepth()}}const fz={};function dz(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fz,r),Yn.extend(t,e,r),uz(t,e)}const F6=On(dz,"vtkOpenGLPixelSpaceCallbackMapper");var hz={newInstance:F6};Vr("vtkPixelSpaceCallbackMapper",F6);const U6=Object.create(null);function ca(t,e){U6[t]=e}function gz(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const pz={};function mz(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pz,r),e.overrides=U6,yC.extend(t,e,r),gz(t,e)}K.newInstance(mz,"vtkWebGPUViewNodeFactory");function vz(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(r,n,i,o)=>{if(_t(r),e.renderable.getParallelProjection()){const a=e.renderable.getParallelScale(),s=a*n,c=a,l=(o[0]-1)*s,f=(o[0]+1)*s,u=(o[1]-1)*c,d=(o[1]+1)*c,h=1/(f-l),g=1/(d-u);r[0]=2*h,r[5]=2*g,r[10]=1/(i[1]-i[0]),r[12]=(f+l)*h,r[13]=(d+u)*g,r[14]=i[1]/(i[1]-i[0])}else{const a=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*a,c=i[0]*a/n):(s=i[0]*a*n,c=i[0]*a);const l=(o[0]-1)*s,f=(o[0]+1)*s,u=(o[1]-1)*c,d=(o[1]+1)*c;r[0]=2*i[0]/(f-l),r[5]=2*i[0]/(d-u),r[12]=(l+f)/(f-l),r[13]=(u+d)/(d-u),r[10]=0,r[14]=i[0],r[11]=-1,r[15]=0}},t.convertToOpenGLDepth=r=>{if(e.renderable.getParallelProjection())return 1-r;const n=e.renderable.getClippingRangeByReference();let i=-n[0]/r;return i=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(i*(n[1]-n[0])),.5*i+.5},t.getKeyMatrices=r=>{const n=r.getRenderable(),i=r.getParent();if(Math.max(i.getMTime(),t.getMTime(),n.getMTime(),e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatrixTime.getMTime()){const o=e.renderable.getViewMatrix();sr(e.keyMatrices.normalMatrix,o),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,gr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),mn(e.keyMatrices.wcvc,o);const a=r.getStabilizedCenterByReference();Gn(e.keyMatrices.scvc,e.keyMatrices.wcvc,a);const s=r.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),Wt(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),gr(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const yz={keyMatrixTime:null,keyMatrices:null};function wz(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yz,r),Yn.extend(t,e,r),e.keyMatrixTime={},K.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},K.setGet(t,e,["keyMatrixTime"]),vz(t,e)}const Cz=K.newInstance(wz);ca("vtkCamera",Cz);function xz(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=r=>{if(e.bindables.length===r.length){let n=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==r[i]&&(n=!1);if(n)return}e.bindables=r,t.modified()},t.getBindGroupLayout=r=>{const n=[];for(let i=0;i<e.bindables.length;i++){const o=e.bindables[i].getBindGroupLayoutEntry();o.binding=i,n.push(o)}return r.getBindGroupLayout({entries:n})},t.getBindGroup=r=>{let n=t.getMTime();for(let o=0;o<e.bindables.length;o++){const a=e.bindables[o].getBindGroupTime().getMTime();n=a>n?a:n}if(n<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let o=0;o<e.bindables.length;o++){const a=e.bindables[o].getBindGroupEntry();a.binding=o,i.push(a)}return e.bindGroup=r.getHandle().createBindGroup({layout:t.getBindGroupLayout(r),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=r=>{const n=[],i=r.getBindGroupLayoutCount(e.label);for(let o=0;o<e.bindables.length;o++)n.push(e.bindables[o].getShaderCode(o,i));return n.join(`
`)}}const Tz={device:null,handle:null,label:null};function B6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tz,r),K.obj(t,e),e.bindables=[],e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),K.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),K.setGet(t,e,["label","device","arrayInformation"]),xz(t,e)}const Sz=K.newInstance(B6);var G6={newInstance:Sz,extend:B6};function _z(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(r,n)=>{e.device=r,e.handle=e.device.getHandle().createShaderModule({code:n.getCode()})}}const Ez={device:null,handle:null};function W6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ez,r),K.obj(t,e),K.get(t,e,["lastCameraMTime"]),K.setGet(t,e,["device","handle"]),_z(t,e)}const bz=K.newInstance(W6,"vtkWebGPUShaderModule");var Dz={newInstance:bz,extend:W6};function Iz(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(r)?r.join(`
`):r;let o=!1;t.search(e)!==-1&&(o=!0);let a="";n&&(a="g");const s=new RegExp(e,a),c=t.replace(s,i);return{replace:o,result:c}}function Mz(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=r=>{const n=r.getType(),i=r.getHash(),o=e._shaderModules.keys();for(let s=0;s<o.length;s++){const c=o[s];if(c.getHash()===i&&c.getType()===n)return e._shaderModules.get(c)}const a=Dz.newInstance();return a.initialize(e.device,r),e._shaderModules.set(r,a),a}}const Oz={shaderModules:null,device:null,window:null};function $6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oz,r),e._shaderModules=new Map,K.obj(t,e),K.setGet(t,e,["device","window"]),Mz(t,e)}const Pz=K.newInstance($6,"vtkWebGPUShaderCache");var Hn={newInstance:Pz,extend:$6,substitute:Iz};function Rz(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(r,n)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=n;const i=[];for(let o=0;o<e.layouts.length;o++)i.push(e.layouts[o].layout);e.pipelineLayout=r.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let o=0;o<e.shaderDescriptions.length;o++){const a=e.shaderDescriptions[o],s=r.getShaderModule(a);a.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),a.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=r.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=r=>{for(let n=0;n<e.shaderDescriptions.length;n++)if(e.shaderDescriptions[n].getType()===r)return e.shaderDescriptions[n];return null},t.addBindGroupLayout=r=>{r&&e.layouts.push({layout:r.getBindGroupLayout(e.device),label:r.getLabel()})},t.getBindGroupLayout=r=>e.layouts[r].layout,t.getBindGroupLayoutCount=r=>{for(let n=0;n<e.layouts.length;n++)if(e.layouts[n].label===r)return n;return 0},t.bindVertexInput=(r,n)=>{n.bindBuffers(r)}}const Az={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function z6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Az,r),Zn(t,e),e.layouts=[],e.shaderDescriptions=[],Wi(t,e,["handle","pipelineDescription"]),Er(t,e,["device","renderEncoder","topology","vertexState"]),Rz(t,e)}const Lz=On(z6,"vtkWebGPUPipeline");var Nz={newInstance:Lz,extend:z6};function Vz(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=r=>e.outputNames.includes(r),t.addOutput=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(r),e.outputNames.push(n),e.outputInterpolations.push(i)},t.addBuiltinOutput=(r,n)=>{e.builtinOutputTypes.push(r),e.builtinOutputNames.push(n)},t.addBuiltinInput=(r,n)=>{e.builtinInputTypes.push(r),e.builtinInputNames.push(n)},t.replaceShaderCode=(r,n)=>{const i=[];let o=[];if(n&&i.push(n.getShaderCode()),r||e.builtinInputNames.length){const a=[];if(a.push(`struct ${e.type}Input
{`),r){const s=r.getOutputNamesByReference(),c=r.getOutputTypesByReference(),l=r.getOutputInterpolationsByReference();for(let f=0;f<s.length;f++)l[f]!==void 0?a.push(`  @location(${f}) @interpolate(${l[f]}) ${s[f]} : ${c[f]},`):a.push(`  @location(${f}) ${s[f]} : ${c[f]},`)}for(let s=0;s<e.builtinInputNames.length;s++)a.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);a.length>1&&(a.push("};"),o=a,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=Hn.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const a=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?a.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):a.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)a.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);a.push("};"),o=o.concat(a),e.code=Hn.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=Hn.substitute(e.code,"//VTK::IOStructs::Dec",o).result}}const kz={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function j6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kz,r),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],K.obj(t,e),K.setGet(t,e,["type","hash","code"]),K.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),Vz(t,e)}const Fz=K.newInstance(j6,"vtkWebGPUShaderDescription");var TS={newInstance:Fz,extend:j6};const SS={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function Uz(t){return!t||t.length<6?0:t in SS?SS[t]:(dn(`unknown format ${t}`),null)}function Bz(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const r=e===1?t.length-1:t.length-3,n=Number(t[r]);if(Number.isNaN(n))return dn(`unknown format ${t}`),0;const i=5-n/2;return e*i}function Gz(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function Wz(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{dn(`unknown format ${t}`);return}const r=t.split("x")[0],n=Number(r[r.length-1]);if(Number.isNaN(n)){dn(`unknown format ${t}`);return}return e+=8*(5-n/2),e+="Array",e}function $z(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{dn(`unknown format ${t}`);return}let r=1;return t[t.length-2]==="x"&&(r=Number(t[t.length-1])),r===4?`vec4<${e}>`:r===3?`vec3<${e}>`:r===2?`vec2<${e}>`:e}function zz(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function jz(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";dn(`unknown format ${t}`)}}var wi={getDetailsFromTextureFormat:Uz,getByteStrideFromBufferFormat:Bz,getNumberOfComponentsFromBufferFormat:Gz,getNativeTypeFromBufferFormat:Wz,getShaderTypeFromBufferFormat:$z,getByteStrideFromShaderFormat:zz,getNativeTypeFromShaderFormat:jz};function Hz(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!e.includes(t[r]))return!1;return!0}function Kz(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",o=n;Array.isArray(o)||(o=[o]);for(let a=0;a<e.inputs.length;a++)if(Hz(e.inputs[a].names,o)){if(e.inputs[a].buffer===r)return;e.inputs[a].buffer=r;return}e.inputs.push({buffer:r,stepMode:i,names:o}),e.inputs=e.inputs.sort((a,s)=>a.names[0]<s.names[0]?-1:a.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=r=>{for(let n=0;n<e.inputs.length;n++)e.inputs[n].names.includes(r)&&e.inputs.splice(n,1)},t.getBuffer=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer;return null},t.hasAttribute=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return!0;return!1},t.getAttributeTime=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let r="",n=0;for(let i=0;i<e.inputs.length;i++)for(let o=0;o<e.inputs[i].names.length;o++){const a=e.inputs[i].buffer.getArrayInformation()[o],s=wi.getShaderTypeFromBufferFormat(a.format);n>0&&(r+=`,
`),r=`${r}  @location(${n}) ${e.inputs[i].names[o]} : ${s}`,n++}return r},t.getVertexInputInformation=()=>{const r={};if(e.inputs.length){const n=[];let i=0;for(let o=0;o<e.inputs.length;o++){const a=e.inputs[o].buffer,s={arrayStride:a.getStrideInBytes(),stepMode:e.inputs[o].stepMode,attributes:[]},c=a.getArrayInformation();for(let l=0;l<e.inputs[o].names.length;l++)s.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;n.push(s)}r.buffers=n}return r},t.bindBuffers=r=>{for(let n=0;n<e.inputs.length;n++)r.setVertexBuffer(n,e.inputs[n].buffer.getHandle());e.indexBuffer&&r.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const Xz={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function H6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xz,r),Zn(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Er(t,e,["created","device","handle","indexBuffer"]),Kz(t,e)}const qz=On(H6,"vtkWebGPUVertexInput");var Yz={newInstance:qz,extend:H6};const Jz=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,Zz=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function Qz(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(r,n,i)=>{const o=TS.newInstance({type:"vertex",hash:r,code:e.vertexShaderTemplate}),a=TS.newInstance({type:"fragment",hash:r,code:e.fragmentShaderTemplate}),s=n.getShaderDescriptions();s.push(o),s.push(a);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((d,h,g)=>g.indexOf(d)===h).map(d=>`replaceShader${d.substring(7,d.length-2)}`);for(let d=0;d<u.length;d++){const h=u[d];h!=="replaceShaderIOStructs"&&e.shaderReplacements.has(h)&&e.shaderReplacements.get(h)(r,n,i)}t.replaceShaderIOStructs(r,n,i)},t.replaceShaderIOStructs=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.replaceShaderCode(null,i),n.getShaderDescription("fragment").replaceShaderCode(o)},t.replaceShaderRenderEncoder=(r,n,i)=>{e.renderEncoder.replaceShaderCode(n)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(r,n,i)=>{if(!e.WebGPURenderer)return;const o=e.WebGPURenderer.getBindGroup().getShaderCode(n),a=n.getShaderDescription("vertex");let s=a.getCode();s=Hn.substitute(s,"//VTK::Renderer::Dec",[o]).result,a.setCode(s);const c=n.getShaderDescription("fragment");s=c.getCode(),s=Hn.substitute(s,"//VTK::Renderer::Dec",[o]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(r,n,i)=>{const o=e.bindGroup.getShaderCode(n),a=n.getShaderDescription("vertex");let s=a.getCode();s=Hn.substitute(s,"//VTK::Mapper::Dec",[o]).result,a.setCode(s);const c=n.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=Hn.substitute(s,"//VTK::Mapper::Dec",[o]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let a=o.getCode();a=Hn.substitute(a,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(r,n,i)=>{n.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=r=>{e.textureViews.includes(r)||e.textureViews.push(r)},t.prepareToDraw=r=>{e.renderEncoder=r,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=r=>{r.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=r=>{t.prepareToDraw(r),r.setPipeline(e.pipeline),t.draw(r)},t.draw=r=>{const n=r.getBoundPipeline();r.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(r),n.bindVertexInput(r,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?r.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):r.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const r=[...e.additionalBindables];e.UBO&&r.push(e.UBO),e.SSBO&&r.push(e.SSBO);for(let n=0;n<e.textureViews.length;n++){r.push(e.textureViews[n]);const i=e.textureViews[n].getSampler();i&&r.push(i)}return r},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Nz.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const ej={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function K6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ej,r),Yn.extend(t,e,r),e.textureViews=[],e.vertexInput=Yz.newInstance(),e.bindGroup=G6.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||Zz,e.vertexShaderTemplate=e.vertexShaderTemplate||Jz,e.shaderReplacements=new Map,K.get(t,e,["pipeline","vertexInput"]),K.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),Qz(t,e)}const tj=K.newInstance(K6,"vtkWebGPUSimpleMapper");var X6={newInstance:tj,extend:K6};function nj(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),o.addOutput("vec4<f32>","vertexVC");let a=o.getCode();a=Hn.substitute(a,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const r=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(r,["vertexBC"]),e.numberOfVertices=6}}const rj={};function q6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rj,r),X6.extend(t,e,r),nj(t,e)}const ij=K.newInstance(q6,"vtkWebGPUFullScreenQuad");var h5={newInstance:ij,extend:q6};const oj={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},aj={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var ug={BufferUsage:oj,PrimitiveTypes:aj};const yv=["getMappedRange","mapAsync","unmap"];function sj(t,e,r,n){const i=n.byteLength,o=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),a=o.getMappedRange(0,i);new Uint8Array(a).set(new Uint8Array(n)),o.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(o,0,e,r,i);const c=s.finish();t.queue.submit([c]),o.destroy()}function cj(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r,usage:n,label:e.label}),e.sizeInBytes=r,e.usage=n},t.write=r=>{sj(e.device.getHandle(),e.handle,0,r.buffer)},t.createAndWrite=(r,n)=>{const i=Math.ceil(r.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:i,usage:n,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=i,e.usage=n,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(r.buffer)),e.handle.unmap()};for(let r=0;r<yv.length;r++)t[yv[r]]=function(){return e.handle[yv[r]](...arguments)}}const lj={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function Y6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lj,r),K.obj(t,e),K.get(t,e,["handle","sizeInBytes","usage"]),K.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),cj(t,e)}const uj=K.newInstance(Y6);var g5={newInstance:uj,extend:Y6,...ug};const{Representation:Od,Interpolation:Pd}=g6;function _S(t){return()=>K.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function fj(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(r,n,i)=>{Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==i)&&(e.color[0]=r,e.color[1]=n,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=_S("ComputeCompositeColor"),t.getColor=()=>{let r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(let n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=r=>{const n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=_S("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Pd.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Pd.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Pd.PHONG),t.getInterpolationAsString=()=>K.enumToString(Pd,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Od.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Od.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Od.POINTS),t.getRepresentationAsString=()=>K.enumToString(Od,e.representation)}const dj={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Pd.GOURAUD,representation:Od.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function J6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dj,r),K.obj(t,e),K.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),K.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),fj(t,e)}const hj=K.newInstance(J6,"vtkProperty");var cf={newInstance:hj,extend:J6,...g6};const{Representation:ES}=cf,{PrimitiveTypes:ul}=ug;class gj{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return!0}get(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return this.values[r]}set(e,r){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=r)}}function pj(t){switch(t){case ul.Points:return"points";case ul.Lines:return"lines";case ul.Triangles:case ul.TriangleEdges:return"polys";case ul.TriangleStripEdges:case ul.TriangleStrips:return"strips";default:return""}}function qg(t,e,r){let n=t.pointIdToFlatId[e];return n<0&&(n=t.flatId,t.pointIdToFlatId[e]=n,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=r,t.flatId++),n}function mj(t,e,r){const n=t.length;for(let a=0;a<n;a++){let s=t[a];if(r.cellProvokedMap.has(s)){r.ibo[r.iboId++]=r.cellProvokedMap.get(s);for(let c=a+1;c<a+n;c++){s=t[c%n];const l=qg(r,s,e);r.ibo[r.iboId++]=l}return}}for(let a=0;a<n;a++){let s=t[a];if(!r.provokedPointIds[s]){let c=qg(r,s,e);r.provokedPointIds[s]=1,r.cellProvokedMap.set(s,c),r.flatIdToCellId[c]=e,r.ibo[r.iboId++]=c;for(let l=a+1;l<a+n;l++)s=t[l%n],c=qg(r,s,e),r.ibo[r.iboId++]=c;return}}let i=t[0],o=r.flatId;r.cellProvokedMap.set(i,o),r.flatIdToPointId[r.flatId]=i,r.flatIdToCellId[r.flatId]=e,r.flatId++,r.ibo[r.iboId++]=o;for(let a=1;a<n;a++)i=t[a],o=qg(r,i,e),r.ibo[r.iboId++]=o}function vj(t,e,r){const n=t.length;r.iboSize+=n;for(let i=0;i<n;i++){const o=t[i];if(r.cellProvokedMap.has(o))return}for(let i=0;i<n;i++){const o=t[i];if(!r.provokedPointIds[o]){r.provokedPointIds[o]=1,r.cellProvokedMap.set(o,1);return}}r.cellProvokedMap.set(t[0],1),r.extraPoints++}let nc;const bS=new Uint32Array(1),jo=new Uint32Array(2),nl=new Uint32Array(3),wv={anythingToPoints(t,e,r,n,i){for(let o=0;o<t;++o)bS[0]=e[r+o],nc(bS,n,i)},linesToWireframe(t,e,r,n,i){for(let o=0;o<t-1;++o)jo[0]=e[r+o],jo[1]=e[r+o+1],nc(jo,n,i)},polysToWireframe(t,e,r,n,i){if(t>2)for(let o=0;o<t;++o)jo[0]=e[r+o],jo[1]=e[r+(o+1)%t],nc(jo,n,i)},stripsToWireframe(t,e,r,n,i){if(t>2){for(let o=0;o<t-1;++o)jo[0]=e[r+o],jo[1]=e[r+o+1],nc(jo,n,i);for(let o=0;o<t-2;o++)jo[0]=e[r+o],jo[1]=e[r+o+2],nc(jo,n,i)}},polysToSurface(t,e,r,n,i){for(let o=0;o<t-2;o++)nl[0]=e[r],nl[1]=e[r+o+1],nl[2]=e[r+o+2],nc(nl,n,i)},stripsToSurface(t,e,r,n,i){for(let o=0;o<t-2;o++)nl[0]=e[r+o],nl[1]=e[r+o+1+o%2],nl[2]=e[r+o+1+(o+1)%2],nc(nl,n,i)}};function yj(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=r=>{const n=r.cells,i=r.primitiveType,o=r.representation,a=r.cellOffset,s=n.getData(),c=s.length,l=pj(i),f=r.numberOfPoints,u={provokedPointIds:new Uint8Array(f),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new gj};let d=null;o===ES.POINTS||i===ul.Points?d=wv.anythingToPoints:o===ES.WIREFRAME||i===ul.Lines?d=wv[`${l}ToWireframe`]:d=wv[`${l}ToSurface`],nc=vj;let h=a||0;for(let g=0;g<c;)u.cellProvokedMap.clear(),d(s[g],s,g+1,h,u),g+=s[g]+1,h++;f<=65535?u.flatIdToPointId=new Uint16Array(f+u.extraPoints):u.flatIdToPointId=new Uint32Array(f+u.extraPoints),f+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(f):u.pointIdToFlatId=new Int32Array(f),f+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),r.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),r.format="uint32"),h<=65535?u.flatIdToCellId=new Uint16Array(f+u.extraPoints):u.flatIdToCellId=new Uint32Array(f+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),nc=mj,h=a||0;for(let g=0;g<c;)u.cellProvokedMap.clear(),d(s[g],s,g+1,h,u),g+=s[g]+1,h++;delete u.provokedPointIds,delete u.pointIdToFlatId,r.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const wj={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function Z6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wj,r),g5.extend(t,e,r),K.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),yj(t,e)}const Cj=K.newInstance(Z6);var xj={newInstance:Cj,extend:Z6,...ug};const{BufferUsage:rl}=ug,{vtkErrorMacro:Tj}=_i,{VtkDataTypes:fu}=Tt,Sj={};function _j(t){let e;switch(t.getDataType()){case fu.UNSIGNED_CHAR:e="uint8";break;case fu.FLOAT:e="float32";break;case fu.UNSIGNED_INT:e="uint32";break;case fu.INT:e="sint32";break;case fu.DOUBLE:e="float32";break;case fu.UNSIGNED_SHORT:e="uint16";break;case fu.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||Tj(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function DS(t,e,r,n,i){const o={},a=t.getFlatSize();if(!a)return o;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let f,u=0;const d=r+(l?1:0),h=M0(n,a*d);let g=t.getFlatIdToPointId();i.cellData&&(g=t.getFlatIdToCellId()),r===1?f=function(m){h[u++]=c[0]*e[m]+s[0]}:r===2?f=function(m){h[u++]=c[0]*e[m]+s[0],h[u++]=c[1]*e[m+1]+s[1]}:r===3&&!l?f=function(m){h[u++]=c[0]*e[m]+s[0],h[u++]=c[1]*e[m+1]+s[1],h[u++]=c[2]*e[m+2]+s[2]}:r===3&&l?f=function(m){h[u++]=c[0]*e[m]+s[0],h[u++]=c[1]*e[m+1]+s[1],h[u++]=c[2]*e[m+2]+s[2],h[u++]=c[3]*1+s[3]}:r===4&&(f=function(m){h[u++]=c[0]*e[m]+s[0],h[u++]=c[1]*e[m+1]+s[1],h[u++]=c[2]*e[m+2]+s[2],h[u++]=c[3]*e[m+3]+s[3]});for(let p=0;p<a;p++){const m=r*g[p];f(m)}return o.nativeArray=h,o}function Ej(t,e,r,n){const i=[t[n*3]-t[r*3],t[n*3+1]-t[r*3+1],t[n*3+2]-t[r*3+2]],o=[t[e*3]-t[r*3],t[e*3+1]-t[r*3+1],t[e*3+2]-t[r*3+2]],a=[];return Qi(i,o,a),Ro(a),a}function bj(t,e){const r=e.getData(),n=t.getData();if(!n||!r)return null;const i=new Int8Array(t.getNumberOfCells()*4),o=n.length;let a=0;for(let s=0;s<o;){const c=Ej(r,n[s+1],n[s+2],n[s+3]);i[a++]=127*c[0],i[a++]=127*c[1],i[a++]=127*c[2],i[a++]=127,s+=n[s]+1}return i}function Dj(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function r(n){n.dataArray&&!n.nativeArray&&(n.nativeArray=n.dataArray.getData());let i,o;if(n.usage===rl.Index&&(i=xj.newInstance({label:n.label}),i.setDevice(e.device),o=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(n),i.createAndWrite(n.nativeArray,o),i.setArrayInformation([{format:n.format}])),i||(i=g5.newInstance({label:n.label}),i.setDevice(e.device)),n.usage===rl.UniformArray&&(o=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(n.nativeArray,o)),n.usage===rl.Storage&&(o=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(n.nativeArray,o)),n.usage===rl.Texture&&(o=GPUBufferUsage.COPY_SRC,i.createAndWrite(n.nativeArray,o)),n.usage===rl.PointArray){o=GPUBufferUsage.VERTEX;const a=wi.getNativeTypeFromBufferFormat(n.format),s=DS(n.indexBuffer,n.dataArray.getData(),n.dataArray.getNumberOfComponents(),a,{packExtra:n.packExtra,shift:n.shift,scale:n.scale,cellData:n.cellData,cellOffset:n.cellOffset});i.createAndWrite(s.nativeArray,o),i.setStrideInBytes(wi.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format,interpolation:n.cellData?"flat":"perspective"}])}if(n.usage===rl.NormalsFromPoints){o=GPUBufferUsage.VERTEX;const a=wi.getNativeTypeFromBufferFormat(n.format),s=bj(n.cells,n.dataArray),c=DS(n.indexBuffer,s,4,a,{cellData:!0});i.createAndWrite(c.nativeArray,o),i.setStrideInBytes(wi.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format,interpolation:"flat"}])}return n.usage===rl.RawVertex&&(o=GPUBufferUsage.VERTEX,i.createAndWrite(n.nativeArray,o),i.setStrideInBytes(wi.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format}])),i.setSourceTime(n.time),i}t.hasBuffer=n=>e.device.hasCachedObject(n),t.getBuffer=n=>n.hash?e.device.getCachedObject(n.hash,r,n):r(n),t.getBufferForPointArray=(n,i)=>{const o=_j(n),a={hash:`${n.getMTime()}I${i.getMTime()}${o}`,usage:rl.PointArray,format:o,dataArray:n,indexBuffer:i};return t.getBuffer(a)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=g5.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const n=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(n,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const Ij={device:null,fullScreenQuadBuffer:null};function Mj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ij,r),Zn(t,e),Er(t,e,["device"]),Dj(t,e)}On(Mj);var fg={...Sj,...ug};const{BufferUsage:Oj}=fg,{vtkErrorMacro:vf}=K;function Pj(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){vf(`entry named ${r} already exists`);return}e._bufferEntryNames.set(r,e.bufferEntries.length);const i=wi.getByteStrideFromShaderFormat(n);e.bufferEntries.push({name:r,type:n,sizeInBytes:i,offset:e.sizeInBytes,nativeType:wi.getNativeTypeFromShaderFormat(n)}),e.sizeInBytes+=i},t.send=r=>{if(!e._buffer){const n={nativeArray:e.Float32Array,usage:Oj.Storage,label:e.label};e._buffer=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e._sendTime.modified();return}r.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[r]=K.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n,i)=>{const o=e._bufferEntryNames.get(r);if(o===void 0){vf(`entry named ${r} not found in UBO`);return}const a=e.bufferEntries[o];t.createView(a.nativeType);const s=e[a.nativeType];s[(a.offset+n*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(r,n,i)=>{const o=e._bufferEntryNames.get(r);if(o===void 0){vf(`entry named ${r} not found in UBO`);return}const a=e.bufferEntries[o];t.createView(a.nativeType);const s=e[a.nativeType],c=(a.offset+n*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)s[c+l]=i[l]},t.setAllInstancesFromArray=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){vf(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)a[l+f]=n[c*s+f]}},t.setAllInstancesFromArrayColorToFloat=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){vf(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)a[l+f]=n[c*s+f]/255}},t.setAllInstancesFromArray3x3To4x4=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){vf(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let f=0;f<3;f++)for(let u=0;u<3;u++)a[l+f*4+u]=n[c*s+f*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(r,n)=>{const i=[`struct ${e.label}StructEntry
{`];for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];i.push(`  ${a.name}: ${a.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${r}) @group(${n}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const Rj={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function Q6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rj,r),K.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},K.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},K.get(t,e,["bindGroupTime"]),K.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),Pj(t,e)}const Aj=K.newInstance(Q6,"vtkWebGPUStorageBuffer");var Lj={newInstance:Aj,extend:Q6};const{BufferUsage:Nj}=fg,{vtkErrorMacro:Cv}=K;function Vj(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){Cv(`entry named ${r} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(r,e.bufferEntries.length),e.bufferEntries.push({name:r,type:n,sizeInBytes:wi.getByteStrideFromShaderFormat(n),offset:-1,nativeType:wi.getNativeTypeFromShaderFormat(n),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let r=0;const n=[];let i=4;for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.sizeInBytes%16===0&&(i=Math.max(16,i)),a.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.packed===!1&&a.sizeInBytes%16===0&&(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(a.packed===!1&&a.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(!a.packed&&a.sizeInBytes%8===0)for(let s=o+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(!a.packed&&a.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let f=c+1;f<e.bufferEntries.length;f++){const u=e.bufferEntries[f];if(!u.packed&&u.sizeInBytes===4){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,l.packed=!0,l.offset=r,n.push(l),r+=l.sizeInBytes,u.packed=!0,u.offset=r,n.push(u),r+=u.sizeInBytes,s=!0;break}}}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];!a.packed&&a.sizeInBytes>4&&(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.packed||(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}e.bufferEntries=n,e._bufferEntryNames.clear();for(let o=0;o<e.bufferEntries.length;o++)e._bufferEntryNames.set(e.bufferEntries[o].name,o);e.sizeInBytes=r,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=r=>{if(!e.UBO){const n={nativeArray:e.Float32Array,usage:Nj.UniformArray,label:e.label};e.UBO=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(r.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[r]=K.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(r);if(i===void 0){Cv(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType];o.lastValue!==n&&(a[o.offset/a.BYTES_PER_ELEMENT]=n,e.sendDirty=!0),o.lastValue=n},t.setArray=(r,n)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(r);if(i===void 0){Cv(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType];let s=!1;for(let c=0;c<n.length;c++)(!o.lastValue||o.lastValue[c]!==n[c])&&(a[o.offset/a.BYTES_PER_ELEMENT+c]=n[c],s=!0);s&&(e.sendDirty=!0,o.lastValue=[...n])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(r,n)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];i.push(`  ${a.name}: ${a.type},`)}return i.push(`};
@binding(${r}) @group(${n}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const kj={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function eI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kj,r),K.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},K.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,K.get(t,e,["binding","bindGroupTime"]),K.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),Vj(t,e)}const Fj=K.newInstance(eI,"vtkWebGPUUniformBuffer");var Jf={newInstance:Fj,extend:eI};const{vtkDebugMacro:Uj}=_i,IS=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,Bj=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Yg=new Float64Array(16),MS=new Float64Array(16);function Gj(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function Wj(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const r=e.camera.getClippingRange(),n=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),o=[],a=[];Jn(a,i,.5*(r[0]+r[1])),nr(o,n,a),an(a,o,e.stabilizedCenter),p0(a)/(r[1]-r[0])>e.recenterThreshold&&(e.stabilizedCenter=o,e.stabilizedTime.modified())},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let i=0;i<n.length;++i)n[i].getSwitch()>0&&r++;return r||(Uj("No lights are on, creating one."),e.renderable.createLight()),r},t.updateUBO=()=>{const r=e.UBO.getSendTime();if(e._parent.getMTime()>r||t.getMTime()>r||e.camera.getMTime()>r||e.renderable.getMTime()>r){const n=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",n.wcvc),e.UBO.setArray("SCPCMatrix",n.scpc),e.UBO.setArray("PCSCMatrix",n.pcsc),e.UBO.setArray("SCVCMatrix",n.scvc),e.UBO.setArray("VCPCMatrix",n.vcpc),e.UBO.setArray("WCVCNormals",n.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",e.renderable.getEnvironmentTexture()?.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const i=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[i.usize,i.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const o=e._parent.getDevice();e.UBO.sendIfNeeded(o)}},t.updateSSBO=()=>{const r=e.renderable.getLights(),n=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let o=0;o<r.length;o++)i+=r[o].getMTime();if(i!==e.lightTimeString){const o=new Float32Array(r.length*4),a=new Float32Array(r.length*4),s=new Float32Array(r.length*4),c=new Float32Array(r.length*4);for(let f=0;f<r.length;f++){const u=f*4,d=r[f].getPosition();Pt(d,d,n.wcvc),o[u]=d[0],o[u+1]=d[1],o[u+2]=d[2],o[u+3]=0,a[u]=-r[f].getDirection()[0],a[u+1]=-r[f].getDirection()[1],a[u+2]=-r[f].getDirection()[2],a[u+3]=0,s[u]=r[f].getColor()[0],s[u+1]=r[f].getColor()[1],s[u+2]=r[f].getColor()[2],s[u+3]=r[f].getIntensity()*5,c[u]=Gj(r[f]),c[u+1]=Math.cos(wr(r[f].getConeAngle())),c[u+2]=Math.cos(wr(r[f].getConeAngle()+r[f].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(r.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",o),e.SSBO.setAllInstancesFromArray("LightDir",a),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=r=>{const n=t.getYInvertedTiledSizeAndOrigin();r.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),r.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},t.bindUBO=r=>{r.activateBindGroup(e.bindGroup)},t.opaquePass=r=>{r?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{if(e.renderable.getTransparent()||e.suppressClear)return;const r=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=h5.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(IS);const o=Jf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&e.backgroundTex?.getImageLoaded()){e.clearFSQ.setFragmentShaderTemplate(Bj);const o=Jf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o);const a=r.getTextureManager().getTextureForVTKTexture(e.backgroundTex,"EnvironmentTexture");if(a.getReady()){const s=a.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([s]),e.backgroundTexLoaded=!0;const c=e.backgroundTex.getInterpolate()?"linear":"nearest";s.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:c,magFilter:c,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=h5.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(IS);const o=Jf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o)}const n=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),mn(MS,n.normalMatrix),_m(Yg,n.scvc,n.pcsc),_m(Yg,MS,Yg),e.clearFSQ.getUBO().setArray("FSQMatrix",Yg),e.clearFSQ.getUBO().sendIfNeeded(r),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.convertToOpenGLDepth=r=>e.webgpuCamera.convertToOpenGLDepth(r),t.getYInvertedTiledSizeAndOrigin=()=>{const r=t.getTiledSizeAndOrigin(),n=e._parent.getSizeByReference();return r.lowerLeftV=n[1]-r.vsize-r.lowerLeftV,r},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],i=r[0]-n[0],o=r[1]-n[1],a=e._parent.normalizedDisplayToDisplay(i,o),s=Math.round(a[0]),c=Math.round(a[1]),l=r[2]-n[0],f=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(l,f);let d=Math.round(u[0])-s,h=Math.round(u[1])-c;return d<0&&(d=0),h<0&&(h=0),{usize:d,vsize:h,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=r=>{for(let n=0;n<e.children.length;n++)if((e.children[n].getPropID?e.children[n].getPropID():-1)===r)return e.children[n];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const $j={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function zj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$j,r),Yn.extend(t,e,r),e.UBO=Jf.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=Lj.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=G6.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=_t(new Float64Array(16)),e.stabilizedTime={},Zn(e.stabilizedTime,{mtime:0}),Wi(t,e,["bindGroup","stabilizedTime"]),O0(t,e,["stabilizedCenter"]),Er(t,e,["renderEncoder","selector","suppressClear","UBO"]),Wj(t,e)}const jj=On(zj,"vtkWebGPURenderer");ca("vtkRenderer",jj);function Hj(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=r,e.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",e.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",e.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",e.options.magFilter=n.magFilter?n.magFilter:"nearest",e.options.minFilter=n.minFilter?n.minFilter:"nearest",e.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(r,n)=>`@binding(${r}) @group(${n}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const Kj={device:null,handle:null,label:null,options:null};function tI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kj,r),K.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),K.get(t,e,["bindGroupTime","handle","options"]),K.setGet(t,e,["bindGroupLayoutEntry","device","label"]),Hj(t,e)}const Xj=K.newInstance(tI);var nI={newInstance:Xj,extend:tI};const{SlicingMode:OS}=Z1,qj=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function Yj(t,e,r){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${r}`}return"0"}const Co=new Float64Array(16),ts=new Float64Array(16),Jg=new Float64Array(16),Ys=new Float64Array(4),Br=new Float64Array(4);function Jj(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const o=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(o.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),o=e.WebGPUImageSlice.getRenderable(),a=o.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||o.getProperty().getMTime()>i){const s=a.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();_t(Co),Gn(Co,Co,c);const l=o.getMatrix();mn(ts,l),gr(ts,ts),Wt(Co,ts,Co);const f=s.getWorldToIndex();Wt(Co,f,Co),gr(Jg,Co),P0(ts,[.5,.5,.5]),Wt(Co,ts,Co);const u=s.getDimensions();_t(ts),ws(ts,ts,[1/u[0],1/u[1],1/u[2]]),Wt(Co,ts,Co),e.UBO.setArray("SCTCMatrix",Co);const d=e.currentInput.getExtent(),{ijkMode:h}=e.renderable.getClosestIJKAxis();let g=e.renderable.getSlice();h!==e.renderable.getSlicingMode()&&(g=e.renderable.getSliceAtPosition(g));let p=2,m=0,w=1;h===OS.I?(p=0,m=1,w=2):h===OS.J&&(p=1,m=2,w=0),Ys[p]=g,Ys[m]=d[m*2]-.5,Ys[w]=d[w*2]-.5,Ys[3]=1,lc(Ys,Ys,Jg),e.UBO.setArray("Origin",Ys),Br[p]=g,Br[m]=d[m*2+1]+.5,Br[w]=d[w*2]-.5,Br[3]=1,lc(Br,Br,Jg),eS(Br,Br,Ys),Br[3]=1,e.UBO.setArray("Axis1",Br),Br[p]=g,Br[m]=d[m*2]-.5,Br[w]=d[w*2+1]+.5,Br[3]=1,lc(Br,Br,Jg),eS(Br,Br,Ys),Br[3]=1,e.UBO.setArray("Axis2",Br);const v=[1,1,1,1],y=[0,0,0,0],C=e.textureViews[0],x=C.getTexture().getScale(),T=C.getTexture().getNumberOfComponents();for(let S=0;S<T;S++){let _=o.getProperty().getColorWindow(),E=o.getProperty().getColorLevel();const b=o.getProperty().getRGBTransferFunction(0);if(b){const I=b.getRange();_=I[1]-I[0],E=.5*(I[1]+I[0])}v[S]=x/_,y[S]=-E/_+.5}e.UBO.setArray("cScale",v),e.UBO.setArray("cShift",y),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const a=1,s=Yj(i,i.getRGBTransferFunction,a);if(e.colorTextureString!==s){e.numRows=a;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const f=new Float32Array(e.rowLength*3);for(let u=0;u<a;u++){l=i.getRGBTransferFunction(u);const d=l.getRange();l.getTable(d[0],d[1],e.rowLength,f,1);for(let h=0;h<e.rowLength;h++){const g=u*e.rowLength*8+h*4;c[g]=255*f[h*3],c[g+1]=255*f[h*3+1],c[g+2]=255*f[h*3+2],c[g+3]=255;for(let p=0;p<4;p++)c[g+e.rowLength*4+p]=c[g+p]}}}else for(let f=0;f<e.rowLength;++f){const u=255*f/(e.rowLength-1);c[f*4]=u,c[f*4+1]=u,c[f*4+2]=u,c[f*4+3]=255;for(let d=0;d<4;d++)c[f*4+e.rowLength*4+d]=c[f*4+d]}{const f={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},d=e.device.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[1]=d}e.colorTextureString=s}};const r=t.updateBuffers;t.updateBuffers=()=>{r();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),o=e.textureViews;if(!o[0]||o[0].getTexture()!==i){const c=i.createView("imgTexture");o[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===Sl.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=nI.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const n=t.getShaderReplacements();t.replaceShaderPosition=(i,o,a)=>{const s=o.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=Hn.substitute(c,"//VTK::Position::Impl",l).result,s.setCode(c)},n.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,o,a)=>{const s=o.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},n.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,o,a)=>{const s=o.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=Hn.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=Hn.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=Hn.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},n.set("replaceShaderImage",t.replaceShaderImage)}const Zj={rowLength:1024};function Qj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zj,r),h5.extend(t,e,r),t.setFragmentShaderTemplate(qj),e.UBO=Jf.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Zn(e.lutBuildTime,{mtime:0}),e.imagemat=_t(new Float64Array(16)),e.imagematinv=_t(new Float64Array(16)),e.VBOBuildTime={},Zn(e.VBOBuildTime),Jj(t,e)}const eH=On(Qj,"vtkWebGPUImageMapper");ca("vtkImageMapper",eH);function tH(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const n=e.renderable.getMatrix(),i=r.getStabilizedCenterByReference();e.bufferShift[0]=n[3]-i[0],e.bufferShift[1]=n[7]-i[1],e.bufferShift[2]=n[11]-i[2],mn(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?_t(e.keyMatrices.normalMatrix):(sr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,gr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),mn(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Gn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),Gn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const nH={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function rH(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nH,r),Yn.extend(t,e,r),e.keyMatricesTime={},Zn(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:_t(new Float64Array(16))},e.bufferShift=[0,0,0,0],Wi(t,e,["propID","keyMatricesTime"]),tH(t,e)}const iH=On(rH,"vtkWebGPUImageSlice");ca("vtkImageSlice",iH);function oH(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,o)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const a=e.renderable.getMapper().getBounds();if(!a||a.length!==6||a[0]>a[1])return;o.addVolume(t)}};const r=new Float64Array(3),n=new Float64Array(3);t.getBoundingCubePoints=(i,o)=>{const a=e.renderable.getMapper().getInputData();if(!a)return;const s=a.getExtent(),c=e.renderable.getMatrix();let l=0;for(let f=4;f<6;f++){r[2]=s[f];for(let u=2;u<4;u++){r[1]=s[u];for(let d=0;d<2;d++){r[0]=s[d],a.indexToWorld(r,n);let h=o+l*3;i[h++]=c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3],i[h++]=c[4]*n[0]+c[5]*n[1]+c[6]*n[2]+c[7],i[h++]=c[8]*n[0]+c[9]*n[1]+c[10]*n[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const o=e.renderable.getMatrix(),a=i.getStabilizedCenterByReference();mn(e.keyMatrices.bcwc,o),Gn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const aH={propID:void 0,keyMatricesTime:null};function sH(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aH,r),Yn.extend(t,e,r),e.keyMatricesTime={},K.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},K.get(t,e,["propID","keyMatricesTime"]),oH(t,e)}const cH=K.newInstance(sH,"vtkWebGPUVolume");ca("vtkVolume",cH);function lH(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),o=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),o,i,a,s)}}const uH={};function fH(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uH,r),Yn.extend(t,e,r),lH(t,e)}const dH=K.newInstance(fH,"vtkWebGPUPixelSpaceCallbackMapper");ca("vtkPixelSpaceCallbackMapper",dH);const qo={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var rI={StructuredType:qo};const{StructuredType:Js}=rI;function hH(t){let e=0;for(let r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?Js.EMPTY:e===3?Js.XYZ_GRID:e===2?t[0]===t[1]?Js.YZ_PLANE:t[2]===t[3]?Js.XZ_PLANE:Js.XY_PLANE:e===1?t[0]<t[1]?Js.X_LINE:t[2]<t[3]?Js.Y_LINE:Js.Z_LINE:Js.SINGLE_POINT}var gH={getDataDescriptionFromExtent:hH,...rI};const{vtkErrorMacro:du}=K;function pH(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return du("instance deleted - cannot call any method"),!1;for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];const a=i.length===1?i[0]:i;if(a.length!==6)return!1;const s=e.extent.some((c,l)=>c!==a[l]);return s&&(e.extent=a.slice(),e.dataDescription=gH.getDataDescriptionFromExtent(e.extent),t.modified()),s},t.setDimensions=function(){let n,i,o;if(e.deleted){du("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],i=a[1],o=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2];else{du("Bad dimension specification");return}t.setExtent(0,n-1,0,i-1,0,o-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let i=1;for(let o=0;o<3;o++){if(n[o]===0)return 0;n[o]>1&&(i*=n[o]-1)}return i},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const i=t.getDimensions();if(i[0]===0||i[1]===0||i[2]===0)return du("Requesting a point from an empty image."),null;const o=new Float64Array(3);switch(e.dataDescription){case qo.EMPTY:return null;case qo.SINGLE_POINT:break;case qo.X_LINE:o[0]=n;break;case qo.Y_LINE:o[1]=n;break;case qo.Z_LINE:o[2]=n;break;case qo.XY_PLANE:o[0]=n%i[0],o[1]=n/i[0];break;case qo.YZ_PLANE:o[1]=n%i[1],o[2]=n/i[1];break;case qo.XZ_PLANE:o[0]=n%i[0],o[2]=n/i[0];break;case qo.XYZ_GRID:o[0]=n%i[0],o[1]=n/i[0]%i[1],o[2]=n/(i[0]*i[1]);break;default:du("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(o,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>hn.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>hn.inflate([...e.extent],.5),t.computeTransforms=()=>{P0(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],ws(e.indexToWorld,e.indexToWorld,e.spacing),gr(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Pt(i,n,e.indexToWorld),i},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Pt(i,n,e.worldToIndex),i},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return hn.transformBounds(n,e.indexToWorld,i)},t.worldToIndexBounds=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return hn.transformBounds(n,e.worldToIndex,i)},e._onOriginChanged=t.computeTransforms,e._onDirectionChanged=t.computeTransforms,e._onSpacingChanged=t.computeTransforms,t.computeTransforms(),t.getCenter=()=>hn.getCenter(t.getBounds()),t.computeHistogram=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const o=[0,0,0,0,0,0];t.worldToIndexBounds(n,o);const a=[0,0,0],s=[0,0,0];hn.computeCornerPoints(o,a,s),Zy(a,a),Zy(s,s);const c=t.getDimensions();e5(a,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],a),e5(s,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],s);const l=c[0],f=c[0]*c[1],u=t.getPointData().getScalars().getData();let d=-1/0,h=1/0,g=0,p=0,m=0;for(let C=a[2];C<=s[2];C++)for(let x=a[1];x<=s[1];x++){let T=a[0]+x*l+C*f;for(let S=a[0];S<=s[0];S++){if(!i||i([S,x,C],o)){const _=u[T];_>d&&(d=_),_<h&&(h=_),g+=_*_,p+=_,m+=1}++T}}const w=m>0?p/m:0,v=m?Math.abs(g/m-w*w):0,y=Math.sqrt(v);return{minimum:h,maximum:d,average:w,variance:v,sigma:y,count:m}},t.computeIncrements=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=[];let a=i;for(let s=0;s<3;++s)o[s]=a,a*=n[s*2+1]-n[s*2]+1;return o},t.computeOffsetIndex=n=>{let[i,o,a]=n;const s=t.getExtent(),c=t.getPointData().getScalars().getNumberOfComponents(),l=t.computeIncrements(s,c);return Math.floor((Math.round(i)-s[0])*l[0]+(Math.round(o)-s[2])*l[1]+(Math.round(a)-s[4])*l[2])},t.getOffsetIndexFromWorld=n=>{const i=t.getExtent(),o=t.worldToIndex(n);for(let a=0;a<3;++a)if(o[a]<i[a*2]||o[a]>i[a*2+1])return du(`GetScalarPointer: Pixel ${o} is not in memory. Current extent = ${i}`),NaN;return t.computeOffsetIndex(o)},t.getScalarValueFromWorld=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const o=t.getPointData().getScalars().getNumberOfComponents();if(i<0||i>=o)return du(`GetScalarPointer: Scalar Component ${i} is not within bounds. Current Scalar numberOfComponents: ${o}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,i)};const r=t.initialize;t.initialize=()=>(t.set({direction:Ao(e.direction),spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:qo.EMPTY}),r())}const mH={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:qo.EMPTY};function iI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mH,r),A0.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Ao(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),K.get(t,e,["indexToWorld","worldToIndex"]),K.setGetArray(t,e,["origin","spacing"],3),K.setGetArray(t,e,["direction"],9),K.getArray(t,e,["extent"],6),pH(t,e)}const vH=K.newInstance(iI,"vtkImageData");var dg={newInstance:vH,extend:iI};const PS=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],RS=[[0,-1,0],[0,1,0]],yH=[[0,-1,0],[0,1,0],[0,0,-1]],wH=[[0,-1,0],[0,1,0],[0,0,1]];var l0;let Pf=(l0=class{static copyMap(e,r){for(const[n,i]of r.rows)e.rows.set(n,structuredClone(i))}constructor(e,r,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const o=(a,s,c)=>{const{start:l,end:f,value:u}=s;for(let d=l;d<f;d++)i[a+d]=u};this.forEach(o)},this.get=i=>{const o=i%this.jMultiple,a=(i-o)/this.jMultiple;return this.getRLE(o,a)?.value??this.defaultValue},this.getRun=(i,o)=>{const a=i+o*this.height;return this.rows.get(a)},this.set=(i,o)=>{if(o===void 0)return;const a=i%this.width,s=(i-a)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:a,end:a+1,value:o}]);return}const l=this.findIndex(c,a),f=c[l],u=c[l-1];if(!f){if(!u||u.value!==o||u.end!==a){c[l]={start:a,end:a+1,value:o};return}u.end++;return}const{start:d,end:h,value:g}=f;if(o===g&&a>=d)return;const p={start:a,end:a+1,value:o},m=a>d,w=m?l+1:l,v=m?f:u;let y=m?c[l+1]:f;if(v?.value===o&&v?.end===a){v.end++,y?.value===o&&y.start===a+1?(v.end=y.end,c.splice(l,1)):y?.start===a&&(y.start++,y.start===y.end&&(c.splice(l,1),y=c[l],y?.start===a+1&&y.value===o&&(v.end=y.end,c.splice(l,1))));return}if(y?.value===o&&y.start===a+1){y.start--,v?.end>a&&(v.end=a,v.end===v.start&&c.splice(l,1));return}if(y?.start===a&&y.end===a+1){y.value=o;const C=c[l+1];C?.start==a+1&&C.value===o&&(c.splice(l+1,1),y.end=C.end);return}a===y?.start&&y.start++,m&&h>a+1?c.splice(w,0,p,{start:a+1,end:v.end,value:v.value}):c.splice(w,0,p),v?.end>a&&(v.end=a)},this.width=e,this.height=r,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*r}toIJK(e){const r=e%this.jMultiple,n=(e-r)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[r,n,i]}toIndex([e,r,n]){return e+n*this.kMultiple+r*this.jMultiple}getRLE(e,r,n=0){const i=this.rows.get(r+n*this.height);if(!i)return;const o=this.findIndex(i,e),a=i[o];return e>=a?.start?a:void 0}has(e){const r=e%this.jMultiple,n=(e-r)/this.jMultiple;return this.getRLE(r,n)?.value!==void 0}delete(e){const r=e%this.width,n=(e-r)/this.width,i=this.rows.get(n);if(!i)return;const o=this.findIndex(i,r),a=i[o];if(!a||a.start>r)return;if(a.end===r+1){a.end--,a.start>=a.end&&(i.splice(o,1),i.length||this.rows.delete(n));return}if(a.start===r){a.start++;return}const s={value:a.value,start:r+1,end:a.end};a.end=r,i.splice(o+1,0,s)}findIndex(e,r){for(let n=0;n<e.length;n++){const{end:i}=e[n];if(r<i)return n}return e.length}forEach(e,r){const n=r?.rowModified;for(const[i,o]of this.rows){const a=n?[...o]:o;for(const s of a)e(i*this.width,s,o)}}forEachRow(e){for(const[r,n]of this.rows)e(r*this.width,n)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,r){r?r.fill(0):r=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:n,height:i,numComps:o}=this;for(let a=0;a<i;a++){const s=this.getRun(a,e);if(s)if(o===1)for(const c of s){const l=a*n,{start:f,end:u,value:d}=c;for(let h=f;h<u;h++)r[l+h]=d}else for(const c of s){const l=a*n*o,{start:f,end:u,value:d}=c;for(let h=f;h<u;h+=o)for(let g=0;g<o;g++)r[l+h+g]=d[g]}}return r}floodFill(e,r,n,i,o){const a=this.getRLE(e,r,n);if(!a)throw new Error(`Initial point ${e},${r},${n} isn't in the RLE`);const s=[[a,r,n]],c=a.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(s,c,i,o)}flood(e,r,n,i){let o=0;const{planar:a=!0,diagonals:s=!0,singlePlane:c=!1}=i||{},l={planar:a,diagonals:s,singlePlane:c};for(;e.length;){const f=e.pop(),[u]=f;if(u.value!==r)continue;u.value=n,o+=u.end-u.start;const d=this.findAdjacents(f,l).filter(h=>h&&h[0].value===r);e.push(...d)}return o}fillFrom(e,r){for(let n=r[2][0];n<=r[2][1];n++)for(let i=r[1][0];i<=r[1][1];i++){let o,a;for(let s=r[0][0];s<=r[0][1];s++){const c=e(s,i,n);if(c===void 0){o=void 0;continue}a||(a=[],this.rows.set(i+n*this.height,a)),o&&o.value!==c&&(o=void 0),o||(o={start:s,end:s,value:c},a.push(o)),o.end++}}}findAdjacents(e,{diagonals:r=!0,planar:n=!0,singlePlane:i=!1}){const[o,a,s,c]=e,{start:l,end:f}=o,u=l>0&&this.getRLE(l-1,a,s),d=f<this.width&&this.getRLE(f,a,s),h=r?[l>0?l-1:l,f<this.width?f+1:f]:[l,f],g=[];u&&g.push([u,a,s]),d&&g.push([d,a,s]);for(const p of c||(i?RS:PS)){const[,m,w]=p,v=m+a,y=w+s;if(v<0||v>=this.height||y<0||y>=this.depth)continue;const C=this.getRun(v,y);if(C)for(const x of C){const T=c||i&&RS||n&&w>0&&wH||n&&w<0&&yH||PS;x.end<=h[0]||x.start>=h[1]||g.push([x,v,y,T])}}return g}},l0.getScalarData=function(e=Uint8ClampedArray){const r=new e(this.frameSize);return this.map.updateScalarData(r),r},l0),tm=class Rd{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:r=1024,dimensions:n=3,growSize:i=128}=e,o=r*n;this.growSize=i,this.array=new ArrayBuffer(o*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let r=0;r<this._length;r++)e(this.getPoint(r),r)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;return this.data.subarray(r,r+this._dimensions)}getPointArray(e){const r=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let i=0;i<this._dimensions;i++)r.push(this.data[i+n]);return r}grow(e=1,r=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+r,i=new ArrayBuffer(n*this._dimensions*this._byteSize),o=new Float32Array(i);o.set(this.data),this.data=o,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let r=0;r<e;r++){const n=r*this._dimensions,i=(this._length-1-r)*this._dimensions;for(let o=0;o<this._dimensions;o++){const a=this.data[n+o];this.data[n+o]=this.data[i+o],this.data[i+o]=a}}}getTypedArray(){return this.data}push(e){this.grow(1);const r=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+r]=e[n];this._length++}map(e){const r=[];for(let n=0;n<this._length;n++)r.push(e(this.getPoint(n),n));return r}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:r,y:n,z:i}=e;return this.forEach(o=>{r.push(o[0]),n.push(o[1]),i&&i.push(o[2])}),e}static fromXYZ({x:e,y:r,z:n}){const i=Rd.create3(e.length);let o=0;for(let a=0;a<e.length;a++)i.data[o++]=e[a],i.data[o++]=r[a],i.data[o++]=n?n[a]:0;return i._length=e.length,i}subselect(e=10,r=0){const n=new Rd({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const o=(r+Math.floor(this.length*i/e))%this.length;n.push(this.getPoint(o))}return n}static create3(e=128,r){e=Math.max(e,r?.length||0);const n=new Rd({initialSize:e,dimensions:3});return r&&r.forEach(i=>n.push(i)),n}static create2(e=128){return new Rd({initialSize:e,dimensions:2})}};function oI(t){const e=Ie(),r=t.getDimensions(),n=tm.create3(r[0]),i=tm.create3(r[1]),o=tm.create3(r[2]),a=t.getDirection(),s=a.slice(0,3),c=a.slice(3,6),l=a.slice(6,9),f=t.getSpacing(),[u,d,h]=f,g=t.indexToWorld([0,0,0]),p=mt(s[0]*u,s[1]*u,s[2]*u),m=mt(c[0]*d,c[1]*d,c[2]*d),w=mt(l[0]*h,l[1]*h,l[2]*h),v=Ie();for(let T=0;T<r[0];T++)n.push(nr(v,g,Jn(v,p,T)));for(let T=0;T<r[1];T++)i.push(Jn(v,m,T));for(let T=0;T<r[2];T++)o.push(Jn(v,w,T));const y=n.getTypedArray(),C=i.getTypedArray(),x=o.getTypedArray();return(T,S=e)=>{const[_,E,D]=T,b=_*3,I=E*3,O=D*3;return S[0]=y[b]+C[I]+x[O],S[1]=y[b+1]+C[I+1]+x[O+1],S[2]=y[b+2]+C[I+2]+x[O+2],S}}function EC(t,e){const{pointInShapeFn:r,callback:n,boundsIJK:i,returnPoints:o=!1}=e;let a;if(t.getScalarData)a=t.getScalarData();else{const u=t.getPointData().getScalars();if(u)a=u.getData();else{const{voxelManager:d}=t.get("voxelManager")||{};d&&(a=d.getCompleteScalarDataArray())}}const s=t.getDimensions(),c=[[0,s[0]],[0,s[1]],[0,s[2]]],f=CH({imageData:t,bounds:i||c,scalarData:a,pointInShapeFn:r,callback:n});return o?f:void 0}function CH({imageData:t,bounds:e,scalarData:r,pointInShapeFn:n,callback:i}){const[[o,a],[s,c],[l,f]]=e,{numComps:u}=t,d=t.getDimensions(),h=oI(t),g=[0,0,0],p=u||r.length/d[2]/d[1]/d[0],m=d[0]*p,w=d[1]*m,v=[];for(let y=l;y<=f;y++){g[2]=y;const C=y*w;for(let x=s;x<=c;x++){g[1]=x;const T=C+x*m;for(let S=o;S<=a;S++){g[0]=S;const _=h(g);if(n(_,g)){const E=T+S*p;let D;p>2?D=[r[E],r[E+1],r[E+2]]:D=r[E],v.push({value:D,index:E,pointIJK:g,pointLPS:_.slice()}),i({value:D,index:E,pointIJK:g,pointLPS:_})}}}}return v}function xH({voxelManager:t,bounds:e,imageData:r,pointInShapeFn:n,callback:i,returnPoints:o}){const[[a,s],[c,l],[f,u]]=e,d=oI(r),h=[0,0,0],g=[];for(let p=f;p<=u;p++){h[2]=p;for(let m=c;m<=l;m++){h[1]=m;for(let w=a;w<=s;w++){h[0]=w;const v=d(h);if(n(v,h)){const y=t.toIndex(h),C=t.getAtIndex(y);o&&g.push({value:C,index:y,pointIJK:[...h],pointLPS:v.slice()}),i?.({value:C,index:y,pointIJK:h,pointLPS:v})}}}}return g}const TH=5*1024;let La=class Gr{get id(){return this._id}constructor(e,r){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(n,i,o)=>{const a=this.toIndex([n,i,o]);return this._get(a)},this.setAtIJK=(n,i,o,a)=>{const s=this.toIndex([n,i,o]),c=this._set(s,a);return c!==!1&&(this.modifiedSlices.add(o),Gr.addBounds(this.boundsIJK,[n,i,o])),c},this.getAtIJKPoint=([n,i,o])=>this.getAtIJK(n,i,o),this.setAtIJKPoint=([n,i,o],a)=>{this.setAtIJK(n,i,o,a)},this.getAtIndex=n=>this._get(n),this.setAtIndex=(n,i)=>{const o=this._set(n,i);if(o!==!1){const a=this.toIJK(n);this.modifiedSlices.add(a[2]),Gr.addBounds(this.boundsIJK,a)}return o},this.getMiddleSliceData=()=>{const n=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:n,slicePlane:2})},this.forEach=(n,i={})=>{const o=i.boundsIJK||this.getBoundsIJK(),a=i.isInObject||this.isInObject||(()=>!0),s=i.returnPoints||!1,c=i.imageData,l=Math.min(o[0][0],o[0][1]),f=Math.max(o[0][0],o[0][1]),u=Math.min(o[1][0],o[1][1]),d=Math.max(o[1][0],o[1][1]),h=Math.min(o[2][0],o[2][1]),g=Math.max(o[2][0],o[2][1]),p=[];if(c)return xH({voxelManager:this,imageData:i.imageData,bounds:[[l,f],[u,d],[h,g]],pointInShapeFn:a,callback:n,returnPoints:s});if(this.map){if(this.map instanceof Pf)return this.rleForEach(n,i);for(const m of this.map.keys()){const w=this.toIJK(m);if(!a(null,w))continue;const v=this._get(m);s&&p.push({value:v,index:m,pointIJK:w,pointLPS:null}),n({value:v,index:m,pointIJK:w,pointLPS:null})}return p}else{for(let m=h;m<=g;m++){const w=m*this.frameSize;for(let v=u;v<=d;v++){const y=w+v*this.width;for(let C=l,x=y+C;C<=f;C++,x++){const T=this.getAtIndex(x),S=[C,v,m];a(null,S)&&(s&&p.push({value:T,index:x,pointIJK:S,pointLPS:null}),n({value:T,index:x,pointIJK:[C,v,m],pointLPS:null}))}}}return p}},this.getSliceData=({sliceIndex:n,slicePlane:i})=>{const[o,a,s]=this.dimensions,c=o*a,l=n*c;let f;const u=this.getConstructor();function d(g){return typeof g=="function"}if(!d(u))return new Uint8Array(0);let h;switch(i){case 0:f=a*s,h=new u(f);for(let g=0;g<a;g++)for(let p=0;p<s;p++){const m=n+g*o+p*c;this.setSliceDataValue(h,g*s+p,this._get(m))}break;case 1:f=o*s,h=new u(f);for(let g=0;g<o;g++)for(let p=0;p<s;p++){const m=g+n*o+p*c;this.setSliceDataValue(h,g+p*o,this._get(m))}break;case 2:f=o*a,h=new u(f);for(let g=0;g<f;g++)this.setSliceDataValue(h,g,this._get(l+g));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=r._get,this._set=r._set,this._id=r._id||"",this._getConstructor=r._getConstructor,this.numberOfComponents=r.numberOfComponents||1,this.scalarData=r.scalarData,this._getScalarData=r._getScalarData,this._updateScalarData=r._updateScalarData}getMinMax(){let e,r;const n=({value:i})=>{const o=Array.isArray(i);if(e===void 0&&(e=o?[...i]:i,r=o?[...i]:i),o)for(let a=0;a<i.length;a++)e[a]=Math.min(e[a],i[a]),r[a]=Math.max(r[a],i[a]);else e=Math.min(e,i),r=Math.max(r,i)};return this.forEach(n,{boundsIJK:this.getDefaultBounds()}),{min:e,max:r}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,r){const n=r?.boundsIJK||this.getBoundsIJK(),{isWithinObject:i}=r||{},o=this.map;if(!o){console.warn("No map found, you need to use a map voxel manager to use rleForEach");return}o.defaultValue=void 0;for(let a=n[2][0];a<=n[2][1];a++)for(let s=n[1][0];s<=n[1][1];s++){const c=o.getRun(s,a);if(c)for(const l of c){const{start:f,end:u,value:d}=l,h=this.toIndex([0,s,a]);for(let g=f;g<u;g++){const p={value:d,index:h+g,pointIJK:[g,s,a]};i?.(p)!==!1&&e(p)}}}}getScalarData(e=!1){if(this.scalarData)return this._updateScalarData?.(this.scalarData),this.scalarData;if(this._getScalarData){const r=this._getScalarData();return e&&console.log("Not transient, should store value",r),r}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clearBounds(){this.boundsIJK.map(e=>{e[0]=1/0,e[1]=-1/0})}clear(){this.map?.clear(),this.clearBounds(),this.modifiedSlices.clear(),this.points?.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}setBounds(e){this.boundsIJK=e}static addBounds(e,r){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(r[0],e[0][0]),e[0][1]=Math.max(r[0],e[0][1]),e[1][0]=Math.min(r[1],e[1][0]),e[1][1]=Math.max(r[1],e[1][1]),e[2][0]=Math.min(r[2],e[2][0]),e[2][1]=Math.max(r[2],e[2][1])}addPoint(e){const r=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(r)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,r,n){if(Array.isArray(n))for(let i=0;i<n.length;i++)e[r*n.length+i]=this.toNumber(n[i]);else e[r]=this.toNumber(n)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n=3,id:i}){const o=new Gr(e,{_get:a=>(a*=n,[r[a++],r[a++],r[a++]]),_id:i||"_createRGBScalarVolumeVoxelManager",_set:(a,s)=>{a*=3;const c=!Dt(r[a],s);return r[a++]=s[0],r[a++]=s[1],r[a++]=s[2],c},numberOfComponents:n,scalarData:r});return o.clear=()=>{r.fill(0)},o}static createImageVolumeVoxelManager({dimensions:e,imageIds:r,numberOfComponents:n=1,id:i}){const o=e[0]*e[1];function a(u){const d=Math.floor(u/o);if(d<0||d>=e[2])return{};const h=r[d];if(!h)return console.warn(`ImageId not found for sliceIndex: ${d}`),{pixelData:null,pixelIndex:null};const g=Ae.getImage(h);if(!g)return console.warn(`Image not found for imageId: ${h}`),{pixelData:null,pixelIndex:null};const p=g.voxelManager,m=u%o;return{voxelManager:p,pixelIndex:m}}function s(u){const{voxelManager:d,pixelIndex:h}=a(u);return!d||h===null?null:d.getAtIndex(h)}function c(u,d){const{voxelManager:h,pixelIndex:g}=a(u);if(!h||g===null)return!1;const p=h.getAtIndex(g),m=!Dt(d,p);return m&&(h.setAtIndex(g,d),!0)}const l=()=>{const{voxelManager:u,pixelIndex:d}=a(0);return!u||d===null?null:u.getConstructor()},f=new Gr(e,{_get:s,_set:c,numberOfComponents:n,_getConstructor:l,_id:i||"createImageVolumeVoxelManager"});return f.getMiddleSliceData=()=>{const u=Math.floor(e[2]/2);return f.getSliceData({sliceIndex:u,slicePlane:2})},f.clear=()=>{for(const u of r)Ae.getImage(u).voxelManager.clear()},f.getRange=()=>{let u=1/0,d=-1/0;for(const h of r){const g=Ae.getImage(h);g&&(g.minPixelValue<u&&(u=g.minPixelValue),g.maxPixelValue>d&&(d=g.maxPixelValue))}return u===1/0&&d===-1/0?[0,0]:[u,d]},f._getScalarDataLength=()=>{const{voxelManager:u,pixelIndex:d}=a(0);return!u||d===null?0:u.getScalarDataLength()*e[2]},f.getCompleteScalarDataArray=()=>{const u=f._getConstructor();if(!u)return new Uint8Array(0);const d=f.getScalarDataLength(),h=new u(d),g=e[0]*e[1]*n;for(let p=0;p<e[2];p++){const{voxelManager:m,pixelIndex:w}=a(p*g/n);if(m&&w!==null){const v=p*g,y=m.getScalarData();if(n===1)h.set(y,v);else for(let C=0;C<y.length;C+=n)for(let x=0;x<n;x++)h[v+C+x]=y[C+x]}}return h},f.setCompleteScalarDataArray=u=>{const d=e[0]*e[1]*n,h=f._getConstructor();let g=1/0,p=-1/0;for(let m=0;m<e[2];m++){const{voxelManager:w}=a(m*d/n);if(w&&h){const v=m*d,y=v+d,C=new h(d);if(C.set(u.subarray(v,y)),w.scalarData)w.scalarData.set(C),w.modifiedSlices.add(m);else for(let S=0;S<d;S++)w.setAtIndex(S,C[S]);for(let S=0;S<C.length;S++){const _=C[S];g=Math.min(g,_),p=Math.max(p,_)}const x=r[m],T=Ae.getImage(x);T&&(T.minPixelValue=g,T.maxPixelValue=p)}}for(let m=0;m<e[2];m++)f.modifiedSlices.add(m);f.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},f}static createScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n,id:i}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!n&&(n=r.length/e[0]/e[1]/e[2],n>4||n<1||n===2))throw new Error(`Number of components ${n} must be 1, 3 or 4`);return n>1?Gr._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n,id:i}):Gr._createNumberVolumeVoxelManager({dimensions:e,scalarData:r,id:i})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:r,dimensionGroupNumber:n=1,timePoint:i=0,numberOfComponents:o=1,id:a}){let s=0;if(n!==void 0?s=n-1:i!==void 0&&(console.warn("Warning: timePoint parameter is deprecated. Please use dimensionGroupNumber instead. timePoint is zero-based while dimensionGroupNumber starts at 1."),s=i),!o){const f=Ae.getImage(e[0][0]);if(!f)throw new Error("Unable to determine number of components: No image found");if(o=f.getPixelData().length/(r[0]*r[1]),o>4||o<1||o===2)throw new Error(`Number of components ${o} must be 1, 3 or 4`)}const c=e.map(f=>Gr.createImageVolumeVoxelManager({dimensions:r,imageIds:f,numberOfComponents:o,id:a})),l=new Gr(r,{_get:f=>c[s]._get(f),_set:(f,u)=>c[s]._set(f,u),numberOfComponents:o,_id:a||"createScalarDynamicVolumeVoxelManager"});return l.getScalarDataLength=()=>c[s].getScalarDataLength(),l.getConstructor=()=>c[s].getConstructor(),l.getRange=()=>c[s].getRange(),l.getMiddleSliceData=()=>c[s].getMiddleSliceData(),l.setTimePoint=f=>{console.warn("Warning: setTimePoint is deprecated. Please use setDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.setDimensionGroupNumber(f+1)},l.setDimensionGroupNumber=f=>{s=f-1,l._get=u=>c[s]._get(u),l._set=(u,d)=>c[s]._set(u,d)},l.getAtIndexAndTimePoint=(f,u)=>(console.warn("Warning: getAtIndexAndTimePoint is deprecated. Please use getAtIndexAndDimensionGroup instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.getAtIndexAndDimensionGroup(f,u+1)),l.getAtIndexAndDimensionGroup=(f,u)=>c[u-1]._get(f),l.getTimePointScalarData=f=>(console.warn("Warning: getTimePointScalarData is deprecated. Please use getDimensionGroupScalarData instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.getDimensionGroupScalarData(f+1)),l.getDimensionGroupScalarData=f=>c[f-1].getCompleteScalarDataArray(),l.getCurrentTimePointScalarData=()=>(console.warn("Warning: getCurrentTimePointScalarData is deprecated. Please use getCurrentDimensionGroupScalarData instead."),l.getCurrentDimensionGroupScalarData()),l.getCurrentDimensionGroupScalarData=()=>c[s].getCompleteScalarDataArray(),l.getCurrentTimePoint=()=>(console.warn("Warning: getCurrentTimePoint is deprecated. Please use getCurrentDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),s),l.getCurrentDimensionGroupNumber=()=>s+1,l}static createImageVoxelManager({width:e,height:r,scalarData:n,numberOfComponents:i=1,id:o}){const a=[e,r,1];if(!i&&(i=n.length/e/r,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?Gr._createRGBScalarVolumeVoxelManager({dimensions:a,scalarData:n,numberOfComponents:i,id:o}):Gr._createNumberVolumeVoxelManager({dimensions:a,scalarData:n,id:o})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:r,id:n}){const i=new Gr(e,{_get:o=>r[o],_set:(o,a)=>{const s=r[o]!==a;return r[o]=a,s},_getConstructor:()=>r.constructor,_id:n||"_createNumberVolumeVoxelManager"});return i.scalarData=r,i.clear=()=>{i.scalarData.fill(0)},i.getMiddleSliceData=()=>{const o=Math.floor(e[2]/2);return i.getSliceData({sliceIndex:o,slicePlane:2})},i}static createMapVoxelManager({dimension:e,id:r}){const n=new Map,i=new Gr(e,{_get:n.get.bind(n),_set:(o,a)=>n.set(o,a)&&!0,_id:r||"createMapVoxelManager"});return i.map=n,i}static createHistoryVoxelManager(e,r){const n=new Map,{dimensions:i}=e,o=new Gr(i,{_get:a=>n.get(a),_set:function(a,s){if(n.has(a))s===n.get(a)&&n.delete(a);else{const c=this.sourceVoxelManager.getAtIndex(a);if(c===s)return!1;n.set(a,c)}this.sourceVoxelManager.setAtIndex(a,s)},_id:r||"createHistoryVoxelManager"});return o.map=n,o.scalarData=e.scalarData,o.sourceVoxelManager=e,o}static createRLEHistoryVoxelManager(e,r){const{dimensions:n}=e,i=new Pf(n[0],n[1],n[2]),o=new Gr(n,{_get:a=>i.get(a),_set:function(a,s){const c=i.get(a);if(c===void 0){const l=this.sourceVoxelManager.getAtIndex(a);if(l===s||l===void 0&&s===0||s===null)return!1;i.set(a,l??0)}else(s===c||s===null)&&(i.delete(a),s=c);this.sourceVoxelManager.setAtIndex(a,s)},_getScalarData:Pf.getScalarData,_updateScalarData:a=>(i.updateScalarData(a),a),_id:r||"createRLEHistoryVoxelManager"});return o.map=i,o.sourceVoxelManager=e,o}static createLazyVoxelManager({dimensions:e,planeFactory:r,id:n}){const i=new Map,[o,a]=e,s=o*a,c=new Gr(e,{_get:l=>i.get(Math.floor(l/s))[l%s],_set:(l,f)=>{const u=Math.floor(l/s);let d=i.get(u);return d||(d=r(o,a),i.set(u,d)),d[l%s]=f,!0},_id:n||"createLazyVoxelManager"});return c.map=i,c}static createRLEVolumeVoxelManager({dimensions:e,id:r}){const[n,i,o]=e,a=new Pf(n,i,o),s=new Gr(e,{_get:c=>a.get(c),_set:(c,l)=>(a.set(c,l),!0),_getScalarData:Pf.getScalarData,_updateScalarData:c=>(a.updateScalarData(c),c),_id:r||"createRLEVolumeVoxelManager"});return s.map=a,s.getPixelData=a.getPixelData.bind(a),s}static createRLEImageVoxelManager({dimensions:e,id:r}){const[n,i]=e;return Gr.createRLEVolumeVoxelManager({dimensions:[n,i,1],id:r})}static addInstanceToImage(e){const{width:r,height:n}=e,i=e.voxelManager.getScalarData();if(i.length>=r*n){e.voxelManager=Gr.createScalarVolumeVoxelManager({dimensions:[r,n,1],scalarData:i});return}e.voxelManager=Gr.createRLEVolumeVoxelManager({dimensions:[r,n,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=TH}};const SH="WebGL",Am=Object.create(null);function aI(t,e){Am[t]=e}function _H(){return Object.keys(Am)}function sI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Am[t]&&Am[t](e)}function EH(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=r=>{t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=r=>{e.renderers=e.renderers.filter(n=>n!==r),t.modified()},t.hasRenderer=r=>e.renderers.indexOf(r)!==-1,t.newAPISpecificView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sI(r||e.defaultViewAPI,n)},t.addView=r=>{t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=r=>{e._views=e._views.filter(n=>n!==r),t.modified()},t.hasView=r=>e._views.indexOf(r)!==-1,t.preRender=()=>{e.renderers.forEach(r=>{r.isActiveCameraCreated()||r.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(r=>r.traverseAllPasses())},t.getStatistics=()=>{const r={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(n=>{n.getGraphicsMemoryInfo&&(r.gpuMemoryMB+=n.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(n=>{const i=n.getViewProps(),o=e._views[0].getViewNodeFor(n);i.forEach(a=>{if(a.getVisibility()){r.propCount+=1;const s=a.getMapper&&a.getMapper();if(s&&s.getPrimitiveCount){const c=o.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(r.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=s.getPrimitiveCount();Object.keys(l).forEach(f=>{r[f]||(r[f]=0),r[f]+=l[f]})}}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`
`),r},t.captureImages=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return K.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(r,n):void 0).filter(i=>!!i)},t.addRenderWindow=r=>e.childRenderWindows.includes(r)?!1:(e.childRenderWindows.push(r),t.modified(),!0),t.removeRenderWindow=r=>{const n=e.childRenderWindows.findIndex(i=>i===r);return n<0?!1:(e.childRenderWindows.splice(n,1),t.modified(),!0)}}const bH={defaultViewAPI:SH,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function cI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bH,r),K.obj(t,e),K.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),K.get(t,e,["neverRendered"]),K.getArray(t,e,["renderers","childRenderWindows"]),K.moveToProtected(t,e,["views"]),K.event(t,e,"completion"),EH(t,e)}const DH=K.newInstance(cI,"vtkRenderWindow");var IH={newInstance:DH,extend:cI,registerViewConstructor:aI,listViewAPIs:_H,newAPISpecificView:sI};function MH(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=r=>{e.currentOperation=r,e.currentTraverseOperation=`traverse${K.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),r.traverse(t)}),e.delegates.forEach(i=>{i.traverse(r,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),r.traverse(t)}))}}const OH={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function lI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OH,r),K.obj(t,e),K.get(t,e,["currentOperation"]),K.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),K.moveToProtected(t,e,["currentParent"]),MH(t,e)}const PH=K.newInstance(lI,"vtkRenderPass");var Q1={newInstance:PH,extend:lI};const{Representation:RH}=cf,{vtkErrorMacro:AS}=K;function AH(t){const e=Oe.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const LH=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function NH(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),o=Tt.newInstance({numberOfComponents:3,values:r});o.setName("points");const a=Tt.newInstance({numberOfComponents:2,values:n});a.setName("tcoords");const s=Tt.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",RH.SURFACE,{points:o,tcoords:a,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=r=>{const n=r.getSize(),i=r.getContext();e.framebuffer=lg.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.create(...n),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Kn.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw({width:n[0],height:n[1],numComps:4,dataType:"Float32Array",data:null}),e.translucentRTexture=Kn.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw({width:n[0],height:n[1],numComps:1,dataType:"Float32Array",data:null}),e.translucentZTexture=Kn.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw({width:n[0],height:n[1],dataType:"Float32Array",data:null}),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=r=>{e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),LH,"")},t.createVBO=r=>{const n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||AS("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||AS("Error setting vertexDC in copy shader VAO.")},t.traverse=(r,n,i)=>{if(e.deleted)return;const o=r.getSize(),a=r.getContext();if(e._supported=!1,n.getSelector()||!a||!r.getWebgl2()||!a.getExtension("EXT_color_buffer_half_float")&&!a.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{const c=e.framebuffer.getSize();c===null||c[0]!==o[0]||c[1]!==o[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}a.drawBuffers([a.COLOR_ATTACHMENT0]),a.clearBufferfv(a.COLOR,0,[0,0,0,0]),a.clearBufferfv(a.DEPTH,0,[1]),a.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),n.traverse(i)),a.colorMask(!0,!0,!0,!0),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1]),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),a.clearBufferfv(a.COLOR,0,[0,0,0,1]),a.clearBufferfv(a.COLOR,1,[0,0,0,0]),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFuncSeparate(a.ONE,a.ONE,a.ZERO,a.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),a.drawBuffers([a.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=q1.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.depthMask(!1),a.depthFunc(a.ALWAYS),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),a.depthMask(!0),a.depthFunc(a.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=n.getTiledSizeAndOrigin();a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?AH:null,t.releaseGraphicsResources=r=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}const VH={framebuffer:null,copyShader:null,tris:null};function uI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VH,r),Q1.extend(t,e,r),e.VBOBuildTime={},K.obj(e.VBOBuildTime,{mtime:0}),e.tris=Fa.newInstance(),K.get(t,e,["framebuffer"]),NH(t,e)}const kH=K.newInstance(uI,"vtkOpenGLOrderIndependentTranslucentPass");var FH={newInstance:kH,extend:uI};function UH(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);const i=r.getRenderable().getNumberOfLayers(),o=r.getRenderable().getRenderersByReference();for(let a=0;a<i;a++)for(let s=0;s<o.length;s++){const c=o[s],l=r.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===a){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const f=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=lg.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==f[0]||u[1]!==f[1])&&(e.framebuffer.create(f[0],f[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=FH.newInstance()),e.translucentPass.traverse(r,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const BH={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function fI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BH,r),Q1.extend(t,e,r),K.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),UH(t,e)}const GH=K.newInstance(fI,"vtkForwardPass");var bC={newInstance:GH,extend:fI};const Ji={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var dI={PassTypes:Ji};const{FieldAssociations:WH}=A0;function $H(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(r,n,i,o,a)=>{},t.selectAsync=async(r,n,i,o,a)=>{const s=await t.getSourceDataAsync(r,n,i,o,a);return s?s.generateSelection(n,i,o,a):[]}}const zH={fieldAssociation:WH.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function hI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zH,r),K.obj(t,e),K.setGet(t,e,["fieldAssociation","captureZValues"]),$H(t,e)}const jH=K.newInstance(hI,"vtkHardwareSelector");var HH={newInstance:jH,extend:hI};const KH={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},XH={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var qH={SelectionContent:KH,SelectionField:XH};function YH(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const JH={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function gI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JH,r),K.obj(t,e),e.properties={},K.setGet(t,e,["contentType","fieldType","properties","selectionList"]),YH(t,e)}const ZH=K.newInstance(gI,"vtkSelectionNode");var pI={newInstance:ZH,extend:gI,...qH};const{PassTypes:Rr}=dI,{SelectionContent:QH,SelectionField:LS}=pI,{FieldAssociations:$d}=A0,{vtkErrorMacro:mI}=K,gl=1;function vI(t){return`${t.propID} ${t.compositeID}`}function yI(t,e,r,n){if(!r)return 0;const i=(e*(n[2]-n[0]+1)+t)*4;return r[i+3]}function uc(t,e,r,n){if(!r)return 0;const i=(e*(n[2]-n[0]+1)+t)*4,o=r[i],a=r[i+1];return(r[i+2]*256+a)*256+o}function wI(t,e){let r=e;return r<<=24,r|=t,r}function eK(t,e,r,n){{if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],o=uc(i[0],i[1],t.pixBuffer[Rr.ACTOR_PASS],t.area);if(o<=0||o-gl>=t.props.length)return null;const a={};a.valid=!0,a.propID=o-gl,a.prop=t.props[a.propID];let s=uc(i[0],i[1],t.pixBuffer[Rr.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),a.compositeID=s-gl,t.captureZValues){const f=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;a.zValue=(256*t.zBuffer[f]+t.zBuffer[f+1])/65535,a.displayPosition=e}if(t.pixBuffer[Rr.ID_LOW24]&&yI(i[0],i[1],t.pixBuffer[Rr.ID_LOW24],t.area)===0)return a;const c=uc(i[0],i[1],t.pixBuffer[Rr.ID_LOW24],t.area),l=uc(i[0],i[1],t.pixBuffer[Rr.ID_HIGH24],t.area);return a.attributeID=wI(c,l),a}}function CI(t,e,r,n,i){const o=[];let a=0;return e.forEach((s,c)=>{const l=pI.newInstance();switch(l.setContentType(QH.INDICES),t){case $d.FIELD_ASSOCIATION_CELLS:l.setFieldType(LS.CELL);break;case $d.FIELD_ASSOCIATION_POINTS:l.setFieldType(LS.POINT);break;default:mI("Unknown field association")}l.getProperties().propID=s.info.propID,l.getProperties().prop=s.info.prop,l.getProperties().compositeID=s.info.compositeID,l.getProperties().attributeID=s.info.attributeID,l.getProperties().pixelCount=s.pixelCount,r&&(l.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],l.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,n)),l.setSelectionList(s.attributeIDs),o[a]=l,a++}),o}function tK(t,e,r,n,i){const o=Math.floor(e),a=Math.floor(r),s=Math.floor(n),c=Math.floor(i),l=new Map,f=[0,0];for(let u=a;u<=c;u++)for(let d=o;d<=s;d++){const g=eK(t,[d,u],0,f);if(g&&g.valid){const p=vI(g);if(!l.has(p))l.set(p,{info:g,pixelCount:1,attributeIDs:[g.attributeID]});else{const m=l.get(p);m.pixelCount++,t.captureZValues&&g.zValue<m.info.zValue&&(m.info=g),m.attributeIDs.indexOf(g.attributeID)===-1&&m.attributeIDs.push(g.attributeID)}}}return CI(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function nK(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=lg.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==n[0]||i[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===$d.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),o=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),o&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=()=>{let n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=async(n,i,o,a,s)=>{if(e._renderer=n,i===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(i,o,a,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:n,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,f=new Array(l),u=0;u<l;u++)f[u]=arguments[u];return tK(c,...f)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return mI("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const n=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=Rr.MIN_KNOWN_PASS;e.currentPass<=Rr.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Rr.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(o=>{e.currentPass=o,t.processPixelBuffers()}),e.currentPass=Rr.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((n,i)=>{t.isPropHit(i)&&n.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=n=>{if(n===Rr.ID_HIGH24){if(e.fieldAssociation===$d.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===$d.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=n=>{if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(i),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===Rr.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const o=i[0].getFramebuffer();o.saveCurrentBindingsAndBuffers(),o.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),o.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=n=>{let i=0;for(let o=0;o<=e.area[3]-e.area[1];o++)for(let a=0;a<=e.area[2]-e.area[0];a++){let s=uc(a,o,n,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=n=>{e.currentPass===Rr.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+gl),e.props.push(n))},t.renderCompositeIndex=n=>{e.currentPass===Rr.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+gl)},t.renderAttributeId=n=>{n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=n=>K.enumToString(Rr,n),t.isPropHit=n=>!!e.hitProps[n],t.setPropColorValueFromInt=n=>{e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=(n,i,o)=>{const a=i<0?0:i;if(console.log("getPixelInformation called",a),a===0){if(o[0]=n[0],o[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;console.log(n),console.log(e.area);const f=[n[0]-e.area[0],n[1]-e.area[1]];console.log("adjusted displayPosition",f);const u=uc(f[0],f[1],e.pixBuffer[Rr.ACTOR_PASS],e.area);if(console.log("actorid",u),u<=0||u-gl>=e.props.length)return null;const d={};d.valid=!0,d.propID=u-gl,d.prop=e.props[d.propID];let h=uc(f[0],f[1],e.pixBuffer[Rr.COMPOSITE_INDEX_PASS],e.area);if((h<0||h>16777215)&&(h=0),d.compositeID=h-gl,e.captureZValues){const m=(f[1]*(e.area[2]-e.area[0]+1)+f[0])*4;d.zValue=(256*e.zBuffer[m]+e.zBuffer[m+1])/65535,d.displayPosition=n}if(e.pixBuffer[Rr.ID_LOW24]&&yI(f[0],f[1],e.pixBuffer[Rr.ID_LOW24],e.area)===0)return d;const g=uc(f[0],f[1],e.pixBuffer[Rr.ID_LOW24],e.area),p=uc(f[0],f[1],e.pixBuffer[Rr.ID_HIGH24],e.area);return d.attributeID=wI(g,p),d}const s=[n[0],n[1]],c=[0,0];let l=t.getPixelInformation(n,0,o);if(l&&l.valid)return l;for(let f=1;f<a;++f){for(let u=s[1]>f?s[1]-f:0;u<=s[1]+f;++u)if(c[1]=u,s[0]>=f&&(c[0]=s[0]-f,l=t.getPixelInformation(c,0,o),l&&l.valid)||(c[0]=s[0]+f,l=t.getPixelInformation(c,0,o),l&&l.valid))return l;for(let u=s[0]>=f?s[0]-(f-1):0;u<=s[0]+(f-1);++u)if(c[0]=u,s[1]>=f&&(c[1]=s[1]-f,l=t.getPixelInformation(c,0,o),l&&l.valid)||(c[1]=s[1]+f,l=t.getPixelInformation(c,0,o),l&&l.valid))return l}return o[0]=n[0],o[1]=n[1],null},t.generateSelection=(n,i,o,a)=>{const s=Math.floor(n),c=Math.floor(i),l=Math.floor(o),f=Math.floor(a),u=new Map,d=[0,0];for(let h=c;h<=f;h++)for(let g=s;g<=l;g++){const p=[g,h],m=t.getPixelInformation(p,0,d);if(m&&m.valid){const w=vI(m);if(!u.has(w))u.set(w,{info:m,pixelCount:1,attributeIDs:[m.attributeID]});else{const v=u.get(w);v.pixelCount++,e.captureZValues&&m.zValue<v.info.zValue&&(v.info=m),v.attributeIDs.indexOf(m.attributeID)===-1&&v.attributeIDs.push(m.attributeID)}}}return CI(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=n=>e.rawPixBuffer[n],t.getPixelBuffer=n=>e.pixBuffer[n],t.attach=(n,i)=>{e._openGLRenderWindow=n,e._renderer=i};const r=t.setArea;t.setArea=function(){return r(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const rK={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function xI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rK,r),HH.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),K.setGetArray(t,e,["area"],4),K.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),K.setGetArray(t,e,["propColorValue"],3),K.moveToProtected(t,e,["renderer","openGLRenderWindow"]),K.event(t,e,"event"),nK(t,e)}const iK=K.newInstance(xI,"vtkOpenGLHardwareSelector");var DC={newInstance:iK,extend:xI,...dI},xv={exports:{}},NS;function oK(){return NS||(NS=1,(function(t,e){(function(r){t.exports=r()})(function(r){var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(w,v){var y=w[0],C=w[1],x=w[2],T=w[3];y+=(C&x|~C&T)+v[0]-680876936|0,y=(y<<7|y>>>25)+C|0,T+=(y&C|~y&x)+v[1]-389564586|0,T=(T<<12|T>>>20)+y|0,x+=(T&y|~T&C)+v[2]+606105819|0,x=(x<<17|x>>>15)+T|0,C+=(x&T|~x&y)+v[3]-1044525330|0,C=(C<<22|C>>>10)+x|0,y+=(C&x|~C&T)+v[4]-176418897|0,y=(y<<7|y>>>25)+C|0,T+=(y&C|~y&x)+v[5]+1200080426|0,T=(T<<12|T>>>20)+y|0,x+=(T&y|~T&C)+v[6]-1473231341|0,x=(x<<17|x>>>15)+T|0,C+=(x&T|~x&y)+v[7]-45705983|0,C=(C<<22|C>>>10)+x|0,y+=(C&x|~C&T)+v[8]+1770035416|0,y=(y<<7|y>>>25)+C|0,T+=(y&C|~y&x)+v[9]-1958414417|0,T=(T<<12|T>>>20)+y|0,x+=(T&y|~T&C)+v[10]-42063|0,x=(x<<17|x>>>15)+T|0,C+=(x&T|~x&y)+v[11]-1990404162|0,C=(C<<22|C>>>10)+x|0,y+=(C&x|~C&T)+v[12]+1804603682|0,y=(y<<7|y>>>25)+C|0,T+=(y&C|~y&x)+v[13]-40341101|0,T=(T<<12|T>>>20)+y|0,x+=(T&y|~T&C)+v[14]-1502002290|0,x=(x<<17|x>>>15)+T|0,C+=(x&T|~x&y)+v[15]+1236535329|0,C=(C<<22|C>>>10)+x|0,y+=(C&T|x&~T)+v[1]-165796510|0,y=(y<<5|y>>>27)+C|0,T+=(y&x|C&~x)+v[6]-1069501632|0,T=(T<<9|T>>>23)+y|0,x+=(T&C|y&~C)+v[11]+643717713|0,x=(x<<14|x>>>18)+T|0,C+=(x&y|T&~y)+v[0]-373897302|0,C=(C<<20|C>>>12)+x|0,y+=(C&T|x&~T)+v[5]-701558691|0,y=(y<<5|y>>>27)+C|0,T+=(y&x|C&~x)+v[10]+38016083|0,T=(T<<9|T>>>23)+y|0,x+=(T&C|y&~C)+v[15]-660478335|0,x=(x<<14|x>>>18)+T|0,C+=(x&y|T&~y)+v[4]-405537848|0,C=(C<<20|C>>>12)+x|0,y+=(C&T|x&~T)+v[9]+568446438|0,y=(y<<5|y>>>27)+C|0,T+=(y&x|C&~x)+v[14]-1019803690|0,T=(T<<9|T>>>23)+y|0,x+=(T&C|y&~C)+v[3]-187363961|0,x=(x<<14|x>>>18)+T|0,C+=(x&y|T&~y)+v[8]+1163531501|0,C=(C<<20|C>>>12)+x|0,y+=(C&T|x&~T)+v[13]-1444681467|0,y=(y<<5|y>>>27)+C|0,T+=(y&x|C&~x)+v[2]-51403784|0,T=(T<<9|T>>>23)+y|0,x+=(T&C|y&~C)+v[7]+1735328473|0,x=(x<<14|x>>>18)+T|0,C+=(x&y|T&~y)+v[12]-1926607734|0,C=(C<<20|C>>>12)+x|0,y+=(C^x^T)+v[5]-378558|0,y=(y<<4|y>>>28)+C|0,T+=(y^C^x)+v[8]-2022574463|0,T=(T<<11|T>>>21)+y|0,x+=(T^y^C)+v[11]+1839030562|0,x=(x<<16|x>>>16)+T|0,C+=(x^T^y)+v[14]-35309556|0,C=(C<<23|C>>>9)+x|0,y+=(C^x^T)+v[1]-1530992060|0,y=(y<<4|y>>>28)+C|0,T+=(y^C^x)+v[4]+1272893353|0,T=(T<<11|T>>>21)+y|0,x+=(T^y^C)+v[7]-155497632|0,x=(x<<16|x>>>16)+T|0,C+=(x^T^y)+v[10]-1094730640|0,C=(C<<23|C>>>9)+x|0,y+=(C^x^T)+v[13]+681279174|0,y=(y<<4|y>>>28)+C|0,T+=(y^C^x)+v[0]-358537222|0,T=(T<<11|T>>>21)+y|0,x+=(T^y^C)+v[3]-722521979|0,x=(x<<16|x>>>16)+T|0,C+=(x^T^y)+v[6]+76029189|0,C=(C<<23|C>>>9)+x|0,y+=(C^x^T)+v[9]-640364487|0,y=(y<<4|y>>>28)+C|0,T+=(y^C^x)+v[12]-421815835|0,T=(T<<11|T>>>21)+y|0,x+=(T^y^C)+v[15]+530742520|0,x=(x<<16|x>>>16)+T|0,C+=(x^T^y)+v[2]-995338651|0,C=(C<<23|C>>>9)+x|0,y+=(x^(C|~T))+v[0]-198630844|0,y=(y<<6|y>>>26)+C|0,T+=(C^(y|~x))+v[7]+1126891415|0,T=(T<<10|T>>>22)+y|0,x+=(y^(T|~C))+v[14]-1416354905|0,x=(x<<15|x>>>17)+T|0,C+=(T^(x|~y))+v[5]-57434055|0,C=(C<<21|C>>>11)+x|0,y+=(x^(C|~T))+v[12]+1700485571|0,y=(y<<6|y>>>26)+C|0,T+=(C^(y|~x))+v[3]-1894986606|0,T=(T<<10|T>>>22)+y|0,x+=(y^(T|~C))+v[10]-1051523|0,x=(x<<15|x>>>17)+T|0,C+=(T^(x|~y))+v[1]-2054922799|0,C=(C<<21|C>>>11)+x|0,y+=(x^(C|~T))+v[8]+1873313359|0,y=(y<<6|y>>>26)+C|0,T+=(C^(y|~x))+v[15]-30611744|0,T=(T<<10|T>>>22)+y|0,x+=(y^(T|~C))+v[6]-1560198380|0,x=(x<<15|x>>>17)+T|0,C+=(T^(x|~y))+v[13]+1309151649|0,C=(C<<21|C>>>11)+x|0,y+=(x^(C|~T))+v[4]-145523070|0,y=(y<<6|y>>>26)+C|0,T+=(C^(y|~x))+v[11]-1120210379|0,T=(T<<10|T>>>22)+y|0,x+=(y^(T|~C))+v[2]+718787259|0,x=(x<<15|x>>>17)+T|0,C+=(T^(x|~y))+v[9]-343485551|0,C=(C<<21|C>>>11)+x|0,w[0]=y+w[0]|0,w[1]=C+w[1]|0,w[2]=x+w[2]|0,w[3]=T+w[3]|0}function o(w){var v=[],y;for(y=0;y<64;y+=4)v[y>>2]=w.charCodeAt(y)+(w.charCodeAt(y+1)<<8)+(w.charCodeAt(y+2)<<16)+(w.charCodeAt(y+3)<<24);return v}function a(w){var v=[],y;for(y=0;y<64;y+=4)v[y>>2]=w[y]+(w[y+1]<<8)+(w[y+2]<<16)+(w[y+3]<<24);return v}function s(w){var v=w.length,y=[1732584193,-271733879,-1732584194,271733878],C,x,T,S,_,E;for(C=64;C<=v;C+=64)i(y,o(w.substring(C-64,C)));for(w=w.substring(C-64),x=w.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<x;C+=1)T[C>>2]|=w.charCodeAt(C)<<(C%4<<3);if(T[C>>2]|=128<<(C%4<<3),C>55)for(i(y,T),C=0;C<16;C+=1)T[C]=0;return S=v*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(S[2],16),E=parseInt(S[1],16)||0,T[14]=_,T[15]=E,i(y,T),y}function c(w){var v=w.length,y=[1732584193,-271733879,-1732584194,271733878],C,x,T,S,_,E;for(C=64;C<=v;C+=64)i(y,a(w.subarray(C-64,C)));for(w=C-64<v?w.subarray(C-64):new Uint8Array(0),x=w.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<x;C+=1)T[C>>2]|=w[C]<<(C%4<<3);if(T[C>>2]|=128<<(C%4<<3),C>55)for(i(y,T),C=0;C<16;C+=1)T[C]=0;return S=v*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(S[2],16),E=parseInt(S[1],16)||0,T[14]=_,T[15]=E,i(y,T),y}function l(w){var v="",y;for(y=0;y<4;y+=1)v+=n[w>>y*8+4&15]+n[w>>y*8&15];return v}function f(w){var v;for(v=0;v<w.length;v+=1)w[v]=l(w[v]);return w.join("")}f(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function w(v,y){return v=v|0||0,v<0?Math.max(v+y,0):Math.min(v,y)}ArrayBuffer.prototype.slice=function(v,y){var C=this.byteLength,x=w(v,C),T=C,S,_,E,D;return y!==r&&(T=w(y,C)),x>T?new ArrayBuffer(0):(S=T-x,_=new ArrayBuffer(S),E=new Uint8Array(_),D=new Uint8Array(this,x,S),E.set(D),_)}})();function u(w){return/[\u0080-\uFFFF]/.test(w)&&(w=unescape(encodeURIComponent(w))),w}function d(w,v){var y=w.length,C=new ArrayBuffer(y),x=new Uint8Array(C),T;for(T=0;T<y;T+=1)x[T]=w.charCodeAt(T);return v?x:C}function h(w){return String.fromCharCode.apply(null,new Uint8Array(w))}function g(w,v,y){var C=new Uint8Array(w.byteLength+v.byteLength);return C.set(new Uint8Array(w)),C.set(new Uint8Array(v),w.byteLength),C}function p(w){var v=[],y=w.length,C;for(C=0;C<y-1;C+=2)v.push(parseInt(w.substr(C,2),16));return String.fromCharCode.apply(String,v)}function m(){this.reset()}return m.prototype.append=function(w){return this.appendBinary(u(w)),this},m.prototype.appendBinary=function(w){this._buff+=w,this._length+=w.length;var v=this._buff.length,y;for(y=64;y<=v;y+=64)i(this._hash,o(this._buff.substring(y-64,y)));return this._buff=this._buff.substring(y-64),this},m.prototype.end=function(w){var v=this._buff,y=v.length,C,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T;for(C=0;C<y;C+=1)x[C>>2]|=v.charCodeAt(C)<<(C%4<<3);return this._finish(x,y),T=f(this._hash),w&&(T=p(T)),this.reset(),T},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(w){return this._buff=w.buff,this._length=w.length,this._hash=w.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(w,v){var y=v,C,x,T;if(w[y>>2]|=128<<(y%4<<3),y>55)for(i(this._hash,w),y=0;y<16;y+=1)w[y]=0;C=this._length*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),x=parseInt(C[2],16),T=parseInt(C[1],16)||0,w[14]=x,w[15]=T,i(this._hash,w)},m.hash=function(w,v){return m.hashBinary(u(w),v)},m.hashBinary=function(w,v){var y=s(w),C=f(y);return v?p(C):C},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(w){var v=g(this._buff.buffer,w),y=v.length,C;for(this._length+=w.byteLength,C=64;C<=y;C+=64)i(this._hash,a(v.subarray(C-64,C)));return this._buff=C-64<y?new Uint8Array(v.buffer.slice(C-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(w){var v=this._buff,y=v.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x,T;for(x=0;x<y;x+=1)C[x>>2]|=v[x]<<(x%4<<3);return this._finish(C,y),T=f(this._hash),w&&(T=p(T)),this.reset(),T},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var w=m.prototype.getState.call(this);return w.buff=h(w.buff),w},m.ArrayBuffer.prototype.setState=function(w){return w.buff=d(w.buff,!0),m.prototype.setState.call(this,w)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(w,v){var y=c(new Uint8Array(w)),C=f(y);return v?p(C):C},m})})(xv)),xv.exports}var aK=oK();const sK=ka(aK),cK=["lastShaderProgramBound","context","_openGLRenderWindow"];function lK(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(r,n,i)=>{let o=n;i.length>0&&(o=Oe.substitute(o,"VSOut","GSOut").result);const a=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;a?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),o=Oe.substitute(o,"//VTK::System::Dec",[`${c}
`,a?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=Oe.substitute(r,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(a){l=Oe.substitute(l,"varying","out").result,o=Oe.substitute(o,"varying","in").result;let u="",d=0;for(;o.includes(`gl_FragData[${d}]`);)o=Oe.substitute(o,`gl_FragData\\[${d}\\]`,`fragOutput${d}`).result,u+=`layout(location = ${d}) out vec4 fragOutput${d};
`,d++;o=Oe.substitute(o,"//VTK::Output::Dec",u).result}const f=Oe.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:o,GSSource:f}},t.readyShaderProgramArray=(r,n,i)=>{const o=t.replaceShaderValues(r,n,i),a=t.getShaderProgram(o.VSSource,o.FSSource,o.GSSource);return t.readyShaderProgram(a)},t.readyShaderProgram=r=>!r||!r.getCompiled()&&!r.compileShader()||!t.bindShaderProgram(r)?null:r,t.getShaderProgram=(r,n,i)=>{const o=`${r}${n}${i}`,a=sK.hash(o);if(!(a in e.shaderPrograms)){const s=Oe.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(r),s.getFragmentShader().setSource(n),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(a),e.shaderPrograms[a]=s,s}return e.shaderPrograms[a]},t.releaseGraphicsResources=r=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(n=>e.shaderPrograms[n]).forEach(n=>n.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=r=>(e.lastShaderProgramBound===r||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),r.bind(),e.lastShaderProgramBound=r),1)}const uK={lastShaderProgramBound:null,shaderPrograms:null,context:null};function TI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uK,r),e.shaderPrograms={},K.obj(t,e),K.setGet(t,e,cK),K.moveToProtected(t,e,["openGLRenderWindow"]),lK(t,e)}const fK=K.newInstance(TI,"vtkShaderCache");var dK={newInstance:fK,extend:TI};const{vtkErrorMacro:hK}=K;function gK(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&hK("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=r=>{if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=()=>{for(let r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=r=>t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r),t.isAllocated=r=>e.textureUnits[r],t.free=r=>{e.textureUnits[r]=!1},t.freeAll=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}}const pK={context:null,numberOfTextureUnits:0,textureUnits:0};function SI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pK,r),K.obj(t,e),e.textureUnits=[],K.get(t,e,["numberOfTextureUnits"]),K.setGet(t,e,["context"]),gK(t,e)}const mK=K.newInstance(SI,"vtkOpenGLTextureUnitManager");var vK={newInstance:mK,extend:SI};function yK(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=r=>{const n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=(r,n,i)=>{const o=i.getViewportByReference(),a=t.getFramebufferSize();return o[0]*a[0]<=r&&o[2]*a[0]>=r&&o[1]*a[1]<=n&&o[3]*a[1]>=n},t.getViewportSize=r=>{const n=r.getViewportByReference(),i=t.getFramebufferSize();return[(n[2]-n[0])*i[0],(n[3]-n[1])*i[1]]},t.getViewportCenter=r=>{const n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r/o[0],n/o[1],i]},t.normalizedDisplayToDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r*o[0],n*o[1],i]},t.worldToView=(r,n,i,o)=>o.worldToView(r,n,i),t.viewToWorld=(r,n,i,o)=>o.viewToWorld(r,n,i),t.worldToDisplay=(r,n,i,o)=>{const a=o.worldToView(r,n,i),s=t.getViewportSize(o),c=o.viewToProjection(a[0],a[1],a[2],s[0]/s[1]),l=o.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(r,n,i,o)=>{const a=t.displayToNormalizedDisplay(r,n,i),s=o.normalizedDisplayToProjection(a[0],a[1],a[2]),c=t.getViewportSize(o),l=o.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return o.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(r,n,i,o)=>{let a=o.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const s=t.normalizedDisplayToDisplay(r,n,i);return[s[0]-a[0]-.5,s[1]-a[1]-.5,i]},t.viewportToNormalizedViewport=(r,n,i,o)=>{const a=t.getViewportSize(o);return a&&a[0]!==0&&a[1]!==0?[r/(a[0]-1),n/(a[1]-1),i]:[r,n,i]},t.normalizedViewportToViewport=(r,n,i,o)=>{const a=t.getViewportSize(o);return[r*(a[0]-1),n*(a[1]-1),i]},t.displayToLocalDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r,o[1]-n-1,i]},t.viewportToNormalizedDisplay=(r,n,i,o)=>{let a=o.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const s=r+a[0]+.5,c=n+a[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{K.vtkErrorMacro("not implemented")},t.getPixelData=(r,n,i,o)=>{K.vtkErrorMacro("not implemented")},t.createSelector=()=>{K.vtkErrorMacro("not implemented")}}const wK={size:void 0,selector:void 0};function _I(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wK,r),e.size||(e.size=[300,300]),K.getArray(t,e,["size"],2),K.get(t,e,["selector"]),Yn.extend(t,e,r),yK(t,e)}const CK=K.newInstance(_I,"vtkRenderWindowViewNode");var xK={newInstance:CK,extend:_I};const TK="__getUnderlyingContext";function SK(){const t=new Map,e={apply(i,o,a){return t.has(a[0])?t.get(a[0]):i.apply(o,a)}};function r(i){return{apply(o,a,s){return t.set(i,s[0]),o.apply(a,s)}}}const n=Object.create(null);return n.getParameter=(i,o,a,s)=>new Proxy(s.bind(i),e),n.depthMask=(i,o,a,s)=>new Proxy(s.bind(i),r(i.DEPTH_WRITEMASK)),{get(i,o,a){if(o===TK)return()=>i;let s=Reflect.get(i,o,i);s instanceof Function&&(s=s.bind(i));const c=n[o];return c?c(i,o,a,s):s}}}const{vtkDebugMacro:VS,vtkErrorMacro:kS}=K,_K={position:"absolute",top:0,left:0,width:"100%",height:"100%"},EK=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Xi(t,e,r){const n=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),o===t.FRAMEBUFFER_COMPLETE}let Lm=0;const e2=[];function bK(){Lm++,e2.forEach(t=>t(Lm))}function DK(){Lm--,e2.forEach(t=>t(Lm))}function IK(t){e2.push(t)}function MK(t){return e2.pop()}function FS(t){t.preventDefault()}function OK(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let r;function n(){return r||(r=SK()),r}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",FS,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function o(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(o),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(d=>{d.setOpenGLRenderWindow?.(t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&bK(),e.textureUnitManager=vK.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&kS("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:d}=e.el.getBoundingClientRect();e.containerSize=[u,d]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.activeFramebuffer?.getSize()||e.size,t.getPixelData=(u,d,h,g)=>{const p=new Uint8Array((h-u+1)*(g-d+1)*4);return e.context.readPixels(u,d,h-u+1,g-d+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},d=null;const h=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&h&&(d=e.canvas.getContext("webgl2",u),d&&(e.webgl2=!0,VS("using webgl2"))),d||(VS("using webgl1"),d=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(d,n())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=Q1.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const d=e._textureResourceIds.get(u);if(d!==void 0){e.context.activeTexture(e.context.TEXTURE0+d);return}const h=t.getTextureUnitManager().allocate();if(h<0){kS("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,h),e.context.activeTexture(e.context.TEXTURE0+h)},t.deactivateTexture=u=>{const d=e._textureResourceIds.get(u);d!==void 0&&(t.getTextureUnitManager().free(d),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const d=e._textureResourceIds.get(u);return d!==void 0?d:-1},t.getDefaultTextureByteSize=function(u){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case Qt.CHAR:case Qt.SIGNED_CHAR:case Qt.UNSIGNED_CHAR:return 1;case d:case h:case Qt.UNSIGNED_SHORT:case Qt.SHORT:case Qt.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,d){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case Qt.UNSIGNED_CHAR:switch(d){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(h&&!g&&Qt.UNSIGNED_SHORT):switch(d){case 1:return h.R16_EXT;case 2:return h.RG16_EXT;case 3:return h.RGB16_EXT;case 4:default:return h.RGBA16_EXT}case(h&&!g&&Qt.SHORT):switch(d){case 1:return h.R16_SNORM_EXT;case 2:return h.RG16_SNORM_EXT;case 3:return h.RGB16_SNORM_EXT;case 4:default:return h.RGBA16_SNORM_EXT}case Qt.UNSIGNED_SHORT:case Qt.SHORT:case Qt.FLOAT:default:switch(d){case 1:return g?e.context.R16F:e.context.R32F;case 2:return g?e.context.RG16F:e.context.RG32F;case 3:return g?e.context.RGB16F:e.context.RGB32F;case 4:default:return g?e.context.RGBA16F:e.context.RGBA32F}}switch(d){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function a(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const d=document.createElement("canvas"),h=d.getContext("2d");d.width=e.canvas.width,d.height=e.canvas.height,h.drawImage(e.canvas,0,0);const g=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(v=>{v.getViewProps().forEach(C=>{if(C.getContainer){const T=C.getContainer().getElementsByTagName("canvas");for(let S=0;S<T.length;S++){const _=T[S],E=_.getBoundingClientRect(),D=E.x-g.x,b=E.y-g.y;h.drawImage(_,D,b)}}})});const w=d.toDataURL(u);d.remove(),t.invokeImageReady(w)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:d=!1,size:h=null,scale:g=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:h||g!==1?h||e.size.map(m=>m*g):null},new Promise((m,w)=>{const v=t.onImageReady(y=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=p,v.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(C=>{let{restoreParamsFn:x,arg:T}=C;return x(T)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),m(y);else{const C=document.createElement("img");if(C.style=_K,C.src=y,e._screenshot.placeHolder=e.el.appendChild(C),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e.rootOpenGLRenderWindow?.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),d){const x=d!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(T=>{const S=T.getActiveCamera(),_=S.get("focalPoint","position","parallelScale");return{resetCameraArgs:x?{renderer:T}:void 0,resetCameraFn:x?d:T.resetCamera,restoreParamsFn:S.set,arg:JSON.parse(JSON.stringify(_))}}),e._screenshot.cameras.forEach(T=>{let{resetCameraFn:S,resetCameraArgs:_}=T;return S(_)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const u=t.get3DContext(),d=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=d[1],d[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),d=u.getExtension("OES_texture_float"),h=u.getExtension("OES_texture_half_float"),g=u.getExtension("WEBGL_debug_renderer_info"),p=u.getExtension("WEBGL_draw_buffers"),m=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),w=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",m&&u.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[d&&Xi(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",d&&Xi(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",d&&Xi(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",d&&Xi(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",d&&Xi(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[h&&Xi(u,u.RGBA,h.HALF_FLOAT_OES)?"RGBA":"",h&&Xi(u,u.RGB,h.HALF_FLOAT_OES)?"RGB":"",h&&Xi(u,u.LUMINANCE,h.HALF_FLOAT_OES)?"LUMINANCE":"",h&&Xi(u,u.ALPHA,h.HALF_FLOAT_OES)?"ALPHA":"",h&&Xi(u,u.LUMINANCE_ALPHA,h.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[d&&Xi(u,u.RGBA,u.FLOAT)?"RGBA":"",d&&Xi(u,u.RGB,u.FLOAT)?"RGB":"",d&&Xi(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",d&&Xi(u,u.ALPHA,u.FLOAT)?"ALPHA":"",d&&Xi(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?u.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",g&&u.getParameter(g.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",g&&u.getParameter(g.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],v={};for(;w.length;){const[y,C,x]=w.pop();C&&(v[C]={label:y,value:x})}return e._glInformation=v,v},t.traverseAllPasses=()=>{if(e.renderPasses)for(let d=0;d<e.renderPasses.length;++d)e.renderPasses[d].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&a();const u=e.renderable.getChildRenderWindowsByReference();for(let d=0;d<u.length;++d)t.getViewNodeFor(u[d])?.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(g=>!!g.getSelector?.()))return;const d=u.getCanvas(),h=e.canvas;e.context2D.drawImage(d,0,d.height-h.height,h.width,h.height,0,0,h.width,h.height)},t.resizeFromChildRenderWindows=()=>{const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const d=[0,0];for(let h=0;h<u.length;++h){const g=t.getViewNodeFor(u[h])?.getSize();g&&(d[0]=g[0]>d[0]?g[0]:d[0],d[1]=g[1]>d[1]?g[1]:d[1])}t.setSize(...d)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const d=e.renderable.getRenderers()[0];d.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(h=>t.setBackgroundImage(h.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=DC.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",FS),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=K.chain(()=>{e.context&&DK(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,d)=>{const h=l(u,d);return h&&t.invokeWindowResizeEvent({width:u,height:d}),h},t.registerGraphicsResourceUser=(u,d)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null),e._graphicsResources.get(u)?.users.add(d)},t.unregisterGraphicsResourceUser=(u,d)=>{const h=e._graphicsResources.get(u);h&&(h.users.delete(d),h.users.size||(h.oglObject?.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,d,h)=>{if(!u)return;const g=e._graphicsResources.get(u);g?.oglObject?.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:d,hash:h,users:g?.users??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(d=>{let{oglObject:h}=d;u+=h.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:d}=u;d.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{t.getViewNodeFor(u)?.releaseGraphicsResources()})};const f={...t};EK.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):f[u](...arguments)}})}const PK={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function EI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PK,r),xK.extend(t,e,r),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=DC.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=mB.newInstance(),e.shaderCache=dK.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=bC.newInstance(),K.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),K.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),K.setGetArray(t,e,["size"],2),K.event(t,e,"imageReady"),K.event(t,e,"windowResizeEvent"),OK(t,e)}const IC=K.newInstance(EI,"vtkOpenGLRenderWindow");aI("WebGL",IC);var RK={newInstance:IC,extend:EI,pushMonitorGLContextCount:IK,popMonitorGLContextCount:MK};Vr("vtkRenderWindow",IC);function AK(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=r=>{if(r){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const i=e.children[n];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),sr(e.keyMatrices.mcwc,e.renderable.getMatrix()),mn(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Ao(e.keyMatrices.normalMatrix):(xl(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),xc(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),g0(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const LK={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function NK(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LK,r),Yn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Ao(new Float64Array(9)),mcwc:_t(new Float64Array(16))},Er(t,e,["context"]),Wi(t,e,["activeTextures"]),AK(t,e)}const bI=On(NK);var VK={newInstance:bI};Vr("vtkActor",bI);function kK(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=r=>{if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const i=e.children[n];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const FK={context:null,activeTextures:null};function UK(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FK,r),Yn.extend(t,e,r),Er(t,e,["context"]),Wi(t,e,["activeTextures"]),kK(t,e)}const DI=On(UK);var BK={newInstance:DI};Vr("vtkActor2D",DI);function GK(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=r=>r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=r=>{const n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=r=>{if(r)if(!Array.isArray(r))t.addClippingPlane(r);else{const n=r.length;for(let i=0;i<n&&i<6;i++)t.addClippingPlane(r[i])}},t.getClippingPlaneInDataCoords=(r,n,i)=>{const o=e.clippingPlanes,a=r;if(o){const s=o.length;if(n>=0&&n<s){const c=o[n],l=c.getNormal(),f=c.getOrigin(),u=l[0],d=l[1],h=l[2],g=-(u*f[0]+d*f[1]+h*f[2]);i[0]=u*a[0]+d*a[4]+h*a[8]+g*a[12],i[1]=u*a[1]+d*a[5]+h*a[9]+g*a[13],i[2]=u*a[2]+d*a[6]+h*a[10]+g*a[14],i[3]=u*a[3]+d*a[7]+h*a[11]+g*a[15];return}}K.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}const WK={clippingPlanes:[]};function $K(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WK,r),K.obj(t,e),K.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),GK(t,e)}var zK={extend:$K};function jK(t,e){t.getBounds=()=>(K.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Xu()),t.getCenter=()=>{const r=t.getBounds();return e.center=hn.isValid(r)?hn.getCenter(r):null,e.center?.slice()},t.getLength=()=>{const r=t.getBounds();return hn.getDiagonalLength(r)}}const HK=t=>({bounds:[...hn.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function KK(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HK(r)),zK.extend(t,e,r),K.setGet(t,e,["viewSpecificProperties"]),jK(t,e)}var MC={extend:KK};const{vtkErrorMacro:US}=K,BS=0,GS=1,Tv=2;function XK(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(let n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(r,n)=>{let i=0;const o=Number(r);return o<n.range[0]?i=n.maxIndex+BS+1.5:o>n.range[1]?i=n.maxIndex+GS+1.5:(i=(o+n.shift)*n.scale,i=i<n.maxIndex?i:n.maxIndex),Math.floor(i)},t.linearLookup=(r,n,i)=>{let o=0;Sm(r)?o=Math.floor(i.maxIndex+1.5+Tv):o=t.linearIndexLookup(r,i);const a=4*o;return n.slice(a,a+4)},t.indexedLookupFunction=(r,n,i)=>{let o=t.getAnnotatedValueIndexInternal(r);o===-1&&(o=e.numberOfColors+Tv);const a=4*o;return[n[a],n[a+1],n[a+2],n[a+3]]},t.lookupShiftAndScale=(r,n)=>{n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=(r,n,i,o)=>{let a=t.linearLookup;e.indexedLookup&&(a=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const l=t.getAlpha(),f=r.getNumberOfTuples(),u=r.getNumberOfComponents(),d=n.getData(),h=r.getData();if(l>=1){if(i===r5.RGBA)for(let g=0;g<f;g++){const p=a(h[g*u+o],e.table,c);d[g*4]=p[0],d[g*4+1]=p[1],d[g*4+2]=p[2],d[g*4+3]=p[3]}}else if(i===r5.RGBA)for(let g=0;g<f;g++){const p=a(h[g*u+o],e.table,c);d[g*4]=p[0],d[g*4+1]=p[1],d[g*4+2]=p[2],d[g*4+3]=Math.floor(p[3]*l+.5)}},t.forceBuild=()=>{let r=0,n=0,i=0,o=0;const a=e.numberOfColors-1;a&&(r=(e.hueRange[1]-e.hueRange[0])/a,n=(e.saturationRange[1]-e.saturationRange[0])/a,i=(e.valueRange[1]-e.valueRange[0])/a,o=(e.alphaRange[1]-e.alphaRange[0])/a),e.table.length=4*a+16;const s=[],c=[];for(let l=0;l<=a;l++)s[0]=e.hueRange[0]+l*r,s[1]=e.saturationRange[0]+l*n,s[2]=e.valueRange[0]+l*i,Eu(s,c),c[3]=e.alphaRange[0]+l*o,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=r=>{if(Array.isArray(r)){const i=r[0].length;e.numberOfColors=r.length;const o=4-i;let a=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<r.length;s++){const c=r[s];for(let l=0;l<i;l++)e.table[a++]=c[l];a+=o}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(r.getNumberOfComponents()!==4)return US("Expected 4 components for RGBA colors"),!1;if(r.getDataType()!==Qt.UNSIGNED_CHAR)return US("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=r.getNumberOfTuples();const n=r.getData();e.table.length=n.length;for(let i=0;i<n.length;i++)e.table[i]=n[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:r}=e,n=e.table;let i=(r+BS)*4;e.useBelowRangeColor||r===0?(n[i]=e.belowRangeColor[0]*255+.5,n[i+1]=e.belowRangeColor[1]*255+.5,n[i+2]=e.belowRangeColor[2]*255+.5,n[i+3]=e.belowRangeColor[3]*255+.5):(n[i]=n[0],n[i+1]=n[1],n[i+2]=n[2],n[i+3]=n[3]),i=(r+GS)*4,e.useAboveRangeColor||r===0?(n[i]=e.aboveRangeColor[0]*255+.5,n[i+1]=e.aboveRangeColor[1]*255+.5,n[i+2]=e.aboveRangeColor[2]*255+.5,n[i+3]=e.aboveRangeColor[3]*255+.5):(n[i]=n[4*(r-1)+0],n[i+1]=n[4*(r-1)+1],n[i+2]=n[4*(r-1)+2],n[i+3]=n[4*(r-1)+3]),i=(r+Tv)*4,n[i]=e.nanColor[0]*255+.5,n[i+1]=e.nanColor[1]*255+.5,n[i+2]=e.nanColor[2]*255+.5,n[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const qK={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function II(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qK,r),G1.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},K.obj(e.buildTime),e.opaqueFlagBuildTime={},K.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},K.obj(e.insertTime,{mtime:0}),K.get(t,e,["buildTime"]),K.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),K.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),K.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),K.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),XK(t,e)}const YK=K.newInstance(II,"vtkLookupTable");var JK={newInstance:YK,extend:II};const{FieldAssociations:WS}=A0,{staticOffsetAPI:ZK,otherStaticMethods:QK}=J1,{ColorMode:Zg,ScalarMode:hu,GetArray:Sv}=Hw,{VectorMode:eX}=jw,{VtkDataTypes:tX}=Tt;function ad(t){return()=>K.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function nX(t,e){const r=t[1]%2===0?1:-1;if(t[0]+=r,t[0]>=e[0]||t[0]<0){const n=t[2]%2===0?1:-1;t[0]-=r,t[1]+=n,(t[1]>=e[1]||t[1]<0)&&(t[1]-=n,t[2]++)}}function rX(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function $S(t,e,r){const n=Math.floor(e),i=n%(2*r[0]);let o,a;i<r[0]?(t[0]=i,o=1,a=t[0]===r[0]-1):(t[0]=2*r[0]-1-i,o=-1,a=t[0]===0);const s=Math.floor(n/r[0]),c=s%(2*r[1]);let l,f;c<r[1]?(t[1]=c,l=1,f=t[1]===r[1]-1):(t[1]=2*r[1]-1-c,l=-1,f=t[1]===0),t[2]=Math.floor(s/r[1]);const u=e-n;a?f?t[2]+=u:t[1]+=l*u:t[0]+=o*u,t[0]=(t[0]+.5)/r[0],t[1]=(t[1]+.5)/r[1],t[2]=(t[2]+.5)/r[2]}const zS=new WeakMap;function iX(t,e,r,n,i,o,a){const s=new Array(arguments.length);for(let I=0;I<arguments.length;++I){const O=arguments[I];s[I]=O.getMTime?.()??O}const c=s.join("/"),l=zS.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const f=(r[1]-r[0])/(i-1),[u,d]=[r[0]-f,r[1]+f],h=u-.5*f,g=1/(d-u+f),p=u,m=(i+1)/(d-u),w=t.getData(),v=t.getNumberOfTuples(),y=t.getNumberOfComponents(),C=e<0||e>=y,x=o[2]<=1?2:3,T=Tt.newInstance({numberOfComponents:x,values:new Float32Array(v*x)}),S=T.getData(),_=[0,0,0];$S(_,i+2,o);let E=0,D=0;const b=[.5,.5,.5];for(let I=0;I<v;++I){let O;if(C){let M=0;for(let R=0;R<y;++R){const A=Number(w[E+R]);M+=A*A}O=Math.sqrt(M)}else O=Number(w[E+e]);if(n&&(O=Math.log10(O)),E+=y,Sm(O))b[0]=_[0],b[1]=_[1],b[2]=_[2];else if(a){let M=(O-p)*m;M<1?M=0:M>i&&(M=i+1),$S(b,M,o)}else{b[1]=.49;const M=(O-h)*g;M>1e3?b[0]=1e3:M<-1e3?b[0]=-1e3:b[0]=M}for(let M=0;M<x;++M)S[D++]=b[M]}return zS.set(t,{stringHash:c,textureCoordinates:T}),T}function oX(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=Xu(),e.bounds},t.setForceCompileOnly=r=>{e.forceCompileOnly=r},t.setSelectionWebGLIdsToVTKIds=r=>{e.selectionWebGLIdsToVTKIds=r},t.createDefaultLookupTable=()=>{e.lookupTable=JK.newInstance()},t.getColorModeAsString=()=>K.enumToString(Zg,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>K.enumToString(hu,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,i,o,a)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(n===hu.DEFAULT)s=r.getPointData().getScalars(),s||(s=r.getCellData().getScalars(),c=!0);else if(n===hu.USE_POINT_DATA)s=r.getPointData().getScalars();else if(n===hu.USE_CELL_DATA)s=r.getCellData().getScalars(),c=!0;else if(n===hu.USE_POINT_FIELD_DATA){const l=r.getPointData();i===Sv.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===hu.USE_CELL_FIELD_DATA){const l=r.getCellData();c=!0,i===Sv.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===hu.USE_FIELD_DATA){const l=r.getFieldData();i===Sv.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}return{scalars:s,cellFlag:c}},t.mapScalars=(r,n)=>{const{scalars:i,cellFlag:o}=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=o,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${n}`;if(e.colorBuildString!==a){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,o))e.mapScalarsToTexture(i,o,n);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${n}`}},e.mapScalarsToTexture=(r,n,i)=>{const o=e.lookupTable.getRange(),a=e.lookupTable.usingLogScale(),s=e.lookupTable.getAlpha(),c=a?[Math.log10(o[0]),Math.log10(o[1])]:o;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const f=e.lookupTable.getNumberOfAvailableColors(),u=2048,d=u**3-3,g=4096-2,p=2,m=n?d:g;e.numberOfColorsInRange=Math.min(Math.max(f,p),m);const w=e.numberOfColorsInRange+3,v=e.numberOfColorsInRange+2,y=n?[Math.min(Math.ceil(w/u**0),u),Math.min(Math.ceil(w/u**1),u),Math.min(Math.ceil(w/u**2),u)]:[v,2,1],C=y[0]*y[1]*y[2],x=new Float64Array(C);x.fill(NaN);const T=e.numberOfColorsInRange,S=T+2,_=[0,0,0],E=c[0],D=c[1]-c[0];for(let O=0;O<S;++O){const M=rX(_,y),R=E+D*(O-1)/(T-1),A=a?10**R:R;x[M]=A,nX(_,y)}const b=Tt.newInstance({numberOfComponents:1,values:x}),I=e.lookupTable.mapScalars(b,e.colorMode,0);e.colorTextureMap=dg.newInstance(),e.colorTextureMap.setDimensions(y),e.colorTextureMap.getPointData().setScalars(I),e.lookupTable.setAlpha(s)}const l=e.lookupTable.getVectorMode()===eX.MAGNITUDE&&r.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=iX(r,l,c,a,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),n)},t.getIsOpaque=()=>{const r=t.getInputData(),i=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const o=t.getLookupTable();return o?(o.build(),o.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(r,n)=>n&&e.colorMode!==Zg.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!r||e.colorMode===Zg.DEFAULT&&r.getDataType()===tX.UNSIGNED_CHAR||e.colorMode===Zg.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){const n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=()=>{const r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=ad("AcquireInvertibleLookupTable"),t.valueToColor=ad("ValueToColor"),t.colorToValue=ad("ColorToValue"),t.useInvertibleColorFor=ad("UseInvertibleColorFor"),t.clearInvertibleColor=ad("ClearInvertibleColor"),t.processSelectorPixelBuffers=(r,n)=>{if(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=r.getRawPixelBuffer(Ji.ID_LOW24),o=r.getRawPixelBuffer(Ji.ID_HIGH24),a=r.getCurrentPass(),s=r.getFieldAssociation();let c=null;s===WS.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===WS.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&n.forEach(l=>{if(a===Ji.ID_LOW24){let f=0;o&&(f+=o[l],f*=256),f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],d=r.getPixelBuffer(Ji.ID_LOW24);d[l]=u&255,d[l+1]=(u&65280)>>8,d[l+2]=(u&16711680)>>16}else if(a===Ji.ID_HIGH24&&o){let f=0;f+=o[l],f*=256,f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],d=r.getPixelBuffer(Ji.ID_HIGH24);d[l]=(u&4278190080)>>24}})}}const aX={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function MI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aX,r),MC.extend(t,e,r),K.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),K.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),K.setGetArray(t,e,["scalarRange"],2),J1.implementCoincidentTopologyMethods(t,e),oX(t,e)}const sX=K.newInstance(MI,"vtkMapper");var Ui={newInstance:sX,extend:MI,...ZK,...QK,...Hw};const{FieldAssociations:_v}=A0,{primTypes:Jr}=Fa,{Representation:yf,Shading:jS}=cf,{ScalarMode:Qg}=Ui,{Filter:HS,Wrap:KS}=Kn,{vtkErrorMacro:gu}=_i,cX={type:"StartEvent"},lX={type:"EndEvent"},{CoordinateSystem:uX}=sg;function fX(t){const e=t.getSelector();return e?e.getCurrentPass():Ji.MIN_KNOWN_PASS-1}function dX(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let a=Jr.Start;a<Jr.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.getShaderTemplate=(n,i,o)=>{n.Vertex=_C,n.Fragment=cg,n.Geometry=""},t.replaceShaderColor=(n,i,o)=>{let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(f=f.concat(["varying vec4 vertexColorVSOutput;"]),a=Oe.substitute(a,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,a=Oe.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=Oe.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Oe.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=Oe.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=Oe.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(o.getBackfaceProperty()&&!e.drawingEdges&&(f=f.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(f=f.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(f=f.concat(["uniform samplerBuffer texture1;"])),c=Oe.substitute(c,"//VTK::Color::Impl",u).result),c=Oe.substitute(c,"//VTK::Color::Dec",f).result,n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderLight=(n,i,o)=>{let a=n.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let f=[];switch(c){case 0:a=Oe.substitute(a,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:a=Oe.substitute(a,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);a=Oe.substitute(a,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)f=f.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${s}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=Oe.substitute(a,"//VTK::Light::Impl",f,!1).result;break;case 3:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);a=Oe.substitute(a,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)f=f.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=Oe.substitute(a,"//VTK::Light::Impl",f,!1).result;break;default:gu("bad light complexity")}n.Fragment=a},t.replaceShaderNormal=(n,i,o)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=n.Vertex,c=n.Geometry,l=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=Oe.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Oe.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=Oe.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=Oe.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=Oe.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=Oe.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=Oe.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=Oe.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(o.getProperty().getRepresentation())===e.context.LINES?(l=Oe.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=Oe.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=Oe.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=Oe.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=Oe.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=s,n.Geometry=c,n.Fragment=l}},t.replaceShaderPositionVC=(n,i,o)=>{e.lastBoundBO.replaceShaderPositionVC(n,i,o);let a=n.Vertex,s=n.Geometry,c=n.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=Oe.substitute(a,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,a=Oe.substitute(a,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Oe.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=Oe.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=Oe.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=Oe.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=Oe.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(a=Oe.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Oe.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderTCoord=(n,i,o)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;if(e.drawingEdges)return;a=Oe.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let f=2,u=2;if(l&&l.length>0&&(f=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(f=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(a=Oe.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=Oe.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=Oe.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Oe.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(f){case 1:c=Oe.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Oe.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Oe.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(a=Oe.substitute(a,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=Oe.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=Oe.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Oe.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,f){case 1:c=Oe.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Oe.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Oe.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=a,n.Geometry=s,n.Fragment=c}},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();a=Oe.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,a=Oe.substitute(a,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Oe.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=Oe.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getCoincidentParameters=(n,i)=>{let o={factor:0,offset:0};const a=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==Ua.PolygonOffset||a.getEdgeVisibility()&&a.getRepresentation()===yf.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===Jr.Points||a.getRepresentation()===yf.POINTS?o=e.renderable.getCoincidentTopologyPointOffsetParameter():c===Jr.Lines||a.getRepresentation()===yf.WIREFRAME?o=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===Jr.Tris||c===Jr.TriStrips)&&(o=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===Jr.TrisEdges||c===Jr.TriStripsEdges)&&(o=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),o.factor/=2,o.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===_v.FIELD_ASSOCIATION_POINTS&&(o.offset-=2),o},t.replaceShaderPicking=(n,i,o)=>{let a=n.Fragment,s=n.Vertex;if(a=Oe.substitute(a,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===Ji.ID_LOW24||e.lastSelectionState===Ji.ID_HIGH24)&&(s=Oe.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=Oe.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,a=Oe.substitute(a,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,a=Oe.substitute(a,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case Ji.ID_LOW24:a=Oe.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case Ji.ID_HIGH24:a=Oe.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:a=Oe.substitute(a,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,a=Oe.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=a,n.Vertex=s}},t.replaceShaderValues=(n,i,o)=>{if(t.replaceShaderColor(n,i,o),t.replaceShaderNormal(n,i,o),t.replaceShaderLight(n,i,o),t.replaceShaderTCoord(n,i,o),t.replaceShaderPicking(n,i,o),t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o),t.replaceShaderPositionVC(n,i,o),e.haveSeenDepthRequest){let a=n.Fragment;a=Oe.substitute(a,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,a=Oe.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=a}},t.getNeedToRebuildShaders=(n,i,o)=>{let a=0,s=0;const c=n.getPrimitiveType(),l=e.currentInput;let f=!1;const u=l.getPointData().getNormals(),d=l.getCellData().getNormals(),h=o.getProperty().getInterpolation()===jS.FLAT,g=o.getProperty().getRepresentation(),p=n.getOpenGLMode(g,c);if((p===e.context.TRIANGLES||d&&!u||!h&&u||!h&&p===e.context.LINES)&&(f=!0),o.getProperty().getLighting()&&f){a=0;const y=i.getLightsByReference();for(let C=0;C<y.length;++C){const x=y[C];x.getSwitch()>0&&(s++,a===0&&(a=1)),a===1&&(s>1||x.getIntensity()!==1||!x.lightTypeIsHeadLight())&&(a=2),a<3&&x.getPositional()&&(a=3)}}let m=!1;const w=e.lastBoundBO.getReferenceByName("lastLightComplexity"),v=e.lastBoundBO.getReferenceByName("lastLightCount");return(w!==a||v!==s)&&(e.lastBoundBO.set({lastLightComplexity:a},!0),e.lastBoundBO.set({lastLightCount:s},!0),m=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(m=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||m?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(n,i,o)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(s=>{s.callback(s.userData,n,i,o)})},t.setMapperShaderParameters=(n,i,o)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||gu("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&c>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||gu("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,f)=>{n.getProgram().isAttributeUsed(`${l}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${l}MC`,n.getCABO().getCustomData()[f].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[f].components,!1)||gu(`Error setting ${l}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||gu("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||gu("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,d=u?sr(e.tmpMat4,o.getMatrix()):o.getMatrix();u&&(mn(d,d),Wt(d,d,u),mn(d,d));for(let h=0;h<c;h++){const g=[];e.renderable.getClippingPlaneInDataCoords(d,h,g);for(let p=0;p<4;p++)l.push(g[p])}n.getProgram().setUniformi("numClipPlanes",c),n.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const f=a[c].getTextureUnit(),u=`texture${f+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,f)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",c.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",c.factor)}n.setMapperShaderParameters(i,o,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(n,i,o)=>{const a=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(a<2)return;const s=n.getProgram();let c=0;const l=i.getLightsByReference();for(let d=0;d<l.length;++d){const h=l[d];if(h.getSwitch()>0){const p=h.getColorByReference(),m=h.getIntensity();e.lightColor[0]=p[0]*m,e.lightColor[1]=p[1]*m,e.lightColor[2]=p[2]*m;const w=h.getDirection(),v=i.getActiveCamera().getViewMatrix(),y=[...w];h.lightTypeIsSceneLight()&&(y[0]=v[0]*w[0]+v[1]*w[1]+v[2]*w[2],y[1]=v[4]*w[0]+v[5]*w[1]+v[6]*w[2],y[2]=v[8]*w[0]+v[9]*w[1]+v[10]*w[2],Ro(y)),e.lightDirection[0]=y[0],e.lightDirection[1]=y[1],e.lightDirection[2]=y[2],Ro(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(a<3)return;const u=i.getActiveCamera().getViewMatrix();mn(u,u),c=0;for(let d=0;d<l.length;++d){const h=l[d];if(h.getSwitch()>0){const p=h.getTransformedPosition(),m=new Float64Array(3);Pt(m,p,u),s.setUniform3fArray(`lightAttenuation${c}`,h.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,h.getPositional()),s.setUniformf(`lightExponent${c}`,h.getExponent()),s.setUniformf(`lightConeAngle${c}`,h.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[m[0],m[1],m[2]]),c++}}};function r(n,i,o){return i.identity(o),n.reduce((a,s,c)=>c===0?s?i.copy(a,s):i.identity(a):s?i.multiply(a,a,s):a,o)}t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),f=a.getLastCameraMTime(),d=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,h=o.getIsIdentity(),g=h?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(o.getCoordinateSystem()===uX.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();_t(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,Wt(e.tmpMat4,e.tmpMat4,d),a.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else a.setUniformMatrix("MCPCMatrix",r([s.wcpc,g.mcwc,d],vh,e.tmpMat4));a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",r([s.wcvc,g.mcwc,d],vh,e.tmpMat4)),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",r([s.normalMatrix,g.normalMatrix],PF,e.tmpMat3)),f!==l&&(a.isUniformUsed("cameraParallel")&&a.setUniformi("cameraParallel",c.getParallelProjection()),a.setLastCameraMTime(l)),h||a.setLastCameraMTime(0)},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram();let s=o.getProperty(),c=s.getOpacity(),l=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),f=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),u=e.drawingEdges?1:s.getAmbient(),d=e.drawingEdges?0:s.getDiffuse(),h=e.drawingEdges?0:s.getSpecular();const g=s.getSpecularPower();a.setUniformf("opacityUniform",c),a.setUniform3fArray("ambientColorUniform",l),a.setUniform3fArray("diffuseColorUniform",f),a.setUniformf("ambient",u),a.setUniformf("diffuse",d);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let m=s.getSpecularColorByReference();if(a.setUniform3fArray("specularColorUniform",m),a.setUniformf("specularPowerUniform",g),a.setUniformf("specular",h),a.isUniformUsed("ambientIntensityBF")){if(s=o.getBackfaceProperty(),c=s.getOpacity(),l=s.getAmbientColor(),u=s.getAmbient(),f=s.getDiffuseColor(),d=s.getDiffuse(),m=s.getSpecularColor(),h=s.getSpecular(),a.setUniformf("ambientIntensityBF",u),a.setUniformf("diffuseIntensityBF",d),a.setUniformf("opacityUniformBF",c),a.setUniform3fArray("ambientColorUniformBF",l),a.setUniform3fArray("diffuseColorUniformBF",f),p<1)return;a.setUniformf("specularIntensityBF",h),a.setUniform3fArray("specularColorUniformBF",m),a.setUniformf("specularPowerUniformBF",g)}},t.updateMaximumPointCellIds=(n,i)=>{const o=e._openGLRenderer.getSelector();if(!o)return;if(e.selectionWebGLIdsToVTKIds?.points?.length){const s=e.selectionWebGLIdsToVTKIds.points.length;o.setMaximumPointId(s-1)}if(e.selectionWebGLIdsToVTKIds?.cells?.length){const s=e.selectionWebGLIdsToVTKIds.cells.length;o.setMaximumCellId(s-1)}o.getFieldAssociation()===_v.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(n,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const o=fX(e._openGLRenderer);e.lastSelectionState!==o&&(e.selectionStateChanged.modified(),e.lastSelectionState=o),e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().renderProp(i),t.updateBufferObjects(n,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation(),a=i.getProperty().getEdgeVisibility()&&o===yf.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===_v.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===Ji.ID_LOW24||e.lastSelectionState===Ji.ID_HIGH24);for(let l=Jr.Start;l<Jr.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=a&&(l===Jr.TrisEdges||l===Jr.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(n,i,o,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(n,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(n,i)=>{if(t.invokeEvent(cX),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(lX),!e.currentInput){gu("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context,a=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!a&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.FRONT)):(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK)),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return o<t.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentInput.getMTime()},t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Qg.USE_CELL_DATA||s===Qg.USE_CELL_FIELD_DATA||s===Qg.USE_FIELD_DATA||!o.getPointData().getScalars())&&s!==Qg.USE_POINT_FIELD_DATA&&a&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==jS.FLAT?o.getPointData().getNormals():null;c===null&&o.getCellData().getNormals()&&(e.haveCellNormals=!0,c=o.getCellData().getNormals());const l=i.getProperty().getRepresentation();let f=o.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(f=null);let u=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Kn.newInstance({resizable:!0}));const h=e.internalColorTexture;h.setMinificationFilter(HS.NEAREST),h.setMagnificationFilter(HS.NEAREST),h.setWrapS(KS.CLAMP_TO_EDGE),h.setWrapT(KS.CLAMP_TO_EDGE),h.setOpenGLRenderWindow(e._openGLRenderWindow);const g=e.renderable.getColorTextureMap(),p=g.getExtent(),m=g.getPointData().getScalars();h.create2DFromRaw({width:p[1]-p[0]+1,height:p[3]-p[2]+1,numComps:m.getNumberOfComponents(),dataType:m.getDataType(),data:m.getData()}),h.activate(),h.sendParameters(),h.deactivate()}const d=`${o.getMTime()}A${l}B${o.getMTime()}C${c?c.getMTime():1}D${a?a.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${f?f.getMTime():1}`;if(e.VBOBuildString!==d){const g={points:o.getPoints(),normals:c,tcoords:f,colors:a,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(w=>o.getPointData().getArrayByName(w))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:o.getVerts()},{inRep:"lines",cells:o.getLines()},{inRep:"polys",cells:o.getPolys()},{inRep:"strips",cells:o.getStrips()},{inRep:"polys",cells:o.getPolys()},{inRep:"strips",cells:o.getStrips()}],m=i.getProperty().getEdgeVisibility()&&l===yf.SURFACE;for(let w=Jr.Start;w<Jr.End;w++)w!==Jr.TrisEdges&&w!==Jr.TriStripsEdges?(g.cellOffset+=e.primitives[w].getCABO().createVBO(p[w].cells,p[w].inRep,l,g,e.selectionWebGLIdsToVTKIds),g.vertexOffset+=e.primitives[w].getCABO().getElementCount()):m?e.primitives[w].getCABO().createVBO(p[w].cells,p[w].inRep,yf.WIREFRAME,{...g,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[w].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=d}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(i=>{n+=i.getAllocatedGPUMemoryInBytes()}),n}}const hX={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:Ji.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function OI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hX,r),Yn.extend(t,e,r),Cs.implementReplaceShaderCoincidentOffset(t,e,r),Cs.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Jr,e.tmpMat3=Ao(new Float64Array(9)),e.tmpMat4=_t(new Float64Array(16));for(let n=Jr.Start;n<Jr.End;n++)e.primitives[n]=Fa.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Er(t,e,["context"]),e.VBOBuildTime={},Zn(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Zn(e.selectionStateChanged,{mtime:0}),dX(t,e)}const PI=On(OI,"vtkOpenGLPolyDataMapper");var t2={newInstance:PI,extend:OI};Vr("vtkMapper",PI);const{vtkErrorMacro:sd}=_i,{Representation:gX}=cf,{ObjectType:ep}=gc,{PassTypes:pX}=DC,mX={type:"StartEvent"},vX={type:"EndEvent"},yX=64,wX=16;function CX(t,e,r){t[12]=(t[12]-e[0])*r[0],t[13]=(t[13]-e[1])*r[1],t[14]=(t[14]-e[2])*r[2],t[0]*=r[0],t[5]*=r[1],t[10]*=r[2]}function xX(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const r={...t};t.renderPiece=(n,i)=>{if(t.invokeEvent(mX),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(vX),!e.currentInput){sd("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const a=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!a&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.FRONT)):(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK)),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.multiply4x4WithOffset=(n,i,o,a)=>{const s=i[0],c=i[1],l=i[2],f=i[3],u=i[4],d=i[5],h=i[6],g=i[7],p=i[8],m=i[9],w=i[10],v=i[11],y=i[12],C=i[13],x=i[14],T=i[15];let S=o[a],_=o[a+1],E=o[a+2],D=o[a+3];n[0]=S*s+_*u+E*p+D*y,n[1]=S*c+_*d+E*m+D*C,n[2]=S*l+_*h+E*w+D*x,n[3]=S*f+_*g+E*v+D*T,S=o[a+4],_=o[a+5],E=o[a+6],D=o[a+7],n[4]=S*s+_*u+E*p+D*y,n[5]=S*c+_*d+E*m+D*C,n[6]=S*l+_*h+E*w+D*x,n[7]=S*f+_*g+E*v+D*T,S=o[a+8],_=o[a+9],E=o[a+10],D=o[a+11],n[8]=S*s+_*u+E*p+D*y,n[9]=S*c+_*d+E*m+D*C,n[10]=S*l+_*h+E*w+D*x,n[11]=S*f+_*g+E*v+D*T,S=o[a+12],_=o[a+13],E=o[a+14],D=o[a+15],n[12]=S*s+_*u+E*p+D*y,n[13]=S*c+_*d+E*m+D*C,n[14]=S*l+_*h+E*w+D*x,n[15]=S*f+_*g+E*v+D*T},t.replaceShaderNormal=(n,i,o)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=n.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=Oe.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Oe.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),n.Vertex=s}r.replaceShaderNormal(n,i,o)},t.replaceShaderClip=(n,i,o)=>{if(e.hardwareSupport){let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();a=Oe.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,a=Oe.substitute(a,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    vec4 gVertex = gMatrix * vertexMC;","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], gVertex);","    }"]).result,s=Oe.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=Oe.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s}r.replaceShaderClip(n,i,o)},t.replaceShaderColor=(n,i,o)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(f=f.concat(["varying vec4 vertexColorVSOutput;"]),a=Oe.substitute(a,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,a=Oe.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=Oe.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Oe.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=Oe.substitute(c,"//VTK::Color::Impl",u).result,c=Oe.substitute(c,"//VTK::Color::Dec",f).result,n.Vertex=a,n.Geometry=s,n.Fragment=c}r.replaceShaderColor(n,i,o)},t.replaceShaderPositionVC=(n,i,o)=>{if(e.hardwareSupport){let a=n.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=Oe.substitute(a,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,a=Oe.substitute(a,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(a=Oe.substitute(a,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,a=Oe.substitute(a,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),n.Vertex=a}r.replaceShaderPositionVC(n,i,o)},t.replaceShaderPicking=(n,i,o)=>{if(e.hardwareSupport){let a=n.Fragment,s=n.Vertex;s=Oe.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=Oe.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,n.Vertex=s,a=Oe.substitute(a,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,a=Oe.substitute(a,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,n.Fragment=a}else r.replaceShaderPicking(n,i,o)},t.updateGlyphShaderParameters=(n,i,o,a,s,c,l,f)=>{const u=o.getProgram();if(n){const d=e.normalMatrix,h=c,g=l*9,p=e.tmpMat3,m=d[0],w=d[1],v=d[2],y=d[3],C=d[4],x=d[5],T=d[6],S=d[7],_=d[8],E=h[g],D=h[g+1],b=h[g+2],I=h[g+3],O=h[g+4],M=h[g+5],R=h[g+6],A=h[g+7],B=h[g+8];p[0]=E*m+D*y+b*T,p[1]=E*w+D*C+b*S,p[2]=E*v+D*x+b*_,p[3]=I*m+O*y+M*T,p[4]=I*w+O*C+M*S,p[5]=I*v+O*x+M*_,p[6]=R*m+A*y+B*T,p[7]=R*w+A*C+B*S,p[8]=R*v+A*x+B*_,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),a){const d=a.getData();e.tmpColor[0]=d[l*4]/255,e.tmpColor[1]=d[l*4+1]/255,e.tmpColor[2]=d[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}f&&u.setUniform3fArray("mapperIndex",f.getPropColorValue())},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation(),a=e.context,s=i.getProperty().getEdgeVisibility()&&o===gX.SURFACE,c=e.openGLCamera.getKeyMatrices(n),l=e.openGLActor.getKeyMatrices();Uu(e.normalMatrix,c.normalMatrix,l.normalMatrix),Wt(e.mcpcMatrix,c.wcpc,l.mcwc),Wt(e.mcvcMatrix,c.wcvc,l.mcwc);const f=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),d=e.renderable.getColorArray(),h=f.length/16;let g=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===pX.COMPOSITE_INDEX_PASS&&(g=!0);for(let p=e.primTypes.Start;p<e.primTypes.End;p++){const m=e.primitives[p].getCABO();if(m.getElementCount()){e.drawingEdges=s&&(p===e.primTypes.TrisEdges||p===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[p],e.primitives[p].updateShaders(n,i,t);const w=e.primitives[p].getProgram(),v=e.primitives[p].getOpenGLMode(o),y=w.isUniformUsed("normalMatrix"),C=w.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(v,0,m.getElementCount(),h):a.drawArraysInstanced(v,0,m.getElementCount(),h);else for(let x=0;x<h;++x)g&&e._openGLRenderer.getSelector().renderCompositeIndex(x),t.updateGlyphShaderParameters(y,C,e.primitives[p],d,f,u,x,g?e._openGLRenderer.getSelector():null),a.drawArrays(v,0,m.getElementCount())}}},t.setMapperShaderParameters=(n,i,o)=>{if(n.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){n.getProgram().isAttributeUsed("gMatrix")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||sd("Error setting gMatrix in shader VAO."):n.getVAO().removeAttributeArray("gMatrix"),n.getProgram().isAttributeUsed("gNormal")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||sd("Error setting gNormal in shader VAO."):n.getVAO().removeAttributeArray("gNormal"),n.getProgram().isAttributeUsed("gColor")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||sd("Error setting gColor in shader VAO."):n.getVAO().removeAttributeArray("gColor"),n.getProgram().isAttributeUsed("mapperIndexVS")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||sd("Error setting mapperIndexVS in shader VAO."):n.getVAO().removeAttributeArray("mapperIndexVS"),r.setMapperShaderParameters(n,i,o),n.getAttributeUpdateTime().modified();return}r.setMapperShaderParameters(n,i,o)},t.getNeedToRebuildBufferObjects=(n,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:r.getNeedToRebuildBufferObjects(n,i)),t.getNeedToRebuildShaders=(n,i,o)=>!!(r.getNeedToRebuildShaders(n,i,o)||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(n,i)=>{const o=e.renderable.getMatrixArray(),a=e.renderable.getInputData(0).getPoints(),{useShiftAndScale:s,coordShift:c,coordScale:l}=CC(a);if(e.hardwareSupport){const f=e.renderable.getNormalArray(),u=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=gc.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=gc.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=gc.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=gc.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),s){const d=o.buffer;for(let h=0;h<o.byteLength;h+=yX){const g=new Float32Array(d,h,wX);CX(g,c,l)}}if(e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(o,ep.ARRAY_BUFFER),e.normalBuffer.upload(f,ep.ARRAY_BUFFER),u?e.colorBuffer.upload(u.getData(),ep.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const d=o.length/16,h=new Uint8Array(4*d);for(let g=0;g<d;++g){let p=g+1;const m=g*4;h[m]=p%256,p-=h[m],p/=256,h[m+1]=p%256,p-=h[m+1],p/=256,h[m+2]=p%256,h[m+3]=255}e.pickBuffer.upload(h,ep.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}if(r.buildBufferObjects(n,i),s)for(let f=os.Start;f<os.End;f++)e.primitives[f].getCABO().setCoordShiftAndScale(c,l)}}const TX={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function SX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TX,r),t2.extend(t,e,r),e.tmpMat3=Ao(new Float64Array(9)),e.normalMatrix=Ao(new Float64Array(9)),e.mcpcMatrix=_t(new Float64Array(16)),e.mcvcMatrix=_t(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},Zn(e.glyphBOBuildTime,{mtime:0}),xX(t,e)}const RI=On(SX,"vtkOpenGLGlyph3DMapper");var _X={newInstance:RI};Vr("vtkGlyph3DMapper",RI);const{vtkErrorMacro:XS}=_i;function EX(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=r=>{if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=(r,n)=>{if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const o=e._openGLRenderer.getRenderable(),a=e.openGLCamera.getKeyMatrices(o),s=new Float64Array(16);if(gr(s,a.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=o.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const n=new Float32Array(12);for(let s=0;s<4;s++)n[s*3]=s%2*2-1,n[s*3+1]=s>1?1:-1,n[s*3+2]=1;const i=Tt.newInstance({numberOfComponents:3,values:n});i.setName("points");const o=new Uint16Array(8);o[0]=3,o[1]=0,o[2]=1,o[3]=3,o[4]=3,o[5]=0,o[6]=3,o[7]=2;const a=Tt.newInstance({numberOfComponents:1,values:o});e.tris.getCABO().createVBO(a,"polys",li.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||XS("Error setting vertexMC in shader VAO."));const r=e.renderable.getTextures();r.length||XS("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==r[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(r[0]))}}const bX={context:null};function DX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bX,r),Yn.extend(t,e,r),e.openGLTexture=Kn.newInstance(),e.tris=Fa.newInstance(),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Ao(new Float64Array(9)),mcwc:_t(new Float64Array(16))},Er(t,e,["context"]),Wi(t,e,["activeTextures"]),EX(t,e)}const AI=On(DX);var IX={newInstance:AI};Vr("vtkSkybox",AI);var MX=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:OX}=_i;function PX(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const r={...t};t.getShaderTemplate=(n,i,o)=>{n.Vertex=MX,n.Fragment=cg,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Oe.substitute(a,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Oe.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=Oe.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Oe.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Oe.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=Oe.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Oe.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,r.replaceShaderValues(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{if(n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&n.getProgram().isAttributeUsed("offsetMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"offsetMC",12,n.getCABO().getStride(),e.context.FLOAT,2,!1)||OX("Error setting 'offsetMC' in shader VAO.")),n.getProgram().isUniformUsed("invertedDepth")&&n.getProgram().setUniformf("invertedDepth",e.invert?-1:1),n.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?n.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):n.getProgram().setUniformf("scaleFactor",1)}r.setMapperShaderParameters(n,i,o)},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);a.isUniformUsed("VCPCMatrix")&&a.setUniformMatrix("VCPCMatrix",c.vcpc);const l=new Float64Array(16);if(a.isUniformUsed("MCVCMatrix"))if(o.getIsIdentity())sr(l,c.wcvc),n.getCABO().getCoordShiftAndScaleEnabled()&&Wt(l,l,n.getCABO().getInverseShiftAndScaleMatrix()),a.setUniformMatrix("MCVCMatrix",l);else{const f=e.openGLActor.getKeyMatrices();Wt(l,c.wcvc,f.mcwc),n.getCABO().getCoordShiftAndScaleEnabled()&&Wt(l,l,n.getCABO().getInverseShiftAndScaleMatrix()),a.setUniformMatrix("MCVCMatrix",l)}a.isUniformUsed("cameraParallel")&&n.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(n,i)=>e.context.TRIANGLES,t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=o.getPointData(),l=o.getPoints(),f=l.getNumberOfPoints(),u=l.getData(),d=5;let h=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(h=c.getArray(e.renderable.getScaleArray()).getData());let g=null,p=0,m=null;a?(p=a.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),g=a.getData(),m=new Uint8Array(3*f*4),s.getColorBO()||s.setColorBO(gc.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(p);const w=new Float32Array(d*f*3);s.setStride(d*4);const v=Math.cos(wr(30));let y=0,C=0;const{useShiftAndScale:x,coordShift:T,coordScale:S}=CC(l);x&&s.setCoordShiftAndScale(T,S);let _=0,E=0;for(let D=0;D<f;++D){let b=e.renderable.getRadius();h&&(b=h[D]),y=D*3;const I=(u[y++]-T[0])*S[0],O=(u[y++]-T[1])*S[1],M=(u[y++]-T[2])*S[2];w[_++]=I,w[_++]=O,w[_++]=M,w[_++]=-2*b*v,w[_++]=-b,g&&(C=D*p,m[E++]=g[C],m[E++]=g[C+1],m[E++]=g[C+2],m[E++]=g[C+3]),w[_++]=I,w[_++]=O,w[_++]=M,w[_++]=2*b*v,w[_++]=-b,g&&(m[E++]=g[C],m[E++]=g[C+1],m[E++]=g[C+2],m[E++]=g[C+3]),w[_++]=I,w[_++]=O,w[_++]=M,w[_++]=0,w[_++]=2*b,g&&(m[E++]=g[C],m[E++]=g[C+1],m[E++]=g[C+2],m[E++]=g[C+3])}s.setElementCount(_/d),s.upload(w,mc.ARRAY_BUFFER),a&&s.getColorBO().upload(m,mc.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const RX={};function AX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RX,r),t2.extend(t,e,r),PX(t,e)}const LI=On(AX,"vtkOpenGLSphereMapper");var LX={newInstance:LI};Vr("vtkSphereMapper",LI);var NX=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:tp}=_i;function VX(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const r={...t};t.getShaderTemplate=(n,i,o)=>{n.Vertex=NX,n.Fragment=cg,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Oe.substitute(a,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Oe.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=Oe.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Oe.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Oe.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=Oe.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Oe.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,r.replaceShaderValues(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("orientMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"orientMC",12,n.getCABO().getStride(),e.context.FLOAT,3,!1)||tp("Error setting 'orientMC' in shader VAO.")),n.getProgram().isAttributeUsed("offsetMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"offsetMC",0,n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||tp("Error setting 'offsetMC' in shader VAO.")),n.getProgram().isAttributeUsed("radiusMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"radiusMC",24,n.getCABO().getStride(),e.context.FLOAT,1,!1)||tp("Error setting 'radiusMC' in shader VAO."))),r.setMapperShaderParameters(n,i,o)},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(a.isUniformUsed("VCPCMatrix")&&a.setUniformMatrix("VCPCMatrix",c.vcpc),o.getIsIdentity())a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",c.wcvc),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(a.isUniformUsed("MCVCMatrix")){const f=new Float64Array(16);Wt(f,c.wcvc,l.mcwc),a.setUniformMatrix("MCVCMatrix",f)}if(a.isUniformUsed("normalMatrix")){const f=new Float64Array(9);Uu(f,c.normalMatrix,l.normalMatrix),a.setUniformMatrix3x3("normalMatrix",f)}}a.isUniformUsed("cameraParallel")&&n.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(n,i)=>e.context.TRIANGLES,t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=o.getPointData(),l=o.getPoints(),f=l.getNumberOfPoints(),u=l.getData();let d=3;d+=4;let h=null,g=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(gc.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),a&&(g=a.getNumberOfComponents(),s.setColorOffset(4),h=a.getData(),s.setColorBOStride(8)),s.setColorComponents(g),s.setStride(d*4);const p=new Float32Array(d*f*12),m=new Uint8Array(12*f*(h?8:4));let w=null,v=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(w=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?v=c.getArray(e.renderable.getOrientationArray()).getData():tp([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const y=[0,1,3,0,3,2,2,3,5,2,5,4];let C=0,x=0,T=0,S=0;for(let _=0;_<f;++_){let E=e.renderable.getLength(),D=e.renderable.getRadius();w&&(E=w[_*2],D=w[_*2+1]);for(let b=0;b<y.length;++b)C=_*3,p[T++]=u[C++],p[T++]=u[C++],p[T++]=u[C++],C=_*3,p[T++]=v[C++]*E,p[T++]=v[C++]*E,p[T++]=v[C++]*E,p[T++]=D,m[S++]=255*(y[b]%2),m[S++]=y[b]>=4?255:0,m[S++]=y[b]>=2?255:0,m[S++]=255,x=_*g,h&&(m[S++]=h[x],m[S++]=h[x+1],m[S++]=h[x+2],m[S++]=h[x+3])}s.setElementCount(T/d),s.upload(p,mc.ARRAY_BUFFER),s.getColorBO().upload(m,mc.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const kX={};function FX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kX,r),t2.extend(t,e,r),VX(t,e)}const NI=On(FX,"vtkOpenGLStickMapper");var UX={newInstance:NI};Vr("vtkStickMapper",NI);function BX(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper");const r=new Map;function n(a,s){if(!s)return;const l=(r.get(s)??0)-1;l<=0?(a.unregisterGraphicsResourceUser(s,t),r.delete(s)):r.set(s,l)}function i(a,s){if(!s)return;const c=r.get(s)??0,l=c+1;r.set(s,l),c<=0&&a.registerGraphicsResourceUser(s,t)}function o(a,s,c){s!==c&&(n(a,s),i(a,c))}t.renderPiece=(a,s)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const c=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let f=0;f<c;++f){const u=e.renderable.getInputData(f);u&&!u.isDeleted()&&e.currentValidInputs.push({imageData:u,inputIndex:f})}let l=0;if(e.currentValidInputs.length>0){const f=s.getProperties(),u=e.currentValidInputs[0],d=u.imageData,h=f[u.inputIndex];h.getShade()&&e.renderable.getBlendMode()===Fd.COMPOSITE_BLEND&&a.getLights().forEach(w=>{w.getSwitch()>0&&l++});const g=e.currentValidInputs.length,p=g>1,{numberOfComponents:m}=d.get("numberOfComponents");e.numberOfComponents=p?g:m,e.numberOfComponents>1?e.useIndependentComponents=h.getIndependentComponents():e.useIndependentComponents=!1}l!==e.numberOfLights&&(e.numberOfLights=l,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(a,s),t.renderPieceDraw(a,s),t.renderPieceFinish(a,s))},t.buildBufferObjects=(a,s)=>{if(!e.jitterTexture.getHandle()){const I=new Float32Array(1024);for(let O=0;O<1024;++O)I[O]=Math.random();e.jitterTexture.setMinificationFilter(Mt.NEAREST),e.jitterTexture.setMagnificationFilter(Mt.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:Qt.FLOAT,data:I})}const c=s.getProperties(),l=e.currentValidInputs[0],f=c[l.inputIndex],u=e.numberOfComponents,d=e.useIndependentComponents,h=d?u:1,g=[];for(let I=0;I<h;++I)g.push(f.getScalarOpacity(I));const p=xs(g,d,h),m=f.getScalarOpacity(),w=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!w?.oglObject?.getHandle()||w.hash!==p){const I=Kn.newInstance();I.setOpenGLRenderWindow(e._openGLRenderWindow);let O=e.renderable.getOpacityTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*2*h,R=new Float32Array(M),A=new Float32Array(O);for(let B=0;B<h;++B){const k=f.getScalarOpacity(B),L=t.getCurrentSampleDistance(a)/f.getScalarOpacityUnitDistance(B),F=k.getRange();k.getTable(F[0],F[1],O,A,1);for(let j=0;j<O;++j)R[B*O*2+j]=1-(1-A[j])**L,R[B*O*2+j+O]=R[B*O*2+j]}if(I.resetFormatAndType(),I.setMinificationFilter(Mt.LINEAR),I.setMagnificationFilter(Mt.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))I.create2DFromRaw({width:O,height:2*h,numComps:1,dataType:Qt.FLOAT,data:R});else{const B=new Uint8ClampedArray(M);for(let k=0;k<M;++k)B[k]=255*R[k];I.create2DFromRaw({width:O,height:2*h,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:B})}m&&e._openGLRenderWindow.setGraphicsResourceForObject(m,I,p),e.opacityTexture=I}else e.opacityTexture=w.oglObject;o(e._openGLRenderWindow,e._opacityTextureCore,m),e._opacityTextureCore=m;const y=[];for(let I=0;I<h;++I)y.push(f.getRGBTransferFunction(I));const C=xs(y,d,h),x=f.getRGBTransferFunction(),T=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!T?.oglObject?.getHandle()||T?.hash!==C){const I=Kn.newInstance();I.setOpenGLRenderWindow(e._openGLRenderWindow);let O=e.renderable.getColorTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*2*h*3,R=new Uint8ClampedArray(M),A=new Float32Array(O*3);for(let B=0;B<h;++B){const k=f.getRGBTransferFunction(B),L=k.getRange();k.getTable(L[0],L[1],O,A,1);for(let F=0;F<O*3;++F)R[B*O*6+F]=255*A[F],R[B*O*6+F+O*3]=255*A[F]}I.resetFormatAndType(),I.setMinificationFilter(Mt.LINEAR),I.setMagnificationFilter(Mt.LINEAR),I.create2DFromRaw({width:O,height:2*h,numComps:3,dataType:Qt.UNSIGNED_CHAR,data:R}),e._openGLRenderWindow.setGraphicsResourceForObject(x,I,C),e.colorTexture=I}else e.colorTexture=T.oglObject;o(e._openGLRenderWindow,e._colorTextureCore,x),e._colorTextureCore=x,e.currentValidInputs.forEach(({imageData:I,inputIndex:O},M)=>{if(e.scalarTextures||(e.scalarTextures=[]),!e.scalarTextures[M]){console.warn(`ScalarTexture for component ${M} not initialized, skipping.`);return}const R=e.scalarTextures[M],A=`${I.getMTime()}-${R.getMTime()}`;if(e.scalarTextureStrings||(e.scalarTextureStrings=[]),e.scalarTextureStrings[M]!==A){const B=I.getDimensions();R.setOpenGLRenderWindow(e._openGLRenderWindow),R.enableUseHalfFloat(!1);const k=R.getTextureParameters(),L=I.get("dataType").dataType;let F=!0;if(k?.dataType===L&&k?.width===B[0]&&k?.height===B[1]&&k?.depth===B[2]&&(F=!1),F){const j=e.context.getExtension("EXT_texture_norm16");R.setOglNorm16Ext(ON()?j:null),R.resetFormatAndType(),R.setTextureParameters({width:B[0],height:B[1],depth:B[2],numberOfComponents:h,dataType:L}),R.create3DFromRaw({width:B[0],height:B[1],depth:B[2],numComps:h,dataType:L,data:null}),R.update3DFromRaw()}else R.deactivate(),R.update3DFromRaw();e.scalarTextureStrings[M]=A}e._scalarTexturesCore||(e._scalarTexturesCore=[])});const _=f.getLabelOutlineThickness(),E=e._openGLRenderWindow.getGraphicsResourceForObject(_),D=_.join("-");if(!E?.oglObject?.getHandle()||E?.hash!==D){const I=Kn.newInstance();I.setOpenGLRenderWindow(e._openGLRenderWindow);let O=e.renderable.getLabelOutlineTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=1,R=O*M,A=new Uint8Array(R);for(let B=0;B<O;++B){const k=typeof _[B]<"u"?_[B]:_[0];A[B]=k}I.resetFormatAndType(),I.setMinificationFilter(Mt.NEAREST),I.setMagnificationFilter(Mt.NEAREST),I.create2DFromRaw({width:O,height:M,numComps:1,dataType:Qt.UNSIGNED_CHAR,data:A}),_&&e._openGLRenderWindow.setGraphicsResourceForObject(_,I,D),e.labelOutlineThicknessTexture=I}else e.labelOutlineThicknessTexture=E.oglObject;if(o(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,_),e._labelOutlineThicknessTextureCore=_,!e.tris.getCABO().getElementCount()){const I=new Float32Array(12);for(let A=0;A<4;A++)I[A*3]=A%2*2-1,I[A*3+1]=A>1?1:-1,I[A*3+2]=-1;const O=new Uint16Array(8);O[0]=3,O[1]=0,O[2]=1,O[3]=3,O[4]=3,O[5]=0,O[6]=3,O[7]=2;const M=Tt.newInstance({numberOfComponents:3,values:I});M.setName("points");const R=Tt.newInstance({numberOfComponents:1,values:O});e.tris.getCABO().createVBO(R,"polys",li.SURFACE,{points:M,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(a,s)=>{if(e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<s.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<s.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.colorTexture?.getMTime()||e.VBOBuildTime.getMTime()<e.labelOutlineThicknessTexture?.getMTime()||!e.colorTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle())return!0;if(e.scalarTextures&&e.scalarTextures.length>0)for(let c=0;c<e.scalarTextures.length;c++){const l=e.scalarTextures[c];if(l&&(e.VBOBuildTime.getMTime()<l.getMTime()||!l.getHandle()))return!0}if(e.currentValidInputs&&e.currentValidInputs.length>0)for(let c=0;c<e.currentValidInputs.length;c++){const l=e.currentValidInputs[c];if(l&&l.imageData&&e.VBOBuildTime.getMTime()<l.imageData.getMTime())return!0}return!1}}const GX={};function WX(t,e,r={}){Object.assign(e,GX,r),k6.extend(t,e,r),r.scalarTexture?e.scalarTextures=[r.scalarTexture]:e.scalarTextures=[],e.scalarTextureStrings=[],e._scalarTexturesCore=[],e.previousState={},BX(t,e)}const $X=K.newInstance(WX,"vtkStreamingOpenGLVolumeMapper"),zX={newInstance:$X},VI=Object.create(null);function ai(t,e){VI[t]=e}function jX(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,i=r.getClassName(n++),o=!1;const a=Object.keys(e.overrides);for(;i&&!o;)a.includes(i)?o=!0:i=r.getClassName(n++);if(!o)return null;const s=e.getModelInitialValues(r),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=VI,e.getModelInitialValues=r=>{const n={};return r.getClassName()==="vtkSharedVolumeMapper"&&(n.scalarTexture=r.getScalarTexture()),n}}const HX={};function kI(t,e,r={}){Object.assign(e,HX,r),yC.extend(t,e,r),jX(t,e),ai("vtkActor",VK.newInstance),ai("vtkActor2D",BK.newInstance),ai("vtkCamera",CB.newInstance),ai("vtkGlyph3DMapper",_X.newInstance),ai("vtkImageMapper",B$.newInstance),ai("vtkImageCPRMapper",j$.newInstance),ai("vtkImageSlice",q$.newInstance),ai("vtkMapper",t2.newInstance),ai("vtkPixelSpaceCallbackMapper",hz.newInstance),ai("vtkRenderer",EB.newInstance),ai("vtkSkybox",IX.newInstance),ai("vtkSphereMapper",LX.newInstance),ai("vtkStickMapper",UX.newInstance),ai("vtkTexture",Kn.newInstance),ai("vtkVolume",Q$.newInstance),ai("vtkVolumeMapper",k6.newInstance),ai("vtkSharedVolumeMapper",zX.newInstance)}const KX=K.newInstance(kI,"vtkStreamingOpenGLViewNodeFactory"),XX={newInstance:KX,extend:kI};function qX(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function FI(t,e,r={}){Object.assign(e,r),RK.extend(t,e,r),e.myFactory=XX.newInstance(),ai("vtkRenderWindow",UI),qX(t,e)}const UI=K.newInstance(FI,"vtkStreamingOpenGLRenderWindow"),YX={newInstance:UI,extend:FI},{vtkDebugMacro:np}=K;function JX(t,e){e.classHierarchy.push("vtkCamera");const r=new Float64Array(3),n=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),o=_t(new Float64Array(16)),a=_t(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),f=_t(new Float64Array(16)),u=_t(new Float64Array(16)),d=new Float64Array(3),h=new Float64Array(3);function g(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,m,w)=>{p===e.position[0]&&m===e.position[1]&&w===e.position[2]||(e.position[0]=p,e.position[1]=m,e.position[2]=w,t.computeDistance(),t.modified())},t.setFocalPoint=(p,m,w)=>{p===e.focalPoint[0]&&m===e.focalPoint[1]&&w===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=m,e.focalPoint[2]=w,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,np("Distance is set to minimum."));const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],m=e.focalPoint[1]-e.position[1],w=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+m*m+w*w),e.distance<1e-20){e.distance=1e-20,np("Distance is set to minimum.");const v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=m/e.distance,e.directionOfProjection[2]=w/e.distance,g()},t.dolly=p=>{if(p<=0)return;const m=e.distance/p;t.setPosition(e.focalPoint[0]-m*e.directionOfProjection[0],e.focalPoint[1]-m*e.directionOfProjection[1],e.focalPoint[2]-m*e.directionOfProjection[2])},t.roll=p=>{const m=e.position,w=e.focalPoint,v=e.viewUp,y=new Float64Array([v[0],v[1],v[2],0]);_t(f);const C=new Float64Array([w[0]-m[0],w[1]-m[1],w[2]-m[2]]);ci(f,f,wr(p),C),lc(y,y,f),e.viewUp[0]=y[0],e.viewUp[1]=y[1],e.viewUp[2]=y[2],t.modified()},t.azimuth=p=>{const m=e.focalPoint;_t(u),Gn(u,u,m),ci(u,u,wr(p),e.viewUp),Gn(u,u,[-m[0],-m[1],-m[2]]),Pt(d,e.position,u),t.setPosition(d[0],d[1],d[2])},t.yaw=p=>{const m=e.position;_t(u),Gn(u,u,m),ci(u,u,wr(p),e.viewUp),Gn(u,u,[-m[0],-m[1],-m[2]]),Pt(h,e.focalPoint,u),t.setFocalPoint(h[0],h[1],h[2])},t.elevation=p=>{const m=e.focalPoint,w=t.getViewMatrix(),v=[-w[0],-w[1],-w[2]];_t(u),Gn(u,u,m),ci(u,u,wr(p),v),Gn(u,u,[-m[0],-m[1],-m[2]]),Pt(d,e.position,u),t.setPosition(d[0],d[1],d[2])},t.pitch=p=>{const m=e.position,w=t.getViewMatrix(),v=[w[0],w[1],w[2]];_t(u),Gn(u,u,m),ci(u,u,wr(p),v),Gn(u,u,[-m[0],-m[1],-m[2]]),Pt(h,e.focalPoint,u),t.setFocalPoint(...h)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,m,w)=>{const v=[p,m,w];u0(e.position,v,e.position),u0(e.focalPoint,v,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const m=[...e.viewUp,1],w=[],v=[],y=[];m[0]+=e.position[0],m[1]+=e.position[1],m[2]+=e.position[2],lc(w,[...e.position,1],p),lc(v,[...e.focalPoint,1],p),lc(y,m,p),y[0]-=w[0],y[1]-=w[1],y[2]-=w[2],t.setPosition(...w.slice(0,3)),t.setFocalPoint(...v.slice(0,3)),t.setViewUp(...y.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let m=p;m<1e-20&&(m=1e-20,np("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+m)},t.setThicknessFromFocalPoint=p=>{let m=p;m<1e-20&&(m=1e-20,np("Thickness is set to minimum.")),t.setClippingRange(e.distance-m/2,e.distance+m/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,m)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Float64Array(24);const w=[[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1],[0,0,1,1],[0,0,-1,1]],v=t.getCompositeProjectionMatrix(p,-1,1);for(let y=0;y<6;y++)lc(w[y],w[y],v),jV(w[y]),m[4*y+0]=w[y][0],m[4*y+1]=w[y][1],m[4*y+2]=w[y][2],m[4*y+3]=w[y][3];return m},t.getCameraLightTransformMatrix=p=>(sr(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{sr(o,t.getViewMatrix()),gr(o,o),W1(a,[e.distance,e.distance,e.distance]),Wt(o,o,a),_t(e.cameraLightTransform),Gn(e.cameraLightTransform,o,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const m=rS(p[0],p[1],p[2],p[3]),w=Tc(),v=rS(0,0,1,0);return uU(w,m),nS(v,m,v),nS(v,v,w),[v[0],v[1],v[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),gr(p,p)},t.getWorldToPhysicalMatrix=p=>{_t(p);const m=[3];Qi(e.physicalViewNorth,e.physicalViewUp,m),p[0]=m[0],p[1]=m[1],p[2]=m[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],mn(p,p),co(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),ws(p,p,s),Gn(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{gr(o,p),Pt(s,r,o),t.computeDistance();const m=e.distance;t.setPosition(s[0],s[1],s[2]),Pt(c,n,o),qt(c,c,s),At(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),Pt(l,i,o),qt(l,l,s),At(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(m)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(o),Wt(o,p,o),t.computeViewParametersFromViewMatrix(o)},t.setModelTransformMatrix=p=>{e.modelTransformMatrix=p},t.getModelTransformMatrix=()=>e.modelTransformMatrix,t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(sr(o,e.viewMatrix),t.computeViewParametersFromViewMatrix(o),mn(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.modelTransformMatrix?(Wt(o,e.viewMatrix,e.modelTransformMatrix),o):e.viewMatrix;eC(o,e.position,e.focalPoint,e.viewUp),mn(o,o);const p=new Float64Array(16);return e.modelTransformMatrix?Wt(p,o,e.modelTransformMatrix):sr(p,o),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,m,w)=>{const v=new Float64Array(16);if(_t(v),e.projectionMatrix){const x=1/e.physicalScale;return co(s,x,x,x),sr(v,e.projectionMatrix),ws(v,v,s),mn(v,v),v}_t(o);const y=e.clippingRange[1]-e.clippingRange[0],C=[e.clippingRange[0]+(m+1)*y/2,e.clippingRange[0]+(w+1)*y/2];if(e.parallelProjection){const x=e.parallelScale*p,T=e.parallelScale,S=(e.windowCenter[0]-1)*x,_=(e.windowCenter[0]+1)*x,E=(e.windowCenter[1]-1)*T,D=(e.windowCenter[1]+1)*T;Qw(o,S,_,E,D,C[0],C[1]),mn(o,o)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const x=Math.tan(wr(e.viewAngle)/2);let T,S;e.useHorizontalViewAngle===!0?(T=e.clippingRange[0]*x,S=e.clippingRange[0]*x/p):(T=e.clippingRange[0]*x*p,S=e.clippingRange[0]*x);const _=(e.windowCenter[0]-1)*T,E=(e.windowCenter[0]+1)*T,D=(e.windowCenter[1]-1)*S,b=(e.windowCenter[1]+1)*S,I=C[0],O=C[1];o[0]=2*I/(E-_),o[5]=2*I/(b-D),o[2]=(_+E)/(E-_),o[6]=(D+b)/(b-D),o[10]=-(I+O)/(O-I),o[14]=-1,o[11]=-2*I*O/(O-I),o[15]=0}}return sr(v,o),v},t.getCompositeProjectionMatrix=(p,m,w)=>{const v=t.getViewMatrix(),y=t.getProjectionMatrix(p,m,w);return Wt(y,v,y),y},t.setDirectionOfProjection=(p,m,w)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===m&&e.directionOfProjection[2]===w)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=m,e.directionOfProjection[2]=w;const v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,g()},t.setDeviceAngles=(p,m,w,v)=>{const y=[3];Qi(e.physicalViewNorth,e.physicalViewUp,y);const C=_t(new Float64Array(16));ci(C,C,wr(p),e.physicalViewUp),ci(C,C,wr(m),y),ci(C,C,wr(w),e.physicalViewNorth),ci(C,C,wr(-v),e.physicalViewUp);const x=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),T=new Float64Array(e.physicalViewNorth);Pt(x,x,C),Pt(T,T,C),t.setDirectionOfProjection(x[0],x[1],x[2]),t.setViewUp(T[0],T[1],T[2]),t.modified()},t.setOrientationWXYZ=(p,m,w,v)=>{const y=_t(new Float64Array(16));if(p!==0&&(m!==0||w!==0||v!==0)){const T=wr(p),S=Tc();og(S,[m,w,v],T),Yf(y,S)}const C=new Float64Array(3);Pt(C,[0,0,-1],y);const x=new Float64Array(3);Pt(x,[0,1,0],y),t.setDirectionOfProjection(...C),t.setViewUp(...x),t.modified()},t.computeClippingRange=p=>{let m=null,w=null;m=e.viewPlaneNormal,w=e.position;const v=-m[0],y=-m[1],C=-m[2],x=-(v*w[0]+y*w[1]+C*w[2]),T=[v*p[0]+y*p[2]+C*p[4]+x,1e-18];for(let S=0;S<2;S++)for(let _=0;_<2;_++)for(let E=0;E<2;E++){const D=v*p[E]+y*p[2+_]+C*p[4+S]+x;T[0]=D<T[0]?D:T[0],T[1]=D>T[1]?D:T[1]}return T}}const ZX={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,modelTransformMatrix:null,cameraLightTransform:Ti(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function BI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZX,r),K.obj(t,e),K.get(t,e,["distance"]),K.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),K.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),K.setGetArray(t,e,["clippingRange","windowCenter"],2),K.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),JX(t,e)}const QX=K.newInstance(BI,"vtkCamera");var OC={newInstance:QX,extend:BI};function eq(t,e){e.classHierarchy.push("vtkLight");const r=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?Pt(r,e.position,e.transformMatrix):co(r,e.position[0],e.position[1],e.position[2]),r),t.getTransformedFocalPoint=()=>(e.transformMatrix?Pt(r,e.focalPoint,e.transformMatrix):co(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r),t.getDirection=()=>(e.directionMTime<e.mtime&&(an(e.direction,e.focalPoint,e.position),Ro(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=n=>{const i=new Float64Array(3);an(i,e.position,n),e.focalPoint=i},t.setDirectionAngle=(n,i)=>{const o=wr(n),a=wr(i);t.setPosition(Math.cos(o)*Math.sin(a),Math.sin(o),Math.cos(o)*Math.cos(a)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const tq={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function nq(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tq,r),K.obj(t,e),K.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),K.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),eq(t,e)}const rq=K.newInstance(nq,"vtkLight");var iq={newInstance:rq};const{vtkErrorMacro:nm}=K;function oq(t){return()=>nm(`vtkViewport::${t} - NOT IMPLEMENTED`)}function aq(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=n=>e.props.includes(n),t.addViewProp=n=>{n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=n=>{const i=e.props.filter(o=>o!==n);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(n);const o=n.getNestedProps();if(o&&o.length)for(let a=0;a<o.length;a++)r(o[a],i);return i}t.getViewPropsWithNestedProps=()=>{let n=[];const i=t.getActors2D();i.sort((a,s)=>a.getLayerNumber()-s.getLayerNumber());const o=e.props.filter(a=>!i.includes(a));for(let a=0;a<o.length;a++)r(o[a],n);return n=n.concat(i),n},t.addActor2D=t.addViewProp,t.removeActor2D=n=>{t.removeViewProp(n)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(n=>{e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D),t.displayToView=()=>nm("call displayToView on your view instead"),t.viewToDisplay=()=>nm("callviewtodisplay on your view instead"),t.getSize=()=>nm("call getSize on your View instead"),t.normalizedDisplayToProjection=(n,i,o)=>{const a=t.normalizedDisplayToNormalizedViewport(n,i,o);return t.normalizedViewportToProjection(a[0],a[1],a[2])},t.normalizedDisplayToNormalizedViewport=(n,i,o)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/a[0],(i-e.viewport[1])/a[1],o]},t.normalizedViewportToProjection=(n,i,o)=>[n*2-1,i*2-1,o*2-1],t.projectionToNormalizedDisplay=(n,i,o)=>{const a=t.projectionToNormalizedViewport(n,i,o);return t.normalizedViewportToNormalizedDisplay(a[0],a[1],a[2])},t.normalizedViewportToNormalizedDisplay=(n,i,o)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*a[0]+e.viewport[0],i*a[1]+e.viewport[1],o]},t.projectionToNormalizedViewport=(n,i,o)=>[(n+1)*.5,(i+1)*.5,(o+1)*.5],t.PickPropFrom=oq("PickPropFrom")}const sq={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function GI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sq,r),K.obj(t,e),K.event(t,e,"event"),K.setGetArray(t,e,["viewport"],4),K.setGetArray(t,e,["background","background2"],3),aq(t,e)}const cq=K.newInstance(GI,"vtkViewport");var lq={newInstance:cq,extend:GI};const{vtkDebugMacro:cd,vtkErrorMacro:cl,vtkWarningMacro:uq}=_i;function qS(t){return()=>cl(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function fq(t,e){e.classHierarchy.push("vtkRenderer");const r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(cd("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const o=t.getActiveCameraAndResetIfCreated();e.lights.forEach(a=>{a.lightTypeIsSceneLight()||(a.lightTypeIsHeadLight()?(a.setPositionFrom(o.getPositionByReference()),a.setFocalPointFrom(o.getFocalPointByReference()),a.modified(o.getMTime())):a.lightTypeIsCameraLight()?a.setTransformMatrix(o.getCameraLightTransformMatrix(Ti())):cl("light has unknown light type",a.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=qS("allocateTime"),t.updateGeometry=qS("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=o=>{cd(t.getClassName(),t,"setting Layer to ",o),e.layer!==o&&(e.layer=o,t.modified()),t.setPreserveColorBuffer(!!o)},t.setActiveCamera=o=>e.activeCamera===o?!1:(e.activeCamera=o,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:o}),!0),t.makeCamera=()=>{const o=OC.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:o}),o},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(o=>{e.actors=e.actors.concat(o.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=o=>{e.actors=e.actors.filter(a=>a!==o),t.removeViewProp(o),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(a=>{t.removeViewProp(a)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(o=>{e.volumes=e.volumes.concat(o.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=o=>{e.volumes=e.volumes.filter(a=>a!==o),t.removeViewProp(o),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(a=>{t.removeViewProp(a)}),e.volumes=[],t.modified()},t.hasLight=o=>e.lights.includes(o),t.addLight=o=>{o&&!t.hasLight(o)&&(e.lights.push(o),t.modified())},t.removeLight=o=>{e.lights=e.lights.filter(a=>a!==o),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=o=>{e.lights=o,t.modified()},t.makeLight=iq.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(o,a,s,c)=>{let l=t.normalizedDisplayToProjection(o,a,s);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(o,a,s,c)=>{let l=t.worldToView(o,a,s);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(o,a,s)=>{if(e.activeCamera===null)return cl("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();gr(c,c),mn(c,c);const l=new Float64Array([o,a,s]);return Pt(l,l,c),l},t.projectionToView=(o,a,s,c)=>{if(e.activeCamera===null)return cl("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);gr(l,l),mn(l,l);const f=new Float64Array([o,a,s]);return Pt(f,f,l),f},t.worldToView=(o,a,s)=>{if(e.activeCamera===null)return cl("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();mn(c,c);const l=new Float64Array([o,a,s]);return Pt(l,l,c),l},t.viewToProjection=(o,a,s,c)=>{if(e.activeCamera===null)return cl("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);mn(l,l);const f=new Float64Array([o,a,s]);return Pt(f,f,l),f},t.computeVisiblePropBounds=()=>{e.allBounds[0]=hn.INIT_BOUNDS[0],e.allBounds[1]=hn.INIT_BOUNDS[1],e.allBounds[2]=hn.INIT_BOUNDS[2],e.allBounds[3]=hn.INIT_BOUNDS[3],e.allBounds[4]=hn.INIT_BOUNDS[4],e.allBounds[5]=hn.INIT_BOUNDS[5];let o=!0;t.invokeEvent(r);for(let a=0;a<e.props.length;++a){const s=e.props[a];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&Hp(c)&&(o=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return o&&($w(e.allBounds),cd("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!Hp(a))return cd("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return cl("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(a[0]+a[1])/2,s[1]=(a[2]+a[3])/2,s[2]=(a[4]+a[5])/2;let l=a[1]-a[0],f=a[3]-a[2],u=a[5]-a[4];l*=l,f*=f,u*=u;let d=l+f+u;d=d===0?1:d,d=Math.sqrt(d)*.5;const h=wr(e.activeCamera.getViewAngle()),g=d,p=d/Math.sin(h*.5),m=e.activeCamera.getViewUp();return Math.abs(jt(m,c))>.999&&(uq("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-m[2],m[0],m[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+p*c[0],s[1]+p*c[1],s[2]+p*c[2]),t.resetCameraClippingRange(a),e.activeCamera.setParallelScale(g),e.activeCamera.setPhysicalScale(d),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Hp(a))return cd("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return cl("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(a);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=wr(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(n),!1},t.setRenderWindow=o=>{o!==e._renderWindow&&(e._vtkWindow=o,e._renderWindow=o)},t.visibleActorCount=()=>e.props.filter(o=>o.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let o=e.mtime;const a=e.activeCamera?e.activeCamera.getMTime():0;a>o&&(o=a);const s=e._createdLight?e._createdLight.getMTime():0;return s>o&&(o=s),o},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const dq={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Xu(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function WI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,dq,r),lq.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Wi(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Er(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),O0(t,e,["actors","volumes","lights"]),Ow(t,e,["background"],4,1),tg(t,e,["renderWindow"]),fq(t,e)}const hq=On(WI,"vtkRenderer");var $I={newInstance:hq,extend:WI};const gq={Unknown:0,LeftController:1,RightController:2},pq={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},mq={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},vq={LeftButton:1,MiddleButton:2,RightButton:3};var zI={Device:gq,Input:pq,Axis:mq,MouseButton:vq};const{Device:rp,Input:Cu}=zI,{vtkWarningMacro:ip,vtkErrorMacro:op,normalizeWheel:yq,vtkOnceErrorMacro:wq}=K,wf={ctrlKey:!1,altKey:!1,shiftKey:!1},Ev={"xr-standard":[Cu.Trigger,Cu.Grip,Cu.TrackPad,Cu.Thumbstick,Cu.A,Cu.B]},PC=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function ld(t){t.cancelable&&t.preventDefault()}function ap(t){const e=Object.create(null);return t.forEach(r=>{let{pointerId:n,position:i}=r;e[n]=i}),e}function Cq(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const r={...t},n=new Set,i=new Map;let o=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{op("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>ip("empty event loop");function a(p,m){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,m))}t.getCurrentRenderer=()=>(e.currentRenderer||a(0,0),e.currentRenderer);function s(p){const m=e._view.getCanvas(),w=m.getBoundingClientRect(),v=m.width/w.width,y=m.height/w.height,C={x:v*(p.clientX-w.left),y:y*(w.height-p.clientY+w.top),z:0,movementX:v*p.movementX,movementY:y*p.movementY};return(i.size<=1||!e.currentRenderer)&&a(C.x,C.y),C}const c=e._getScreenEventPositionFor||s;function l(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function f(p){const m=l(p);return{key:p.key,keyCode:p.charCode,...m}}function u(p){return p.pointerType||""}const d=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",ld),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),p.addEventListener("keypress",t.handleKeyPress),p.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.tabIndex=0,p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;r.setContainer(p)&&d()};const h=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,o=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",ld),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel),p.removeEventListener("keypress",t.handleKeyPress),p.removeEventListener("keydown",t.handleKeyDown)),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{h(),r.setContainer(null)},t.handleKeyPress=p=>{const m=f(p);t.keyPressEvent(m)},t.handleKeyDown=p=>{const m=f(p);t.keyDownEvent(m)},t.handleKeyUp=p=>{const m=f(p);t.keyUpEvent(m)},t.handlePointerEnter=p=>{const m={...l(p),position:c(p),deviceType:u(p)};t.pointerEnterEvent(m),m.deviceType==="mouse"&&t.mouseEnterEvent(m)},t.handlePointerLeave=p=>{const m={...l(p),position:c(p),deviceType:u(p)};t.pointerLeaveEvent(m),m.deviceType==="mouse"&&t.mouseLeaveEvent(m)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&ld(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),i.has(p.pointerId)&&ip("[RenderWindowInteractor] duplicate pointerId detected"),i.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(i.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&ld(p),i.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(i.has(p.pointerId))switch(i.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(i.has(p.pointerId)){const m=i.get(p.pointerId);m.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const m={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonPressEvent(m);break;case 1:t.middleButtonPressEvent(m);break;case 2:t.rightButtonPressEvent(m);break;default:op(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>document.exitPointerLock?.(),t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function g(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){op("undefined requester, can not start animating");return}if(n.has(p)){ip("requester is already registered for animating");return}n.add(p),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const m=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,m),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(p)){if(!m){const w=p&&p.getClassName?p.getClassName():p;ip(`${w} did not request an animation`)}return}n.delete(p),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,m,w)=>{p.inputSources.forEach(v=>{const y=v.gripSpace==null?null:m.getPose(v.gripSpace,w),C=v.gripSpace==null?null:m.getPose(v.targetRaySpace,w),x=v.gamepad,T=v.handedness;if(x){x.index in e.lastGamepadValues||(e.lastGamepadValues[x.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let S=0;S<x.buttons.length;++S)S in e.lastGamepadValues[x.index][T].buttons||(e.lastGamepadValues[x.index][T].buttons[S]=!1),e.lastGamepadValues[x.index][T].buttons[S]!==x.buttons[S].pressed&&y!=null&&(t.button3DEvent({gamepad:x,position:y.transform.position,orientation:y.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,pressed:x.buttons[S].pressed,device:v.handedness==="left"?rp.LeftController:rp.RightController,input:Ev[x.mapping]&&Ev[x.mapping][S]?Ev[x.mapping][S]:Cu.Trigger}),e.lastGamepadValues[x.index][T].buttons[S]=x.buttons[S].pressed),e.lastGamepadValues[x.index][T].buttons[S]&&y!=null&&t.move3DEvent({gamepad:x,position:y.transform.position,orientation:y.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,device:v.handedness==="left"?rp.LeftController:rp.RightController})}})},t.handleMouseMove=p=>{const m={...l(p),position:c(p),deviceType:u(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(m):(t.mouseMoveEvent(m),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),g(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{ld(p);const m={...yq(p),...l(p),position:c(p),deviceType:u(p)};e.wheelTimeoutID===0&&(Math.abs(m.spinY)>=.3?o=Math.abs(m.spinY):o=1),m.spinY/=o,e.wheelTimeoutID===0?(t.startMouseWheelEvent(m),t.mouseWheelEvent(m)):(t.mouseWheelEvent(m),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const m={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(m);break;case 1:t.middleButtonReleaseEvent(m);break;case 2:t.rightButtonReleaseEvent(m);break;default:op(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const w=ap(i);if(m.length===2){const v={...l(wf),position:m[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(v)}t.recognizeGesture("TouchStart",w)}else if(m.length===1){const w={...l(wf),position:c(p),deviceType:u(p)};t.leftButtonPressEvent(w)}},t.handleTouchMove=p=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const w=ap(i);t.recognizeGesture("TouchMove",w)}else if(m.length===1){const w={...l(wf),position:m[0].position,deviceType:u(p)};t.mouseMoveEvent(w)}},t.handleTouchEnd=p=>{const m=[...i.values()];if(e.recognizeGestures)if(m.length===0){const w={...l(wf),position:c(p),deviceType:u(p)};t.leftButtonReleaseEvent(w)}else if(m.length===1){const w=ap(i);t.recognizeGesture("TouchEnd",w);const v={...l(wf),position:m[0].position,deviceType:u(p)};t.leftButtonPressEvent(v)}else{const w=ap(i);t.recognizeGesture("TouchMove",w)}else if(m.length===1){const w={...l(wf),position:m[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(w)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>e._view?.getRenderable()?.getRenderersByReference()?.[0],t.findPokedRenderer=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const w=e._view?.getRenderable()?.getRenderers();if(!w||w.length===0)return null;w.sort((T,S)=>T.getLayer()-S.getLayer());let v=null,y=null,C=null,x=w.length;for(;x--;){const T=w[x];if(e._view.isInViewport(p,m,T)&&T.getInteractive()){C=T;break}v===null&&T.getInteractive()&&(v=T),y===null&&e._view.isInViewport(p,m,T)&&(y=T)}return C===null&&(C=v),C===null&&(C=y),C==null&&(C=w[0]),C},t.render=()=>{!t.isAnimating()&&!e.inRender&&g()},PC.forEach(p=>{const m=p.charAt(0).toLowerCase()+p.slice(1);t[`${m}Event`]=w=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){wq(`
          Can not forward events without a current renderer on the interactor.
        `);return}const y={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...w};t[`invoke${p}`](y)}}),t.recognizeGesture=(p,m)=>{if(Object.keys(m).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(m).forEach(D=>{e.startingEventPositions[D]=m[D]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let w=0;const v=[],y=[];Object.keys(m).forEach(D=>{v[w]=m[D],y[w]=e.startingEventPositions[D],w++});const C=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y)),x=Math.sqrt((v[0].x-v[1].x)*(v[0].x-v[1].x)+(v[0].y-v[1].y)*(v[0].y-v[1].y));let T=xm(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),S=xm(Math.atan2(v[1].y-v[0].y,v[1].x-v[0].x)),_=S-T;S=S+180>=360?S-180:S+180,T=T+180>=360?T-180:T+180,Math.abs(S-T)<Math.abs(_)&&(_=S-T);const E=[];if(E[0]=(v[0].x-y[0].x+v[1].x-y[1].x)/2,E[1]=(v[0].y-y[0].y+v[1].y-y[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let D=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);D<15&&(D=15);const b=Math.abs(x-C),I=x*3.1415926*Math.abs(_)/360,O=Math.sqrt(E[0]*E[0]+E[1]*E[1]);if(b>D&&b>I&&b>O){e.currentGesture="Pinch";const M={scale:1,touches:m};t.startPinchEvent(M)}else if(I>D&&I>O){e.currentGesture="Rotate";const M={rotation:0,touches:m};t.startRotateEvent(M)}else if(O>D){e.currentGesture="Pan";const M={translation:[0,0],touches:m};t.startPanEvent(M)}}else{if(e.currentGesture==="Rotate"){const D={rotation:_,touches:m};t.rotateEvent(D)}if(e.currentGesture==="Pinch"){const D={scale:x/C,touches:m};t.pinchEvent(D)}if(e.currentGesture==="Pan"){const D={translation:E,touches:m};t.panEvent(D)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{h();const m=r.setContainer(p??null);return m&&d(),m},t.delete=()=>{for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),r.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const xq={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function jI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xq,r),K.obj(t,e),e._animationExtendedEnd=0,K.event(t,e,"RenderEvent"),PC.forEach(n=>K.event(t,e,n)),K.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),K.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),K.moveToProtected(t,e,["view"]),Cq(t,e)}const Tq=K.newInstance(jI,"vtkRenderWindowInteractor");var Sq={newInstance:Tq,extend:jI,handledEvents:PC,...zI};function _q(t,e){e.classHierarchy.push("vtkActor");const r={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let n=e.properties[0].getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.properties[0]||t.getProperty(),!t.getIsOpaque()),t.makeProperty=cf.newInstance,t.getMTime=()=>{let n=r.getMTime();if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();n=i>n?i:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();n=i>n?i:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),n=i>n?i:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(n,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,i)}}const Eq={mapper:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1};function HI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eq,r),vC.extend(t,e,r),e.boundsMTime={},K.obj(e.boundsMTime),K.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),_q(t,e)}const bq=K.newInstance(HI,"vtkActor");var Lo={newInstance:bq,extend:HI};function Dq(t,e){const r=t.invokeResize;delete t.invokeResize,e.renderWindow=IH.newInstance(),e.rendererMap={},e.openGLRenderWindow=YX.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=Sq.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:n,id:i,background:o})=>{const a=$I.newInstance({viewport:n,background:o||e.background});e.renderWindow.addRenderer(a),e.rendererMap[i]=a},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=n=>{const i=t.getRenderer(n);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[n]},t.getRenderer=n=>e.rendererMap[n],t.getRenderers=()=>{const{rendererMap:n}=e;return Object.keys(n).map(o=>({id:o,renderer:n[o]}))},t.resize=()=>{if(e.container){const{width:n,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(n),Math.floor(i)),r(),e.renderWindow.render()}},t.setContainer=n=>{e.container=n,e.openGLRenderWindow.setContainer(e.container)},t.delete=K.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const Iq={background:[0,0,0],container:null};function KI(t,e,r={}){Object.assign(e,Iq,r),K.obj(t,e),K.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),K.event(t,e,"resize"),Dq(t,e)}const Mq=K.newInstance(KI),XI={newInstance:Mq,extend:KI},{BlendMode:ll}=lb;function Oq(t,e,r,n,i){let o=null;return i?(o=i,o.removeAllPoints()):o=qu.newInstance(),o.addPointLong(-1024,0,1,1),o.addPoint(t,e),o.addPoint(r,n),o}const Pq=["getAnisotropy","getComputeNormalFromOpacity","getFilterMode","getFilterModeAsString","getGlobalIlluminationReach","getIpScalarRange","getIpScalarRangeByReference","getLAOKernelRadius","getLAOKernelSize","getLocalAmbientOcclusion","getPreferSizeOverAccuracy","getVolumetricScatteringBlending","setAnisotropy","setAverageIPScalarRange","setComputeNormalFromOpacity","setFilterMode","setFilterModeToNormalized","setFilterModeToOff","setFilterModeToRaw","setGlobalIlluminationReach","setIpScalarRange","setIpScalarRangeFrom","setLAOKernelRadius","setLAOKernelSize","setLocalAmbientOcclusion","setPreferSizeOverAccuracy","setVolumetricScatteringBlending"],Rq={createRadonTransferFunction:Oq};function Aq(t,e){e.classHierarchy.push("vtkVolumeMapper");const r={...t};t.getBounds=()=>(e.static||t.update(),e.bounds=[...t.getInputData().getBounds()],e.bounds),t.setBlendModeToComposite=()=>{t.setBlendMode(ll.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(ll.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(ll.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(ll.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(ll.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(ll.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>K.enumToString(ll,e.blendMode),t.setVolumeShadowSamplingDistFactor=n=>r.setVolumeShadowSamplingDistFactor(n>=1?n:1),Pq.forEach(n=>{const i=()=>{throw new Error(`The method "volumeMapper.${n}()" doesn't exist anymore. It is a rendering property that has been moved to the volume property. Replace your code with:
volumeActor.getProperty().${n}()
`)};t[n]=i})}const Lq=t=>({bounds:[...hn.INIT_BOUNDS],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:ll.COMPOSITE_BLEND,volumeShadowSamplingDistFactor:5,colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024,...t});function qI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lq(r)),MC.extend(t,e,r),K.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","volumeShadowSamplingDistFactor","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),K.event(t,e,"lightingActivated"),Aq(t,e)}const Nq=K.newInstance(qI,"vtkVolumeMapper");var YI={newInstance:Nq,extend:qI,...Rq};function Vq(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const r=t.delete;t.delete=()=>{e.scalarTexture=null,r()}}const kq={scalarTexture:null};function JI(t,e,r={}){Object.assign(e,kq,r),YI.extend(t,e,r),K.setGet(t,e,["scalarTexture"]),Vq(t,e)}const Fq=K.newInstance(JI,"vtkSharedVolumeMapper"),Uq={newInstance:Fq,extend:JI};function RC(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint32Array":return Uint32Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, Int16Array, or Uint32Array");return Float32Array}}function AC(t,e,r={}){const{isVolumeBuffer:n=!1}=r,i=RC(t,n),o=i.BYTES_PER_ELEMENT;return{numBytes:e*o,TypedArrayConstructor:i}}function YS(t,e){const r=RC(e),n=new r(t.length);return n.set(t),n}function Bq(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const r=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=({width:s,height:c,depth:l,numberOfComponents:f,dataType:u,data:d,preferSizeOverAccuracy:h})=>{e.inputDataType=u,e.inputNumComps=f,r({width:s,height:c,depth:l,numberOfComponents:f,dataType:u,data:d,preferSizeOverAccuracy:h})};const n=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(s,c)=>{const l=n(s,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],l},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const c=Ae.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){a();return}return t.hasUpdatedFrames()&&o()};const i=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,i()},t.modified=()=>{i();const s=Ae.getVolume(e.volumeId);if(!s)return;const c=s.imageIds;for(let l=0;l<c.length;l++)e.updatedFrames[l]=!0};function o(){const s=Ae.getVolume(e.volumeId),c=s.imageIds;for(let l=0;l<e.updatedFrames.length;l++)if(e.updatedFrames[l]){const f=Ae.getImage(c[l]);if(!f)continue;let u=f.voxelManager.getScalarData();const d=e.context;s.dataType!==u.constructor.name&&(u=YS(u,s.dataType));const[h]=t.updateArrayDataTypeForGL(s.dataType,[u]);t.bind();const g=l;d.texSubImage3D(e.target,0,0,0,g,e.width,e.height,1,e.format,e.openGLDataType,h),t.deactivate(),e.updatedFrames[l]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function a(){const s=Ae.getVolume(e.volumeId),c=s.getCurrentDimensionGroupImageIds();if(!c.length)return!1;let l;for(let f=0;f<c.length;f++){const u=c[f],d=Ae.getImage(u);let h;d?(h=d.voxelManager.getScalarData(),l=h.constructor):(l=RC(s.dataType,!0),h=new l(e.width*e.height));const g=e.context;s.dataType!==h.constructor.name&&(h=YS(h,s.dataType));const[p]=t.updateArrayDataTypeForGL(s.dataType,[h]);t.bind();let m=f;g.texSubImage3D(e.target,0,0,0,m,e.width,e.height,1,e.format,e.openGLDataType,p),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:c,depth:l,numberOfComponents:f,dataType:u})=>{e.width??=s,e.height??=c,e.depth??=l,e.inputNumComps??=f,e.inputDataType??=u},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const Gq={updatedFrames:[]};function ZI(t,e,r={}){Object.assign(e,Gq,r),Kn.extend(t,e,r),Bq(t,e)}const Wq=K.newInstance(ZI,"vtkStreamingOpenGLTexture"),$q={newInstance:Wq,extend:ZI},zq={isPerformingCoordinateTransformation:!1};function QI(t,e,r={}){Object.assign(e,zq,r),OC.extend(t,e,r),K.setGet(t,e,["isPerformingCoordinateTransformation"]),Hq(t,e)}const jq=K.newInstance(QI,"vtkSlabCamera");function Hq(t,e){e.classHierarchy.push("vtkSlabCamera");const r=_t(new Float64Array(16)),n=new Float64Array(3);t.getProjectionMatrix=(i,o,a)=>{const s=Ti();if(e.projectionMatrix){const d=1/e.physicalScale;return co(n,d,d,d),sr(s,e.projectionMatrix),ws(s,s,n),mn(s,s),s}_t(r);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const f=l-c,u=[c+(o+1)*f/2,c+(a+1)*f/2];if(e.parallelProjection){const d=e.parallelScale*i,h=e.parallelScale,g=(e.windowCenter[0]-1)*d,p=(e.windowCenter[0]+1)*d,m=(e.windowCenter[1]-1)*h,w=(e.windowCenter[1]+1)*h;Qw(r,g,p,m,w,u[0],u[1]),mn(r,r)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const d=Math.tan(pt.radiansFromDegrees(e.viewAngle)/2);let h,g;e.useHorizontalViewAngle===!0?(h=c*d,g=c*d/i):(h=c*d*i,g=c*d);const p=(e.windowCenter[0]-1)*h,m=(e.windowCenter[0]+1)*h,w=(e.windowCenter[1]-1)*g,v=(e.windowCenter[1]+1)*g,y=u[0],C=u[1];r[0]=2*y/(m-p),r[5]=2*y/(v-w),r[2]=(p+m)/(m-p),r[6]=(w+v)/(v-w),r[10]=-(y+C)/(C-y),r[14]=-1,r[11]=-2*y*C/(C-y),r[15]=0}}return sr(s,r),s}}const Kq={newInstance:jq,extend:QI};class lf{get numTimePoints(){return typeof this.numDimensionGroups=="number"?this.numDimensionGroups:1}constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numFrames=null;const{imageIds:r,scaling:n,dimensions:i,spacing:o,origin:a,direction:s,dataType:c,volumeId:l,referencedVolumeId:f,metadata:u,referencedImageIds:d,additionalDetails:h,voxelManager:g,numberOfComponents:p}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:m}=e;this.suppressWarnings=!0,this.imageIds=r,this.volumeId=l,this.metadata=u,this.dimensions=i,this.spacing=o,this.origin=a,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=$q.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=g??La.createImageVolumeVoxelManager({dimensions:i,imageIds:r,numberOfComponents:p,id:l}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],m||(m=dg.newInstance(),m.setDimensions(i),m.setSpacing(o),m.setDirection(s),m.setOrigin(a)),m.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:p||1},this.suppressWarnings),m.set({hasScalarVolume:!1},this.suppressWarnings),this.imageData=m,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),n&&(this.scaling=n),f&&(this.referencedVolumeId=f),d&&(this.referencedImageIds=d),h&&(this.additionalDetails=h)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,r)=>{const n=cr(e);this._imageIdsIndexMap.set(e,r),this._imageURIsIndexMap.set(n,r)})}isDynamicVolume(){return this.numTimePoints?this.numTimePoints>1:!1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){Ae.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(r=>Ae.getImage(r))}}const gs=[];function L0(t,e=0){let r;for(r=0;r<gs.length&&!(gs[r].priority<=e);r++);gs.splice(r,0,{priority:e,provider:t})}function Xq(t){for(let e=0;e<gs.length;e++)if(gs[e].provider===t){gs.splice(e,1);break}}function qq(){for(;gs.length>0;)gs.pop()}function ut(t,...e){for(let r=0;r<gs.length;r++){const n=gs[r].provider(t,...e);if(n!==void 0)return n}}function LC(t,e,r=ut){const n={};for(const i of e)try{const o=r(i,t);if(o){const a={};for(const s in o)if(s in o){const c=e9(s);a[c]=o[s]}Object.assign(n,a)}}catch(o){console.error(`Error retrieving ${i} data:`,o)}return n}const e9=t=>t.startsWith("sop")?`SOP${t.substring(3)}`:(t.endsWith("Id")&&(t=`${t.substring(0,t.length-2)}ID`),t.charAt(0).toUpperCase()+t.slice(1)),Yq=t=>t.startsWith("SOP")?`sop${t.substring(3)}`:(t.endsWith("ID")&&(t=`${t.substring(0,t.length-2)}Id`),t.charAt(0).toLowerCase()+t.slice(1)),t9=Object.freeze(Object.defineProperty({__proto__:null,addProvider:L0,get:ut,getNormalized:LC,removeAllProviders:qq,removeProvider:Xq,toLowerCamelTag:Yq,toUpperCamelTag:e9},Symbol.toStringTag,{value:"Module"}));let ud={};const yl={add:(t,e)=>{yl.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const r=e.type;ud[t]||(ud[t]={}),ud[t][r]=e.metadata},get:(t,e)=>ud[e]?.[t],clear:()=>{ud={}}};L0(yl.get);const Hr=new bw("imageLoadPool");Hr.grabDelay=0;Hr.setMaxSimultaneousRequests(Zt.Interaction,1e3);Hr.setMaxSimultaneousRequests(Zt.Thumbnail,1e3);Hr.setMaxSimultaneousRequests(Zt.Prefetch,1e3);const Nm={};let Vm;function n9(t,e){const r=Ae.getImageLoadObject(t);if(r)return JS(r.promise,t),r;const n=t.split(":")[0],i=Nm[n]||Vm;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${n}'`);const o=i(t,e);return JS(o.promise,t),o}function JS(t,e){Promise.resolve(t).then(r=>{Jq(r),Xe(ke,Ge.IMAGE_LOADED,{image:r})}).catch(r=>{const n={imageId:e,error:r};Xe(ke,Ge.IMAGE_LOAD_FAILED,n)})}function Jq(t){if(!t.voxelManager){const{width:e,height:r,numberOfComponents:n}=t,i=La.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:r,numberOfComponents:n});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function r9(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return n9(t,e).promise}function Ts(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const r=n9(t,e);return Ae.getImageLoadObject(t)||Ae.putImageLoadObject(t,r),r.promise}function Zq(t,e={priority:0,requestType:"prefetch"}){if(!t||t.length===0)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return t.map(n=>Ts(n,e))}function Th(t,e={}){if(t===void 0)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");e.imageId===void 0&&(e.imageId=`derived:${un()}`);const{imageId:r,skipCreateBuffer:n,onCacheAdd:i,voxelRepresentation:o}=e,a=ut("imagePlaneModule",t),s=a.rows*a.columns,{TypedArrayConstructor:c}=AC(e.targetBuffer?.type,s),l=new c(n?1:s),f=r,u=ut("imagePlaneModule",t);yl.add(f,{type:"imagePlaneModule",metadata:u});const d=ut("generalSeriesModule",t);yl.add(f,{type:"generalSeriesModule",metadata:d}),yl.add(f,{type:"generalImageModule",metadata:{instanceNumber:e.instanceNumber}});const h=ut("imagePixelModule",t);yl.add(f,{type:"imagePixelModule",metadata:{...h,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const g=VC(r,{scalarData:l,onCacheAdd:i,skipCreateBuffer:n,targetBuffer:{type:l.constructor.name},voxelRepresentation:o,dimensions:[a.columns,a.rows],spacing:[a.columnPixelSpacing,a.rowPixelSpacing],origin:a.imagePositionPatient,direction:a.imageOrientationPatient,frameOfReferenceUID:a.frameOfReferenceUID,referencedImageId:t});return g.referencedImageId=t,Ae.getImageLoadObject(r)||Ae.putImageSync(r,g),g}function NC(t,e={}){if(t.length===0)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");return t.map((n,i)=>{const o={imageId:e?.getDerivedImageId?.(n)||`derived:${un()}`,...e};return Th(n,{...o,instanceNumber:i+1})})}function VC(t,e){const{scalarData:r,origin:n,direction:i,targetBuffer:o,skipCreateBuffer:a,onCacheAdd:s,frameOfReferenceUID:c,voxelRepresentation:l,referencedImageId:f}=e,u=e.dimensions,d=e.spacing;if(!u||!d)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const h=u[0],g=u[1],p=d[0],m=d[1],w={frameOfReferenceUID:c,rows:g,columns:h,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:n??[0,0,0],pixelSpacing:[m,p],rowPixelSpacing:m,columnPixelSpacing:p},v=h*g,y=r.length/v;let C;if(r){if(!(r instanceof Uint8Array||r instanceof Float32Array||r instanceof Uint16Array||r instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");C=r}else if(!a){const{TypedArrayConstructor:R}=AC(o?.type,v);C=new R(v)}let x,T,S;if(C instanceof Uint8Array)x=8,T=8,S=7;else if(C instanceof Uint16Array)x=16,T=16,S=15;else if(C instanceof Int16Array)x=16,T=16,S=15;else if(C instanceof Float32Array)x=32,T=32,S=31;else throw new Error("Unsupported scalarData type");const _={samplesPerPixel:1,photometricInterpretation:C.length>u[0]*u[1]?"RGB":"MONOCHROME2",rows:g,columns:h,bitsAllocated:x,bitsStored:T,highBit:S},E={imagePlaneModule:w,imagePixelModule:_};["imagePlaneModule","imagePixelModule"].forEach(R=>{yl.add(t,{type:R,metadata:E[R]||{}})});const D=t,b=l===gm.RLE&&La.createRLEImageVoxelManager({dimensions:u,id:D})||La.createImageVoxelManager({height:g,width:h,numberOfComponents:y,scalarData:C,id:D});let I=C[0],O=C[0];for(let R=1;R<C.length;R++)C[R]<I&&(I=C[R]),C[R]>O&&(O=C[R]);const M={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:_.photometricInterpretation==="RGB",numberOfComponents:_.samplesPerPixel,dataType:o?.type,slope:1,minPixelValue:I,maxPixelValue:O,rows:_.rows,columns:_.columns,getCanvas:void 0,height:_.rows,width:_.columns,rgba:void 0,columnPixelSpacing:w.columnPixelSpacing,rowPixelSpacing:w.rowPixelSpacing,FrameOfReferenceUID:w.frameOfReferenceUID,invert:!1,getPixelData:()=>b.getScalarData(),voxelManager:b,sizeInBytes:r.byteLength,referencedImageId:f};return s?.(M),Ae.putImageSync(M.imageId,M),M}function i9(t){const e=({additionalDetails:n})=>n.imageId?n.imageId!==t:!0;Hr.filterRequests(e);const r=Ae.getImageLoadObject(t);r&&r.cancelFn()}function Qq(t){t.forEach(e=>{i9(e)})}function eY(){const t=Hr.getRequestPool();Object.keys(t).forEach(e=>{const r=t[e];Object.keys(r).forEach(n=>{const i=r[n].pop();if(!i)return;const o=i.additionalDetails,{imageId:a,volumeId:s}=o;let c;a?c=Ae.getImageLoadObject(a):s&&(c=Ae.getVolumeLoadObject(s)),c&&c.cancel()}),Hr.clearRequestStack(e)})}function Zf(t,e){Nm[t]=e}function tY(t){const e=Vm;return Vm=t,e}function nY(){Object.keys(Nm).forEach(t=>delete Nm[t]),Vm=void 0}function rY(t,e={}){return NC(t,{...e,targetBuffer:{type:"Uint8Array"}})}function iY(t,e={}){return Th(t,{...e,targetBuffer:{type:"Uint8Array"}})}const oY=Object.freeze(Object.defineProperty({__proto__:null,cancelLoadAll:eY,cancelLoadImage:i9,cancelLoadImages:Qq,createAndCacheDerivedImage:Th,createAndCacheDerivedImages:NC,createAndCacheDerivedLabelmapImage:iY,createAndCacheDerivedLabelmapImages:rY,createAndCacheLocalImage:VC,loadAndCacheImage:Ts,loadAndCacheImages:Zq,loadImage:r9,registerImageLoader:Zf,registerUnknownImageLoader:tY,unregisterAllImageLoaders:nY},Symbol.toStringTag,{value:"Module"}));function o9(t){const e=t[0],{pixelRepresentation:r,bitsAllocated:n,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=ut("imagePixelModule",e),c=[],l=ut("voiLutModule",e);let f;if(l){const{windowWidth:v,windowCenter:y}=l;if(f=l?.voiLUTFunction,Array.isArray(v))for(let C=0;C<v.length;C++)c.push({windowWidth:v[C],windowCenter:y[C]});else c.push({windowWidth:v,windowCenter:y})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:d}=ut("generalSeriesModule",e),{imageOrientationPatient:h,pixelSpacing:g,frameOfReferenceUID:p,columns:m,rows:w}=ut("imagePlaneModule",e);return{BitsAllocated:n,BitsStored:i,SamplesPerPixel:s,HighBit:o,PhotometricInterpretation:a,PixelRepresentation:r,Modality:u,ImageOrientationPatient:h,PixelSpacing:g,FrameOfReferenceUID:p,Columns:m,Rows:w,voiLut:c,VOILUTFunction:f,SeriesInstanceUID:d}}const bv=1;function ZS(t){if(t.columnPixelSpacing!==void 0)return t.columnPixelSpacing;if(t.rowPixelSpacing!==void 0)return t.rowPixelSpacing;if(t.pixelSpacing?.[1]!==void 0)return t.pixelSpacing[1];if(t.pixelSpacing?.[0]!==void 0)return t.pixelSpacing[0]}function a9(t){const{imagePositionPatient:e,imageOrientationPatient:r}=ut("imagePlaneModule",t[0]);if(t.length===1){const{sliceThickness:m,spacingBetweenSlices:w,columnPixelSpacing:v,rowPixelSpacing:y,pixelSpacing:C}=ut("imagePlaneModule",t[0]);if(m)return m;if(w)return w;const x=ZS({columnPixelSpacing:v,rowPixelSpacing:y,pixelSpacing:C});return x!==void 0?x:bv}const n=mt(r[0],r[1],r[2]),i=mt(r[3],r[4],r[5]),o=Ie();nn(o,n,i);const a=mt(e[0],e[1],e[2]),s=t[0].split(":")[0]==="wadouri";let c;function l(m){const{imagePositionPatient:w}=ut("imagePlaneModule",m),v=Ie(),y=mt(w[0],w[1],w[2]);return an(v,a,y),ft(v,o)}if(s){const m=[t[0],t[Math.floor(t.length/2)]],w=ut("imagePlaneModule",m[1]);if(!w)throw new Error("Incomplete metadata required for volume construction.");const v=Ie(),y=mt(w.imagePositionPatient[0],w.imagePositionPatient[1],w.imagePositionPatient[2]);an(v,a,y);const C=ft(v,o);c=Math.abs(C)/Math.floor(t.length/2)}else{const m=t.map(v=>({distance:l(v),imageId:v}));m.sort((v,y)=>y.distance-v.distance);const w=m.length;c=Math.abs(m[w-1].distance-m[0].distance)/(w-1)}const{sliceThickness:f,spacingBetweenSlices:u,columnPixelSpacing:d,rowPixelSpacing:h,pixelSpacing:g}=ut("imagePlaneModule",t[0]),{strictZSpacingForVolumeViewport:p}=Aa().rendering;if((c===0||isNaN(c))&&!p)if(u)console.debug("Could not calculate spacing. Using spacingBetweenSlices"),c=u;else if(f)console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),c=f;else{const m=ZS({columnPixelSpacing:d,rowPixelSpacing:h,pixelSpacing:g});m?c=m:(console.debug(`Could not calculate spacing and no pixel spacing found. Using default thickness (${bv} mm)`),c=bv)}return c}function kC(t,e){const{imagePositionPatient:r,imageOrientationPatient:n}=ut("imagePlaneModule",t[0]);if(!e){const f=mt(n[0],n[1],n[2]),u=mt(n[3],n[4],n[5]);e=Ie(),nn(e,f,u)}const i=t[0].split(":")[0]==="wadouri",o=a9(t);let a;function s(f){const{imagePositionPatient:u}=ut("imagePlaneModule",f),d=Ie();return an(d,r,u),ft(d,e)}if(i){const f=[t[0],t[Math.floor(t.length/2)]];a=t;const u=s(f[0]),d=s(f[1]);u-d<0&&a.reverse()}else{const f=t.map(u=>({distance:s(u),imageId:u}));f.sort((u,d)=>d.distance-u.distance),a=f.map(u=>u.imageId)}const{imagePositionPatient:c}=ut("imagePlaneModule",a[0]);return{zSpacing:o,origin:c,sortedImageIds:a}}function s9(t){const e=ut("modalityLutModule",t)||{},r=ut("generalSeriesModule",t)||{},{modality:n}=r,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:n},o=ut("scalingModule",t)||{};return{...i,...n==="PT"&&{suvbw:o.suvbw,suvbsa:o.suvbsa,suvlbm:o.suvlbm},...n==="RTDOSE"&&{doseGridScaling:o.DoseGridScaling,doseSummation:o.DoseSummation,doseType:o.DoseType,doseUnit:o.DoseUnit}}}const FC=t=>Object.values(t).some(r=>typeof r=="number"&&!Number.isInteger(r)),QS={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function hg(t,e){const r=o9(t),{ImageOrientationPatient:n,PixelSpacing:i,Columns:o,Rows:a}=r,s=mt(n[0],n[1],n[2]),c=mt(n[3],n[4],n[5]),l=Ie();nn(l,s,c);const{zSpacing:f,origin:u,sortedImageIds:d}=kC(t,l),h=t.length,g=[i[1],i[0],f],p=[o,a,h].map(w=>Math.floor(w)),m=[...s,...c,...l];return{dimensions:p,spacing:g,origin:u,dataType:aY(d,r),direction:m,metadata:r,imageIds:d,volumeId:e,voxelManager:null,numberOfComponents:r.PhotometricInterpretation==="RGB"?3:1}}function aY(t,e){const{BitsAllocated:r,PixelRepresentation:n}=e,i=n===1,o=sY(t);if(o)return o;const[a,s,c]=[0,Math.floor(t.length/2),t.length-1],l=[a,s,c].map(h=>s9(t[h])),f=l.some(h=>h.rescaleIntercept<0||h.rescaleSlope<0),u=l.some(h=>FC(h)),d=N1();switch(r){case 8:return"Uint8Array";case 16:return d&&u?"Float32Array":i||f?"Int16Array":!i&&!f?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";case 64:return"Float64Array";default:throw new Error(`Bits allocated of ${r} is not defined to generate scalarData for the volume.`)}}function sY(t){const r=[0,Math.floor(t.length/2),t.length-1].map(i=>Ae.getImage(t[i]));if(!r.every(Boolean))return null;const n=r[0].getPixelData().constructor.name;return r.every(i=>i.getPixelData().constructor.name===n)&&n in QS?QS[n]:null}let km=class c9{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const r=new c9("as iterator");return e.then(n=>{try{r.add(n,!0)}catch(i){r.reject(i)}},n=>{r.reject(n)}),r}add(e,r=!1){this.nextValue=e,this.done||=r,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,r)=>{this.waiting.resolve=e,this.waiting.reject=r})),await this.waiting.promise}yield this.nextValue}async forEach(e,r){let n=0;try{for await(const i of this){const{done:o}=this;try{await e(i,o,n),n++}catch(a){if(!o){console.warn("Caught exception in intermediate value",a);continue}if(r)r(a,o);else throw a}}}catch(i){if(r)r(i,!0);else throw i}}generate(e,r){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},n=>{this.reject(n),r?r(n):console.warn("Couldn't process because",n)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const Cf=new Map,e_="imageRetrieveConfiguration",m0={IMAGE_RETRIEVE_CONFIGURATION:e_,clear:()=>{Cf.clear()},add:(t,e)=>{Cf.set(t,e)},clone:()=>new Map(Cf),restore:t=>{Cf.clear(),t.forEach((e,r)=>{Cf.set(r,e)})},get:(t,...e)=>{if(t===e_)return e.map(r=>Cf.get(r)).find(r=>r!==void 0)}};L0(m0.get.bind(m0));function gg(t){const e=Bi(),r=[];return e.forEach(n=>{const o=n.getVolumeViewports().filter(a=>a.hasVolumeId(t));r.push(...o)}),r}const p5=t=>{const e=cY(t);e?.length&&e.forEach(({renderingEngine:r,viewportIds:n})=>{r.hasBeenDestroyed||r.renderViewports(n)})};function cY(t){const e=Bi(),r=[];return e.forEach(n=>{const i=gg(t);i.length&&r.push({renderingEngine:n,viewportIds:i.map(o=>o.id)})}),r}const t_=[{id:"initialImages",retrieveType:"single"}],lY=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],Dv=[{offset:-1,imageQualityStatus:lo.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:lo.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:lo.FAR_REPLICATE}],uY=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:Zt.Thumbnail,priority:5,nearbyFrames:Dv},{id:"quarterThumb",decimate:4,offset:3,requestType:Zt.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:Dv},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:Zt.Thumbnail,retrieveType:"multipleFast",nearbyFrames:Dv},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:Zt.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:Zt.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:Zt.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:Zt.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function l9(t,e,r=0){const n=[];for(let i=r;i<t.length;i+=e)n.push(i);return n}function fY(t,e,r){if(e?.nearbyRequests?.length)for(const n of e.nearbyRequests)try{const{itemId:i,imageQualityStatus:o}=n,a=Ae.getImageQuality(i);if(a!==void 0&&a>=o)continue;const s={...r,imageId:i,imageQualityStatus:o};Ae.setPartialImage(i,s),t.successCallback(i,s)}catch(i){console.warn("Couldn't fill nearby item ",n.itemId,i)}}const Gf=class Gf{constructor(e){this.stages=e.stages||t_,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,r){return new dY(this,e,r).loadImages()}};Gf.createProgressive=u9,Gf.interleavedRetrieveStages={stages:uY},Gf.singleRetrieveStages={stages:t_},Gf.sequentialRetrieveStages={stages:lY};let Sh=Gf;class dY{constructor(e,r,n){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new km("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=r,this.listener=n}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const r of e)this.addRequest(r);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,r){const{imageId:n,next:i}=e,o=(f,u)=>{this.listener.errorCallback(n,c||!i,f),u&&this.updateStageStatus(e.stage,f)},a=(r.loader||Ts)(n,r),s=km.as(a);let c=!1;return s.forEach(async(f,u)=>{const d=Ae.getImageQuality(n);if(!f){console.warn("No image retrieved",n);return}const{imageQualityStatus:h}=f;if(c||=h===lo.FULL_RESOLUTION,d!==void 0&&d>h){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(n,f),this.displayedIterator.add(f),u&&this.updateStageStatus(e.stage),fY(this.listener,e,f)},o).finally(()=>{if(!c&&i)Ae.setPartialImage(n),this.addRequest(i,r.streamingData);else{c||this.listener.errorCallback(n,!0,"Couldn't decode"),this.outstandingRequests--;for(let f=i;f;f=f.next)this.updateStageStatus(f.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(f=>null)}addRequest(e,r={}){const{imageId:n,stage:i}=e,o=this.listener.getLoaderImageOptions(n);if(!o)return;const{retrieveType:a="default"}=i,{retrieveOptions:s}=this,c=s[a]||s.default,l={...o,retrieveType:a,retrieveOptions:c,streamingData:r},f=i.priority??-5,u=i.requestType||Zt.Interaction,d={imageId:n};Hr.addRequest(this.sendRequest.bind(this,e,l),u,d,f)}updateStageStatus(e,r,n=!1){const{id:i}=e,o=this.stageStatusMap.get(i);if(o&&(o.imageLoadPendingCount--,r?o.imageLoadFailedCount++:n||o.totalImageCount++,!n&&!o.stageStartTime&&(o.stageStartTime=Date.now()),!o.imageLoadPendingCount)){const{imageLoadFailedCount:a,totalImageCount:s,stageStartTime:c=Date.now(),startTime:l}=o,f={stageId:i,numberOfFailures:a,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};Xe(ke,Ge.IMAGE_RETRIEVAL_STAGE,f),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,r=new Map,n=(i,o)=>{const a=o<0?this.imageIds.length+o:o<1?Math.floor((this.imageIds.length-1)*o):o,s=this.imageIds[a];if(!s)throw new Error(`No value found to add to requests at ${o}`);const c={imageId:s,stage:i,index:a,nearbyRequests:this.findNearbyRequests(a,i)};this.addStageStatus(i);const l=r.get(s);l?l.next=c:e.push(c),r.set(s,c)};for(const i of this.stages)(i.positions||l9(this.imageIds,i.decimate||1,i.offset??0)).forEach(a=>{n(i,a)});return e}findNearbyRequests(e,r){const n=new Array;if(!r.nearbyFrames)return n;for(const i of r.nearbyFrames){const o=e+i.offset;o<0||o>=this.imageIds.length||n.push({itemId:this.imageIds[o],imageQualityStatus:i.imageQualityStatus,index:o})}return n}addStageStatus(e){const{id:r}=e,n=this.stageStatusMap.get(r)||{stageId:r,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return n.imageLoadPendingCount++,this.stageStatusMap.set(r,n),n}}function u9(t){return new Sh(t)}const n_=Zt.Prefetch;class f9 extends lf{constructor(e,r){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:n}=this;if(!n||!n.loading)return;n.loading=!1,n.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:o})=>o.volumeId!==this.volumeId;Hr.filterRequests(i)},this.loadStatus=r.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:r}=this,{numFrames:n}=this;for(let i=0;i<n;i++)r.setUpdatedFrame(i);this.modified(),e&&p5(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:r,framesProcessed:n,totalNumFrames:i}=e,{volumeId:o,reRenderFraction:a,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(r>this.reRenderTarget||n===i)&&(this.reRenderTarget+=a,p5(o)),n===i){s.callbacks.forEach(u=>u(e));const f={FrameOfReferenceUID:l,volumeId:o};Xe(ke,Ge.IMAGE_VOLUME_LOADING_COMPLETED,f)}}updateTextureAndTriggerEvents(e,r,n=lo.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:o,numFrames:a,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(o[i]>n||o[i]===lo.FULL_RESOLUTION)return;const f=n===lo.FULL_RESOLUTION;o[e]=n,this.framesUpdated++,f&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:a,framesProcessed:this.framesProcessed};Xe(ke,Ge.IMAGE_VOLUME_MODIFIED,u),f&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:s,complete:f,imageQualityStatus:n}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,r){const n=this.getImageIdIndex(e),{imageQualityStatus:i}=r;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",n);return}this.updateTextureAndTriggerEvents(n,e,i),this.isDynamicVolume()&&this.checkDimensionGroupCompletion(n)}errorCallback(e,r,n){if(!r)return;const{totalNumFrames:i,numFrames:o}=this,a=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:a,error:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:n,imageIdIndex:a,imageId:e};Xe(ke,Ge.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:r,loadStatus:n,numFrames:i}=this,{transferSyntaxUID:o}=ut("transferSyntax",r[0])||{},a=ut(m0.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,o,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:a?(a.create||Sh.createProgressive)(a):this,n.loading===!0)return;const{loaded:s}=this.loadStatus,c=r.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:r}=ut("transferSyntax",e)||{},n=ut("imagePlaneModule",e)||{},{rows:i,columns:o}=n,a=this.getImageIdIndex(e),s=ut("modalityLutModule",e)||{},c=ut("generalSeriesModule",e)||{},l={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality},f=l.modality;if(f==="PT"||f==="RTDOSE"){const g=ut("scalingModule",e);g&&(this._addScalingToVolume(g),Object.assign(l,g))}const u=FC(l),d=N1();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:g,rescaleIntercept:p}=l;this.isPreScaled=typeof g=="number"&&typeof p=="number"}return!d&&u&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:o},allowFloatRendering:d,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:n_,transferSyntaxUID:r,additionalDetails:{imageId:e,imageIdIndex:a,volumeId:this.volumeId},retrieveOptions:void 0}}callLoadImage(e,r,n){const{cachedFrames:i}=this;if(i[r]===lo.FULL_RESOLUTION)return;const o=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(r),ke.removeEventListener(Ge.IMAGE_CACHE_IMAGE_ADDED,o))};return ke.addEventListener(Ge.IMAGE_CACHE_IMAGE_ADDED,o),km.as(Ts(e,n)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,r,e))}getImageIdsRequests(e,r){this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),e.map(o=>{const a=this.getImageIdIndex(o),s=n_,c=r,l=this.getLoaderImageOptions(o),{retrieveOptions:f={}}=ut(m0.IMAGE_RETRIEVE_CONFIGURATION,o,"volume")||{};return l.retrieveOptions={...l.retrieveOptions,...f.default||Object.values(f)?.[0]||{}},{callLoadImage:this.callLoadImage.bind(this),imageId:o,imageIdIndex:a,options:l,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(r=>{if(!r)return;const{callLoadImage:n,imageId:i,imageIdIndex:o,options:a,priority:s,requestType:c,additionalDetails:l}=r;Hr.addRequest(n.bind(this,i,o,a),c,l,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(n=>{console.debug("progressive loading failed to complete",n)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:r,suvlbm:n,suvbsa:i}=e,o={};n&&(o.suvbwToSuvlbm=n/r),i&&(o.suvbwToSuvbsa=i/r),r&&(o.suvbw=r),this.scaling={PT:o}}checkDimensionGroupCompletion(e){}}class d9 extends f9{constructor(e,r){e.imageIds||(e.imageIds=r.imageIds),super(e,r),this.getImageIdsToLoad=()=>{const{imageIds:n}=this;return this.numFrames=n.length,n}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:r}=this;return this.getImageIdsRequests(r,e)}}function h9(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function r(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[g,p]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],m=[0,g,p];await Promise.all(m.map(w=>Ae.isLoaded(e.imageIds[w])?Promise.resolve(!0):new Promise((v,y)=>{const C=e.imageIds[w];Hr.addRequest(async()=>{r9(C).then(()=>{console.log(`Prefetched imageId: ${C}`),v(!0)}).catch(x=>{y(x)})},Zt.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=hg(e.imageIds,t),{dimensions:o,spacing:a,origin:s,direction:c,metadata:l,imageIds:f,dataType:u,numberOfComponents:d}=i;return new d9({volumeId:t,metadata:l,dimensions:o,spacing:a,origin:s,direction:c,imageIds:f,dataType:u,numberOfComponents:d},{imageIds:f,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const n=r();return{promise:n,decache:()=>{n.then(i=>{i.destroy(),i=null})},cancel:()=>{n.then(i=>{i.cancelLoading()})}}}const UC={};let Qf=h9;function g9(t,e){const r=t.indexOf(":"),n=t.substring(0,r);let i=UC[n];if(i==null){if(Qf==null||typeof Qf!="function")throw new Error(`No volume loader for scheme ${n} has been registered`);i=Qf}const o=i(t,e);return o.promise.then(function(a){Xe(ke,Ge.VOLUME_LOADED,{volume:a})},function(a){const s={volumeId:t,error:a};Xe(ke,Ge.VOLUME_LOADED_FAILED,s)}),o}function BC(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let r=Ae.getVolumeLoadObject(t);return r!==void 0?r.promise:(r=g9(t,e),r.promise.then(n=>n))}async function GC(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let r=Ae.getVolumeLoadObject(t);return r!==void 0||(r=g9(t,e),Ae.putVolumeLoadObject(t,r)),r.promise}function p9(t,e){const r=Ae.getVolume(t);if(!r)throw new Error(`Cannot created derived volume: Referenced volume with id ${t} does not exist.`);let{volumeId:n}=e;const{voxelRepresentation:i}=e;n===void 0&&(n=un());const{metadata:o,dimensions:a,spacing:s,origin:c,direction:l}=r,f=r.isDynamicVolume()?r.getCurrentDimensionGroupImageIds():r.imageIds??[],u=NC(f,{targetBuffer:e.targetBuffer,voxelRepresentation:i}),d=u[0].dataType,h=u.map(p=>p.imageId),g=new lf({volumeId:n,dataType:d,metadata:structuredClone(o),dimensions:[a[0],a[1],a[2]],spacing:s,origin:c,direction:l,referencedVolumeId:t,imageIds:h,referencedImageIds:r.imageIds??[]});return Ae.putVolumeSync(n,g),g}async function WC(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const r=Ae.getVolume(t);return r||(e.filter(o=>!Ae.getImage(o)).length===0?pg(t,e):await GC(t,{imageIds:e}))}function pg(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const r=Ae.getVolume(t);if(r)return r;const n=hg(e,t),i=new lf({volumeId:t,dataType:n.dataType,metadata:structuredClone(n.metadata),dimensions:n.dimensions,spacing:n.spacing,origin:n.origin,direction:n.direction,referencedVolumeId:n.referencedVolumeId,imageIds:n.imageIds,referencedImageIds:n.referencedImageIds});return Ae.putVolumeSync(t,i),i}function mg(t,e={}){const{metadata:r,dimensions:n,spacing:i,origin:o,direction:a,scalarData:s,targetBuffer:c,preventCache:l=!1}=e,f=Ae.getVolume(t);if(f)return f;const u=n[0]*n[1],d=s?s.constructor.name:c?.type??"Float32Array",h=u*n[2];let g;switch(d){case"Uint8Array":case"Int8Array":g=h;break;case"Uint16Array":case"Int16Array":g=h*2;break;case"Float32Array":g=h*4;break}if(!Ae.isCacheable(g))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const m=[];for(let y=0;y<n[2];y++){const C=`${t}_slice_${y}`;m.push(C);const x=s.subarray(y*u,(y+1)*u);VC(C,{scalarData:x,dimensions:[n[0],n[1]],spacing:[i[0],i[1]],origin:o,direction:a,targetBuffer:{type:d}})}const w=new lf({volumeId:t,metadata:structuredClone(r),dimensions:[n[0],n[1],n[2]],spacing:i,origin:o,direction:a,imageIds:m,dataType:d}),v=La.createImageVolumeVoxelManager({imageIds:m,dimensions:n,numberOfComponents:1,id:t});return w.voxelManager=v,l||Ae.putVolumeSync(t,w),w}function hY(t,e){UC[t]=e}function m9(){return Object.keys(UC)}function gY(t){const e=Qf;return Qf=t,e}function v9(){return Qf.name}function vg(t,e={}){return p9(t,{...e,targetBuffer:{type:"Uint8Array",...e?.targetBuffer}})}function pY(t,e,r=!1){return t.scalarData||(t.scalarData=new Uint8Array(t.dimensions[0]*t.dimensions[1]*t.dimensions[2])),mg(e,{...t,preventCache:r})}const mY=Object.freeze(Object.defineProperty({__proto__:null,createAndCacheDerivedLabelmapVolume:vg,createAndCacheDerivedVolume:p9,createAndCacheVolume:GC,createAndCacheVolumeFromImages:WC,createAndCacheVolumeFromImagesSync:pg,createLocalLabelmapVolume:pY,createLocalVolume:mg,getUnknownVolumeLoaderSchema:v9,getVolumeLoaderSchemes:m9,loadVolume:BC,registerUnknownVolumeLoader:gY,registerVolumeLoader:hY},Symbol.toStringTag,{value:"Module"}));function y9(t,e){const r=Uq.newInstance();r.setInputData(t);const n=t.getSpacing(),o=(Aa().rendering?.volumeRendering?.sampleDistanceMultiplier||1)*(n[0]+n[1]+n[2])/6;return r.setMaximumSamplesPerRay(4e3),r.setSampleDistance(o),r.setScalarTexture(e),r}function w9(t){const e=YI.newInstance();e.setBlendMode(t.getBlendMode());const r=t.getInputData(),{voxelManager:n}=r.get("voxelManager"),i=n.getCompleteScalarDataArray(),o=Tt.newInstance({name:"Pixels",values:i});return r.getPointData().setScalars(o),e.setInputData(r),e.setMaximumSamplesPerRay(t.getMaximumSamplesPerRay()),e.setSampleDistance(t.getSampleDistance()),e}const vY=0,yY=Zt.Prefetch;async function $C(t,e){let r=CY(e);!r&&e.imageIds.length&&(r=await xY(e),r=wY(e,r)),!(r.lower===0&&r.upper===0||r.lower===void 0||r.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)}function wY(t,e){const r=t.imageIds,n=Math.floor(r.length/2),i=r[n],o=ut("generalSeriesModule",i)||{};return TY(o.modality,t)?{lower:0,upper:5}:e}function CY(t){const{imageIds:e,metadata:r}=t;let n;if(e?.length){const i=Math.floor(e.length/2),o=e[i],a=ut("voiLutModule",o);if(a&&a.windowWidth&&a.windowCenter){a?.voiLUTFunction&&(n={},n.voiLUTFunction=a?.voiLUTFunction);const{windowWidth:s,windowCenter:c}=a,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;l!==0&&(n={windowWidth:l,windowCenter:f})}}else n=r.voiLut[0];if(n&&(n.windowWidth!==0||n.windowCenter!==0)){const{lower:i,upper:o}=Tl(Number(n.windowWidth),Number(n.windowCenter),n.voiLUTFunction);return isNaN(i)||isNaN(o)?void 0:{lower:i,upper:o}}}async function xY(t){const{imageIds:e}=t,r=Math.floor(e.length/2),n=t.imageIds[r],i=ut("generalSeriesModule",n)||{},{modality:o}=i,a=ut("modalityLutModule",n)||{},s={rescaleSlope:a.rescaleSlope,rescaleIntercept:a.rescaleIntercept,modality:o};let c;if(o==="PT"){const h=ut("scalingModule",n);h&&(c={...s,suvbw:h.suvbw})}const l={priority:vY,requestType:yY,preScale:{scalingParameters:c}};let f=Ae.getImage(n);t.referencedImageIds?.length||(f=await Ts(n,{...l,ignoreCache:!0}));let{min:u,max:d}=f.voxelManager.getMinMax();return u?.length>1&&(u=Math.min(...u),d=Math.max(...d)),{lower:u,upper:d}}function TY(t,e){return!(t!=="PT"||!e.isPreScaled||!e.scaling?.PT.suvbw)}async function Fm(t,e,r,n=!1){const{volumeId:i,callback:o,blendMode:a}=t,s=await BC(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=s,f=y9(c,l);a&&f.setBlendMode(a);const u=iB.newInstance();u.setMapper(f);const{numberOfComponents:d}=c.get("numberOfComponents"),h=u.getProperty();return h.set({viewportId:r},!0),Aa().rendering.preferSizeOverAccuracy&&h.setPreferSizeOverAccuracy(!0),d===3&&u.getProperty().setIndependentComponents(!1),await $C(u,s),o&&o({volumeActor:u,volumeId:i}),n||SY(e,r,u,i),u}function SY(t,e,r,n){const i=r.getProperty().getRGBTransferFunction(0).getRange(),o={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:n};Xe(t,Ge.VOI_MODIFIED,o)}function C9(t){const e=t.getMapper().getInputData(),r=e.extentToBounds(e.getExtent());return[[r[0],r[2],r[4]],[r[0],r[2],r[5]],[r[0],r[3],r[4]],[r[0],r[3],r[5]],[r[1],r[2],r[4]],[r[1],r[2],r[5]],[r[1],r[3],r[4]],[r[1],r[3],r[5]]]}const _Y=Po*Po,Iv=t=>Math.abs(Math.abs(t)-1)<_Y,Mv=(t,e)=>Iv(t[e])||Iv(t[e+1])||Iv(t[e+2]),EY=t=>Mv(t,0)&&Mv(t,3)&&Mv(t,6);function n2(t,e,r){const n=t.getMapper().getInputData();let i;const o=n.getDirection();if(EY(o))i=C9(t);else{const[u,d,h]=n.getDimensions();i=[[0,0,0],[u-1,0,0],[0,d-1,0],[u-1,d-1,0],[0,0,h-1],[u-1,0,h-1],[0,d-1,h-1],[u-1,d-1,h-1]].map(p=>n.indexToWorld(p))}const a=ti.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(u=>a.apply(u));const s=[...r];a.apply(s);const c=s[0];let l=1/0,f=-1/0;for(let u=0;u<8;u++){const d=i[u][0];d>f&&(f=d),d<l&&(l=d)}return{min:l,max:f,current:c,actor:t,viewPlaneNormal:e,focalPoint:r}}function Ll(t,e){const{direction:r,spacing:n}=t,i=r.slice(0,3),o=r.slice(3,6),a=r.slice(6,9),s=[ft(i,e),ft(o,e),ft(a,e)],c=Ie();return co(c,s[0]*n[0],s[1]*n[1],s[2]*n[2]),_r(c)}const Ms=t=>{const e="volumeId:",r=t.includes(e)?t.substring(e.length):t,n=r.indexOf("sliceIndex=");return n===-1?r:r.substring(0,n-1)},bY=1+Po,DY=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),r_=t=>!!m9().find(e=>DY(t.volumeId,e));function N0(t,e,r,n=!1){const{viewPlaneNormal:i}=e,o=t.getActors();if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const a=o.map(l=>{const f=l.referencedId??l.uid;return Ae.getVolume(f)}).filter(l=>!!l);if(r){const l=Ms(r),f=a.findIndex(g=>l.includes(g.volumeId)),u=a[f],{uid:d}=o[f],h=i_(u,i,t,n);return{imageVolume:u,spacingInNormalDirection:h,actorUID:d}}if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=a.find(r_);for(let l=0;l<a.length;l++){const f=a[l];if(c&&!r_(f))continue;const u=i_(f,i,t);u*bY<s.spacingInNormalDirection&&(s.spacingInNormalDirection=u,s.imageVolume=f,s.actorUID=o[l].uid)}return s}function i_(t,e,r,n=!1){const{slabThickness:i}=r.getProperties();let o=i;return(!i||!n)&&(o=Ll(t,e)),o}function Um(t){const e=t.getCamera(),{spacingInNormalDirection:r,imageVolume:n}=N0(t,e);if(!n)return;const{viewPlaneNormal:i,focalPoint:o}=e,a=t.getActors().find(g=>g.referencedId===n.volumeId||g.uid===n.volumeId);a||console.warn("No actor found for with actorUID of",n.volumeId);const s=a.actor,c=n2(s,i,o),{min:l,max:f,current:u}=c,d=Math.round((f-l)/r)+1;let h=(u-l)/(f-l)*d;return h=Math.floor(h),h>d-1?h=d-1:h<0&&(h=0),{numberOfSlices:d,imageIndex:h}}const Af={};function IY(t){Af[t]!==void 0&&delete Af[t]}function MY(t){const{renderingEngineId:e,viewportId:r}=t.detail,i=Bn(e).getViewport(r);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");Af[i.id]===void 0&&(Af[i.id]=0);const o=Um(i);if(!o){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:a,imageIndex:s}=o;if(Af[i.id]===s)return;Af[i.id]=s;const c={imageIndex:s,viewportId:r,renderingEngineId:e,numberOfSlices:a};Xe(i.element,Ge.VOLUME_NEW_IMAGE,c)}function v0(t,e,r){const[n,i,o]=t,[a,s,c]=e,[l,f,u,d]=r,h=a-n,g=s-i,p=c-o,m=-1*(l*n+f*i+u*o-d)/(l*h+f*g+u*p),w=h*m+n,v=g*m+i,y=p*m+o;return[w,v,y]}function ps(t,e,r=!1){const[n,i,o]=t,a=n*e[0]+i*e[1]+o*e[2];if(r){const s=Math.sqrt(n*n+i*i+o*o);return[n/s,i/s,o/s,a/s]}return[n,i,o,a]}function x9(t,e,r){const[n,i,o,a]=t,[s,c,l,f]=e,[u,d,h,g]=r,p=Ed(n,s,u,i,c,d,o,l,h),m=Ed(a,f,g,i,c,d,o,l,h),w=Ed(n,s,u,a,f,g,o,l,h),v=Ed(n,s,u,i,c,d,a,f,g),y=yu(m)/yu(p),C=yu(w)/yu(p),x=yu(v)/yu(p);return[y,C,x]}function _h(t,e,r=!1){const[n,i,o,a]=t,[s,c,l]=e,f=n*s+i*c+o*l-a,u=Math.abs(f)/Math.sqrt(n*n+i*i+o*o);return(r?Math.sign(f):1)*u}function T9(t,e,r=Po){return _h(e,t)<r}const OY=Object.freeze(Object.defineProperty({__proto__:null,isPointOnPlane:T9,linePlaneIntersection:v0,planeDistanceToPoint:_h,planeEquation:ps,threePlaneIntersection:x9},Symbol.toStringTag,{value:"Module"}));function m5(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function na(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(na);{const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=na(t[r]));return e}}const PY=.95;function S9(t,e){if(!t?.length||!e.FrameOfReferenceUID)return;e.planeRestriction||={FrameOfReferenceUID:e.FrameOfReferenceUID,point:t[0],inPlaneVector1:null,inPlaneVector2:null};const{planeRestriction:r}=e;if(t.length===1)return r.inPlaneVector1=null,r.inPlaneVector2=null,r;const n=an(Ie(),t[0],t[Math.floor(t.length/2)]);At(n,n),r.inPlaneVector1=n,r.inPlaneVector2=null;const i=t.length;if(i>2)for(let o=Math.floor(i/3);o<i;o++){const a=an(Ie(),t[o],t[0]),s=_r(a);if(!Dt(s,0)&&ft(a,r.inPlaneVector1)<s*PY)return At(a,a),r.inPlaneVector2=a,r}return r}const nh=class nh{constructor(e){this.insetImageMultiplier=Aa().rendering?.useLegacyCameraFOV?1.1:1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=Ni.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=r=>{},this.viewportWidgets=new Map,this.addWidget=(r,n)=>{this.viewportWidgets.set(r,n)},this.getWidget=r=>this.viewportWidgets.get(r),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.getRenderPasses=()=>null,this.removeWidgets=()=>{this.getWidgets().forEach(n=>{if(n.getEnabled()&&n.setEnabled(!1),n.getActor&&n.getRenderer){const i=n.getActor(),o=n.getRenderer();o&&i&&o.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=na(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=na(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===Ni.NO_DATA||this.viewportStatus===Ni.LOADING||(this.viewportStatus=Ni.RENDERED)}setColorTransform(e,r){let n=null;if(!e&&!r)return;const i=r||[255,255,255],o=Math.max(...i),a=i.map(u=>o/u),{lower:s=0,upper:c=255}=e||{},l=(c-s+1)/255,f=s/255;return n=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${a[0]*l} 0 0 0 ${f}           0 ${a[1]*l} 0 0 ${f}           0 0 ${a[2]*l} 0 ${f}           0 0 0 1 0" />        </filter>      </svg>#colour')`,n}getRenderingEngine(){return gh.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,r=!1){this.options=structuredClone(e),this.options?.displayArea&&this.setDisplayArea(this.options?.displayArea),r&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:r}){const n=this.getDefaultImageData();if(!n)return;const i=this.getCamera(),{viewPlaneNormal:o,viewUp:a,focalPoint:s,position:c}=i,l=nn(Ie(),o,a);let f=$1(Ie(),a);const u=Oa(Ie(),o),d=Nr(c,s),g=n.getDimensions().map(x=>Math.floor(x/2)),p=[g[0],g[1],g[2]],m=n.indexToWorld(p,Ie()),w=this._getFocalPointForResetCamera(m,i,{resetPan:!0,resetToCenter:!1}),v=qt(Ie(),s,w),y=_r(v),C=x=>{const T=Jn(Ie(),x,2*ft(v,x));return qt(T,T,v),At(T,T),T};if(e){const x=C(f),T=tn(Ie(),w,x,y),S=tn(Ie(),T,u,d);this.setCamera({viewPlaneNormal:u,position:S,focalPoint:T}),this.flipHorizontal=!this.flipHorizontal}if(r){f=Oa(f,a);const x=C(l),T=tn(Ie(),w,x,y),S=tn(Ie(),T,u,d);this.setCamera({focalPoint:T,viewPlaneNormal:u,viewUp:f,position:S}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&ta(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const r=this.getActors();let n=r[0];return e&&(n=r.find(o=>o.referencedId===e)),!n||!ta(n)?null:n.actor}getActorUIDByIndex(e){const r=this.getActors()[e];if(r)return r.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){const r=this.getActors();this.removeAllActors(),this.addActors(e,{resetCamera:!0}),Xe(this.element,Ge.ACTORS_CHANGED,{viewportId:this.id,removedActors:r,addedActors:e,currentActors:e})}_removeActor(e){const r=this.getActor(e);if(!r){console.warn(`Actor ${e} does not exist in ${this.id}, can't remove`);return}return this.getRenderer().removeActor(r.actor),this._actors.delete(e),r}removeActors(e){const r=[];e.forEach(i=>{const o=this._removeActor(i);o&&r.push(o)});const n=this.getActors();Xe(this.element,Ge.ACTORS_CHANGED,{viewportId:this.id,removedActors:r,addedActors:[],currentActors:n})}addActors(e,r={}){const{resetCamera:n=!1}=r,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}if(e.forEach(o=>{this.addActor(o)}),n)this.resetCamera();else{const o=this.getViewPresentation(),a=this.getViewReference();this.resetCamera(),this.setViewReference(a),this.setViewPresentation(o)}Xe(this.element,Ge.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:e,currentActors:this.getActors()})}addActor(e){const{uid:r,actor:n}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${r} Rendering Engine has been destroyed`);return}if(!r||!n)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(r)){console.warn(`Actor ${r} already exists for this viewport`);return}this.getRenderer()?.addActor(n),this._actors.set(r,Object.assign({},e)),this.updateCameraClippingPlanesAndRange(),Xe(this.element,Ge.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:[e],currentActors:this.getActors()})}removeAllActors(){const e=this.getActors();this.getRenderer()?.removeAllViewProps(),this._actors=new Map,Xe(this.element,Ge.ACTORS_CHANGED,{viewportId:this.id,removedActors:e,addedActors:[],currentActors:[]})}resetCameraNoEvent(){const e=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=e}setCameraNoEvent(e){const r=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=r}_getViewImageDataIntersections(e,r,n){const i=n[0],o=n[1],a=n[2],s=i*r[0]+o*r[1]+a*r[2],c=e.getBounds(),l=this._getEdges(c),f=[];for(const u of l){const[[d,h,g],[p,m,w]]=u;if(i*(p-d)+o*(m-h)+a*(w-g)===0)continue;const v=v0([d,h,g],[p,m,w],[i,o,a,s]);this._isInBounds(v,c)&&f.push(v)}return f}setInterpolationType(e,r){}setDisplayArea(e,r=!1){if(!e)return;const{storeAsInitialCamera:n,type:i}=e;n&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:o}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(this.getProperties()?.interpolationType??dc.LINEAR),this.setDisplayAreaFit(e)),n&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=o,!r&&!o){const a={viewportId:this.id,displayArea:e,storeAsInitialCamera:n};Xe(this.element,Ge.DISPLAY_AREA_MODIFIED,a),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:r=1}=e,n=this.canvas,i=n.height,o=n.width;if(i<8||o<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(dc.NEAREST),this.setCamera({parallelScale:i*c/(2*r)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:f,viewUp:u,viewPlaneNormal:d}=this.getCamera(),h=Ie();if(n.height%2&&tn(h,h,u,r*.5*c),n.width%2){const g=nn(Ie(),u,d);tn(h,h,g,r*.5*c)}!h[0]&&!h[1]&&!h[2]||this.setCamera({focalPoint:nr(Ie(),l,h),position:nr(Ie(),f,h)})}setDisplayAreaFit(e){const{imageArea:r,imageCanvasPoint:n}=e,i=window?.devicePixelRatio||1,o=this.getDefaultImageData();if(!o)return;const a=this.sWidth/i,s=this.sHeight/i,c=o.getDimensions(),l=this.worldToCanvas(o.indexToWorld([0,0,0])),f=this.worldToCanvas(o.indexToWorld([c[0],c[1],c[2]])),u=[Math.abs(f[0]-l[0]),Math.abs(f[1]-l[1])],[d,h]=u;let g=this.getZoom()/this.insetImageMultiplier;if(r){const[p,m]=r,w=Math.max(Math.abs(d/a),Math.abs(h/s)),v=Math.abs(p*d/a),y=Math.abs(m*h/s),C=this.getZoom(),x=this.getZoom(this.fitToCanvasCamera);g=(v>y?w/v:w/y)*C/x,this.setZoom(this.insetImageMultiplier*g,!1)}if(n){const{imagePoint:p,canvasPoint:m=p||[.5,.5]}=n,[w,v]=m,y=a*(w-.5),C=s*(v-.5),[x,T]=p||m,S=g,_=this.insetImageMultiplier*S*d*(.5-x),E=this.insetImageMultiplier*S*h*(.5-T),D=_+y,b=E+C,I=[D,b];Zr(I,I,this.getPan()),this.setPan(I,!1)}}getDisplayArea(){return this.options?.displayArea}resetCamera(e){const{resetPan:r=!0,resetZoom:n=!0,resetToCenter:i=!0,storeAsInitialCamera:o=!0}=e||{},a=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera();let c;const l=this.getDefaultActor();l&&ta(l)?c=l.actor.getMapper().getInputData().getBounds():c=a.computeVisiblePropBounds();const f=[0,0,0],u=this.getDefaultImageData();if(u){const A=u.getSpacing();c[0]=c[0]+A[0]/2,c[1]=c[1]-A[0]/2,c[2]=c[2]+A[1]/2,c[3]=c[3]-A[1]/2,c[4]=c[4]+A[2]/2,c[5]=c[5]-A[2]/2}const d=this.getVtkActiveCamera(),h=d.getViewPlaneNormal(),g=d.getViewUp();if(f[0]=(c[0]+c[1])/2,f[1]=(c[2]+c[3])/2,f[2]=(c[4]+c[5])/2,u){const B=u.getDimensions().map(L=>Math.floor(L/2)),k=[B[0],B[1],B[2]];u.indexToWorld(k,f)}let p,m;const v=Aa().rendering?.useLegacyCameraFOV??!1;if(u&&!v){const A=u.getExtent(),B=u.getSpacing();p=(A[1]-A[0])*B[0],m=(A[3]-A[2])*B[1]}else({widthWorld:p,heightWorld:m}=this._getWorldDistanceViewUpAndViewRight(c,g,h));const y=[this.sWidth,this.sHeight],C=p/m,x=y[0]/y[1],T=C/x,S=T<1?this.insetImageMultiplier*m/2:this.insetImageMultiplier*m*T/2,_=nh.boundsRadius(c)*(this.type===Fn.VOLUME_3D?10:1),E=this.insetImageMultiplier*_,D=Math.abs(pt.dot(g,h))>.999?[-g[2],g[0],g[1]]:g,b=this._getFocalPointForResetCamera(f,s,{resetPan:r,resetToCenter:i}),I=[b[0]+E*h[0],b[1]+E*h[1],b[2]+E*h[2]];a.resetCameraClippingRange(c);const O=[-Cr.MAXIMUM_RAY_DISTANCE,Cr.MAXIMUM_RAY_DISTANCE];d.setPhysicalScale(_),d.setPhysicalTranslation(-b[0],-b[1],-b[2]),this.setCamera({parallelScale:n?S:s.parallelScale,focalPoint:b,position:I,viewAngle:90,viewUp:D,clippingRange:O});const M=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),o&&this.setInitialCamera(M),n&&this.setZoom(1,o);const R={type:"ResetCameraEvent",renderer:a};return a.invokeEvent(R),this.triggerCameraModifiedEventIfNecessary(s,M),u&&this.options.displayArea&&n&&r&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const n=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),o=this.worldToCanvas(qt([0,0,0],e.focalPoint,i)),a=this.worldToCanvas(qt([0,0,0],n,i));return Mn([0,0],o,a)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,r=!1){const n=this.getCamera(),{focalPoint:i,position:o}=n,a=this.canvasToWorld([0,0]),s=Mn([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!r)return;const c=qt(Ie(),this.canvasToWorld(s),a),l=qt(Ie(),i,c),f=qt(Ie(),o,c);this.setCamera({...n,focalPoint:l,position:f},r)}getZoom(e=this.initialCamera){if(!e)return 1;const r=this.getVtkActiveCamera(),{parallelScale:n}=e;return n/r.getParallelScale()}setZoom(e,r=!1){const n=this.getCamera(),{parallelScale:i}=this.initialCamera,o=i/e;n.parallelScale===o&&!r||this.setCamera({...n,parallelScale:o},r)}_getFocalPointForViewPlaneReset(e){const{focalPoint:r,viewPlaneNormal:n}=this.getCamera(),i=this._getViewImageDataIntersections(e,r,n);let o=0,a=0,s=0;return i.forEach(([l,f,u])=>{o+=l,a+=f,s+=u}),[o/i.length,a/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),r=(s,c)=>s.some(l=>isNaN(l))?c:s,n=r([...e.getViewUp()],[0,1,0]),i=r([...e.getViewPlaneNormal()],[0,0,-1]),o=r([...e.getPosition()],[0,0,1]),a=r([...e.getFocalPoint()],[0,0,0]);return{viewUp:n,viewPlaneNormal:i,position:o,focalPoint:a,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,r=!1){const n=this.getVtkActiveCamera(),i=this.getCamera(),o=Object.assign({},i,e),{viewUp:a,viewPlaneNormal:s,position:c,focalPoint:l,parallelScale:f,viewAngle:u,flipHorizontal:d,flipVertical:h,clippingRange:g}=e;if(d!==void 0){const w=d&&!this.flipHorizontal||!d&&this.flipHorizontal;w&&this.flip({flipHorizontal:w})}if(h!==void 0){const w=h&&!this.flipVertical||!h&&this.flipVertical;w&&this.flip({flipVertical:w})}a!==void 0&&n.setViewUp(a),s!==void 0&&n.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&n.setPosition(...c),l!==void 0&&n.setFocalPoint(...l),f!==void 0&&n.setParallelScale(f),u!==void 0&&n.setViewAngle(u),g!==void 0&&n.setClippingRange(g);const p=i.focalPoint,m=i.viewUp;if(p&&l||m&&a){const w=n.getViewPlaneNormal(),v=n.getViewUp();let y=!1,C=!1;if(l){const x=[l[0]-p[0],l[1]-p[1],l[2]-p[2]];y=Math.abs(pt.dot(x,w))>0}if(a&&(C=!Dt(v,m)),y||C){const x=this.getDefaultActor();if(!x?.actor)return;eo(x,"vtkActor")||this.updateClippingPlanesForActors(o),(eo(x,"vtkImageSlice")||this.type===Fn.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}r&&this.setInitialCamera(o),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,r){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const n={previousCamera:e,camera:r,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Xe(this.element,Ge.CAMERA_MODIFIED,n)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(n=>{if(!n.actor)return;const i=n.actor.getMapper();let o=n?.clippingFilter?n?.clippingFilter.getClippingPlanes():i.getClippingPlanes();o.length===0&&n?.clippingFilter&&(o=[tr.newInstance(),tr.newInstance()]);let a=Cr.MINIMUM_SLAB_THICKNESS;n.slabThickness&&(a=n.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(o,a,s,c),Xe(this.element,Ge.CLIPPING_PLANES_UPDATED,{actorEntry:n,focalPoint:c,vtkPlanes:o,viewport:this})})}setOrientationOfClippingPlanes(e,r,n,i){if(e.length<2)return;const o=[n[0],n[1],n[2]];pt.multiplyScalar(o,r),e[0].setNormal(n);const a=[0,0,0];pt.subtract(i,o,a),e[0].setOrigin(a),e[1].setNormal(-n[0],-n[1],-n[2]);const s=[0,0,0];pt.add(i,o,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const r=e.actor.getMapper();let n=e?.clippingFilter?e?.clippingFilter.getClippingPlanes():r.getClippingPlanes();return n.length===0&&e?.clippingFilter&&(n=[tr.newInstance(),tr.newInstance()]),n}_getWorldDistanceViewUpAndViewRight(e,r,n){const i=this._getCorners(e),o=this._getCorners(e),a=nn(Ie(),r,n);let s=ti.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]);i.forEach(d=>s.apply(d));let c=1/0,l=-1/0;for(let d=0;d<8;d++){const h=i[d][0];h>l&&(l=h),h<c&&(c=h)}s=ti.buildFromDegree().identity().rotateFromDirections([a[0],a[1],a[2]],[1,0,0]),o.forEach(d=>s.apply(d));let f=1/0,u=-1/0;for(let d=0;d<8;d++){const h=o[d][0];h>u&&(u=h),h<f&&(f=h)}return{widthWorld:u-f,heightWorld:l-c}}getViewReference(e){const{focalPoint:r,viewPlaneNormal:n,viewUp:i}=this.getCamera(),o=this.getFrameOfReferenceUID(),a={FrameOfReferenceUID:o,cameraFocalPoint:r,viewPlaneNormal:n,viewUp:i,sliceIndex:e?.sliceIndex??this.getSliceIndex(),planeRestriction:{FrameOfReferenceUID:o,point:e?.points?.[0]||r,inPlaneVector1:i,inPlaneVector2:nn(Ie(),i,n)}};return e?.points&&S9(e.points,a.planeRestriction),a}isPlaneViewable(e,r){if(e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{focalPoint:n,viewPlaneNormal:i}=this.getCamera(),{point:o,inPlaneVector1:a,inPlaneVector2:s}=e;if(r?.withOrientation)return!0;if(a&&!Dt(0,ft(i,a))||s&&!Dt(0,ft(i,s)))return!1;if(r?.withNavigation)return!0;const c=an(Ie(),o,n);return Dt(0,ft(c,i))}isReferenceViewable(e,r){if(e.planeRestriction)return this.isPlaneViewable(e.planeRestriction,r);if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:n}=e,i=this.getCamera();return n&&!Dt(n,i.viewPlaneNormal)&&!Dt(Oa(i.viewPlaneNormal,i.viewPlaneNormal),n)?r?.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0,flipHorizontal:!0,flipVertical:!0}){const r={},{rotation:n,displayArea:i,zoom:o,pan:a,flipHorizontal:s,flipVertical:c}=e;n&&(r.rotation=this.getRotation()),i&&(r.displayArea=this.getDisplayArea());const l=this.getZoom();return o&&(r.zoom=l),a&&(r.pan=this.getPan(),as(r.pan,r.pan,1/l)),s&&(r.flipHorizontal=this.flipHorizontal),c&&(r.flipVertical=this.flipVertical),r}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:r,zoom:n=this.getZoom(),pan:i,rotation:o,flipHorizontal:a=this.flipHorizontal,flipVertical:s=this.flipVertical}=e;r!==this.getDisplayArea()&&this.setDisplayArea(r),this.setZoom(n),i&&this.setPan(as([0,0],i,n)),a!==void 0&&a!==this.flipHorizontal&&this.flip({flipHorizontal:a}),s!==void 0&&s!==this.flipVertical&&this.flip({flipVertical:s}),o>=0&&this.setRotation(o)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,r,{resetPan:n=!0,resetToCenter:i=!0}){if(i&&n)return e;if(i&&!n)return m5(r.focalPoint)?e:r.focalPoint;if(!i&&n){const o=r,a=o.focalPoint,s=o.viewPlaneNormal,c=qt(Ie(),e,a),l=ft(c,s),f=tn(Ie(),e,s,-1*l);return[f[0],f[1],f[2]]}if(!n&&!i)return m5(r.focalPoint)?e:r.focalPoint}_isInBounds(e,r){const[n,i,o,a,s,c]=r,[l,f,u]=e;return!(l<n||l>i||f<o||f>a||u<s||u>c)}_getEdges(e){const[r,n,i,o,a,s,c,l]=this._getCorners(e);return[[r,n],[r,a],[r,i],[n,o],[n,s],[i,o],[i,c],[o,l],[a,c],[a,s],[s,l],[c,l]]}static boundsRadius(e){const r=(e[1]-e[0])**2,n=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(r+n+i||1)*.5}setDataIds(e,r){throw new Error("Unsupported operatoin setDataIds")}};nh.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},nh.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let Qu=nh;function _9(t,e,r=!1){const n=t.getCamera(),{focalPoint:i,viewPlaneNormal:o}=n,{spacingInNormalDirection:a,actorUID:s}=N0(t,n,e,r);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const l=c.actor;return{sliceRange:n2(l,o,i),spacingInNormalDirection:a,camera:n}}function Bu(t,e,r=!1){const{sliceRange:n,spacingInNormalDirection:i,camera:o}=_9(t,e,r),{min:a,max:s,current:c}=n,l=Math.round((s-a)/i),u=(c-a)/(s-a)*l,d=Math.round(u);return{numScrollSteps:l,currentStepIndex:d,sliceRangeInfo:{sliceRange:n,spacingInNormalDirection:i,camera:o}}}function e0(t,e,r,n,i,o){const{min:a,max:s,current:c}=r,l=Ie();an(l,e,t);const f=Math.round((s-a)/i),d=(c-a)/(s-a)*f;let h=Math.round(d),g=[t[0]-n[0]*d*i,t[1]-n[1]*d*i,t[2]-n[2]*d*i];h+=o,h>f?h=f:h<0&&(h=0);const p=h*i;g=[g[0]+n[0]*p,g[1]+n[1]*p,g[2]+n[2]*p];const m=[g[0]+l[0],g[1]+l[1],g[2]+l[2]];return{newFocalPoint:g,newPosition:m}}function E9(t){let e=[];const[r,n]=t.getRange();t.getTable(r,n,1024,e),e=e.filter((h,g)=>g%3===0);const i=[...Array(1024).keys()].map((h,g)=>r+(n-r)/1023*g),o=e[256],a=Math.log((1-o)/o),s=i[256],c=e[256*3],l=Math.log((1-c)/c),f=i[256*3],u=Math.round(4*(f-s)/(a-l)),d=Math.round(s+u*a/4);return[Math.round(d-u/2),Math.round(d+u/2)]}function b9(t,e){const r=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:n}=RY(r),i=n[0],o=n[1]-n[0],a=Cc.newInstance(),s=[];for(let C=0;C<r.length;C+=4){let x=r[C];const T=r[C+1],S=r[C+2],_=r[C+3];x=(x-i)/o,s.push([x,T,S,_])}AY(s,n,a),t.getProperty().setRGBTransferFunction(0,a);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=qu.newInstance(),f=[];for(let C=0;C<c.length;C+=2){let x=c[C];const T=c[C+1];x=(x-i)/o,f.push([x,T])}LY(f,n,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[d,h,g,p]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,d),u.setGradientOpacityMinimumOpacity(0,h),u.setGradientOpacityMaximumValue(0,g),u.setGradientOpacityMaximumOpacity(0,p),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const m=parseFloat(e.ambient),w=parseFloat(e.diffuse),v=parseFloat(e.specular),y=parseFloat(e.specularPower);u.setAmbient(m),u.setDiffuse(w),u.setSpecular(v),u.setSpecularPower(y)}function RY(t){let e=1/0,r=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),r=Math.max(r,t[i]);const n=(r-e)/2;return{shiftRange:[-n,n],min:e,max:r}}function AY(t,e,r){const n=e[1]-e[0],i=t.map(([o,a,s,c])=>[o*n+e[0],a,s,c]);return r.removeAllPoints(),i.forEach(([o,a,s,c])=>r.addRGBPoint(o,a,s,c)),i}function LY(t,e,r){const n=e[1]-e[0],i=t.map(([o,a])=>[o*n+e[0],a]);return r.removeAllPoints(),i.forEach(([o,a])=>r.addPoint(o,a)),i}const{MPR_CAMERA_VALUES:xo}=Mc,{OrientationAxis:sc}=go;function D9(t,e,r,n){let i;switch(n){case sc.AXIAL:case sc.AXIAL_REFORMAT:i=xo.axial;break;case sc.SAGITTAL:case sc.SAGITTAL_REFORMAT:i=xo.sagittal;break;case sc.CORONAL:case sc.CORONAL_REFORMAT:i=xo.coronal;break;default:i=xo.axial;break}const o=At(Ie(),t),a=At(Ie(),e),s=At(Ie(),r),c=[o,a,s],l=[mt(i.viewRight[0],i.viewRight[1],i.viewRight[2]),mt(i.viewUp[0],i.viewUp[1],i.viewUp[2]),mt(i.viewPlaneNormal[0],i.viewPlaneNormal[1],i.viewPlaneNormal[2])],f=new Set,u=p=>{let m=0,w=-2,v=!1;c.forEach((C,x)=>{if(f.has(x))return;const T=ft(p,C),S=Math.abs(T);S>w&&(w=S,m=x,v=T<0)}),f.add(m);const y=ea(c[m]);return v&&Oa(y,y),y},d=u(l[0]),h=u(l[1]),g=u(l[2]);return{viewPlaneNormal:[g[0],g[1],g[2]],viewUp:[h[0],h[1],h[2]],viewRight:[d[0],d[1],d[2]]}}function I9(t,e){if(!t.getActors()?.length)return;t.type!==Fn.ORTHOGRAPHIC&&console.warn("Viewport should be a volume viewport");let r=t.getCurrentImageId();if(r||(r=t.getImageIds()?.[0]),!r)return;const{imageOrientationPatient:n}=ut("imagePlaneModule",r),i=mt(n[0],n[1],n[2]),o=mt(n[3],n[4],n[5]),a=nn(Ie(),i,o);let{orientation:s}=e||{};const{useViewportNormal:c}=e||{};let l=a;return c&&(l=t.getCamera().viewPlaneNormal),s||(s=NY(l)),D9(i,o,a,s)}function NY(t){const e=At(Ie(),t),r=mt(xo.axial.viewPlaneNormal[0],xo.axial.viewPlaneNormal[1],xo.axial.viewPlaneNormal[2]),n=mt(xo.sagittal.viewPlaneNormal[0],xo.sagittal.viewPlaneNormal[1],xo.sagittal.viewPlaneNormal[2]),i=mt(xo.coronal.viewPlaneNormal[0],xo.coronal.viewPlaneNormal[1],xo.coronal.viewPlaneNormal[2]),o=Math.abs(ft(e,r)),a=Math.abs(ft(e,n)),s=Math.abs(ft(e,i));return o>=a&&o>=s?sc.AXIAL:a>=s?sc.SAGITTAL:sc.CORONAL}function M9(){return Aa()?.rendering?.renderingEngineMode===Hu.ContextPool}const VY=t=>!(typeof t=="number"&&Number.isFinite(t)),{vtkErrorMacro:sp}=K;function kY(t,e){e.classHierarchy.push("vtkConvolution2DPass"),t.computeKernelWeight=function(n){const i=n.reduce((o,a)=>o+a);return i<=0?1:i},t.traverse=function(r){if(e.deleted)return;if(e.kernelDimension%2!==1){sp("Invalid kernel dimension! Kernel dimension must be odd (e.g. 3, 5, 7, ...).");return}e.kernel===null&&(e.kernel=new Float32Array(e.kernelDimension),e.kernel[Math.floor(e.kernelDimension/2)]=1);const n=e.kernelDimension*e.kernelDimension;if(e.kernel.length!==n){sp(`The given kernel is invalid. 2D convolution kernels have to be 1D arrays with ${n} components representing the ${e.kernelDimension}x${e.kernelDimension} kernel in row-major form.`);return}e.framebuffer===null&&(e.framebuffer=lg.newInstance());const i=r.getSize(),o=r.getContext();if(o===null){e.delegates.forEach(c=>{c.traverse(r,t)});return}e.VBOBuildTime.getMTime()<t.getMTime()&&(e.tris.setOpenGLRenderWindow(r),t.buildVertexBuffer()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();const a=e.framebuffer.getSize();if((a===null||a[0]!==i[0]||a[1]!==i[1])&&(e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),e.delegates.forEach(c=>{c.traverse(r,t)}),e.framebuffer.restorePreviousBindingsAndBuffers(),e.convolutionShader!==null&&e.oldKernelDimension!==e.kernelDimension&&(e.convolutionShader=null,e.oldKernelDimension=e.kernelDimension),e.convolutionShader===null){e.convolutionShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),t.getFragmentShaderCode(e.kernelDimension),"");const c=e.convolutionShader;e.copyVAO=q1.newInstance(),e.copyVAO.setOpenGLRenderWindow(r),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(c,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),o.FLOAT,3,o.FALSE)||sp("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(c,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),o.FLOAT,2,o.FALSE)||sp("Error setting vertexDC in copy shader VAO.")}else r.getShaderCache().readyShaderProgram(e.convolutionShader);o.viewport(0,0,i[0],i[1]),o.scissor(0,0,i[0],i[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.convolutionShader.setUniformi("u_image",s.getTextureUnit()),e.convolutionShader.setUniform2f("u_textureSize",s.getWidth(),s.getHeight()),e.convolutionShader.setUniformfv("u_kernel",e.kernel),e.convolutionShader.setUniformf("u_kernelWeight",t.computeKernelWeight(e.kernel)),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate()},t.getFragmentShaderCode=r=>{const n=r*r;let i=["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D u_image;","uniform vec2 u_textureSize;",`uniform float u_kernel[${n}];`,"uniform float u_kernelWeight;","varying vec2 tcoord;","void main(){","    vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;",`    vec4 colorSum =
`].join(`
`);const o=Math.floor(r/2);let a=0;for(let s=-o;s<=o;++s)for(let c=-o;c<=o;++c)i+=`        texture2D(u_image, tcoord + onePixel * vec2(${c}, ${s})) * u_kernel[${a}]`,++a,a!==n&&(i+=` +
`);return i+=[";","    gl_FragData[0] = vec4((colorSum / u_kernelWeight).rgb, texture2D(u_image, tcoord).a);","}"].join(`
`),i},t.buildVertexBuffer=()=>{const r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),o=Tt.newInstance({numberOfComponents:3,values:r});o.setName("points");const a=Tt.newInstance({numberOfComponents:2,values:n});a.setName("tcoords");const s=Tt.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",li.SURFACE,{points:o,tcoords:a,cellOffset:0}),e.VBOBuildTime.modified()}}const FY={framebuffer:null,convolutionShader:null,tris:null,kernel:[0,0,0,0,1,0,0,0,0],oldKernelDimension:3,kernelDimension:3};function O9(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FY,r),Q1.extend(t,e,r),e.VBOBuildTime={},K.obj(e.VBOBuildTime,{mtime:0}),e.tris=Fa.newInstance(),K.setGet(t,e,["kernel","kernelDimension"]),K.get(t,e,["framebuffer"]),kY(t,e)}const UY=K.newInstance(O9,"vtkConvolution2DPass");var P9={newInstance:UY,extend:O9};function R9(t){let e=bC.newInstance();if(t>0){const r=P9.newInstance();r.setDelegates([e]);const n=Math.max(0,t);r.setKernelDimension(3),r.setKernel([-n,-n,-n,-n,1+8*n,-n,-n,-n,-n]),e=r}return e}function A9(t){let e=bC.newInstance();if(t>0){const r=P9.newInstance();r.setDelegates([e]);const n=Math.min(t,1e3),i=15,a=BY(i,5),s=i*i,c=Math.floor(s/2),l=Array(s).fill(0);l[c]=1;const f=Math.min(n/10,1),u=a.map((d,h)=>(1-f)*l[h]+f*d);r.setKernelDimension(15),r.setKernel(u),e=r}return e}function BY(t,e){const r=[],n=(t-1)/2;let i=0;for(let o=0;o<t;o++)for(let a=0;a<t;a++){const s=a-n,c=o-n,l=Math.exp(-(s*s+c*c)/(2*Math.pow(e,2)));r.push(l),i+=l}return r.map(o=>o/i)}class ir extends Qu{constructor(e){if(super(e),this.useCPURendering=!1,this.sharpening=0,this.smoothing=0,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const o=this.getPan(this.fitToCanvasCamera),a=this.getPan(),s=this.getCamera(),c=Mo([0,0],o,a);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),f=l?Oa([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:f}),this.rotateCamera(i);const u=this.getPan(),d=this.getPan(this.fitToCanvasCamera),h=Mo([0,0],u,d),g=Zr([0,0],o,h);if(this.setPan(g,!1),this._suppressCameraModifiedEvents)return;const p=this.getCamera(),m={previousCamera:s,camera:p,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Xe(this.element,Ge.CAMERA_MODIFIED,m)},this.setSharpening=i=>{this.sharpening=i,this.render()},this.setSmoothing=i=>{this.smoothing=i,this.render()},this.getRenderPasses=()=>{if(!this.shouldUseCustomRenderPass())return null;const i=[];try{return this.smoothing>0&&i.push(A9(this.smoothing)),this.sharpening>0&&i.push(R9(this.sharpening)),i.length?i:null}catch(o){return console.warn("Failed to create custom render passes:",o),null}},this.getDefaultProperties=i=>{let o;return i!==void 0&&(o=this.perVolumeIdDefaultProperties.get(i)),o!==void 0?o:{...this.globalDefaultProperties}},this.getProperties=i=>{if(!this._getApplicableVolumeActor(i))return;const{colormap:a,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}=this.viewportProperties;if(i||=this.getVolumeId(),!Ae.getVolume(i))return null;const h=this.getActors().find(x=>x.referencedId===i);if(!h)return;const p=h.actor.getProperty().getRGBTransferFunction(0),[m,w]=this.viewportProperties?.VOILUTFunction==="SIGMOID"?E9(p):p.getRange(),v={lower:m,upper:w},y=this.getColormap(i);return{colormap:i&&y?y:a,voiRange:v,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u,sharpening:this.sharpening,smoothing:this.smoothing}},this.getColormap=i=>{const o=this._getApplicableVolumeActor(i);if(!o)return;const{volumeActor:a}=o,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),l=c.reduce((h,g)=>(h.push(g.x,g.r,g.g,g.b),h),[]),f=iC(l,a)||{},u=aC(a),d=sC(a);return f.threshold=u,f.opacity=d,f},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:o,flipVertical:a}=this.getCameraNoRotation(),s=a?Oa([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=tC(s,i)*180/Math.PI,l=nn([0,0,0],s,i);return ft(l,o)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorldTiled=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),s=this.getVtkDisplayCoordsTiled(i),f=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().displayToWorld(s[0],s[1],s[2],a);return o.setIsPerformingCoordinateTransformation?.(!1),[f[0],f[1],f[2]]},this.canvasToWorldContextPool=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,f=c/l,[u,d,h,g]=a.getViewport(),p=h-u,m=g-d,w=[i[0]*s,i[1]*s],v=[u+w[0]/c*p,d+(1-w[1]/l)*m,0],y=a.normalizedDisplayToProjection(v[0],v[1],v[2]),C=a.projectionToView(y[0],y[1],y[2],f),x=a.viewToWorld(C[0],C[1],C[2]);return o.setIsPerformingCoordinateTransformation?.(!1),[x[0],x[1],x[2]]},this.getVtkDisplayCoordsTiled=i=>{const o=window.devicePixelRatio||1,a=[i[0]*o,i[1]*o],l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().getSize(),f=[a[0]+this.sx,a[1]+this.sy];return f[1]=l[1]-f[1],[f[0],f[1],0]},this.getVtkDisplayCoordsContextPool=i=>{const o=window.devicePixelRatio||1,a=[i[0]*o,i[1]*o],s=this.getRenderer(),{width:c,height:l}=this.canvas,[f,u,d,h]=s.getViewport(),g=d-f,p=h-u,m=a[0]/c*g*c,w=a[1]/l*p*l,v=[m,p*l-w];return[v[0],v[1],0]},this.worldToCanvasTiled=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...i,a);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy],d=window.devicePixelRatio||1,h=[u[0]/d,u[1]/d];return o.setIsPerformingCoordinateTransformation(!1),h},this.worldToCanvasContextPool=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),{width:s,height:c}=this.canvas,l=s/c,[f,u,d,h]=a.getViewport(),g=d-f,p=h-u,m=a.worldToView(i[0],i[1],i[2]),w=a.viewToProjection(m[0],m[1],m[2],l),v=a.projectionToNormalizedDisplay(w[0],w[1],w[2]),y=(v[0]-f)/g,C=(v[1]-u)/p,x=y*s,T=(1-C)*c,S=window.devicePixelRatio||1,_=[x/S,T/S];return o.setIsPerformingCoordinateTransformation(!1),_},this.hasImageURI=i=>this.getActors().filter(a=>eo(a,"vtkVolume")).some(({uid:a,referencedId:s})=>{const c=Ae.getVolume(s||a);return c?.getImageIdIndex?c.getImageIdIndex(i)!==void 0||c.getImageURIIndex(i)!==void 0:!1}),this.getImageIds=i=>{const o=this._getApplicableVolumeActor(i);if(!o)throw new Error(`No actor found for the given volumeId: ${i}`);const a=o.volumeId,s=Ae.getVolume(a);if(!s)throw new Error(`imageVolume with id: ${a} does not exist in cache`);return s.imageIds},this.renderingPipelineFunctions={worldToCanvas:{tiled:this.worldToCanvasTiled,contextPool:this.worldToCanvasContextPool},canvasToWorld:{tiled:this.canvasToWorldTiled,contextPool:this.canvasToWorldContextPool},getVtkDisplayCoords:{tiled:this.getVtkDisplayCoordsTiled,contextPool:this.getVtkDisplayCoordsContextPool},getRenderer:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},this.useCPURendering=Xf(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");this._configureRenderingPipeline();const r=this.getRenderer(),n=Kq.newInstance();switch(r.setActiveCamera(n),this.type){case Fn.ORTHOGRAPHIC:n.setParallelProjection(!0);break;case Fn.VOLUME_3D:n.setParallelProjection(!0);break;case Fn.PERSPECTIVE:n.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,r=!0){const{viewPlaneNormal:n,viewUp:i}=this._getOrientationVectors(e)||{};if(!n||!i)return;const o=this.getVtkActiveCamera();o.setDirectionOfProjection(-n[0],-n[1],-n[2]),o.setViewUpFrom(i),this.initialViewUp=i,r&&this.resetCamera({resetOrientation:!1,resetRotation:!1})}initializeVolumeNewImageEventDispatcher(){const e=n.bind(this),r=i.bind(this);function n(o){const{viewportId:a}=o.detail;a!==this.id||this.isDisabled||!this.getImageData()||MY(o)}function i(o){const{viewportId:a}=o.detail;a===this.id&&(this.element.removeEventListener(Ge.CAMERA_MODIFIED,e),ke.removeEventListener(Ge.ELEMENT_DISABLED,r),IY(a))}this.element.removeEventListener(Ge.CAMERA_MODIFIED,e),this.element.addEventListener(Ge.CAMERA_MODIFIED,e),ke.addEventListener(Ge.ELEMENT_DISABLED,r)}setVOILUTFunction(e,r,n){Object.values(Ci).includes(e)||(e=Ci.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,r,n),this.viewportProperties.VOILUTFunction=e}setColormap(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i,a=Cc.newInstance();let s=wh(e.name);const{name:c}=e;if(s||(s=mh.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const l=o.getProperty().getRGBTransferFunction(0).getRange();if(a.applyColorMap(s),a.setMappingRange(l[0],l[1]),o.getProperty().setRGBTransferFunction(0,a),this.viewportProperties.colormap=e,!n){const f=this.getColormap(r),u={viewportId:this.id,colormap:f,volumeId:r};Xe(this.element,Ge.VOI_MODIFIED,u),Xe(this.element,Ge.COLORMAP_MODIFIED,u)}}setOpacity(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n,o=qu.newInstance();typeof e.opacity=="number"?K8(i,e.opacity):(e.opacity.forEach(({opacity:c,value:l})=>{o.addPoint(l,c)}),i.getProperty().setScalarOpacity(0,o)),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity;const a=this.getColormap(r),s={viewportId:this.id,colormap:a,volumeId:r};Xe(this.element,Ge.COLORMAP_MODIFIED,s)}setInvert(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const o=i.volumeId,a=this._getOrCreateColorTransferFunction(o);if(Gd(a),this.viewportProperties.invert=e,!n){const s={...this.getVOIModifiedEventDetail(o),invertStateChanged:!0};Xe(this.element,Ge.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const r=this._getApplicableVolumeActor(e);if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);const o=r.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),a=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:o[0],upper:o[1]},volumeId:r.volumeId,VOILUTFunction:s,colormap:a,invert:c}}_getOrCreateColorTransferFunction(e){const r=this._getApplicableVolumeActor(e);if(!r)return null;const{volumeActor:n}=r,i=n.getProperty().getRGBTransferFunction(0);if(i)return i;const o=Cc.newInstance();return n.getProperty().setRGBTransferFunction(0,o),o}setInterpolationType(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,r,n=!1){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i,a=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");if([s.lower,s.upper].some(VY)){console.warn("VOI range contains invalid values, ignoring setVOI request",s);return}const{VOILUTFunction:c}=this.getProperties(a);if(c===Ci.SAMPLED_SIGMOID){const l=cC(s);o.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:f}=s;o.getProperty().getRGBTransferFunction(0).setRange(l,f)}if(!n){const l={...this.getVOIModifiedEventDetail(a)};Xe(this.element,Ge.VOI_MODIFIED,l)}this.viewportProperties.voiRange=s}rotateCamera(e){const r=e-this.getRotation();this.getVtkActiveCamera().roll(-r)}setDefaultProperties(e,r){r==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(r,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const r=super.getViewReference(e),n=this.getVolumeId(e);if(e?.forFrameOfReference!==!1&&(r.volumeId=n),typeof e?.sliceIndex!="number")return r;const{viewPlaneNormal:i}=r,o=e?.sliceIndex-this.getSliceIndex(),{sliceRangeInfo:a}=Bu(this,n,!0),{sliceRange:s,spacingInNormalDirection:c,camera:l}=a,{focalPoint:f,position:u}=l,{newFocalPoint:d}=e0(f,u,s,i,c,o);return r.cameraFocalPoint=d,r}isReferenceViewable(e,r){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,r))return!1;if(r?.withNavigation){const{referencedImageId:o}=e;return!o||this.hasImageURI(o)}const n=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=n&&n<=i[1]:i===void 0||i===n}scroll(e=1){const r=this.getVolumeId(),{sliceRangeInfo:n}=Bu(this,r,!0);if(!n)return;const{sliceRange:i,spacingInNormalDirection:o,camera:a}=n,{focalPoint:s,viewPlaneNormal:c,position:l}=a,{newFocalPoint:f,newPosition:u}=e0(s,l,i,c,o,e);this.setCamera({focalPoint:f,position:u}),this.render()}setBestOrentation(e,r){if(!e&&!r)return;const{viewPlaneNormal:n}=this.getCamera();if(xf(n,r)&&xf(n,e))return;const i=this._getAcquisitionPlaneOrientation();if(xf(i.viewPlaneNormal,r)&&xf(i.viewPlaneNormal,e)){this.setOrientation(i);return}for(const a of Object.values(hc))if(xf(a.viewPlaneNormal,r)&&xf(a.viewPlaneNormal,e)){this.setOrientation(a);return}const o=nn(Ie(),r||i.viewPlaneNormal,e);At(o,o),this.setOrientation({viewPlaneNormal:o})}setViewPlane(e){const{point:r,inPlaneVector1:n,inPlaneVector2:i,FrameOfReferenceUID:o}=e;this.setBestOrentation(n,i),this.setViewReference({FrameOfReferenceUID:o,cameraFocalPoint:r,viewPlaneNormal:this.getCamera().viewPlaneNormal})}setViewReference(e){if(!e)return;const r=this.getVolumeId(),{FrameOfReferenceUID:n,cameraFocalPoint:i,referencedImageId:o,planeRestriction:a,viewPlaneNormal:s,viewUp:c}=e;let{sliceIndex:l}=e;if(a&&!s)return this.setViewPlane(a);const{focalPoint:f,viewPlaneNormal:u,position:d}=this.getCamera(),h=j8(u,s),g=Dt(u,s);if(typeof l=="number"&&r!==void 0&&e.volumeId===r&&(h||g)){const{currentStepIndex:p,sliceRangeInfo:m,numScrollSteps:w}=Bu(this,r,!0),{sliceRange:v,spacingInNormalDirection:y}=m;h&&(l=w-l-1);const C=l-p,{newFocalPoint:x,newPosition:T}=e0(f,d,v,u,y,C);this.setCamera({focalPoint:x,position:T})}else if(n===this.getFrameOfReferenceUID()){if(s&&!h&&!g){this.setOrientation({viewPlaneNormal:s,viewUp:c}),this.setViewReference(e);return}if(o&&this.isInAcquisitionPlane()){const p=ut(Zi.IMAGE_PLANE,o),{imagePositionPatient:m}=p,{focalPoint:w}=this.getCamera(),v=qt(Ie(),w,m),y=ft(v,u),C=tn(Ie(),w,[-u[0],-u[1],-u[2]],y),x=qt(Ie(),C,w),T=nr(Ie(),d,x);this.setCamera({focalPoint:C,position:T}),this.render();return}if(i){const p=qt([0,0,0],i,f),m=s??u,w=ft(p,m);Dt(w,0)||Jn(p,m,w);const v=nr([0,0,0],f,p),y=nr([0,0,0],d,p);this.setCamera({focalPoint:v,position:y})}}else throw new Error(`Incompatible view refs: ${n}!==${this.getFrameOfReferenceUID()}`)}setThreshold(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n;X8(i,e.threshold),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.threshold=e.threshold;const o=this.getColormap(r),a={viewportId:this.id,colormap:o,volumeId:r};Xe(this.element,Ge.COLORMAP_MODIFIED,a)}setProperties({voiRange:e,VOILUTFunction:r,invert:n,colormap:i,preset:o,interpolationType:a,slabThickness:s,sampleDistanceMultiplier:c,sharpening:l,smoothing:f}={},u,d=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:r,invert:n,colormap:i,preset:o,slabThickness:s}),n!==void 0&&this.viewportProperties.invert!==n&&this.setInvert(n,u,d),i?.name&&this.setColormap(i,u,d),i?.opacity!=null&&this.setOpacity(i,u),i?.threshold!=null&&this.setThreshold(i,u),e!==void 0&&this.setVOI(e,u,d),typeof a<"u"&&this.setInterpolationType(a),r!==void 0&&this.setVOILUTFunction(r,u,d),o!==void 0&&this.setPreset(o,u,d),s!==void 0&&this.setSlabThickness(s),c!==void 0&&this.setSampleDistanceMultiplier(c),typeof l<"u"&&this.setSharpening(l),typeof f<"u"&&this.setSmoothing(f)}shouldUseCustomRenderPass(){return!this.useCPURendering}resetToDefaultProperties(e){const r=this.globalDefaultProperties;r.colormap?.name&&this.setColormap(r.colormap,e),r.colormap?.opacity!=null&&this.setOpacity(r.colormap,e),r.voiRange!==void 0&&this.setVOI(r.voiRange,e),r.VOILUTFunction!==void 0&&this.setVOILUTFunction(r.VOILUTFunction,e),r.invert!==void 0&&this.setInvert(r.invert,e),r.slabThickness!==void 0&&(this.setSlabThickness(r.slabThickness),this.viewportProperties.slabThickness=r.slabThickness),r.sampleDistanceMultiplier!==void 0&&this.setSampleDistanceMultiplier(r.sampleDistanceMultiplier),r.preset!==void 0&&this.setPreset(r.preset,e,!1),this.render()}setPreset(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i;let a=e;typeof a=="string"&&(a=fb.find(s=>s.name===e)),a&&(b9(o,a),this.viewportProperties.preset=a,this.render(),n||Xe(this.element,Ge.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:o,presetName:a.name}))}setSampleDistanceMultiplier(e){}async setVolumes(e,r=!1,n=!1){const i=e[0].volumeId,o=Ae.getVolume(i);if(!o)throw new Error(`imageVolume with id: ${i} does not exist, you need to create/allocate the volume first`);const a=o.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,a),this._FrameOfReferenceUID=a,e.forEach(c=>{this._addVolumeId(c.volumeId)});const s=[];for(let c=0;c<e.length;c++){const{volumeId:l,actorUID:f,slabThickness:u,...d}=e[c],h=await Fm(e[c],this.element,this.id,n),g=f||un();s.push({uid:g,actor:h,slabThickness:u,referencedId:l,...d})}this._setVolumeActors(s),this.viewportStatus=Ni.PRE_RENDER,this.initializeColorTransferFunction(e),Xe(this.element,Ge.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:s}),r&&this.render()}async addVolumes(e,r=!1,n=!1){const i=Ae.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const o=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(a=>{this._addVolumeId(a.volumeId)});for(let a=0;a<e.length;a++){const{volumeId:s,visibility:c,actorUID:l,slabThickness:f,...u}=e[a],d=await Fm(e[a],this.element,this.id,n);c||d.setVisibility(!1);const h=l||un();o.push({uid:h,actor:d,slabThickness:f,referencedId:s,...u})}this.addActors(o),this.initializeColorTransferFunction(e),r&&this.render()}removeVolumeActors(e,r=!1){this.removeActors(e),r&&this.render()}setOrientation(e,r=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const r=e[0].volumeId,n=this._getOrCreateColorTransferFunction(r);!this.initialTransferFunctionNodes&&n&&(this.initialTransferFunctionNodes=Dm(n))}_getApplicableVolumeActor(e){const r=this.getActors();if(!r?.length)return;if(e){const i=r.find(o=>o.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const n=r[0];return{volumeActor:n.actor,volumeId:n.referencedId,actorUID:n.uid}}async _isValidVolumeInputArray(e,r){const n=e.length;for(let i=1;i<n;i++){const o=Ae.getVolume(e[i].volumeId);if(r!==o.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const r of this.volumeIds)if(r.includes(e))return!0;return!1}getImageData(e){if(!this.getDefaultActor())return;e||=this.getVolumeId();const n=this.getActors()?.find(s=>s.referencedId===e);if(!eo(n,"vtkVolume"))return;const i=n.actor,o=Ae.getVolume(e),a=i.getMapper().getInputData();return{dimensions:a.getDimensions(),spacing:a.getSpacing(),origin:a.getOrigin(),direction:a.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:o?.metadata?.Modality,FrameOfReferenceUID:o?.metadata?.FrameOfReferenceUID},get scalarData(){return o?.voxelManager?.getScalarData()},scaling:o?.scaling,hasPixelSpacing:!0,voxelManager:o?.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,r){super.setCamera(e,r),this.setCameraClippingRange()}_setVolumeActors(e){for(let r=0;r<e.length;r++)this.viewportProperties.invert=!1;this.setActors(e)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getViewUp(e){const{viewUp:r}=this.getCamera(),n=ft(r,e);if(Dt(n,0))return r;if(qp(e[0],1))return[0,0,1];if(qp(e[1],1))return[0,0,1];if(qp(e[2],1))return[0,-1,0];const i=tn(Ie(),r,e,-n);return At(i,i),i}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal)return{...e,viewUp:e.viewUp||this._getViewUp(e.viewPlaneNormal)};throw new Error("Invalid orientation object. It must contain viewPlaneNormal")}else if(typeof e=="string"){if(e==="acquisition")return this._getAcquisitionPlaneOrientation();if(e==="reformat"||e.includes("_reformat"))return I9(this,{useViewportNormal:!0});if(hc[e])return this.viewportProperties.orientation=e,hc[e]}throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(hc).join(", ")}`)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const r=this.getVolumeId(),n=Ae.getVolume(r);if(!n)throw new Error(`imageVolume with id: ${r} does not exist in cache`);const{direction:i}=n,o=i.slice(6,9).map(s=>-s),a=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:o,viewUp:a}}getSlabThickness(){const e=this.getActors();let r=Cr.MINIMUM_SLAB_THICKNESS;return e.forEach(n=>{n.slabThickness>r&&(r=n.slabThickness)}),r}getIntensityFromWorld(e){const r=this.getDefaultActor();if(!eo(r,"vtkVolume"))return;const{actor:n}=r,i=n.getMapper().getInputData(),o=Ae.getVolume(this.getVolumeId()),a=Lr(i,e);return o.voxelManager.getAtIJKPoint(a)}getVolumeId(e){const r=this.getActors();if(!r)return;if(!e?.volumeId){const i=r.find(o=>o.actor.getClassName()==="vtkVolume");return i?.referencedId||i?.uid}const n=r.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===e?.volumeId);return n?.referencedId||n?.uid}getViewReferenceId(e={}){let{volumeId:r,sliceIndex:n}=e;if(!r){const l=this.getActors();if(!l)return;r=l.find(f=>f.actor.getClassName()==="vtkVolume")?.referencedId}const i=this.getSliceIndex();n??=i;const{viewPlaneNormal:o,focalPoint:a}=this.getCamera(),s=r.includes("?")?"&":"?",c=o.map(l=>l.toFixed(3)).join(",");return`volumeId:${r}${s}sliceIndex=${n}&viewPlaneNormal=${c}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}_configureRenderingPipeline(){const e=M9();for(const r in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,r)){const n=this.renderingPipelineFunctions[r];this[r]=e?n.contextPool:n.tiled}}}function xf(t,e){return!e||Dt(ft(t,e),0)}function GY(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(K.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),Xu())}const WY={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1],colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024};function $Y(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WY,r),MC.extend(t,e,r),K.setGet(t,e,["slice","useCustomExtents","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),K.setGetArray(t,e,["customDisplayExtent"],6),K.setGetArray(t,e,["backgroundColor"],4),GY(t,e)}var zY={extend:$Y};function L9(t,e,r){const n=r.getCurrentImage(),i=n.getExtent(),o=[i[0],i[2],i[4]],{ijkMode:a}=r.getClosestIJKAxis();let s=r.isA("vtkImageArrayMapper")?r.getSubSlice():r.getSlice();a!==r.getSlicingMode()&&(s=r.getSliceAtPosition(s)),o[a]+=s;const c=[0,0,0];n.indexToWorld(o,c),o[a]+=1;const l=[0,0,0];n.indexToWorld(o,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],At(l,l);const f=tr.intersectWithLine(t,e,c,l);if(f.intersection){const u=f.x,d=[0,0,0];return n.worldToIndex(u,d),{t:f.t,absoluteIJK:d}}return null}function jY(t,e,r){const n=L9(t,e,r);if(n){const o=r.getCurrentImage().getExtent(),a=[Math.round(n.absoluteIJK[0]),Math.round(n.absoluteIJK[1]),Math.round(n.absoluteIJK[2])];return a[0]<o[0]||a[0]>o[1]||a[1]<o[2]||a[1]>o[3]||a[2]<o[4]||a[2]>o[5]?null:{t:n.t,ijk:a}}return null}function HY(t,e,r){const n=L9(t,e,r);if(n){const o=r.getCurrentImage().getExtent(),a=n.absoluteIJK,s=[Math.floor(a[0]),Math.floor(a[1]),Math.floor(a[2])];if(s[0]<o[0]||s[0]>o[1]-1||s[1]<o[2]||s[1]>o[3]-1||s[2]<o[4]||s[2]>(o[5]?o[5]-1:o[5]))return null;const c=[a[0]-s[0],a[1]-s[1],a[2]-s[2]];return{t:n.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:KY,otherStaticMethods:XY}=J1,{SlicingMode:Pn}=Z1;function qY(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=n=>{const i=t.getCurrentImage();let o;if(n.length===3)o=n;else if(Number.isFinite(n)){const f=i.getBounds();switch(e.slicingMode){case Pn.X:o=[n,(f[3]+f[2])/2,(f[5]+f[4])/2];break;case Pn.Y:o=[(f[1]+f[0])/2,n,(f[5]+f[4])/2];break;case Pn.Z:o=[(f[1]+f[0])/2,(f[3]+f[2])/2,n];break}}const a=[0,0,0];i.worldToIndex(o,a);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case Pn.I:l=ba(a[0],s[0],s[1]);break;case Pn.J:l=ba(a[1],s[2],s[3]);break;case Pn.K:l=ba(a[2],s[4],s[5]);break;default:return 0}return l},t.setSliceFromCamera=n=>{const i=n.getFocalPoint();switch(e.slicingMode){case Pn.I:case Pn.J:case Pn.K:{const o=t.getSliceAtPosition(i);t.setSlice(o)}break;case Pn.X:t.setSlice(i[0]);break;case Pn.Y:t.setSlice(i[1]);break;case Pn.Z:t.setSlice(i[2]);break}},t.setXSlice=n=>{t.setSlicingMode(Pn.X),t.setSlice(n)},t.setYSlice=n=>{t.setSlicingMode(Pn.Y),t.setSlice(n)},t.setZSlice=n=>{t.setSlicingMode(Pn.Z),t.setSlice(n)},t.setISlice=n=>{t.setSlicingMode(Pn.I),t.setSlice(n)},t.setJSlice=n=>{t.setSlicingMode(Pn.J),t.setSlice(n)},t.setKSlice=n=>{t.setSlicingMode(Pn.K),t.setSlice(n)},t.getSlicingModeNormal=()=>{const n=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case Pn.X:n[0]=1;break;case Pn.Y:n[1]=1;break;case Pn.Z:n[2]=1;break;case Pn.I:zp(i,[1,0,0],n);break;case Pn.J:zp(i,[0,1,0],n);break;case Pn.K:zp(i,[0,0,1],n);break}return n};function r(){let n;switch(e.slicingMode){case Pn.X:n=0;break;case Pn.Y:n=1;break;case Pn.Z:n=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),o=y8(i);let a=0;for(;a<3&&o[n+3*a]===0;++a);const s=o[n+3*a]<0;e.closestIJKAxis={ijkMode:a,flip:s}}t.setSlicingMode=n=>{e.slicingMode!==n&&(e.slicingMode=n,t.getCurrentImage()&&r(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Pn.NONE)&&t.getCurrentImage()&&r(),e.closestIJKAxis),t.getBounds=()=>{const n=t.getCurrentImage();if(!n)return Xu();if(!e.useCustomExtents)return n.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:o}=t.getClosestIJKAxis();let a=e.slice;switch(o!==e.slicingMode&&(a=t.getSliceAtPosition(e.slice)),o){case Pn.I:i[0]=a,i[1]=a;break;case Pn.J:i[2]=a,i[3]=a;break;case Pn.K:i[4]=a,i[5]=a;break}return n.extentToBounds(i)},t.getBoundsForSlice=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const o=t.getCurrentImage();if(!o)return Xu();const a=o.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=n;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(n)),s){case Pn.I:a[0]=c-i,a[1]=c+i;break;case Pn.J:a[2]=c-i,a[3]=c+i;break;case Pn.K:a[4]=c-i,a[5]=c+i;break}return o.extentToBounds(a)},t.intersectWithLineForPointPicking=(n,i)=>jY(n,i,t),t.intersectWithLineForCellPicking=(n,i)=>HY(n,i,t),t.getCurrentImage=()=>t.getInputData()}const YY={slicingMode:Pn.NONE,closestIJKAxis:{ijkMode:Pn.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function N9(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YY,r),zY.extend(t,e,r),K.get(t,e,["slicingMode"]),K.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),J1.implementCoincidentTopologyMethods(t,e),qY(t,e)}const JY=K.newInstance(N9,"vtkImageMapper");var ZY={newInstance:JY,extend:N9,...KY,...XY,...Z1};const{InterpolationType:rm}=w$,{vtkErrorMacro:o_}=K,im=4;function QY(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let r=e.mtime,n;for(let i=0;i<im;i++)e.componentData[i].rGBTransferFunction&&(n=e.componentData[i].rGBTransferFunction.getMTime(),r=r>n?r:n),e.componentData[i].piecewiseFunction&&(n=e.componentData[i].piecewiseFunction.getMTime(),r=r>n?r:n);return r},t.setRGBTransferFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),e.componentData[i].rGBTransferFunction!==o?(e.componentData[i].rGBTransferFunction=o,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].rGBTransferFunction},t.setPiecewiseFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),e.componentData[i].piecewiseFunction!==o?(e.componentData[i].piecewiseFunction=o,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].piecewiseFunction},t.setScalarOpacity=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),t.setPiecewiseFunction(i,o)},t.getScalarOpacity=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(r)},t.setComponentWeight=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(r<0||r>=im)return o_("Invalid index"),!1;const i=Math.min(1,Math.max(0,n));return e.componentData[r].componentWeight!==i?(e.componentData[r].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return r<0||r>=im?(o_("Invalid index"),0):e.componentData[r].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(rm.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(rm.LINEAR),t.getInterpolationTypeAsString=()=>K.enumToString(rm,e.interpolationType)}const eJ=t=>({independentComponents:!1,interpolationType:rm.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,updatedExtents:[],...t});function tJ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,eJ(r)),K.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<im;n++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}K.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity","updatedExtents"]),K.setGetArray(t,e,["labelOutlineThickness"]),QY(t,e)}const nJ=K.newInstance(tJ,"vtkImageProperty");var rJ={newInstance:nJ};function iJ(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let r=e.properties[0].getOpacity()>=1;return r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=rJ.newInstance,t.getBoundsForSlice=(r,n)=>{const i=e.mapper.getBoundsForSlice(r,n);if(!hn.isValid(i))return i;t.computeMatrix();const o=new Float64Array(16);return mn(o,e.matrix),hn.transformBounds(i,o)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return e.properties.forEach(n=>{r=Math.max(r,n.getMTime());const i=n.getRGBTransferFunction();i!==null&&(r=Math.max(r,i.getMTime()))}),r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const oJ={mapper:null,forceOpaque:!1,forceTranslucent:!1};function V9(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oJ,r),vC.extend(t,e,r),e.boundsMTime={},K.obj(e.boundsMTime),K.setGet(t,e,["mapper","forceOpaque","forceTranslucent"]),iJ(t,e)}const aJ=K.newInstance(V9,"vtkImageSlice");var sJ={newInstance:aJ,extend:V9};function cJ(t){return Object.values(Ci).includes(t)?t:Ci.LINEAR}function k9(t){const r={...ut(Zi.IMAGE_PLANE,t)};return r.columnPixelSpacing||(r.columnPixelSpacing=1),r.rowPixelSpacing||(r.rowPixelSpacing=1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}function F9(t){const e=t.imageId,{pixelRepresentation:r,bitsAllocated:n,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=ut("imagePixelModule",e),{windowWidth:c,windowCenter:l,voiLUTFunction:f}=t,{modality:u}=ut("generalSeriesModule",e),d=ut("scalingModule",e),h=ut(Zi.CALIBRATION,e),g=cJ(f),p=k9(e);return{calibration:h,scalingFactor:d,voiLUTFunction:g,modality:u,imagePlaneModule:p,imagePixelModule:{bitsAllocated:n,bitsStored:i,samplesPerPixel:s,highBit:o,photometricInterpretation:a,pixelRepresentation:r,windowWidth:c,windowCenter:l,modality:u,voiLUTFunction:g}}}function r2(t){const{imagePlaneModule:e,imagePixelModule:r,voiLUTFunction:n,modality:i,scalingFactor:o,calibration:a}=F9(t);let{rowCosines:s,columnCosines:c}=e;(s==null||c==null)&&(s=[1,0,0],c=[0,1,0]);const l=mt(s[0],s[1],s[2]),f=mt(c[0],c[1],c[2]),u=Ie();nn(u,l,f);let d=e.imagePositionPatient;d==null&&(d=[0,0,0]);const h=e.columnPixelSpacing||t.columnPixelSpacing,g=e.rowPixelSpacing||t.rowPixelSpacing,p=t.columns,m=t.rows,w=Po,v=1;return!r.photometricInterpretation&&t.sizeInBytes===3*t.width*t.height&&(t.numberOfComponents=3),{numberOfComponents:t.numberOfComponents||lJ(r.photometricInterpretation),origin:d,direction:[...l,...f,...u],dimensions:[p,m,v],spacing:[h,g,w],numVoxels:p*m*v,imagePlaneModule:e,imagePixelModule:r,bitsAllocated:r.bitsAllocated,voiLUTFunction:n,modality:i,scalingFactor:o,calibration:a,scanAxisNormal:u}}function lJ(t){let e=1;return(t==="RGB"||t?.includes("YBR")||t==="PALETTE COLOR")&&(e=3),e}var om={exports:{}},uJ=om.exports,a_;function fJ(){return a_||(a_=1,(function(t){(function(e,r){t.exports?t.exports=r():e.log=r()})(uJ,function(){var e=function(){},r="undefined",n=typeof window!==r&&typeof window.navigator!==r&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],o={},a=null;function s(p,m){var w=p[m];if(typeof w.bind=="function")return w.bind(p);try{return Function.prototype.bind.call(w,p)}catch{return function(){return Function.prototype.apply.apply(w,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===r?!1:p==="trace"&&n?c:console[p]!==void 0?s(console,p):console.log!==void 0?s(console,"log"):e}function f(){for(var p=this.getLevel(),m=0;m<i.length;m++){var w=i[m];this[w]=m<p?e:this.methodFactory(w,p,this.name)}if(this.log=this.debug,typeof console===r&&p<this.levels.SILENT)return"No console available for logging"}function u(p){return function(){typeof console!==r&&(f.call(this),this[p].apply(this,arguments))}}function d(p,m,w){return l(p)||u.apply(this,arguments)}function h(p,m){var w=this,v,y,C,x="loglevel";typeof p=="string"?x+=":"+p:typeof p=="symbol"&&(x=void 0);function T(b){var I=(i[b]||"silent").toUpperCase();if(!(typeof window===r||!x)){try{window.localStorage[x]=I;return}catch{}try{window.document.cookie=encodeURIComponent(x)+"="+I+";"}catch{}}}function S(){var b;if(!(typeof window===r||!x)){try{b=window.localStorage[x]}catch{}if(typeof b===r)try{var I=window.document.cookie,O=encodeURIComponent(x),M=I.indexOf(O+"=");M!==-1&&(b=/^([^;]+)/.exec(I.slice(M+O.length+1))[1])}catch{}return w.levels[b]===void 0&&(b=void 0),b}}function _(){if(!(typeof window===r||!x)){try{window.localStorage.removeItem(x)}catch{}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function E(b){var I=b;if(typeof I=="string"&&w.levels[I.toUpperCase()]!==void 0&&(I=w.levels[I.toUpperCase()]),typeof I=="number"&&I>=0&&I<=w.levels.SILENT)return I;throw new TypeError("log.setLevel() called with invalid level: "+b)}w.name=p,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=m||d,w.getLevel=function(){return C??y??v},w.setLevel=function(b,I){return C=E(b),I!==!1&&T(C),f.call(w)},w.setDefaultLevel=function(b){y=E(b),S()||w.setLevel(b,!1)},w.resetLevel=function(){C=null,_(),f.call(w)},w.enableAll=function(b){w.setLevel(w.levels.TRACE,b)},w.disableAll=function(b){w.setLevel(w.levels.SILENT,b)},w.rebuild=function(){if(a!==w&&(v=E(a.getLevel())),f.call(w),a===w)for(var b in o)o[b].rebuild()},v=E(a?a.getLevel():"WARN");var D=S();D!=null&&(C=E(D)),f.call(w)}a=new h,a.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var w=o[m];return w||(w=o[m]=new h(m,a.methodFactory)),w};var g=typeof window!==r?window.log:void 0;return a.noConflict=function(){return typeof window!==r&&window.log===a&&(window.log=g),a},a.getLoggers=function(){return o},a.default=a,a})})(om)),om.exports}var dJ=fJ();const hJ=ka(dJ),U9=hJ.noConflict();typeof window<"u"&&(window.log=U9);function i2(t){const e=U9.getLogger(t[0]);return e.getLogger=(...r)=>i2(`${t}.${r.join(".")}`),e}function zC(...t){return i2(t.join("."))}const V0=i2("cs3d"),jC=V0.getLogger("core"),gJ=V0.getLogger("tools"),pJ=V0.getLogger("dicomImageLoader"),mJ=V0.getLogger("ai"),vJ=V0.getLogger("examples"),yJ=zC("consistency","dicom"),wJ=zC("consistency","image"),CJ=Object.freeze(Object.defineProperty({__proto__:null,aiLog:mJ,coreLog:jC,cs3dLog:V0,dicomConsistencyLog:yJ,examplesLog:vJ,getLogger:zC,getRootLogger:i2,imageConsistencyLog:wJ,loaderLog:pJ,toolsLog:gJ},Symbol.toStringTag,{value:"Module"}));function B9(t){const e=Cc.newInstance();let r=0,n=1024;return t.lower!==void 0&&t.upper!==void 0&&(r=t.lower,n=t.upper),e.addRGBPoint(r,0,0,0),e.addRGBPoint(n,1,1,1),e}function o2(t,e){const r=e.voxelManager.getScalarData();if(!t.getPointData)return;const n=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let o=0;o<e.columns*e.rows;o++)i[o*3]=r[o*4],i[o*3+1]=r[o*4+1],i[o*3+2]=r[o*4+2];e.rgba=!1,e.getPixelData=()=>i,n.set(i)}else n.set(r);t.modified()}function ln(){return window.performance?performance.now():Date.now()}function xJ(t,e){return function(r){const n=((r-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(n,0),255)}}function TJ(t){const r=Math.max(...t.lut).toString(2).length-8,n=t.lut[0]>>r,i=t.lut[t.lut.length-1]>>r,o=t.firstValueMapped+t.lut.length-1;return function(a){return a<t.firstValueMapped?n:a>=o?i:t.lut[a-t.firstValueMapped]>>r}}function G9(t,e,r){return r?TJ(r):xJ(t,e)}function SJ(t,e,r,n,i){const o=t.maxPixelValue,a=t.minPixelValue,s=Math.min(a,0);if(t.cachedLut===void 0){const f=o-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const c=t.cachedLut.lutArray,l=G9(Array.isArray(e)?e[0]:e,Array.isArray(r)?r[0]:r,i);if(n)for(let f=a;f<=o;f++)c[f+-s]=255-l(f);else for(let f=a;f<=o;f++)c[f+-s]=l(f);return c}function _J(t,e,r){let n=ln();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ln()-n;const o=t.minPixelValue;let a=0,s=0;const c=i.length;if(n=ln(),o<0)for(;s<c;)r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=255;else for(;s<c;)r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-n}function EJ(t,e,r){let n=ln();const i=t.getPixelData();t.stats.lastGetPixelDataTime=ln()-n;const o=t.minPixelValue;let a=0,s=0;const c=i.length;if(n=ln(),o<0)for(;s<c;)r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=i[s++];else for(;s<c;)r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-n}class k0{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new k0;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const r=this.m[0]*e[0]+this.m[2]*e[1],n=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],o=this.m[1]*e[2]+this.m[3]*e[3],a=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this.m[4]=a,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),r=this.m[3]*e,n=-this.m[1]*e,i=-this.m[2]*e,o=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this.m[4]=a,this.m[5]=s}rotate(e){const r=Math.cos(e),n=Math.sin(e),i=this.m[0]*r+this.m[2]*n,o=this.m[1]*r+this.m[3]*n,a=this.m[0]*-n+this.m[2]*r,s=this.m[1]*-n+this.m[3]*r;this.m[0]=i,this.m[1]=o,this.m[2]=a,this.m[3]=s}translate(e,r){this.m[4]+=this.m[0]*e+this.m[2]*r,this.m[5]+=this.m[1]*e+this.m[3]*r}scale(e,r){this.m[0]*=e,this.m[1]*=e,this.m[2]*=r,this.m[3]*=r}transformPoint(e){const r=e[0],n=e[1];return[r*this.m[0]+n*this.m[2]+this.m[4],r*this.m[1]+n*this.m[3]+this.m[5]]}}function Eh(t,e){const r=new k0;if(!t.viewport.displayedArea)return r;r.translate(t.canvas.width/2,t.canvas.height/2);const n=t.viewport.rotation;n!==0&&r.rotate(n*Math.PI/180);let i=t.viewport.scale,o=t.viewport.scale;const a=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(o*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,o=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*o),l=t.canvas.width/(a*i);i=o=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(o*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return r.scale(i,o),n!==0&&r.rotate(-n*Math.PI/180),r.translate(t.viewport.translation.x,t.viewport.translation.y),n!==0&&r.rotate(n*Math.PI/180),t.viewport.hflip&&r.scale(-1,1),t.viewport.vflip&&r.scale(1,-1),r.translate(-a/2,-s/2),r}function HC(t,e,r){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=Eh(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function KC(t,e){const r=t.renderingTools.lastRenderedImageId,n=t.renderingTools.lastRenderedViewport;return e.imageId!==r||!n||n.windowCenter!==t.viewport.voi.windowCenter||n.windowWidth!==t.viewport.voi.windowWidth||n.invert!==t.viewport.invert||n.rotation!==t.viewport.rotation||n.hflip!==t.viewport.hflip||n.vflip!==t.viewport.vflip||n.modalityLUT!==t.viewport.modalityLUT||n.voiLUT!==t.viewport.voiLUT||n.colormap!==t.viewport.colormap}function Bm(t,e){const r=t.renderingTools.renderCanvas;r.width=e.width,r.height=e.height;const n=r.getContext("2d");n.fillStyle="white",n.fillRect(0,0,r.width,r.height);const i=n.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=n,t.renderingTools.renderCanvasData=i}function XC(t){const e=t.image.imageId,r=t.viewport,n=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=n,t.renderingTools.lastRenderedViewport={windowCenter:r.voi.windowCenter,windowWidth:r.voi.windowWidth,invert:r.invert,rotation:r.rotation,hflip:r.hflip,vflip:r.vflip,modalityLUT:r.modalityLUT,voiLUT:r.voiLUT,colormap:r.colormap},t.renderingTools}const W9="viewport-element",$9="cornerstone-canvas",vc=1e-4;let v5;function yg(t,e=512,r=512){const n=v5?v5(e,r):document.createElement("canvas");return t&&(n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.style.imageRendering="pixelated",n.classList.add($9),t.appendChild(n)),n}function z9(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(W9),t.appendChild(e),e}function bJ(t){v5=t}function Oo(t){const e=`canvas.${$9}`,r=`div.${W9}`,n=t.querySelector(r)||z9(t),i=n.querySelector(e);if(i)return i;const o=yg(n),a=n.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(a.width*s),l=Math.ceil(a.height*s);return o.width=c,o.height=l,o}function DJ(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(SJ(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function IJ(t,e,r){const n=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!n)&&(t.renderingTools.renderCanvas=yg(null,e.width,e.height));const i=t.renderingTools.renderCanvas,{windowWidth:o,windowCenter:a}=t.viewport.voi;if((o===256||o===255)&&(a===128||a===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!KC(t,e)&&!r)return i;(!t.renderingTools.renderCanvasContext||i.width!==e.width||i.height!==e.height)&&Bm(t,e);let s=ln();const c=DJ(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=ln()-s;const l=t.renderingTools.renderCanvasData,f=t.renderingTools.renderCanvasContext;return e.rgba?EJ(e,c,l.data):_J(e,c,l.data),s=ln(),f.putImageData(l,0,0),e.stats.lastPutImageDataTime=ln()-s,i}function MJ(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,HC(t,n);const i=IJ(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=XC(t)}function OJ(t,e,r){let n=ln();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ln()-n;const o=i.length,a=t.minPixelValue;let s=3,c=0;if(n=ln(),i instanceof Int16Array)if(a<0)for(;c<o;)r[s]=e[i[c++]+-a],s+=4;else for(;c<o;)r[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<o;)r[s]=e[i[c++]],s+=4;else if(a<0)for(;c<o;)r[s]=e[i[c++]+-a],s+=4;else for(;c<o;)r[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-n}function PJ(t,e,r){let n=ln();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ln()-n;const o=i.length;let a=3,s=0;for(n=ln();s<o;)r[a]=e(i[s++]),a+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-n}function RJ(t,e,r){let n=ln();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ln()-n;const o=i.length,a=t.minPixelValue;let s=0,c=0,l;if(n=ln(),i instanceof Int16Array)if(a<0)for(;c<o;)l=e[i[c++]+-a],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else if(i instanceof Uint16Array)for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else if(a<0)for(;c<o;)l=e[i[c++]+-a],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-n}function AJ(t,e){if(LJ(t))return;const r=e.maxPixelValue*e.slope+e.intercept,n=e.minPixelValue*e.slope+e.intercept,i=r-n,o=(r+n)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:o,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=o)}function LJ(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function s_(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function NJ(t,e){return r=>r*t+e}function VJ(t){const e=t.lut[0],r=t.lut[t.lut.length-1],n=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=n?r:t.lut[i]}function kJ(t,e,r){return r?VJ(r):NJ(t,e)}function FJ(t,e,r,n,i,o){const a=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const d=a-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(d)}const l=t.cachedLut.lutArray,f=kJ(t.slope,t.intercept,i),u=G9(e,r,o);if(t.isPreScaled)if(n)for(let d=s;d<=a;d++)l[d+-c]=255-u(d);else for(let d=s;d<=a;d++)l[d+-c]=u(d);else if(n)for(let d=s;d<=a;d++)l[d+-c]=255-u(f(d));else for(let d=s;d<=a;d++)l[d+-c]=u(f(d));return l}function j9(t,e,r){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&s_(t.cachedLut.modalityLUT,e.modalityLUT)&&s_(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!r||(AJ(e,t),FJ(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function UJ(t,e,r,n=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=yg(null,e.width,e.height),Bm(t,e));const o=t.renderingTools.renderCanvas;if(!KC(t,e)&&!r)return o;(o.width!==e.width||o.height!==e.height)&&Bm(t,e),e.stats=e.stats||{};const a=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=ln();e.stats.lastLutGenerateTime=ln()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:f,windowCenter:u}=l.voi,d=u-f/2,p=255/(u+f/2-d);let m;l.invert?m=w=>255-(w-d)*p:m=w=>(w-d)*p,PJ(e,m,a.data)}else{const f=j9(e,l,r);n?OJ(e,f,a.data):RJ(e,f,a.data)}return c=ln(),s.putImageData(a,0,0),e.stats.lastPutImageDataTime=ln()-c,o}function BJ(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,HC(t,n);const i=UJ(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=XC(t)}const y5=0,w5=1,GJ=2;function WJ(t,e,r){if(t>1)throw new Error("HSVToRGB expects hue < 1");const n=[];if(e===0)return n[0]=r,n[1]=r,n[2]=r,n;const i=Math.floor(t*6),o=6*t-i,a=r*(1-e),s=r*(1-e*o),c=r*(1-e*(1-o));switch(i){case 0:case 6:n[0]=r,n[1]=c,n[2]=a;break;case 1:n[0]=s,n[1]=r,n[2]=a;break;case 2:n[0]=a,n[1]=r,n[2]=c;break;case 3:n[0]=a,n[1]=s,n[2]=r;break;case 4:n[0]=c,n[1]=a,n[2]=r;break;case 5:n[0]=r,n[1]=a,n[2]=s;break}return n}function $J(t,e){let r;return t<e.Range[0]?r=e.MaxIndex+y5+1.5:t>e.Range[1]?r=e.MaxIndex+w5+1.5:r=(t+e.Shift)*e.Scale,Math.floor(r)}class qC{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,r){this.TableRange[0]=e,this.TableRange[1]=r}setHueRange(e,r){this.HueRange[0]=e,this.HueRange[1]=r}setSaturationRange(e,r){this.SaturationRange[0]=e,this.SaturationRange[1]=r}setValueRange(e,r){this.ValueRange[0]=e,this.ValueRange[1]=r}setRange(e,r){this.InputRange[0]=e,this.InputRange[1]=r}setAlphaRange(e,r){this.AlphaRange[0]=e,this.AlphaRange[1]=r}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const r=this.NumberOfColors-1;let n,i,o,a;r?(n=(this.HueRange[1]-this.HueRange[0])/r,i=(this.SaturationRange[1]-this.SaturationRange[0])/r,o=(this.ValueRange[1]-this.ValueRange[0])/r,a=(this.AlphaRange[1]-this.AlphaRange[0])/r):n=i=o=a=0;for(let s=0;s<=r;s++){const c=this.HueRange[0]+s*n,l=this.SaturationRange[0]+s*i,f=this.ValueRange[0]+s*o,u=this.AlphaRange[0]+s*a,d=WJ(c,l,f),h=[0,0,0,0];switch(this.Ramp){case"scurve":h[0]=Math.floor(127.5*(1+Math.cos((1-d[0])*Math.PI))),h[1]=Math.floor(127.5*(1+Math.cos((1-d[1])*Math.PI))),h[2]=Math.floor(127.5*(1+Math.cos((1-d[2])*Math.PI))),h[3]=Math.floor(u*255);break;case"linear":h[0]=Math.floor(d[0]*255+.5),h[1]=Math.floor(d[1]*255+.5),h[2]=Math.floor(d[2]*255+.5),h[3]=Math.floor(u*255+.5);break;case"sqrt":h[0]=Math.floor(Math.sqrt(d[0])*255+.5),h[1]=Math.floor(Math.sqrt(d[1])*255+.5),h[2]=Math.floor(Math.sqrt(d[2])*255+.5),h[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(h)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,r=e+y5,n=e+w5,i=e+GJ;this.UseBelowRangeColor||e===0?this.Table[r]=this.BelowRangeColor:this.Table[r]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const r=this.getIndex(e);if(r<0)return this.NaNColor;if(r===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(r===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[r]}getIndex(e){const r={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?r.Scale=Number.MAX_VALUE:r.Scale=r.MaxIndex/(this.TableRange[1]-this.TableRange[0]),r.Range[0]=this.TableRange[0],r.Range[1]=this.TableRange[1],isNaN(e))return-1;let n=$J(e,r);return n===this.NumberOfColors+y5?n=0:n===this.NumberOfColors+w5&&(n=this.NumberOfColors-1),n}setTableValue(e,r,n,i,o){let a;if(typeof r=="number"&&n!==void 0&&i!==void 0&&o!==void 0)a=[r,n,i,o];else if(Array.isArray(r))a=r;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=a,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const c_=[0,0,0,0];function zJ(t,e,r){r=r===null?100:r;const n=(e-t)/(r-1),i=[];for(;r-- >0;)i.push(t),t+=n;return i[i.length-1]=e,i}function jJ(t,e){let r=0,n=t.length-1;for(;r<=n;){const i=r+Math.floor((n-r)/2),o=t[i];if(o===e)return i;e<o?n=i-1:r=i+1}return r}function HJ(t,e){let r;const n=[],i=e.length;for(t.sort(function(o,a){return o-a}),r=0;r<i;r++)n[r]=jJ(t,e[r]);return n}function Ov(t,e,r){let n;const i=[],o=[],a=[],s=[];for(r=r===null?1:r,n=0;n<e.length;n++){const f=e[n];i.push((t-1)*f[0]),o.push(f[1]),a.push(f[1])}const c=zJ(0,1,t);for(n=0;n<t;n++)c[n]=(t-1)*Math.pow(c[n],r);const l=HJ(i,c);for(n=1;n<t-1;n++){const f=l[n],u=(c[n]-i[f-1])/(i[f]-i[f-1]),d=o[f]-a[f-1];s[n]=u*d+a[f-1]}return s[0]=a[0],s[t-1]=o[e.length-1],s}function KJ(t,e,r){let n;const i=[];e=e===null?256:e,r=r===null?1:r;const o=Ov(e,t.red,r),a=Ov(e,t.green,r),s=Ov(e,t.blue,r);for(n=0;n<e;n++){const c=Math.round(o[n]*255),l=Math.round(a[n]*255),f=Math.round(s[n]*255),u=[c,l,f,255];i.push(u)}return i}function XJ(t,e){let r=zy[t];return r||(r=zy[t]={name:"",colors:[]}),!r.colors&&r.segmentedData&&(r.colors=KJ(r.segmentedData,r.numColors,r.gamma)),{getId(){return t},getColorSchemeName(){return r.name},setColorSchemeName(i){r.name=i},getNumberOfColors(){return r.colors.length},setNumberOfColors(i){for(;r.colors.length<i;)r.colors.push(c_);r.colors.length=i},getColor(i){return this.isValidIndex(i)?r.colors[i]:c_},getColorRepeating(i){const o=r.colors.length;return i=o?i%o:0,this.getColor(i)},setColor(i,o){this.isValidIndex(i)&&(r.colors[i]=o)},addColor(i){r.colors.push(i)},insertColor(i,o){this.isValidIndex(i)&&r.colors.splice(i,1,o)},removeColor(i){this.isValidIndex(i)&&r.colors.splice(i,1)},clearColors(){r.colors=[]},buildLookupTable(i){if(!i)return;const o=r.colors.length;i.setNumberOfTableValues(o);for(let a=0;a<o;a++)i.setTableValue(a,r.colors[a])},createLookupTable(){const i=new qC;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<r.colors.length}}}function qJ(t,e,r,n){let i=ln();const o=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ln()-i;const a=o.length,s=t.minPixelValue;let c=0,l=0,f,u,d;if(i=ln(),r instanceof qC?d=r.Table:d=r,s<0)for(;l<a;)f=e[o[l++]+-s],u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];else for(;l<a;)f=e[o[l++]],u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-i}function YJ(t,e,r,n){let i=ln();const o=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ln()-i;const a=o.length,s=t.minPixelValue;let c=0,l=0,f,u,d;if(i=ln(),r instanceof qC?d=r.Table:d=r,s<0)for(;l<a;)f=e(o[l++]+-s),u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];else for(;l<a;)f=e(o[l++]),u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=ln()-i}function C5(t,e,r){return Math.max(e,Math.min(r,t))}function JJ(t,e,r){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=yg(null,e.width,e.height));const n=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=XJ(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const o=i.getId();if(!KC(t,e)&&!r&&t.renderingTools.colormapId===o)return n;(!t.renderingTools.renderCanvasContext||n.width!==e.width||n.height!==e.height)&&Bm(t,e);let a=ln();(!t.renderingTools.colorLUT||r||t.renderingTools.colormapId!==o)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=o);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,f=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:d}=l.voi,h=d-u/2,m=255/(d+u/2-h);let w;l.invert?w=v=>C5(Math.floor(255-(v-h)*m),0,255):w=v=>C5(Math.floor((v-h)*m),0,255),YJ(e,w,f,s.data)}else{const u=j9(e,t.viewport,r);e.stats=e.stats||{},e.stats.lastLutGenerateTime=ln()-a,qJ(e,u,f,s.data)}return a=ln(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=ln()-a,n}function ZJ(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,HC(t,n);const i=JJ(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=XC(t)}function H9(t,e){const r=t.image;if(!t.canvas||!t.image)return;const n=ln();if(r.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},r){let o=r.render;o||(t.viewport.colormap?o=ZJ:r.color?o=MJ:o=BJ),o(t,e)}const i=ln()-n;r.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function K9(t){return Eh(t)}function cp(t,e){const r=K9(t);return r.invert(),r.transformPoint(e)}const QJ={viewport:{}};function eZ(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function tZ(){const t=eZ(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:Ci.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,QJ.viewport)}function zd(t,e){if(t==null)throw new Error(e)}function nZ(t){return!(t==null||t===0||t===180)}function X9(t,e=null){return zd(t,"getImageSize: parameter image must not be undefined"),zd(t.width,"getImageSize: parameter image must have width"),zd(t.height,"getImageSize: parameter image must have height"),nZ(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function YC(t,e,r=null){zd(t,"getImageScale: parameter canvas must not be undefined"),zd(e,"getImageScale: parameter image must not be undefined");const n=X9(e,r),i=e.rowPixelSpacing||1,o=e.columnPixelSpacing||1;let a=1,s=1;i<o?s=o/i:a=i/o;const c=t.height/n.height/a,l=t.width/n.width/s;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function q9(t,e,r,n){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return tZ();const i=YC(t,e,0).scaleFactor;let o;return r==="PT"&&e.isPreScaled?o={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(o={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:o,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:r,voiLUT:e.voiLUT,colormap:n!==void 0?n:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function l_(t,e){return K9(t).transformPoint(e)}function rZ(t){const{image:e}=t;t.viewport.scale=YC(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function iZ(t){const{canvas:e}=t,{clientWidth:r,clientHeight:n}=e;(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}function oZ(t,e,r){const n=t.viewport.scale,i=X9(t.image,t.viewport.rotation),o=Math.round(i.width*n),a=Math.round(i.height*n),s=t.viewport.translation.x,c=t.viewport.translation.y;return o===e&&a<=r||o<=e&&a===r&&s===0&&c===0}function aZ(t,e,r){const n=t.viewport.scale,i=t.canvas.width,o=t.canvas.height,a=i/e,s=o/r,c=Math.sqrt(a*s);t.viewport.scale=c*n}function sZ(t,e=!1){const r=t.canvas.width,n=t.canvas.height;iZ(t),t.image!==void 0&&(e||oZ(t,r,n)?rZ(t):aZ(t,r,n))}function cZ(t,e){const{hflip:r,vflip:n,rotation:i}=e;if(t.x*=r?-1:1,t.y*=n?-1:1,i!==0){const o=i*Math.PI/180,a=Math.cos(o),s=Math.sin(o),c=t.x*a-t.y*s,l=t.x*s+t.y*a;t.x=c,t.y=l}return t}function lZ(t,e=!0,r=!0){const{canvas:n,image:i,viewport:o}=t,a=YC(n,i,0).scaleFactor;o.vflip=!1,o.hflip=!1,e&&(o.translation.x=0,o.translation.y=0),r&&(o.displayedArea.tlhc.x=1,o.displayedArea.tlhc.y=1,o.displayedArea.brhc.x=i.columns,o.displayedArea.brhc.y=i.rows,o.scale=a)}const u_=jC.getLogger("utilities","getClosestImageId");function _c(t,e,r,n){const{direction:i,spacing:o,imageIds:a}=t,{ignoreSpacing:s=!1}=n||{};if(!a?.length)return;const c=i.slice(6,9),l=ft(c,r);if(Math.abs(l)<1-Po)return;let f;s||(f=Ll({direction:i,spacing:o},r)/2);let u,d=1/0;for(let h=0;h<a.length;h++){const g=a[h],p=ut("imagePlaneModule",g);if(!p?.imagePositionPatient){u_.warn(`Missing imagePositionPatient for imageId: ${g}`);continue}const{imagePositionPatient:m}=p,w=Ie();an(w,e,m);const v=Math.abs(ft(w,r));s?v<d&&(d=v,u=g):v<f&&v<d&&(d=v,u=g)}return u===void 0&&u_.warn("No imageId found within the specified criteria (half spacing or absolute closest)."),u}function uZ(t,e){const r=ft(t,e),n=Jn(Ie(),e,2*r);return an(Ie(),t,n)}function f_(t,e,r,n){let i=ea(t);if(r&&Oa(i,i),e){const o=nn(Ie(),n,i);At(o,o),i=uZ(i,o)}return i}const d_=jC.getLogger("RenderingEngine","StackViewport");class qn extends Qu{constructor(e){super(e),this.imageIds=[],this.imageKeyToIndexMap=new Map,this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.sharpening=0,this.smoothing=0,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.setSharpening=r=>{this.sharpening=r,this.render()},this.setSmoothing=r=>{this.smoothing=r,this.render()},this.getRenderPasses=()=>{if(!this.shouldUseCustomRenderPass())return null;const r=[];try{return this.smoothing>0&&r.push(A9(this.smoothing)),this.sharpening>0&&r.push(R9(this.sharpening)),r.length?r:null}catch(n){return console.warn("Failed to create custom render passes:",n),null}},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&sZ(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=r=>this.getImagePlaneReferenceData(r)?.FrameOfReferenceUID,this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=r=>{const n=ZY.newInstance();n.setInputData(r);const i=sJ.newInstance();return i.setMapper(n),r.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=r=>{let n;return r!==void 0&&(n=this.perImageIdDefaultProperties.get(r)),n!==void 0?n:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:r,voiRange:n,VOILUTFunction:i,interpolationType:o,invert:a,voiUpdatedWithSetProperties:s}=this;return{colormap:r,voiRange:n,VOILUTFunction:i,interpolationType:o,invert:a,isComputedVOI:!s,sharpening:this.sharpening,smoothing:this.smoothing}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:r}=this._cpuFallbackEnabledElement;return r.rotation},this.getRotationGPU=()=>{const{viewUp:r,viewPlaneNormal:n,flipVertical:i,flipHorizontal:o}=this.getCameraNoRotation(),a=f_(this.initialViewUp,o,i,n),c=tC(a,r)*180/Math.PI,l=nn(Ie(),a,r);return ft(l,n)>=0?c:(360-c)%360},this.setRotation=r=>{const n=this.getCamera();if(this.useCPURendering?this.setRotationCPU(r):this.setRotationGPU(r),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),o={previousCamera:n,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Xe(this.element,Ge.CAMERA_MODIFIED,o)},this.renderImageObject=r=>{this._setCSImage(r),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,r)},this._setCSImage=r=>{r.isPreScaled=r.preScale?.scaled,this.csImage=r},this.canvasToWorldCPU=(r,n=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,o]=cp(this._cpuFallbackEnabledElement,r),{origin:a,spacing:s,direction:c}=this.getImageData(),l=c.slice(0,3),f=c.slice(3,6);return tn(n,a,l,i*s[0]),tn(n,n,f,o*s[1]),n},this.worldToCanvasCPU=r=>{const{spacing:n,direction:i,origin:o}=this.getImageData(),a=i.slice(0,3),s=i.slice(3,6),c=qt(Ie(),r,o),l=[ft(c,a)/n[0],ft(c,s)/n[1]];return l_(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPUContextPool=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,f=c/l,u=[r[0]*s,r[1]*s],d=n.getViewport(),[h,g,p,m]=d,w=p-h,v=m-g,y=[h+u[0]/c*w,g+(1-u[1]/l)*v,0],C=n.normalizedDisplayToProjection(y[0],y[1],y[2]),x=n.projectionToView(C[0],C[1],C[2],f),T=n.viewToWorld(x[0],x[1],x[2]);return i.setClippingRange(o[0],o[1]),[T[0],T[1],T[2]]},this.canvasToWorldGPUTiled=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[r[0]*f,r[1]*f],d=[u[0]+this.sx,u[1]+this.sy];d[1]=l[1]-d[1];const h=c.displayToWorld(d[0],d[1],0,n);return i.setClippingRange(o[0],o[1]),[h[0],h[1],h[2]]},this.worldToCanvasGPUContextPool=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,f=c/l,u=n.worldToView(r[0],r[1],r[2]),d=n.viewToProjection(u[0],u[1],u[2],f),h=n.projectionToNormalizedDisplay(d[0],d[1],d[2]),g=n.getViewport(),[p,m,w,v]=g,y=w-p,C=v-m,x=(h[0]-p)/y*c,T=(1-(h[1]-m)/C)*l;return i.setClippingRange(o[0],o[1]),[x/s,T/s]},this.worldToCanvasGPUTiled=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...r,n);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy];i.setClippingRange(o[0],o[1]);const d=window.devicePixelRatio||1;return[u[0]/d,u[1]/d]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=(r=this.getCurrentImageIdIndex())=>this.imageIds[r],this.hasImageId=r=>this.imageKeyToIndexMap.has(r),this.hasImageURI=r=>this.imageKeyToIndexMap.has(r),this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(H9(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(r={})=>{const{resetPan:n=!0,resetZoom:i=!0}=r;return this.resetCameraCPU({resetPan:n,resetZoom:i}),!0},gpu:(r={})=>{const{resetPan:n=!0,resetZoom:i=!0}=r;return this.resetCameraGPU({resetPan:n,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:{tiled:this.canvasToWorldGPUTiled,contextPool:this.canvasToWorldGPUContextPool}},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:{tiled:this.worldToCanvasGPUTiled,contextPool:this.worldToCanvasGPUContextPool}},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=Xf(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return Xf()}_configureRenderingPipeline(e){const r=M9();this.useCPURendering=e??Xf();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const i=this.renderingPipelineFunctions[n];this.useCPURendering?this[n]=i.cpu:typeof i.gpu=="object"&&i.gpu.tiled&&i.gpu.contextPool?this[n]=r?i.gpu.contextPool:i.gpu.tiled:this[n]=i.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new k0,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),r=OC.newInstance();e.setActiveCamera(r),this.initialViewUp=[0,-1,0],r.setDirectionOfProjection(-0,-0,1),r.setViewUp(...this.initialViewUp),r.setParallelProjection(!0),r.setThicknessFromFocalPoint(.1),r.setFreezeFocalPoint(!0)}shouldUseCustomRenderPass(){return!this.useCPURendering}initializeElementDisabledHandler(){ke.addEventListener(Ge.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),ke.removeEventListener(Ge.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!ta(e))return;const{actor:r}=e,n=r.getMapper().getInputData(),i=this.csImage;return{dimensions:n.getDimensions(),spacing:n.getSpacing(),origin:n.getOrigin(),direction:n.getDirection(),get scalarData(){return i?.voxelManager.getScalarData()},imageData:r.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i?.calibration,...this.calibration},preScale:{...i?.preScale},voxelManager:i?.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const r=e.spacing,n=this.csImage;return{dimensions:e.dimensions,spacing:r,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>r,worldToIndex:i=>{const o=this.worldToCanvasCPU(i),a=cp(this._cpuFallbackEnabledElement,o);return[a[0],a[1],0]},indexToWorld:(i,o)=>{const a=l_(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(a,o)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...n?.calibration,...this.calibration},preScale:{...n?.preScale},voxelManager:n?.voxelManager}}calibrateIfNecessary(e,r){const n=ut("calibratedPixelSpacing",e),i=this.calibration!==n,o=n?.scale;return this.hasPixelSpacing=o>0||!r.usingDefaultValues&&r.rowPixelSpacing>0,r.calibration=n,i&&(this.calibration=n,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:o,calibration:n}),r}setDefaultProperties(e,r){r==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(r,e),this.getCurrentImageId()===r&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:r,VOILUTFunction:n,invert:i,interpolationType:o,sharpening:a,smoothing:s}={},c=!1){this.viewportStatus=this.csImage?Ni.PRE_RENDER:Ni.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??r,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??n,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??o,sharpening:this.globalDefaultProperties.sharpening??a,smoothing:this.globalDefaultProperties.smoothing??s},typeof e<"u"&&this.setColormap(e),typeof r<"u"&&this.setVOI(r,{suppressEvents:c,voiUpdatedWithSetProperties:!0}),typeof n<"u"&&this.setVOILUTFunction(n,c),typeof i<"u"&&this.setInvertColor(i),typeof o<"u"&&this.setInterpolationType(o),typeof a<"u"&&this.setSharpening(a),typeof s<"u"&&this.setSmoothing(s)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=Ni.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;if(this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(dc.LINEAR),!this.useCPURendering){const r=this.getTransferFunction();z1(r,this.initialTransferFunctionNodes);const i=Dm(r).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),o=this.getDefaultActor(),a=iC(i,o.actor);this.setColormap(a)}}resetToDefaultProperties(){this.cpuRenderingInvalidated=!0,this.viewportStatus=Ni.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),r=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;r.colormap?.name&&this.setColormap(r.colormap);let n;r.voiRange==null?n=this._getVOIRangeForCurrentImage():n=r.voiRange,this.setVOI(n),this.setInterpolationType(dc.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:r,invert:n}=this;this.setVOI(e),this.setInterpolationType(r),this.setInvertColor(n)}getCameraCPU(){const{metadata:e,viewport:r}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:n}=e,i=n.slice(6,9).map(u=>-u);let o=n.slice(3,6).map(u=>-u);if(r.rotation){const u=Zw(Ti(),r.rotation*Math.PI/180,i);o=Pt(Ie(),o,u)}const a=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(a),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),f=Nr(c,l)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:f,scale:r.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[o[0],o[1],o[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:r,image:n}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:o,parallelScale:a,scale:s,flipHorizontal:c,flipVertical:l}=e,{clientHeight:f}=this.element;if(o){const d=this.worldToCanvasCPU(o),h=cp(this._cpuFallbackEnabledElement,d),g=this.worldToCanvasCPU(i.focalPoint),p=cp(this._cpuFallbackEnabledElement,g),m=xt();Mn(m,iS(h[0],h[1]),iS(p[0],p[1]));const w=cZ({x:m[0],y:m[1]},r);r.translation.x-=w.x,r.translation.y-=w.y}if(a){const{rowPixelSpacing:d}=n,h=f*d*.5/a;r.scale=h,r.parallelScale=a}if(s){const{rowPixelSpacing:d}=n;r.scale=s,r.parallelScale=f*d*.5/s}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=Eh(this._cpuFallbackEnabledElement);const u={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Xe(this.element,Ge.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation?.x??0,e.translation?.y??0]}setPanCPU(e){const r=this.getCameraCPU();this.setCameraCPU({...r,focalPoint:[...e.map(n=>-n),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const r=this.getCameraCPU();this.setCameraCPU({...r,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:r}){const{viewport:n}=this._cpuFallbackEnabledElement;e!==void 0&&(n.hflip=e,this.flipHorizontal=n.hflip),r!==void 0&&(n.vflip=r,this.flipVertical=n.vflip)}setVOILUTFunction(e,r){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const n=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==n&&(i=!0),this.VOILUTFunction=n;const{voiRange:o}=this.getProperties();this.setVOI(o,{suppressEvents:r,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r.rotation=e}setRotationGPU(e){const r=this.getPan(this.fitToCanvasCamera),n=this.getPan(),i=Mo([0,0],r,n);this.setPan(i,!1);const{flipVertical:o,flipHorizontal:a,viewPlaneNormal:s}=this.getCamera(),c=f_(this.initialViewUp,a,o,s);this.setCameraNoEvent({viewUp:c}),this.getVtkActiveCamera().roll(-e);const l=this.getPan(),f=this.getPan(this.fitToCanvasCamera),u=Mo([0,0],l,f),d=Zr([0,0],r,u);this.setPan(d,!1)}setInterpolationTypeGPU(e){const r=this.getDefaultActor();if(!r||!ta(r))return;const{actor:n}=r;n.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r.pixelReplication=e!==dc.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r&&(r.invert=e,this.invert=e)}setInvertColorGPU(e){const r=this.getDefaultActor();if(r&&ta(r)){if(eo(r,"vtkVolume")){const i=r.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Gd(i),this.invert=e}else if(eo(r,"vtkImageSlice")){const i=r.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Gd(i),this.invert=e}}}setVOICPU(e,r={}){const{suppressEvents:n=!1}=r,{viewport:i,image:o}=this._cpuFallbackEnabledElement;if(!i||!o)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=o,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:f,voiLUTFunction:o.voiLUTFunction};const{lower:u,upper:d}=Tl(l,f,o.voiLUTFunction);e={lower:u,upper:d}}else{const{lower:s,upper:c}=e,{windowCenter:l,windowWidth:f}=R0(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:o.voiLUTFunction}),i.voi.windowWidth=f,i.voi.windowCenter=l}this.voiRange=e;const a={viewportId:this.id,range:e};n||Xe(this.element,Ge.VOI_MODIFIED,a)}getTransferFunction(){const e=this.getDefaultActor();return!e||!ta(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,r={}){const{suppressEvents:n=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:o=!1}=r;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const a=this.getDefaultActor();if(!a||!ta(a))return;const s=a.actor;let c=e;if(typeof c>"u"){const h=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:h[0],upper:h[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let l=s.getProperty().getRGBTransferFunction(0);const f=this.VOILUTFunction===Ci.SAMPLED_SIGMOID;if((f||!l||i)&&(l=(f?cC:B9)(c),this.invert&&Gd(l),s.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=Dm(l)),f||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=o),n)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};Xe(this.element,Ge.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:r,suvlbm:n,suvbsa:i}=e,o={};n&&(o.suvbwToSuvlbm=n/r),i&&(o.suvbwToSuvbsa=i/r),this.scaling.PT=o}getImageDataMetadata(e){const r=e.imageId,n=r2(e),{numberOfComponents:i,origin:o,direction:a,dimensions:s,spacing:c,numVoxels:l,imagePixelModule:f,voiLUTFunction:u,modality:d,scalingFactor:h,calibration:g}=n;d==="PT"&&h&&this._addScalingToViewport(h),this.modality=d;const p=this._getValidVOILUTFunction(u);this.VOILUTFunction=p,this.calibration=g;let m=this._getImagePlaneModule(r);return this.useCPURendering||(m=this.calibrateIfNecessary(r,m)),{bitsAllocated:f.bitsAllocated,numberOfComponents:i,origin:o,direction:a,dimensions:s,spacing:c,numVoxels:l,imagePlaneModule:m,imagePixelModule:f}}matchImagesForOverlay(e,r){return(i=>{const o=ut(Zi.IMAGE_PLANE,r),a=ut(Zi.IMAGE_PLANE,i),s=o.imageOrientationPatient,c=a.imageOrientationPatient;if(s&&c){if(Dt(o.imageOrientationPatient,a.imageOrientationPatient)){const f=o.imagePositionPatient,u=a.imagePositionPatient;if(f&&u&&Dt(f,u)){const h=o.rows,g=o.columns,p=a.rows,m=a.columns;if(h===p&&g===m)return i}}}else{const l=o.rows,f=o.columns,u=a.rows,d=a.columns;if(l===u&&f===d)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const r=this.imageIds[e];if(!r)return;const n=ut(Zi.IMAGE_PLANE,r);if(!n)return;const{imagePositionPatient:i,frameOfReferenceUID:o}=n;let{rowCosines:a,columnCosines:s}=n;a||=[1,0,0],s||=[0,1,0];const c=nn([0,0,0],s,a);return{FrameOfReferenceUID:o,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:r,sliceIndex:e}}_getCameraOrientation(e){const r=e.slice(6,9).map(i=>-i),n=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[r[0],r[1],r[2]],viewUp:[n[0],n[1],n[2]]}}createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a}){const s=new a.constructor(a.length),c=Tt.newInstance({name:"Pixels",numberOfComponents:o,values:s}),l=dg.newInstance();return l.setDimensions(n),l.setSpacing(i),l.setDirection(r),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a}){try{this._imageData=this.createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a})}catch(s){d_.error(s)}}async setStack(e,r=0){if(this._throwIfDestroyed(),this.imageIds=e,r>e.length)throw new Error("Current image index is greater than the number of images in the stack");this.imageKeyToIndexMap.clear(),e.forEach((a,s)=>{this.imageKeyToIndexMap.set(a,s),this.imageKeyToIndexMap.set(cr(a),s)}),this.currentImageIdIndex=r,this.targetImageIdIndex=r;const n=ut(m0.IMAGE_RETRIEVE_CONFIGURATION,e[r],"stack");this.imagesLoader=n?(n.create||u9)(n):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=dc.LINEAR,this.invert=!1,this.viewportStatus=Ni.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(r),o={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:r};return Xe(this.element,Ge.VIEWPORT_NEW_IMAGE_SET,o),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,r){if(!r)return!1;const[n,i]=r.getSpacing(),[o,a]=r.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=r.getDirection(),l=c.slice(0,3),f=c.slice(3,6),u=r.getPointData().getScalars().getDataType(),d=Dt(n,e.columnPixelSpacing),h=Dt(i,e.rowPixelSpacing),g=d||e.columnPixelSpacing===null&&n===1,p=h||e.rowPixelSpacing===null&&i===1,m=o===e.columns,w=a===e.rows,v=Dt(s.rowCosines,l),y=Dt(s.columnCosines,f),C=u===e.voxelManager.getScalarData().constructor.name;return g&&p&&m&&w&&v&&y&&C}_updateVTKImageDataFromCornerstoneImage(e){let n=this._getImagePlaneModule(e.imageId).imagePositionPatient;n==null&&(n=[0,0,0]),this._imageData.setOrigin(n);const i=this.getActor(this.id);i&&(i.referencedId=e.imageId),o2(this._imageData,e)}_loadAndDisplayImage(e,r){return this.useCPURendering?this._loadAndDisplayImageCPU(e,r):this._loadAndDisplayImageGPU(e,r)}_loadAndDisplayImageCPU(e,r){return new Promise((n,i)=>{function o(h,g,p){if(this.currentImageIdIndex!==g)return;const m=h.voxelManager.getScalarData(),w=h.preScale,v=w?.scalingParameters,y=w?.scaled&&v?.rescaleIntercept%1!==0||v?.rescaleSlope%1!==0;if(m instanceof Float32Array&&y){const x={min:h.minPixelValue,max:h.maxPixelValue},_=Math.abs(x.max-x.min)/65535,E=x.min,D=m.length,b=new Uint16Array(D);let I=65535,O=0;for(let M=0;M<D;M++){const R=Math.floor((m[M]-E)/_);b[M]=R,I=Math.min(I,R),O=Math.max(O,R)}h.minPixelValue=I,h.maxPixelValue=O,h.slope=_,h.intercept=E,h.voxelManager?h.voxelManager.getScalarData=()=>b:h.getPixelData=()=>b,h.preScale={...h.preScale,scaled:!1}}this._setCSImage(h),this.viewportStatus=Ni.PRE_RENDER;const C={image:h,imageId:p,imageIdIndex:g,viewportId:this.id,renderingEngineId:this.renderingEngineId};Xe(this.element,Ge.STACK_NEW_IMAGE,C),this._updateToDisplayImageCPU(h),this.render(),this.currentImageIdIndex=g,n(p)}function a(h,g,p){const m={error:h,imageIdIndex:g,imageId:p};this.suppressEvents||Xe(ke,Ge.IMAGE_LOAD_ERROR,m),i(h)}function s(h,g,p){return Ts(h,p).then(m=>{o.call(this,m,g,h)},m=>{a.call(this,m,g,h)})}const c=-5,l=Zt.Interaction,f={imageId:e,imageIdIndex:r},u={useRGBA:!0,requestType:l},d={imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};Xe(this.element,Ge.PRE_STACK_NEW_IMAGE,d),Hr.addRequest(s.bind(this,e,r,u),l,f,c)})}successCallback(e,r){const n=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==n)return;const i=this.csImage?.imageFrame,o=r?.imageFrame,a=i?.photometricInterpretation||this.csImage?.photometricInterpretation,s=o?.photometricInterpretation||r?.photometricInterpretation;a!==s&&(this.stackInvalidated=!0),this._setCSImage(r);const c={image:r,imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(r),Xe(this.element,Ge.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=n}errorCallback(e,r,n){if(!r)return;const i=this.imageIds.indexOf(e),o={error:n,imageIdIndex:i,imageId:e};Xe(ke,Ge.IMAGE_LOAD_ERROR,o)}getLoaderImageOptions(e){const r=this.imageIds.indexOf(e),{transferSyntaxUID:n}=ut("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:n,priority:5,requestType:Zt.Interaction,additionalDetails:{imageId:e,imageIdIndex:r}}}async loadImages(e,r){const n=await Promise.allSettled(e.map(o=>{const a=this.getLoaderImageOptions(o);return Ts(o,a).then(s=>(r.successCallback(o,s),o),s=>(r.errorCallback(o,!0,s),o))})),i=n.filter(o=>o.status==="rejected");if(i&&i.length){const o=new CustomEvent(Ge.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});ke.dispatchEvent(o)}return n}_loadAndDisplayImageGPU(e,r){if(!e){console.warn("No image id set yet to load");return}const n={imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Xe(this.element,Ge.PRE_STACK_NEW_IMAGE,n),this.imagesLoader.loadImages([e],this).then(()=>e)}_updateToDisplayImageCPU(e){const r=this.getImageDataMetadata(e),n=q9(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:o,voiLUTFunction:a}=n.voi;this.voiRange=Tl(o,i,a),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...r},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},n,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?n:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=Eh(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const r=[];e.forEach(n=>{const{imageId:i,...o}=n,a=Ae.getImage(i),{origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u}=this.getImageDataMetadata(a),d=this.createVTKImageData({origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u,pixelArray:a.voxelManager.getScalarData()}),h=this.createActorMapper(d);h&&(r.push({uid:n.actorUID??un(),actor:h,referencedId:i,...o}),n.callback&&n.callback({imageActor:h,imageId:n.imageId}))}),this.addActors(r)}_updateActorToDisplayImageId(e){const r=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),n=this.getViewPresentation();if(r&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(n),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:o,dimensions:a,spacing:s,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),f=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:o,dimensions:a,spacing:s,numberOfComponents:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),d=this.getActors();d.length&&d[0].uid===this.id?d[0].actor=u:d.unshift({uid:this.id,actor:u,referencedId:e.imageId}),this.setActors(d);const{viewPlaneNormal:h,viewUp:g}=this._getCameraOrientation(o),p=this.getCamera();this.setCameraNoEvent({viewUp:g,viewPlaneNormal:h}),this.initialViewUp=g,this.resetCameraNoEvent(),this.setViewPresentation(n),this.triggerCameraEvent(this.getCamera(),p);const m=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const w=this._getInitialVOIRange(e);this.setVOI(w,{forceRecreateLUTFunction:!!m}),this.initialInvert=!!m,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.voiRange;const{windowCenter:r,windowWidth:n,voiLUTFunction:i}=e;let o=this._getVOIRangeFromWindowLevel(n,r,i);return o=this._getPTPreScaledRange()||o,o}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){return!(this.modality!=="PT"||!this.csImage.isPreScaled||!this.csImage.preScale?.scalingParameters.suvbw)}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,r,n=Ci.LINEAR){let i,o;if(typeof r=="number"&&typeof e=="number"?(i=r,o=e):Array.isArray(r)&&Array.isArray(e)&&(i=r[0],o=e[0]),i!==void 0&&o!==void 0)return Tl(o,i,n)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=Ni.PRE_RENDER;const r=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const n=this.perImageIdDefaultProperties.get(r);n!==void 0?this.setProperties(n):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return r}resetCameraCPU({resetPan:e=!0,resetZoom:r=!0}){const{image:n}=this._cpuFallbackEnabledElement;if(!n)return;lZ(this._cpuFallbackEnabledElement,e,r);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:o,clientHeight:a}=this.element,s=[o/2,a/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:r}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:r,resetToCenter:!0})}scroll(e,r=!0,n=!1){const i=this.imageIds;if(isNaN(this.targetImageIdIndex))return;const o=this.targetImageIdIndex,a=i.length;let s=o+e;n?s=(s+a)%a:s=Math.max(0,Math.min(a-1,s)),this.targetImageIdIndex=s;const c=i[s];Ae.isLoaded(c)||!r?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const f={newImageIdIndex:s,imageId:c,direction:e};s!==o&&Xe(this.element,Ge.STACK_VIEWPORT_SCROLL,f)}setImageIdIndex(e){if(this._throwIfDestroyed(),this.currentImageIdIndex===e)return Promise.resolve(this.getCurrentImageId());const r=this._setImageIdIndex(e);return this.targetImageIdIndex=e,r}calibrateSpacing(e){const r=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,r)}triggerCameraEvent(e,r){const n={previousCamera:r,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Xe(this.element,Ge.CAMERA_MODIFIED,n)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),r={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Xe(this.element,Ge.IMAGE_SPACING_CALIBRATED,r),this._publishCalibratedEvent=!1}jumpToWorld(e){const r=this.getImageIds(),n=this.getImageData(),{direction:i,spacing:o}=n,a=_c({direction:i,spacing:o,imageIds:r},e,this.getCamera().viewPlaneNormal,{ignoreSpacing:!0}),s=r.indexOf(a);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:r,voiLUTFunction:n}=this.csImage;return this._getVOIRangeFromWindowLevel(r,e,n)}_getValidVOILUTFunction(e){return Object.values(Ci).includes(e)?e:Ci.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:r}=this.getImageData();return{width:r[0],height:r[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,r={}){const n=this.getCurrentImageIdIndex(),i=this.imageIds[n];if(!i||!e)return!1;const{referencedImageId:o,multiSliceReference:a}=e;if(o){if(o===i)return!0;e.referencedImageURI||=cr(o);const{referencedImageURI:c}=e,l=this.imageKeyToIndexMap.get(c);if(r.asOverlay&&this.matchImagesForOverlay(i,o))return!0;if(l===void 0)return!1;if(r.withNavigation)return!0;const f=a&&this.imageKeyToIndexMap.get(a.referencedImageId);return n<=f&&n>=l}if(!super.isReferenceViewable(e,{...r,withOrientation:r?.asVolume}))return!1;if(e.volumeId||e.FrameOfReferenceUID)return r.asVolume;const{cameraFocalPoint:s}=e;if(r.asNearbyProjection&&s){const{spacing:c,direction:l,origin:f}=this.getImageData(),u=l.slice(6,9),d=Ll({direction:l,spacing:c},u),h=qt(Ie(),s,f),g=ft(h,u),p=d/2;if(Math.abs(g)<=p)return!0}return!1}getViewReference(e={}){const{sliceIndex:r=this.getCurrentImageIdIndex()}=e,n=super.getViewReference(e),i=this.getCurrentImageId(r);if(i){if(n.referencedImageId=i,this.getCurrentImageIdIndex()!==r){const o=this.getImagePlaneReferenceData(r);if(!o)return;Object.assign(n,o)}return n}}setViewReference(e){if(!e?.referencedImageId){e?.sliceIndex!==void 0&&this.scroll(e.sliceIndex-this.targetImageIdIndex);return}const{referencedImageId:r}=e;e.referencedImageURI||=cr(r);const{referencedImageURI:n}=e,i=this.imageKeyToIndexMap.get(n);if(i===void 0){d_.error(`No image URI found for ${n}`);return}this.scroll(i-this.targetImageIdIndex)}getViewReferenceId(e={}){const{sliceIndex:r=this.currentImageIdIndex}=e;return`imageId:${this.imageIds[r]}`}getSliceIndexForImage(e){if(e){if(typeof e=="string")return this.imageKeyToIndexMap.get(e);if(e.referencedImageId)return this.imageKeyToIndexMap.get(e.referencedImageId)}}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const r=wh(e.name);this._cpuFallbackEnabledElement.viewport.colormap=r,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const n={viewportId:this.id,colormap:e};Xe(this.element,Ge.COLORMAP_MODIFIED,n)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),o=i.getRGBTransferFunction(),a=wh(e.name)||mh.getPresetByName(e.name);if(o)o.applyColorMap(a),o.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,o);else{const c=Cc.newInstance();c.applyColorMap(a),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};Xe(this.element,Ge.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){const r=k9(e);return this.hasPixelSpacing=!r.usingDefaultValues||this.calibration?.scale>0||this.calibration?.rowPixelSpacing>0,this.calibration||=r.calibration,r}isInAcquisitionPlane(){return!0}}function pl(t,e){const{imageData:r}=t.getImageData(),n=t.canvasToWorld(e);return Lr(r,n)}function y0(t,e){return t.indexToWorld(e)}function fZ(t,e){const{imageData:r}=t.getImageData(),n=y0(r,e);return t.worldToCanvas(n)}class zn extends ir{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:n}=Um(this)||{};return n},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(n,i=!0)=>{const{currentStepIndex:o}=Bu(this,n||this.getVolumeId(),i);return o},this.getSliceIndex=()=>{const{imageIndex:n}=Um(this)||{};return n},this.getCurrentImageId=()=>{const n=this.getDefaultActor();if(!n||!eo(n,"vtkVolume"))return;const i=Ae.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:o,focalPoint:a}=this.getCamera();return _c(i,a,o)},this.getSlicePlaneCoordinates=()=>{const n=this.getDefaultActor();if(!n?.actor)return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),o=Ae.getVolume(i),a=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:l}=a,f=Ll(o,l),u=n2(n.actor,l,s),d=Math.round((u.current-u.min)/f),h=Math.round((u.max-u.current)/f),g=this.getSliceIndex(),p=[];for(let m=-d;m<=h;m++){const{newFocalPoint:w}=e0(s,c,u,l,f,m);p.push({sliceIndex:g+m,point:w})}return p};const{orientation:r}=this.options;if(r&&r!==Ma.ACQUISITION){this.applyViewOrientation(r);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,r=!1,n=!1){const i=e[0].volumeId,o=Ae.getVolume(i);if(!o)throw new Error(`imageVolume with id: ${i} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(o),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,o),super.setVolumes(e,r,n)}async addVolumes(e,r=!1,n=!1){const i=Ae.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,i),super.addVolumes(e,r,n)}jumpToWorld(e){const{focalPoint:r}=this.getCamera(),n=[0,0,0];an(n,e,r);const i=this.getCamera(),o=i.viewPlaneNormal,a=ft(n,o),s=mt(o[0],o[1],o[2]);if(Jn(s,s,a),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],l=[0,0,0];nr(c,i.focalPoint,s),nr(l,i.position,s),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,r=!0){let n,i;if(typeof e=="string"){if(e===Ma.ACQUISITION)({viewPlaneNormal:n,viewUp:i}=super._getAcquisitionPlaneOrientation());else if(e===Ma.REFORMAT||e.includes("_reformat"))({viewPlaneNormal:n,viewUp:i}=I9(this,{useViewportNormal:!0}));else if(hc[e])({viewPlaneNormal:n,viewUp:i}=hc[e]);else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:n,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:n,viewUp:i}=e),this.applyViewOrientation(e);r&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-Cr.MAXIMUM_RAY_DISTANCE,Cr.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Cr.MINIMUM_SLAB_THICKNESS,Cr.MAXIMUM_RAY_DISTANCE)}_setViewPlaneToReformatOrientation(e,r){let n,i;if(r){const{direction:o}=r;({viewPlaneNormal:n,viewUp:i}=D9(o.slice(0,3),o.slice(3,6),o.slice(6,9),e))}else({viewPlaneNormal:n,viewUp:i}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:i}),this.initialViewUp=i,this.resetCamera()}_setViewPlaneToAcquisitionPlane(e){let r,n;if(e){const{direction:i}=e;r=i.slice(6,9).map(o=>-o),n=i.slice(3,6).map(o=>-o)}else({viewPlaneNormal:r,viewUp:n}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:r,viewUp:n}),this.initialViewUp=n,this.resetCamera()}getBlendMode(e){const r=this.getActors(),n=e?.length>0?r.find(i=>e.includes(i.uid)):r[0];return n?.blendMode||n?.actor.getMapper().getBlendMode()}setBlendMode(e,r=[],n=!1){let i=this.getActors();r?.length>0&&(i=i.filter(o=>r.includes(o.uid))),i.forEach(o=>{const{actor:a}=o;a.getMapper().setBlendMode?.(e),o.blendMode=e}),n&&this.render()}resetCamera(e){const{resetPan:r=!0,resetZoom:n=!0,resetRotation:i=!0,resetToCenter:o=!0,suppressEvents:a=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:r,resetZoom:n,resetToCenter:o});const l=this.getVtkActiveCamera(),f=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(h=>{if(!h.actor)return;const g=h.actor.getMapper();if(g.getClippingPlanes().length===0&&!h?.clippingFilter){const m=tr.newInstance(),w=tr.newInstance(),v=[m,w];let y=Cr.MINIMUM_SLAB_THICKNESS;h.slabThickness&&(y=h.slabThickness),this.setOrientationOfClippingPlanes(v,y,f,u),g.addClippingPlane(m),g.addClippingPlane(w)}}),i&&hc[this.viewportProperties.orientation]!==void 0){const h=hc[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:h.viewUp,viewPlaneNormal:h.viewPlaneNormal})}if(!a){const h={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Xe(this.element,Ge.CAMERA_RESET,h)}return!0}setSlabThickness(e,r=[]){e<.1&&(e=.1);let n=this.getActors();r?.length>0&&(n=n.filter(o=>r.includes(o.uid))),n.forEach(o=>{eo(o,"vtkVolume")&&(o.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(n=>{eo(n,"vtkVolume")&&(n.slabThickness=Cr.MINIMUM_SLAB_THICKNESS)});const r=this.getCamera();this.updateClippingPlanesForActors(r),this.triggerCameraModifiedEventIfNecessary(r,r),this.viewportProperties.slabThickness=void 0}isInAcquisitionPlane(){const e=this.getImageData();if(!e)return!1;const{direction:r}=e,{viewPlaneNormal:n}=this.getCamera(),i=[r[6],r[7],r[8]];return Math.abs(ft(n,i))>.99}getSliceViewInfo(){const{width:e,height:r}=this.getCanvas(),n=pl(this,[0,0]),i=pl(this,[e-1,0]),o=pl(this,[0,r-1]),a=an(Ie(),i,n),s=an(Ie(),o,n),c=nn(Ie(),a,s);At(a,a),At(s,s),At(c,c);const{dimensions:l}=this.getImageData(),[f,u,d]=l,p=[[0,0,0],[f-1,0,0],[0,u-1,0],[f-1,u-1,0],[0,0,d-1],[f-1,0,d-1],[0,u-1,d-1],[f-1,u-1,d-1]].map(D=>fZ(this,D)).reduce((D,b)=>(D.minX=Math.min(D.minX,b[0]),D.minY=Math.min(D.minY,b[1]),D.maxX=Math.max(D.maxX,b[0]),D.maxY=Math.max(D.maxY,b[1]),D),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),m=pl(this,[p.minX,p.minY]),w=Xw(a[0],a[1],a[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,m[0],m[1],m[2],1),v=pl(this,[p.maxX,p.maxY]),y=an(Ie(),v,m),C=gr(Ti(),w),{viewPlaneNormal:x}=this.getCamera();if(x.filter(D=>Math.abs(D)>Po).length>1)throw new Error("getSliceInfo is not supported for oblique views");const S=x.findIndex(D=>Math.abs(D)>1-Po);if(S===-1)throw new Error("Unable to determine slice axis");const _=ft(a,y)+1,E=ft(s,y)+1;return{sliceIndex:this.getSliceIndex(),width:_,height:E,slicePlane:S,sliceToIndexMatrix:w,indexToSliceMatrix:C}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const r=super.getViewReference(e);if(!r?.volumeId)return;const n=Ae.getVolume(r.volumeId);return r.referencedImageId=_c(n,r.cameraFocalPoint,r.viewPlaneNormal),r}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const r=e?this.getActor(e):this.getDefaultActor();if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);r.slabThickness&&(r.slabThickness=Cr.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const n=Ae.getVolume(e);if(!n)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if($C(r.actor,n),ta(r)){const l=r.actor.getProperty().getRGBTransferFunction(0);z1(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),Xe(this.element,Ge.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:r}=this.getCamera(),n=Cr.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:o})=>{const a=[tr.newInstance(),tr.newInstance()];return this.setOrientationOfClippingPlanes(a,n,r,i),{sliceIndex:o,planes:a.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}class a2 extends ir{constructor(e){super(e),this.setSampleDistanceMultiplier=o=>{this.getActors().forEach(s=>{if(eo(s,"vtkVolume")){const l=s.actor.getMapper();if(l&&l.getInputData){const f=l.getInputData();if(f){const u=f.getSpacing();let g=(u[0]+u[1]+u[2])/6*(o||1);g!==void 0&&l.setSampleDistance&&(l.getSampleDistance(),l.setSampleDistance(g))}}}}),this.render()},this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:r,orientation:n}=this.options,i=this.getVtkActiveCamera();r!=null&&i.setParallelProjection(r),n&&n!==Ma.ACQUISITION&&this.applyViewOrientation(n)}isInAcquisitionPlane(){return!1}resetCamera({resetPan:e=!0,resetZoom:r=!0,resetToCenter:n=!0}={}){super.resetCamera({resetPan:e,resetZoom:r,resetToCenter:n});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-Cr.MAXIMUM_RAY_DISTANCE,Cr.MAXIMUM_RAY_DISTANCE):i.setClippingRange(Cr.MINIMUM_SLAB_THICKNESS,Cr.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,r){return null}setBlendMode(e,r,n){return null}resetProperties(e){const r=e?this.getActor(e):this.getDefaultActor();if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);r.slabThickness&&(r.slabThickness=Cr.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const n=Ae.getVolume(e);if(!n)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if($C(r.actor,n),ta(r)){const i=r.actor.getProperty().getRGBTransferFunction(0);z1(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),Xe(this.element,Ge.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-Cr.MAXIMUM_RAY_DISTANCE,Cr.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Cr.MINIMUM_SLAB_THICKNESS,Cr.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}async function Y9(t,e,r,n=!1,i=!1){r.forEach(a=>{const s=t.getViewport(a);if(!s)throw new Error(`Viewport with Id ${a} does not exist`);if(!(s instanceof ir))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const o=r.map(async a=>{await t.getViewport(a).setVolumes(e,n,i)});await Promise.all(o)}async function J9(t,e,r,n=!1,i=!1){for(const a of r){const s=t.getViewport(a);if(!s)throw new Error(`Viewport with Id ${a} does not exist`);if(!(s instanceof ir)){console.warn(`Viewport with Id ${a} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const o=r.map(async a=>{await t.getViewport(a).addVolumes(e,n,i)});await Promise.all(o)}function Z9(t,e,r){for(const n of r){const i=t.getViewport(n);if(!i)throw new Error(`Viewport with Id ${n} does not exist`);if(!i.addImages){console.warn(`Viewport with Id ${n} does not have addImages. Cannot add image segmentation to this viewport.`);return}}r.forEach(n=>{t.getViewport(n).addImages(e)})}class dZ{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,r){this.transferFunction[e]=r}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const r=this.transferFunction[0],n=r.getRedValue(e),i=r.getGreenValue(e),o=r.getBlueValue(e);return[n,i,o,this.opacity]}}class hZ{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class gZ{constructor(e,r){this.canvasProperties=new dZ(this),this.visibility=!1,this.mapper=new hZ(this),this.className="CanvasActor",this.derivedImage=r,this.viewport=e}renderRLE(e,r,n){const{width:i,height:o}=this.image;let{canvas:a}=this;(!a||a.width!==i||a.height!==o)&&(this.canvas=a=new window.OffscreenCanvas(i,o));const s=a.getContext("2d"),c=s.createImageData(i,o),{data:l}=c;l.fill(0);const{map:f}=n;let u=1/0,d=1/0,h=-1/0,g=-1/0;for(let w=0;w<o;w++){const v=f.getRun(w,0);if(!v)continue;d=Math.min(d,w),g=Math.max(g,w);const y=w*i<<2;let C;for(const x of v){const{start:T,end:S,value:_}=x;if(_===0){C||=[],C.push(v.indexOf(x));continue}u=Math.min(u,T),h=Math.max(h,S);const E=this.canvasProperties.getColor(_).map(b=>b*255);let D=y+(T<<2);for(let b=T;b<S;b++)l[D++]=E[0],l[D++]=E[1],l[D++]=E[2],l[D++]=E[3]}}if(u>i)return;const p=h-u,m=g-d;s.putImageData(c,0,0,u-1,d-1,p+2,m+2),r.drawImage(a,u,d,p,m,u,d,p,m)}setMapper(e){this.mapper=e}render(e,r){if(!this.visibility)return;const n=this.image||this.getImage(),{width:i,height:o}=n,a=n.getScalarData();if(!a)return;const{voxelManager:s}=n;if(s&&s.map.getRun){this.renderRLE(e,r,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==o)&&(this.canvas=c=new window.OffscreenCanvas(i,o));const l=c.getContext("2d"),f=l.createImageData(i,o),{data:u}=f;let d=0,h=0,g=1/0,p=1/0,m=-1/0,w=-1/0;for(let C=0;C<o;C++)for(let x=0;x<i;x++){const T=a[d++];if(T){g=Math.min(x,g),p=Math.min(C,p),m=Math.max(x,m),w=Math.max(C,w);const S=this.canvasProperties.getColor(T);u[h]=S[0]*255,u[h+1]=S[1]*255,u[h+2]=S[2]*255,u[h+3]=127}h+=4}if(g>i)return;const v=m-g+1,y=w-p+1;l.putImageData(f,0,0,g,p,v,y),r.drawImage(c,g,p,v,y,g,p,v,y)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:r=>e.imageData.worldToIndex(r),indexToWorld:(r,n)=>e.imageData.indexToWorld(r,n),getDimensions:()=>e.dimensions,getScalarData:()=>this.derivedImage?.getPixelData(),getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:r=>{this.derivedImage=r,this.image=null},modified:()=>null}),this.image}}const q3=class q3{static imageIdToFrames(e){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const n=r[2].split("-").map(i=>Number(i));return n.length===1?n[0]:n}static imageIdToFrameEnd(e){const r=this.imageIdToFrames(e);return Array.isArray(r)?r[1]:r}static imageIdToFrameStart(e){const r=this.imageIdToFrames(e);return Array.isArray(r)?r[0]:r}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,r){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const i=this.framesToString(r);return e.replace(this.frameRangeExtractor,`${n[1]}${i}`)}};q3.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let t0=q3;const rh=class rh extends Qu{constructor(e){super({...e,canvas:e.canvas||Oo(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const r=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(r)?this.numberOfFrames:r},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const r=this.canvas,{clientWidth:n,clientHeight:i}=r;(r.width!==n||r.height!==i)&&(r.width=n,r.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(r,n=[0,0,0])=>{const i=this.videoCamera.panWorld,o=this.getWorldToCanvasRatio(),a=[i[0]*o,i[1]*o],s=[r[0]-a[0],r[1]-a[1]];return n.splice(0,2,s[0]/o,s[1]/o),n},this.worldToCanvas=r=>{const n=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(r[0]+n[0])*i,(r[1]+n[1])*i]},this.getRotation=()=>0,this.canvasToIndex=r=>{const n=this.getTransform();return n.invert(),n.transformPoint(r.map(i=>i*devicePixelRatio))},this.indexToCanvas=r=>this.getTransform().transformPoint(r).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const r=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),o=this.canvasContext;o.resetTransform(),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.transform(i[0]/r,i[1]/r,i[2]/r,i[3]/r,i[4]/r,i[5]/r),o.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const s of this.getActors())s.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Xe(this.element,Ge.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Xe(this.element,Ge.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const a=this.getFrameNumber();this.isPlaying&&(a<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):a>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(Ge.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(Ge.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const r=typeof e=="string"?e:e.imageId,n=ut(Zi.IMAGE_PLANE,r);let i=n.rowCosines,o=n.columnCosines;(n.usingDefaultValues||i==null||o==null)&&(i=[1,0,0],o=[0,1,0]);const s=mt(i[0],i[1],i[2]),c=mt(o[0],o[1],o[2]),{rows:l,columns:f}=n,u=Ie();nn(u,s,c);let d=n.imagePositionPatient;d==null&&(d=[0,0,0]);const h=n.columnPixelSpacing||1,g=n.rowPixelSpacing||1,p=n.columns,m=n.rows,w=1,v=1;return this.hasPixelSpacing=!!n.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:d,rows:l,columns:f,direction:[...s,...c,...u],dimensions:[p,m,v],spacing:[h,g,w],hasPixelSpacing:this.hasPixelSpacing,numVoxels:p*m*v,imagePlaneModule:n}}setDataIds(e,r){this.setVideo(e[0],(r.viewReference?.sliceIndex||0)+1)}setVideo(e,r){this.imageId=Array.isArray(e)?e[0]:e;const n=ut(Zi.IMAGE_URL,e);if(!n?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=n,o=ut(Zi.GENERAL_SERIES,e);this.modality=o?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:a,numberOfFrames:s}=ut(Zi.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(a||30))),a||(a=Math.round(s/this.videoElement.duration)),this.fps=a,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(r||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(r||1),c(this)},25)})))}async setVideoURL(e){return new Promise(r=>{this.videoElement.src=e,this.videoElement.preload="auto";const n=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",n),this.refreshRenderValues(),r(!0)};this.videoElement.addEventListener("loadedmetadata",n)})}getImageIds(){const e=new Array(this.numberOfFrames),r=this.imageId.replace(/[0-9]+$/,"");for(let n=0;n<this.numberOfFrames;n++)e[n]=`${r}${n+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const r=this.videoElement,n=this.renderFrame,o=r.currentTime+e*this.scrollSpeed/this.fps;r.currentTime=o;const a=s=>{n(),r.removeEventListener("seeked",a)};r.addEventListener("seeked",a)}async start(){const e=this.videoElement,r=this.renderFrame;if(e.currentTime=0,e.paused){const n=i=>{r(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async end(){const e=this.videoElement,r=this.renderFrame;if(e.currentTime=e.duration,e.paused){const n=i=>{r(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async setTime(e){const r=this.videoElement,n=this.renderFrame;if(r.currentTime=e,r.paused){const i=o=>{n(),r.removeEventListener("seeked",i)};r.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getSliceIndexForImage(e){if(e){if(typeof e=="string")return t0.imageIdToFrameStart(e);if(e.referencedImageId)return t0.imageIdToFrameStart(e.referencedImageId)}}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,r=hh.FRAME){this.scrollSpeed=r===hh.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0,voiRange:{lower:0,upper:255}})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const o=new Uint8ClampedArray;return o.getRange=()=>[0,255],o.frameNumber=-1,o}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const r=e.getContext("2d");r.drawImage(this.videoElement,0,0);const i=r.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,r=e.spacing,n={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:o=>{const a=this.worldToCanvas(o),s=this.canvasToIndex(a);return[s[0],s[1],0]},indexToWorld:(o,a)=>{const s=this.indexToCanvas([o[0],o[1]]);return this.canvasToWorld(s,a)}},i={dimensions:e.dimensions,spacing:r,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:n,voxelManager:{forEach:(o,a)=>EC(a.imageData,{pointInShapeFn:a.isInObject??(()=>!0),callback:o,boundsIJK:a.boundsIJK,returnPoints:a.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(n,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const r=e.match(rh.frameRangeExtractor),n=r?e.substring(0,r.index):e;return this.imageId.includes(n)}setVOI(e){this.voiRange=e;const r=this.setColorTransform(e,this.averageWhite);this.canvas.style.filter=r}setWindowLevel(e=256,r=128){const n=r-e/2,i=r+e/2-1;this.setVOI({lower:n,upper:i}),this.setColorTransform({lower:n,upper:i},this.averageWhite)}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}setCamera(e){const{parallelScale:r,focalPoint:n}=e;if(r&&(this.videoCamera.parallelScale=this.element.clientHeight/2/r),n!==void 0){const i=this.worldToCanvas(n),o=[this.element.clientWidth/2,this.element.clientHeight/2],a=[(i[0]-o[0])/this.videoCamera.parallelScale,(i[1]-o[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-a[0],this.videoCamera.panWorld[1]-a[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(e=this.getCurrentImageIdIndex()){return this.imageId?.replace("/frames/1",`/frames/${e+1}`)}getViewReferenceId(e={}){const{sliceIndex:r}=e;return r===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(r)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${r[0]+1}-${r[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+r}`)}`}isReferenceViewable(e,r={}){let{imageURI:n}=r;const{referencedImageId:i,sliceIndex:o,multiSliceReference:a}=e;if(!super.isReferenceViewable(e))return!1;const s=this.getCurrentImageId();if(!n){const d=s.indexOf(":");n=s.substring(d+1,s.length-1)}if(r.withNavigation)return!0;const c=this.getSliceIndex();if(a){const d=t0.imageIdToFrameEnd(a.referencedImageId);return c>=o&&c<=d}if(o!==void 0)return c===o;if(!i)return!1;const l=i.match(rh.frameRangeExtractor);if(!l||!l[2])return!0;const f=l[2].split("-").map(d=>Number(d)),u=c+1;return f[0]<=u&&u<=(f[1]??f[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){const r=e?.sliceIndex??(this.isPlaying?this.frameRange[0]:this.getCurrentImageIdIndex()),n=e?.rangeEndSliceIndex??(this.isPlaying?this.frameRange[1]-1:void 0),i=n>r?{sliceIndex:n,referencedImageId:this.getCurrentImageId(n)}:void 0;return{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:r,multiSliceReference:i}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,r=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(r),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const r=Math.floor(this.videoWidth*e),n=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-r)/2,o=(this.canvas.offsetHeight-n)/2,a=i/e,s=o/e;this.videoCamera.panWorld=[a,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,r=window.devicePixelRatio||1,n=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),o=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],a=[o[0]*i,o[1]*i],s=new k0;return s.scale(r,r),s.translate(o[0],o[1]),s.scale(n,n),s.translate(e[0],e[1]),s.translate(-a[0],-a[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const r=this.getActors();e.forEach(n=>{const{imageId:i,...o}=n,a=Ae.getImage(i),s=this.createActorMapper(a),c=n.actorUID??un();s&&(r.push({uid:c,actor:s,referencedId:i,...o}),n.callback&&n.callback({imageActor:s,imageId:i}))}),this.setActors(r)}createActorMapper(e){return new gZ(this,e)}};rh.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let w0=rh;const pZ=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`;let fd=null;const mZ="postrender",h_="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",Wf=class Wf extends Qu{constructor(e){super({...e,canvas:e.canvas||Oo(e.element)}),this.imageURISet=new Set,this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.annotationRemovedListener=n=>{const{detail:i}=n,o=i?.annotation?.metadata;if(!o){this.postrender();return}const a=o.referencedImageURI??(o.referencedImageId?cr(o.referencedImageId):null);if(a&&!this.hasImageURI(a))return;const s=o.FrameOfReferenceUID??null;s&&s!==this.frameOfReferenceUID||this.postrender()},this.voiRange={lower:0,upper:255},this.getProperties=()=>({voiRange:{...this.voiRange}}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const n=this.canvas,{clientWidth:i,clientHeight:o}=n;(n.width!==i||n.height!==o)&&(n.width=i,n.height=o),this.refreshRenderValues()},this.canvasToWorld=n=>{if(!this.metadata)return;const i=this.canvasToIndex(n);return i[1]=-i[1],this.indexToWorld(i)},this.worldToCanvas=n=>{if(!this.metadata)return;const i=this.worldToIndex(n);return i[1]=-i[1],this.indexToCanvas([i[0],i[1],0])},this.postrender=()=>{this.refreshRenderValues(),Xe(this.element,Ge.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=n=>{const i=this.getTransform();i.invert();const o=i.transformPoint(n.map(a=>a*devicePixelRatio));return[o[0],o[1],0]},this.indexToCanvas=n=>this.getTransform().transformPoint([n[0],n[1]]).map(o=>o/devicePixelRatio),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=un(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const r=this.element.firstElementChild;r.insertBefore(this.microscopyElement,r.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(Ge.ELEMENT_DISABLED,this.elementDisabledHandler),ke.addEventListener(h_,this.annotationRemovedListener)}removeEventListeners(){this.canvas.removeEventListener(Ge.ELEMENT_DISABLED,this.elementDisabledHandler),ke.removeEventListener(h_,this.annotationRemovedListener)}elementDisabledHandler(){this.removeEventListeners(),this.viewer?.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null,this.imageURISet.clear()}getImageDataMetadata(e=0){const r=this.metadataDicomweb.reduce((E,D)=>E?.NumberOfFrames<D.NumberOfFrames?D:E),{TotalPixelMatrixColumns:n,TotalPixelMatrixRows:i,ImageOrientationSlide:o,ImagedVolumeWidth:a,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=r,l=ut(Zi.IMAGE_PLANE,this.imageIds[e]);let f=o.slice(0,3),u=o.slice(3,6);(f==null||u==null)&&(f=[1,0,0],u=[0,1,0]);const d=mt(f[0],f[1],f[2]),h=mt(u[0],u[1],u[2]),g=Ie();nn(g,d,h);const{XOffsetInSlideCoordinateSystem:p=0,YOffsetInSlideCoordinateSystem:m=0,ZOffsetInSlideCoordinateSystem:w=0}=r.TotalPixelMatrixOriginSequence?.[0]||{},v=[p,m,w],y=a/n,C=s/i,x=n,T=i,S=c,_=1;return this.hasPixelSpacing=!!(a&&s),{bitsAllocated:8,numberOfComponents:3,origin:v,direction:[...d,...h,...g],dimensions:[x,T,_],spacing:[y,C,S],hasPixelSpacing:this.hasPixelSpacing,numVoxels:x*T*_,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){e.voiRange&&this.setVOI(e.voiRange)}resetProperties(){this.setProperties({voiRange:{lower:0,upper:255}})}setVOI(e){this.voiRange=e;const r=this.setColorTransform(e,this.averageWhite);this.map.getViewport().querySelectorAll(".ol-layers canvas").forEach(i=>{i.style.filter=r})}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}getScalarData(){return null}computeTransforms(){const e=Ti(),r=Ti();return P0(e,this.metadata.origin),e[0]=this.metadata.direction[0],e[1]=this.metadata.direction[1],e[2]=this.metadata.direction[2],e[4]=this.metadata.direction[3],e[5]=this.metadata.direction[4],e[6]=this.metadata.direction[5],e[8]=this.metadata.direction[6],e[9]=this.metadata.direction[7],e[10]=this.metadata.direction[8],ws(e,e,this.metadata.spacing),gr(r,e),{indexToWorld:e,worldToIndex:r}}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:r}=e,n={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:o=>this.worldToIndex(o),indexToWorld:o=>this.indexToWorld(o)};return{dimensions:e.dimensions,spacing:r,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:n}}hasImageURI(e){return e?this.imageURISet.has(e):!1}setCamera(e){const r=this.getCamera(),{parallelScale:n,focalPoint:i}=e,o=this.getView(),{xSpacing:a}=this.internalCamera;if(n){const c=this.element.clientHeight/n,l=1/a/c;o.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);o.setCenter(l)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(r,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:r,centerIndex:n}=this.internalCamera,i=e*r,o=this.indexToCanvas([n[0],n[1],0]),a=this.canvasToWorld(o);return{parallelProjection:!0,focalPoint:a,position:a,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*i,viewPlaneNormal:[0,0,1]}}worldToIndexWSI(e){if(!fd)return;const r=this.viewer.getAffine(),n=fd.applyInverseTransform({coordinate:[e[0],e[1]],affine:r});return[n[0],n[1]]}indexToWorldWSI(e){if(!fd)return;const r=fd.applyTransform({coordinate:[e[0],e[1]],affine:this.viewer.getAffine()});return[r[0],r[1],0]}worldToIndex(e){const{worldToIndex:r}=this.computeTransforms(),n=Ie();return Pt(n,e,r),n}indexToWorld(e){const{indexToWorld:r}=this.computeTransforms(),n=Ie(),i=mt(...e);return Pt(n,i,r),[n[0],n[1],n[2]]}setDataIds(e,r){r?.miniNavigationOverlay!==!1&&Wf.addMiniNavigationOverlayCss();const n=r?.webClient||ut(Zi.WADO_WEB_CLIENT,e[0]);if(!n)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}.`);return this.setWSI(e,n)}async setWSI(e,r){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e,this.imageURISet=new Set(e.map(s=>cr(s)));const n=await Wf.getDicomMicroscopyViewer();fd||=n.utils,this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{const c=r.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=c["00080008"]?.Value;l?.length===1&&(c["00080008"].Value=l[0].split("\\"));const f=c["00200052"]?.Value?.[0];return this.frameOfReferenceUID?f!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=f,c}),o=[];i.forEach(s=>{const c=new n.metadata.VLWholeSlideMicroscopyImage({metadata:s}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?o.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=o;const a=new n.viewer.VolumeImageViewer({client:r,metadata:o,controls:["overview","position"],retrieveRendered:!1,bindings:{}});a.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),a.deactivateDragPanInteraction(),this.viewer=a,this.map=a.getMap(),this.map.on(mZ,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const r=this.getCamera();this.setCamera({parallelScale:r.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer.getMap(),r=window;return r.map=e,r.viewer=this.viewer,r.view=e?.getView(),r.wsi=this,e?.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const r=e.getResolution();if(!r||r<Po)return;const n=e.getCenter(),i=e.getProjection().getExtent(),o=e.getRotation(),a=e.getZoom(),{metadata:{spacing:[s,c]}}=this,l=1/r/s;Object.assign(this.internalCamera,{extent:i,centerIndex:n,worldToCanvasRatio:l,xSpacing:s,ySpacing:c,resolution:r,rotation:o,zoom:a})}getZoom(){return this.getView()?.getZoom()}setZoom(e){this.getView()?.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:r,rotation:n}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],o=new k0;return o.translate(i[0],i[1]),o.rotate(n),o.scale(1/r,-1/r),o.translate(-e[0],-e[1]),o}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=pZ,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};Wf.getDicomMicroscopyViewer=async()=>bb("dicom-microscopy-viewer"),Wf.overlayCssId="overlayCss";let Gm=Wf;const Q9={[Fn.ORTHOGRAPHIC]:zn,[Fn.PERSPECTIVE]:zn,[Fn.STACK]:qn,[Fn.VOLUME_3D]:a2,[Fn.VIDEO]:w0,[Fn.WHOLE_SLIDE]:Gm};function ls(t){return Q9[t].useCustomRenderingPipeline}const oo={WIDTH:160,HEIGHT:96,TEXT_PADDING:3,TEXT_Y_OFFSET:2,GRAPH_Y_OFFSET:15,GRAPH_WIDTH:150,GRAPH_HEIGHT:70,FONT_SIZE:9,FONT_FAMILY:"Helvetica,Arial,sans-serif",GRAPH_ALPHA:.9},lp={UPDATE_INTERVAL:1e3,MAX_MS_VALUE:200,MAX_FPS_VALUE:300,OVERLAY_STYLES:{position:"fixed",top:"0px",right:"0px",left:"auto",zIndex:"9999",cursor:"pointer",opacity:"0.9"}},Pv={BYTES_TO_MB:1048576,MS_PER_SECOND:1e3},Zs=[{name:"FPS",foregroundColor:"#0ff",backgroundColor:"#002"},{name:"MS",foregroundColor:"#0f0",backgroundColor:"#020"},{name:"MB",foregroundColor:"#f08",backgroundColor:"#201"}];class Rv{constructor(e,r,n){this.minValue=1/0,this.maxValue=0,this.name=e,this.foregroundColor=r,this.backgroundColor=n,this.devicePixelRatio=Math.round(window.devicePixelRatio||1),this.dimensions=this.calculateDimensions(),this.dom=this.createCanvas(),this.context=this.initializeContext(),this.drawInitialPanel()}update(e,r){this.updateMinMax(e),this.clearTextArea(),this.drawText(e),this.scrollGraph(),this.drawNewValue(e,r)}calculateDimensions(){const e=this.devicePixelRatio;return{width:oo.WIDTH*e,height:oo.HEIGHT*e,textX:oo.TEXT_PADDING*e,textY:oo.TEXT_Y_OFFSET*e,graphX:oo.TEXT_PADDING*e,graphY:oo.GRAPH_Y_OFFSET*e,graphWidth:oo.GRAPH_WIDTH*e,graphHeight:oo.GRAPH_HEIGHT*e}}createCanvas(){const e=document.createElement("canvas");return e.width=this.dimensions.width,e.height=this.dimensions.height,e.style.cssText=`width:${oo.WIDTH}px;height:${oo.HEIGHT}px`,e}initializeContext(){const e=this.dom.getContext("2d");if(!e)throw new Error("Failed to get 2D context");return e.font=`bold ${oo.FONT_SIZE*this.devicePixelRatio}px ${oo.FONT_FAMILY}`,e.textBaseline="top",e}drawInitialPanel(){const{width:e,height:r,textX:n,textY:i,graphX:o,graphY:a,graphWidth:s,graphHeight:c}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,r),this.context.fillStyle=this.foregroundColor,this.context.fillText(this.name,n,i),this.context.fillRect(o,a,s,c),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=oo.GRAPH_ALPHA,this.context.fillRect(o,a,s,c),this.context.globalAlpha=1}updateMinMax(e){this.minValue=Math.min(this.minValue,e),this.maxValue=Math.max(this.maxValue,e)}clearTextArea(){const{width:e,graphY:r}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,r)}drawText(e){const{textX:r,textY:n}=this.dimensions,i=this.formatText(e);this.context.fillStyle=this.foregroundColor,this.context.fillText(i,r,n)}formatText(e){const r=Math.round(e),n=Math.round(this.minValue),i=Math.round(this.maxValue);return`${r} ${this.name} (${n}-${i})`}scrollGraph(){const{graphX:e,graphY:r,graphWidth:n,graphHeight:i}=this.dimensions,o=this.devicePixelRatio;this.context.drawImage(this.dom,e+o,r,n-o,i,e,r,n-o,i)}drawNewValue(e,r){const{graphX:n,graphY:i,graphWidth:o,graphHeight:a}=this.dimensions,s=this.devicePixelRatio,c=n+o-s;this.context.fillStyle=this.foregroundColor,this.context.fillRect(c,i,s,a);const l=Math.round((1-e/r)*a);this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=oo.GRAPH_ALPHA,this.context.fillRect(c,i,s,l),this.context.globalAlpha=1}}var si;(function(t){t[t.FPS=0]="FPS",t[t.MS=1]="MS",t[t.MEMORY=2]="MEMORY"})(si||(si={}));var ss;let vZ=(ss=class{constructor(){this.dom=null,this.currentMode=0,this.startTime=0,this.lastUpdateTime=0,this.frameCount=0,this.panels=new Map,this.animationFrameId=null,this.isSetup=!1}static getInstance(){return ss.instance||(ss.instance=new ss),ss.instance}setup(){if(!this.isSetup)try{this.dom=this.createOverlayElement(),this.startTime=performance.now(),this.lastUpdateTime=this.startTime,this.initializePanels(),this.showPanel(si.FPS),this.applyOverlayStyles(),document.body.appendChild(this.dom),this.startLoop(),this.isSetup=!0}catch(e){console.warn("Failed to setup stats overlay:",e)}}cleanup(){this.stopLoop(),this.dom&&this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.dom=null,this.panels.clear(),this.isSetup=!1}showPanel(e){Array.from(this.dom.children).forEach((n,i)=>{n.style.display=i===e?"block":"none"}),this.currentMode=e}update(){this.startTime=this.updateStats()}createOverlayElement(){const e=document.createElement("div");return e.addEventListener("click",this.handleClick.bind(this),!1),e}applyOverlayStyles(){Object.assign(this.dom.style,lp.OVERLAY_STYLES)}handleClick(e){e.preventDefault();const r=this.dom.children.length;this.showPanel((this.currentMode+1)%r)}initializePanels(){const e=new Rv(Zs[si.FPS].name,Zs[si.FPS].foregroundColor,Zs[si.FPS].backgroundColor);this.addPanel(si.FPS,e);const r=new Rv(Zs[si.MS].name,Zs[si.MS].foregroundColor,Zs[si.MS].backgroundColor);if(this.addPanel(si.MS,r),this.isMemoryAvailable()){const n=new Rv(Zs[si.MEMORY].name,Zs[si.MEMORY].foregroundColor,Zs[si.MEMORY].backgroundColor);this.addPanel(si.MEMORY,n)}}isMemoryAvailable(){return performance.memory!==void 0}addPanel(e,r){this.dom.appendChild(r.dom),this.panels.set(e,r)}startLoop(){const e=()=>{this.update(),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}updateStats(){this.frameCount++;const e=performance.now(),r=e-this.startTime,n=this.panels.get(si.MS);if(n&&n.update(r,lp.MAX_MS_VALUE),e>=this.lastUpdateTime+lp.UPDATE_INTERVAL){const i=this.frameCount*Pv.MS_PER_SECOND/(e-this.lastUpdateTime),o=this.panels.get(si.FPS);o&&o.update(i,lp.MAX_FPS_VALUE),this.lastUpdateTime=e,this.frameCount=0,this.updateMemoryPanel()}return e}updateMemoryPanel(){const e=this.panels.get(si.MEMORY);if(!e)return;const r=performance;if(r.memory){const n=r.memory.usedJSHeapSize/Pv.BYTES_TO_MB,i=r.memory.jsHeapSizeLimit/Pv.BYTES_TO_MB;e.update(n,i)}}},ss.instance=null,ss);const g_=vZ.getInstance(),Wm=2;class JC{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const o=this._getViewportsAsArray().map(a=>{if(a.getFrameOfReferenceUID()===n)return a.id});this.renderViewports(o)},this.id=e||un(),this.useCPURendering=Xf(),gh.set(this),!Eb())throw new Error("@cornerstonejs/core is not initialized, run init() first");this._viewports=new Map,this.hasBeenDestroyed=!1,Aa()?.debug?.statsOverlay&&g_.setup()}enableElement(e){const r=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:n,viewportId:i}=r;if(!n)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:a}=r,s=ls(a);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(r):this.addCustomViewport(r);const c=Oo(n),{background:l}=r.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const r=this.getViewport(e);if(!r){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(r),!ls(r.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),r.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const r=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const n=[],i=[];r.forEach(o=>{!this.useCPURendering&&!ls(o.type)?n.push(o):i.push(o)}),this.setVtkjsDrivenViewports(n),this.setCustomViewports(i),r.forEach(o=>{const a=Oo(o.element),{background:s}=o.defaultOptions;this.fillCanvasWithBackgroundColor(a,s)})}resize(e=!0,r=!0){this._throwIfDestroyed();const n=this._getViewportsAsArray(),i=[],o=[];n.forEach(a=>{ls(a.type)?o.push(a):i.push(a)}),i.length&&this._resizeVTKViewports(i,r,e),o.length&&this._resizeUsingCustomResizeHandler(o,r,e)}getViewport(e){return this._viewports?.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const r=this.getViewport(e);if(!r)throw new Error(`Viewport with Id ${e} does not exist`);if(!(r instanceof qn))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return r}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(r=>r instanceof qn)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),r=n=>n instanceof ir;return e.filter(r)}render(){const r=this.getViewports().map(n=>n.id);this._setViewportsToBeRenderedNextFrame(r)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(g_.cleanup(),this.useCPURendering||(this._getViewportsAsArray().forEach(r=>{this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(r.id)}),this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),gh.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,r){const n=e.getContext("2d");let i;if(r){const o=r.map(a=>Math.floor(255*a));i=`rgb(${o[0]}, ${o[1]}, ${o[2]})`}else i="black";n.fillStyle=i,n.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:r,defaultOptions:n}=e;let i=n;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},r===Fn.ORTHOGRAPHIC&&(i={...i,orientation:Ma.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const r=[];return e.forEach(n=>{r.push(this._normalizeViewportInputEntry(n))}),r}_resizeUsingCustomResizeHandler(e,r=!0,n=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const o=i.getCamera();i.resetCamera(),r&&i.setCamera(o)}),n&&this.render()}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addCustomViewport(e){const{element:r,viewportId:n,type:i,defaultOptions:o}=e;r.tabIndex=-1;const a=Oo(r),{clientWidth:s,clientHeight:c}=a;(a.width!==s||a.height!==c)&&(a.width=s,a.height=c);const l={id:n,renderingEngineId:this.id,element:r,type:i,canvas:a,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:o||{}},f=Q9[i],u=new f(l);this._viewports.set(n,u);const d={element:r,viewportId:n,renderingEngineId:this.id};Xe(ke,Ge.ELEMENT_ENABLED,d)}getRenderer(e){return this.offscreenMultiRenderWindow.getRenderer(e)}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");return this.offscreenMultiRenderWindow}setCustomViewports(e){e.forEach(r=>{this.addCustomViewport(r)})}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(r=>{this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_resetViewport(e){const r=this.id,{element:n,canvas:i,id:o}=e,a={element:n,viewportId:o,renderingEngineId:r};e.removeWidgets(),Xe(ke,Ge.ELEMENT_DISABLED,a),n.removeAttribute("data-viewport-uid"),n.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(r=>{this._resetViewport(r)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}}class ZC extends JC{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const r=this._getViewportsAsArray(),n=[];for(let i=0;i<r.length;i++){const o=r[i];if(this._needsRender.has(o.id)){const a=this.renderViewportUsingCustomOrVtkPipeline(o);if(n.push(a),o.setRendered(),this._needsRender.delete(o.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,n.forEach(i=>{i?.element&&Xe(i.element,Ge.IMAGE_RENDERED,i)})},this.useCPURendering||(this.offscreenMultiRenderWindow=XI.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer))}enableVTKjsDrivenViewport(e){const n=this._getViewportsAsArray().filter(f=>ls(f.type)===!1),i=n.map(f=>f.canvas),o=Oo(e.element);i.push(o);const{offScreenCanvasWidth:a,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(n,a,s),l={...e,canvas:o};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:a,offScreenCanvasHeight:s,xOffset:c})}addVtkjsDrivenViewport(e,r){const{element:n,canvas:i,viewportId:o,type:a,defaultOptions:s}=e;n.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:f}=r,{sxStartDisplayCoords:u,syStartDisplayCoords:d,sxEndDisplayCoords:h,syEndDisplayCoords:g,sx:p,sy:m,sWidth:w,sHeight:v}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,f);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,d,h,g],id:o,background:s.background?s.background:[0,0,0]});const y={id:o,element:n,renderingEngineId:this.id,type:a,canvas:i,sx:p,sy:m,sWidth:w,sHeight:v,defaultOptions:s||{}};let C;if(a===Fn.STACK)C=new qn(y);else if(a===Fn.ORTHOGRAPHIC||a===Fn.PERSPECTIVE)C=new zn(y);else if(a===Fn.VOLUME_3D)C=new a2(y);else throw new Error(`Viewport Type ${a} is not supported`);this._viewports.set(o,C);const x={element:n,viewportId:o,renderingEngineId:this.id};C.suppressEvents||Xe(ke,Ge.ELEMENT_ENABLED,x)}setVtkjsDrivenViewports(e){if(e.length){const r=e.map(a=>Oo(a.element));r.forEach(a=>{const s=window.devicePixelRatio||1,c=a.getBoundingClientRect();a.width=c.width*s,a.height=c.height*s});const{offScreenCanvasWidth:n,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(r);let o=0;for(let a=0;a<e.length;a++){const s=e[a],c=r[a],l={...s,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:n,offScreenCanvasHeight:i,xOffset:o}),o+=c.width}}}_resizeVTKViewports(e,r=!0,n=!0){const i=e.map(o=>Oo(o.element));if(i.forEach(o=>{const a=window.devicePixelRatio||1;o.width=o.clientWidth*a,o.height=o.clientHeight*a}),i.length){const{offScreenCanvasWidth:o,offScreenCanvasHeight:a}=this._resizeOffScreenCanvas(i);this._resize(e,o,a)}e.forEach(o=>{const a=o.getCamera(),s=o.getRotation(),{flipHorizontal:c}=a;o.resetCameraForResize();const l=o.getDisplayArea();r&&(l?(c&&o.setCamera({flipHorizontal:c}),s&&o.setViewPresentation({rotation:s})):o.setCamera(a))}),n&&this.render()}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,r=e.getRenderWindow(),n=e.getRenderers();if(n.length){for(let i=0;i<n.length;i++){const{renderer:o,id:a}=n[i];this._needsRender.has(a)?o.setDraw(!0):o.setDraw(!1)}r.render();for(let i=0;i<n.length;i++)n[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let r;if(e.sWidth<Wm||e.sHeight<Wm){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(ls(e.type)===!0)r=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:n}=this,a=n.getOpenGLRenderWindow().get3DContext().canvas;r=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,a)}return r}_renderViewportFromVtkCanvasToOnscreenCanvas(e,r){const{element:n,canvas:i,sx:o,sy:a,sWidth:s,sHeight:c,id:l,renderingEngineId:f,suppressEvents:u}=e,{width:d,height:h}=i;return i.getContext("2d").drawImage(r,o,a,s,c,0,0,d,h),{element:n,suppressEvents:u,viewportId:l,renderingEngineId:f,viewportStatus:e.viewportStatus}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:r,offscreenMultiRenderWindow:n}=this,i=Math.max(...e.map(a=>a.height));let o=0;return e.forEach(a=>{o+=a.width}),r.width=o,r.height=i,n.resize(),{offScreenCanvasWidth:o,offScreenCanvasHeight:i}}_resize(e,r,n){let i=0;for(let o=0;o<e.length;o++){const a=e[o],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:f,sx:u,sy:d,sWidth:h,sHeight:g}=this._getViewportCoordsOnOffScreenCanvas(a,r,n,i);i+=a.canvas.width,a.sx=u,a.sy=d,a.sWidth=h,a.sHeight=g,this.offscreenMultiRenderWindow.getRenderer(a.id).setViewport(s,c,l,f)}return i}_getViewportCoordsOnOffScreenCanvas(e,r,n,i){const{canvas:o}=e,{width:a,height:s}=o,c=i,l=0,f=c/r,u=l+(n-s)/n,d=a/r,h=s/n;return{sxStartDisplayCoords:f,syStartDisplayCoords:u,sxEndDisplayCoords:f+d,syEndDisplayCoords:u+h,sx:c,sy:l,sWidth:a,sHeight:s}}}class yZ{constructor(e){this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext=new Map,this.viewportSizes=new Map,this.contextMaxSizes=new Map;for(let r=0;r<e;r++){const n=XI.newInstance(),i=document.createElement("div");n.setContainer(i),this.contexts.push(n),this.offScreenCanvasContainers.push(i)}}getContextByIndex(e){return e>=0&&e<this.contexts.length?{context:this.contexts[e],container:this.offScreenCanvasContainers[e]}:null}assignViewportToContext(e,r){this.viewportToContext.set(e,r)}getContextIndexForViewport(e){return this.viewportToContext.get(e)}getAllContexts(){return this.contexts}getContextCount(){return this.contexts.length}updateViewportSize(e,r,n){const i=this.viewportToContext.get(e);if(i===void 0)return!1;this.viewportSizes.set(e,{width:r,height:n});const o=this.contextMaxSizes.get(i),a=this.calculateMaxSizeForContext(i);return this.contextMaxSizes.set(i,a),!o||o.width!==a.width||o.height!==a.height}getMaxSizeForContext(e){return this.contextMaxSizes.get(e)}calculateMaxSizeForContext(e){let r=0,n=0;return this.viewportToContext.forEach((i,o)=>{if(i===e){const a=this.viewportSizes.get(o);a&&(r=Math.max(r,a.width),n=Math.max(n,a.height))}}),{width:r,height:n}}removeViewport(e){const r=this.viewportToContext.get(e);if(this.viewportToContext.delete(e),this.viewportSizes.delete(e),r!==void 0){const n=this.calculateMaxSizeForContext(r);this.contextMaxSizes.set(r,n)}}destroy(){this.contexts.forEach(e=>{e.delete()}),this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext.clear(),this.viewportSizes.clear(),this.contextMaxSizes.clear()}}class x5 extends JC{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const o=this._getViewportsAsArray().filter(s=>this._needsRender.has(s.id));if(o.length===0){this._animationFrameSet=!1,this._animationFrameHandle=null;return}const a=o.map(s=>{const c=this.renderViewportUsingCustomOrVtkPipeline(s);return s.setRendered(),this._needsRender.delete(s.id),c});this._animationFrameSet=!1,this._animationFrameHandle=null,a.forEach(s=>{s?.element&&Xe(s.element,Ge.IMAGE_RENDERED,s)})};const{rendering:r}=Aa(),{webGlContextCount:n}=r;this.useCPURendering||(this.contextPool=new yZ(n))}enableVTKjsDrivenViewport(e){const i=this._getViewportsAsArray().filter(s=>ls(s.type)===!1).map(s=>s.canvas),o=Oo(e.element);i.push(o);const a={...e,canvas:o};this.addVtkjsDrivenViewport(a)}addVtkjsDrivenViewport(e){const{element:r,canvas:n,viewportId:i,type:o,defaultOptions:a}=e;r.tabIndex=-1;let s=0;if(o===Fn.STACK){const p=this.contextPool.getAllContexts();s=this._viewports.size%p.length}this.contextPool.assignViewportToContext(i,s),this.contextPool.updateViewportSize(i,n.width,n.height);const c=this.contextPool.getContextByIndex(s),{context:l,container:f}=c,u=this.contextPool.getMaxSizeForContext(s);f.width=u.width,f.height=u.height,l.resize(),l.addRenderer({viewport:[0,0,1,1],id:i,background:a.background?a.background:[0,0,0]});const d={id:i,element:r,renderingEngineId:this.id,type:o,canvas:n,sx:0,sy:0,sWidth:n.width,sHeight:n.height,defaultOptions:a||{}};let h;if(o===Fn.STACK)h=new qn(d);else if(o===Fn.ORTHOGRAPHIC||o===Fn.PERSPECTIVE)h=new zn(d);else if(o===Fn.VOLUME_3D)h=new a2(d);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(i,h);const g={element:r,viewportId:i,renderingEngineId:this.id};h.suppressEvents||Xe(ke,Ge.ELEMENT_ENABLED,g)}setVtkjsDrivenViewports(e){if(e.length){const r=e.map(n=>Oo(n.element));r.forEach(n=>{const i=window.devicePixelRatio||1,o=n.getBoundingClientRect();n.width=o.width*i,n.height=o.height*i});for(let n=0;n<e.length;n++){const i=e[n],o=r[n],a={...i,canvas:o};this.addVtkjsDrivenViewport(a)}}}_resizeVTKViewports(e,r=!0,n=!0){const i=e.map(o=>Oo(o.element));i.forEach(o=>{const a=window.devicePixelRatio||1;o.width=o.clientWidth*a,o.height=o.clientHeight*a}),i.length&&this._resize(e),e.forEach(o=>{const a=o.getCamera(),s=o.getRotation(),{flipHorizontal:c}=a;o.resetCameraForResize();const l=o.getDisplayArea();r&&(l?(c&&o.setCamera({flipHorizontal:c}),s&&o.setViewPresentation({rotation:s})):o.setCamera(a))}),n&&this.render()}renderViewportUsingCustomOrVtkPipeline(e){if(ls(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const r=this.contextPool.getContextIndexForViewport(e.id),n=this.contextPool.getContextByIndex(r),{context:i,container:o}=n;return this._renderViewportWithContext(e,i,o)}_renderViewportWithContext(e,r,n){if(e.sWidth<Wm||e.sHeight<Wm){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(ls(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");r.getRenderer(e.id)||r.addRenderer({viewport:[0,0,1,1],id:e.id,background:e.defaultOptions?.background||[0,0,0]});const i=r.getRenderWindow(),o=i.getViews()[0],a=o.getRenderPasses(),s=this.getViewportRenderPasses(e.id);s&&o.setRenderPasses(s),this._resizeOffScreenCanvasForViewport(e,n,r);const c=r.getRenderer(e.id),l=this.contextPool.getContextIndexForViewport(e.id),f=this.contextPool.getMaxSizeForContext(l),u=e.canvas.width,d=e.canvas.height,h=Math.min(1,u/f.width),g=Math.min(1,d/f.height);c.setViewport(0,0,h,g);const p=r.getRenderers();p.forEach(({renderer:x,id:T})=>{x.setDraw(T===e.id)});const m=this.getWidgetRenderers();m.forEach((x,T)=>{T.setDraw(x===e.id)}),i.render(),p.forEach(({renderer:x})=>x.setDraw(!1)),m.forEach((x,T)=>{T.setDraw(!1)}),a&&o.setRenderPasses(a);const y=r.getOpenGLRenderWindow().get3DContext().canvas;return this._copyToOnscreenCanvas(e,y)}_renderViewportFromVtkCanvasToOnscreenCanvas(e,r){return this._copyToOnscreenCanvas(e,r)}_resizeOffScreenCanvasForViewport(e,r,n){const i=this.contextPool.getContextIndexForViewport(e.id);if(i===void 0||!this.contextPool.updateViewportSize(e.id,e.canvas.width,e.canvas.height))return;const a=this.contextPool.getMaxSizeForContext(i);r.width===a.width&&r.height===a.height||(r.width=a.width,r.height=a.height,n.resize())}_copyToOnscreenCanvas(e,r){const{element:n,canvas:i,id:o,renderingEngineId:a,suppressEvents:s}=e,{width:c,height:l}=i,f=i.getContext("2d"),u=this.contextPool.getContextIndexForViewport(o),h=this.contextPool.getMaxSizeForContext(u).height-l;return f.drawImage(r,0,h,c,l,0,0,c,l),{element:n,suppressEvents:s,viewportId:o,renderingEngineId:a,viewportStatus:e.viewportStatus}}_resize(e){const r=new Set;for(const n of e){n.sx=0,n.sy=0,n.sWidth=n.canvas.width,n.sHeight=n.canvas.height;const i=this.contextPool.getContextIndexForViewport(n.id);this.contextPool.updateViewportSize(n.id,n.canvas.width,n.canvas.height)&&r.add(i);const a=this.contextPool.getContextByIndex(i),{context:s}=a,c=s.getRenderer(n.id),l=this.contextPool.getMaxSizeForContext(i),f=Math.min(1,n.canvas.width/l.width),u=Math.min(1,n.canvas.height/l.height);c.setViewport(0,0,f,u)}r.forEach(n=>{const i=this.contextPool.getContextByIndex(n);if(i){const{context:o,container:a}=i,s=this.contextPool.getMaxSizeForContext(n);a.width=s.width,a.height=s.height,o.resize()}})}getWidgetRenderers(){const e=this._getViewportsAsArray(),r=new Map;return e.forEach(n=>{(n.getWidgets?n.getWidgets():[]).forEach(o=>{const a=o.getRenderer?o.getRenderer():null;a&&r.set(a,n.id)})}),r}getViewportRenderPasses(e){const r=this.getViewport(e);return r?.getRenderPasses?r.getRenderPasses():null}getRenderer(e){const r=this.contextPool?.getContextIndexForViewport(e),n=this.contextPool.getContextByIndex(r),{context:i}=n;return i.getRenderer(e)}disableElement(e){const r=this.getViewport(e);if(r&&(super.disableElement(e),!ls(r.type)&&!this.useCPURendering)){const n=this.contextPool.getContextIndexForViewport(e);if(n!==void 0){const i=this.contextPool.getContextByIndex(n);if(i){const{context:o}=i;o.removeRenderer(e)}}this.contextPool.removeViewport(e)}}destroy(){this.contextPool&&this.contextPool.destroy(),super.destroy()}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");const r=this.contextPool.getContextIndexForViewport(e);return this.contextPool.getContextByIndex(r).context}}class e7{constructor(e){const n=Aa()?.rendering?.renderingEngineMode;switch(n){case Hu.Tiled:this._implementation=new ZC(e);break;case Hu.ContextPool:this._implementation=new x5(e);break;default:console.warn(`RenderingEngine: Unknown rendering engine mode "${n}". Defaulting to Next rendering engine.`),this._implementation=new x5(e);break}}get id(){return this._implementation.id}enableElement(e){return this._implementation.enableElement(e)}disableElement(e){return this._implementation.disableElement(e)}setViewports(e){return this._implementation.setViewports(e)}resize(e=!0,r=!0){return this._implementation.resize(e,r)}getViewport(e){return this._implementation.getViewport(e)}getViewports(){return this._implementation.getViewports()}getStackViewport(e){return this._implementation.getStackViewport(e)}getStackViewports(){return this._implementation.getStackViewports()}getVolumeViewports(){return this._implementation.getVolumeViewports()}getRenderer(e){return this._implementation.getRenderer(e)}fillCanvasWithBackgroundColor(e,r){return this._implementation.fillCanvasWithBackgroundColor(e,r)}render(){return this._implementation.render()}renderViewports(e){return this._implementation.renderViewports(e)}renderViewport(e){return this._implementation.renderViewport(e)}destroy(){return this._implementation.destroy()}getOffscreenMultiRenderWindow(e){return this._implementation.getOffscreenMultiRenderWindow(e)}}const wZ="4.14.4";class t7{constructor(e){this._color=[200,0,0],this.id=e.id,this._points=e.points,this._polys=e.polys,this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes(),this._updateCentroid(),this._visible=!0}_getSizeInBytes(){return this._points.length*4+this._polys.length*4}_updateCentroid(){const e=this._points.length/3;let r=0,n=0,i=0;for(let o=0;o<this._points.length;o+=3)r+=this._points[o],n+=this._points[o+1],i+=this._points[o+2];this._centroid=[r/e,n/e,i/e]}get color(){return this._color}set color(e){this._color=e}get points(){return this._points}set points(e){this._points=e,this._updateCentroid()}get polys(){return this._polys}set polys(e){this._polys=e}get segmentIndex(){return this._segmentIndex}get visible(){return this._visible}set visible(e){this._visible=e}get centroid(){return this._centroid}get flatPointsArray(){return this._points}get totalNumberOfPoints(){return this._points.length/3}}function n7(t){return new TextDecoder("latin1").decode(t)}function CZ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=n7(t),i=e.exec(n);if(!i)return{text:n};const o=i.index+i[0].length,a=n.substring(0,o);let s=null;const c=r?r.exec(n):null;if(c){const l=n.substr(c.index);s={text:a+l,binaryBuffer:t.slice(o,c.index)}}else s={text:a,binaryBuffer:t.slice(o)};return s}var bh={arrayBufferToString:n7,extractBinary:CZ};const QC={};function r7(t){return!!QC[t]}function xZ(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return QC[t](e)}function i7(t,e){QC[t]=e}var wg={get:xZ,has:r7,registerType:i7};function o7(){const t=new ArrayBuffer(4),e=new Uint8Array(t),r=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,r[0]===3569595041?"LittleEndian":r[0]===2712847316?"BigEndian":null}const TZ=o7();function SZ(t,e){if(e<2)return;const r=new Int8Array(t),n=r.length,i=[];for(let o=0;o<n;o+=e){for(let a=0;a<e;a++)i.push(r[o+a]);for(let a=0;a<e;a++)r[o+a]=i.pop()}}var Av={ENDIANNESS:TZ,getEndianness:o7,swapBytes:SZ};const{vtkErrorMacro:a7,vtkDebugMacro:_Z}=K,ex=()=>(a7("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let C0=0;function s2(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new XMLHttpRequest;return n.open(t,e,!0),r.headers&&Object.entries(r.headers).forEach(i=>{let[o,a]=i;return n.setRequestHeader(o,a)}),r.progressCallback&&n.addEventListener("progress",r.progressCallback),n}function EZ(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,n)=>{const i=s2("GET",t,e);i.onreadystatechange=o=>{i.readyState===4&&(i.status===200||i.status===0?r(i.response):n({xhr:i,e:o}))},i.responseType="arraybuffer",i.send()})}function bZ(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return n&&n.compression?ex():r.ref&&!r.ref.pending?new Promise((i,o)=>{const a=[e,r.ref.basepath,r.ref.id].join("/"),s=s2("GET",a,n);s.onreadystatechange=c=>{s.readyState===1&&(r.ref.pending=!0,++C0===1&&t?.invokeBusy&&t.invokeBusy(!0)),s.readyState===4&&(r.ref.pending=!1,s.status===200||s.status===0?(r.buffer=s.response,r.ref.encode==="JSON"?r.values=JSON.parse(r.buffer):(Av.ENDIANNESS!==r.ref.encode&&Av.ENDIANNESS&&(_Z(`Swap bytes of ${r.name}`),Av.swapBytes(r.buffer,C8[r.dataType])),r.values=K.newTypedArray(r.dataType,r.buffer)),r.values.length!==r.size&&a7(`Error in FetchArray: ${r.name}, does not have the proper array size. Got ${r.values.length}, instead of ${r.size}`),delete r.ref,--C0===0&&t?.invokeBusy&&t.invokeBusy(!1),t?.modified&&t.modified(),i(r)):o({xhr:s,e:c}))},s.responseType=r.dataType!=="string"?"arraybuffer":"text",s.send()}):Promise.resolve(r)}function DZ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?ex():new Promise((n,i)=>{const o=s2("GET",e,r);o.onreadystatechange=a=>{o.readyState===1&&++C0===1&&t?.invokeBusy&&t.invokeBusy(!0),o.readyState===4&&(--C0===0&&t?.invokeBusy&&t.invokeBusy(!1),o.status===200||o.status===0?n(JSON.parse(o.responseText)):i({xhr:o,e:a}))},o.responseType="text",o.send()})}function IZ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?ex():new Promise((n,i)=>{const o=s2("GET",e,r);o.onreadystatechange=a=>{o.readyState===1&&++C0===1&&t?.invokeBusy&&t.invokeBusy(!0),o.readyState===4&&(--C0===0&&t?.invokeBusy&&t.invokeBusy(!1),o.status===200||o.status===0?n(o.responseText):i({xhr:o,e:a}))},o.responseType="text",o.send()})}function MZ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((n,i)=>{const o=new Image;r.crossOrigin&&(o.crossOrigin=r.crossOrigin),o.onload=()=>n(o),o.onerror=i,o.src=e})}const OZ={fetchArray:bZ,fetchJSON:DZ,fetchText:IZ,fetchBinary:EZ,fetchImage:MZ};r7("http")||i7("http",t=>OZ);const Lv={ASCII:"ascii",BINARY_LITTLE_ENDIAN:"binary_little_endian"},p_={diffuse_red:"red",diffuse_green:"green",diffuse_blue:"blue"},s7={patternHeader:/ply([\s\S]*)end_header\r?\n/,patternBody:/end_header\s([\s\S]*)$/};function m_(t){let e="",r=0;const n=s7.patternHeader.exec(t);n!==null&&(e=n[1],r=n[0].length);const i={comments:[],elements:[],headerLength:r},o=e.split(`
`);let a,s,c;for(let l=0;l<o.length;l++){let f=o[l];if(f=f.trim(),f!==""){let u;switch(c=f.split(/\s+/),s=c.shift(),f=c.join(" "),s){case"format":i.format=c[0],i.version=c[1];break;case"comment":i.comments.push(f);break;case"element":a!==void 0&&i.elements.push(a),a={},a.name=c[0],a.count=parseInt(c[1],10),a.properties=[];break;case"property":u={type:c[0]},u.type==="list"?(u.name=c[3],u.countType=c[1],u.itemType=c[2]):u.name=c[1],u.name in p_&&(u.name=p_[u.name]),a.properties.push(u);break;case"obj_info":i.objInfo=f;break;default:console.warn("unhandled",s,c);break}}}return a!==void 0&&i.elements.push(a),i}function v_(t,e,r,n){const i=e.find(y=>y.name==="vertex"),o=e.find(y=>y.name==="face");let a=0,s=0;i&&(a=i.count),o&&(s=o.count);let c=new Float32Array(a*3),l=new Uint8Array(a*3),f=new Float32Array(a*2),u=new Float32Array(a*3);const d=t.colors.length>0,h=t.uvs.length>0,g=t.normals.length>0,p=t.faceVertexUvs.length>0,m=new Map;let w=a;for(let y=0;y<a;y++){let C=y*3+0,x=y*3+1;const T=y*3+2;c[C]=t.vertices[C],c[x]=t.vertices[x],c[T]=t.vertices[T],d&&(l[C]=t.colors[C],l[x]=t.colors[x],l[T]=t.colors[T]),h?(C=y*2+0,x=y*2+1,f[C]=t.uvs[C],f[x]=t.uvs[x]):(f[y*2]=-1,f[y*2+1]=-1),g&&(u[C]=t.normals[C],u[x]=t.normals[x],u[T]=t.normals[T])}if(p&&!h&&s>0){let y=0,C=0;if(n){const x=[],T=[],S=[],_=[];for(let E=0;E<s;++E){const D=t.indices[y++],b=t.faceVertexUvs[C++];if(b&&D*2===b.length)for(let I=0;I<D;++I){const O=t.indices[y+I],M=[b[I*2],b[I*2+1]],R=[f[O*2],f[O*2+1]];if(R[0]===-1){f[O*2]=M[0],f[O*2+1]=M[1];const A=`${M[0]},${M[1]}`;m.has(A)||m.set(A,[]),m.get(A).push(O)}else if(Math.abs(R[0]-M[0])>r||Math.abs(R[1]-M[1])>r){const B=`${M[0]},${M[1]}`;let k=-1;if(m.has(B)){const L=m.get(B);for(let F=0,j=L.length;F<j;F++){const J=L[F];if(Math.abs(c[J*3]-c[O*3])<=r&&Math.abs(c[J*3+1]-c[O*3+1])<=r&&Math.abs(c[J*3+2]-c[O*3+2])<=r){k=J;break}}}k===-1?(x.push(c[O*3],c[O*3+1],c[O*3+2]),d&&T.push(l[O*3],l[O*3+1],l[O*3+2]),g&&S.push(u[O*3],u[O*3+1],u[O*3+2]),_.push(M[0],M[1]),m.has(B)||m.set(B,[]),m.get(B).push(w),t.indices[y+I]=w,w++):t.indices[y+I]=k}}y+=D}if(x.length>0){const E=a+x.length/3,D=new Float32Array(E*3),b=new Float32Array(E*2),I=d?new Uint8Array(E*3):null,O=g?new Float32Array(E*3):null;D.set(c),b.set(f),d&&I&&I.set(l),g&&O&&O.set(u),D.set(x,a*3),b.set(_,a*2),d&&I&&I.set(T,a*3),g&&O&&O.set(S,a*3),c=D,f=b,d&&(l=I),g&&(u=O)}}else for(let x=0;x<s;++x){const T=t.indices[y++],S=t.faceVertexUvs[C++];if(S&&T*2===S.length)for(let _=0;_<T;++_){const E=t.indices[y++];f[E*2]=S[_*2],f[E*2+1]=S[_*2+1]}else y+=T}}const v=rr.newInstance();if(v.getPoints().setData(c,3),s>0)v.getPolys().setData(Uint32Array.from(t.indices));else{const y=new Uint32Array(a*2);for(let C=0;C<a;C++)y[C*2]=1,y[C*2+1]=C;v.getVerts().setData(y)}if(d&&v.getPointData().setScalars(Tt.newInstance({numberOfComponents:3,values:l,name:"RGB"})),h||p){const y=Tt.newInstance({numberOfComponents:2,values:f,name:"TextureCoordinates"}),C=v.getPointData();C.addArray(y),C.setActiveTCoords(y.getName())}return g&&v.getPointData().setNormals(Tt.newInstance({numberOfComponents:3,name:"Normals",values:u})),v}function Nv(t,e){let r;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":r=parseInt(t,10);break;case"float":case"double":case"float32":case"float64":r=parseFloat(t);break;default:console.log("Unsupported type");break}return r}function PZ(t,e){const r=e.split(/\s+/),n={};for(let i=0;i<t.length;i++)if(t[i].type==="list"){const o=[],a=Nv(r.shift(),t[i].countType);for(let s=0;s<a;s++)o.push(Nv(r.shift(),t[i].itemType));n[t[i].name]=o}else n[t[i].name]=Nv(r.shift(),t[i].type);return n}function y_(t,e,r){if(e==="vertex")t.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&t.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r?t.uvs.push(r.s,r.t):"u"in r&&"v"in r?t.uvs.push(r.u,r.v):"texture_u"in r&&"texture_v"in r&&t.uvs.push(r.texture_u,r.texture_v),"red"in r&&"green"in r&&"blue"in r&&t.colors.push(r.red,r.green,r.blue);else if(e==="face"){const n=r.vertex_indices||r.vertex_index,i=r.texcoord;n&&n.length>0&&(t.indices.push(n.length),n.forEach((o,a)=>{t.indices.push(o)})),t.faceVertexUvs.push(i)}}function Vv(t,e,r,n){let i;switch(r){case"int8":case"char":i=[t.getInt8(e),1];break;case"uint8":case"uchar":i=[t.getUint8(e),1];break;case"int16":case"short":i=[t.getInt16(e,n),2];break;case"uint16":case"ushort":i=[t.getUint16(e,n),2];break;case"int32":case"int":i=[t.getInt32(e,n),4];break;case"uint32":case"uint":i=[t.getUint32(e,n),4];break;case"float32":case"float":i=[t.getFloat32(e,n),4];break;case"float64":case"double":i=[t.getFloat64(e,n),8];break;default:console.log("Unsupported type");break}return i}function RZ(t,e,r,n){const i={};let o,a=0;for(let s=0;s<r.length;s++)if(r[s].type==="list"){const c=[];o=Vv(t,e+a,r[s].countType,n);const l=o[0];a+=o[1];for(let f=0;f<l;f++)o=Vv(t,e+a,r[s].itemType,n),c.push(o[0]),a+=o[1];i[r[s].name]=c}else o=Vv(t,e+a,r[s].type,n),i[r[s].name]=o[0],a+=o[1];return[i,a]}function AZ(t,e){e.classHierarchy.push("vtkPLYReader"),e.dataAccessHelper||(e.dataAccessHelper=wg.get("http"));function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{compression:o,progressCallback:a}=e;return i.binary?e.dataAccessHelper.fetchBinary(n,{compression:o,progressCallback:a}):e.dataAccessHelper.fetchText(t,n,{compression:o,progressCallback:a})}t.setUrl=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{binary:!0};e.url=n;const o=n.split("/");return o.pop(),e.baseURL=o.join("/"),e.compression=i.compression,t.loadData({progressCallback:i.progressCallback,binary:!!i.binary})},t.loadData=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=r(e.url,n);return i.then(t.parse),i},t.parse=n=>{typeof n=="string"?t.parseAsText(n):t.parseAsArrayBuffer(n)},t.parseAsArrayBuffer=n=>{if(!n)return;if(n!==e.parseData)t.modified();else return;let i=n;n instanceof ArrayBuffer&&(i=bh.arrayBufferToString(n));const o=m_(i);if(!(o.format!==Lv.ASCII)){t.parseAsText(i);return}e.parseData=n;const s={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},c=o.format===Lv.BINARY_LITTLE_ENDIAN,l=n instanceof ArrayBuffer?n:n.buffer,f=new DataView(l,o.headerLength);let u,d=0;for(let g=0;g<o.elements.length;g++)for(let p=0;p<o.elements[g].count;p++){u=RZ(f,d,o.elements[g].properties,c),d+=u[1];const m=u[0];y_(s,o.elements[g].name,m)}const h=v_(s,o.elements,e.faceTextureTolerance,e.duplicatePointsForFaceTexture);e.output[0]=h},t.parseAsText=n=>{if(!n)return;if(n!==e.parseData)t.modified();else return;e.parseData=n;let i=n;n instanceof ArrayBuffer&&(i=bh.arrayBufferToString(n));const o=m_(i);if(o.format!==Lv.ASCII){t.parseAsArrayBuffer(n);return}const s={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},c=s7.patternBody.exec(i);let l="";c!==null&&(l=c[1]);const f=l.split(`
`);let u=0,d=0;for(let g=0;g<f.length;g++){let p=f[g];if(p=p.trim(),p!==""){d>=o.elements[u].count&&(u++,d=0);const m=PZ(o.elements[u].properties,p);y_(s,o.elements[u].name,m),d++}}const h=v_(s,o.elements,e.faceTextureTolerance,e.duplicatePointsForFaceTexture);e.output[0]=h},t.requestData=(n,i)=>{t.parse(e.parseData)}}const LZ={faceTextureTolerance:1e-6,duplicatePointsForFaceTexture:!0};function c7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LZ,r),K.obj(t,e),K.get(t,e,["url","baseURL","duplicatePointsForFaceTexture","faceTextureTolerance"]),K.setGet(t,e,["dataAccessHelper"]),K.algo(t,e,0,1),AZ(t,e),e.compression||(e.compression=null),e.progressCallback||(e.progressCallback=null)}const NZ=K.newInstance(c7,"vtkPLYReader");var VZ={extend:c7,newInstance:NZ};const{vtkErrorMacro:kv}=K;function kZ(t){const r=t.split(" ").filter(i=>i.indexOf("=")>-1),n={};for(let i=0;i<r.length;++i){const a=r[i].split("=");a.length===2&&(n[a[0]]=a[1])}return n}function w_(t,e){for(let r=0;r<t.length;r++)e.push(t[r])}function FZ(t,e,r,n,i){const o=t[e];if(o===void 0)return-1;if(o.indexOf("endfacet")!==-1||o.indexOf("facet")===-1)return e+1;let a=0,s=2;const c=r.length/3,l=o.split(/[ \t]+/).filter(f=>f).slice(-3).map(Number);for(w_(l,i);t[e+s].indexOf("vertex")!==-1;){const u=t[e+s].split(/[ \t]+/).filter(d=>d).slice(-3).map(Number);w_(u,r),a++,s++}n.push(a);for(let f=0;f<a;f++)n.push(c+f);for(;t[e+s]&&t[e+s].indexOf("endfacet")!==-1;)s++;return e+s+2}function UZ(t,e){e.classHierarchy.push("vtkSTLReader"),e.dataAccessHelper||(e.dataAccessHelper=wg.get("http"));function r(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=o.compression!==void 0?o.compression:e.compression,s=o.progressCallback!==void 0?o.progressCallback:e.progressCallback;return o.binary?e.dataAccessHelper.fetchBinary(i,{compression:a,progressCallback:s}):e.dataAccessHelper.fetchText(t,i,{compression:a,progressCallback:s})}function n(i){const o=e.output[0],a=o.getPoints().getData(),s=o.getPolys().getData();if(!a||!s){console.warn("No valid polydata.");return}const c=new Map,l=new Map;let f=0,u=!1;for(let d=0;d<a.length;d+=3){const h=(a[d]*10**i).toFixed(0),g=(a[d+1]*10**i).toFixed(0),p=(a[d+2]*10**i).toFixed(0),m=`${h},${g},${p}`;c.get(m)!==void 0?(l.set(d/3,c.get(m)),u=!0):(l.set(d/3,f),c.set(m,f),f++)}if(u){const d=new Float32Array(c.size*3),h=Array.from(c.keys());for(let p=0;p<h.length;p++){const m=h[p],w=c.get(m)*3,v=m.split(",").map(y=>+y*10**-i);d[w]=v[0],d[w+1]=v[1],d[w+2]=v[2]}const g=new Int32Array(s.length);for(let p=0;p<s.length;p+=4)g[p]=3,g[p+1]=l.get(s[p+1]),g[p+2]=l.get(s[p+2]),g[p+3]=l.get(s[p+3]);o.getPoints().setData(d),o.getPolys().setData(g),o.modified()}}t.setUrl=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{binary:!0};e.url=i;const a=i.split("/");return a.pop(),e.baseURL=a.join("/"),t.loadData(o)},t.loadData=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const o=r(e.url,i);return o.then(t.parse),o},t.parse=i=>{typeof i=="string"?t.parseAsText(i):t.parseAsArrayBuffer(i)},t.parseAsArrayBuffer=i=>{if(!i)return;if(i!==e.parseData)t.modified();else return;e.parseData=i;let o=!1;if(o=84+new DataView(i,0,84).getUint32(80,!0)*50===i.byteLength,!o){t.parseAsText(bh.arrayBufferToString(i));return}const c=i.slice(0,80),l=bh.arrayBufferToString(c),f=kZ(l),u=new DataView(i,84),d=(i.byteLength-84)/50,h=new Float32Array(d*9),g=new Float32Array(d*3),p=new Uint32Array(d*4),m=new Uint16Array(d);let w=0;for(let C=0;C<d;C++){const x=C*50;g[C*3+0]=u.getFloat32(x+0,!0),g[C*3+1]=u.getFloat32(x+4,!0),g[C*3+2]=u.getFloat32(x+8,!0),h[C*9+0]=u.getFloat32(x+12,!0),h[C*9+1]=u.getFloat32(x+16,!0),h[C*9+2]=u.getFloat32(x+20,!0),h[C*9+3]=u.getFloat32(x+24,!0),h[C*9+4]=u.getFloat32(x+28,!0),h[C*9+5]=u.getFloat32(x+32,!0),h[C*9+6]=u.getFloat32(x+36,!0),h[C*9+7]=u.getFloat32(x+40,!0),h[C*9+8]=u.getFloat32(x+44,!0),p[w++]=3,p[w++]=C*3+0,p[w++]=C*3+1,p[w++]=C*3+2,m[C]=u.getUint16(x+48,!0)}const v="SPACE";if(v in f&&f[v]!=="LPS"){const C=f[v],x=new Float32Array(16);switch(x[15]=1,C[0]){case"L":x[0]=1;break;case"R":x[0]=-1;break;default:kv(`Can not convert STL file from ${C} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}switch(C[1]){case"P":x[5]=1;break;case"A":x[5]=-1;break;default:kv(`Can not convert STL file from ${C} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}switch(C[2]){case"S":x[10]=1;break;case"I":x[10]=-1;break;default:kv(`Can not convert STL file from ${C} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}ti.buildFromDegree().setMatrix(x).apply(h).apply(g)}const y=rr.newInstance();y.getPoints().setData(h,3),y.getPolys().setData(p),y.getCellData().setScalars(Tt.newInstance({name:"Attribute",values:m})),y.getCellData().setNormals(Tt.newInstance({name:"Normals",values:g,numberOfComponents:3})),e.output[0]=y,e.removeDuplicateVertices>=0&&n(e.removeDuplicateVertices)},t.parseAsText=i=>{if(!i)return;if(i!==e.parseData)t.modified();else return;e.parseData=i;const o=i.split(`
`);let a=1;const s=[],c=[],l=[];for(;a!==-1;)a=FZ(o,a,s,c,l);const f=rr.newInstance();f.getPoints().setData(Float32Array.from(s),3),f.getPolys().setData(Uint32Array.from(c)),f.getCellData().setNormals(Tt.newInstance({name:"Normals",values:Float32Array.from(l),numberOfComponents:3})),e.output[0]=f,e.removeDuplicateVertices>=0&&n(e.removeDuplicateVertices)},t.requestData=(i,o)=>{t.parse(e.parseData)}}const BZ={removeDuplicateVertices:-1};function l7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BZ,r),K.obj(t,e),K.get(t,e,["url","baseURL"]),K.setGet(t,e,["dataAccessHelper","removeDuplicateVertices"]),K.algo(t,e,0,1),UZ(t,e),e.compression||(e.compression=null),e.progressCallback||(e.progressCallback=null)}const GZ=K.newInstance(l7,"vtkSTLReader");var WZ={extend:l7,newInstance:GZ},am={exports:{}},$Z=am.exports,C_;function zZ(){return C_||(C_=1,(function(t,e){(function(r,n){t.exports=n()})($Z,(function(){return(function(r){var n={};function i(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return r[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=r,i.c=n,i.d=function(o,a,s){i.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:s})},i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.t=function(o,a){if(1&a&&(o=i(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var c in o)i.d(s,c,(function(l){return o[l]}).bind(null,c));return s},i.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(a,"a",a),a},i.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},i.p="",i(i.s=184)})([function(r,n,i){function o(a){for(var s in a)n.hasOwnProperty(s)||(n[s]=a[s])}Object.defineProperty(n,"__esModule",{value:!0}),o(i(240)),o(i(251)),o(i(175)),o(i(107)),o(i(29)),o(i(73)),o(i(106)),o(i(30)),o(i(252)),o(i(52)),o(i(97)),o(i(253)),o(i(37)),o(i(51)),o(i(173)),o(i(176)),o(i(172)),o(i(108)),o(i(254)),o(i(255)),o(i(256)),o(i(72)),o(i(177)),o(i(105)),o(i(17)),o(i(257)),o(i(12)),o(i(174))},function(r,n,i){var o=this&&this.__values||function(y){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&y[C],T=0;if(x)return x.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&T>=y.length&&(y=void 0),{value:y&&y[T++],done:!y}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(212);n.FixedSizeSet=a.FixedSizeSet;var s=i(213);n.ObjectCache=s.ObjectCache;var c=i(214);n.CompareCache=c.CompareCache;var l=i(215);n.Lazy=l.Lazy;var f=i(216);function u(y,C,x){if(w(y))y.forEach((function(S,_){return C.call(x,_,S)}));else for(var T in y)y.hasOwnProperty(T)&&C.call(x,T,y[T])}function d(y){var C,x;if(h(y))return y;if(p(y)){var T=[];try{for(var S=o(y),_=S.next();!_.done;_=S.next()){var E=_.value;T.push(d(E))}}catch(I){C={error:I}}finally{try{_&&!_.done&&(x=S.return)&&x.call(S)}finally{if(C)throw C.error}}return T}if(g(y)){T={};for(var D in y)if(y.hasOwnProperty(D)){var b=y[D];T[D]=d(b)}return T}return y}function h(y){return!!y&&Object.prototype.toString.call(y)==="[object Function]"}function g(y){var C=typeof y;return!!y&&(C==="function"||C==="object")}function p(y){return Array.isArray(y)}function m(y){return y instanceof Set}function w(y){return y instanceof Map}function v(y){if(g(y)){var C=Object.getPrototypeOf(y),x=C.constructor;return C&&x&&typeof x=="function"&&x instanceof x&&Function.prototype.toString.call(x)===Function.prototype.toString.call(Object)}return!1}n.StringWalker=f.StringWalker,n.applyMixin=function(y,C){for(var x=[],T=2;T<arguments.length;T++)x[T-2]=arguments[T];Object.getOwnPropertyNames(C.prototype).forEach((function(S){if(S!=="constructor"){if(x.indexOf(S)!==-1){var _=Object.getOwnPropertyDescriptor(y.prototype,S);_&&Object.defineProperty(y.prototype,"_"+S,_)}var E=Object.getOwnPropertyDescriptor(C.prototype,S);E&&Object.defineProperty(y.prototype,S,E)}}))},n.applyDefaults=function y(C,x,T){T===void 0&&(T=!1);var S=d(C||{});return u(x,(function(_,E){v(E)?S[_]=y(S[_],E,T):(T||S[_]===void 0)&&(S[_]=E)})),S},n.forEachArray=function(y,C,x){y.forEach(C,x)},n.forEachObject=u,n.arrayLength=function(y){return m(y)?y.size:y.length},n.objectLength=function(y){return w(y)?y.size:Object.keys(y).length},n.getObjectValue=function(y,C){return w(y)?y.get(C):y[C]},n.removeObjectValue=function(y,C){w(y)?y.delete(C):delete y[C]},n.clone=d,n.isBoolean=function(y){return typeof y=="boolean"},n.isNumber=function(y){return typeof y=="number"},n.isString=function(y){return typeof y=="string"},n.isFunction=h,n.isObject=g,n.isArray=p,n.isSet=m,n.isMap=w,n.isEmpty=function(y){if(p(y))return!y.length;if(m(y)||w(y))return!y.size;if(g(y)){for(var C in y)if(y.hasOwnProperty(C))return!1;return!0}return!1},n.isPlainObject=v,n.isIterable=function(y){return y&&typeof y[Symbol.iterator]=="function"},n.getValue=function(y){return h(y.valueOf)?y.valueOf():y},n.utf8Encode=function(y){for(var C=new Uint8Array(4*y.length),x=0,T=0;T<y.length;T++){var S=y.charCodeAt(T);if(S<128)C[x++]=S;else{if(S<2048)C[x++]=S>>6|192;else{if(S>55295&&S<56320){if(++T>=y.length)throw new Error("Incomplete surrogate pair.");var _=y.charCodeAt(T);if(_<56320||_>57343)throw new Error("Invalid surrogate character.");S=65536+((1023&S)<<10)+(1023&_),C[x++]=S>>18|240,C[x++]=S>>12&63|128}else C[x++]=S>>12|224;C[x++]=S>>6&63|128}C[x++]=63&S|128}}return C.subarray(0,x)},n.utf8Decode=function(y){for(var C="",x=0;x<y.length;){var T=y[x++];if(T>127)if(T>191&&T<224){if(x>=y.length)throw new Error("Incomplete 2-byte sequence.");T=(31&T)<<6|63&y[x++]}else if(T>223&&T<240){if(x+1>=y.length)throw new Error("Incomplete 3-byte sequence.");T=(15&T)<<12|(63&y[x++])<<6|63&y[x++]}else{if(!(T>239&&T<248))throw new Error("Unknown multi-byte start.");if(x+2>=y.length)throw new Error("Incomplete 4-byte sequence.");T=(7&T)<<18|(63&y[x++])<<12|(63&y[x++])<<6|63&y[x++]}if(T<=65535)C+=String.fromCharCode(T);else{if(!(T<=1114111))throw new Error("Code point exceeds UTF-16 limit.");T-=65536,C+=String.fromCharCode(T>>10|55296),C+=String.fromCharCode(1023&T|56320)}}return C}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),(function(o){o[o.Before=0]="Before",o[o.Equal=1]="Equal",o[o.After=2]="After"})(n.BoundaryPosition||(n.BoundaryPosition={})),(function(o){o[o.None=0]="None",o[o.Capturing=1]="Capturing",o[o.AtTarget=2]="AtTarget",o[o.Bubbling=3]="Bubbling"})(n.EventPhase||(n.EventPhase={})),(function(o){o[o.Element=1]="Element",o[o.Attribute=2]="Attribute",o[o.Text=3]="Text",o[o.CData=4]="CData",o[o.EntityReference=5]="EntityReference",o[o.Entity=6]="Entity",o[o.ProcessingInstruction=7]="ProcessingInstruction",o[o.Comment=8]="Comment",o[o.Document=9]="Document",o[o.DocumentType=10]="DocumentType",o[o.DocumentFragment=11]="DocumentFragment",o[o.Notation=12]="Notation"})(n.NodeType||(n.NodeType={})),(function(o){o[o.Disconnected=1]="Disconnected",o[o.Preceding=2]="Preceding",o[o.Following=4]="Following",o[o.Contains=8]="Contains",o[o.ContainedBy=16]="ContainedBy",o[o.ImplementationSpecific=32]="ImplementationSpecific"})(n.Position||(n.Position={})),(function(o){o[o.Accept=1]="Accept",o[o.Reject=2]="Reject",o[o.Skip=3]="Skip"})(n.FilterResult||(n.FilterResult={})),(function(o){o[o.All=4294967295]="All",o[o.Element=1]="Element",o[o.Attribute=2]="Attribute",o[o.Text=4]="Text",o[o.CDataSection=8]="CDataSection",o[o.EntityReference=16]="EntityReference",o[o.Entity=32]="Entity",o[o.ProcessingInstruction=64]="ProcessingInstruction",o[o.Comment=128]="Comment",o[o.Document=256]="Document",o[o.DocumentType=512]="DocumentType",o[o.DocumentFragment=1024]="DocumentFragment",o[o.Notation=2048]="Notation"})(n.WhatToShow||(n.WhatToShow={})),(function(o){o[o.StartToStart=0]="StartToStart",o[o.StartToEnd=1]="StartToEnd",o[o.EndToEnd=2]="EndToEnd",o[o.EndToStart=3]="EndToStart"})(n.HowToCompare||(n.HowToCompare={}))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(241);n.Cast=o.Cast;var a=i(150);n.Guard=a.Guard;var s=i(242);n.EmptySet=s.EmptySet},function(r,n,i){var o=i(11),a=i(55).f,s=i(21),c=i(25),l=i(80),f=i(119),u=i(123);r.exports=function(d,h){var g,p,m,w,v,y=d.target,C=d.global,x=d.stat;if(g=C?o:x?o[y]||l(y,{}):(o[y]||{}).prototype)for(p in h){if(w=h[p],m=d.noTargetGet?(v=a(g,p))&&v.value:g[p],!u(C?p:y+(x?".":"#")+p,d.forced)&&m!==void 0){if(typeof w==typeof m)continue;f(w,m)}(d.sham||m&&m.sham)&&s(w,"sham",!0),c(g,p,w,d)}}},function(r,n,i){var o=i(11),a=i(81),s=i(14),c=i(58),l=i(86),f=i(124),u=a("wks"),d=o.Symbol,h=f?d:d&&d.withoutSetter||c;r.exports=function(g){return s(u,g)||(l&&s(d,g)?u[g]=d[g]:u[g]=h("Symbol."+g)),u[g]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(1),a=i(29),s=(function(){function c(){this._features={mutationObservers:!0,customElements:!0,slots:!0,steps:!0},this._window=null,this._compareCache=new o.CompareCache,this._rangeList=new o.FixedSizeSet}return c.prototype.setFeatures=function(l){if(l===void 0&&(l=!0),o.isObject(l))for(var f in l)this._features[f]=l[f]||!1;else for(var f in this._features)this._features[f]=l},Object.defineProperty(c.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"window",{get:function(){return this._window===null&&(this._window=a.create_window()),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"compareCache",{get:function(){return this._compareCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rangeList",{get:function(){return this._rangeList},enumerable:!0,configurable:!0}),Object.defineProperty(c,"instance",{get:function(){return c._instance||(c._instance=new c),c._instance},enumerable:!0,configurable:!0}),c})();n.dom=s.instance},function(r,n,i){var o=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var y={};if(v!=null)for(var C in v)Object.hasOwnProperty.call(v,C)&&(y[C]=v[C]);return y.default=v,y};Object.defineProperty(n,"__esModule",{value:!0});var a=o(i(228));n.base64=a;var s=o(i(146));n.byte=s;var c=o(i(147));n.byteSequence=c;var l=o(i(96));n.codePoint=l;var f=o(i(232));n.json=f;var u=o(i(233));n.list=u;var d=o(i(234));n.map=d;var h=o(i(235));n.namespace=h;var g=o(i(236));n.queue=g;var p=o(i(237));n.set=p;var m=o(i(238));n.stack=m;var w=o(i(239));n.string=w},function(r,n){r.exports=function(i){try{return!!i()}catch{return!0}}},function(r,n,i){var o,a=this&&this.__extends||(o=function(k,L){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,j){F.__proto__=j}||function(F,j){for(var J in j)j.hasOwnProperty(J)&&(F[J]=j[J])})(k,L)},function(k,L){function F(){this.constructor=k}o(k,L),k.prototype=L===null?Object.create(L):(F.prototype=L.prototype,new F)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(k){function L(F,j){j===void 0&&(j="");var J=k.call(this,j)||this;return J.name=F,J}return a(L,k),L})(Error);n.DOMException=s;var c=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"DOMStringSizeError",F)||this}return a(L,k),L})(s);n.DOMStringSizeError=c;var l=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"WrongDocumentError","The object is in the wrong document. "+F)||this}return a(L,k),L})(s);n.WrongDocumentError=l;var f=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NoDataAllowedError",F)||this}return a(L,k),L})(s);n.NoDataAllowedError=f;var u=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NoModificationAllowedError","The object can not be modified. "+F)||this}return a(L,k),L})(s);n.NoModificationAllowedError=u;var d=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NotSupportedError","The operation is not supported. "+F)||this}return a(L,k),L})(s);n.NotSupportedError=d;var h=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InUseAttributeError",F)||this}return a(L,k),L})(s);n.InUseAttributeError=h;var g=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidStateError","The object is in an invalid state. "+F)||this}return a(L,k),L})(s);n.InvalidStateError=g;var p=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidModificationError","The object can not be modified in this way. "+F)||this}return a(L,k),L})(s);n.InvalidModificationError=p;var m=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NamespaceError","The operation is not allowed by Namespaces in XML. [XMLNS] "+F)||this}return a(L,k),L})(s);n.NamespaceError=m;var w=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidAccessError","The object does not support the operation or argument. "+F)||this}return a(L,k),L})(s);n.InvalidAccessError=w;var v=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"ValidationError",F)||this}return a(L,k),L})(s);n.ValidationError=v;var y=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"TypeMismatchError",F)||this}return a(L,k),L})(s);n.TypeMismatchError=y;var C=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"SecurityError","The operation is insecure. "+F)||this}return a(L,k),L})(s);n.SecurityError=C;var x=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NetworkError","A network error occurred. "+F)||this}return a(L,k),L})(s);n.NetworkError=x;var T=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"AbortError","The operation was aborted. "+F)||this}return a(L,k),L})(s);n.AbortError=T;var S=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"URLMismatchError","The given URL does not match another URL. "+F)||this}return a(L,k),L})(s);n.URLMismatchError=S;var _=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"QuotaExceededError","The quota has been exceeded. "+F)||this}return a(L,k),L})(s);n.QuotaExceededError=_;var E=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"TimeoutError","The operation timed out. "+F)||this}return a(L,k),L})(s);n.TimeoutError=E;var D=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidNodeTypeError","The supplied node is incorrect or has an incorrect ancestor for this operation. "+F)||this}return a(L,k),L})(s);n.InvalidNodeTypeError=D;var b=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"DataCloneError","The object can not be cloned. "+F)||this}return a(L,k),L})(s);n.DataCloneError=b;var I=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NotImplementedError","The DOM method is not implemented by this module. "+F)||this}return a(L,k),L})(s);n.NotImplementedError=I;var O=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"HierarchyRequestError","The operation would yield an incorrect node tree. "+F)||this}return a(L,k),L})(s);n.HierarchyRequestError=O;var M=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NotFoundError","The object can not be found here. "+F)||this}return a(L,k),L})(s);n.NotFoundError=M;var R=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"IndexSizeError","The index is not in the allowed range. "+F)||this}return a(L,k),L})(s);n.IndexSizeError=R;var A=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"SyntaxError","The string did not match the expected pattern. "+F)||this}return a(L,k),L})(s);n.SyntaxError=A;var B=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidCharacterError","The string contains invalid characters. "+F)||this}return a(L,k),L})(s);n.InvalidCharacterError=B},function(r,n,i){var o=i(53),a=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],s=["scalar","sequence","mapping"];r.exports=function(c,l){var f,u;if(l=l||{},Object.keys(l).forEach((function(d){if(a.indexOf(d)===-1)throw new o('Unknown option "'+d+'" is met in definition of "'+c+'" YAML type.')})),this.tag=c,this.kind=l.kind||null,this.resolve=l.resolve||function(){return!0},this.construct=l.construct||function(d){return d},this.instanceOf=l.instanceOf||null,this.predicate=l.predicate||null,this.represent=l.represent||null,this.defaultStyle=l.defaultStyle||null,this.styleAliases=(f=l.styleAliases||null,u={},f!==null&&Object.keys(f).forEach((function(d){f[d].forEach((function(h){u[String(h)]=d}))})),u),s.indexOf(this.kind)===-1)throw new o('Unknown kind "'+this.kind+'" is specified for "'+c+'" YAML type.')}},function(r,n,i){(function(o){var a=function(s){return s&&s.Math==Math&&s};r.exports=a(typeof globalThis=="object"&&globalThis)||a(typeof window=="object"&&window)||a(typeof self=="object"&&self)||a(typeof o=="object"&&o)||Function("return this")()}).call(this,i(78))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.idl_defineConst=function(o,a,s){Object.defineProperty(o,a,{writable:!1,enumerable:!0,configurable:!1,value:s})}},function(r,n){r.exports=function(i){return typeof i=="object"?i!==null:typeof i=="function"}},function(r,n){var i={}.hasOwnProperty;r.exports=function(o,a){return i.call(o,a)}},function(r,n,i){var o=i(16),a=i(115),s=i(18),c=i(56),l=Object.defineProperty;n.f=o?l:function(f,u,d){if(s(f),u=c(u,!0),s(d),a)try{return l(f,u,d)}catch{}if("get"in d||"set"in d)throw TypeError("Accessors not supported");return"value"in d&&(f[u]=d.value),f}},function(r,n,i){var o=i(8);r.exports=!o((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}))},function(r,n,i){var o=this&&this.__values||function(y){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&y[C],T=0;if(x)return x.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&T>=y.length&&(y=void 0),{value:y&&y[T++],done:!y}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(3),s=i(2);function c(y,C,x){if(x===void 0&&(x=!1),x&&a.Guard.isElementNode(C)&&a.Guard.isShadowRoot(C.shadowRoot)&&C.shadowRoot._firstChild)return C.shadowRoot._firstChild;if(C._firstChild)return C._firstChild;if(C===y)return null;if(C._nextSibling)return C._nextSibling;for(var T=C._parent;T&&T!==y;){if(T._nextSibling)return T._nextSibling;T=T._parent}return null}function l(){var y;return(y={})[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:null}}}},y}function f(y,C,x,T){C===void 0&&(C=!1),x===void 0&&(x=!1);for(var S=C?y:c(y,y,x);S&&T&&!T(S);)S=c(y,S,x);return S}function u(y,C,x,T,S){T===void 0&&(T=!1);for(var _=c(y,C,T);_&&S&&!S(_);)_=c(y,_,T);return _}function d(y,C,x,T){var S;return C===void 0&&(C=!1),x===void 0&&(x=!1),C||y._children.size!==0?((S={})[Symbol.iterator]=function(){var _=C?y:c(y,y,x);return{next:function(){for(;_&&T&&!T(_);)_=c(y,_,x);if(_===null)return{done:!0,value:null};var E={done:!1,value:_};return _=c(y,_,x),E}}},S):l()}function h(y,C,x){C===void 0&&(C=!1);for(var T=C?y:y._parent;T&&x&&!x(T);)T=T._parent;return T}function g(y,C,x,T){for(var S=C._parent;S&&T&&!T(S);)S=S._parent;return S}function p(y){return a.Guard.isDocumentTypeNode(y)?0:a.Guard.isCharacterDataNode(y)?y._data.length:y._children.size}function m(y,C){if(C===void 0&&(C=!1),C){var x=m(y,!1);return a.Guard.isShadowRoot(x)?m(x._host,!0):x}return y._parent?m(y._parent):y}function w(y,C,x,T){x===void 0&&(x=!1),T===void 0&&(T=!1);for(var S=x?y:T&&a.Guard.isShadowRoot(y)?y._host:y._parent;S!==null;){if(S===C)return!0;S=T&&a.Guard.isShadowRoot(S)?S._host:S._parent}return!1}function v(y){for(var C=m(y),x=0,T=f(C);T!==null;){if(x++,T===y)return x;T=u(C,T)}return-1}n.tree_getFirstDescendantNode=f,n.tree_getNextDescendantNode=u,n.tree_getDescendantNodes=d,n.tree_getDescendantElements=function(y,C,x,T){var S;return C===void 0&&(C=!1),x===void 0&&(x=!1),C||y._children.size!==0?((S={})[Symbol.iterator]=function(){var _=d(y,C,x,(function(D){return a.Guard.isElementNode(D)}))[Symbol.iterator](),E=_.next().value;return{next:function(){for(;E&&T&&!T(E);)E=_.next().value;if(E===null)return{done:!0,value:null};var D={done:!1,value:E};return E=_.next().value,D}}},S):l()},n.tree_getSiblingNodes=function(y,C,x){var T;return C===void 0&&(C=!1),y._parent&&y._parent._children.size!==0?((T={})[Symbol.iterator]=function(){var S=y._parent?y._parent._firstChild:null;return{next:function(){for(;S&&(x&&!x(S)||!C&&S===y);)S=S._nextSibling;if(S===null)return{done:!0,value:null};var _={done:!1,value:S};return S=S._nextSibling,_}}},T):l()},n.tree_getFirstAncestorNode=h,n.tree_getNextAncestorNode=g,n.tree_getAncestorNodes=function(y,C,x){var T;return C===void 0&&(C=!1),C||y._parent?((T={})[Symbol.iterator]=function(){var S=h(y,C,x);return{next:function(){if(S===null)return{done:!0,value:null};var _={done:!1,value:S};return S=g(0,S,C,x),_}}},T):l()},n.tree_getCommonAncestor=function(y,C){if(y===C)return y._parent;for(var x=[],T=[],S=h(y,!0);S!==null;)x.push(S),S=g(0,S);for(var _=h(C,!0);_!==null;)T.push(_),_=g(0,_);for(var E=x.length,D=T.length,b=null,I=Math.min(E,D);I>0;I--){var O=x[--E];if(O!==T[--D])break;b=O}return b},n.tree_getFollowingNode=function(y,C){if(C._firstChild)return C._firstChild;if(C._nextSibling)return C._nextSibling;for(;;){var x=C._parent;if(x===null||x===y)return null;if(x._nextSibling)return x._nextSibling;C=x}},n.tree_getPrecedingNode=function(y,C){return C===y?null:C._previousSibling?(C=C._previousSibling)._lastChild?C._lastChild:C:C._parent},n.tree_isConstrained=function y(C){var x,T,S,_,E,D;switch(C._nodeType){case s.NodeType.Document:var b=!1,I=!1;try{for(var O=o(C._children),M=O.next();!M.done;M=O.next())switch(M.value._nodeType){case s.NodeType.ProcessingInstruction:case s.NodeType.Comment:break;case s.NodeType.DocumentType:if(b||I)return!1;b=!0;break;case s.NodeType.Element:if(I)return!1;I=!0;break;default:return!1}}catch(L){x={error:L}}finally{try{M&&!M.done&&(T=O.return)&&T.call(O)}finally{if(x)throw x.error}}break;case s.NodeType.DocumentFragment:case s.NodeType.Element:try{for(var R=o(C._children),A=R.next();!A.done;A=R.next())switch(A.value._nodeType){case s.NodeType.Element:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:break;default:return!1}}catch(L){S={error:L}}finally{try{A&&!A.done&&(_=R.return)&&_.call(R)}finally{if(S)throw S.error}}break;case s.NodeType.DocumentType:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:return!C.hasChildNodes()}try{for(var B=o(C._children),k=B.next();!k.done;k=B.next())if(!y(k.value))return!1}catch(L){E={error:L}}finally{try{k&&!k.done&&(D=B.return)&&D.call(B)}finally{if(E)throw E.error}}return!0},n.tree_nodeLength=p,n.tree_isEmpty=function(y){return p(y)===0},n.tree_rootNode=m,n.tree_isDescendantOf=function(y,C,x,T){x===void 0&&(x=!1),T===void 0&&(T=!1);for(var S=f(y,x,T);S!==null;){if(S===C)return!0;S=u(y,S,x,T)}return!1},n.tree_isAncestorOf=w,n.tree_isHostIncludingAncestorOf=function y(C,x,T){if(T===void 0&&(T=!1),w(C,x,T))return!0;var S=m(C);return!(!a.Guard.isDocumentFragmentNode(S)||S._host===null||!y(S._host,x,T))},n.tree_isSiblingOf=function(y,C,x){return x===void 0&&(x=!1),y!==C?y._parent!==null&&y._parent===C._parent:!!x},n.tree_isPreceding=function(y,C){var x=v(y),T=v(C);return x!==-1&&T!==-1&&m(y)===m(C)&&T<x},n.tree_isFollowing=function(y,C){var x=v(y),T=v(C);return x!==-1&&T!==-1&&m(y)===m(C)&&T>x},n.tree_isParentOf=function(y,C){return y._parent===C},n.tree_isChildOf=function(y,C){return C._parent===y},n.tree_previousSibling=function(y){return y._previousSibling},n.tree_nextSibling=function(y){return y._nextSibling},n.tree_firstChild=function(y){return y._firstChild},n.tree_lastChild=function(y){return y._lastChild},n.tree_treePosition=v,n.tree_index=function(y){for(var C=0;y._previousSibling!==null;)C++,y=y._previousSibling;return C},n.tree_retarget=function(y,C){for(;;){if(!y||!a.Guard.isNode(y))return y;var x=m(y);if(!a.Guard.isShadowRoot(x)||C&&a.Guard.isNode(C)&&w(x,C,!0,!0))return y;y=x.host}}},function(r,n,i){var o=i(13);r.exports=function(a){if(!o(a))throw TypeError(String(a)+" is not an object");return a}},function(r,n,i){var o=i(24),a=i(130),s=i(49),c=i(43),l=i(88),f=c.set,u=c.getterFor("Array Iterator");r.exports=l(Array,"Array",(function(d,h){f(this,{type:"Array Iterator",target:o(d),index:0,kind:h})}),(function(){var d=u(this),h=d.target,g=d.kind,p=d.index++;return!h||p>=h.length?(d.target=void 0,{value:void 0,done:!0}):g=="keys"?{value:p,done:!1}:g=="values"?{value:h[p],done:!1}:{value:[p,h[p]],done:!1}}),"values"),s.Arguments=s.Array,a("keys"),a("values"),a("entries")},function(r,n,i){var o=i(90),a=i(25),s=i(202);o||a(Object.prototype,"toString",s,{unsafe:!0})},function(r,n,i){var o=i(16),a=i(15),s=i(40);r.exports=o?function(c,l,f){return a.f(c,l,s(1,f))}:function(c,l,f){return c[l]=f,c}},function(r,n,i){var o=i(137).charAt,a=i(43),s=i(88),c=a.set,l=a.getterFor("String Iterator");s(String,"String",(function(f){c(this,{type:"String Iterator",string:String(f),index:0})}),(function(){var f,u=l(this),d=u.string,h=u.index;return h>=d.length?{value:void 0,done:!0}:(f=o(d,h),u.index+=f.length,{value:f,done:!1})}))},function(r,n,i){var o=i(11),a=i(203),s=i(19),c=i(21),l=i(5),f=l("iterator"),u=l("toStringTag"),d=s.values;for(var h in a){var g=o[h],p=g&&g.prototype;if(p){if(p[f]!==d)try{c(p,f,d)}catch{p[f]=d}if(p[u]||c(p,u,h),a[h]){for(var m in s)if(p[m]!==s[m])try{c(p,m,s[m])}catch{p[m]=s[m]}}}}},function(r,n,i){var o=i(41),a=i(35);r.exports=function(s){return o(a(s))}},function(r,n,i){var o=i(11),a=i(21),s=i(14),c=i(80),l=i(117),f=i(43),u=f.get,d=f.enforce,h=String(String).split("String");(r.exports=function(g,p,m,w){var v=!!w&&!!w.unsafe,y=!!w&&!!w.enumerable,C=!!w&&!!w.noTargetGet;typeof m=="function"&&(typeof p!="string"||s(m,"name")||a(m,"name",p),d(m).source=h.join(typeof p=="string"?p:"")),g!==o?(v?!C&&g[p]&&(y=!0):delete g[p],y?g[p]=m:a(g,p,m)):y?g[p]=m:c(p,m)})(Function.prototype,"toString",(function(){return typeof this=="function"&&u(this).source||l(this)}))},function(r,n,i){var o=i(47),a=Math.min;r.exports=function(s){return s>0?a(o(s),9007199254740991):0}},function(r,n,i){var o=i(35);r.exports=function(a){return Object(o(a))}},function(r,n,i){var o=i(16),a=i(8),s=i(14),c=Object.defineProperty,l={},f=function(u){throw u};r.exports=function(u,d){if(s(l,u))return l[u];d||(d={});var h=[][u],g=!!s(d,"ACCESSORS")&&d.ACCESSORS,p=s(d,0)?d[0]:f,m=s(d,1)?d[1]:void 0;return l[u]=!!h&&!a((function(){if(g&&!o)return!0;var w={length:-1};g?c(w,1,{enumerable:!0,get:f}):w[1]=1,h.call(w,p,m)}))}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(148),a=i(149),s=i(151),c=i(98),l=i(153),f=i(154),u=i(155),d=i(99),h=i(100),g=i(156),p=i(157),m=i(101),w=i(158),v=i(159),y=i(160),C=i(161),x=i(162),T=i(163),S=i(164),_=i(165),E=i(166),D=i(167),b=i(168),I=i(169),O=i(170);n.create_domImplementation=function(M){return o.DOMImplementationImpl._create(M)},n.create_window=function(){return a.WindowImpl._create()},n.create_xmlDocument=function(){return new s.XMLDocumentImpl},n.create_document=function(){return new c.DocumentImpl},n.create_abortController=function(){return new l.AbortControllerImpl},n.create_abortSignal=function(){return f.AbortSignalImpl._create()},n.create_documentType=function(M,R,A,B){return u.DocumentTypeImpl._create(M,R,A,B)},n.create_element=function(M,R,A,B){return d.ElementImpl._create(M,R,A,B)},n.create_htmlElement=function(M,R,A,B){return d.ElementImpl._create(M,R,A,B)},n.create_htmlUnknownElement=function(M,R,A,B){return d.ElementImpl._create(M,R,A,B)},n.create_documentFragment=function(M){return h.DocumentFragmentImpl._create(M)},n.create_shadowRoot=function(M,R){return g.ShadowRootImpl._create(M,R)},n.create_attr=function(M,R){return p.AttrImpl._create(M,R)},n.create_text=function(M,R){return m.TextImpl._create(M,R)},n.create_cdataSection=function(M,R){return w.CDATASectionImpl._create(M,R)},n.create_comment=function(M,R){return v.CommentImpl._create(M,R)},n.create_processingInstruction=function(M,R,A){return y.ProcessingInstructionImpl._create(M,R,A)},n.create_htmlCollection=function(M,R){return R===void 0&&(R=function(){return!0}),C.HTMLCollectionImpl._create(M,R)},n.create_nodeList=function(M){return x.NodeListImpl._create(M)},n.create_nodeListStatic=function(M,R){return T.NodeListStaticImpl._create(M,R)},n.create_namedNodeMap=function(M){return S.NamedNodeMapImpl._create(M)},n.create_range=function(M,R){return _.RangeImpl._create(M,R)},n.create_nodeIterator=function(M,R,A){return E.NodeIteratorImpl._create(M,R,A)},n.create_treeWalker=function(M,R){return D.TreeWalkerImpl._create(M,R)},n.create_nodeFilter=function(){return b.NodeFilterImpl._create()},n.create_mutationRecord=function(M,R,A,B,k,L,F,j,J){return I.MutationRecordImpl._create(M,R,A,B,k,L,F,j,J)},n.create_domTokenList=function(M,R){return O.DOMTokenListImpl._create(M,R)}},function(r,n,i){var o=this&&this.__values||function(p){var m=typeof Symbol=="function"&&Symbol.iterator,w=m&&p[m],v=0;if(w)return w.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&v>=p.length&&(p=void 0),{value:p&&p[v++],done:!p}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(17),c=i(3),l=i(72),f=new Map;function u(p,m){if(m!==p._root&&s.tree_isAncestorOf(p._reference,m,!0)){if(p._pointerBeforeReference)for(;;){var w=s.tree_getFollowingNode(p._root,m);if(w!==null&&s.tree_isDescendantOf(p._root,w,!0)&&!s.tree_isDescendantOf(m,w,!0))return void(p._reference=w);if(w===null)return void(p._pointerBeforeReference=!1)}if(m._previousSibling===null)m._parent!==null&&(p._reference=m._parent);else{for(var v=m._previousSibling,y=s.tree_getFirstDescendantNode(m._previousSibling,!0,!1);y!==null;)y!==null&&(v=y),y=s.tree_getNextDescendantNode(m._previousSibling,y,!0,!1);p._reference=v}}}function d(p,m,w,v,y){if(c.Guard.isSlot(p)&&m==="name"&&y===null){if(v===w||v===null&&w===""||v===""&&w===null)return;p._name=v===null||v===""?"":v,l.shadowTree_assignSlotablesForATree(s.tree_rootNode(p))}}function h(p,m,w,v,y){if(c.Guard.isSlotable(p)&&m==="slot"&&y===null){if(v===w||v===null&&w===""||v===""&&w===null)return;p._name=v===null||v===""?"":v,l.shadowTree_isAssigned(p)&&l.shadowTree_assignSlotables(p._assignedSlot),l.shadowTree_assignASlot(p)}}function g(p,m,w,v){m==="id"&&v===null&&(p._uniqueIdentifier=w||void 0)}n.dom_runRemovingSteps=function(p,m){},n.dom_runCloningSteps=function(p,m,w,v){},n.dom_runAdoptingSteps=function(p,m){},n.dom_runAttributeChangeSteps=function(p,m,w,v,y){var C,x;a.dom.features.slots&&(h.call(p,p,m,w,v,y),d.call(p,p,m,w,v,y)),g.call(p,p,m,v,y);try{for(var T=o(p._attributeChangeSteps),S=T.next();!S.done;S=T.next())S.value.call(p,p,m,w,v,y)}catch(_){C={error:_}}finally{try{S&&!S.done&&(x=T.return)&&x.call(T)}finally{if(C)throw C.error}}},n.dom_runInsertionSteps=function(p){},n.dom_runNodeIteratorPreRemovingSteps=function(p,m){u.call(p,p,m)},n.dom_hasSupportedTokens=function(p){return f.has(p)},n.dom_getSupportedTokens=function(p){return f.get(p)||new Set},n.dom_runEventConstructingSteps=function(p){},n.dom_runChildTextContentChangeSteps=function(p){}},function(r,n,i){var o=i(4),a=i(11),s=i(46),c=i(44),l=i(16),f=i(86),u=i(124),d=i(8),h=i(14),g=i(59),p=i(13),m=i(18),w=i(27),v=i(24),y=i(56),C=i(40),x=i(60),T=i(61),S=i(82),_=i(190),E=i(85),D=i(55),b=i(15),I=i(79),O=i(21),M=i(25),R=i(81),A=i(57),B=i(45),k=i(58),L=i(5),F=i(125),j=i(126),J=i(62),ie=i(43),fe=i(36).forEach,ae=A("hidden"),de=L("toPrimitive"),we=ie.set,_e=ie.getterFor("Symbol"),Te=Object.prototype,G=a.Symbol,P=s("JSON","stringify"),$=D.f,W=b.f,q=_.f,Q=I.f,ee=R("symbols"),ge=R("op-symbols"),De=R("string-to-symbol-registry"),Ne=R("symbol-to-string-registry"),We=R("wks"),re=a.QObject,se=!re||!re.prototype||!re.prototype.findChild,ve=l&&d((function(){return x(W({},"a",{get:function(){return W(this,"a",{value:7}).a}})).a!=7}))?function(ze,qe,Je){var lt=$(Te,qe);lt&&delete Te[qe],W(ze,qe,Je),lt&&ze!==Te&&W(Te,qe,lt)}:W,le=function(ze,qe){var Je=ee[ze]=x(G.prototype);return we(Je,{type:"Symbol",tag:ze,description:qe}),l||(Je.description=qe),Je},pe=u?function(ze){return typeof ze=="symbol"}:function(ze){return Object(ze)instanceof G},$e=function(ze,qe,Je){ze===Te&&$e(ge,qe,Je),m(ze);var lt=y(qe,!0);return m(Je),h(ee,lt)?(Je.enumerable?(h(ze,ae)&&ze[ae][lt]&&(ze[ae][lt]=!1),Je=x(Je,{enumerable:C(0,!1)})):(h(ze,ae)||W(ze,ae,C(1,{})),ze[ae][lt]=!0),ve(ze,lt,Je)):W(ze,lt,Je)},oe=function(ze,qe){m(ze);var Je=v(qe),lt=T(Je).concat(Ee(Je));return fe(lt,(function(Pe){l&&!st.call(Je,Pe)||$e(ze,Pe,Je[Pe])})),ze},st=function(ze){var qe=y(ze,!0),Je=Q.call(this,qe);return!(this===Te&&h(ee,qe)&&!h(ge,qe))&&(!(Je||!h(this,qe)||!h(ee,qe)||h(this,ae)&&this[ae][qe])||Je)},gt=function(ze,qe){var Je=v(ze),lt=y(qe,!0);if(Je!==Te||!h(ee,lt)||h(ge,lt)){var Pe=$(Je,lt);return!Pe||!h(ee,lt)||h(Je,ae)&&Je[ae][lt]||(Pe.enumerable=!0),Pe}},ct=function(ze){var qe=q(v(ze)),Je=[];return fe(qe,(function(lt){h(ee,lt)||h(B,lt)||Je.push(lt)})),Je},Ee=function(ze){var qe=ze===Te,Je=q(qe?ge:v(ze)),lt=[];return fe(Je,(function(Pe){!h(ee,Pe)||qe&&!h(Te,Pe)||lt.push(ee[Pe])})),lt};f||(M((G=function(){if(this instanceof G)throw TypeError("Symbol is not a constructor");var ze=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,qe=k(ze),Je=function(lt){this===Te&&Je.call(ge,lt),h(this,ae)&&h(this[ae],qe)&&(this[ae][qe]=!1),ve(this,qe,C(1,lt))};return l&&se&&ve(Te,qe,{configurable:!0,set:Je}),le(qe,ze)}).prototype,"toString",(function(){return _e(this).tag})),M(G,"withoutSetter",(function(ze){return le(k(ze),ze)})),I.f=st,b.f=$e,D.f=gt,S.f=_.f=ct,E.f=Ee,F.f=function(ze){return le(L(ze),ze)},l&&(W(G.prototype,"description",{configurable:!0,get:function(){return _e(this).description}}),c||M(Te,"propertyIsEnumerable",st,{unsafe:!0}))),o({global:!0,wrap:!0,forced:!f,sham:!f},{Symbol:G}),fe(T(We),(function(ze){j(ze)})),o({target:"Symbol",stat:!0,forced:!f},{for:function(ze){var qe=String(ze);if(h(De,qe))return De[qe];var Je=G(qe);return De[qe]=Je,Ne[Je]=qe,Je},keyFor:function(ze){if(!pe(ze))throw TypeError(ze+" is not a symbol");if(h(Ne,ze))return Ne[ze]},useSetter:function(){se=!0},useSimple:function(){se=!1}}),o({target:"Object",stat:!0,forced:!f,sham:!l},{create:function(ze,qe){return qe===void 0?x(ze):oe(x(ze),qe)},defineProperty:$e,defineProperties:oe,getOwnPropertyDescriptor:gt}),o({target:"Object",stat:!0,forced:!f},{getOwnPropertyNames:ct,getOwnPropertySymbols:Ee}),o({target:"Object",stat:!0,forced:d((function(){E.f(1)}))},{getOwnPropertySymbols:function(ze){return E.f(w(ze))}}),P&&o({target:"JSON",stat:!0,forced:!f||d((function(){var ze=G();return P([ze])!="[null]"||P({a:ze})!="{}"||P(Object(ze))!="{}"}))},{stringify:function(ze,qe,Je){for(var lt,Pe=[ze],Fe=1;arguments.length>Fe;)Pe.push(arguments[Fe++]);if(lt=qe,(p(qe)||ze!==void 0)&&!pe(ze))return g(qe)||(qe=function(nt,wt){if(typeof lt=="function"&&(wt=lt.call(this,nt,wt)),!pe(wt))return wt}),Pe[1]=qe,P.apply(null,Pe)}}),G.prototype[de]||O(G.prototype,de,G.prototype.valueOf),J(G,"Symbol"),B[ae]=!0},function(r,n,i){var o=i(4),a=i(16),s=i(11),c=i(14),l=i(13),f=i(15).f,u=i(119),d=s.Symbol;if(a&&typeof d=="function"&&(!("description"in d.prototype)||d().description!==void 0)){var h={},g=function(){var y=arguments.length<1||arguments[0]===void 0?void 0:String(arguments[0]),C=this instanceof g?new d(y):y===void 0?d():d(y);return y===""&&(h[C]=!0),C};u(g,d);var p=g.prototype=d.prototype;p.constructor=g;var m=p.toString,w=String(d("test"))=="Symbol(test)",v=/^Symbol\((.*)\)[^)]+$/;f(p,"description",{configurable:!0,get:function(){var y=l(this)?this.valueOf():this,C=m.call(y);if(c(h,y))return"";var x=w?C.slice(7,-1):C.replace(v,"$1");return x===""?void 0:x}}),o({global:!0,forced:!0},{Symbol:g})}},function(r,n,i){i(126)("iterator")},function(r,n,i){var o,a=this&&this.__extends||(o=function(w,v){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,C){y.__proto__=C}||function(y,C){for(var x in C)C.hasOwnProperty(x)&&(y[x]=C[x])})(w,v)},function(w,v){function y(){this.constructor=w}o(w,v),w.prototype=v===null?Object.create(v):(y.prototype=v.prototype,new y)}),s=this&&this.__values||function(w){var v=typeof Symbol=="function"&&Symbol.iterator,y=v&&w[v],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),f=i(70),u=i(3),d=i(9),h=i(0),g=i(152),p=i(12),m=(function(w){function v(){var y=w.call(this)||this;return y._parent=null,y._firstChild=null,y._lastChild=null,y._previousSibling=null,y._nextSibling=null,y}return a(v,w),Object.defineProperty(v.prototype,"_childNodes",{get:function(){return this.__childNodes||(this.__childNodes=h.create_nodeList(this))},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverride||c.dom.window._associatedDocument},set:function(y){this._nodeDocumentOverride=y},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"_registeredObserverList",{get:function(){return this.__registeredObserverList||(this.__registeredObserverList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"nodeName",{get:function(){return u.Guard.isElementNode(this)?this._htmlUppercasedQualifiedName:u.Guard.isAttrNode(this)?this._qualifiedName:u.Guard.isExclusiveTextNode(this)?"#text":u.Guard.isCDATASectionNode(this)?"#cdata-section":u.Guard.isProcessingInstructionNode(this)?this._target:u.Guard.isCommentNode(this)?"#comment":u.Guard.isDocumentNode(this)?"#document":u.Guard.isDocumentTypeNode(this)?this._name:u.Guard.isDocumentFragmentNode(this)?"#document-fragment":""},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"baseURI",{get:function(){return g.urlSerializer(this._nodeDocument._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"isConnected",{get:function(){return u.Guard.isElementNode(this)&&h.shadowTree_isConnected(this)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"ownerDocument",{get:function(){return this._nodeType===l.NodeType.Document?null:this._nodeDocument},enumerable:!0,configurable:!0}),v.prototype.getRootNode=function(y){return h.tree_rootNode(this,!!y&&y.composed)},Object.defineProperty(v.prototype,"parentNode",{get:function(){return this._nodeType===l.NodeType.Attribute?null:this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"parentElement",{get:function(){return this._parent&&u.Guard.isElementNode(this._parent)?this._parent:null},enumerable:!0,configurable:!0}),v.prototype.hasChildNodes=function(){return this._firstChild!==null},Object.defineProperty(v.prototype,"childNodes",{get:function(){return this._childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"nodeValue",{get:function(){return u.Guard.isAttrNode(this)?this._value:u.Guard.isCharacterDataNode(this)?this._data:null},set:function(y){y===null&&(y=""),u.Guard.isAttrNode(this)?h.attr_setAnExistingAttributeValue(this,y):u.Guard.isCharacterDataNode(this)&&h.characterData_replaceData(this,0,this._data.length,y)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"textContent",{get:function(){return u.Guard.isDocumentFragmentNode(this)||u.Guard.isElementNode(this)?h.text_descendantTextContent(this):u.Guard.isAttrNode(this)?this._value:u.Guard.isCharacterDataNode(this)?this._data:null},set:function(y){y===null&&(y=""),u.Guard.isDocumentFragmentNode(this)||u.Guard.isElementNode(this)?h.node_stringReplaceAll(y,this):u.Guard.isAttrNode(this)?h.attr_setAnExistingAttributeValue(this,y):u.Guard.isCharacterDataNode(this)&&h.characterData_replaceData(this,0,h.tree_nodeLength(this),y)},enumerable:!0,configurable:!0}),v.prototype.normalize=function(){for(var y,C,x,T,S=[],_=h.tree_getFirstDescendantNode(this,!1,!1,(function(fe){return u.Guard.isExclusiveTextNode(fe)}));_!==null;)S.push(_),_=h.tree_getNextDescendantNode(this,_,!1,!1,(function(fe){return u.Guard.isExclusiveTextNode(fe)}));for(var E=0;E<S.length;E++){var D=S[E];if(D._parent!==null){var b=h.tree_nodeLength(D);if(b!==0){var I=[],O="";try{for(var M=(y=void 0,s(h.text_contiguousExclusiveTextNodes(D))),R=M.next();!R.done;R=M.next()){var A=R.value;I.push(A),O+=A._data}}catch(fe){y={error:fe}}finally{try{R&&!R.done&&(C=M.return)&&C.call(M)}finally{if(y)throw y.error}}if(h.characterData_replaceData(D,b,0,O),c.dom.rangeList.size!==0)for(var B=D._nextSibling;B!==null&&u.Guard.isExclusiveTextNode(B);){var k=B,L=h.tree_index(k);try{for(var F=(x=void 0,s(c.dom.rangeList)),j=F.next();!j.done;j=F.next()){var J=j.value;J._start[0]===k&&(J._start[0]=D,J._start[1]+=b),J._end[0]===k&&(J._end[0]=D,J._end[1]+=b),J._start[0]===k._parent&&J._start[1]===L&&(J._start[0]=D,J._start[1]=b),J._end[0]===k._parent&&J._end[1]===L&&(J._end[0]=D,J._end[1]=b)}}catch(fe){x={error:fe}}finally{try{j&&!j.done&&(T=F.return)&&T.call(F)}finally{if(x)throw x.error}}b+=h.tree_nodeLength(B),B=B._nextSibling}for(var ie=0;ie<I.length;ie++)(A=I[ie])._parent!==null&&h.mutation_remove(A,A._parent)}else h.mutation_remove(D,D._parent)}}},v.prototype.cloneNode=function(y){if(y===void 0&&(y=!1),u.Guard.isShadowRoot(this))throw new d.NotSupportedError;return h.node_clone(this,null,y)},v.prototype.isEqualNode=function(y){return y===void 0&&(y=null),y!==null&&h.node_equals(this,y)},v.prototype.isSameNode=function(y){return y===void 0&&(y=null),this===y},v.prototype.compareDocumentPosition=function(y){if(y===this)return 0;var C=y,x=this,T=null,S=null;if(u.Guard.isAttrNode(C)&&(C=(T=C)._element),u.Guard.isAttrNode(x)&&(x=(S=x)._element,T&&C&&C===x))for(var _=0;_<x._attributeList.length;_++){var E=x._attributeList[_];if(h.node_equals(E,T))return l.Position.ImplementationSpecific|l.Position.Preceding;if(h.node_equals(E,S))return l.Position.ImplementationSpecific|l.Position.Following}return C===null||x===null||h.tree_rootNode(C)!==h.tree_rootNode(x)?l.Position.Disconnected|l.Position.ImplementationSpecific|(c.dom.compareCache.check(this,y)?l.Position.Preceding:l.Position.Following):!T&&h.tree_isAncestorOf(x,C)||S&&C===x?l.Position.Contains|l.Position.Preceding:!S&&h.tree_isDescendantOf(x,C)||T&&C===x?l.Position.ContainedBy|l.Position.Following:h.tree_isPreceding(x,C)?l.Position.Preceding:l.Position.Following},v.prototype.contains=function(y){return y!==null&&h.tree_isDescendantOf(this,y,!0)},v.prototype.lookupPrefix=function(y){return y?u.Guard.isElementNode(this)?h.node_locateANamespacePrefix(this,y):u.Guard.isDocumentNode(this)?this.documentElement===null?null:h.node_locateANamespacePrefix(this.documentElement,y):u.Guard.isDocumentTypeNode(this)||u.Guard.isDocumentFragmentNode(this)?null:u.Guard.isAttrNode(this)?this._element===null?null:h.node_locateANamespacePrefix(this._element,y):this._parent!==null&&u.Guard.isElementNode(this._parent)?h.node_locateANamespacePrefix(this._parent,y):null:null},v.prototype.lookupNamespaceURI=function(y){return h.node_locateANamespace(this,y||null)},v.prototype.isDefaultNamespace=function(y){return y||(y=null),h.node_locateANamespace(this,null)===y},v.prototype.insertBefore=function(y,C){return h.mutation_preInsert(y,this,C)},v.prototype.appendChild=function(y){return h.mutation_append(y,this)},v.prototype.replaceChild=function(y,C){return h.mutation_replace(C,y,this)},v.prototype.removeChild=function(y){return h.mutation_preRemove(y,this)},v.prototype._getTheParent=function(y){return u.Guard.isSlotable(this)&&h.shadowTree_isAssigned(this)?this._assignedSlot:this._parent},v.ELEMENT_NODE=1,v.ATTRIBUTE_NODE=2,v.TEXT_NODE=3,v.CDATA_SECTION_NODE=4,v.ENTITY_REFERENCE_NODE=5,v.ENTITY_NODE=6,v.PROCESSING_INSTRUCTION_NODE=7,v.COMMENT_NODE=8,v.DOCUMENT_NODE=9,v.DOCUMENT_TYPE_NODE=10,v.DOCUMENT_FRAGMENT_NODE=11,v.NOTATION_NODE=12,v.DOCUMENT_POSITION_DISCONNECTED=1,v.DOCUMENT_POSITION_PRECEDING=2,v.DOCUMENT_POSITION_FOLLOWING=4,v.DOCUMENT_POSITION_CONTAINS=8,v.DOCUMENT_POSITION_CONTAINED_BY=16,v.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,v})(f.EventTargetImpl);n.NodeImpl=m,m.prototype._children=new u.EmptySet,p.idl_defineConst(m.prototype,"ELEMENT_NODE",1),p.idl_defineConst(m.prototype,"ATTRIBUTE_NODE",2),p.idl_defineConst(m.prototype,"TEXT_NODE",3),p.idl_defineConst(m.prototype,"CDATA_SECTION_NODE",4),p.idl_defineConst(m.prototype,"ENTITY_REFERENCE_NODE",5),p.idl_defineConst(m.prototype,"ENTITY_NODE",6),p.idl_defineConst(m.prototype,"PROCESSING_INSTRUCTION_NODE",7),p.idl_defineConst(m.prototype,"COMMENT_NODE",8),p.idl_defineConst(m.prototype,"DOCUMENT_NODE",9),p.idl_defineConst(m.prototype,"DOCUMENT_TYPE_NODE",10),p.idl_defineConst(m.prototype,"DOCUMENT_FRAGMENT_NODE",11),p.idl_defineConst(m.prototype,"NOTATION_NODE",12),p.idl_defineConst(m.prototype,"DOCUMENT_POSITION_DISCONNECTED",1),p.idl_defineConst(m.prototype,"DOCUMENT_POSITION_PRECEDING",2),p.idl_defineConst(m.prototype,"DOCUMENT_POSITION_FOLLOWING",4),p.idl_defineConst(m.prototype,"DOCUMENT_POSITION_CONTAINS",8),p.idl_defineConst(m.prototype,"DOCUMENT_POSITION_CONTAINED_BY",16),p.idl_defineConst(m.prototype,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32)},function(r,n){r.exports=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i}},function(r,n,i){var o=i(87),a=i(41),s=i(27),c=i(26),l=i(128),f=[].push,u=function(d){var h=d==1,g=d==2,p=d==3,m=d==4,w=d==6,v=d==5||w;return function(y,C,x,T){for(var S,_,E=s(y),D=a(E),b=o(C,x,3),I=c(D.length),O=0,M=T||l,R=h?M(y,I):g?M(y,0):void 0;I>O;O++)if((v||O in D)&&(_=b(S=D[O],O,E),d)){if(h)R[O]=_;else if(_)switch(d){case 3:return!0;case 5:return S;case 6:return O;case 2:f.call(R,S)}else if(m)return!1}return w?-1:p||m?m:R}};r.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6)}},function(r,n,i){var o=this&&this.__values||function(E){var D=typeof Symbol=="function"&&Symbol.iterator,b=D&&E[D],I=0;if(b)return b.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&I>=E.length&&(E=void 0),{value:E&&E[I++],done:!E}}};throw new TypeError(D?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(E,D){var b=typeof Symbol=="function"&&E[Symbol.iterator];if(!b)return E;var I,O,M=b.call(E),R=[];try{for(;(D===void 0||D-- >0)&&!(I=M.next()).done;)R.push(I.value)}catch(A){O={error:A}}finally{try{I&&!I.done&&(b=M.return)&&b.call(M)}finally{if(O)throw O.error}}return R},s=this&&this.__spread||function(){for(var E=[],D=0;D<arguments.length;D++)E=E.concat(a(arguments[D]));return E};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(9),f=i(2),u=i(3),d=i(1),h=i(7),g=i(73),p=i(17),m=i(172),w=i(72),v=i(51),y=i(30),C=i(106);function x(E,D,b){var I,O,M,R,A,B,k,L,F=D._nodeType,j=E._nodeType,J=b?b._nodeType:null;if(F!==f.NodeType.Document&&F!==f.NodeType.DocumentFragment&&F!==f.NodeType.Element)throw new l.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+D.nodeName+".");if(p.tree_isHostIncludingAncestorOf(D,E,!0))throw new l.HierarchyRequestError("The node to be inserted cannot be an inclusive ancestor of parent node. Node is "+E.nodeName+", parent node is "+D.nodeName+".");if(b!==null&&b._parent!==D)throw new l.NotFoundError("The reference child node cannot be found under parent node. Child node is "+b.nodeName+", parent node is "+D.nodeName+".");if(j!==f.NodeType.DocumentFragment&&j!==f.NodeType.DocumentType&&j!==f.NodeType.Element&&j!==f.NodeType.Text&&j!==f.NodeType.ProcessingInstruction&&j!==f.NodeType.CData&&j!==f.NodeType.Comment)throw new l.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+E.nodeName+".");if(j===f.NodeType.Text&&F===f.NodeType.Document)throw new l.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+E.nodeName+".");if(j===f.NodeType.DocumentType&&F!==f.NodeType.Document)throw new l.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+D.nodeName+".");if(F===f.NodeType.Document){if(j===f.NodeType.DocumentFragment){var ie=0;try{for(var fe=o(E._children),ae=fe.next();!ae.done;ae=fe.next()){var de=ae.value;if(de._nodeType===f.NodeType.Element)ie++;else if(de._nodeType===f.NodeType.Text)throw new l.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+de.nodeName+".")}}catch(Q){I={error:Q}}finally{try{ae&&!ae.done&&(O=fe.return)&&O.call(fe)}finally{if(I)throw I.error}}if(ie>1)throw new l.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+ie+" element nodes.");if(ie===1){try{for(var we=o(D._children),_e=we.next();!_e.done;_e=we.next())if(_e.value._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("The document node already has a document element node.")}catch(Q){M={error:Q}}finally{try{_e&&!_e.done&&(R=we.return)&&R.call(we)}finally{if(M)throw M.error}}if(b){if(J===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");for(var Te=b._nextSibling;Te;){if(Te._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");Te=Te._nextSibling}}}}else if(j===f.NodeType.Element){try{for(var G=o(D._children),P=G.next();!P.done;P=G.next())if(P.value._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Document already has a document element node. Node is "+E.nodeName+".")}catch(Q){A={error:Q}}finally{try{P&&!P.done&&(B=G.return)&&B.call(G)}finally{if(A)throw A.error}}if(b){if(J===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+E.nodeName+".");for(Te=b._nextSibling;Te;){if(Te._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+E.nodeName+".");Te=Te._nextSibling}}}else if(j===f.NodeType.DocumentType){try{for(var $=o(D._children),W=$.next();!W.done;W=$.next())if(W.value._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Document already has a document type node. Node is "+E.nodeName+".")}catch(Q){k={error:Q}}finally{try{W&&!W.done&&(L=$.return)&&L.call($)}finally{if(k)throw k.error}}if(b)for(var q=b._previousSibling;q;){if(q._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+E.nodeName+".");q=q._previousSibling}else for(q=D._firstChild;q;){if(q._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+E.nodeName+".");q=q._nextSibling}}}}function T(E,D,b){x(E,D,b);var I=b;return I===E&&(I=E._nextSibling),C.document_adopt(E,D._nodeDocument),S(E,D,I),E}function S(E,D,b,I){var O,M;if(b!==null||E._nodeType===f.NodeType.DocumentFragment){var R=E._nodeType===f.NodeType.DocumentFragment?E._children.size:1;if(b!==null&&c.dom.rangeList.size!==0){var A=p.tree_index(b);try{for(var B=o(c.dom.rangeList),k=B.next();!k.done;k=B.next()){var L=k.value;L._start[0]===D&&L._start[1]>A&&(L._start[1]+=R),L._end[0]===D&&L._end[1]>A&&(L._end[1]+=R)}}catch(_e){O={error:_e}}finally{try{k&&!k.done&&(M=B.return)&&M.call(B)}finally{if(O)throw O.error}}}var F=E._nodeType===f.NodeType.DocumentFragment?new(Array.bind.apply(Array,s([void 0],E._children))):[E];if(E._nodeType===f.NodeType.DocumentFragment)for(;E._firstChild;)_(E._firstChild,E,!0);c.dom.features.mutationObservers&&E._nodeType===f.NodeType.DocumentFragment&&v.observer_queueTreeMutationRecord(E,[],F,null,null);for(var j=b?b._previousSibling:D._lastChild,J=b===null?-1:p.tree_index(b),ie=0;ie<F.length;ie++){var fe=F[ie];if(u.Guard.isElementNode(fe)&&(u.Guard.isDocumentNode(D)&&(D._documentElement=fe),fe._nodeDocument._hasNamespaces||fe._namespace===null&&fe._namespacePrefix===null||(fe._nodeDocument._hasNamespaces=!0)),fe._parent=D,b===null?h.set.append(D._children,fe):(h.set.insert(D._children,fe,J),J++),D._firstChild===null)fe._previousSibling=null,fe._nextSibling=null,D._firstChild=fe,D._lastChild=fe;else{var ae=b?b._previousSibling:D._lastChild,de=b||null;fe._previousSibling=ae,fe._nextSibling=de,ae&&(ae._nextSibling=fe),de&&(de._previousSibling=fe),ae||(D._firstChild=fe),de||(D._lastChild=fe)}c.dom.features.slots&&D._shadowRoot!==null&&u.Guard.isSlotable(fe)&&w.shadowTree_assignASlot(fe),c.dom.features.steps&&u.Guard.isTextNode(fe)&&y.dom_runChildTextContentChangeSteps(D),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(D))&&u.Guard.isSlot(D)&&d.isEmpty(D._assignedNodes)&&w.shadowTree_signalASlotChange(D),c.dom.features.slots&&w.shadowTree_assignSlotablesForATree(p.tree_rootNode(fe));for(var we=p.tree_getFirstDescendantNode(fe,!0,!0);we!==null;)c.dom.features.steps&&y.dom_runInsertionSteps(we),c.dom.features.customElements&&u.Guard.isElementNode(we)&&w.shadowTree_isConnected(we)&&(u.Guard.isCustomElementNode(we)?g.customElement_enqueueACustomElementCallbackReaction(we,"connectedCallback",[]):g.customElement_tryToUpgrade(we)),we=p.tree_getNextDescendantNode(fe,we,!0,!0)}c.dom.features.mutationObservers&&(I||v.observer_queueTreeMutationRecord(D,F,[],j,b))}else(function(_e,Te,G){var P=Te._lastChild;if(u.Guard.isElementNode(_e)&&(u.Guard.isDocumentNode(Te)&&(Te._documentElement=_e),_e._nodeDocument._hasNamespaces||_e._namespace===null&&_e._namespacePrefix===null||(_e._nodeDocument._hasNamespaces=!0)),_e._parent=Te,Te._children.add(_e),Te._firstChild===null)_e._previousSibling=null,_e._nextSibling=null,Te._firstChild=_e,Te._lastChild=_e;else{var $=Te._lastChild;_e._previousSibling=$,_e._nextSibling=null,$&&($._nextSibling=_e),$||(Te._firstChild=_e),Te._lastChild=_e}c.dom.features.slots&&Te._shadowRoot!==null&&u.Guard.isSlotable(_e)&&w.shadowTree_assignASlot(_e),c.dom.features.steps&&u.Guard.isTextNode(_e)&&y.dom_runChildTextContentChangeSteps(Te),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(Te))&&u.Guard.isSlot(Te)&&d.isEmpty(Te._assignedNodes)&&w.shadowTree_signalASlotChange(Te),c.dom.features.slots&&w.shadowTree_assignSlotablesForATree(p.tree_rootNode(_e)),c.dom.features.steps&&y.dom_runInsertionSteps(_e),c.dom.features.customElements&&u.Guard.isElementNode(_e)&&w.shadowTree_isConnected(_e)&&(u.Guard.isCustomElementNode(_e)?g.customElement_enqueueACustomElementCallbackReaction(_e,"connectedCallback",[]):g.customElement_tryToUpgrade(_e)),c.dom.features.mutationObservers&&(G||v.observer_queueTreeMutationRecord(Te,[_e],[],P,null))})(E,D,I)}function _(E,D,b){var I,O,M,R,A,B,k,L;if(c.dom.rangeList.size!==0){var F=p.tree_index(E);try{for(var j=o(c.dom.rangeList),J=j.next();!J.done;J=j.next()){var ie=J.value;p.tree_isDescendantOf(E,ie._start[0],!0)&&(ie._start=[D,F]),p.tree_isDescendantOf(E,ie._end[0],!0)&&(ie._end=[D,F]),ie._start[0]===D&&ie._start[1]>F&&ie._start[1]--,ie._end[0]===D&&ie._end[1]>F&&ie._end[1]--}}catch(De){I={error:De}}finally{try{J&&!J.done&&(O=j.return)&&O.call(j)}finally{if(I)throw I.error}}try{for(var fe=o(c.dom.rangeList),ae=fe.next();!ae.done;ae=fe.next())(ie=ae.value)._start[0]===D&&ie._start[1]>F&&(ie._start[1]-=1),ie._end[0]===D&&ie._end[1]>F&&(ie._end[1]-=1)}catch(De){M={error:De}}finally{try{ae&&!ae.done&&(R=fe.return)&&R.call(fe)}finally{if(M)throw M.error}}}if(c.dom.features.steps)try{for(var de=o(m.nodeIterator_iteratorList()),we=de.next();!we.done;we=de.next()){var _e=we.value;_e._root._nodeDocument===E._nodeDocument&&y.dom_runNodeIteratorPreRemovingSteps(_e,E)}}catch(De){A={error:De}}finally{try{we&&!we.done&&(B=de.return)&&B.call(de)}finally{if(A)throw A.error}}var Te=E._previousSibling,G=E._nextSibling;u.Guard.isDocumentNode(D)&&u.Guard.isElementNode(E)&&(D._documentElement=null),E._parent=null,D._children.delete(E);var P=E._previousSibling,$=E._nextSibling;E._previousSibling=null,E._nextSibling=null,P&&(P._nextSibling=$),$&&($._previousSibling=P),P||(D._firstChild=$),$||(D._lastChild=P),c.dom.features.slots&&u.Guard.isSlotable(E)&&E._assignedSlot!==null&&w.shadowTree_isAssigned(E)&&w.shadowTree_assignSlotables(E._assignedSlot),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(D))&&u.Guard.isSlot(D)&&d.isEmpty(D._assignedNodes)&&w.shadowTree_signalASlotChange(D),c.dom.features.slots&&p.tree_getFirstDescendantNode(E,!0,!1,(function(De){return u.Guard.isSlot(De)}))!==null&&(w.shadowTree_assignSlotablesForATree(p.tree_rootNode(D)),w.shadowTree_assignSlotablesForATree(E)),c.dom.features.steps&&y.dom_runRemovingSteps(E,D),c.dom.features.customElements&&u.Guard.isCustomElementNode(E)&&g.customElement_enqueueACustomElementCallbackReaction(E,"disconnectedCallback",[]);for(var W=p.tree_getFirstDescendantNode(E,!1,!0);W!==null;)c.dom.features.steps&&y.dom_runRemovingSteps(W,E),c.dom.features.customElements&&u.Guard.isCustomElementNode(W)&&g.customElement_enqueueACustomElementCallbackReaction(W,"disconnectedCallback",[]),W=p.tree_getNextDescendantNode(E,W,!1,!0);if(c.dom.features.mutationObservers)for(var q=p.tree_getFirstAncestorNode(D,!0);q!==null;){try{for(var Q=(k=void 0,o(q._registeredObserverList)),ee=Q.next();!ee.done;ee=Q.next()){var ge=ee.value;ge.options.subtree&&E._registeredObserverList.push({observer:ge.observer,options:ge.options,source:ge})}}catch(De){k={error:De}}finally{try{ee&&!ee.done&&(L=Q.return)&&L.call(Q)}finally{if(k)throw k.error}}q=p.tree_getNextAncestorNode(D,q,!0)}c.dom.features.mutationObservers&&(b||v.observer_queueTreeMutationRecord(D,[],[E],Te,G)),c.dom.features.steps&&u.Guard.isTextNode(E)&&y.dom_runChildTextContentChangeSteps(D)}n.mutation_ensurePreInsertionValidity=x,n.mutation_preInsert=T,n.mutation_insert=S,n.mutation_append=function(E,D){return T(E,D,null)},n.mutation_replace=function(E,D,b){var I,O,M,R,A,B,k,L;if(b._nodeType!==f.NodeType.Document&&b._nodeType!==f.NodeType.DocumentFragment&&b._nodeType!==f.NodeType.Element)throw new l.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+b.nodeName+".");if(p.tree_isHostIncludingAncestorOf(b,D,!0))throw new l.HierarchyRequestError("The node to be inserted cannot be an ancestor of parent node. Node is "+D.nodeName+", parent node is "+b.nodeName+".");if(E._parent!==b)throw new l.NotFoundError("The reference child node cannot be found under parent node. Child node is "+E.nodeName+", parent node is "+b.nodeName+".");if(D._nodeType!==f.NodeType.DocumentFragment&&D._nodeType!==f.NodeType.DocumentType&&D._nodeType!==f.NodeType.Element&&D._nodeType!==f.NodeType.Text&&D._nodeType!==f.NodeType.ProcessingInstruction&&D._nodeType!==f.NodeType.CData&&D._nodeType!==f.NodeType.Comment)throw new l.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+D.nodeName+".");if(D._nodeType===f.NodeType.Text&&b._nodeType===f.NodeType.Document)throw new l.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+D.nodeName+".");if(D._nodeType===f.NodeType.DocumentType&&b._nodeType!==f.NodeType.Document)throw new l.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+b.nodeName+".");if(b._nodeType===f.NodeType.Document){if(D._nodeType===f.NodeType.DocumentFragment){var F=0;try{for(var j=o(D._children),J=j.next();!J.done;J=j.next()){var ie=J.value;if(ie._nodeType===f.NodeType.Element)F++;else if(ie._nodeType===f.NodeType.Text)throw new l.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+ie.nodeName+".")}}catch(ge){I={error:ge}}finally{try{J&&!J.done&&(O=j.return)&&O.call(j)}finally{if(I)throw I.error}}if(F>1)throw new l.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+F+" element nodes.");if(F===1){try{for(var fe=o(b._children),ae=fe.next();!ae.done;ae=fe.next())if((P=ae.value)._nodeType===f.NodeType.Element&&P!==E)throw new l.HierarchyRequestError("The document node already has a document element node.")}catch(ge){M={error:ge}}finally{try{ae&&!ae.done&&(R=fe.return)&&R.call(fe)}finally{if(M)throw M.error}}for(var de=E._nextSibling;de;){if(de._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");de=de._nextSibling}}}else if(D._nodeType===f.NodeType.Element){try{for(var we=o(b._children),_e=we.next();!_e.done;_e=we.next())if((P=_e.value)._nodeType===f.NodeType.Element&&P!==E)throw new l.HierarchyRequestError("Document already has a document element node. Node is "+D.nodeName+".")}catch(ge){A={error:ge}}finally{try{_e&&!_e.done&&(B=we.return)&&B.call(we)}finally{if(A)throw A.error}}for(de=E._nextSibling;de;){if(de._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+D.nodeName+".");de=de._nextSibling}}else if(D._nodeType===f.NodeType.DocumentType){try{for(var Te=o(b._children),G=Te.next();!G.done;G=Te.next()){var P;if((P=G.value)._nodeType===f.NodeType.DocumentType&&P!==E)throw new l.HierarchyRequestError("Document already has a document type node. Node is "+D.nodeName+".")}}catch(ge){k={error:ge}}finally{try{G&&!G.done&&(L=Te.return)&&L.call(Te)}finally{if(k)throw k.error}}for(var $=E._previousSibling;$;){if($._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+D.nodeName+".");$=$._previousSibling}}}var W=E._nextSibling;W===D&&(W=D._nextSibling);var q=E._previousSibling;C.document_adopt(D,b._nodeDocument);var Q=[];E._parent!==null&&(Q.push(E),_(E,E._parent,!0));var ee=[];return D._nodeType===f.NodeType.DocumentFragment?ee=Array.from(D._children):ee.push(D),S(D,b,W,!0),c.dom.features.mutationObservers&&v.observer_queueTreeMutationRecord(b,ee,Q,q,W),E},n.mutation_replaceAll=function(E,D){var b,I;E!==null&&C.document_adopt(E,D._nodeDocument);var O=Array.from(D._children),M=[];E&&E._nodeType===f.NodeType.DocumentFragment?M=Array.from(E._children):E!==null&&M.push(E);try{for(var R=o(O),A=R.next();!A.done;A=R.next())_(A.value,D,!0)}catch(B){b={error:B}}finally{try{A&&!A.done&&(I=R.return)&&I.call(R)}finally{if(b)throw b.error}}E!==null&&S(E,D,null,!0),c.dom.features.mutationObservers&&v.observer_queueTreeMutationRecord(D,M,O,null,null)},n.mutation_preRemove=function(E,D){if(E._parent!==D)throw new l.NotFoundError("The child node cannot be found under parent node. Child node is "+E.nodeName+", parent node is "+D.nodeName+".");return _(E,D),E},n.mutation_remove=_},function(r,n,i){function o(a){return a==null}r.exports.isNothing=o,r.exports.isObject=function(a){return typeof a=="object"&&a!==null},r.exports.toArray=function(a){return Array.isArray(a)?a:o(a)?[]:[a]},r.exports.repeat=function(a,s){var c,l="";for(c=0;c<s;c+=1)l+=a;return l},r.exports.isNegativeZero=function(a){return a===0&&Number.NEGATIVE_INFINITY===1/a},r.exports.extend=function(a,s){var c,l,f,u;if(s)for(c=0,l=(u=Object.keys(s)).length;c<l;c+=1)a[f=u[c]]=s[f];return a}},function(r,n,i){var o=i(38),a=i(53),s=i(10);function c(f,u,d){var h=[];return f.include.forEach((function(g){d=c(g,u,d)})),f[u].forEach((function(g){d.forEach((function(p,m){p.tag===g.tag&&p.kind===g.kind&&h.push(m)})),d.push(g)})),d.filter((function(g,p){return h.indexOf(p)===-1}))}function l(f){this.include=f.include||[],this.implicit=f.implicit||[],this.explicit=f.explicit||[],this.implicit.forEach((function(u){if(u.loadKind&&u.loadKind!=="scalar")throw new a("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")})),this.compiledImplicit=c(this,"implicit",[]),this.compiledExplicit=c(this,"explicit",[]),this.compiledTypeMap=(function(){var u,d,h={scalar:{},sequence:{},mapping:{},fallback:{}};function g(p){h[p.kind][p.tag]=h.fallback[p.tag]=p}for(u=0,d=arguments.length;u<d;u+=1)arguments[u].forEach(g);return h})(this.compiledImplicit,this.compiledExplicit)}l.DEFAULT=null,l.create=function(){var f,u;switch(arguments.length){case 1:f=l.DEFAULT,u=arguments[0];break;case 2:f=arguments[0],u=arguments[1];break;default:throw new a("Wrong number of arguments for Schema.create function")}if(f=o.toArray(f),u=o.toArray(u),!f.every((function(d){return d instanceof l})))throw new a("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!u.every((function(d){return d instanceof s})))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new l({include:f,explicit:u})},r.exports=l},function(r,n){r.exports=function(i,o){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:o}}},function(r,n,i){var o=i(8),a=i(42),s="".split;r.exports=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(c){return a(c)=="String"?s.call(c,""):Object(c)}:Object},function(r,n){var i={}.toString;r.exports=function(o){return i.call(o).slice(8,-1)}},function(r,n,i){var o,a,s,c=i(186),l=i(11),f=i(13),u=i(21),d=i(14),h=i(57),g=i(45),p=l.WeakMap;if(c){var m=new p,w=m.get,v=m.has,y=m.set;o=function(x,T){return y.call(m,x,T),T},a=function(x){return w.call(m,x)||{}},s=function(x){return v.call(m,x)}}else{var C=h("state");g[C]=!0,o=function(x,T){return u(x,C,T),T},a=function(x){return d(x,C)?x[C]:{}},s=function(x){return d(x,C)}}r.exports={set:o,get:a,has:s,enforce:function(x){return s(x)?a(x):o(x,{})},getterFor:function(x){return function(T){var S;if(!f(T)||(S=a(T)).type!==x)throw TypeError("Incompatible receiver, "+x+" required");return S}}}},function(r,n){r.exports=!1},function(r,n){r.exports={}},function(r,n,i){var o=i(120),a=i(11),s=function(c){return typeof c=="function"?c:void 0};r.exports=function(c,l){return arguments.length<2?s(o[c])||s(a[c]):o[c]&&o[c][l]||a[c]&&a[c][l]}},function(r,n){var i=Math.ceil,o=Math.floor;r.exports=function(a){return isNaN(a=+a)?0:(a>0?o:i)(a)}},function(r,n,i){var o=i(8);r.exports=function(a,s){var c=[][a];return!!c&&o((function(){c.call(null,s||function(){throw 1},1)}))}},function(r,n){r.exports={}},function(r,n,i){i(31),i(32),i(33),i(220),i(64),i(19),i(65),i(20),i(68),i(66),i(92),i(144),i(22),i(94),i(23);var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,m=p&&g[p],w=0;if(m)return m.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(g,p){var m=typeof Symbol=="function"&&g[Symbol.iterator];if(!m)return g;var w,v,y=m.call(g),C=[];try{for(;(p===void 0||p-- >0)&&!(w=y.next()).done;)C.push(w.value)}catch(x){v={error:x}}finally{try{w&&!w.done&&(m=y.return)&&m.call(y)}finally{if(v)throw v.error}}return C},s=this&&this.__spread||function(){for(var g=[],p=0;p<arguments.length;p++)g=g.concat(a(arguments[p]));return g};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(69),f=i(95),u=i(7),d=i(0),h=(function(){function g(p){this.level=0,this._builderOptions=p}return g.prototype.declaration=function(p,m,w){},g.prototype.docType=function(p,m,w){},g.prototype.comment=function(p){},g.prototype.text=function(p){},g.prototype.instruction=function(p,m){},g.prototype.cdata=function(p){},g.prototype.openTagBegin=function(p){},g.prototype.openTagEnd=function(p,m,w){},g.prototype.closeTag=function(p){},g.prototype.attributes=function(p){var m,w;try{for(var v=o(p),y=v.next();!y.done;y=v.next()){var C=y.value;this.attribute(C[1]===null?C[2]:C[1]+":"+C[2],C[3])}}catch(x){m={error:x}}finally{try{y&&!y.done&&(w=v.return)&&w.call(v)}finally{if(m)throw m.error}}},g.prototype.attribute=function(p,m){},g.prototype.beginElement=function(p){},g.prototype.endElement=function(p){},g.prototype.serializeNode=function(p,m){var w=p._nodeDocument!==void 0&&p._nodeDocument._hasNamespaces;if(this.level=0,this.currentNode=p,w){var v=new f.NamespacePrefixMap;v.set("xml",u.namespace.XML),this._serializeNodeNS(p,null,v,{value:1},m)}else this._serializeNode(p,m)},g.prototype._serializeNodeNS=function(p,m,w,v,y){switch(this.currentNode=p,p.nodeType){case c.NodeType.Element:this._serializeElementNS(p,m,w,v,y);break;case c.NodeType.Document:this._serializeDocumentNS(p,m,w,v,y);break;case c.NodeType.Comment:this._serializeComment(p,y);break;case c.NodeType.Text:this._serializeText(p,y);break;case c.NodeType.DocumentFragment:this._serializeDocumentFragmentNS(p,m,w,v,y);break;case c.NodeType.DocumentType:this._serializeDocumentType(p,y);break;case c.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(p,y);break;case c.NodeType.CData:this._serializeCData(p,y);break;default:throw new Error("Unknown node type: "+p.nodeType)}},g.prototype._serializeNode=function(p,m){switch(this.currentNode=p,p.nodeType){case c.NodeType.Element:this._serializeElement(p,m);break;case c.NodeType.Document:this._serializeDocument(p,m);break;case c.NodeType.Comment:this._serializeComment(p,m);break;case c.NodeType.Text:this._serializeText(p,m);break;case c.NodeType.DocumentFragment:this._serializeDocumentFragment(p,m);break;case c.NodeType.DocumentType:this._serializeDocumentType(p,m);break;case c.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(p,m);break;case c.NodeType.CData:this._serializeCData(p,m);break;default:throw new Error("Unknown node type: "+p.nodeType)}},g.prototype._serializeElementNS=function(p,m,w,v,y){var C,x,T=[];if(y&&(p.localName.indexOf(":")!==-1||!d.xml_isName(p.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var S="",_=!1,E=!1,D=w.copy(),b={},I=this._recordNamespaceInformation(p,D,b),O=m,M=p.namespaceURI;if(O===M)I!==null&&(E=!0),S=M===u.namespace.XML?"xml:"+p.localName:p.localName,this.beginElement(S),this.openTagBegin(S);else{var R=p.prefix,A=null;if(R===null&&M===I||(A=D.get(R,M)),R==="xmlns"){if(y)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");A=R}A!==null?(S=A+":"+p.localName,I!==null&&I!==u.namespace.XML&&(O=I||null),this.beginElement(S),this.openTagBegin(S)):R!==null?(R in b&&(R=this._generatePrefix(M,D,v)),D.set(R,M),S+=R+":"+p.localName,this.beginElement(S),this.openTagBegin(S),T.push([null,"xmlns",R,this._serializeAttributeValue(M,y)]),I!==null&&(O=I||null)):I===null||I!==null&&I!==M?(E=!0,S+=p.localName,O=M,this.beginElement(S),this.openTagBegin(S),T.push([null,null,"xmlns",this._serializeAttributeValue(M,y)])):(S+=p.localName,O=M,this.beginElement(S),this.openTagBegin(S))}T.push.apply(T,s(this._serializeAttributesNS(p,D,v,b,E,y))),this.attributes(T);var B=M===u.namespace.HTML;if(B&&p.childNodes.length===0&&g._VoidElementNames.has(p.localName)?(this.openTagEnd(S,!0,!0),this.endElement(S),_=!0):B||p.childNodes.length!==0?this.openTagEnd(S,!1,!1):(this.openTagEnd(S,!0,!1),this.endElement(S),_=!0),!_){if(!(B&&p.localName==="template"))try{for(var k=o(p.childNodes),L=k.next();!L.done;L=k.next()){var F=L.value;this.level++,this._serializeNodeNS(F,O,D,v,y),this.level--}}catch(j){C={error:j}}finally{try{L&&!L.done&&(x=k.return)&&x.call(k)}finally{if(C)throw C.error}}this.closeTag(S),this.endElement(S)}},g.prototype._serializeElement=function(p,m){var w,v;if(m&&(p.localName.indexOf(":")!==-1||!d.xml_isName(p.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var y=!1,C=p.localName;this.beginElement(C),this.openTagBegin(C);var x=this._serializeAttributes(p,m);if(this.attributes(x),p.hasChildNodes()?this.openTagEnd(C,!1,!1):(this.openTagEnd(C,!0,!1),this.endElement(C),y=!0),!y){try{for(var T=o(p._children),S=T.next();!S.done;S=T.next()){var _=S.value;this.level++,this._serializeNode(_,m),this.level--}}catch(E){w={error:E}}finally{try{S&&!S.done&&(v=T.return)&&v.call(T)}finally{if(w)throw w.error}}this.closeTag(C),this.endElement(C)}},g.prototype._serializeDocumentNS=function(p,m,w,v,y){var C,x;if(y&&p.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var T=o(p.childNodes),S=T.next();!S.done;S=T.next()){var _=S.value;this._serializeNodeNS(_,m,w,v,y)}}catch(E){C={error:E}}finally{try{S&&!S.done&&(x=T.return)&&x.call(T)}finally{if(C)throw C.error}}},g.prototype._serializeDocument=function(p,m){var w,v;if(m&&p.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var y=o(p._children),C=y.next();!C.done;C=y.next()){var x=C.value;this._serializeNode(x,m)}}catch(T){w={error:T}}finally{try{C&&!C.done&&(v=y.return)&&v.call(y)}finally{if(w)throw w.error}}},g.prototype._serializeComment=function(p,m){if(m&&(!d.xml_isLegalChar(p.data)||p.data.indexOf("--")!==-1||p.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");this.comment(p.data)},g.prototype._serializeText=function(p,m){if(m&&!d.xml_isLegalChar(p.data))throw new Error("Text data contains invalid characters (well-formed required).");var w=p.data.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.text(w)},g.prototype._serializeDocumentFragmentNS=function(p,m,w,v,y){var C,x;try{for(var T=o(p.childNodes),S=T.next();!S.done;S=T.next()){var _=S.value;this._serializeNodeNS(_,m,w,v,y)}}catch(E){C={error:E}}finally{try{S&&!S.done&&(x=T.return)&&x.call(T)}finally{if(C)throw C.error}}},g.prototype._serializeDocumentFragment=function(p,m){var w,v;try{for(var y=o(p._children),C=y.next();!C.done;C=y.next()){var x=C.value;this._serializeNode(x,m)}}catch(T){w={error:T}}finally{try{C&&!C.done&&(v=y.return)&&v.call(y)}finally{if(w)throw w.error}}},g.prototype._serializeDocumentType=function(p,m){if(m&&!d.xml_isPubidChar(p.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(m&&(!d.xml_isLegalChar(p.systemId)||p.systemId.indexOf('"')!==-1&&p.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");this.docType(p.name,p.publicId,p.systemId)},g.prototype._serializeProcessingInstruction=function(p,m){if(m&&(p.target.indexOf(":")!==-1||/^xml$/i.test(p.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(m&&(!d.xml_isLegalChar(p.data)||p.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");this.instruction(p.target,p.data)},g.prototype._serializeCData=function(p,m){if(m&&p.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");this.cdata(p.data)},g.prototype._serializeAttributesNS=function(p,m,w,v,y,C){var x,T,S=[],_=C?new l.LocalNameSet:void 0;try{for(var E=o(p.attributes),D=E.next();!D.done;D=E.next()){var b=D.value;if(C||y||b.namespaceURI!==null){if(C&&_&&_.has(b.namespaceURI,b.localName))throw new Error("Element contains duplicate attributes (well-formed required).");C&&_&&_.set(b.namespaceURI,b.localName);var I=b.namespaceURI,O=null;if(I!==null)if(O=m.get(b.prefix,I),I===u.namespace.XMLNS){if(b.value===u.namespace.XML||b.prefix===null&&y||b.prefix!==null&&(!(b.localName in v)||v[b.localName]!==b.value)&&m.has(b.localName,b.value))continue;if(C&&b.value===u.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(C&&b.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");b.prefix==="xmlns"&&(O="xmlns")}else O===null&&(O=b.prefix===null||m.hasPrefix(b.prefix)&&!m.has(b.prefix,I)?this._generatePrefix(I,m,w):b.prefix,S.push([null,"xmlns",O,this._serializeAttributeValue(I,C)]));if(C&&(b.localName.indexOf(":")!==-1||!d.xml_isName(b.localName)||b.localName==="xmlns"&&I===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");S.push([I,O,b.localName,this._serializeAttributeValue(b.value,C)])}else S.push([null,null,b.localName,this._serializeAttributeValue(b.value,C)])}}catch(M){x={error:M}}finally{try{D&&!D.done&&(T=E.return)&&T.call(E)}finally{if(x)throw x.error}}return S},g.prototype._serializeAttributes=function(p,m){var w,v,y=[],C=m?{}:void 0;try{for(var x=o(p.attributes),T=x.next();!T.done;T=x.next()){var S=T.value;if(m){if(m&&C&&S.localName in C)throw new Error("Element contains duplicate attributes (well-formed required).");if(m&&C&&(C[S.localName]=!0),m&&(S.localName.indexOf(":")!==-1||!d.xml_isName(S.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");y.push([null,null,S.localName,this._serializeAttributeValue(S.value,m)])}else y.push([null,null,S.localName,this._serializeAttributeValue(S.value,m)])}}catch(_){w={error:_}}finally{try{T&&!T.done&&(v=x.return)&&v.call(x)}finally{if(w)throw w.error}}return y},g.prototype._recordNamespaceInformation=function(p,m,w){var v,y,C=null;try{for(var x=o(p.attributes),T=x.next();!T.done;T=x.next()){var S=T.value,_=S.namespaceURI,E=S.prefix;if(_===u.namespace.XMLNS){if(E===null){C=S.value;continue}var D=S.localName,b=S.value;if(b===u.namespace.XML||(b===""&&(b=null),m.has(D,b)))continue;m.set(D,b),w[D]=b||""}}}catch(I){v={error:I}}finally{try{T&&!T.done&&(y=x.return)&&y.call(x)}finally{if(v)throw v.error}}return C},g.prototype._generatePrefix=function(p,m,w){var v="ns"+w.value.toString();return w.value++,m.set(v,p),v},g.prototype._serializeAttributeValue=function(p,m){if(m&&p!==null&&!d.xml_isLegalChar(p))throw new Error("Invalid characters in attribute value.");return p===null?"":p.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},g._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),g})();n.BaseWriter=h},function(r,n,i){var o=this&&this.__values||function(m){var w=typeof Symbol=="function"&&Symbol.iterator,v=w&&m[w],y=0;if(v)return v.call(m);if(m&&typeof m.length=="number")return{next:function(){return m&&y>=m.length&&(m=void 0),{value:m&&m[y++],done:!m}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(m,w){var v=typeof Symbol=="function"&&m[Symbol.iterator];if(!v)return m;var y,C,x=v.call(m),T=[];try{for(;(w===void 0||w-- >0)&&!(y=x.next()).done;)T.push(y.value)}catch(S){C={error:S}}finally{try{y&&!y.done&&(v=x.return)&&v.call(x)}finally{if(C)throw C.error}}return T};Object.defineProperty(n,"__esModule",{value:!0});var s=i(6),c=i(3),l=i(7),f=i(29),u=i(17),d=i(97);function h(){var m=s.dom.window;m._mutationObserverMicrotaskQueued||(m._mutationObserverMicrotaskQueued=!0,Promise.resolve().then((function(){g()})))}function g(){var m,w,v,y,C=s.dom.window;C._mutationObserverMicrotaskQueued=!1;var x=l.set.clone(C._mutationObservers),T=l.set.clone(C._signalSlots);l.set.empty(C._signalSlots);var S=function(O){var M=l.list.clone(O._recordQueue);l.list.empty(O._recordQueue);for(var R=0;R<O._nodeList.length;R++){var A=O._nodeList[R];l.list.remove(A._registeredObserverList,(function(B){return c.Guard.isTransientRegisteredObserver(B)&&B.observer===O}))}if(!l.list.isEmpty(M))try{O._callback.call(O,M,O)}catch{}};try{for(var _=o(x),E=_.next();!E.done;E=_.next())S(E.value)}catch(O){m={error:O}}finally{try{E&&!E.done&&(w=_.return)&&w.call(_)}finally{if(m)throw m.error}}if(s.dom.features.slots)try{for(var D=o(T),b=D.next();!b.done;b=D.next()){var I=b.value;d.event_fireAnEvent("slotchange",I,void 0,{bubbles:!0})}}catch(O){v={error:O}}finally{try{b&&!b.done&&(y=D.return)&&y.call(D)}finally{if(v)throw v.error}}}function p(m,w,v,y,C,x,T,S,_){for(var E,D,b=new Map,I=u.tree_getFirstAncestorNode(w,!0);I!==null;){for(var O=0;O<I._registeredObserverList.length;O++){var M=I._registeredObserverList[O],R=M.options;if((I===w||R.subtree)&&(m!=="attributes"||R.attributes)&&(m!=="attributes"||!R.attributeFilter||R.attributeFilter.indexOf(v||"")&&y===null)&&(m!=="characterData"||R.characterData)&&(m!=="childList"||R.childList)){var A=M.observer;b.has(A)||b.set(A,null),(m==="attributes"&&R.attributeOldValue||m==="characterData"&&R.characterDataOldValue)&&b.set(A,C)}}I=u.tree_getNextAncestorNode(w,I,!0)}try{for(var B=o(b),k=B.next();!k.done;k=B.next()){var L=a(k.value,2),F=L[0],j=L[1],J=f.create_mutationRecord(m,w,f.create_nodeListStatic(w,x),f.create_nodeListStatic(w,T),S,_,v,y,j);F._recordQueue.push(J)}}catch(ie){E={error:ie}}finally{try{k&&!k.done&&(D=B.return)&&D.call(B)}finally{if(E)throw E.error}}h()}n.observer_queueAMutationObserverMicrotask=h,n.observer_notifyMutationObservers=g,n.observer_queueMutationRecord=p,n.observer_queueTreeMutationRecord=function(m,w,v,y,C){p("childList",m,null,null,null,w,v,y,C)},n.observer_queueAttributeMutationRecord=function(m,w,v,y){p("attributes",m,w,v,y,[],[],null,null)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(7),s=i(3),c=i(9),l=i(29),f=i(73),u=i(51),d=i(30),h=i(37),g=i(106);function p(x,T,S){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(T,x._localName,x._namespace,x._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(T)&&f.customElement_enqueueACustomElementCallbackReaction(T,"attributeChangedCallback",[x._localName,x._value,S,x._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(T,x._localName,x._value,S,x._namespace),x._value=S}function m(x,T){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(T,x._localName,x._namespace,null),o.dom.features.customElements&&s.Guard.isCustomElementNode(T)&&f.customElement_enqueueACustomElementCallbackReaction(T,"attributeChangedCallback",[x._localName,null,x._value,x._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(T,x._localName,null,x._value,x._namespace),T._attributeList._asArray().push(x),x._element=T,T._nodeDocument._hasNamespaces||x._namespace===null&&x._namespacePrefix===null&&x._localName!=="xmlns"||(T._nodeDocument._hasNamespaces=!0)}function w(x,T){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(T,x._localName,x._namespace,x._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(T)&&f.customElement_enqueueACustomElementCallbackReaction(T,"attributeChangedCallback",[x._localName,x._value,null,x._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(T,x._localName,x._value,null,x._namespace);var S=T._attributeList._asArray().indexOf(x);T._attributeList._asArray().splice(S,1),x._element=null}function v(x,T,S){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,x._localName,x._namespace,x._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&f.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[x._localName,x._value,T._value,x._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(S,x._localName,x._value,T._value,x._namespace);var _=S._attributeList._asArray().indexOf(x);_!==-1&&(S._attributeList._asArray()[_]=T),x._element=null,T._element=S,S._nodeDocument._hasNamespaces||T._namespace===null&&T._namespacePrefix===null&&T._localName!=="xmlns"||(S._nodeDocument._hasNamespaces=!0)}function y(x,T){return T._namespace===a.namespace.HTML&&T._nodeDocument._type==="html"&&(x=x.toLowerCase()),T._attributeList._asArray().find((function(S){return S._qualifiedName===x}))||null}function C(x,T,S){var _=x||null;return S._attributeList._asArray().find((function(E){return E._namespace===_&&E._localName===T}))||null}n.element_has=function(x,T){return T._attributeList._asArray().indexOf(x)!==-1},n.element_change=p,n.element_append=m,n.element_remove=w,n.element_replace=v,n.element_getAnAttributeByName=y,n.element_getAnAttributeByNamespaceAndLocalName=C,n.element_getAnAttributeValue=function(x,T,S){S===void 0&&(S="");var _=C(S,T,x);return _===null?"":_._value},n.element_setAnAttribute=function(x,T){if(x._element!==null&&x._element!==T)throw new c.InUseAttributeError("This attribute already exists in the document: "+x._qualifiedName+" as a child of "+x._element._qualifiedName+".");var S=C(x._namespace||"",x._localName,T);return S===x?x:(S!==null?v(S,x,T):m(x,T),S)},n.element_setAnAttributeValue=function(x,T,S,_,E){_===void 0&&(_=null),E===void 0&&(E=null);var D=C(E||"",T,x);if(D===null){var b=l.create_attr(x._nodeDocument,T);return b._namespace=E,b._namespacePrefix=_,b._value=S,void m(b,x)}p(D,x,S)},n.element_removeAnAttributeByName=function(x,T){var S=y(x,T);return S!==null&&w(S,T),S},n.element_removeAnAttributeByNamespaceAndLocalName=function(x,T,S){var _=C(x,T,S);return _!==null&&w(_,S),_},n.element_createAnElement=function(x,T,S,_,E,D){_===void 0&&(_=null),E===void 0&&(E=null),D===void 0&&(D=!1);var b=null;if(!o.dom.features.customElements)return(b=l.create_element(x,T,S,_))._customElementState="uncustomized",b._customElementDefinition=null,b._is=E,b;var I=f.customElement_lookUpACustomElementDefinition(x,S,T,E);if(I!==null&&I.name!==I.localName)(b=new(g.document_elementInterface(T,a.namespace.HTML)))._localName=T,b._namespace=a.namespace.HTML,b._namespacePrefix=_,b._customElementState="undefined",b._customElementDefinition=null,b._is=E,b._nodeDocument=x,D?f.customElement_upgrade(I,b):f.customElement_enqueueACustomElementUpgradeReaction(b,I);else if(I!==null)if(D)try{var O=new I.constructor;if(console.assert(O._customElementState!==void 0),console.assert(O._customElementDefinition!==void 0),console.assert(O._namespace===a.namespace.HTML),O._attributeList.length!==0)throw new c.NotSupportedError("Custom element already has attributes.");if(O._children.size!==0)throw new c.NotSupportedError("Custom element already has child nodes.");if(O._parent!==null)throw new c.NotSupportedError("Custom element already has a parent node.");if(O._nodeDocument!==x)throw new c.NotSupportedError("Custom element is already in a document.");if(O._localName!==T)throw new c.NotSupportedError("Custom element has a different local name.");O._namespacePrefix=_,O._is=null}catch{(b=l.create_htmlUnknownElement(x,T,a.namespace.HTML,_))._customElementState="failed",b._customElementDefinition=null,b._is=null}else(b=l.create_htmlElement(x,T,a.namespace.HTML,_))._customElementState="undefined",b._customElementDefinition=null,b._is=null,f.customElement_enqueueACustomElementUpgradeReaction(b,I);else(b=new(g.document_elementInterface(T,S)))._localName=T,b._namespace=S,b._namespacePrefix=_,b._customElementState="uncustomized",b._customElementDefinition=null,b._is=E,b._nodeDocument=x,S!==a.namespace.HTML||E===null&&!f.customElement_isValidCustomElementName(T)||(b._customElementState="undefined");if(b===null)throw new Error("Unable to create element.");return b},n.element_insertAdjacent=function(x,T,S){switch(T.toLowerCase()){case"beforebegin":return x._parent===null?null:h.mutation_preInsert(S,x._parent,x);case"afterbegin":return h.mutation_preInsert(S,x,x._firstChild);case"beforeend":return h.mutation_preInsert(S,x,null);case"afterend":return x._parent===null?null:h.mutation_preInsert(S,x._parent,x._nextSibling);default:throw new c.SyntaxError(`Invalid 'where' argument. "beforebegin", "afterbegin", "beforeend" or "afterend" expected`)}}},function(r,n,i){function o(a,s){Error.call(this),this.name="YAMLException",this.reason=a,this.mark=s,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(a){var s=this.name+": ";return s+=this.reason||"(unknown reason)",!a&&this.mark&&(s+=" "+this.mark.toString()),s},r.exports=o},function(r,n,i){var o=i(39);r.exports=new o({include:[i(181)],implicit:[i(293),i(294)],explicit:[i(295),i(296),i(297),i(298)]})},function(r,n,i){var o=i(16),a=i(79),s=i(40),c=i(24),l=i(56),f=i(14),u=i(115),d=Object.getOwnPropertyDescriptor;n.f=o?d:function(h,g){if(h=c(h),g=l(g,!0),u)try{return d(h,g)}catch{}if(f(h,g))return s(!a.f.call(h,g),h[g])}},function(r,n,i){var o=i(13);r.exports=function(a,s){if(!o(a))return a;var c,l;if(s&&typeof(c=a.toString)=="function"&&!o(l=c.call(a))||typeof(c=a.valueOf)=="function"&&!o(l=c.call(a))||!s&&typeof(c=a.toString)=="function"&&!o(l=c.call(a)))return l;throw TypeError("Can't convert object to primitive value")}},function(r,n,i){var o=i(81),a=i(58),s=o("keys");r.exports=function(c){return s[c]||(s[c]=a(c))}},function(r,n){var i=0,o=Math.random();r.exports=function(a){return"Symbol("+String(a===void 0?"":a)+")_"+(++i+o).toString(36)}},function(r,n,i){var o=i(42);r.exports=Array.isArray||function(a){return o(a)=="Array"}},function(r,n,i){var o,a=i(18),s=i(188),c=i(84),l=i(45),f=i(189),u=i(116),d=i(57),h=d("IE_PROTO"),g=function(){},p=function(w){return"<script>"+w+"<\/script>"},m=function(){try{o=document.domain&&new ActiveXObject("htmlfile")}catch{}var w,v;m=o?(function(C){C.write(p("")),C.close();var x=C.parentWindow.Object;return C=null,x})(o):((v=u("iframe")).style.display="none",f.appendChild(v),v.src="javascript:",(w=v.contentWindow.document).open(),w.write(p("document.F=Object")),w.close(),w.F);for(var y=c.length;y--;)delete m.prototype[c[y]];return m()};l[h]=!0,r.exports=Object.create||function(w,v){var y;return w!==null?(g.prototype=a(w),y=new g,g.prototype=null,y[h]=w):y=m(),v===void 0?y:s(y,v)}},function(r,n,i){var o=i(121),a=i(84);r.exports=Object.keys||function(s){return o(s,a)}},function(r,n,i){var o=i(15).f,a=i(14),s=i(5)("toStringTag");r.exports=function(c,l,f){c&&!a(c=f?c:c.prototype,s)&&o(c,s,{configurable:!0,value:l})}},function(r,n,i){var o=i(8),a=i(5),s=i(129),c=a("species");r.exports=function(l){return s>=51||!o((function(){var f=[];return(f.constructor={})[c]=function(){return{foo:1}},f[l](Boolean).foo!==1}))}},function(r,n,i){var o=i(4),a=i(122).indexOf,s=i(48),c=i(28),l=[].indexOf,f=!!l&&1/[1].indexOf(1,-0)<0,u=s("indexOf"),d=c("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:f||!u||!d},{indexOf:function(h){return f?l.apply(this,arguments)||0:a(this,h,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(16),a=i(15).f,s=Function.prototype,c=s.toString,l=/^\s*function ([^ (]*)/;o&&!("name"in s)&&a(s,"name",{configurable:!0,get:function(){try{return c.call(this).match(l)[1]}catch{return""}}})},function(r,n,i){var o=i(25),a=i(18),s=i(8),c=i(136),l=RegExp.prototype,f=l.toString,u=s((function(){return f.call({source:"a",flags:"b"})!="/a/b"})),d=f.name!="toString";(u||d)&&o(RegExp.prototype,"toString",(function(){var h=a(this),g=String(h.source),p=h.flags;return"/"+g+"/"+String(p===void 0&&h instanceof RegExp&&!("flags"in l)?c.call(h):p)}),{unsafe:!0})},function(r,n,i){i(31),i(32),i(33),i(19),i(138),i(20),i(66),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}),s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(1),l=i(2),f=(function(u){function d(h,g){var p=u.call(this,h)||this;return p._writerOptions=c.applyDefaults(g,{format:"object",wellFormed:!1,group:!1,verbose:!1}),p}return a(d,u),d.prototype.serialize=function(h){return this._currentList=[],this._currentIndex=0,this._listRegister=[this._currentList],this.serializeNode(h,this._writerOptions.wellFormed),this._process(this._currentList,this._writerOptions)},d.prototype._process=function(h,g){var p,m,w,v,y,C,x;if(h.length===0)return{};for(var T={},S=!1,_=0,E=0,D=0,b=0,I=0;I<h.length;I++){var O=h[I];switch(Te=Object.keys(O)[0]){case"@":continue;case"#":_++;break;case"!":E++;break;case"?":D++;break;case"$":b++;break;default:T[Te]?S=!0:T[Te]=!0}}var M=this._getAttrKey(),R=this._getNodeKey(l.NodeType.Text),A=this._getNodeKey(l.NodeType.Comment),B=this._getNodeKey(l.NodeType.ProcessingInstruction),k=this._getNodeKey(l.NodeType.CData);if(_===1&&h.length===1&&c.isString(h[0]["#"]))return h[0]["#"];if(S){var L={};for(I=0;I<h.length;I++)if(O=h[I],(Te=Object.keys(O)[0])==="@"){var F=O["@"];(G=Object.keys(F)).length===1?L[M+G[0]]=F[G[0]]:L[M]=O["@"]}var j=[];for(I=0;I<h.length;I++)switch(O=h[I],Te=Object.keys(O)[0]){case"@":break;case"#":j.push(((p={})[R]=O["#"],p));break;case"!":j.push(((m={})[A]=O["!"],m));break;case"?":j.push(((w={})[B]=O["?"],w));break;case"$":j.push(((v={})[k]=O.$,v));break;default:if(($=O)[Te].length!==0&&c.isArray($[Te][0])){for(var J=[],ie=$[Te],fe=0;fe<ie.length;fe++)J.push(this._process(ie[fe],g));j.push(((y={})[Te]=J,y))}else g.verbose?j.push(((C={})[Te]=[this._process($[Te],g)],C)):j.push(((x={})[Te]=this._process($[Te],g),x))}return L[R]=j,L}var ae=1,de=1,we=1,_e=1;for(L={},I=0;I<h.length;I++){var Te;switch(O=h[I],Te=Object.keys(O)[0]){case"@":F=O["@"];var G=Object.keys(F);if(g.group&&G.length!==1)L[M]=F;else for(var P in F)L[M+P]=F[P];break;case"#":ae=this._processSpecItem(O["#"],L,g.group,R,_,ae);break;case"!":de=this._processSpecItem(O["!"],L,g.group,A,E,de);break;case"?":we=this._processSpecItem(O["?"],L,g.group,B,D,we);break;case"$":_e=this._processSpecItem(O.$,L,g.group,k,b,_e);break;default:var $;if(($=O)[Te].length!==0&&c.isArray($[Te][0])){J=[],ie=$[Te];for(var W=0;W<ie.length;W++)J.push(this._process(ie[W],g));L[Te]=J}else g.verbose?L[Te]=[this._process($[Te],g)]:L[Te]=this._process($[Te],g)}}return L},d.prototype._processSpecItem=function(h,g,p,m,w,v){var y,C;if(!p&&c.isArray(h)&&w+h.length>2)try{for(var x=s(h),T=x.next();!T.done;T=x.next()){var S=T.value;g[m+(v++).toString()]=S}}catch(_){y={error:_}}finally{try{T&&!T.done&&(C=x.return)&&C.call(x)}finally{if(y)throw y.error}}else g[w>1?m+(v++).toString():m]=h;return v},d.prototype.beginElement=function(h){var g,p,m=[];if(this._currentList.length===0)this._currentList.push(((g={})[h]=m,g));else{var w=this._currentList[this._currentList.length-1];this._isElementNode(w,h)?w[h].length!==0&&c.isArray(w[h][0])?w[h].push(m):w[h]=[w[h],m]:this._currentList.push(((p={})[h]=m,p))}this._currentIndex++,this._listRegister.length>this._currentIndex?this._listRegister[this._currentIndex]=m:this._listRegister.push(m),this._currentList=m},d.prototype.endElement=function(){this._currentList=this._listRegister[--this._currentIndex]},d.prototype.attribute=function(h,g){var p,m;if(this._currentList.length===0)this._currentList.push({"@":(p={},p[h]=g,p)});else{var w=this._currentList[this._currentList.length-1];this._isAttrNode(w)?w["@"][h]=g:this._currentList.push({"@":(m={},m[h]=g,m)})}},d.prototype.comment=function(h){if(this._currentList.length===0)this._currentList.push({"!":h});else{var g=this._currentList[this._currentList.length-1];this._isCommentNode(g)?c.isArray(g["!"])?g["!"].push(h):g["!"]=[g["!"],h]:this._currentList.push({"!":h})}},d.prototype.text=function(h){if(this._currentList.length===0)this._currentList.push({"#":h});else{var g=this._currentList[this._currentList.length-1];this._isTextNode(g)?c.isArray(g["#"])?g["#"].push(h):g["#"]=[g["#"],h]:this._currentList.push({"#":h})}},d.prototype.instruction=function(h,g){var p=g===""?h:h+" "+g;if(this._currentList.length===0)this._currentList.push({"?":p});else{var m=this._currentList[this._currentList.length-1];this._isInstructionNode(m)?c.isArray(m["?"])?m["?"].push(p):m["?"]=[m["?"],p]:this._currentList.push({"?":p})}},d.prototype.cdata=function(h){if(this._currentList.length===0)this._currentList.push({$:h});else{var g=this._currentList[this._currentList.length-1];this._isCDATANode(g)?c.isArray(g.$)?g.$.push(h):g.$=[g.$,h]:this._currentList.push({$:h})}},d.prototype._isAttrNode=function(h){return"@"in h},d.prototype._isTextNode=function(h){return"#"in h},d.prototype._isCommentNode=function(h){return"!"in h},d.prototype._isInstructionNode=function(h){return"?"in h},d.prototype._isCDATANode=function(h){return"$"in h},d.prototype._isElementNode=function(h,g){return g in h},d.prototype._getAttrKey=function(){return this._builderOptions.convert.att},d.prototype._getNodeKey=function(h){switch(h){case l.NodeType.Comment:return this._builderOptions.convert.comment;case l.NodeType.Text:return this._builderOptions.convert.text;case l.NodeType.ProcessingInstruction:return this._builderOptions.convert.ins;case l.NodeType.CData:return this._builderOptions.convert.cdata;default:throw new Error("Invalid node type.")}},d})(i(50).BaseWriter);n.ObjectWriter=f},function(r,n,i){var o=i(4),a=i(93);o({target:"RegExp",proto:!0,forced:/./.exec!==a},{exec:a})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(){this._items={},this._nullItems={}}return a.prototype.set=function(s,c){s===null?this._nullItems[c]=!0:(this._items[s]||(this._items[s]={}),this._items[s][c]=!0)},a.prototype.has=function(s,c){return s===null?this._nullItems[c]===!0:!!this._items[s]&&this._items[s][c]===!0},a})();n.LocalNameSet=o},function(r,n,i){var o=this&&this.__read||function(f,u){var d=typeof Symbol=="function"&&f[Symbol.iterator];if(!d)return f;var h,g,p=d.call(f),m=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)m.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(g)throw g.error}}return m};Object.defineProperty(n,"__esModule",{value:!0});var a=i(9),s=i(3),c=i(0),l=(function(){function f(){}return Object.defineProperty(f.prototype,"_eventListenerList",{get:function(){return this.__eventListenerList||(this.__eventListenerList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_eventHandlerMap",{get:function(){return this.__eventHandlerMap||(this.__eventHandlerMap={})},enumerable:!0,configurable:!0}),f.prototype.addEventListener=function(u,d,h){h===void 0&&(h={passive:!1,once:!1,capture:!1});var g,p=o(c.eventTarget_flattenMore(h),3),m=p[0],w=p[1],v=p[2];d&&(g=s.Guard.isEventListener(d)?d:{handleEvent:d},c.eventTarget_addEventListener(this,{type:u,callback:g,capture:m,passive:w,once:v,removed:!1}))},f.prototype.removeEventListener=function(u,d,h){h===void 0&&(h={capture:!1});var g=c.eventTarget_flatten(h);if(d)for(var p=0;p<this._eventListenerList.length;p++){var m=this._eventListenerList[p];if(m.type===u&&m.capture===g){if(s.Guard.isEventListener(d)&&m.callback===d){c.eventTarget_removeEventListener(this,m,p);break}if(d&&m.callback.handleEvent===d){c.eventTarget_removeEventListener(this,m,p);break}}}},f.prototype.dispatchEvent=function(u){if(u._dispatchFlag||!u._initializedFlag)throw new a.InvalidStateError;return u._isTrusted=!1,c.event_dispatch(u,this)},f.prototype._getTheParent=function(u){return null},f})();n.EventTargetImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(34),c=i(0),l=(function(f){function u(d){var h=f.call(this)||this;return h._data=d,h}return a(u,f),Object.defineProperty(u.prototype,"data",{get:function(){return this._data},set:function(d){c.characterData_replaceData(this,0,this._data.length,d)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),u.prototype.substringData=function(d,h){return c.characterData_substringData(this,d,h)},u.prototype.appendData=function(d){return c.characterData_replaceData(this,this._data.length,0,d)},u.prototype.insertData=function(d,h){c.characterData_replaceData(this,d,0,h)},u.prototype.deleteData=function(d,h){c.characterData_replaceData(this,d,h,"")},u.prototype.replaceData=function(d,h,g){c.characterData_replaceData(this,d,h,g)},Object.defineProperty(u.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),u.prototype.before=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.after=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.replaceWith=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},u})(s.NodeImpl);n.CharacterDataImpl=l},function(r,n,i){var o=this&&this.__values||function(w){var v=typeof Symbol=="function"&&Symbol.iterator,y=v&&w[v],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(w,v){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var C,x,T=y.call(w),S=[];try{for(;(v===void 0||v-- >0)&&!(C=T.next()).done;)S.push(C.value)}catch(_){x={error:_}}finally{try{C&&!C.done&&(y=T.return)&&y.call(T)}finally{if(x)throw x.error}}return S},s=this&&this.__spread||function(){for(var w=[],v=0;v<arguments.length;v++)w=w.concat(a(arguments[v]));return w};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(3),f=i(1),u=i(17),d=i(51);function h(w){c.dom.window._signalSlots.add(w),d.observer_queueAMutationObserverMicrotask()}function g(w,v){v===void 0&&(v=!1);var y=l.Cast.asNode(w)._parent;if(y===null)return null;var C=y._shadowRoot||null;if(C===null||v&&C._mode!=="open")return null;for(var x=u.tree_getFirstDescendantNode(C,!1,!0,(function(T){return l.Guard.isSlot(T)}));x!==null;){if(x._name===w._name)return x;x=u.tree_getNextDescendantNode(C,x,!1,!0,(function(T){return l.Guard.isSlot(T)}))}return null}function p(w){var v,y,C=[],x=u.tree_rootNode(w);if(!l.Guard.isShadowRoot(x))return C;var T=x._host;try{for(var S=o(T._children),_=S.next();!_.done;_=S.next()){var E=_.value;l.Guard.isSlotable(E)&&g(E)===w&&C.push(E)}}catch(D){v={error:D}}finally{try{_&&!_.done&&(y=S.return)&&y.call(S)}finally{if(v)throw v.error}}return C}function m(w){var v,y,C=p(w);if(C.length===w._assignedNodes.length){for(var x=!0,T=0;T<C.length;T++)if(C[T]!==w._assignedNodes[T]){x=!1;break}x||h(w)}w._assignedNodes=C;try{for(var S=o(C),_=S.next();!_.done;_=S.next())_.value._assignedSlot=w}catch(E){v={error:E}}finally{try{_&&!_.done&&(y=S.return)&&y.call(S)}finally{if(v)throw v.error}}}n.shadowTree_signalASlotChange=h,n.shadowTree_isConnected=function(w){return l.Guard.isDocumentNode(u.tree_rootNode(w,!0))},n.shadowTree_isAssigned=function(w){return w._assignedSlot!==null},n.shadowTree_findASlot=g,n.shadowTree_findSlotables=p,n.shadowTree_findFlattenedSlotables=function w(v){var y,C,x,T,S=[],_=u.tree_rootNode(v);if(!l.Guard.isShadowRoot(_))return S;var E=p(v);if(f.isEmpty(E))try{for(var D=o(v._children),b=D.next();!b.done;b=D.next()){var I=b.value;l.Guard.isSlotable(I)&&E.push(I)}}catch(B){y={error:B}}finally{try{b&&!b.done&&(C=D.return)&&C.call(D)}finally{if(y)throw y.error}}try{for(var O=o(E),M=O.next();!M.done;M=O.next()){var R=M.value;if(l.Guard.isSlot(R)&&l.Guard.isShadowRoot(u.tree_rootNode(R))){var A=w(R);S.push.apply(S,s(A))}else S.push(R)}}catch(B){x={error:B}}finally{try{M&&!M.done&&(T=O.return)&&T.call(O)}finally{if(x)throw x.error}}return S},n.shadowTree_assignSlotables=m,n.shadowTree_assignSlotablesForATree=function(w){for(var v=u.tree_getFirstDescendantNode(w,!0,!1,(function(y){return l.Guard.isSlot(y)}));v!==null;)m(v),v=u.tree_getNextDescendantNode(w,v,!0,!1,(function(y){return l.Guard.isSlot(y)}))},n.shadowTree_assignASlot=function(w){var v=g(w);v!==null&&m(v)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=/[a-z]([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*/,a=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]),s=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),c=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),l=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);n.customElement_isValidCustomElementName=function(f){return!!o.test(f)&&!a.has(f)},n.customElement_isValidElementName=function(f){return s.has(f)},n.customElement_isVoidElementName=function(f){return c.has(f)},n.customElement_isValidShadowHostName=function(f){return l.has(f)},n.customElement_enqueueACustomElementUpgradeReaction=function(f,u){},n.customElement_enqueueACustomElementCallbackReaction=function(f,u,d){},n.customElement_upgrade=function(f,u){},n.customElement_tryToUpgrade=function(f){},n.customElement_lookUpACustomElementDefinition=function(f,u,d,h){return null}},function(r,n,i){i(4)({target:"String",proto:!0},{repeat:i(259)})},function(r,n,i){i(278),i(68),i(179),i(94),Object.defineProperty(n,"__esModule",{value:!0});var o=i(109),a=(function(){function s(c){this._builderOptions=c,c.parser&&Object.assign(this,c.parser)}return s.prototype._docType=function(c,l,f,u){return c.dtd({name:l,pubID:f,sysID:u})},s.prototype._comment=function(c,l){return c.com(l)},s.prototype._text=function(c,l){return c.txt(l)},s.prototype._instruction=function(c,l,f){return c.ins(l,f)},s.prototype._cdata=function(c,l){return c.dat(l)},s.prototype._element=function(c,l,f){return l===void 0?c.ele(f):c.ele(l,f)},s.prototype._attribute=function(c,l,f,u){return l===void 0?c.att(f,u):c.att(l,f,u)},s.prototype._sanitize=function(c){return o.sanitizeInput(c,this._builderOptions.invalidCharReplacement)},s.prototype._decodeText=function(c){return c==null?c:c.replace(/&(quot|amp|apos|lt|gt);/g,(function(l,f){return s._entityTable[f]})).replace(/&#(?:x([a-fA-F0-9]+)|([0-9]+));/g,(function(l,f,u){return String.fromCodePoint(parseInt(f||u,f?16:10))}))},s.prototype._decodeAttributeValue=function(c){return this._decodeText(c)},s.prototype.parse=function(c,l){return this._parse(c,l)},s.prototype.docType=function(c,l,f,u){return this._docType(c,l,f,u)},s.prototype.comment=function(c,l){return this._comment(c,l)},s.prototype.text=function(c,l){return this._text(c,l)},s.prototype.instruction=function(c,l,f){return this._instruction(c,l,f)},s.prototype.cdata=function(c,l){return this._cdata(c,l)},s.prototype.element=function(c,l,f){return this._element(c,l,f)},s.prototype.attribute=function(c,l,f,u){return this._attribute(c,l,f,u)},s.prototype.sanitize=function(c){return this._sanitize(c)},s._entityTable={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},s})();n.BaseReader=a},function(r,n,i){var o=i(39);r.exports=o.DEFAULT=new o({include:[i(54)],explicit:[i(299),i(300),i(301)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(185);n.XMLBuilderImpl=o.XMLBuilderImpl;var a=i(304);n.XMLBuilderCBImpl=a.XMLBuilderCBImpl;var s=i(183);n.builder=s.builder,n.create=s.create,n.fragment=s.fragment,n.convert=s.convert;var c=i(309);n.createCB=c.createCB,n.fragmentCB=c.fragmentCB},function(r,n){var i;i=(function(){return this})();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}r.exports=i},function(r,n,i){var o={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,s=a&&!o.call({1:2},1);n.f=s?function(c){var l=a(this,c);return!!l&&l.enumerable}:o},function(r,n,i){var o=i(11),a=i(21);r.exports=function(s,c){try{a(o,s,c)}catch{o[s]=c}return c}},function(r,n,i){var o=i(44),a=i(118);(r.exports=function(s,c){return a[s]||(a[s]=c!==void 0?c:{})})("versions",[]).push({version:"3.6.5",mode:o?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(r,n,i){var o=i(121),a=i(84).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(s){return o(s,a)}},function(r,n,i){var o=i(47),a=Math.max,s=Math.min;r.exports=function(c,l){var f=o(c);return f<0?a(f+l,0):s(f,l)}},function(r,n){r.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(r,n){n.f=Object.getOwnPropertySymbols},function(r,n,i){var o=i(8);r.exports=!!Object.getOwnPropertySymbols&&!o((function(){return!String(Symbol())}))},function(r,n,i){var o=i(127);r.exports=function(a,s,c){if(o(a),s===void 0)return a;switch(c){case 0:return function(){return a.call(s)};case 1:return function(l){return a.call(s,l)};case 2:return function(l,f){return a.call(s,l,f)};case 3:return function(l,f,u){return a.call(s,l,f,u)}}return function(){return a.apply(s,arguments)}}},function(r,n,i){var o=i(4),a=i(195),s=i(132),c=i(133),l=i(62),f=i(21),u=i(25),d=i(5),h=i(44),g=i(49),p=i(131),m=p.IteratorPrototype,w=p.BUGGY_SAFARI_ITERATORS,v=d("iterator"),y=function(){return this};r.exports=function(C,x,T,S,_,E,D){a(T,x,S);var b,I,O,M=function(j){if(j===_&&L)return L;if(!w&&j in B)return B[j];switch(j){case"keys":case"values":case"entries":return function(){return new T(this,j)}}return function(){return new T(this)}},R=x+" Iterator",A=!1,B=C.prototype,k=B[v]||B["@@iterator"]||_&&B[_],L=!w&&k||M(_),F=x=="Array"&&B.entries||k;if(F&&(b=s(F.call(new C)),m!==Object.prototype&&b.next&&(h||s(b)===m||(c?c(b,m):typeof b[v]!="function"&&f(b,v,y)),l(b,R,!0,!0),h&&(g[R]=y))),_=="values"&&k&&k.name!=="values"&&(A=!0,L=function(){return k.call(this)}),h&&!D||B[v]===L||f(B,v,L),g[x]=L,_)if(I={values:M("values"),keys:E?L:M("keys"),entries:M("entries")},D)for(O in I)(w||A||!(O in B))&&u(B,O,I[O]);else o({target:x,proto:!0,forced:w||A},I);return I}},function(r,n,i){var o=i(4),a=i(13),s=i(59),c=i(83),l=i(26),f=i(24),u=i(134),d=i(5),h=i(63),g=i(28),p=h("slice"),m=g("slice",{ACCESSORS:!0,0:0,1:2}),w=d("species"),v=[].slice,y=Math.max;o({target:"Array",proto:!0,forced:!p||!m},{slice:function(C,x){var T,S,_,E=f(this),D=l(E.length),b=c(C,D),I=c(x===void 0?D:x,D);if(s(E)&&(typeof(T=E.constructor)!="function"||T!==Array&&!s(T.prototype)?a(T)&&(T=T[w])===null&&(T=void 0):T=void 0,T===Array||T===void 0))return v.call(E,b,I);for(S=new(T===void 0?Array:T)(y(I-b,0)),_=0;b<I;b++,_++)b in E&&u(S,_,E[b]);return S.length=_,S}})},function(r,n,i){var o={};o[i(5)("toStringTag")]="z",r.exports=String(o)==="[object z]"},function(r,n,i){i(19),i(138),i(20),i(92),i(22),i(23),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultBuilderOptions={version:"1.0",encoding:void 0,standalone:void 0,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},invalidCharReplacement:void 0,parser:void 0},n.XMLBuilderOptionKeys=new Set(Object.keys(n.DefaultBuilderOptions)),n.DefaultXMLBuilderCBOptions={format:"xml",wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,spaceBeforeSlash:!1,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}}},function(r,n,i){var o=i(139),a=i(143);r.exports=o("Set",(function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}}),a)},function(r,n,i){var o,a,s=i(136),c=i(221),l=RegExp.prototype.exec,f=String.prototype.replace,u=l,d=(o=/a/,a=/b*/g,l.call(o,"a"),l.call(a,"a"),o.lastIndex!==0||a.lastIndex!==0),h=c.UNSUPPORTED_Y||c.BROKEN_CARET,g=/()??/.exec("")[1]!==void 0;(d||g||h)&&(u=function(p){var m,w,v,y,C=this,x=h&&C.sticky,T=s.call(C),S=C.source,_=0,E=p;return x&&((T=T.replace("y","")).indexOf("g")===-1&&(T+="g"),E=String(p).slice(C.lastIndex),C.lastIndex>0&&(!C.multiline||C.multiline&&p[C.lastIndex-1]!==`
`)&&(S="(?: "+S+")",E=" "+E,_++),w=new RegExp("^(?:"+S+")",T)),g&&(w=new RegExp("^"+S+"$(?!\\s)",T)),d&&(m=C.lastIndex),v=l.call(x?w:C,E),x?v?(v.input=v.input.slice(_),v[0]=v[0].slice(_),v.index=C.lastIndex,C.lastIndex+=v[0].length):C.lastIndex=0:d&&v&&(C.lastIndex=C.global?v.index+v[0].length:m),g&&v&&v.length>1&&f.call(v[0],w,(function(){for(y=1;y<arguments.length-2;y++)arguments[y]===void 0&&(v[y]=void 0)})),v}),r.exports=u},function(r,n,i){var o=i(225),a=i(18),s=i(27),c=i(26),l=i(47),f=i(35),u=i(226),d=i(227),h=Math.max,g=Math.min,p=Math.floor,m=/\$([$&'`]|\d\d?|<[^>]*>)/g,w=/\$([$&'`]|\d\d?)/g;o("replace",2,(function(v,y,C,x){var T=x.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,S=x.REPLACE_KEEPS_$0,_=T?"$":"$0";return[function(D,b){var I=f(this),O=D?.[v];return O!==void 0?O.call(D,I,b):y.call(String(I),D,b)},function(D,b){if(!T&&S||typeof b=="string"&&b.indexOf(_)===-1){var I=C(y,D,this,b);if(I.done)return I.value}var O=a(D),M=String(this),R=typeof b=="function";R||(b=String(b));var A=O.global;if(A){var B=O.unicode;O.lastIndex=0}for(var k=[];;){var L=d(O,M);if(L===null||(k.push(L),!A))break;String(L[0])===""&&(O.lastIndex=u(M,c(O.lastIndex),B))}for(var F,j="",J=0,ie=0;ie<k.length;ie++){L=k[ie];for(var fe=String(L[0]),ae=h(g(l(L.index),M.length),0),de=[],we=1;we<L.length;we++)de.push((F=L[we])===void 0?F:String(F));var _e=L.groups;if(R){var Te=[fe].concat(de,ae,M);_e!==void 0&&Te.push(_e);var G=String(b.apply(void 0,Te))}else G=E(fe,M,ae,de,_e,b);ae>=J&&(j+=M.slice(J,ae)+G,J=ae+fe.length)}return j+M.slice(J)}];function E(D,b,I,O,M,R){var A=I+D.length,B=O.length,k=w;return M!==void 0&&(M=s(M),k=m),y.call(R,k,(function(L,F){var j;switch(F.charAt(0)){case"$":return"$";case"&":return D;case"`":return b.slice(0,I);case"'":return b.slice(A);case"<":j=M[F.slice(1,-1)];break;default:var J=+F;if(J===0)return L;if(J>B){var ie=p(J/10);return ie===0?L:ie<=B?O[ie-1]===void 0?F.charAt(1):O[ie-1]+F.charAt(1):L}j=O[J-1]}return j===void 0?"":j}))}}))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(){this._items={},this._nullItems=[]}return a.prototype.copy=function(){var s=new a;for(var c in this._items)s._items[c]=this._items[c].slice(0);return s._nullItems=this._nullItems.slice(0),s},a.prototype.get=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;if(l===null)return null;for(var f=null,u=0;u<l.length;u++)if((f=l[u])===s)return f;return f},a.prototype.has=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;return l!==null&&l.indexOf(s)!==-1},a.prototype.hasPrefix=function(s){if(this._nullItems.indexOf(s)!==-1)return!0;for(var c in this._items)if(this._items[c].indexOf(s)!==-1)return!0;return!1},a.prototype.set=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;c!==null&&l===null?this._items[c]=[s]:l.push(s)},a})();n.NamespacePrefixMap=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.Surrogate=/[\uD800-\uDFFF]/,n.ScalarValue=/[\uD800-\uDFFF]/,n.NonCharacter=/[\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]/,n.ASCIICodePoint=/[\u0000-\u007F]/,n.ASCIITabOrNewLine=/[\t\n\r]/,n.ASCIIWhiteSpace=/[\t\n\f\r ]/,n.C0Control=/[\u0000-\u001F]/,n.C0ControlOrSpace=/[\u0000-\u001F ]/,n.Control=/[\u0000-\u001F\u007F-\u009F]/,n.ASCIIDigit=/[0-9]/,n.ASCIIUpperHexDigit=/[0-9A-F]/,n.ASCIILowerHexDigit=/[0-9a-f]/,n.ASCIIHexDigit=/[0-9A-Fa-f]/,n.ASCIIUpperAlpha=/[A-Z]/,n.ASCIILowerAlpha=/[a-z]/,n.ASCIIAlpha=/[A-Za-z]/,n.ASCIIAlphanumeric=/[0-9A-Za-z]/},function(r,n,i){var o=this&&this.__values||function(b){var I=typeof Symbol=="function"&&Symbol.iterator,O=I&&b[I],M=0;if(O)return O.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&M>=b.length&&(b=void 0),{value:b&&b[M++],done:!b}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(b,I){var O=typeof Symbol=="function"&&b[Symbol.iterator];if(!O)return b;var M,R,A=O.call(b),B=[];try{for(;(I===void 0||I-- >0)&&!(M=A.next()).done;)B.push(M.value)}catch(k){R={error:k}}finally{try{M&&!M.done&&(O=A.return)&&O.call(A)}finally{if(R)throw R.error}}return B},s=this&&this.__spread||function(){for(var b=[],I=0;I<arguments.length;I++)b=b.concat(a(arguments[I]));return b};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),f=i(3),u=i(171),d=i(104),h=i(9),g=i(17),p=i(72),m=i(30);function w(b,I){I===void 0&&(I=void 0),I===void 0&&(I=null);var O=v(b,I,new Date,{});return O._isTrusted=!0,O}function v(b,I,O,M){var R=new b("");return R._initializedFlag=!0,R._timeStamp=O.getTime(),Object.assign(R,M),c.dom.features.steps&&m.dom_runEventConstructingSteps(R),R}function y(b,I,O,M){var R,A,B,k;O===void 0&&(O=!1),M===void 0&&(M={value:!1});var L=!1;b._dispatchFlag=!0;var F=I;if(O){var j=I._associatedDocument;f.Guard.isDocumentNode(j)&&(F=j)}var J=null,ie=g.tree_retarget(b._relatedTarget,I);if(I!==ie||I===b._relatedTarget){var fe=[];try{for(var ae=o(b._touchTargetList),de=ae.next();!de.done;de=ae.next()){var we=de.value;fe.push(g.tree_retarget(we,I))}}catch(We){R={error:We}}finally{try{de&&!de.done&&(A=ae.return)&&A.call(ae)}finally{if(R)throw R.error}}C(b,I,F,ie,fe,!1);var _e=f.Guard.isMouseEvent(b)&&b._type==="click";_e&&I._activationBehavior!==void 0&&(J=I);for(var Te=f.Guard.isSlotable(I)&&p.shadowTree_isAssigned(I)?I:null,G=!1,P=I._getTheParent(b);P!==null&&f.Guard.isNode(P);){if(Te!==null){if(!f.Guard.isSlot(P))throw new Error("Parent node of a slotable should be a slot.");Te=null;var $=g.tree_rootNode(P,!0);f.Guard.isShadowRoot($)&&$._mode==="closed"&&(G=!0)}f.Guard.isSlotable(P)&&p.shadowTree_isAssigned(P)&&(Te=P),ie=g.tree_retarget(b._relatedTarget,P),fe=[];try{for(var W=(B=void 0,o(b._touchTargetList)),q=W.next();!q.done;q=W.next())we=q.value,fe.push(g.tree_retarget(we,P))}catch(We){B={error:We}}finally{try{q&&!q.done&&(k=W.return)&&k.call(W)}finally{if(B)throw B.error}}f.Guard.isWindow(P)||f.Guard.isNode(P)&&f.Guard.isNode(I)&&g.tree_isAncestorOf(g.tree_rootNode(I,!0),P,!0,!0)?(_e&&b._bubbles&&J===null&&P._activationBehavior&&(J=P),C(b,P,null,ie,fe,G)):P===ie?P=null:(I=P,_e&&J===null&&I._activationBehavior&&(J=I),C(b,P,I,ie,fe,G)),P!==null&&(P=P._getTheParent(b)),G=!1}for(var Q=null,ee=b._path,ge=ee.length-1;ge>=0;ge--)if((Ne=ee[ge]).shadowAdjustedTarget!==null){Q=Ne;break}if(Q!==null)if(f.Guard.isNode(Q.shadowAdjustedTarget)&&f.Guard.isShadowRoot(g.tree_rootNode(Q.shadowAdjustedTarget,!0)))L=!0;else if(f.Guard.isNode(Q.relatedTarget)&&f.Guard.isShadowRoot(g.tree_rootNode(Q.relatedTarget,!0)))L=!0;else for(var De=0;De<Q.touchTargetList.length;De++){var Ne=Q.touchTargetList[De];if(f.Guard.isNode(Ne)&&f.Guard.isShadowRoot(g.tree_rootNode(Ne,!0))){L=!0;break}}for(J!==null&&J._legacyPreActivationBehavior!==void 0&&J._legacyPreActivationBehavior(b),ge=ee.length-1;ge>=0;ge--)(Ne=ee[ge]).shadowAdjustedTarget!==null?b._eventPhase=l.EventPhase.AtTarget:b._eventPhase=l.EventPhase.Capturing,x(Ne,b,"capturing",M);for(ge=0;ge<ee.length;ge++){if((Ne=ee[ge]).shadowAdjustedTarget!==null)b._eventPhase=l.EventPhase.AtTarget;else{if(!b._bubbles)continue;b._eventPhase=l.EventPhase.Bubbling}x(Ne,b,"bubbling",M)}}return b._eventPhase=l.EventPhase.None,b._currentTarget=null,b._path=[],b._dispatchFlag=!1,b._stopPropagationFlag=!1,b._stopImmediatePropagationFlag=!1,L&&(b._target=null,b._relatedTarget=null,b._touchTargetList=[]),J!==null&&(b._canceledFlag||J._activationBehavior===void 0?J._legacyCanceledActivationBehavior!==void 0&&J._legacyCanceledActivationBehavior(b):J._activationBehavior(b)),!b._canceledFlag}function C(b,I,O,M,R,A){var B=!1;f.Guard.isNode(I)&&f.Guard.isShadowRoot(g.tree_rootNode(I))&&(B=!0);var k=!1;f.Guard.isShadowRoot(I)&&I._mode==="closed"&&(k=!0),b._path.push({invocationTarget:I,invocationTargetInShadowTree:B,shadowAdjustedTarget:O,relatedTarget:M,touchTargetList:R,rootOfClosedTree:k,slotInClosedTree:A})}function x(b,I,O,M){M===void 0&&(M={value:!1});for(var R=I._path,A=-1,B=0;B<R.length;B++)if(R[B]===b){A=B;break}if(A!==-1){var k=R[A];(k.shadowAdjustedTarget!==null||A>0&&(k=R[A-1]).shadowAdjustedTarget!==null)&&(I._target=k.shadowAdjustedTarget)}if(I._relatedTarget=b.relatedTarget,I._touchTargetList=b.touchTargetList,!I._stopPropagationFlag){I._currentTarget=b.invocationTarget;var L=I._currentTarget._eventListenerList,F=new(Array.bind.apply(Array,s([void 0],L)));if(!T(I,F,O,b,M)&&I._isTrusted){var j=I._type;j==="animationend"?I._type="webkitAnimationEnd":j==="animationiteration"?I._type="webkitAnimationIteration":j==="animationstart"?I._type="webkitAnimationStart":j==="transitionend"&&(I._type="webkitTransitionEnd"),T(I,F,O,b,M),I._type=j}}}function T(b,I,O,M,R){R===void 0&&(R={value:!1});for(var A=!1,B=0;B<I.length;B++){var k=I[B];if(!k.removed){if(b._type!==k.type||(A=!0,O==="capturing"&&!k.capture)||O==="bubbling"&&k.capture)continue;if(k.once&&b._currentTarget!==null){for(var L=b._currentTarget,F=-1,j=0;j<L._eventListenerList.length;j++)if(L._eventListenerList[j]===k){F=j;break}F!==-1&&L._eventListenerList.splice(F,1)}var J=void 0,ie=void 0;f.Guard.isWindow(J)&&(ie=J._currentEvent,M.invocationTargetInShadowTree===!1&&(J._currentEvent=b)),k.passive&&(b._inPassiveListenerFlag=!0);try{k.callback.handleEvent.call(b._currentTarget,b)}catch{R.value=!0}if(k.passive&&(b._inPassiveListenerFlag=!1),f.Guard.isWindow(J)&&(J._currentEvent=ie),b._stopImmediatePropagationFlag)return A}}return A}function S(b,I){return null}function _(b,I){return null}function E(b,I){}function D(b,I){}n.event_setTheCanceledFlag=function(b){b._cancelable&&!b._inPassiveListenerFlag&&(b._canceledFlag=!0)},n.event_initialize=function(b,I,O,M){b._initializedFlag=!0,b._stopPropagationFlag=!1,b._stopImmediatePropagationFlag=!1,b._canceledFlag=!1,b._isTrusted=!1,b._target=null,b._type=I,b._bubbles=O,b._cancelable=M},n.event_createAnEvent=w,n.event_innerEventCreationSteps=v,n.event_dispatch=y,n.event_appendToAnEventPath=C,n.event_invoke=x,n.event_innerInvoke=T,n.event_fireAnEvent=function(b,I,O,M,R){O===void 0&&(O=d.EventImpl);var A=w(O);if(A._type=b,M)for(var B in M)A[B]=M[B];return y(A,I,R)},n.event_createLegacyEvent=function(b){var I=null;switch(b.toLowerCase()){case"beforeunloadevent":case"compositionevent":break;case"customevent":I=u.CustomEventImpl;break;case"devicemotionevent":case"deviceorientationevent":case"dragevent":break;case"event":case"events":I=d.EventImpl}if(I===null)throw new h.NotSupportedError("Event constructor not found for interface "+b+".");var O=new I("");return O._type="",O._timeStamp=new Date().getTime(),O._isTrusted=!1,O._initializedFlag=!1,O},n.event_getterEventHandlerIDLAttribute=function(b,I){return null},n.event_setterEventHandlerIDLAttribute=function(b,I,O){},n.event_determineTheTargetOfAnEventHandler=S,n.event_getTheCurrentValueOfAnEventHandler=_,n.event_activateAnEventHandler=E,n.event_deactivateAnEventHandler=D},function(r,n,i){var o,a=this&&this.__extends||(o=function(C,x){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,S){T.__proto__=S}||function(T,S){for(var _ in S)S.hasOwnProperty(_)&&(T[_]=S[_])})(C,x)},function(C,x){function T(){this.constructor=C}o(C,x),C.prototype=x===null?Object.create(x):(T.prototype=x.prototype,new T)}),s=this&&this.__values||function(C){var x=typeof Symbol=="function"&&Symbol.iterator,T=x&&C[x],S=0;if(T)return T.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&S>=C.length&&(C=void 0),{value:C&&C[S++],done:!C}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(C,x){var T=typeof Symbol=="function"&&C[Symbol.iterator];if(!T)return C;var S,_,E=T.call(C),D=[];try{for(;(x===void 0||x-- >0)&&!(S=E.next()).done;)D.push(S.value)}catch(b){_={error:b}}finally{try{S&&!S.done&&(T=E.return)&&T.call(E)}finally{if(_)throw _.error}}return D};Object.defineProperty(n,"__esModule",{value:!0});var l=i(6),f=i(2),u=i(9),d=i(34),h=i(3),g=i(1),p=i(7),m=i(152),w=i(0),v=i(12),y=(function(C){function x(){var T=C.call(this)||this;return T._children=new Set,T._encoding={name:"UTF-8",labels:["unicode-1-1-utf-8","utf-8","utf8"]},T._contentType="application/xml",T._URL={scheme:"about",username:"",password:"",host:null,port:null,path:["blank"],query:null,fragment:null,_cannotBeABaseURLFlag:!0,_blobURLEntry:null},T._origin=null,T._type="xml",T._mode="no-quirks",T._documentElement=null,T._hasNamespaces=!1,T._nodeDocumentOverwrite=null,T}return a(x,C),Object.defineProperty(x.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverwrite||this},set:function(T){this._nodeDocumentOverwrite=T},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"implementation",{get:function(){return this._implementation||(this._implementation=w.create_domImplementation(this))},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"URL",{get:function(){return m.urlSerializer(this._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"documentURI",{get:function(){return this.URL},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"origin",{get:function(){return"null"},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"compatMode",{get:function(){return this._mode==="quirks"?"BackCompat":"CSS1Compat"},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"characterSet",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"charset",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"inputEncoding",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"doctype",{get:function(){var T,S;try{for(var _=s(this._children),E=_.next();!E.done;E=_.next()){var D=E.value;if(h.Guard.isDocumentTypeNode(D))return D}}catch(b){T={error:b}}finally{try{E&&!E.done&&(S=_.return)&&S.call(_)}finally{if(T)throw T.error}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"documentElement",{get:function(){return this._documentElement},enumerable:!0,configurable:!0}),x.prototype.getElementsByTagName=function(T){return w.node_listOfElementsWithQualifiedName(T,this)},x.prototype.getElementsByTagNameNS=function(T,S){return w.node_listOfElementsWithNamespace(T,S,this)},x.prototype.getElementsByClassName=function(T){return w.node_listOfElementsWithClassNames(T,this)},x.prototype.createElement=function(T,S){if(!w.xml_isName(T))throw new u.InvalidCharacterError;this._type==="html"&&(T=T.toLowerCase());var _=null;S!==void 0&&(_=g.isString(S)?S:S.is);var E=this._type==="html"||this._contentType==="application/xhtml+xml"?p.namespace.HTML:null;return w.element_createAnElement(this,T,E,null,_,!0)},x.prototype.createElementNS=function(T,S,_){return w.document_internalCreateElementNS(this,T,S,_)},x.prototype.createDocumentFragment=function(){return w.create_documentFragment(this)},x.prototype.createTextNode=function(T){return w.create_text(this,T)},x.prototype.createCDATASection=function(T){if(this._type==="html")throw new u.NotSupportedError;if(T.indexOf("]]>")!==-1)throw new u.InvalidCharacterError;return w.create_cdataSection(this,T)},x.prototype.createComment=function(T){return w.create_comment(this,T)},x.prototype.createProcessingInstruction=function(T,S){if(!w.xml_isName(T))throw new u.InvalidCharacterError;if(S.indexOf("?>")!==-1)throw new u.InvalidCharacterError;return w.create_processingInstruction(this,T,S)},x.prototype.importNode=function(T,S){if(S===void 0&&(S=!1),h.Guard.isDocumentNode(T)||h.Guard.isShadowRoot(T))throw new u.NotSupportedError;return w.node_clone(T,this,S)},x.prototype.adoptNode=function(T){if(h.Guard.isDocumentNode(T))throw new u.NotSupportedError;if(h.Guard.isShadowRoot(T))throw new u.HierarchyRequestError;return w.document_adopt(T,this),T},x.prototype.createAttribute=function(T){if(!w.xml_isName(T))throw new u.InvalidCharacterError;return this._type==="html"&&(T=T.toLowerCase()),w.create_attr(this,T)},x.prototype.createAttributeNS=function(T,S){var _=c(w.namespace_validateAndExtract(T,S),3),E=_[0],D=_[1],b=_[2],I=w.create_attr(this,b);return I._namespace=E,I._namespacePrefix=D,I},x.prototype.createEvent=function(T){return w.event_createLegacyEvent(T)},x.prototype.createRange=function(){var T=w.create_range();return T._start=[this,0],T._end=[this,0],T},x.prototype.createNodeIterator=function(T,S,_){S===void 0&&(S=f.WhatToShow.All),_===void 0&&(_=null);var E=w.create_nodeIterator(T,T,!0);return E._whatToShow=S,E._iteratorCollection=w.create_nodeList(T),g.isFunction(_)?(E._filter=w.create_nodeFilter(),E._filter.acceptNode=_):E._filter=_,E},x.prototype.createTreeWalker=function(T,S,_){S===void 0&&(S=f.WhatToShow.All),_===void 0&&(_=null);var E=w.create_treeWalker(T,T);return E._whatToShow=S,g.isFunction(_)?(E._filter=w.create_nodeFilter(),E._filter.acceptNode=_):E._filter=_,E},x.prototype._getTheParent=function(T){return T._type==="load"?null:l.dom.window},x.prototype.getElementById=function(T){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(x.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),x.prototype.prepend=function(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S];throw new Error("Mixin: ParentNode not implemented.")},x.prototype.append=function(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S];throw new Error("Mixin: ParentNode not implemented.")},x.prototype.querySelector=function(T){throw new Error("Mixin: ParentNode not implemented.")},x.prototype.querySelectorAll=function(T){throw new Error("Mixin: ParentNode not implemented.")},x})(d.NodeImpl);n.DocumentImpl=y,v.idl_defineConst(y.prototype,"_nodeType",f.NodeType.Document)},function(r,n,i){var o,a=this&&this.__extends||(o=function(m,w){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var C in y)y.hasOwnProperty(C)&&(v[C]=y[C])})(m,w)},function(m,w){function v(){this.constructor=m}o(m,w),m.prototype=w===null?Object.create(w):(v.prototype=w.prototype,new v)}),s=this&&this.__values||function(m){var w=typeof Symbol=="function"&&Symbol.iterator,v=w&&m[w],y=0;if(v)return v.call(m);if(m&&typeof m.length=="number")return{next:function(){return m&&y>=m.length&&(m=void 0),{value:m&&m[y++],done:!m}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(m,w){var v=typeof Symbol=="function"&&m[Symbol.iterator];if(!v)return m;var y,C,x=v.call(m),T=[];try{for(;(w===void 0||w-- >0)&&!(y=x.next()).done;)T.push(y.value)}catch(S){C={error:S}}finally{try{y&&!y.done&&(v=x.return)&&v.call(x)}finally{if(C)throw C.error}}return T};Object.defineProperty(n,"__esModule",{value:!0});var l=i(2),f=i(34),u=i(9),d=i(7),h=i(0),g=i(12),p=(function(m){function w(){var v=m.call(this)||this;return v._children=new Set,v._namespace=null,v._namespacePrefix=null,v._localName="",v._customElementState="undefined",v._customElementDefinition=null,v._is=null,v._shadowRoot=null,v._attributeList=h.create_namedNodeMap(v),v._attributeChangeSteps=[],v._name="",v._assignedSlot=null,v}return a(w,m),Object.defineProperty(w.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"tagName",{get:function(){return this._htmlUppercasedQualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"id",{get:function(){return h.element_getAnAttributeValue(this,"id")},set:function(v){h.element_setAnAttributeValue(this,"id",v)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"className",{get:function(){return h.element_getAnAttributeValue(this,"class")},set:function(v){h.element_setAnAttributeValue(this,"class",v)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"classList",{get:function(){var v=h.element_getAnAttributeByName("class",this);return v===null&&(v=h.create_attr(this._nodeDocument,"class")),h.create_domTokenList(this,v)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"slot",{get:function(){return h.element_getAnAttributeValue(this,"slot")},set:function(v){h.element_setAnAttributeValue(this,"slot",v)},enumerable:!0,configurable:!0}),w.prototype.hasAttributes=function(){return this._attributeList.length!==0},Object.defineProperty(w.prototype,"attributes",{get:function(){return this._attributeList},enumerable:!0,configurable:!0}),w.prototype.getAttributeNames=function(){var v,y,C=[];try{for(var x=s(this._attributeList),T=x.next();!T.done;T=x.next()){var S=T.value;C.push(S._qualifiedName)}}catch(_){v={error:_}}finally{try{T&&!T.done&&(y=x.return)&&y.call(x)}finally{if(v)throw v.error}}return C},w.prototype.getAttribute=function(v){var y=h.element_getAnAttributeByName(v,this);return y?y._value:null},w.prototype.getAttributeNS=function(v,y){var C=h.element_getAnAttributeByNamespaceAndLocalName(v,y,this);return C?C._value:null},w.prototype.setAttribute=function(v,y){if(!h.xml_isName(v))throw new u.InvalidCharacterError;this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(v=v.toLowerCase());for(var C=null,x=0;x<this._attributeList.length;x++){var T=this._attributeList[x];if(T._qualifiedName===v){C=T;break}}if(C===null)return(C=h.create_attr(this._nodeDocument,v))._value=y,void h.element_append(C,this);h.element_change(C,this,y)},w.prototype.setAttributeNS=function(v,y,C){var x=c(h.namespace_validateAndExtract(v,y),3),T=x[0],S=x[1],_=x[2];h.element_setAnAttributeValue(this,_,C,S,T)},w.prototype.removeAttribute=function(v){h.element_removeAnAttributeByName(v,this)},w.prototype.removeAttributeNS=function(v,y){h.element_removeAnAttributeByNamespaceAndLocalName(v,y,this)},w.prototype.hasAttribute=function(v){this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(v=v.toLowerCase());for(var y=0;y<this._attributeList.length;y++)if(this._attributeList[y]._qualifiedName===v)return!0;return!1},w.prototype.toggleAttribute=function(v,y){if(!h.xml_isName(v))throw new u.InvalidCharacterError;this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(v=v.toLowerCase());for(var C=null,x=0;x<this._attributeList.length;x++){var T=this._attributeList[x];if(T._qualifiedName===v){C=T;break}}return C===null?(y===void 0||y===!0)&&((C=h.create_attr(this._nodeDocument,v))._value="",h.element_append(C,this),!0):y!==void 0&&y!==!1||(h.element_removeAnAttributeByName(v,this),!1)},w.prototype.hasAttributeNS=function(v,y){for(var C=v||null,x=0;x<this._attributeList.length;x++){var T=this._attributeList[x];if(T._namespace===C&&T._localName===y)return!0}return!1},w.prototype.getAttributeNode=function(v){return h.element_getAnAttributeByName(v,this)},w.prototype.getAttributeNodeNS=function(v,y){return h.element_getAnAttributeByNamespaceAndLocalName(v,y,this)},w.prototype.setAttributeNode=function(v){return h.element_setAnAttribute(v,this)},w.prototype.setAttributeNodeNS=function(v){return h.element_setAnAttribute(v,this)},w.prototype.removeAttributeNode=function(v){for(var y=!1,C=0;C<this._attributeList.length;C++)if(this._attributeList[C]===v){y=!0;break}if(!y)throw new u.NotFoundError;return h.element_remove(v,this),v},w.prototype.attachShadow=function(v){if(this._namespace!==d.namespace.HTML)throw new u.NotSupportedError;if(!h.customElement_isValidCustomElementName(this._localName)&&!h.customElement_isValidShadowHostName(this._localName))throw new u.NotSupportedError;if(h.customElement_isValidCustomElementName(this._localName)||this._is!==null){var y=h.customElement_lookUpACustomElementDefinition(this._nodeDocument,this._namespace,this._localName,this._is);if(y!==null&&y.disableShadow===!0)throw new u.NotSupportedError}if(this._shadowRoot!==null)throw new u.NotSupportedError;var C=h.create_shadowRoot(this._nodeDocument,this);return C._mode=v.mode,this._shadowRoot=C,C},Object.defineProperty(w.prototype,"shadowRoot",{get:function(){var v=this._shadowRoot;return v===null||v.mode==="closed"?null:v},enumerable:!0,configurable:!0}),w.prototype.closest=function(v){throw new u.NotImplementedError},w.prototype.matches=function(v){throw new u.NotImplementedError},w.prototype.webkitMatchesSelector=function(v){return this.matches(v)},w.prototype.getElementsByTagName=function(v){return h.node_listOfElementsWithQualifiedName(v,this)},w.prototype.getElementsByTagNameNS=function(v,y){return h.node_listOfElementsWithNamespace(v,y,this)},w.prototype.getElementsByClassName=function(v){return h.node_listOfElementsWithClassNames(v,this)},w.prototype.insertAdjacentElement=function(v,y){return h.element_insertAdjacent(this,v,y)},w.prototype.insertAdjacentText=function(v,y){var C=h.create_text(this._nodeDocument,y);h.element_insertAdjacent(this,v,C)},Object.defineProperty(w.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"_htmlUppercasedQualifiedName",{get:function(){var v=this._qualifiedName;return this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(v=v.toUpperCase()),v},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),w.prototype.prepend=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];throw new Error("Mixin: ParentNode not implemented.")},w.prototype.append=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];throw new Error("Mixin: ParentNode not implemented.")},w.prototype.querySelector=function(v){throw new Error("Mixin: ParentNode not implemented.")},w.prototype.querySelectorAll=function(v){throw new Error("Mixin: ParentNode not implemented.")},Object.defineProperty(w.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),w.prototype.before=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.after=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.replaceWith=function(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},Object.defineProperty(w.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),w._create=function(v,y,C,x){C===void 0&&(C=null),x===void 0&&(x=null);var T=new w;return T._localName=y,T._namespace=C,T._namespacePrefix=x,T._nodeDocument=v,T},w})(f.NodeImpl);n.ElementImpl=p,g.idl_defineConst(p.prototype,"_nodeType",l.NodeType.Element)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(12),f=(function(u){function d(h){h===void 0&&(h=null);var g=u.call(this)||this;return g._children=new Set,g._host=h,g}return a(d,u),d.prototype.getElementById=function(h){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(d.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),d.prototype.prepend=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ParentNode not implemented.")},d.prototype.append=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ParentNode not implemented.")},d.prototype.querySelector=function(h){throw new Error("Mixin: ParentNode not implemented.")},d.prototype.querySelectorAll=function(h){throw new Error("Mixin: ParentNode not implemented.")},d._create=function(h,g){g===void 0&&(g=null);var p=new d(g);return p._nodeDocument=h,p},d})(c.NodeImpl);n.DocumentFragmentImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.DocumentFragment)},function(r,n,i){var o,a=this&&this.__extends||(o=function(h,g){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,m){p.__proto__=m}||function(p,m){for(var w in m)m.hasOwnProperty(w)&&(p[w]=m[w])})(h,g)},function(h,g){function p(){this.constructor=h}o(h,g),h.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),s=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],m=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&m>=h.length&&(h=void 0),{value:h&&h[m++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(71),f=i(0),u=i(12),d=(function(h){function g(p){p===void 0&&(p="");var m=h.call(this,p)||this;return m._name="",m._assignedSlot=null,m}return a(g,h),Object.defineProperty(g.prototype,"wholeText",{get:function(){var p,m,w="";try{for(var v=s(f.text_contiguousTextNodes(this,!0)),y=v.next();!y.done;y=v.next())w+=y.value._data}catch(C){p={error:C}}finally{try{y&&!y.done&&(m=v.return)&&m.call(v)}finally{if(p)throw p.error}}return w},enumerable:!0,configurable:!0}),g.prototype.splitText=function(p){return f.text_split(this,p)},Object.defineProperty(g.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),g._create=function(p,m){m===void 0&&(m="");var w=new g(m);return w._nodeDocument=p,w},g})(l.CharacterDataImpl);n.TextImpl=d,u.idl_defineConst(d.prototype,"_nodeType",c.NodeType.Text)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(){}return Object.defineProperty(a.prototype,"_startNode",{get:function(){return this._start[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_startOffset",{get:function(){return this._start[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_endNode",{get:function(){return this._end[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_endOffset",{get:function(){return this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_collapsed",{get:function(){return this._start[0]===this._end[0]&&this._start[1]===this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"startContainer",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"endContainer",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"endOffset",{get:function(){return this._endOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"collapsed",{get:function(){return this._collapsed},enumerable:!0,configurable:!0}),a})();n.AbstractRangeImpl=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=(function(){function s(c){this._activeFlag=!1,this._root=c,this._whatToShow=o.WhatToShow.All,this._filter=null}return Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"whatToShow",{get:function(){return this._whatToShow},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),s})();n.TraverserImpl=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(0),s=i(12),c=(function(){function l(f,u){this._target=null,this._relatedTarget=null,this._touchTargetList=[],this._path=[],this._currentTarget=null,this._eventPhase=o.EventPhase.None,this._stopPropagationFlag=!1,this._stopImmediatePropagationFlag=!1,this._canceledFlag=!1,this._inPassiveListenerFlag=!1,this._composedFlag=!1,this._initializedFlag=!1,this._dispatchFlag=!1,this._isTrusted=!1,this._bubbles=!1,this._cancelable=!1,this._type=f,u&&(this._bubbles=u.bubbles||!1,this._cancelable=u.cancelable||!1,this._composedFlag=u.composed||!1),this._initializedFlag=!0,this._timeStamp=new Date().getTime()}return Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"srcElement",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),l.prototype.composedPath=function(){var f=[],u=this._path;if(u.length===0)return f;var d=this._currentTarget;if(d===null)throw new Error("Event currentTarget is null.");f.push(d);for(var h=0,g=0,p=u.length-1;p>=0;){if(u[p].rootOfClosedTree&&g++,u[p].invocationTarget===d){h=p;break}u[p].slotInClosedTree&&g--,p--}var m=g,w=g;for(p=h-1;p>=0;)u[p].rootOfClosedTree&&m++,m<=w&&f.unshift(u[p].invocationTarget),u[p].slotInClosedTree&&--m<w&&(w=m),p--;for(m=g,w=g,p=h+1;p<u.length;)u[p].slotInClosedTree&&m++,m<=w&&f.push(u[p].invocationTarget),u[p].rootOfClosedTree&&--m<w&&(w=m),p++;return f},Object.defineProperty(l.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),l.prototype.stopPropagation=function(){this._stopPropagationFlag=!0},Object.defineProperty(l.prototype,"cancelBubble",{get:function(){return this._stopPropagationFlag},set:function(f){f&&this.stopPropagation()},enumerable:!0,configurable:!0}),l.prototype.stopImmediatePropagation=function(){this._stopPropagationFlag=!0,this._stopImmediatePropagationFlag=!0},Object.defineProperty(l.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"returnValue",{get:function(){return!this._canceledFlag},set:function(f){f||a.event_setTheCanceledFlag(this)},enumerable:!0,configurable:!0}),l.prototype.preventDefault=function(){a.event_setTheCanceledFlag(this)},Object.defineProperty(l.prototype,"defaultPrevented",{get:function(){return this._canceledFlag},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"composed",{get:function(){return this._composedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isTrusted",{get:function(){return this._isTrusted},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),l.prototype.initEvent=function(f,u,d){u===void 0&&(u=!1),d===void 0&&(d=!1),this._dispatchFlag||a.event_initialize(this,f,u,d)},l.NONE=0,l.CAPTURING_PHASE=1,l.AT_TARGET=2,l.BUBBLING_PHASE=3,l})();n.EventImpl=c,s.idl_defineConst(c.prototype,"NONE",0),s.idl_defineConst(c.prototype,"CAPTURING_PHASE",1),s.idl_defineConst(c.prototype,"AT_TARGET",2),s.idl_defineConst(c.prototype,"BUBBLING_PHASE",3)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(9);n.traversal_filter=function(s,c){if(s._activeFlag)throw new a.InvalidStateError;var l=1<<c._nodeType-1;if((s.whatToShow&l)==0)return o.FilterResult.Skip;if(!s.filter)return o.FilterResult.Accept;s._activeFlag=!0;var f=o.FilterResult.Reject;try{f=s.filter.acceptNode(c)}catch(u){throw s._activeFlag=!1,u}return s._activeFlag=!1,f}},function(r,n,i){var o=this&&this.__read||function(w,v){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var C,x,T=y.call(w),S=[];try{for(;(v===void 0||v-- >0)&&!(C=T.next()).done;)S.push(C.value)}catch(_){x={error:_}}finally{try{C&&!C.done&&(y=T.return)&&y.call(T)}finally{if(x)throw x.error}}return S},a=this&&this.__values||function(w){var v=typeof Symbol=="function"&&Symbol.iterator,y=v&&w[v],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(6),c=i(3),l=i(1),f=i(99),u=i(73),d=i(17),h=i(173),g=i(30),p=i(52),m=i(37);n.document_elementInterface=function(w,v){return f.ElementImpl},n.document_internalCreateElementNS=function(w,v,y,C){var x=o(h.namespace_validateAndExtract(v,y),3),T=x[0],S=x[1],_=x[2],E=null;return C!==void 0&&(E=l.isString(C)?C:C.is),p.element_createAnElement(w,_,T,S,E,!0)},n.document_adopt=function(w,v){var y,C;if(w._nodeDocument!==v||w._parent!==null){var x=w._nodeDocument;if(w._parent&&m.mutation_remove(w,w._parent),v!==x)for(var T=d.tree_getFirstDescendantNode(w,!0,!0);T!==null;){if(T._nodeDocument=v,c.Guard.isElementNode(T))try{for(var S=(y=void 0,a(T._attributeList._asArray())),_=S.next();!_.done;_=S.next())_.value._nodeDocument=v}catch(E){y={error:E}}finally{try{_&&!_.done&&(C=S.return)&&C.call(S)}finally{if(y)throw y.error}}s.dom.features.customElements&&c.Guard.isElementNode(T)&&T._customElementState==="custom"&&u.customElement_enqueueACustomElementCallbackReaction(T,"adoptedCallback",[x,v]),s.dom.features.steps&&g.dom_runAdoptingSteps(T,x),T=d.tree_getNextDescendantNode(w,T,!0,!0)}}}},function(r,n,i){var o=this&&this.__values||function(d){var h=typeof Symbol=="function"&&Symbol.iterator,g=h&&d[h],p=0;if(g)return g.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&p>=d.length&&(d=void 0),{value:d&&d[p++],done:!d}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(9),l=i(17),f=i(51),u=i(30);n.characterData_replaceData=function(d,h,g,p){var m,w,v=l.tree_nodeLength(d);if(h>v)throw new c.IndexSizeError("Offset exceeds character data length. Offset: "+h+", Length: "+v+", Node is "+d.nodeName+".");h+g>v&&(g=v-h),a.dom.features.mutationObservers&&f.observer_queueMutationRecord("characterData",d,null,null,d._data,[],[],null,null);var y=d._data.substring(0,h)+p+d._data.substring(h+g);d._data=y;try{for(var C=o(a.dom.rangeList),x=C.next();!x.done;x=C.next()){var T=x.value;T._start[0]===d&&T._start[1]>h&&T._start[1]<=h+g&&(T._start[1]=h),T._end[0]===d&&T._end[1]>h&&T._end[1]<=h+g&&(T._end[1]=h),T._start[0]===d&&T._start[1]>h+g&&(T._start[1]+=p.length-g),T._end[0]===d&&T._end[1]>h+g&&(T._end[1]+=p.length-g)}}catch(S){m={error:S}}finally{try{x&&!x.done&&(w=C.return)&&w.call(C)}finally{if(m)throw m.error}}a.dom.features.steps&&s.Guard.isTextNode(d)&&d._parent!==null&&u.dom_runChildTextContentChangeSteps(d._parent)},n.characterData_substringData=function(d,h,g){var p=l.tree_nodeLength(d);if(h>p)throw new c.IndexSizeError("Offset exceeds character data length. Offset: "+h+", Length: "+p+", Node is "+d.nodeName+".");return h+g>p?d._data.substr(h):d._data.substr(h,g)}},function(r,n,i){var o=this&&this.__read||function(u,d){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var g,p,m=h.call(u),w=[];try{for(;(d===void 0||d-- >0)&&!(g=m.next()).done;)w.push(g.value)}catch(v){p={error:v}}finally{try{g&&!g.done&&(h=m.return)&&h.call(m)}finally{if(p)throw p.error}}return w},a=this&&this.__spread||function(){for(var u=[],d=0;d<arguments.length;d++)u=u.concat(o(arguments[d]));return u},s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(7);function l(u){var d=c.string.splitAStringOnASCIIWhitespace(u);return new Set(d)}function f(u){return a(u).join(" ")}n.orderedSet_parse=l,n.orderedSet_serialize=f,n.orderedSet_sanitize=function(u){return f(l(u))},n.orderedSet_contains=function(u,d,h){var g,p,m,w;try{for(var v=s(d),y=v.next();!y.done;y=v.next()){var C=y.value,x=!1;try{for(var T=(m=void 0,s(u)),S=T.next();!S.done;S=T.next()){var _=S.value;if(h){if(_===C){x=!0;break}}else if(_.toUpperCase()===C.toUpperCase()){x=!0;break}}}catch(E){m={error:E}}finally{try{S&&!S.done&&(w=T.return)&&w.call(T)}finally{if(m)throw m.error}}if(!x)return!1}}catch(E){g={error:E}}finally{try{y&&!y.done&&(p=v.return)&&p.call(v)}finally{if(g)throw g.error}}return!0}},function(r,n,i){i(179),Object.defineProperty(n,"__esModule",{value:!0});var o=i(262),a=i(110),s=i(1);a.dom.setFeatures(!1),n.createDocument=function(){var c=new o.DOMImplementation().createDocument(null,"root",null);return c.documentElement&&c.removeChild(c.documentElement),c},n.sanitizeInput=function(c,l){if(c==null)return c;if(l===void 0)return c+"";var f="";c+="";for(var u=0;u<c.length;u++){var d=c.charCodeAt(u);if(d===9||d===10||d===13||d>=32&&d<=55295||d>=57344&&d<=65533)f+=c.charAt(u);else if(d>=55296&&d<=56319&&u<c.length-1){var h=c.charCodeAt(u+1);h>=56320&&h<=57343?(d=1024*(d-55296)+h-56320+65536,f+=String.fromCodePoint(d),u++):f+=s.isString(l)?l:l(c.charAt(u),u,c)}else f+=s.isString(l)?l:l(c.charAt(u),u,c)}return f}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(1),a=i(153);n.AbortController=a.AbortControllerImpl;var s=i(154);n.AbortSignal=s.AbortSignalImpl;var c=i(102);n.AbstractRange=c.AbstractRangeImpl;var l=i(157);n.Attr=l.AttrImpl;var f=i(158);n.CDATASection=f.CDATASectionImpl;var u=i(71);n.CharacterData=u.CharacterDataImpl;var d=i(263),h=i(159);n.Comment=h.CommentImpl;var g=i(171);n.CustomEvent=g.CustomEventImpl;var p=i(100);n.DocumentFragment=p.DocumentFragmentImpl;var m=i(98);n.Document=m.DocumentImpl;var w=i(264),v=i(155);n.DocumentType=v.DocumentTypeImpl;var y=i(6);n.dom=y.dom;var C=i(148);n.DOMImplementation=C.DOMImplementationImpl;var x=i(170);n.DOMTokenList=x.DOMTokenListImpl;var T=i(99);n.Element=T.ElementImpl;var S=i(104);n.Event=S.EventImpl;var _=i(70);n.EventTarget=_.EventTargetImpl;var E=i(161);n.HTMLCollection=E.HTMLCollectionImpl;var D=i(265);n.MutationObserver=D.MutationObserverImpl;var b=i(169);n.MutationRecord=b.MutationRecordImpl;var I=i(164);n.NamedNodeMap=I.NamedNodeMapImpl;var O=i(168);n.NodeFilter=O.NodeFilterImpl;var M=i(34);n.Node=M.NodeImpl;var R=i(166);n.NodeIterator=R.NodeIteratorImpl;var A=i(162);n.NodeList=A.NodeListImpl;var B=i(163);n.NodeListStatic=B.NodeListStaticImpl;var k=i(266),L=i(267),F=i(268),j=i(160);n.ProcessingInstruction=j.ProcessingInstructionImpl;var J=i(165);n.Range=J.RangeImpl;var ie=i(156);n.ShadowRoot=ie.ShadowRootImpl;var fe=i(269),ae=i(270);n.StaticRange=ae.StaticRangeImpl;var de=i(101);n.Text=de.TextImpl;var we=i(103);n.Traverser=we.TraverserImpl;var _e=i(167);n.TreeWalker=_e.TreeWalkerImpl;var Te=i(149);n.Window=Te.WindowImpl;var G=i(151);n.XMLDocument=G.XMLDocumentImpl,o.applyMixin(T.ElementImpl,d.ChildNodeImpl),o.applyMixin(u.CharacterDataImpl,d.ChildNodeImpl),o.applyMixin(v.DocumentTypeImpl,d.ChildNodeImpl),o.applyMixin(m.DocumentImpl,w.DocumentOrShadowRootImpl),o.applyMixin(ie.ShadowRootImpl,w.DocumentOrShadowRootImpl),o.applyMixin(T.ElementImpl,k.NonDocumentTypeChildNodeImpl),o.applyMixin(u.CharacterDataImpl,k.NonDocumentTypeChildNodeImpl),o.applyMixin(m.DocumentImpl,L.NonElementParentNodeImpl),o.applyMixin(p.DocumentFragmentImpl,L.NonElementParentNodeImpl),o.applyMixin(m.DocumentImpl,F.ParentNodeImpl),o.applyMixin(p.DocumentFragmentImpl,F.ParentNodeImpl),o.applyMixin(T.ElementImpl,F.ParentNodeImpl),o.applyMixin(de.TextImpl,fe.SlotableImpl),o.applyMixin(T.ElementImpl,fe.SlotableImpl)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),(function(o){o[o.EOF=0]="EOF",o[o.Declaration=1]="Declaration",o[o.DocType=2]="DocType",o[o.Element=3]="Element",o[o.Text=4]="Text",o[o.CDATA=5]="CDATA",o[o.PI=6]="PI",o[o.Comment=7]="Comment",o[o.ClosingTag=8]="ClosingTag"})(n.TokenType||(n.TokenType={}))},function(r,n,i){i(64),i(20),i(66);var o,a=this&&this.__extends||(o=function(l,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h])})(l,f)},function(l,f){function u(){this.constructor=l}o(l,f),l.prototype=f===null?Object.create(f):(u.prototype=f.prototype,new u)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=(function(l){function f(){return l!==null&&l.apply(this,arguments)||this}return a(f,l),f.prototype._parse=function(u,d){var h=this,g=this._builderOptions,p=null;return s.isFunction(d)?p=this.parse(u,d.apply(this)):s.isArray(d)||s.isSet(d)?s.forEachArray(d,(function(m){return p=h.parse(u,m)}),this):s.isMap(d)||s.isObject(d)?s.forEachObject(d,(function(m,w){if(s.isFunction(w)&&(w=w.apply(h)),g.ignoreConverters||m.indexOf(g.convert.att)!==0)if(g.ignoreConverters||m.indexOf(g.convert.text)!==0)if(g.ignoreConverters||m.indexOf(g.convert.cdata)!==0)if(g.ignoreConverters||m.indexOf(g.convert.comment)!==0)if(g.ignoreConverters||m.indexOf(g.convert.ins)!==0){if(!((s.isArray(w)||s.isSet(w))&&s.isEmpty(w))){if((s.isMap(w)||s.isObject(w))&&s.isEmpty(w))p=h.element(u,void 0,h.sanitize(m))||p;else if(g.keepNullNodes||w!=null)if(s.isArray(w)||s.isSet(w))s.forEachArray(w,(function(T){var S={};S[m]=T,p=h.parse(u,S)}),h);else if(s.isMap(w)||s.isObject(w))(v=h.element(u,void 0,h.sanitize(m)))&&(p=v,h.parse(v,w));else if(w!=null&&w!==""){var v;(v=h.element(u,void 0,h.sanitize(m)))&&(p=v,h.text(v,h._decodeText(h.sanitize(w))))}else p=h.element(u,void 0,h.sanitize(m))||p}}else if(s.isString(w)){var y=w.indexOf(" "),C=y===-1?w:w.substr(0,y),x=y===-1?"":w.substr(y+1);p=h.instruction(u,h.sanitize(C),h.sanitize(x))||p}else s.isArray(w)||s.isSet(w)?s.forEachArray(w,(function(T){var S=T.indexOf(" "),_=S===-1?T:T.substr(0,S),E=S===-1?"":T.substr(S+1);p=h.instruction(u,h.sanitize(_),h.sanitize(E))||p}),h):s.forEachObject(w,(function(T,S){return p=h.instruction(u,h.sanitize(T),h.sanitize(S))||p}),h);else s.isArray(w)||s.isSet(w)?s.forEachArray(w,(function(T){return p=h.comment(u,h.sanitize(T))||p}),h):p=h.comment(u,h.sanitize(w))||p;else s.isArray(w)||s.isSet(w)?s.forEachArray(w,(function(T){return p=h.cdata(u,h.sanitize(T))||p}),h):p=h.cdata(u,h.sanitize(w))||p;else p=s.isMap(w)||s.isObject(w)?h.parse(u,w):h.text(u,h._decodeText(h.sanitize(w)))||p;else if(m===g.convert.att){if(s.isArray(w)||s.isSet(w))throw new Error("Invalid attribute: "+w.toString()+". "+u._debugInfo());s.forEachObject(w,(function(T,S){p=h.attribute(u,void 0,h.sanitize(T),h._decodeAttributeValue(h.sanitize(S)))||p}))}else p=h.attribute(u,void 0,h.sanitize(m.substr(g.convert.att.length)),h._decodeAttributeValue(h.sanitize(w)))||p}),this):(g.keepNullNodes||d!=null)&&(p=this.text(u,this._decodeText(this.sanitize(d)))||p),p||u},f})(i(75).BaseReader);n.ObjectReader=c},function(r,n,i){var o=i(39);r.exports=new o({explicit:[i(286),i(287),i(288)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(a){this.level=0,this._builderOptions=a,this._writerOptions=a};n.BaseCBWriter=o},function(r,n,i){var o=i(16),a=i(8),s=i(116);r.exports=!o&&!a((function(){return Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a!=7}))},function(r,n,i){var o=i(11),a=i(13),s=o.document,c=a(s)&&a(s.createElement);r.exports=function(l){return c?s.createElement(l):{}}},function(r,n,i){var o=i(118),a=Function.toString;typeof o.inspectSource!="function"&&(o.inspectSource=function(s){return a.call(s)}),r.exports=o.inspectSource},function(r,n,i){var o=i(11),a=i(80),s=o["__core-js_shared__"]||a("__core-js_shared__",{});r.exports=s},function(r,n,i){var o=i(14),a=i(187),s=i(55),c=i(15);r.exports=function(l,f){for(var u=a(f),d=c.f,h=s.f,g=0;g<u.length;g++){var p=u[g];o(l,p)||d(l,p,h(f,p))}}},function(r,n,i){var o=i(11);r.exports=o},function(r,n,i){var o=i(14),a=i(24),s=i(122).indexOf,c=i(45);r.exports=function(l,f){var u,d=a(l),h=0,g=[];for(u in d)!o(c,u)&&o(d,u)&&g.push(u);for(;f.length>h;)o(d,u=f[h++])&&(~s(g,u)||g.push(u));return g}},function(r,n,i){var o=i(24),a=i(26),s=i(83),c=function(l){return function(f,u,d){var h,g=o(f),p=a(g.length),m=s(d,p);if(l&&u!=u){for(;p>m;)if((h=g[m++])!=h)return!0}else for(;p>m;m++)if((l||m in g)&&g[m]===u)return l||m||0;return!l&&-1}};r.exports={includes:c(!0),indexOf:c(!1)}},function(r,n,i){var o=i(8),a=/#|\.prototype\./,s=function(d,h){var g=l[c(d)];return g==u||g!=f&&(typeof h=="function"?o(h):!!h)},c=s.normalize=function(d){return String(d).replace(a,".").toLowerCase()},l=s.data={},f=s.NATIVE="N",u=s.POLYFILL="P";r.exports=s},function(r,n,i){var o=i(86);r.exports=o&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},function(r,n,i){var o=i(5);n.f=o},function(r,n,i){var o=i(120),a=i(14),s=i(125),c=i(15).f;r.exports=function(l){var f=o.Symbol||(o.Symbol={});a(f,l)||c(f,l,{value:s.f(l)})}},function(r,n){r.exports=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i}},function(r,n,i){var o=i(13),a=i(59),s=i(5)("species");r.exports=function(c,l){var f;return a(c)&&(typeof(f=c.constructor)!="function"||f!==Array&&!a(f.prototype)?o(f)&&(f=f[s])===null&&(f=void 0):f=void 0),new(f===void 0?Array:f)(l===0?0:l)}},function(r,n,i){var o,a,s=i(11),c=i(193),l=s.process,f=l&&l.versions,u=f&&f.v8;u?a=(o=u.split("."))[0]+o[1]:c&&(!(o=c.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=c.match(/Chrome\/(\d+)/))&&(a=o[1]),r.exports=a&&+a},function(r,n,i){var o=i(5),a=i(60),s=i(15),c=o("unscopables"),l=Array.prototype;l[c]==null&&s.f(l,c,{configurable:!0,value:a(null)}),r.exports=function(f){l[c][f]=!0}},function(r,n,i){var o,a,s,c=i(132),l=i(21),f=i(14),u=i(5),d=i(44),h=u("iterator"),g=!1;[].keys&&("next"in(s=[].keys())?(a=c(c(s)))!==Object.prototype&&(o=a):g=!0),o==null&&(o={}),d||f(o,h)||l(o,h,(function(){return this})),r.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:g}},function(r,n,i){var o=i(14),a=i(27),s=i(57),c=i(196),l=s("IE_PROTO"),f=Object.prototype;r.exports=c?Object.getPrototypeOf:function(u){return u=a(u),o(u,l)?u[l]:typeof u.constructor=="function"&&u instanceof u.constructor?u.constructor.prototype:u instanceof Object?f:null}},function(r,n,i){var o=i(18),a=i(197);r.exports=Object.setPrototypeOf||("__proto__"in{}?(function(){var s,c=!1,l={};try{(s=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(l,[]),c=l instanceof Array}catch{}return function(f,u){return o(f),a(u),c?s.call(f,u):f.__proto__=u,f}})():void 0)},function(r,n,i){var o=i(56),a=i(15),s=i(40);r.exports=function(c,l,f){var u=o(l);u in c?a.f(c,u,s(0,f)):c[u]=f}},function(r,n,i){var o=i(90),a=i(42),s=i(5)("toStringTag"),c=a((function(){return arguments})())=="Arguments";r.exports=o?a:function(l){var f,u,d;return l===void 0?"Undefined":l===null?"Null":typeof(u=(function(h,g){try{return h[g]}catch{}})(f=Object(l),s))=="string"?u:c?a(f):(d=a(f))=="Object"&&typeof f.callee=="function"?"Arguments":d}},function(r,n,i){var o=i(18);r.exports=function(){var a=o(this),s="";return a.global&&(s+="g"),a.ignoreCase&&(s+="i"),a.multiline&&(s+="m"),a.dotAll&&(s+="s"),a.unicode&&(s+="u"),a.sticky&&(s+="y"),s}},function(r,n,i){var o=i(47),a=i(35),s=function(c){return function(l,f){var u,d,h=String(a(l)),g=o(f),p=h.length;return g<0||g>=p?c?"":void 0:(u=h.charCodeAt(g))<55296||u>56319||g+1===p||(d=h.charCodeAt(g+1))<56320||d>57343?c?h.charAt(g):u:c?h.slice(g,g+2):d-56320+(u-55296<<10)+65536}};r.exports={codeAt:s(!1),charAt:s(!0)}},function(r,n,i){var o=i(4),a=i(27),s=i(61);o({target:"Object",stat:!0,forced:i(8)((function(){s(1)}))},{keys:function(c){return s(a(c))}})},function(r,n,i){var o=i(4),a=i(11),s=i(123),c=i(25),l=i(140),f=i(141),u=i(142),d=i(13),h=i(8),g=i(208),p=i(62),m=i(209);r.exports=function(w,v,y){var C=w.indexOf("Map")!==-1,x=w.indexOf("Weak")!==-1,T=C?"set":"add",S=a[w],_=S&&S.prototype,E=S,D={},b=function(B){var k=_[B];c(_,B,B=="add"?function(L){return k.call(this,L===0?0:L),this}:B=="delete"?function(L){return!(x&&!d(L))&&k.call(this,L===0?0:L)}:B=="get"?function(L){return x&&!d(L)?void 0:k.call(this,L===0?0:L)}:B=="has"?function(L){return!(x&&!d(L))&&k.call(this,L===0?0:L)}:function(L,F){return k.call(this,L===0?0:L,F),this})};if(s(w,typeof S!="function"||!(x||_.forEach&&!h((function(){new S().entries().next()})))))E=y.getConstructor(v,w,C,T),l.REQUIRED=!0;else if(s(w,!0)){var I=new E,O=I[T](x?{}:-0,1)!=I,M=h((function(){I.has(1)})),R=g((function(B){new S(B)})),A=!x&&h((function(){for(var B=new S,k=5;k--;)B[T](k,k);return!B.has(-0)}));R||((E=v((function(B,k){u(B,E,w);var L=m(new S,B,E);return k!=null&&f(k,L[T],L,C),L}))).prototype=_,_.constructor=E),(M||A)&&(b("delete"),b("has"),C&&b("get")),(A||O)&&b(T),x&&_.clear&&delete _.clear}return D[w]=E,o({global:!0,forced:E!=S},D),p(E,w),x||y.setStrong(E,w,C),E}},function(r,n,i){var o=i(45),a=i(13),s=i(14),c=i(15).f,l=i(58),f=i(204),u=l("meta"),d=0,h=Object.isExtensible||function(){return!0},g=function(m){c(m,u,{value:{objectID:"O"+ ++d,weakData:{}}})},p=r.exports={REQUIRED:!1,fastKey:function(m,w){if(!a(m))return typeof m=="symbol"?m:(typeof m=="string"?"S":"P")+m;if(!s(m,u)){if(!h(m))return"F";if(!w)return"E";g(m)}return m[u].objectID},getWeakData:function(m,w){if(!s(m,u)){if(!h(m))return!0;if(!w)return!1;g(m)}return m[u].weakData},onFreeze:function(m){return f&&p.REQUIRED&&h(m)&&!s(m,u)&&g(m),m}};o[u]=!0},function(r,n,i){var o=i(18),a=i(205),s=i(26),c=i(87),l=i(206),f=i(207),u=function(d,h){this.stopped=d,this.result=h};(r.exports=function(d,h,g,p,m){var w,v,y,C,x,T,S,_=c(h,g,p?2:1);if(m)w=d;else{if(typeof(v=l(d))!="function")throw TypeError("Target is not iterable");if(a(v)){for(y=0,C=s(d.length);C>y;y++)if((x=p?_(o(S=d[y])[0],S[1]):_(d[y]))&&x instanceof u)return x;return new u(!1)}w=v.call(d)}for(T=w.next;!(S=T.call(w)).done;)if(typeof(x=f(w,_,S.value,p))=="object"&&x&&x instanceof u)return x;return new u(!1)}).stop=function(d){return new u(!0,d)}},function(r,n){r.exports=function(i,o,a){if(!(i instanceof o))throw TypeError("Incorrect "+(a?a+" ":"")+"invocation");return i}},function(r,n,i){var o=i(15).f,a=i(60),s=i(210),c=i(87),l=i(142),f=i(141),u=i(88),d=i(211),h=i(16),g=i(140).fastKey,p=i(43),m=p.set,w=p.getterFor;r.exports={getConstructor:function(v,y,C,x){var T=v((function(D,b){l(D,T,y),m(D,{type:y,index:a(null),first:void 0,last:void 0,size:0}),h||(D.size=0),b!=null&&f(b,D[x],D,C)})),S=w(y),_=function(D,b,I){var O,M,R=S(D),A=E(D,b);return A?A.value=I:(R.last=A={index:M=g(b,!0),key:b,value:I,previous:O=R.last,next:void 0,removed:!1},R.first||(R.first=A),O&&(O.next=A),h?R.size++:D.size++,M!=="F"&&(R.index[M]=A)),D},E=function(D,b){var I,O=S(D),M=g(b);if(M!=="F")return O.index[M];for(I=O.first;I;I=I.next)if(I.key==b)return I};return s(T.prototype,{clear:function(){for(var D=S(this),b=D.index,I=D.first;I;)I.removed=!0,I.previous&&(I.previous=I.previous.next=void 0),delete b[I.index],I=I.next;D.first=D.last=void 0,h?D.size=0:this.size=0},delete:function(D){var b=S(this),I=E(this,D);if(I){var O=I.next,M=I.previous;delete b.index[I.index],I.removed=!0,M&&(M.next=O),O&&(O.previous=M),b.first==I&&(b.first=O),b.last==I&&(b.last=M),h?b.size--:this.size--}return!!I},forEach:function(D){for(var b,I=S(this),O=c(D,arguments.length>1?arguments[1]:void 0,3);b=b?b.next:I.first;)for(O(b.value,b.key,this);b&&b.removed;)b=b.previous},has:function(D){return!!E(this,D)}}),s(T.prototype,C?{get:function(D){var b=E(this,D);return b&&b.value},set:function(D,b){return _(this,D===0?0:D,b)}}:{add:function(D){return _(this,D=D===0?0:D,D)}}),h&&o(T.prototype,"size",{get:function(){return S(this).size}}),T},setStrong:function(v,y,C){var x=y+" Iterator",T=w(y),S=w(x);u(v,y,(function(_,E){m(this,{type:x,target:_,state:T(_),kind:E,last:void 0})}),(function(){for(var _=S(this),E=_.kind,D=_.last;D&&D.removed;)D=D.previous;return _.target&&(_.last=D=D?D.next:_.state.first)?E=="keys"?{value:D.key,done:!1}:E=="values"?{value:D.value,done:!1}:{value:[D.key,D.value],done:!1}:(_.target=void 0,{value:void 0,done:!0})}),C?"entries":"values",!C,!0),d(y)}}},function(r,n,i){var o,a=i(4),s=i(55).f,c=i(26),l=i(222),f=i(35),u=i(224),d=i(44),h="".endsWith,g=Math.min,p=u("endsWith");a({target:"String",proto:!0,forced:!!(d||p||(o=s(String.prototype,"endsWith"),!o||o.writable))&&!p},{endsWith:function(m){var w=String(f(this));l(m);var v=arguments.length>1?arguments[1]:void 0,y=c(w.length),C=v===void 0?y:g(c(v),y),x=String(m);return h?h.call(w,x,C):w.slice(C-x.length,C)===x}})},function(r,n,i){(function(o){var a=i(229),s=i(230),c=i(231);function l(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(G,P){if(l()<P)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(G=new Uint8Array(P)).__proto__=u.prototype:(G===null&&(G=new u(P)),G.length=P),G}function u(G,P,$){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(G,P,$);if(typeof G=="number"){if(typeof P=="string")throw new Error("If encoding is specified then the first argument must be a string");return g(this,G)}return d(this,G,P,$)}function d(G,P,$,W){if(typeof P=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&P instanceof ArrayBuffer?(function(q,Q,ee,ge){if(Q.byteLength,ee<0||Q.byteLength<ee)throw new RangeError("'offset' is out of bounds");if(Q.byteLength<ee+(ge||0))throw new RangeError("'length' is out of bounds");return Q=ee===void 0&&ge===void 0?new Uint8Array(Q):ge===void 0?new Uint8Array(Q,ee):new Uint8Array(Q,ee,ge),u.TYPED_ARRAY_SUPPORT?(q=Q).__proto__=u.prototype:q=p(q,Q),q})(G,P,$,W):typeof P=="string"?(function(q,Q,ee){if(typeof ee=="string"&&ee!==""||(ee="utf8"),!u.isEncoding(ee))throw new TypeError('"encoding" must be a valid string encoding');var ge=0|w(Q,ee),De=(q=f(q,ge)).write(Q,ee);return De!==ge&&(q=q.slice(0,De)),q})(G,P,$):(function(q,Q){if(u.isBuffer(Q)){var ee=0|m(Q.length);return(q=f(q,ee)).length===0||Q.copy(q,0,0,ee),q}if(Q){if(typeof ArrayBuffer<"u"&&Q.buffer instanceof ArrayBuffer||"length"in Q)return typeof Q.length!="number"||(ge=Q.length)!=ge?f(q,0):p(q,Q);if(Q.type==="Buffer"&&c(Q.data))return p(q,Q.data)}var ge;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")})(G,P)}function h(G){if(typeof G!="number")throw new TypeError('"size" argument must be a number');if(G<0)throw new RangeError('"size" argument must not be negative')}function g(G,P){if(h(P),G=f(G,P<0?0:0|m(P)),!u.TYPED_ARRAY_SUPPORT)for(var $=0;$<P;++$)G[$]=0;return G}function p(G,P){var $=P.length<0?0:0|m(P.length);G=f(G,$);for(var W=0;W<$;W+=1)G[W]=255&P[W];return G}function m(G){if(G>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|G}function w(G,P){if(u.isBuffer(G))return G.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(G)||G instanceof ArrayBuffer))return G.byteLength;typeof G!="string"&&(G=""+G);var $=G.length;if($===0)return 0;for(var W=!1;;)switch(P){case"ascii":case"latin1":case"binary":return $;case"utf8":case"utf-8":case void 0:return we(G).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*$;case"hex":return $>>>1;case"base64":return _e(G).length;default:if(W)return we(G).length;P=(""+P).toLowerCase(),W=!0}}function v(G,P,$){var W=!1;if((P===void 0||P<0)&&(P=0),P>this.length||(($===void 0||$>this.length)&&($=this.length),$<=0)||($>>>=0)<=(P>>>=0))return"";for(G||(G="utf8");;)switch(G){case"hex":return A(this,P,$);case"utf8":case"utf-8":return O(this,P,$);case"ascii":return M(this,P,$);case"latin1":case"binary":return R(this,P,$);case"base64":return I(this,P,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,P,$);default:if(W)throw new TypeError("Unknown encoding: "+G);G=(G+"").toLowerCase(),W=!0}}function y(G,P,$){var W=G[P];G[P]=G[$],G[$]=W}function C(G,P,$,W,q){if(G.length===0)return-1;if(typeof $=="string"?(W=$,$=0):$>2147483647?$=2147483647:$<-2147483648&&($=-2147483648),$=+$,isNaN($)&&($=q?0:G.length-1),$<0&&($=G.length+$),$>=G.length){if(q)return-1;$=G.length-1}else if($<0){if(!q)return-1;$=0}if(typeof P=="string"&&(P=u.from(P,W)),u.isBuffer(P))return P.length===0?-1:x(G,P,$,W,q);if(typeof P=="number")return P&=255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?q?Uint8Array.prototype.indexOf.call(G,P,$):Uint8Array.prototype.lastIndexOf.call(G,P,$):x(G,[P],$,W,q);throw new TypeError("val must be string, number or Buffer")}function x(G,P,$,W,q){var Q,ee=1,ge=G.length,De=P.length;if(W!==void 0&&((W=String(W).toLowerCase())==="ucs2"||W==="ucs-2"||W==="utf16le"||W==="utf-16le")){if(G.length<2||P.length<2)return-1;ee=2,ge/=2,De/=2,$/=2}function Ne(ve,le){return ee===1?ve[le]:ve.readUInt16BE(le*ee)}if(q){var We=-1;for(Q=$;Q<ge;Q++)if(Ne(G,Q)===Ne(P,We===-1?0:Q-We)){if(We===-1&&(We=Q),Q-We+1===De)return We*ee}else We!==-1&&(Q-=Q-We),We=-1}else for($+De>ge&&($=ge-De),Q=$;Q>=0;Q--){for(var re=!0,se=0;se<De;se++)if(Ne(G,Q+se)!==Ne(P,se)){re=!1;break}if(re)return Q}return-1}function T(G,P,$,W){$=Number($)||0;var q=G.length-$;W?(W=Number(W))>q&&(W=q):W=q;var Q=P.length;if(Q%2!=0)throw new TypeError("Invalid hex string");W>Q/2&&(W=Q/2);for(var ee=0;ee<W;++ee){var ge=parseInt(P.substr(2*ee,2),16);if(isNaN(ge))return ee;G[$+ee]=ge}return ee}function S(G,P,$,W){return Te(we(P,G.length-$),G,$,W)}function _(G,P,$,W){return Te((function(q){for(var Q=[],ee=0;ee<q.length;++ee)Q.push(255&q.charCodeAt(ee));return Q})(P),G,$,W)}function E(G,P,$,W){return _(G,P,$,W)}function D(G,P,$,W){return Te(_e(P),G,$,W)}function b(G,P,$,W){return Te((function(q,Q){for(var ee,ge,De,Ne=[],We=0;We<q.length&&!((Q-=2)<0);++We)ee=q.charCodeAt(We),ge=ee>>8,De=ee%256,Ne.push(De),Ne.push(ge);return Ne})(P,G.length-$),G,$,W)}function I(G,P,$){return P===0&&$===G.length?a.fromByteArray(G):a.fromByteArray(G.slice(P,$))}function O(G,P,$){$=Math.min(G.length,$);for(var W=[],q=P;q<$;){var Q,ee,ge,De,Ne=G[q],We=null,re=Ne>239?4:Ne>223?3:Ne>191?2:1;if(q+re<=$)switch(re){case 1:Ne<128&&(We=Ne);break;case 2:(192&(Q=G[q+1]))==128&&(De=(31&Ne)<<6|63&Q)>127&&(We=De);break;case 3:Q=G[q+1],ee=G[q+2],(192&Q)==128&&(192&ee)==128&&(De=(15&Ne)<<12|(63&Q)<<6|63&ee)>2047&&(De<55296||De>57343)&&(We=De);break;case 4:Q=G[q+1],ee=G[q+2],ge=G[q+3],(192&Q)==128&&(192&ee)==128&&(192&ge)==128&&(De=(15&Ne)<<18|(63&Q)<<12|(63&ee)<<6|63&ge)>65535&&De<1114112&&(We=De)}We===null?(We=65533,re=1):We>65535&&(We-=65536,W.push(We>>>10&1023|55296),We=56320|1023&We),W.push(We),q+=re}return(function(se){var ve=se.length;if(ve<=4096)return String.fromCharCode.apply(String,se);for(var le="",pe=0;pe<ve;)le+=String.fromCharCode.apply(String,se.slice(pe,pe+=4096));return le})(W)}n.Buffer=u,n.SlowBuffer=function(G){return+G!=G&&(G=0),u.alloc(+G)},n.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=o.TYPED_ARRAY_SUPPORT!==void 0?o.TYPED_ARRAY_SUPPORT:(function(){try{var G=new Uint8Array(1);return G.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},G.foo()===42&&typeof G.subarray=="function"&&G.subarray(1,1).byteLength===0}catch{return!1}})(),n.kMaxLength=l(),u.poolSize=8192,u._augment=function(G){return G.__proto__=u.prototype,G},u.from=function(G,P,$){return d(null,G,P,$)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(G,P,$){return(function(W,q,Q,ee){return h(q),q<=0?f(W,q):Q!==void 0?typeof ee=="string"?f(W,q).fill(Q,ee):f(W,q).fill(Q):f(W,q)})(null,G,P,$)},u.allocUnsafe=function(G){return g(null,G)},u.allocUnsafeSlow=function(G){return g(null,G)},u.isBuffer=function(G){return!(G==null||!G._isBuffer)},u.compare=function(G,P){if(!u.isBuffer(G)||!u.isBuffer(P))throw new TypeError("Arguments must be Buffers");if(G===P)return 0;for(var $=G.length,W=P.length,q=0,Q=Math.min($,W);q<Q;++q)if(G[q]!==P[q]){$=G[q],W=P[q];break}return $<W?-1:W<$?1:0},u.isEncoding=function(G){switch(String(G).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(G,P){if(!c(G))throw new TypeError('"list" argument must be an Array of Buffers');if(G.length===0)return u.alloc(0);var $;if(P===void 0)for(P=0,$=0;$<G.length;++$)P+=G[$].length;var W=u.allocUnsafe(P),q=0;for($=0;$<G.length;++$){var Q=G[$];if(!u.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(W,q),q+=Q.length}return W},u.byteLength=w,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var G=this.length;if(G%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var P=0;P<G;P+=2)y(this,P,P+1);return this},u.prototype.swap32=function(){var G=this.length;if(G%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var P=0;P<G;P+=4)y(this,P,P+3),y(this,P+1,P+2);return this},u.prototype.swap64=function(){var G=this.length;if(G%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var P=0;P<G;P+=8)y(this,P,P+7),y(this,P+1,P+6),y(this,P+2,P+5),y(this,P+3,P+4);return this},u.prototype.toString=function(){var G=0|this.length;return G===0?"":arguments.length===0?O(this,0,G):v.apply(this,arguments)},u.prototype.equals=function(G){if(!u.isBuffer(G))throw new TypeError("Argument must be a Buffer");return this===G||u.compare(this,G)===0},u.prototype.inspect=function(){var G="",P=n.INSPECT_MAX_BYTES;return this.length>0&&(G=this.toString("hex",0,P).match(/.{2}/g).join(" "),this.length>P&&(G+=" ... ")),"<Buffer "+G+">"},u.prototype.compare=function(G,P,$,W,q){if(!u.isBuffer(G))throw new TypeError("Argument must be a Buffer");if(P===void 0&&(P=0),$===void 0&&($=G?G.length:0),W===void 0&&(W=0),q===void 0&&(q=this.length),P<0||$>G.length||W<0||q>this.length)throw new RangeError("out of range index");if(W>=q&&P>=$)return 0;if(W>=q)return-1;if(P>=$)return 1;if(this===G)return 0;for(var Q=(q>>>=0)-(W>>>=0),ee=($>>>=0)-(P>>>=0),ge=Math.min(Q,ee),De=this.slice(W,q),Ne=G.slice(P,$),We=0;We<ge;++We)if(De[We]!==Ne[We]){Q=De[We],ee=Ne[We];break}return Q<ee?-1:ee<Q?1:0},u.prototype.includes=function(G,P,$){return this.indexOf(G,P,$)!==-1},u.prototype.indexOf=function(G,P,$){return C(this,G,P,$,!0)},u.prototype.lastIndexOf=function(G,P,$){return C(this,G,P,$,!1)},u.prototype.write=function(G,P,$,W){if(P===void 0)W="utf8",$=this.length,P=0;else if($===void 0&&typeof P=="string")W=P,$=this.length,P=0;else{if(!isFinite(P))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");P|=0,isFinite($)?($|=0,W===void 0&&(W="utf8")):(W=$,$=void 0)}var q=this.length-P;if(($===void 0||$>q)&&($=q),G.length>0&&($<0||P<0)||P>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var Q=!1;;)switch(W){case"hex":return T(this,G,P,$);case"utf8":case"utf-8":return S(this,G,P,$);case"ascii":return _(this,G,P,$);case"latin1":case"binary":return E(this,G,P,$);case"base64":return D(this,G,P,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,G,P,$);default:if(Q)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),Q=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function M(G,P,$){var W="";$=Math.min(G.length,$);for(var q=P;q<$;++q)W+=String.fromCharCode(127&G[q]);return W}function R(G,P,$){var W="";$=Math.min(G.length,$);for(var q=P;q<$;++q)W+=String.fromCharCode(G[q]);return W}function A(G,P,$){var W=G.length;(!P||P<0)&&(P=0),(!$||$<0||$>W)&&($=W);for(var q="",Q=P;Q<$;++Q)q+=de(G[Q]);return q}function B(G,P,$){for(var W=G.slice(P,$),q="",Q=0;Q<W.length;Q+=2)q+=String.fromCharCode(W[Q]+256*W[Q+1]);return q}function k(G,P,$){if(G%1!=0||G<0)throw new RangeError("offset is not uint");if(G+P>$)throw new RangeError("Trying to access beyond buffer length")}function L(G,P,$,W,q,Q){if(!u.isBuffer(G))throw new TypeError('"buffer" argument must be a Buffer instance');if(P>q||P<Q)throw new RangeError('"value" argument is out of bounds');if($+W>G.length)throw new RangeError("Index out of range")}function F(G,P,$,W){P<0&&(P=65535+P+1);for(var q=0,Q=Math.min(G.length-$,2);q<Q;++q)G[$+q]=(P&255<<8*(W?q:1-q))>>>8*(W?q:1-q)}function j(G,P,$,W){P<0&&(P=4294967295+P+1);for(var q=0,Q=Math.min(G.length-$,4);q<Q;++q)G[$+q]=P>>>8*(W?q:3-q)&255}function J(G,P,$,W,q,Q){if($+W>G.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("Index out of range")}function ie(G,P,$,W,q){return q||J(G,0,$,4),s.write(G,P,$,W,23,4),$+4}function fe(G,P,$,W,q){return q||J(G,0,$,8),s.write(G,P,$,W,52,8),$+8}u.prototype.slice=function(G,P){var $,W=this.length;if((G=~~G)<0?(G+=W)<0&&(G=0):G>W&&(G=W),(P=P===void 0?W:~~P)<0?(P+=W)<0&&(P=0):P>W&&(P=W),P<G&&(P=G),u.TYPED_ARRAY_SUPPORT)($=this.subarray(G,P)).__proto__=u.prototype;else{var q=P-G;$=new u(q,void 0);for(var Q=0;Q<q;++Q)$[Q]=this[Q+G]}return $},u.prototype.readUIntLE=function(G,P,$){G|=0,P|=0,$||k(G,P,this.length);for(var W=this[G],q=1,Q=0;++Q<P&&(q*=256);)W+=this[G+Q]*q;return W},u.prototype.readUIntBE=function(G,P,$){G|=0,P|=0,$||k(G,P,this.length);for(var W=this[G+--P],q=1;P>0&&(q*=256);)W+=this[G+--P]*q;return W},u.prototype.readUInt8=function(G,P){return P||k(G,1,this.length),this[G]},u.prototype.readUInt16LE=function(G,P){return P||k(G,2,this.length),this[G]|this[G+1]<<8},u.prototype.readUInt16BE=function(G,P){return P||k(G,2,this.length),this[G]<<8|this[G+1]},u.prototype.readUInt32LE=function(G,P){return P||k(G,4,this.length),(this[G]|this[G+1]<<8|this[G+2]<<16)+16777216*this[G+3]},u.prototype.readUInt32BE=function(G,P){return P||k(G,4,this.length),16777216*this[G]+(this[G+1]<<16|this[G+2]<<8|this[G+3])},u.prototype.readIntLE=function(G,P,$){G|=0,P|=0,$||k(G,P,this.length);for(var W=this[G],q=1,Q=0;++Q<P&&(q*=256);)W+=this[G+Q]*q;return W>=(q*=128)&&(W-=Math.pow(2,8*P)),W},u.prototype.readIntBE=function(G,P,$){G|=0,P|=0,$||k(G,P,this.length);for(var W=P,q=1,Q=this[G+--W];W>0&&(q*=256);)Q+=this[G+--W]*q;return Q>=(q*=128)&&(Q-=Math.pow(2,8*P)),Q},u.prototype.readInt8=function(G,P){return P||k(G,1,this.length),128&this[G]?-1*(255-this[G]+1):this[G]},u.prototype.readInt16LE=function(G,P){P||k(G,2,this.length);var $=this[G]|this[G+1]<<8;return 32768&$?4294901760|$:$},u.prototype.readInt16BE=function(G,P){P||k(G,2,this.length);var $=this[G+1]|this[G]<<8;return 32768&$?4294901760|$:$},u.prototype.readInt32LE=function(G,P){return P||k(G,4,this.length),this[G]|this[G+1]<<8|this[G+2]<<16|this[G+3]<<24},u.prototype.readInt32BE=function(G,P){return P||k(G,4,this.length),this[G]<<24|this[G+1]<<16|this[G+2]<<8|this[G+3]},u.prototype.readFloatLE=function(G,P){return P||k(G,4,this.length),s.read(this,G,!0,23,4)},u.prototype.readFloatBE=function(G,P){return P||k(G,4,this.length),s.read(this,G,!1,23,4)},u.prototype.readDoubleLE=function(G,P){return P||k(G,8,this.length),s.read(this,G,!0,52,8)},u.prototype.readDoubleBE=function(G,P){return P||k(G,8,this.length),s.read(this,G,!1,52,8)},u.prototype.writeUIntLE=function(G,P,$,W){G=+G,P|=0,$|=0,W||L(this,G,P,$,Math.pow(2,8*$)-1,0);var q=1,Q=0;for(this[P]=255&G;++Q<$&&(q*=256);)this[P+Q]=G/q&255;return P+$},u.prototype.writeUIntBE=function(G,P,$,W){G=+G,P|=0,$|=0,W||L(this,G,P,$,Math.pow(2,8*$)-1,0);var q=$-1,Q=1;for(this[P+q]=255&G;--q>=0&&(Q*=256);)this[P+q]=G/Q&255;return P+$},u.prototype.writeUInt8=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,1,255,0),u.TYPED_ARRAY_SUPPORT||(G=Math.floor(G)),this[P]=255&G,P+1},u.prototype.writeUInt16LE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[P]=255&G,this[P+1]=G>>>8):F(this,G,P,!0),P+2},u.prototype.writeUInt16BE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[P]=G>>>8,this[P+1]=255&G):F(this,G,P,!1),P+2},u.prototype.writeUInt32LE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[P+3]=G>>>24,this[P+2]=G>>>16,this[P+1]=G>>>8,this[P]=255&G):j(this,G,P,!0),P+4},u.prototype.writeUInt32BE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[P]=G>>>24,this[P+1]=G>>>16,this[P+2]=G>>>8,this[P+3]=255&G):j(this,G,P,!1),P+4},u.prototype.writeIntLE=function(G,P,$,W){if(G=+G,P|=0,!W){var q=Math.pow(2,8*$-1);L(this,G,P,$,q-1,-q)}var Q=0,ee=1,ge=0;for(this[P]=255&G;++Q<$&&(ee*=256);)G<0&&ge===0&&this[P+Q-1]!==0&&(ge=1),this[P+Q]=(G/ee>>0)-ge&255;return P+$},u.prototype.writeIntBE=function(G,P,$,W){if(G=+G,P|=0,!W){var q=Math.pow(2,8*$-1);L(this,G,P,$,q-1,-q)}var Q=$-1,ee=1,ge=0;for(this[P+Q]=255&G;--Q>=0&&(ee*=256);)G<0&&ge===0&&this[P+Q+1]!==0&&(ge=1),this[P+Q]=(G/ee>>0)-ge&255;return P+$},u.prototype.writeInt8=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,1,127,-128),u.TYPED_ARRAY_SUPPORT||(G=Math.floor(G)),G<0&&(G=255+G+1),this[P]=255&G,P+1},u.prototype.writeInt16LE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[P]=255&G,this[P+1]=G>>>8):F(this,G,P,!0),P+2},u.prototype.writeInt16BE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[P]=G>>>8,this[P+1]=255&G):F(this,G,P,!1),P+2},u.prototype.writeInt32LE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[P]=255&G,this[P+1]=G>>>8,this[P+2]=G>>>16,this[P+3]=G>>>24):j(this,G,P,!0),P+4},u.prototype.writeInt32BE=function(G,P,$){return G=+G,P|=0,$||L(this,G,P,4,2147483647,-2147483648),G<0&&(G=4294967295+G+1),u.TYPED_ARRAY_SUPPORT?(this[P]=G>>>24,this[P+1]=G>>>16,this[P+2]=G>>>8,this[P+3]=255&G):j(this,G,P,!1),P+4},u.prototype.writeFloatLE=function(G,P,$){return ie(this,G,P,!0,$)},u.prototype.writeFloatBE=function(G,P,$){return ie(this,G,P,!1,$)},u.prototype.writeDoubleLE=function(G,P,$){return fe(this,G,P,!0,$)},u.prototype.writeDoubleBE=function(G,P,$){return fe(this,G,P,!1,$)},u.prototype.copy=function(G,P,$,W){if($||($=0),W||W===0||(W=this.length),P>=G.length&&(P=G.length),P||(P=0),W>0&&W<$&&(W=$),W===$||G.length===0||this.length===0)return 0;if(P<0)throw new RangeError("targetStart out of bounds");if($<0||$>=this.length)throw new RangeError("sourceStart out of bounds");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),G.length-P<W-$&&(W=G.length-P+$);var q,Q=W-$;if(this===G&&$<P&&P<W)for(q=Q-1;q>=0;--q)G[q+P]=this[q+$];else if(Q<1e3||!u.TYPED_ARRAY_SUPPORT)for(q=0;q<Q;++q)G[q+P]=this[q+$];else Uint8Array.prototype.set.call(G,this.subarray($,$+Q),P);return Q},u.prototype.fill=function(G,P,$,W){if(typeof G=="string"){if(typeof P=="string"?(W=P,P=0,$=this.length):typeof $=="string"&&(W=$,$=this.length),G.length===1){var q=G.charCodeAt(0);q<256&&(G=q)}if(W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!u.isEncoding(W))throw new TypeError("Unknown encoding: "+W)}else typeof G=="number"&&(G&=255);if(P<0||this.length<P||this.length<$)throw new RangeError("Out of range index");if($<=P)return this;var Q;if(P>>>=0,$=$===void 0?this.length:$>>>0,G||(G=0),typeof G=="number")for(Q=P;Q<$;++Q)this[Q]=G;else{var ee=u.isBuffer(G)?G:we(new u(G,W).toString()),ge=ee.length;for(Q=0;Q<$-P;++Q)this[Q+P]=ee[Q%ge]}return this};var ae=/[^+\/0-9A-Za-z-_]/g;function de(G){return G<16?"0"+G.toString(16):G.toString(16)}function we(G,P){var $;P=P||1/0;for(var W=G.length,q=null,Q=[],ee=0;ee<W;++ee){if(($=G.charCodeAt(ee))>55295&&$<57344){if(!q){if($>56319){(P-=3)>-1&&Q.push(239,191,189);continue}if(ee+1===W){(P-=3)>-1&&Q.push(239,191,189);continue}q=$;continue}if($<56320){(P-=3)>-1&&Q.push(239,191,189),q=$;continue}$=65536+(q-55296<<10|$-56320)}else q&&(P-=3)>-1&&Q.push(239,191,189);if(q=null,$<128){if((P-=1)<0)break;Q.push($)}else if($<2048){if((P-=2)<0)break;Q.push($>>6|192,63&$|128)}else if($<65536){if((P-=3)<0)break;Q.push($>>12|224,$>>6&63|128,63&$|128)}else{if(!($<1114112))throw new Error("Invalid code point");if((P-=4)<0)break;Q.push($>>18|240,$>>12&63|128,$>>6&63|128,63&$|128)}}return Q}function _e(G){return a.toByteArray((function(P){if((P=(function($){return $.trim?$.trim():$.replace(/^\s+|\s+$/g,"")})(P).replace(ae,"")).length<2)return"";for(;P.length%4!=0;)P+="=";return P})(G))}function Te(G,P,$,W){for(var q=0;q<W&&!(q+$>=P.length||q>=G.length);++q)P[q+$]=G[q];return q}}).call(this,i(78))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.isASCIIByte=function(o){return o>=0&&o<=127}},function(r,n,i){var o=this&&this.__read||function(s,c){var l=typeof Symbol=="function"&&s[Symbol.iterator];if(!l)return s;var f,u,d=l.call(s),h=[];try{for(;(c===void 0||c-- >0)&&!(f=d.next()).done;)h.push(f.value)}catch(g){u={error:g}}finally{try{f&&!f.done&&(l=d.return)&&l.call(d)}finally{if(u)throw u.error}}return h},a=this&&this.__spread||function(){for(var s=[],c=0;c<arguments.length;c++)s=s.concat(o(arguments[c]));return s};Object.defineProperty(n,"__esModule",{value:!0}),n.length=function(s){return s.length},n.byteLowercase=function(s){for(var c=0;c<s.length;c++){var l=s[c];l>=65&&l<=90&&(s[c]=l+32)}},n.byteUppercase=function(s){for(var c=0;c<s.length;c++){var l=s[c];l>=97&&l<=122&&(s[c]=l-32)}},n.byteCaseInsensitiveMatch=function(s,c){if(s.length!==c.length)return!1;for(var l=0;l<s.length;l++){var f=s[l],u=c[l];if(f>=65&&f<=90&&(f+=32),u>=65&&u<=90&&(u+=32),f!==u)return!1}return!0},n.startsWith=function(s,c){for(var l=0;;){if(l>=s.length)return!1;if(l>=c.length)return!0;if(s[l]!==c[l])return!1;l++}},n.byteLessThan=function(s,c){for(var l=0;;){if(l>=s.length)return!1;if(l>=c.length)return!0;var f=s[l],u=c[l];if(f<u)return!0;if(f>u)return!1;l++}},n.isomorphicDecode=function(s){return String.fromCodePoint.apply(String,a(s))}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(7),s=i(0),c=i(12),l=(function(){function f(u){this._associatedDocument=u||o.dom.window.document}return f.prototype.createDocumentType=function(u,d,h){return s.namespace_validate(u),s.create_documentType(this._associatedDocument,u,d,h)},f.prototype.createDocument=function(u,d,h){h===void 0&&(h=null);var g=s.create_xmlDocument(),p=null;return d&&(p=s.document_internalCreateElementNS(g,u,d)),h&&g.appendChild(h),p&&g.appendChild(p),g._origin=this._associatedDocument._origin,u===a.namespace.HTML?g._contentType="application/xhtml+xml":u===a.namespace.SVG?g._contentType="image/svg+xml":g._contentType="application/xml",g},f.prototype.createHTMLDocument=function(u){var d=s.create_document();d._type="html",d._contentType="text/html",d.appendChild(s.create_documentType(d,"html","",""));var h=s.element_createAnElement(d,"html",a.namespace.HTML);d.appendChild(h);var g=s.element_createAnElement(d,"head",a.namespace.HTML);if(h.appendChild(g),u!==void 0){var p=s.element_createAnElement(d,"title",a.namespace.HTML);g.appendChild(p);var m=s.create_text(d,u);p.appendChild(m)}var w=s.element_createAnElement(d,"body",a.namespace.HTML);return h.appendChild(w),d._origin=this._associatedDocument._origin,d},f.prototype.hasFeature=function(){return!0},f._create=function(u){return new f(u)},f})();n.DOMImplementationImpl=l,c.idl_defineConst(l.prototype,"_ID","@oozcitak/dom")},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(70),c=i(1),l=i(0),f=(function(u){function d(){var h=u.call(this)||this;return h._signalSlots=new Set,h._mutationObserverMicrotaskQueued=!1,h._mutationObservers=new Set,h._iteratorList=new c.FixedSizeSet,h._associatedDocument=l.create_document(),h}return a(d,u),Object.defineProperty(d.prototype,"document",{get:function(){return this._associatedDocument},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"event",{get:function(){return this._currentEvent},enumerable:!0,configurable:!0}),d._create=function(){return new d},d})(s.EventTargetImpl);n.WindowImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=(function(){function s(){}return s.isNode=function(c){return!!c&&c._nodeType!==void 0},s.isDocumentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Document},s.isDocumentTypeNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.DocumentType},s.isDocumentFragmentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.DocumentFragment},s.isAttrNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Attribute},s.isCharacterDataNode=function(c){if(!s.isNode(c))return!1;var l=c._nodeType;return l===o.NodeType.Text||l===o.NodeType.ProcessingInstruction||l===o.NodeType.Comment||l===o.NodeType.CData},s.isTextNode=function(c){return s.isNode(c)&&(c._nodeType===o.NodeType.Text||c._nodeType===o.NodeType.CData)},s.isExclusiveTextNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Text},s.isCDATASectionNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.CData},s.isCommentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Comment},s.isProcessingInstructionNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.ProcessingInstruction},s.isElementNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Element},s.isCustomElementNode=function(c){return s.isElementNode(c)&&c._customElementState==="custom"},s.isShadowRoot=function(c){return!!c&&c.host!==void 0},s.isMouseEvent=function(c){return!!c&&c.screenX!==void 0&&c.screenY!=null},s.isSlotable=function(c){return!!c&&c._name!==void 0&&c._assignedSlot!==void 0&&(s.isTextNode(c)||s.isElementNode(c))},s.isSlot=function(c){return!!c&&c._name!==void 0&&c._assignedNodes!==void 0&&s.isElementNode(c)},s.isWindow=function(c){return!!c&&c.navigator!==void 0},s.isEventListener=function(c){return!!c&&c.handleEvent!==void 0},s.isRegisteredObserver=function(c){return!!c&&c.observer!==void 0&&c.options!==void 0},s.isTransientRegisteredObserver=function(c){return!!c&&c.source!==void 0&&s.isRegisteredObserver(c)},s})();n.Guard=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(){return c.call(this)||this}return a(l,c),l})(i(98).DocumentImpl);n.XMLDocumentImpl=s},function(r,n,i){var o=this&&this.__values||function(W){var q=typeof Symbol=="function"&&Symbol.iterator,Q=q&&W[q],ee=0;if(Q)return Q.call(W);if(W&&typeof W.length=="number")return{next:function(){return W&&ee>=W.length&&(W=void 0),{value:W&&W[ee++],done:!W}}};throw new TypeError(q?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(W,q){var Q=typeof Symbol=="function"&&W[Symbol.iterator];if(!Q)return W;var ee,ge,De=Q.call(W),Ne=[];try{for(;(q===void 0||q-- >0)&&!(ee=De.next()).done;)Ne.push(ee.value)}catch(We){ge={error:We}}finally{try{ee&&!ee.done&&(Q=De.return)&&Q.call(De)}finally{if(ge)throw ge.error}}return Ne};Object.defineProperty(n,"__esModule",{value:!0});var s,c=i(1),l=i(243),f=i(7),u=i(244),d={ftp:21,file:null,http:80,https:443,ws:80,wss:443},h=/[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,g=/[ "<>`]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,p=/[ "<>`#?{}]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,m=/[ "<>`#?{}/:;=@\[\]\\\^\|]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,w=/[0-9A-Za-z!\$&-\/:;=\?@_~\xA0-\uD7FF\uE000-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uD83E\uD840-\uD87E\uD880-\uD8BE\uD8C0-\uD8FE\uD900-\uD93E\uD940-\uD97E\uD980-\uD9BE\uD9C0-\uD9FE\uDA00-\uDA3E\uDA40-\uDA7E\uDA80-\uDABE\uDAC0-\uDAFE\uDB00-\uDB3E\uDB40-\uDB7E\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDC00-\uDFFD]/,v=/[\0\t\f\r #%/:?@\[\\\]]/;function y(W){s!==void 0&&s.call(null,"Validation Error: "+W)}function C(){return{scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null}}function x(W){return W in d}function T(W){return x(W.scheme)}function S(W){return d[W]||null}function _(W){return W.username!==""||W.password!==""}function E(W,q){var Q,ee;q===void 0&&(q=!1);var ge=W.scheme+":";if(W.host!==null?(ge+="//",_(W)&&(ge+=W.username,W.password!==""&&(ge+=":"+W.password),ge+="@"),ge+=D(W.host),W.port!==null&&(ge+=":"+W.port)):W.host===null&&W.scheme==="file"&&(ge+="//"),W._cannotBeABaseURLFlag)ge+=W.path[0];else try{for(var De=o(W.path),Ne=De.next();!Ne.done;Ne=De.next())ge+="/"+Ne.value}catch(We){Q={error:We}}finally{try{Ne&&!Ne.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}return W.query!==null&&(ge+="?"+W.query),q||W.fragment===null||(ge+="#"+W.fragment),ge}function D(W){return c.isNumber(W)?b(W):c.isArray(W)?"["+I(W)+"]":W}function b(W){for(var q="",Q=W,ee=1;ee<=4;ee++)q=(Q%256).toString()+q,ee!==4&&(q="."+q),Q=Math.floor(Q/256);return q}function I(W){for(var q="",Q=null,ee=-1,ge=0,De=0,Ne=0;Ne<8;Ne++)if(W[Ne]===0){ge=1;for(var We=Ne+1;We<8&&W[We]===0;We++)ge++;ge>De&&(De=ge,ee=Ne)}De>1&&(Q=ee);for(var re=!1,se=0;se<8;se++)re&&W[se]===0||(re&&(re=!1),Q!==se?(q+=W[se].toString(16),se!==7&&(q+=":")):(q+=se===0?"::":":",re=!0));return q}function O(W,q,Q,ee,ge){var De,Ne,We,re;if(ee===void 0){ee={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null};var se=/^[\u0000-\u001F\u0020]+/,ve=/[\u0000-\u001F\u0020]+$/;(se.test(W)||ve.test(W))&&y("Input string contains leading or trailing control characters or space."),W=(W=W.replace(se,"")).replace(ve,"")}var le=/[\u0009\u000A\u000D]/g;le.test(W)&&y("Input string contains tab or newline characters."),W=W.replace(le,"");var pe=ge===void 0?l.ParserState.SchemeStart:ge;q===void 0&&(q=null);for(var $e=Q===void 0||Q==="replacement"||Q==="UTF-16BE"||Q==="UTF-16LE"?"UTF-8":Q,oe="",st=!1,gt=!1,ct=!1,Ee=new c.StringWalker(W);;){switch(pe){case l.ParserState.SchemeStart:if(f.codePoint.ASCIIAlpha.test(Ee.c()))oe+=Ee.c().toLowerCase(),pe=l.ParserState.Scheme;else{if(ge!==void 0)return y("Invalid scheme start character."),null;pe=l.ParserState.NoScheme,Ee.pointer--}break;case l.ParserState.Scheme:if(f.codePoint.ASCIIAlphanumeric.test(Ee.c())||Ee.c()==="+"||Ee.c()==="-"||Ee.c()===".")oe+=Ee.c().toLowerCase();else{if(Ee.c()!==":"){if(ge===void 0){oe="",pe=l.ParserState.NoScheme,Ee.pointer=0;continue}return y("Invalid input string."),null}if(ge!==void 0&&(x(ee.scheme)&&!x(oe)||!x(ee.scheme)&&x(oe)||(_(ee)||ee.port!==null)&&oe==="file"||ee.scheme==="file"&&(ee.host===""||ee.host===null)))return ee;if(ee.scheme=oe,ge!==void 0)return ee.port===S(ee.scheme)&&(ee.port=null),ee;oe="",ee.scheme==="file"?(Ee.remaining().startsWith("//")||y("Invalid file URL scheme, '//' expected."),pe=l.ParserState.File):T(ee)&&q!==null&&q.scheme===ee.scheme?pe=l.ParserState.SpecialRelativeOrAuthority:T(ee)?pe=l.ParserState.SpecialAuthoritySlashes:Ee.remaining().startsWith("/")?(pe=l.ParserState.PathOrAuthority,Ee.pointer++):(ee._cannotBeABaseURLFlag=!0,ee.path.push(""),pe=l.ParserState.CannotBeABaseURLPath)}break;case l.ParserState.NoScheme:if(q===null||q._cannotBeABaseURLFlag&&Ee.c()!=="#")return y("Invalid input string."),null;q._cannotBeABaseURLFlag&&Ee.c()==="#"?(ee.scheme=q.scheme,ee.path=f.list.clone(q.path),ee.query=q.query,ee.fragment="",ee._cannotBeABaseURLFlag=!0,pe=l.ParserState.Fragment):q.scheme!=="file"?(pe=l.ParserState.Relative,Ee.pointer--):(pe=l.ParserState.File,Ee.pointer--);break;case l.ParserState.SpecialRelativeOrAuthority:Ee.c()==="/"&&Ee.remaining().startsWith("/")?(pe=l.ParserState.SpecialAuthorityIgnoreSlashes,Ee.pointer++):(y("Invalid input string."),pe=l.ParserState.Relative,Ee.pointer--);break;case l.ParserState.PathOrAuthority:Ee.c()==="/"?pe=l.ParserState.Authority:(pe=l.ParserState.Path,Ee.pointer--);break;case l.ParserState.Relative:if(q===null)throw new Error("Invalid parser state. Base URL is null.");switch(ee.scheme=q.scheme,Ee.c()){case"":ee.username=q.username,ee.password=q.password,ee.host=q.host,ee.port=q.port,ee.path=f.list.clone(q.path),ee.query=q.query;break;case"/":pe=l.ParserState.RelativeSlash;break;case"?":ee.username=q.username,ee.password=q.password,ee.host=q.host,ee.port=q.port,ee.path=f.list.clone(q.path),ee.query="",pe=l.ParserState.Query;break;case"#":ee.username=q.username,ee.password=q.password,ee.host=q.host,ee.port=q.port,ee.path=f.list.clone(q.path),ee.query=q.query,ee.fragment="",pe=l.ParserState.Fragment;break;default:T(ee)&&Ee.c()==="\\"?(y("Invalid input string."),pe=l.ParserState.RelativeSlash):(ee.username=q.username,ee.password=q.password,ee.host=q.host,ee.port=q.port,ee.path=f.list.clone(q.path),ee.path.length!==0&&ee.path.splice(ee.path.length-1,1),pe=l.ParserState.Path,Ee.pointer--)}break;case l.ParserState.RelativeSlash:if(!T(ee)||Ee.c()!=="/"&&Ee.c()!=="\\")if(Ee.c()==="/")pe=l.ParserState.Authority;else{if(q===null)throw new Error("Invalid parser state. Base URL is null.");ee.username=q.username,ee.password=q.password,ee.host=q.host,ee.port=q.port,pe=l.ParserState.Path,Ee.pointer--}else Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.SpecialAuthorityIgnoreSlashes;break;case l.ParserState.SpecialAuthoritySlashes:Ee.c()==="/"&&Ee.remaining().startsWith("/")?(pe=l.ParserState.SpecialAuthorityIgnoreSlashes,Ee.pointer++):(y("Expected '//'."),pe=l.ParserState.SpecialAuthorityIgnoreSlashes,Ee.pointer--);break;case l.ParserState.SpecialAuthorityIgnoreSlashes:Ee.c()!=="/"&&Ee.c()!=="\\"?(pe=l.ParserState.Authority,Ee.pointer--):y("Unexpected '/' or '\\'.");break;case l.ParserState.Authority:if(Ee.c()==="@"){y("Unexpected '@'."),st&&(oe="%40"+oe),st=!0;try{for(var ze=(De=void 0,o(oe)),qe=ze.next();!qe.done;qe=ze.next()){var Je=qe.value;if(Je!==":"||ct){var lt=Te(Je,m);ct?ee.password+=lt:ee.username+=lt}else ct=!0}}catch(sn){De={error:sn}}finally{try{qe&&!qe.done&&(Ne=ze.return)&&Ne.call(ze)}finally{if(De)throw De.error}}oe=""}else if(Ee.c()===""||Ee.c()==="/"||Ee.c()==="?"||Ee.c()==="#"||T(ee)&&Ee.c()==="\\"){if(st&&oe==="")return y("Invalid input string."),null;Ee.pointer-=oe.length+1,oe="",pe=l.ParserState.Host}else oe+=Ee.c();break;case l.ParserState.Host:case l.ParserState.Hostname:if(ge!==void 0&&ee.scheme==="file")Ee.pointer--,pe=l.ParserState.FileHost;else if(Ee.c()!==":"||gt)if(Ee.c()===""||Ee.c()==="/"||Ee.c()==="?"||Ee.c()==="#"||T(ee)&&Ee.c()==="\\"){if(Ee.pointer--,T(ee)&&oe==="")return y("Invalid input string."),null;if(ge!==void 0&&oe===""&&(_(ee)||ee.port!==null))return y("Invalid input string."),ee;if((Fe=F(oe,!T(ee)))===null)return null;if(ee.host=Fe,oe="",pe=l.ParserState.PathStart,ge!==void 0)return ee}else Ee.c()==="["&&(gt=!0),Ee.c()==="]"&&(gt=!1),oe+=Ee.c();else{if(oe==="")return y("Invalid input string."),null;if((Fe=F(oe,!T(ee)))===null)return null;if(ee.host=Fe,oe="",pe=l.ParserState.Port,ge===l.ParserState.Hostname)return ee}break;case l.ParserState.Port:if(f.codePoint.ASCIIDigit.test(Ee.c()))oe+=Ee.c();else{if(!(Ee.c()===""||Ee.c()==="/"||Ee.c()==="?"||Ee.c()==="#"||T(ee)&&Ee.c()==="\\"||ge))return y("Invalid input string."),null;if(oe!==""&&oe!==""){var Pe=parseInt(oe,10);if(Pe>Math.pow(2,16)-1)return y("Invalid port number."),null;ee.port=Pe===S(ee.scheme)?null:Pe,oe=""}if(ge!==void 0)return ee;pe=l.ParserState.PathStart,Ee.pointer--}break;case l.ParserState.File:if(ee.scheme="file",Ee.c()==="/"||Ee.c()==="\\")Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.FileSlash;else if(q!==null&&q.scheme==="file")switch(Ee.c()){case"":ee.host=q.host,ee.path=f.list.clone(q.path),ee.query=q.query;break;case"?":ee.host=q.host,ee.path=f.list.clone(q.path),ee.query="",pe=l.ParserState.Query;break;case"#":ee.host=q.host,ee.path=f.list.clone(q.path),ee.query=q.query,ee.fragment="",pe=l.ParserState.Fragment;break;default:L(Ee.substring())?y("Unexpected windows drive letter in input string."):(ee.host=q.host,ee.path=f.list.clone(q.path),A(ee)),pe=l.ParserState.Path,Ee.pointer--}else pe=l.ParserState.Path,Ee.pointer--;break;case l.ParserState.FileSlash:Ee.c()==="/"||Ee.c()==="\\"?(Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.FileHost):(q===null||q.scheme!=="file"||L(Ee.substring())||(B(q.path[0])?ee.path.push(q.path[0]):ee.host=q.host),pe=l.ParserState.Path,Ee.pointer--);break;case l.ParserState.FileHost:if(Ee.c()===""||Ee.c()==="/"||Ee.c()==="\\"||Ee.c()==="?"||Ee.c()==="#")if(Ee.pointer--,ge===void 0&&k(oe))y("Unexpected windows drive letter in input string."),pe=l.ParserState.Path;else if(oe===""){if(ee.host="",ge!==void 0)return ee;pe=l.ParserState.PathStart}else{var Fe;if((Fe=F(oe,!T(ee)))===null)return null;if(Fe==="localhost"&&(Fe=""),ee.host=Fe,ge!==void 0)return ee;oe="",pe=l.ParserState.PathStart}else oe+=Ee.c();break;case l.ParserState.PathStart:T(ee)?(Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.Path,Ee.c()!=="/"&&Ee.c()!=="\\"&&Ee.pointer--):ge===void 0&&Ee.c()==="?"?(ee.query="",pe=l.ParserState.Query):ge===void 0&&Ee.c()==="#"?(ee.fragment="",pe=l.ParserState.Fragment):Ee.c()!==""&&(pe=l.ParserState.Path,Ee.c()!=="/"&&Ee.pointer--);break;case l.ParserState.Path:if(Ee.c()===""||Ee.c()==="/"||T(ee)&&Ee.c()==="\\"||ge===void 0&&(Ee.c()==="?"||Ee.c()==="#")){if(T(ee)&&Ee.c()==="\\"&&y("Invalid input string."),R(oe))A(ee),Ee.c()==="/"||T(ee)&&Ee.c()==="\\"||ee.path.push("");else if(!M(oe)||Ee.c()==="/"||T(ee)&&Ee.c()==="\\"){if(!M(oe)){if(ee.scheme==="file"&&ee.path.length===0&&k(oe)){ee.host!==null&&ee.host!==""&&(y("Invalid input string."),ee.host="");var nt=Array.from(oe);oe=nt.slice(0,1)+":"+nt.slice(2)}ee.path.push(oe)}}else ee.path.push("");if(oe="",ee.scheme==="file"&&(Ee.c()===""||Ee.c()==="?"||Ee.c()==="#"))for(;ee.path.length>1&&ee.path[0]==="";)y("Invalid input string."),ee.path.splice(0,1);Ee.c()==="?"&&(ee.query="",pe=l.ParserState.Query),Ee.c()==="#"&&(ee.fragment="",pe=l.ParserState.Fragment)}else w.test(Ee.c())||Ee.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Ee.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Ee.remaining())||y("Percent encoded character must be followed by two hex digits."),oe+=Te(Ee.c(),p);break;case l.ParserState.CannotBeABaseURLPath:Ee.c()==="?"?(ee.query="",pe=l.ParserState.Query):Ee.c()==="#"?(ee.fragment="",pe=l.ParserState.Fragment):(Ee.c()===""||w.test(Ee.c())||Ee.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Ee.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Ee.remaining())||y("Percent encoded character must be followed by two hex digits."),Ee.c()!==""&&(ee.path[0]+=Te(Ee.c(),h)));break;case l.ParserState.Query:if($e==="UTF-8"||T(ee)&&ee.scheme!=="ws"&&ee.scheme!=="wss"||($e="UTF-8"),ge===void 0&&Ee.c()==="#")ee.fragment="",pe=l.ParserState.Fragment;else if(Ee.c()!==""){if(w.test(Ee.c())||Ee.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Ee.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Ee.remaining())||y("Percent encoded character must be followed by two hex digits."),$e.toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var wt=c.utf8Encode(Ee.c());if(wt.length>=3&&wt[0]===38&&wt[1]===35&&wt[wt.length-1]===59)wt=wt.subarray(2,wt.length-1),ee.query+="%26%23"+f.byteSequence.isomorphicDecode(wt)+"%3B";else try{for(var yn=(We=void 0,o(wt)),bn=yn.next();!bn.done;bn=yn.next()){var fn=bn.value;fn<33||fn>126||fn===34||fn===35||fn===60||fn===62||fn===39&&T(ee)?ee.query+=de(fn):ee.query+=String.fromCharCode(fn)}}catch(sn){We={error:sn}}finally{try{bn&&!bn.done&&(re=yn.return)&&re.call(yn)}finally{if(We)throw We.error}}}break;case l.ParserState.Fragment:Ee.c()===""||(Ee.c()==="\0"?y("NULL character in input string."):(w.test(Ee.c())||Ee.c()==="%"||y("Unexpected character in fragment string."),Ee.c()!=="%"||/^[A-Za-z0-9][A-Za-z0-9]/.test(Ee.remaining())||y("Unexpected character in fragment string."),ee.fragment+=Te(Ee.c(),g)))}if(Ee.eof)break;Ee.pointer++}return ee}function M(W){return W==="."||W.toLowerCase()==="%2e"}function R(W){var q=W.toLowerCase();return q===".."||q===".%2e"||q==="%2e."||q==="%2e%2e"}function A(W){var q=W.path;q.length!==0&&(W.scheme==="file"&&q.length===1&&B(q[0])||W.path.splice(W.path.length-1,1))}function B(W){return W.length>=2&&f.codePoint.ASCIIAlpha.test(W[0])&&W[1]===":"}function k(W){return W.length>=2&&f.codePoint.ASCIIAlpha.test(W[0])&&(W[1]===":"||W[1]==="|")}function L(W){return W.length>=2&&k(W)&&(W.length===2||W[2]==="/"||W[2]==="\\"||W[2]==="?"||W[2]==="#")}function F(W,q){if(q===void 0&&(q=!1),W.startsWith("["))return W.endsWith("]")?ie(W.substring(1,W.length-1)):(y("Expected ']' after '['."),null);if(q)return fe(W);var Q=$(c.utf8Decode(_e(W)));if(Q===null||v.test(Q))return y("Invalid domain."),null;var ee=J(Q);return ee===null||c.isNumber(ee)?ee:Q}function j(W,q){q===void 0&&(q={value:!1});var Q=10;return W.startsWith("0x")||W.startsWith("0X")?(q.value=!0,W=W.substr(2),Q=16):W.length>=2&&W[0]==="0"&&(q.value=!0,W=W.substr(1),Q=8),W===""?0:(Q===10?/^[0-9]+$/:Q===16?/^[0-9A-Fa-f]+$/:/^[0-7]+$/).test(W)?parseInt(W,Q):null}function J(W){var q,Q,ee,ge,De={value:!1},Ne=W.split(".");if(Ne[Ne.length-1]===""&&(De.value=!0,Ne.length>1&&Ne.pop()),Ne.length>4)return W;var We=[];try{for(var re=o(Ne),se=re.next();!se.done;se=re.next()){var ve=se.value;if(ve===""||(gt=j(ve,De))===null)return W;We.push(gt)}}catch(ct){q={error:ct}}finally{try{se&&!se.done&&(Q=re.return)&&Q.call(re)}finally{if(q)throw q.error}}De.value&&y("Invalid IP v4 address.");for(var le=0;le<We.length;le++)if(We[le]>255&&(y("Invalid IP v4 address."),le<We.length-1))return null;if(We[We.length-1]>=Math.pow(256,5-We.length))return y("Invalid IP v4 address."),null;var pe=We[We.length-1];We.pop();var $e=0;try{for(var oe=o(We),st=oe.next();!st.done;st=oe.next()){var gt;pe+=(gt=st.value)*Math.pow(256,3-$e),$e++}}catch(ct){ee={error:ct}}finally{try{st&&!st.done&&(ge=oe.return)&&ge.call(oe)}finally{if(ee)throw ee.error}}return pe}function ie(W){var q,Q=[0,0,0,0,0,0,0,0],ee=0,ge=null,De=new c.StringWalker(W);if(De.c()===":"){if(!De.remaining().startsWith(":"))return y("Invalid IP v6 address."),null;De.pointer+=2,ge=ee+=1}for(;De.c()!=="";){if(ee===8)return y("Invalid IP v6 address."),null;if(De.c()!==":"){for(var Ne=0,We=0;We<4&&f.codePoint.ASCIIHexDigit.test(De.c());)Ne=16*Ne+parseInt(De.c(),16),De.pointer++,We++;if(De.c()==="."){if(We===0||(De.pointer-=We,ee>6))return y("Invalid IP v6 address."),null;for(var re=0;De.c()!=="";){var se=null;if(re>0){if(!(De.c()==="."&&re<4))return y("Invalid IP v6 address."),null;De.pointer++}if(!f.codePoint.ASCIIDigit.test(De.c()))return y("Invalid IP v6 address."),null;for(;f.codePoint.ASCIIDigit.test(De.c());){var ve=parseInt(De.c(),10);if(se===null)se=ve;else{if(se===0)return y("Invalid IP v6 address."),null;se=10*se+ve}if(se>255)return y("Invalid IP v6 address."),null;De.pointer++}if(se===null)return y("Invalid IP v6 address."),null;Q[ee]=256*Q[ee]+se,++re!==2&&re!==4||ee++}if(re!==4)return y("Invalid IP v6 address."),null;break}if(De.c()===":"){if(De.pointer++,De.c()==="")return y("Invalid IP v6 address."),null}else if(De.c()!=="")return y("Invalid IP v6 address."),null;Q[ee]=Ne,ee++}else{if(ge!==null)return y("Invalid IP v6 address."),null;De.pointer++,ge=++ee}}if(ge!==null){var le=ee-ge;for(ee=7;ee!==0&&le>0;)q=a([Q[ge+le-1],Q[ee]],2),Q[ee]=q[0],Q[ge+le-1]=q[1],ee--,le--}else if(ge===null&&ee!==8)return y("Invalid IP v6 address."),null;return Q}function fe(W){var q,Q;if(/[\x00\t\f\r #/:?@\[\\\]]/.test(W))return y("Invalid host string."),null;var ee="";try{for(var ge=o(W),De=ge.next();!De.done;De=ge.next())ee+=Te(De.value,h)}catch(Ne){q={error:Ne}}finally{try{De&&!De.done&&(Q=ge.return)&&Q.call(ge)}finally{if(q)throw q.error}}return ee}function ae(W){return null}function de(W){return"%"+("00"+W.toString(16).toUpperCase()).slice(-2)}function we(W){for(var q=function(We){return We>=48&&We<=57||We>=65&&We<=70||We>=97&&We<=102},Q=new Uint8Array(W.length),ee=0,ge=0;ge<W.length;ge++){var De=W[ge];if(De!==37)Q[ee]=De,ee++;else if(De===37&&ge>=W.length-2)Q[ee]=De,ee++;else if(De!==37||q(W[ge+1])&&q(W[ge+2])){var Ne=parseInt(c.utf8Decode(Uint8Array.of(W[ge+1],W[ge+2])),16);Q[ee]=Ne,ee++,ge+=2}else Q[ee]=De,ee++}return Q.subarray(0,ee)}function _e(W){return we(c.utf8Encode(W))}function Te(W,q){var Q,ee;if(!q.test(W))return W;var ge=c.utf8Encode(W),De="";try{for(var Ne=o(ge),We=Ne.next();!We.done;We=Ne.next())De+=de(We.value)}catch(re){Q={error:re}}finally{try{We&&!We.done&&(ee=Ne.return)&&ee.call(Ne)}finally{if(Q)throw Q.error}}return De}function G(W){var q,Q,ee,ge,De=[],Ne=[];try{for(var We=o(W),re=We.next();!re.done;re=We.next()){var se=re.value;se===38?(De.push(Uint8Array.from(Ne)),Ne=[]):Ne.push(se)}}catch(qe){q={error:qe}}finally{try{re&&!re.done&&(Q=We.return)&&Q.call(We)}finally{if(q)throw q.error}}Ne.length!==0&&De.push(Uint8Array.from(Ne));var ve=[];try{for(var le=o(De),pe=le.next();!pe.done;pe=le.next()){var $e=pe.value;if($e.length!==0){for(var oe=$e.indexOf(61),st=oe!==-1?$e.slice(0,oe):$e,gt=oe!==-1?$e.slice(oe+1):new Uint8Array,ct=0;ct<st.length;ct++)st[ct]===43&&(st[ct]=32);for(ct=0;ct<gt.length;ct++)gt[ct]===43&&(gt[ct]=32);var Ee=c.utf8Decode(st),ze=c.utf8Decode(gt);ve.push([Ee,ze])}}}catch(qe){ee={error:qe}}finally{try{pe&&!pe.done&&(ge=le.return)&&ge.call(le)}finally{if(ee)throw ee.error}}return ve}function P(W){var q,Q,ee="";try{for(var ge=o(W),De=ge.next();!De.done;De=ge.next()){var Ne=De.value;ee+=Ne===32?"+":Ne===42||Ne===45||Ne===46||Ne>=48&&Ne<=57||Ne>=65&&Ne<=90||Ne===95||Ne>=97&&Ne<=122?String.fromCodePoint(Ne):de(Ne)}}catch(We){q={error:We}}finally{try{De&&!De.done&&(Q=ge.return)&&Q.call(ge)}finally{if(q)throw q.error}}return ee}function $(W,q){var Q=u.domainToASCII(W);return Q===""?(y("Invalid domain name."),null):Q}n.setValidationErrorCallback=function(W){s=W},n.newURL=C,n.isSpecialScheme=x,n.isSpecial=T,n.defaultPort=S,n.includesCredentials=_,n.cannotHaveAUsernamePasswordPort=function(W){return W.host===null||W.host===""||W._cannotBeABaseURLFlag||W.scheme==="file"},n.urlSerializer=E,n.hostSerializer=D,n.iPv4Serializer=b,n.iPv6Serializer=I,n.urlParser=function(W,q,Q){var ee=O(W,q,Q);return ee===null?null:(ee.scheme!=="blob"||(ee._blobURLEntry=null),ee)},n.basicURLParser=O,n.setTheUsername=function(W,q){var Q,ee,ge="";try{for(var De=o(q),Ne=De.next();!Ne.done;Ne=De.next())ge+=Te(Ne.value,m)}catch(We){Q={error:We}}finally{try{Ne&&!Ne.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}W.username=ge},n.setThePassword=function(W,q){var Q,ee,ge="";try{for(var De=o(q),Ne=De.next();!Ne.done;Ne=De.next())ge+=Te(Ne.value,m)}catch(We){Q={error:We}}finally{try{Ne&&!Ne.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}W.password=ge},n.isSingleDotPathSegment=M,n.isDoubleDotPathSegment=R,n.shorten=A,n.isNormalizedWindowsDriveLetter=B,n.isWindowsDriveLetter=k,n.startsWithAWindowsDriveLetter=L,n.hostParser=F,n.iPv4NumberParser=j,n.iPv4Parser=J,n.iPv6Parser=ie,n.opaqueHostParser=fe,n.resolveABlobURL=ae,n.percentEncode=de,n.percentDecode=we,n.stringPercentDecode=_e,n.utf8PercentEncode=Te,n.hostEquals=function(W,q){return W===q},n.urlEquals=function(W,q,Q){return Q===void 0&&(Q=!1),E(W,Q)===E(q,Q)},n.urlEncodedStringParser=function(W){return G(c.utf8Encode(W))},n.urlEncodedParser=G,n.urlEncodedByteSerializer=P,n.urlEncodedSerializer=function(W,q){var Q,ee;if((q===void 0||q==="replacement"||q==="UTF-16BE"||q==="UTF-16LE"?"UTF-8":q).toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var ge="";try{for(var De=o(W),Ne=De.next();!Ne.done;Ne=De.next()){var We=Ne.value,re=P(c.utf8Encode(We[0])),se=We[1];se=P(c.utf8Encode(se)),ge!==""&&(ge+="&"),ge+=re+"="+se}}catch(ve){Q={error:ve}}finally{try{Ne&&!Ne.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}return ge},n.origin=function W(q){switch(q.scheme){case"blob":q._blobURLEntry;var Q=O(q.path[0]);return Q===null?l.OpaqueOrigin:W(Q);case"ftp":case"http":case"https":case"ws":case"wss":return[q.scheme,q.host===null?"":q.host,q.port,null];case"file":default:return l.OpaqueOrigin}},n.domainToASCII=$,n.domainToUnicode=function(W,q){var Q=u.domainToUnicode(W);return Q===""&&y("Invalid domain name."),Q},n.asciiSerializationOfAnOrigin=function(W){if(W[0]===""&&W[1]===""&&W[2]===null&&W[3]===null)return"null";var q=W[0]+"://"+D(W[1]);return W[2]!==null&&(q+=":"+W[2].toString()),q}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=(function(){function s(){this._signal=o.create_abortSignal()}return Object.defineProperty(s.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),s.prototype.abort=function(){o.abort_signalAbort(this._signal)},s})();n.AbortControllerImpl=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(70),c=i(0),l=(function(f){function u(){var d=f.call(this)||this;return d._abortedFlag=!1,d._abortAlgorithms=new Set,d}return a(u,f),Object.defineProperty(u.prototype,"aborted",{get:function(){return this._abortedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onabort",{get:function(){return c.event_getterEventHandlerIDLAttribute(this,"onabort")},set:function(d){c.event_setterEventHandlerIDLAttribute(this,"onabort",d)},enumerable:!0,configurable:!0}),u._create=function(){return new u},u})(s.EventTargetImpl);n.AbortSignalImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(12),f=(function(u){function d(h,g,p){var m=u.call(this)||this;return m._name="",m._publicId="",m._systemId="",m._name=h,m._publicId=g,m._systemId=p,m}return a(d,u),Object.defineProperty(d.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"publicId",{get:function(){return this._publicId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"systemId",{get:function(){return this._systemId},enumerable:!0,configurable:!0}),d.prototype.before=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},d.prototype.after=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},d.prototype.replaceWith=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},d.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},d._create=function(h,g,p,m){p===void 0&&(p=""),m===void 0&&(m="");var w=new d(g,p,m);return w._nodeDocument=h,w},d})(c.NodeImpl);n.DocumentTypeImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.DocumentType)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(100),c=i(1),l=i(0),f=(function(u){function d(h,g){var p=u.call(this)||this;return p._host=h,p._mode=g,p}return a(d,u),Object.defineProperty(d.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),d.prototype._getTheParent=function(h){return h._composedFlag||c.isEmpty(h._path)||l.tree_rootNode(h._path[0].invocationTarget)!==this?this._host:null},d._create=function(h,g){return new d(g,"closed")},d})(s.DocumentFragmentImpl);n.ShadowRootImpl=f},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var m in p)p.hasOwnProperty(m)&&(g[m]=p[m])})(d,h)},function(d,h){function g(){this.constructor=d}o(d,h),d.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(0),f=i(12),u=(function(d){function h(g){var p=d.call(this)||this;return p._namespace=null,p._namespacePrefix=null,p._element=null,p._value="",p._localName=g,p}return a(h,d),Object.defineProperty(h.prototype,"ownerElement",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"name",{get:function(){return this._qualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"value",{get:function(){return this._value},set:function(g){l.attr_setAnExistingAttributeValue(this,g)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix!==null?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),h._create=function(g,p){var m=new h(p);return m._nodeDocument=g,m},h})(c.NodeImpl);n.AttrImpl=u,f.idl_defineConst(u.prototype,"_nodeType",s.NodeType.Attribute),f.idl_defineConst(u.prototype,"specified",!0)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(101),c=i(2),l=i(12),f=(function(u){function d(h){return u.call(this,h)||this}return a(d,u),d._create=function(h,g){g===void 0&&(g="");var p=new d(g);return p._nodeDocument=h,p},d})(s.TextImpl);n.CDATASectionImpl=f,l.idl_defineConst(f.prototype,"_nodeType",c.NodeType.CData)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(71),l=i(12),f=(function(u){function d(h){return h===void 0&&(h=""),u.call(this,h)||this}return a(d,u),d._create=function(h,g){g===void 0&&(g="");var p=new d(g);return p._nodeDocument=h,p},d})(c.CharacterDataImpl);n.CommentImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.Comment)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(71),l=i(12),f=(function(u){function d(h,g){var p=u.call(this,g)||this;return p._target=h,p}return a(d,u),Object.defineProperty(d.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),d._create=function(h,g,p){var m=new d(g,p);return m._nodeDocument=h,m},d})(c.CharacterDataImpl);n.ProcessingInstructionImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.ProcessingInstruction)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(7),a=i(0),s=i(3),c=i(1),l=(function(){function f(u,d){return this._live=!0,this._root=u,this._filter=d,new Proxy(this,this)}return Object.defineProperty(f.prototype,"length",{get:function(){for(var u=this,d=0,h=a.tree_getFirstDescendantNode(this._root,!1,!1,(function(g){return s.Guard.isElementNode(g)&&u._filter(g)}));h!==null;)d++,h=a.tree_getNextDescendantNode(this._root,h,!1,!1,(function(g){return s.Guard.isElementNode(g)&&u._filter(g)}));return d},enumerable:!0,configurable:!0}),f.prototype.item=function(u){for(var d=this,h=0,g=a.tree_getFirstDescendantNode(this._root,!1,!1,(function(p){return s.Guard.isElementNode(p)&&d._filter(p)}));g!==null;){if(h===u)return g;h++,g=a.tree_getNextDescendantNode(this._root,g,!1,!1,(function(p){return s.Guard.isElementNode(p)&&d._filter(p)}))}return null},f.prototype.namedItem=function(u){var d=this;if(u==="")return null;for(var h=a.tree_getFirstDescendantNode(this._root,!1,!1,(function(m){return s.Guard.isElementNode(m)&&d._filter(m)}));h!=null;){if(h._uniqueIdentifier===u)return h;if(h._namespace===o.namespace.HTML)for(var g=0;g<h._attributeList.length;g++){var p=h._attributeList[g];if(p._localName==="name"&&p._namespace===null&&p._namespacePrefix===null&&p._value===u)return h}h=a.tree_getNextDescendantNode(this._root,h,!1,!1,(function(m){return s.Guard.isElementNode(m)&&d._filter(m)}))}return null},f.prototype[Symbol.iterator]=function(){var u=this._root,d=this._filter,h=a.tree_getFirstDescendantNode(u,!1,!1,(function(g){return s.Guard.isElementNode(g)&&d(g)}));return{next:function(){if(h===null)return{done:!0,value:null};var g={done:!1,value:h};return h=a.tree_getNextDescendantNode(u,h,!1,!1,(function(p){return s.Guard.isElementNode(p)&&d(p)})),g}}},f.prototype.get=function(u,d,h){if(!c.isString(d)||f.reservedNames.indexOf(d)!==-1)return Reflect.get(u,d,h);var g=Number(d);return isNaN(g)?u.namedItem(d)||void 0:u.item(g)||void 0},f.prototype.set=function(u,d,h,g){if(!c.isString(d)||f.reservedNames.indexOf(d)!==-1)return Reflect.set(u,d,h,g);var p=Number(d),m=isNaN(p)?u.namedItem(d)||void 0:u.item(p)||void 0;return!(!m||!m._parent)&&(a.mutation_replace(m,h,m._parent),!0)},f._create=function(u,d){return d===void 0&&(d=function(){return!0}),new f(u,d)},f.reservedNames=["_root","_live","_filter","length","item","namedItem","get","set"],f})();n.HTMLCollectionImpl=l},function(r,n,i){var o=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(1),c=i(0),l=(function(){function f(u){return this._live=!0,this._filter=null,this._length=0,this._root=u,new Proxy(this,this)}return Object.defineProperty(f.prototype,"length",{get:function(){return this._root._children.size},enumerable:!0,configurable:!0}),f.prototype.item=function(u){if(u<0||u>this.length-1)return null;if(u<this.length/2){for(var d=0,h=this._root._firstChild;h!==null&&d!==u;)h=h._nextSibling,d++;return h}for(d=this.length-1,h=this._root._lastChild;h!==null&&d!==u;)h=h._previousSibling,d--;return h},f.prototype.keys=function(){var u;return(u={})[Symbol.iterator]=(function(){var d=0;return{next:(function(){return d===this.length?{done:!0,value:null}:{done:!1,value:d++}}).bind(this)}}).bind(this),u},f.prototype.values=function(){var u;return(u={})[Symbol.iterator]=(function(){var d=this[Symbol.iterator]();return{next:function(){return d.next()}}}).bind(this),u},f.prototype.entries=function(){var u;return(u={})[Symbol.iterator]=(function(){var d=this[Symbol.iterator](),h=0;return{next:function(){var g=d.next();return g.done?{done:!0,value:null}:{done:!1,value:[h++,g.value]}}}}).bind(this),u},f.prototype[Symbol.iterator]=function(){return this._root._children[Symbol.iterator]()},f.prototype.forEach=function(u,d){var h,g;d===void 0&&(d=a.dom.window);var p=0;try{for(var m=o(this._root._children),w=m.next();!w.done;w=m.next()){var v=w.value;u.call(d,v,p++,this)}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}},f.prototype.get=function(u,d,h){if(!s.isString(d))return Reflect.get(u,d,h);var g=Number(d);return isNaN(g)?Reflect.get(u,d,h):u.item(g)||void 0},f.prototype.set=function(u,d,h,g){if(!s.isString(d))return Reflect.set(u,d,h,g);var p=Number(d);if(isNaN(p))return Reflect.set(u,d,h,g);var m=u.item(p)||void 0;return!!m&&!!m._parent&&(c.mutation_replace(m,h,m._parent),!0)},f._create=function(u){return new f(u)},f})();n.NodeListImpl=l},function(r,n,i){var o=this&&this.__values||function(l){var f=typeof Symbol=="function"&&Symbol.iterator,u=f&&l[f],d=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&d>=l.length&&(l=void 0),{value:l&&l[d++],done:!l}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(1),c=(function(){function l(f){return this._live=!1,this._items=[],this._length=0,this._root=f,this._items=[],this._filter=function(u){return!0},new Proxy(this,this)}return Object.defineProperty(l.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),l.prototype.item=function(f){return f<0||f>this.length-1?null:this._items[f]},l.prototype.keys=function(){var f;return(f={})[Symbol.iterator]=(function(){var u=0;return{next:(function(){return u===this.length?{done:!0,value:null}:{done:!1,value:u++}}).bind(this)}}).bind(this),f},l.prototype.values=function(){var f;return(f={})[Symbol.iterator]=(function(){var u=this[Symbol.iterator]();return{next:function(){return u.next()}}}).bind(this),f},l.prototype.entries=function(){var f;return(f={})[Symbol.iterator]=(function(){var u=this[Symbol.iterator](),d=0;return{next:function(){var h=u.next();return h.done?{done:!0,value:null}:{done:!1,value:[d++,h.value]}}}}).bind(this),f},l.prototype[Symbol.iterator]=function(){var f=this._items[Symbol.iterator]();return{next:function(){return f.next()}}},l.prototype.forEach=function(f,u){var d,h;u===void 0&&(u=a.dom.window);var g=0;try{for(var p=o(this._items),m=p.next();!m.done;m=p.next()){var w=m.value;f.call(u,w,g++,this)}}catch(v){d={error:v}}finally{try{m&&!m.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}},l.prototype.get=function(f,u,d){if(!s.isString(u))return Reflect.get(f,u,d);var h=Number(u);return isNaN(h)?Reflect.get(f,u,d):f._items[h]||void 0},l.prototype.set=function(f,u,d,h){if(!s.isString(u))return Reflect.set(f,u,d,h);var g=Number(u);return isNaN(g)?Reflect.set(f,u,d,h):g>=0&&g<f._items.length&&(f._items[g]=d,!0)},l._create=function(f,u){var d=new l(f);return d._items=u,d},l})();n.NodeListStaticImpl=c},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(9),c=i(0),l=(function(f){function u(d){var h=f.call(this)||this;return h._element=d,Object.setPrototypeOf(h,u.prototype),h}return a(u,f),u.prototype._asArray=function(){return this},u.prototype.item=function(d){return this[d]||null},u.prototype.getNamedItem=function(d){return c.element_getAnAttributeByName(d,this._element)},u.prototype.getNamedItemNS=function(d,h){return c.element_getAnAttributeByNamespaceAndLocalName(d||"",h,this._element)},u.prototype.setNamedItem=function(d){return c.element_setAnAttribute(d,this._element)},u.prototype.setNamedItemNS=function(d){return c.element_setAnAttribute(d,this._element)},u.prototype.removeNamedItem=function(d){var h=c.element_removeAnAttributeByName(d,this._element);if(h===null)throw new s.NotFoundError;return h},u.prototype.removeNamedItemNS=function(d,h){var g=c.element_removeAnAttributeByNamespaceAndLocalName(d||"",h,this._element);if(g===null)throw new s.NotFoundError;return g},u._create=function(d){return new u(d)},u})(Array);n.NamedNodeMapImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(m,w){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var C in y)y.hasOwnProperty(C)&&(v[C]=y[C])})(m,w)},function(m,w){function v(){this.constructor=m}o(m,w),m.prototype=w===null?Object.create(w):(v.prototype=w.prototype,new v)}),s=this&&this.__values||function(m){var w=typeof Symbol=="function"&&Symbol.iterator,v=w&&m[w],y=0;if(v)return v.call(m);if(m&&typeof m.length=="number")return{next:function(){return m&&y>=m.length&&(m=void 0),{value:m&&m[y++],done:!m}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),f=i(102),u=i(9),d=i(0),h=i(12),g=i(3),p=(function(m){function w(){var v=m.call(this)||this,y=c.dom.window._associatedDocument;return v._start=[y,0],v._end=[y,0],c.dom.rangeList.add(v),v}return a(w,m),Object.defineProperty(w.prototype,"commonAncestorContainer",{get:function(){for(var v=this._start[0];!d.tree_isAncestorOf(this._end[0],v,!0);){if(v._parent===null)throw new Error("Parent node  is null.");v=v._parent}return v},enumerable:!0,configurable:!0}),w.prototype.setStart=function(v,y){d.range_setTheStart(this,v,y)},w.prototype.setEnd=function(v,y){d.range_setTheEnd(this,v,y)},w.prototype.setStartBefore=function(v){var y=v._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheStart(this,y,d.tree_index(v))},w.prototype.setStartAfter=function(v){var y=v._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheStart(this,y,d.tree_index(v)+1)},w.prototype.setEndBefore=function(v){var y=v._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheEnd(this,y,d.tree_index(v))},w.prototype.setEndAfter=function(v){var y=v._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheEnd(this,y,d.tree_index(v)+1)},w.prototype.collapse=function(v){v?this._end=this._start:this._start=this._end},w.prototype.selectNode=function(v){d.range_select(v,this)},w.prototype.selectNodeContents=function(v){if(g.Guard.isDocumentTypeNode(v))throw new u.InvalidNodeTypeError;var y=d.tree_nodeLength(v);this._start=[v,0],this._end=[v,y]},w.prototype.compareBoundaryPoints=function(v,y){if(v!==l.HowToCompare.StartToStart&&v!==l.HowToCompare.StartToEnd&&v!==l.HowToCompare.EndToEnd&&v!==l.HowToCompare.EndToStart)throw new u.NotSupportedError;if(d.range_root(this)!==d.range_root(y))throw new u.WrongDocumentError;var C,x;switch(v){case l.HowToCompare.StartToStart:C=this._start,x=y._start;break;case l.HowToCompare.StartToEnd:C=this._end,x=y._start;break;case l.HowToCompare.EndToEnd:C=this._end,x=y._end;break;case l.HowToCompare.EndToStart:C=this._start,x=y._end;break;default:throw new u.NotSupportedError}var T=d.boundaryPoint_position(C,x);return T===l.BoundaryPosition.Before?-1:T===l.BoundaryPosition.After?1:0},w.prototype.deleteContents=function(){var v,y,C,x;if(!d.range_collapsed(this)){var T=this._startNode,S=this._startOffset,_=this._endNode,E=this._endOffset;if(T===_&&g.Guard.isCharacterDataNode(T))d.characterData_replaceData(T,S,E-S,"");else{var D,b,I=[];try{for(var O=s(d.range_getContainedNodes(this)),M=O.next();!M.done;M=O.next()){var R=(L=M.value)._parent;R!==null&&d.range_isContained(R,this)||I.push(L)}}catch(F){v={error:F}}finally{try{M&&!M.done&&(y=O.return)&&y.call(O)}finally{if(v)throw v.error}}if(d.tree_isAncestorOf(_,T,!0))D=T,b=S;else{for(var A=T;A._parent!==null&&!d.tree_isAncestorOf(_,A._parent,!0);)A=A._parent;if(A._parent===null)throw new Error("Parent node is null.");D=A._parent,b=d.tree_index(A)+1}g.Guard.isCharacterDataNode(T)&&d.characterData_replaceData(T,S,d.tree_nodeLength(T)-S,"");try{for(var B=s(I),k=B.next();!k.done;k=B.next()){var L;(L=k.value)._parent&&d.mutation_remove(L,L._parent)}}catch(F){C={error:F}}finally{try{k&&!k.done&&(x=B.return)&&x.call(B)}finally{if(C)throw C.error}}g.Guard.isCharacterDataNode(_)&&d.characterData_replaceData(_,0,E,""),this._start=[D,b],this._end=[D,b]}}},w.prototype.extractContents=function(){return d.range_extract(this)},w.prototype.cloneContents=function(){return d.range_cloneTheContents(this)},w.prototype.insertNode=function(v){return d.range_insert(v,this)},w.prototype.surroundContents=function(v){var y,C;try{for(var x=s(d.range_getPartiallyContainedNodes(this)),T=x.next();!T.done;T=x.next()){var S=T.value;if(!g.Guard.isTextNode(S))throw new u.InvalidStateError}}catch(E){y={error:E}}finally{try{T&&!T.done&&(C=x.return)&&C.call(x)}finally{if(y)throw y.error}}if(g.Guard.isDocumentNode(v)||g.Guard.isDocumentTypeNode(v)||g.Guard.isDocumentFragmentNode(v))throw new u.InvalidNodeTypeError;var _=d.range_extract(this);v._children.size!==0&&d.mutation_replaceAll(null,v),d.range_insert(v,this),d.mutation_append(_,v),d.range_select(v,this)},w.prototype.cloneRange=function(){return d.create_range(this._start,this._end)},w.prototype.detach=function(){c.dom.rangeList.delete(this)},w.prototype.isPointInRange=function(v,y){if(d.tree_rootNode(v)!==d.range_root(this))return!1;if(g.Guard.isDocumentTypeNode(v))throw new u.InvalidNodeTypeError;if(y>d.tree_nodeLength(v))throw new u.IndexSizeError;var C=[v,y];return d.boundaryPoint_position(C,this._start)!==l.BoundaryPosition.Before&&d.boundaryPoint_position(C,this._end)!==l.BoundaryPosition.After},w.prototype.comparePoint=function(v,y){if(d.tree_rootNode(v)!==d.range_root(this))throw new u.WrongDocumentError;if(g.Guard.isDocumentTypeNode(v))throw new u.InvalidNodeTypeError;if(y>d.tree_nodeLength(v))throw new u.IndexSizeError;var C=[v,y];return d.boundaryPoint_position(C,this._start)===l.BoundaryPosition.Before?-1:d.boundaryPoint_position(C,this._end)===l.BoundaryPosition.After?1:0},w.prototype.intersectsNode=function(v){if(d.tree_rootNode(v)!==d.range_root(this))return!1;var y=v._parent;if(y===null)return!0;var C=d.tree_index(v);return d.boundaryPoint_position([y,C],this._end)===l.BoundaryPosition.Before&&d.boundaryPoint_position([y,C+1],this._start)===l.BoundaryPosition.After},w.prototype.toString=function(){var v,y,C="";if(this._startNode===this._endNode&&g.Guard.isTextNode(this._startNode))return this._startNode._data.substring(this._startOffset,this._endOffset);g.Guard.isTextNode(this._startNode)&&(C+=this._startNode._data.substring(this._startOffset));try{for(var x=s(d.range_getContainedNodes(this)),T=x.next();!T.done;T=x.next()){var S=T.value;g.Guard.isTextNode(S)&&(C+=S._data)}}catch(_){v={error:_}}finally{try{T&&!T.done&&(y=x.return)&&y.call(x)}finally{if(v)throw v.error}}return g.Guard.isTextNode(this._endNode)&&(C+=this._endNode._data.substring(0,this._endOffset)),C},w._create=function(v,y){var C=new w;return v&&(C._start=v),y&&(C._end=y),C},w.START_TO_START=0,w.START_TO_END=1,w.END_TO_END=2,w.END_TO_START=3,w})(f.AbstractRangeImpl);n.RangeImpl=p,h.idl_defineConst(p.prototype,"START_TO_START",0),h.idl_defineConst(p.prototype,"START_TO_END",1),h.idl_defineConst(p.prototype,"END_TO_END",2),h.idl_defineConst(p.prototype,"END_TO_START",3)},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(103),c=i(0),l=(function(f){function u(d,h,g){var p=f.call(this,d)||this;return p._iteratorCollection=void 0,p._reference=h,p._pointerBeforeReference=g,c.nodeIterator_iteratorList().add(p),p}return a(u,f),Object.defineProperty(u.prototype,"referenceNode",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"pointerBeforeReferenceNode",{get:function(){return this._pointerBeforeReference},enumerable:!0,configurable:!0}),u.prototype.nextNode=function(){return c.nodeIterator_traverse(this,!0)},u.prototype.previousNode=function(){return c.nodeIterator_traverse(this,!1)},u.prototype.detach=function(){c.nodeIterator_iteratorList().delete(this)},u._create=function(d,h,g){return new u(d,h,g)},u})(s.TraverserImpl);n.NodeIteratorImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(103),l=i(0),f=(function(u){function d(h,g){var p=u.call(this,h)||this;return p._current=g,p}return a(d,u),Object.defineProperty(d.prototype,"currentNode",{get:function(){return this._current},set:function(h){this._current=h},enumerable:!0,configurable:!0}),d.prototype.parentNode=function(){for(var h=this._current;h!==null&&h!==this._root;)if((h=h._parent)!==null&&l.traversal_filter(this,h)===s.FilterResult.Accept)return this._current=h,h;return null},d.prototype.firstChild=function(){return l.treeWalker_traverseChildren(this,!0)},d.prototype.lastChild=function(){return l.treeWalker_traverseChildren(this,!1)},d.prototype.nextSibling=function(){return l.treeWalker_traverseSiblings(this,!0)},d.prototype.previousNode=function(){for(var h=this._current;h!==this._root;){for(var g=h._previousSibling;g;){h=g;for(var p=l.traversal_filter(this,h);p!==s.FilterResult.Reject&&h._lastChild;)h=h._lastChild,p=l.traversal_filter(this,h);if(p===s.FilterResult.Accept)return this._current=h,h;g=h._previousSibling}if(h===this._root||h._parent===null)return null;if(h=h._parent,l.traversal_filter(this,h)===s.FilterResult.Accept)return this._current=h,h}return null},d.prototype.previousSibling=function(){return l.treeWalker_traverseSiblings(this,!1)},d.prototype.nextNode=function(){for(var h=this._current,g=s.FilterResult.Accept;;){for(;g!==s.FilterResult.Reject&&h._firstChild;)if(h=h._firstChild,(g=l.traversal_filter(this,h))===s.FilterResult.Accept)return this._current=h,h;for(var p=null,m=h;m!==null;){if(m===this._root)return null;if((p=m._nextSibling)!==null){h=p;break}m=m._parent}if((g=l.traversal_filter(this,h))===s.FilterResult.Accept)return this._current=h,h}},d._create=function(h,g){return new d(h,g)},d})(c.TraverserImpl);n.TreeWalkerImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(12),s=(function(){function c(){}return c.prototype.acceptNode=function(l){return o.FilterResult.Accept},c._create=function(){return new c},c.FILTER_ACCEPT=1,c.FILTER_REJECT=2,c.FILTER_SKIP=3,c.SHOW_ALL=4294967295,c.SHOW_ELEMENT=1,c.SHOW_ATTRIBUTE=2,c.SHOW_TEXT=4,c.SHOW_CDATA_SECTION=8,c.SHOW_ENTITY_REFERENCE=16,c.SHOW_ENTITY=32,c.SHOW_PROCESSING_INSTRUCTION=64,c.SHOW_COMMENT=128,c.SHOW_DOCUMENT=256,c.SHOW_DOCUMENT_TYPE=512,c.SHOW_DOCUMENT_FRAGMENT=1024,c.SHOW_NOTATION=2048,c})();n.NodeFilterImpl=s,a.idl_defineConst(s.prototype,"FILTER_ACCEPT",1),a.idl_defineConst(s.prototype,"FILTER_REJECT",2),a.idl_defineConst(s.prototype,"FILTER_SKIP",3),a.idl_defineConst(s.prototype,"SHOW_ALL",4294967295),a.idl_defineConst(s.prototype,"SHOW_ELEMENT",1),a.idl_defineConst(s.prototype,"SHOW_ATTRIBUTE",2),a.idl_defineConst(s.prototype,"SHOW_TEXT",4),a.idl_defineConst(s.prototype,"SHOW_CDATA_SECTION",8),a.idl_defineConst(s.prototype,"SHOW_ENTITY_REFERENCE",16),a.idl_defineConst(s.prototype,"SHOW_ENTITY",32),a.idl_defineConst(s.prototype,"SHOW_PROCESSING_INSTRUCTION",64),a.idl_defineConst(s.prototype,"SHOW_COMMENT",128),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT",256),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT_TYPE",512),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT_FRAGMENT",1024),a.idl_defineConst(s.prototype,"SHOW_NOTATION",2048)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s,c,l,f,u,d,h,g,p){this._type=s,this._target=c,this._addedNodes=l,this._removedNodes=f,this._previousSibling=u,this._nextSibling=d,this._attributeName=h,this._attributeNamespace=g,this._oldValue=p}return Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"addedNodes",{get:function(){return this._addedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"removedNodes",{get:function(){return this._removedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"attributeName",{get:function(){return this._attributeName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"attributeNamespace",{get:function(){return this._attributeNamespace},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),a._create=function(s,c,l,f,u,d,h,g,p){return new a(s,c,l,f,u,d,h,g,p)},a})();n.MutationRecordImpl=o},function(r,n,i){var o=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(9),c=i(7),l=i(0),f=(function(){function u(d,h){this._element=d,this._attribute=h,this._tokenSet=new Set;var g=h._localName,p=l.element_getAnAttributeValue(d,g),m=this;this._element._attributeChangeSteps.push((function(w,v,y,C,x){v===m._attribute._localName&&x===null&&(C?m._tokenSet=l.orderedSet_parse(C):m._tokenSet.clear())})),a.dom.features.steps&&l.dom_runAttributeChangeSteps(d,g,p,p,null)}return Object.defineProperty(u.prototype,"length",{get:function(){return this._tokenSet.size},enumerable:!0,configurable:!0}),u.prototype.item=function(d){var h,g,p=0;try{for(var m=o(this._tokenSet),w=m.next();!w.done;w=m.next()){var v=w.value;if(p===d)return v;p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}return null},u.prototype.contains=function(d){return this._tokenSet.has(d)},u.prototype.add=function(){for(var d,h,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];try{for(var m=o(g),w=m.next();!w.done;w=m.next()){var v=w.value;if(v==="")throw new s.SyntaxError("Cannot add an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(v))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.add(v)}}catch(y){d={error:y}}finally{try{w&&!w.done&&(h=m.return)&&h.call(m)}finally{if(d)throw d.error}}l.tokenList_updateSteps(this)},u.prototype.remove=function(){for(var d,h,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];try{for(var m=o(g),w=m.next();!w.done;w=m.next()){var v=w.value;if(v==="")throw new s.SyntaxError("Cannot remove an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(v))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.delete(v)}}catch(y){d={error:y}}finally{try{w&&!w.done&&(h=m.return)&&h.call(m)}finally{if(d)throw d.error}}l.tokenList_updateSteps(this)},u.prototype.toggle=function(d,h){if(h===void 0&&(h=void 0),d==="")throw new s.SyntaxError("Cannot toggle an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(d))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return this._tokenSet.has(d)?h!==void 0&&h!==!1||(this._tokenSet.delete(d),l.tokenList_updateSteps(this),!1):(h===void 0||h===!0)&&(this._tokenSet.add(d),l.tokenList_updateSteps(this),!0)},u.prototype.replace=function(d,h){if(d===""||h==="")throw new s.SyntaxError("Cannot replace an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(d)||c.codePoint.ASCIIWhiteSpace.test(h))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return!!this._tokenSet.has(d)&&(c.set.replace(this._tokenSet,d,h),l.tokenList_updateSteps(this),!0)},u.prototype.supports=function(d){return l.tokenList_validationSteps(this,d)},Object.defineProperty(u.prototype,"value",{get:function(){return l.tokenList_serializeSteps(this)},set:function(d){l.element_setAnAttributeValue(this._element,this._attribute._localName,d)},enumerable:!0,configurable:!0}),u.prototype[Symbol.iterator]=function(){var d=this._tokenSet[Symbol.iterator]();return{next:function(){return d.next()}}},u._create=function(d,h){return new u(d,h)},u})();n.DOMTokenListImpl=f},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(104),c=i(0),l=(function(f){function u(d,h){var g=f.call(this,d,h)||this;return g._detail=null,g._detail=h&&h.detail||null,g}return a(u,f),Object.defineProperty(u.prototype,"detail",{get:function(){return this._detail},enumerable:!0,configurable:!0}),u.prototype.initCustomEvent=function(d,h,g,p){h===void 0&&(h=!1),g===void 0&&(g=!1),p===void 0&&(p=null),this._dispatchFlag||(c.event_initialize(this,d,h,g),this._detail=p)},u})(s.EventImpl);n.CustomEventImpl=l},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(2),s=i(105),c=i(17);n.nodeIterator_traverse=function(l,f){for(var u=l._reference,d=l._pointerBeforeReference;;){if(f)if(d)d=!1;else{var h=c.tree_getFollowingNode(l._root,u);if(!h)return null;u=h}else if(d){var g=c.tree_getPrecedingNode(l.root,u);if(!g)return null;u=g}else d=!0;if(s.traversal_filter(l,u)===a.FilterResult.Accept)break}return l._reference=u,l._pointerBeforeReference=d,u},n.nodeIterator_iteratorList=function(){return o.dom.window._iteratorList}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(9),a=i(7),s=i(174);function c(l){if(!s.xml_isName(l))throw new o.InvalidCharacterError("Invalid XML name: "+l);if(!s.xml_isQName(l))throw new o.InvalidCharacterError("Invalid XML qualified name: "+l+".")}n.namespace_validate=c,n.namespace_validateAndExtract=function(l,f){l||(l=null),c(f);var u=f.split(":"),d=u.length===2?u[0]:null,h=u.length===2?u[1]:f;if(d&&l===null)throw new o.NamespaceError("Qualified name includes a prefix but the namespace is null.");if(d==="xml"&&l!==a.namespace.XML)throw new o.NamespaceError('Qualified name includes the "xml" prefix but the namespace is not the XML namespace.');if(l!==a.namespace.XMLNS&&(d==="xmlns"||f==="xmlns"))throw new o.NamespaceError('Qualified name includes the "xmlns" prefix but the namespace is not the XMLNS namespace.');if(l===a.namespace.XMLNS&&d!=="xmlns"&&f!=="xmlns")throw new o.NamespaceError('Qualified name does not include the "xmlns" prefix but the namespace is the XMLNS namespace.');return[l,d,h]},n.namespace_extractQName=function(l){c(l);var f=l.split(":");return[f.length===2?f[0]:null,f.length===2?f[1]:l]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.xml_isName=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s>=97&&s<=122||s>=65&&s<=90||s===58||s===95||s>=192&&s<=214||s>=216&&s<=246||s>=248&&s<=767||s>=880&&s<=893||s>=895&&s<=8191||s>=8204&&s<=8205||s>=8304&&s<=8591||s>=11264&&s<=12271||s>=12289&&s<=55295||s>=63744&&s<=64975||s>=65008&&s<=65533)&&(a===0||!(s===45||s===46||s>=48&&s<=57||s===183||s>=768&&s<=879||s>=8255&&s<=8256))){if(s>=55296&&s<=56319&&a<o.length-1){var c=o.charCodeAt(a+1);if(c>=56320&&c<=57343&&(a++,(s=1024*(s-55296)+c-56320+65536)>=65536&&s<=983039))continue}return!1}}return!0},n.xml_isQName=function(o){for(var a=!1,s=0;s<o.length;s++){var c=o.charCodeAt(s);if(!(c>=97&&c<=122||c>=65&&c<=90||c===95||c>=192&&c<=214||c>=216&&c<=246||c>=248&&c<=767||c>=880&&c<=893||c>=895&&c<=8191||c>=8204&&c<=8205||c>=8304&&c<=8591||c>=11264&&c<=12271||c>=12289&&c<=55295||c>=63744&&c<=64975||c>=65008&&c<=65533)&&(s===0||!(c===45||c===46||c>=48&&c<=57||c===183||c>=768&&c<=879||c>=8255&&c<=8256))){if(s===0||c!==58){if(c>=55296&&c<=56319&&s<o.length-1){var l=o.charCodeAt(s+1);if(l>=56320&&l<=57343&&(s++,(c=1024*(c-55296)+l-56320+65536)>=65536&&c<=983039))continue}return!1}if(a||s===o.length-1)return!1;a=!0}}return!0},n.xml_isLegalChar=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s===9||s===10||s===13||s>=32&&s<=55295||s>=57344&&s<=65533)){if(s>=55296&&s<=56319&&a<o.length-1){var c=o.charCodeAt(a+1);if(c>=56320&&c<=57343&&(a++,(s=1024*(s-55296)+c-56320+65536)>=65536&&s<=1114111))continue}return!1}}return!0},n.xml_isPubidChar=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s>=97&&s<=122||s>=65&&s<=90||s>=39&&s<=59||s===32||s===13||s===10||s>=35&&s<=37||s===33||s===61||s===63||s===64||s===95))return!1}return!0}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(17);n.boundaryPoint_position=function s(c,l){var f=c[0],u=c[1],d=l[0],h=l[1];if(console.assert(a.tree_rootNode(f)===a.tree_rootNode(d),"Boundary points must share the same root node."),f===d)return u===h?o.BoundaryPosition.Equal:u<h?o.BoundaryPosition.Before:o.BoundaryPosition.After;if(a.tree_isFollowing(d,f)){var g=s([d,h],[f,u]);if(g===o.BoundaryPosition.Before)return o.BoundaryPosition.After;if(g===o.BoundaryPosition.After)return o.BoundaryPosition.Before}if(a.tree_isAncestorOf(d,f)){for(var p=d;!a.tree_isChildOf(f,p);)p._parent!==null&&(p=p._parent);if(a.tree_index(p)<u)return o.BoundaryPosition.After}return o.BoundaryPosition.Before}},function(r,n,i){var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,m=p&&g[p],w=0;if(m)return m.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(7),l=i(29),f=i(108),u=i(30),d=i(37),h=i(52);n.node_stringReplaceAll=function(g,p){var m=null;g!==""&&(m=l.create_text(p._nodeDocument,g)),d.mutation_replaceAll(m,p)},n.node_clone=function g(p,m,w){var v,y,C,x,T;if(m===void 0&&(m=null),w===void 0&&(w=!1),m===null&&(m=p._nodeDocument),s.Guard.isElementNode(p)){T=h.element_createAnElement(m,p._localName,p._namespace,p._namespacePrefix,p._is,!1);try{for(var S=o(p._attributeList),_=S.next();!_.done;_=S.next()){var E=g(_.value,m);h.element_append(E,T)}}catch(R){v={error:R}}finally{try{_&&!_.done&&(y=S.return)&&y.call(S)}finally{if(v)throw v.error}}}else if(s.Guard.isDocumentNode(p)){var D=l.create_document();D._encoding=p._encoding,D._contentType=p._contentType,D._URL=p._URL,D._origin=p._origin,D._type=p._type,D._mode=p._mode,T=D}else if(s.Guard.isDocumentTypeNode(p))T=l.create_documentType(m,p._name,p._publicId,p._systemId);else if(s.Guard.isAttrNode(p)){var b=l.create_attr(m,p.localName);b._namespace=p._namespace,b._namespacePrefix=p._namespacePrefix,b._value=p._value,T=b}else T=s.Guard.isExclusiveTextNode(p)?l.create_text(m,p._data):s.Guard.isCDATASectionNode(p)?l.create_cdataSection(m,p._data):s.Guard.isCommentNode(p)?l.create_comment(m,p._data):s.Guard.isProcessingInstructionNode(p)?l.create_processingInstruction(m,p._target,p._data):s.Guard.isDocumentFragmentNode(p)?l.create_documentFragment(m):Object.create(p);if(s.Guard.isDocumentNode(T)?(T._nodeDocument=T,m=T):T._nodeDocument=m,a.dom.features.steps&&u.dom_runCloningSteps(T,p,m,w),w)try{for(var I=o(p._children),O=I.next();!O.done;O=I.next()){var M=g(O.value,m,!0);d.mutation_append(M,T)}}catch(R){C={error:R}}finally{try{O&&!O.done&&(x=I.return)&&x.call(I)}finally{if(C)throw C.error}}return T},n.node_equals=function g(p,m){var w,v,y,C;if(p._nodeType!==m._nodeType)return!1;if(s.Guard.isDocumentTypeNode(p)&&s.Guard.isDocumentTypeNode(m)){if(p._name!==m._name||p._publicId!==m._publicId||p._systemId!==m._systemId)return!1}else if(s.Guard.isElementNode(p)&&s.Guard.isElementNode(m)){if(p._namespace!==m._namespace||p._namespacePrefix!==m._namespacePrefix||p._localName!==m._localName||p._attributeList.length!==m._attributeList.length)return!1}else if(s.Guard.isAttrNode(p)&&s.Guard.isAttrNode(m)){if(p._namespace!==m._namespace||p._localName!==m._localName||p._value!==m._value)return!1}else if(s.Guard.isProcessingInstructionNode(p)&&s.Guard.isProcessingInstructionNode(m)){if(p._target!==m._target||p._data!==m._data)return!1}else if(s.Guard.isCharacterDataNode(p)&&s.Guard.isCharacterDataNode(m)&&p._data!==m._data)return!1;if(s.Guard.isElementNode(p)&&s.Guard.isElementNode(m)){var x={};try{for(var T=o(p._attributeList),S=T.next();!S.done;S=T.next())x[(D=S.value)._localName]=D}catch(A){w={error:A}}finally{try{S&&!S.done&&(v=T.return)&&v.call(T)}finally{if(w)throw w.error}}try{for(var _=o(m._attributeList),E=_.next();!E.done;E=_.next()){var D,b=E.value;if(!(D=x[b._localName])||!g(D,b))return!1}}catch(A){y={error:A}}finally{try{E&&!E.done&&(C=_.return)&&C.call(_)}finally{if(y)throw y.error}}}if(p._children.size!==m._children.size)return!1;for(var I=p._children[Symbol.iterator](),O=m._children[Symbol.iterator](),M=I.next(),R=O.next();!M.done&&!R.done;){if(!g(M.value,R.value))return!1;M=I.next(),R=O.next()}return!0},n.node_listOfElementsWithQualifiedName=function(g,p){return g==="*"?l.create_htmlCollection(p):p._nodeDocument._type==="html"?l.create_htmlCollection(p,(function(m){return m._namespace===c.namespace.HTML&&m._qualifiedName===g.toLowerCase()||m._namespace!==c.namespace.HTML&&m._qualifiedName===g})):l.create_htmlCollection(p,(function(m){return m._qualifiedName===g}))},n.node_listOfElementsWithNamespace=function(g,p,m){return g===""&&(g=null),g==="*"&&p==="*"?l.create_htmlCollection(m):g==="*"?l.create_htmlCollection(m,(function(w){return w._localName===p})):p==="*"?l.create_htmlCollection(m,(function(w){return w._namespace===g})):l.create_htmlCollection(m,(function(w){return w._localName===p&&w._namespace===g}))},n.node_listOfElementsWithClassNames=function(g,p){var m=f.orderedSet_parse(g);if(m.size===0)return l.create_htmlCollection(p,(function(){return!1}));var w=p._nodeDocument._mode!=="quirks";return l.create_htmlCollection(p,(function(v){var y=v.classList;return f.orderedSet_contains(y._tokenSet,m,w)}))},n.node_locateANamespacePrefix=function g(p,m){if(p._namespace===m&&p._namespacePrefix!==null)return p._namespacePrefix;for(var w=0;w<p._attributeList.length;w++){var v=p._attributeList[w];if(v._namespacePrefix==="xmlns"&&v._value===m)return v._localName}return p._parent&&s.Guard.isElementNode(p._parent)?g(p._parent,m):null},n.node_locateANamespace=function g(p,m){if(s.Guard.isElementNode(p)){if(p._namespace!==null&&p._namespacePrefix===m)return p._namespace;for(var w=0;w<p._attributeList.length;w++){var v=p._attributeList[w];if(v._namespace===c.namespace.XMLNS&&v._namespacePrefix==="xmlns"&&v._localName===m||m===null&&v._namespace===c.namespace.XMLNS&&v._namespacePrefix===null&&v._localName==="xmlns")return v._value||null}return p.parentElement===null?null:g(p.parentElement,m)}return s.Guard.isDocumentNode(p)?p.documentElement===null?null:g(p.documentElement,m):s.Guard.isDocumentTypeNode(p)||s.Guard.isDocumentFragmentNode(p)?null:s.Guard.isAttrNode(p)?p._element===null?null:g(p._element,m):p._parent&&s.Guard.isElementNode(p._parent)?g(p._parent,m):null}},function(r,n,i){var o=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],m=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&m>=h.length&&(h=void 0),{value:h&&h[m++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(9),l=i(29),f=i(17),u=i(107),d=i(37);n.text_contiguousTextNodes=function(h,g){var p;return g===void 0&&(g=!1),(p={})[Symbol.iterator]=function(){for(var m=h;m&&s.Guard.isTextNode(m._previousSibling);)m=m._previousSibling;return{next:function(){if(m&&!g&&m===h&&(m=s.Guard.isTextNode(m._nextSibling)?m._nextSibling:null),m===null)return{done:!0,value:null};var w={done:!1,value:m};return m=s.Guard.isTextNode(m._nextSibling)?m._nextSibling:null,w}}},p},n.text_contiguousExclusiveTextNodes=function(h,g){var p;return g===void 0&&(g=!1),(p={})[Symbol.iterator]=function(){for(var m=h;m&&s.Guard.isExclusiveTextNode(m._previousSibling);)m=m._previousSibling;return{next:function(){if(m&&!g&&m===h&&(m=s.Guard.isExclusiveTextNode(m._nextSibling)?m._nextSibling:null),m===null)return{done:!0,value:null};var w={done:!1,value:m};return m=s.Guard.isExclusiveTextNode(m._nextSibling)?m._nextSibling:null,w}}},p},n.text_descendantTextContent=function(h){for(var g="",p=f.tree_getFirstDescendantNode(h,!1,!1,(function(m){return s.Guard.isTextNode(m)}));p!==null;)g+=p._data,p=f.tree_getNextDescendantNode(h,p,!1,!1,(function(m){return s.Guard.isTextNode(m)}));return g},n.text_split=function(h,g){var p,m,w=h._data.length;if(g>w)throw new c.IndexSizeError;var v=w-g,y=u.characterData_substringData(h,g,v),C=l.create_text(h._nodeDocument,y),x=h._parent;if(x!==null){d.mutation_insert(C,x,h._nextSibling);try{for(var T=o(a.dom.rangeList),S=T.next();!S.done;S=T.next()){var _=S.value;_._start[0]===h&&_._start[1]>g&&(_._start[0]=C,_._start[1]-=g),_._end[0]===h&&_._end[1]>g&&(_._end[0]=C,_._end[1]-=g);var E=f.tree_index(h);_._start[0]===x&&_._start[1]===E+1&&_._start[1]++,_._end[0]===x&&_._end[1]===E+1&&_._end[1]++}}catch(D){p={error:D}}finally{try{S&&!S.done&&(m=T.return)&&m.call(T)}finally{if(p)throw p.error}}}return u.characterData_replaceData(h,g,v,""),C}},function(r,n,i){var o=i(4),a=i(41),s=i(24),c=i(48),l=[].join,f=a!=Object,u=c("join",",");o({target:"Array",proto:!0,forced:f||!u},{join:function(d){return l.call(s(this),d===void 0?",":d)}})},function(r,n,i){var o=i(4),a=i(83),s=String.fromCharCode,c=String.fromCodePoint;o({target:"String",stat:!0,forced:!!c&&c.length!=1},{fromCodePoint:function(l){for(var f,u=[],d=arguments.length,h=0;d>h;){if(f=+arguments[h++],a(f,1114111)!==f)throw RangeError(f+" is not a valid code point");u.push(f<65536?s(f):s(55296+((f-=65536)>>10),f%1024+56320))}return u.join("")}})},function(r,n,i){var o=this&&this.__read||function(c,l){var f=typeof Symbol=="function"&&c[Symbol.iterator];if(!f)return c;var u,d,h=f.call(c),g=[];try{for(;(l===void 0||l-- >0)&&!(u=h.next()).done;)g.push(u.value)}catch(p){d={error:p}}finally{try{u&&!u.done&&(f=h.return)&&f.call(h)}finally{if(d)throw d.error}}return g};Object.defineProperty(n,"__esModule",{value:!0});var a=i(111),s=(function(){function c(l,f){this._options={skipWhitespaceOnlyText:!1},this.err={line:-1,col:-1,index:-1,str:""},this._str=l,this._index=0,this._length=l.length,f&&(this._options.skipWhitespaceOnlyText=f.skipWhitespaceOnlyText||!1)}return c.prototype.nextToken=function(){if(this.eof())return{type:a.TokenType.EOF};var l=this.skipIfStartsWith("<")?this.openBracket():this.text();return this._options.skipWhitespaceOnlyText&&l.type===a.TokenType.Text&&c.isWhiteSpaceToken(l)&&(l=this.nextToken()),l},c.prototype.openBracket=function(){return this.skipIfStartsWith("?")?this.skipIfStartsWith("xml")?c.isSpace(this._str[this._index])?this.declaration():(this.seek(-3),this.pi()):this.pi():this.skipIfStartsWith("!")?this.skipIfStartsWith("--")?this.comment():this.skipIfStartsWith("[CDATA[")?this.cdata():this.skipIfStartsWith("DOCTYPE")?this.doctype():void this.throwError("Invalid '!' in opening tag."):this.skipIfStartsWith("/")?this.closeTag():this.openTag()},c.prototype.declaration=function(){for(var l="",f="",u="";!this.eof();){if(this.skipSpace(),this.skipIfStartsWith("?>"))return{type:a.TokenType.Declaration,version:l,encoding:f,standalone:u};var d=o(this.attribute(),2),h=d[0],g=d[1];h==="version"?l=g:h==="encoding"?f=g:h==="standalone"?u=g:this.throwError("Invalid attribute name: "+h)}this.throwError("Missing declaration end symbol `?>`")},c.prototype.doctype=function(){var l="",f="";this.skipSpace();var u=this.takeUntil2("[",">",!0);return this.skipSpace(),this.skipIfStartsWith("PUBLIC")?(l=this.quotedString(),f=this.quotedString()):this.skipIfStartsWith("SYSTEM")&&(f=this.quotedString()),this.skipSpace(),this.skipIfStartsWith("[")&&(this.skipUntil("]"),this.skipIfStartsWith("]")||this.throwError("Missing end bracket of DTD internal subset")),this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing doctype end symbol `>`"),{type:a.TokenType.DocType,name:u,pubId:l,sysId:f}},c.prototype.pi=function(){var l=this.takeUntilStartsWith("?>",!0);if(this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.skipSpace(),this.skipIfStartsWith("?>"))return{type:a.TokenType.PI,target:l,data:""};var f=this.takeUntilStartsWith("?>");return this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.seek(2),{type:a.TokenType.PI,target:l,data:f}},c.prototype.text=function(){var l=this.takeUntil("<");return{type:a.TokenType.Text,data:l}},c.prototype.comment=function(){var l=this.takeUntilStartsWith("-->");return this.eof()&&this.throwError("Missing comment end symbol `-->`"),this.seek(3),{type:a.TokenType.Comment,data:l}},c.prototype.cdata=function(){var l=this.takeUntilStartsWith("]]>");return this.eof()&&this.throwError("Missing CDATA end symbol `]>`"),this.seek(3),{type:a.TokenType.CDATA,data:l}},c.prototype.openTag=function(){this.skipSpace();var l=this.takeUntil2(">","/",!0);if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:a.TokenType.Element,name:l,attributes:[],selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:a.TokenType.Element,name:l,attributes:[],selfClosing:!0};for(var f=[];!this.eof();){if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:a.TokenType.Element,name:l,attributes:f,selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:a.TokenType.Element,name:l,attributes:f,selfClosing:!0};var u=this.attribute();f.push(u)}this.throwError("Missing opening element tag end symbol `>`")},c.prototype.closeTag=function(){this.skipSpace();var l=this.takeUntil(">",!0);return this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing closing element tag end symbol `>`"),{type:a.TokenType.ClosingTag,name:l}},c.prototype.attribute=function(){this.skipSpace();var l=this.takeUntil("=",!0);return this.skipSpace(),this.skipIfStartsWith("=")||this.throwError("Missing equals sign before attribute value"),[l,this.quotedString()]},c.prototype.quotedString=function(){this.skipSpace();var l=this.take(1);c.isQuote(l)||this.throwError("Missing start quote character before quoted value");var f=this.takeUntil(l);return this.skipIfStartsWith(l)||this.throwError("Missing end quote character after quoted value"),f},c.prototype.eof=function(){return this._index>=this._length},c.prototype.skipIfStartsWith=function(l){var f=l.length;if(f===1)return this._str[this._index]===l&&(this._index++,!0);for(var u=0;u<f;u++)if(this._str[this._index+u]!==l[u])return!1;return this._index+=f,!0},c.prototype.seek=function(l){this._index+=l,this._index<0&&(this._index=0),this._index>this._length&&(this._index=this._length)},c.prototype.skipSpace=function(){for(;!this.eof()&&c.isSpace(this._str[this._index]);)this._index++},c.prototype.take=function(l){if(l===1)return this._str[this._index++];var f=this._index;return this.seek(l),this._str.slice(f,this._index)},c.prototype.takeUntil=function(l,f){f===void 0&&(f=!1);for(var u=this._index;this._index<this._length;){var d=this._str[this._index];if(d===l||f&&c.isSpace(d))break;this._index++}return this._str.slice(u,this._index)},c.prototype.takeUntil2=function(l,f,u){u===void 0&&(u=!1);for(var d=this._index;this._index<this._length;){var h=this._str[this._index];if(h===l||h===f||u&&c.isSpace(h))break;this._index++}return this._str.slice(d,this._index)},c.prototype.takeUntilStartsWith=function(l,f){f===void 0&&(f=!1);for(var u=this._index,d=l.length;this._index<this._length;){for(var h=!0,g=0;g<d;g++){var p=this._str[this._index+g],m=l[g];if(f&&c.isSpace(p))return this._str.slice(u,this._index);if(p!==m){this._index++,h=!1;break}}if(h)return this._str.slice(u,this._index)}return this._index=this._length,this._str.slice(u)},c.prototype.skipUntil=function(l){for(;this._index<this._length&&this._str[this._index]!==l;)this._index++},c.isWhiteSpaceToken=function(l){for(var f=l.data,u=0;u<f.length;u++){var d=f[u];if(d!==" "&&d!==`
`&&d!=="\r"&&d!=="	"&&d!=="\f")return!1}return!0},c.isSpace=function(l){return l===" "||l===`
`||l==="\r"||l==="	"},c.isQuote=function(l){return l==='"'||l==="'"},c.prototype.throwError=function(l){for(var f=/\r\n|\r|\n/g,u=null,d=0,h=0,g=this._str.length;(u=f.exec(this._str))!==null&&u!==null;)if(d++,u.index<this._index&&(h=f.lastIndex),u.index>this._index){g=u.index;break}throw this.err={line:d,col:this._index-h,index:this._index,str:this._str.substring(h,g)},new Error(l+`
Index: `+this.err.index+`
Ln: `+this.err.line+", Col: "+this.err.col+`
Input: `+this.err.str)},c.prototype[Symbol.iterator]=function(){return this._index=0,{next:(function(){var l=this.nextToken();return l.type===a.TokenType.EOF?{done:!0,value:null}:{done:!1,value:l}}).bind(this)}},c})();n.XMLStringLexer=s},function(r,n,i){var o=i(39);r.exports=new o({include:[i(182)]})},function(r,n,i){var o=i(39);r.exports=new o({include:[i(113)],implicit:[i(289),i(290),i(291),i(292)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(91),a=i(1),s=i(3),c=i(77),l=i(109);function f(g,p){var m=d(g===void 0||u(g)?g:o.DefaultBuilderOptions),w=u(g)?p:g,v=l.createDocument();h(v,m);var y=new c.XMLBuilderImpl(v);return w!==void 0&&y.ele(w),y}function u(g){if(!a.isPlainObject(g))return!1;for(var p in g)if(g.hasOwnProperty(p)&&!o.XMLBuilderOptionKeys.has(p))return!1;return!0}function d(g){g===void 0&&(g={});var p=a.applyDefaults(g,o.DefaultBuilderOptions);if(p.convert.att.length===0||p.convert.ins.length===0||p.convert.text.length===0||p.convert.cdata.length===0||p.convert.comment.length===0)throw new Error("JS object converter strings cannot be zero length.");return p}function h(g,p,m){var w=g;w._xmlBuilderOptions=p,w._isFragment=m}n.builder=function(g,p){var m=d(u(g)?g:o.DefaultBuilderOptions),w=s.Guard.isNode(g)||a.isArray(g)?g:p;if(w===void 0)throw new Error("Invalid arguments.");if(a.isArray(w)){for(var v=[],y=0;y<w.length;y++){var C=new c.XMLBuilderImpl(w[y]);C.set(m),v.push(C)}return v}var x=new c.XMLBuilderImpl(w);return x.set(m),x},n.create=f,n.fragment=function(g,p){var m=d(g===void 0||u(g)?g:o.DefaultBuilderOptions),w=u(g)?p:g,v=l.createDocument();h(v,m,!0);var y=new c.XMLBuilderImpl(v.createDocumentFragment());return w!==void 0&&y.ele(w),y},n.convert=function(g,p,m){var w,v,y;return u(g)&&p!==void 0?(w=g,v=p,y=m):(w=o.DefaultBuilderOptions,v=g,y=p||void 0),f(w,v).end(y)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(77);n.builder=o.builder,n.create=o.create,n.fragment=o.fragment,n.convert=o.convert,n.createCB=o.createCB,n.fragmentCB=o.fragmentCB},function(r,n,i){i(31),i(32),i(33),i(191),i(192),i(194),i(64),i(19),i(198),i(199),i(89),i(201),i(65),i(20),i(66),i(22),i(23);var o=this&&this.__read||function(w,v){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var C,x,T=y.call(w),S=[];try{for(;(v===void 0||v-- >0)&&!(C=T.next()).done;)S.push(C.value)}catch(_){x={error:_}}finally{try{C&&!C.done&&(y=T.return)&&y.call(T)}finally{if(x)throw x.error}}return S},a=this&&this.__values||function(w){var v=typeof Symbol=="function"&&Symbol.iterator,y=v&&w[v],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(91),c=i(1),l=i(217),f=i(2),u=i(3),d=i(0),h=i(109),g=i(7),p=i(276),m=(function(){function w(v){this._domNode=v}return Object.defineProperty(w.prototype,"node",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),w.prototype.set=function(v){return this._options=c.applyDefaults(c.applyDefaults(this._options,v,!0),s.DefaultBuilderOptions),this},w.prototype.ele=function(v,y,C){var x,T,S,_,E,D;if(c.isObject(v))return new p.ObjectReader(this._options).parse(this,v);if(v!==null&&/^\s*</.test(v))return new p.XMLReader(this._options).parse(this,v);if(v!==null&&/^\s*[\{\[]/.test(v))return new p.JSONReader(this._options).parse(this,v);if(v!==null&&/^(\s*|(#.*)|(%.*))*---/.test(v))return new p.YAMLReader(this._options).parse(this,v);if((v===null||c.isString(v))&&c.isString(y))_=(x=o([v,y,C],3))[0],E=x[1],D=x[2];else{if(v===null)throw new Error("Element name cannot be null. "+this._debugInfo());_=(T=o([void 0,v,c.isObject(y)?y:void 0],3))[0],E=T[1],D=T[2]}if(D&&(D=c.getValue(D)),_=(S=o(this._extractNamespace(h.sanitizeInput(_,this._options.invalidCharReplacement),h.sanitizeInput(E,this._options.invalidCharReplacement),!0),2))[0],E=S[1],_===void 0){var b=o(d.namespace_extractQName(E),1)[0];_=this.node.lookupNamespaceURI(b)}var I=_!=null?this._doc.createElementNS(_,E):this._doc.createElement(E);this.node.appendChild(I);var O=new w(I),M=this._doc.doctype;if(I===this._doc.documentElement&&M!==null){var R=this._doc.implementation.createDocumentType(this._doc.documentElement.tagName,M.publicId,M.systemId);this._doc.replaceChild(R,M)}return D&&!c.isEmpty(D)&&O.att(D),O},w.prototype.remove=function(){var v=this.up();return v.node.removeChild(this.node),v},w.prototype.att=function(v,y,C){var x,T,S,_,E,D,b=this;if(c.isMap(v)||c.isObject(v))return c.forEachObject(v,(function(k,L){return b.att(k,L)}),this),this;if(v!=null&&(v=c.getValue(v+"")),y!=null&&(y=c.getValue(y+"")),C!=null&&(C=c.getValue(C+"")),v!==null&&!c.isString(v)||!c.isString(y)||C!==null&&!c.isString(C)){if(!c.isString(v)||y!=null&&!c.isString(y))throw new Error("Attribute name and value not specified. "+this._debugInfo());_=(T=o([void 0,v,y],3))[0],E=T[1],D=T[2]}else _=(x=o([v,y,C],3))[0],E=x[1],D=x[2];if(this._options.keepNullAttributes&&D==null)D="";else if(D==null)return this;if(!u.Guard.isElementNode(this.node))throw new Error("An attribute can only be assigned to an element node.");var I=this.node;_=(S=o(this._extractNamespace(_,E,!1),2))[0],E=S[1],E=h.sanitizeInput(E,this._options.invalidCharReplacement),_=h.sanitizeInput(_,this._options.invalidCharReplacement),D=h.sanitizeInput(D,this._options.invalidCharReplacement);var O=o(d.namespace_extractQName(E),2),M=O[0],R=O[1],A=o(d.namespace_extractQName(I.prefix?I.prefix+":"+I.localName:I.localName),1)[0],B=null;return M==="xmlns"?(_=g.namespace.XMLNS,I.namespaceURI===null&&A===R&&(B=D)):M===null&&R==="xmlns"&&A===null&&(_=g.namespace.XMLNS,B=D),B!==null&&(this._updateNamespace(B),I=this.node),_!==void 0?I.setAttributeNS(_,E,D):I.setAttribute(E,D),this},w.prototype.removeAtt=function(v,y){var C,x,T=this;if(!u.Guard.isElementNode(this.node))throw new Error("An attribute can only be removed from an element node.");if(v=c.getValue(v),y!==void 0&&(y=c.getValue(y)),v!==null&&y===void 0)x=v;else{if(v!==null&&!c.isString(v)||y===void 0)throw new Error("Attribute namespace must be a string. "+this._debugInfo());C=v,x=y}return c.isArray(x)||c.isSet(x)?c.forEachArray(x,(function(S){return C===void 0?T.removeAtt(S):T.removeAtt(C,S)}),this):C!==void 0?(x=h.sanitizeInput(x,this._options.invalidCharReplacement),C=h.sanitizeInput(C,this._options.invalidCharReplacement),this.node.removeAttributeNS(C,x)):(x=h.sanitizeInput(x,this._options.invalidCharReplacement),this.node.removeAttribute(x)),this},w.prototype.txt=function(v){if(v==null){if(!this._options.keepNullNodes)return this;v=""}var y=this._doc.createTextNode(h.sanitizeInput(v,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.com=function(v){if(v==null){if(!this._options.keepNullNodes)return this;v=""}var y=this._doc.createComment(h.sanitizeInput(v,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.dat=function(v){if(v==null){if(!this._options.keepNullNodes)return this;v=""}var y=this._doc.createCDATASection(h.sanitizeInput(v,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.ins=function(v,y){var C=this;if(y===void 0&&(y=""),y==null){if(!this._options.keepNullNodes)return this;y=""}if(c.isArray(v)||c.isSet(v))c.forEachArray(v,(function(T){var S=(T+="").indexOf(" "),_=S===-1?T:T.substr(0,S),E=S===-1?"":T.substr(S+1);C.ins(_,E)}),this);else if(c.isMap(v)||c.isObject(v))c.forEachObject(v,(function(T,S){return C.ins(T,S)}),this);else{var x=this._doc.createProcessingInstruction(h.sanitizeInput(v,this._options.invalidCharReplacement),h.sanitizeInput(y,this._options.invalidCharReplacement));this.node.appendChild(x)}return this},w.prototype.dec=function(v){return this._options.version=v.version||"1.0",this._options.encoding=v.encoding,this._options.standalone=v.standalone,this},w.prototype.dtd=function(v){var y=h.sanitizeInput(v&&v.name||(this._doc.documentElement?this._doc.documentElement.tagName:"ROOT"),this._options.invalidCharReplacement),C=h.sanitizeInput(v&&v.pubID||"",this._options.invalidCharReplacement),x=h.sanitizeInput(v&&v.sysID||"",this._options.invalidCharReplacement);if(this._doc.documentElement!==null&&y!==this._doc.documentElement.tagName)throw new Error("DocType name does not match document element name.");var T=this._doc.implementation.createDocumentType(y,C,x);return this._doc.doctype!==null?this._doc.replaceChild(T,this._doc.doctype):this._doc.insertBefore(T,this._doc.documentElement),this},w.prototype.import=function(v){var y,C,x=this._domNode,T=this._doc,S=v.node;if(u.Guard.isDocumentNode(S)){var _=S.documentElement;if(_===null)throw new Error("Imported document has no document element node. "+this._debugInfo());var E=T.importNode(_,!0);x.appendChild(E);var D=o(d.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=x.lookupNamespaceURI(D);new w(E)._updateNamespace(b)}else if(u.Guard.isDocumentFragmentNode(S))try{for(var I=a(S.childNodes),O=I.next();!O.done;O=I.next()){var M=O.value;E=T.importNode(M,!0),x.appendChild(E),u.Guard.isElementNode(E)&&(D=o(d.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=x.lookupNamespaceURI(D),new w(E)._updateNamespace(b))}}catch(R){y={error:R}}finally{try{O&&!O.done&&(C=I.return)&&C.call(I)}finally{if(y)throw y.error}}else E=T.importNode(S,!0),x.appendChild(E),u.Guard.isElementNode(E)&&(D=o(d.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=x.lookupNamespaceURI(D),new w(E)._updateNamespace(b));return this},w.prototype.doc=function(){if(this._doc._isFragment){for(var v=this.node;v&&v.nodeType!==f.NodeType.DocumentFragment;)v=v.parentNode;if(v===null)throw new Error("Node has no parent node while searching for document fragment ancestor. "+this._debugInfo());return new w(v)}return new w(this._doc)},w.prototype.root=function(){var v=this._doc.documentElement;if(!v)throw new Error("Document root element is null. "+this._debugInfo());return new w(v)},w.prototype.up=function(){var v=this._domNode.parentNode;if(!v)throw new Error("Parent node is null. "+this._debugInfo());return new w(v)},w.prototype.prev=function(){var v=this._domNode.previousSibling;if(!v)throw new Error("Previous sibling node is null. "+this._debugInfo());return new w(v)},w.prototype.next=function(){var v=this._domNode.nextSibling;if(!v)throw new Error("Next sibling node is null. "+this._debugInfo());return new w(v)},w.prototype.first=function(){var v=this._domNode.firstChild;if(!v)throw new Error("First child node is null. "+this._debugInfo());return new w(v)},w.prototype.last=function(){var v=this._domNode.lastChild;if(!v)throw new Error("Last child node is null. "+this._debugInfo());return new w(v)},w.prototype.each=function(v,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var T=this._getFirstDescendantNode(this._domNode,y,C);T[0];){var S=this._getNextDescendantNode(this._domNode,T[0],C,T[1],T[2]);v.call(x,new w(T[0]),T[1],T[2]),T=S}return this},w.prototype.map=function(v,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);var T=[];return this.each((function(S,_,E){return T.push(v.call(x,S,_,E))}),y,C),T},w.prototype.reduce=function(v,y,C,x,T){C===void 0&&(C=!1),x===void 0&&(x=!1);var S=y;return this.each((function(_,E,D){return S=v.call(T,S,_,E,D)}),C,x),S},w.prototype.find=function(v,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var T=this._getFirstDescendantNode(this._domNode,y,C);T[0];){var S=new w(T[0]);if(v.call(x,S,T[1],T[2]))return S;T=this._getNextDescendantNode(this._domNode,T[0],C,T[1],T[2])}},w.prototype.filter=function(v,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);var T=[];return this.each((function(S,_,E){v.call(x,S,_,E)&&T.push(S)}),y,C),T},w.prototype.every=function(v,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var T=this._getFirstDescendantNode(this._domNode,y,C);T[0];){var S=new w(T[0]);if(!v.call(x,S,T[1],T[2]))return!1;T=this._getNextDescendantNode(this._domNode,T[0],C,T[1],T[2])}return!0},w.prototype.some=function(v,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var T=this._getFirstDescendantNode(this._domNode,y,C);T[0];){var S=new w(T[0]);if(v.call(x,S,T[1],T[2]))return!0;T=this._getNextDescendantNode(this._domNode,T[0],C,T[1],T[2])}return!1},w.prototype.toArray=function(v,y){v===void 0&&(v=!1),y===void 0&&(y=!1);var C=[];return this.each((function(x){return C.push(x)}),v,y),C},w.prototype.toString=function(v){return(v=v||{}).format===void 0&&(v.format="xml"),this._serialize(v)},w.prototype.toObject=function(v){return(v=v||{}).format===void 0&&(v.format="object"),this._serialize(v)},w.prototype.end=function(v){return(v=v||{}).format===void 0&&(v.format="xml"),this.doc()._serialize(v)},w.prototype._getFirstDescendantNode=function(v,y,C){return y?[this._domNode,0,0]:C?this._getNextDescendantNode(v,v,C,0,0):[this._domNode.firstChild,0,1]},w.prototype._getNextDescendantNode=function(v,y,C,x,T){if(!C)return v===y?[y.firstChild,0,T+1]:[y.nextSibling,x+1,T];if(y.firstChild)return[y.firstChild,0,T+1];if(y===v)return[null,-1,-1];if(y.nextSibling)return[y.nextSibling,x+1,T];for(var S=y.parentNode;S&&S!==v;){if(S.nextSibling)return[S.nextSibling,d.tree_index(S.nextSibling),T-1];S=S.parentNode,T--}return[null,-1,-1]},w.prototype._serialize=function(v){if(v.format==="xml")return new l.XMLWriter(this._options,v).serialize(this.node);if(v.format==="map")return new l.MapWriter(this._options,v).serialize(this.node);if(v.format==="object")return new l.ObjectWriter(this._options,v).serialize(this.node);if(v.format==="json")return new l.JSONWriter(this._options,v).serialize(this.node);if(v.format==="yaml")return new l.YAMLWriter(this._options,v).serialize(this.node);throw new Error("Invalid writer format: "+v.format+". "+this._debugInfo())},w.prototype._extractNamespace=function(v,y,C){var x=y.indexOf("@");if(x>0&&(v===void 0&&(v=y.slice(x+1)),y=y.slice(0,x)),v===void 0)v=C?this._options.defaultNamespace.ele:this._options.defaultNamespace.att;else if(v!==null&&v[0]==="@"){var T=v.slice(1);if((v=this._options.namespaceAlias[T])===void 0)throw new Error("Namespace alias `"+T+"` is not defined. "+this._debugInfo())}return[v,y]},w.prototype._updateNamespace=function(v){var y,C,x,T,S=this._domNode;if(u.Guard.isElementNode(S)&&v!==null&&S.namespaceURI!==v){var _=o(d.namespace_extractQName(S.prefix?S.prefix+":"+S.localName:S.localName),2),E=_[0],D=_[1],b=d.create_element(this._doc,D,v,E);try{for(var I=a(S.attributes),O=I.next();!O.done;O=I.next()){var M=O.value,R=M.prefix?M.prefix+":"+M.localName:M.localName,A=o(d.namespace_extractQName(R),1)[0],B=M.namespaceURI;B===null&&A!==null&&(B=S.lookupNamespaceURI(A)),B===null?b.setAttribute(R,M.value):b.setAttributeNS(B,R,M.value)}}catch(fe){y={error:fe}}finally{try{O&&!O.done&&(C=I.return)&&C.call(I)}finally{if(y)throw y.error}}var k=S.parentNode;if(k===null)throw new Error("Parent node is null."+this._debugInfo());k.replaceChild(b,S),this._domNode=b;try{for(var L=a(S.childNodes),F=L.next();!F.done;F=L.next()){var j=F.value.cloneNode(!0);if(b.appendChild(j),u.Guard.isElementNode(j)){var J=o(d.namespace_extractQName(j.prefix?j.prefix+":"+j.localName:j.localName),1)[0],ie=b.lookupNamespaceURI(J);new w(j)._updateNamespace(ie)}}}catch(fe){x={error:fe}}finally{try{F&&!F.done&&(T=L.return)&&T.call(L)}finally{if(x)throw x.error}}}},Object.defineProperty(w.prototype,"_doc",{get:function(){var v=this.node;if(u.Guard.isDocumentNode(v))return v;var y=v.ownerDocument;if(!y)throw new Error("Owner document is null. "+this._debugInfo());return y},enumerable:!0,configurable:!0}),w.prototype._debugInfo=function(v){var y=this.node,C=y.parentNode;v=v||y.nodeName;var x=C?C.nodeName:"";return x?"node: <"+v+">, parent: <"+x+">":"node: <"+v+">"},Object.defineProperty(w.prototype,"_options",{get:function(){var v=this._doc;if(v._xmlBuilderOptions===void 0)throw new Error("Builder options is not set.");return v._xmlBuilderOptions},set:function(v){this._doc._xmlBuilderOptions=v},enumerable:!0,configurable:!0}),w})();n.XMLBuilderImpl=m},function(r,n,i){var o=i(11),a=i(117),s=o.WeakMap;r.exports=typeof s=="function"&&/native code/.test(a(s))},function(r,n,i){var o=i(46),a=i(82),s=i(85),c=i(18);r.exports=o("Reflect","ownKeys")||function(l){var f=a.f(c(l)),u=s.f;return u?f.concat(u(l)):f}},function(r,n,i){var o=i(16),a=i(15),s=i(18),c=i(61);r.exports=o?Object.defineProperties:function(l,f){s(l);for(var u,d=c(f),h=d.length,g=0;h>g;)a.f(l,u=d[g++],f[u]);return l}},function(r,n,i){var o=i(46);r.exports=o("document","documentElement")},function(r,n,i){var o=i(24),a=i(82).f,s={}.toString,c=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];r.exports.f=function(l){return c&&s.call(l)=="[object Window]"?(function(f){try{return a(f)}catch{return c.slice()}})(l):a(o(l))}},function(r,n,i){var o=i(4),a=i(36).every,s=i(48),c=i(28),l=s("every"),f=c("every");o({target:"Array",proto:!0,forced:!l||!f},{every:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(4),a=i(36).filter,s=i(63),c=i(28),l=s("filter"),f=c("filter");o({target:"Array",proto:!0,forced:!l||!f},{filter:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(46);r.exports=o("navigator","userAgent")||""},function(r,n,i){var o=i(4),a=i(36).find,s=i(130),c=i(28),l=!0,f=c("find");"find"in[]&&Array(1).find((function(){l=!1})),o({target:"Array",proto:!0,forced:l||!f},{find:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}}),s("find")},function(r,n,i){var o=i(131).IteratorPrototype,a=i(60),s=i(40),c=i(62),l=i(49),f=function(){return this};r.exports=function(u,d,h){var g=d+" Iterator";return u.prototype=a(o,{next:s(1,h)}),c(u,g,!1,!0),l[g]=f,u}},function(r,n,i){var o=i(8);r.exports=!o((function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype}))},function(r,n,i){var o=i(13);r.exports=function(a){if(!o(a)&&a!==null)throw TypeError("Can't set "+String(a)+" as a prototype");return a}},function(r,n,i){var o=i(4),a=i(36).map,s=i(63),c=i(28),l=s("map"),f=c("map");o({target:"Array",proto:!0,forced:!l||!f},{map:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(4),a=i(200).left,s=i(48),c=i(28),l=s("reduce"),f=c("reduce",{1:0});o({target:"Array",proto:!0,forced:!l||!f},{reduce:function(u){return a(this,u,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(127),a=i(27),s=i(41),c=i(26),l=function(f){return function(u,d,h,g){o(d);var p=a(u),m=s(p),w=c(p.length),v=f?w-1:0,y=f?-1:1;if(h<2)for(;;){if(v in m){g=m[v],v+=y;break}if(v+=y,f?v<0:w<=v)throw TypeError("Reduce of empty array with no initial value")}for(;f?v>=0:w>v;v+=y)v in m&&(g=d(g,m[v],v,p));return g}};r.exports={left:l(!1),right:l(!0)}},function(r,n,i){var o=i(4),a=i(36).some,s=i(48),c=i(28),l=s("some"),f=c("some");o({target:"Array",proto:!0,forced:!l||!f},{some:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(90),a=i(135);r.exports=o?{}.toString:function(){return"[object "+a(this)+"]"}},function(r,n){r.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(r,n,i){var o=i(8);r.exports=!o((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(r,n,i){var o=i(5),a=i(49),s=o("iterator"),c=Array.prototype;r.exports=function(l){return l!==void 0&&(a.Array===l||c[s]===l)}},function(r,n,i){var o=i(135),a=i(49),s=i(5)("iterator");r.exports=function(c){if(c!=null)return c[s]||c["@@iterator"]||a[o(c)]}},function(r,n,i){var o=i(18);r.exports=function(a,s,c,l){try{return l?s(o(c)[0],c[1]):s(c)}catch(u){var f=a.return;throw f!==void 0&&o(f.call(a)),u}}},function(r,n,i){var o=i(5)("iterator"),a=!1;try{var s=0,c={next:function(){return{done:!!s++}},return:function(){a=!0}};c[o]=function(){return this},Array.from(c,(function(){throw 2}))}catch{}r.exports=function(l,f){if(!f&&!a)return!1;var u=!1;try{var d={};d[o]=function(){return{next:function(){return{done:u=!0}}}},l(d)}catch{}return u}},function(r,n,i){var o=i(13),a=i(133);r.exports=function(s,c,l){var f,u;return a&&typeof(f=c.constructor)=="function"&&f!==l&&o(u=f.prototype)&&u!==l.prototype&&a(s,u),s}},function(r,n,i){var o=i(25);r.exports=function(a,s,c){for(var l in s)o(a,l,s[l],c);return a}},function(r,n,i){var o=i(46),a=i(15),s=i(5),c=i(16),l=s("species");r.exports=function(f){var u=o(f),d=a.f;c&&u&&!u[l]&&d(u,l,{configurable:!0,get:function(){return this}})}},function(r,n,i){var o=this&&this.__generator||function(c,l){var f,u,d,h,g={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(m){return function(w){return(function(v){if(f)throw new TypeError("Generator is already executing.");for(;g;)try{if(f=1,u&&(d=2&v[0]?u.return:v[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,v[1])).done)return d;switch(u=0,d&&(v=[2&v[0],d.value]),v[0]){case 0:case 1:d=v;break;case 4:return g.label++,{value:v[1],done:!1};case 5:g.label++,u=v[1],v=[0];continue;case 7:v=g.ops.pop(),g.trys.pop();continue;default:if(d=g.trys,!((d=d.length>0&&d[d.length-1])||v[0]!==6&&v[0]!==2)){g=0;continue}if(v[0]===3&&(!d||v[1]>d[0]&&v[1]<d[3])){g.label=v[1];break}if(v[0]===6&&g.label<d[1]){g.label=d[1],d=v;break}if(d&&g.label<d[2]){g.label=d[2],g.ops.push(v);break}d[2]&&g.ops.pop(),g.trys.pop();continue}v=l.call(c,g)}catch(y){v=[6,y],u=0}finally{f=d=0}if(5&v[0])throw v[1];return{value:v[0]?v[1]:void 0,done:!0}})([m,w])}}},a=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=(function(){function c(l){l===void 0&&(l=1e3),this._items=new Set,this._limit=l}return c.prototype.add=function(l){if(this._items.add(l),this._items.size>this._limit){var f=this._items.values().next();f.done||this._items.delete(f.value)}return this},c.prototype.delete=function(l){return this._items.delete(l)},c.prototype.has=function(l){return this._items.has(l)},c.prototype.clear=function(){this._items.clear()},Object.defineProperty(c.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),c.prototype.forEach=function(l,f){var u=this;this._items.forEach((function(d){return l.call(f,d,d,u)}))},c.prototype.keys=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.keys())];case 1:return l.sent(),[2]}}))},c.prototype.values=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.values())];case 1:return l.sent(),[2]}}))},c.prototype.entries=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.entries())];case 1:return l.sent(),[2]}}))},c.prototype[Symbol.iterator]=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items)];case 1:return l.sent(),[2]}}))},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return"FixedSizeSet"},enumerable:!0,configurable:!0}),c})();n.FixedSizeSet=s},function(r,n,i){var o=this&&this.__generator||function(c,l){var f,u,d,h,g={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(m){return function(w){return(function(v){if(f)throw new TypeError("Generator is already executing.");for(;g;)try{if(f=1,u&&(d=2&v[0]?u.return:v[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,v[1])).done)return d;switch(u=0,d&&(v=[2&v[0],d.value]),v[0]){case 0:case 1:d=v;break;case 4:return g.label++,{value:v[1],done:!1};case 5:g.label++,u=v[1],v=[0];continue;case 7:v=g.ops.pop(),g.trys.pop();continue;default:if(d=g.trys,!((d=d.length>0&&d[d.length-1])||v[0]!==6&&v[0]!==2)){g=0;continue}if(v[0]===3&&(!d||v[1]>d[0]&&v[1]<d[3])){g.label=v[1];break}if(v[0]===6&&g.label<d[1]){g.label=d[1],d=v;break}if(d&&g.label<d[2]){g.label=d[2],g.ops.push(v);break}d[2]&&g.ops.pop(),g.trys.pop();continue}v=l.call(c,g)}catch(y){v=[6,y],u=0}finally{f=d=0}if(5&v[0])throw v[1];return{value:v[0]?v[1]:void 0,done:!0}})([m,w])}}},a=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=(function(){function c(l){l===void 0&&(l=1e3),this._items=new Map,this._limit=l}return c.prototype.get=function(l){return this._items.get(l)},c.prototype.set=function(l,f){if(this._items.set(l,f),this._items.size>this._limit){var u=this._items.keys().next();u.done||this._items.delete(u.value)}},c.prototype.delete=function(l){return this._items.delete(l)},c.prototype.has=function(l){return this._items.has(l)},c.prototype.clear=function(){this._items.clear()},Object.defineProperty(c.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),c.prototype.forEach=function(l,f){this._items.forEach((function(u,d){return l.call(f,d,u)}))},c.prototype.keys=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.keys())];case 1:return l.sent(),[2]}}))},c.prototype.values=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.values())];case 1:return l.sent(),[2]}}))},c.prototype.entries=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.entries())];case 1:return l.sent(),[2]}}))},c.prototype[Symbol.iterator]=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items)];case 1:return l.sent(),[2]}}))},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return"ObjectCache"},enumerable:!0,configurable:!0}),c})();n.ObjectCache=s},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s){s===void 0&&(s=1e3),this._items=new Map,this._limit=s}return a.prototype.check=function(s,c){if(this._items.get(s)===c)return!0;if(this._items.get(c)===s)return!1;var l=Math.random()<.5;if(l?this._items.set(s,c):this._items.set(c,s),this._items.size>this._limit){var f=this._items.keys().next();f.done||this._items.delete(f.value)}return l},a})();n.CompareCache=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s){this._initialized=!1,this._value=void 0,this._initFunc=s}return Object.defineProperty(a.prototype,"value",{get:function(){return this._initialized||(this._value=this._initFunc(),this._initialized=!0),this._value},enumerable:!0,configurable:!0}),a})();n.Lazy=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s){this._pointer=0,this._chars=Array.from(s),this._length=this._chars.length}return Object.defineProperty(a.prototype,"eof",{get:function(){return this._pointer>=this._length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),a.prototype.codePoint=function(){if(this._codePoint===void 0)if(this.eof)this._codePoint=-1;else{var s=this._chars[this._pointer].codePointAt(0);this._codePoint=s!==void 0?s:-1}return this._codePoint},a.prototype.c=function(){return this._c===void 0&&(this._c=this.eof?"":this._chars[this._pointer]),this._c},a.prototype.remaining=function(){return this._remaining===void 0&&(this._remaining=this.eof?"":this._chars.slice(this._pointer+1).join("")),this._remaining},a.prototype.substring=function(){return this._substring===void 0&&(this._substring=this.eof?"":this._chars.slice(this._pointer).join("")),this._substring},Object.defineProperty(a.prototype,"pointer",{get:function(){return this._pointer},set:function(s){s!==this._pointer&&(this._pointer=s,this._codePoint=void 0,this._c=void 0,this._remaining=void 0,this._substring=void 0)},enumerable:!0,configurable:!0}),a})();n.StringWalker=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(218);n.MapWriter=o.MapWriter;var a=i(258);n.XMLWriter=a.XMLWriter;var s=i(67);n.ObjectWriter=s.ObjectWriter;var c=i(260);n.JSONWriter=c.JSONWriter;var l=i(261);n.YAMLWriter=l.YAMLWriter},function(r,n,i){i(19),i(219),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=i(67),l=(function(f){function u(d,h){var g=f.call(this,d)||this;return g._writerOptions=s.applyDefaults(h,{format:"map",wellFormed:!1,group:!1,verbose:!1}),g}return a(u,f),u.prototype.serialize=function(d){var h=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1,verbose:!1}),g=new c.ObjectWriter(this._builderOptions,h).serialize(d);return this._convertObject(g)},u.prototype._convertObject=function(d){if(s.isArray(d)){for(var h=0;h<d.length;h++)d[h]=this._convertObject(d[h]);return d}if(s.isObject(d)){var g=new Map;for(var p in d)g.set(p,this._convertObject(d[p]));return g}return d},u})(i(50).BaseWriter);n.MapWriter=l},function(r,n,i){var o=i(139),a=i(143);r.exports=o("Map",(function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}}),a)},function(r,n,i){var o=i(4),a=i(8),s=i(59),c=i(13),l=i(27),f=i(26),u=i(134),d=i(128),h=i(63),g=i(5),p=i(129),m=g("isConcatSpreadable"),w=p>=51||!a((function(){var C=[];return C[m]=!1,C.concat()[0]!==C})),v=h("concat"),y=function(C){if(!c(C))return!1;var x=C[m];return x!==void 0?!!x:s(C)};o({target:"Array",proto:!0,forced:!w||!v},{concat:function(C){var x,T,S,_,E,D=l(this),b=d(D,0),I=0;for(x=-1,S=arguments.length;x<S;x++)if(y(E=x===-1?D:arguments[x])){if(I+(_=f(E.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(T=0;T<_;T++,I++)T in E&&u(b,I,E[T])}else{if(I>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(b,I++,E)}return b.length=I,b}})},function(r,n,i){var o=i(8);function a(s,c){return RegExp(s,c)}n.UNSUPPORTED_Y=o((function(){var s=a("a","y");return s.lastIndex=2,s.exec("abcd")!=null})),n.BROKEN_CARET=o((function(){var s=a("^r","gy");return s.lastIndex=2,s.exec("str")!=null}))},function(r,n,i){var o=i(223);r.exports=function(a){if(o(a))throw TypeError("The method doesn't accept regular expressions");return a}},function(r,n,i){var o=i(13),a=i(42),s=i(5)("match");r.exports=function(c){var l;return o(c)&&((l=c[s])!==void 0?!!l:a(c)=="RegExp")}},function(r,n,i){var o=i(5)("match");r.exports=function(a){var s=/./;try{"/./"[a](s)}catch{try{return s[o]=!1,"/./"[a](s)}catch{}}return!1}},function(r,n,i){i(68);var o=i(25),a=i(8),s=i(5),c=i(93),l=i(21),f=s("species"),u=!a((function(){var m=/./;return m.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(m,"$<a>")!=="7"})),d="a".replace(/./,"$0")==="$0",h=s("replace"),g=!!/./[h]&&/./[h]("a","$0")==="",p=!a((function(){var m=/(?:)/,w=m.exec;m.exec=function(){return w.apply(this,arguments)};var v="ab".split(m);return v.length!==2||v[0]!=="a"||v[1]!=="b"}));r.exports=function(m,w,v,y){var C=s(m),x=!a((function(){var b={};return b[C]=function(){return 7},""[m](b)!=7})),T=x&&!a((function(){var b=!1,I=/a/;return m==="split"&&((I={}).constructor={},I.constructor[f]=function(){return I},I.flags="",I[C]=/./[C]),I.exec=function(){return b=!0,null},I[C](""),!b}));if(!x||!T||m==="replace"&&(!u||!d||g)||m==="split"&&!p){var S=/./[C],_=v(C,""[m],(function(b,I,O,M,R){return I.exec===c?x&&!R?{done:!0,value:S.call(I,O,M)}:{done:!0,value:b.call(O,I,M)}:{done:!1}}),{REPLACE_KEEPS_$0:d,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:g}),E=_[0],D=_[1];o(String.prototype,m,E),o(RegExp.prototype,C,w==2?function(b,I){return D.call(b,this,I)}:function(b){return D.call(b,this)})}y&&l(RegExp.prototype[C],"sham",!0)}},function(r,n,i){var o=i(137).charAt;r.exports=function(a,s,c){return s+(c?o(a,s).length:1)}},function(r,n,i){var o=i(42),a=i(93);r.exports=function(s,c){var l=s.exec;if(typeof l=="function"){var f=l.call(s,c);if(typeof f!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return f}if(o(s)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return a.call(s,c)}},function(r,n,i){(function(o){Object.defineProperty(n,"__esModule",{value:!0});var a=i(96);n.forgivingBase64Encode=function(s){return o.from(s).toString("base64")},n.forgivingBase64Decode=function(s){return s===""?"":((s=s.replace(a.ASCIIWhiteSpace,"")).length%4==0&&(s.endsWith("==")?s=s.substr(0,s.length-2):s.endsWith("=")&&(s=s.substr(0,s.length-1))),s.length%4==1?null:/[0-9A-Za-z+/]/.test(s)?o.from(s,"base64").toString("utf8"):null)}}).call(this,i(145).Buffer)},function(r,n,i){n.byteLength=function(h){var g=u(h),p=g[0],m=g[1];return 3*(p+m)/4-m},n.toByteArray=function(h){var g,p,m=u(h),w=m[0],v=m[1],y=new s((function(T,S,_){return 3*(S+_)/4-_})(0,w,v)),C=0,x=v>0?w-4:w;for(p=0;p<x;p+=4)g=a[h.charCodeAt(p)]<<18|a[h.charCodeAt(p+1)]<<12|a[h.charCodeAt(p+2)]<<6|a[h.charCodeAt(p+3)],y[C++]=g>>16&255,y[C++]=g>>8&255,y[C++]=255&g;return v===2&&(g=a[h.charCodeAt(p)]<<2|a[h.charCodeAt(p+1)]>>4,y[C++]=255&g),v===1&&(g=a[h.charCodeAt(p)]<<10|a[h.charCodeAt(p+1)]<<4|a[h.charCodeAt(p+2)]>>2,y[C++]=g>>8&255,y[C++]=255&g),y},n.fromByteArray=function(h){for(var g,p=h.length,m=p%3,w=[],v=0,y=p-m;v<y;v+=16383)w.push(d(h,v,v+16383>y?y:v+16383));return m===1?(g=h[p-1],w.push(o[g>>2]+o[g<<4&63]+"==")):m===2&&(g=(h[p-2]<<8)+h[p-1],w.push(o[g>>10]+o[g>>4&63]+o[g<<2&63]+"=")),w.join("")};for(var o=[],a=[],s=typeof Uint8Array<"u"?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=c.length;l<f;++l)o[l]=c[l],a[c.charCodeAt(l)]=l;function u(h){var g=h.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var p=h.indexOf("=");return p===-1&&(p=g),[p,p===g?0:4-p%4]}function d(h,g,p){for(var m,w,v=[],y=g;y<p;y+=3)m=(h[y]<<16&16711680)+(h[y+1]<<8&65280)+(255&h[y+2]),v.push(o[(w=m)>>18&63]+o[w>>12&63]+o[w>>6&63]+o[63&w]);return v.join("")}a[45]=62,a[95]=63},function(r,n){n.read=function(i,o,a,s,c){var l,f,u=8*c-s-1,d=(1<<u)-1,h=d>>1,g=-7,p=a?c-1:0,m=a?-1:1,w=i[o+p];for(p+=m,l=w&(1<<-g)-1,w>>=-g,g+=u;g>0;l=256*l+i[o+p],p+=m,g-=8);for(f=l&(1<<-g)-1,l>>=-g,g+=s;g>0;f=256*f+i[o+p],p+=m,g-=8);if(l===0)l=1-h;else{if(l===d)return f?NaN:1/0*(w?-1:1);f+=Math.pow(2,s),l-=h}return(w?-1:1)*f*Math.pow(2,l-s)},n.write=function(i,o,a,s,c,l){var f,u,d,h=8*l-c-1,g=(1<<h)-1,p=g>>1,m=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=s?0:l-1,v=s?1:-1,y=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(u=isNaN(o)?1:0,f=g):(f=Math.floor(Math.log(o)/Math.LN2),o*(d=Math.pow(2,-f))<1&&(f--,d*=2),(o+=f+p>=1?m/d:m*Math.pow(2,1-p))*d>=2&&(f++,d/=2),f+p>=g?(u=0,f=g):f+p>=1?(u=(o*d-1)*Math.pow(2,c),f+=p):(u=o*Math.pow(2,p-1)*Math.pow(2,c),f=0));c>=8;i[a+w]=255&u,w+=v,u/=256,c-=8);for(f=f<<c|u,h+=c;h>0;i[a+w]=255&f,w+=v,f/=256,h-=8);i[a+w-v]|=128*y}},function(r,n){var i={}.toString;r.exports=Array.isArray||function(o){return i.call(o)=="[object Array]"}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1);function s(c){var l,f;if(c===null||a.isString(c)||a.isNumber(c))return c;if(a.isArray(c)){var u=new Array;try{for(var d=o(c),h=d.next();!h.done;h=d.next()){var g=h.value;u.push(s(g))}}catch(w){l={error:w}}finally{try{h&&!h.done&&(f=d.return)&&f.call(d)}finally{if(l)throw l.error}}return u}if(a.isObject(c)){u=new Map;for(var p in c)if(c.hasOwnProperty(p)){var m=c[p];u.set(p,s(m))}return u}return c}n.parseJSONFromBytes=function(c){var l=a.utf8Decode(c);return JSON.parse.call(void 0,l)},n.serializeJSONToBytes=function(c){var l=JSON.stringify.call(void 0,c);return a.utf8Encode(l)},n.parseJSONIntoInfraValues=function(c){return s(JSON.parse.call(void 0,c))},n.convertAJSONDerivedJavaScriptValueToAnInfraValue=s},function(r,n,i){var o=this&&this.__generator||function(f,u){var d,h,g,p,m={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(v){return function(y){return(function(C){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,h&&(g=2&C[0]?h.return:C[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,C[1])).done)return g;switch(h=0,g&&(C=[2&C[0],g.value]),C[0]){case 0:case 1:g=C;break;case 4:return m.label++,{value:C[1],done:!1};case 5:m.label++,h=C[1],C=[0];continue;case 7:C=m.ops.pop(),m.trys.pop();continue;default:if(g=m.trys,!((g=g.length>0&&g[g.length-1])||C[0]!==6&&C[0]!==2)){m=0;continue}if(C[0]===3&&(!g||C[1]>g[0]&&C[1]<g[3])){m.label=C[1];break}if(C[0]===6&&m.label<g[1]){m.label=g[1],g=C;break}if(g&&m.label<g[2]){m.label=g[2],m.ops.push(C);break}g[2]&&m.ops.pop(),m.trys.pop();continue}C=u.call(f,m)}catch(x){C=[6,x],h=0}finally{d=g=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}})([v,y])}}},a=this&&this.__read||function(f,u){var d=typeof Symbol=="function"&&f[Symbol.iterator];if(!d)return f;var h,g,p=d.call(f),m=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)m.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(g)throw g.error}}return m},s=this&&this.__spread||function(){for(var f=[],u=0;u<arguments.length;u++)f=f.concat(a(arguments[u]));return f},c=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);n.append=function(f,u){f.push(u)},n.extend=function(f,u){f.push.apply(f,s(u))},n.prepend=function(f,u){f.unshift(u)},n.replace=function(f,u,d){var h,g,p=0;try{for(var m=c(f),w=m.next();!w.done;w=m.next()){var v=w.value;if(l.isFunction(u))u.call(null,v)&&(f[p]=d);else if(v===u)return void(f[p]=d);p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}},n.insert=function(f,u,d){f.splice(d,0,u)},n.remove=function(f,u){for(var d=f.length;d--;){var h=f[d];if(l.isFunction(u))u.call(null,h)&&f.splice(d,1);else if(h===u)return void f.splice(d,1)}},n.empty=function(f){f.length=0},n.contains=function(f,u){var d,h;try{for(var g=c(f),p=g.next();!p.done;p=g.next()){var m=p.value;if(l.isFunction(u)){if(u.call(null,m))return!0}else if(m===u)return!0}}catch(w){d={error:w}}finally{try{p&&!p.done&&(h=g.return)&&h.call(g)}finally{if(d)throw d.error}}return!1},n.size=function(f,u){var d,h;if(u===void 0)return f.length;var g=0;try{for(var p=c(f),m=p.next();!m.done;m=p.next()){var w=m.value;u.call(null,w)&&g++}}catch(v){d={error:v}}finally{try{m&&!m.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}return g},n.isEmpty=function(f){return f.length===0},n.forEach=function(f,u){var d,h,g,p,m,w;return o(this,(function(v){switch(v.label){case 0:return u!==void 0?[3,2]:[5,c(f)];case 1:return v.sent(),[3,9];case 2:v.trys.push([2,7,8,9]),d=c(f),h=d.next(),v.label=3;case 3:return h.done?[3,6]:(g=h.value,u.call(null,g)?[4,g]:[3,5]);case 4:v.sent(),v.label=5;case 5:return h=d.next(),[3,3];case 6:return[3,9];case 7:return p=v.sent(),m={error:p},[3,9];case 8:try{h&&!h.done&&(w=d.return)&&w.call(d)}finally{if(m)throw m.error}return[7];case 9:return[2]}}))},n.clone=function(f){return new(Array.bind.apply(Array,s([void 0],f)))},n.sortInAscendingOrder=function(f,u){return f.sort((function(d,h){return u.call(null,d,h)?-1:1}))},n.sortInDescendingOrder=function(f,u){return f.sort((function(d,h){return u.call(null,d,h)?1:-1}))}},function(r,n,i){var o=this&&this.__generator||function(f,u){var d,h,g,p,m={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(v){return function(y){return(function(C){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,h&&(g=2&C[0]?h.return:C[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,C[1])).done)return g;switch(h=0,g&&(C=[2&C[0],g.value]),C[0]){case 0:case 1:g=C;break;case 4:return m.label++,{value:C[1],done:!1};case 5:m.label++,h=C[1],C=[0];continue;case 7:C=m.ops.pop(),m.trys.pop();continue;default:if(g=m.trys,!((g=g.length>0&&g[g.length-1])||C[0]!==6&&C[0]!==2)){m=0;continue}if(C[0]===3&&(!g||C[1]>g[0]&&C[1]<g[3])){m.label=C[1];break}if(C[0]===6&&m.label<g[1]){m.label=g[1],g=C;break}if(g&&m.label<g[2]){m.label=g[2],m.ops.push(C);break}g[2]&&m.ops.pop(),m.trys.pop();continue}C=u.call(f,m)}catch(x){C=[6,x],h=0}finally{d=g=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}})([v,y])}}},a=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(f,u){var d=typeof Symbol=="function"&&f[Symbol.iterator];if(!d)return f;var h,g,p=d.call(f),m=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)m.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(g)throw g.error}}return m},c=this&&this.__spread||function(){for(var f=[],u=0;u<arguments.length;u++)f=f.concat(s(arguments[u]));return f};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);n.get=function(f,u){return f.get(u)},n.set=function(f,u,d){f.set(u,d)},n.remove=function(f,u){var d,h,g,p;if(l.isFunction(u)){var m=[];try{for(var w=a(f),v=w.next();!v.done;v=w.next()){var y=v.value;u.call(null,y)&&m.push(y[0])}}catch(S){d={error:S}}finally{try{v&&!v.done&&(h=w.return)&&h.call(w)}finally{if(d)throw d.error}}try{for(var C=a(m),x=C.next();!x.done;x=C.next()){var T=x.value;f.delete(T)}}catch(S){g={error:S}}finally{try{x&&!x.done&&(p=C.return)&&p.call(C)}finally{if(g)throw g.error}}}else f.delete(u)},n.contains=function(f,u){var d,h;if(l.isFunction(u)){try{for(var g=a(f),p=g.next();!p.done;p=g.next()){var m=p.value;if(u.call(null,m))return!0}}catch(w){d={error:w}}finally{try{p&&!p.done&&(h=g.return)&&h.call(g)}finally{if(d)throw d.error}}return!1}return f.has(u)},n.keys=function(f){return new Set(f.keys())},n.values=function(f){return c(f.values())},n.size=function(f,u){var d,h;if(u===void 0)return f.size;var g=0;try{for(var p=a(f),m=p.next();!m.done;m=p.next()){var w=m.value;u.call(null,w)&&g++}}catch(v){d={error:v}}finally{try{m&&!m.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}return g},n.isEmpty=function(f){return f.size===0},n.forEach=function(f,u){var d,h,g,p,m,w;return o(this,(function(v){switch(v.label){case 0:return u!==void 0?[3,2]:[5,a(f)];case 1:return v.sent(),[3,9];case 2:v.trys.push([2,7,8,9]),d=a(f),h=d.next(),v.label=3;case 3:return h.done?[3,6]:(g=h.value,u.call(null,g)?[4,g]:[3,5]);case 4:v.sent(),v.label=5;case 5:return h=d.next(),[3,3];case 6:return[3,9];case 7:return p=v.sent(),m={error:p},[3,9];case 8:try{h&&!h.done&&(w=d.return)&&w.call(d)}finally{if(m)throw m.error}return[7];case 9:return[2]}}))},n.clone=function(f){return new Map(f)},n.sortInAscendingOrder=function(f,u){var d=new(Array.bind.apply(Array,c([void 0],f)));return d.sort((function(h,g){return u.call(null,h,g)?-1:1})),new Map(d)},n.sortInDescendingOrder=function(f,u){var d=new(Array.bind.apply(Array,c([void 0],f)));return d.sort((function(h,g){return u.call(null,h,g)?1:-1})),new Map(d)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.HTML="http://www.w3.org/1999/xhtml",n.XML="http://www.w3.org/XML/1998/namespace",n.XMLNS="http://www.w3.org/2000/xmlns/",n.MathML="http://www.w3.org/1998/Math/MathML",n.SVG="http://www.w3.org/2000/svg",n.XLink="http://www.w3.org/1999/xlink"},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.enqueue=function(o,a){o.push(a)},n.dequeue=function(o){return o.shift()||null}},function(r,n,i){var o=this&&this.__generator||function(u,d){var h,g,p,m,w={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return m={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function v(y){return function(C){return(function(x){if(h)throw new TypeError("Generator is already executing.");for(;w;)try{if(h=1,g&&(p=2&x[0]?g.return:x[0]?g.throw||((p=g.return)&&p.call(g),0):g.next)&&!(p=p.call(g,x[1])).done)return p;switch(g=0,p&&(x=[2&x[0],p.value]),x[0]){case 0:case 1:p=x;break;case 4:return w.label++,{value:x[1],done:!1};case 5:w.label++,g=x[1],x=[0];continue;case 7:x=w.ops.pop(),w.trys.pop();continue;default:if(p=w.trys,!((p=p.length>0&&p[p.length-1])||x[0]!==6&&x[0]!==2)){w=0;continue}if(x[0]===3&&(!p||x[1]>p[0]&&x[1]<p[3])){w.label=x[1];break}if(x[0]===6&&w.label<p[1]){w.label=p[1],p=x;break}if(p&&w.label<p[2]){w.label=p[2],w.ops.push(x);break}p[2]&&w.ops.pop(),w.trys.pop();continue}x=d.call(u,w)}catch(T){x=[6,T],g=0}finally{h=p=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}})([y,C])}}},a=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(u,d){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var g,p,m=h.call(u),w=[];try{for(;(d===void 0||d-- >0)&&!(g=m.next()).done;)w.push(g.value)}catch(v){p={error:v}}finally{try{g&&!g.done&&(h=m.return)&&h.call(m)}finally{if(p)throw p.error}}return w},c=this&&this.__spread||function(){for(var u=[],d=0;d<arguments.length;d++)u=u.concat(s(arguments[d]));return u};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);function f(u,d){var h,g;try{for(var p=a(u),m=p.next();!m.done;m=p.next()){var w=m.value;if(!d.has(w))return!1}}catch(v){h={error:v}}finally{try{m&&!m.done&&(g=p.return)&&g.call(p)}finally{if(h)throw h.error}}return!0}n.append=function(u,d){u.add(d)},n.extend=function(u,d){d.forEach(u.add,u)},n.prepend=function(u,d){var h=new Set(u);u.clear(),u.add(d),h.forEach(u.add,u)},n.replace=function(u,d,h){var g,p,m=new Set;try{for(var w=a(u),v=w.next();!v.done;v=w.next()){var y=v.value;l.isFunction(d)?d.call(null,y)?m.add(h):m.add(y):y===d?m.add(h):m.add(y)}}catch(C){g={error:C}}finally{try{v&&!v.done&&(p=w.return)&&p.call(w)}finally{if(g)throw g.error}}u.clear(),m.forEach(u.add,u)},n.insert=function(u,d,h){var g,p,m=new Set,w=0;try{for(var v=a(u),y=v.next();!y.done;y=v.next()){var C=y.value;w===h&&m.add(d),m.add(C),w++}}catch(x){g={error:x}}finally{try{y&&!y.done&&(p=v.return)&&p.call(v)}finally{if(g)throw g.error}}u.clear(),m.forEach(u.add,u)},n.remove=function(u,d){var h,g,p,m;if(l.isFunction(d)){var w=[];try{for(var v=a(u),y=v.next();!y.done;y=v.next()){var C=y.value;d.call(null,C)&&w.push(C)}}catch(_){h={error:_}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}try{for(var x=a(w),T=x.next();!T.done;T=x.next()){var S=T.value;u.delete(S)}}catch(_){p={error:_}}finally{try{T&&!T.done&&(m=x.return)&&m.call(x)}finally{if(p)throw p.error}}}else u.delete(d)},n.empty=function(u){u.clear()},n.contains=function(u,d){var h,g;if(!l.isFunction(d))return u.has(d);try{for(var p=a(u),m=p.next();!m.done;m=p.next()){var w=m.value;if(d.call(null,w))return!0}}catch(v){h={error:v}}finally{try{m&&!m.done&&(g=p.return)&&g.call(p)}finally{if(h)throw h.error}}return!1},n.size=function(u,d){var h,g;if(d===void 0)return u.size;var p=0;try{for(var m=a(u),w=m.next();!w.done;w=m.next()){var v=w.value;d.call(null,v)&&p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}return p},n.isEmpty=function(u){return u.size===0},n.forEach=function(u,d){var h,g,p,m,w,v;return o(this,(function(y){switch(y.label){case 0:return d!==void 0?[3,2]:[5,a(u)];case 1:return y.sent(),[3,9];case 2:y.trys.push([2,7,8,9]),h=a(u),g=h.next(),y.label=3;case 3:return g.done?[3,6]:(p=g.value,d.call(null,p)?[4,p]:[3,5]);case 4:y.sent(),y.label=5;case 5:return g=h.next(),[3,3];case 6:return[3,9];case 7:return m=y.sent(),w={error:m},[3,9];case 8:try{g&&!g.done&&(v=h.return)&&v.call(h)}finally{if(w)throw w.error}return[7];case 9:return[2]}}))},n.clone=function(u){return new Set(u)},n.sortInAscendingOrder=function(u,d){var h=new(Array.bind.apply(Array,c([void 0],u)));return h.sort((function(g,p){return d.call(null,g,p)?-1:1})),new Set(h)},n.sortInDescendingOrder=function(u,d){var h=new(Array.bind.apply(Array,c([void 0],u)));return h.sort((function(g,p){return d.call(null,g,p)?1:-1})),new Set(h)},n.isSubsetOf=f,n.isSupersetOf=function(u,d){return f(d,u)},n.intersection=function(u,d){var h,g,p=new Set;try{for(var m=a(u),w=m.next();!w.done;w=m.next()){var v=w.value;d.has(v)&&p.add(v)}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}return p},n.union=function(u,d){var h=new Set(u);return d.forEach(h.add,h),h},n.range=function(u,d){for(var h=new Set,g=u;g<=d;g++)h.add(g);return h}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.push=function(o,a){o.push(a)},n.pop=function(o){return o.pop()||null}},function(r,n,i){var o=this&&this.__values||function(w){var v=typeof Symbol=="function"&&Symbol.iterator,y=v&&w[v],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(96),s=i(147),c=i(146),l=i(1);function f(w,v){for(var y=0;;){var C=y<w.length?w.charCodeAt(y):null,x=y<v.length?v.charCodeAt(y):null;if(C===null)return!0;if(C!==x)return!1;y++}}function u(w){var v,y,C=Array.from(w),x=new Uint8Array(C.length),T=0;try{for(var S=o(w),_=S.next();!_.done;_=S.next()){var E=_.value.codePointAt(0);console.assert(E!==void 0&&E<=255,"isomorphicEncode requires string bytes to be less than or equal to 0x00FF."),E!==void 0&&E<=255&&(x[T++]=E)}}catch(D){v={error:D}}finally{try{_&&!_.done&&(y=S.return)&&y.call(S)}finally{if(v)throw v.error}}return x}function d(w){return/^[\u0000-\u007F]*$/.test(w)}function h(w){var v,y,C="";try{for(var x=o(w),T=x.next();!T.done;T=x.next()){var S=T.value,_=S.codePointAt(0);C+=_!==void 0&&_>=65&&_<=90?String.fromCodePoint(_+32):S}}catch(E){v={error:E}}finally{try{T&&!T.done&&(y=x.return)&&y.call(x)}finally{if(v)throw v.error}}return C}function g(w){return w.replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,"")}function p(w,v,y){if(!l.isArray(v))return p(w,Array.from(v),y);for(var C="";y.position<v.length&&w.call(null,v[y.position]);)C+=v[y.position],y.position++;return C}function m(w,v){p((function(y){return a.ASCIIWhiteSpace.test(y)}),w,v)}n.isCodeUnitPrefix=f,n.isCodeUnitLessThan=function(w,v){if(f(v,w))return!1;if(f(w,v))return!0;for(var y=0;y<Math.min(w.length,v.length);y++){var C=w.charCodeAt(y),x=v.charCodeAt(y);if(C!==x)return C<x}return!1},n.isomorphicEncode=u,n.isASCIIString=d,n.asciiLowercase=h,n.asciiUppercase=function(w){var v,y,C="";try{for(var x=o(w),T=x.next();!T.done;T=x.next()){var S=T.value,_=S.codePointAt(0);C+=_!==void 0&&_>=97&&_<=122?String.fromCodePoint(_-32):S}}catch(E){v={error:E}}finally{try{T&&!T.done&&(y=x.return)&&y.call(x)}finally{if(v)throw v.error}}return C},n.asciiCaseInsensitiveMatch=function(w,v){return h(w)===h(v)},n.asciiEncode=function(w){return console.assert(d(w),"asciiEncode requires an ASCII string."),u(w)},n.asciiDecode=function(w){var v,y;try{for(var C=o(w),x=C.next();!x.done;x=C.next()){var T=x.value;console.assert(c.isASCIIByte(T),"asciiDecode requires an ASCII byte sequence.")}}catch(S){v={error:S}}finally{try{x&&!x.done&&(y=C.return)&&y.call(C)}finally{if(v)throw v.error}}return s.isomorphicDecode(w)},n.stripNewlines=function(w){return w.replace(/[\n\r]/g,"")},n.normalizeNewlines=function(w){return w.replace(/\r\n/g,`
`).replace(/\r/g,`
`)},n.stripLeadingAndTrailingASCIIWhitespace=g,n.stripAndCollapseASCIIWhitespace=function(w){return g(w.replace(/[\t\n\f\r ]{2,}/g," "))},n.collectASequenceOfCodePoints=p,n.skipASCIIWhitespace=m,n.strictlySplit=function w(v,y){if(!l.isArray(v))return w(Array.from(v),y);var C={position:0},x=[],T=p((function(S){return y!==S}),v,C);for(x.push(T);C.position<v.length;)console.assert(v[C.position]===y,"strictlySplit found no delimiter in input string."),C.position++,T=p((function(S){return y!==S}),v,C),x.push(T);return x},n.splitAStringOnASCIIWhitespace=function w(v){if(!l.isArray(v))return w(Array.from(v));var y={position:0},C=[];for(m(v,y);y.position<v.length;){var x=p((function(T){return!a.ASCIIWhiteSpace.test(T)}),v,y);C.push(x),m(v,y)}return C},n.splitAStringOnCommas=function w(v){if(!l.isArray(v))return w(Array.from(v));for(var y={position:0},C=[];y.position<v.length;){var x=p((function(T){return T!==","}),v,y);C.push(g(x)),y.position<v.length&&(console.assert(v[y.position]===",","splitAStringOnCommas found no delimiter in input string."),y.position++)}return C},n.concatenate=function(w,v){return v===void 0&&(v=""),w.length===0?"":w.join(v)}},function(r,n,i){var o=this&&this.__values||function(s){var c=typeof Symbol=="function"&&Symbol.iterator,l=c&&s[c],f=0;if(l)return l.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&f>=s.length&&(s=void 0),{value:s&&s[f++],done:!s}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(97);n.abort_add=function(s,c){c._abortedFlag||c._abortAlgorithms.add(s)},n.abort_remove=function(s,c){c._abortAlgorithms.delete(s)},n.abort_signalAbort=function(s){var c,l;if(!s._abortedFlag){s._abortedFlag=!0;try{for(var f=o(s._abortAlgorithms),u=f.next();!u.done;u=f.next())u.value.call(s)}catch(d){c={error:d}}finally{try{u&&!u.done&&(l=f.return)&&l.call(f)}finally{if(c)throw c.error}}s._abortAlgorithms.clear(),a.event_fireAnEvent("abort",s)}}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(150),a=(function(){function s(){}return s.asNode=function(c){if(o.Guard.isNode(c))return c;throw new Error("Invalid object. Node expected.")},s})();n.Cast=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function s(){}return Object.defineProperty(s.prototype,"size",{get:function(){return 0},enumerable:!0,configurable:!0}),s.prototype.add=function(c){throw new Error("Cannot add to an empty set.")},s.prototype.clear=function(){},s.prototype.delete=function(c){return!1},s.prototype.forEach=function(c,l){},s.prototype.has=function(c){return!1},s.prototype[Symbol.iterator]=function(){return new a},s.prototype.entries=function(){return new a},s.prototype.keys=function(){return new a},s.prototype.values=function(){return new a},Object.defineProperty(s.prototype,Symbol.toStringTag,{get:function(){return"EmptySet"},enumerable:!0,configurable:!0}),s})();n.EmptySet=o;var a=(function(){function s(){}return s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){return{done:!0,value:null}},s})()},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),(function(o){o[o.SchemeStart=0]="SchemeStart",o[o.Scheme=1]="Scheme",o[o.NoScheme=2]="NoScheme",o[o.SpecialRelativeOrAuthority=3]="SpecialRelativeOrAuthority",o[o.PathOrAuthority=4]="PathOrAuthority",o[o.Relative=5]="Relative",o[o.RelativeSlash=6]="RelativeSlash",o[o.SpecialAuthoritySlashes=7]="SpecialAuthoritySlashes",o[o.SpecialAuthorityIgnoreSlashes=8]="SpecialAuthorityIgnoreSlashes",o[o.Authority=9]="Authority",o[o.Host=10]="Host",o[o.Hostname=11]="Hostname",o[o.Port=12]="Port",o[o.File=13]="File",o[o.FileSlash=14]="FileSlash",o[o.FileHost=15]="FileHost",o[o.PathStart=16]="PathStart",o[o.Path=17]="Path",o[o.CannotBeABaseURLPath=18]="CannotBeABaseURLPath",o[o.Query=19]="Query",o[o.Fragment=20]="Fragment"})(n.ParserState||(n.ParserState={})),n.OpaqueOrigin=["","",null,null]},function(r,n,i){var o=i(245),a=i(247);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=x,n.resolve=function(T,S){return x(T,!1,!0).resolve(S)},n.resolveObject=function(T,S){return T?x(T,!1,!0).resolveObject(S):S},n.format=function(T){return a.isString(T)&&(T=x(T)),T instanceof s?T.format():s.prototype.format.call(T)},n.Url=s;var c=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),d=["'"].concat(u),h=["%","/","?",";","#"].concat(d),g=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},C=i(248);function x(T,S,_){if(T&&a.isObject(T)&&T instanceof s)return T;var E=new s;return E.parse(T,S,_),E}s.prototype.parse=function(T,S,_){if(!a.isString(T))throw new TypeError("Parameter 'url' must be a string, not "+typeof T);var E=T.indexOf("?"),D=E!==-1&&E<T.indexOf("#")?"?":"#",b=T.split(D);b[0]=b[0].replace(/\\/g,"/");var I=T=b.join(D);if(I=I.trim(),!_&&T.split("#").length===1){var O=f.exec(I);if(O)return this.path=I,this.href=I,this.pathname=O[1],O[2]?(this.search=O[2],this.query=S?C.parse(this.search.substr(1)):this.search.substr(1)):S&&(this.search="",this.query={}),this}var M=c.exec(I);if(M){var R=(M=M[0]).toLowerCase();this.protocol=R,I=I.substr(M.length)}if(_||M||I.match(/^\/\/[^@\/]+@[^@\/]+/)){var A=I.substr(0,2)==="//";!A||M&&v[M]||(I=I.substr(2),this.slashes=!0)}if(!v[M]&&(A||M&&!y[M])){for(var B,k,L=-1,F=0;F<g.length;F++)(j=I.indexOf(g[F]))!==-1&&(L===-1||j<L)&&(L=j);for((k=L===-1?I.lastIndexOf("@"):I.lastIndexOf("@",L))!==-1&&(B=I.slice(0,k),I=I.slice(k+1),this.auth=decodeURIComponent(B)),L=-1,F=0;F<h.length;F++){var j;(j=I.indexOf(h[F]))!==-1&&(L===-1||j<L)&&(L=j)}L===-1&&(L=I.length),this.host=I.slice(0,L),I=I.slice(L),this.parseHost(),this.hostname=this.hostname||"";var J=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!J)for(var ie=this.hostname.split(/\./),fe=(F=0,ie.length);F<fe;F++){var ae=ie[F];if(ae&&!ae.match(p)){for(var de="",we=0,_e=ae.length;we<_e;we++)ae.charCodeAt(we)>127?de+="x":de+=ae[we];if(!de.match(p)){var Te=ie.slice(0,F),G=ie.slice(F+1),P=ae.match(m);P&&(Te.push(P[1]),G.unshift(P[2])),G.length&&(I="/"+G.join(".")+I),this.hostname=Te.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),J||(this.hostname=o.toASCII(this.hostname));var $=this.port?":"+this.port:"",W=this.hostname||"";this.host=W+$,this.href+=this.host,J&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!w[R])for(F=0,fe=d.length;F<fe;F++){var q=d[F];if(I.indexOf(q)!==-1){var Q=encodeURIComponent(q);Q===q&&(Q=escape(q)),I=I.split(q).join(Q)}}var ee=I.indexOf("#");ee!==-1&&(this.hash=I.substr(ee),I=I.slice(0,ee));var ge=I.indexOf("?");if(ge!==-1?(this.search=I.substr(ge),this.query=I.substr(ge+1),S&&(this.query=C.parse(this.query)),I=I.slice(0,ge)):S&&(this.search="",this.query={}),I&&(this.pathname=I),y[R]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){$=this.pathname||"";var De=this.search||"";this.path=$+De}return this.href=this.format(),this},s.prototype.format=function(){var T=this.auth||"";T&&(T=(T=encodeURIComponent(T)).replace(/%3A/i,":"),T+="@");var S=this.protocol||"",_=this.pathname||"",E=this.hash||"",D=!1,b="";this.host?D=T+this.host:this.hostname&&(D=T+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(D+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(b=C.stringify(this.query));var I=this.search||b&&"?"+b||"";return S&&S.substr(-1)!==":"&&(S+=":"),this.slashes||(!S||y[S])&&D!==!1?(D="//"+(D||""),_&&_.charAt(0)!=="/"&&(_="/"+_)):D||(D=""),E&&E.charAt(0)!=="#"&&(E="#"+E),I&&I.charAt(0)!=="?"&&(I="?"+I),S+D+(_=_.replace(/[?#]/g,(function(O){return encodeURIComponent(O)})))+(I=I.replace("#","%23"))+E},s.prototype.resolve=function(T){return this.resolveObject(x(T,!1,!0)).format()},s.prototype.resolveObject=function(T){if(a.isString(T)){var S=new s;S.parse(T,!1,!0),T=S}for(var _=new s,E=Object.keys(this),D=0;D<E.length;D++){var b=E[D];_[b]=this[b]}if(_.hash=T.hash,T.href==="")return _.href=_.format(),_;if(T.slashes&&!T.protocol){for(var I=Object.keys(T),O=0;O<I.length;O++){var M=I[O];M!=="protocol"&&(_[M]=T[M])}return y[_.protocol]&&_.hostname&&!_.pathname&&(_.path=_.pathname="/"),_.href=_.format(),_}if(T.protocol&&T.protocol!==_.protocol){if(!y[T.protocol]){for(var R=Object.keys(T),A=0;A<R.length;A++){var B=R[A];_[B]=T[B]}return _.href=_.format(),_}if(_.protocol=T.protocol,T.host||v[T.protocol])_.pathname=T.pathname;else{for(var k=(T.pathname||"").split("/");k.length&&!(T.host=k.shift()););T.host||(T.host=""),T.hostname||(T.hostname=""),k[0]!==""&&k.unshift(""),k.length<2&&k.unshift(""),_.pathname=k.join("/")}if(_.search=T.search,_.query=T.query,_.host=T.host||"",_.auth=T.auth,_.hostname=T.hostname||T.host,_.port=T.port,_.pathname||_.search){var L=_.pathname||"",F=_.search||"";_.path=L+F}return _.slashes=_.slashes||T.slashes,_.href=_.format(),_}var j=_.pathname&&_.pathname.charAt(0)==="/",J=T.host||T.pathname&&T.pathname.charAt(0)==="/",ie=J||j||_.host&&T.pathname,fe=ie,ae=_.pathname&&_.pathname.split("/")||[],de=(k=T.pathname&&T.pathname.split("/")||[],_.protocol&&!y[_.protocol]);if(de&&(_.hostname="",_.port=null,_.host&&(ae[0]===""?ae[0]=_.host:ae.unshift(_.host)),_.host="",T.protocol&&(T.hostname=null,T.port=null,T.host&&(k[0]===""?k[0]=T.host:k.unshift(T.host)),T.host=null),ie=ie&&(k[0]===""||ae[0]==="")),J)_.host=T.host||T.host===""?T.host:_.host,_.hostname=T.hostname||T.hostname===""?T.hostname:_.hostname,_.search=T.search,_.query=T.query,ae=k;else if(k.length)ae||(ae=[]),ae.pop(),ae=ae.concat(k),_.search=T.search,_.query=T.query;else if(!a.isNullOrUndefined(T.search))return de&&(_.hostname=_.host=ae.shift(),(P=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=P.shift(),_.host=_.hostname=P.shift())),_.search=T.search,_.query=T.query,a.isNull(_.pathname)&&a.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.href=_.format(),_;if(!ae.length)return _.pathname=null,_.search?_.path="/"+_.search:_.path=null,_.href=_.format(),_;for(var we=ae.slice(-1)[0],_e=(_.host||T.host||ae.length>1)&&(we==="."||we==="..")||we==="",Te=0,G=ae.length;G>=0;G--)(we=ae[G])==="."?ae.splice(G,1):we===".."?(ae.splice(G,1),Te++):Te&&(ae.splice(G,1),Te--);if(!ie&&!fe)for(;Te--;Te)ae.unshift("..");!ie||ae[0]===""||ae[0]&&ae[0].charAt(0)==="/"||ae.unshift(""),_e&&ae.join("/").substr(-1)!=="/"&&ae.push("");var P,$=ae[0]===""||ae[0]&&ae[0].charAt(0)==="/";return de&&(_.hostname=_.host=$?"":ae.length?ae.shift():"",(P=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=P.shift(),_.host=_.hostname=P.shift())),(ie=ie||_.host&&ae.length)&&!$&&ae.unshift(""),ae.length?_.pathname=ae.join("/"):(_.pathname=null,_.path=null),a.isNull(_.pathname)&&a.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.auth=T.auth||_.auth,_.slashes=_.slashes||T.slashes,_.href=_.format(),_},s.prototype.parseHost=function(){var T=this.host,S=l.exec(T);S&&((S=S[0])!==":"&&(this.port=S.substr(1)),T=T.substr(0,T.length-S.length)),T&&(this.hostname=T)}},function(r,n,i){(function(o,a){var s;(function(c){n&&n.nodeType,o&&o.nodeType;var l=typeof a=="object"&&a;l.global!==l&&l.window!==l&&l.self;var f,u=2147483647,d=/^xn--/,h=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,w=String.fromCharCode;function v(b){throw new RangeError(p[b])}function y(b,I){for(var O=b.length,M=[];O--;)M[O]=I(b[O]);return M}function C(b,I){var O=b.split("@"),M="";return O.length>1&&(M=O[0]+"@",b=O[1]),M+y((b=b.replace(g,".")).split("."),I).join(".")}function x(b){for(var I,O,M=[],R=0,A=b.length;R<A;)(I=b.charCodeAt(R++))>=55296&&I<=56319&&R<A?(64512&(O=b.charCodeAt(R++)))==56320?M.push(((1023&I)<<10)+(1023&O)+65536):(M.push(I),R--):M.push(I);return M}function T(b){return y(b,(function(I){var O="";return I>65535&&(O+=w((I-=65536)>>>10&1023|55296),I=56320|1023&I),O+=w(I)})).join("")}function S(b,I){return b+22+75*(b<26)-((I!=0)<<5)}function _(b,I,O){var M=0;for(b=O?m(b/700):b>>1,b+=m(b/I);b>455;M+=36)b=m(b/35);return m(M+36*b/(b+38))}function E(b){var I,O,M,R,A,B,k,L,F,j,J,ie=[],fe=b.length,ae=0,de=128,we=72;for((O=b.lastIndexOf("-"))<0&&(O=0),M=0;M<O;++M)b.charCodeAt(M)>=128&&v("not-basic"),ie.push(b.charCodeAt(M));for(R=O>0?O+1:0;R<fe;){for(A=ae,B=1,k=36;R>=fe&&v("invalid-input"),((L=(J=b.charCodeAt(R++))-48<10?J-22:J-65<26?J-65:J-97<26?J-97:36)>=36||L>m((u-ae)/B))&&v("overflow"),ae+=L*B,!(L<(F=k<=we?1:k>=we+26?26:k-we));k+=36)B>m(u/(j=36-F))&&v("overflow"),B*=j;we=_(ae-A,I=ie.length+1,A==0),m(ae/I)>u-de&&v("overflow"),de+=m(ae/I),ae%=I,ie.splice(ae++,0,de)}return T(ie)}function D(b){var I,O,M,R,A,B,k,L,F,j,J,ie,fe,ae,de,we=[];for(ie=(b=x(b)).length,I=128,O=0,A=72,B=0;B<ie;++B)(J=b[B])<128&&we.push(w(J));for(M=R=we.length,R&&we.push("-");M<ie;){for(k=u,B=0;B<ie;++B)(J=b[B])>=I&&J<k&&(k=J);for(k-I>m((u-O)/(fe=M+1))&&v("overflow"),O+=(k-I)*fe,I=k,B=0;B<ie;++B)if((J=b[B])<I&&++O>u&&v("overflow"),J==I){for(L=O,F=36;!(L<(j=F<=A?1:F>=A+26?26:F-A));F+=36)de=L-j,ae=36-j,we.push(w(S(j+de%ae,0))),L=m(de/ae);we.push(w(S(L,0))),A=_(O,fe,M==R),O=0,++M}++O,++I}return we.join("")}f={version:"1.4.1",ucs2:{decode:x,encode:T},decode:E,encode:D,toASCII:function(b){return C(b,(function(I){return h.test(I)?"xn--"+D(I):I}))},toUnicode:function(b){return C(b,(function(I){return d.test(I)?E(I.slice(4).toLowerCase()):I}))}},(s=(function(){return f}).call(n,i,n,o))===void 0||(o.exports=s)})()}).call(this,i(246)(r),i(78))},function(r,n){r.exports=function(i){return i.webpackPolyfill||(i.deprecate=function(){},i.paths=[],i.children||(i.children=[]),Object.defineProperty(i,"loaded",{enumerable:!0,get:function(){return i.l}}),Object.defineProperty(i,"id",{enumerable:!0,get:function(){return i.i}}),i.webpackPolyfill=1),i}},function(r,n,i){r.exports={isString:function(o){return typeof o=="string"},isObject:function(o){return typeof o=="object"&&o!==null},isNull:function(o){return o===null},isNullOrUndefined:function(o){return o==null}}},function(r,n,i){n.decode=n.parse=i(249),n.encode=n.stringify=i(250)},function(r,n,i){function o(s,c){return Object.prototype.hasOwnProperty.call(s,c)}r.exports=function(s,c,l,f){c=c||"&",l=l||"=";var u={};if(typeof s!="string"||s.length===0)return u;var d=/\+/g;s=s.split(c);var h=1e3;f&&typeof f.maxKeys=="number"&&(h=f.maxKeys);var g=s.length;h>0&&g>h&&(g=h);for(var p=0;p<g;++p){var m,w,v,y,C=s[p].replace(d,"%20"),x=C.indexOf(l);x>=0?(m=C.substr(0,x),w=C.substr(x+1)):(m=C,w=""),v=decodeURIComponent(m),y=decodeURIComponent(w),o(u,v)?a(u[v])?u[v].push(y):u[v]=[u[v],y]:u[v]=y}return u};var a=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"}},function(r,n,i){var o=function(l){switch(typeof l){case"string":return l;case"boolean":return l?"true":"false";case"number":return isFinite(l)?l:"";default:return""}};r.exports=function(l,f,u,d){return f=f||"&",u=u||"=",l===null&&(l=void 0),typeof l=="object"?s(c(l),(function(h){var g=encodeURIComponent(o(h))+u;return a(l[h])?s(l[h],(function(p){return g+encodeURIComponent(o(p))})).join(f):g+encodeURIComponent(o(l[h]))})).join(f):d?encodeURIComponent(o(d))+u+encodeURIComponent(o(l)):""};var a=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"};function s(l,f){if(l.map)return l.map(f);for(var u=[],d=0;d<l.length;d++)u.push(f(l[d],d));return u}var c=Object.keys||function(l){var f=[];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&f.push(u);return f}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(52);n.attr_setAnExistingAttributeValue=function(a,s){a._element===null?a._value=s:o.element_change(a,a._element,s)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(108),a=i(30),s=i(52);n.tokenList_validationSteps=function(c,l){if(!a.dom_hasSupportedTokens(c._attribute._localName))throw new TypeError("There are no supported tokens defined for attribute name: '"+c._attribute._localName+"'.");return a.dom_getSupportedTokens(c._attribute._localName).has(l.toLowerCase())},n.tokenList_updateSteps=function(c){(c._element.hasAttribute(c._attribute._localName)||c._tokenSet.size!==0)&&s.element_setAnAttributeValue(c._element,c._attribute._localName,o.orderedSet_serialize(c._tokenSet))},n.tokenList_serializeSteps=function(c){return s.element_getAnAttributeValue(c._element,c._attribute._localName)}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1);function s(c){return a.isBoolean(c)?c:c.capture||!1}n.eventTarget_flatten=s,n.eventTarget_flattenMore=function(c){var l=s(c),f=!1,u=!1;return a.isBoolean(c)||(f=c.once||!1,u=c.passive||!1),[l,u,f]},n.eventTarget_addEventListener=function(c,l){if(l.callback!==null){for(var f=0;f<c._eventListenerList.length;f++){var u=c._eventListenerList[f];if(u.type===l.type&&u.callback.handleEvent===l.callback.handleEvent&&u.capture===l.capture)return}c._eventListenerList.push(l)}},n.eventTarget_removeEventListener=function(c,l,f){l.removed=!0,c._eventListenerList.splice(f,1)},n.eventTarget_removeAllEventListeners=function(c){var l,f;try{for(var u=o(c._eventListenerList),d=u.next();!d.done;d=u.next())d.value.removed=!0}catch(h){l={error:h}}finally{try{d&&!d.done&&(f=u.return)&&f.call(u)}finally{if(l)throw l.error}}c._eventListenerList.length=0}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1),s=i(29);n.parentNode_convertNodesIntoANode=function(c,l){for(var f,u,d=null,h=0;h<c.length;h++){var g=c[h];if(a.isString(g)){var p=s.create_text(l,g);c[h]=p}}if(c.length===1)d=c[0];else{var m=d=s.create_documentFragment(l);try{for(var w=o(c),v=w.next();!v.done;v=w.next())g=v.value,m.appendChild(g)}catch(y){f={error:y}}finally{try{v&&!v.done&&(u=w.return)&&u.call(w)}finally{if(f)throw f.error}}}return d}},function(r,n,i){var o=this&&this.__values||function(S){var _=typeof Symbol=="function"&&Symbol.iterator,E=_&&S[_],D=0;if(E)return E.call(S);if(S&&typeof S.length=="number")return{next:function(){return S&&D>=S.length&&(S=void 0),{value:S&&S[D++],done:!S}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(S,_){var E=typeof Symbol=="function"&&S[Symbol.iterator];if(!E)return S;var D,b,I=E.call(S),O=[];try{for(;(_===void 0||_-- >0)&&!(D=I.next()).done;)O.push(D.value)}catch(M){b={error:M}}finally{try{D&&!D.done&&(E=I.return)&&E.call(I)}finally{if(b)throw b.error}}return O},s=this&&this.__spread||function(){for(var S=[],_=0;_<arguments.length;_++)S=S.concat(a(arguments[_]));return S};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(9),f=i(3),u=i(29),d=i(17),h=i(175),g=i(107),p=i(176),m=i(37),w=i(177);function v(S){return S._startNode===S._endNode&&S._startOffset===S._endOffset}function y(S){return d.tree_rootNode(S._startNode)}function C(S,_){return d.tree_rootNode(S)===y(_)&&h.boundaryPoint_position([S,0],_._start)===c.BoundaryPosition.After&&h.boundaryPoint_position([S,d.tree_nodeLength(S)],_._end)===c.BoundaryPosition.Before}function x(S,_){var E=d.tree_isAncestorOf(_._startNode,S,!0),D=d.tree_isAncestorOf(_._endNode,S,!0);return E&&!D||!E&&D}function T(S){var _,E,D,b,I,O,M=u.create_documentFragment(S._startNode._nodeDocument);if(v(S))return M;var R=S._startNode,A=S._startOffset,B=S._endNode,k=S._endOffset;if(R===B&&f.Guard.isCharacterDataNode(R))return(W=p.node_clone(R))._data=g.characterData_substringData(R,A,k-A),m.mutation_append(W,M),g.characterData_replaceData(R,A,k-A,""),M;for(var L=R;!d.tree_isAncestorOf(B,L,!0);){if(L._parent===null)throw new Error("Parent node  is null.");L=L._parent}var F=null;if(!d.tree_isAncestorOf(B,R,!0))try{for(var j=o(L._children),J=j.next();!J.done;J=j.next())if(x(de=J.value,S)){F=de;break}}catch(De){_={error:De}}finally{try{J&&!J.done&&(E=j.return)&&E.call(j)}finally{if(_)throw _.error}}var ie=null;if(!d.tree_isAncestorOf(R,B,!0))for(var fe=s(L._children),ae=fe.length-1;ae>0;ae--){var de;if(x(de=fe[ae],S)){ie=de;break}}var we,_e,Te=[];try{for(var G=o(L._children),P=G.next();!P.done;P=G.next())if(C(ge=P.value,S)){if(f.Guard.isDocumentTypeNode(ge))throw new l.HierarchyRequestError;Te.push(ge)}}catch(De){D={error:De}}finally{try{P&&!P.done&&(b=G.return)&&b.call(G)}finally{if(D)throw D.error}}if(d.tree_isAncestorOf(B,R,!0))we=R,_e=A;else{for(var $=R;$._parent!==null&&!d.tree_isAncestorOf(B,$._parent);)$=$._parent;if($._parent===null)throw new Error("Parent node is null.");we=$._parent,_e=1+d.tree_index($)}if(f.Guard.isCharacterDataNode(F))(W=p.node_clone(R))._data=g.characterData_substringData(R,A,d.tree_nodeLength(R)-A),m.mutation_append(W,M),g.characterData_replaceData(R,A,d.tree_nodeLength(R)-A,"");else if(F!==null){var W=p.node_clone(F);m.mutation_append(W,M);var q=T(u.create_range([R,A],[F,d.tree_nodeLength(F)]));m.mutation_append(q,W)}try{for(var Q=o(Te),ee=Q.next();!ee.done;ee=Q.next()){var ge=ee.value;m.mutation_append(ge,M)}}catch(De){I={error:De}}finally{try{ee&&!ee.done&&(O=Q.return)&&O.call(Q)}finally{if(I)throw I.error}}return f.Guard.isCharacterDataNode(ie)?((W=p.node_clone(B))._data=g.characterData_substringData(B,0,k),m.mutation_append(W,M),g.characterData_replaceData(B,0,k,"")):ie!==null&&(W=p.node_clone(ie),m.mutation_append(W,M),q=T(u.create_range([ie,0],[B,k])),m.mutation_append(q,W)),S._start=[we,_e],S._end=[we,_e],M}n.range_collapsed=v,n.range_root=y,n.range_isContained=C,n.range_isPartiallyContained=x,n.range_setTheStart=function(S,_,E){if(f.Guard.isDocumentTypeNode(_))throw new l.InvalidNodeTypeError;if(E>d.tree_nodeLength(_))throw new l.IndexSizeError;var D=[_,E];y(S)===d.tree_rootNode(_)&&h.boundaryPoint_position(D,S._end)!==c.BoundaryPosition.After||(S._end=D),S._start=D},n.range_setTheEnd=function(S,_,E){if(f.Guard.isDocumentTypeNode(_))throw new l.InvalidNodeTypeError;if(E>d.tree_nodeLength(_))throw new l.IndexSizeError;var D=[_,E];y(S)===d.tree_rootNode(_)&&h.boundaryPoint_position(D,S._start)!==c.BoundaryPosition.Before||(S._start=D),S._end=D},n.range_select=function(S,_){var E=S._parent;if(E===null)throw new l.InvalidNodeTypeError;var D=d.tree_index(S);_._start=[E,D],_._end=[E,D+1]},n.range_extract=T,n.range_cloneTheContents=function S(_){var E,D,b,I,O,M,R=u.create_documentFragment(_._startNode._nodeDocument);if(v(_))return R;var A=_._startNode,B=_._startOffset,k=_._endNode,L=_._endOffset;A===k&&f.Guard.isCharacterDataNode(A)&&((P=p.node_clone(A))._data=g.characterData_substringData(A,B,L-B),m.mutation_append(P,R));for(var F=A;!d.tree_isAncestorOf(k,F,!0);){if(F._parent===null)throw new Error("Parent node  is null.");F=F._parent}var j=null;if(!d.tree_isAncestorOf(k,A,!0))try{for(var J=o(F._children),ie=J.next();!ie.done;ie=J.next())if(x(we=ie.value,_)){j=we;break}}catch(ee){E={error:ee}}finally{try{ie&&!ie.done&&(D=J.return)&&D.call(J)}finally{if(E)throw E.error}}var fe=null;if(!d.tree_isAncestorOf(A,k,!0))for(var ae=s(F._children),de=ae.length-1;de>0;de--){var we;if(x(we=ae[de],_)){fe=we;break}}var _e=[];try{for(var Te=o(F._children),G=Te.next();!G.done;G=Te.next())if(C(Q=G.value,_)){if(f.Guard.isDocumentTypeNode(Q))throw new l.HierarchyRequestError;_e.push(Q)}}catch(ee){b={error:ee}}finally{try{G&&!G.done&&(I=Te.return)&&I.call(Te)}finally{if(b)throw b.error}}if(f.Guard.isCharacterDataNode(j))(P=p.node_clone(A))._data=g.characterData_substringData(A,B,d.tree_nodeLength(A)-B),m.mutation_append(P,R);else if(j!==null){var P=p.node_clone(j);m.mutation_append(P,R);var $=S(u.create_range([A,B],[j,d.tree_nodeLength(j)]));m.mutation_append($,P)}try{for(var W=o(_e),q=W.next();!q.done;q=W.next()){var Q=q.value,P=p.node_clone(Q);m.mutation_append(P,R)}}catch(ee){O={error:ee}}finally{try{q&&!q.done&&(M=W.return)&&M.call(W)}finally{if(O)throw O.error}}return f.Guard.isCharacterDataNode(fe)?((P=p.node_clone(k))._data=g.characterData_substringData(k,0,L),m.mutation_append(P,R)):fe!==null&&(P=p.node_clone(fe),R.append(P),$=T(u.create_range([fe,0],[k,L])),m.mutation_append($,P)),R},n.range_insert=function(S,_){var E,D;if(f.Guard.isProcessingInstructionNode(_._startNode)||f.Guard.isCommentNode(_._startNode)||f.Guard.isTextNode(_._startNode)&&_._startNode._parent===null||_._startNode===S)throw new l.HierarchyRequestError;var b,I=null;if(f.Guard.isTextNode(_._startNode))I=_._startNode;else{var O=0;try{for(var M=o(_._startNode._children),R=M.next();!R.done;R=M.next()){var A=R.value;if(O===_._startOffset){I=A;break}O++}}catch(k){E={error:k}}finally{try{R&&!R.done&&(D=M.return)&&D.call(M)}finally{if(E)throw E.error}}}if(I===null)b=_._startNode;else{if(I._parent===null)throw new Error("Parent node is null.");b=I._parent}m.mutation_ensurePreInsertionValidity(S,b,I),f.Guard.isTextNode(_._startNode)&&(I=w.text_split(_._startNode,_._startOffset)),S===I&&(I=S._nextSibling),S._parent!==null&&m.mutation_remove(S,S._parent);var B=I===null?d.tree_nodeLength(b):d.tree_index(I);f.Guard.isDocumentFragmentNode(S)?B+=d.tree_nodeLength(S):B++,m.mutation_preInsert(S,b,I),v(_)&&(_._end=[b,B])},n.range_getContainedNodes=function(S){var _;return(_={})[Symbol.iterator]=function(){var E=S.commonAncestorContainer,D=d.tree_getFirstDescendantNode(E);return{next:function(){for(;D&&!C(D,S);)D=d.tree_getNextDescendantNode(E,D);if(D===null)return{done:!0,value:null};var b={done:!1,value:D};return D=d.tree_getNextDescendantNode(E,D),b}}},_},n.range_getPartiallyContainedNodes=function(S){var _;return(_={})[Symbol.iterator]=function(){var E=S.commonAncestorContainer,D=d.tree_getFirstDescendantNode(E);return{next:function(){for(;D&&!x(D,S);)D=d.tree_getNextDescendantNode(E,D);if(D===null)return{done:!0,value:null};var b={done:!1,value:D};return D=d.tree_getNextDescendantNode(E,D),b}}},_}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(9);n.selectors_scopeMatchASelectorsString=function(a,s){throw new o.NotSupportedError}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(105);n.treeWalker_traverseChildren=function(s,c){for(var l=c?s._current._firstChild:s._current._lastChild;l!==null;){var f=a.traversal_filter(s,l);if(f===o.FilterResult.Accept)return s._current=l,l;if(f===o.FilterResult.Skip){var u=c?l._firstChild:l._lastChild;if(u!==null){l=u;continue}}for(;l!==null;){var d=c?l._nextSibling:l._previousSibling;if(d!==null){l=d;break}var h=l._parent;if(h===null||h===s._root||h===s._current)return null;l=h}}return null},n.treeWalker_traverseSiblings=function(s,c){var l=s._current;if(l===s._root)return null;for(;;){for(var f=c?l._nextSibling:l._previousSibling;f!==null;){l=f;var u=a.traversal_filter(s,l);if(u===o.FilterResult.Accept)return s._current=l,l;f=c?l._firstChild:l._lastChild,u!==o.FilterResult.Reject&&f!==null||(f=c?l._nextSibling:l._previousSibling)}if((l=l._parent)===null||l===s._root||a.traversal_filter(s,l)===o.FilterResult.Accept)return null}}},function(r,n,i){i(89),i(74);var o,a=this&&this.__extends||(o=function(d,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var m in p)p.hasOwnProperty(m)&&(g[m]=p[m])})(d,h)},function(d,h){function g(){this.constructor=d}o(d,h),d.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=i(2),l=i(50),f=i(3),u=(function(d){function h(g,p){var m=d.call(this,g)||this;return m._indentation={},m._lengthToLastNewline=0,m._writerOptions=s.applyDefaults(p,{wellFormed:!1,headless:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,indentTextOnlyNodes:!1,spaceBeforeSlash:!1}),m}return a(h,d),h.prototype.serialize=function(g){return this._refs={suppressPretty:!1,emptyNode:!1,markup:""},g.nodeType!==c.NodeType.Document||this._writerOptions.headless||this.declaration(this._builderOptions.version,this._builderOptions.encoding,this._builderOptions.standalone),this.serializeNode(g,this._writerOptions.wellFormed),this._writerOptions.prettyPrint&&this._refs.markup.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(this._refs.markup=this._refs.markup.slice(0,-this._writerOptions.newline.length)),this._refs.markup},h.prototype.declaration=function(g,p,m){this._beginLine(),this._refs.markup+='<?xml version="'+g+'"',p!==void 0&&(this._refs.markup+=' encoding="'+p+'"'),m!==void 0&&(this._refs.markup+=' standalone="'+(m?"yes":"no")+'"'),this._refs.markup+="?>",this._endLine()},h.prototype.docType=function(g,p,m){this._beginLine(),this._refs.markup+=p&&m?"<!DOCTYPE "+g+' PUBLIC "'+p+'" "'+m+'">':p?"<!DOCTYPE "+g+' PUBLIC "'+p+'">':m?"<!DOCTYPE "+g+' SYSTEM "'+m+'">':"<!DOCTYPE "+g+">",this._endLine()},h.prototype.openTagBegin=function(g){this._beginLine(),this._refs.markup+="<"+g},h.prototype.openTagEnd=function(g,p,m){if(this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._writerOptions.prettyPrint&&!p&&!m){for(var w=!0,v=!0,y=this.currentNode.firstChild,C=0,x=0;y;){if(f.Guard.isExclusiveTextNode(y))x++;else{if(!f.Guard.isCDATASectionNode(y)){w=!1,v=!1;break}C++}y.data!==""&&(v=!1),y=y.nextSibling}this._refs.suppressPretty=!this._writerOptions.indentTextOnlyNodes&&w&&(C<=1&&x===0||C===0),this._refs.emptyNode=v}(m||p||this._refs.emptyNode)&&this._writerOptions.allowEmptyTags?this._refs.markup+="></"+g+">":this._refs.markup+=m?" />":p||this._refs.emptyNode?this._writerOptions.spaceBeforeSlash?" />":"/>":">",this._endLine()},h.prototype.closeTag=function(g){this._refs.emptyNode||(this._beginLine(),this._refs.markup+="</"+g+">"),this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._endLine()},h.prototype.attribute=function(g,p){var m=g+'="'+p+'"';this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._refs.markup.length-this._lengthToLastNewline+1+m.length>this._writerOptions.width?(this._endLine(),this._beginLine(),this._refs.markup+=this._indent(1)+m):this._refs.markup+=" "+m},h.prototype.text=function(g){g!==""&&(this._beginLine(),this._refs.markup+=g,this._endLine())},h.prototype.cdata=function(g){g!==""&&(this._beginLine(),this._refs.markup+="<![CDATA["+g+"]]>",this._endLine())},h.prototype.comment=function(g){this._beginLine(),this._refs.markup+="<!--"+g+"-->",this._endLine()},h.prototype.instruction=function(g,p){this._beginLine(),this._refs.markup+="<?"+(p===""?g:g+" "+p)+"?>",this._endLine()},h.prototype._beginLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._indent(this._writerOptions.offset+this.level))},h.prototype._endLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._writerOptions.newline,this._lengthToLastNewline=this._refs.markup.length)},h.prototype._indent=function(g){if(g<=0)return"";if(this._indentation[g]!==void 0)return this._indentation[g];var p=this._writerOptions.indent.repeat(g);return this._indentation[g]=p,p},h})(l.BaseWriter);n.XMLWriter=u},function(r,n,i){var o=i(47),a=i(35);r.exports="".repeat||function(s){var c=String(a(this)),l="",f=o(s);if(f<0||f==1/0)throw RangeError("Wrong number of repetitions");for(;f>0;(f>>>=1)&&(c+=c))1&f&&(l+=c);return l}},function(r,n,i){i(31),i(32),i(33),i(19),i(178),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}),s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(67),l=i(1),f=(function(u){function d(h,g){var p=u.call(this,h)||this;return p._writerOptions=l.applyDefaults(g,{wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),p}return a(d,u),d.prototype.serialize=function(h){var g=l.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),p=new c.ObjectWriter(this._builderOptions,g).serialize(h);return this._beginLine(this._writerOptions,0)+this._convertObject(p,this._writerOptions)},d.prototype._convertObject=function(h,g,p){var m,w,v=this;p===void 0&&(p=0);var y="",C=this._isLeafNode(h);if(l.isArray(h)){y+="[";var x=h.length,T=0;try{for(var S=s(h),_=S.next();!_.done;_=S.next()){var E=_.value;y+=this._endLine(g,p+1)+this._beginLine(g,p+1)+this._convertObject(E,g,p+1),T<x-1&&(y+=","),T++}}catch(I){m={error:I}}finally{try{_&&!_.done&&(w=S.return)&&w.call(S)}finally{if(m)throw m.error}}y+=this._endLine(g,p)+this._beginLine(g,p),y+="]"}else if(l.isObject(h)){y+="{";var D=l.objectLength(h),b=0;l.forEachObject(h,(function(I,O){C&&g.prettyPrint?y+=" ":y+=v._endLine(g,p+1)+v._beginLine(g,p+1),y+=v._key(I),g.prettyPrint&&(y+=" "),y+=v._convertObject(O,g,p+1),b<D-1&&(y+=","),b++}),this),C&&g.prettyPrint?y+=" ":y+=this._endLine(g,p)+this._beginLine(g,p),y+="}"}else y+=this._val(h);return y},d.prototype._beginLine=function(h,g){if(!h.prettyPrint)return"";var p=h.offset+g+1;return p>0?new Array(p).join(h.indent):""},d.prototype._endLine=function(h,g){return h.prettyPrint?h.newline:""},d.prototype._key=function(h){return'"'+h+'":'},d.prototype._val=function(h){return JSON.stringify(h)},d.prototype._isLeafNode=function(h){return this._descendantCount(h)<=1},d.prototype._descendantCount=function(h,g){var p=this;return g===void 0&&(g=0),l.isArray(h)?l.forEachArray(h,(function(m){return g+=p._descendantCount(m,g)}),this):l.isObject(h)?l.forEachObject(h,(function(m,w){return g+=p._descendantCount(w,g)}),this):g++,g},d})(i(50).BaseWriter);n.JSONWriter=f},function(r,n,i){i(31),i(32),i(33),i(19),i(178),i(89),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}),s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(67),l=i(1),f=(function(u){function d(h,g){var p=u.call(this,h)||this;if(p._writerOptions=l.applyDefaults(g,{wellFormed:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),p._writerOptions.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(p._writerOptions.offset<0)throw new Error("YAML offset should be zero or a positive number.");return p}return a(d,u),d.prototype.serialize=function(h){var g=l.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),p=new c.ObjectWriter(this._builderOptions,g).serialize(h),m=this._beginLine(this._writerOptions,0)+"---"+this._endLine(this._writerOptions)+this._convertObject(p,this._writerOptions,0);return m.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(m=m.slice(0,-this._writerOptions.newline.length)),m},d.prototype._convertObject=function(h,g,p,m){var w,v,y=this;m===void 0&&(m=!1);var C="";if(l.isArray(h))try{for(var x=s(h),T=x.next();!T.done;T=x.next()){var S=T.value;C+=this._beginLine(g,p,!0),l.isObject(S)?l.isEmpty(S)?C+='""'+this._endLine(g):C+=this._convertObject(S,g,p,!0):C+=this._val(S)+this._endLine(g)}}catch(_){w={error:_}}finally{try{T&&!T.done&&(v=x.return)&&v.call(x)}finally{if(w)throw w.error}}else l.forEachObject(h,(function(_,E){m?(C+=y._key(_),m=!1):C+=y._beginLine(g,p)+y._key(_),l.isObject(E)?l.isEmpty(E)?C+=' ""'+y._endLine(g):C+=y._endLine(g)+y._convertObject(E,g,p+1):C+=" "+y._val(E)+y._endLine(g)}),this);return C},d.prototype._beginLine=function(h,g,p){p===void 0&&(p=!1);var m=h.offset+g+1,w=new Array(m).join(h.indent);return p?w.substr(0,w.length-2)+"-"+w.substr(-1,1):w},d.prototype._endLine=function(h){return h.newline},d.prototype._key=function(h){return'"'+h+'":'},d.prototype._val=function(h){return JSON.stringify(h)},d})(i(50).BaseWriter);n.YAMLWriter=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),i(110).dom.setFeatures(!0);var o=i(110);n.DOMImplementation=o.DOMImplementation;var a=i(271);n.DOMParser=a.DOMParser;var s=i(274);n.XMLSerializer=s.XMLSerializer},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=i(0),s=(function(){function c(){}return c.prototype.before=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];var u=o.Cast.asNode(this),d=u._parent;if(d!==null){for(var h=u._previousSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var m=l[p];if(m===h){h=h._previousSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);h=h===null?d._firstChild:h._nextSibling,a.mutation_preInsert(w,d,h)}},c.prototype.after=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];var u=o.Cast.asNode(this),d=u._parent;if(d){for(var h=u._nextSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var m=l[p];if(m===h){h=h._nextSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);a.mutation_preInsert(w,d,h)}},c.prototype.replaceWith=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];var u=o.Cast.asNode(this),d=u._parent;if(d){for(var h=u._nextSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var m=l[p];if(m===h){h=h._nextSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);u._parent===d?a.mutation_replace(u,w,d):a.mutation_preInsert(w,d,h)}},c.prototype.remove=function(){var l=o.Cast.asNode(this),f=l._parent;f&&a.mutation_remove(l,f)},c})();n.ChildNodeImpl=s},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){};n.DocumentOrShadowRootImpl=o},function(r,n,i){var o=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(7),l=(function(){function f(u){this._nodeList=[],this._recordQueue=[],this._callback=u;var d=a.dom.window;c.set.append(d._mutationObservers,this)}return f.prototype.observe=function(u,d){var h,g;if((d=d||{childList:!1,subtree:!1}).attributeOldValue===void 0&&d.attributeFilter===void 0||d.attributes!==void 0||(d.attributes=!0),d.characterDataOldValue!==void 0&&d.characterData===void 0&&(d.characterData=!0),!d.childList&&!d.attributes&&!d.characterData)throw new TypeError;if(d.attributeOldValue&&!d.attributes)throw new TypeError;if(d.attributeFilter!==void 0&&!d.attributes)throw new TypeError;if(d.characterDataOldValue&&!d.characterData)throw new TypeError;var p=!1,m=d,w=function(x){var T,S;if(x.observer===v){p=!0;try{for(var _=(T=void 0,o(v._nodeList)),E=_.next();!E.done;E=_.next()){var D=E.value;c.list.remove(D._registeredObserverList,(function(b){return s.Guard.isTransientRegisteredObserver(b)&&b.source===x}))}}catch(b){T={error:b}}finally{try{E&&!E.done&&(S=_.return)&&S.call(_)}finally{if(T)throw T.error}}x.options=m}},v=this;try{for(var y=o(u._registeredObserverList),C=y.next();!C.done;C=y.next())w(C.value)}catch(x){h={error:x}}finally{try{C&&!C.done&&(g=y.return)&&g.call(y)}finally{if(h)throw h.error}}p||(u._registeredObserverList.push({observer:this,options:d}),this._nodeList.push(u))},f.prototype.disconnect=function(){var u,d,h=this;try{for(var g=o(this._nodeList),p=g.next();!p.done;p=g.next()){var m=p.value;c.list.remove(m._registeredObserverList,(function(w){return w.observer===h}))}}catch(w){u={error:w}}finally{try{p&&!p.done&&(d=g.return)&&d.call(g)}finally{if(u)throw u.error}}this._recordQueue=[]},f.prototype.takeRecords=function(){var u=this._recordQueue;return this._recordQueue=[],u},f})();n.MutationObserverImpl=l},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=(function(){function s(){}return Object.defineProperty(s.prototype,"previousElementSibling",{get:function(){for(var c=o.Cast.asNode(this)._previousSibling;c;){if(o.Guard.isElementNode(c))return c;c=c._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"nextElementSibling",{get:function(){for(var c=o.Cast.asNode(this)._nextSibling;c;){if(o.Guard.isElementNode(c))return c;c=c._nextSibling}return null},enumerable:!0,configurable:!0}),s})();n.NonDocumentTypeChildNodeImpl=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=i(0),s=(function(){function c(){}return c.prototype.getElementById=function(l){for(var f=a.tree_getFirstDescendantNode(o.Cast.asNode(this),!1,!1,(function(u){return o.Guard.isElementNode(u)}));f!==null;){if(f._uniqueIdentifier===l)return f;f=a.tree_getNextDescendantNode(o.Cast.asNode(this),f,!1,!1,(function(u){return o.Guard.isElementNode(u)}))}return null},c})();n.NonElementParentNodeImpl=s},function(r,n,i){var o=this&&this.__values||function(l){var f=typeof Symbol=="function"&&Symbol.iterator,u=f&&l[f],d=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&d>=l.length&&(l=void 0),{value:l&&l[d++],done:!l}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(3),s=i(0),c=(function(){function l(){}return Object.defineProperty(l.prototype,"children",{get:function(){return s.create_htmlCollection(a.Cast.asNode(this))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"firstElementChild",{get:function(){for(var f=a.Cast.asNode(this)._firstChild;f;){if(a.Guard.isElementNode(f))return f;f=f._nextSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"lastElementChild",{get:function(){for(var f=a.Cast.asNode(this)._lastChild;f;){if(a.Guard.isElementNode(f))return f;f=f._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"childElementCount",{get:function(){var f,u,d=0;try{for(var h=o(a.Cast.asNode(this)._children),g=h.next();!g.done;g=h.next()){var p=g.value;a.Guard.isElementNode(p)&&d++}}catch(m){f={error:m}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(f)throw f.error}}return d},enumerable:!0,configurable:!0}),l.prototype.prepend=function(){for(var f=[],u=0;u<arguments.length;u++)f[u]=arguments[u];var d=a.Cast.asNode(this),h=s.parentNode_convertNodesIntoANode(f,d._nodeDocument);s.mutation_preInsert(h,d,d._firstChild)},l.prototype.append=function(){for(var f=[],u=0;u<arguments.length;u++)f[u]=arguments[u];var d=a.Cast.asNode(this),h=s.parentNode_convertNodesIntoANode(f,d._nodeDocument);s.mutation_append(h,d)},l.prototype.querySelector=function(f){var u=a.Cast.asNode(this),d=s.selectors_scopeMatchASelectorsString(f,u);return d.length===0?null:d[0]},l.prototype.querySelectorAll=function(f){var u=a.Cast.asNode(this),d=s.selectors_scopeMatchASelectorsString(f,u);return s.create_nodeListStatic(u,d)},l})();n.ParentNodeImpl=c},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=(function(){function s(){}return Object.defineProperty(s.prototype,"_name",{get:function(){return this.__name||""},set:function(c){this.__name=c},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_assignedSlot",{get:function(){return this.__assignedSlot||null},set:function(c){this.__assignedSlot=c},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"assignedSlot",{get:function(){return o.shadowTree_findASlot(this,!0)},enumerable:!0,configurable:!0}),s})();n.SlotableImpl=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(102),c=i(9),l=i(3),f=(function(u){function d(h){var g=u.call(this)||this;if(l.Guard.isDocumentTypeNode(h.startContainer)||l.Guard.isAttrNode(h.startContainer)||l.Guard.isDocumentTypeNode(h.endContainer)||l.Guard.isAttrNode(h.endContainer))throw new c.InvalidNodeTypeError;return g._start=[h.startContainer,h.startOffset],g._end=[h.endContainer,h.endOffset],g}return a(d,u),d})(s.AbstractRangeImpl);n.StaticRangeImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(272);n.DOMParser=o.DOMParserImpl},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=i(273),s=(function(){function c(){}return c.prototype.parseFromString=function(l,f){if(f==="text/html")throw new Error("HTML parser not implemented.");try{return(u=new a.XMLParserImpl().parse(l))._contentType=f,u}catch(p){var u,d="http://www.mozilla.org/newlayout/xml/parsererror.xml",h=(u=o.create_xmlDocument()).createElementNS(d,"parsererror"),g=u.createElementNS(d,"error");return g.setAttribute("message",p.message),h.appendChild(g),u.appendChild(h),u}},c})();n.DOMParserImpl=s},function(r,n,i){var o=this&&this.__read||function(h,g){var p=typeof Symbol=="function"&&h[Symbol.iterator];if(!p)return h;var m,w,v=p.call(h),y=[];try{for(;(g===void 0||g-- >0)&&!(m=v.next()).done;)y.push(m.value)}catch(C){w={error:C}}finally{try{m&&!m.done&&(p=v.return)&&p.call(v)}finally{if(w)throw w.error}}return y},a=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],m=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&m>=h.length&&(h=void 0),{value:h&&h[m++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(180),c=i(111),l=i(7),f=i(0),u=i(69),d=(function(){function h(){}return h.prototype.parse=function(g){for(var p,m,w,v,y=new s.XMLStringLexer(g,{skipWhitespaceOnlyText:!0}),C=f.create_document(),x=C,T=y.nextToken();T.type!==c.TokenType.EOF;){switch(T.type){case c.TokenType.Declaration:var S=T;if(S.version!=="1.0")throw new Error("Invalid xml version: "+S.version);break;case c.TokenType.DocType:var _=T;if(!f.xml_isPubidChar(_.pubId))throw new Error("DocType public identifier does not match PubidChar construct.");if(!f.xml_isLegalChar(_.sysId)||_.sysId.indexOf('"')!==-1&&_.sysId.indexOf("'")!==-1)throw new Error("DocType system identifier contains invalid characters.");x.appendChild(C.implementation.createDocumentType(_.name,_.pubId,_.sysId));break;case c.TokenType.CDATA:var E=T;if(!f.xml_isLegalChar(E.data)||E.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters.");x.appendChild(C.createCDATASection(E.data));break;case c.TokenType.Comment:var D=T;if(!f.xml_isLegalChar(D.data)||D.data.indexOf("--")!==-1||D.data.endsWith("-"))throw new Error("Comment data contains invalid characters.");x.appendChild(C.createComment(D.data));break;case c.TokenType.PI:var b=T;if(b.target.indexOf(":")!==-1||/^xml$/i.test(b.target))throw new Error("Processing instruction target contains invalid characters.");if(!f.xml_isLegalChar(b.data)||b.data.indexOf("?>")!==-1)throw new Error("Processing instruction data contains invalid characters.");x.appendChild(C.createProcessingInstruction(b.target,b.data));break;case c.TokenType.Text:var I=T;if(!f.xml_isLegalChar(I.data))throw new Error("Text data contains invalid characters.");x.appendChild(C.createTextNode(this._decodeText(I.data)));break;case c.TokenType.Element:var O=T,M=o(f.namespace_extractQName(O.name),2),R=M[0],A=M[1];if(A.indexOf(":")!==-1||!f.xml_isName(A))throw new Error("Node local name contains invalid characters.");if(R==="xmlns")throw new Error("An element cannot have the 'xmlns' prefix.");var B=x.lookupNamespaceURI(R),k={};try{for(var L=(p=void 0,a(O.attributes)),F=L.next();!F.done;F=L.next()){var j=o(F.value,2),J=j[0],ie=j[1];if(J==="xmlns")B=ie;else{var fe=o(f.namespace_extractQName(J),2),ae=fe[0],de=fe[1];ae==="xmlns"&&(de===R&&(B=ie),k[de]=ie)}}}catch(q){p={error:q}}finally{try{F&&!F.done&&(m=L.return)&&m.call(L)}finally{if(p)throw p.error}}var we=B!==null?C.createElementNS(B,O.name):C.createElement(O.name);x.appendChild(we);var _e=new u.LocalNameSet;try{for(var Te=(w=void 0,a(O.attributes)),G=Te.next();!G.done;G=Te.next()){var P=o(G.value,2),$=(J=P[0],ie=P[1],o(f.namespace_extractQName(J),2)),W=(ae=$[0],de=$[1],null);if(ae==="xmlns"||ae===null&&de==="xmlns"?W=l.namespace.XMLNS:(W=we.lookupNamespaceURI(ae))!==null&&we.isDefaultNamespace(W)?W=null:W===null&&ae!==null&&(W=k[ae]||null),_e.has(W,de))throw new Error("Element contains duplicate attributes.");if(_e.set(W,de),W===l.namespace.XMLNS&&ie===l.namespace.XMLNS)throw new Error("XMLNS namespace is reserved.");if(de.indexOf(":")!==-1||!f.xml_isName(de))throw new Error("Attribute local name contains invalid characters.");if(ae==="xmlns"&&ie==="")throw new Error("Empty XML namespace is not allowed.");W!==null?we.setAttributeNS(W,J,this._decodeAttributeValue(ie)):we.setAttribute(J,this._decodeAttributeValue(ie))}}catch(q){w={error:q}}finally{try{G&&!G.done&&(v=Te.return)&&v.call(Te)}finally{if(w)throw w.error}}O.selfClosing||(x=we);break;case c.TokenType.ClosingTag:if(T.name!==x.nodeName)throw new Error("Closing tag name does not match opening tag name.");x._parent&&(x=x._parent)}T=y.nextToken()}return C},h.prototype._decodeText=function(g){return g==null?g:g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},h.prototype._decodeAttributeValue=function(g){return g==null?g:g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},h})();n.XMLParserImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(275);n.XMLSerializer=o.XMLSerializerImpl},function(r,n,i){var o=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],m=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&m>=h.length&&(h=void 0),{value:h&&h[m++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(2),s=i(69),c=i(95),l=i(9),f=i(7),u=i(0),d=(function(){function h(){}return h.prototype.serializeToString=function(g){return this._xmlSerialization(g,!1)},h.prototype._xmlSerialization=function(g,p){if(g._nodeDocument===void 0||g._nodeDocument._hasNamespaces){var m=new c.NamespacePrefixMap;m.set("xml",f.namespace.XML);try{return this._serializeNodeNS(g,null,m,{value:1},p)}catch{throw new l.InvalidStateError}}else try{return this._serializeNode(g,p)}catch{throw new l.InvalidStateError}},h.prototype._serializeNodeNS=function(g,p,m,w,v){switch(g.nodeType){case a.NodeType.Element:return this._serializeElementNS(g,p,m,w,v);case a.NodeType.Document:return this._serializeDocumentNS(g,p,m,w,v);case a.NodeType.Comment:return this._serializeComment(g,v);case a.NodeType.Text:return this._serializeText(g,v);case a.NodeType.DocumentFragment:return this._serializeDocumentFragmentNS(g,p,m,w,v);case a.NodeType.DocumentType:return this._serializeDocumentType(g,v);case a.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(g,v);case a.NodeType.CData:return this._serializeCData(g,v);default:throw new Error("Unknown node type: "+g.nodeType)}},h.prototype._serializeNode=function(g,p){switch(g.nodeType){case a.NodeType.Element:return this._serializeElement(g,p);case a.NodeType.Document:return this._serializeDocument(g,p);case a.NodeType.Comment:return this._serializeComment(g,p);case a.NodeType.Text:return this._serializeText(g,p);case a.NodeType.DocumentFragment:return this._serializeDocumentFragment(g,p);case a.NodeType.DocumentType:return this._serializeDocumentType(g,p);case a.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(g,p);case a.NodeType.CData:return this._serializeCData(g,p);default:throw new Error("Unknown node type: "+g.nodeType)}},h.prototype._serializeElementNS=function(g,p,m,w,v){var y,C;if(v&&(g.localName.indexOf(":")!==-1||!u.xml_isName(g.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var x="<",T="",S=!1,_=!1,E=m.copy(),D={},b=this._recordNamespaceInformation(g,E,D),I=p,O=g.namespaceURI;if(I===O)b!==null&&(_=!0),x+=T=O===f.namespace.XML?"xml:"+g.localName:g.localName;else{var M=g.prefix,R=null;if(M===null&&O===b||(R=E.get(M,O)),M==="xmlns"){if(v)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");R=M}R!==null?(T=R+":"+g.localName,b!==null&&b!==f.namespace.XML&&(I=b||null),x+=T):M!==null?(M in D&&(M=this._generatePrefix(O,E,w)),E.set(M,O),x+=T+=M+":"+g.localName,x+=" xmlns:"+M+'="'+this._serializeAttributeValue(O,v)+'"',b!==null&&(I=b||null)):b===null||b!==null&&b!==O?(_=!0,I=O,x+=T+=g.localName,x+=' xmlns="'+this._serializeAttributeValue(O,v)+'"'):(I=O,x+=T+=g.localName)}x+=this._serializeAttributesNS(g,E,w,D,_,v);var A=O===f.namespace.HTML;if(A&&g.childNodes.length===0&&h._VoidElementNames.has(g.localName)?(x+=" /",S=!0):A||g.childNodes.length!==0||(x+="/",S=!0),x+=">",S)return x;if(!(A&&g.localName==="template"))try{for(var B=o(g._children||g.childNodes),k=B.next();!k.done;k=B.next()){var L=k.value;x+=this._serializeNodeNS(L,I,E,w,v)}}catch(F){y={error:F}}finally{try{k&&!k.done&&(C=B.return)&&C.call(B)}finally{if(y)throw y.error}}return x+="</"+T+">"},h.prototype._serializeDocumentNS=function(g,p,m,w,v){var y,C;if(v&&g.documentElement===null)throw new Error("Missing document element (well-formed required).");var x="";try{for(var T=o(g._children||g.childNodes),S=T.next();!S.done;S=T.next()){var _=S.value;x+=this._serializeNodeNS(_,p,m,w,v)}}catch(E){y={error:E}}finally{try{S&&!S.done&&(C=T.return)&&C.call(T)}finally{if(y)throw y.error}}return x},h.prototype._serializeComment=function(g,p){if(p&&(!u.xml_isLegalChar(g.data)||g.data.indexOf("--")!==-1||g.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");return"<!--"+g.data+"-->"},h.prototype._serializeText=function(g,p){if(p&&!u.xml_isLegalChar(g.data))throw new Error("Text data contains invalid characters (well-formed required).");for(var m="",w=0;w<g.data.length;w++){var v=g.data[w];m+=v==="&"?"&amp;":v==="<"?"&lt;":v===">"?"&gt;":v}return m},h.prototype._serializeDocumentFragmentNS=function(g,p,m,w,v){var y,C,x="";try{for(var T=o(g._children||g.childNodes),S=T.next();!S.done;S=T.next()){var _=S.value;x+=this._serializeNodeNS(_,p,m,w,v)}}catch(E){y={error:E}}finally{try{S&&!S.done&&(C=T.return)&&C.call(T)}finally{if(y)throw y.error}}return x},h.prototype._serializeDocumentType=function(g,p){if(p&&!u.xml_isPubidChar(g.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(p&&(!u.xml_isLegalChar(g.systemId)||g.systemId.indexOf('"')!==-1&&g.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");return g.publicId&&g.systemId?"<!DOCTYPE "+g.name+' PUBLIC "'+g.publicId+'" "'+g.systemId+'">':g.publicId?"<!DOCTYPE "+g.name+' PUBLIC "'+g.publicId+'">':g.systemId?"<!DOCTYPE "+g.name+' SYSTEM "'+g.systemId+'">':"<!DOCTYPE "+g.name+">"},h.prototype._serializeProcessingInstruction=function(g,p){if(p&&(g.target.indexOf(":")!==-1||/^xml$/i.test(g.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(p&&(!u.xml_isLegalChar(g.data)||g.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");return"<?"+(g.data===""?g.target:g.target+" "+g.data)+"?>"},h.prototype._serializeCData=function(g,p){if(p&&g.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");return"<![CDATA["+g.data+"]]>"},h.prototype._serializeAttributesNS=function(g,p,m,w,v,y){var C,x,T="",S=y?new s.LocalNameSet:void 0;try{for(var _=o(g.attributes),E=_.next();!E.done;E=_.next()){var D=E.value;if(v||y||D.namespaceURI!==null){if(y&&S&&S.has(D.namespaceURI,D.localName))throw new Error("Element contains duplicate attributes (well-formed required).");y&&S&&S.set(D.namespaceURI,D.localName);var b=D.namespaceURI,I=null;if(b!==null)if(I=p.get(D.prefix,b),b===f.namespace.XMLNS){if(D.value===f.namespace.XML||D.prefix===null&&v||D.prefix!==null&&(!(D.localName in w)||w[D.localName]!==D.value)&&p.has(D.localName,D.value))continue;if(y&&D.value===f.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(y&&D.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");D.prefix==="xmlns"&&(I="xmlns")}else I===null&&(T+=" xmlns:"+(I=D.prefix===null||p.hasPrefix(D.prefix)&&!p.has(D.prefix,b)?this._generatePrefix(b,p,m):D.prefix)+'="'+this._serializeAttributeValue(b,y)+'"');if(T+=" ",I!==null&&(T+=I+":"),y&&(D.localName.indexOf(":")!==-1||!u.xml_isName(D.localName)||D.localName==="xmlns"&&b===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");T+=D.localName+'="'+this._serializeAttributeValue(D.value,y)+'"'}else T+=" "+D.localName+'="'+this._serializeAttributeValue(D.value,y)+'"'}}catch(O){C={error:O}}finally{try{E&&!E.done&&(x=_.return)&&x.call(_)}finally{if(C)throw C.error}}return T},h.prototype._recordNamespaceInformation=function(g,p,m){var w,v,y=null;try{for(var C=o(g.attributes),x=C.next();!x.done;x=C.next()){var T=x.value,S=T.namespaceURI,_=T.prefix;if(S===f.namespace.XMLNS){if(_===null){y=T.value;continue}var E=T.localName,D=T.value;if(D===f.namespace.XML||(D===""&&(D=null),p.has(E,D)))continue;p.set(E,D),m[E]=D||""}}}catch(b){w={error:b}}finally{try{x&&!x.done&&(v=C.return)&&v.call(C)}finally{if(w)throw w.error}}return y},h.prototype._generatePrefix=function(g,p,m){var w="ns"+m.value;return m.value++,p.set(w,g),w},h.prototype._serializeAttributeValue=function(g,p){if(p&&g!==null&&!u.xml_isLegalChar(g))throw new Error("Invalid characters in attribute value.");if(g===null)return"";for(var m="",w=0;w<g.length;w++){var v=g[w];m+=v==='"'?"&quot;":v==="&"?"&amp;":v==="<"?"&lt;":v===">"?"&gt;":v}return m},h.prototype._serializeElement=function(g,p){var m,w;if(p&&(g.localName.indexOf(":")!==-1||!u.xml_isName(g.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var v=!1,y=g.localName,C="<"+y;if(C+=this._serializeAttributes(g,p),g._children.size===0&&(C+="/",v=!0),C+=">",v)return C;try{for(var x=o(g._children),T=x.next();!T.done;T=x.next()){var S=T.value;C+=this._serializeNode(S,p)}}catch(_){m={error:_}}finally{try{T&&!T.done&&(w=x.return)&&w.call(x)}finally{if(m)throw m.error}}return C+="</"+y+">"},h.prototype._serializeDocument=function(g,p){var m,w;if(p&&g.documentElement===null)throw new Error("Missing document element (well-formed required).");var v="";try{for(var y=o(g._children),C=y.next();!C.done;C=y.next()){var x=C.value;v+=this._serializeNode(x,p)}}catch(T){m={error:T}}finally{try{C&&!C.done&&(w=y.return)&&w.call(y)}finally{if(m)throw m.error}}return v},h.prototype._serializeDocumentFragment=function(g,p){var m,w,v="";try{for(var y=o(g._children),C=y.next();!C.done;C=y.next()){var x=C.value;v+=this._serializeNode(x,p)}}catch(T){m={error:T}}finally{try{C&&!C.done&&(w=y.return)&&w.call(y)}finally{if(m)throw m.error}}return v},h.prototype._serializeAttributes=function(g,p){var m,w,v="",y=p?{}:void 0;try{for(var C=o(g.attributes),x=C.next();!x.done;x=C.next()){var T=x.value;if(p&&y&&T.localName in y)throw new Error("Element contains duplicate attributes (well-formed required).");if(p&&y&&(y[T.localName]=!0),p&&(T.localName.indexOf(":")!==-1||!u.xml_isName(T.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");v+=" "+T.localName+'="'+this._serializeAttributeValue(T.value,p)+'"'}}catch(S){m={error:S}}finally{try{x&&!x.done&&(w=C.return)&&w.call(C)}finally{if(m)throw m.error}}return v},h._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),h})();n.XMLSerializerImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(277);n.XMLReader=o.XMLReader;var a=i(112);n.ObjectReader=a.ObjectReader;var s=i(280);n.JSONReader=s.JSONReader;var c=i(281);n.YAMLReader=c.YAMLReader},function(r,n,i){i(31),i(32),i(33),i(19),i(65),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(g,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,w){m.__proto__=w}||function(m,w){for(var v in w)w.hasOwnProperty(v)&&(m[v]=w[v])})(g,p)},function(g,p){function m(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(m.prototype=p.prototype,new m)}),s=this&&this.__read||function(g,p){var m=typeof Symbol=="function"&&g[Symbol.iterator];if(!m)return g;var w,v,y=m.call(g),C=[];try{for(;(p===void 0||p-- >0)&&!(w=y.next()).done;)C.push(w.value)}catch(x){v={error:x}}finally{try{w&&!w.done&&(m=y.return)&&m.call(y)}finally{if(v)throw v.error}}return C},c=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,m=p&&g[p],w=0;if(m)return m.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var l=i(180),f=i(111),u=i(7),d=i(0),h=(function(g){function p(){return g!==null&&g.apply(this,arguments)||this}return a(p,g),p.prototype._parse=function(m,w){for(var v,y,C,x,T=new l.XMLStringLexer(w,{skipWhitespaceOnlyText:!0}),S=m,_=m,E=T.nextToken();E.type!==f.TokenType.EOF;){switch(E.type){case f.TokenType.Declaration:var D=E,b=this.sanitize(D.version);if(b!=="1.0")throw new Error("Invalid xml version: "+b);var I={version:b};D.encoding&&(I.encoding=this.sanitize(D.encoding)),D.standalone&&(I.standalone=this.sanitize(D.standalone)==="yes"),_.set(I);break;case f.TokenType.DocType:var O=E;_=this.docType(_,this.sanitize(O.name),this.sanitize(O.pubId),this.sanitize(O.sysId))||_;break;case f.TokenType.CDATA:var M=E;_=this.cdata(_,this.sanitize(M.data))||_;break;case f.TokenType.Comment:var R=E;_=this.comment(_,this.sanitize(R.data))||_;break;case f.TokenType.PI:var A=E;_=this.instruction(_,this.sanitize(A.target),this.sanitize(A.data))||_;break;case f.TokenType.Text:var B=E;_=this.text(_,this._decodeText(this.sanitize(B.data)))||_;break;case f.TokenType.Element:var k=E,L=this.sanitize(k.name),F=s(d.namespace_extractQName(L),1)[0],j=_.node.lookupNamespaceURI(F),J={};try{for(var ie=(v=void 0,c(k.attributes)),fe=ie.next();!fe.done;fe=ie.next()){var ae=s(fe.value,2),de=ae[0],we=ae[1];if(de=this.sanitize(de),we=this.sanitize(we),de==="xmlns")j=we;else{var _e=s(d.namespace_extractQName(de),2),Te=_e[0],G=_e[1];Te==="xmlns"&&(G===F&&(j=we),J[G]=we)}}}catch(ge){v={error:ge}}finally{try{fe&&!fe.done&&(y=ie.return)&&y.call(ie)}finally{if(v)throw v.error}}var P=j!==null?this.element(_,j,L):this.element(_,void 0,L);if(P===void 0)break;_.node===m.node&&(S=P);try{for(var $=(C=void 0,c(k.attributes)),W=$.next();!W.done;W=$.next()){var q=s(W.value,2);de=q[0],we=q[1],de=this.sanitize(de),we=this.sanitize(we);var Q=s(d.namespace_extractQName(de),2),ee=(Te=Q[0],G=Q[1],null);Te==="xmlns"||Te===null&&G==="xmlns"?ee=u.namespace.XMLNS:(ee=P.node.lookupNamespaceURI(Te))!==null&&P.node.isDefaultNamespace(ee)?ee=null:ee===null&&Te!==null&&(ee=J[Te]||null),ee!==null?this.attribute(P,ee,de,this._decodeAttributeValue(we)):this.attribute(P,void 0,de,this._decodeAttributeValue(we))}}catch(ge){C={error:ge}}finally{try{W&&!W.done&&(x=$.return)&&x.call($)}finally{if(C)throw C.error}}k.selfClosing||(_=P);break;case f.TokenType.ClosingTag:_.node.parentNode&&(_=_.up())}E=T.nextToken()}return S},p})(i(75).BaseReader);n.XMLReader=h},function(r,n,i){var o=i(4),a=i(279);o({target:"Object",stat:!0,forced:Object.assign!==a},{assign:a})},function(r,n,i){var o=i(16),a=i(8),s=i(61),c=i(85),l=i(79),f=i(27),u=i(41),d=Object.assign,h=Object.defineProperty;r.exports=!d||a((function(){if(o&&d({b:1},d(h({},"a",{enumerable:!0,get:function(){h(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var g={},p={},m=Symbol();return g[m]=7,"abcdefghijklmnopqrst".split("").forEach((function(w){p[w]=w})),d({},g)[m]!=7||s(d({},p)).join("")!="abcdefghijklmnopqrst"}))?function(g,p){for(var m=f(g),w=arguments.length,v=1,y=c.f,C=l.f;w>v;)for(var x,T=u(arguments[v++]),S=y?s(T).concat(y(T)):s(T),_=S.length,E=0;_>E;)x=S[E++],o&&!C.call(T,x)||(m[x]=T[x]);return m}:d},function(r,n,i){var o,a=this&&this.__extends||(o=function(l,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h])})(l,f)},function(l,f){function u(){this.constructor=l}o(l,f),l.prototype=f===null?Object.create(f):(u.prototype=f.prototype,new u)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(112),c=(function(l){function f(){return l!==null&&l.apply(this,arguments)||this}return a(f,l),f.prototype._parse=function(u,d){return new s.ObjectReader(this._builderOptions).parse(u,JSON.parse(d))},f})(i(75).BaseReader);n.JSONReader=c},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(112),c=i(75),l=i(282),f=(function(u){function d(){return u!==null&&u.apply(this,arguments)||this}return a(d,u),d.prototype._parse=function(h,g){var p=l.safeLoad(g);if(p===void 0)throw new Error("Unable to parse YAML document.");return new s.ObjectReader(this._builderOptions).parse(h,p)},d})(c.BaseReader);n.YAMLReader=f},function(r,n,i){var o=i(283);r.exports=o},function(r,n,i){var o=i(284),a=i(303);function s(c){return function(){throw new Error("Function "+c+" is deprecated and cannot be used.")}}r.exports.Type=i(10),r.exports.Schema=i(39),r.exports.FAILSAFE_SCHEMA=i(113),r.exports.JSON_SCHEMA=i(182),r.exports.CORE_SCHEMA=i(181),r.exports.DEFAULT_SAFE_SCHEMA=i(54),r.exports.DEFAULT_FULL_SCHEMA=i(76),r.exports.load=o.load,r.exports.loadAll=o.loadAll,r.exports.safeLoad=o.safeLoad,r.exports.safeLoadAll=o.safeLoadAll,r.exports.dump=a.dump,r.exports.safeDump=a.safeDump,r.exports.YAMLException=i(53),r.exports.MINIMAL_SCHEMA=i(113),r.exports.SAFE_SCHEMA=i(54),r.exports.DEFAULT_SCHEMA=i(76),r.exports.scan=s("scan"),r.exports.parse=s("parse"),r.exports.compose=s("compose"),r.exports.addConstructor=s("addConstructor")},function(r,n,i){var o=i(38),a=i(53),s=i(285),c=i(54),l=i(76),f=Object.prototype.hasOwnProperty,u=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,d=/[\x85\u2028\u2029]/,h=/[,\[\]\{\}]/,g=/^(?:!|!!|![a-z\-]+!)$/i,p=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function m(P){return Object.prototype.toString.call(P)}function w(P){return P===10||P===13}function v(P){return P===9||P===32}function y(P){return P===9||P===32||P===10||P===13}function C(P){return P===44||P===91||P===93||P===123||P===125}function x(P){var $;return 48<=P&&P<=57?P-48:97<=($=32|P)&&$<=102?$-97+10:-1}function T(P){return P===48?"\0":P===97?"\x07":P===98?"\b":P===116||P===9?"	":P===110?`
`:P===118?"\v":P===102?"\f":P===114?"\r":P===101?"\x1B":P===32?" ":P===34?'"':P===47?"/":P===92?"\\":P===78?"":P===95?"":P===76?"\u2028":P===80?"\u2029":""}function S(P){return P<=65535?String.fromCharCode(P):String.fromCharCode(55296+(P-65536>>10),56320+(P-65536&1023))}for(var _=new Array(256),E=new Array(256),D=0;D<256;D++)_[D]=T(D)?1:0,E[D]=T(D);function b(P,$){this.input=P,this.filename=$.filename||null,this.schema=$.schema||l,this.onWarning=$.onWarning||null,this.legacy=$.legacy||!1,this.json=$.json||!1,this.listener=$.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=P.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function I(P,$){return new a($,new s(P.filename,P.input,P.position,P.line,P.position-P.lineStart))}function O(P,$){throw I(P,$)}function M(P,$){P.onWarning&&P.onWarning.call(null,I(P,$))}var R={YAML:function(P,$,W){var q,Q,ee;P.version!==null&&O(P,"duplication of %YAML directive"),W.length!==1&&O(P,"YAML directive accepts exactly one argument"),(q=/^([0-9]+)\.([0-9]+)$/.exec(W[0]))===null&&O(P,"ill-formed argument of the YAML directive"),Q=parseInt(q[1],10),ee=parseInt(q[2],10),Q!==1&&O(P,"unacceptable YAML version of the document"),P.version=W[0],P.checkLineBreaks=ee<2,ee!==1&&ee!==2&&M(P,"unsupported YAML version of the document")},TAG:function(P,$,W){var q,Q;W.length!==2&&O(P,"TAG directive accepts exactly two arguments"),q=W[0],Q=W[1],g.test(q)||O(P,"ill-formed tag handle (first argument) of the TAG directive"),f.call(P.tagMap,q)&&O(P,'there is a previously declared suffix for "'+q+'" tag handle'),p.test(Q)||O(P,"ill-formed tag prefix (second argument) of the TAG directive"),P.tagMap[q]=Q}};function A(P,$,W,q){var Q,ee,ge,De;if($<W){if(De=P.input.slice($,W),q)for(Q=0,ee=De.length;Q<ee;Q+=1)(ge=De.charCodeAt(Q))===9||32<=ge&&ge<=1114111||O(P,"expected valid JSON character");else u.test(De)&&O(P,"the stream contains non-printable characters");P.result+=De}}function B(P,$,W,q){var Q,ee,ge,De;for(o.isObject(W)||O(P,"cannot merge mappings; the provided source object is unacceptable"),ge=0,De=(Q=Object.keys(W)).length;ge<De;ge+=1)ee=Q[ge],f.call($,ee)||($[ee]=W[ee],q[ee]=!0)}function k(P,$,W,q,Q,ee,ge,De){var Ne,We;if(Array.isArray(Q))for(Ne=0,We=(Q=Array.prototype.slice.call(Q)).length;Ne<We;Ne+=1)Array.isArray(Q[Ne])&&O(P,"nested arrays are not supported inside keys"),typeof Q=="object"&&m(Q[Ne])==="[object Object]"&&(Q[Ne]="[object Object]");if(typeof Q=="object"&&m(Q)==="[object Object]"&&(Q="[object Object]"),Q=String(Q),$===null&&($={}),q==="tag:yaml.org,2002:merge")if(Array.isArray(ee))for(Ne=0,We=ee.length;Ne<We;Ne+=1)B(P,$,ee[Ne],W);else B(P,$,ee,W);else P.json||f.call(W,Q)||!f.call($,Q)||(P.line=ge||P.line,P.position=De||P.position,O(P,"duplicated mapping key")),$[Q]=ee,delete W[Q];return $}function L(P){var $;($=P.input.charCodeAt(P.position))===10?P.position++:$===13?(P.position++,P.input.charCodeAt(P.position)===10&&P.position++):O(P,"a line break is expected"),P.line+=1,P.lineStart=P.position}function F(P,$,W){for(var q=0,Q=P.input.charCodeAt(P.position);Q!==0;){for(;v(Q);)Q=P.input.charCodeAt(++P.position);if($&&Q===35)do Q=P.input.charCodeAt(++P.position);while(Q!==10&&Q!==13&&Q!==0);if(!w(Q))break;for(L(P),Q=P.input.charCodeAt(P.position),q++,P.lineIndent=0;Q===32;)P.lineIndent++,Q=P.input.charCodeAt(++P.position)}return W!==-1&&q!==0&&P.lineIndent<W&&M(P,"deficient indentation"),q}function j(P){var $,W=P.position;return!(($=P.input.charCodeAt(W))!==45&&$!==46||$!==P.input.charCodeAt(W+1)||$!==P.input.charCodeAt(W+2)||(W+=3,($=P.input.charCodeAt(W))!==0&&!y($)))}function J(P,$){$===1?P.result+=" ":$>1&&(P.result+=o.repeat(`
`,$-1))}function ie(P,$){var W,q,Q=P.tag,ee=P.anchor,ge=[],De=!1;for(P.anchor!==null&&(P.anchorMap[P.anchor]=ge),q=P.input.charCodeAt(P.position);q!==0&&q===45&&y(P.input.charCodeAt(P.position+1));)if(De=!0,P.position++,F(P,!0,-1)&&P.lineIndent<=$)ge.push(null),q=P.input.charCodeAt(P.position);else if(W=P.line,de(P,$,3,!1,!0),ge.push(P.result),F(P,!0,-1),q=P.input.charCodeAt(P.position),(P.line===W||P.lineIndent>$)&&q!==0)O(P,"bad indentation of a sequence entry");else if(P.lineIndent<$)break;return!!De&&(P.tag=Q,P.anchor=ee,P.kind="sequence",P.result=ge,!0)}function fe(P){var $,W,q,Q,ee=!1,ge=!1;if((Q=P.input.charCodeAt(P.position))!==33)return!1;if(P.tag!==null&&O(P,"duplication of a tag property"),(Q=P.input.charCodeAt(++P.position))===60?(ee=!0,Q=P.input.charCodeAt(++P.position)):Q===33?(ge=!0,W="!!",Q=P.input.charCodeAt(++P.position)):W="!",$=P.position,ee){do Q=P.input.charCodeAt(++P.position);while(Q!==0&&Q!==62);P.position<P.length?(q=P.input.slice($,P.position),Q=P.input.charCodeAt(++P.position)):O(P,"unexpected end of the stream within a verbatim tag")}else{for(;Q!==0&&!y(Q);)Q===33&&(ge?O(P,"tag suffix cannot contain exclamation marks"):(W=P.input.slice($-1,P.position+1),g.test(W)||O(P,"named tag handle cannot contain such characters"),ge=!0,$=P.position+1)),Q=P.input.charCodeAt(++P.position);q=P.input.slice($,P.position),h.test(q)&&O(P,"tag suffix cannot contain flow indicator characters")}return q&&!p.test(q)&&O(P,"tag name cannot contain such characters: "+q),ee?P.tag=q:f.call(P.tagMap,W)?P.tag=P.tagMap[W]+q:W==="!"?P.tag="!"+q:W==="!!"?P.tag="tag:yaml.org,2002:"+q:O(P,'undeclared tag handle "'+W+'"'),!0}function ae(P){var $,W;if((W=P.input.charCodeAt(P.position))!==38)return!1;for(P.anchor!==null&&O(P,"duplication of an anchor property"),W=P.input.charCodeAt(++P.position),$=P.position;W!==0&&!y(W)&&!C(W);)W=P.input.charCodeAt(++P.position);return P.position===$&&O(P,"name of an anchor node must contain at least one character"),P.anchor=P.input.slice($,P.position),!0}function de(P,$,W,q,Q){var ee,ge,De,Ne,We,re,se,ve,le=1,pe=!1,$e=!1;if(P.listener!==null&&P.listener("open",P),P.tag=null,P.anchor=null,P.kind=null,P.result=null,ee=ge=De=W===4||W===3,q&&F(P,!0,-1)&&(pe=!0,P.lineIndent>$?le=1:P.lineIndent===$?le=0:P.lineIndent<$&&(le=-1)),le===1)for(;fe(P)||ae(P);)F(P,!0,-1)?(pe=!0,De=ee,P.lineIndent>$?le=1:P.lineIndent===$?le=0:P.lineIndent<$&&(le=-1)):De=!1;if(De&&(De=pe||Q),le!==1&&W!==4||(se=W===1||W===2?$:$+1,ve=P.position-P.lineStart,le===1?De&&(ie(P,ve)||(function(oe,st,gt){var ct,Ee,ze,qe,Je,lt=oe.tag,Pe=oe.anchor,Fe={},nt={},wt=null,yn=null,bn=null,fn=!1,sn=!1;for(oe.anchor!==null&&(oe.anchorMap[oe.anchor]=Fe),Je=oe.input.charCodeAt(oe.position);Je!==0;){if(ct=oe.input.charCodeAt(oe.position+1),ze=oe.line,qe=oe.position,Je!==63&&Je!==58||!y(ct)){if(!de(oe,gt,2,!1,!0))break;if(oe.line===ze){for(Je=oe.input.charCodeAt(oe.position);v(Je);)Je=oe.input.charCodeAt(++oe.position);if(Je===58)y(Je=oe.input.charCodeAt(++oe.position))||O(oe,"a whitespace character is expected after the key-value separator within a block mapping"),fn&&(k(oe,Fe,nt,wt,yn,null),wt=yn=bn=null),sn=!0,fn=!1,Ee=!1,wt=oe.tag,yn=oe.result;else{if(!sn)return oe.tag=lt,oe.anchor=Pe,!0;O(oe,"can not read an implicit mapping pair; a colon is missed")}}else{if(!sn)return oe.tag=lt,oe.anchor=Pe,!0;O(oe,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else Je===63?(fn&&(k(oe,Fe,nt,wt,yn,null),wt=yn=bn=null),sn=!0,fn=!0,Ee=!0):fn?(fn=!1,Ee=!0):O(oe,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),oe.position+=1,Je=ct;if((oe.line===ze||oe.lineIndent>st)&&(de(oe,st,4,!0,Ee)&&(fn?yn=oe.result:bn=oe.result),fn||(k(oe,Fe,nt,wt,yn,bn,ze,qe),wt=yn=bn=null),F(oe,!0,-1),Je=oe.input.charCodeAt(oe.position)),oe.lineIndent>st&&Je!==0)O(oe,"bad indentation of a mapping entry");else if(oe.lineIndent<st)break}return fn&&k(oe,Fe,nt,wt,yn,null),sn&&(oe.tag=lt,oe.anchor=Pe,oe.kind="mapping",oe.result=Fe),sn})(P,ve,se))||(function(oe,st){var gt,ct,Ee,ze,qe,Je,lt,Pe,Fe,nt,wt=!0,yn=oe.tag,bn=oe.anchor,fn={};if((nt=oe.input.charCodeAt(oe.position))===91)Ee=93,Je=!1,ct=[];else{if(nt!==123)return!1;Ee=125,Je=!0,ct={}}for(oe.anchor!==null&&(oe.anchorMap[oe.anchor]=ct),nt=oe.input.charCodeAt(++oe.position);nt!==0;){if(F(oe,!0,st),(nt=oe.input.charCodeAt(oe.position))===Ee)return oe.position++,oe.tag=yn,oe.anchor=bn,oe.kind=Je?"mapping":"sequence",oe.result=ct,!0;wt||O(oe,"missed comma between flow collection entries"),Fe=null,ze=qe=!1,nt===63&&y(oe.input.charCodeAt(oe.position+1))&&(ze=qe=!0,oe.position++,F(oe,!0,st)),gt=oe.line,de(oe,st,1,!1,!0),Pe=oe.tag,lt=oe.result,F(oe,!0,st),nt=oe.input.charCodeAt(oe.position),!qe&&oe.line!==gt||nt!==58||(ze=!0,nt=oe.input.charCodeAt(++oe.position),F(oe,!0,st),de(oe,st,1,!1,!0),Fe=oe.result),Je?k(oe,ct,fn,Pe,lt,Fe):ze?ct.push(k(oe,null,fn,Pe,lt,Fe)):ct.push(lt),F(oe,!0,st),(nt=oe.input.charCodeAt(oe.position))===44?(wt=!0,nt=oe.input.charCodeAt(++oe.position)):wt=!1}O(oe,"unexpected end of the stream within a flow collection")})(P,se)?$e=!0:(ge&&(function(oe,st){var gt,ct,Ee,ze,qe,Je=1,lt=!1,Pe=!1,Fe=st,nt=0,wt=!1;if((ze=oe.input.charCodeAt(oe.position))===124)ct=!1;else{if(ze!==62)return!1;ct=!0}for(oe.kind="scalar",oe.result="";ze!==0;)if((ze=oe.input.charCodeAt(++oe.position))===43||ze===45)Je===1?Je=ze===43?3:2:O(oe,"repeat of a chomping mode identifier");else{if(!((Ee=48<=(qe=ze)&&qe<=57?qe-48:-1)>=0))break;Ee===0?O(oe,"bad explicit indentation width of a block scalar; it cannot be less than one"):Pe?O(oe,"repeat of an indentation width identifier"):(Fe=st+Ee-1,Pe=!0)}if(v(ze)){do ze=oe.input.charCodeAt(++oe.position);while(v(ze));if(ze===35)do ze=oe.input.charCodeAt(++oe.position);while(!w(ze)&&ze!==0)}for(;ze!==0;){for(L(oe),oe.lineIndent=0,ze=oe.input.charCodeAt(oe.position);(!Pe||oe.lineIndent<Fe)&&ze===32;)oe.lineIndent++,ze=oe.input.charCodeAt(++oe.position);if(!Pe&&oe.lineIndent>Fe&&(Fe=oe.lineIndent),w(ze))nt++;else{if(oe.lineIndent<Fe){Je===3?oe.result+=o.repeat(`
`,lt?1+nt:nt):Je===1&&lt&&(oe.result+=`
`);break}for(ct?v(ze)?(wt=!0,oe.result+=o.repeat(`
`,lt?1+nt:nt)):wt?(wt=!1,oe.result+=o.repeat(`
`,nt+1)):nt===0?lt&&(oe.result+=" "):oe.result+=o.repeat(`
`,nt):oe.result+=o.repeat(`
`,lt?1+nt:nt),lt=!0,Pe=!0,nt=0,gt=oe.position;!w(ze)&&ze!==0;)ze=oe.input.charCodeAt(++oe.position);A(oe,gt,oe.position,!1)}}return!0})(P,se)||(function(oe,st){var gt,ct,Ee;if((gt=oe.input.charCodeAt(oe.position))!==39)return!1;for(oe.kind="scalar",oe.result="",oe.position++,ct=Ee=oe.position;(gt=oe.input.charCodeAt(oe.position))!==0;)if(gt===39){if(A(oe,ct,oe.position,!0),(gt=oe.input.charCodeAt(++oe.position))!==39)return!0;ct=oe.position,oe.position++,Ee=oe.position}else w(gt)?(A(oe,ct,Ee,!0),J(oe,F(oe,!1,st)),ct=Ee=oe.position):oe.position===oe.lineStart&&j(oe)?O(oe,"unexpected end of the document within a single quoted scalar"):(oe.position++,Ee=oe.position);O(oe,"unexpected end of the stream within a single quoted scalar")})(P,se)||(function(oe,st){var gt,ct,Ee,ze,qe,Je,lt;if((Je=oe.input.charCodeAt(oe.position))!==34)return!1;for(oe.kind="scalar",oe.result="",oe.position++,gt=ct=oe.position;(Je=oe.input.charCodeAt(oe.position))!==0;){if(Je===34)return A(oe,gt,oe.position,!0),oe.position++,!0;if(Je===92){if(A(oe,gt,oe.position,!0),w(Je=oe.input.charCodeAt(++oe.position)))F(oe,!1,st);else if(Je<256&&_[Je])oe.result+=E[Je],oe.position++;else if((qe=(lt=Je)===120?2:lt===117?4:lt===85?8:0)>0){for(Ee=qe,ze=0;Ee>0;Ee--)(qe=x(Je=oe.input.charCodeAt(++oe.position)))>=0?ze=(ze<<4)+qe:O(oe,"expected hexadecimal character");oe.result+=S(ze),oe.position++}else O(oe,"unknown escape sequence");gt=ct=oe.position}else w(Je)?(A(oe,gt,ct,!0),J(oe,F(oe,!1,st)),gt=ct=oe.position):oe.position===oe.lineStart&&j(oe)?O(oe,"unexpected end of the document within a double quoted scalar"):(oe.position++,ct=oe.position)}O(oe,"unexpected end of the stream within a double quoted scalar")})(P,se)?$e=!0:(function(oe){var st,gt,ct;if((ct=oe.input.charCodeAt(oe.position))!==42)return!1;for(ct=oe.input.charCodeAt(++oe.position),st=oe.position;ct!==0&&!y(ct)&&!C(ct);)ct=oe.input.charCodeAt(++oe.position);return oe.position===st&&O(oe,"name of an alias node must contain at least one character"),gt=oe.input.slice(st,oe.position),oe.anchorMap.hasOwnProperty(gt)||O(oe,'unidentified alias "'+gt+'"'),oe.result=oe.anchorMap[gt],F(oe,!0,-1),!0})(P)?($e=!0,P.tag===null&&P.anchor===null||O(P,"alias node should not have any properties")):(function(oe,st,gt){var ct,Ee,ze,qe,Je,lt,Pe,Fe,nt=oe.kind,wt=oe.result;if(y(Fe=oe.input.charCodeAt(oe.position))||C(Fe)||Fe===35||Fe===38||Fe===42||Fe===33||Fe===124||Fe===62||Fe===39||Fe===34||Fe===37||Fe===64||Fe===96||(Fe===63||Fe===45)&&(y(ct=oe.input.charCodeAt(oe.position+1))||gt&&C(ct)))return!1;for(oe.kind="scalar",oe.result="",Ee=ze=oe.position,qe=!1;Fe!==0;){if(Fe===58){if(y(ct=oe.input.charCodeAt(oe.position+1))||gt&&C(ct))break}else if(Fe===35){if(y(oe.input.charCodeAt(oe.position-1)))break}else{if(oe.position===oe.lineStart&&j(oe)||gt&&C(Fe))break;if(w(Fe)){if(Je=oe.line,lt=oe.lineStart,Pe=oe.lineIndent,F(oe,!1,-1),oe.lineIndent>=st){qe=!0,Fe=oe.input.charCodeAt(oe.position);continue}oe.position=ze,oe.line=Je,oe.lineStart=lt,oe.lineIndent=Pe;break}}qe&&(A(oe,Ee,ze,!1),J(oe,oe.line-Je),Ee=ze=oe.position,qe=!1),v(Fe)||(ze=oe.position+1),Fe=oe.input.charCodeAt(++oe.position)}return A(oe,Ee,ze,!1),!!oe.result||(oe.kind=nt,oe.result=wt,!1)})(P,se,W===1)&&($e=!0,P.tag===null&&(P.tag="?")),P.anchor!==null&&(P.anchorMap[P.anchor]=P.result)):le===0&&($e=De&&ie(P,ve))),P.tag!==null&&P.tag!=="!")if(P.tag==="?"){for(P.result!==null&&P.kind!=="scalar"&&O(P,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+P.kind+'"'),Ne=0,We=P.implicitTypes.length;Ne<We;Ne+=1)if((re=P.implicitTypes[Ne]).resolve(P.result)){P.result=re.construct(P.result),P.tag=re.tag,P.anchor!==null&&(P.anchorMap[P.anchor]=P.result);break}}else f.call(P.typeMap[P.kind||"fallback"],P.tag)?(re=P.typeMap[P.kind||"fallback"][P.tag],P.result!==null&&re.kind!==P.kind&&O(P,"unacceptable node kind for !<"+P.tag+'> tag; it should be "'+re.kind+'", not "'+P.kind+'"'),re.resolve(P.result)?(P.result=re.construct(P.result),P.anchor!==null&&(P.anchorMap[P.anchor]=P.result)):O(P,"cannot resolve a node with !<"+P.tag+"> explicit tag")):O(P,"unknown tag !<"+P.tag+">");return P.listener!==null&&P.listener("close",P),P.tag!==null||P.anchor!==null||$e}function we(P){var $,W,q,Q,ee=P.position,ge=!1;for(P.version=null,P.checkLineBreaks=P.legacy,P.tagMap={},P.anchorMap={};(Q=P.input.charCodeAt(P.position))!==0&&(F(P,!0,-1),Q=P.input.charCodeAt(P.position),!(P.lineIndent>0||Q!==37));){for(ge=!0,Q=P.input.charCodeAt(++P.position),$=P.position;Q!==0&&!y(Q);)Q=P.input.charCodeAt(++P.position);for(q=[],(W=P.input.slice($,P.position)).length<1&&O(P,"directive name must not be less than one character in length");Q!==0;){for(;v(Q);)Q=P.input.charCodeAt(++P.position);if(Q===35){do Q=P.input.charCodeAt(++P.position);while(Q!==0&&!w(Q));break}if(w(Q))break;for($=P.position;Q!==0&&!y(Q);)Q=P.input.charCodeAt(++P.position);q.push(P.input.slice($,P.position))}Q!==0&&L(P),f.call(R,W)?R[W](P,W,q):M(P,'unknown document directive "'+W+'"')}F(P,!0,-1),P.lineIndent===0&&P.input.charCodeAt(P.position)===45&&P.input.charCodeAt(P.position+1)===45&&P.input.charCodeAt(P.position+2)===45?(P.position+=3,F(P,!0,-1)):ge&&O(P,"directives end mark is expected"),de(P,P.lineIndent-1,4,!1,!0),F(P,!0,-1),P.checkLineBreaks&&d.test(P.input.slice(ee,P.position))&&M(P,"non-ASCII line breaks are interpreted as content"),P.documents.push(P.result),P.position===P.lineStart&&j(P)?P.input.charCodeAt(P.position)===46&&(P.position+=3,F(P,!0,-1)):P.position<P.length-1&&O(P,"end of the stream or a document separator is expected")}function _e(P,$){$=$||{},(P=String(P)).length!==0&&(P.charCodeAt(P.length-1)!==10&&P.charCodeAt(P.length-1)!==13&&(P+=`
`),P.charCodeAt(0)===65279&&(P=P.slice(1)));var W=new b(P,$),q=P.indexOf("\0");for(q!==-1&&(W.position=q,O(W,"null byte is not allowed in input")),W.input+="\0";W.input.charCodeAt(W.position)===32;)W.lineIndent+=1,W.position+=1;for(;W.position<W.length-1;)we(W);return W.documents}function Te(P,$,W){$!==null&&typeof $=="object"&&W===void 0&&(W=$,$=null);var q=_e(P,W);if(typeof $!="function")return q;for(var Q=0,ee=q.length;Q<ee;Q+=1)$(q[Q])}function G(P,$){var W=_e(P,$);if(W.length!==0){if(W.length===1)return W[0];throw new a("expected a single document in the stream, but found more")}}r.exports.loadAll=Te,r.exports.load=G,r.exports.safeLoadAll=function(P,$,W){return typeof $=="object"&&$!==null&&W===void 0&&(W=$,$=null),Te(P,$,o.extend({schema:c},W))},r.exports.safeLoad=function(P,$){return G(P,o.extend({schema:c},$))}},function(r,n,i){var o=i(38);function a(s,c,l,f,u){this.name=s,this.buffer=c,this.position=l,this.line=f,this.column=u}a.prototype.getSnippet=function(s,c){var l,f,u,d,h;if(!this.buffer)return null;for(s=s||4,c=c||75,l="",f=this.position;f>0&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(f-1))===-1;)if(f-=1,this.position-f>c/2-1){l=" ... ",f+=5;break}for(u="",d=this.position;d<this.buffer.length&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(d))===-1;)if((d+=1)-this.position>c/2-1){u=" ... ",d-=5;break}return h=this.buffer.slice(f,d),o.repeat(" ",s)+l+h+u+`
`+o.repeat(" ",s+this.position-f+l.length)+"^"},a.prototype.toString=function(s){var c,l="";return this.name&&(l+='in "'+this.name+'" '),l+="at line "+(this.line+1)+", column "+(this.column+1),s||(c=this.getSnippet())&&(l+=`:
`+c),l},r.exports=a},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:str",{kind:"scalar",construct:function(a){return a!==null?a:""}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(a){return a!==null?a:[]}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:map",{kind:"mapping",construct:function(a){return a!==null?a:{}}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(a){if(a===null)return!0;var s=a.length;return s===1&&a==="~"||s===4&&(a==="null"||a==="Null"||a==="NULL")},construct:function(){return null},predicate:function(a){return a===null},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(a){if(a===null)return!1;var s=a.length;return s===4&&(a==="true"||a==="True"||a==="TRUE")||s===5&&(a==="false"||a==="False"||a==="FALSE")},construct:function(a){return a==="true"||a==="True"||a==="TRUE"},predicate:function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},represent:{lowercase:function(a){return a?"true":"false"},uppercase:function(a){return a?"TRUE":"FALSE"},camelcase:function(a){return a?"True":"False"}},defaultStyle:"lowercase"})},function(r,n,i){var o=i(38),a=i(10);function s(l){return 48<=l&&l<=55}function c(l){return 48<=l&&l<=57}r.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(l){if(l===null)return!1;var f,u,d=l.length,h=0,g=!1;if(!d)return!1;if((f=l[h])!=="-"&&f!=="+"||(f=l[++h]),f==="0"){if(h+1===d)return!0;if((f=l[++h])==="b"){for(h++;h<d;h++)if((f=l[h])!=="_"){if(f!=="0"&&f!=="1")return!1;g=!0}return g&&f!=="_"}if(f==="x"){for(h++;h<d;h++)if((f=l[h])!=="_"){if(!(48<=(u=l.charCodeAt(h))&&u<=57||65<=u&&u<=70||97<=u&&u<=102))return!1;g=!0}return g&&f!=="_"}for(;h<d;h++)if((f=l[h])!=="_"){if(!s(l.charCodeAt(h)))return!1;g=!0}return g&&f!=="_"}if(f==="_")return!1;for(;h<d;h++)if((f=l[h])!=="_"){if(f===":")break;if(!c(l.charCodeAt(h)))return!1;g=!0}return!(!g||f==="_")&&(f!==":"||/^(:[0-5]?[0-9])+$/.test(l.slice(h)))},construct:function(l){var f,u,d=l,h=1,g=[];return d.indexOf("_")!==-1&&(d=d.replace(/_/g,"")),(f=d[0])!=="-"&&f!=="+"||(f==="-"&&(h=-1),f=(d=d.slice(1))[0]),d==="0"?0:f==="0"?d[1]==="b"?h*parseInt(d.slice(2),2):d[1]==="x"?h*parseInt(d,16):h*parseInt(d,8):d.indexOf(":")!==-1?(d.split(":").forEach((function(p){g.unshift(parseInt(p,10))})),d=0,u=1,g.forEach((function(p){d+=p*u,u*=60})),h*d):h*parseInt(d,10)},predicate:function(l){return Object.prototype.toString.call(l)==="[object Number]"&&l%1==0&&!o.isNegativeZero(l)},represent:{binary:function(l){return l>=0?"0b"+l.toString(2):"-0b"+l.toString(2).slice(1)},octal:function(l){return l>=0?"0"+l.toString(8):"-0"+l.toString(8).slice(1)},decimal:function(l){return l.toString(10)},hexadecimal:function(l){return l>=0?"0x"+l.toString(16).toUpperCase():"-0x"+l.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(r,n,i){var o=i(38),a=i(10),s=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),c=/^[-+]?[0-9]+e/;r.exports=new a("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(l){return l!==null&&!(!s.test(l)||l[l.length-1]==="_")},construct:function(l){var f,u,d,h;return u=(f=l.replace(/_/g,"").toLowerCase())[0]==="-"?-1:1,h=[],"+-".indexOf(f[0])>=0&&(f=f.slice(1)),f===".inf"?u===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:f===".nan"?NaN:f.indexOf(":")>=0?(f.split(":").forEach((function(g){h.unshift(parseFloat(g,10))})),f=0,d=1,h.forEach((function(g){f+=g*d,d*=60})),u*f):u*parseFloat(f,10)},predicate:function(l){return Object.prototype.toString.call(l)==="[object Number]"&&(l%1!=0||o.isNegativeZero(l))},represent:function(l,f){var u;if(isNaN(l))switch(f){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===l)switch(f){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===l)switch(f){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(o.isNegativeZero(l))return"-0.0";return u=l.toString(10),c.test(u)?u.replace("e",".e"):u},defaultStyle:"lowercase"})},function(r,n,i){var o=i(10),a=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),s=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");r.exports=new o("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(c){return c!==null&&(a.exec(c)!==null||s.exec(c)!==null)},construct:function(c){var l,f,u,d,h,g,p,m,w=0,v=null;if((l=a.exec(c))===null&&(l=s.exec(c)),l===null)throw new Error("Date resolve error");if(f=+l[1],u=+l[2]-1,d=+l[3],!l[4])return new Date(Date.UTC(f,u,d));if(h=+l[4],g=+l[5],p=+l[6],l[7]){for(w=l[7].slice(0,3);w.length<3;)w+="0";w=+w}return l[9]&&(v=6e4*(60*+l[10]+ +(l[11]||0)),l[9]==="-"&&(v=-v)),m=new Date(Date.UTC(f,u,d,h,g,p,w)),v&&m.setTime(m.getTime()-v),m},instanceOf:Date,represent:function(c){return c.toISOString()}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(a){return a==="<<"||a===null}})},function(r,n,i){var o;try{o=i(145).Buffer}catch{}var a=i(10),s=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;r.exports=new a("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(c){if(c===null)return!1;var l,f,u=0,d=c.length,h=s;for(f=0;f<d;f++)if(!((l=h.indexOf(c.charAt(f)))>64)){if(l<0)return!1;u+=6}return u%8==0},construct:function(c){var l,f,u=c.replace(/[\r\n=]/g,""),d=u.length,h=s,g=0,p=[];for(l=0;l<d;l++)l%4==0&&l&&(p.push(g>>16&255),p.push(g>>8&255),p.push(255&g)),g=g<<6|h.indexOf(u.charAt(l));return(f=d%4*6)===0?(p.push(g>>16&255),p.push(g>>8&255),p.push(255&g)):f===18?(p.push(g>>10&255),p.push(g>>2&255)):f===12&&p.push(g>>4&255),o?o.from?o.from(p):new o(p):p},predicate:function(c){return o&&o.isBuffer(c)},represent:function(c){var l,f,u="",d=0,h=c.length,g=s;for(l=0;l<h;l++)l%3==0&&l&&(u+=g[d>>18&63],u+=g[d>>12&63],u+=g[d>>6&63],u+=g[63&d]),d=(d<<8)+c[l];return(f=h%3)===0?(u+=g[d>>18&63],u+=g[d>>12&63],u+=g[d>>6&63],u+=g[63&d]):f===2?(u+=g[d>>10&63],u+=g[d>>4&63],u+=g[d<<2&63],u+=g[64]):f===1&&(u+=g[d>>2&63],u+=g[d<<4&63],u+=g[64],u+=g[64]),u}})},function(r,n,i){var o=i(10),a=Object.prototype.hasOwnProperty,s=Object.prototype.toString;r.exports=new o("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(c){if(c===null)return!0;var l,f,u,d,h,g=[],p=c;for(l=0,f=p.length;l<f;l+=1){if(u=p[l],h=!1,s.call(u)!=="[object Object]")return!1;for(d in u)if(a.call(u,d)){if(h)return!1;h=!0}if(!h||g.indexOf(d)!==-1)return!1;g.push(d)}return!0},construct:function(c){return c!==null?c:[]}})},function(r,n,i){var o=i(10),a=Object.prototype.toString;r.exports=new o("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(s){if(s===null)return!0;var c,l,f,u,d,h=s;for(d=new Array(h.length),c=0,l=h.length;c<l;c+=1){if(f=h[c],a.call(f)!=="[object Object]"||(u=Object.keys(f)).length!==1)return!1;d[c]=[u[0],f[u[0]]]}return!0},construct:function(s){if(s===null)return[];var c,l,f,u,d,h=s;for(d=new Array(h.length),c=0,l=h.length;c<l;c+=1)f=h[c],u=Object.keys(f),d[c]=[u[0],f[u[0]]];return d}})},function(r,n,i){var o=i(10),a=Object.prototype.hasOwnProperty;r.exports=new o("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(s){if(s===null)return!0;var c,l=s;for(c in l)if(a.call(l,c)&&l[c]!==null)return!1;return!0},construct:function(s){return s!==null?s:{}}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(a){return a===void 0},represent:function(){return""}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(a){if(a===null||a.length===0)return!1;var s=a,c=/\/([gim]*)$/.exec(a),l="";return!(s[0]==="/"&&(c&&(l=c[1]),l.length>3||s[s.length-l.length-1]!=="/"))},construct:function(a){var s=a,c=/\/([gim]*)$/.exec(a),l="";return s[0]==="/"&&(c&&(l=c[1]),s=s.slice(1,s.length-l.length-1)),new RegExp(s,l)},predicate:function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},represent:function(a){var s="/"+a.source+"/";return a.global&&(s+="g"),a.multiline&&(s+="m"),a.ignoreCase&&(s+="i"),s}})},function(r,n,i){var o;try{o=i(302)}catch{typeof window<"u"&&(o=window.esprima)}var a=i(10);r.exports=new a("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(s){if(s===null)return!1;try{var c="("+s+")",l=o.parse(c,{range:!0});return l.type==="Program"&&l.body.length===1&&l.body[0].type==="ExpressionStatement"&&(l.body[0].expression.type==="ArrowFunctionExpression"||l.body[0].expression.type==="FunctionExpression")}catch{return!1}},construct:function(s){var c,l="("+s+")",f=o.parse(l,{range:!0}),u=[];if(f.type!=="Program"||f.body.length!==1||f.body[0].type!=="ExpressionStatement"||f.body[0].expression.type!=="ArrowFunctionExpression"&&f.body[0].expression.type!=="FunctionExpression")throw new Error("Failed to resolve function");return f.body[0].expression.params.forEach((function(d){u.push(d.name)})),c=f.body[0].expression.body.range,f.body[0].expression.body.type==="BlockStatement"?new Function(u,l.slice(c[0]+1,c[1]-1)):new Function(u,"return "+l.slice(c[0],c[1]))},predicate:function(s){return Object.prototype.toString.call(s)==="[object Function]"},represent:function(s){return s.toString()}})},function(r,n,i){var o;o=function(){return(function(a){var s={};function c(l){if(s[l])return s[l].exports;var f=s[l]={exports:{},id:l,loaded:!1};return a[l].call(f.exports,f,f.exports,c),f.loaded=!0,f.exports}return c.m=a,c.c=s,c.p="",c(0)})([function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(1),f=c(3),u=c(8),d=c(15);function h(p,m,w){var v=null,y=function(D,b){w&&w(D,b),v&&v.visit(D,b)},C=typeof w=="function"?y:null,x=!1;if(m){x=typeof m.comment=="boolean"&&m.comment;var T=typeof m.attachComment=="boolean"&&m.attachComment;(x||T)&&((v=new l.CommentHandler).attach=T,m.comment=!0,C=y)}var S,_=!1;m&&typeof m.sourceType=="string"&&(_=m.sourceType==="module"),S=m&&typeof m.jsx=="boolean"&&m.jsx?new f.JSXParser(p,m,C):new u.Parser(p,m,C);var E=_?S.parseModule():S.parseScript();return x&&v&&(E.comments=v.comments),S.config.tokens&&(E.tokens=S.tokens),S.config.tolerant&&(E.errors=S.errorHandler.errors),E}s.parse=h,s.parseModule=function(p,m,w){var v=m||{};return v.sourceType="module",h(p,v,w)},s.parseScript=function(p,m,w){var v=m||{};return v.sourceType="script",h(p,v,w)},s.tokenize=function(p,m,w){var v,y=new d.Tokenizer(p,m);v=[];try{for(;;){var C=y.getNextToken();if(!C)break;w&&(C=w(C)),v.push(C)}}catch(x){y.errorHandler.tolerate(x)}return y.errorHandler.tolerant&&(v.errors=y.errors()),v};var g=c(2);s.Syntax=g.Syntax,s.version="4.0.1"},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(2),f=(function(){function u(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return u.prototype.insertInnerComments=function(d,h){if(d.type===l.Syntax.BlockStatement&&d.body.length===0){for(var g=[],p=this.leading.length-1;p>=0;--p){var m=this.leading[p];h.end.offset>=m.start&&(g.unshift(m.comment),this.leading.splice(p,1),this.trailing.splice(p,1))}g.length&&(d.innerComments=g)}},u.prototype.findTrailingComments=function(d){var h=[];if(this.trailing.length>0){for(var g=this.trailing.length-1;g>=0;--g){var p=this.trailing[g];p.start>=d.end.offset&&h.unshift(p.comment)}return this.trailing.length=0,h}var m=this.stack[this.stack.length-1];if(m&&m.node.trailingComments){var w=m.node.trailingComments[0];w&&w.range[0]>=d.end.offset&&(h=m.node.trailingComments,delete m.node.trailingComments)}return h},u.prototype.findLeadingComments=function(d){for(var h,g=[];this.stack.length>0&&(w=this.stack[this.stack.length-1])&&w.start>=d.start.offset;)h=w.node,this.stack.pop();if(h){for(var p=(h.leadingComments?h.leadingComments.length:0)-1;p>=0;--p){var m=h.leadingComments[p];m.range[1]<=d.start.offset&&(g.unshift(m),h.leadingComments.splice(p,1))}return h.leadingComments&&h.leadingComments.length===0&&delete h.leadingComments,g}for(p=this.leading.length-1;p>=0;--p){var w;(w=this.leading[p]).start<=d.start.offset&&(g.unshift(w.comment),this.leading.splice(p,1))}return g},u.prototype.visitNode=function(d,h){if(!(d.type===l.Syntax.Program&&d.body.length>0)){this.insertInnerComments(d,h);var g=this.findTrailingComments(h),p=this.findLeadingComments(h);p.length>0&&(d.leadingComments=p),g.length>0&&(d.trailingComments=g),this.stack.push({node:d,start:h.start.offset})}},u.prototype.visitComment=function(d,h){var g=d.type[0]==="L"?"Line":"Block",p={type:g,value:d.value};if(d.range&&(p.range=d.range),d.loc&&(p.loc=d.loc),this.comments.push(p),this.attach){var m={comment:{type:g,value:d.value,range:[h.start.offset,h.end.offset]},start:h.start.offset};d.loc&&(m.comment.loc=d.loc),d.type=g,this.leading.push(m),this.trailing.push(m)}},u.prototype.visit=function(d,h){d.type==="LineComment"||d.type==="BlockComment"?this.visitComment(d,h):this.attach&&this.visitNode(d,h)},u})();s.CommentHandler=f},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(a,s,c){var l,f=this&&this.__extends||(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,x){C.__proto__=x}||function(C,x){for(var T in x)x.hasOwnProperty(T)&&(C[T]=x[T])},function(C,x){function T(){this.constructor=C}l(C,x),C.prototype=x===null?Object.create(x):(T.prototype=x.prototype,new T)});Object.defineProperty(s,"__esModule",{value:!0});var u=c(4),d=c(5),h=c(6),g=c(7),p=c(8),m=c(13),w=c(14);function v(C){var x;switch(C.type){case h.JSXSyntax.JSXIdentifier:x=C.name;break;case h.JSXSyntax.JSXNamespacedName:var T=C;x=v(T.namespace)+":"+v(T.name);break;case h.JSXSyntax.JSXMemberExpression:var S=C;x=v(S.object)+"."+v(S.property)}return x}m.TokenName[100]="JSXIdentifier",m.TokenName[101]="JSXText";var y=(function(C){function x(T,S,_){return C.call(this,T,S,_)||this}return f(x,C),x.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():C.prototype.parsePrimaryExpression.call(this)},x.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},x.prototype.finishJSX=function(){this.nextToken()},x.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},x.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},x.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},x.prototype.scanXHTMLEntity=function(T){for(var S="&",_=!0,E=!1,D=!1,b=!1;!this.scanner.eof()&&_&&!E;){var I=this.scanner.source[this.scanner.index];if(I===T)break;if(E=I===";",S+=I,++this.scanner.index,!E)switch(S.length){case 2:D=I==="#";break;case 3:D&&(_=(b=I==="x")||u.Character.isDecimalDigit(I.charCodeAt(0)),D=D&&!b);break;default:_=(_=_&&!(D&&!u.Character.isDecimalDigit(I.charCodeAt(0))))&&!(b&&!u.Character.isHexDigit(I.charCodeAt(0)))}}if(_&&E&&S.length>2){var O=S.substr(1,S.length-2);D&&O.length>1?S=String.fromCharCode(parseInt(O.substr(1),10)):b&&O.length>2?S=String.fromCharCode(parseInt("0"+O.substr(1),16)):D||b||!w.XHTMLEntities[O]||(S=w.XHTMLEntities[O])}return S},x.prototype.lexJSX=function(){var T=this.scanner.source.charCodeAt(this.scanner.index);if(T===60||T===62||T===47||T===58||T===61||T===123||T===125)return{type:7,value:I=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(T===34||T===39){for(var S=this.scanner.index,_=this.scanner.source[this.scanner.index++],E="";!this.scanner.eof()&&(O=this.scanner.source[this.scanner.index++])!==_;)E+=O==="&"?this.scanXHTMLEntity(_):O;return{type:8,value:E,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:S,end:this.scanner.index}}if(T===46){var D=this.scanner.source.charCodeAt(this.scanner.index+1),b=this.scanner.source.charCodeAt(this.scanner.index+2),I=D===46&&b===46?"...":".";return S=this.scanner.index,this.scanner.index+=I.length,{type:7,value:I,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:S,end:this.scanner.index}}if(T===96)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(u.Character.isIdentifierStart(T)&&T!==92){for(S=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var O=this.scanner.source.charCodeAt(this.scanner.index);if(u.Character.isIdentifierPart(O)&&O!==92)++this.scanner.index;else{if(O!==45)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(S,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:S,end:this.scanner.index}}return this.scanner.lex()},x.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var T=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(T)),T},x.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var T=this.scanner.index,S="";!this.scanner.eof();){var _=this.scanner.source[this.scanner.index];if(_==="{"||_==="<")break;++this.scanner.index,S+=_,u.Character.isLineTerminator(_.charCodeAt(0))&&(++this.scanner.lineNumber,_==="\r"&&this.scanner.source[this.scanner.index]===`
`&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var E={type:101,value:S,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index};return S.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(E)),E},x.prototype.peekJSXToken=function(){var T=this.scanner.saveState();this.scanner.scanComments();var S=this.lexJSX();return this.scanner.restoreState(T),S},x.prototype.expectJSX=function(T){var S=this.nextJSXToken();S.type===7&&S.value===T||this.throwUnexpectedToken(S)},x.prototype.matchJSX=function(T){var S=this.peekJSXToken();return S.type===7&&S.value===T},x.prototype.parseJSXIdentifier=function(){var T=this.createJSXNode(),S=this.nextJSXToken();return S.type!==100&&this.throwUnexpectedToken(S),this.finalize(T,new d.JSXIdentifier(S.value))},x.prototype.parseJSXElementName=function(){var T=this.createJSXNode(),S=this.parseJSXIdentifier();if(this.matchJSX(":")){var _=S;this.expectJSX(":");var E=this.parseJSXIdentifier();S=this.finalize(T,new d.JSXNamespacedName(_,E))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var D=S;this.expectJSX(".");var b=this.parseJSXIdentifier();S=this.finalize(T,new d.JSXMemberExpression(D,b))}return S},x.prototype.parseJSXAttributeName=function(){var T,S=this.createJSXNode(),_=this.parseJSXIdentifier();if(this.matchJSX(":")){var E=_;this.expectJSX(":");var D=this.parseJSXIdentifier();T=this.finalize(S,new d.JSXNamespacedName(E,D))}else T=_;return T},x.prototype.parseJSXStringLiteralAttribute=function(){var T=this.createJSXNode(),S=this.nextJSXToken();S.type!==8&&this.throwUnexpectedToken(S);var _=this.getTokenRaw(S);return this.finalize(T,new g.Literal(S.value,_))},x.prototype.parseJSXExpressionAttribute=function(){var T=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var S=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(T,new d.JSXExpressionContainer(S))},x.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},x.prototype.parseJSXNameValueAttribute=function(){var T=this.createJSXNode(),S=this.parseJSXAttributeName(),_=null;return this.matchJSX("=")&&(this.expectJSX("="),_=this.parseJSXAttributeValue()),this.finalize(T,new d.JSXAttribute(S,_))},x.prototype.parseJSXSpreadAttribute=function(){var T=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var S=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(T,new d.JSXSpreadAttribute(S))},x.prototype.parseJSXAttributes=function(){for(var T=[];!this.matchJSX("/")&&!this.matchJSX(">");){var S=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();T.push(S)}return T},x.prototype.parseJSXOpeningElement=function(){var T=this.createJSXNode();this.expectJSX("<");var S=this.parseJSXElementName(),_=this.parseJSXAttributes(),E=this.matchJSX("/");return E&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(T,new d.JSXOpeningElement(S,E,_))},x.prototype.parseJSXBoundaryElement=function(){var T=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var S=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(T,new d.JSXClosingElement(S))}var _=this.parseJSXElementName(),E=this.parseJSXAttributes(),D=this.matchJSX("/");return D&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(T,new d.JSXOpeningElement(_,D,E))},x.prototype.parseJSXEmptyExpression=function(){var T=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(T,new d.JSXEmptyExpression)},x.prototype.parseJSXExpressionContainer=function(){var T,S=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(T=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),T=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(S,new d.JSXExpressionContainer(T))},x.prototype.parseJSXChildren=function(){for(var T=[];!this.scanner.eof();){var S=this.createJSXChildNode(),_=this.nextJSXText();if(_.start<_.end){var E=this.getTokenRaw(_),D=this.finalize(S,new d.JSXText(_.value,E));T.push(D)}if(this.scanner.source[this.scanner.index]!=="{")break;var b=this.parseJSXExpressionContainer();T.push(b)}return T},x.prototype.parseComplexJSXElement=function(T){for(var S=[];!this.scanner.eof();){T.children=T.children.concat(this.parseJSXChildren());var _=this.createJSXChildNode(),E=this.parseJSXBoundaryElement();if(E.type===h.JSXSyntax.JSXOpeningElement){var D=E;if(D.selfClosing){var b=this.finalize(_,new d.JSXElement(D,[],null));T.children.push(b)}else S.push(T),T={node:_,opening:D,closing:null,children:[]}}if(E.type===h.JSXSyntax.JSXClosingElement){T.closing=E;var I=v(T.opening.name);if(I!==v(T.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",I),!(S.length>0))break;b=this.finalize(T.node,new d.JSXElement(T.opening,T.children,T.closing)),(T=S[S.length-1]).children.push(b),S.pop()}}return T},x.prototype.parseJSXElement=function(){var T=this.createJSXNode(),S=this.parseJSXOpeningElement(),_=[],E=null;if(!S.selfClosing){var D=this.parseComplexJSXElement({node:T,opening:S,closing:E,children:_});_=D.children,E=D.closing}return this.finalize(T,new d.JSXElement(S,_,E))},x.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var T=this.parseJSXElement();return this.finishJSX(),T},x.prototype.isStartOfExpression=function(){return C.prototype.isStartOfExpression.call(this)||this.match("<")},x})(p.Parser);s.JSXParser=y},function(a,s){Object.defineProperty(s,"__esModule",{value:!0});var c={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};s.Character={fromCodePoint:function(l){return l<65536?String.fromCharCode(l):String.fromCharCode(55296+(l-65536>>10))+String.fromCharCode(56320+(l-65536&1023))},isWhiteSpace:function(l){return l===32||l===9||l===11||l===12||l===160||l>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(l)>=0},isLineTerminator:function(l){return l===10||l===13||l===8232||l===8233},isIdentifierStart:function(l){return l===36||l===95||l>=65&&l<=90||l>=97&&l<=122||l===92||l>=128&&c.NonAsciiIdentifierStart.test(s.Character.fromCodePoint(l))},isIdentifierPart:function(l){return l===36||l===95||l>=65&&l<=90||l>=97&&l<=122||l>=48&&l<=57||l===92||l>=128&&c.NonAsciiIdentifierPart.test(s.Character.fromCodePoint(l))},isDecimalDigit:function(l){return l>=48&&l<=57},isHexDigit:function(l){return l>=48&&l<=57||l>=65&&l<=70||l>=97&&l<=102},isOctalDigit:function(l){return l>=48&&l<=55}}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(6),f=function(x){this.type=l.JSXSyntax.JSXClosingElement,this.name=x};s.JSXClosingElement=f;var u=function(x,T,S){this.type=l.JSXSyntax.JSXElement,this.openingElement=x,this.children=T,this.closingElement=S};s.JSXElement=u;var d=function(){this.type=l.JSXSyntax.JSXEmptyExpression};s.JSXEmptyExpression=d;var h=function(x){this.type=l.JSXSyntax.JSXExpressionContainer,this.expression=x};s.JSXExpressionContainer=h;var g=function(x){this.type=l.JSXSyntax.JSXIdentifier,this.name=x};s.JSXIdentifier=g;var p=function(x,T){this.type=l.JSXSyntax.JSXMemberExpression,this.object=x,this.property=T};s.JSXMemberExpression=p;var m=function(x,T){this.type=l.JSXSyntax.JSXAttribute,this.name=x,this.value=T};s.JSXAttribute=m;var w=function(x,T){this.type=l.JSXSyntax.JSXNamespacedName,this.namespace=x,this.name=T};s.JSXNamespacedName=w;var v=function(x,T,S){this.type=l.JSXSyntax.JSXOpeningElement,this.name=x,this.selfClosing=T,this.attributes=S};s.JSXOpeningElement=v;var y=function(x){this.type=l.JSXSyntax.JSXSpreadAttribute,this.argument=x};s.JSXSpreadAttribute=y;var C=function(x,T){this.type=l.JSXSyntax.JSXText,this.value=x,this.raw=T};s.JSXText=C},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(2),f=function(Be){this.type=l.Syntax.ArrayExpression,this.elements=Be};s.ArrayExpression=f;var u=function(Be){this.type=l.Syntax.ArrayPattern,this.elements=Be};s.ArrayPattern=u;var d=function(Be,rt,Ot){this.type=l.Syntax.ArrowFunctionExpression,this.id=null,this.params=Be,this.body=rt,this.generator=!1,this.expression=Ot,this.async=!1};s.ArrowFunctionExpression=d;var h=function(Be,rt,Ot){this.type=l.Syntax.AssignmentExpression,this.operator=Be,this.left=rt,this.right=Ot};s.AssignmentExpression=h;var g=function(Be,rt){this.type=l.Syntax.AssignmentPattern,this.left=Be,this.right=rt};s.AssignmentPattern=g;var p=function(Be,rt,Ot){this.type=l.Syntax.ArrowFunctionExpression,this.id=null,this.params=Be,this.body=rt,this.generator=!1,this.expression=Ot,this.async=!0};s.AsyncArrowFunctionExpression=p;var m=function(Be,rt,Ot){this.type=l.Syntax.FunctionDeclaration,this.id=Be,this.params=rt,this.body=Ot,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionDeclaration=m;var w=function(Be,rt,Ot){this.type=l.Syntax.FunctionExpression,this.id=Be,this.params=rt,this.body=Ot,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionExpression=w;var v=function(Be){this.type=l.Syntax.AwaitExpression,this.argument=Be};s.AwaitExpression=v;var y=function(Be,rt,Ot){var Tn=Be==="||"||Be==="&&";this.type=Tn?l.Syntax.LogicalExpression:l.Syntax.BinaryExpression,this.operator=Be,this.left=rt,this.right=Ot};s.BinaryExpression=y;var C=function(Be){this.type=l.Syntax.BlockStatement,this.body=Be};s.BlockStatement=C;var x=function(Be){this.type=l.Syntax.BreakStatement,this.label=Be};s.BreakStatement=x;var T=function(Be,rt){this.type=l.Syntax.CallExpression,this.callee=Be,this.arguments=rt};s.CallExpression=T;var S=function(Be,rt){this.type=l.Syntax.CatchClause,this.param=Be,this.body=rt};s.CatchClause=S;var _=function(Be){this.type=l.Syntax.ClassBody,this.body=Be};s.ClassBody=_;var E=function(Be,rt,Ot){this.type=l.Syntax.ClassDeclaration,this.id=Be,this.superClass=rt,this.body=Ot};s.ClassDeclaration=E;var D=function(Be,rt,Ot){this.type=l.Syntax.ClassExpression,this.id=Be,this.superClass=rt,this.body=Ot};s.ClassExpression=D;var b=function(Be,rt){this.type=l.Syntax.MemberExpression,this.computed=!0,this.object=Be,this.property=rt};s.ComputedMemberExpression=b;var I=function(Be,rt,Ot){this.type=l.Syntax.ConditionalExpression,this.test=Be,this.consequent=rt,this.alternate=Ot};s.ConditionalExpression=I;var O=function(Be){this.type=l.Syntax.ContinueStatement,this.label=Be};s.ContinueStatement=O;var M=function(){this.type=l.Syntax.DebuggerStatement};s.DebuggerStatement=M;var R=function(Be,rt){this.type=l.Syntax.ExpressionStatement,this.expression=Be,this.directive=rt};s.Directive=R;var A=function(Be,rt){this.type=l.Syntax.DoWhileStatement,this.body=Be,this.test=rt};s.DoWhileStatement=A;var B=function(){this.type=l.Syntax.EmptyStatement};s.EmptyStatement=B;var k=function(Be){this.type=l.Syntax.ExportAllDeclaration,this.source=Be};s.ExportAllDeclaration=k;var L=function(Be){this.type=l.Syntax.ExportDefaultDeclaration,this.declaration=Be};s.ExportDefaultDeclaration=L;var F=function(Be,rt,Ot){this.type=l.Syntax.ExportNamedDeclaration,this.declaration=Be,this.specifiers=rt,this.source=Ot};s.ExportNamedDeclaration=F;var j=function(Be,rt){this.type=l.Syntax.ExportSpecifier,this.exported=rt,this.local=Be};s.ExportSpecifier=j;var J=function(Be){this.type=l.Syntax.ExpressionStatement,this.expression=Be};s.ExpressionStatement=J;var ie=function(Be,rt,Ot){this.type=l.Syntax.ForInStatement,this.left=Be,this.right=rt,this.body=Ot,this.each=!1};s.ForInStatement=ie;var fe=function(Be,rt,Ot){this.type=l.Syntax.ForOfStatement,this.left=Be,this.right=rt,this.body=Ot};s.ForOfStatement=fe;var ae=function(Be,rt,Ot,Tn){this.type=l.Syntax.ForStatement,this.init=Be,this.test=rt,this.update=Ot,this.body=Tn};s.ForStatement=ae;var de=function(Be,rt,Ot,Tn){this.type=l.Syntax.FunctionDeclaration,this.id=Be,this.params=rt,this.body=Ot,this.generator=Tn,this.expression=!1,this.async=!1};s.FunctionDeclaration=de;var we=function(Be,rt,Ot,Tn){this.type=l.Syntax.FunctionExpression,this.id=Be,this.params=rt,this.body=Ot,this.generator=Tn,this.expression=!1,this.async=!1};s.FunctionExpression=we;var _e=function(Be){this.type=l.Syntax.Identifier,this.name=Be};s.Identifier=_e;var Te=function(Be,rt,Ot){this.type=l.Syntax.IfStatement,this.test=Be,this.consequent=rt,this.alternate=Ot};s.IfStatement=Te;var G=function(Be,rt){this.type=l.Syntax.ImportDeclaration,this.specifiers=Be,this.source=rt};s.ImportDeclaration=G;var P=function(Be){this.type=l.Syntax.ImportDefaultSpecifier,this.local=Be};s.ImportDefaultSpecifier=P;var $=function(Be){this.type=l.Syntax.ImportNamespaceSpecifier,this.local=Be};s.ImportNamespaceSpecifier=$;var W=function(Be,rt){this.type=l.Syntax.ImportSpecifier,this.local=Be,this.imported=rt};s.ImportSpecifier=W;var q=function(Be,rt){this.type=l.Syntax.LabeledStatement,this.label=Be,this.body=rt};s.LabeledStatement=q;var Q=function(Be,rt){this.type=l.Syntax.Literal,this.value=Be,this.raw=rt};s.Literal=Q;var ee=function(Be,rt){this.type=l.Syntax.MetaProperty,this.meta=Be,this.property=rt};s.MetaProperty=ee;var ge=function(Be,rt,Ot,Tn,Di){this.type=l.Syntax.MethodDefinition,this.key=Be,this.computed=rt,this.value=Ot,this.kind=Tn,this.static=Di};s.MethodDefinition=ge;var De=function(Be){this.type=l.Syntax.Program,this.body=Be,this.sourceType="module"};s.Module=De;var Ne=function(Be,rt){this.type=l.Syntax.NewExpression,this.callee=Be,this.arguments=rt};s.NewExpression=Ne;var We=function(Be){this.type=l.Syntax.ObjectExpression,this.properties=Be};s.ObjectExpression=We;var re=function(Be){this.type=l.Syntax.ObjectPattern,this.properties=Be};s.ObjectPattern=re;var se=function(Be,rt,Ot,Tn,Di,rn){this.type=l.Syntax.Property,this.key=rt,this.computed=Ot,this.value=Tn,this.kind=Be,this.method=Di,this.shorthand=rn};s.Property=se;var ve=function(Be,rt,Ot,Tn){this.type=l.Syntax.Literal,this.value=Be,this.raw=rt,this.regex={pattern:Ot,flags:Tn}};s.RegexLiteral=ve;var le=function(Be){this.type=l.Syntax.RestElement,this.argument=Be};s.RestElement=le;var pe=function(Be){this.type=l.Syntax.ReturnStatement,this.argument=Be};s.ReturnStatement=pe;var $e=function(Be){this.type=l.Syntax.Program,this.body=Be,this.sourceType="script"};s.Script=$e;var oe=function(Be){this.type=l.Syntax.SequenceExpression,this.expressions=Be};s.SequenceExpression=oe;var st=function(Be){this.type=l.Syntax.SpreadElement,this.argument=Be};s.SpreadElement=st;var gt=function(Be,rt){this.type=l.Syntax.MemberExpression,this.computed=!1,this.object=Be,this.property=rt};s.StaticMemberExpression=gt;var ct=function(){this.type=l.Syntax.Super};s.Super=ct;var Ee=function(Be,rt){this.type=l.Syntax.SwitchCase,this.test=Be,this.consequent=rt};s.SwitchCase=Ee;var ze=function(Be,rt){this.type=l.Syntax.SwitchStatement,this.discriminant=Be,this.cases=rt};s.SwitchStatement=ze;var qe=function(Be,rt){this.type=l.Syntax.TaggedTemplateExpression,this.tag=Be,this.quasi=rt};s.TaggedTemplateExpression=qe;var Je=function(Be,rt){this.type=l.Syntax.TemplateElement,this.value=Be,this.tail=rt};s.TemplateElement=Je;var lt=function(Be,rt){this.type=l.Syntax.TemplateLiteral,this.quasis=Be,this.expressions=rt};s.TemplateLiteral=lt;var Pe=function(){this.type=l.Syntax.ThisExpression};s.ThisExpression=Pe;var Fe=function(Be){this.type=l.Syntax.ThrowStatement,this.argument=Be};s.ThrowStatement=Fe;var nt=function(Be,rt,Ot){this.type=l.Syntax.TryStatement,this.block=Be,this.handler=rt,this.finalizer=Ot};s.TryStatement=nt;var wt=function(Be,rt){this.type=l.Syntax.UnaryExpression,this.operator=Be,this.argument=rt,this.prefix=!0};s.UnaryExpression=wt;var yn=function(Be,rt,Ot){this.type=l.Syntax.UpdateExpression,this.operator=Be,this.argument=rt,this.prefix=Ot};s.UpdateExpression=yn;var bn=function(Be,rt){this.type=l.Syntax.VariableDeclaration,this.declarations=Be,this.kind=rt};s.VariableDeclaration=bn;var fn=function(Be,rt){this.type=l.Syntax.VariableDeclarator,this.id=Be,this.init=rt};s.VariableDeclarator=fn;var sn=function(Be,rt){this.type=l.Syntax.WhileStatement,this.test=Be,this.body=rt};s.WhileStatement=sn;var bi=function(Be,rt){this.type=l.Syntax.WithStatement,this.object=Be,this.body=rt};s.WithStatement=bi;var Kt=function(Be,rt){this.type=l.Syntax.YieldExpression,this.argument=Be,this.delegate=rt};s.YieldExpression=Kt},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(9),f=c(10),u=c(11),d=c(7),h=c(12),g=c(2),p=c(13),m=(function(){function w(v,y,C){y===void 0&&(y={}),this.config={range:typeof y.range=="boolean"&&y.range,loc:typeof y.loc=="boolean"&&y.loc,source:null,tokens:typeof y.tokens=="boolean"&&y.tokens,comment:typeof y.comment=="boolean"&&y.comment,tolerant:typeof y.tolerant=="boolean"&&y.tolerant},this.config.loc&&y.source&&y.source!==null&&(this.config.source=String(y.source)),this.delegate=C,this.errorHandler=new f.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new h.Scanner(v,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return w.prototype.throwError=function(v){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];var x=Array.prototype.slice.call(arguments,1),T=v.replace(/%(\d)/g,(function(D,b){return l.assert(b<x.length,"Message reference must be in range"),x[b]})),S=this.lastMarker.index,_=this.lastMarker.line,E=this.lastMarker.column+1;throw this.errorHandler.createError(S,_,E,T)},w.prototype.tolerateError=function(v){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];var x=Array.prototype.slice.call(arguments,1),T=v.replace(/%(\d)/g,(function(D,b){return l.assert(b<x.length,"Message reference must be in range"),x[b]})),S=this.lastMarker.index,_=this.scanner.lineNumber,E=this.lastMarker.column+1;this.errorHandler.tolerateError(S,_,E,T)},w.prototype.unexpectedTokenError=function(v,y){var C,x=y||u.Messages.UnexpectedToken;if(v?(y||(x=v.type===2?u.Messages.UnexpectedEOS:v.type===3?u.Messages.UnexpectedIdentifier:v.type===6?u.Messages.UnexpectedNumber:v.type===8?u.Messages.UnexpectedString:v.type===10?u.Messages.UnexpectedTemplate:u.Messages.UnexpectedToken,v.type===4&&(this.scanner.isFutureReservedWord(v.value)?x=u.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(v.value)&&(x=u.Messages.StrictReservedWord))),C=v.value):C="ILLEGAL",x=x.replace("%0",C),v&&typeof v.lineNumber=="number"){var T=v.start,S=v.lineNumber,_=this.lastMarker.index-this.lastMarker.column,E=v.start-_+1;return this.errorHandler.createError(T,S,E,x)}return T=this.lastMarker.index,S=this.lastMarker.line,E=this.lastMarker.column+1,this.errorHandler.createError(T,S,E,x)},w.prototype.throwUnexpectedToken=function(v,y){throw this.unexpectedTokenError(v,y)},w.prototype.tolerateUnexpectedToken=function(v,y){this.errorHandler.tolerate(this.unexpectedTokenError(v,y))},w.prototype.collectComments=function(){if(this.config.comment){var v=this.scanner.scanComments();if(v.length>0&&this.delegate)for(var y=0;y<v.length;++y){var C=v[y],x=void 0;x={type:C.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(C.slice[0],C.slice[1])},this.config.range&&(x.range=C.range),this.config.loc&&(x.loc=C.loc);var T={start:{line:C.loc.start.line,column:C.loc.start.column,offset:C.range[0]},end:{line:C.loc.end.line,column:C.loc.end.column,offset:C.range[1]}};this.delegate(x,T)}}else this.scanner.scanComments()},w.prototype.getTokenRaw=function(v){return this.scanner.source.slice(v.start,v.end)},w.prototype.convertToken=function(v){var y={type:p.TokenName[v.type],value:this.getTokenRaw(v)};if(this.config.range&&(y.range=[v.start,v.end]),this.config.loc&&(y.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),v.type===9){var C=v.pattern,x=v.flags;y.regex={pattern:C,flags:x}}return y},w.prototype.nextToken=function(){var v=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var y=this.scanner.lex();return this.hasLineTerminator=v.lineNumber!==y.lineNumber,y&&this.context.strict&&y.type===3&&this.scanner.isStrictModeReservedWord(y.value)&&(y.type=4),this.lookahead=y,this.config.tokens&&y.type!==2&&this.tokens.push(this.convertToken(y)),v},w.prototype.nextRegexToken=function(){this.collectComments();var v=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(v))),this.lookahead=v,this.nextToken(),v},w.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},w.prototype.startNode=function(v,y){y===void 0&&(y=0);var C=v.start-v.lineStart,x=v.lineNumber;return C<0&&(C+=y,x--),{index:v.start,line:x,column:C}},w.prototype.finalize=function(v,y){if(this.config.range&&(y.range=[v.index,this.lastMarker.index]),this.config.loc&&(y.loc={start:{line:v.line,column:v.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(y.loc.source=this.config.source)),this.delegate){var C={start:{line:v.line,column:v.column,offset:v.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(y,C)}return y},w.prototype.expect=function(v){var y=this.nextToken();y.type===7&&y.value===v||this.throwUnexpectedToken(y)},w.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var v=this.lookahead;v.type===7&&v.value===","?this.nextToken():v.type===7&&v.value===";"?(this.nextToken(),this.tolerateUnexpectedToken(v)):this.tolerateUnexpectedToken(v,u.Messages.UnexpectedToken)}else this.expect(",")},w.prototype.expectKeyword=function(v){var y=this.nextToken();y.type===4&&y.value===v||this.throwUnexpectedToken(y)},w.prototype.match=function(v){return this.lookahead.type===7&&this.lookahead.value===v},w.prototype.matchKeyword=function(v){return this.lookahead.type===4&&this.lookahead.value===v},w.prototype.matchContextualKeyword=function(v){return this.lookahead.type===3&&this.lookahead.value===v},w.prototype.matchAssign=function(){if(this.lookahead.type!==7)return!1;var v=this.lookahead.value;return v==="="||v==="*="||v==="**="||v==="/="||v==="%="||v==="+="||v==="-="||v==="<<="||v===">>="||v===">>>="||v==="&="||v==="^="||v==="|="},w.prototype.isolateCoverGrammar=function(v){var y=this.context.isBindingElement,C=this.context.isAssignmentTarget,x=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var T=v.call(this);return this.context.firstCoverInitializedNameError!==null&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=y,this.context.isAssignmentTarget=C,this.context.firstCoverInitializedNameError=x,T},w.prototype.inheritCoverGrammar=function(v){var y=this.context.isBindingElement,C=this.context.isAssignmentTarget,x=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var T=v.call(this);return this.context.isBindingElement=this.context.isBindingElement&&y,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&C,this.context.firstCoverInitializedNameError=x||this.context.firstCoverInitializedNameError,T},w.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(this.lookahead.type===2||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},w.prototype.parsePrimaryExpression=function(){var v,y,C,x=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&this.lookahead.value==="await"&&this.tolerateUnexpectedToken(this.lookahead),v=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(x,new d.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,u.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),C=this.getTokenRaw(y),v=this.finalize(x,new d.Literal(y.value,C));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),C=this.getTokenRaw(y),v=this.finalize(x,new d.Literal(y.value==="true",C));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),C=this.getTokenRaw(y),v=this.finalize(x,new d.Literal(null,C));break;case 10:v=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,v=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":v=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":v=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,y=this.nextRegexToken(),C=this.getTokenRaw(y),v=this.finalize(x,new d.RegexLiteral(y.regex,C,y.pattern,y.flags));break;default:v=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?v=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?v=this.finalize(x,new d.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?v=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),v=this.finalize(x,new d.ThisExpression)):v=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:v=this.throwUnexpectedToken(this.nextToken())}return v},w.prototype.parseSpreadElement=function(){var v=this.createNode();this.expect("...");var y=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(v,new d.SpreadElement(y))},w.prototype.parseArrayInitializer=function(){var v=this.createNode(),y=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),y.push(null);else if(this.match("...")){var C=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),y.push(C)}else y.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(v,new d.ArrayExpression(y))},w.prototype.parsePropertyMethod=function(v){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var y=this.context.strict,C=this.context.allowStrictDirective;this.context.allowStrictDirective=v.simple;var x=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&v.firstRestricted&&this.tolerateUnexpectedToken(v.firstRestricted,v.message),this.context.strict&&v.stricted&&this.tolerateUnexpectedToken(v.stricted,v.message),this.context.strict=y,this.context.allowStrictDirective=C,x},w.prototype.parsePropertyMethodFunction=function(){var v=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters(),x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(v,new d.FunctionExpression(null,C.params,x,!1))},w.prototype.parsePropertyMethodAsyncFunction=function(){var v=this.createNode(),y=this.context.allowYield,C=this.context.await;this.context.allowYield=!1,this.context.await=!0;var x=this.parseFormalParameters(),T=this.parsePropertyMethod(x);return this.context.allowYield=y,this.context.await=C,this.finalize(v,new d.AsyncFunctionExpression(null,x.params,T))},w.prototype.parseObjectPropertyKey=function(){var v,y=this.createNode(),C=this.nextToken();switch(C.type){case 8:case 6:this.context.strict&&C.octal&&this.tolerateUnexpectedToken(C,u.Messages.StrictOctalLiteral);var x=this.getTokenRaw(C);v=this.finalize(y,new d.Literal(C.value,x));break;case 3:case 1:case 5:case 4:v=this.finalize(y,new d.Identifier(C.value));break;case 7:C.value==="["?(v=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):v=this.throwUnexpectedToken(C);break;default:v=this.throwUnexpectedToken(C)}return v},w.prototype.isPropertyKey=function(v,y){return v.type===g.Syntax.Identifier&&v.name===y||v.type===g.Syntax.Literal&&v.value===y},w.prototype.parseObjectProperty=function(v){var y,C=this.createNode(),x=this.lookahead,T=null,S=null,_=!1,E=!1,D=!1,b=!1;if(x.type===3){var I=x.value;this.nextToken(),_=this.match("["),T=(b=!(this.hasLineTerminator||I!=="async"||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(C,new d.Identifier(I))}else this.match("*")?this.nextToken():(_=this.match("["),T=this.parseObjectPropertyKey());var O=this.qualifiedPropertyName(this.lookahead);if(x.type===3&&!b&&x.value==="get"&&O)y="get",_=this.match("["),T=this.parseObjectPropertyKey(),this.context.allowYield=!1,S=this.parseGetterMethod();else if(x.type===3&&!b&&x.value==="set"&&O)y="set",_=this.match("["),T=this.parseObjectPropertyKey(),S=this.parseSetterMethod();else if(x.type===7&&x.value==="*"&&O)y="init",_=this.match("["),T=this.parseObjectPropertyKey(),S=this.parseGeneratorMethod(),E=!0;else if(T||this.throwUnexpectedToken(this.lookahead),y="init",this.match(":")&&!b)!_&&this.isPropertyKey(T,"__proto__")&&(v.value&&this.tolerateError(u.Messages.DuplicateProtoProperty),v.value=!0),this.nextToken(),S=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))S=b?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),E=!0;else if(x.type===3)if(I=this.finalize(C,new d.Identifier(x.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),D=!0;var M=this.isolateCoverGrammar(this.parseAssignmentExpression);S=this.finalize(C,new d.AssignmentPattern(I,M))}else D=!0,S=I;else this.throwUnexpectedToken(this.nextToken());return this.finalize(C,new d.Property(y,T,_,S,E,D))},w.prototype.parseObjectInitializer=function(){var v=this.createNode();this.expect("{");for(var y=[],C={value:!1};!this.match("}");)y.push(this.parseObjectProperty(C)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(v,new d.ObjectExpression(y))},w.prototype.parseTemplateHead=function(){l.assert(this.lookahead.head,"Template literal must start with a template head");var v=this.createNode(),y=this.nextToken(),C=y.value,x=y.cooked;return this.finalize(v,new d.TemplateElement({raw:C,cooked:x},y.tail))},w.prototype.parseTemplateElement=function(){this.lookahead.type!==10&&this.throwUnexpectedToken();var v=this.createNode(),y=this.nextToken(),C=y.value,x=y.cooked;return this.finalize(v,new d.TemplateElement({raw:C,cooked:x},y.tail))},w.prototype.parseTemplateLiteral=function(){var v=this.createNode(),y=[],C=[],x=this.parseTemplateHead();for(C.push(x);!x.tail;)y.push(this.parseExpression()),x=this.parseTemplateElement(),C.push(x);return this.finalize(v,new d.TemplateLiteral(C,y))},w.prototype.reinterpretExpressionAsPattern=function(v){switch(v.type){case g.Syntax.Identifier:case g.Syntax.MemberExpression:case g.Syntax.RestElement:case g.Syntax.AssignmentPattern:break;case g.Syntax.SpreadElement:v.type=g.Syntax.RestElement,this.reinterpretExpressionAsPattern(v.argument);break;case g.Syntax.ArrayExpression:v.type=g.Syntax.ArrayPattern;for(var y=0;y<v.elements.length;y++)v.elements[y]!==null&&this.reinterpretExpressionAsPattern(v.elements[y]);break;case g.Syntax.ObjectExpression:for(v.type=g.Syntax.ObjectPattern,y=0;y<v.properties.length;y++)this.reinterpretExpressionAsPattern(v.properties[y].value);break;case g.Syntax.AssignmentExpression:v.type=g.Syntax.AssignmentPattern,delete v.operator,this.reinterpretExpressionAsPattern(v.left)}},w.prototype.parseGroupExpression=function(){var v;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),v={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var y=this.lookahead,C=[];if(this.match("..."))v=this.parseRestElement(C),this.expect(")"),this.match("=>")||this.expect("=>"),v={type:"ArrowParameterPlaceHolder",params:[v],async:!1};else{var x=!1;if(this.context.isBindingElement=!0,v=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var T=[];for(this.context.isAssignmentTarget=!1,T.push(v);this.lookahead.type!==2&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var S=0;S<T.length;S++)this.reinterpretExpressionAsPattern(T[S]);x=!0,v={type:"ArrowParameterPlaceHolder",params:T,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),T.push(this.parseRestElement(C)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,S=0;S<T.length;S++)this.reinterpretExpressionAsPattern(T[S]);x=!0,v={type:"ArrowParameterPlaceHolder",params:T,async:!1}}else T.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(x)break}x||(v=this.finalize(this.startNode(y),new d.SequenceExpression(T)))}if(!x){if(this.expect(")"),this.match("=>")&&(v.type===g.Syntax.Identifier&&v.name==="yield"&&(x=!0,v={type:"ArrowParameterPlaceHolder",params:[v],async:!1}),!x)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),v.type===g.Syntax.SequenceExpression)for(S=0;S<v.expressions.length;S++)this.reinterpretExpressionAsPattern(v.expressions[S]);else this.reinterpretExpressionAsPattern(v);v={type:"ArrowParameterPlaceHolder",params:v.type===g.Syntax.SequenceExpression?v.expressions:[v],async:!1}}this.context.isBindingElement=!1}}}return v},w.prototype.parseArguments=function(){this.expect("(");var v=[];if(!this.match(")"))for(;;){var y=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(v.push(y),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),v},w.prototype.isIdentifierName=function(v){return v.type===3||v.type===4||v.type===1||v.type===5},w.prototype.parseIdentifierName=function(){var v=this.createNode(),y=this.nextToken();return this.isIdentifierName(y)||this.throwUnexpectedToken(y),this.finalize(v,new d.Identifier(y.value))},w.prototype.parseNewExpression=function(){var v,y=this.createNode(),C=this.parseIdentifierName();if(l.assert(C.name==="new","New expression must start with `new`"),this.match("."))if(this.nextToken(),this.lookahead.type===3&&this.context.inFunctionBody&&this.lookahead.value==="target"){var x=this.parseIdentifierName();v=new d.MetaProperty(C,x)}else this.throwUnexpectedToken(this.lookahead);else{var T=this.isolateCoverGrammar(this.parseLeftHandSideExpression),S=this.match("(")?this.parseArguments():[];v=new d.NewExpression(T,S),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(y,v)},w.prototype.parseAsyncArgument=function(){var v=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,v},w.prototype.parseAsyncArguments=function(){this.expect("(");var v=[];if(!this.match(")"))for(;;){var y=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(v.push(y),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),v},w.prototype.parseLeftHandSideExpressionAllowCall=function(){var v,y=this.lookahead,C=this.matchContextualKeyword("async"),x=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(v=this.createNode(),this.nextToken(),v=this.finalize(v,new d.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):v=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var T=this.parseIdentifierName();v=this.finalize(this.startNode(y),new d.StaticMemberExpression(v,T))}else if(this.match("(")){var S=C&&y.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var _=S?this.parseAsyncArguments():this.parseArguments();if(v=this.finalize(this.startNode(y),new d.CallExpression(v,_)),S&&this.match("=>")){for(var E=0;E<_.length;++E)this.reinterpretExpressionAsPattern(_[E]);v={type:"ArrowParameterPlaceHolder",params:_,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),T=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),v=this.finalize(this.startNode(y),new d.ComputedMemberExpression(v,T));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var D=this.parseTemplateLiteral();v=this.finalize(this.startNode(y),new d.TaggedTemplateExpression(v,D))}return this.context.allowIn=x,v},w.prototype.parseSuper=function(){var v=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(v,new d.Super)},w.prototype.parseLeftHandSideExpression=function(){l.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var v=this.startNode(this.lookahead),y=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var C=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),y=this.finalize(v,new d.ComputedMemberExpression(y,C))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),C=this.parseIdentifierName(),y=this.finalize(v,new d.StaticMemberExpression(y,C));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var x=this.parseTemplateLiteral();y=this.finalize(v,new d.TaggedTemplateExpression(y,x))}return y},w.prototype.parseUpdateExpression=function(){var v,y=this.lookahead;if(this.match("++")||this.match("--")){var C=this.startNode(y),x=this.nextToken();v=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&v.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(v.name)&&this.tolerateError(u.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment);var T=!0;v=this.finalize(C,new d.UpdateExpression(x.value,v,T)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(v=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&this.lookahead.type===7&&(this.match("++")||this.match("--"))){this.context.strict&&v.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(v.name)&&this.tolerateError(u.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var S=this.nextToken().value;T=!1,v=this.finalize(this.startNode(y),new d.UpdateExpression(S,v,T))}return v},w.prototype.parseAwaitExpression=function(){var v=this.createNode();this.nextToken();var y=this.parseUnaryExpression();return this.finalize(v,new d.AwaitExpression(y))},w.prototype.parseUnaryExpression=function(){var v;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var y=this.startNode(this.lookahead),C=this.nextToken();v=this.inheritCoverGrammar(this.parseUnaryExpression),v=this.finalize(y,new d.UnaryExpression(C.value,v)),this.context.strict&&v.operator==="delete"&&v.argument.type===g.Syntax.Identifier&&this.tolerateError(u.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else v=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return v},w.prototype.parseExponentiationExpression=function(){var v=this.lookahead,y=this.inheritCoverGrammar(this.parseUnaryExpression);if(y.type!==g.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var C=y,x=this.isolateCoverGrammar(this.parseExponentiationExpression);y=this.finalize(this.startNode(v),new d.BinaryExpression("**",C,x))}return y},w.prototype.binaryPrecedence=function(v){var y=v.value;return v.type===7?this.operatorPrecedence[y]||0:v.type===4&&(y==="instanceof"||this.context.allowIn&&y==="in")?7:0},w.prototype.parseBinaryExpression=function(){var v=this.lookahead,y=this.inheritCoverGrammar(this.parseExponentiationExpression),C=this.lookahead,x=this.binaryPrecedence(C);if(x>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var T=[v,this.lookahead],S=y,_=this.isolateCoverGrammar(this.parseExponentiationExpression),E=[S,C.value,_],D=[x];!((x=this.binaryPrecedence(this.lookahead))<=0);){for(;E.length>2&&x<=D[D.length-1];){_=E.pop();var b=E.pop();D.pop(),S=E.pop(),T.pop();var I=this.startNode(T[T.length-1]);E.push(this.finalize(I,new d.BinaryExpression(b,S,_)))}E.push(this.nextToken().value),D.push(x),T.push(this.lookahead),E.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var O=E.length-1;y=E[O];for(var M=T.pop();O>1;){var R=T.pop(),A=M&&M.lineStart;I=this.startNode(R,A),b=E[O-1],y=this.finalize(I,new d.BinaryExpression(b,E[O-2],y)),O-=2,M=R}}return y},w.prototype.parseConditionalExpression=function(){var v=this.lookahead,y=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var C=this.context.allowIn;this.context.allowIn=!0;var x=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=C,this.expect(":");var T=this.isolateCoverGrammar(this.parseAssignmentExpression);y=this.finalize(this.startNode(v),new d.ConditionalExpression(y,x,T)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return y},w.prototype.checkPatternParam=function(v,y){switch(y.type){case g.Syntax.Identifier:this.validateParam(v,y,y.name);break;case g.Syntax.RestElement:this.checkPatternParam(v,y.argument);break;case g.Syntax.AssignmentPattern:this.checkPatternParam(v,y.left);break;case g.Syntax.ArrayPattern:for(var C=0;C<y.elements.length;C++)y.elements[C]!==null&&this.checkPatternParam(v,y.elements[C]);break;case g.Syntax.ObjectPattern:for(C=0;C<y.properties.length;C++)this.checkPatternParam(v,y.properties[C].value)}v.simple=v.simple&&y instanceof d.Identifier},w.prototype.reinterpretAsCoverFormalsList=function(v){var y,C=[v],x=!1;switch(v.type){case g.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":C=v.params,x=v.async;break;default:return null}y={simple:!0,paramSet:{}};for(var T=0;T<C.length;++T)(S=C[T]).type===g.Syntax.AssignmentPattern?S.right.type===g.Syntax.YieldExpression&&(S.right.argument&&this.throwUnexpectedToken(this.lookahead),S.right.type=g.Syntax.Identifier,S.right.name="yield",delete S.right.argument,delete S.right.delegate):x&&S.type===g.Syntax.Identifier&&S.name==="await"&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(y,S),C[T]=S;if(this.context.strict||!this.context.allowYield)for(T=0;T<C.length;++T){var S;(S=C[T]).type===g.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(y.message===u.Messages.StrictParamDupe){var _=this.context.strict?y.stricted:y.firstRestricted;this.throwUnexpectedToken(_,y.message)}return{simple:y.simple,params:C,stricted:y.stricted,firstRestricted:y.firstRestricted,message:y.message}},w.prototype.parseAssignmentExpression=function(){var v;if(!this.context.allowYield&&this.matchKeyword("yield"))v=this.parseYieldExpression();else{var y=this.lookahead,C=y;if(v=this.parseConditionalExpression(),C.type===3&&C.lineNumber===this.lookahead.lineNumber&&C.value==="async"&&(this.lookahead.type===3||this.matchKeyword("yield"))){var x=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(x),v={type:"ArrowParameterPlaceHolder",params:[x],async:!0}}if(v.type==="ArrowParameterPlaceHolder"||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var T=v.async,S=this.reinterpretAsCoverFormalsList(v);if(S){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var _=this.context.strict,E=this.context.allowStrictDirective;this.context.allowStrictDirective=S.simple;var D=this.context.allowYield,b=this.context.await;this.context.allowYield=!0,this.context.await=T;var I=this.startNode(y);this.expect("=>");var O=void 0;if(this.match("{")){var M=this.context.allowIn;this.context.allowIn=!0,O=this.parseFunctionSourceElements(),this.context.allowIn=M}else O=this.isolateCoverGrammar(this.parseAssignmentExpression);var R=O.type!==g.Syntax.BlockStatement;this.context.strict&&S.firstRestricted&&this.throwUnexpectedToken(S.firstRestricted,S.message),this.context.strict&&S.stricted&&this.tolerateUnexpectedToken(S.stricted,S.message),v=T?this.finalize(I,new d.AsyncArrowFunctionExpression(S.params,O,R)):this.finalize(I,new d.ArrowFunctionExpression(S.params,O,R)),this.context.strict=_,this.context.allowStrictDirective=E,this.context.allowYield=D,this.context.await=b}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment),this.context.strict&&v.type===g.Syntax.Identifier){var A=v;this.scanner.isRestrictedWord(A.name)&&this.tolerateUnexpectedToken(C,u.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(A.name)&&this.tolerateUnexpectedToken(C,u.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(v):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var B=(C=this.nextToken()).value,k=this.isolateCoverGrammar(this.parseAssignmentExpression);v=this.finalize(this.startNode(y),new d.AssignmentExpression(B,v,k)),this.context.firstCoverInitializedNameError=null}}return v},w.prototype.parseExpression=function(){var v=this.lookahead,y=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var C=[];for(C.push(y);this.lookahead.type!==2&&this.match(",");)this.nextToken(),C.push(this.isolateCoverGrammar(this.parseAssignmentExpression));y=this.finalize(this.startNode(v),new d.SequenceExpression(C))}return y},w.prototype.parseStatementListItem=function(){var v;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,this.lookahead.type===4)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,u.Messages.IllegalExportDeclaration),v=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,u.Messages.IllegalImportDeclaration),v=this.parseImportDeclaration();break;case"const":v=this.parseLexicalDeclaration({inFor:!1});break;case"function":v=this.parseFunctionDeclaration();break;case"class":v=this.parseClassDeclaration();break;case"let":v=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:v=this.parseStatement()}else v=this.parseStatement();return v},w.prototype.parseBlock=function(){var v=this.createNode();this.expect("{");for(var y=[];!this.match("}");)y.push(this.parseStatementListItem());return this.expect("}"),this.finalize(v,new d.BlockStatement(y))},w.prototype.parseLexicalBinding=function(v,y){var C=this.createNode(),x=this.parsePattern([],v);this.context.strict&&x.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(x.name)&&this.tolerateError(u.Messages.StrictVarName);var T=null;return v==="const"?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),T=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(u.Messages.DeclarationMissingInitializer,"const")):(!y.inFor&&x.type!==g.Syntax.Identifier||this.match("="))&&(this.expect("="),T=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(C,new d.VariableDeclarator(x,T))},w.prototype.parseBindingList=function(v,y){for(var C=[this.parseLexicalBinding(v,y)];this.match(",");)this.nextToken(),C.push(this.parseLexicalBinding(v,y));return C},w.prototype.isLexicalDeclaration=function(){var v=this.scanner.saveState();this.scanner.scanComments();var y=this.scanner.lex();return this.scanner.restoreState(v),y.type===3||y.type===7&&y.value==="["||y.type===7&&y.value==="{"||y.type===4&&y.value==="let"||y.type===4&&y.value==="yield"},w.prototype.parseLexicalDeclaration=function(v){var y=this.createNode(),C=this.nextToken().value;l.assert(C==="let"||C==="const","Lexical declaration must be either let or const");var x=this.parseBindingList(C,v);return this.consumeSemicolon(),this.finalize(y,new d.VariableDeclaration(x,C))},w.prototype.parseBindingRestElement=function(v,y){var C=this.createNode();this.expect("...");var x=this.parsePattern(v,y);return this.finalize(C,new d.RestElement(x))},w.prototype.parseArrayPattern=function(v,y){var C=this.createNode();this.expect("[");for(var x=[];!this.match("]");)if(this.match(","))this.nextToken(),x.push(null);else{if(this.match("...")){x.push(this.parseBindingRestElement(v,y));break}x.push(this.parsePatternWithDefault(v,y)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(C,new d.ArrayPattern(x))},w.prototype.parsePropertyPattern=function(v,y){var C,x,T=this.createNode(),S=!1,_=!1;if(this.lookahead.type===3){var E=this.lookahead;C=this.parseVariableIdentifier();var D=this.finalize(T,new d.Identifier(E.value));if(this.match("=")){v.push(E),_=!0,this.nextToken();var b=this.parseAssignmentExpression();x=this.finalize(this.startNode(E),new d.AssignmentPattern(D,b))}else this.match(":")?(this.expect(":"),x=this.parsePatternWithDefault(v,y)):(v.push(E),_=!0,x=D)}else S=this.match("["),C=this.parseObjectPropertyKey(),this.expect(":"),x=this.parsePatternWithDefault(v,y);return this.finalize(T,new d.Property("init",C,S,x,!1,_))},w.prototype.parseObjectPattern=function(v,y){var C=this.createNode(),x=[];for(this.expect("{");!this.match("}");)x.push(this.parsePropertyPattern(v,y)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(C,new d.ObjectPattern(x))},w.prototype.parsePattern=function(v,y){var C;return this.match("[")?C=this.parseArrayPattern(v,y):this.match("{")?C=this.parseObjectPattern(v,y):(!this.matchKeyword("let")||y!=="const"&&y!=="let"||this.tolerateUnexpectedToken(this.lookahead,u.Messages.LetInLexicalBinding),v.push(this.lookahead),C=this.parseVariableIdentifier(y)),C},w.prototype.parsePatternWithDefault=function(v,y){var C=this.lookahead,x=this.parsePattern(v,y);if(this.match("=")){this.nextToken();var T=this.context.allowYield;this.context.allowYield=!0;var S=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=T,x=this.finalize(this.startNode(C),new d.AssignmentPattern(x,S))}return x},w.prototype.parseVariableIdentifier=function(v){var y=this.createNode(),C=this.nextToken();return C.type===4&&C.value==="yield"?this.context.strict?this.tolerateUnexpectedToken(C,u.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(C):C.type!==3?this.context.strict&&C.type===4&&this.scanner.isStrictModeReservedWord(C.value)?this.tolerateUnexpectedToken(C,u.Messages.StrictReservedWord):(this.context.strict||C.value!=="let"||v!=="var")&&this.throwUnexpectedToken(C):(this.context.isModule||this.context.await)&&C.type===3&&C.value==="await"&&this.tolerateUnexpectedToken(C),this.finalize(y,new d.Identifier(C.value))},w.prototype.parseVariableDeclaration=function(v){var y=this.createNode(),C=this.parsePattern([],"var");this.context.strict&&C.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(C.name)&&this.tolerateError(u.Messages.StrictVarName);var x=null;return this.match("=")?(this.nextToken(),x=this.isolateCoverGrammar(this.parseAssignmentExpression)):C.type===g.Syntax.Identifier||v.inFor||this.expect("="),this.finalize(y,new d.VariableDeclarator(C,x))},w.prototype.parseVariableDeclarationList=function(v){var y={inFor:v.inFor},C=[];for(C.push(this.parseVariableDeclaration(y));this.match(",");)this.nextToken(),C.push(this.parseVariableDeclaration(y));return C},w.prototype.parseVariableStatement=function(){var v=this.createNode();this.expectKeyword("var");var y=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(v,new d.VariableDeclaration(y,"var"))},w.prototype.parseEmptyStatement=function(){var v=this.createNode();return this.expect(";"),this.finalize(v,new d.EmptyStatement)},w.prototype.parseExpressionStatement=function(){var v=this.createNode(),y=this.parseExpression();return this.consumeSemicolon(),this.finalize(v,new d.ExpressionStatement(y))},w.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(u.Messages.StrictFunction),this.parseStatement()},w.prototype.parseIfStatement=function(){var v,y=this.createNode(),C=null;this.expectKeyword("if"),this.expect("(");var x=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),v=this.finalize(this.createNode(),new d.EmptyStatement)):(this.expect(")"),v=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),C=this.parseIfClause())),this.finalize(y,new d.IfStatement(x,v,C))},w.prototype.parseDoWhileStatement=function(){var v=this.createNode();this.expectKeyword("do");var y=this.context.inIteration;this.context.inIteration=!0;var C=this.parseStatement();this.context.inIteration=y,this.expectKeyword("while"),this.expect("(");var x=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(v,new d.DoWhileStatement(C,x))},w.prototype.parseWhileStatement=function(){var v,y=this.createNode();this.expectKeyword("while"),this.expect("(");var C=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),v=this.finalize(this.createNode(),new d.EmptyStatement);else{this.expect(")");var x=this.context.inIteration;this.context.inIteration=!0,v=this.parseStatement(),this.context.inIteration=x}return this.finalize(y,new d.WhileStatement(C,v))},w.prototype.parseForStatement=function(){var v,y,C,x=null,T=null,S=null,_=!0,E=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){x=this.createNode(),this.nextToken();var D=this.context.allowIn;this.context.allowIn=!1;var b=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=D,b.length===1&&this.matchKeyword("in")){var I=b[0];I.init&&(I.id.type===g.Syntax.ArrayPattern||I.id.type===g.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(u.Messages.ForInOfLoopInitializer,"for-in"),x=this.finalize(x,new d.VariableDeclaration(b,"var")),this.nextToken(),v=x,y=this.parseExpression(),x=null}else b.length===1&&b[0].init===null&&this.matchContextualKeyword("of")?(x=this.finalize(x,new d.VariableDeclaration(b,"var")),this.nextToken(),v=x,y=this.parseAssignmentExpression(),x=null,_=!1):(x=this.finalize(x,new d.VariableDeclaration(b,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){x=this.createNode();var O=this.nextToken().value;this.context.strict||this.lookahead.value!=="in"?(D=this.context.allowIn,this.context.allowIn=!1,b=this.parseBindingList(O,{inFor:!0}),this.context.allowIn=D,b.length===1&&b[0].init===null&&this.matchKeyword("in")?(x=this.finalize(x,new d.VariableDeclaration(b,O)),this.nextToken(),v=x,y=this.parseExpression(),x=null):b.length===1&&b[0].init===null&&this.matchContextualKeyword("of")?(x=this.finalize(x,new d.VariableDeclaration(b,O)),this.nextToken(),v=x,y=this.parseAssignmentExpression(),x=null,_=!1):(this.consumeSemicolon(),x=this.finalize(x,new d.VariableDeclaration(b,O)))):(x=this.finalize(x,new d.Identifier(O)),this.nextToken(),v=x,y=this.parseExpression(),x=null)}else{var M=this.lookahead;if(D=this.context.allowIn,this.context.allowIn=!1,x=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=D,this.matchKeyword("in"))this.context.isAssignmentTarget&&x.type!==g.Syntax.AssignmentExpression||this.tolerateError(u.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(x),v=x,y=this.parseExpression(),x=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&x.type!==g.Syntax.AssignmentExpression||this.tolerateError(u.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(x),v=x,y=this.parseAssignmentExpression(),x=null,_=!1;else{if(this.match(",")){for(var R=[x];this.match(",");)this.nextToken(),R.push(this.isolateCoverGrammar(this.parseAssignmentExpression));x=this.finalize(this.startNode(M),new d.SequenceExpression(R))}this.expect(";")}}if(v===void 0&&(this.match(";")||(T=this.parseExpression()),this.expect(";"),this.match(")")||(S=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),C=this.finalize(this.createNode(),new d.EmptyStatement);else{this.expect(")");var A=this.context.inIteration;this.context.inIteration=!0,C=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=A}return v===void 0?this.finalize(E,new d.ForStatement(x,T,S,C)):_?this.finalize(E,new d.ForInStatement(v,y,C)):this.finalize(E,new d.ForOfStatement(v,y,C))},w.prototype.parseContinueStatement=function(){var v=this.createNode();this.expectKeyword("continue");var y=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var C=this.parseVariableIdentifier();y=C;var x="$"+C.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,x)||this.throwError(u.Messages.UnknownLabel,C.name)}return this.consumeSemicolon(),y!==null||this.context.inIteration||this.throwError(u.Messages.IllegalContinue),this.finalize(v,new d.ContinueStatement(y))},w.prototype.parseBreakStatement=function(){var v=this.createNode();this.expectKeyword("break");var y=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var C=this.parseVariableIdentifier(),x="$"+C.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,x)||this.throwError(u.Messages.UnknownLabel,C.name),y=C}return this.consumeSemicolon(),y!==null||this.context.inIteration||this.context.inSwitch||this.throwError(u.Messages.IllegalBreak),this.finalize(v,new d.BreakStatement(y))},w.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(u.Messages.IllegalReturn);var v=this.createNode();this.expectKeyword("return");var y=(this.match(";")||this.match("}")||this.hasLineTerminator||this.lookahead.type===2)&&this.lookahead.type!==8&&this.lookahead.type!==10?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(v,new d.ReturnStatement(y))},w.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(u.Messages.StrictModeWith);var v,y=this.createNode();this.expectKeyword("with"),this.expect("(");var C=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),v=this.finalize(this.createNode(),new d.EmptyStatement)):(this.expect(")"),v=this.parseStatement()),this.finalize(y,new d.WithStatement(C,v))},w.prototype.parseSwitchCase=function(){var v,y=this.createNode();this.matchKeyword("default")?(this.nextToken(),v=null):(this.expectKeyword("case"),v=this.parseExpression()),this.expect(":");for(var C=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)C.push(this.parseStatementListItem());return this.finalize(y,new d.SwitchCase(v,C))},w.prototype.parseSwitchStatement=function(){var v=this.createNode();this.expectKeyword("switch"),this.expect("(");var y=this.parseExpression();this.expect(")");var C=this.context.inSwitch;this.context.inSwitch=!0;var x=[],T=!1;for(this.expect("{");!this.match("}");){var S=this.parseSwitchCase();S.test===null&&(T&&this.throwError(u.Messages.MultipleDefaultsInSwitch),T=!0),x.push(S)}return this.expect("}"),this.context.inSwitch=C,this.finalize(v,new d.SwitchStatement(y,x))},w.prototype.parseLabelledStatement=function(){var v,y=this.createNode(),C=this.parseExpression();if(C.type===g.Syntax.Identifier&&this.match(":")){this.nextToken();var x=C,T="$"+x.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,T)&&this.throwError(u.Messages.Redeclaration,"Label",x.name),this.context.labelSet[T]=!0;var S=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),S=this.parseClassDeclaration();else if(this.matchKeyword("function")){var _=this.lookahead,E=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(_,u.Messages.StrictFunction):E.generator&&this.tolerateUnexpectedToken(_,u.Messages.GeneratorInLegacyContext),S=E}else S=this.parseStatement();delete this.context.labelSet[T],v=new d.LabeledStatement(x,S)}else this.consumeSemicolon(),v=new d.ExpressionStatement(C);return this.finalize(y,v)},w.prototype.parseThrowStatement=function(){var v=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(u.Messages.NewlineAfterThrow);var y=this.parseExpression();return this.consumeSemicolon(),this.finalize(v,new d.ThrowStatement(y))},w.prototype.parseCatchClause=function(){var v=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var y=[],C=this.parsePattern(y),x={},T=0;T<y.length;T++){var S="$"+y[T].value;Object.prototype.hasOwnProperty.call(x,S)&&this.tolerateError(u.Messages.DuplicateBinding,y[T].value),x[S]=!0}this.context.strict&&C.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(C.name)&&this.tolerateError(u.Messages.StrictCatchVariable),this.expect(")");var _=this.parseBlock();return this.finalize(v,new d.CatchClause(C,_))},w.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},w.prototype.parseTryStatement=function(){var v=this.createNode();this.expectKeyword("try");var y=this.parseBlock(),C=this.matchKeyword("catch")?this.parseCatchClause():null,x=this.matchKeyword("finally")?this.parseFinallyClause():null;return C||x||this.throwError(u.Messages.NoCatchOrFinally),this.finalize(v,new d.TryStatement(y,C,x))},w.prototype.parseDebuggerStatement=function(){var v=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(v,new d.DebuggerStatement)},w.prototype.parseStatement=function(){var v;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:v=this.parseExpressionStatement();break;case 7:var y=this.lookahead.value;v=y==="{"?this.parseBlock():y==="("?this.parseExpressionStatement():y===";"?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:v=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":v=this.parseBreakStatement();break;case"continue":v=this.parseContinueStatement();break;case"debugger":v=this.parseDebuggerStatement();break;case"do":v=this.parseDoWhileStatement();break;case"for":v=this.parseForStatement();break;case"function":v=this.parseFunctionDeclaration();break;case"if":v=this.parseIfStatement();break;case"return":v=this.parseReturnStatement();break;case"switch":v=this.parseSwitchStatement();break;case"throw":v=this.parseThrowStatement();break;case"try":v=this.parseTryStatement();break;case"var":v=this.parseVariableStatement();break;case"while":v=this.parseWhileStatement();break;case"with":v=this.parseWithStatement();break;default:v=this.parseExpressionStatement()}break;default:v=this.throwUnexpectedToken(this.lookahead)}return v},w.prototype.parseFunctionSourceElements=function(){var v=this.createNode();this.expect("{");var y=this.parseDirectivePrologues(),C=this.context.labelSet,x=this.context.inIteration,T=this.context.inSwitch,S=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;this.lookahead.type!==2&&!this.match("}");)y.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=C,this.context.inIteration=x,this.context.inSwitch=T,this.context.inFunctionBody=S,this.finalize(v,new d.BlockStatement(y))},w.prototype.validateParam=function(v,y,C){var x="$"+C;this.context.strict?(this.scanner.isRestrictedWord(C)&&(v.stricted=y,v.message=u.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(v.paramSet,x)&&(v.stricted=y,v.message=u.Messages.StrictParamDupe)):v.firstRestricted||(this.scanner.isRestrictedWord(C)?(v.firstRestricted=y,v.message=u.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(C)?(v.firstRestricted=y,v.message=u.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(v.paramSet,x)&&(v.stricted=y,v.message=u.Messages.StrictParamDupe)),typeof Object.defineProperty=="function"?Object.defineProperty(v.paramSet,x,{value:!0,enumerable:!0,writable:!0,configurable:!0}):v.paramSet[x]=!0},w.prototype.parseRestElement=function(v){var y=this.createNode();this.expect("...");var C=this.parsePattern(v);return this.match("=")&&this.throwError(u.Messages.DefaultRestParameter),this.match(")")||this.throwError(u.Messages.ParameterAfterRestParameter),this.finalize(y,new d.RestElement(C))},w.prototype.parseFormalParameter=function(v){for(var y=[],C=this.match("...")?this.parseRestElement(y):this.parsePatternWithDefault(y),x=0;x<y.length;x++)this.validateParam(v,y[x],y[x].value);v.simple=v.simple&&C instanceof d.Identifier,v.params.push(C)},w.prototype.parseFormalParameters=function(v){var y;if(y={simple:!0,params:[],firstRestricted:v},this.expect("("),!this.match(")"))for(y.paramSet={};this.lookahead.type!==2&&(this.parseFormalParameter(y),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:y.simple,params:y.params,stricted:y.stricted,firstRestricted:y.firstRestricted,message:y.message}},w.prototype.matchAsyncFunction=function(){var v=this.matchContextualKeyword("async");if(v){var y=this.scanner.saveState();this.scanner.scanComments();var C=this.scanner.lex();this.scanner.restoreState(y),v=y.lineNumber===C.lineNumber&&C.type===4&&C.value==="function"}return v},w.prototype.parseFunctionDeclaration=function(v){var y=this.createNode(),C=this.matchContextualKeyword("async");C&&this.nextToken(),this.expectKeyword("function");var x,T=!C&&this.match("*");T&&this.nextToken();var S=null,_=null;if(!v||!this.match("(")){var E=this.lookahead;S=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(E.value)&&this.tolerateUnexpectedToken(E,u.Messages.StrictFunctionName):this.scanner.isRestrictedWord(E.value)?(_=E,x=u.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(E.value)&&(_=E,x=u.Messages.StrictReservedWord)}var D=this.context.await,b=this.context.allowYield;this.context.await=C,this.context.allowYield=!T;var I=this.parseFormalParameters(_),O=I.params,M=I.stricted;_=I.firstRestricted,I.message&&(x=I.message);var R=this.context.strict,A=this.context.allowStrictDirective;this.context.allowStrictDirective=I.simple;var B=this.parseFunctionSourceElements();return this.context.strict&&_&&this.throwUnexpectedToken(_,x),this.context.strict&&M&&this.tolerateUnexpectedToken(M,x),this.context.strict=R,this.context.allowStrictDirective=A,this.context.await=D,this.context.allowYield=b,C?this.finalize(y,new d.AsyncFunctionDeclaration(S,O,B)):this.finalize(y,new d.FunctionDeclaration(S,O,B,T))},w.prototype.parseFunctionExpression=function(){var v=this.createNode(),y=this.matchContextualKeyword("async");y&&this.nextToken(),this.expectKeyword("function");var C,x=!y&&this.match("*");x&&this.nextToken();var T,S=null,_=this.context.await,E=this.context.allowYield;if(this.context.await=y,this.context.allowYield=!x,!this.match("(")){var D=this.lookahead;S=this.context.strict||x||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(D.value)&&this.tolerateUnexpectedToken(D,u.Messages.StrictFunctionName):this.scanner.isRestrictedWord(D.value)?(T=D,C=u.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(D.value)&&(T=D,C=u.Messages.StrictReservedWord)}var b=this.parseFormalParameters(T),I=b.params,O=b.stricted;T=b.firstRestricted,b.message&&(C=b.message);var M=this.context.strict,R=this.context.allowStrictDirective;this.context.allowStrictDirective=b.simple;var A=this.parseFunctionSourceElements();return this.context.strict&&T&&this.throwUnexpectedToken(T,C),this.context.strict&&O&&this.tolerateUnexpectedToken(O,C),this.context.strict=M,this.context.allowStrictDirective=R,this.context.await=_,this.context.allowYield=E,y?this.finalize(v,new d.AsyncFunctionExpression(S,I,A)):this.finalize(v,new d.FunctionExpression(S,I,A,x))},w.prototype.parseDirective=function(){var v=this.lookahead,y=this.createNode(),C=this.parseExpression(),x=C.type===g.Syntax.Literal?this.getTokenRaw(v).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(y,x?new d.Directive(C,x):new d.ExpressionStatement(C))},w.prototype.parseDirectivePrologues=function(){for(var v=null,y=[];;){var C=this.lookahead;if(C.type!==8)break;var x=this.parseDirective();y.push(x);var T=x.directive;if(typeof T!="string")break;T==="use strict"?(this.context.strict=!0,v&&this.tolerateUnexpectedToken(v,u.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(C,u.Messages.IllegalLanguageModeDirective)):!v&&C.octal&&(v=C)}return y},w.prototype.qualifiedPropertyName=function(v){switch(v.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return v.value==="["}return!1},w.prototype.parseGetterMethod=function(){var v=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters();C.params.length>0&&this.tolerateError(u.Messages.BadGetterArity);var x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(v,new d.FunctionExpression(null,C.params,x,!1))},w.prototype.parseSetterMethod=function(){var v=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters();C.params.length!==1?this.tolerateError(u.Messages.BadSetterArity):C.params[0]instanceof d.RestElement&&this.tolerateError(u.Messages.BadSetterRestParameter);var x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(v,new d.FunctionExpression(null,C.params,x,!1))},w.prototype.parseGeneratorMethod=function(){var v=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters();this.context.allowYield=!1;var x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(v,new d.FunctionExpression(null,C.params,x,!0))},w.prototype.isStartOfExpression=function(){var v=!0,y=this.lookahead.value;switch(this.lookahead.type){case 7:v=y==="["||y==="("||y==="{"||y==="+"||y==="-"||y==="!"||y==="~"||y==="++"||y==="--"||y==="/"||y==="/=";break;case 4:v=y==="class"||y==="delete"||y==="function"||y==="let"||y==="new"||y==="super"||y==="this"||y==="typeof"||y==="void"||y==="yield"}return v},w.prototype.parseYieldExpression=function(){var v=this.createNode();this.expectKeyword("yield");var y=null,C=!1;if(!this.hasLineTerminator){var x=this.context.allowYield;this.context.allowYield=!1,(C=this.match("*"))?(this.nextToken(),y=this.parseAssignmentExpression()):this.isStartOfExpression()&&(y=this.parseAssignmentExpression()),this.context.allowYield=x}return this.finalize(v,new d.YieldExpression(y,C))},w.prototype.parseClassElement=function(v){var y=this.lookahead,C=this.createNode(),x="",T=null,S=null,_=!1,E=!1,D=!1,b=!1;if(this.match("*"))this.nextToken();else if(_=this.match("["),(T=this.parseObjectPropertyKey()).name==="static"&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(y=this.lookahead,D=!0,_=this.match("["),this.match("*")?this.nextToken():T=this.parseObjectPropertyKey()),y.type===3&&!this.hasLineTerminator&&y.value==="async"){var I=this.lookahead.value;I!==":"&&I!=="("&&I!=="*"&&(b=!0,y=this.lookahead,T=this.parseObjectPropertyKey(),y.type===3&&y.value==="constructor"&&this.tolerateUnexpectedToken(y,u.Messages.ConstructorIsAsync))}var O=this.qualifiedPropertyName(this.lookahead);return y.type===3?y.value==="get"&&O?(x="get",_=this.match("["),T=this.parseObjectPropertyKey(),this.context.allowYield=!1,S=this.parseGetterMethod()):y.value==="set"&&O&&(x="set",_=this.match("["),T=this.parseObjectPropertyKey(),S=this.parseSetterMethod()):y.type===7&&y.value==="*"&&O&&(x="init",_=this.match("["),T=this.parseObjectPropertyKey(),S=this.parseGeneratorMethod(),E=!0),!x&&T&&this.match("(")&&(x="init",S=b?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),E=!0),x||this.throwUnexpectedToken(this.lookahead),x==="init"&&(x="method"),_||(D&&this.isPropertyKey(T,"prototype")&&this.throwUnexpectedToken(y,u.Messages.StaticPrototype),!D&&this.isPropertyKey(T,"constructor")&&((x!=="method"||!E||S&&S.generator)&&this.throwUnexpectedToken(y,u.Messages.ConstructorSpecialMethod),v.value?this.throwUnexpectedToken(y,u.Messages.DuplicateConstructor):v.value=!0,x="constructor")),this.finalize(C,new d.MethodDefinition(T,_,S,x,D))},w.prototype.parseClassElementList=function(){var v=[],y={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():v.push(this.parseClassElement(y));return this.expect("}"),v},w.prototype.parseClassBody=function(){var v=this.createNode(),y=this.parseClassElementList();return this.finalize(v,new d.ClassBody(y))},w.prototype.parseClassDeclaration=function(v){var y=this.createNode(),C=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var x=v&&this.lookahead.type!==3?null:this.parseVariableIdentifier(),T=null;this.matchKeyword("extends")&&(this.nextToken(),T=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var S=this.parseClassBody();return this.context.strict=C,this.finalize(y,new d.ClassDeclaration(x,T,S))},w.prototype.parseClassExpression=function(){var v=this.createNode(),y=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var C=this.lookahead.type===3?this.parseVariableIdentifier():null,x=null;this.matchKeyword("extends")&&(this.nextToken(),x=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var T=this.parseClassBody();return this.context.strict=y,this.finalize(v,new d.ClassExpression(C,x,T))},w.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var v=this.createNode(),y=this.parseDirectivePrologues();this.lookahead.type!==2;)y.push(this.parseStatementListItem());return this.finalize(v,new d.Module(y))},w.prototype.parseScript=function(){for(var v=this.createNode(),y=this.parseDirectivePrologues();this.lookahead.type!==2;)y.push(this.parseStatementListItem());return this.finalize(v,new d.Script(y))},w.prototype.parseModuleSpecifier=function(){var v=this.createNode();this.lookahead.type!==8&&this.throwError(u.Messages.InvalidModuleSpecifier);var y=this.nextToken(),C=this.getTokenRaw(y);return this.finalize(v,new d.Literal(y.value,C))},w.prototype.parseImportSpecifier=function(){var v,y,C=this.createNode();return this.lookahead.type===3?(y=v=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),y=this.parseVariableIdentifier())):(y=v=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),y=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(C,new d.ImportSpecifier(y,v))},w.prototype.parseNamedImports=function(){this.expect("{");for(var v=[];!this.match("}");)v.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),v},w.prototype.parseImportDefaultSpecifier=function(){var v=this.createNode(),y=this.parseIdentifierName();return this.finalize(v,new d.ImportDefaultSpecifier(y))},w.prototype.parseImportNamespaceSpecifier=function(){var v=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(u.Messages.NoAsAfterImportNamespace),this.nextToken();var y=this.parseIdentifierName();return this.finalize(v,new d.ImportNamespaceSpecifier(y))},w.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(u.Messages.IllegalImportDeclaration);var v,y=this.createNode();this.expectKeyword("import");var C=[];if(this.lookahead.type===8)v=this.parseModuleSpecifier();else{if(this.match("{")?C=C.concat(this.parseNamedImports()):this.match("*")?C.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(C.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?C.push(this.parseImportNamespaceSpecifier()):this.match("{")?C=C.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var x=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause;this.throwError(x,this.lookahead.value)}this.nextToken(),v=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(y,new d.ImportDeclaration(C,v))},w.prototype.parseExportSpecifier=function(){var v=this.createNode(),y=this.parseIdentifierName(),C=y;return this.matchContextualKeyword("as")&&(this.nextToken(),C=this.parseIdentifierName()),this.finalize(v,new d.ExportSpecifier(y,C))},w.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(u.Messages.IllegalExportDeclaration);var v,y=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var C=this.parseFunctionDeclaration(!0);v=this.finalize(y,new d.ExportDefaultDeclaration(C))}else this.matchKeyword("class")?(C=this.parseClassDeclaration(!0),v=this.finalize(y,new d.ExportDefaultDeclaration(C))):this.matchContextualKeyword("async")?(C=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),v=this.finalize(y,new d.ExportDefaultDeclaration(C))):(this.matchContextualKeyword("from")&&this.throwError(u.Messages.UnexpectedToken,this.lookahead.value),C=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),v=this.finalize(y,new d.ExportDefaultDeclaration(C)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var x=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause;this.throwError(x,this.lookahead.value)}this.nextToken();var T=this.parseModuleSpecifier();this.consumeSemicolon(),v=this.finalize(y,new d.ExportAllDeclaration(T))}else if(this.lookahead.type===4){switch(C=void 0,this.lookahead.value){case"let":case"const":C=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":C=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}v=this.finalize(y,new d.ExportNamedDeclaration(C,[],null))}else if(this.matchAsyncFunction())C=this.parseFunctionDeclaration(),v=this.finalize(y,new d.ExportNamedDeclaration(C,[],null));else{var S=[],_=null,E=!1;for(this.expect("{");!this.match("}");)E=E||this.matchKeyword("default"),S.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),_=this.parseModuleSpecifier(),this.consumeSemicolon()):E?(x=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause,this.throwError(x,this.lookahead.value)):this.consumeSemicolon(),v=this.finalize(y,new d.ExportNamedDeclaration(null,S,_))}return v},w})();s.Parser=m},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.assert=function(c,l){if(!c)throw new Error("ASSERT: "+l)}},function(a,s){Object.defineProperty(s,"__esModule",{value:!0});var c=(function(){function l(){this.errors=[],this.tolerant=!1}return l.prototype.recordError=function(f){this.errors.push(f)},l.prototype.tolerate=function(f){if(!this.tolerant)throw f;this.recordError(f)},l.prototype.constructError=function(f,u){var d=new Error(f);try{throw d}catch(h){Object.create&&Object.defineProperty&&(d=Object.create(h),Object.defineProperty(d,"column",{value:u}))}return d},l.prototype.createError=function(f,u,d,h){var g="Line "+u+": "+h,p=this.constructError(g,d);return p.index=f,p.lineNumber=u,p.description=h,p},l.prototype.throwError=function(f,u,d,h){throw this.createError(f,u,d,h)},l.prototype.tolerateError=function(f,u,d,h){var g=this.createError(f,u,d,h);if(!this.tolerant)throw g;this.recordError(g)},l})();s.ErrorHandler=c},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(9),f=c(4),u=c(11);function d(p){return"0123456789abcdef".indexOf(p.toLowerCase())}function h(p){return"01234567".indexOf(p)}var g=(function(){function p(m,w){this.source=m,this.errorHandler=w,this.trackComment=!1,this.isModule=!1,this.length=m.length,this.index=0,this.lineNumber=m.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return p.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},p.prototype.restoreState=function(m){this.index=m.index,this.lineNumber=m.lineNumber,this.lineStart=m.lineStart},p.prototype.eof=function(){return this.index>=this.length},p.prototype.throwUnexpectedToken=function(m){return m===void 0&&(m=u.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,m)},p.prototype.tolerateUnexpectedToken=function(m){m===void 0&&(m=u.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,m)},p.prototype.skipSingleLineComment=function(m){var w,v,y=[];for(this.trackComment&&(y=[],w=this.index-m,v={start:{line:this.lineNumber,column:this.index-this.lineStart-m},end:{}});!this.eof();){var C=this.source.charCodeAt(this.index);if(++this.index,f.Character.isLineTerminator(C)){if(this.trackComment){v.end={line:this.lineNumber,column:this.index-this.lineStart-1};var x={multiLine:!1,slice:[w+m,this.index-1],range:[w,this.index-1],loc:v};y.push(x)}return C===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,y}}return this.trackComment&&(v.end={line:this.lineNumber,column:this.index-this.lineStart},x={multiLine:!1,slice:[w+m,this.index],range:[w,this.index],loc:v},y.push(x)),y},p.prototype.skipMultiLineComment=function(){var m,w,v=[];for(this.trackComment&&(v=[],m=this.index-2,w={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var y=this.source.charCodeAt(this.index);if(f.Character.isLineTerminator(y))y===13&&this.source.charCodeAt(this.index+1)===10&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(y===42){if(this.source.charCodeAt(this.index+1)===47){if(this.index+=2,this.trackComment){w.end={line:this.lineNumber,column:this.index-this.lineStart};var C={multiLine:!0,slice:[m+2,this.index-2],range:[m,this.index],loc:w};v.push(C)}return v}++this.index}else++this.index}return this.trackComment&&(w.end={line:this.lineNumber,column:this.index-this.lineStart},C={multiLine:!0,slice:[m+2,this.index],range:[m,this.index],loc:w},v.push(C)),this.tolerateUnexpectedToken(),v},p.prototype.scanComments=function(){var m;this.trackComment&&(m=[]);for(var w=this.index===0;!this.eof();){var v=this.source.charCodeAt(this.index);if(f.Character.isWhiteSpace(v))++this.index;else if(f.Character.isLineTerminator(v))++this.index,v===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,w=!0;else if(v===47)if((v=this.source.charCodeAt(this.index+1))===47){this.index+=2;var y=this.skipSingleLineComment(2);this.trackComment&&(m=m.concat(y)),w=!0}else{if(v!==42)break;this.index+=2,y=this.skipMultiLineComment(),this.trackComment&&(m=m.concat(y))}else if(w&&v===45){if(this.source.charCodeAt(this.index+1)!==45||this.source.charCodeAt(this.index+2)!==62)break;this.index+=3,y=this.skipSingleLineComment(3),this.trackComment&&(m=m.concat(y))}else{if(v!==60||this.isModule||this.source.slice(this.index+1,this.index+4)!=="!--")break;this.index+=4,y=this.skipSingleLineComment(4),this.trackComment&&(m=m.concat(y))}}return m},p.prototype.isFutureReservedWord=function(m){switch(m){case"enum":case"export":case"import":case"super":return!0;default:return!1}},p.prototype.isStrictModeReservedWord=function(m){switch(m){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},p.prototype.isRestrictedWord=function(m){return m==="eval"||m==="arguments"},p.prototype.isKeyword=function(m){switch(m.length){case 2:return m==="if"||m==="in"||m==="do";case 3:return m==="var"||m==="for"||m==="new"||m==="try"||m==="let";case 4:return m==="this"||m==="else"||m==="case"||m==="void"||m==="with"||m==="enum";case 5:return m==="while"||m==="break"||m==="catch"||m==="throw"||m==="const"||m==="yield"||m==="class"||m==="super";case 6:return m==="return"||m==="typeof"||m==="delete"||m==="switch"||m==="export"||m==="import";case 7:return m==="default"||m==="finally"||m==="extends";case 8:return m==="function"||m==="continue"||m==="debugger";case 10:return m==="instanceof";default:return!1}},p.prototype.codePointAt=function(m){var w=this.source.charCodeAt(m);if(w>=55296&&w<=56319){var v=this.source.charCodeAt(m+1);v>=56320&&v<=57343&&(w=1024*(w-55296)+v-56320+65536)}return w},p.prototype.scanHexEscape=function(m){for(var w=m==="u"?4:2,v=0,y=0;y<w;++y){if(this.eof()||!f.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;v=16*v+d(this.source[this.index++])}return String.fromCharCode(v)},p.prototype.scanUnicodeCodePointEscape=function(){var m=this.source[this.index],w=0;for(m==="}"&&this.throwUnexpectedToken();!this.eof()&&(m=this.source[this.index++],f.Character.isHexDigit(m.charCodeAt(0)));)w=16*w+d(m);return(w>1114111||m!=="}")&&this.throwUnexpectedToken(),f.Character.fromCodePoint(w)},p.prototype.getIdentifier=function(){for(var m=this.index++;!this.eof();){var w=this.source.charCodeAt(this.index);if(w===92)return this.index=m,this.getComplexIdentifier();if(w>=55296&&w<57343)return this.index=m,this.getComplexIdentifier();if(!f.Character.isIdentifierPart(w))break;++this.index}return this.source.slice(m,this.index)},p.prototype.getComplexIdentifier=function(){var m,w=this.codePointAt(this.index),v=f.Character.fromCodePoint(w);for(this.index+=v.length,w===92&&(this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,m=this.scanUnicodeCodePointEscape()):(m=this.scanHexEscape("u"))!==null&&m!=="\\"&&f.Character.isIdentifierStart(m.charCodeAt(0))||this.throwUnexpectedToken(),v=m);!this.eof()&&(w=this.codePointAt(this.index),f.Character.isIdentifierPart(w));)v+=m=f.Character.fromCodePoint(w),this.index+=m.length,w===92&&(v=v.substr(0,v.length-1),this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,m=this.scanUnicodeCodePointEscape()):(m=this.scanHexEscape("u"))!==null&&m!=="\\"&&f.Character.isIdentifierPart(m.charCodeAt(0))||this.throwUnexpectedToken(),v+=m);return v},p.prototype.octalToDecimal=function(m){var w=m!=="0",v=h(m);return!this.eof()&&f.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(w=!0,v=8*v+h(this.source[this.index++]),"0123".indexOf(m)>=0&&!this.eof()&&f.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(v=8*v+h(this.source[this.index++]))),{code:v,octal:w}},p.prototype.scanIdentifier=function(){var m,w=this.index,v=this.source.charCodeAt(w)===92?this.getComplexIdentifier():this.getIdentifier();if((m=v.length===1?3:this.isKeyword(v)?4:v==="null"?5:v==="true"||v==="false"?1:3)!=3&&w+v.length!==this.index){var y=this.index;this.index=w,this.tolerateUnexpectedToken(u.Messages.InvalidEscapedReservedWord),this.index=y}return{type:m,value:v,lineNumber:this.lineNumber,lineStart:this.lineStart,start:w,end:this.index}},p.prototype.scanPunctuator=function(){var m=this.index,w=this.source[this.index];switch(w){case"(":case"{":w==="{"&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,this.source[this.index]==="."&&this.source[this.index+1]==="."&&(this.index+=2,w="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:(w=this.source.substr(this.index,4))===">>>="?this.index+=4:(w=w.substr(0,3))==="==="||w==="!=="||w===">>>"||w==="<<="||w===">>="||w==="**="?this.index+=3:(w=w.substr(0,2))==="&&"||w==="||"||w==="=="||w==="!="||w==="+="||w==="-="||w==="*="||w==="/="||w==="++"||w==="--"||w==="<<"||w===">>"||w==="&="||w==="|="||w==="^="||w==="%="||w==="<="||w===">="||w==="=>"||w==="**"?this.index+=2:(w=this.source[this.index],"<>=!+-*%&|^/".indexOf(w)>=0&&++this.index)}return this.index===m&&this.throwUnexpectedToken(),{type:7,value:w,lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.scanHexLiteral=function(m){for(var w="";!this.eof()&&f.Character.isHexDigit(this.source.charCodeAt(this.index));)w+=this.source[this.index++];return w.length===0&&this.throwUnexpectedToken(),f.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+w,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.scanBinaryLiteral=function(m){for(var w,v="";!this.eof()&&((w=this.source[this.index])==="0"||w==="1");)v+=this.source[this.index++];return v.length===0&&this.throwUnexpectedToken(),this.eof()||(w=this.source.charCodeAt(this.index),(f.Character.isIdentifierStart(w)||f.Character.isDecimalDigit(w))&&this.throwUnexpectedToken()),{type:6,value:parseInt(v,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.scanOctalLiteral=function(m,w){var v="",y=!1;for(f.Character.isOctalDigit(m.charCodeAt(0))?(y=!0,v="0"+this.source[this.index++]):++this.index;!this.eof()&&f.Character.isOctalDigit(this.source.charCodeAt(this.index));)v+=this.source[this.index++];return y||v.length!==0||this.throwUnexpectedToken(),(f.Character.isIdentifierStart(this.source.charCodeAt(this.index))||f.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(v,8),octal:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:w,end:this.index}},p.prototype.isImplicitOctalLiteral=function(){for(var m=this.index+1;m<this.length;++m){var w=this.source[m];if(w==="8"||w==="9")return!1;if(!f.Character.isOctalDigit(w.charCodeAt(0)))return!0}return!0},p.prototype.scanNumericLiteral=function(){var m=this.index,w=this.source[m];l.assert(f.Character.isDecimalDigit(w.charCodeAt(0))||w===".","Numeric literal must start with a decimal digit or a decimal point");var v="";if(w!=="."){if(v=this.source[this.index++],w=this.source[this.index],v==="0"){if(w==="x"||w==="X")return++this.index,this.scanHexLiteral(m);if(w==="b"||w==="B")return++this.index,this.scanBinaryLiteral(m);if(w==="o"||w==="O")return this.scanOctalLiteral(w,m);if(w&&f.Character.isOctalDigit(w.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(w,m)}for(;f.Character.isDecimalDigit(this.source.charCodeAt(this.index));)v+=this.source[this.index++];w=this.source[this.index]}if(w==="."){for(v+=this.source[this.index++];f.Character.isDecimalDigit(this.source.charCodeAt(this.index));)v+=this.source[this.index++];w=this.source[this.index]}if(w==="e"||w==="E")if(v+=this.source[this.index++],(w=this.source[this.index])!=="+"&&w!=="-"||(v+=this.source[this.index++]),f.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;f.Character.isDecimalDigit(this.source.charCodeAt(this.index));)v+=this.source[this.index++];else this.throwUnexpectedToken();return f.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(v),lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.scanStringLiteral=function(){var m=this.index,w=this.source[m];l.assert(w==="'"||w==='"',"String literal must starts with a quote"),++this.index;for(var v=!1,y="";!this.eof();){var C=this.source[this.index++];if(C===w){w="";break}if(C==="\\")if((C=this.source[this.index++])&&f.Character.isLineTerminator(C.charCodeAt(0)))++this.lineNumber,C==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(C){case"u":if(this.source[this.index]==="{")++this.index,y+=this.scanUnicodeCodePointEscape();else{var x=this.scanHexEscape(C);x===null&&this.throwUnexpectedToken(),y+=x}break;case"x":var T=this.scanHexEscape(C);T===null&&this.throwUnexpectedToken(u.Messages.InvalidHexEscapeSequence),y+=T;break;case"n":y+=`
`;break;case"r":y+="\r";break;case"t":y+="	";break;case"b":y+="\b";break;case"f":y+="\f";break;case"v":y+="\v";break;case"8":case"9":y+=C,this.tolerateUnexpectedToken();break;default:if(C&&f.Character.isOctalDigit(C.charCodeAt(0))){var S=this.octalToDecimal(C);v=S.octal||v,y+=String.fromCharCode(S.code)}else y+=C}else{if(f.Character.isLineTerminator(C.charCodeAt(0)))break;y+=C}}return w!==""&&(this.index=m,this.throwUnexpectedToken()),{type:8,value:y,octal:v,lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.scanTemplate=function(){var m="",w=!1,v=this.index,y=this.source[v]==="`",C=!1,x=2;for(++this.index;!this.eof();){var T=this.source[this.index++];if(T==="`"){x=1,C=!0,w=!0;break}if(T==="$"){if(this.source[this.index]==="{"){this.curlyStack.push("${"),++this.index,w=!0;break}m+=T}else if(T==="\\")if(T=this.source[this.index++],f.Character.isLineTerminator(T.charCodeAt(0)))++this.lineNumber,T==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(T){case"n":m+=`
`;break;case"r":m+="\r";break;case"t":m+="	";break;case"u":if(this.source[this.index]==="{")++this.index,m+=this.scanUnicodeCodePointEscape();else{var S=this.index,_=this.scanHexEscape(T);_!==null?m+=_:(this.index=S,m+=T)}break;case"x":var E=this.scanHexEscape(T);E===null&&this.throwUnexpectedToken(u.Messages.InvalidHexEscapeSequence),m+=E;break;case"b":m+="\b";break;case"f":m+="\f";break;case"v":m+="\v";break;default:T==="0"?(f.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(u.Messages.TemplateOctalLiteral),m+="\0"):f.Character.isOctalDigit(T.charCodeAt(0))?this.throwUnexpectedToken(u.Messages.TemplateOctalLiteral):m+=T}else f.Character.isLineTerminator(T.charCodeAt(0))?(++this.lineNumber,T==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index,m+=`
`):m+=T}return w||this.throwUnexpectedToken(),y||this.curlyStack.pop(),{type:10,value:this.source.slice(v+1,this.index-x),cooked:m,head:y,tail:C,lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.testRegExp=function(m,w){var v=m,y=this;w.indexOf("u")>=0&&(v=v.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(C,x,T){var S=parseInt(x||T,16);return S>1114111&&y.throwUnexpectedToken(u.Messages.InvalidRegExp),S<=65535?String.fromCharCode(S):""})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(v)}catch{this.throwUnexpectedToken(u.Messages.InvalidRegExp)}try{return new RegExp(m,w)}catch{return null}},p.prototype.scanRegExpBody=function(){var m=this.source[this.index];l.assert(m==="/","Regular expression literal must start with a slash");for(var w=this.source[this.index++],v=!1,y=!1;!this.eof();)if(w+=m=this.source[this.index++],m==="\\")m=this.source[this.index++],f.Character.isLineTerminator(m.charCodeAt(0))&&this.throwUnexpectedToken(u.Messages.UnterminatedRegExp),w+=m;else if(f.Character.isLineTerminator(m.charCodeAt(0)))this.throwUnexpectedToken(u.Messages.UnterminatedRegExp);else if(v)m==="]"&&(v=!1);else{if(m==="/"){y=!0;break}m==="["&&(v=!0)}return y||this.throwUnexpectedToken(u.Messages.UnterminatedRegExp),w.substr(1,w.length-2)},p.prototype.scanRegExpFlags=function(){for(var m="";!this.eof();){var w=this.source[this.index];if(!f.Character.isIdentifierPart(w.charCodeAt(0)))break;if(++this.index,w!=="\\"||this.eof())m+=w;else if((w=this.source[this.index])==="u"){++this.index;var v=this.index,y=this.scanHexEscape("u");if(y!==null)for(m+=y;v<this.index;++v)this.source[v];else this.index=v,m+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return m},p.prototype.scanRegExp=function(){var m=this.index,w=this.scanRegExpBody(),v=this.scanRegExpFlags();return{type:9,value:"",pattern:w,flags:v,regex:this.testRegExp(w,v),lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var m=this.source.charCodeAt(this.index);return f.Character.isIdentifierStart(m)?this.scanIdentifier():m===40||m===41||m===59?this.scanPunctuator():m===39||m===34?this.scanStringLiteral():m===46?f.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():f.Character.isDecimalDigit(m)?this.scanNumericLiteral():m===96||m===125&&this.curlyStack[this.curlyStack.length-1]==="${"?this.scanTemplate():m>=55296&&m<57343&&f.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},p})();s.Scanner=g},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenName={},s.TokenName[1]="Boolean",s.TokenName[2]="<end>",s.TokenName[3]="Identifier",s.TokenName[4]="Keyword",s.TokenName[5]="Null",s.TokenName[6]="Numeric",s.TokenName[7]="Punctuator",s.TokenName[8]="String",s.TokenName[9]="RegularExpression",s.TokenName[10]="Template"},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(10),f=c(12),u=c(13),d=(function(){function g(){this.values=[],this.curly=this.paren=-1}return g.prototype.beforeFunctionExpression=function(p){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(p)>=0},g.prototype.isRegexStart=function(){var p=this.values[this.values.length-1],m=p!==null;switch(p){case"this":case"]":m=!1;break;case")":var w=this.values[this.paren-1];m=w==="if"||w==="while"||w==="for"||w==="with";break;case"}":if(m=!1,this.values[this.curly-3]==="function")m=!!(v=this.values[this.curly-4])&&!this.beforeFunctionExpression(v);else if(this.values[this.curly-4]==="function"){var v;m=!(v=this.values[this.curly-5])||!this.beforeFunctionExpression(v)}}return m},g.prototype.push=function(p){p.type===7||p.type===4?(p.value==="{"?this.curly=this.values.length:p.value==="("&&(this.paren=this.values.length),this.values.push(p.value)):this.values.push(null)},g})(),h=(function(){function g(p,m){this.errorHandler=new l.ErrorHandler,this.errorHandler.tolerant=!!m&&typeof m.tolerant=="boolean"&&m.tolerant,this.scanner=new f.Scanner(p,this.errorHandler),this.scanner.trackComment=!!m&&typeof m.comment=="boolean"&&m.comment,this.trackRange=!!m&&typeof m.range=="boolean"&&m.range,this.trackLoc=!!m&&typeof m.loc=="boolean"&&m.loc,this.buffer=[],this.reader=new d}return g.prototype.errors=function(){return this.errorHandler.errors},g.prototype.getNextToken=function(){if(this.buffer.length===0){var p=this.scanner.scanComments();if(this.scanner.trackComment)for(var m=0;m<p.length;++m){var w=p[m],v=this.scanner.source.slice(w.slice[0],w.slice[1]),y={type:w.multiLine?"BlockComment":"LineComment",value:v};this.trackRange&&(y.range=w.range),this.trackLoc&&(y.loc=w.loc),this.buffer.push(y)}if(!this.scanner.eof()){var C=void 0;this.trackLoc&&(C={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var x=this.scanner.source[this.scanner.index]==="/"&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(x);var T={type:u.TokenName[x.type],value:this.scanner.source.slice(x.start,x.end)};if(this.trackRange&&(T.range=[x.start,x.end]),this.trackLoc&&(C.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},T.loc=C),x.type===9){var S=x.pattern,_=x.flags;T.regex={pattern:S,flags:_}}this.buffer.push(T)}}return this.buffer.shift()},g})();s.Tokenizer=h}])},r.exports=o()},function(r,n,i){var o=i(38),a=i(53),s=i(76),c=i(54),l=Object.prototype.toString,f=Object.prototype.hasOwnProperty,u={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},d=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function h(M){var R,A,B;if(R=M.toString(16).toUpperCase(),M<=255)A="x",B=2;else if(M<=65535)A="u",B=4;else{if(!(M<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");A="U",B=8}return"\\"+A+o.repeat("0",B-R.length)+R}function g(M){this.schema=M.schema||s,this.indent=Math.max(1,M.indent||2),this.noArrayIndent=M.noArrayIndent||!1,this.skipInvalid=M.skipInvalid||!1,this.flowLevel=o.isNothing(M.flowLevel)?-1:M.flowLevel,this.styleMap=(function(R,A){var B,k,L,F,j,J,ie;if(A===null)return{};for(B={},L=0,F=(k=Object.keys(A)).length;L<F;L+=1)j=k[L],J=String(A[j]),j.slice(0,2)==="!!"&&(j="tag:yaml.org,2002:"+j.slice(2)),(ie=R.compiledTypeMap.fallback[j])&&f.call(ie.styleAliases,J)&&(J=ie.styleAliases[J]),B[j]=J;return B})(this.schema,M.styles||null),this.sortKeys=M.sortKeys||!1,this.lineWidth=M.lineWidth||80,this.noRefs=M.noRefs||!1,this.noCompatMode=M.noCompatMode||!1,this.condenseFlow=M.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function p(M,R){for(var A,B=o.repeat(" ",R),k=0,L=-1,F="",j=M.length;k<j;)(L=M.indexOf(`
`,k))===-1?(A=M.slice(k),k=j):(A=M.slice(k,L+1),k=L+1),A.length&&A!==`
`&&(F+=B),F+=A;return F}function m(M,R){return`
`+o.repeat(" ",M.indent*R)}function w(M){return M===32||M===9}function v(M){return 32<=M&&M<=126||161<=M&&M<=55295&&M!==8232&&M!==8233||57344<=M&&M<=65533&&M!==65279||65536<=M&&M<=1114111}function y(M,R){return v(M)&&M!==65279&&M!==44&&M!==91&&M!==93&&M!==123&&M!==125&&M!==58&&(M!==35||R&&(function(A){return v(A)&&!w(A)&&A!==65279&&A!==13&&A!==10})(R))}function C(M){return/^\n* /.test(M)}function x(M,R,A,B,k){var L,F,j,J,ie=!1,fe=!1,ae=B!==-1,de=-1,we=v(J=M.charCodeAt(0))&&J!==65279&&!w(J)&&J!==45&&J!==63&&J!==58&&J!==44&&J!==91&&J!==93&&J!==123&&J!==125&&J!==35&&J!==38&&J!==42&&J!==33&&J!==124&&J!==61&&J!==62&&J!==39&&J!==34&&J!==37&&J!==64&&J!==96&&!w(M.charCodeAt(M.length-1));if(R)for(L=0;L<M.length;L++){if(!v(F=M.charCodeAt(L)))return 5;j=L>0?M.charCodeAt(L-1):null,we=we&&y(F,j)}else{for(L=0;L<M.length;L++){if((F=M.charCodeAt(L))===10)ie=!0,ae&&(fe=fe||L-de-1>B&&M[de+1]!==" ",de=L);else if(!v(F))return 5;j=L>0?M.charCodeAt(L-1):null,we=we&&y(F,j)}fe=fe||ae&&L-de-1>B&&M[de+1]!==" "}return ie||fe?A>9&&C(M)?5:fe?4:3:we&&!k(M)?1:2}function T(M,R,A,B){M.dump=(function(){if(R.length===0)return"''";if(!M.noCompatMode&&d.indexOf(R)!==-1)return"'"+R+"'";var k=M.indent*Math.max(1,A),L=M.lineWidth===-1?-1:Math.max(Math.min(M.lineWidth,40),M.lineWidth-k),F=B||M.flowLevel>-1&&A>=M.flowLevel;switch(x(R,F,M.indent,L,(function(j){return(function(J,ie){var fe,ae;for(fe=0,ae=J.implicitTypes.length;fe<ae;fe+=1)if(J.implicitTypes[fe].resolve(ie))return!0;return!1})(M,j)}))){case 1:return R;case 2:return"'"+R.replace(/'/g,"''")+"'";case 3:return"|"+S(R,M.indent)+_(p(R,k));case 4:return">"+S(R,M.indent)+_(p((function(j,J){for(var ie,fe,ae=/(\n+)([^\n]*)/g,de=(_e=j.indexOf(`
`),_e=_e!==-1?_e:j.length,ae.lastIndex=_e,E(j.slice(0,_e),J)),we=j[0]===`
`||j[0]===" ",_e;fe=ae.exec(j);){var Te=fe[1],G=fe[2];ie=G[0]===" ",de+=Te+(we||ie||G===""?"":`
`)+E(G,J),we=ie}return de})(R,L),k));case 5:return'"'+(function(j){for(var J,ie,fe,ae="",de=0;de<j.length;de++)(J=j.charCodeAt(de))>=55296&&J<=56319&&(ie=j.charCodeAt(de+1))>=56320&&ie<=57343?(ae+=h(1024*(J-55296)+ie-56320+65536),de++):(fe=u[J],ae+=!fe&&v(J)?j[de]:fe||h(J));return ae})(R)+'"';default:throw new a("impossible error: invalid scalar style")}})()}function S(M,R){var A=C(M)?String(R):"",B=M[M.length-1]===`
`;return A+(B&&(M[M.length-2]===`
`||M===`
`)?"+":B?"":"-")+`
`}function _(M){return M[M.length-1]===`
`?M.slice(0,-1):M}function E(M,R){if(M===""||M[0]===" ")return M;for(var A,B,k=/ [^ ]/g,L=0,F=0,j=0,J="";A=k.exec(M);)(j=A.index)-L>R&&(B=F>L?F:j,J+=`
`+M.slice(L,B),L=B+1),F=j;return J+=`
`,M.length-L>R&&F>L?J+=M.slice(L,F)+`
`+M.slice(F+1):J+=M.slice(L),J.slice(1)}function D(M,R,A){var B,k,L,F,j,J;for(L=0,F=(k=A?M.explicitTypes:M.implicitTypes).length;L<F;L+=1)if(((j=k[L]).instanceOf||j.predicate)&&(!j.instanceOf||typeof R=="object"&&R instanceof j.instanceOf)&&(!j.predicate||j.predicate(R))){if(M.tag=A?j.tag:"?",j.represent){if(J=M.styleMap[j.tag]||j.defaultStyle,l.call(j.represent)==="[object Function]")B=j.represent(R,J);else{if(!f.call(j.represent,J))throw new a("!<"+j.tag+'> tag resolver accepts not "'+J+'" style');B=j.represent[J](R,J)}M.dump=B}return!0}return!1}function b(M,R,A,B,k,L){M.tag=null,M.dump=A,D(M,A,!1)||D(M,A,!0);var F=l.call(M.dump);B&&(B=M.flowLevel<0||M.flowLevel>R);var j,J,ie=F==="[object Object]"||F==="[object Array]";if(ie&&(J=(j=M.duplicates.indexOf(A))!==-1),(M.tag!==null&&M.tag!=="?"||J||M.indent!==2&&R>0)&&(k=!1),J&&M.usedDuplicates[j])M.dump="*ref_"+j;else{if(ie&&J&&!M.usedDuplicates[j]&&(M.usedDuplicates[j]=!0),F==="[object Object]")B&&Object.keys(M.dump).length!==0?((function(ae,de,we,_e){var Te,G,P,$,W,q,Q="",ee=ae.tag,ge=Object.keys(we);if(ae.sortKeys===!0)ge.sort();else if(typeof ae.sortKeys=="function")ge.sort(ae.sortKeys);else if(ae.sortKeys)throw new a("sortKeys must be a boolean or a function");for(Te=0,G=ge.length;Te<G;Te+=1)q="",_e&&Te===0||(q+=m(ae,de)),$=we[P=ge[Te]],b(ae,de+1,P,!0,!0,!0)&&((W=ae.tag!==null&&ae.tag!=="?"||ae.dump&&ae.dump.length>1024)&&(ae.dump&&ae.dump.charCodeAt(0)===10?q+="?":q+="? "),q+=ae.dump,W&&(q+=m(ae,de)),b(ae,de+1,$,!0,W)&&(ae.dump&&ae.dump.charCodeAt(0)===10?q+=":":q+=": ",Q+=q+=ae.dump));ae.tag=ee,ae.dump=Q||"{}"})(M,R,M.dump,k),J&&(M.dump="&ref_"+j+M.dump)):((function(ae,de,we){var _e,Te,G,P,$,W="",q=ae.tag,Q=Object.keys(we);for(_e=0,Te=Q.length;_e<Te;_e+=1)$="",_e!==0&&($+=", "),ae.condenseFlow&&($+='"'),P=we[G=Q[_e]],b(ae,de,G,!1,!1)&&(ae.dump.length>1024&&($+="? "),$+=ae.dump+(ae.condenseFlow?'"':"")+":"+(ae.condenseFlow?"":" "),b(ae,de,P,!1,!1)&&(W+=$+=ae.dump));ae.tag=q,ae.dump="{"+W+"}"})(M,R,M.dump),J&&(M.dump="&ref_"+j+" "+M.dump));else if(F==="[object Array]"){var fe=M.noArrayIndent&&R>0?R-1:R;B&&M.dump.length!==0?((function(ae,de,we,_e){var Te,G,P="",$=ae.tag;for(Te=0,G=we.length;Te<G;Te+=1)b(ae,de+1,we[Te],!0,!0)&&(_e&&Te===0||(P+=m(ae,de)),ae.dump&&ae.dump.charCodeAt(0)===10?P+="-":P+="- ",P+=ae.dump);ae.tag=$,ae.dump=P||"[]"})(M,fe,M.dump,k),J&&(M.dump="&ref_"+j+M.dump)):((function(ae,de,we){var _e,Te,G="",P=ae.tag;for(_e=0,Te=we.length;_e<Te;_e+=1)b(ae,de,we[_e],!1,!1)&&(_e!==0&&(G+=","+(ae.condenseFlow?"":" ")),G+=ae.dump);ae.tag=P,ae.dump="["+G+"]"})(M,fe,M.dump),J&&(M.dump="&ref_"+j+" "+M.dump))}else{if(F!=="[object String]"){if(M.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+F)}M.tag!=="?"&&T(M,M.dump,R,L)}M.tag!==null&&M.tag!=="?"&&(M.dump="!<"+M.tag+"> "+M.dump)}return!0}function I(M,R){var A,B,k=[],L=[];for((function F(j,J,ie){var fe,ae,de;if(j!==null&&typeof j=="object")if((ae=J.indexOf(j))!==-1)ie.indexOf(ae)===-1&&ie.push(ae);else if(J.push(j),Array.isArray(j))for(ae=0,de=j.length;ae<de;ae+=1)F(j[ae],J,ie);else for(fe=Object.keys(j),ae=0,de=fe.length;ae<de;ae+=1)F(j[fe[ae]],J,ie)})(M,k,L),A=0,B=L.length;A<B;A+=1)R.duplicates.push(k[L[A]]);R.usedDuplicates=new Array(B)}function O(M,R){var A=new g(R=R||{});return A.noRefs||I(M,A),b(A,0,M,!0,!0)?A.dump+`
`:""}r.exports.dump=O,r.exports.safeDump=function(M,R){return O(M,o.extend({schema:c},R))}},function(r,n,i){i(31),i(32),i(33),i(64),i(19),i(65),i(20),i(68),i(92),i(144),i(22),i(94),i(23);var o,a=this&&this.__extends||(o=function(x,T){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,_){S.__proto__=_}||function(S,_){for(var E in _)_.hasOwnProperty(E)&&(S[E]=_[E])})(x,T)},function(x,T){function S(){this.constructor=x}o(x,T),x.prototype=T===null?Object.create(T):(S.prototype=T.prototype,new S)}),s=this&&this.__values||function(x){var T=typeof Symbol=="function"&&Symbol.iterator,S=T&&x[T],_=0;if(S)return S.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&_>=x.length&&(x=void 0),{value:x&&x[_++],done:!x}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(x,T){var S=typeof Symbol=="function"&&x[Symbol.iterator];if(!S)return x;var _,E,D=S.call(x),b=[];try{for(;(T===void 0||T-- >0)&&!(_=D.next()).done;)b.push(_.value)}catch(I){E={error:I}}finally{try{_&&!_.done&&(S=D.return)&&S.call(D)}finally{if(E)throw E.error}}return b};Object.defineProperty(n,"__esModule",{value:!0});var l=i(91),f=i(1),u=i(183),d=i(0),h=i(7),g=i(95),p=i(69),m=i(3),w=i(305),v=i(306),y=i(307),C=(function(x){function T(S,_){_===void 0&&(_=!1);var E=x.call(this)||this;return E._hasDeclaration=!1,E._docTypeName="",E._hasDocumentElement=!1,E._currentElementSerialized=!1,E._openTags=[],E._ended=!1,E._fragment=_,E._options=f.applyDefaults(S||{},l.DefaultXMLBuilderCBOptions),E._builderOptions={defaultNamespace:E._options.defaultNamespace,namespaceAlias:E._options.namespaceAlias},E._options.format==="json"?E._writer=new v.JSONCBWriter(E._options):E._options.format==="yaml"?E._writer=new y.YAMLCBWriter(E._options):E._writer=new w.XMLCBWriter(E._options),E._options.data!==void 0&&E.on("data",E._options.data),E._options.end!==void 0&&E.on("end",E._options.end),E._options.error!==void 0&&E.on("error",E._options.error),E._prefixMap=new g.NamespacePrefixMap,E._prefixMap.set("xml",h.namespace.XML),E._prefixIndex={value:1},E._push(E._writer.frontMatter()),E}return a(T,x),T.prototype.ele=function(S,_,E){var D,b;if(f.isObject(S)||f.isString(S)&&(/^\s*</.test(S)||/^\s*[\{\[]/.test(S)||/^(\s*|(#.*)|(%.*))*---/.test(S))){var I=u.fragment().set(this._options);try{I.ele(S)}catch(A){return this.emit("error",A),this}try{for(var O=s(I.node.childNodes),M=O.next();!M.done;M=O.next()){var R=M.value;this._fromNode(R)}}catch(A){D={error:A}}finally{try{M&&!M.done&&(b=O.return)&&b.call(O)}finally{if(D)throw D.error}}return this}if(this._serializeOpenTag(!0),!this._fragment&&this._hasDocumentElement&&this._writer.level===0)return this.emit("error",new Error("Document cannot have multiple document element nodes.")),this;try{this._currentElement=u.fragment(this._builderOptions).ele(S,_,E)}catch(A){return this.emit("error",A),this}return this._fragment||this._hasDocumentElement||this._docTypeName===""||this._currentElement.node._qualifiedName===this._docTypeName?(this._currentElementSerialized=!1,this._fragment||(this._hasDocumentElement=!0),this):(this.emit("error",new Error("Document element name does not match DocType declaration name.")),this)},T.prototype.att=function(S,_,E){if(this._currentElement===void 0)return this.emit("error",new Error("Cannot insert an attribute node as child of a document node.")),this;try{this._currentElement.att(S,_,E)}catch(D){return this.emit("error",D),this}return this},T.prototype.com=function(S){var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).com(S).first().node}catch(E){return this.emit("error",E),this}return!this._options.wellFormed||d.xml_isLegalChar(_.data)&&_.data.indexOf("--")===-1&&!_.data.endsWith("-")?(this._push(this._writer.comment(_.data)),this):(this.emit("error",new Error("Comment data contains invalid characters (well-formed required).")),this)},T.prototype.txt=function(S){if(!this._fragment&&this._currentElement===void 0)return this.emit("error",new Error("Cannot insert a text node as child of a document node.")),this;var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).txt(S).first().node}catch(D){return this.emit("error",D),this}if(this._options.wellFormed&&!d.xml_isLegalChar(_.data))return this.emit("error",new Error("Text data contains invalid characters (well-formed required).")),this;var E=_.data.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this._push(this._writer.text(E)),this},T.prototype.ins=function(S,_){var E;_===void 0&&(_=""),this._serializeOpenTag(!0);try{E=u.fragment(this._builderOptions).ins(S,_).first().node}catch(D){return this.emit("error",D),this}return this._options.wellFormed&&(E.target.indexOf(":")!==-1||/^xml$/i.test(E.target))?(this.emit("error",new Error("Processing instruction target contains invalid characters (well-formed required).")),this):this._options.wellFormed&&!d.xml_isLegalChar(E.data)?(this.emit("error",Error("Processing instruction data contains invalid characters (well-formed required).")),this):(this._push(this._writer.instruction(E.target,E.data)),this)},T.prototype.dat=function(S){var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).dat(S).first().node}catch(E){return this.emit("error",E),this}return this._push(this._writer.cdata(_.data)),this},T.prototype.dec=function(S){return S===void 0&&(S={version:"1.0"}),this._fragment?(this.emit("error",Error("Cannot insert an XML declaration into a document fragment.")),this):this._hasDeclaration?(this.emit("error",Error("XML declaration is already inserted.")),this):(this._push(this._writer.declaration(S.version||"1.0",S.encoding,S.standalone)),this._hasDeclaration=!0,this)},T.prototype.dtd=function(S){if(this._fragment)return this.emit("error",Error("Cannot insert a DocType declaration into a document fragment.")),this;if(this._docTypeName!=="")return this.emit("error",new Error("DocType declaration is already inserted.")),this;if(this._hasDocumentElement)return this.emit("error",new Error("Cannot insert DocType declaration after document element.")),this;var _;try{_=u.create().dtd(S).first().node}catch(E){return this.emit("error",E),this}return this._options.wellFormed&&!d.xml_isPubidChar(_.publicId)?(this.emit("error",new Error("DocType public identifier does not match PubidChar construct (well-formed required).")),this):this._options.wellFormed&&(!d.xml_isLegalChar(_.systemId)||_.systemId.indexOf('"')!==-1&&_.systemId.indexOf("'")!==-1)?(this.emit("error",new Error("DocType system identifier contains invalid characters (well-formed required).")),this):(this._docTypeName=S.name,this._push(this._writer.docType(S.name,_.publicId,_.systemId)),this)},T.prototype.import=function(S){var _,E,D=u.fragment().set(this._options);try{D.import(S)}catch(M){return this.emit("error",M),this}try{for(var b=s(D.node.childNodes),I=b.next();!I.done;I=b.next()){var O=I.value;this._fromNode(O)}}catch(M){_={error:M}}finally{try{I&&!I.done&&(E=b.return)&&E.call(b)}finally{if(_)throw _.error}}return this},T.prototype.up=function(){return this._serializeOpenTag(!1),this._serializeCloseTag(),this},T.prototype.end=function(){for(this._serializeOpenTag(!1);this._openTags.length>0;)this._serializeCloseTag();return this._push(null),this},T.prototype._serializeOpenTag=function(S){if(!this._currentElementSerialized&&this._currentElement!==void 0){var _=this._currentElement.node;if(!this._options.wellFormed||_.localName.indexOf(":")===-1&&d.xml_isName(_.localName)){var E="",D=!1,b=this._prefixMap.copy(),I={},O=this._recordNamespaceInformation(_,b,I),M=this._openTags.length===0?null:this._openTags[this._openTags.length-1][1],R=_.namespaceURI;if(R===null&&(R=M),M===R)O!==null&&(D=!0),E=R===h.namespace.XML?"xml:"+_.localName:_.localName,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E));else{var A=_.prefix,B=null;if(A===null&&R===O||(B=b.get(A,R)),A==="xmlns"){if(this._options.wellFormed)return void this.emit("error",new Error("An element cannot have the 'xmlns' prefix (well-formed required)."));B=A}B!==null?(E=B+":"+_.localName,O!==null&&O!==h.namespace.XML&&(M=O||null),this._writer.beginElement(E),this._push(this._writer.openTagBegin(E))):A!==null?(A in I&&(A=this._generatePrefix(R,b,this._prefixIndex)),b.set(A,R),E+=A+":"+_.localName,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)),this._push(this._writer.attribute("xmlns:"+A,this._serializeAttributeValue(R,this._options.wellFormed))),O!==null&&(M=O||null)):O===null||O!==null&&O!==R?(D=!0,E+=_.localName,M=R,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)),this._push(this._writer.attribute("xmlns",this._serializeAttributeValue(R,this._options.wellFormed)))):(E+=_.localName,M=R,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)))}this._serializeAttributes(_,b,this._prefixIndex,I,D,this._options.wellFormed);var k=R===h.namespace.HTML;k&&!S&&T._VoidElementNames.has(_.localName)?(this._push(this._writer.openTagEnd(E,!0,!0)),this._writer.endElement(E)):k||S?this._push(this._writer.openTagEnd(E,!1,!1)):(this._push(this._writer.openTagEnd(E,!0,!1)),this._writer.endElement(E)),this._currentElementSerialized=!0,this._openTags.push([E,M,this._prefixMap,S]),this._isPrefixMapModified(this._prefixMap,b)&&(this._prefixMap=b),this._writer.level++}else this.emit("error",new Error("Node local name contains invalid characters (well-formed required)."))}},T.prototype._serializeCloseTag=function(){this._writer.level--;var S=this._openTags.pop();if(S!==void 0){var _=c(S,4),E=_[0],D=(_[1],_[2]),b=_[3];this._prefixMap=D,b&&(this._push(this._writer.closeTag(E)),this._writer.endElement(E))}else this.emit("error",new Error("Last element is undefined."))},T.prototype._push=function(S){S===null?(this._ended=!0,this.emit("end")):this._ended?this.emit("error",new Error("Cannot push to ended stream.")):S.length!==0&&(this._writer.hasData=!0,this.emit("data",S,this._writer.level))},T.prototype._fromNode=function(S){var _,E,D,b;if(m.Guard.isElementNode(S)){var I=S.prefix?S.prefix+":"+S.localName:S.localName;S.namespaceURI!==null?this.ele(S.namespaceURI,I):this.ele(I);try{for(var O=s(S.attributes),M=O.next();!M.done;M=O.next()){var R=M.value,A=R.prefix?R.prefix+":"+R.localName:R.localName;R.namespaceURI!==null?this.att(R.namespaceURI,A,R.value):this.att(A,R.value)}}catch(F){_={error:F}}finally{try{M&&!M.done&&(E=O.return)&&E.call(O)}finally{if(_)throw _.error}}try{for(var B=s(S.childNodes),k=B.next();!k.done;k=B.next()){var L=k.value;this._fromNode(L)}}catch(F){D={error:F}}finally{try{k&&!k.done&&(b=B.return)&&b.call(B)}finally{if(D)throw D.error}}this.up()}else m.Guard.isExclusiveTextNode(S)&&S.data?this.txt(S.data):m.Guard.isCommentNode(S)?this.com(S.data):m.Guard.isCDATASectionNode(S)?this.dat(S.data):m.Guard.isProcessingInstructionNode(S)&&this.ins(S.target,S.data)},T.prototype._serializeAttributes=function(S,_,E,D,b,I){var O,M,R=I?new p.LocalNameSet:void 0;try{for(var A=s(S.attributes),B=A.next();!B.done;B=A.next()){var k=B.value;if(I||b||k.namespaceURI!==null){if(I&&R&&R.has(k.namespaceURI,k.localName))return void this.emit("error",new Error("Element contains duplicate attributes (well-formed required)."));I&&R&&R.set(k.namespaceURI,k.localName);var L=k.namespaceURI,F=null;if(L!==null)if(F=_.get(k.prefix,L),L===h.namespace.XMLNS){if(k.value===h.namespace.XML||k.prefix===null&&b||k.prefix!==null&&(!(k.localName in D)||D[k.localName]!==k.value)&&_.has(k.localName,k.value))continue;if(I&&k.value===h.namespace.XMLNS)return void this.emit("error",new Error("XMLNS namespace is reserved (well-formed required)."));if(I&&k.value==="")return void this.emit("error",new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required)."));k.prefix==="xmlns"&&(F="xmlns")}else F===null&&(F=k.prefix===null||_.hasPrefix(k.prefix)&&!_.has(k.prefix,L)?this._generatePrefix(L,_,E):k.prefix,this._push(this._writer.attribute("xmlns:"+F,this._serializeAttributeValue(L,this._options.wellFormed))));if(I&&(k.localName.indexOf(":")!==-1||!d.xml_isName(k.localName)||k.localName==="xmlns"&&L===null))return void this.emit("error",new Error("Attribute local name contains invalid characters (well-formed required)."));this._push(this._writer.attribute((F!==null?F+":":"")+k.localName,this._serializeAttributeValue(k.value,this._options.wellFormed)))}else this._push(this._writer.attribute(k.localName,this._serializeAttributeValue(k.value,this._options.wellFormed)))}}catch(j){O={error:j}}finally{try{B&&!B.done&&(M=A.return)&&M.call(A)}finally{if(O)throw O.error}}},T.prototype._serializeAttributeValue=function(S,_){return _&&S!==null&&!d.xml_isLegalChar(S)?(this.emit("error",new Error("Invalid characters in attribute value.")),""):S===null?"":S.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},T.prototype._recordNamespaceInformation=function(S,_,E){var D,b,I=null;try{for(var O=s(S.attributes),M=O.next();!M.done;M=O.next()){var R=M.value,A=R.namespaceURI,B=R.prefix;if(A===h.namespace.XMLNS){if(B===null){I=R.value;continue}var k=R.localName,L=R.value;if(L===h.namespace.XML||(L===""&&(L=null),_.has(k,L)))continue;_.set(k,L),E[k]=L||""}}}catch(F){D={error:F}}finally{try{M&&!M.done&&(b=O.return)&&b.call(O)}finally{if(D)throw D.error}}return I},T.prototype._generatePrefix=function(S,_,E){var D="ns"+E.value;return E.value++,_.set(D,S),D},T.prototype._isPrefixMapModified=function(S,_){var E=S._items,D=_._items,b=S._nullItems,I=_._nullItems;for(var O in D){var M=E[O];if(M===void 0)return!0;var R=D[O];if(M.length!==R.length)return!0;for(var A=0;A<M.length;A++)if(M[A]!==R[A])return!0}if(b.length!==I.length)return!0;for(A=0;A<b.length;A++)if(b[A]!==I[A])return!0;return!1},T._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),T})(i(308).EventEmitter);n.XMLBuilderCBImpl=C},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(f){var u=c.call(this,f)||this;return u._lineLength=0,u}return a(l,c),l.prototype.frontMatter=function(){return""},l.prototype.declaration=function(f,u,d){var h=this._beginLine()+"<?xml";return h+=' version="'+f+'"',u!==void 0&&(h+=' encoding="'+u+'"'),d!==void 0&&(h+=' standalone="'+(d?"yes":"no")+'"'),h+="?>"},l.prototype.docType=function(f,u,d){var h=this._beginLine();return h+=u&&d?"<!DOCTYPE "+f+' PUBLIC "'+u+'" "'+d+'">':u?"<!DOCTYPE "+f+' PUBLIC "'+u+'">':d?"<!DOCTYPE "+f+' SYSTEM "'+d+'">':"<!DOCTYPE "+f+">"},l.prototype.comment=function(f){return this._beginLine()+"<!--"+f+"-->"},l.prototype.text=function(f){return this._beginLine()+f},l.prototype.instruction=function(f,u){return u?this._beginLine()+"<?"+f+" "+u+"?>":this._beginLine()+"<?"+f+"?>"},l.prototype.cdata=function(f){return this._beginLine()+"<![CDATA["+f+"]]>"},l.prototype.openTagBegin=function(f){return this._lineLength+=1+f.length,this._beginLine()+"<"+f},l.prototype.openTagEnd=function(f,u,d){return d?" />":u?this._writerOptions.allowEmptyTags?"></"+f+">":this._writerOptions.spaceBeforeSlash?" />":"/>":">"},l.prototype.closeTag=function(f){return this._beginLine()+"</"+f+">"},l.prototype.attribute=function(f,u){var d=f+'="'+u+'"';return this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._lineLength+1+d.length>this._writerOptions.width?(d=this._beginLine()+this._indent(1)+d,this._lineLength=d.length,d):(this._lineLength+=1+d.length," "+d)},l.prototype.beginElement=function(f){},l.prototype.endElement=function(f){},l.prototype._beginLine=function(){if(this._writerOptions.prettyPrint){var f=(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level);return this._lineLength=f.length,f}return""},l.prototype._indent=function(f){return f<=0?"":this._writerOptions.indent.repeat(f)},l})(i(114).BaseCBWriter);n.XMLCBWriter=s},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(f){var u=c.call(this,f)||this;return u._hasChildren=[],u._additionalLevel=0,u}return a(l,c),l.prototype.frontMatter=function(){return""},l.prototype.declaration=function(f,u,d){return""},l.prototype.docType=function(f,u,d){return""},l.prototype.comment=function(f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.comment)+this._sep()+this._val(f)+this._sep()+"}"},l.prototype.text=function(f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.text)+this._sep()+this._val(f)+this._sep()+"}"},l.prototype.instruction=function(f,u){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.ins)+this._sep()+this._val(u?f+" "+u:f)+this._sep()+"}"},l.prototype.cdata=function(f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.cdata)+this._sep()+this._val(f)+this._sep()+"}"},l.prototype.attribute=function(f,u){return this._comma()+this._beginLine(1)+"{"+this._sep()+this._key(this._builderOptions.convert.att+f)+this._sep()+this._val(u)+this._sep()+"}"},l.prototype.openTagBegin=function(f){var u=this._comma()+this._beginLine()+"{"+this._sep()+this._key(f)+this._sep()+"{";return this._additionalLevel++,this.hasData=!0,u+=this._beginLine()+this._key(this._builderOptions.convert.text)+this._sep()+"[",this._hasChildren.push(!1),u},l.prototype.openTagEnd=function(f,u,d){if(u){var h=this._sep()+"]";return this._additionalLevel--,h+=this._beginLine()+"}"+this._sep()+"}"}return""},l.prototype.closeTag=function(f){var u=this._beginLine()+"]";return this._additionalLevel--,u+=this._beginLine()+"}"+this._sep()+"}"},l.prototype.beginElement=function(f){},l.prototype.endElement=function(f){this._hasChildren.pop()},l.prototype._beginLine=function(f){return f===void 0&&(f=0),this._writerOptions.prettyPrint?(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level+f):""},l.prototype._indent=function(f){return f+this._additionalLevel<=0?"":this._writerOptions.indent.repeat(f+this._additionalLevel)},l.prototype._comma=function(){var f=this._hasChildren[this._hasChildren.length-1]?",":"";return this._hasChildren.length>0&&(this._hasChildren[this._hasChildren.length-1]=!0),f},l.prototype._sep=function(){return this._writerOptions.prettyPrint?" ":""},l.prototype._key=function(f){return'"'+f+'":'},l.prototype._val=function(f){return JSON.stringify(f)},l})(i(114).BaseCBWriter);n.JSONCBWriter=s},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(f){var u=c.call(this,f)||this;if(u._rootWritten=!1,u._additionalLevel=0,f.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(f.offset<0)throw new Error("YAML offset should be zero or a positive number.");return u}return a(l,c),l.prototype.frontMatter=function(){return this._beginLine()+"---"},l.prototype.declaration=function(f,u,d){return""},l.prototype.docType=function(f,u,d){return""},l.prototype.comment=function(f){return this._beginLine()+this._key(this._builderOptions.convert.comment)+" "+this._val(f)},l.prototype.text=function(f){return this._beginLine()+this._key(this._builderOptions.convert.text)+" "+this._val(f)},l.prototype.instruction=function(f,u){return this._beginLine()+this._key(this._builderOptions.convert.ins)+" "+this._val(u?f+" "+u:f)},l.prototype.cdata=function(f){return this._beginLine()+this._key(this._builderOptions.convert.cdata)+" "+this._val(f)},l.prototype.attribute=function(f,u){this._additionalLevel++;var d=this._beginLine()+this._key(this._builderOptions.convert.att+f)+" "+this._val(u);return this._additionalLevel--,d},l.prototype.openTagBegin=function(f){var u=this._beginLine()+this._key(f);return this._rootWritten||(this._rootWritten=!0),this.hasData=!0,this._additionalLevel++,u+=this._beginLine(!0)+this._key(this._builderOptions.convert.text)},l.prototype.openTagEnd=function(f,u,d){return u?" "+this._val(""):""},l.prototype.closeTag=function(f){return this._additionalLevel--,""},l.prototype.beginElement=function(f){},l.prototype.endElement=function(f){},l.prototype._beginLine=function(f){return f===void 0&&(f=!1),(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level,f)},l.prototype._indent=function(f,u){if(f+this._additionalLevel<=0)return"";var d=this._writerOptions.indent.repeat(f+this._additionalLevel);return!u&&this._rootWritten?d.substr(0,d.length-2)+"-"+d.substr(-1,1):d},l.prototype._key=function(f){return'"'+f+'":'},l.prototype._val=function(f){return JSON.stringify(f)},l})(i(114).BaseCBWriter);n.YAMLCBWriter=s},function(r,n,i){var o,a=typeof Reflect=="object"?Reflect:null,s=a&&typeof a.apply=="function"?a.apply:function(y,C,x){return Function.prototype.apply.call(y,C,x)};o=a&&typeof a.ownKeys=="function"?a.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var c=Number.isNaN||function(y){return y!=y};function l(){l.init.call(this)}r.exports=l,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var f=10;function u(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}function d(y){return y._maxListeners===void 0?l.defaultMaxListeners:y._maxListeners}function h(y,C,x,T){var S,_,E,D;if(u(x),(_=y._events)===void 0?(_=y._events=Object.create(null),y._eventsCount=0):(_.newListener!==void 0&&(y.emit("newListener",C,x.listener?x.listener:x),_=y._events),E=_[C]),E===void 0)E=_[C]=x,++y._eventsCount;else if(typeof E=="function"?E=_[C]=T?[x,E]:[E,x]:T?E.unshift(x):E.push(x),(S=d(y))>0&&E.length>S&&!E.warned){E.warned=!0;var b=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(C)+" listeners added. Use emitter.setMaxListeners() to increase limit");b.name="MaxListenersExceededWarning",b.emitter=y,b.type=C,b.count=E.length,D=b,console&&console.warn&&console.warn(D)}return y}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(y,C,x){var T={fired:!1,wrapFn:void 0,target:y,type:C,listener:x},S=g.bind(T);return S.listener=x,T.wrapFn=S,S}function m(y,C,x){var T=y._events;if(T===void 0)return[];var S=T[C];return S===void 0?[]:typeof S=="function"?x?[S.listener||S]:[S]:x?(function(_){for(var E=new Array(_.length),D=0;D<E.length;++D)E[D]=_[D].listener||_[D];return E})(S):v(S,S.length)}function w(y){var C=this._events;if(C!==void 0){var x=C[y];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}function v(y,C){for(var x=new Array(C),T=0;T<C;++T)x[T]=y[T];return x}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(y){if(typeof y!="number"||y<0||c(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");f=y}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||c(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},l.prototype.getMaxListeners=function(){return d(this)},l.prototype.emit=function(y){for(var C=[],x=1;x<arguments.length;x++)C.push(arguments[x]);var T=y==="error",S=this._events;if(S!==void 0)T=T&&S.error===void 0;else if(!T)return!1;if(T){var _;if(C.length>0&&(_=C[0]),_ instanceof Error)throw _;var E=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw E.context=_,E}var D=S[y];if(D===void 0)return!1;if(typeof D=="function")s(D,this,C);else{var b=D.length,I=v(D,b);for(x=0;x<b;++x)s(I[x],this,C)}return!0},l.prototype.addListener=function(y,C){return h(this,y,C,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(y,C){return h(this,y,C,!0)},l.prototype.once=function(y,C){return u(C),this.on(y,p(this,y,C)),this},l.prototype.prependOnceListener=function(y,C){return u(C),this.prependListener(y,p(this,y,C)),this},l.prototype.removeListener=function(y,C){var x,T,S,_,E;if(u(C),(T=this._events)===void 0)return this;if((x=T[y])===void 0)return this;if(x===C||x.listener===C)--this._eventsCount==0?this._events=Object.create(null):(delete T[y],T.removeListener&&this.emit("removeListener",y,x.listener||C));else if(typeof x!="function"){for(S=-1,_=x.length-1;_>=0;_--)if(x[_]===C||x[_].listener===C){E=x[_].listener,S=_;break}if(S<0)return this;S===0?x.shift():(function(D,b){for(;b+1<D.length;b++)D[b]=D[b+1];D.pop()})(x,S),x.length===1&&(T[y]=x[0]),T.removeListener!==void 0&&this.emit("removeListener",y,E||C)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(y){var C,x,T;if((x=this._events)===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[y]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete x[y]),this;if(arguments.length===0){var S,_=Object.keys(x);for(T=0;T<_.length;++T)(S=_[T])!=="removeListener"&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(C=x[y])=="function")this.removeListener(y,C);else if(C!==void 0)for(T=C.length-1;T>=0;T--)this.removeListener(y,C[T]);return this},l.prototype.listeners=function(y){return m(this,y,!0)},l.prototype.rawListeners=function(y){return m(this,y,!1)},l.listenerCount=function(y,C){return typeof y.listenerCount=="function"?y.listenerCount(C):w.call(y,C)},l.prototype.listenerCount=w,l.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(77);n.createCB=function(a){return new o.XMLBuilderCBImpl(a)},n.fragmentCB=function(a){return new o.XMLBuilderCBImpl(a,!0)}}])}))})(am)),am.exports}var jZ=zZ(),Eo=Uint8Array,Lu=Uint16Array,u7=Uint32Array,f7=new Eo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),d7=new Eo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),HZ=new Eo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h7=function(t,e){for(var r=new Lu(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new u7(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},g7=h7(f7,2),p7=g7[0],KZ=g7[1];p7[28]=258,KZ[258]=28;var XZ=h7(d7,0),qZ=XZ[0],T5=new Lu(32768);for(var dr=0;dr<32768;++dr){var il=(dr&43690)>>>1|(dr&21845)<<1;il=(il&52428)>>>2|(il&13107)<<2,il=(il&61680)>>>4|(il&3855)<<4,T5[dr]=((il&65280)>>>8|(il&255)<<8)>>>1}var jd=(function(t,e,r){for(var n=t.length,i=0,o=new Lu(e);i<n;++i)t[i]&&++o[t[i]-1];var a=new Lu(e);for(i=0;i<e;++i)a[i]=a[i-1]+o[i-1]<<1;var s;if(r){s=new Lu(1<<e);var c=15-e;for(i=0;i<n;++i)if(t[i])for(var l=i<<4|t[i],f=e-t[i],u=a[t[i]-1]++<<f,d=u|(1<<f)-1;u<=d;++u)s[T5[u]>>>c]=l}else for(s=new Lu(n),i=0;i<n;++i)t[i]&&(s[i]=T5[a[t[i]-1]++]>>>15-t[i]);return s}),Cg=new Eo(288);for(var dr=0;dr<144;++dr)Cg[dr]=8;for(var dr=144;dr<256;++dr)Cg[dr]=9;for(var dr=256;dr<280;++dr)Cg[dr]=7;for(var dr=280;dr<288;++dr)Cg[dr]=8;var m7=new Eo(32);for(var dr=0;dr<32;++dr)m7[dr]=5;var YZ=jd(Cg,9,1),JZ=jd(m7,5,1),Fv=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},pa=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},Uv=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},ZZ=function(t){return(t+7)/8|0},QZ=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t.BYTES_PER_ELEMENT==2?Lu:t.BYTES_PER_ELEMENT==4?u7:Eo)(r-e);return n.set(t.subarray(e,r)),n},eQ=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ca=function(t,e,r){var n=new Error(e||eQ[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Ca),!r)throw n;return n},tx=function(t,e,r){var n=t.length;if(!n||r&&r.f&&!r.l)return e||new Eo(0);var i=!e||r,o=!r||r.i;r||(r={}),e||(e=new Eo(n*3));var a=function(de){var we=e.length;if(de>we){var _e=new Eo(Math.max(we*2,de));_e.set(e),e=_e}},s=r.f||0,c=r.p||0,l=r.b||0,f=r.l,u=r.d,d=r.m,h=r.n,g=n*8;do{if(!f){s=pa(t,c,1);var p=pa(t,c+1,3);if(c+=3,p)if(p==1)f=YZ,u=JZ,d=9,h=5;else if(p==2){var y=pa(t,c,31)+257,C=pa(t,c+10,15)+4,x=y+pa(t,c+5,31)+1;c+=14;for(var T=new Eo(x),S=new Eo(19),_=0;_<C;++_)S[HZ[_]]=pa(t,c+_*3,7);c+=C*3;for(var E=Fv(S),D=(1<<E)-1,b=jd(S,E,1),_=0;_<x;){var I=b[pa(t,c,D)];c+=I&15;var m=I>>>4;if(m<16)T[_++]=m;else{var O=0,M=0;for(m==16?(M=3+pa(t,c,3),c+=2,O=T[_-1]):m==17?(M=3+pa(t,c,7),c+=3):m==18&&(M=11+pa(t,c,127),c+=7);M--;)T[_++]=O}}var R=T.subarray(0,y),A=T.subarray(y);d=Fv(R),h=Fv(A),f=jd(R,d,1),u=jd(A,h,1)}else Ca(1);else{var m=ZZ(c)+4,w=t[m-4]|t[m-3]<<8,v=m+w;if(v>n){o&&Ca(0);break}i&&a(l+w),e.set(t.subarray(m,v),l),r.b=l+=w,r.p=c=v*8,r.f=s;continue}if(c>g){o&&Ca(0);break}}i&&a(l+131072);for(var B=(1<<d)-1,k=(1<<h)-1,L=c;;L=c){var O=f[Uv(t,c)&B],F=O>>>4;if(c+=O&15,c>g){o&&Ca(0);break}if(O||Ca(2),F<256)e[l++]=F;else if(F==256){L=c,f=null;break}else{var j=F-254;if(F>264){var _=F-257,J=f7[_];j=pa(t,c,(1<<J)-1)+p7[_],c+=J}var ie=u[Uv(t,c)&k],fe=ie>>>4;ie||Ca(3),c+=ie&15;var A=qZ[fe];if(fe>3){var J=d7[fe];A+=Uv(t,c)&(1<<J)-1,c+=J}if(c>g){o&&Ca(0);break}i&&a(l+131072);for(var ae=l+j;l<ae;l+=4)e[l]=e[l-A],e[l+1]=e[l+1-A],e[l+2]=e[l+2-A],e[l+3]=e[l+3-A];l=ae}}r.l=f,r.p=L,r.b=l,r.f=s,f&&(s=1,r.m=d,r.d=u,r.n=h)}while(!s);return l==e.length?e:QZ(e,0,l)},tQ=new Eo(0),nQ=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&Ca(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=t[10]|(t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},rQ=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},iQ=function(t){((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&Ca(6,"invalid zlib data"),t[1]&32&&Ca(6,"invalid zlib data: preset dictionaries not supported")};function oQ(t,e){return tx(t,e)}function aQ(t,e){return tx(t.subarray(nQ(t),-8),new Eo(rQ(t)))}function sQ(t,e){return tx((iQ(t),t.subarray(2,-4)),e)}function cQ(t,e){return t[0]==31&&t[1]==139&&t[2]==8?aQ(t):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?oQ(t,e):sQ(t,e)}var lQ=typeof TextDecoder<"u"&&new TextDecoder,uQ=0;try{lQ.decode(tQ,{stream:!0}),uQ=1}catch{}const To=[];To[45]=62;To[95]=63;const Lf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let t=0;t<Lf.length;t++)To[Lf.charCodeAt(t)]=t;function rs(t){return To[t.charCodeAt(0)]!==void 0}function fQ(t){const e=t.length,r=[];let n=null;for(let i=0;i<e;i++)rs(t[i])?(n||(n={start:i,count:0}),n.count++,n.end=i):t[i]==="="&&n&&(r.push(n),n=null);return n&&r.push(n),r}function dQ(t,e,r,n){const{start:i,count:o}=e,a=o%4,s=Math.floor(o/4);let c=i,l=null,f=r;for(let u=0;u<s;u++){for(;!rs(t[c]);)c++;for(l=To[t.charCodeAt(c++)]<<18;!rs(t[c]);)c++;for(l|=To[t.charCodeAt(c++)]<<12;!rs(t[c]);)c++;for(l|=To[t.charCodeAt(c++)]<<6;!rs(t[c]);)c++;l|=To[t.charCodeAt(c++)],n[f++]=l>>16&255,n[f++]=l>>8&255,n[f++]=l&255}switch(a){case 3:for(;!rs(t[c]);)c++;for(l=To[t.charCodeAt(c++)]<<10;!rs(t[c]);)c++;for(l|=To[t.charCodeAt(c++)]<<4;!rs(t[c]);)c++;l|=To[t.charCodeAt(c++)]>>2,n[f++]=l>>8&255,n[f++]=l&255;break;case 2:for(;!rs(t[c]);)c++;for(l=To[t.charCodeAt(c++)]<<2;!rs(t[c]);)c++;l|=To[t.charCodeAt(c++)]>>4,n[f++]=l&255;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return f}function hQ(t){const e=fQ(t),r=e[e.length-1].end+1,n=(4-r%4)%4,i=(r+n)*3/4-n,o=new ArrayBuffer(i),a=new Uint8Array(o);let s=0;for(let c=0;c<e.length;c++)s+=dQ(t,e[c],s,a),s+=(4-e[c].count%4)%4;return o}function x_(t,e,r){const n=(t<<16)+(e<<8)+r;return Lf[n>>18]+Lf[n>>12&63]+Lf[n>>6&63]+Lf[n&63]}function gQ(t){const e=new Uint8Array(t),r=t.byteLength%3,n=t.byteLength-r,i=Array(n/3);for(let o=0;o<i.length;o++){const a=o*3;i[o]=x_(e[a],e[a+1],e[a+2])}if(r>0){const o=x_(e[n],e[n+1]||0,e[n+2]||0);r===1?i.push(`${o.substr(0,2)}==`):r===2&&i.push(`${o.substr(0,3)}=`)}return i.join("")}var nx={toArrayBuffer:hQ,fromArrayBuffer:gQ};function pQ(t,e){e.classHierarchy.push("vtkStringArray"),t.getComponent=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+n]},t.setComponent=(r,n,i)=>{i!==e.values[r*e.numberOfComponents+n]&&(e.values[r*e.numberOfComponents+n]=i,t.modified())},t.getData=()=>e.values,t.getTuple=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=e.numberOfComponents||1;n.length&&(n.length=i);const o=r*i;for(let a=0;a<i;a++)n[a]=e.values[o+a];return n},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.values.length,t.getNumberOfTuples=()=>e.values.length/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>y7({name:e.name,numberOfComponents:e.numberOfComponents,empty:!0}),t.getName=()=>(e.name||t.setName(`vtkStringArray${t.getMTime()}`),e.name),t.setData=(r,n)=>{e.values=r,e.size=r.length,n&&(e.numberOfComponents=n),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.modified()}}const mQ={name:"",numberOfComponents:1,size:0,dataType:"string"};function v7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,mQ,r),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkStringArray object without: size > 0, values");e.values?Array.isArray(e.values)&&(e.values=[...e.values]):e.values=[],e.values&&(e.size=e.values.length),K.obj(t,e),K.set(t,e,["name"]),pQ(t,e)}const y7=K.newInstance(v7,"vtkStringArray");var vQ={newInstance:y7,extend:v7};function yQ(t,e){return[...t.getElementsByTagName(e)]}function T_(t,e){return yQ(t,e)[0]}function wQ(t){return jZ.create(t)}function CQ(t){const e=/^\s*<AppendedData\s+encoding="raw">\s*_/m,r=/\n\s*<\/AppendedData>/m;return bh.extractBinary(t,e,r)}const wl={Int8:Int8Array,UInt8:Uint8Array,Int16:Int16Array,UInt16:Uint16Array,Int32:Int32Array,UInt32:Uint32Array,Int64:Int32Array,UInt64:Uint32Array,Float32:Float32Array,Float64:Float64Array},Dh={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,Int64:8,UInt64:8,Float32:4,Float64:8};function S5(t){const e=t.length-1;return t.filter((r,n)=>n<e&&n%2===0)}function _5(t,e,r){if(!["UInt64","UInt32"].includes(r))throw new Error(`Cannot handle a header type of ${r}`);let n=wl[r],i=wl[e],o=!1;r==="UInt64"&&(n=wl.UInt32),/^U?Int64$/.test(e)&&(o=!0,i=wl[e.replace("64","32")]);const{byteOffset:a}=t,s=Dh[e],c=Dh[r];let l;a%c===0?l=new n(t.buffer,a,1):l=new n(t.buffer.slice(a,a+c));const f=Number(l[0]);let u,d=f/s;o&&(d*=2);const h=a+c;return h%s===0?u=new i(t.buffer,h,d):u=new i(t.buffer.slice(h,h+f)),o&&(u=S5(u)),u}function xQ(t,e){if(e==="UInt64"){let l=new Uint32Array(t.buffer,0,6);const f=l[0],u=l[2],d=l[4],h=[8,f,u,d];l=new Uint32Array(t.buffer,24,f*2);for(let g=0;g<f;g++)h.push(l[g*2]);return h}let r=new Uint32Array(t.buffer,0,3);const n=4,i=r[0],o=r[1],a=r[2],s=[n,i,o,a];r=new Uint32Array(t.buffer,12,i);for(let c=0;c<i;c++)s.push(r[c]);return s}function TQ(t,e){const[r]=t;return(t.length-1)*r}function SQ(t,e){const r=cQ(t);e.uint8.set(r,e.offset),e.offset+=r.length}function rx(t,e){const r=xQ(t,e),n=r[1],i=r[2],o=r[3];let a=0;n>0&&(o===0?a=n*i:a=(n-1)*i+o);const s=new ArrayBuffer(a),c={offset:0,uint8:new Uint8Array(s)};let l=TQ(r);for(;l<t.length&&t[l]!==120;)l++;for(let f=0;f<n;f++){const u=r[4+f],d=new Uint8Array(t.buffer,l,u);SQ(d,c),l+=u}return c.uint8}function Ih(t,e,r,n,i,o){const a=e.getAttribute("type"),s=e.getAttribute("Name"),c=e.getAttribute("format"),l=Number(e.getAttribute("NumberOfComponents")||"1");let f=null;if(c==="ascii"){f=new wl[a](t*l);let u=0;e.firstChild.nodeValue.split(/[\\t \\n]+/).forEach(d=>{d.trim().length&&(f[u++]=Number(d))})}else if(c==="binary"){const u=new Uint8Array(nx.toArrayBuffer(e.firstChild.nodeValue.trim()));if(r==="vtkZLibDataCompressor"){const d=rx(u,i);f=new wl[a](d.buffer),/^U?Int64$/.test(a)&&(f=S5(f))}else f=new wl[a](u.buffer,Dh[i]),a.indexOf("Int64")!==-1&&(f=S5(f))}else if(c==="appended"){const u=Number(e.getAttribute("offset"));f=_5(new Uint8Array(o,u),a,i)}else console.error("Format not supported",c);return{name:s,values:f,numberOfComponents:l}}function Bv(t){return new TextDecoder().decode(t).split("\0").slice(0,-1)}function _Q(t,e,r,n,i){const o=t.getAttribute("Name"),a=t.getAttribute("format"),s=Number(t.getAttribute("NumberOfComponents")||"1"),l=Number(t.getAttribute("NumberOfTuples")||"1")*s,f=[];if(a==="ascii"){const u=t.firstChild.nodeValue.trim().split(/\s+/);let d=0;const h=[];for(;f.length<l;){const g=Number(u[d++]);g===0?(f.push(h.join("")),h.length=0):h.push(String.fromCharCode(g))}}else if(a==="binary"){const u=new Uint8Array(nx.toArrayBuffer(t.firstChild.nodeValue.trim()));if(e==="vtkZLibDataCompressor"){const d=rx(u,n);f.push(...Bv(d))}else{const d=_5(u,"UInt8",n);f.push(...Bv(d))}}else if(a==="appended"){const u=Number(t.getAttribute("offset")),d=_5(new Uint8Array(i,u),"UInt8",n);f.push(...Bv(d))}else K.vtkErrorMacro(`Format not supported: ${a}`);return{name:o,values:f,numberOfComponents:s}}function EQ(t,e,r,n,i,o){const a={},s=e.getElementsByTagName("DataArray");for(let g=0;g<s.length;g++){const p=s[g];a[p.getAttribute("Name")]=p}const c=Ih(t,a.offsets,r,n,i,o).values,l=c[c.length-1],f=Ih(l,a.connectivity,r,n,i,o).values,u=new Uint32Array(t+l);let d=0,h=0;return c.forEach(g=>{const p=g-h;u[d++]=p;for(let m=0;m<p;m++)u[d++]=f[h+m];h=g}),u}function bQ(t,e,r,n,i,o,a){if(e){const s=["Scalars","Vectors","Normals","Tensors","TCoords"],c={};s.forEach(u=>{const d=e.getAttribute(u);d&&(c[d]=r[`set${u}`])});const l=e.getElementsByTagName("DataArray"),f=l.length;for(let u=0;u<f;u++){const d=l[u],h=Tt.newInstance(Ih(t,d,n,i,o,a)),g=h.getName();(c[g]||r.addArray)(h)}}}function DQ(t,e,r,n,i){const o=[...t.getElementsByTagName("DataArray")].map(s=>Tt.newInstance(Ih(Number(s.getAttribute("NumberOfTuples")),s,e,r,n,i))),a=[...t.getElementsByTagName("Array")].filter(s=>s.getAttribute("type")==="String").map(s=>vQ.newInstance(_Q(s,e,r,n,i)));return[...o,...a]}function IQ(t,e){e.classHierarchy.push("vtkXMLReader"),e.dataAccessHelper||(e.dataAccessHelper=wg.get("http"));function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.dataAccessHelper.fetchBinary(n,i)}t.setUrl=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.url=n;const o=n.split("/");return o.pop(),e.baseURL=o.join("/"),t.loadData(i)},t.loadData=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r(e.url,n).then(t.parseAsArrayBuffer)},t.parseAsArrayBuffer=n=>{if(!n)return!1;if(n!==e.rawDataBuffer)t.modified();else return!0;const{text:i,binaryBuffer:o}=CQ(n);e.rawDataBuffer=n,e.binaryBuffer=o;const s=wQ(i).root(),c=s.node,l=c.getAttribute("type"),f=c.getAttribute("compressor"),u=c.getAttribute("byte_order"),d=c.getAttribute("header_type")||"UInt32";if(f&&f!=="vtkZLibDataCompressor")return console.error("Invalid compressor",f),!1;if(u&&u!=="LittleEndian")return console.error("Only LittleEndian encoding is supported"),!1;if(l!==e.dataType)return console.error("Invalid data type",l,"expecting",e.dataType),!1;if(T_(c,"AppendedData")){const p=T_(c,"AppendedData"),m=p.getAttribute("encoding"),w=s.filter(S=>{const{node:_}=S;return _.nodeType===Node.ELEMENT_NODE&&_.getAttribute("format")==="appended"&&_.hasAttribute("offset")},!1,!0).map(S=>({node:S.node,offset:Number(S.node.getAttribute("offset"))}));w.sort((S,_)=>S.offset-_.offset);let v=e.binaryBuffer;m==="base64"&&(v=p.textContent.trim().substr(1));const y=[];for(let S=0;S<w.length;++S){const _=w[S].offset;let E=0;S===w.length-1?E=v.length||v.byteLength:E=w[S+1].offset,m==="base64"?y.push(new Uint8Array(nx.toArrayBuffer(v.substring(_,E)))):y.push(new Uint8Array(v.slice(_,E)))}if(f==="vtkZLibDataCompressor")for(let S=0;S<y.length;++S){const _=y[S],E=rx(_,d),D=new Uint8Array(E.length+Dh[d]);new wl[d](D.buffer,0,1)[0]=E.length,D.set(E,Dh[d]),y[S]=D}const C=y.reduce((S,_)=>S+_.length,0),x=new ArrayBuffer(C),T=new Uint8Array(x);for(let S=0,_=0;S<y.length;++S)w[S].node.setAttribute("offset",_),T.set(y[S],_),_+=y[S].length;if(e.binaryBuffer=x,!e.binaryBuffer)return console.error("Processing appended data format: requires binaryBuffer to parse"),!1}t.parseXML(c,l,f,u,d);const g=c.getElementsByTagName(l)[0].getElementsByTagName("FieldData")[0];if(g){const p=DQ(g,f,u,d,e.binaryBuffer);for(let m=0;m<e.output.length;m++){const w=e.output[m].getFieldData();for(let v=0;v<p.length;v++)w.addArray(p[v])}}return!0},t.requestData=(n,i)=>{t.parseAsArrayBuffer(e.rawDataBuffer)}}const MQ={};function OQ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MQ,r),K.obj(t,e),K.get(t,e,["url","baseURL"]),K.setGet(t,e,["dataAccessHelper"]),K.algo(t,e,0,1),IQ(t,e)}var Mh={extend:OQ,processDataArray:Ih,processFieldData:bQ,processCells:EQ};function PQ(t,e,r,n,i,o,a){const s=Number(r.getAttribute(`NumberOf${e}`));if(s>0){const c=r.getElementsByTagName(e)[0].getElementsByTagName("DataArray")[0],{values:l,numberOfComponents:f}=Mh.processDataArray(s,c,n,i,o,a);t[`get${e}`]().setData(l,f)}return s}function RQ(t,e,r,n,i,o,a){const s=Number(r.getAttribute(`NumberOf${e}`));if(s>0){const c=Mh.processCells(s,r.getElementsByTagName(e)[0],n,i,o,a);t[`get${e}`]().setData(c)}return s}function AQ(t,e){e.classHierarchy.push("vtkXMLPolyDataReader"),t.parseXML=(r,n,i,o,a)=>{const c=r.getElementsByTagName(e.dataType)[0].getElementsByTagName("Piece"),l=c.length;for(let f=0;f<l;f++){const u=rr.newInstance(),d=c[f],h=PQ(u,"Points",d,i,o,a,e.binaryBuffer);let g=0;["Verts","Lines","Strips","Polys"].forEach(p=>{g+=RQ(u,p,d,i,o,a,e.binaryBuffer)}),Mh.processFieldData(h,d.getElementsByTagName("PointData")[0],u.getPointData(),i,o,a,e.binaryBuffer),Mh.processFieldData(g,d.getElementsByTagName("CellData")[0],u.getCellData(),i,o,a,e.binaryBuffer),e.output[f]=u}}}const LQ={dataType:"PolyData"};function w7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LQ,r),Mh.extend(t,e,r),AQ(t,e)}const NQ=K.newInstance(w7,"vtkXMLPolyDataReader");var C7={newInstance:NQ,extend:w7};const cn={};function Gv(t,e,r,n,i){for(let o=0;o<i;o++)r[n+o]=t[e+o]}function VQ(t){cn.splitOn=t,cn.pieces=[],cn.v=[],cn.vt=[],cn.vn=[],cn.f=[[]],cn.size=0}function kQ(t){const e=t.split("/").map(o=>Number(o));let r=e[0]-1;r=r<0?r+1+cn.v.length/3:r;let n=e[1]?e[1]-1:r;n=n<0?n+1+cn.vt.length/2:n;let i=e[2]?e[2]-1:r;return i=i<0?i+1+cn.vn.length/3:i,[r,n,i]}function FQ(t){if(t[0]==="#")return;const e=t.split(/[ \t]+/);if(e[0]===cn.splitOn)e.shift(),cn.pieces.push(e.join(" ").trim()),cn.f.push([]),cn.size++;else if(e[0]==="v")cn.v.push(Number(e[1])),cn.v.push(Number(e[2])),cn.v.push(Number(e[3]));else if(e[0]==="vt")cn.vt.push(Number(e[1])),cn.vt.push(Number(e[2]));else if(e[0]==="vn")cn.vn.push(Number(e[1])),cn.vn.push(Number(e[2])),cn.vn.push(Number(e[3]));else if(e[0]==="f"){cn.size===0&&cn.size++;const r=cn.f[cn.size-1];e.shift();const n=e.filter(o=>o.length>0&&o!=="\r"),i=n.length;r.push(i);for(let o=0;o<i;o++)r.push(kQ(n[o]))}}function UQ(t){const e=!!cn.vt.length,r=!!cn.vn.length;if(t.splitMode){t.numberOfOutputs=cn.size;for(let n=0;n<cn.size;n++){const i=cn.f[n],o=i.length,a=cn.v.length/3,s={};let c;if(t.trackDuplicates){const m=[];let w=0;for(let y=0;y<o;){const C=i[y++];for(let x=0;x<C;x++){const[T,S,_]=i[y++],E=`${T}/${S}/${_}`;s[E]===void 0&&(m[T]===void 0?m[T]=[E]:(m[T].push(E),++w),s[E]=T)}}c=new Uint16Array(a+w);let v=0;for(let y=0;y<m.length;++y){const C=m[y]?m[y].length:0;c[y]=C>1?a+v:y;for(let x=1;x<C;++x){const T=a+v++;c[T]=y,s[m[y][x]]=T}}}const l={},f=rr.newInstance({name:cn.pieces[n]}),u=[],d=[],h=[],g=[];let p=0;for(;p<o;){const m=i[p];g.push(m);for(let w=0;w<m;w++){const[v,y,C]=i[p+w+1],x=`${v}/${y}/${C}`;if(l[x]===void 0){const T=t.trackDuplicates?s[x]:u.length/3;l[x]=T,Gv(cn.v,v*3,u,T*3,3),e&&Gv(cn.vt,y*2,d,T*2,2),r&&Gv(cn.vn,C*3,h,T*3,3)}g.push(l[x])}p+=m+1}if(f.getPoints().setData(Float32Array.from(u),3),t.trackDuplicates){const m=Tt.newInstance({name:"Duplicates",values:c});f.getPointData().addArray(m)}if(f.getPolys().setData(Uint32Array.from(g)),e){const m=Tt.newInstance({numberOfComponents:2,values:Float32Array.from(d),name:"TextureCoordinates"});f.getPointData().setTCoords(m)}if(r){const m=Tt.newInstance({numberOfComponents:3,values:Float32Array.from(h),name:"Normals"});f.getPointData().setNormals(m)}t.output[n]=f}}else{t.numberOfOutputs=1;const n=rr.newInstance();if(n.getPoints().setData(Float32Array.from(cn.v),3),e&&cn.v.length/3===cn.vt.length/2){const c=Tt.newInstance({numberOfComponents:2,values:Float32Array.from(cn.vt),name:"TextureCoordinates"});n.getPointData().setTCoords(c)}if(r&&cn.v.length===cn.vn.length){const c=Tt.newInstance({numberOfComponents:3,values:Float32Array.from(cn.vn),name:"Normals"});n.getPointData().setNormals(c)}const i=[],o=cn.f[0],a=o.length;let s=0;for(;s<a;){const c=o[s];i.push(c);for(let l=0;l<c;l++){const[f]=o[s+l+1];i.push(f)}s+=c+1}n.getPolys().setData(Uint32Array.from(i)),t.output[0]=n}}function BQ(t,e){const r=[],n=t.getPointData().getArrayByName("Duplicates");if(n==null)return r;const i=n.getData(),o=Math.min(e,i[e]);r.push(o);let a=i[o];if(a!==o)for(;a<i.length&&i[a]===o;)r.push(a++);return r}const GQ={getPointDuplicateIds:BQ};function WQ(t,e){e.classHierarchy.push("vtkOBJReader"),e.dataAccessHelper||(e.dataAccessHelper=wg.get("http"));function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.dataAccessHelper.fetchText(t,n,i)}t.setUrl=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n.indexOf(".obj")===-1&&!i.fullpath)e.baseURL=n,e.url=`${n}/index.obj`;else{e.url=n;const o=n.split("/");o.pop(),e.baseURL=o.join("/")}return t.loadData(i)},t.loadData=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r(e.url,n).then(i=>t.isDeleted()?!1:t.parseAsText(i))},t.parseAsText=n=>(n&&(n!==e.parseData&&t.modified(),e.parseData=n,e.numberOfOutputs=0,VQ(e.splitMode),n.split(`
`).forEach(FQ),UQ(e)),!0),t.requestData=(n,i)=>{t.parseAsText(e.parseData)},t.isBusy=()=>!!e.requestCount,t.getNumberOfOutputPorts=()=>e.numberOfOutputs}const $Q={numberOfOutputs:1,requestCount:0,splitMode:null,trackDuplicates:!1};function x7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$Q,r),K.obj(t,e),K.get(t,e,["url","baseURL"]),K.setGet(t,e,["dataAccessHelper","splitMode","trackDuplicates"]),K.algo(t,e,0,1),K.event(t,e,"busy"),WQ(t,e)}const zQ=K.newInstance(x7,"vtkOBJReader");var jQ={newInstance:zQ,extend:x7,...GQ};function HQ(t,e){e.classHierarchy.push("vtkPolyDataNormals"),t.vtkPolyDataNormalsExecute=(r,n,i)=>{if(!i)return null;const o=new Float32Array(i.length),a=new Float32Array(3*r);let s=0,c=0;const l=n.length,f=[0,0,0],u=[0,0,0];for(let d=0;d<l;d+=c+1)if(c=n[d],!(c<3)){for(let h=1;h<=3;++h)f[h-1]=3*n[d+h];if(X1.computeNormal(i.slice(f[0],f[0]+3),i.slice(f[1],f[1]+3),i.slice(f[2],f[2]+3),u),a[s++]=u[0],a[s++]=u[1],a[s++]=u[2],e.computePointNormals)for(let h=1;h<=c;++h){let g=3*n[d+h];o[g]+=u[0],o[++g]+=u[1],o[++g]+=u[2]}}if(e.computePointNormals){const d=[0,0,0];for(let h=0;h<i.length;)d[0]=o[h],d[1]=o[h+1],d[2]=o[h+2],pt.normalize(d),o[h++]=d[0],o[h++]=d[1],o[h++]=d[2]}return[a,o]},t.requestData=(r,n)=>{if(!t.getNumberOfInputPorts())return;const o=r[0];if(!o)return;const a=n[0]?.initialize()||rr.newInstance();a.setPoints(o.getPoints()),a.setVerts(o.getVerts()),a.setLines(o.getLines()),a.setPolys(o.getPolys()),a.setStrips(o.getStrips()),a.getPointData().passData(o.getPointData()),a.getCellData().passData(o.getCellData()),a.getFieldData().passData(o.getFieldData());const[s,c]=t.vtkPolyDataNormalsExecute(o.getNumberOfPolys(),o.getPolys().getData(),o.getPoints().getData());if(e.computePointNormals){const l=Tt.newInstance({numberOfComponents:3,name:"Normals",values:c});a.getPointData().setNormals(l)}if(e.computeCellNormals){const l=Tt.newInstance({numberOfComponents:3,name:"Normals",values:s});a.getCellData().setNormals(l)}n[0]=a}}function KQ(t){return{computeCellNormals:!1,computePointNormals:!0,...t}}function T7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KQ(r)),K.obj(t,e),K.algo(t,e,1,1),K.setGet(t,e,["computeCellNormals","computePointNormals"]),HQ(t,e)}const XQ=K.newInstance(T7,"vtkPolyDataNormals");var qQ={newInstance:XQ,extend:T7};class YQ{constructor(e){this._color=[255,255,255],this._actors=[],this.id=e.id,this._color=e.color??this._color,this._format=e.format;const r=new TextDecoder,n=qQ.newInstance(),i=o=>{const a=Lo.newInstance();a.setMapper(o);const s=cf.newInstance();return s.setColor(this._color[0]/255,this._color[1]/255,this._color[2]/255),a.setProperty(s),a};if(this._format===bo.PLY){const o=Ui.newInstance(),a=VZ.newInstance();a.parseAsArrayBuffer(e.arrayBuffer),o.setInputConnection(a.getOutputPort()),this._actors.push(i(o))}else if(this._format===bo.STL){const o=Ui.newInstance(),a=WZ.newInstance();a.parseAsArrayBuffer(e.arrayBuffer),n.setInputConnection(a.getOutputPort()),o.setInputConnection(n.getOutputPort()),this._actors.push(i(o))}else if(this._format===bo.OBJ){const o=jQ.newInstance({splitMode:e.materialUrl?"usemtl":null});o.parseAsText(r.decode(e.arrayBuffer));const a=o.getNumberOfOutputPorts();for(let s=0;s<a;s++){const c=o.getOutputData(s),l=Ui.newInstance();l.setInputData(c),this._actors.push(i(l))}}else if(this._format===bo.VTP){const o=Ui.newInstance(),a=C7.newInstance();a.parseAsArrayBuffer(e.arrayBuffer),o.setInputConnection(a.getOutputPort()),this._actors.push(i(o))}this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){let e=0;for(let r=0;r<this._actors.length;r++){const o=this._actors[r].getMapper().getInputData(),a=o.getPoints(),s=o.getPolys(),c=a.getData().length,l=s.getData().length;e+=c*4+l*4}return e}get defaultActor(){return this._actors[0]}get actors(){return this._actors}get color(){return this._color}get format(){return this._format}}var ya;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(ya||(ya={}));class c2{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,r,n){const i=e.indexOf(".");if(i!==-1){const a=e.substring(0,i);let s=this._children.get(a);s||(s=new c2(this._target),this._children.set(a,s)),e=e.substring(i+1),s.addEventListener(e,r,n)}else this._addEventListener(e,r,n)}removeEventListener(e,r,n){const i=e.indexOf(".");if(i!==-1){const a=e.substring(0,i),s=this._children.get(a);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,r,n),s.isEmpty&&this._children.delete(a)}else this._removeEventListener(e,r,n)}reset(){Array.from(this._children.entries()).forEach(([e,r])=>{if(r.reset(),r.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,r,n){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const a=n?.capture??!1?ya.Capture:ya.Bubble,s=i.get(r)??ya.None;if(s&a){console.warn("A listener is already registered for this phase");return}i.set(r,s|a),this._target.addEventListener(e,r,n)}_removeEventListener(e,r,n){const o=n?.capture??!1?ya.Capture:ya.Bubble,a=this._eventListeners.get(e);if(!a)return;(r?[r]:Array.from(a.keys())).forEach(c=>{const l=a.get(c)??ya.None;if(!!!(l&o))return;this._target.removeEventListener(e,c,n);const u=l^o;u===ya.None?a.delete(c):a.set(c,u)}),a.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,r){Array.from(r.entries()).forEach(([n,i])=>{const o=ya.Capture;for(let a=o;i;a<<=1){if(!(i&a))continue;const s=a===ya.Capture;this.removeEventListener(e,n,{capture:s}),i^=a}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,r])=>{this._unregisterAllListeners(e,r)})}}class S7{constructor(){this._targetsEventListeners=new Map}addEventListener(e,r,n,i){let o=this._targetsEventListeners.get(e);o||(o=new c2(e),this._targetsEventListeners.set(e,o)),o.addEventListener(r,n,i)}removeEventListener(e,r,n,i){const o=this._targetsEventListeners.get(e);o&&(o.removeEventListener(r,n,i),o.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,r])=>{r.reset(),this._targetsEventListeners.delete(e)})}}const JQ=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:S7,TargetEventListeners:c2},Symbol.toStringTag,{value:"Module"}));function ZQ(t,e){const r=t.getSize();for(let n=0;n<r;n++){const i=[];t.getNodeValue(n,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(n,i)}}function ix(t){let e=t[0],r=t[0],n;const i=t.length;for(let o=1;o<i;o++)n=t[o],e=Math.min(e,n),r=Math.max(r,n);return{min:e,max:r}}const QQ=Symbol("LastRuntimeId"),eee={},tee=4294967295,nee="-";function _7(t,e,r){return ree(t!==null&&typeof t=="object"?t:eee,QQ,(typeof r=="number"&&r>0?r:tee)>>>0).join(typeof e=="string"?e:nee)}function ree(t,e,r){let n=t[e];n instanceof Array||(n=[0],Object.defineProperty(t,e,{value:n}));for(let i=!0,o=0;i&&o<n.length;++o){let a=n[o]|0;a<r?(i=!1,a=a+1):(a=0,o+1===n.length&&n.push(0)),n[o]=a}return n}const S_={},iee={add:(t,e)=>{const r=cr(t);S_[r]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const r=cr(e);return S_[r]}}};function Ad(t,e,r=1e-5){return Math.abs(t[0]+e[0])<r&&Math.abs(t[1]+e[1])<r&&Math.abs(t[2]+e[2])<r}function Or(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function oee(t,e){let r;e?r=[Bn(e)]:r=Bi();const n=[];return r.forEach(i=>{const o=t.getActors(),a=i.getVolumeViewports();for(const s of a){const c=s.getActors();if(c.length!==o.length)continue;o.every(({uid:f})=>c.find(u=>f===u.uid))&&n.push(s)}}),n}const E7=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function b7(t,e,r=void 0,n="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const o=!e.imageId,a=!o&&e,s=o&&e,l=`renderGPUViewport-${a.imageId||s.volumeId}`,f=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const d=t.width,h=t.height;f.style.width=`${d/u+vc}px`,f.style.height=`${h/u+vc}px`,f.style.visibility="hidden",f.style.position="absolute",document.body.appendChild(f);const g=l.split(":").join("-");f.setAttribute("viewport-id-for-remove",g);const p=Oo(f),m=Bn(n)||new ZC(n);let w=m.getViewport(l);if(!w){const v={viewportId:l,type:o?Fn.ORTHOGRAPHIC:Fn.STACK,element:f,defaultOptions:{...i,suppressEvents:!0}};m.enableElement(v),w=m.getViewport(l)}return new Promise(v=>{let y=!1,{viewReference:C}=i;const x=T=>{if(y)return;if(C){const M=C;C=null,w.setViewReference(M),w.render();return}t.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t.width,t.height);const _=w.canvasToWorld([0,0]),E=w.canvasToWorld([p.width/u,0]),D=w.canvasToWorld([0,p.height/u]),b=an([0,0,0],w.canvasToWorld([1/u,0]),_),I=an([0,0,0],w.canvasToWorld([0,1/u]),_),O=1;y=!0,f.removeEventListener(Ge.IMAGE_RENDERED,x),setTimeout(()=>{m.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${g}"]`).forEach(R=>{R.remove()})},0),v({origin:_,bottomLeft:D,topRight:E,thicknessMm:O,rightVector:b,downVector:I})};f.addEventListener(Ge.IMAGE_RENDERED,x),o?w.setVolumes([s],!1,!0):w.renderImageObject(e),w.resetCamera(),r==="PT"&&!E7(a)&&w.setProperties({voiRange:{lower:a.minPixelValue,upper:a.maxPixelValue}}),w.render()})}function D7(t,e,r,n,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const a=e,s=q9(t,a,r),c={canvas:t,viewport:s,image:a,renderingTools:{}};c.transform=Eh(c);const l=!0;return new Promise((f,u)=>{H9(c,l),f(null)})}function aee(t){const{canvas:e,imageId:r,viewReference:n,requestType:i=Zt.Thumbnail,priority:o=-5,renderingEngineId:a="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:f}=t,u=n?.volumeId,d=u&&!r,h=n&&f?{...f,viewReference:n}:f,g=s?D7:b7;return new Promise((p,m)=>{function w(x,T){const{modality:S}=ut("generalSeriesModule",T)||{},_=!d&&x,E=d&&x;_&&(_.isPreScaled=_.isPreScaled||_.preScale?.scaled),c&&(e.height=256,e.width=256),l&&_&&(e.width=_&&e.height*_.width/_.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,E&&s&&m(new Error("CPU rendering of volume not supported")),g(e,x,S,a,h).then(p)}function v(x,T){console.error(x,T),m(x)}function y(x,T,S){return Ts(x,S).then(_=>{w.call(this,_,x)},_=>{v.call(this,_,x)})}const C={useRGBA:!!s,requestType:i};if(u){const x=Ae.getVolume(u);x||m(new Error(`Volume id ${u} not found in cache`));const T=x.imageIds[0];w(x,T)}else Hr.addRequest(y.bind(null,r,null,C),i,{imageId:r},o)})}function E5(t){return Array.isArray(t)?t:[t]}const __={HISTORY_UNDO:"CORNERSTONE_TOOLS_HISTORY_UNDO",HISTORY_REDO:"CORNERSTONE_TOOLS_HISTORY_REDO"};class I7{constructor(e="Tools",r=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.isRecordingGrouped=!1,this.label=e,this._size=r}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}get canUndo(){return this.undoAvailable>0}get canRedo(){return this.redoAvailable>0}undo(e=1){for(;e>0&&this.undoAvailable>0;){const r=this.ring[this.position];for(const n of E5(r).reverse())n.restoreMemo(!0),this.dispatchHistoryEvent({item:n,isUndo:!0});e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}}undoIf(e){return this.undoAvailable>0&&e(this.ring[this.position])?(this.undo(),!0):!1}dispatchHistoryEvent({item:e,isUndo:r}){e.id&&ke.dispatchEvent(new CustomEvent(r?__.HISTORY_UNDO:__.HISTORY_REDO,{detail:{isUndo:r,id:e.id,operationType:e.operationType||"annotation",memo:e}}))}redo(e=1){for(;e>0&&this.redoAvailable>0;){const r=(this.position+1)%this.size,n=this.ring[r];for(const i of E5(n).reverse())i.restoreMemo(!1),this.dispatchHistoryEvent({item:i,isUndo:!1});e--,this.position=r,this.undoAvailable++,this.redoAvailable--}}initializeGroupItem(){this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=[]}startGroupRecording(){this.isRecordingGrouped=!0,this.initializeGroupItem()}rollbackUnusedGroupItem(){this.ring[this.position]=void 0,this.position=(this.position-1)%this._size,this.undoAvailable--}endGroupRecording(){this.isRecordingGrouped=!1;const e=this.ring[this.position];Array.isArray(e)&&e.length===0&&this.rollbackUnusedGroupItem()}pushGrouped(e){const r=this.ring[this.position];if(Array.isArray(r))return r.push(e),e;throw new Error("Last item should be an array for grouped memos.")}push(e){if(!e)return;const r=e.restoreMemo?e:e.createMemo?.();if(r)return this.isRecordingGrouped?this.pushGrouped(r):(this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=r,r)}}const M7=new I7,ox=Object.freeze(Object.defineProperty({__proto__:null,DefaultHistoryMemo:M7,HistoryMemo:I7},Symbol.toStringTag,{value:"Module"}));function b5(t,e){const r=ut("imagePlaneModule",t);if(!r)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:n,rowCosines:i,imagePositionPatient:o}=r;let{columnPixelSpacing:a,rowPixelSpacing:s}=r;a||=1,s||=1;const c=Ie();tn(c,o,n,-a/2),tn(c,c,i,-s/2);const l=Ie();an(l,e,c);const f=ft(l,i),u=ft(l,n);return[f/s,u/a]}function O7(t,e){const r=ut("imagePlaneModule",t);if(!r)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:n,rowCosines:i,imagePositionPatient:o}=r;let{columnPixelSpacing:a,rowPixelSpacing:s}=r;a||=1,s||=1;const c=Ie();return tn(c,o,i,s*(e[0]-.5)),tn(c,c,n,a*(e[1]-.5)),Array.from(c)}function $m(t){const e=Bi(),r=[];return e.forEach(n=>{n.getViewports().forEach(o=>{o.hasImageURI(t)&&r.push(o)})}),r}function ax(t,e){const r=see(t,e);return r?r.index:null}function see(t,e){const r=e.getImageIds(),n=e.getCurrentImageIdIndex();if(r.length===0)return null;const i=c=>{const l=cee(c);if(!l)return null;const f=ps(l.planeNormal,l.imagePositionPatient);return _h(f,t)},o={distance:i(r[n])??1/0,index:n},a=r.slice(n+1);for(let c=0;c<a.length;c++){const l=a[c],f=i(l);if(f!==null)if(f<=o.distance)o.distance=f,o.index=c+n+1;else break}const s=r.slice(0,n);for(let c=s.length-1;c>=0;c--){const l=s[c],f=i(l);if(!(f===null||f===o.distance))if(f<o.distance)o.distance=f,o.index=c;else break}return o.distance===1/0?null:o}function cee(t){const e=ut("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:r,columnCosines:n,imagePositionPatient:i}=e,o=co(Ie(),...r),a=co(Ie(),...n),s=nn(Ie(),o,a);return{rowCosines:r,columnCosines:n,imagePositionPatient:i,planeNormal:s}}function sx(t){const{width:e,height:r}=t.getCanvas(),{sliceToIndexMatrix:n,indexToSliceMatrix:i}=t.getSliceViewInfo(),o=pl(t,[0,0]),a=pl(t,[e-1,0]),s=pl(t,[0,r-1]),c=an(Ie(),a,o),l=an(Ie(),s,o),f=nn(Ie(),c,l);At(c,c),At(l,l),At(f,f);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),d=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!Yu(1,u)||!Yu(1,d))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:h}=t.getImageData(),g=t.getSliceViewInfo(),p=h.getSliceData(g);return{width:g.width,height:g.height,scalarData:p,sliceToIndexMatrix:n,indexToSliceMatrix:i}}const pu={},Oh={add:(t,e)=>{const[r,n]=t,i=`${r}_${n}`;pu[i]||(pu[i]={}),pu[i]=e},get:(t,e,r)=>{if(t!=="spatialRegistrationModule")return;const n=`${e}_${r}`;if(pu[n])return pu[n];const i=`${r}_${e}`;if(pu[i])return gr(Ti(),pu[i])}};L0(Oh.get.bind(Oh));const lee=.05;function P7(t,e){const r=t.getSliceIndex(),n=e.getSliceIndex(),i=ut("imagePlaneModule",r.toString()),o=ut("imagePlaneModule",n.toString());if(!i||!o){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:a}=o;if(!i.imageOrientationPatient.every((d,h)=>Math.abs(d-a[h])<lee)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i?.imageOrientationPatient,o?.imageOrientationPatient);return}const c=i.imagePositionPatient,l=o.imagePositionPatient,f=qt(Ie(),c,l),u=P0(Ti(),f);Oh.add([t.id,e.id],u)}function zm(t){const{imageData:e,dimensions:r}=t.getImageData()||{};if(!e||!r)return[];const{canvas:n}=t,i=window.devicePixelRatio,o=[0,0],a=[n.width/i,0],s=[n.width/i,n.height/i],c=[0,n.height/i],l=t.canvasToWorld(o),f=t.canvasToWorld(a),u=t.canvasToWorld(s),d=t.canvasToWorld(c),h=e.worldToIndex(l),g=e.worldToIndex(f),p=e.worldToIndex(u),m=e.worldToIndex(d);return uee({dimensions:r,imageData:e,topLeftImage:h,topRightImage:g,bottomRightImage:p,bottomLeftImage:m,topLeftWorld:l,topRightWorld:f,bottomRightWorld:u,bottomLeftWorld:d})}function uee({dimensions:t,imageData:e,topLeftImage:r,topRightImage:n,bottomRightImage:i,bottomLeftImage:o,topLeftWorld:a,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:l}){const f=up(r,t)?a:e.indexToWorld([0,0,0]),u=up(n,t)?s:e.indexToWorld([t[0]-1,0,0]),d=up(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),h=up(o,t)?l:e.indexToWorld([0,t[1]-1,0]);return[f,u,h,d]}function up(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function Ce(t){if(!t)return;const{viewportUid:e,renderingEngineUid:r}=t.dataset;return Ln(e,r)}function Ln(t,e){if(!e||!t)return;const r=Bn(e);if(!r||r.hasBeenDestroyed)return;const n=r.getViewport(t);if(!n)return;const i=n.getFrameOfReferenceUID();return{viewport:n,renderingEngine:r,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function xn(t){const e=Bi();for(let r=0;r<e.length;r++){const n=e[r];if(n.getViewport(t))return Ln(t,n.id)}}function R7(){const t=[];return Bi().forEach(r=>{r.getViewports().forEach(({element:i})=>{t.push(Ce(i))})}),t}function fee(t){const e=Ce(t);if(!e)return;const{viewport:r}=e;if(!(r instanceof qn))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${r.type}`);return r.getCornerstoneImage()}function Nl(t){if(!t.length)return!1;const e=t[0],{modality:r,seriesInstanceUID:n}=ut("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:c,usingDefaultValues:l}=ut("imagePlaneModule",e);if(l)return!1;const f={modality:r,imageOrientationPatient:i,pixelSpacing:o,columns:s,rows:c,seriesInstanceUID:n};let u=!0;for(let d=0;d<t.length;d++){const h=t[d],{modality:g,seriesInstanceUID:p}=ut("generalSeriesModule",h),{imageOrientationPatient:m,pixelSpacing:w,columns:v,rows:y}=ut("imagePlaneModule",h);if(p!==f.seriesInstanceUID){u=!1;break}if(g!==f.modality){u=!1;break}if(v!==f.columns){u=!1;break}if(y!==f.rows){u=!1;break}if(!Dt(m,f.imageOrientationPatient)){u=!1;break}if(!Dt(w,f.pixelSpacing)){u=!1;break}}return u}const dee=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function A7(t){return t?(Array.isArray(t)?t:[t]).find(r=>dee.has(r)):!1}async function hee({viewport:t,options:e={}}){const r=t.getRenderingEngine();let n=e.volumeId||`${un()}`;n.split(":").length===0&&(n=`${v9()}:${n}`);const{id:i,element:o}=t,a=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();r.enableElement({viewportId:a,type:Fn.ORTHOGRAPHIC,element:o,defaultOptions:{background:e.background,orientation:e.orientation}}),(await GC(n,{imageIds:s})).load();const u=r.getViewport(a);await Y9(r,[{volumeId:n}],[a]);const d=()=>{u.render(),o.removeEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,d)};return o.addEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,d),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function gee({viewport:t,options:e}){const r=t,{id:n,element:i}=r,o=t.getRenderingEngine(),{background:a}=e,s=e.viewportId||n,c=Ae.getVolume(r.getVolumeId());if(!(c instanceof lf))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:s,type:Fn.STACK,element:i,defaultOptions:{background:a}},f=r.getViewReference();o.enableElement(l);const u=o.getViewport(s);return await u.setStack(c.imageIds),u.setViewReference(f),u.render(),u}function Ht(t,e=2){if(Array.isArray(t))return t.map(i=>Ht(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const r=Math.abs(t);if(r<1e-4)return`${t}`;const n=r>=100?e-2:r>=10?e-1:r>=1?e:r>=.1?e+1:r>=.01?e+2:r>=.001?e+3:e+4;return t.toFixed(n)}function Cl(t){return Math.round(t/Po)*Po}function L7(t,e,r){const n=t.length===e*r*4,i=t.length===e*r*3;if(n||i){const o=new Float32Array(e*r);let a=0,s=0;const c=n?4:3;for(let l=0;l<e;l++)for(let f=0;f<r;f++){const u=t[a],d=t[a+1],h=t[a+2];o[s]=(u+d+h)/3,a+=c,s++}return o}else return t}function pee(t){if(t instanceof zn)return Ae.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function cx(t,e){const r=[...t];return e>=r.length?(E_(r),r):(E_(r),r.slice(0,e))}function E_(t){for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}}function Wv(t){const e=t.toString(16);return e.length==1?"0"+e:e}function mee(t,e,r){return"#"+Wv(t)+Wv(e)+Wv(r)}function vee(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const yee=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:vee,rgbToHex:mee},Symbol.toStringTag,{value:"Module"}));function N7(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(r){return console.debug("Error in JSON.stringify during deep comparison:",r),t===e}}function wee(t,e,r){if(!r)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!r?void 0:r(e).metadata.Modality;throw new Error("Invalid viewport type")}const Cee=(t,e)=>t.reduce((r,n)=>((r[n[e]]=r[n[e]]||[]).push(n),r),{});function xee(t){const e=t.map(a=>{const{imagePositionPatient:s}=ut("imagePlaneModule",a)||{};return{imageId:a,imagePositionPatient:s}});if(!e.every(a=>a.imagePositionPatient))return null;const r=Cee(e,"imagePositionPatient"),n=Object.keys(r),i=r[n[0]].length;return i===1||!n.every(a=>r[a].length===i)?null:r}function Tee(t,e){const r={};let n=[];const i=Object.keys(t);for(let o=0;o<i.length;o++){const a=new Set,s=t[i[o]];for(let c=0;c<s.length;c++){const l=e(s[c].imageId)||0;if(r[l]=r[l]||[],r[l].push({imageId:s[c].imageId}),a.add(l),a.size-1<c)return}if(o==0)n=Array.from(a);else if(!bee(n,a))return}return r}function dd(t,e){const r=ut(e,t);try{return parseFloat(r)}catch{return}}function See(t){const e=ut("20011003",t);try{const{InlineBinary:r}=e;if(r){const n=atob(r),i=new ArrayBuffer(n.length),o=new DataView(i);for(let a=0;a<n.length;a++)o.setUint8(a,n.charCodeAt(a));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function _ee(t){let e=ut("0019100c",t)||ut("0019100C",t);try{const{InlineBinary:r}=e;return r&&(e=atob(r)),parseFloat(e)}catch{return}}function Eee(t){let e=ut("00431039",t);try{const{InlineBinary:r}=e;return r&&(e=atob(r).split("//")),parseFloat(e[0])%1e5}catch{return}}function bee(t,e){if(t.length!=e.size)return!1;for(let r=0;r<t.length;r++)if(!e.has(t[r]))return!1;return!0}function Dee(t){const e=ut("petImageModule",t);return e?e.frameReferenceTime:0}function lx(t){const e=xee(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const r=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],n=[i=>dd(i,r[0]),i=>dd(i,r[1]),i=>dd(i,r[2]),i=>dd(i,r[3]),i=>dd(i,r[4]),See,_ee,Eee,Dee];for(let i=0;i<n.length;i++){const o=Tee(e,n[i]);if(o)return{imageIdGroups:Object.keys(o).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>o[c].map(l=>l.imageId)),splittingTag:r[i]}}return{imageIdGroups:[t],splittingTag:null}}function Iee(t){const{imageIdGroups:e,splittingTag:r}=lx(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:r}}function Mee(t,e){const r=t.length,{rescaleSlope:n,rescaleIntercept:i,suvbw:o}=e;if(e.modality==="PT"&&typeof o=="number")for(let a=0;a<r;a++)t[a]=o*(t[a]*n+i);else for(let a=0;a<r;a++)t[a]=t[a]*n+i;return t}function jm(t,e,r){return Math.min(Math.max(e,t),r)}function ef(t,e){if(!Ce(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof qn&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:o}=e;if(t instanceof zn)Oee(t,n,i,o);else{const a=t.getCurrentImageIdIndex();if(a+i>t.getImageIds().length-1||a+i<0){const s={imageIdIndex:a,direction:i};Xe(ke,Ge.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function Oee(t,e,r,n=!1){const i=n,{numScrollSteps:o,currentStepIndex:a,sliceRangeInfo:s}=Bu(t,e,i);if(o===0||!s)return;const{sliceRange:c,spacingInNormalDirection:l,camera:f}=s,{focalPoint:u,viewPlaneNormal:d,position:h}=f,{newFocalPoint:g,newPosition:p}=e0(u,h,c,d,l,r);t.setCamera({focalPoint:g,position:p}),t.render();const m=a+r,w={volumeId:e,viewport:t,delta:r,desiredStepIndex:m,currentStepIndex:a,numScrollSteps:o,currentImageId:t.getCurrentImageId()};(m>o||m<0)&&t.getCurrentImageId()?Xe(ke,Ge.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,w):Xe(ke,Ge.VOLUME_VIEWPORT_SCROLL,w)}async function ux(t,e={}){const{imageIndex:r,debounceLoading:n,volumeId:i}=e,o=Ce(t);if(!o)throw new Error("Element has been disabled");const{viewport:a}=o,{imageIndex:s,numberOfSlices:c}=Pee(a,n),f=Ree(c,r)-s;ef(a,{delta:f,debounceLoading:n,volumeId:i})}function Pee(t,e){return t instanceof qn?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function Ree(t,e){const r=t-1;return jm(e,0,r)}function fx(t,e,r={}){const n=Ae.getVolume(t);if(!n)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:o,direction:a,dimensions:s}=n,{minX:c,maxX:l,minY:f,maxY:u,minZ:d,maxZ:h}=e,g=[Math.min(c,l),Math.min(f,u),Math.min(d,h)],p=y0(n.imageData,g),m=[Math.abs(l-c)+1,Math.abs(u-f)+1,Math.abs(h-d)+1],{targetBuffer:w}=r,v={metadata:i,dimensions:m,spacing:o,origin:p,direction:a,targetBuffer:w,scalarData:w?.type==="Float32Array"?new Float32Array(m[0]*m[1]*m[2]):void 0},y=mg(un(),v),C=y.voxelManager.getCompleteScalarDataArray(),x=m[0]*m[1],T=s[0]*s[1],S=n.voxelManager.getCompleteScalarDataArray();for(let _=0;_<m[2];_++)for(let E=0;E<m[1];E++){const D=y0(y.imageData,[0,E,_]),b=Lr(n.imageData,D),I=b[2]*T+b[1]*s[0]+b[0],O=S.slice(I,I+m[0]),M=_*x+E*m[0];C.set(O,M)}return y.voxelManager.setCompleteScalarDataArray(C),y}function l2(t,e){const{viewUp:r,viewPlaneNormal:n}=e,i=Yp(t,[0,0,0]),o=Oa(Ie(),r),a=Oa(Ie(),n),s=nn(Ie(),o,a),c=an(Ie(),Yp(t,o),i),l=an(Ie(),Yp(t,a),i);At(c,c),At(l,l);const f=nn(Ie(),c,l);return{worldVecRowDir:s,worldVecColDir:o,worldVecSliceDir:a,ijkVecRowDir:f,ijkVecColDir:c,ijkVecSliceDir:l}}function V7(t,e,r,n){const[i,o,a]=e,s=i*o;let c=0,l=0,f=0;const[u,d,h]=r.map(Math.round);for(let w=h-n;w<=h+n;w++)if(!(w<0||w>=a)){for(let v=d-n;v<=d+n;v++)if(!(v<0||v>=o))for(let y=u-n;y<=u+n;y++){if(y<0||y>=i)continue;const C=w*s+v*i+y,x=t[C];c+=x,l+=x*x,f++}}if(f===0){const w=h*s+d*i+u;return w>=0&&w<t.length?{mean:t[w],stdDev:0,count:1}:{mean:0,stdDev:0,count:0}}const g=c/f,p=l/f-g*g,m=Math.sqrt(Math.max(0,p));return{mean:g,stdDev:m,count:f}}const Aee=new Set(["1.2.840.10008.5.1.4.1.1.1","1.2.840.10008.5.1.4.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.2","1.2.840.10008.5.1.4.1.1.1.2.1","1.2.840.10008.5.1.4.1.1.1.3","1.2.840.10008.5.1.4.1.1.1.3.1","1.2.840.10008.5.1.4.1.1.12.1","1.2.840.10008.5.1.4.1.1.12.1.1","1.2.840.10008.5.1.4.1.1.12.2","1.2.840.10008.5.1.4.1.1.12.2.1","1.2.840.10008.5.1.4.1.1.12.3"]);function k7(t){const{PixelSpacing:e,ImagerPixelSpacing:r,EstimatedRadiographicMagnificationFactor:n,DistanceSourceToDetector:i,DistanceSourceToPatient:o}=t;if(n)return n;if(o<i)return i/o;if(r?.[0]>e?.[0])return!0}function F7(t){const{PixelSpacing:e,ImagerPixelSpacing:r,PixelSpacingCalibrationType:n}=t,i=!0;if(e&&n==="GEOMETRY")return Dt(e,r)&&console.warn("Calibration type is geometry, but pixel spacing and imager pixel spacing identical",e,r),{PixelSpacing:e,type:xa.ERMF,isProjection:i};if(e&&n==="FIDUCIAL")return{PixelSpacing:e,type:xa.CALIBRATED,isProjection:i};if(r){const o=k7(t);return o>1?{PixelSpacing:r.map(s=>s/o),type:xa.ERMF,isProjection:i}:o===!0?{PixelSpacing:e,type:xa.ERMF,isProjection:i}:(o&&console.error("Illegal ERMF value:",o),{PixelSpacing:e||r,type:xa.PROJECTION,isProjection:i})}return{PixelSpacing:e,type:xa.UNKNOWN,isProjection:i}}function Lee(t){const{PixelSpacing:e,SOPClassUID:r}=t;return Aee.has(r)?F7(t):{PixelSpacing:e,type:xa.NOT_APPLICABLE,isProjection:!1}}const U7=(t,e)=>wee(t,e,Ae.getVolume),gn=Object.freeze(Object.defineProperty({__proto__:null,FrameRange:t0,HistoryMemo:ox,PointsManager:tm,ProgressiveIterator:km,RLEVoxelMap:Pf,VoxelManager:La,actorIsA:eo,applyPreset:b9,asArray:E5,autoLoad:p5,buildMetadata:F9,calculateNeighborhoodStats:V7,calculateRadiographicPixelSpacing:F7,calculateSpacingBetweenImageIds:a9,calculateViewportsSpatialRegistration:P7,calibratedPixelSpacingMetadataProvider:iee,clamp:C5,clip:jm,color:yee,colormap:CU,convertStackToVolumeViewport:hee,convertToGrayscale:L7,convertVolumeToStackViewport:gee,createLinearRGBTransferFunction:B9,createSigmoidRGBTransferFunction:cC,createSubVolume:fx,decimate:l9,deepClone:na,deepEqual:N7,deepMerge:jr,eventListener:JQ,fnv1aHash:W8,generateVolumePropsFromImageIds:hg,genericMetadataProvider:yl,getBufferConfiguration:AC,getClosestImageId:_c,getClosestStackImageIndexForPoint:ax,getCurrentVolumeViewportSlice:sx,getDynamicVolumeInfo:Iee,getERMF:k7,getImageDataMetadata:r2,getImageLegacy:fee,getImageSliceDataForVolumeViewport:Um,getMinMax:ix,getPixelSpacingInformation:Lee,getRandomSampleFromArray:cx,getRuntimeId:_7,getScalingParameters:s9,getSliceRange:n2,getSpacingInNormalDirection:Ll,getTargetVolumeAndSpacingInNormalDir:N0,getViewportImageCornersInWorld:zm,getViewportImageIds:pee,getViewportModality:U7,getViewportsWithImageURI:$m,getViewportsWithVolumeId:gg,getVoiFromSigmoidRGBTransferFunction:E9,getVolumeActorCorners:C9,getVolumeDirectionVectors:l2,getVolumeId:Ms,getVolumeSliceRangeInfo:_9,getVolumeViewportScrollInfo:Bu,getVolumeViewportsContainingSameVolumes:oee,hasFloatScalingParameters:FC,hasNaNValues:m5,imageIdToURI:cr,imageRetrieveMetadataProvider:m0,imageToWorldCoords:O7,indexWithinDimensions:Or,invertRgbTransferFunction:Gd,isEqual:Dt,isEqualAbs:qp,isEqualNegative:j8,isImageActor:ta,isNumber:fr,isOpposite:Ad,isPTPrescaledWithSUV:E7,isValidVolume:Nl,isVideoTransferSyntax:A7,jumpToSlice:ux,loadImageToCanvas:aee,logger:CJ,makeVolumeMetadata:o9,planar:OY,pointInShapeCallback:EC,renderToCanvasCPU:D7,renderToCanvasGPU:b7,roundNumber:Ht,roundToPrecision:Cl,scaleArray:Mee,scaleRgbTransferFunction:ZQ,scroll:ef,snapFocalPointToSlice:e0,sortImageIdsAndGetSpacing:kC,spatialRegistrationMetadataProvider:Oh,splitImageIdsBy4DTags:lx,transferFunctionUtils:SU,transformIndexToWorld:y0,transformWorldToIndex:Lr,transformWorldToIndexContinuous:Yp,triggerEvent:Xe,updatePlaneRestriction:S9,updateVTKImageDataWithCornerstoneImage:o2,uuidv4:un,windowLevel:TU,worldToImageCoords:b5},Symbol.toStringTag,{value:"Module"}));class B7 extends f9{constructor(e,r){super(e,r),this._dimensionGroupNumber=1,this._loadedDimensionGroups=new Set,this._getImageIdRequests=(o,a)=>this.getImageIdsRequests(o,a),this.getImageLoadRequests=o=>{const a=this.getImageIdsToLoad();return this._getImageIdRequests(a,o)};const{imageIdGroups:n,splittingTag:i}=e;this._splittingTag=i,this._imageIdGroups=n,this.numDimensionGroups=this._imageIdGroups.length}_getImageIdsToLoad(){const e=this._imageIdGroups,r=this._dimensionGroupNumber-1,n=[...e[r]];let i=r-1,o=r+1;for(;i>=0||o<e.length;)i>=0&&n.push(...e[i--]),o<e.length&&n.push(...e[o++]);return n}getImageIdsToLoad(){return this._getImageIdsToLoad()}get dimensionGroupNumber(){return this._dimensionGroupNumber}set dimensionGroupNumber(e){this._dimensionGroupNumber!==e&&(this._dimensionGroupNumber=e,this.voxelManager.setDimensionGroupNumber(e),this.invalidateVolume(!0),Xe(ke,Ge.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED,{volumeId:this.volumeId,dimensionGroupNumber:e,numDimensionGroups:this.numDimensionGroups,imageIdGroupIndex:e-1,numImageIdGroups:this.numDimensionGroups,splittingTag:this.splittingTag}))}scroll(e){const r=this._dimensionGroupNumber+e;r<1?this.dimensionGroupNumber=this.numDimensionGroups:r>this.numDimensionGroups?this.dimensionGroupNumber=1:this.dimensionGroupNumber=r}getCurrentDimensionGroupImageIds(){return this._imageIdGroups[this._dimensionGroupNumber-1]}flatImageIdIndexToDimensionGroupNumber(e){return Math.floor(e/this._imageIdGroups[0].length)+1}flatImageIdIndexToImageIdIndex(e){return e%this._imageIdGroups[0].length}get splittingTag(){return this._splittingTag}isDimensionGroupLoaded(e){return this._loadedDimensionGroups.has(e)}markDimensionGroupAsLoaded(e){this._loadedDimensionGroups.add(e),Xe(ke,Ge.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED,{volumeId:this.volumeId,dimensionGroupNumber:e})}checkDimensionGroupCompletion(e){const r=this.flatImageIdIndexToDimensionGroupNumber(e);this._imageIdGroups[r-1].every(o=>{const a=this.getImageIdIndex(o);return this.cachedFrames[a]===lo.FULL_RESOLUTION})&&!this.isDimensionGroupLoaded(r)&&this.markDimensionGroupAsLoaded(r)}}const F0=new bw("imageRetrievalPool");F0.setMaxSimultaneousRequests(Zt.Interaction,200);F0.setMaxSimultaneousRequests(Zt.Thumbnail,200);F0.setMaxSimultaneousRequests(Zt.Prefetch,200);F0.grabDelay=0;const b_=Symbol("DefaultSettings"),D_=Symbol("RuntimeSettings"),I_=Symbol("ObjectSettingsMap"),Qs=Symbol("Dictionary");class or{constructor(e){const r=Object.create(e instanceof or&&Qs in e?e[Qs]:null);Object.seal(Object.defineProperty(this,Qs,{value:r}))}set(e,r){return Hm(this[Qs],e,r,null)}get(e){return kee(this[Qs],e)}unset(e){return Nee(this[Qs],e+"")}forEach(e){M_(this[Qs],e)}extend(){return new or(this)}import(e){G7(e)&&Object.keys(e).forEach(r=>{Hm(this[Qs],r,e[r],null)})}dump(){const e={};return M_(this[Qs],(r,n)=>{typeof n<"u"&&W7(e,r,n)}),e}static assert(e){return e instanceof or?e:or.getRuntimeSettings()}static getDefaultSettings(e=null){let r=or[b_];if(r instanceof or||(r=new or,or[b_]=r),e){const n={};return r.forEach(i=>{if(i.startsWith(e)){const o=i.split(`${e}.`)[1];n[o]=r.get(i)}}),n}return r}static getRuntimeSettings(){let e=or[D_];return e instanceof or||(e=new or(or.getDefaultSettings()),or[D_]=e),e}static getObjectSettings(e,r){let n=null;if(e instanceof or)n=e;else if(typeof e=="object"&&e!==null){let i=or[I_];i instanceof WeakMap||(i=new WeakMap,or[I_]=i),n=i.get(e),n instanceof or||(n=new or(or.assert(or.getObjectSettings(r))),i.set(e,n))}return n}static extendRuntimeSettings(){return or.getRuntimeSettings().extend()}}function Nee(t,e){if(e.endsWith(".")){let r=0;const n=e,i=n.slice(0,-1),o=i.length===0;for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(o||a.startsWith(n)||a===i)&&(delete t[a],++r);return r>0}return delete t[e]}function M_(t,e){for(const r in t)e(r,t[r])}function Vee(t,e,r,n){let i;if(n.has(r))return Hm(t,e,null,n);n.add(r),i=0;for(const o in r)if(Object.prototype.hasOwnProperty.call(r,o)){const a=o.length===0?e:`${e}.${o}`;Hm(t,a,r[o],n)||++i}return n.delete(r),i===0}function Hm(t,e,r,n){return Fee(e)?G7(r)?Vee(t,e,r,n instanceof WeakSet?n:new WeakSet):(t[e]=r,!0):!1}function kee(t,e){return t[e]}function Fee(t){let e,r,n;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(n=-1;(r=t.indexOf(".",n+1))>=0;){if(r-n<2||r===e)return!1;n=r}return!0}function G7(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function W7(t,e,r){const n=e.indexOf(".");if(n>=0){const i=e.slice(0,n);let o=t[i];if(typeof o!="object"||o===null){const a=o;o={},typeof a<"u"&&(o[""]=a),t[i]=o}W7(o,e.slice(n+1,e.length),r)}else t[e]=r}or.getDefaultSettings().set("useCursors",!0);function sm(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Uee(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function $7(t){let e,r,n;t.length!==2?(e=sm,r=(s,c)=>sm(t(s),c),n=(s,c)=>t(s)-c):(e=t===sm||t===Uee?t:Bee,r=t,n=t);function i(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;r(s[u],c)<0?l=u+1:f=u}while(l<f)}return l}function o(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;r(s[u],c)<=0?l=u+1:f=u}while(l<f)}return l}function a(s,c,l=0,f=s.length){const u=i(s,c,l,f-1);return u>l&&n(s[u-1],c)>-n(s[u],c)?u-1:u}return{left:i,center:a,right:o}}function Bee(){return 0}function Gee(t){return t===null?NaN:+t}const Wee=$7(sm),$ee=Wee.right;$7(Gee).center;const zee=Math.sqrt(50),jee=Math.sqrt(10),Hee=Math.sqrt(2);function Km(t,e,r){const n=(e-t)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),a=o>=zee?10:o>=jee?5:o>=Hee?2:1;let s,c,l;return i<0?(l=Math.pow(10,-i)/a,s=Math.round(t*l),c=Math.round(e*l),s/l<t&&++s,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*a,s=Math.round(t/l),c=Math.round(e/l),s*l<t&&++s,c*l>e&&--c),c<s&&.5<=r&&r<2?Km(t,e,r*2):[s,c,l]}function Kee(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[i,o,a]=n?Km(e,t,r):Km(t,e,r);if(!(o>=i))return[];const s=o-i+1,c=new Array(s);if(n)if(a<0)for(let l=0;l<s;++l)c[l]=(o-l)/-a;else for(let l=0;l<s;++l)c[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)c[l]=(i+l)/-a;else for(let l=0;l<s;++l)c[l]=(i+l)*a;return c}function D5(t,e,r){return e=+e,t=+t,r=+r,Km(t,e,r)[2]}function Xee(t,e,r){e=+e,t=+t,r=+r;const n=e<t,i=n?D5(e,t,r):D5(t,e,r);return(n?-1:1)*(i<0?1/-i:i)}function qee(t,e){let r;if(e===void 0)for(const n of t)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of t)(i=e(i,++n,t))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function Yee(t){if(!(o=t.length))return[];for(var e=-1,r=qee(t,Jee),n=new Array(r);++e<r;)for(var i=-1,o,a=n[e]=new Array(o);++i<o;)a[i]=t[i][e];return n}function Jee(t){return t.length}function O_(){return Yee(arguments)}function Zee(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function dx(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function z7(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function xg(){}var Ph=.7,Xm=1/Ph,n0="\\s*([+-]?\\d+)\\s*",Rh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ms="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Qee=/^#([0-9a-f]{3,8})$/,ete=new RegExp(`^rgb\\(${n0},${n0},${n0}\\)$`),tte=new RegExp(`^rgb\\(${ms},${ms},${ms}\\)$`),nte=new RegExp(`^rgba\\(${n0},${n0},${n0},${Rh}\\)$`),rte=new RegExp(`^rgba\\(${ms},${ms},${ms},${Rh}\\)$`),ite=new RegExp(`^hsl\\(${Rh},${ms},${ms}\\)$`),ote=new RegExp(`^hsla\\(${Rh},${ms},${ms},${Rh}\\)$`),P_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};dx(xg,Ah,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:R_,formatHex:R_,formatHex8:ate,formatHsl:ste,formatRgb:A_,toString:A_});function R_(){return this.rgb().formatHex()}function ate(){return this.rgb().formatHex8()}function ste(){return j7(this).formatHsl()}function A_(){return this.rgb().formatRgb()}function Ah(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Qee.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?L_(e):r===3?new uo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?fp(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?fp(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ete.exec(t))?new uo(e[1],e[2],e[3],1):(e=tte.exec(t))?new uo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=nte.exec(t))?fp(e[1],e[2],e[3],e[4]):(e=rte.exec(t))?fp(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=ite.exec(t))?k_(e[1],e[2]/100,e[3]/100,1):(e=ote.exec(t))?k_(e[1],e[2]/100,e[3]/100,e[4]):P_.hasOwnProperty(t)?L_(P_[t]):t==="transparent"?new uo(NaN,NaN,NaN,0):null}function L_(t){return new uo(t>>16&255,t>>8&255,t&255,1)}function fp(t,e,r,n){return n<=0&&(t=e=r=NaN),new uo(t,e,r,n)}function cte(t){return t instanceof xg||(t=Ah(t)),t?(t=t.rgb(),new uo(t.r,t.g,t.b,t.opacity)):new uo}function I5(t,e,r,n){return arguments.length===1?cte(t):new uo(t,e,r,n??1)}function uo(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}dx(uo,I5,z7(xg,{brighter(t){return t=t==null?Xm:Math.pow(Xm,t),new uo(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Ph:Math.pow(Ph,t),new uo(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new uo(Gu(this.r),Gu(this.g),Gu(this.b),qm(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:N_,formatHex:N_,formatHex8:lte,formatRgb:V_,toString:V_}));function N_(){return`#${Nu(this.r)}${Nu(this.g)}${Nu(this.b)}`}function lte(){return`#${Nu(this.r)}${Nu(this.g)}${Nu(this.b)}${Nu((isNaN(this.opacity)?1:this.opacity)*255)}`}function V_(){const t=qm(this.opacity);return`${t===1?"rgb(":"rgba("}${Gu(this.r)}, ${Gu(this.g)}, ${Gu(this.b)}${t===1?")":`, ${t})`}`}function qm(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Gu(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Nu(t){return t=Gu(t),(t<16?"0":"")+t.toString(16)}function k_(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Sa(t,e,r,n)}function j7(t){if(t instanceof Sa)return new Sa(t.h,t.s,t.l,t.opacity);if(t instanceof xg||(t=Ah(t)),!t)return new Sa;if(t instanceof Sa)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),o=Math.max(e,r,n),a=NaN,s=o-i,c=(o+i)/2;return s?(e===o?a=(r-n)/s+(r<n)*6:r===o?a=(n-e)/s+2:a=(e-r)/s+4,s/=c<.5?o+i:2-o-i,a*=60):s=c>0&&c<1?0:a,new Sa(a,s,c,t.opacity)}function ute(t,e,r,n){return arguments.length===1?j7(t):new Sa(t,e,r,n??1)}function Sa(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}dx(Sa,ute,z7(xg,{brighter(t){return t=t==null?Xm:Math.pow(Xm,t),new Sa(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Ph:Math.pow(Ph,t),new Sa(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new uo($v(t>=240?t-240:t+120,i,n),$v(t,i,n),$v(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new Sa(F_(this.h),dp(this.s),dp(this.l),qm(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=qm(this.opacity);return`${t===1?"hsl(":"hsla("}${F_(this.h)}, ${dp(this.s)*100}%, ${dp(this.l)*100}%${t===1?")":`, ${t})`}`}}));function F_(t){return t=(t||0)%360,t<0?t+360:t}function dp(t){return Math.max(0,Math.min(1,t||0))}function $v(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}function fte(t,e,r,n,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*r+(1+3*t+3*o-3*a)*n+a*i)/6}function zv(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),i=t[n],o=t[n+1],a=n>0?t[n-1]:2*i-o,s=n<e-1?t[n+2]:2*o-i;return fte((r-n/e)*e,a,i,o,s)}}const hx=t=>()=>t;function dte(t,e){return function(r){return t+r*e}}function hte(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function gte(t){return(t=+t)==1?H7:function(e,r){return r-e?hte(e,r,t):hx(isNaN(e)?r:e)}}function H7(t,e){var r=e-t;return r?dte(t,r):hx(isNaN(t)?e:t)}const U_=(function t(e){var r=gte(e);function n(i,o){var a=r((i=I5(i)).r,(o=I5(o)).r),s=r(i.g,o.g),c=r(i.b,o.b),l=H7(i.opacity,o.opacity);return function(f){return i.r=a(f),i.g=s(f),i.b=c(f),i.opacity=l(f),i+""}}return n.gamma=t,n})(1);function pte(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=t[i]*(1-o)+e[i]*o;return n}}function mte(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function vte(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,i=new Array(n),o=new Array(r),a;for(a=0;a<n;++a)i[a]=gx(t[a],e[a]);for(;a<r;++a)o[a]=e[a];return function(s){for(a=0;a<n;++a)o[a]=i[a](s);return o}}function yte(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function Ym(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function wte(t,e){var r={},n={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?r[i]=gx(t[i],e[i]):n[i]=e[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var M5=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,jv=new RegExp(M5.source,"g");function Cte(t){return function(){return t}}function xte(t){return function(e){return t(e)+""}}function Tte(t,e){var r=M5.lastIndex=jv.lastIndex=0,n,i,o,a=-1,s=[],c=[];for(t=t+"",e=e+"";(n=M5.exec(t))&&(i=jv.exec(e));)(o=i.index)>r&&(o=e.slice(r,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,c.push({i:a,x:Ym(n,i)})),r=jv.lastIndex;return r<e.length&&(o=e.slice(r),s[a]?s[a]+=o:s[++a]=o),s.length<2?c[0]?xte(c[0].x):Cte(e):(e=c.length,function(l){for(var f=0,u;f<e;++f)s[(u=c[f]).i]=u.x(l);return s.join("")})}function gx(t,e){var r=typeof e,n;return e==null||r==="boolean"?hx(e):(r==="number"?Ym:r==="string"?(n=Ah(e))?(e=n,U_):Tte:e instanceof Ah?U_:e instanceof Date?yte:mte(e)?pte:Array.isArray(e)?vte:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?wte:Ym)(t,e)}function Ste(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function hd(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t(n/(e-1));return r}function _te(t){return function(){return t}}function Ete(t){return+t}var B_=[0,1];function Nf(t){return t}function O5(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:_te(isNaN(e)?NaN:.5)}function bte(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function Dte(t,e,r){var n=t[0],i=t[1],o=e[0],a=e[1];return i<n?(n=O5(i,n),o=r(a,o)):(n=O5(n,i),o=r(o,a)),function(s){return o(n(s))}}function Ite(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),o=new Array(n),a=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<n;)i[a]=O5(t[a],t[a+1]),o[a]=r(e[a],e[a+1]);return function(s){var c=$ee(t,s,1,n)-1;return o[c](i[c](s))}}function Mte(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ote(){var t=B_,e=B_,r=gx,n,i,o,a=Nf,s,c,l;function f(){var d=Math.min(t.length,e.length);return a!==Nf&&(a=bte(t[0],t[d-1])),s=d>2?Ite:Dte,c=l=null,u}function u(d){return d==null||isNaN(d=+d)?o:(c||(c=s(t.map(n),e,r)))(n(a(d)))}return u.invert=function(d){return a(i((l||(l=s(e,t.map(n),Ym)))(d)))},u.domain=function(d){return arguments.length?(t=Array.from(d,Ete),f()):t.slice()},u.range=function(d){return arguments.length?(e=Array.from(d),f()):e.slice()},u.rangeRound=function(d){return e=Array.from(d),r=Ste,f()},u.clamp=function(d){return arguments.length?(a=d?!0:Nf,f()):a!==Nf},u.interpolate=function(d){return arguments.length?(r=d,f()):r},u.unknown=function(d){return arguments.length?(o=d,u):o},function(d,h){return n=d,i=h,f()}}function Pte(){return Ote()(Nf,Nf)}function Rte(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Jm(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function x0(t){return t=Jm(Math.abs(t)),t?t[1]:NaN}function Ate(t,e){return function(r,n){for(var i=r.length,o=[],a=0,s=t[0],c=0;i>0&&s>0&&(c+s+1>n&&(s=Math.max(1,n-c)),o.push(r.substring(i-=s,i+s)),!((c+=s+1)>n));)s=t[a=(a+1)%t.length];return o.reverse().join(e)}}function Lte(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var Nte=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Zm(t){if(!(e=Nte.exec(t)))throw new Error("invalid format: "+t);var e;return new px({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Zm.prototype=px.prototype;function px(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}px.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Vte(t){e:for(var e=t.length,r=1,n=-1,i;r<e;++r)switch(t[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(i+1):t}var K7;function kte(t,e){var r=Jm(t,e);if(!r)return t+"";var n=r[0],i=r[1],o=i-(K7=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Jm(t,Math.max(0,e+o-1))[0]}function G_(t,e){var r=Jm(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const W_={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Rte,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>G_(t*100,e),r:G_,s:kte,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function $_(t){return t}var z_=Array.prototype.map,j_=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Fte(t){var e=t.grouping===void 0||t.thousands===void 0?$_:Ate(z_.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?$_:Lte(z_.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(u){u=Zm(u);var d=u.fill,h=u.align,g=u.sign,p=u.symbol,m=u.zero,w=u.width,v=u.comma,y=u.precision,C=u.trim,x=u.type;x==="n"?(v=!0,x="g"):W_[x]||(y===void 0&&(y=12),C=!0,x="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var T=p==="$"?r:p==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",S=p==="$"?n:/[%p]/.test(x)?a:"",_=W_[x],E=/[defgprs%]/.test(x);y=y===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function D(b){var I=T,O=S,M,R,A;if(x==="c")O=_(b)+O,b="";else{b=+b;var B=b<0||1/b<0;if(b=isNaN(b)?c:_(Math.abs(b),y),C&&(b=Vte(b)),B&&+b==0&&g!=="+"&&(B=!1),I=(B?g==="("?g:s:g==="-"||g==="("?"":g)+I,O=(x==="s"?j_[8+K7/3]:"")+O+(B&&g==="("?")":""),E){for(M=-1,R=b.length;++M<R;)if(A=b.charCodeAt(M),48>A||A>57){O=(A===46?i+b.slice(M+1):b.slice(M))+O,b=b.slice(0,M);break}}}v&&!m&&(b=e(b,1/0));var k=I.length+b.length+O.length,L=k<w?new Array(w-k+1).join(d):"";switch(v&&m&&(b=e(L+b,L.length?w-O.length:1/0),L=""),h){case"<":b=I+b+O+L;break;case"=":b=I+L+b+O;break;case"^":b=L.slice(0,k=L.length>>1)+I+b+O+L.slice(k);break;default:b=L+I+b+O;break}return o(b)}return D.toString=function(){return u+""},D}function f(u,d){var h=l((u=Zm(u),u.type="f",u)),g=Math.max(-8,Math.min(8,Math.floor(x0(d)/3)))*3,p=Math.pow(10,-g),m=j_[8+g/3];return function(w){return h(p*w)+m}}return{format:l,formatPrefix:f}}var hp,X7,q7;Ute({thousands:",",grouping:[3],currency:["$",""]});function Ute(t){return hp=Fte(t),X7=hp.format,q7=hp.formatPrefix,hp}function Bte(t){return Math.max(0,-x0(Math.abs(t)))}function Gte(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(x0(e)/3)))*3-x0(Math.abs(t)))}function Wte(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,x0(e)-x0(t))+1}function $te(t,e,r,n){var i=Xee(t,e,r),o;switch(n=Zm(n??",f"),n.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(o=Gte(i,a))&&(n.precision=o),q7(n,a)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=Wte(i,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=Bte(i))&&(n.precision=o-(n.type==="%")*2);break}}return X7(n)}function zte(t){var e=t.domain;return t.ticks=function(r){var n=e();return Kee(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var i=e();return $te(i[0],i[i.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),i=0,o=n.length-1,a=n[i],s=n[o],c,l,f=10;for(s<a&&(l=a,a=s,s=l,l=i,i=o,o=l);f-- >0;){if(l=D5(a,s,r),l===c)return n[i]=a,n[o]=s,e(n);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;c=l}return t},t}function mx(){var t=Pte();return t.copy=function(){return Mte(t,mx())},Zee.apply(t,arguments),zte(t)}function jte(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=r=>{e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.imageBitmap=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setImageBitmap=r=>{e.imageBitmap!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.jsImageData=null),e.imageBitmap=r,e.imageLoaded=!0,t.modified())},t.setCanvas=r=>{e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.imageBitmap=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=r=>{e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null,e.imageBitmap=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let r=0,n=0,i=1;if(t.getInputData()){const a=t.getInputData();r=a.getDimensions()[0],n=a.getDimensions()[1],i=a.getDimensions()[2]}return e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height),e.imageBitmap&&(r=e.imageBitmap.width,n=e.imageBitmap.height),(r>1)+(n>1)+(i>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData;if(e.imageBitmap)return e.imageBitmap;if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const r=e.image.width,n=e.image.height,o=new OffscreenCanvas(r,n).getContext("2d");return o.translate(0,n),o.scale(1,-1),o.drawImage(e.image,0,0,r,n),o.getImageData(0,0,r,n)}return null}}const Hte=(t,e,r)=>{const i=t.createShaderModule({code:`
    @group(0) @binding(0) var inputTexture: texture_2d<f32>;
    @group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;

    @compute @workgroup_size(8, 8)
    fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
      let texelCoord = vec2<i32>(global_id.xy);
      let outputSize = textureDimensions(outputTexture);

      if (texelCoord.x >= i32(outputSize.x) || texelCoord.y >= i32(outputSize.y)) {
        return;
      }

      let inputSize = textureDimensions(inputTexture);
      let scale = vec2<f32>(inputSize) / vec2<f32>(outputSize);

      // Compute the floating-point source coordinate
      let srcCoord = (vec2<f32>(texelCoord) + 0.5) * scale - 0.5;

      // Get integer coordinates for the four surrounding texels
      let x0 = i32(floor(srcCoord.x));
      let x1 = min(x0 + 1, i32(inputSize.x) - 1);
      let y0 = i32(floor(srcCoord.y));
      let y1 = min(y0 + 1, i32(inputSize.y) - 1);

      // Compute the weights
      let wx = srcCoord.x - f32(x0);
      let wy = srcCoord.y - f32(y0);

      // Fetch the four texels
      let c00 = textureLoad(inputTexture, vec2<i32>(x0, y0), 0);
      let c10 = textureLoad(inputTexture, vec2<i32>(x1, y0), 0);
      let c01 = textureLoad(inputTexture, vec2<i32>(x0, y1), 0);
      let c11 = textureLoad(inputTexture, vec2<i32>(x1, y1), 0);

      // Bilinear interpolation
      let color = mix(
        mix(c00, c10, wx),
        mix(c01, c11, wx),
        wy
      );

      textureStore(outputTexture, texelCoord, color);
    }
  `}),o=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm",access:"write-only"}},{binding:2,visibility:GPUShaderStage.COMPUTE,sampler:{type:"filtering"}}]}),a=t.createPipelineLayout({bindGroupLayouts:[o]}),s=t.createComputePipeline({label:"ComputeMipmapPipeline",layout:a,compute:{module:i,entryPoint:"main"}}),c=t.createSampler({magFilter:"linear",minFilter:"linear"});for(let l=1;l<r;l++){const f=e.createView({baseMipLevel:l-1,mipLevelCount:1}),u=e.createView({baseMipLevel:l,mipLevelCount:1}),d=t.createBindGroup({layout:s.getBindGroupLayout(0),entries:[{binding:0,resource:f},{binding:1,resource:u},{binding:2,resource:c}]}),h=t.createCommandEncoder({label:"MipmapGenerateCommandEncoder"}),g=h.beginComputePass();g.setPipeline(s),g.setBindGroup(0,d);const p=Math.max(1,e.width>>l),m=Math.max(1,e.height>>l),w=Math.ceil(p/8),v=Math.ceil(m/8);g.dispatchWorkgroups(w,v),g.end(),t.queue.submit([h.finish()])}},Kte={image:null,canvas:null,jsImageData:null,imageBitmap:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function Y7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kte,r),K.obj(t,e),K.algo(t,e,6,0),K.get(t,e,["canvas","image","jsImageData","imageBitmap","imageLoaded","resizable"]),K.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),jte(t,e)}const Xte=K.newInstance(Y7,"vtkTexture"),qte={generateMipmaps:Hte};var Ol={newInstance:Xte,extend:Y7,...qte};const Yte=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],H_=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],gp=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],K_=[0,1,0,1,0,1,0,1,2,2,2,2],hr=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],on=new Float64Array(3),pp=new Float64Array(3),jn=new Float64Array(3),Iu=new Float64Array(3),mu=new Float64Array(3),mp=new Float64Array(3),Hv=new Float64Array(16);function Kv(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function J7(t){const e=[],r=[];for(let n=0;n<3;n++){const i=mx().domain([t[n*2],t[n*2+1]]);e[n]=i.ticks(5);const o=i.tickFormat(5);r[n]=e[n].map(o)}return{ticks:e,tickStrings:r}}function Jte(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=r=>{e.renderable!==r&&(e.renderable=r,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(r.getProperty()),e.tmActor.setParentProp(r),t.modified())},t.createPolyDataForOneLabel=(r,n,i,o,a,s,c)=>{const l=e.renderable.get_tmAtlas().get(r);if(!l)return;const f=e.renderable.getTextPolyData().getPoints().getData(),u=e.lastSize;on[0]=f[n*3],on[1]=f[n*3+1],on[2]=f[n*3+2],Pt(jn,on,i),jn[0]+=.1,Pt(pp,jn,o),qt(mu,pp,on),jn[0]-=.1,jn[1]+=.1,Pt(pp,jn,o),qt(mp,pp,on);for(let g=0;g<3;g++)mu[g]/=.5*.1*u[0],mp[g]/=.5*.1*u[1];let d=c.ptIdx,h=c.cellIdx;on[0]=f[n*3],on[1]=f[n*3+1],on[2]=f[n*3+2],a[0]<-.5?Jn(jn,mu,a[0]*s-l.width):a[0]>.5?Jn(jn,mu,a[0]*s):Jn(jn,mu,a[0]*s-l.width/2),nr(on,on,jn),Jn(jn,mp,a[1]*s-l.height/2),nr(on,on,jn),c.points[d*3]=on[0],c.points[d*3+1]=on[1],c.points[d*3+2]=on[2],c.tcoords[d*2]=l.tcoords[0],c.tcoords[d*2+1]=l.tcoords[1],d++,Jn(jn,mu,l.width),nr(on,on,jn),c.points[d*3]=on[0],c.points[d*3+1]=on[1],c.points[d*3+2]=on[2],c.tcoords[d*2]=l.tcoords[2],c.tcoords[d*2+1]=l.tcoords[3],d++,Jn(jn,mp,l.height),nr(on,on,jn),c.points[d*3]=on[0],c.points[d*3+1]=on[1],c.points[d*3+2]=on[2],c.tcoords[d*2]=l.tcoords[4],c.tcoords[d*2+1]=l.tcoords[5],d++,Jn(jn,mu,l.width),qt(on,on,jn),c.points[d*3]=on[0],c.points[d*3+1]=on[1],c.points[d*3+2]=on[2],c.tcoords[d*2]=l.tcoords[6],c.tcoords[d*2+1]=l.tcoords[7],d++,c.polys[h*4]=3,c.polys[h*4+1]=d-4,c.polys[h*4+2]=d-3,c.polys[h*4+3]=d-2,h++,c.polys[h*4]=3,c.polys[h*4+1]=d-4,c.polys[h*4+2]=d-2,c.polys[h*4+3]=d-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const r=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);mn(r,r);const n=e.renderable.getTextValues().length,i=n*4,o=n*2,a=new Float64Array(i*3),s=new Uint16Array(o*4),c=new Float32Array(i*2);gr(Hv,r);const l={ptIdx:0,cellIdx:0,polys:s,points:a,tcoords:c};let f=0,u=0,d=0;const h=e.renderable.getTextPolyData().getPoints().getData(),g=e.renderable.getTextValues();for(;f<h.length/3;){on[0]=h[f*3],on[1]=h[f*3+1],on[2]=h[f*3+2],Pt(jn,on,r),on[0]=h[f*3+3],on[1]=h[f*3+4],on[2]=h[f*3+5],Pt(Iu,on,r),qt(jn,jn,Iu);const m=[jn[0],jn[1]];i8(m),t.createPolyDataForOneLabel(g[u],f,r,Hv,m,e.renderable.getAxisTitlePixelOffset(),l),f+=2,u++;for(let w=0;w<e.renderable.getTickCounts()[d];w++)t.createPolyDataForOneLabel(g[u],f,r,Hv,m,e.renderable.getTickLabelPixelOffset(),l),f++,u++;d++}const p=Tt.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(p),e.tmPolyData.getPoints().setData(a,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(s,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(r,n,i)=>{(e.lastSize[0]!==r[0]||e.lastSize[1]!==r[1])&&(e.lastSize[0]=r[0],e.lastSize[1]=r[1],e.lastAspectRatio=r[0]/r[1],e.forceUpdate=!0),e.camera=n,t.updateTexturePolyData()}}const Zte=K.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),K.obj(t,e),e.tmPolyData=rr.newInstance(),e.tmMapper=Ui.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=Lo.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),K.setGet(t,e,["renderable"]),K.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},K.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},K.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],Jte(t,e)},"vtkCubeAxesActorHelper");function Qte(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=n=>{e.camera!==n&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=n,n&&(e.cameraModifiedSub=n.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const n=e.camera.getViewMatrix();mn(n,n);let i=!1;const o=hn.getDiagonalLength(e.dataBounds),a=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let s=0;s<6;s++){let c=!1;const l=Math.floor(s/2),f=(l+1)%3,u=(l+2)%3;e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&e.dataBounds[u*2]!==e.dataBounds[u*2+1]&&(on[l]=e.dataBounds[s]-.1*o*Yte[s][l],on[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),on[u]=.5*(e.dataBounds[u*2]+e.dataBounds[u*2+1]),Pt(jn,on,n),on[l]=e.dataBounds[s],Pt(Iu,on,n),qt(jn,Iu,jn),At(jn,jn),c=jn[2]>a,e.camera.getParallelProjection()||(At(Iu,Iu),c=ft(Iu,jn)>a)),c!==e.lastFacesToDraw[s]&&(e.lastFacesToDraw[s]=c,i=!0)}return i},t.updatePolyData=(n,i,o)=>{let a=0,s=0;a+=8;let c=0;for(let h=0;h<12;h++)i[h]>0&&c++;if(s+=c,e.gridLines)for(let h=0;h<6;h++)n[h]&&(a+=o[hr[h][0]].length*2+o[hr[h][1]].length*2,s+=o[hr[h][0]].length+o[hr[h][1]].length);const l=new Float64Array(a*3),f=new Uint32Array(s*3);let u=0,d=0;for(let h=0;h<2;h++)for(let g=0;g<2;g++)for(let p=0;p<2;p++)l[u*3]=e.dataBounds[p],l[u*3+1]=e.dataBounds[2+g],l[u*3+2]=e.dataBounds[4+h],u++;for(let h=0;h<12;h++)i[h]>0&&(f[d*3]=2,f[d*3+1]=gp[h][0],f[d*3+2]=gp[h][1],d++);if(e.gridLines){for(let h=0;h<6;h++)if(n[h]){const g=Math.floor(h/2);let p=o[hr[h][0]];for(let m=0;m<p.length;m++)l[u*3+g]=e.dataBounds[h],l[u*3+hr[h][0]]=p[m],l[u*3+hr[h][1]]=e.dataBounds[hr[h][1]*2],u++,l[u*3+g]=e.dataBounds[h],l[u*3+hr[h][0]]=p[m],l[u*3+hr[h][1]]=e.dataBounds[hr[h][1]*2+1],u++,f[d*3]=2,f[d*3+1]=u-2,f[d*3+2]=u-1,d++;p=o[hr[h][1]];for(let m=0;m<p.length;m++)l[u*3+g]=e.dataBounds[h],l[u*3+hr[h][1]]=p[m],l[u*3+hr[h][0]]=e.dataBounds[hr[h][0]*2],u++,l[u*3+g]=e.dataBounds[h],l[u*3+hr[h][1]]=p[m],l[u*3+hr[h][0]]=e.dataBounds[hr[h][0]*2+1],u++,f[d*3]=2,f[d*3+1]=u-2,f[d*3+2]=u-1,d++}}e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(f,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(n,i,o,a)=>{let s=0;for(let h=0;h<12;h++)i[h]===1&&(s+=2,s+=o[K_[h]].length);const c=e.polyData.getPoints().getData(),l=new Float64Array(s*3);let f=0,u=0,d=0;for(let h=0;h<6;h++)if(n[h])for(let g=0;g<4;g++){const p=H_[h][g];if(i[p]===1){const m=K_[p],w=gp[p][0]*3,v=gp[p][1]*3;l[f*3]=.5*(c[w]+c[v]),l[f*3+1]=.5*(c[w+1]+c[v+1]),l[f*3+2]=.5*(c[w+2]+c[v+2]),f++;const y=Math.floor(h/2);l[f*3+y]=e.dataBounds[h],l[f*3+hr[h][0]]=.5*(e.dataBounds[hr[h][0]*2]+e.dataBounds[hr[h][0]*2+1]),l[f*3+hr[h][1]]=.5*(e.dataBounds[hr[h][1]*2]+e.dataBounds[hr[h][1]*2+1]),f++,e.textValues[u]=e.axisLabels[m],u++;const C=(m+1)%3,x=(m+2)%3,T=o[m],S=a[m];e.tickCounts[d]=T.length;for(let _=0;_<T.length;_++)l[f*3+m]=T[_],l[f*3+C]=c[w+C],l[f*3+x]=c[w+x],f++,e.textValues[u]=S[_],u++;d++}}e.textPolyData.getPoints().setData(l,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const n=t.computeFacesToDraw(),i=e.lastFacesToDraw;let o=!1;for(let a=0;a<6;a++)e.dataBounds[a]!==e.lastTickBounds[a]&&(o=!0,e.lastTickBounds[a]=e.dataBounds[a]);if(n||o||e.forceUpdate){const a=new Array(12).fill(0);for(let c=0;c<6;c++)if(i[c])for(let l=0;l<4;l++)a[H_[c][l]]++;const s=e.generateTicks(e.dataBounds);t.updatePolyData(i,a,s.ticks),t.updateTextData(i,a,s.ticks,s.tickStrings),(o||e.forceUpdate)&&t.updateTextureAtlas(s.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=n=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let i=0,o=1;for(let a=0;a<3;a++){if(!e._tmAtlas.has(e.axisLabels[a])){Kv(e.tmContext,e.axisTextStyle);const s=e.tmContext.measureText(e.axisLabels[a]),c={height:s.actualBoundingBoxAscent+2,startingHeight:o,width:s.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[a],c),o+=c.height,i<c.width&&(i=c.width)}Kv(e.tmContext,e.tickTextStyle);for(let s=0;s<n[a].length;s++)if(!e._tmAtlas.has(n[a][s])){const c=e.tmContext.measureText(n[a][s]),l={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(n[a][s],l),o+=l.height,i<l.width&&(i=l.width)}}i=Zo(i),o=Zo(o),e._tmAtlas.forEach(a=>{a.tcoords=[0,(o-a.startingHeight-a.height)/o,a.width/i,(o-a.startingHeight-a.height)/o,a.width/i,(o-a.startingHeight)/o,0,(o-a.startingHeight)/o]}),e.tmCanvas.width=i,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,o),e._tmAtlas.forEach((a,s)=>{Kv(e.tmContext,a.textStyle),e.tmContext.fillText(s,1,a.startingHeight+a.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),hn.setBounds(e.bounds,e.gridActor.getBounds()),hn.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const r=K.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=n=>r(n)[0]}function ene(t,e,r){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...hn.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:J7,...r,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...r?.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...r?.tickTextStyle}}}function Z7(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Lo.extend(t,e,ene(t,e,r)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=Ol.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=Ui.newInstance(),e.polyData=rr.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=Lo.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=rr.newInstance(),K.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),K.setGetArray(t,e,["dataBounds"],6),K.setGetArray(t,e,["axisLabels"],3),K.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),Qte(t,e)}const tne=K.newInstance(Z7,"vtkCubeAxesActor");var Q7={newInstance:tne,extend:Z7,newCubeAxesActorHelper:Zte,defaultGenerateTicks:J7};function nne(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e._openGLRenderWindow.getRenderable())}}}const rne={};function ine(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rne,r),Yn.extend(t,e,r),e.CubeAxesActorHelper=Q7.newCubeAxesActorHelper(),nne(t,e)}const one=On(ine,"vtkOpenGLCubeAxesActor");Vr("vtkCubeAxesActor",one);var ane=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,sne=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const eM={BACKGROUND:0,FOREGROUND:1};var tM={DisplayLocation:eM};const{primTypes:wa}=Fa,{Filter:X_,Wrap:q_}=Kn,{vtkErrorMacro:gd}=_i,cne={type:"StartEvent"},lne={type:"EndEvent"};function une(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=n=>{n&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=n=>{n&&t.render()},t.getShaderTemplate=(n,i,o)=>{n.Vertex=sne,n.Fragment=ane,n.Geometry=""},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let a=wa.Start;a<wa.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor2D.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.renderPiece=(n,i)=>{if(t.invokeEvent(cne),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(lne),!e.currentInput){gd("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context;e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.renderPieceStart=(n,i)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(i)}e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),t.updateBufferObjects(n,i),e.lastBoundBO=null},t.getNeedToRebuildShaders=(n,i,o)=>n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i)},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return!!(o<t.getMTime()||o<e._openGLRenderWindow.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&o<n.getMTime())},t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,i.getProperty().getOpacity());const a=e.renderable.getColorMapColors(),s=i.getProperty().getRepresentation();let c=o.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(c=null);let l=!1;if(e.renderable.getColorCoordinates()){c=e.renderable.getColorCoordinates(),l=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Kn.newInstance({resizable:!0}));const g=e.internalColorTexture;g.setMinificationFilter(X_.NEAREST),g.setMagnificationFilter(X_.NEAREST),g.setWrapS(q_.CLAMP_TO_EDGE),g.setWrapT(q_.CLAMP_TO_EDGE),g.setOpenGLRenderWindow(e._openGLRenderWindow);const p=e.renderable.getColorTextureMap(),m=p.getExtent(),w=p.getPointData().getScalars();g.create2DFromRaw({width:m[1]-m[0]+1,height:m[3]-m[2]+1,numComps:w.getNumberOfComponents(),dataType:w.getDataType(),data:w.getData()}),g.activate(),g.sendParameters(),g.deactivate()}const f=e.renderable.getTransformCoordinate(),d=n.getRenderWindow().getViews()[0].getViewportSize(n),h=`${o.getMTime()}A${s}B${o.getMTime()}C${a?a.getMTime():1}D${c?c.getMTime():1}E${f?n.getMTime():1}F${d}`;if(e.VBOBuildString!==h){let g=o.getPoints();if(f){const m=Ju.newInstance(),w=g.getNumberOfPoints();m.setNumberOfPoints(w);const v=[];for(let y=0;y<w;++y){g.getPoint(y,v),f.setValue(v);const C=f.getComputedDoubleViewportValue(n);m.setPoint(y,C[0],C[1],0)}g=m}const p={points:g,tcoords:c,colors:a,cellOffset:0,useTCoordsPerCell:l,haveCellScalars:e.renderable.getAreScalarsMappedFromCells(),customAttributes:e.renderable.getCustomShaderAttributes().map(m=>o.getPointData().getArrayByName(m))};p.cellOffset+=e.primitives[wa.Points].getCABO().createVBO(o.getVerts(),"verts",s,p),p.cellOffset+=e.primitives[wa.Lines].getCABO().createVBO(o.getLines(),"lines",s,p),p.cellOffset+=e.primitives[wa.Tris].getCABO().createVBO(o.getPolys(),"polys",s,p),p.cellOffset+=e.primitives[wa.TriStrips].getCABO().createVBO(o.getStrips(),"strips",s,p),e.VBOBuildTime.modified(),e.VBOBuildString=h}},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation();e.context.depthMask(!0);for(let s=wa.Start;s<wa.End;s++)e.primitives[s].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[s],e.primitiveIDOffset+=e.primitives[s].drawArrays(n,i,o,t))},t.renderPieceFinish=(n,i)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.replaceShaderValues=(n,i,o)=>{t.replaceShaderColor(n,i,o),t.replaceShaderTCoord(n,i,o),t.replaceShaderPicking(n,i,o),t.replaceShaderPositionVC(n,i,o)},t.replaceShaderColor=(n,i,o)=>{let a=n.Vertex,s=n.Geometry,c=n.Fragment,l=["uniform vec3 diffuseColorUniform;","uniform float opacityUniform;"],f=["vec3 diffuseColor = diffuseColorUniform;","float opacity = opacityUniform;"];e.lastBoundBO.getCABO().getColorComponents()!==0?(l=l.concat(["varying vec4 vertexColorVSOutput;"]),a=Oe.substitute(a,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,a=Oe.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=Oe.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Oe.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,c=Oe.substitute(c,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result):e.renderable.getAreScalarsMappedFromCells()&&(f=f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  opacity = opacity*texColor.a;"])),f=f.concat(["gl_FragData[0] = vec4(diffuseColor, opacity);"]),c=Oe.substitute(c,"//VTK::Color::Dec",l).result,c=Oe.substitute(c,"//VTK::Color::Impl",f).result,n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderTCoord=(n,i,o)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getCABO().getTCoordComponents();l===1?(a=Oe.substitute(a,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,a=Oe.substitute(a,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=Oe.substitute(s,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,s=Oe.substitute(s,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=Oe.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=Oe.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):l===2&&(a=Oe.substitute(a,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,a=Oe.substitute(a,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=Oe.substitute(s,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,s=Oe.substitute(s,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=Oe.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=Oe.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.renderable.getAreScalarsMappedFromCells()&&(s=Oe.substitute(s,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),n.Vertex=a,n.Geometry=s,n.Fragment=c}},t.replaceShaderPicking=(n,i,o)=>{let a=n.Fragment;a=Oe.substitute(a,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,a=Oe.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,n.Fragment=a},t.replaceShaderPositionVC=(n,i,o)=>{e.lastBoundBO.replaceShaderPositionVC(n,i,o)},t.invokeShaderCallbacks=(n,i,o)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(s=>{s.callback(s.userData,n,i,o)})},t.setMapperShaderParameters=(n,i,o)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||gd("Error setting vertexWC in shader VAO.")),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,l)=>{n.getProgram().isAttributeUsed(`${c}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${c}MC`,n.getCABO().getCustomData()[l].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[l].components,!1)||gd(`Error setting ${c}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||gd("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||gd("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&e.internalColorTexture.getTextureUnit()>-1&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor2D.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const f=a[c].getTextureUnit(),u=`texture${f+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,f)}n.setMapperShaderParameters(i,o,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(n,i,o)=>{const a=e.renderable.getColorMapColors();if(!a||a.getNumberOfComponents()===0){const s=n.getProgram(),c=o.getProperty(),l=c.getOpacity();s.setUniformf("opacityUniform",l);const f=c.getColor();s.setUniform3fArray("diffuseColorUniform",f)}},t.setLightingShaderParameters=(n,i,o)=>{};function r(n,i,o){return i.identity(o),n.reduce((a,s,c)=>c===0?s?i.copy(a,s):i.identity(a):s?i.multiply(a,a,s):a,o)}t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),c=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,f=i.getRenderWindow().getViews()[0].getViewportSize(i),u=i.getViewport(),d=o.getActualPositionCoordinate().getComputedDoubleViewportValue(i),h=[0,0,1,1],g=[0,0,1,1];if(g[0]=u[0]>=h[0]?u[0]:h[0],g[1]=u[1]>=h[1]?u[1]:h[1],g[2]=u[2]<=h[2]?u[2]:h[2],g[3]=u[3]<=h[3]?u[3]:h[3],g[0]>=g[2]||g[1]>=g[3])return;f[0]=Td(f[0]*(g[2]-g[0])/(u[2]-u[0])),f[1]=Td(f[1]*(g[3]-g[1])/(u[3]-u[1]));const p=e._openGLRenderer.getParent().getSize(),m=Td(d[0]-(g[0]-u[0])*p[0]),w=Td(d[1]-(g[1]-u[1])*p[1]),v=-m;let y=-m+f[0];const C=-w;let x=-w+f[1];v===y&&(y=v+1),C===x&&(x=C+1);const T=_t(new Float64Array(16));T[0]=2/(y-v),T[5]=2/(x-C),T[3]=-1*(y+v)/(y-v),T[7]=-1*(x+C)/(x-C),T[10]=0,T[11]=o.getProperty().getDisplayLocation()===eM.FOREGROUND?-1:1,T[15]=1,mn(T,T),a.setUniformMatrix("WCVCMatrix",r([T,c],vh,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(i=>{n+=i.getAllocatedGPUMemoryInBytes()}),n}}const fne={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function dne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fne,r),Yn.extend(t,e,r),Cs.implementReplaceShaderCoincidentOffset(t,e,r),Cs.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=wa,e.tmpMat4=_t(new Float64Array(16));for(let n=wa.Start;n<wa.End;n++)e.primitives[n]=Fa.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Er(t,e,["context"]),e.VBOBuildTime={},Zn(e.VBOBuildTime,{mtime:0}),une(t,e)}const hne=On(dne,"vtkOpenGLPolyDataMapper2D");Vr("vtkMapper2D",hne);const gne={HORIZONTAL:"horizontal",VERTICAL:"vertical",AUTO:"auto"};var nM={Orientation:gne};const{VectorMode:pne}=G1,{Orientation:Qm}=nM;function Xv(t,e,r){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor;const n=e.fontSize??r;t.font=`${e.fontStyle} ${n}px ${e.fontFamily}`}function rM(t,e){return r=>{const n=r.getLastSize(),i=(n[0]/700)**.8,o=(n[1]/700)**.8,a=Math.min(i,o),s=r.getAxisTextStyle(),c=r.getTickTextStyle();Object.assign(s,e.axisTextStyle),Object.assign(c,e.tickTextStyle),s.fontSize===void 0&&(s.fontSize=Math.max(24*a,12)),c.fontSize===void 0&&(r.getLastAspectRatio()>1?c.fontSize=Math.max(20*a,10):c.fontSize=Math.max(16*a,10));const l=r.updateTextureAtlas();r.setTopTitle(!1);const f=r.getBoxSizeByReference();let u=!1;if(e.orientation===Qm.VERTICAL?u=!0:e.orientation===Qm.HORIZONTAL?u=!1:u=r.getLastAspectRatio()>1,u)r.setTickLabelPixelOffset(.3*c.fontSize),l.titleWidth<=l.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize?(r.setTopTitle(!0),r.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.98-f[0],-.92])):(r.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.titleHeight+r.getAxisTitlePixelOffset()+l.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.99-f[0],-.92])),f[1]=Math.max(1.2,Math.min(1.84/o,1.84));else{r.setAxisTitlePixelOffset(1.2*c.fontSize),r.setTickLabelPixelOffset(.1*c.fontSize);const d=2*(.8*c.fontSize+l.titleHeight+r.getAxisTitlePixelOffset())/n[1],h=2*l.tickWidth/n[0];f[0]=Math.min(1.9,Math.max(1.4,1.4*h*(r.getTicks().length+3))),f[1]=d,r.setBoxPosition([-.5*f[0],-.97])}r.recomputeBarSegments(l)}}function iM(t,e){return r=>{const n=r.getLastTickBounds(),i=mx().domain([n[0],n[1]]),o=i.ticks(5),a=i.tickFormat(5);r.setTicks(o),r.setTickStrings(o.map(a))}}function mne(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=i=>{e.renderable!==i&&(e.renderable=i,e.barActor.setProperty(i.getProperty()),e.barActor.setParentProp(i),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(i.getProperty()),e.tmActor.setParentProp(i),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=i.generateTicks,e.axisTextStyle={...i.getAxisTextStyle()},e.tickTextStyle={...i.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(i,o,a)=>{(e.lastSize[0]!==i[0]||e.lastSize[1]!==i[1])&&(e.lastSize[0]=i[0],e.lastSize[1]=i[1],e.lastAspectRatio=i[0]/i[1],e.forceUpdate=!0);const s=e.renderable.getScalarsToColors();if(!(!s||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(s),e.camera=o,e.renderWindow=a,e.forceUpdate||Math.max(s.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=s.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const l=t.updateTextureAtlas();t.recomputeBarSegments(l)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const i={},o=new Map;let a=0,s=1;Xv(e.tmContext,e.axisTextStyle,18);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.axisTextStyle};o.set(e.renderable.getAxisLabel(),l),s+=l.height,a=l.width,i.titleWidth=l.width,i.titleHeight=l.height,i.tickWidth=0,i.tickHeight=0,Xv(e.tmContext,e.tickTextStyle,14);const f=[...t.getTickStrings(),"NaN","Below","Above"];for(let u=0;u<f.length;u++)o.has(f[u])||(c=e.tmContext.measureText(f[u]),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle},o.set(f[u],l),s+=l.height,a<l.width&&(a=l.width),i.tickWidth<l.width&&(i.tickWidth=l.width),i.tickHeight<l.height&&(i.tickHeight=l.height));return a=Zo(a),s=Zo(s),o.forEach(u=>{u.tcoords=[0,(s-u.startingHeight-u.height)/s,u.width/a,(s-u.startingHeight-u.height)/s,u.width/a,(s-u.startingHeight)/s,0,(s-u.startingHeight)/s]}),e.tmCanvas.width=a,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,s),o.forEach((u,d)=>{const h=u.textStyle===e.axisTextStyle?18:14;Xv(e.tmContext,u.textStyle,h),e.tmContext.fillText(d,1,u.startingHeight+u.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=o,i},t.computeBarSize=i=>{e.vertical=e.boxSize[1]>e.boxSize[0];const o=2*i.tickHeight/e.lastSize[1],a=[1,1];if(e.vertical){const s=2*(i.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-s,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-s,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+s,e.barPosition[1]=e.boxPosition[1],a[1]=o}else{const s=(2*i.tickWidth-8)/e.lastSize[0],c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],a[0]=s}return a},t.recomputeBarSegments=i=>{const o=t.computeBarSize(i);e.barSegments=[];const a=[0,0],s=e.vertical?1:0,c=e.vertical?.01:.02;function l(d,h){e.barSegments.push({corners:[[...a],[a[0]+o[0],a[1]],[a[0]+o[0],a[1]+o[1]],[a[0],a[1]+o[1]]],scalars:h,title:d}),a[s]+=o[s]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&l("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&e.renderable.getScalarsToColors().getUseBelowRangeColor?.()&&l("Below",[-.1,-.1,-.1,-.1]);const f=e.renderable.getScalarsToColors().getUseAboveRangeColor?.();a[s]+=c;const u=o[s];o[s]=f?1-2*c-o[s]-a[s]:1-c-a[s],l("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&f&&(o[s]=u,a[s]+=c,l("Above",[1.1,1.1,1.1,1.1]))};const r=new Float64Array(3);t.createPolyDataForOneLabel=(i,o,a,s,c,l)=>{const f=e._tmAtlas.get(i);if(!f)return;let u=l.ptIdx,d=l.cellIdx;r[0]=(.5*o[0]+.5)*e.lastSize[0],r[1]=(.5*o[1]+.5)*e.lastSize[1],r[2]=o[2],r[0]+=c[0],r[1]+=c[1];const h=[],g=s==="vertical"?[1,0]:[0,1];s==="vertical"?(h[0]=f.width,h[1]=-f.height,a[0]==="middle"?r[1]-=f.width/2:a[0]==="right"&&(r[1]-=f.width),a[1]==="middle"?r[0]+=f.height/2:a[1]==="top"&&(r[0]+=f.height)):(h[0]=f.width,h[1]=f.height,a[0]==="middle"?r[0]-=f.width/2:a[0]==="right"&&(r[0]-=f.width),a[1]==="middle"?r[1]-=f.height/2:a[1]==="top"&&(r[1]-=f.height)),l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[0],l.tcoords[u*2+1]=f.tcoords[1],u++,r[g[0]]+=h[0],l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[2],l.tcoords[u*2+1]=f.tcoords[3],u++,r[g[1]]+=h[1],l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[4],l.tcoords[u*2+1]=f.tcoords[5],u++,r[g[0]]-=h[0],l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[6],l.tcoords[u*2+1]=f.tcoords[7],u++,l.polys[d*4]=3,l.polys[d*4+1]=u-4,l.polys[d*4+2]=u-3,l.polys[d*4+3]=u-2,d++,l.polys[d*4]=3,l.polys[d*4+1]=u-4,l.polys[d*4+2]=u-2,l.polys[d*4+3]=u-1,l.ptIdx+=4,l.cellIdx+=2};const n=new Float64Array(3);t.updatePolyDataForLabels=()=>{const i=t.getTickStrings().length+e.barSegments.length,o=i*4,a=i*2,s=new Float64Array(o*3),c=new Uint16Array(a*4),l=new Float32Array(o*2),f={ptIdx:0,cellIdx:0,polys:c,points:s,tcoords:l},u=e.vertical?0:1,d=e.vertical?1:0;n[2]=-.99;const h=e.vertical?["right","middle"]:["middle","bottom"];let g=[0,1];const p=[0,0];e.vertical?(p[0]=-e.tickLabelPixelOffset,e.topTitle?(n[0]=e.boxPosition[0]+.5*e.boxSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)):(n[0]=e.barPosition[0]+e.barSize[0],n[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],f)),g=[-1,0]):(p[1]=e.tickLabelPixelOffset,n[0]=e.barPosition[0]+.5*e.barSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)),n[u]=e.barPosition[u]+(.5*g[u]+.5)*e.barSize[u],n[d]=e.barPosition[d]+e.barSize[d]*.5;let m=null;for(let S=0;S<e.barSegments.length;S++){const _=e.barSegments[S];_.title==="ticks"?m=_:(n[d]=e.barPosition[d]+.5*e.barSize[d]*(_.corners[2][d]+_.corners[0][d]),t.createPolyDataForOneLabel(_.title,n,h,"horizontal",p,f))}const w=e.barPosition[d]+e.barSize[d]*m.corners[0][d],v=e.barSize[d]*(m.corners[2][d]-m.corners[0][d]),y=t.getTicks(),C=t.getTickStrings(),x=t.getTickPositions();for(let S=0;S<y.length;S++){const _=x?x[S]:(y[S]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);n[d]=w+v*_,t.createPolyDataForOneLabel(C[S],n,h,"horizontal",p,f)}const T=Tt.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(T),e.tmPolyData.getPoints().setData(s,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{const i=e.renderable.getScalarsToColors();let o=0;e.renderable.getDrawNanAnnotation()&&i.getNanColor()&&(o+=1),e.renderable.getDrawBelowRangeSwatch()&&i.getUseBelowRangeColor?.()&&(o+=1),e.renderable.getDrawAboveRangeSwatch()&&i.getUseAboveRangeColor?.()&&(o+=1);const a=4*(1+o),s=a;let c=1;i.getVectorMode()===pne.COMPONENT&&(c=i.getVectorComponent()+1);const l=new Float64Array(a*3),f=new Uint16Array(s*5),u=new Float32Array(a*c);let d=0,h=0;for(let p=0;p<e.barSegments.length;p++){const m=e.barSegments[p];for(let w=0;w<4;w++){n[0]=e.barPosition[0]+m.corners[w][0]*e.barSize[0],n[1]=e.barPosition[1]+m.corners[w][1]*e.barSize[1],l[d*3]=(.5*n[0]+.5)*e.lastSize[0],l[d*3+1]=(.5*n[1]+.5)*e.lastSize[1],l[d*3+2]=n[2];for(let v=0;v<c;v++)u[d*c+v]=e.lastTickBounds[0]+m.scalars[w]*(e.lastTickBounds[1]-e.lastTickBounds[0]);d++}f[h*5]=4,f[h*5+1]=d-4,f[h*5+2]=d-3,f[h*5+3]=d-2,f[h*5+4]=d-1,h++}const g=Tt.newInstance({numberOfComponents:c,values:u,name:"Scalars"});e.polyData.getPointData().setScalars(g),e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(f,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const vne=K.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),K.obj(t,e),K.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings","tickPositions"]),K.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),K.getArray(t,e,["boxPosition","boxSize"]),K.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},K.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=Ui.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=rr.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=Lo.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=rr.newInstance(),e.tmMapper=Ui.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=Ol.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=Lo.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],mne(t,e)},"vtkScalarBarActorHelper");function yne(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.setOrientationToHorizontal=()=>t.setOrientation(Qm.HORIZONTAL),t.setOrientationToVertical=()=>t.setOrientation(Qm.VERTICAL),t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(rM(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(iM())}}function wne(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:void 0,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:void 0,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,orientation:null,...t}}function oM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wne(r)),e.autoLayout||(e.autoLayout=rM(t,e)),e.generateTicks||(e.generateTicks=iM()),Lo.extend(t,e,r),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),K.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch","orientation"]),K.get(t,e,["axisTextStyle","tickTextStyle"]),K.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),K.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),yne(t,e)}const Cne=K.newInstance(oM,"vtkScalarBarActor");var aM={newInstance:Cne,extend:oM,newScalarBarActorHelper:vne,...nM};function xne(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e._openGLRenderWindow.getRenderable())}}}const Tne={};function Sne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tne,r),Yn.extend(t,e,r),e.scalarBarActorHelper=aM.newScalarBarActorHelper(),xne(t,e)}const _ne=On(Sne,"vtkOpenGLScalarBarActor");Vr("vtkScalarBarActor",_ne);const{CoordinateSystem:Y_}=sg;function Ene(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const n=e.renderable.getMatrix();e.bufferShift[0]=n[3],e.bufferShift[1]=n[7],e.bufferShift[2]=n[11];const i=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Y_.WORLD&&(e.bufferShift[0]-=i[0],e.bufferShift[1]-=i[1],e.bufferShift[2]-=i[2]),mn(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?_t(e.keyMatrices.normalMatrix):(sr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,gr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),mn(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Gn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Y_.WORLD?Gn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]):sr(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const bne={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function Dne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bne,r),Yn.extend(t,e,r),e.keyMatricesTime={},K.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},K.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],Ene(t,e)}const Ine=K.newInstance(Dne);ca("vtkActor",Ine);const{CoordinateSystem:J_}=sg;function Mne(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const n=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===J_.WORLD&&(e.bufferShift[0]-=n[0],e.bufferShift[1]-=n[1],e.bufferShift[2]-=n[2]),_t(e.keyMatrices.bcwc),_t(e.keyMatrices.normalMatrix),Gn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===J_.WORLD?Gn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-n[0],-n[1],-n[2]]):sr(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const One={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function Pne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,One,r),Yn.extend(t,e,r),e.keyMatricesTime={},K.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},K.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],Mne(t,e)}const Rne=K.newInstance(Pne);ca("vtkActor2D",Rne);function Ane(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const Lne={};function Nne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lne,r),Yn.extend(t,e,r),e.CubeAxesActorHelper=Q7.newCubeAxesActorHelper(),Ane(t,e)}const Vne=On(Nne,"vtkWebGPUCubeAxesActor");ca("vtkCubeAxesActor",Vne);const{DisplayLocation:P5}=tM;function kne(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(P5.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(P5.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(li.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(li.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(li.POINTS),t.getRepresentationAsString=()=>K.enumToString(li,e.representation)}const Fne={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:li.SURFACE,displayLocation:P5.FOREGROUND};function Une(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fne,r),K.obj(t,e),K.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),K.setGetArray(t,e,["color"],3),kne(t,e)}K.newInstance(Une,"vtkProperty2D");var Bne={...tM};const{BufferUsage:oi,PrimitiveTypes:qi}=fg,{Representation:vp}=cf,{ScalarMode:yp}=Ui,{CoordinateSystem:Gne}=sg,{DisplayLocation:Z_}=Bne,Wne=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,$ne=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

struct Material {
  ior: f32,
  roughness: f32,
  metallic: f32,
  base: vec3<f32>,
};

struct DirectionalLight {
  direction: vec3<f32>,
  color: vec3<f32>,
};

struct PointLight {
  position: vec3<f32>,
  color: vec3<f32>,
};

struct SpotLight {
  position: vec3<f32>,
  direction: vec3<f32>,
  cones: vec2<f32>,
  color: vec3<f32>,
};

const pi: f32 = 3.14159265359;

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;

  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, mat: Material, light: DirectionalLight) -> PBRData {
  var L: vec3<f32> = normalize(light.direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = light.color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf * incoming * angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: PointLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V);
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  var F: f32 = schlickFresnelIOR(V, N, mat.ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = light.color * (1.0 / (dist * dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: SpotLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);

  var theta: f32 = mdot(normalize(light.direction), L);
  var epsilon: f32 = light.cones.x - light.cones.y;
  var intensity: f32 = (theta - light.cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist * dist;

  var incoming: vec3<f32> = light.color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;
  var ior: f32 = mapperUBO.BaseIOR;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  // Use texture alpha for transparency
  computedColor.a = mapperUBO.Opacity * _diffuseMap.a;
  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function Q_(t){return t.indexOf("edge")>=0}function zne(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=r=>{r&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==Gne.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{const n=e.WebGPUActor.getRenderable().getProperty(),i=e.UBO.getSendTime();if(t.getMTime()<=i&&n.getMTime()<=i&&e.renderable.getMTime()<=i)return;const o=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",o.bcwc),e.UBO.setArray("BCSCMatrix",o.bcsc),e.UBO.setArray("MCWCNormals",o.normalMatrix),e.is2D){const s=n.getDisplayLocation?.()??Z_.BACKGROUND;e.UBO.setValue("ZValue",s===Z_.FOREGROUND?1:0);const c=n.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[...c,1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else e.UBO.setValue("AmbientIntensity",n.getAmbient()),e.UBO.setArray("AmbientColor",[...n.getAmbientColorByReference(),1]),e.UBO.setValue("DiffuseIntensity",n.getDiffuse()),e.UBO.setArray("DiffuseColor",[...n.getDiffuseColorByReference(),1]),e.UBO.setValue("Roughness",n.getRoughness()),e.UBO.setValue("BaseIOR",n.getBaseIOR()),e.UBO.setValue("Metallic",n.getMetallic()),e.UBO.setValue("NormalStrength",n.getNormalStrength()),e.UBO.setValue("Emission",n.getEmission()),e.UBO.setValue("SpecularIntensity",n.getSpecular()),n.getSpecularColorByReference()&&e.UBO.setArray("SpecularColor",[...n.getSpecularColorByReference(),1]);const a=n.getEdgeColorByReference?.();a&&e.UBO.setArray("EdgeColor",[...a,1]),e.UBO.setValue("LineWidth",n.getLineWidth()),e.UBO.setValue("Opacity",n.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID()),e.UBO.sendIfNeeded(e.WebGPURenderWindow.getDevice())},t.haveWideLines=()=>{const r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();return r.getProperty().getLineWidth()<=1||e.primitiveType===qi.Verts?!1:e.primitiveType===qi.Triangles||e.primitiveType===qi.TriangleStrips?n===vp.WIREFRAME:!0},t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),o.hasOutput("vertexVC")||o.addOutput("vec4<f32>","vertexVC");let a=o.getCode();e.useRendererMatrix?(a=Hn.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(a=Hn.substitute(a,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(a=Hn.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(a=Hn.substitute(a,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(o.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),a=Hn.substitute(a,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),a=Hn.substitute(a,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(r,n,i)=>{const o=i.getBuffer("normalMC"),a=e.WebGPUActor.getRenderable();if(o){const s=n.getShaderDescription("vertex");s.hasOutput("normalVC")||s.addOutput("vec3<f32>","normalVC",o.getArrayInformation()[0].interpolation),s.hasOutput("tangentVC")||s.addOutput("vec3<f32>","tangentVC",o.getArrayInformation()[0].interpolation),s.hasOutput("bitangentVC")||s.addOutput("vec3<f32>","bitangentVC",o.getArrayInformation()[0].interpolation);let c=s.getCode();c=Hn.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,s.setCode(c);const l=n.getShaderDescription("fragment");c=l.getCode(),a.getProperty().getNormalTexture()?c=Hn.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=Hn.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,l.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(r,n,i)=>{if(r.includes("sel"))return;const o=n.getShaderDescription("vertex");o.hasOutput("vertexVC")||o.addOutput("vec4<f32>","vertexVC");const a=e.WebGPURenderer.getRenderable(),s=n.getShaderDescription("fragment");let c=s.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!Q_(r)&&!e.is2D&&!r.includes("sel")){const l=["  let fragPos = vec3<f32>(input.vertexVC.xyz);","  let V = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  let baseColor = _diffuseMap.rgb * diffuseColor.rgb;","  let roughness = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  let metallic = mapperUBO.Metallic * _metallicMap.r;","  let alpha = roughness * roughness;","  let k = alpha * alpha / 2.0;","  var diffuse = vec3<f32>(0.);","  var specular = vec3<f32>(0.);","  let emission = _emissionMap.rgb * mapperUBO.Emission;","","  // Material struct","  let mat = Material(ior, roughness, metallic, baseColor);","","  {","    var i = 0;","    loop {","      if (!(i < rendererUBO.LightCount)) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let pointLight = PointLight(pos, color);","           let result = calcPointLight(normal, V, fragPos, mat, pointLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","          }","         // Directional light","         case 1 {","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let dirLight = DirectionalLight(dir, color);","           let result = calcDirectionalLight(normal, V, mat, dirLight); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         // Spot Light","         case 2 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let cones = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           let spotLight = SpotLight(pos, dir, cones, color);","           let result = calcSpotLight(normal, V, fragPos, mat, spotLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  let fresnel = min(1.0, schlickFresnelIOR(V, normal, ior, k)); // Fresnel","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  let fresnelMetallic = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  let kS = min(vec3<f32>(1.0), mix(vec3<f32>(fresnel), fresnelMetallic, metallic));","  let kD = (1.0 - kS) * (1.0 - metallic);","  let PBR = mapperUBO.DiffuseIntensity * kD * diffuse + kS * specular;","  computedColor = vec4<f32>(PBR + emission, mapperUBO.Opacity);"];a.getEnvironmentTexture()?.getImageLoaded()&&l.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  let diffuseIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  let diffuseCoords = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  let VreflN = normalize(reflect(-V, normal));","  let reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  let specularCoords = vecToRectCoord(reflectionIBLCoords);","  let diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  let level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  let specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  let specularIBLContribution = specularIBL.rgb * rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution * kS, 0);","  let diffuseIBLContribution = diffuseIBL.rgb * rendererUBO.BackgroundDiffuseStrength;","  computedColor += vec4<f32>(diffuseIBLContribution * baseColor * _ambientOcclusionMap.rgb * kD, 0);"),c=Hn.substitute(c,"//VTK::Light::Impl",l).result,s.setCode(c)}else c=Hn.substitute(c,"//VTK::Light::Impl",["  let diffuse = diffuseColor.rgb;","  let specular = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,s.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(r,n,i)=>{if(Q_(r)){const l=n.getShaderDescription("fragment");let f=l.getCode();f=Hn.substitute(f,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,l.setCode(f);return}const o=i.getBuffer("colorVI");if(!o)return;const a=n.getShaderDescription("vertex");a.addOutput("vec4<f32>","color",o.getArrayInformation()[0].interpolation);let s=a.getCode();s=Hn.substitute(s,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,a.setCode(s);const c=n.getShaderDescription("fragment");s=c.getCode(),s=Hn.substitute(s,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(r,n,i)=>{if(!i.hasAttribute("tcoord"))return;const o=n.getShaderDescription("vertex"),a=i.getBuffer("tcoord"),s=wi.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);let c=o.getCode();o.addOutput(`vec${s}<f32>`,"tcoordVS"),c=Hn.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,o.setCode(c);const l=n.getShaderDescription("fragment");c=l.getCode();const f=e.WebGPUActor.getRenderable(),u=f.getProperty(),d=T=>T?T.getDimensionality()===s:!1,h=[],g=u.getDiffuseTexture?.();(g?.getImageLoaded()||f.getTextures()[0]||e.colorTexture)&&(d(g)||d(f.getTextures()[0])||d(e.colorTexture))&&h.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);");const p=u.getORMTexture?.(),m=u.getRMTexture?.(),w=u.getRoughnessTexture?.(),v=u.getMetallicTexture?.(),y=u.getAmbientOcclusionTexture?.(),C=u.getEmissionTexture?.(),x=u.getNormalTexture?.();p?.getImageLoaded()?d(p)&&h.push("_ambientOcclusionMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).rrra;","_roughnessMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).bbba;"):m?.getImageLoaded()?d(m)&&h.push("_roughnessMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).bbba;"):(w?.getImageLoaded()&&d(w)&&h.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS).ggga;"),v?.getImageLoaded()&&d(v)&&h.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS).bbba;"),y?.getImageLoaded()&&d(y)&&h.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS).rrra;")),C?.getImageLoaded()&&d(C)&&h.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),x?.getImageLoaded()&&d(x)&&h.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),c=Hn.substitute(c,"//VTK::TCoord::Impl",h).result,l.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(r,n,i)=>{if(r.includes("sel")){const o=n.getShaderDescription("fragment");let a=o.getCode();a=Hn.substitute(a,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,o.setCode(a)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(r,n)=>r===vp.POINTS||n===qi.Points?oi.Verts:n===qi.Lines?oi.Lines:r===vp.WIREFRAME?n===qi.Triangles?oi.LinesFromTriangles:oi.LinesFromStrips:n===qi.Triangles?oi.Triangles:n===qi.TriangleStrips?oi.Strips:n===qi.TriangleEdges?oi.LinesFromTriangles:oi.LinesFromStrips,t.getHashFromUsage=r=>`pt${r}`,t.getTopologyFromUsage=r=>{switch(r){case oi.Triangles:return"triangle-list";case oi.Verts:return"point-list";case oi.Lines:default:return"line-list"}},t.buildVertexInput=()=>{const r=e.currentInput,n=e.cellArray,i=e.primitiveType;let a=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const s=e.WebGPURenderWindow.getDevice();let c=!1;i===qi.TriangleEdges&&(c=!0,a=vp.WIREFRAME);const l=e.vertexInput,f=r.getPoints();let u=null;if(n?(u=s.getBufferManager().getBuffer({hash:`R${a}P${i}${n.getMTime()}`,usage:oi.Index,cells:n,numberOfPoints:f.getNumberOfPoints(),primitiveType:i,representation:a}),l.setIndexBuffer(u)):l.setIndexBuffer(null),f){const p=e.WebGPUActor.getBufferShift(e.WebGPURenderer);l.addBuffer(s.getBufferManager().getBuffer({hash:`${f.getMTime()}I${u?.getMTime?.()??0}${p.join()}float32x4`,usage:oi.PointArray,format:"float32x4",dataArray:f,indexBuffer:u,shift:p,packExtra:!0}),["vertexBC"])}else l.removeBufferIfPresent("vertexBC");const d=t.getUsage(a,i);if(e._usesCellNormals=!1,!e.is2D&&(d===oi.Triangles||d===oi.Strips)){const p=r.getPointData().getNormals(),m={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};p?(m.hash=`${p.getMTime()}I${u.getMTime()}snorm8x4`,m.dataArray=p,m.usage=oi.PointArray,l.addBuffer(s.getBufferManager().getBuffer(m),["normalMC"])):i===qi.Triangles?(e._usesCellNormals=!0,m.hash=`PFN${f.getMTime()}I${u.getMTime()}snorm8x4`,m.dataArray=f,m.cells=n,m.usage=oi.NormalsFromPoints,l.addBuffer(s.getBufferManager().getBuffer(m),["normalMC"])):l.removeBufferIfPresent("normalMC")}else l.removeBufferIfPresent("normalMC");let h=!1;if(e.renderable.getScalarVisibility()){const p=e.renderable.getColorMapColors();if(p&&!c){const m=e.renderable.getScalarMode(),w=(m===yp.USE_CELL_DATA||m===yp.USE_CELL_FIELD_DATA||m===yp.USE_FIELD_DATA||!r.getPointData().getScalars())&&m!==yp.USE_POINT_FIELD_DATA&&p;l.addBuffer(s.getBufferManager().getBuffer({usage:oi.PointArray,format:"unorm8x4",hash:`${w}${p.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:p,indexBuffer:u,cellData:w,cellOffset:0}),["colorVI"]),h=!0}}h||l.removeBufferIfPresent("colorVI");let g=null;e.renderable.getInterpolateScalarsBeforeMapping?.()&&e.renderable.getColorCoordinates()?g=e.renderable.getColorCoordinates():g=r.getPointData().getTCoords(),g&&!c?l.addBuffer(s.getBufferManager().getBufferForPointArray(g,l.getIndexBuffer()),["tcoord"]):l.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{const r=[],n=[],i=e.renderable.getColorTextureMap?.();i&&!e.colorTexture&&(e.colorTexture=Ol.newInstance({label:"polyDataColor"})),i&&(e.colorTexture.setInputData(i),n.push(["DiffuseTexture",e.colorTexture]));const o=e.WebGPUActor.getRenderable(),a=e.WebGPURenderer.getRenderable();[["DiffuseTexture",o.getProperty().getDiffuseTexture?.()],["DiffuseTexture",o.getTextures()[0]],["DiffuseTexture",e.colorTexture],["ORMTexture",o.getProperty().getORMTexture?.()],["RMTexture",o.getProperty().getRMTexture?.()],["RoughnessTexture",o.getProperty().getRoughnessTexture?.()],["MetallicTexture",o.getProperty().getMetallicTexture?.()],["NormalTexture",o.getProperty().getNormalTexture?.()],["AmbientOcclusionTexture",o.getProperty().getAmbientOcclusionTexture?.()],["EmissionTexture",o.getProperty().getEmissionTexture?.()],["EnvironmentTexture",a.getEnvironmentTexture?.()]].forEach(c=>{let[l,f]=c;f&&((f.getInputData()||f.getJsImageData()||f.getCanvas()||f.getImageBitmap())&&n.push([l,f]),f.getImage()&&f.getImageLoaded()&&n.push([l,f]))}),n.forEach(c=>{let[l,f]=c;const u=e.device.getTextureManager().getTextureForVTKTexture(f,l);if(!u.getReady())return;let d=!1;for(let h=0;h<e.textures.length;++h)if(e.textures[h]===u){d=!0,r[h]=!0;break}if(!d){r[e.textures.length]=!0;const h=u.createView(l);e.textures.push(u),e.textureViews.push(h);const g=f.getInterpolate()?"linear":"nearest";let p=null;f.getEdgeClamp()&&f.getRepeat()?p="mirror-repeat":f.getEdgeClamp()?p="clamp-to-edge":f.getRepeat()&&(p="repeat");let m={addressModeU:p,addressModeV:p,addressModeW:p,minFilter:g,magFilter:g};l==="EnvironmentTexture"&&(m={addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:g,magFilter:g,mipmapFilter:"linear"}),h.addSampler(e.device,m)}});for(let c=e.textures.length-1;c>=0;c--)r[c]||(e.textures.splice(c,1),e.textureViews.splice(c,1))},t.computePipelineHash=()=>{let r=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===qi.TriangleEdges||e.primitiveType===qi.TriangleStripEdges)r+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(r+="n"),e.vertexInput.hasAttribute("colorVI")&&(r+="c"),e.vertexInput.hasAttribute("tcoord")){const i=e.vertexInput.getBuffer("tcoord"),o=wi.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);r+=`t${o}`}e.textures.length&&(r+=`tx${e.textures.length}`)}e._usesCellNormals&&(r+="cn"),e.SSBO&&(r+="ssbo");const n=t.getHashFromUsage(e.usage);r+=n,r+=e.renderEncoder.getPipelineHash(),e.pipelineHash=r},t.updateBuffers=()=>{e.primitiveType!==qi.TriangleEdges&&e.primitiveType!==qi.TriangleStripEdges&&t.updateTextures();const r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();e.usage=t.getUsage(n,e.primitiveType),t.buildVertexInput();const i=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(i.getSizeInBytes()/i.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const o=r.getProperty();t.setNumberOfInstances(Math.ceil(o.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const jne={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function sM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jne,r),X6.extend(t,e,r),e.fragmentShaderTemplate=$ne,e.vertexShaderTemplate=Wne,e._tmpMat3=Ao(new Float64Array(9)),e._tmpMat4=_t(new Float64Array(16)),e.UBO=Jf.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Er(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],zne(t,e)}const Hne=On(sM,"vtkWebGPUCellArrayMapper");var cM={newInstance:Hne,extend:sM};const{PrimitiveTypes:Ho}=fg;function Kne(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>cM.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{if(!r){dn("No input!");return}const n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],i=[];let o=0;for(let a=Ho.Points;a<=Ho.TriangleStrips;a++)if(n[a].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[a]),s.setCurrentInput(r),s.setCellOffset(o),s.setPrimitiveType(a),s.setRenderable(e.renderable),o+=n[a].getNumberOfCells(),i.push(s)}else e.primitives[a]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility()){if(n[Ho.Triangles].getNumberOfValues()>0){const a=Ho.TriangleEdges;e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[Ho.Triangles]),s.setCurrentInput(r),s.setCellOffset(e.primitives[Ho.Triangles].getCellOffset()),s.setPrimitiveType(a),s.setRenderable(e.renderable),i.push(s)}else e.primitives[Ho.TriangleEdges]=null;if(n[Ho.TriangleStrips].getNumberOfValues()>0){const a=Ho.TriangleStripEdges;e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[Ho.TriangleStrips]),s.setCurrentInput(r),s.setCellOffset(e.primitives[Ho.TriangleStrips].getCellOffset()),s.setPrimitiveType(a),s.setRenderable(e.renderable),i.push(s)}else e.primitives[Ho.TriangleStripEdges]=null}t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}const Xne={primitives:null};function qne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xne,r),Yn.extend(t,e,r),e.primitives=[],Kne(t,e)}const Yne=On(qne,"vtkWebGPUPolyDataMapper");ca("vtkMapper",Yne);const{PrimitiveTypes:eE}=fg;function Jne(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>cM.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{const n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],i=[];let o=0;for(let a=eE.Points;a<=eE.Triangles;a++)if(n[a].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[a]),s.setCurrentInput(r),s.setCellOffset(o),s.setPrimitiveType(a),s.setRenderable(e.renderable),s.setIs2D(!0),o+=n[a].getNumberOfCells(),i.push(s)}else e.primitives[a]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}function Zne(t){return{primitives:[],...t}}function Qne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zne(r)),Yn.extend(t,e,r),e.primitives=[],Jne(t,e)}const ere=On(Qne,"vtkWebGPUPolyDataMapper2D");ca("vtkMapper2D",ere);function tre(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const nre={};function rre(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nre,r),Yn.extend(t,e,r),e.scalarBarActorHelper=aM.newScalarBarActorHelper(),tre(t,e)}const ire=On(rre,"vtkWebGPUScalarBarActor");ca("vtkScalarBarActor",ire);function ore(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(r,n)=>{e.texture=r,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=wi.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=i.sampleType},t.createFromTextureHandle=(r,n)=>{e.texture=null,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=wi.getDetailsFromTextureFormat(n.format);e.bindGroupLayoutEntry.texture.sampleType=i.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(r,n)=>{let i="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?i="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(i="u32");let o=`@binding(${r}) @group(${n}) var ${e.label}: texture_${e.options.dimension}<${i}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(o=`@binding(${r}) @group(${n}) var ${e.label}: texture_depth_${e.options.dimension};`),o},t.addSampler=(r,n)=>{const i=nI.newInstance({label:`${e.label}Sampler`});i.create(r,n),t.setSampler(i)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const are={texture:null,handle:null,sampler:null,label:null};function lM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,are,r),K.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),K.get(t,e,["bindGroupTime","texture"]),K.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),ore(t,e)}const sre=K.newInstance(lM);var cre={newInstance:sre,extend:lM};function lre(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(r,n)=>{e.device=r,e.width=n.width,e.height=n.height,e.depth=n.depth?n.depth:1;const i=e.depth===1?"2d":"3d";e.format=n.format?n.format:"rgba8unorm",e.mipLevel=n.mipLevel?n.mipLevel:0,e.usage=n.usage?n.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:i,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(r,n,i)=>{e.device=r,e.handle=n,e.width=i.width,e.height=i.height,e.depth=i.depth?i.depth:1,e.format=i.format?i.format:"rgba8unorm",e.usage=i.usage?i.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=r=>{let n=[];const i=u=>{e.device.getHandle().queue.copyExternalImageToTexture({source:u,flipY:r.flip},{texture:e.handle,premultipliedAlpha:!0,mipLevel:0,origin:{x:0,y:0,z:0}},[u.width,u.height,e.depth]),t.getDimensionality()!==3&&e.mipLevel>0&&Ol.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0};if(r.canvas){i(r.canvas);return}if(r.imageBitmap){r.width=r.imageBitmap.width,r.height=r.imageBitmap.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,i(r.imageBitmap);return}if(r.jsImageData){r.width=r.jsImageData.width,r.height=r.jsImageData.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,i(r.jsImageData);return}if(r.image){r.width=r.image.width,r.height=r.image.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,i(r.image);return}const o=wi.getDetailsFromTextureFormat(e.format);let a=e.width*o.stride;const s=(u,d,h)=>{const g=o.elementSize===2&&o.sampleType==="float",p=u.BYTES_PER_ELEMENT,m=u.length/(d*h)*p;if(!g&&m%256===0)return[u,m];const w=m/p,v=o.elementSize,y=256*Math.floor((w*v+255)/256),C=y/v,x=K.newTypedArray(g?"Uint16Array":u.constructor.name,C*d*h),T=d*h;if(g)for(let S=0;S<T;S++){const _=S*w,E=S*C;for(let D=0;D<w;D++)x[E+D]=bu.toHalf(u[_+D])}else if(C===w)x.set(u);else for(let S=0;S<T;S++)x.set(u.subarray(S*w,(S+1)*w),S*C);return[x,y]};r.nativeArray&&(n=r.nativeArray);const c=t.getDimensionality()===3,l=s(n,e.height,c?e.depth:1);a=l[1];const f=l[0];e.device.getHandle().queue.writeTexture({texture:e.handle,mipLevel:0,origin:{x:0,y:0,z:0}},f,{offset:0,bytesPerRow:a,rowsPerImage:e.height},{width:e.width,height:e.height,depthOrArrayLayers:c?e.depth:1}),!c&&e.mipLevel>0&&Ol.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0},t.getScale=()=>{const r=wi.getDetailsFromTextureFormat(e.format);return r.elementSize===2&&r.sampleType==="float"?1:255},t.getNumberOfComponents=()=>wi.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let r=0;return e.width>1&&r++,e.height>1&&r++,e.depth>1&&r++,r},t.resizeToMatch=r=>{(r.getWidth()!==e.width||r.getHeight()!==e.height||r.getDepth()!==e.depth)&&(e.width=r.getWidth(),e.height=r.getHeight(),e.depth=r.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(r!==e.width||n!==e.height||i!==e.depth)&&(e.width=r,e.height=n,e.depth=i,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n.dimension||(n.dimension=e.depth===1?"2d":"3d");const i=cre.newInstance({label:r});return i.create(t,n),i}}const ure={device:null,handle:null,buffer:null,ready:!1,label:null};function fre(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ure,r),K.obj(t,e),K.get(t,e,["handle","ready","width","height","depth","format","usage"]),K.setGet(t,e,["device","label"]),lre(t,e)}K.newInstance(fre);function dre(t){if(!t||t.data.length===0)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!t.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!t.data||!Array.isArray(t.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");t.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(r=>{if(!r||!Array.isArray(r)||r.length!==3)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}class tE{constructor(e){const{points:r,type:n}=e.data;this.id=e.id,this._points=r,this._type=n,this._color=e.color,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return this._points.length*3}get points(){return this._points}set points(e){this._points=e}get color(){return this._color}set color(e){this._color=e}get type(){return this._type}set type(e){this._type=e}get segmentIndex(){return this._segmentIndex}set segmentIndex(e){this._segmentIndex=e}get flatPointsArray(){return this._points.map(e=>[...e]).flat()}}class hre{constructor(e){this._color=[200,0,0],this.id=e.id,this._contours=[],this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(r=>{const{points:n,type:i,color:o}=r,a=new tE({id:`${this.id}-segment-${this._segmentIndex}`,data:{points:n,type:i,segmentIndex:this._segmentIndex,color:o??this._color},segmentIndex:this._segmentIndex,color:o??this._color});this._contours.push(a)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.totalNumberOfPoints,r=this.flatPointsArray,n=r.reduce((a,s)=>[a[0]+s[0],a[1]+s[1],a[2]+s[2]],[0,0,0]),i=[n[0]/e,n[1]/e,n[2]/e],o=r.reduce((a,s)=>{const c=this._getDistance(i,s),l=this._getDistance(i,a);return c<l?s:a},r[0]);this._centroid=o}_getSizeInBytes(){return this._contours.reduce((e,r)=>e+r.sizeInBytes,0)}_getDistance(e,r){return Math.sqrt((e[0]-r[0])**2+(e[1]-r[1])**2+(e[2]-r[2])**2)}get centroid(){return this._centroid}get segmentIndex(){return this._segmentIndex}get color(){return this._color}set color(e){this._color=e,this._contours.forEach(r=>{r instanceof tE&&(r.color=e)})}get contours(){return this._contours}get flatPointsArray(){return this._contours.flatMap(e=>e.points)}get numberOfContours(){return this._contours.length}get totalNumberOfPoints(){return this._contours.reduce((e,r)=>e+r.points.length,0)}get numberOfPointsArray(){return this._contours.map(e=>e.points.length)}getPointsInContour(e){return this._contours[e].points}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}}function gre(t,e){dre(e);const r=new hre({id:e.id,data:e.data,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:hs.CONTOUR,data:r,sizeInBytes:r.sizeInBytes}}function pre(t){if(!t.id)throw new Error("Surface must have an id");if(t.points?.length===0)throw new Error("Surface must have non-empty points array");if(t.polys?.length===0)throw new Error("Surface must have non-empty polys array");if(!t.frameOfReferenceUID)throw new Error("Surface must have a frameOfReferenceUID")}function mre(t,e){pre(e);const r=new t7({id:e.id,points:e.points,polys:e.polys,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:hs.SURFACE,data:r,sizeInBytes:r.sizeInBytes}}function vre(t){if(!t.id)throw new Error("Mesh must have an id");if(!t.arrayBuffer)throw new Error("Mesh must have an arrayBuffer");if(!(t.format in bo))throw new Error(`Mesh format must be one of the following: ${Object.values(bo).join(", ")}`)}function yre(t,e){e.classHierarchy.push("vtkMTLReader");function r(){e.requestCount--,e.requestCount===0&&t.invokeBusy(!1)}function n(o){if(o[0]==="#"||o.length===0)return;const a=o.split(/[ \t]+/).map(s=>s.trim()).filter(s=>s.length);if(a[0]==="newmtl")a.shift(),e.currentMaterial=a.join(" ").trim();else if(e.currentMaterial){if(a.length<2)return;if(e.materials[e.currentMaterial]||(e.materials[e.currentMaterial]={}),e.materials[e.currentMaterial][a[0]]=a.slice(1),a[0]==="map_Kd"){const s=new Image;s.onload=()=>setTimeout(r,0),s.src=[e.baseURL,a[1]].join("/"),e.materials[e.currentMaterial].image=s,e.requestCount++}}}e.dataAccessHelper||(e.dataAccessHelper=wg.get("http"));function i(o,a){return e.dataAccessHelper.fetchText(t,o,a)}t.setUrl=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(o.indexOf(".mtl")===-1&&!a.fullpath)e.baseURL=o,e.url=`${o}/index.mtl`;else{e.url=o;const s=o.split("/");s.pop(),e.baseURL=s.join("/")}return t.loadData(a)},t.loadData=o=>new Promise((a,s)=>{i(e.url,o).then(c=>{t.parseAsText(c),a()},c=>{s()})}),t.parseAsText=o=>{t.modified(),e.materials={},o.split(`
`).forEach(n)},t.isBusy=()=>!!e.requestCount,t.getMaterialNames=()=>Object.keys(e.materials),t.getMaterial=o=>e.materials[o],t.listImages=()=>Object.keys(e.materials).map(o=>e.materials[o].map_Kd).filter(o=>!!o).map(o=>o[0].trim()),t.setImageSrc=(o,a)=>new Promise((s,c)=>{const l=Object.keys(e.materials).find(u=>e.materials[u].map_Kd&&e.materials[u].map_Kd[0].trim()===o.trim()),f=e.materials[l];f&&f.image?(f.image.src=a,f.image.onload=()=>setTimeout(s,0)):s()}),t.applyMaterialToActor=(o,a)=>{const s=e.materials[o];if(s&&a){const c=[1,1,1],l={ambientColor:s.Ka?s.Ka.map(u=>Number(u)):c,specularColor:s.Ks?s.Ks.map(u=>Number(u)):c,diffuseColor:s.Kd?s.Kd.map(u=>Number(u)):c,opacity:s.d?Number(s.d):1,specularPower:s.Ns?Number(s.Ns):1},f=Number(s.illum||2);if(["ambient","diffuse","specular"].forEach((u,d)=>{l[u]=d<=f?1:0}),s.image){const u=Ol.newInstance({interpolate:e.interpolateTextures});u.setImage(s.image),a.addTexture(u)}a.getProperty().set(l)}}}const wre={numberOfOutputs:1,requestCount:0,materials:{},interpolateTextures:!0};function uM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wre,r),Zn(t,e),Wi(t,e,["url","baseURL"]),Er(t,e,["dataAccessHelper","interpolateTextures","splitGroup"]),Aw(t,e,"busy"),yre(t,e)}const Cre=On(uM,"vtkMTLReader");var xre={newInstance:Cre,extend:uM};function fM(t,e){vre(e);const r=new YQ({...e}),n={id:t,type:hs.MESH,data:r,sizeInBytes:r.sizeInBytes};switch(e.format){case bo.PLY:if(e.materialUrl){const i=new Image;return new Promise((o,a)=>{i.onload=()=>{try{const s=Ol.newInstance();s.setInterpolate(!0),s.setImage(i),r.defaultActor.addTexture(s),o(n)}catch(s){a(s)}},i.onerror=s=>a(s),i.src=e.materialUrl})}return Promise.resolve(n);case bo.OBJ:if(e.materialUrl){const i=xre.newInstance();return i.setUrl(e.materialUrl).then(()=>{for(let o=0;o<r.actors.length;o++){const a=r.actors[o],s=a.getMapper();if(s){const c=s.getInputData();if(c){const l=c.get("name").name;i.applyMaterialToActor(l,a)}}}return n}).catch(o=>{throw new Error(`Failed to load material: ${o}`)})}return Promise.resolve(n);case bo.STL:case bo.VTP:return Promise.resolve(n);default:return Promise.reject(new Error(`Unsupported format: ${e.format}`))}}function Tre({url:t,signal:e,onload:r,loaderOptions:n}){return new Promise(async(i,o)=>{const a=new XMLHttpRequest;a.open("GET",t,!0);const s={},c=await n.beforeSend(a,s),l=Object.assign({},s,c);a.responseType="arraybuffer",Object.keys(l).forEach(function(h){l[h]!==null&&a.setRequestHeader(h,l[h])});const f=function(h){r&&typeof r=="function"&&r(),e&&e.removeEventListener("abort",u),i(a.response)},u=()=>{a.abort(),a.removeEventListener("load",f),o(new Error("Request aborted"))};a.addEventListener("load",f);const d=(h,g)=>{const p={url:t,loaded:h,total:g};Xe(ke,Ge.GEOMETRY_LOAD_PROGRESS,{data:p})};a.onprogress=function(h){d(h.loaded,h.total)},e&&e.aborted?(a.abort(),o(new Error("Request aborted"))):e&&e.addEventListener("abort",u),a.send()})}function dM(t,e,r){return{promise:new Promise((i,o)=>{Sre(t,e,r).then(i).catch(o)}),cancelFn:void 0,decache:()=>{}}}async function Sre(t,e,r){const i=t.split(":").slice(1).join(":"),o=await Tre({url:i,loaderOptions:r});if(!e||!("geometryData"in e))throw new Error("Mesh must have a geometryData");return fM(i,{...e.geometryData,arrayBuffer:o})}let e1={beforeSend(t){}};function _re(t){e1=Object.assign(e1,t)}function Ere(){return e1}const hM={};let Hd;function gM(t,e){const r=t.indexOf(":"),n=t.substring(0,r);let i=hM[n];if(i==null){if(Hd==null||typeof Hd!="function")throw new Error(`No geometry loader for scheme ${n} has been registered`);i=Hd}const o=i(t,e,e1);return o.promise.then(function(a){Xe(ke,Ge.GEOMETRY_LOADED,{geometry:a})},function(a){const s={geometryId:t,error:a};Xe(ke,Ge.GEOMETRY_LOADED_FAILED,s)}),o}function bre(t,e){if(t===void 0)throw new Error("loadGeometry: parameter geometryId must not be undefined");let r=Ae.getGeometryLoadObject(t);return r!==void 0||(r=gM(t,e)),r.promise}async function Dre(t,e){if(t===void 0)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let r=Ae.getGeometryLoadObject(t);return r!==void 0||(r=gM(t,e),await Ae.putGeometryLoadObject(t,r)),r.promise}function Ire(t,e){if(t===void 0)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let r=Ae.getGeometry(t);if(r)return r;if(e.type===hs.CONTOUR)r=gre(t,e.geometryData);else if(e.type===hs.SURFACE)r=mre(t,e.geometryData);else if(e.type===hs.MESH)fM(t,e.geometryData).then(n=>{r=n});else throw new Error(`Unknown geometry type: ${e.type}`);return Ae.putGeometrySync(t,r),r}function pM(t,e){hM[t]=e}function Mre(t){const e=Hd;return Hd=t,e}pM("mesh",dM);const Ore=Object.freeze(Object.defineProperty({__proto__:null,createAndCacheGeometry:Ire,getOptions:Ere,loadAndCacheGeometry:Dre,loadGeometry:bre,registerGeometryLoader:pM,registerUnknownGeometryLoader:Mre,setOptions:_re},Symbol.toStringTag,{value:"Module"}));function Pre(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a 4D streaming image volume");const{imageIds:r}=e,{splittingTag:n,imageIdGroups:i}=lx(r),o=Math.floor(i.length/2),a=hg(i[o],t),{metadata:s,dimensions:c,spacing:l,direction:f,sizeInBytes:u,origin:d,numberOfComponents:h,dataType:g}=a,p=f.slice(6,9),m=i.map(C=>kC(C,p).sortedImageIds),w=m.flat(),v=La.createScalarDynamicVolumeVoxelManager({dimensions:c,imageIdGroups:m,dimensionGroupNumber:1,numberOfComponents:h});let y=new B7({volumeId:t,metadata:s,dimensions:c,spacing:l,origin:d,direction:f,sizeInBytes:u,imageIds:w,imageIdGroups:m,splittingTag:n,voxelManager:v,numberOfComponents:h,dataType:g},{imageIds:w,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}});return{promise:Promise.resolve(y),decache:()=>{y.destroy(),y=null},cancel:()=>{y.cancelLoading()}}}const Rre=Object.freeze(Object.defineProperty({__proto__:null,BaseRenderingEngine:JC,BaseVolumeViewport:ir,CONSTANTS:Mc,ContextPoolRenderingEngine:x5,EPSILON:vc,EVENTS:Ge,Enums:go,ImageVolume:lf,ProgressiveRetrieveImages:Sh,RenderingEngine:e7,Settings:or,StackViewport:qn,StreamingDynamicImageVolume:B7,StreamingImageVolume:d9,Surface:t7,TiledRenderingEngine:ZC,VideoViewport:w0,Viewport:Qu,VolumeViewport:zn,VolumeViewport3D:a2,WSIViewport:Gm,addImageSlicesToViewports:Z9,addVolumesToViewports:J9,cache:Ae,canRenderFloatTextures:N1,convertMapperToNotSharedMapper:w9,cornerstoneMeshLoader:dM,cornerstoneStreamingDynamicImageVolumeLoader:Pre,cornerstoneStreamingImageVolumeLoader:h9,createCanvas:yg,createViewportElement:z9,createVolumeActor:Fm,createVolumeMapper:y9,eventTarget:ke,geometryLoader:Ore,getConfiguration:Aa,getEnabledElement:Ce,getEnabledElementByIds:Ln,getEnabledElementByViewportId:xn,getEnabledElements:R7,getOrCreateCanvas:Oo,getRenderingEngine:Bn,getRenderingEngines:Bi,getShouldUseCPURendering:Xf,getWebWorkerManager:Is,imageLoadPoolManager:Hr,imageLoader:oY,imageRetrievalPoolManager:F0,init:_b,isCornerstoneInitialized:Eb,metaData:t9,peerImport:bb,registerImageLoader:Zf,requestPoolManager:Hr,resetInitialization:LN,resetUseCPURendering:AN,setCanvasCreator:bJ,setConfiguration:NN,setPreferSizeOverAccuracy:RN,setUseCPURendering:PN,setVolumesForViewports:Y9,triggerEvent:Xe,utilities:gn,version:wZ,volumeLoader:mY},Symbol.toStringTag,{value:"Module"}));var Ss;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(Ss||(Ss={}));var Qr;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})(Qr||(Qr={}));var _n;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(_n||(_n={}));var _a;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(_a||(_a={}));var V;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",t.VOLUMECROPPINGCONTROL_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPINGCONTROL_TOOL_CHANGED",t.VOLUMECROPPING_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPING_TOOL_CHANGED",t.STACK_PREFETCH_COMPLETE="CORNERSTONE_TOOLS_STACK_PREFETCH_COMPLETE",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",t.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(V||(V={}));var yt;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(yt||(yt={}));var Vu;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(Vu||(Vu={}));var ht;(function(t){t.CalculateCursorGeometry="calculateCursorGeometry",t.RenderCursor="renderCursor",t.OnInteractionStart="onInteractionStart",t.OnInteractionEnd="onInteractionEnd",t.Preview="preview",t.RejectPreview="rejectPreview",t.AcceptPreview="acceptPreview",t.Fill="fill",t.Interpolate="interpolate",t.StrategyFunction="strategyFunction",t.CreateIsInThreshold="createIsInThreshold",t.Initialize="initialize",t.INTERNAL_setValue="setValue",t.AddPreview="addPreview",t.ComputeInnerCircleRadius="computeInnerCircleRadius",t.GetStatistics="getStatistics",t.EnsureImageVolumeFor3DManipulation="ensureImageVolumeFor3DManipulation",t.EnsureSegmentationVolumeFor3DManipulation="ensureSegmentationVolumeFor3DManipulation"})(ht||(ht={}));var Nt;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated",t.History="History",t.MetadataReferenceModified="MetadataReferenceModified",t.LabelChange="LabelChange"})(Nt||(Nt={}));var No;(function(t){t.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",t.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",t.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",t.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",t.SURFACE_CLIPPING="Clipping Surfaces",t.COMPUTE_STATISTICS="Computing Statistics",t.INTERPOLATE_LABELMAP="Interpolating Labelmap",t.COMPUTE_LARGEST_BIDIRECTIONAL="Computing Largest Bidirectional",t.GENERATE_CONTOUR_SETS="Generating Contour Sets"})(No||(No={}));var ra;(function(t){t.Linear="Linear",t.Area="Area",t.Volume="Volume",t.Pixel="Pixel"})(ra||(ra={}));const Are=Object.freeze(Object.defineProperty({__proto__:null,AnnotationStyleStates:_a,ChangeTypes:Nt,Events:V,get KeyboardBindings(){return Qr},get MeasurementType(){return ra},get MouseBindings(){return Ss},SegmentationRepresentations:yt,StrategyCallbacks:ht,get Swipe(){return Vu},ToolModes:_n,WorkerTypes:No},Symbol.toStringTag,{value:"Module"}));let u2={};function Lre(){u2={}}const nE={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:u2,enabledElements:[],handleRadius:6};let Ue={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:u2,enabledElements:[],handleRadius:6};function Nre(){Lre(),Ue={...structuredClone({...nE,svgNodeCache:{}}),svgNodeCache:{...nE.svgNodeCache}}}var qv,rE;function Vre(){if(rE)return qv;rE=1;var t="Expected a function",e="__lodash_hash_undefined__",r="[object Function]",n="[object GeneratorFunction]",i="[object Symbol]",o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/,s=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/[\\^$.*+?()[\]{}|]/g,f=/\\(\\)?/g,u=/^\[object .+?Constructor\]$/,d=typeof cc=="object"&&cc&&cc.Object===Object&&cc,h=typeof self=="object"&&self&&self.Object===Object&&self,g=d||h||Function("return this")();function p(Pe,Fe){return Pe?.[Fe]}function m(Pe){var Fe=!1;if(Pe!=null&&typeof Pe.toString!="function")try{Fe=!!(Pe+"")}catch{}return Fe}var w=Array.prototype,v=Function.prototype,y=Object.prototype,C=g["__core-js_shared__"],x=(function(){var Pe=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||"");return Pe?"Symbol(src)_1."+Pe:""})(),T=v.toString,S=y.hasOwnProperty,_=y.toString,E=RegExp("^"+T.call(S).replace(l,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),D=g.Symbol,b=w.splice,I=We(g,"Map"),O=We(Object,"create"),M=D?D.prototype:void 0,R=M?M.toString:void 0;function A(Pe){var Fe=-1,nt=Pe?Pe.length:0;for(this.clear();++Fe<nt;){var wt=Pe[Fe];this.set(wt[0],wt[1])}}function B(){this.__data__=O?O(null):{}}function k(Pe){return this.has(Pe)&&delete this.__data__[Pe]}function L(Pe){var Fe=this.__data__;if(O){var nt=Fe[Pe];return nt===e?void 0:nt}return S.call(Fe,Pe)?Fe[Pe]:void 0}function F(Pe){var Fe=this.__data__;return O?Fe[Pe]!==void 0:S.call(Fe,Pe)}function j(Pe,Fe){var nt=this.__data__;return nt[Pe]=O&&Fe===void 0?e:Fe,this}A.prototype.clear=B,A.prototype.delete=k,A.prototype.get=L,A.prototype.has=F,A.prototype.set=j;function J(Pe){var Fe=-1,nt=Pe?Pe.length:0;for(this.clear();++Fe<nt;){var wt=Pe[Fe];this.set(wt[0],wt[1])}}function ie(){this.__data__=[]}function fe(Pe){var Fe=this.__data__,nt=q(Fe,Pe);if(nt<0)return!1;var wt=Fe.length-1;return nt==wt?Fe.pop():b.call(Fe,nt,1),!0}function ae(Pe){var Fe=this.__data__,nt=q(Fe,Pe);return nt<0?void 0:Fe[nt][1]}function de(Pe){return q(this.__data__,Pe)>-1}function we(Pe,Fe){var nt=this.__data__,wt=q(nt,Pe);return wt<0?nt.push([Pe,Fe]):nt[wt][1]=Fe,this}J.prototype.clear=ie,J.prototype.delete=fe,J.prototype.get=ae,J.prototype.has=de,J.prototype.set=we;function _e(Pe){var Fe=-1,nt=Pe?Pe.length:0;for(this.clear();++Fe<nt;){var wt=Pe[Fe];this.set(wt[0],wt[1])}}function Te(){this.__data__={hash:new A,map:new(I||J),string:new A}}function G(Pe){return Ne(this,Pe).delete(Pe)}function P(Pe){return Ne(this,Pe).get(Pe)}function $(Pe){return Ne(this,Pe).has(Pe)}function W(Pe,Fe){return Ne(this,Pe).set(Pe,Fe),this}_e.prototype.clear=Te,_e.prototype.delete=G,_e.prototype.get=P,_e.prototype.has=$,_e.prototype.set=W;function q(Pe,Fe){for(var nt=Pe.length;nt--;)if(st(Pe[nt][0],Fe))return nt;return-1}function Q(Pe,Fe){Fe=re(Fe,Pe)?[Fe]:De(Fe);for(var nt=0,wt=Fe.length;Pe!=null&&nt<wt;)Pe=Pe[pe(Fe[nt++])];return nt&&nt==wt?Pe:void 0}function ee(Pe){if(!Ee(Pe)||ve(Pe))return!1;var Fe=ct(Pe)||m(Pe)?E:u;return Fe.test($e(Pe))}function ge(Pe){if(typeof Pe=="string")return Pe;if(qe(Pe))return R?R.call(Pe):"";var Fe=Pe+"";return Fe=="0"&&1/Pe==-1/0?"-0":Fe}function De(Pe){return gt(Pe)?Pe:le(Pe)}function Ne(Pe,Fe){var nt=Pe.__data__;return se(Fe)?nt[typeof Fe=="string"?"string":"hash"]:nt.map}function We(Pe,Fe){var nt=p(Pe,Fe);return ee(nt)?nt:void 0}function re(Pe,Fe){if(gt(Pe))return!1;var nt=typeof Pe;return nt=="number"||nt=="symbol"||nt=="boolean"||Pe==null||qe(Pe)?!0:a.test(Pe)||!o.test(Pe)||Fe!=null&&Pe in Object(Fe)}function se(Pe){var Fe=typeof Pe;return Fe=="string"||Fe=="number"||Fe=="symbol"||Fe=="boolean"?Pe!=="__proto__":Pe===null}function ve(Pe){return!!x&&x in Pe}var le=oe(function(Pe){Pe=Je(Pe);var Fe=[];return s.test(Pe)&&Fe.push(""),Pe.replace(c,function(nt,wt,yn,bn){Fe.push(yn?bn.replace(f,"$1"):wt||nt)}),Fe});function pe(Pe){if(typeof Pe=="string"||qe(Pe))return Pe;var Fe=Pe+"";return Fe=="0"&&1/Pe==-1/0?"-0":Fe}function $e(Pe){if(Pe!=null){try{return T.call(Pe)}catch{}try{return Pe+""}catch{}}return""}function oe(Pe,Fe){if(typeof Pe!="function"||Fe&&typeof Fe!="function")throw new TypeError(t);var nt=function(){var wt=arguments,yn=Fe?Fe.apply(this,wt):wt[0],bn=nt.cache;if(bn.has(yn))return bn.get(yn);var fn=Pe.apply(this,wt);return nt.cache=bn.set(yn,fn),fn};return nt.cache=new(oe.Cache||_e),nt}oe.Cache=_e;function st(Pe,Fe){return Pe===Fe||Pe!==Pe&&Fe!==Fe}var gt=Array.isArray;function ct(Pe){var Fe=Ee(Pe)?_.call(Pe):"";return Fe==r||Fe==n}function Ee(Pe){var Fe=typeof Pe;return!!Pe&&(Fe=="object"||Fe=="function")}function ze(Pe){return!!Pe&&typeof Pe=="object"}function qe(Pe){return typeof Pe=="symbol"||ze(Pe)&&_.call(Pe)==i}function Je(Pe){return Pe==null?"":ge(Pe)}function lt(Pe,Fe,nt){var wt=Pe==null?void 0:Q(Pe,Fe);return wt===void 0?nt:wt}return qv=lt,qv}var kre=Vre();const Fre=ka(kre),iE=Symbol("DefinedCursors"),mM=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class ki{constructor(e,r){this.name=e+"",this.fallback=r}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:r}=this;return r instanceof ki?`${e}, ${r.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const r=oE(ki,iE);let n=r.get(e);if(n instanceof ki)return n;if(mM.has(e))return n=new ki(e),r.set(e,n),n}static setDefinedCursor(e,r){return r instanceof ki?(oE(ki,iE).set(e,r),!0):!1}}function oE(t,e){let r=t[e];return r instanceof Map||(r=new Map,Object.defineProperty(t,e,{value:r})),r}const Ure=mM.values(),Bre="image-cursor";class Lh extends ki{constructor(e,r,n,i,o){super(i||Lh.getUniqueInstanceName(Bre),o),this.url=e,this.x=Number(r)||0,this.y=Number(n)||0}getStyleProperty(){const{url:e,x:r,y:n}=this;let i=`url('${e}')`;return r>=0&&n>=0&&(r>0||n>0)&&(i+=` ${r} ${n}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${_7(Lh)}`}}const Dn={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},ao={x:127,y:60},Tf=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,ol=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,wp='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Sf='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Cp='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',f2={Angle:In(Dn,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:In(Dn,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:In(Dn,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:In(Dn,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:In(Dn,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:In(Dn,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:In(Dn,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:In(Dn,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:In(Dn,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:In(Dn,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:In(Dn,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:In(Dn,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),Label:In(Dn,{name:"Label",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:In(Dn,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:In(Dn,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:In(Dn,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:In(Dn,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:In(Dn,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:In(Dn,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:In(Dn,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:In(Dn,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:In(Dn,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:In(Dn,{name:"SegmentationFreeHandEraseInside",iconContent:`${wp} ${Tf}`,viewBox:ao}),SegmentationFreeHandFillInside:In(Dn,{name:"SegmentationFreeHandFillInside",iconContent:`${wp} ${ol}`,viewBox:ao}),SegmentationFreeHandEraseOutside:In(Dn,{name:"SegmentationFreeHandEraseOutside",iconContent:`${wp} ${Tf}`,viewBox:ao}),SegmentationFreeHandFillOutside:In(Dn,{name:"SegmentationFreeHandFillOutside",iconContent:`${wp} ${ol}`,viewBox:ao}),SegmentationRectangleEraseInside:In(Dn,{name:"SegmentationRectangleEraseInside",iconContent:`${Sf} ${Tf}`,viewBox:ao}),RectangleScissor:In(Dn,{name:"RectangleScissor",iconContent:`${Sf} ${ol}`,viewBox:ao}),"RectangleScissor.FILL_INSIDE":In(Dn,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${Sf} ${ol}`,viewBox:ao}),"RectangleScissor.FILL_OUTSIDE":In(Dn,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${Sf} ${ol}`,viewBox:ao}),"RectangleScissor.ERASE_OUTSIDE":In(Dn,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${Sf} ${Tf}`,viewBox:ao}),"RectangleScissor.ERASE_INSIDE":In(Dn,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${Sf} ${Tf}`,viewBox:ao}),CircleScissor:In(Dn,{name:"CircleScissor",iconContent:`${Cp} ${ol}`,viewBox:ao}),"CircleScissor.FILL_INSIDE":In(Dn,{name:"CircleScissor.FILL_INSIDE",iconContent:`${Cp} ${ol}`,viewBox:ao}),"CircleScissor.ERASE_OUTSIDE":In(Dn,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${Cp} ${Tf}`,viewBox:ao}),"CircleScissor.FILL_OUTSIDE":In(Dn,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${Cp} ${ol}`,viewBox:ao})};function In(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function Gre(t,e,r){f2[t]=In(Dn,{iconContent:e,viewBox:r})}function Wre(t){return f2[t]}const $re=Object.keys(f2);class zre{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0,markerSize:"10",angleArcLineDash:""};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,r){let n=this.config.annotations;n||(this.config={...this.config,annotations:{}},n=this.config.annotations),n[e]=r}setViewportToolStyles(e,r){let n=this.config.viewports;n||(this.config={...this.config,viewports:{}},n=this.config.viewports),n[e]=r}setToolGroupToolStyles(e,r){let n=this.config.toolGroups;n||(this.config={...this.config,toolGroups:{}},n=this.config.toolGroups),n[e]=r}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,r){const{annotationUID:n,viewportId:i,toolGroupId:o,toolName:a}=r;return this._getToolStyle(e,n,i,o,a)}_getToolStyle(e,r,n,i,o){if(r){const s=this.getAnnotationToolStyles(r);if(s&&s[e]!==void 0)return s[e]}if(n){const s=this.getViewportToolStyles(n);if(s){if(s[o]&&s[o][e]!==void 0)return s[o][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[o]&&s[o][e]!==void 0)return s[o][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const a=this.getDefaultToolStyles();if(a[o]&&a[o][e]!==void 0)return a[o][e];if(a.global&&a.global[e]!==void 0)return a.global[e]}_initializeConfig(e){const r={};for(const n in e)r[n]=e[n];this.config={default:{global:r}}}}const vx=new zre;function jre(t,e,r){const n=[`${t}`];return e&&n.push(`${n[0]}${e}`),r&&n.push(`${n[n.length-1]}${r}`),n}function Gi(t,e,r,n){const i=jre(t,r,n);for(let o=i.length-1;o>=0;--o){const a=vx.getStyleProperty(i[o],e);if(a!==void 0)return a}}const Hre="color",Kre=_a.Highlighted,Xre=_n.Active;class r0 extends Lh{constructor(e,r,n,i,o){super(e,r,n,i,o)}static getDefinedCursor(e,r=!1,n){n||(n=Gi(Hre,{},Kre,Xre));const i=qre(e,r,n);let o=super.getDefinedCursor(i);const a=Number(Gi("pointerStrokeWidth",{}));if(!o){const s=Wre(e);s&&(o=Yre(s,i,r,n,a,super.getDefinedCursor("default")),super.setDefinedCursor(i,o))}return o}}function vM(t,e){const r=Object(e),n=Object.prototype.hasOwnProperty.bind(r);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,o)=>n(o)?r[o]+"":"")}function qre(t,e,r){return`${e?"pointer":"cursor"}:${t}/${r}`}function Yre(t,e,r,n,i,o){const{x:a,y:s}=t.mousePoint;return new r0(Jre(t,r,{color:n,pointerStrokeWidth:i}),a,s,e,o)}function Jre(t,e,r){const n=Zre(t,e,r);return`${URL.createObjectURL(n)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function Zre(t,e,r){const n=(e?eie:Qre)(t,r);return new Blob([n],{type:"image/svg+xml"})}function Qre(t,e){const{iconContent:r,iconSize:n,viewBox:i}=t,o=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${n}" height="${n}" viewBox="0 0
      ${i.x} ${i.y}">
      ${r}
    </svg>`;return vM(o,e)}function eie(t,e){const{iconContent:r,iconSize:n,viewBox:i,mousePointerGroupString:o}=t,a=n/Math.max(i.x,i.y,1),s=16+n,c=e.pointerStrokeWidth||1,l=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g stroke-width="${c}">${o}</g>
      <g transform="translate(16, 16) scale(${a})">${r}</g>
    </svg>`;return vM(l,e)}const aE=Symbol("ElementCursorsMap");function yM(t,e){Nh(t)[0]=e,Tg(t,e)}function Tg(t,e){const r=Nh(t);r[1]=r[0],r[0]=e,t.style.cursor=(e instanceof ki?e:ki.getDefinedCursor("auto")).getStyleProperty()}function Vt(t){Tg(t,Nh(t)[1])}function St(t){Tg(t,ki.getDefinedCursor("none"))}function Nh(t){let e=Nh[aE];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(Nh,aE,{value:e}));let r=e.get(t);return r||(r=[null,null],e.set(t,r)),r}const tie=Object.freeze(Object.defineProperty({__proto__:null,hideElementCursor:St,initElementCursor:yM,resetElementCursor:Vt,setElementCursor:Tg},Symbol.toStringTag,{value:"Module"}));function nie(t,e){let r=r0.getDefinedCursor(e,!0);r||(r=ki.getDefinedCursor(e)),r||(console.log(`Cursor ${e} is not defined either as SVG or as a standard cursor.`),r=ki.getDefinedCursor(e)),Tg(t,r)}const rie=[...$re,...Ure],iie=Object.freeze(Object.defineProperty({__proto__:null,CursorNames:rie,CursorSVG:f2,ImageMouseCursor:Lh,MouseCursor:ki,SVGMouseCursor:r0,elementCursor:tie,registerCursor:Gre,setCursorForElement:nie},Symbol.toStringTag,{value:"Module"}));function Kr(t){return Ue.toolGroups.find(e=>e.id===t)}const{Active:pd,Passive:Yv,Enabled:Jv,Disabled:Zv}=_n,oie=[{mouseButton:Ss.Primary}];class yx{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const r=this._toolInstances[e];if(!r){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return r}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,r={}){const n=Ue.tools[e],i=typeof e<"u"&&e!=="",o=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",r);return}if(!n){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(o){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:a}=n,s={name:e,toolGroupId:this.id,configuration:r},c=new a(s);this._toolInstances[e]=c}addToolInstance(e,r,n={}){let i=Ue.tools[e]?.toolClass;if(!i){const o=Ue.tools[r].toolClass;class a extends o{}a.toolName=e,i=a,Ue.tools[e]={toolClass:a}}this.addTool(i.toolName,n)}addViewport(e,r){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const n=this._findRenderingEngine(e,r);this.viewportsInfo.some(({viewportId:a})=>a===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:n});const i=this.getActivePrimaryMouseButtonTool();this.setViewportsCursorByToolName(i);const o={toolGroupId:this.id,viewportId:e,renderingEngineId:n};Xe(ke,V.TOOLGROUP_VIEWPORT_ADDED,o)}removeViewports(e,r){const n=[];if(this.viewportsInfo.forEach((o,a)=>{let s=!1;o.renderingEngineId===e&&(s=!0,r&&o.viewportId!==r&&(s=!1)),s&&n.push(a)}),n.length)for(let o=n.length-1;o>=0;o--)this.viewportsInfo.splice(n[o],1);const i={toolGroupId:this.id,viewportId:r,renderingEngineId:e};Xe(ke,V.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,r){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}n.setActiveStrategy(r)}setToolMode(e,r,n={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(r===_n.Active){this.setToolActive(e,n||this.restoreToolOptions[e]);return}if(r===_n.Passive){this.setToolPassive(e);return}if(r===_n.Enabled){this.setToolEnabled(e);return}if(r===_n.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,r={}){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!n){console.warn(`'${e}' instance ${n} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],o=r.bindings?r.bindings:[],s={bindings:[...i,...o].reduce((l,f)=>{const u=f.numTouchPoints!==void 0,d=f.mouseButton!==void 0;return!l.some(h=>Qv(h,f))&&(u||d)&&l.push(f),l},[]),mode:pd};if(this.toolOptions[e]=s,this._toolInstances[e].mode=pd,this._hasMousePrimaryButtonBinding(r))this.setViewportsCursorByToolName(e),n.isPrimary=!0;else{if(!this.getActivePrimaryMouseButtonTool()){const f=ki.getDefinedCursor("default");this._setCursorForViewports(f)}n.isPrimary=!1}this._hasMousePrimaryButtonBinding(r)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof n.onSetToolActive=="function"&&n.onSetToolActive(),this._renderViewports();const c={toolGroupId:this.id,toolName:e,toolBindingsOptions:r};Xe(ke,V.TOOL_ACTIVATED,c),this._triggerToolModeChangedEvent(e,pd,r)}setToolPassive(e,r){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),o=Object.assign({bindings:i?i.bindings:[]},i,{mode:Yv}),a=Array.isArray(r?.removeAllBindings)?r.removeAllBindings:this.getDefaultPrimaryBindings();o.bindings=o.bindings.filter(c=>r?.removeAllBindings!==!0&&!a.some(l=>Qv(c,l)));let s=Yv;o.bindings.length!==0&&(s=pd,o.mode=s),this.toolOptions[e]=o,n.mode=s,n.isPrimary=!1,typeof n.onSetToolPassive=="function"&&n.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,Yv)}setToolEnabled(e){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:Jv};this.toolOptions[e]=n,r.mode=Jv,typeof r.onSetToolEnabled=="function"&&r.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,Jv)}setToolDisabled(e){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:Zv};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=n,r.mode=Zv,typeof r.onSetToolDisabled=="function"&&r.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,Zv)}getToolOptions(e){const r=this.toolOptions[e];if(r!==void 0)return r}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const r=this.toolOptions[e];return r.mode===pd&&this._hasMousePrimaryButtonBinding(r)})}setViewportsCursorByToolName(e,r){const n=this._getCursor(e,r);this._setCursorForViewports(n)}_getCursor(e,r){let n,i;return r&&(n=`${e}.${r}`,i=r0.getDefinedCursor(n,!0),i)||(n=`${e}`,i=r0.getDefinedCursor(n,!0),i)||(n=e,i=r0.getDefinedCursor(n,!0),i)?i:ki.getDefinedCursor("default")}_setCursorForViewports(e){or.getRuntimeSettings().get("useCursors")&&this.viewportsInfo.forEach(({renderingEngineId:n,viewportId:i})=>{const o=Ln(i,n);if(!o)return;const{viewport:a}=o;yM(a.element,e)})}setToolConfiguration(e,r,n){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let o;return n?o=r:o=Object.assign(i.configuration,r),i.configuration=o,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return Ss.Primary}getDefaultPrimaryBindings(){return oie}getToolConfiguration(e,r){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const n=Fre(this._toolInstances[e].configuration,r)||this._toolInstances[e].configuration;return na(n)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const r=this.getCurrentActivePrimaryToolName();this.setToolDisabled(r),this.setToolActive(e,{bindings:[{mouseButton:Ss.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,r=null){let n=Kr(e);return n?(console.debug(`ToolGroup ${e} already exists`),n):(n=new yx(e),Ue.toolGroups.push(n),r=r??(()=>!0),Object.keys(this._toolInstances).filter(r).forEach(i=>{const o=this._toolInstances[i],a=this.toolOptions[i],s=o.mode;n.addTool(i),n.setToolMode(i,s,{bindings:a.bindings??[]})}),n)}_hasMousePrimaryButtonBinding(e){const r=this.getDefaultPrimaryBindings();return e?.bindings?.some(n=>r.some(i=>Qv(n,i)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:r})=>{Bn(e).renderViewport(r)})}_triggerToolModeChangedEvent(e,r,n){const i={toolGroupId:this.id,toolName:e,mode:r,toolBindingsOptions:n};Xe(ke,V.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,r){const n=Bi();if(n?.length===0)throw new Error("No rendering engines found.");if(r)return r;const i=n.filter(o=>o.getViewport(e));if(i.length===0){if(n.length===1)return n[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function Qv(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function aie(t){if(Ue.toolGroups.some(n=>n.id===t)){console.warn(`'${t}' already exists.`);return}const r=new yx(t);return Ue.toolGroups.push(r),r}function wM(t){const e=Ue.toolGroups.findIndex(r=>r.id===t);e>-1&&Ue.toolGroups.splice(e,1)}function CM(){const t=[...Ue.toolGroups];for(const e of t)wM(e.id);Ue.toolGroups=[]}function lr(t,e){e||(e=Bi().find(n=>n.getViewports().find(i=>i.id===t))?.id);const r=Ue.toolGroups.filter(n=>n.viewportsInfo.some(i=>i.renderingEngineId===e&&(!i.viewportId||i.viewportId===t)));if(r.length){if(r.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return r[0]}}function sie(){return Ue.toolGroups}const cie=[_n.Active,_n.Passive,_n.Enabled];function xM(t){return Ue.toolGroups.filter(({toolOptions:e})=>{const r=Object.keys(e);for(let n=0;n<r.length;n++)if(t===r[n]&&e[t]&&cie.includes(e[t].mode))return!0;return!1})}const TM=Object.freeze(Object.defineProperty({__proto__:null,createToolGroup:aie,destroy:CM,destroyToolGroup:wM,getAllToolGroups:sie,getToolGroup:Kr,getToolGroupForViewport:lr,getToolGroupsWithToolName:xM},Symbol.toStringTag,{value:"Module"}));function SM(t,e){const r=Ce(e),{renderingEngine:n,viewportId:i}=r,o=V.ANNOTATION_ADDED,a={annotation:t,viewportId:i,renderingEngineId:n.id};Xe(ke,o,a)}function _M(t){const{toolName:e}=t.metadata,r=xM(e);if(!r.length)return;const n=[];r.forEach(a=>{a.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:l}=s,{FrameOfReferenceUID:f}=Ln(l,c);t.metadata.FrameOfReferenceUID===f&&n.push(s)})});const i=V.ANNOTATION_ADDED,o={annotation:t};if(!n.length){Xe(ke,i,o);return}n.forEach(({renderingEngineId:a,viewportId:s})=>{o.viewportId=s,o.renderingEngineId=a,Xe(ke,i,o)})}function d2(t){const e=V.ANNOTATION_REMOVED;Xe(ke,e,t)}function Gt(t,e,r=Nt.HandlesUpdated){const n=e&&Ce(e),{viewportId:i,renderingEngineId:o}=n||{},a=V.ANNOTATION_MODIFIED;Xe(ke,a,{annotation:t,viewportId:i,renderingEngineId:o,changeType:r})}function En(t){EM({annotation:t})}function h2(t,e=!1){EM({annotation:t,contourHoleProcessingEnabled:e})}function EM(t){const e=V.ANNOTATION_COMPLETED;Xe(ke,e,t)}const lie=Object.freeze(Object.defineProperty({__proto__:null,triggerAnnotationAddedForElement:SM,triggerAnnotationAddedForFOR:_M,triggerAnnotationCompleted:En,triggerAnnotationModified:Gt,triggerAnnotationRemoved:d2,triggerContourAnnotationCompleted:h2},Symbol.toStringTag,{value:"Module"}));let bM;function Ba(){return bM}function wx(t){bM=t}function $t(t,e){const r=Ba(),n=r.getGroupKey(e);return r.getAnnotations(n,t)}function vn(t){return Ba().getAnnotation(t)}function U0(){return Ba().getAllAnnotations()}function B0(t){const{annotationUID:e,parentAnnotationUID:r}=t;if(!r)return;const n=vn(r),i=n.childAnnotationUIDs.indexOf(e);n.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function Sg(t,e){const{annotationUID:r}=t,{annotationUID:n}=e;B0(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(n)&&(t.childAnnotationUIDs.push(n),e.parentAnnotationUID=r)}function DM(t){return t.parentAnnotationUID?vn(t.parentAnnotationUID):void 0}function _g(t){return t.childAnnotationUIDs?.map(e=>vn(e))??[]}function Ft(t,e){t.annotationUID||(t.annotationUID=un());const r=Ba();if(e instanceof HTMLDivElement){const n=r.getGroupKey(e);r.addAnnotation(t,n),SM(t,e)}else r.addAnnotation(t,void 0),_M(t);return t.annotationUID}function uie(t,e){const r=Ba(),n=r.getGroupKey(e);return r.getNumberOfAnnotations(n,t)}function kt(t){if(!t)return;const e=Ba(),r=e.getAnnotation(t);r&&(r.childAnnotationUIDs?.forEach(n=>kt(n)),e.removeAnnotation(t),d2({annotation:r,annotationManagerUID:e.uid}))}function fie(){const t=Ba(),e=t.removeAllAnnotations();for(const r of e)d2({annotation:r,annotationManagerUID:t.uid})}function die(t,e){const r=Ba(),n=r.getGroupKey(e),i=r.removeAnnotations(n,t);for(const o of i)d2({annotation:o,annotationManagerUID:r.uid})}function Cx(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?vn(e.parentAnnotationUID):void 0}const hie=Object.freeze(Object.defineProperty({__proto__:null,addAnnotation:Ft,addChildAnnotation:Sg,clearParentAnnotation:B0,getAllAnnotations:U0,getAnnotation:vn,getAnnotationManager:Ba,getAnnotations:$t,getChildAnnotations:_g,getNumberOfAnnotations:uie,getParentAnnotation:DM,invalidateAnnotation:Cx,removeAllAnnotations:fie,removeAnnotation:kt,removeAnnotations:die,setAnnotationManager:wx},Symbol.toStringTag,{value:"Module"}));function xx(t){const e=t.toolName;if(!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);Ue.tools[e]||(Ue.tools[e]={toolClass:t})}function gie(t){const e=t.toolName;return!!(e&&Ue.tools[e])}function g2(t){return!!(t&&Ue.tools[t])}function IM(t){const e=t.toolName;if(!e)throw new Error(`No tool found for: ${t.name}`);if(!Ue.tools[e]!==void 0)delete Ue.tools[e];else throw new Error(`${e} cannot be removed because it has not been added`)}function uf(t,e){const r=e||t.currentTarget,{viewport:n}=Ce(r)||{};if(!n)return;const i=vie(t),o=mie(t),a=pie(r,o),s=n.canvasToWorld(a);return{page:o,client:i,canvas:a,world:s}}function pie(t,e){const r=t.getBoundingClientRect();return[e[0]-r.left-window.pageXOffset,e[1]-r.top-window.pageYOffset]}function mie(t){return[t.pageX,t.pageY]}function vie(t){return[t.clientX,t.clientY]}function MM(t){const e=t.currentTarget,{viewportId:r,renderingEngineId:n}=Ce(e),i=uf(t,e),o={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},a={event:t,eventName:V.MOUSE_DOUBLE_CLICK,viewportId:r,renderingEngineId:n,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:o};!Xe(e,V.MOUSE_DOUBLE_CLICK,a)&&(t.stopImmediatePropagation(),t.preventDefault())}const sE=V.MOUSE_MOVE;function Eg(t){const e=t.currentTarget,r=Ce(e);if(!r)return;const{renderingEngineId:n,viewportId:i}=r,o=uf(t);!Xe(e,sE,{renderingEngineId:n,viewportId:i,camera:{},element:e,currentPoints:o,eventName:sE,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:cE,MOUSE_DOWN_ACTIVATE:yie,MOUSE_CLICK:wie,MOUSE_UP:Cie,MOUSE_DRAG:lE}=V,xie=400,Tie=150,Sie=3,_ie={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let Bt={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const zr={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function OM(t){if(zr.doubleClickTimeout){if(t.buttons===zr.mouseDownEvent.buttons)return;zr.mouseDownEvent=t,t1();return}zr.doubleClickTimeout=setTimeout(t1,t.buttons===1?xie:Tie),zr.mouseDownEvent=t,zr.ignoreDoubleClick=!1,Bt.element=t.currentTarget,Bt.mouseButton=t.buttons;const e=Ce(Bt.element),{renderingEngineId:r,viewportId:n}=e;Bt.renderingEngineId=r,Bt.viewportId=n,Bt.preventClickTimeout=setTimeout(bie,Bt.clickDelay),Bt.element.removeEventListener("mousemove",Eg);const i=uf(t,Bt.element);Bt.startPoints=_l(i),Bt.lastPoints=_l(i),document.addEventListener("mouseup",Tx),document.addEventListener("mousemove",PM)}function Eie(t){const e=p2(Bt.startPoints,Bt.startPoints),r={event:t,eventName:cE,element:Bt.element,mouseButton:Bt.mouseButton,renderingEngineId:Bt.renderingEngineId,viewportId:Bt.viewportId,camera:{},startPoints:Bt.startPoints,lastPoints:Bt.startPoints,currentPoints:Bt.startPoints,deltaPoints:e};Bt.lastPoints=_l(r.lastPoints),Xe(r.element,cE,r)&&Xe(r.element,yie,r)}function PM(t){if(!Ce(Bt.element)?.viewport)return;const r=uf(t,Bt.element),n=NM(Bt.element,Bt.lastPoints),i=p2(r,n);if(zr.doubleClickTimeout)if(AM(i.canvas))t1();else return;const o={event:t,eventName:lE,mouseButton:Bt.mouseButton,renderingEngineId:Bt.renderingEngineId,viewportId:Bt.viewportId,camera:{},element:Bt.element,startPoints:_l(Bt.startPoints),lastPoints:_l(n),currentPoints:r,deltaPoints:i};!Xe(Bt.element,lE,o)&&(t.stopImmediatePropagation(),t.preventDefault()),Bt.lastPoints=_l(r)}function Tx(t){if(clearTimeout(Bt.preventClickTimeout),zr.doubleClickTimeout)zr.mouseUpEvent?R5():(zr.mouseUpEvent=t,Bt.element.addEventListener("mousemove",RM));else{const e=Bt.isClickEvent?wie:Cie,r=uf(t,Bt.element),n=p2(r,Bt.lastPoints),i={event:t,eventName:e,mouseButton:Bt.mouseButton,element:Bt.element,renderingEngineId:Bt.renderingEngineId,viewportId:Bt.viewportId,camera:{},startPoints:_l(Bt.startPoints),lastPoints:_l(Bt.lastPoints),currentPoints:r,deltaPoints:n};Xe(i.element,e,i),R5()}document.removeEventListener("mousemove",PM)}function RM(t){const e=uf(t,Bt.element),r=NM(Bt.element,Bt.lastPoints),n=p2(e,r);AM(n.canvas)&&(t1(),Eg(t))}function AM(t){return Math.abs(t[0])+Math.abs(t[1])>Sie}function bie(){Bt.isClickEvent=!1}function t1(){zr.ignoreDoubleClick=!0;const t=zr.mouseDownEvent,e=zr.mouseUpEvent;LM(),Eie(t),e&&Tx(e)}function LM(){zr.doubleClickTimeout&&(clearTimeout(zr.doubleClickTimeout),zr.doubleClickTimeout=null),zr.mouseDownEvent=null,zr.mouseUpEvent=null}function R5(){document.removeEventListener("mouseup",Tx),Bt.element?.removeEventListener("mousemove",RM),Bt.element?.addEventListener("mousemove",Eg),LM(),Bt=JSON.parse(JSON.stringify(_ie))}function _l(t){return JSON.parse(JSON.stringify(t))}function NM(t,e){const{viewport:r}=Ce(t)||{};if(!r)return e;const n=r.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:n}}function p2(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:ey(t.page,e.page),client:ey(t.client,e.client),canvas:ey(t.canvas,e.canvas),world:Die(t.world,e.world)}}function ey(t,e){return[t[0]-e[0],t[1]-e[1]]}function Die(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function Iie(){return Bt.mouseButton}function VM(t){zr.ignoreDoubleClick?(zr.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):R5()}function kM(t){t.removeEventListener("dblclick",MM),t.removeEventListener("mousedown",OM),t.removeEventListener("mousemove",Eg),t.removeEventListener("dblclick",VM,{capture:!0})}function Mie(t){kM(t),t.addEventListener("dblclick",MM),t.addEventListener("mousedown",OM),t.addEventListener("mousemove",Eg),t.addEventListener("dblclick",VM,{capture:!0})}const FM={enable:Mie,disable:kM},Oie=2e3,T0={mouse:0,touch:1};let uE,fE;function UM(t,e){const r=Date.now();if(t!==uE){if(r-fE<=Oie)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;uE=t}fE=r}const BM=UM.bind(null,T0.mouse),GM=UM.bind(null,T0.touch);function dE(t,e,r){const n=r?BM:GM;e.forEach(function(i){t.addEventListener(i,n,{passive:!1})})}function hE(t,e,r){const n=r?BM:GM;e.forEach(function(i){t.removeEventListener(i,n)})}const WM=["mousedown","mouseup","mousemove"],$M=["touchstart","touchend"];function zM(t){hE(t,WM,T0.mouse),hE(t,$M,T0.touch)}function Pie(t){zM(t),dE(t,WM,T0.mouse),dE(t,$M,T0.touch)}const jM={enable:Pie,disable:zM};function m2(t,e){const r=e||t.currentTarget,n=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(n).map(i=>{const o=Lie(n[i]),a=Aie(n[i]),s=Rie(r,a),{viewport:c}=Ce(r),l=c.canvasToWorld(s);return{page:a,client:o,canvas:s,world:l,touch:{identifier:i,radiusX:n[i].radiusX,radiusY:n[i].radiusY,force:n[i].force,rotationAngle:n[i].rotationAngle}}})}function Rie(t,e){const r=t.getBoundingClientRect();return[e[0]-r.left-window.pageXOffset,e[1]-r.top-window.pageYOffset]}function Aie(t){return[t.pageX,t.pageY]}function Lie(t){return[t.clientX,t.clientY]}function n1(t,e){const r=Vh(t),n=Vh(e);return{page:ty(r.page,n.page),client:ty(r.client,n.client),canvas:ty(r.canvas,n.canvas),world:Vie(r.world,n.world)}}function Sx(t,e){const r=Vh(t),n=Vh(e);return{page:i0(r.page,n.page),client:i0(r.client,n.client),canvas:i0(r.canvas,n.canvas),world:HM(r.world,n.world)}}function Nie(t,e){}function r1(t,e){const r=gE(t),n=gE(e);return{page:r.page-n.page,client:r.client-n.client,canvas:r.canvas-n.canvas,world:r.world-n.world}}function vs(t){return JSON.parse(JSON.stringify(t))}function A5(t){return JSON.parse(JSON.stringify(t))}function Vh(t){return t.reduce((e,r)=>({page:[e.page[0]+r.page[0]/t.length,e.page[1]+r.page[1]/t.length],client:[e.client[0]+r.client[0]/t.length,e.client[1]+r.client[1]/t.length],canvas:[e.canvas[0]+r.canvas[0]/t.length,e.canvas[1]+r.canvas[1]/t.length],world:[e.world[0]+r.world[0]/t.length,e.world[1]+r.world[1]/t.length,e.world[2]+r.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function Pa(t){return t.reduce((e,r)=>({page:[e.page[0]+r.page[0]/t.length,e.page[1]+r.page[1]/t.length],client:[e.client[0]+r.client[0]/t.length,e.client[1]+r.client[1]/t.length],canvas:[e.canvas[0]+r.canvas[0]/t.length,e.canvas[1]+r.canvas[1]/t.length],world:[e.world[0]+r.world[0]/t.length,e.world[1]+r.world[1]/t.length,e.world[2]+r.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+r.touch.radiusX/t.length,radiusY:e.touch.radiusY+r.touch.radiusY/t.length,force:e.touch.force+r.touch.force/t.length,rotationAngle:e.touch.rotationAngle+r.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function ty(t,e){return[t[0]-e[0],t[1]-e[1]]}function Vie(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function gE(t){const e=[];for(let r=0;r<t.length;r++)for(let n=0;n<t.length;n++)r<n&&e.push({page:i0(t[r].page,t[n].page),client:i0(t[r].client,t[n].client),canvas:i0(t[r].canvas,t[n].canvas),world:HM(t[r].world,t[n].world)});return e.reduce((r,n)=>({page:r.page+n.page/e.length,client:r.client+n.client/e.length,canvas:r.canvas+n.canvas/e.length,world:r.world+n.world/e.length}),{page:0,client:0,canvas:0,world:0})}function i0(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function HM(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}const kie=Object.freeze(Object.defineProperty({__proto__:null,copyPoints:A5,copyPointsList:vs,getDeltaDistance:Sx,getDeltaDistanceBetweenIPoints:r1,getDeltaPoints:n1,getDeltaRotation:Nie,getMeanPoints:Vh,getMeanTouchPoints:Pa},Symbol.toStringTag,{value:"Module"}));or.getRuntimeSettings();const{TOUCH_START:pE,TOUCH_START_ACTIVATE:Fie,TOUCH_PRESS:mE,TOUCH_DRAG:vE,TOUCH_END:yE,TOUCH_TAP:wE,TOUCH_SWIPE:ny}=V,kh={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},i1={page:0,client:0,canvas:0,world:0},KM={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...kh,touch:null}],lastPointsList:[{...kh,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:i1,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},XM={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...kh,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let Et=JSON.parse(JSON.stringify(KM)),Dr=JSON.parse(JSON.stringify(XM));function Pl(t,e,r){return Xe(t,e,r)}function qM(t){Et.element=t.currentTarget;const e=Ce(Et.element),{renderingEngineId:r,viewportId:n}=e;Et.renderingEngineId=r,Et.viewportId=n,!Et.isTouchStart&&(clearTimeout(Et.pressTimeout),Et.pressTimeout=setTimeout(()=>Uie(t),Et.pressDelay),Bie(t),document.addEventListener("touchmove",YM),document.addEventListener("touchend",JM))}function Uie(t){if(Et.accumulatedDistance.canvas>Et.pressMaxDistance)return;const r={event:t,eventName:mE,renderingEngineId:Et.renderingEngineId,viewportId:Et.viewportId,camera:{},element:Et.element,startPointsList:vs(Et.startPointsList),lastPointsList:vs(Et.lastPointsList),startPoints:A5(Pa(Et.startPointsList)),lastPoints:A5(Pa(Et.lastPointsList))};Pl(r.element,mE,r)}function Bie(t){Et.isTouchStart=!0,Et.startTime=new Date;const e=m2(t,Et.element),r=Pa(e),n=kh,i=i1,o={event:t,eventName:pE,element:Et.element,renderingEngineId:Et.renderingEngineId,viewportId:Et.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:r,lastPoints:r,currentPoints:r,deltaPoints:n,deltaDistance:i};Et.startPointsList=vs(o.startPointsList),Et.lastPointsList=vs(o.lastPointsList),Pl(o.element,pE,o)&&Pl(o.element,Fie,o)}function YM(t){const e=m2(t,Et.element),r=ZM(Et.element,Et.lastPointsList),n=e.length===r.length?n1(e,r):kh,i=e.length===r.length?r1(e,r):i1,o=e.length===r.length?Sx(e,Et.lastPointsList):i1;Et.accumulatedDistance={page:Et.accumulatedDistance.page+o.page,client:Et.accumulatedDistance.client+o.client,canvas:Et.accumulatedDistance.canvas+o.canvas,world:Et.accumulatedDistance.world+o.world};const a={event:t,eventName:vE,renderingEngineId:Et.renderingEngineId,viewportId:Et.viewportId,camera:{},element:Et.element,startPoints:Pa(Et.startPointsList),lastPoints:Pa(r),currentPoints:Pa(e),startPointsList:vs(Et.startPointsList),lastPointsList:vs(r),currentPointsList:e,deltaPoints:n,deltaDistance:i};Pl(Et.element,vE,a),Wie(t,n),Et.lastPointsList=vs(e)}function JM(t){clearTimeout(Et.pressTimeout);const e=m2(t,Et.element),r=ZM(Et.element,Et.lastPointsList),n=e.length===r.length?n1(e,r):n1(e,e),i=e.length===r.length?r1(e,r):r1(e,e),o={event:t,eventName:yE,element:Et.element,renderingEngineId:Et.renderingEngineId,viewportId:Et.viewportId,camera:{},startPointsList:vs(Et.startPointsList),lastPointsList:vs(r),currentPointsList:e,startPoints:Pa(Et.startPointsList),lastPoints:Pa(r),currentPoints:Pa(e),deltaPoints:n,deltaDistance:i};Pl(o.element,yE,o),Gie(t),Et=JSON.parse(JSON.stringify(KM)),document.removeEventListener("touchmove",YM),document.removeEventListener("touchend",JM)}function Gie(t){const e=new Date().getTime(),r=Et.startTime.getTime();if(e-r>Dr.tapToleranceMs||(Dr.taps===0&&(Dr.element=Et.element,Dr.renderingEngineId=Et.renderingEngineId,Dr.viewportId=Et.viewportId,Dr.startPointsList=Et.startPointsList),Dr.taps>0&&!(Dr.element==Et.element&&Dr.renderingEngineId==Et.renderingEngineId&&Dr.viewportId==Et.viewportId)))return;const n=m2(t,Dr.element);Sx(n,Dr.startPointsList).canvas>Dr.tapMaxDistance||(clearTimeout(Dr.tapTimeout),Dr.taps+=1,Dr.tapTimeout=setTimeout(()=>{const o={event:t,eventName:wE,element:Dr.element,renderingEngineId:Dr.renderingEngineId,viewportId:Dr.viewportId,camera:{},currentPointsList:n,currentPoints:Pa(n),taps:Dr.taps};Pl(o.element,wE,o),Dr=JSON.parse(JSON.stringify(XM))},Dr.tapToleranceMs))}function Wie(t,e){const r=new Date().getTime(),n=Et.startTime.getTime();if(Et.swiped||r-n>Et.swipeToleranceMs)return;const[i,o]=e.canvas,a={event:t,eventName:ny,renderingEngineId:Et.renderingEngineId,viewportId:Et.viewportId,camera:{},element:Et.element,swipe:null};Math.abs(i)>Et.swipeDistanceThreshold&&(a.swipe=i>0?Vu.RIGHT:Vu.LEFT,Pl(a.element,ny,a),Et.swiped=!0),Math.abs(o)>Et.swipeDistanceThreshold&&(a.swipe=o>0?Vu.DOWN:Vu.UP,Pl(a.element,ny,a),Et.swiped=!0)}function ZM(t,e){const{viewport:r}=Ce(t);return e.map(n=>{const i=r.canvasToWorld(n.canvas);return{page:n.page,client:n.client,canvas:n.canvas,world:i,touch:n.touch}})}function QM(t){jM.disable(t),t.removeEventListener("touchstart",qM)}function $ie(t){QM(t),jM.enable(t),t.addEventListener("touchstart",qM,{passive:!1})}const eO={enable:$ie,disable:QM},CE=10,xE=40,TE=800;function zie(t){let e=0,r=0,n=0,i=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),n=e*CE,i=r*CE,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||i)&&t.deltaMode&&(t.deltaMode===1?(n*=xE,i*=xE):(n*=TE,i*=TE)),n&&!e&&(e=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:i}}function tO(t){const e=t.currentTarget,r=Ce(e),{renderingEngineId:n,viewportId:i}=r;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:o,spinY:a,pixelX:s,pixelY:c}=zie(t),l=a<0?-1:1,f={event:t,eventName:V.MOUSE_WHEEL,renderingEngineId:n,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:o,spinY:a,pixelX:s,pixelY:c,direction:l},points:uf(t)};Xe(e,V.MOUSE_WHEEL,f)}function jie(t){nO(t),t.addEventListener("wheel",tO,{passive:!1})}function nO(t){t.removeEventListener("wheel",tO)}const rO={enable:jie,disable:nO},Hie={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Ar={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function v2(t){Ar.element=t.currentTarget;const e=Ce(Ar.element),{renderingEngineId:r,viewportId:n}=e;Ar.renderingEngineId=r,Ar.viewportId=n,Ar.key=t.key,Ar.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:Ar.renderingEngineId,viewportId:Ar.viewportId,element:Ar.element,key:Ar.key,keyCode:Ar.keyCode};Xe(i.element,V.KEY_DOWN,i),document.addEventListener("keyup",iO),document.addEventListener("visibilitychange",_x),Ar.element.removeEventListener("keydown",v2)}function _x(){document.removeEventListener("visibilitychange",_x),document.visibilityState==="hidden"&&oO()}function iO(t){const e={renderingEngineId:Ar.renderingEngineId,viewportId:Ar.viewportId,element:Ar.element,key:Ar.key,keyCode:Ar.keyCode};document.removeEventListener("keyup",iO),document.removeEventListener("visibilitychange",_x),Ar.element.addEventListener("keydown",v2),Ar=structuredClone(Hie),Xe(e.element,V.KEY_UP,e)}function Kie(){return Ar.keyCode}function oO(){Ar.keyCode=void 0}function Xie(t){aO(t),t.addEventListener("keydown",v2)}function aO(t){t.removeEventListener("keydown",v2)}const G0={enable:Xie,disable:aO,getModifierKey:Kie},{EPSILON:_f}=Mc;function sO(t,e,r=!1){let n=1/0,i=r?-1/0:0,o=1/0,a=r?-1/0:0,s=1/0,c=r?-1/0:0;const l=t[0]?.length===3;for(let f=0;f<t.length;f++){const u=t[f];n=Math.min(u[0],n),i=Math.max(u[0],i),o=Math.min(u[1],o),a=Math.max(u[1],a),l&&(s=Math.min(u[2]??s,s),c=Math.max(u[2]??c,c))}return e?(n=Math.max(r?e[0]+_f:0,n),i=Math.min(r?e[0]-_f:e[0]-1,i),o=Math.max(r?e[1]+_f:0,o),a=Math.min(r?e[1]-_f:e[1]-1,a),l&&e.length===3&&(s=Math.max(r?e[2]+_f:0,s),c=Math.min(r?e[2]-_f:e[2]-1,c))):r||(n=Math.max(0,n),i=Math.min(1/0,i),o=Math.max(0,o),a=Math.min(1/0,a),l&&(s=Math.max(0,s),c=Math.min(1/0,c))),l?[[n,i],[o,a],[s,c]]:[[n,i],[o,a],null]}function Rl(t,e){return sO(t,e,!1)}function qie(t,e){return sO(t,e,!0)}const Yie=(t,e)=>JSON.stringify(t)===JSON.stringify(e);function Ex(t,e,r,n){const i=r[0]/2,o=r[1]/2,a=r[2]/2,s=new Array(8);s[0]=Lr(t,[n[0]-i,n[1]-o,n[2]-a]);const c=[[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]];for(let l=0;l<7;l++){const[f,u,d]=c[l];s[l+1]=Lr(t,[n[0]+f*i,n[1]+u*o,n[2]+d*a])}return Rl(s,e)}function cO(t,e){const{spacing:r}=t,n=t.voxelManager.getScalarDataLength(),i=[];let o=0;for(let a=0;a<e.length;a++){const{imageData:s,spacing:c,dimensions:l,voxelManager:f}=e[a].volume,u=e[a].volume.voxelManager.getScalarDataLength();u===n&&Yie(c,r)&&(o=a);const d=e[a].lower,h=e[a].upper;i.push({imageData:s,lower:d,upper:h,spacing:c,dimensions:l,volumeSize:u,voxelManager:f})}return{volumeInfoList:i,baseVolumeIdx:o}}const bx=new Map,Jie=t=>{const e=bx.get(t);e&&(e.isDirty=!0)},Zie=t=>{const e=bx.get(t);return e&&!e.isDirty?e.indices:null},Qie=(t,e)=>{bx.set(t,{indices:e,isDirty:!1})};function ui(t,e,r){const n={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:r};Jie(t),Xe(ke,V.SEGMENTATION_DATA_MODIFIED,n)}function la(t){const e={segmentationId:t};Xe(ke,V.SEGMENTATION_MODIFIED,e)}function Dx(t){const e={segmentationId:t};Xe(ke,V.SEGMENTATION_REMOVED,e)}function us(t,e,r){const n={segmentationId:e,type:r,viewportId:t};Xe(ke,V.SEGMENTATION_REPRESENTATION_MODIFIED,n)}function L5(t,e,r){const n={viewportId:t,segmentationId:e,type:r};Xe(ke,V.SEGMENTATION_REPRESENTATION_REMOVED,n)}const eoe=Object.freeze(Object.defineProperty({__proto__:null,triggerSegmentationDataModified:ui,triggerSegmentationModified:la,triggerSegmentationRemoved:Dx,triggerSegmentationRepresentationModified:us,triggerSegmentationRepresentationRemoved:L5},Symbol.toStringTag,{value:"Module"})),toe={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function noe(){return toe}const roe={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function ioe(){return roe}class ooe{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,r,n=!0){const{viewportId:i,segmentationId:o,type:a,segmentIndex:s}=e,c=this.getStyle(e),l=n?{...c,...r}:r;let f;if(!i&&!o?f=l:n?f=this.copyActiveToInactiveIfNotProvided(l,a):f=l,!a)throw new Error("Type is required to set a style");if(i){this.config.viewportsStyle[i]||(this.config.viewportsStyle[i]={renderInactiveSegmentations:!1,representations:{}});const u=this.config.viewportsStyle[i].representations;if(o){u[o]||(u[o]={}),u[o][a]||(u[o][a]={});const d=u[o][a];s!==void 0?(d.perSegment||(d.perSegment={}),d.perSegment[s]=f):d.allSegments=f}else{const d="__allSegmentations__";u[d]||(u[d]={}),u[d][a]||(u[d][a]={}),u[d][a].allSegments=f}}else if(o){this.config.segmentations[o]||(this.config.segmentations[o]={}),this.config.segmentations[o][a]||(this.config.segmentations[o][a]={});const u=this.config.segmentations[o][a];s!==void 0?(u.perSegment||(u.perSegment={}),u.perSegment[s]=f):u.allSegments=f}else this.config.global[a]=f}copyActiveToInactiveIfNotProvided(e,r){const n={...e};if(r===yt.Labelmap){const i=n;i.renderOutlineInactive??=i.renderOutline,i.outlineWidthInactive??=i.outlineWidth,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha,i.outlineOpacityInactive??=i.outlineOpacity}else if(r===yt.Contour){const i=n;i.outlineWidthInactive??=i.outlineWidth,i.outlineOpacityInactive??=i.outlineOpacity,i.outlineDashInactive??=i.outlineDash,i.renderOutlineInactive??=i.renderOutline,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha}return n}getStyle(e){const{viewportId:r,segmentationId:n,type:i,segmentIndex:o}=e;let a=this.getDefaultStyle(i);if(this.config.global[i]&&(a={...a,...this.config.global[i]}),this.config.segmentations[n]?.[i]&&(a={...a,...this.config.segmentations[n][i].allSegments},o!==void 0&&this.config.segmentations[n][i].perSegment?.[o]&&(a={...a,...this.config.segmentations[n][i].perSegment[o]})),r&&this.config.viewportsStyle[r]){this.config.viewportsStyle[r].renderInactiveSegmentations;const s="__allSegmentations__";this.config.viewportsStyle[r].representations[s]?.[i]&&(a={...a,...this.config.viewportsStyle[r].representations[s][i].allSegments}),n&&this.config.viewportsStyle[r].representations[n]?.[i]&&(a={...a,...this.config.viewportsStyle[r].representations[n][i].allSegments},o!==void 0&&this.config.viewportsStyle[r].representations[n][i].perSegment?.[o]&&(a={...a,...this.config.viewportsStyle[r].representations[n][i].perSegment[o]}))}return a}getRenderInactiveSegmentations(e){return this.config.viewportsStyle[e]?.renderInactiveSegmentations}setRenderInactiveSegmentations(e,r){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=r}getDefaultStyle(e){switch(e){case yt.Labelmap:return ioe();case yt.Contour:return noe();case yt.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const n=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:n,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:r}=e,n=this.getStyle(e),i=this.getDefaultStyle(r);return!N7(n,i)}}const fo=new ooe;function aoe(t){const e={segmentationId:t};Xe(ke,V.SEGMENTATION_ADDED,e)}const SE={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class soe{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,this._labelmapImageIdReferenceMap=new Map,e||=un(),this.state=Object.freeze(na(SE)),this.uid=e}getState(){return this.state}updateState(e){const r=na(this.state);e(r),this.state=Object.freeze(r)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this._stackLabelmapImageIdReferenceMap.clear(),this._labelmapImageIdReferenceMap.clear(),this.state=Object.freeze(na(SE))}getSegmentation(e){return this.state.segmentations.find(r=>r.segmentationId===e)}updateSegmentation(e,r){this.updateState(n=>{const i=n.segmentations.find(o=>o.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,r)}),la(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(r=>{const n=na(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const i=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=i}r.segmentations.push(n)}),aoe(e.segmentationId)}removeSegmentation(e){this.updateState(r=>{const n=r.segmentations.filter(i=>i.segmentationId!==e);r.segmentations.splice(0,r.segmentations.length,...n)}),Dx(e)}addSegmentationRepresentation(e,r,n,i){if(!xn(e))return;if(this.getSegmentationRepresentations(e,{type:n,segmentationId:r}).length>0){console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",r);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],fo.setRenderInactiveSegmentations(e,!0)),n!==yt.Labelmap?this.addDefaultSegmentationRepresentation(s,e,r,n,i):this.addLabelmapRepresentation(s,e,r,i)}),us(e,r,n)}addDefaultSegmentationRepresentation(e,r,n,i,o){const a=e.segmentations.find(c=>c.segmentationId===n);if(!a)return;const s={};Object.keys(a.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[r].push({segmentationId:n,type:i,active:!0,visible:!0,colorLUTIndex:o?.colorLUTIndex||0,segments:s,config:{..._E(i),...o}}),this._setActiveSegmentation(e,r,n)}addLabelmapRepresentation(e,r,n,i=_E(yt.Labelmap)){if(!xn(r))return;const a=this.getSegmentation(n);if(!a)return;const{representationData:s}=a;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,r,n,yt.Labelmap,i);this.processLabelmapRepresentationAddition(r,n),this.addDefaultSegmentationRepresentation(e,r,n,yt.Labelmap,i)}async processLabelmapRepresentationAddition(e,r){const n=xn(e);if(!n)return;const i=this.getSegmentation(r);if(!i)return;const o=n.viewport instanceof ir,{representationData:a}=i,s="volumeId"in a.Labelmap;n.viewport,!o&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,r,n,i){const o=r.getCurrentImageId();let a=!1;for(const s of n)r.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(a=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(o,s),this._updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:o,labelmapImageId:s}));return i&&i(r,e,n),a?this._stackLabelmapImageIdReferenceMap.get(e).get(o):void 0}updateLabelmapSegmentationImageReferences(e,r){const n=this.getSegmentation(r);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(r)||this._stackLabelmapImageIdReferenceMap.set(r,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const o=this.getLabelmapImageIds(i),s=xn(e).viewport;return this._updateLabelmapSegmentationReferences(r,s,o,null)}_updateAllLabelmapSegmentationImageReferences(e,r){const n=this.getSegmentation(r);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(r)||this._stackLabelmapImageIdReferenceMap.set(r,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const o=this.getLabelmapImageIds(i),s=xn(e).viewport;this._updateLabelmapSegmentationReferences(r,s,o,(c,l,f)=>{c.getImageIds().forEach((d,h)=>{for(const g of f)c.isReferenceViewable({referencedImageId:g,sliceIndex:h},{asOverlay:!0,withNavigation:!0})&&(this._stackLabelmapImageIdReferenceMap.get(l).set(d,g),this._updateLabelmapImageIdReferenceMap({segmentationId:l,referenceImageId:d,labelmapImageId:g}))})})}getLabelmapImageIds(e){const r=e.Labelmap;let n;if(r.imageIds)n=r.imageIds;else if(!n&&r.volumeId){const i=r.volumeId;n=Ae.getVolume(i).imageIds}return n}getLabelmapImageIdsForImageId(e,r){const n=this._generateMapKey({segmentationId:r,referenceImageId:e});return this._labelmapImageIdReferenceMap.get(n)}getCurrentLabelmapImageIdsForViewport(e,r){const n=xn(e);if(!n)return;const o=n.viewport.getCurrentImageId();return this.getLabelmapImageIdsForImageId(o,r)}getCurrentLabelmapImageIdForViewport(e,r){const n=xn(e);if(!n||!this._stackLabelmapImageIdReferenceMap.has(r))return;const o=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(r).get(o)}getStackSegmentationImageIdsForViewport(e,r){if(!this.getSegmentation(r))return[];this._updateAllLabelmapSegmentationImageReferences(e,r);const{viewport:i}=xn(e),o=i.getImageIds(),a=this._stackLabelmapImageIdReferenceMap.get(r);return o.map(s=>a.get(s))}removeSegmentationRepresentationsInternal(e,r){const n=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const o=i.viewportSegRepresentations[e];let a=!1;if(!r||Object.values(r).every(s=>s===void 0))n.push(...o),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=r;i.viewportSegRepresentations[e]=o.filter(l=>{const f=s&&c&&l.segmentationId===s&&l.type===c||s&&!c&&l.segmentationId===s||!s&&c&&l.type===c;return f&&(n.push(l),l.active&&(a=!0)),!f}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:a&&(i.viewportSegRepresentations[e][0].active=!0)}}),n}removeSegmentationRepresentations(e,r){const n=this.removeSegmentationRepresentationsInternal(e,r);n.forEach(o=>{L5(e,o.segmentationId,o.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&us(e,i[0].segmentationId,i[0].type),n}removeSegmentationRepresentation(e,r,n){const i=this.removeSegmentationRepresentationsInternal(e,r);return n||i.forEach(({segmentationId:o,type:a})=>{L5(e,o,a)}),i}_updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:r,labelmapImageId:n}){const i=this._generateMapKey({segmentationId:e,referenceImageId:r});if(!this._labelmapImageIdReferenceMap.has(i)){this._labelmapImageIdReferenceMap.set(i,[n]);return}const o=this._labelmapImageIdReferenceMap.get(i),a=Array.from(new Set([...o,n]));this._labelmapImageIdReferenceMap.set(i,a)}_setActiveSegmentation(e,r,n){const i=e.viewportSegRepresentations[r];i&&i.forEach(o=>{o.active=o.segmentationId===n})}setActiveSegmentation(e,r){this.updateState(n=>{const i=n.viewportSegRepresentations[e];i&&i.forEach(o=>{o.active=o.segmentationId===r})}),us(e,r)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const r=this.state.viewportSegRepresentations[e].find(n=>n.active);if(r)return this.getSegmentation(r.segmentationId)}getSegmentationRepresentations(e,r={}){const n=this.state.viewportSegRepresentations[e];return n?!r.type&&!r.segmentationId?n:n.filter(i=>{const o=r.type?i.type===r.type:!0,a=r.segmentationId?i.segmentationId===r.segmentationId:!0;return o&&a}):[]}getSegmentationRepresentation(e,r){return this.getSegmentationRepresentations(e,r)[0]}getSegmentationRepresentationVisibility(e,r){return this.getSegmentationRepresentation(e,r)?.visible}setSegmentationRepresentationVisibility(e,r,n){this.updateState(i=>{const o=this.getSegmentationRepresentations(e,r);o&&o.forEach(a=>{a.visible=n,Object.entries(a.segments).forEach(([s,c])=>{c.visible=n})})}),us(e,r.segmentationId,r.type)}addColorLUT(e,r){this.updateState(n=>{n.colorLUT[r]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[r]=na(e)})}removeColorLUT(e){this.updateState(r=>{delete r.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(r=>r.slice(-Math.round(r.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,r])=>({viewportId:e,representations:r}))}getSegmentationRepresentationsBySegmentationId(e){const r=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([n,i])=>{const o=i.filter(a=>a.segmentationId===e);o.length>0&&r.push({viewportId:n,representations:o})}),r}_generateMapKey({segmentationId:e,referenceImageId:r}){return`${e}-${r}`}}async function lO({imageIds:t,options:e}){const r=t,n=e?.volumeId||un();return await WC(n,r),{volumeId:n}}async function coe({segmentationId:t,options:e}){const r=An.getSegmentation(t),n=r.representationData.Labelmap,{volumeId:i}=await lO({imageIds:n.imageIds,options:e});r.representationData.Labelmap.volumeId=i}function _E(t){const e=Cc.newInstance(),r=qu.newInstance();return r.addPoint(0,0),t===yt.Labelmap?{cfun:e,ofun:r}:{}}const An=new soe("DEFAULT");function Ut(t){return An.getSegmentation(t)}function ho(t,e={}){return An.getSegmentationRepresentations(t,e)}function Ix(t,e){const r=An;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");return r.getSegmentationRepresentations(t,e)?.[0]}function uO(t){return An.getSegmentationRepresentationsBySegmentationId(t)}function loe(t,e){const r=Ce(t),{viewport:n}=r,o=n.getActors().filter(a=>a.representationUID&&typeof a.representationUID=="string"&&a.representationUID.startsWith(e));n.removeActors(o.map(a=>a.uid))}function fO(t,e,r){const n=xn(t);if(!n)return;const{renderingEngine:i,viewport:o}=n;if(!i||!o)return;const s=o.getActors().filter(r);return s.length>0?s[0]:void 0}function uoe(t,e){const r=xn(t);if(!r)return;const{renderingEngine:n,viewport:i}=r;if(!n||!i)return;const a=i.getActors().filter(e);return a.length>0?a:void 0}function foe(t,e){return y2(t,e)?.uid}function Kd(t,e){return uoe(t,r=>r.representationUID?.startsWith(`${e}-${yt.Labelmap}`))}function y2(t,e){return fO(t,e,r=>r.representationUID?.startsWith(`${e}-${yt.Labelmap}`))}function doe(t,e,r){return fO(t,e,n=>n.representationUID===dO(e,r))}function dO(t,e){return`${t}-${yt.Surface}-${e}`}function hoe(t,e,r){const i=doe(t.id,r,e.segmentIndex)?.actor,o=e.visible;if(i){if(i.setVisibility(o),!o)return;const p=i.getMapper(),m=p.getInputData(),w=e.points,v=e.polys,y=m.getPoints().getData(),C=m.getPolys().getData();if(w.length===y.length&&v.length===C.length)return;const x=rr.newInstance();x.getPoints().setData(w,3);const T=Ml.newInstance({values:Float32Array.from(v)});x.setPolys(T),p.setInputData(x),p.modified(),t.getRenderer().resetCameraClippingRange();return}const a=e.points,s=e.polys,c=e.color,l=rr.newInstance();l.getPoints().setData(a,3);const f=Ml.newInstance({values:Float32Array.from(s)});l.setPolys(f);const u=Ui.newInstance({});let d;u.setInputData(l);const h=Lo.newInstance();h.setMapper(u),h.getProperty().setColor(c[0]/255,c[1]/255,c[2]/255),h.getProperty().setLineWidth(2);const g=dO(r,e.segmentIndex);t.addActor({uid:un(),actor:h,clippingFilter:d,representationUID:g}),t.resetCamera(),t.getRenderer().resetCameraClippingRange(),t.render()}function bg(t){return An.getColorLUT(t)}let o1={};function goe(){return o1}function poe(t){o1=t}let EE=!1;function ys(){if(!o1.addons?.polySeg)return console.warn("PolySeg add-on not configured. This will prevent automatic conversion between segmentation representations (labelmap, contour, surface). To enable these features, install @cornerstonejs/polymorphic-segmentation and register it during initialization: cornerstoneTools.init({ addons: { polySeg } })."),null;const t=o1.addons.polySeg;return EE||(t.init(),EE=!0),t}function Mx({segmentationId:t,type:e,data:r}){const n=Ut(t);if(!n)throw new Error(`Segmentation ${t} not found`);switch(n.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case yt.Labelmap:r&&(n.representationData[e]=r);break;case yt.Contour:r&&(n.representationData[e]=r);break;case yt.Surface:r&&(n.representationData[e]=r);break;default:throw new Error(`Invalid representation type ${e}`)}}async function Ox(t,e,r,n){const i=await r();return Mx({segmentationId:t,type:e,data:i}),n?.(),i}function Px(t,e){const r=Ix(t,e);return r?Object.entries(r.segments).reduce((i,[o,a])=>(a.visible||i.add(Number(o)),i),new Set):new Set}function moe(t,e,r=!1){const n=xn(t);if(!n)return;const{viewport:i}=n;loe(i.element,e),r&&i.render()}async function voe(t,e){const{segmentationId:r,type:n}=e,i=Ut(r);if(!i)return;let o=i.representationData[yt.Surface];if(!o&&ys()?.canComputeRequestedRepresentation(r,yt.Surface)){const l=ys();if(o=await Ox(r,yt.Surface,()=>l.computeSurfaceData(r,{viewport:t})),!o)throw new Error(`No Surface data found for segmentationId ${r} even we tried to compute it`)}else!o&&!ys()&&console.debug(`No surface data found for segmentationId ${r} and PolySeg add-on is not configured. Unable to convert from other representations to surface. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(!o){console.warn(`No Surface data found for segmentationId ${r}. Skipping render.`);return}const{geometryIds:a}=o;a?.size||console.warn(`No Surfaces found for segmentationId ${r}. Skipping render.`);const{colorLUTIndex:s}=e,c=bg(s);a.forEach(l=>{const f=Ae.getGeometry(l);if(!f?.data){console.warn(`No Surfaces found for geometryId ${l}. Skipping render.`);return}const{segmentIndex:u}=f.data,h=Px(t.id,{segmentationId:r,type:n}).has(u),g=f.data,p=c[u];g.color=p.slice(0,3),g.visible=!h,hoe(t,g,r)}),t.render()}function yoe(t){const e=ys();return r=>e.updateSurfaceData(r,{viewport:t})}const Rx={getUpdateFunction:yoe,render:voe,removeRepresentation:moe};function woe(t,e,r,n){const i=t.getViewReference(),{viewPlaneNormal:o,FrameOfReferenceUID:a}=i,s={annotationUID:n?.annotationUID||un(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:e,viewPlaneNormal:o,FrameOfReferenceUID:a,referencedImageId:Coe(t,r[0],o),...n}};return Ft(s,t.element),s}function Coe(t,e,r){let n;if(t instanceof qn)n=Ax(t,e,r);else if(t instanceof ir){const i=xoe(t),o=Ms(i),a=Ae.getVolume(o);n=_c(a,e,r)}else throw new Error("getReferencedImageId: viewport must be a StackViewport or BaseVolumeViewport");return n}function xoe(t){const e=t.getViewReferenceId?.();if(e)return e;if(t instanceof ir)return`volumeId:${Toe(t)}`;throw new Error("getTargetId: viewport must have a getTargetId method")}function Toe(t){const e=t.getActors();if(e)return e.find(r=>r.actor.getClassName()==="vtkVolume")?.uid}function Ax(t,e,r){const n=t.getImageIds();if(!n||!n.length)return;const i=n.map(o=>{const{imagePositionPatient:a}=ut("imagePlaneModule",o),s=Soe(e,a,r);return{imageId:o,distance:s}});return i.sort((o,a)=>o.distance-a.distance),i[0].imageId}function Soe(t,e,r){const n=Ie();an(n,t,e);const i=ft(n,r);return Math.abs(i)}function hO(t,e){const{segmentation:r}=t.data,{segmentation:n}=e.data;return r.segmentationId===n.segmentationId&&r.segmentIndex===n.segmentIndex}class gO{constructor(e){this.getGroupKey=r=>{if(typeof r=="string")return r;const i=Ce(r);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=r=>{const n=r.detail,{FrameOfReferenceUID:i}=n,a=this.annotations[i];a&&Object.keys(a).forEach(s=>{a[s].forEach(l=>{l.invalidated!==void 0&&(l.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(r,n)=>{const i=this.annotations;return i[r]?n?i[r][n]?i[r][n]:[]:i[r]:[]},this.getAnnotation=r=>{const n=this.annotations;for(const i in n){const o=n[i];for(const a in o){const s=o[a];for(const c of s)if(r===c.annotationUID)return c}}},this.getNumberOfAnnotations=(r,n)=>{const i=this.getAnnotations(r,n);if(!i.length)return 0;if(n)return i.length;let o=0;for(const a in i)o+=i[a].length;return o},this.addAnnotation=(r,n)=>{const{metadata:i}=r,{FrameOfReferenceUID:o,toolName:a}=i;n=n||o;const s=this.annotations;let c=s[n];c||(s[n]={},c=s[n]);let l=c[a];l||(c[a]=[],l=c[a]),this.preprocessingFn&&(r=this.preprocessingFn(r)),l.push(r)},this.removeAnnotation=r=>{const{annotations:n}=this;for(const i in n){const o=n[i];for(const a in o){const s=o[a],c=s.findIndex(l=>l.annotationUID===r);c!==-1&&(s.splice(c,1),s.length===0&&delete o[a])}Object.keys(o).length===0&&delete n[i]}},this.removeAnnotations=(r,n)=>{const i=this.annotations,o=[];if(!i[r])return o;if(n){const a=i[r][n];if(a)for(const s of a)this.removeAnnotation(s.annotationUID),o.push(s)}else for(const a in i[r]){const s=i[r][a];for(const c of s)this.removeAnnotation(c.annotationUID),o.push(c)}return o},this.saveAnnotations=(r,n)=>{const i=this.annotations;if(r&&n){const o=i[r];if(!o)return;const a=o[n];return structuredClone(a)}else if(r){const o=i[r];return structuredClone(o)}return structuredClone(i)},this.restoreAnnotations=(r,n,i)=>{const o=this.annotations;if(n&&i){let a=o[n];a||(o[n]={},a=o[n]),a[i]=r}else n?o[n]=r:this.annotations=structuredClone(r)},this.getAllAnnotations=()=>Object.values(this.annotations).map(r=>Object.values(r)).flat(2),this.getNumberOfAllAnnotations=()=>{let r=0;const n=this.annotations;for(const i in n){const o=n[i];for(const a in o){const s=o[a];r+=s.length}}return r},this.removeAllAnnotations=()=>{const r=[];for(const n of this.getAllAnnotations())this.removeAnnotation(n.annotationUID),r.push(n);return r},e||(e=un()),this.annotations={},this.uid=e,ke.addEventListener(Ge.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const _oe=new gO("DEFAULT"),El=new Set;function w2(t,e=!0){const r=mO();t&&(e?Ioe(t,El,r):vO(t,El,r)),yO(r,El)}function Eoe(){const t=mO();Moe(El,t),yO(t,El)}function boe(){return Array.from(El)}function pr(t){return El.has(t)}function Doe(){return El.size}function pO(t){const e=pr(t);return w2(t,e),e}function mO(){return Object.freeze({added:[],removed:[],locked:[]})}function Ioe(t,e,r){if(!e.has(t)){e.add(t),r.added.push(t);const n=vn(t);n&&(n.isLocked=!0)}}function vO(t,e,r){if(e.delete(t)){r.removed.push(t);const n=vn(t);n&&(n.isLocked=!1)}}function Moe(t,e){t.forEach(r=>{vO(r,t,e)})}function yO(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(r=>{t.locked.push(r)}),Xe(ke,V.ANNOTATION_LOCK_CHANGE,t))}const Ooe=Object.freeze(Object.defineProperty({__proto__:null,checkAndSetAnnotationLocked:pO,getAnnotationsLocked:boe,getAnnotationsLockedCount:Doe,isAnnotationLocked:pr,setAnnotationLocked:w2,unlockAllAnnotations:Eoe},Symbol.toStringTag,{value:"Module"})),fs=new Set;function ia(t,e=!0,r=!1){e?Poe(t,r):Lx(t)}function Poe(t,e=!1){const r=CO();if(!e){xO(fs,r);const n=vn(t);n&&(n.isSelected=!0)}if(t&&!fs.has(t)){fs.add(t),r.added.push(t);const n=vn(t);n&&(n.isSelected=!0)}TO(r,fs)}function Lx(t){const e=CO();if(t){if(fs.delete(t)){e.removed.push(t);const r=vn(t);r.isSelected=!1}}else xO(fs,e);TO(e,fs)}function wO(){return Array.from(fs)}function Roe(t){return wO().filter(e=>vn(e)?.metadata?.toolName===t)}function Dg(t){return fs.has(t)}function Aoe(){return fs.size}function CO(){return Object.freeze({added:[],removed:[],selection:[]})}function xO(t,e){t.forEach(r=>{if(t.delete(r)){e.removed.push(r);const n=vn(r);n&&(n.isSelected=!1)}})}function TO(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(r=>{t.selection.push(r)}),Xe(ke,V.ANNOTATION_SELECTION_CHANGE,t))}const Loe=Object.freeze(Object.defineProperty({__proto__:null,deselectAnnotation:Lx,getAnnotationsSelected:wO,getAnnotationsSelectedByToolName:Roe,getAnnotationsSelectedCount:Aoe,isAnnotationSelected:Dg,setAnnotationSelected:ia},Symbol.toStringTag,{value:"Module"})),Noe=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),Voe=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),tf=new Set;function SO(t,e=!0){const r=_O();t&&(e?EO(t,tf,r):Foe(t,tf,r)),bO(r)}function koe(){const t=_O();tf.forEach(e=>{EO(e,tf,t)}),bO(t)}function mr(t){if(vn(t))return!tf.has(t)}function _O(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function EO(t,e,r){if(e.delete(t)){r.lastVisible.push(t);const n=vn(t);n.isVisible=!0}}function Foe(t,e,r){if(!e.has(t)){e.add(t),Dg(t)&&Lx(t),r.lastHidden.push(t);const n=vn(t);n.isVisible=!1}}function bO(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(tf.forEach(e=>{t.hidden.push(e)}),Xe(ke,V.ANNOTATION_VISIBILITY_CHANGE,t))}function DO(t){const e=!tf.has(t);return SO(t,e),e}const Uoe=Object.freeze(Object.defineProperty({__proto__:null,checkAndSetAnnotationVisibility:DO,isAnnotationVisible:mr,setAnnotationVisibility:SO,showAllAnnotations:koe},Symbol.toStringTag,{value:"Module"})),Nx=_oe,Boe=t=>{t=Noe(t),t=Voe(t);const e=t.annotationUID,r=pO(e);t.isLocked=r;const n=DO(e);return t.isVisible=n,t};Nx.setPreprocessingFn(Boe);wx(Nx);function Goe(){wx(Nx)}function Na(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:r}=t.data.segmentation,n=Ut(e),{annotationUIDsMap:i}=n?.representationData.Contour||{},o=i?.get(r);o&&(o.delete(t.annotationUID),o.size||i.delete(r))}function Ec(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:r}=t.data.segmentation,n=Ut(e);n.representationData.Contour||(n.representationData.Contour={annotationUIDsMap:new Map});let{annotationUIDsMap:i}=n.representationData.Contour;i||(i=new Map);let o=i?.get(r);o||(o=new Set,i.set(r,o)),n.segments[r].locked&&w2(t.annotationUID,!0),i.set(r,o.add(t.annotationUID))}const Woe="PlanarFreehandContourSegmentationTool";function Vx(t){const{polyline:e}=t.data?.contour||{};if(!e||e.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",e);return}kt(t.annotationUID),Na(t);const r=e[0],n=e[e.length-1],i={metadata:{...t.metadata,toolName:Woe,originalToolName:t.metadata.originalToolName||t.metadata.toolName},data:{cachedStats:{},handles:{points:[r,n],textBox:t.data.handles.textBox?{...t.data.handles.textBox}:void 0},contour:{...t.data.contour},spline:t.data.spline,segmentation:{...t.data.segmentation}},annotationUID:un(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:t.interpolationUID,interpolationCompleted:t.interpolationCompleted};return Ft(i,t.metadata.FrameOfReferenceUID),Ec(i),Gt(i),i}function ff(t){const n=An.getState().viewportSegRepresentations;return Object.entries(n).filter(([,o])=>o.some(a=>a.segmentationId===t)).map(([o])=>o)}function kx(t){const e=ff(t);if(e?.length===0)return[];const r=[];for(const n of e){const{viewport:i}=xn(n)||{};i&&r.push(i)}return r}function Fx(t){const e=kx(t);return e.length>0?e[0]:void 0}function Ux(t,e,r=.99){const n=e.metadata?.viewPlaneNormal;if(!n||!Array.isArray(n))return;const i=Ie();At(i,n);for(const o of t){const a=o.getCamera();if(!a?.viewPlaneNormal)continue;const s=Ie();At(s,a.viewPlaneNormal);const c=ft(i,s);if(Math.abs(c)>=r)return o}}function Fh(t){const e=Ut(t);if(!e)return;const r=e.representationData?.Contour;if(!r)return;const{annotationUIDsMap:n}=r;if(n)return n}function IO(t,e,r){const n={annotationUID:un(),data:{contour:{closed:!0,polyline:[]},segmentation:{segmentationId:e,segmentIndex:r},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{...t.metadata,toolName:t.metadata.toolName}};return n.data.segmentation.segmentationId=e,n.data.segmentation.segmentIndex=r,t.data.contour?.polyline&&(n.data.contour.polyline=[...t.data.contour.polyline]),t.data.handles?.points&&(n.data.handles.points=t.data.handles.points.map(i=>[...i])),n}function MO(t,e,r,n){const i=Fh(t),o=Fh(r);if(!i||!o||!i?.has(e))return;const a=i.get(e),s=Fx(r);if(!s)return;const c=lr(s.id),l=u=>{const d=IO(u,r,n);if(c){const h=c.getToolInstance(u.metadata.toolName);h&&typeof h.isSplineAnnotation=="function"&&h.isSplineAnnotation(u)&&h.createSplineObjectFromType(d,u.data.spline.type)}return Ft(d,s.element),f.add(d.annotationUID),d},f=new Set;for(const u of a){const d=vn(u),h=l(d);if(d?.childAnnotationUIDs){h.childAnnotationUIDs=[];for(const g of d.childAnnotationUIDs){const p=vn(g),m=l(p);m.parentAnnotationUID=h.annotationUID,h.childAnnotationUIDs.push(m.annotationUID)}}}o.set(n,f)}var to;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(to||(to={}));function Bx(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}function a1(t,e){const r=t.maxX-t.minX,n=t.maxY-t.minY,i=[r,n],o=[t.minX+r/2,t.minY+n/2],a=[Math.abs(e[0]-o[0]),Math.abs(e[1]-o[1])],s=a[0]-i[0]*.5,c=a[1]-i[1]*.5;if(s>0&&c>0)return s*s+c*c;const l=Math.max(s,0)+Math.max(c,0);return l*l}function $oe(t,e){return Math.sqrt(a1(t,e))}const zoe=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:$oe,distanceToPointSquared:a1,intersectAABB:Bx},Symbol.toStringTag,{value:"Module"}));class OO{}class PO{constructor(e){this.storePointData=e.storePointData}getStatistics(){console.debug("InstanceCalculator getStatistics called")}}const{PointsManager:joe}=gn;function Uh(t){return{max:[-1/0],min:[1/0],sum:[0],count:0,maxIJK:null,maxLPS:null,minIJK:null,minLPS:null,runMean:[0],m2:[0],m3:[0],m4:[0],allValues:[[]],pointsInShape:t?joe.create3(1024):null,sumLPS:[0,0,0]}}function RO(t,e,r=null,n=null){Array.isArray(e)&&e.length>1&&t.max.length===1&&(t.max.push(t.max[0],t.max[0]),t.min.push(t.min[0],t.min[0]),t.sum.push(t.sum[0],t.sum[0]),t.runMean.push(0,0),t.m2.push(t.m2[0],t.m2[0]),t.m3.push(t.m3[0],t.m3[0]),t.m4.push(t.m4[0],t.m4[0]),t.allValues.push([],[])),t?.pointsInShape&&r&&t.pointsInShape.push(r);const i=Array.isArray(e)?e:[e];t.count+=1,r&&(t.sumLPS[0]+=r[0],t.sumLPS[1]+=r[1],t.sumLPS[2]+=r[2]),t.max.forEach((o,a)=>{const s=i[a];t.allValues[a].push(s);const c=t.count,l=s-t.runMean[a],f=l/c,u=l*f*(c-1);t.sum[a]+=s,t.runMean[a]+=f,t.m4[a]+=u*f*f*(c*c-3*c+3)+6*f*f*t.m2[a]-4*f*t.m3[a],t.m3[a]+=u*f*(c-2)-3*f*t.m2[a],t.m2[a]+=u,s<t.min[a]&&(t.min[a]=s,a===0&&(t.minIJK=n?[...n]:null,t.minLPS=r?[...r]:null)),s>t.max[a]&&(t.max[a]=s,a===0&&(t.maxIJK=n?[...n]:null,t.maxLPS=r?[...r]:null))})}function Hoe(t){if(t.length===0)return 0;const e=[...t].sort((n,i)=>n-i),r=Math.floor(e.length/2);return e.length%2===0?(e[r-1]+e[r])/2:e[r]}function AO(t,e){const r=t.sum.map(u=>u/t.count),n=t.m2.map(u=>Math.sqrt(u/t.count)),i=t.sumLPS.map(u=>u/t.count),o=t.m3.map((u,d)=>{const h=t.m2[d]/t.count;return h===0?0:u/(t.count*Math.pow(h,1.5))}),a=t.m4.map((u,d)=>{const h=t.m2[d]/t.count;return h===0?0:u/(t.count*h*h)-3}),s=t.allValues.map(u=>Hoe(u)),c={max:{name:"max",label:"Max Pixel",value:t.max.length===1?t.max[0]:t.max,unit:e,pointIJK:t.maxIJK?[...t.maxIJK]:null,pointLPS:t.maxLPS?[...t.maxLPS]:null},min:{name:"min",label:"Min Pixel",value:t.min.length===1?t.min[0]:t.min,unit:e,pointIJK:t.minIJK?[...t.minIJK]:null,pointLPS:t.minLPS?[...t.minLPS]:null},mean:{name:"mean",label:"Mean Pixel",value:r.length===1?r[0]:r,unit:e},stdDev:{name:"stdDev",label:"Standard Deviation",value:n.length===1?n[0]:n,unit:e},count:{name:"count",label:"Voxel Count",value:t.count,unit:null},median:{name:"median",label:"Median",value:s.length===1?s[0]:s,unit:e},skewness:{name:"skewness",label:"Skewness",value:o.length===1?o[0]:o,unit:null},kurtosis:{name:"kurtosis",label:"Kurtosis",value:a.length===1?a[0]:a,unit:null},maxLPS:{name:"maxLPS",label:"Max LPS",value:t.maxLPS?Array.from(t.maxLPS):null,unit:null},minLPS:{name:"minLPS",label:"Min LPS",value:t.minLPS?Array.from(t.minLPS):null,unit:null},pointsInShape:t.pointsInShape,center:{name:"center",label:"Center",value:i?[...i]:null,unit:null},array:[]};c.array.push(c.min,c.max,c.mean,c.stdDev,c.median,c.skewness,c.kurtosis,c.count,c.maxLPS,c.minLPS),c.center.value&&c.array.push(c.center);const l=t.pointsInShape!==null,f=Uh(l);return t.max=f.max,t.min=f.min,t.sum=f.sum,t.count=f.count,t.maxIJK=f.maxIJK,t.maxLPS=f.maxLPS,t.minIJK=f.minIJK,t.minLPS=f.minLPS,t.runMean=f.runMean,t.m2=f.m2,t.m3=f.m3,t.m4=f.m4,t.allValues=f.allValues,t.pointsInShape=f.pointsInShape,t.sumLPS=f.sumLPS,c}const Mu=class Mu extends OO{static statsInit(e){e.storePointData||(this.state.pointsInShape=null),this.state=Uh(e.storePointData)}};Mu.state=Uh(!0),Mu.statsCallback=({value:e,pointLPS:r=null,pointIJK:n=null})=>{RO(Mu.state,e,r,n)},Mu.getStatistics=e=>AO(Mu.state,e?.unit);let _s=Mu;class LO extends PO{constructor(e){super(e),this.state=Uh(e.storePointData)}statsInit(e){this.state=Uh(e.storePointData)}statsCallback(e){RO(this.state,e.value,e.pointLPS,e.pointIJK)}getStatistics(e){return AO(this.state,e?.unit)}}const Koe=Object.freeze(Object.defineProperty({__proto__:null,BasicStatsCalculator:_s,Calculator:OO,InstanceBasicStatsCalculator:LO,InstanceCalculator:PO},Symbol.toStringTag,{value:"Module"}));function bc(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[r,n,i=0]=t,[o,a,s=0]=e,c=o-r,l=a-n,f=s-i;return c*c+l*l+f*f}function Os(t,e){return Math.sqrt(bc(t,e))}function N5(t,e){const[r,n]=t,[i,o]=e,a=2*i-r,s=2*o-n;return[a,s]}const Xoe=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:Os,distanceToPointSquared:bc,mirror:N5},Symbol.toStringTag,{value:"Module"}));function bl(t){const[e,r]=t;return Os(e,r)}function ku(t){const[e,r]=t,n=Os(e,r),i=[e[0]-n,e[1]-n],o=[e[0]+n,e[1]+n];return[i,o]}const qoe=Object.freeze(Object.defineProperty({__proto__:null,getCanvasCircleCorners:ku,getCanvasCircleRadius:bl},Symbol.toStringTag,{value:"Module"}));function C2(t,e,r={}){return r.precalculated||NO(t,r),r.precalculated(e)}const NO=(t,e={})=>{const{xRadius:r,yRadius:n,zRadius:i}=t;(e.invXRadiusSq===void 0||e.invYRadiusSq===void 0||e.invZRadiusSq===void 0)&&(e.invXRadiusSq=r!==0?1/r**2:0,e.invYRadiusSq=n!==0?1/n**2:0,e.invZRadiusSq=i!==0?1/i**2:0);const{invXRadiusSq:o,invYRadiusSq:a,invZRadiusSq:s}=e,{center:c}=t,[l,f,u]=c;return e.precalculated=d=>{const h=d[0]-l;let g=h*h*o;if(g>1)return!1;const p=d[1]-f;if(g+=p*p*a,g>1)return!1;const m=d[2]-u;return g+=m*m*s,g<=1},e};function V5(t){const[e,r,n,i]=t,o=[n[0],r[1]],a=[i[0],e[1]];return[o,a]}const Yoe=Object.freeze(Object.defineProperty({__proto__:null,getCanvasEllipseCorners:V5,pointInEllipse:C2,precalculatePointInEllipse:NO},Symbol.toStringTag,{value:"Module"}));function s1(t,e,r){let n;const i=bc(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(n=t),!n){const o=((r[0]-t[0])*(e[0]-t[0])+(r[1]-t[1])*(e[1]-t[1]))/i;o<0?n=t:o>1?n=e:n=[t[0]+o*(e[0]-t[0]),t[1]+o*(e[1]-t[1])]}return{point:[...n],distanceSquared:bc(r,n)}}function Ig(t,e,r){return s1(t,e,r).distanceSquared}function Ir(t,e,r){if(t.length!==2||e.length!==2||r.length!==2)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(Ig(t,e,r))}function xp(t){return typeof t=="number"?t?t<0?-1:1:t===t?0:NaN:NaN}function c1(t,e,r,n,i=!1){const[o,a]=t,[s,c]=e,[l,f]=r,[u,d]=n;if(i){const I=(o-s)*(f-d)-(a-c)*(l-u);if(Math.abs(I)<1e-10)return;const O=((o-l)*(f-d)-(a-f)*(l-u))/I,M=o+O*(s-o),R=a+O*(c-a);return[M,R]}const h=c-a,g=o-s,p=s*a-o*c,m=h*l+g*f+p,w=h*u+g*d+p;if(m!==0&&w!==0&&xp(m)===xp(w))return;const v=d-f,y=l-u,C=u*f-l*d,x=v*o+y*a+C,T=v*s+y*c+C;if(x!==0&&T!==0&&xp(x)===xp(T))return;const S=h*y-v*g;let _;_=g*C-y*p;const E=_/S;_=v*p-h*C;const D=_/S;return[E,D]}const md=.01;function cm(t,e,r){const n=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],o=t[1]<=e[1]?t[1]:e[1],a=t[1]>=e[1]?t[1]:e[1];if(!(r[0]>=n-md&&r[0]<=i+md&&r[1]>=o-md&&r[1]<=a+md))return!1;const c=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return(c>=0?c:-c)<=md}const Joe=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:Ir,distanceToPointSquared:Ig,distanceToPointSquaredInfo:s1,intersectLine:c1,isPointOnLineSegment:cm},Symbol.toStringTag,{value:"Module"}));function x2(t){if(t.length<3)return!1;const e=t.length,r=t[0],n=t[e-1],i=bc(r,n);return Yu(0,i)}function Fi(t,e,r={closed:void 0}){if(t.length<3)return!1;const n=t.length;let i=0;const{closed:o,holes:a}=r;if(a?.length){for(const l of a)if(Fi(l,e))return!1}const s=!(o===void 0?x2(t):o),c=t.length-(s?1:2);for(let l=0;l<=c;l++){const f=t[l],u=l===n-1?0:l+1,d=t[u],h=f[0]>=d[0]?f[0]:d[0],g=f[1]>=d[1]?f[1]:d[1],p=f[1]<=d[1]?f[1]:d[1];if(e[0]<=h&&e[1]>=p&&e[1]<g){let v=f[0]===d[0];if(!v){const y=(e[1]-f[1])*(d[0]-f[0])/(d[1]-f[1])+f[0];v=e[0]<=y}i+=v?1:0}}return!!(i%2)}function df(t,e){for(let r=0,n=e.length;r<n;r++)if(!Fi(t,e[r]))return!1;return!0}function Al(t,e){let r=t;const n=e?.numDimensions||2,i=n===3;if(!Array.isArray(t[0])){const u=t,d=u.length/n;r=new Array(u.length/n);for(let h=0,g=d;h<g;h++)r[h]=[u[h*n],u[h*n+1]],i&&r[h].push(u[h*n+2])}let o=1/0,a=1/0,s=-1/0,c=-1/0,l=1/0,f=-1/0;r=r;for(let u=0,d=r.length;u<d;u++){const[h,g,p]=r[u];o=o<h?o:h,a=a<g?a:g,s=s>h?s:h,c=c>g?c:g,i&&(l=l<p?l:p,f=f>p?f:p)}return i?{minX:o,maxX:s,minY:a,maxY:c,minZ:l,maxZ:f}:{minX:o,maxX:s,minY:a,maxY:c}}function Mg(t){const e=t.length;let r=0,n=e-1;for(let i=0;i<e;i++)r+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(r/2)}function oa(t){if(t.length<3)return 0;const e=t[0];let r=0;for(let n=0,i=t.length;n<i;n++){const o=t[n],a=n===i-1?0:n+1,s=t[a],c=o[0]-e[0],l=o[1]-e[1],f=s[0]-e[0],u=s[1]-e[1];r+=c*u-l*f}return r*=.5,r}function lm(t){return oa(t)>=0?1:-1}function Zoe(t){const e=Ie(),r=t[0];for(let n=0,i=t.length;n<i;n++){const o=t[n],a=n===i-1?0:n+1,s=t[a],c=o[0]-r[0],l=o[1]-r[1],f=o[2]-r[2],u=s[0]-r[0],d=s[1]-r[1],h=s[2]-r[2];e[0]+=l*h-f*d,e[1]+=f*u-c*h,e[2]+=c*d-l*u}return Jn(e,e,.5),e}function Qoe(t){const e=Zoe(t);return At(e,e)}function k5(t){const e=oa(t);return[0,0,e/Math.abs(e)]}const $r=1e-7;function ry(t,e){return t[0]*e[1]-t[1]*e[0]}function Tr(t,e){return Dt(t,e,$r)}function VO(t,e,r,n){const i=Mn(xt(),e,t),o=Mn(xt(),n,r),a=ry(i,o),s=Mn(xt(),r,t),c=ry(s,i);if(Math.abs(a)<$r){if(Math.abs(c)<$r){const u=oc(i,i),d=oc(o,o);if(u<$r||d<$r)return Tr(t,r)||Tr(t,n)?t:Tr(e,r)||Tr(e,n)?e:null;const h=oc(Mn(xt(),r,t),i)/u,g=oc(Mn(xt(),n,t),i)/u,p=oc(Mn(xt(),t,r),o)/d,m=oc(Mn(xt(),e,r),o)/d,w=v=>v>=-$r&&v<=1+$r;if(w(h)){const v=bd(xt(),t,i,h);if(Tr(r,v))return r}if(w(g)){const v=bd(xt(),t,i,g);if(Tr(n,v))return n}if(w(p)){const v=bd(xt(),r,o,p);if(Tr(t,v))return t}if(w(m)){const v=bd(xt(),r,o,m);if(Tr(e,v))return e}}return null}const l=ry(s,o)/a,f=c/a;return l>=-$r&&l<=1+$r&&f>=-$r&&f<=1+$r?[t[0]+l*i[0],t[1]+l*i[1]]:null}var fc;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(fc||(fc={}));var Ai;(function(t){t[t.Entering=0]="Entering",t[t.Exiting=1]="Exiting",t[t.Unknown=2]="Unknown"})(Ai||(Ai={}));function W0(t,e){if(t.length!==e.length)return!1;const r=t.length;if(r===0)return!0;let n=!0;for(let o=0;o<r;o++)if(!Tr(t[o],e[o])){n=!1;break}if(n)return!0;let i=!0;for(let o=0;o<r;o++)if(!Tr(t[o],e[r-1-o])){i=!1;break}if(i)return!0;for(let o=1;o<r;o++){let a=!0;for(let c=0;c<r;c++)if(!Tr(t[c],e[(c+o)%r])){a=!1;break}if(a)return!0;let s=!0;for(let c=0;c<r;c++)if(!Tr(t[c],e[(r-1-c+o)%r])){s=!1;break}if(s)return!0}return!1}function T2(t,e){if(t.length<3)return[];if(e.length<3)return[t.slice()];const r=e.slice();if(W0(t,e))return[];const n=oa(t),i=oa(r);Math.sign(n)===Math.sign(i)&&Math.abs(i)>$r&&r.reverse();const o=[];for(let f=0;f<t.length;f++){const u=t[f],d=t[(f+1)%t.length];for(let h=0;h<r.length;h++){const g=r[h],p=r[(h+1)%r.length],m=VO(u,d,g,p);if(m){const w=Math.sqrt(vl(u,d)),v=Math.sqrt(vl(g,p));o.push({coord:m,seg1Idx:f,seg2Idx:h,alpha1:w<$r?0:Math.sqrt(vl(u,m))/w,alpha2:v<$r?0:Math.sqrt(vl(g,m))/v})}}}const a=(f,u,d)=>{const h=[];let g=0;for(let m=0;m<f.length;m++){const w=f[m];h.push({id:`${u}_v${g++}`,coordinates:w,type:fc.Vertex,originalPolyIndex:u,originalVertexIndex:m,next:null,prev:null,isIntersection:!1,visited:!1});const v=d.filter(y=>(u===0?y.seg1Idx:y.seg2Idx)===m).sort((y,C)=>(u===0?y.alpha1:y.alpha2)-(u===0?C.alpha1:C.alpha2));for(const y of v){if(h.length>0&&Tr(h[h.length-1].coordinates,y.coord)){h[h.length-1].isIntersection||(h[h.length-1].isIntersection=!0,h[h.length-1].intersectionInfo=y,h[h.length-1].alpha=u===0?y.alpha1:y.alpha2);continue}h.push({id:`${u}_i${g++}`,coordinates:y.coord,type:fc.Intersection,originalPolyIndex:u,next:null,prev:null,isIntersection:!0,visited:!1,alpha:u===0?y.alpha1:y.alpha2,intersectionInfo:y})}}const p=[];if(h.length>0){p.push(h[0]);for(let m=1;m<h.length;m++)Tr(h[m].coordinates,p[p.length-1].coordinates)?h[m].isIntersection&&(p[p.length-1].isIntersection=!0,p[p.length-1].intersectionInfo=h[m].intersectionInfo,p[p.length-1].alpha=h[m].alpha):p.push(h[m])}if(p.length>0)for(let m=0;m<p.length;m++)p[m].next=p[(m+1)%p.length],p[m].prev=p[(m-1+p.length)%p.length];return p},s=a(t,0,o),c=a(r,1,o);s.forEach(f=>{if(f.isIntersection){const u=f.intersectionInfo,d=c.find(h=>h.isIntersection&&Tr(h.coordinates,f.coordinates)&&h.intersectionInfo.seg1Idx===u.seg1Idx&&h.intersectionInfo.seg2Idx===u.seg2Idx);if(d){f.partnerNode=d,d.partnerNode=f;const h=f.prev.coordinates,g=f.coordinates,p=d.next.coordinates;Mn(xt(),g,h),Mn(xt(),p,g);const m=[(f.prev.coordinates[0]+f.coordinates[0])/2,(f.prev.coordinates[1]+f.coordinates[1])/2];Fi(e,m)?f.intersectionDir=Ai.Exiting:f.intersectionDir=Ai.Entering}else f.isIntersection=!1}}),s.forEach(f=>delete f.intersectionInfo),c.forEach(f=>delete f.intersectionInfo);const l=[];for(let f=0;f<s.length;f++){const u=s[f];if(u.visited||u.isIntersection||Fi(e,u.coordinates))continue;const d=[];let h=u,g=!0,p=0;const m=(s.length+c.length)*2;do{if(p++>m){console.warn("Subtraction: Max iterations reached, possible infinite loop.");break}h.visited=!0,(d.length===0||!Tr(d[d.length-1],h.coordinates))&&d.push(h.coordinates),h.isIntersection&&(g?h.intersectionDir===Ai.Entering&&h.partnerNode&&(h=h.partnerNode,g=!1):h.partnerNode?(h=h.partnerNode,g=!0):console.warn("Subtraction: Intersection on source without partner.")),h=h.next}while(h!==u||!g);d.length>=3&&(Tr(d[0],d[d.length-1])&&d.pop(),d.length>=3&&l.push(d))}return l}function kO(t,e){if(t.length<3||e.length<3)return[];let r=e.slice();const n=oa(t),i=oa(r);if(Math.abs(n)<$r||Math.abs(i)<$r)return[];n<0&&(t=t.slice().reverse()),i<0&&(r=r.slice().reverse());const o=r,a=[];for(let u=0;u<t.length;u++){const d=t[u],h=t[(u+1)%t.length];for(let g=0;g<r.length;g++){const p=r[g],m=r[(g+1)%r.length],w=VO(d,h,p,m);if(w){const v=Math.sqrt(vl(d,h)),y=Math.sqrt(vl(p,m));a.push({coord:[...w],seg1Idx:u,seg2Idx:g,alpha1:v<$r?0:Math.sqrt(vl(d,w))/v,alpha2:y<$r?0:Math.sqrt(vl(p,w))/y})}}}if(a.length===0)return Fi(o,t[0])&&t.every(u=>Fi(o,u))?[[...t.map(u=>[...u])]]:Fi(t,r[0])&&r.every(u=>Fi(t,u))?[[...r.map(u=>[...u])]]:[];const s=(u,d,h)=>{const g=[];let p=0;for(let w=0;w<u.length;w++){const v=u[w];g.push({id:`${d}_v${p++}`,coordinates:[...v],type:fc.Vertex,originalPolyIndex:d,originalVertexIndex:w,next:null,prev:null,isIntersection:!1,visited:!1,processedInPath:!1,intersectionDir:Ai.Unknown});const y=h.filter(C=>(d===0?C.seg1Idx:C.seg2Idx)===w).sort((C,x)=>(d===0?C.alpha1:C.alpha2)-(d===0?x.alpha1:x.alpha2));for(const C of y){if(g.length>0&&Tr(g[g.length-1].coordinates,C.coord)){const x=g[g.length-1];x.isIntersection||(x.isIntersection=!0,x.intersectionInfo=C,x.alpha=d===0?C.alpha1:C.alpha2,x.type=fc.Intersection);continue}g.push({id:`${d}_i${p++}`,coordinates:[...C.coord],type:fc.Intersection,originalPolyIndex:d,next:null,prev:null,isIntersection:!0,visited:!1,processedInPath:!1,alpha:d===0?C.alpha1:C.alpha2,intersectionInfo:C,intersectionDir:Ai.Unknown})}}const m=[];if(g.length>0){m.push(g[0]);for(let w=1;w<g.length;w++)if(!Tr(g[w].coordinates,m[m.length-1].coordinates))m.push(g[w]);else{const v=m[m.length-1];g[w].isIntersection&&g[w].intersectionInfo&&(v.isIntersection=!0,v.intersectionInfo=g[w].intersectionInfo,v.alpha=g[w].alpha,v.type=fc.Intersection)}}if(m.length>1&&Tr(m[0].coordinates,m[m.length-1].coordinates)){const w=m[0],v=m.pop();v.isIntersection&&!w.isIntersection&&v.intersectionInfo&&(w.isIntersection=!0,w.intersectionInfo=v.intersectionInfo,w.alpha=v.alpha,w.type=fc.Intersection)}if(m.length>0)for(let w=0;w<m.length;w++)m[w].next=m[(w+1)%m.length],m[w].prev=m[(w-1+m.length)%m.length];return m},c=s(t,0,a),l=s(r,1,a);if(c.length===0||l.length===0)return[];c.forEach(u=>{if(u.isIntersection&&u.intersectionInfo){const d=u.intersectionInfo,h=l.find(g=>g.isIntersection&&g.intersectionInfo&&Tr(g.coordinates,u.coordinates)&&g.intersectionInfo.seg1Idx===d.seg1Idx&&g.intersectionInfo.seg2Idx===d.seg2Idx);if(h){u.partnerNode=h,h.partnerNode=u;const g=Mn(xt(),u.coordinates,u.prev.coordinates),p=Mn(xt(),h.next.coordinates,h.coordinates),m=g[0]*p[1]-g[1]*p[0];if(m>$r)u.intersectionDir=Ai.Entering,h.intersectionDir=Ai.Exiting;else if(m<-$r)u.intersectionDir=Ai.Exiting,h.intersectionDir=Ai.Entering;else{const w=[(u.prev.coordinates[0]+u.coordinates[0])/2,(u.prev.coordinates[1]+u.coordinates[1])/2];Fi(o,w)?(u.intersectionDir=Ai.Exiting,h.intersectionDir=Ai.Entering):(u.intersectionDir=Ai.Entering,h.intersectionDir=Ai.Exiting)}}else u.isIntersection=!1,u.intersectionInfo=void 0}});const f=[];for(const u of c){if(!u.isIntersection||u.visited||u.intersectionDir!==Ai.Entering)continue;let d=[],h=u,g=!0;const p=u;let m=0;const w=(c.length+l.length)*2;c.forEach(v=>v.processedInPath=!1),l.forEach(v=>v.processedInPath=!1);do{if(m++>w){console.warn("Intersection: Max iterations in path tracing.",p.id,h.id),d=[];break}if(h.processedInPath&&h!==p){console.warn("Intersection: Path processing loop detected, discarding path segment.",p.id,h.id),d=[];break}h.processedInPath=!0,h.visited=!0,(d.length===0||!Tr(d[d.length-1],h.coordinates))&&d.push([...h.coordinates]);let v=!1;h.isIntersection&&h.partnerNode&&(g?(h=h.partnerNode,g=!1,v=!0):(h=h.partnerNode,g=!0,v=!0)),h=h.next}while(h!==p||g&&h.originalPolyIndex!==0||!g&&h.originalPolyIndex!==1);if(m>w||d.length===0||d.length>0&&Tr(d[0],d[d.length-1])&&d.pop(),d.length>=3){const v=oa(d);(n>0&&v<0||n<0&&v>0)&&d.reverse(),f.push(d.map(y=>[...y]))}}return f}function Gx(t,e,r,n){let i=!1;const o=t[0]<e[0]?t[0]:e[0],a=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],l=r[0]<n[0]?r[0]:n[0],f=r[1]<n[1]?r[1]:n[1],u=r[0]>n[0]?r[0]:n[0],d=r[1]>n[1]?r[1]:n[1];if(o>u||s<l||a>d||c<f)return!1;const h=[Tp(t,e,r),Tp(t,e,n),Tp(r,n,t),Tp(r,n,e)];return h[0]!==h[1]&&h[2]!==h[3]?!0:((h[0]===0&&Sp(t,r,e)||h[1]===0&&Sp(t,n,e)||h[2]===0&&Sp(r,t,n)||h[3]===0&&Sp(r,e,n))&&(i=!0),i)}function Tp(t,e,r){const n=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return n===0?0:n>0?1:2}function Sp(t,e,r){return e[0]<=Math.max(t[0],r[0])&&e[0]>=Math.min(t[0],r[0])&&e[1]<=Math.max(t[1],r[1])&&e[1]>=Math.min(t[1],r[1])}function Wx(t,e,r,n=!0){const i=[],o=t.length,a=o-(n?1:2);for(let s=0;s<=a;s++){const c=t[s],l=s===o-1?0:s+1,f=t[l];Gx(e,r,c,f)&&i.push([s,l])}return i}function FO(t,e,r,n=!0){let i,o;n?(o=t.length-1,i=0):(o=0,i=1);for(let a=i;a<t.length;a++){const s=t[o],c=t[a];if(Gx(e,r,s,c))return[o,a];o=a}}function S2(t,e){for(let r=0,n=t.length;r<n;r++){const i=t[r],o=r===n-1?0:r+1,a=t[o];if(FO(e,i,a)?.length===2)return!0}return!1}const eae=.01;function UO(t,e,r,n){const i=[e[0]-t[0],e[1]-t[1]],o=[n[0]-r[0],n[1]-r[1]],a=o[1]*i[0]-o[0]*i[1];if((a>=0?a:-a)<eae){const g=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],p=[r[0]<n[0]?r[0]:n[0],r[0]>n[0]?r[0]:n[0],r[1]<n[1]?r[1]:n[1],r[1]>n[1]?r[1]:n[1]];if(!(g[0]<=p[1]&&g[1]>=p[0]&&g[2]<=p[3]&&g[3]>=p[2])||!(cm(t,e,r)||cm(t,e,n)||cm(r,n,t)))return;const v=g[0]>p[0]?g[0]:p[0],y=g[1]<p[1]?g[1]:p[1],C=g[2]>p[2]?g[2]:p[2],x=g[3]<p[3]?g[3]:p[3],T=(v+y)*.5,S=(C+x)*.5;return[T,S]}let c=t[1]-r[1],l=t[0]-r[0];const f=o[0]*c-o[1]*l,u=i[0]*c-i[1]*l;c=f/a,l=u/a;const d=t[0]+c*i[0],h=t[1]+c*i[1];return[d,h]}var Wu;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(Wu||(Wu={}));var $u;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})($u||($u={}));var Vf;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(Vf||(Vf={}));function bE(t){for(let e=0,r=t.length;e<r;e++){const n=t[e];n.next||(n.next=t[e===r-1?0:e+1])}}function tae(t,e){const r=[],n=[],i=new Map;let a=Fi(e,t[0])?Vf.Exiting:Vf.Entering;for(let s=0,c=t.length;s<c;s++){const l=t[s],f=Fi(e,l),u={type:Wu.Vertex,coordinates:l,position:f?$u.Inside:$u.Outside,visited:!1,next:null};r.push(u);const d=t[s===c-1?0:s+1],h=Wx(e,l,d).map(g=>{const p=g[0],m=e[g[0]],w=e[g[1]],v=UO(l,d,m,w),y=bc(l,v);return{sourceLineSegmentId:p,coordinate:v,targetStartPointDistSquared:y}});h.sort((g,p)=>g.targetStartPointDistSquared-p.targetStartPointDistSquared),h.forEach(g=>{const{sourceLineSegmentId:p,coordinate:m}=g,w={type:Wu.Intersection,coordinates:m,position:$u.Edge,direction:a,visited:!1,next:null},v={...w,direction:Vf.Unknown,cloned:!0};a===Vf.Entering?w.next=v:v.next=w;let y=i.get(p);y||(y=[],i.set(p,y)),r.push(w),y.push(v),a*=-1})}for(let s=0,c=e.length;s<c;s++){const l=s,f=e[s],u={type:Wu.Vertex,coordinates:f,visited:!1,next:null};n.push(u);const d=i.get(l);d?.length&&d.map(h=>({intersectionPoint:h,lineSegStartDistSquared:bc(f,h.coordinates)})).sort((h,g)=>h.lineSegStartDistSquared-g.lineSegStartDistSquared).map(({intersectionPoint:h})=>h).forEach(h=>n.push(h))}return bE(r),bE(n),{targetPolylinePoints:r,sourcePolylinePoints:n}}function nae(t){for(let e=0,r=t.length;e<r;e++){const n=t[e];if(!n.visited&&n.position===$u.Outside&&n.type===Wu.Vertex)return n}for(let e=0,r=t.length;e<r;e++){const n=t[e];if(!n.visited&&n.position===$u.Outside)return n}}function _2(t,e){const r=k5(t),n=k5(e),i=ft(n,r);if(Yu(1,i)||(e=e.slice().reverse()),!S2(e,t)&&df(e,t))return e.slice();const{targetPolylinePoints:s}=tae(t,e),c=nae(s);if(!c)return t.slice();const l=[c.coordinates];let f=c.next,u=0;const d=t.length+e.length+1e3;for(;f!==c&&u<d;){if(u++,f.type===Wu.Intersection&&f.cloned){f=f.next;continue}if(l.push(f.coordinates),f=f.next,!f){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}}return u>=d&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),l}const rae=.1;function E2(t,e=rae){const r=t.length;if(r<3)return t;const n=e*e,i=[[0,r-1]],o=new Array(r).fill(!1);let a=2;for(o[0]=!0,o[r-1]=!0;i.length;){const[c,l]=i.pop();if(l-c===1)continue;const f=t[c],u=t[l];let d=-1/0,h=-1;for(let g=c+1;g<l;g++){const p=t[g],m=Ig(f,u,p);m>d&&(d=m,h=g)}d<n||(o[h]=!0,a++,i.push([h,l]),i.push([c,h]))}const s=new Array(a);for(let c=0,l=0;c<r;c++)o[c]&&(s[l++]=t[c]);return s}function BO(t,e,r,n=!0){const i=[],o=Wx(t,e,r,n);for(let a=0;a<o.length;a++){const s=t[o[a][0]],c=t[o[a][1]],l=UO(e,r,s,c);i.push(l)}return i}function iae(t,e,r,n=!0){let i,o;n?(o=t.length-1,i=0):(o=0,i=1);const a=[];for(let f=i;f<t.length;f++){const u=t[o],d=t[f];Gx(e,r,u,d)&&a.push([o,f]),o=f}if(a.length===0)return;const s=[];a.forEach(f=>{const u=[t[f[0]],t[f[1]]],d=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2];s.push(Xn(d,e))});const c=Math.min(...s),l=s.indexOf(c);return{segment:a[l],distance:c}}const Ef=.001,oae=(t,e)=>{let r,n,i;if(t instanceof qn){const a=t.getImageData();if(!a)return;n=a.direction.slice(0,3),i=a.direction.slice(3,6),r=a.spacing}else{const a=t.getImageData(),{direction:s,spacing:c}=a,{viewPlaneNormal:l,viewUp:f}=t.getCamera(),u=s.slice(0,3),d=s.slice(3,6),h=s.slice(6,9),g=Ie();nn(g,f,l);const p=Math.abs(ft(g,u)),m=Math.abs(ft(g,d)),w=Math.abs(ft(g,h));let v;if(Math.abs(1-p)<Ef)v=c[0],n=u;else if(Math.abs(1-m)<Ef)v=c[1],n=d;else if(Math.abs(1-w)<Ef)v=c[2],n=h;else throw new Error("No support yet for oblique plane planar contours");const y=Math.abs(ft(f,u)),C=Math.abs(ft(f,d)),x=Math.abs(ft(f,h));let T;if(Math.abs(1-y)<Ef)T=c[0],i=u;else if(Math.abs(1-C)<Ef)T=c[1],i=d;else if(Math.abs(1-x)<Ef)T=c[2],i=h;else throw new Error("No support yet for oblique plane planar contours");r=[v,T]}return{spacing:[r[0]/e,r[1]/e],xDir:n,yDir:i}},aae=(t,e,r)=>nC(t,e)<r,sae=(t,e,r,n)=>{const{xDir:i,yDir:o,spacing:a}=n,s=Ce(t),{viewport:c}=s;if(!e.length)return e.push(r),console.log(">>>>> !canvasPoints. :: RETURN"),1;const l=c.canvasToWorld(e[e.length-1]),f=c.canvasToWorld(r),u=Ie();qt(u,f,l);const d=Math.abs(ft(u,i)),h=Math.abs(ft(u,o)),g=Math.max(Math.floor(d/a[0]),Math.floor(h/a[0]));if(g>1){const p=e[e.length-1],m=nC(p,r),w=xt();Mn(w,r,p),Qo(w,w[0]/m,w[1]/m);const v=m/g;for(let y=1;y<=g;y++)e.push([p[0]+v*w[0]*y,p[1]+v*w[1]*y])}else e.push(r);return g},cae=(t,e,r,n)=>{const i=[t[0]-e[0],t[1]-e[1]],o=[r[0]-e[0],r[1]-e[1]],a=i[0]*o[0]+i[1]*o[1];if(a<0)return!1;const s=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(s===0)return!1;const c=a/s,l=[o[0]/s,o[1]/s],f=[l[0]*c,l[1]*c],u=[e[0]+f[0],e[1]+f[1]];return!(Xn(t,u)>n||Xn(e,u)>Xn(e,r))},lae=1e-6;function GO(t){let e;const r=cx(t,50);for(let a=0;a<3;a++)if(r.every((s,c,l)=>Math.abs(s[a]-l[0][a])<lae)){e=a;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const n=[],i=(e+1)%3,o=(e+2)%3;for(let a=0;a<t.length;a++)n.push([t[a][i],t[a][o]]);return{sharedDimensionIndex:e,projectedPolyline:n}}function $x(t,e,r={}){const{sharedDimensionIndex:n,projectedPolyline:i}=GO(e),{holes:o}=r,a=[];if(o)for(let c=0;c<o.length;c++){const l=o[c],f=[];for(let u=0;u<l.length;u++)f.push([l[u][(n+1)%3],l[u][(n+2)%3]]);a.push(f)}const s=[t[(n+1)%3],t[(n+2)%3]];return Fi(i,s,{holes:a})}function WO(t){if(t.length<3)return t.slice();const e=t.map(o=>[o[0],o[1]]).sort((o,a)=>o[0]===a[0]?o[1]-a[1]:o[0]-a[0]);function r(o,a,s){return(a[0]-o[0])*(s[1]-o[1])-(a[1]-o[1])*(s[0]-o[0])}const n=[];for(const o of e){for(;n.length>=2&&r(n[n.length-2],n[n.length-1],o)<=0;)n.pop();n.push(o)}const i=[];for(let o=e.length-1;o>=0;o--){const a=e[o];for(;i.length>=2&&r(i[i.length-2],i[i.length-1],a)<=0;)i.pop();i.push(a)}return n.pop(),i.pop(),n.concat(i)}const Vl=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:sae,arePolylinesIdentical:W0,containsPoint:Fi,containsPoints:df,convexHull:WO,decimate:E2,getAABB:Al,getArea:Mg,getClosestLineSegmentIntersection:iae,getFirstLineSegmentIntersectionIndexes:FO,getLineSegmentIntersectionsCoordinates:BO,getLineSegmentIntersectionsIndexes:Wx,getNormal2:k5,getNormal3:Qoe,getSignedArea:oa,getSubPixelSpacingAndXYDirections:oae,getWindingDirection:lm,intersectPolyline:S2,intersectPolylines:kO,isClosed:x2,isPointInsidePolyline3D:$x,mergePolylines:_2,pointCanProjectOnLine:cae,pointsAreWithinCloseContourProximity:aae,projectTo2D:GO,subtractPolylines:T2},Symbol.toStringTag,{value:"Module"}));function uae(t,e,r,n){const i=[t,e],o=[t+r,e],a=[t+r,e],s=[t+r,e+n],c=[t+r,e+n],l=[t,e+n],f=[t,e+n];return{top:[i,o],right:[a,s],bottom:[c,l],left:[f,[t,e]]}}function zx(t,e){if(t.length!==4||e.length!==2)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[r,n,i,o]=t;let a=655535;const s=uae(r,n,i,o);return Object.keys(s).forEach(c=>{const[l,f]=s[c],u=Ir(l,f,e);u<a&&(a=u)}),a}const fae=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:zx},Symbol.toStringTag,{value:"Module"}));function F5(t,e){let r=[0,0],n=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const o=dae(e,i);o<n&&(n=o,r=[...i])}),r}function dae(t,e){const[r,n]=t,[i,o]=e;return Math.sqrt(Math.pow(r-i,2)+Math.pow(n-o,2))}const U5=1e-6,DE=1,hae=0;function _p(t,e,r){const[n,i]=r;if(Math.abs(e)<U5)return t<0;const o=t/e;if(e>0){if(o>i)return 0;o>n&&(r[0]=o)}else{if(o<n)return 0;o<i&&(r[1]=o)}return 1}function Fu(t,e,r,n,i){const[o,a]=t,[s,c]=e,l=s-o,f=c-a;if(n===void 0||i===void 0?(n=t,i=e):(n[0]=t[0],n[1]=t[1],i[0]=e[0],i[1]=e[1]),Math.abs(l)<U5&&Math.abs(f)<U5&&o>=r[0]&&o<=r[2]&&a>=r[1]&&a<=r[3])return DE;const u=[0,1];if(_p(r[0]-o,l,u)&&_p(o-r[2],-l,u)&&_p(r[1]-a,f,u)&&_p(a-r[3],-f,u)){const[d,h]=u;return h<1&&(i[0]=o+h*l,i[1]=a+h*f),d>0&&(n[0]+=d*l,n[1]+=d*f),DE}return hae}const gae=Object.freeze(Object.defineProperty({__proto__:null,findClosestPoint:F5,liangBarksyClip:Fu},Symbol.toStringTag,{value:"Module"}));function pae(t,e){const[r,n]=t,[i,o]=e,a=an(Ie(),n,r),s=an(Ie(),i,o),c=ft(a,s),l=_r(a),f=_r(s),u=c/(l*f);return Math.acos(u)*180/Math.PI}function mae(t,e){const[r,n]=t,[i,o]=e,a=Mo(xt(),n,r),s=Mo(xt(),i,o),c=oc(a,s),l=bm(a),f=bm(s),u=c/(l*f);return Math.acos(u)*(180/Math.PI)}function o0(t,e){return t[0].length===3?pae(t,e):mae(t,e)}const vae=Object.freeze(Object.defineProperty({__proto__:null,angleBetweenLines:o0},Symbol.toStringTag,{value:"Module"})),yae=Object.freeze(Object.defineProperty({__proto__:null,BasicStatsCalculator:Koe,aabb:zoe,angle:vae,circle:qoe,ellipse:Yoe,lineSegment:Joe,point:Xoe,polyline:Vl,rectangle:fae,vec2:gae},Symbol.toStringTag,{value:"Module"}));function Ga(t,e,r,n){const{canvasToWorld:i,worldToCanvas:o}=r,{data:a}=t,{targetWindingDirection:s}=e;let{points:c}=e,l=lm(c);n?.decimate?.enabled&&(c=E2(e.points,n?.decimate?.epsilon));let{closed:f}=e;const u=c.length,d=new Array(u);lm(c);const h=DM(t);if(f===void 0){let g=!1;if(c.length>3){const p=bc(c[0],c[u-1]);g=Dt(0,p)}f=g}if(n?.updateWindingDirection!==!1){let g=h?h.data.contour.windingDirection*-1:s;g===void 0&&(g=l),g!==l&&c.reverse();const p=(a.handles?.points??[]).map(o);p.length>2&&lm(p)!==g&&a.handles.points.reverse(),l=g}for(let g=0;g<u;g++)d[g]=i(c[g]);a.contour.polyline=d,a.contour.closed=f,a.contour.windingDirection=l,Cx(t)}const wae="viewport-element";function Cae(t){const e=Ce(t),{viewportId:r,renderingEngineId:n}=e,i=`${r}:${n}`,o=xae(t);return Object.keys(Ue.svgNodeCache[i]).forEach(a=>{Ue.svgNodeCache[i][a].touched=!1}),{svgLayerElement:o,svgNodeCacheForCanvas:Ue.svgNodeCache,getSvgNode:Tae.bind(this,i),appendNode:Sae.bind(this,o,i),setNodeTouched:_ae.bind(this,i),clearUntouched:Eae.bind(this,o,i)}}function xae(t){const e=`.${wae}`;return t.querySelector(e)?.querySelector(":scope > .svg-layer")}function Tae(t,e){if(Ue.svgNodeCache[t]&&Ue.svgNodeCache[t][e])return Ue.svgNodeCache[t][e].domRef}function Sae(t,e,r,n){if(!Ue.svgNodeCache[e])return null;Ue.svgNodeCache[e][n]={touched:!0,domRef:r},t.appendChild(r)}function _ae(t,e){Ue.svgNodeCache[t]&&Ue.svgNodeCache[t][e]&&(Ue.svgNodeCache[t][e].touched=!0)}function Eae(t,e){Ue.svgNodeCache[e]&&Object.keys(Ue.svgNodeCache[e]).forEach(r=>{const n=Ue.svgNodeCache[e][r];!n.touched&&n.domRef&&(t.removeChild(n.domRef),delete Ue.svgNodeCache[e][r])})}function $O(t,e){const r=Cae(t);e(r),r.clearUntouched()}function Ps(t,e,r){return`${t}::${e}::${r}`}function Vo(t,e){Object.keys(t).forEach(r=>{const n=e.getAttribute(r),i=t[r];i===void 0||i===""?e.removeAttribute(r):n!==i&&e.setAttribute(r,i)})}function Rs(t,e){Object.keys(t).forEach(r=>{const n=t[r];n!==void 0&&n!==""&&e.setAttribute(r,n)})}function Si(t,e,r,n,i,o={},a=""){const{color:s,fill:c,width:l,lineWidth:f,lineDash:u,fillOpacity:d,strokeOpacity:h}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},o),g=f||l,p="http://www.w3.org/2000/svg",m=Ps(e,"circle",r),w=t.getSvgNode(m),v={cx:`${n[0]}`,cy:`${n[1]}`,r:`${i}`,stroke:s,fill:c,"stroke-width":g,"stroke-dasharray":u,"fill-opacity":d,"stroke-opacity":h};if(w)Vo(v,w),t.setNodeTouched(m);else{const y=document.createElementNS(p,"circle");a!==""&&y.setAttribute("data-id",a),Rs(v,y),t.appendNode(y,m)}}function jx(t,e,r,n,i={},o=""){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),f=c||s,u="http://www.w3.org/2000/svg",d=Ps(e,"ellipse",r),h=t.getSvgNode(d),[g,p,m,w]=n,v=Math.hypot(m[0]-w[0],m[1]-w[1]),y=Math.hypot(p[0]-g[0],p[1]-g[1]),C=Math.atan2(m[1]-w[1],m[0]-w[0])*180/Math.PI,x=[(m[0]+w[0])/2,(p[1]+g[1])/2],T=v/2,S=y/2,_={cx:`${x[0]}`,cy:`${x[1]}`,rx:`${T}`,ry:`${S}`,stroke:a,fill:"transparent",transform:`rotate(${C} ${x[0]} ${x[1]})`,"stroke-width":f,"stroke-dasharray":l};if(h)Vo(_,h),t.setNodeTouched(d);else{const E=document.createElementNS(u,"ellipse");o!==""&&E.setAttribute("data-id",o),Rs(_,E),t.appendNode(E,d)}}function bae(t,e,r,n,i,o={},a=""){const s=[(n[0]+i[0])/2,n[1]],c=[(n[0]+i[0])/2,i[1]],l=[n[0],(n[1]+i[1])/2],f=[i[0],(n[1]+i[1])/2];jx(t,e,r,[c,s,l,f],o={},a="")}function l1(t,e,r,n,i={},o){const{color:a,handleRadius:s,width:c,lineWidth:l,fill:f,type:u,opacity:d}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),h=l||c,g="http://www.w3.org/2000/svg",p=Ps(e,"handle",`hg-${r}-index-${o}`);let m;if(u==="circle")m={cx:`${n[0]}`,cy:`${n[1]}`,r:s,stroke:a,fill:f,"stroke-width":h,opacity:d};else if(u==="rect"){const y=parseFloat(s)*1.5,C=n[0]-y*.5,x=n[1]-y*.5;m={x:`${C}`,y:`${x}`,width:`${y}`,height:`${y}`,stroke:a,fill:f,"stroke-width":h,rx:`${y*.1}`,opacity:d}}else throw new Error(`Unsupported handle type: ${u}`);const w=t.getSvgNode(p);if(w)Vo(m,w),t.setNodeTouched(p);else{const v=document.createElementNS(g,u);Rs(m,v),t.appendNode(v,p)}}function Wn(t,e,r,n,i={}){n.forEach((o,a)=>{l1(t,e,r,o,i,a)})}function Yt(t,e,r,n,i,o={},a=""){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s="rgb(0, 255, 0)",width:c=10,lineWidth:l,lineDash:f,markerStartId:u=null,markerEndId:d=null,shadow:h=!1,strokeOpacity:g=1,textBoxLinkLineColor:p}=o,m=l||c,w="http://www.w3.org/2000/svg",v=Ps(e,"line",r),y=t.getSvgNode(v),C=t.svgLayerElement.id,x=h?`filter:url(#shadow-${C});`:"",T={x1:`${n[0]}`,y1:`${n[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:p||s,style:x,"stroke-width":m,"stroke-dasharray":f,"marker-start":u?`url(#${u})`:"","marker-end":d?`url(#${d})`:"","stroke-opacity":g};if(y)Vo(T,y),t.setNodeTouched(v);else{const S=document.createElementNS(w,"line");a!==""&&S.setAttribute("data-id",a),Rs(T,S),t.appendNode(S,v)}}function zO(t,e,r,n,i,o={}){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),f=i[0]+(n[0]-i[0])/2,u=[f,n[1]],d=[f,i[1]],h={start:n,end:u},g={start:u,end:d},p={start:d,end:i};Yt(t,e,"1",h.start,h.end,{color:a,width:s,lineWidth:c,lineDash:l}),Yt(t,e,"2",g.start,g.end,{color:a,width:s,lineWidth:c,lineDash:l}),Yt(t,e,"3",p.start,p.end,{color:a,width:s,lineWidth:c,lineDash:l})}function aa(t,e,r,n,i){if(n.length<2)return;const{color:o="rgb(0, 255, 0)",width:a=10,fillColor:s="none",fillOpacity:c=0,lineWidth:l,lineDash:f,closePath:u=!1,markerStartId:d=null,markerEndId:h=null}=i,g=l||a,p="http://www.w3.org/2000/svg",m=Ps(e,"polyline",r),w=t.getSvgNode(m);let v="";for(const C of n)v+=`${C[0].toFixed(1)}, ${C[1].toFixed(1)} `;if(u){const C=n[0];v+=`${C[0]}, ${C[1]}`}const y={points:v,stroke:o,fill:s,"fill-opacity":c,"stroke-width":g,"stroke-dasharray":f,"marker-start":d?`url(#${d})`:"","marker-end":h?`url(#${h})`:""};if(w)Vo(y,w),t.setNodeTouched(m);else{const C=document.createElementNS(p,"polyline");Rs(y,C),t.appendNode(C,m)}}function yc(t,e,r,n,i){const a=n.length&&n[0].length&&Array.isArray(n[0][0])?n:[n],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:l="none",fillOpacity:f=0,lineWidth:u,lineDash:d,closePath:h=!1}=i,g=u||c,p="http://www.w3.org/2000/svg",m=Ps(e,"path",r),w=t.getSvgNode(m);let v="";for(let C=0,x=a.length;C<x;C++){const T=a[C],S=T.length;if(!(S<2)){for(let _=0;_<S;_++){const E=T[_];v+=`${_?"L":"M"} ${E[0].toFixed(1)}, ${E[1].toFixed(1)} `}h&&(v+="Z ")}}if(!v)return;const y={d:v,stroke:s,fill:l,"fill-opacity":f,"stroke-width":g,"stroke-dasharray":d};if(w)Vo(y,w),t.setNodeTouched(m);else{const C=document.createElementNS(p,"path");Rs(y,C),t.appendNode(C,m)}}function B5(t,e,r,n,i,o,a,s,c={},l="",f){const{color:u,fill:d,width:h,lineWidth:g,lineDash:p,fillOpacity:m,strokeOpacity:w}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},c),v=g||h,y="http://www.w3.org/2000/svg",C=Ps(e,"fan",r),x=t.getSvgNode(C),T=a*Math.PI/180,S=s*Math.PI/180,_=n[0],E=n[1],D=_+o*Math.cos(T),b=E+o*Math.sin(T),I=_+o*Math.cos(S),O=E+o*Math.sin(S),M=_+i*Math.cos(T),R=E+i*Math.sin(T),A=_+i*Math.cos(S),B=E+i*Math.sin(S),k=s-a<=180?0:1;let L=`M ${D} ${b}`;L+=` A ${o} ${o} 0 ${k} 1 ${I} ${O}`,L+=` L ${A} ${B}`,L+=` A ${i} ${i} 0 ${k} 0 ${M} ${R}`,L+=" Z";const F={d:L,stroke:u,fill:d,"stroke-width":v,"stroke-dasharray":p,"fill-opacity":m,"stroke-opacity":w,"mix-blend-mode":"normal"};if(x)Vo(F,x),t.setNodeTouched(C);else{const j=document.createElementNS(y,"path");l!==""&&j.setAttribute("data-id",l),f!==void 0&&(j.style.zIndex=f.toString()),Rs(F,j),t.appendNode(j,C)}}function Dc(t,e,r,n,i,o={}){const a=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},o);return Dae(t,e,r,n,i,a)}function Dae(t,e,r,n=[""],i,o){const{padding:a,color:s,fontFamily:c,fontSize:l,background:f,textBoxBorderRadius:u,textBoxMargin:d}=o;let h;const[g,p]=[i[0]+a,i[1]+a],m={color:f,textBoxBorderRadius:u,textBoxMargin:d},w="http://www.w3.org/2000/svg",v=Ps(e,"text",r),y=t.getSvgNode(v);if(y){const C=y.querySelector("text"),x=Array.from(C.children);for(let _=0;_<x.length;_++){const E=x[_],D=n[_]||"";E.textContent=D}if(n.length>x.length){for(let _=0;_<n.length-x.length;_++){const E=n[_+x.length],D=IE(E);C.appendChild(D)}y.appendChild(C),t.appendNode(y,v)}const T={fill:s,"font-size":l,"font-family":c},S={transform:`translate(${g} ${p})`};Vo(T,C),Vo(S,y),y.setAttribute("data-annotation-uid",e),h=ME(y,m),t.setNodeTouched(v)}else{const C=document.createElementNS(w,"g");C.setAttribute("data-annotation-uid",e),C.setAttribute("transform",`translate(${g} ${p})`);const x=Iae(t,o);for(let T=0;T<n.length;T++){const S=n[T],_=IE(S);x.appendChild(_)}C.appendChild(x),t.appendNode(C,v),h=ME(C,m)}return Object.assign({},h,{x:g,y:p,height:h.height+a,width:h.width+a})}function Iae(t,e){const{color:r,fontFamily:n,fontSize:i}=e,a=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,l=`${s}${c}`;return a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("fill",r),a.setAttribute("font-family",n),a.setAttribute("font-size",i),a.setAttribute("style",l),a.setAttribute("pointer-events","visible"),a}function IE(t){const r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttribute("x","0"),r.setAttribute("dy","1.2em"),r.textContent=t,r}function ME(t,e){const{color:r,textBoxBorderRadius:n=0,textBoxMargin:i=0}=e;let o=t.querySelector("rect.background");const a=t.querySelector("text").getBBox();if(!r)return o&&t.removeChild(o),t.getBBox();o||(o=document.createElementNS("http://www.w3.org/2000/svg","rect"),o.setAttribute("class","background"),t.insertBefore(o,t.firstChild));const s=t.getBBox(),c={x:`${s.x}`,y:`${s.y}`,width:`${a.width+Number(i)*2}`,height:`${a.height+Number(i)*2}`,fill:r,rx:n,ry:n};return i&&Array.from(t.querySelector("text").querySelectorAll("tspan")).forEach((f,u)=>{u===0&&f.setAttribute("y",i),f.setAttribute("x",i)}),Vo(c,o),s}function Mae(t,e,r,n,i,o,a={}){const s=n.length>0?F5(n,i):i,c=Oae(o),l=F5(c,s),f=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},a);Yt(t,e,`link-${r}`,s,l,f)}function Oae(t){const{x:e,y:r,height:n,width:i}=t,o=i/2,a=n/2,s=[e+o,r],c=[e,r+a],l=[e+o,r+n],f=[e+i,r+a];return[s,c,l,f]}function Ei(t,e,r,n,i,o,a,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),l=Dc(t,e,r,n,i,c);return Mae(t,e,r,o,i,l,c),l}function Hx(t,e,r,n,i={},o=""){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),f=c||s,u="http://www.w3.org/2000/svg",d=Ps(e,"rect",r),h=t.getSvgNode(d),[g,p,m,w]=n,v=Math.hypot(g[0]-p[0],g[1]-p[1]),y=Math.hypot(g[0]-m[0],g[1]-m[1]),C=[(w[0]+g[0])/2,(w[1]+g[1])/2],x=[(m[0]+g[0])/2,(m[1]+g[1])/2],T=Math.atan2(C[1]-x[1],C[0]-x[0])*180/Math.PI,S={x:`${C[0]-v/2}`,y:`${C[1]-y/2}`,width:`${v}`,height:`${y}`,stroke:a,fill:"transparent",transform:`rotate(${T} ${C[0]} ${C[1]})`,"stroke-width":f,"stroke-dasharray":l};if(h)Vo(S,h),t.setNodeTouched(d);else{const _=document.createElementNS(u,"rect");o!==""&&_.setAttribute("data-id",o),Rs(S,_),t.appendNode(_,d)}}function Og(t,e,r,n,i,o={},a=""){const s=[n[0],n[1]],c=[i[0],n[1]],l=[n[0],i[1]],f=[i[0],i[1]];Hx(t,e,r,[s,c,l,f],o,a)}const OE="http://www.w3.org/2000/svg";function u1(t,e,r,n,i,o={}){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{viaMarker:a=!1,color:s="rgb(0, 255, 0)",markerSize:c=10}=o;if(!a){Pae(t,e,r,n,i,o);return}const l=t.svgLayerElement.id,u=`${`arrow-${e}`}-${l}`,d=t.svgLayerElement.querySelector("defs");let h=d.querySelector(`#${u}`);if(h){h.setAttribute("markerWidth",`${c}`),h.setAttribute("markerHeight",`${c}`);const g=h.querySelector("path");g&&g.setAttribute("fill",s)}else{h=document.createElementNS(OE,"marker"),h.setAttribute("id",u),h.setAttribute("viewBox","0 0 10 10"),h.setAttribute("refX","8"),h.setAttribute("refY","5"),h.setAttribute("markerWidth",`${c}`),h.setAttribute("markerHeight",`${c}`),h.setAttribute("orient","auto");const g=document.createElementNS(OE,"path");g.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),g.setAttribute("fill",s),h.appendChild(g),d.appendChild(h)}o.markerEndId=u,Yt(t,e,r,n,i,o)}function Pae(t,e,r,n,i,o={}){const{color:a="rgb(0, 255, 0)",width:s=2,lineWidth:c,lineDash:l}=o,f=10,u=Math.atan2(i[1]-n[1],i[0]-n[0]),d={start:[i[0]-f*Math.cos(u-Math.PI/7),i[1]-f*Math.sin(u-Math.PI/7)],end:i},h={start:[i[0]-f*Math.cos(u+Math.PI/7),i[1]-f*Math.sin(u+Math.PI/7)],end:i};Yt(t,e,r,n,i,{color:a,width:s,lineWidth:c,lineDash:l}),Yt(t,e,"2",d.start,d.end,{color:a,width:s,lineWidth:c,lineDash:l}),Yt(t,e,"3",h.start,h.end,{color:a,width:s,lineWidth:c,lineDash:l})}function jO(t,e,r,n,i,o={}){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),f=c||s,u="http://www.w3.org/2000/svg",d=Ps(e,"rect",r),h=t.getSvgNode(d),g=[Math.min(n[0],i[0]),Math.min(n[1],i[1])],p=Math.abs(n[0]-i[0]),m=Math.abs(n[1]-i[1]),w={x:`${g[0]}`,y:`${g[1]}`,width:`${p}`,height:`${m}`,stroke:a,fill:"black","stroke-width":f,"stroke-dasharray":l};if(h)Vo(w,h),t.setNodeTouched(d);else{const v=document.createElementNS(u,"rect");Rs(w,v),t.appendNode(v,d)}}const Rae=Object.freeze(Object.defineProperty({__proto__:null,draw:$O,drawArrow:u1,drawCircle:Si,drawEllipse:bae,drawEllipseByCoordinates:jx,drawFan:B5,drawHandle:l1,drawHandles:Wn,drawHeight:zO,drawLine:Yt,drawLinkedTextBox:Ei,drawPath:yc,drawPolyline:aa,drawRect:Og,drawRectByCoordinates:Hx,drawRedactionRect:jO,drawTextBox:Dc,setAttributesIfNecessary:Vo,setNewAttributesIfValid:Rs},Symbol.toStringTag,{value:"Module"}));function HO(t,e){const r=Ce(t),{renderingEngineId:n,viewportId:i}=r,o=lr(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l];if(f&&e.includes(f.mode)){const u=o.getToolInstance(l);a.push(u)}}return a}const{Active:Aae,Passive:Lae,Enabled:Nae}=_n;class Vae{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let r=0;r<e.length;r++){const n=e[r];if(this._needsRender.has(n)&&(this._triggerRender(n),this._needsRender.delete(n),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,r){this._viewportElements.set(e,r)}removeViewportElement(e,r){this._viewportElements.delete(e),this._needsRender.delete(r),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(r=>{this._needsRender.add(r)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const r=[...this._viewportElements.values()];e.forEach(n=>{r.indexOf(n)!==-1&&this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const r=Ce(e);if(!r)return;if(!Bn(r.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=HO(e,[Aae,Lae,Nae]),{renderingEngineId:o,viewportId:a}=r,s={element:e,renderingEngineId:o,viewportId:a};$O(e,c=>{let l=!1;const f=u=>{if(u.renderAnnotation){const d=u.renderAnnotation(r,c);l=l||d}};i.forEach(f),l&&Xe(e,V.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const Kx=new Vae;function $0(t){Kx.renderViewport(t)}function Me(t){t.length&&t.forEach(e=>{const r=xn(e);if(!r){console.warn(`Viewport not available for ${e}`);return}const{viewport:n}=r;if(!n){console.warn(`Viewport not available for ${e}`);return}const i=n.element;$0(i)})}function KO(t,e){const r=t.length,n=[];for(let i=0;i<r;i++){const o=t[i];o.getFrameOfReferenceUID()===e&&n.push(o)}return n}const{Active:kae,Passive:Fae,Enabled:Uae}=_n;function b2(t,e){const r=t.length,n=[];for(let i=0;i<r;i++){const o=t[i],a=lr(o.id,o.renderingEngineId);if(!a)continue;Bae(a,e)&&n.push(o)}return n}function Bae(t,e){const{toolOptions:r}=t,n=r[e];if(!n)return!1;const i=n.mode;return i===kae||i===Fae||i===Uae}function XO(t,e,r=.999){return t.filter(n=>{const i=n.getCamera();return Math.abs(ft(i.viewPlaneNormal,e.viewPlaneNormal))>r})}function vt(t,e,r=!0){const n=Ce(t),{renderingEngine:i,FrameOfReferenceUID:o}=n;let a=i.getViewports();a=KO(a,o),a=b2(a,e);const s=i.getViewport(n.viewportId);return r&&(a=XO(a,s.getCamera())),a.map(l=>l.id)}const Gae=Object.freeze(Object.defineProperty({__proto__:null,filterViewportsWithFrameOfReferenceUID:KO,filterViewportsWithParallelNormals:XO,filterViewportsWithToolEnabled:b2,getViewportIdsWithToolToRender:vt},Symbol.toStringTag,{value:"Module"})),PE=1e-10,f1="PlanarFreehandContourSegmentationTool";function ko(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}function qO(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.canvasToWorld(t[i]);return n}function Pg(t,e){const r=Al(t),n=Al(e);if(!Bx(r,n))return{hasIntersection:!1,isContourHole:!1};const o=S2(t,e),a=!o&&df(e,t);return{hasIntersection:o||a,isContourHole:a}}function YO(t,e){return _g(e).map(r=>{const n=r,i=ko(n.data.contour.polyline,t);return{annotation:n,polyline:i}})}function D2(t,e,r){Sg(e,r),Na(r);const{contour:n}=r.data,i=ko(n.polyline,t);Ga(r,{points:i,closed:n.closed,targetWindingDirection:e.data.contour.windingDirection===to.Clockwise?to.CounterClockwise:to.Clockwise},t);const{element:o}=t;qx(t,[e,r])}function Xx(t,e,r,n,i){if(!g2(f1)){console.warn(`${f1} is not registered in cornerstone. Cannot combine polylines.`);return}const o=i[0],a=Fi(r,o),s=YO(t,e),c=new Set(s),l=new Map,f=(v,y)=>{let C=l.get(v);C||(C=[],l.set(v,C)),C.push(y),c.delete(y)},u=[];if(a){const v=_2(r,i);u.push(v),Array.from(c.keys()).forEach(y=>f(v,y))}else T2(r,i).forEach(y=>{u.push(y),Array.from(c.keys()).forEach(C=>{df(y,C.polyline)&&f(y,C)})});Array.from(l.values()).forEach(v=>v.forEach(y=>B0(y.annotation)));const{element:d}=t,{metadata:h,data:g}=e,{handles:p,segmentation:m}=g,{textBox:w}=p;kt(n.annotationUID),kt(e.annotationUID),Na(n),Na(e);for(let v=0;v<u.length;v++){const y=u[v];if(!y||y.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",y);continue}const C=JO(t,e,y);Ft(C,d),Ec(C),Gt(C,t.element),l.get(y)?.forEach(x=>Sg(C,x.annotation))}qx(t,[e,n])}function JO(t,e,r){const n=t.canvasToWorld(r[0]),i=t.canvasToWorld(r[r.length-1]),o={metadata:{...e.metadata,toolName:f1,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[n,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:un(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Ga(o,{points:r,closed:!0,targetWindingDirection:to.Clockwise},t),o}function qx(t,e){const{element:r}=t,n=new Set([f1]);e.forEach(i=>{n.add(i.metadata.toolName)});for(const i of n.values())if(g2(i)){const o=vt(r,i);Me(o)}}function Yx(t){if(!t||t.length<2)return t;const e=[t[0]];for(let r=1;r<t.length;r++){const n=t[r],i=e[e.length-1],o=Math.abs(n[0]-i[0]),a=Math.abs(n[1]-i[1]);(o>PE||a>PE)&&e.push(n)}return e}function Jx(t){const e=[],r=new Set;for(let n of t){if(!n||n.length<3||(n=Yx(n),n.length<3))continue;const o=[...n].sort((a,s)=>a[0]!==s[0]?a[0]-s[0]:a[1]-s[1]).map(a=>`${a[0].toFixed(6)},${a[1].toFixed(6)}`).join("|");r.has(o)||(r.add(o),e.push(n))}return e}const Wae="PlanarFreehandContourSegmentationTool";function $ae(t,e,r,n,i){return n.forEach(({polyline:o,viewReference:a})=>{if(o.length<3)return;const s={annotationUID:un(),data:{contour:{closed:!0,polyline:o},segmentation:{segmentationId:r,segmentIndex:i},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:Wae,...a}};Ft(s,t.element);const c=e?.get(i)||new Set;c.add(s.annotationUID),e.set(i,c)}),e}function Bh(t){const{metadata:e}=t;if(!e)return{};const{FrameOfReferenceUID:r,referencedImageId:n,referencedImageURI:i,multiSliceReference:o,cameraFocalPoint:a,viewPlaneNormal:s,viewUp:c,sliceIndex:l,volumeId:f,bounds:u}=e;return{FrameOfReferenceUID:r,referencedImageId:n,referencedImageURI:i,multiSliceReference:o,cameraFocalPoint:a,viewPlaneNormal:s,viewUp:c,sliceIndex:l,volumeId:f,bounds:u}}function I2(t,e){if(!t||!e||t.FrameOfReferenceUID!==e.FrameOfReferenceUID||t.referencedImageId!==e.referencedImageId||!t.viewPlaneNormal||!e.viewPlaneNormal||t.viewPlaneNormal.length!==e.viewPlaneNormal.length)return!1;for(let r=0;r<t.viewPlaneNormal.length;r++)if(t.viewPlaneNormal[r]!==e.viewPlaneNormal[r])return!1;return!0}function Gh(t,e){const r=[],n=new Set,i=new Set;for(let o=0;o<t.length;o++){if(n.has(o))continue;const a=t[o];let s=!1;for(let c=0;c<e.length;c++){if(i.has(c))continue;const l=e[c];if(!I2(a.viewReference,l.viewReference))continue;if(W0(a.polyline,l.polyline)){r.push(a),n.add(o),i.add(c),s=!0;break}const f=Pg(a.polyline,l.polyline);if(f.hasIntersection&&!f.isContourHole){const u=_2(a.polyline,l.polyline);r.push({polyline:u,viewReference:a.viewReference}),n.add(o),i.add(c),s=!0;break}}s||(r.push(a),n.add(o))}for(let o=0;o<e.length;o++)i.has(o)||r.push(e[o]);return r}function zae(t){if(t.length===0)return[];if(t.length===1)return[...t[0]];let e=[...t[0]];for(let r=1;r<t.length;r++)e=Gh(e,t[r]);return e}function jae(t,e,r){const n=t.map(o=>({polyline:ko(o.data.contour.polyline,r),viewReference:Bh(o)})),i=e.map(o=>({polyline:ko(o.data.contour.polyline,r),viewReference:Bh(o)}));return Gh(n,i)}function S0(t,e){const r=[];for(let n=0;n<t.length;n++){let i=[t[n]];for(let o=0;o<e.length;o++){const a=e[o],s=[];for(const c of i){if(!I2(c.viewReference,a.viewReference)){s.push(c);continue}if(W0(c.polyline,a.polyline))continue;const l=Pg(c.polyline,a.polyline);if(l.hasIntersection&&!l.isContourHole){const f=Jx(T2(c.polyline,a.polyline));for(const u of f){const d=Yx(u);d.length>=3&&s.push({polyline:d,viewReference:c.viewReference})}}else s.push({polyline:c.polyline,viewReference:c.viewReference})}i=s}r.push(...i)}return r}function Hae(t,e){if(e.length===0)return[...t];let r=[...t];for(let n=0;n<e.length;n++)r=S0(r,e[n]);return r}function Kae(t,e,r){const n=t.map(o=>({polyline:ko(o.data.contour.polyline,r),viewReference:Bh(o)})),i=e.map(o=>({polyline:ko(o.data.contour.polyline,r),viewReference:Bh(o)}));return S0(n,i)}function ZO(t,e){if(!t.length||!e.length)return[];const r=[];for(const n of t)for(const i of e){if(!I2(n.viewReference,i.viewReference))continue;if(W0(n.polyline,i.polyline)){r.push({...n});continue}const o=Pg(n.polyline,i.polyline);if(o.hasIntersection&&!o.isContourHole){const a=Jx(kO(n.polyline,i.polyline));a&&a.length>0&&a.forEach(s=>{r.push({polyline:s,viewReference:n.viewReference})})}}return r}function QO(t,e){if(!t.length&&!e.length)return[];if(!t.length)return e;if(!e.length)return t;if(t.length===e.length){let o=!0;for(let a=0;a<t.length;a++){let s=!1;for(let c=0;c<e.length;c++)if(I2(t[a].viewReference,e[c].viewReference)&&W0(t[a].polyline,e[c].polyline)){s=!0;break}if(!s){o=!1;break}}if(o)return[]}const r=S0(t,e),n=S0(e,t);return[...r,...n]}var Ia;(function(t){t[t.Union=0]="Union",t[t.Subtract=1]="Subtract",t[t.Intersect=2]="Intersect",t[t.XOR=3]="XOR",t[t.Copy=4]="Copy",t[t.Delete=5]="Delete"})(Ia||(Ia={}));function RE(t,e){const r=[],{annotationUIDsMap:n}=t||{};if(!n?.has(e))return;const i=n.get(e);for(const o of i){const a=vn(o),{polyline:s}=a.data.contour;r.push({polyline:s,viewReference:Bh(a)})}return r}function Xae(t,e,r){const n=Ut(e.segmentationId),i=Ut(r.segmentationId);if(!n||!i||!n.representationData.Contour||!i.representationData.Contour)return;const o=RE(n.representationData.Contour,e.segmentIndex),a=RE(i.representationData.Contour,r.segmentIndex);if(!o||!a)return;const s=o.map(({polyline:l,viewReference:f})=>({polyline:ko(l,t),viewReference:f})),c=a.map(({polyline:l,viewReference:f})=>({polyline:ko(l,t),viewReference:f}));return{polyLinesInfoCanvas1:s,polyLinesInfoCanvas2:c}}function qae(t,{segmentIndex:e,label:r,color:n}){if(!t?.segments)return;const i=t.segments[e]??{active:!1,locked:!1,segmentIndex:e,cachedStats:{},label:r,color:n};r!==void 0&&(i.label=r),n!==void 0&&(i.color=n),t.segments[e]=i}function eP(t){t.forEach(e=>{const r=vn(e);kt(e),Na(r)}),t.clear()}function M2(t,e,r,n){const i=Fx(t.segmentationId);if(!i)return;const{polyLinesInfoCanvas1:o,polyLinesInfoCanvas2:a}=Xae(i,t,e)||{};if(!o||!a)return;let s;switch(n){case Ia.Union:s=Gh(o,a);break;case Ia.Subtract:s=S0(o,a);break;case Ia.Intersect:s=ZO(o,a);break;case Ia.XOR:s=QO(o,a);break;default:s=Gh(o,a);break}const c=s.map(({polyline:m,viewReference:w})=>({polyline:qO(m,i),viewReference:w})),l=r,f=Ut(l.segmentationId),u=l.segmentIndex,d=l.color,h=l.label,g=f.representationData.Contour,{annotationUIDsMap:p}=g;if(p){if(t.segmentationId===l.segmentationId&&t.segmentIndex===u){const m=p.get(u);m&&eP(m)}$ae(i,p,f.segmentationId,c,u),qae(f,{segmentIndex:u,color:d,label:h})}}function Yae(t,e,r){M2(t,e,r,Ia.Union)}function Jae(t,e,r){M2(t,e,r,Ia.Subtract)}function Zae(t,e,r){M2(t,e,r,Ia.Intersect)}function Qae(t,e,r){M2(t,e,r,Ia.XOR)}function ese(t,e){MO(t.segmentationId,t.segmentIndex,e.segmentationId,e.segmentIndex)}function tse(t){const e=Ut(t.segmentationId);if(!e){console.log("No active segmentation detected");return}if(!e.representationData.Contour){console.log("No contour representation found");return}const r=e.representationData.Contour,{annotationUIDsMap:n}=r;if(!n){console.log("No annotation map found");return}if(!n.has(t.segmentIndex)){console.log("Segmentation index has no annotations");return}const i=n.get(t.segmentIndex);eP(i)}function z0(t){return!!t.data?.segmentation}function tP(t,e,r){const n=[],i=Al(e);for(let o=0;o<r.length;o++){const a=r[o],s=nse(a.data.contour.polyline,t),c=Al(s);if(!Bx(i,c))continue;const f=S2(e,s),u=!f&&df(s,e);(f||u)&&n.push({targetAnnotation:a,targetPolyline:s,isContourHole:u})}return n}function nse(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}const d1="PlanarFreehandContourSegmentationTool";function nP(t,e,r,n){const i=n.filter(a=>a.isContourHole),o=n.filter(a=>!a.isContourHole);if(i.length>0){const a=i[0];sse(t,a.targetAnnotation,e),rP(t,[e,a.targetAnnotation]);return}if(o.length!==0){if(!g2(d1)){console.warn(`${d1} is not registered in cornerstone. Cannot process multiple intersections.`);return}rse(t,e,r,o)}}function rse(t,e,r,n){const{element:i}=t,o=[e],a=[],s=[];n.forEach(({targetAnnotation:d})=>{const h=ase(t,d);s.push(...h),o.push(d)});const c=r[0];if(n.some(({targetPolyline:d})=>Fi(d,c))){let d=r;n.forEach(({targetPolyline:h})=>{d=_2(d,h)}),a.push(d)}else n.forEach(({targetPolyline:d})=>{const h=T2(d,r);a.push(...h)});o.forEach(d=>{kt(d.annotationUID),Na(d)}),s.forEach(d=>B0(d.annotation));const f=n[0].targetAnnotation,u=[];a.forEach(d=>{if(!d||d.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",d);return}const h=ise(t,f,d);Ft(h,i),Ec(h),Gt(h,t.element),u.push(h)}),ose(t,s,u),rP(t,o)}function ise(t,e,r){const n=t.canvasToWorld(r[0]),i=t.canvasToWorld(r[r.length-1]),o={metadata:{...e.metadata,toolName:d1,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[n,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:un(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Ga(o,{points:r,closed:!0,targetWindingDirection:to.Clockwise},t),o}function ose(t,e,r){e.forEach(n=>{const i=r.find(o=>{const a=Zx(o.data.contour.polyline,t);return df(a,n.polyline)});i&&Sg(i,n.annotation)})}function ase(t,e){return _g(e).map(r=>{const n=r,i=Zx(n.data.contour.polyline,t);return{annotation:n,polyline:i}})}function sse(t,e,r){Sg(e,r),Na(r);const{contour:n}=r.data,i=Zx(n.polyline,t);Ga(r,{points:i,closed:n.closed,targetWindingDirection:e.data.contour.windingDirection===to.Clockwise?to.CounterClockwise:to.Clockwise},t)}function Zx(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}function rP(t,e){const{element:r}=t,n=new Set([d1]);e.forEach(i=>{n.add(i.metadata.toolName)});for(const i of n.values())if(g2(i)){const o=vt(r,i);Me(o)}}const{isEqual:AE}=gn;function Qx(t){const{metadata:e}=t;return R7().filter(r=>{if(r.FrameOfReferenceUID===e.FrameOfReferenceUID){const n=r.viewport,{viewPlaneNormal:i,viewUp:o}=n.getCamera();return AE(i,e.viewPlaneNormal)&&(!e.viewUp||AE(o,e.viewUp))}}).map(r=>r.viewport)}async function cse(t,e,r,n=!0){const i=typeof t=="string"?vn(t):t,o=typeof e=="string"?vn(e):e;if(!i||!o)throw new Error("Both source and target annotations must be valid");r||(r=lse(i));const a=ko(i.data.contour.polyline,r),s=ko(o.data.contour.polyline,r),c=Pg(a,s);if(!c.hasIntersection){console.warn("No intersection found between the two annotations");return}if(c.isContourHole){if(!n){console.warn("Hole processing is disabled");return}D2(r,o,i)}else Xx(r,o,s,i,a)}function lse(t){const e=Qx(t);if(!e.length)throw new Error("No viewport found for the annotation");return e[0]}const use=Object.freeze(Object.defineProperty({__proto__:null,get LogicalOperation(){return Ia},add:Yae,addContourSegmentationAnnotation:Ec,areSameSegment:hO,checkIntersection:Pg,cleanupPolylines:Jx,combinePolylines:Xx,contourSegmentationOperation:cse,convertContourPolylineToCanvasSpace:ko,convertContourPolylineToWorld:qO,convertContourSegmentationAnnotation:Vx,copy:ese,copyAnnotation:IO,copyContourSegment:MO,createNewAnnotationFromPolyline:JO,createPolylineHole:D2,deleteOperation:tse,findAllIntersectingContours:tP,getContourHolesData:YO,intersect:Zae,intersectPolylinesSets:ZO,isContourSegmentationAnnotation:z0,processMultipleIntersections:nP,removeContourSegmentationAnnotation:Na,removeDuplicatePoints:Yx,subtract:Jae,subtractAnnotationPolylines:Kae,subtractMultiplePolylineSets:Hae,subtractPolylineSets:S0,unifyAnnotationPolylines:jae,unifyMultiplePolylineSets:zae,unifyPolylineSets:Gh,updateViewportsForAnnotations:qx,xor:Qae,xorPolylinesSets:QO},Symbol.toStringTag,{value:"Module"}));function fse(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==hs.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function dse(t,e,r,n){r.size?t.render():hse(t,e,n)}function hse(t,e,r){const{segmentationId:n}=r,i=new Map;e.forEach(o=>{const a=Ae.getGeometry(o);if(!a){console.warn(`No geometry found for geometryId ${o}. Skipping render.`);return}const s=a.data.segmentIndex;fse(a);const c=fo.getStyle({viewportId:t.id,segmentationId:n,type:yt.Contour,segmentIndex:s}),l=a.data,f=t.getCamera().viewPlaneNormal;l.contours.forEach(u=>{const{points:d,color:h,id:g}=u,p=Ax(t,d[0],f),m={annotationUID:un(),data:{contour:{closed:!0,polyline:d},segmentation:{segmentationId:n,segmentIndex:s,color:h,id:g},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:p,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},w=t.element;Ft(m,w),Ec(m)}),c&&i.set(s,c)}),t.render()}function iP(t){const e=Zie(t);if(e)return e;const r=Ut(t);if(!r)throw new Error(`No segmentation found for segmentationId ${t}`);let n;if(r.representationData.Labelmap)n=gse(r,t);else if(r.representationData.Contour)n=vse(r);else if(r.representationData.Surface)n=yse(r);else throw new Error(`Unsupported segmentation type: ${r.representationData}`);return Qie(t,n),n}function gse(t,e){const r=t.representationData[yt.Labelmap],n=new Set;return r.imageIds?mse(n,r.imageIds):pse(n,e),Array.from(n).map(Number).sort((i,o)=>i-o)}function pse(t,e){Ae.getVolume(e).voxelManager.forEach(({value:n})=>{n!==0&&t.add(n)})}function mse(t,e){e.forEach(r=>{Ae.getImage(r).voxelManager.getScalarData().forEach(o=>{o!==0&&t.add(o)})})}function vse(t){const{annotationUIDsMap:e,geometryIds:r}=t.representationData.Contour||{};if(!r)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const n=new Set([...e.keys()]);return r.forEach(i=>{const o=Ae.getGeometry(i);n.add(o.data.segmentIndex)}),Array.from(n).sort((i,o)=>i-o)}function yse(t){const e=t.representationData.Surface?.geometryIds??[];return Array.from(e.keys()).map(Number).sort((r,n)=>r-n)}const bf=new Map,LE=new Map;function wse(t,e,r=!1){const n=xn(t);if(!n)return;const{viewport:i}=n;r&&i.render()}async function Cse(t,e){const{segmentationId:r}=e,n=Ut(r);if(!n)return;let i=n.representationData[yt.Contour];const o=ys();if(!i&&ys()?.canComputeRequestedRepresentation(r,yt.Contour)&&!bf.get(t.id)?(bf.set(t.id,!0),i=await Ox(r,yt.Contour,()=>o.computeContourData(r,{viewport:t})),bf.set(t.id,!1)):!i&&!ys()&&console.debug(`No contour data found for segmentationId ${r} and PolySeg add-on is not configured. Unable to convert from other representations to contour. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`),!i||!i.geometryIds?.length)return;let a=!1;const s=t.getCamera().viewPlaneNormal;i.annotationUIDsMap&&(a=!Tse(i.annotationUIDsMap,s)),i.geometryIds.length>0&&(a=!xse(i.geometryIds,s));const c=LE.get(t.id)||new Set;if(a&&!bf.get(t.id)&&!c.has(r)&&t.viewportStatus===Ni.RENDERED){bf.set(t.id,!0);const l=iP(r),u=(await o.computeSurfaceData(r,{segmentIndices:l,viewport:t})).geometryIds,d=[];for(const m of u.values()){const v=Ae.getGeometry(m).data;d.push({points:v.points,polys:v.polys,segmentIndex:v.segmentIndex,id:v.segmentIndex})}const h=await o.clipAndCacheSurfacesForViewport(d,t),g=o.extractContourData(h),p=o.createAndAddContourSegmentationsFromClippedSurfaces(g,t,r);i.annotationUIDsMap=new Map([...i.annotationUIDsMap,...p]),c.add(r),LE.set(t.id,c),bf.set(t.id,!1)}dse(t,i.geometryIds,i.annotationUIDsMap,e)}function xse(t,e){let r=null,n=null;for(const f of t){const u=Ae.getGeometry(f);if(!u)continue;const d=u.data;if(d.contours?.[0]?.points?.length>=3){r=u,n=d;break}}if(!r||!n)return!1;const i=n.contours,{points:o}=i[0],[a]=o,s=Ie(),{length:c}=o,l=Math.ceil(c/25);for(let f=1;f<c;f+=l){const u=o[f];if(an(s,a,u),At(s,s),ft(e,s)>.1)return!1}return!0}function Tse(t,e){const r=Array.from(t.values()).flat().map(i=>Array.from(i)).flat(),n=cx(r,3);for(const i of n){const o=vn(i);if(o?.metadata){if(!o.metadata.viewPlaneNormal)continue;const a=o.metadata.viewPlaneNormal,s=Math.abs(e[0]*a[0]+e[1]*a[1]+e[2]*a[2]);if(Math.abs(s-1)>.01)return!1}}return!0}function Sse(t){return null}const e3={getUpdateFunction:Sse,render:Cse,removeRepresentation:wse};function kl(t,e){const r=Ic(t,e);if(r?.length)return r[0]}function Ic(t,e){return An.getCurrentLabelmapImageIdsForViewport(t,e)}function _se(t,e){return An.getLabelmapImageIdsForImageId(t,e)}const NE=new Map,Ese=({cfun:t,ofun:e,actor:r})=>{r.getProperty().setRGBTransferFunction(1,t),r.getProperty().setScalarOpacity(1,e)};async function bse({viewport:t,volumeInputs:e,segmentationId:r}){const n=t.getDefaultActor(),{actor:i}=n,{uid:o,callback:a}=n,s=t.getVolumeId();if(NE.get(o)?.added)return{uid:o,actor:i};const c=e,l=Ae.getVolume(c[0].volumeId);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{volumeId:f}=c[0],u=await BC(f);if(!u)throw new Error(`segImageVolume with id: ${u.volumeId} does not exist`);const h=u.voxelManager.getCompleteScalarDataArray(),{imageData:g}=u,p=Ae.getVolume(s),w=p.voxelManager.getCompleteScalarDataArray(),v=2,y=new Float32Array(v*p.voxelManager.getScalarDataLength()),C=g.getDimensions();for(let E=0;E<C[2];++E)for(let D=0;D<C[1];++D)for(let b=0;b<C[0];++b){const I=b+C[0]*(D+C[1]*E);y[I*v+0]=w[I],y[I*v+1]=h[I]}t.removeActors([o]);const x=i.getMapper(),T=w9(x);i.setMapper(T),T.setBlendMode(ds.LABELMAP_EDGE_PROJECTION_BLEND);const S=T.getInputData().getPointData().getArray(0);S.setData(y),S.setNumberOfComponents(2),i.getProperty().setColorMixPreset(1),i.getProperty().setForceNearestInterpolation(1,!0),i.getProperty().setIndependentComponents(!0),t.addActor({actor:i,uid:o,callback:a,referencedId:s,representationUID:`${r}-${yt.Labelmap}`}),NE.set(o,{added:!0,segmentationRepresentationUID:`${r}`,originalBlendMode:t.getBlendMode()}),i.set({preLoad:Ese});function _(E){const{segmentationId:D}=E.detail,{representationData:b}=Ut(D),{volumeId:I}=b.Labelmap;if(I!==u.volumeId)return;const M=Ae.getVolume(I).voxelManager,R=T.getInputData(),A=R.getPointData().getArray(0),B=A.getData(),k=2,L=g.getDimensions(),F=Array.from({length:L[2]},(j,J)=>J);for(const j of F)for(let J=0;J<L[1];++J)for(let ie=0;ie<L[0];++ie){const fe=ie+L[0]*(J+L[1]*j);B[fe*k+1]=M.getAtIndex(fe)}A.setData(B),R.modified(),t.render()}return ke.addEventListenerDebounced(V.SEGMENTATION_DATA_MODIFIED,_,200),ke.addEventListener(V.SEGMENTATION_REPRESENTATION_REMOVED,async E=>{ke.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,_);const D=t.getActor(o),{element:b,id:I}=t;t.removeActors([o]);const O=await Fm({volumeId:o,blendMode:ds.MAXIMUM_INTENSITY_BLEND,callback:({volumeActor:M})=>{D.callback&&D.callback({volumeActor:M,volumeId:f})}},b,I);t.addActor({actor:O,uid:o}),t.render()}),{uid:o,actor:i}}const{uuidv4:oP}=gn;async function Dse(t,e,r,n){const i=Ce(t),{renderingEngine:o,viewport:a}=i,{id:s}=a,c=!0,l=!1,f=!0;if(a instanceof ir){const d=Ise(e,r);Ae.getVolume(d)||await Mse(e);let h=n?.blendMode??ds.MAXIMUM_INTENSITY_BLEND,g=h===ds.LABELMAP_EDGE_PROJECTION_BLEND;if(g){const m=a.getVolumeId(),w=Ae.getVolume(m),y=Ae.getVolume(d).dimensions,C=w.dimensions;(y[0]!==C[0]||y[1]!==C[1]||y[2]!==C[2])&&(g=!1,h=ds.MAXIMUM_INTENSITY_BLEND,console.debug("Dimensions mismatch - falling back to regular volume addition"))}const p=[{volumeId:d,visibility:c,representationUID:`${r}-${yt.Labelmap}`,useIndependentComponents:g,blendMode:h}];if(!p[0].useIndependentComponents)await J9(o,p,[s],l,f);else return await bse({viewport:a,volumeInputs:p,segmentationId:r})}else{const d=Ic(a.id,r).map(h=>({imageId:h,representationUID:`${r}-${yt.Labelmap}-${h}`}));Z9(o,d,[s])}ui(r)}function Ise(t,e){let{volumeId:r}=t;if(!r){r=oP();const n=Ut(e);n.representationData.Labelmap={...n.representationData.Labelmap,volumeId:r},t.volumeId=r,la(e)}return r}async function Mse(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await WC(t.volumeId||oP(),e.imageIds)}function Ose(t,e){const r=Ce(t),{viewport:n}=r;n.removeActors([foe(n.id,e)])}function nf(t){return An.getActiveSegmentation(t)}function Pse(t,e){An.setActiveSegmentation(t,e)}function Oc(t){return nf(t)}function Rse(t,e){Pse(t,e)}const Ase=Object.freeze(Object.defineProperty({__proto__:null,getActiveSegmentation:Oc,setActiveSegmentation:Rse},Symbol.toStringTag,{value:"Module"}));function no(t){const e=Ut(t);if(e){const r=Object.keys(e.segments).find(n=>e.segments[n].active);return r?Number(r):void 0}}const iy=255,Xd=new Map;let oy=!1;function Lse(t,e,r=!1){const n=xn(t);if(Xd.forEach((o,a)=>{a.includes(e)&&Xd.delete(a)}),!n)return;const{viewport:i}=n;Ose(i.element,e),r&&i.render()}async function Nse(t,e){const{segmentationId:r,config:n}=e,i=Ut(r);if(!i){console.warn("No segmentation found for segmentationId: ",r);return}let o=i.representationData[yt.Labelmap],a=Kd(t.id,r);if(!o&&ys()?.canComputeRequestedRepresentation(r,yt.Labelmap)&&!oy){oy=!0;const s=ys();if(o=await Ox(r,yt.Labelmap,()=>s.computeLabelmapData(r,{viewport:t}),()=>{An.processLabelmapRepresentationAddition(t.id,r),setTimeout(()=>{ui(r)},0)}),!o)throw new Error(`No labelmap data found for segmentationId ${r}.`);oy=!1}else!o&&!ys()&&console.debug(`No labelmap data found for segmentationId ${r} and PolySeg add-on is not configured. Unable to convert from other representations to labelmap. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(o){if(t instanceof zn)a?.length||await kE(t,o,r,n),a=Kd(t.id,r);else{if(!Ic(t.id,r)?.length)return;a||await kE(t,o,r,n),a=Kd(t.id,r)}if(a?.length)for(const s of a)Vse(t.id,s,e)}}function Vse(t,e,r){const{segmentationId:n}=r,{cfun:i,ofun:o}=r.config,{colorLUTIndex:a}=r,c=Oc(t)?.segmentationId===n,l=fo.getStyle({viewportId:t,type:yt.Labelmap,segmentationId:n}),f=fo.getRenderInactiveSegmentations(t),u=bg(a),d=Math.min(256,u.length),{outlineWidth:h,renderOutline:g,outlineOpacity:p,activeSegmentOutlineWidthDelta:m}=VE(l,c),w=Px(t,{segmentationId:n,type:yt.Labelmap});for(let x=0;x<d;x++){const T=x,S=u[T],E=fo.getStyle({viewportId:t,type:yt.Labelmap,segmentationId:n,segmentIndex:T}),{fillAlpha:D,outlineWidth:b,renderFill:I,renderOutline:O}=VE(l,c,E),{forceOpacityUpdate:M,forceColorUpdate:R}=kse(t,n,T,{fillAlpha:D,renderFill:I,renderOutline:O,segmentColor:S,outlineWidth:b,segmentsHidden:w,cfun:i,ofun:o});if(R&&i.addRGBPoint(T,S[0]/iy,S[1]/iy,S[2]/iy),M)if(I){const A=w.has(T)?0:S[3]/255*D;o.removePoint(T),o.addPointLong(T,A,.5,1)}else o.addPointLong(T,.01,.5,1)}o.setClamping(!1);const v=e.actor,{preLoad:y}=v.get?.("preLoad")||{preLoad:null};if(y?y({cfun:i,ofun:o,actor:v}):(v.getProperty().setRGBTransferFunction(0,i),v.getProperty().setScalarOpacity(0,o),v.getProperty().setInterpolationTypeToNearest()),g){v.getProperty().setUseLabelOutline(g),v.getProperty().setLabelOutlineOpacity(p);const x=no(r.segmentationId),T=new Array(d-1);for(let S=1;S<d;S++){if(w.has(S)){T[S-1]=0;continue}T[S-1]=S===x?h+m:h}v.getProperty().setLabelOutlineThickness(T),v.modified(),v.getProperty().modified(),v.getMapper().modified()}else v.getProperty().setLabelOutlineThickness(new Array(d-1).fill(0));const C=c||f;v.setVisibility(C)}function VE(t,e,r){const i={...t,...r||{}},o=e?i.fillAlpha:i.fillAlphaInactive,a=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,l=e?i.outlineOpacity:i.outlineOpacityInactive,f=i.activeSegmentOutlineWidthDelta;return{fillAlpha:o,outlineWidth:a,renderFill:s,renderOutline:c,outlineOpacity:l,activeSegmentOutlineWidthDelta:f}}function kse(t,e,r,{fillAlpha:n,renderFill:i,renderOutline:o,segmentColor:a,outlineWidth:s,segmentsHidden:c,cfun:l,ofun:f}){const u=`${t}-${e}-${r}`,d=Xd.get(u);if(!d)return Xd.set(u,{fillAlpha:n,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:h,renderFill:g,renderOutline:p,outlineWidth:m,segmentColor:w,segmentsHidden:v,cfunMTime:y,ofunMTime:C}=d,x=w[0]!==a[0]||w[1]!==a[1]||w[2]!==a[2],T=w[3]!==a[3]||h!==n||g!==i||p!==o||m!==s||v!==c;return(T||x)&&Xd.set(u,{fillAlpha:n,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:T,forceColorUpdate:x}}async function kE(t,e,r,n){return await Dse(t.element,e,r,n)||void 0}function Fse(t){}const t3={getUpdateFunction:Fse,render:Nse,removeRepresentation:Lse},{CalibrationTypes:xu}=go,ay="px",FE="voxels",aP=[1,2,3,4],Use=["4,3","4,7"],G5={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},sy="",Bse=[xu.ERMF,xu.USER,xu.ERROR,xu.PROJECTION,xu.CALIBRATED,xu.UNKNOWN],Fo=(t,e)=>{const{calibration:r,hasPixelSpacing:n,spacing:i=[1,1,1]}=t;let o=n?"mm":ay;const a=n?"mm":FE;let s=o+sy;const c=r?.scale||1;let l=c/(r?.columnPixelSpacing||i[0]),f=c/(r?.rowPixelSpacing||i[1]),u=c/i[2],d="";if(!r||!r.type&&!r.sequenceOfUltrasoundRegions)return{unit:o,areaUnit:s,scale:l,scaleY:f,scaleZ:u,volumeUnit:a};if(Bse.includes(r?.type)&&(d=r.type),r.type===xu.UNCALIBRATED)return{unit:ay,areaUnit:ay+sy,scale:l,scaleY:f,scaleZ:u,volumeUnit:FE};if(r.sequenceOfUltrasoundRegions){const h=r.sequenceOfUltrasoundRegions.find(g=>e.every(p=>p[0]>=g.regionLocationMinX0&&p[0]<=g.regionLocationMaxX1&&p[1]>=g.regionLocationMinY0&&p[1]<=g.regionLocationMaxY1)&&aP.includes(g.regionDataType));if(h&&h.physicalUnitsXDirection===h.physicalUnitsYDirection){const g=Math.abs(h.physicalDeltaX),p=Math.abs(h.physicalDeltaY);l=1/g,f=1/p,d="US Region",o=G5[h.physicalUnitsXDirection]||"unknown",s=o+sy}}else r.scale&&(l=r.scale);return{unit:o+(d?` ${d}`:""),areaUnit:s+(d?` ${d}`:""),volumeUnit:a+(d?` ${d}`:""),scale:l,scaleY:f,scaleZ:u}},h1=(t,e)=>{const[r]=e,{calibration:n}=t;let i=["raw"],o=[null],a="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{units:i,values:o};if(n.sequenceOfUltrasoundRegions){const s=n.sequenceOfUltrasoundRegions.filter(p=>aP.includes(p.regionDataType)&&Use.includes(`${p.physicalUnitsXDirection},${p.physicalUnitsYDirection}`));if(!s?.length)return{units:i,values:o};const c=s.find(p=>r[0]>=p.regionLocationMinX0&&r[0]<=p.regionLocationMaxX1&&r[1]>=p.regionLocationMinY0&&r[1]<=p.regionLocationMaxY1);if(!c)return{units:i,values:o};const{referencePixelX0:l=0,referencePixelY0:f=0}=c,{physicalDeltaX:u,physicalDeltaY:d}=c,h=(r[1]-c.regionLocationMinY0-f)*d,g=(r[0]-c.regionLocationMinX0-l)*u;a="US Region",o=[g,h],i=[G5[c.physicalUnitsXDirection],G5[c.physicalUnitsYDirection]]}return{units:i,values:o,calibrationType:a}},n3=t=>t.calibration?.aspect||1,{isEqual:cy}=gn,{EPSILON:Gse}=Mc,Wse=1-Gse;function r3(t,e,r){const{viewPlaneNormal:n}=e,i=t.filter(c=>{const{planeRestriction:l,referencedImageId:f}=c.metadata;let{viewPlaneNormal:u}=c.metadata;if(l){const{inPlaneVector1:h,inPlaneVector2:g}=l;return!(h&&!cy(0,ft(n,h))||g&&!cy(0,ft(n,g)))}if(!c.metadata.referencedImageId&&!u&&c.metadata.FrameOfReferenceUID){for(const h of c.data.handles.points){const g=an(Ie(),h,e.focalPoint),p=ft(g,n);if(!cy(p,0))return!1}return c.metadata.viewPlaneNormal=n,c.metadata.cameraFocalPoint=e.focalPoint,!0}if(!u&&f){const{imageOrientationPatient:h}=ut("imagePlaneModule",f),g=mt(h[0],h[1],h[2]),p=mt(h[3],h[4],h[5]);u=Ie(),nn(u,g,p),c.metadata.viewPlaneNormal=u}const d=Math.abs(ft(n,u))>Wse;return u&&d});if(!i.length)return[];const o=r/2,{focalPoint:a}=e,s=[];for(const c of i){const{data:l,metadata:f,isVisible:u}=c;if(!u)continue;const d=f.planeRestriction?.point||l.handles?.points?.[0]||l.contour?.polyline[0];if(!d){s.push(c);continue}const h=an(Ie(),a,d);Math.abs(ft(h,n))<o&&s.push(c)}return s}function O2(t,e,r,n){const i=Ie();nn(i,e,t);const o=mt(...r),a=mt(...n),s=Ie();qt(s,o,a);const c=_r(s);if(c<1e-4)return{worldWidth:0,worldHeight:0};const l=ft(s,i)/(c*_r(i)),u=Math.sqrt(1-l*l)*c,d=l*c;return{worldWidth:u,worldHeight:d}}function Rg(t,e,r={}){if(t instanceof zn){const n=t.getCamera(),{spacingInNormalDirection:i}=N0(t,n);return r3(e,n,i)}if(t instanceof qn){const n=t.getCurrentImageId();if(!n)return[];const i=n.indexOf(":");r.imageURI=n.substring(i+1)}return e.filter(n=>n.isVisible?n.data.isCanvasAnnotation?!0:t.isReferenceViewable(n.metadata,r):!1)}function Ag(t,e,r,n){const i=Ie();nn(i,e,t);const o=mt(...r),a=mt(...n),s=Ie();qt(s,o,a);const c=_r(s);if(c<1e-4)return{worldWidth:0,worldHeight:0};const l=ft(s,i)/(c*_r(i)),u=Math.sqrt(1-l*l)*c,d=l*c;return{worldWidth:u,worldHeight:d}}function i3(t,e,r,n,i=.25){const o=o3(t,e,{targetVolumeId:r,stepSize:i});let a;for(const s of o){const c=t.getIntensityFromWorld(s),l=n(c,s);l&&(a=l)}return a}function o3(t,e,{targetVolumeId:r,stepSize:n}){const i=t.getCamera(),{viewPlaneNormal:o}=i,{spacingInNormalDirection:a}=N0(t,i,r),s=a*n||1,c=t.getBounds(),l=[];let f=[...e];for(;UE(f,c);)l.push([...f]),f[0]+=o[0]*s,f[1]+=o[1]*s,f[2]+=o[2]*s;for(f=[...e];UE(f,c);)l.push([...f]),f[0]-=o[0]*s,f[1]-=o[1]*s,f[2]-=o[2]*s;return l}const UE=function(t,e){const[r,n,i,o,a,s]=e,c=10;return t[0]>r+c&&t[0]<n-c&&t[1]>i+c&&t[1]<o-c&&t[2]>a+c&&t[2]<s-c},sP=(t,e,r,n,i,o,a,s)=>{const c=[mt(r,n,i),mt(o,n,i),mt(r,a,i),mt(o,a,i),mt(r,n,s),mt(o,n,s),mt(r,a,s),mt(o,a,s)],l=mt(e[0],e[1],e[2]),f=mt(t[0],t[1],t[2]),u=-ft(l,f);let d=null;for(const h of c){const g=ft(l,h)+u;if(d===null)d=Math.sign(g);else if(Math.sign(g)!==d)return!0}return!1},{EPSILON:$se}=Mc,zse=1-$se;function P2(t,e){const{viewPlaneNormal:r}=e,n=t.filter(i=>{let o=i.metadata.viewPlaneNormal;if(!o){const{referencedImageId:s}=i.metadata,{imageOrientationPatient:c}=ut("imagePlaneModule",s),l=mt(c[0],c[1],c[2]),f=mt(c[3],c[4],c[5]);o=Ie(),nn(o,l,f),i.metadata.viewPlaneNormal=o}const a=Math.abs(ft(r,o))>zse;return o&&a});return n.length?n:[]}const jse={filterAnnotationsWithinSlice:r3,getWorldWidthAndHeightFromCorners:O2,getWorldWidthAndHeightFromTwoPoints:Ag,filterAnnotationsForDisplay:Rg,getPointInLineOfSightWithCriteria:i3,isPlaneIntersectingAABB:sP,filterAnnotationsWithinSamePlane:P2,getPointsInLineOfSight:o3},Hse=Object.freeze(Object.defineProperty({__proto__:null,default:jse,filterAnnotationsForDisplay:Rg,filterAnnotationsWithinSamePlane:P2,filterAnnotationsWithinSlice:r3,getPointInLineOfSightWithCriteria:i3,getPointsInLineOfSight:o3,getWorldWidthAndHeightFromCorners:O2,getWorldWidthAndHeightFromTwoPoints:Ag,isPlaneIntersectingAABB:sP},Symbol.toStringTag,{value:"Module"}));function a3(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function j0(t,e,r){let n,i,o,a,s,c,l=0,f=!1,u=!1,d=!0;const h=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,a3(r)&&(f=!!r.leading,u="maxWait"in r,o=u?Math.max(Number(r.maxWait)||0,e):o,d="trailing"in r?!!r.trailing:d);function g(D){const b=n,I=i;return n=i=void 0,l=D,a=t.apply(I,b),a}function p(D,b){return h?window.requestAnimationFrame(D):setTimeout(D,b)}function m(D){if(h)return window.cancelAnimationFrame(D);clearTimeout(D)}function w(D){return l=D,s=p(C,e),f?g(D):a}function v(D){const b=D-c,I=D-l,O=e-b;return u?Math.min(O,o-I):O}function y(D){const b=D-c,I=D-l;return c===void 0||b>=e||b<0||u&&I>=o}function C(){const D=Date.now();if(y(D))return x(D);s=p(C,v(D))}function x(D){return s=void 0,d&&n?g(D):(n=i=void 0,a)}function T(){s!==void 0&&m(s),l=0,n=c=i=s=void 0}function S(){return s===void 0?a:x(Date.now())}function _(){return s!==void 0}function E(...D){const b=Date.now(),I=y(b);if(n=D,i=this,c=b,I){if(s===void 0)return w(c);if(u)return s=p(C,e),g(c)}return s===void 0&&(s=p(C,e)),a}return E.cancel=T,E.flush=S,E.pending=_,E}function $i(t,e,r){let n=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return a3(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),j0(t,e,{leading:n,trailing:i,maxWait:e})}function Kse(t){return t[0]?.length===3}function Xse(t,e){if(!e||e.length===0||e.length===t.length)return t;const r=e[e.length-1]-e[0]+1,n=zv(e.map(o=>t[o][0])),i=zv(e.map(o=>t[o][1]));if(Kse(t)){const o=zv(e.map(a=>t[a][2]));return O_(hd(n,r),hd(i,r),hd(o,r))}else return O_(hd(n,r),hd(i,r))}function qse(t,e){const r=[],[n,i]=e,o=i-n+1,a=Math.floor(o/t);let s=0,c=Math.round((o-1)/(a-1)*s)+n;for(;c<=i;)r.push(c),s++,c=Math.round((o-1)/(a-1)*s)+n;return r}function g1(t,e,r,n){const i=r-e+1,o=Math.floor(n/100*i)??1,a=Math.floor(i/o)??1;if(isNaN(i)||!i||!a||i/a<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,r),l=t.slice(0,s),f=t.slice(c+1,t.length),u=qse(a,[s,c]),d=Xse(t,u);return[...l,...d,...f]}function R2(t,e){return e?.autoGenerated?!1:t?.smoothing?.smoothOnAdd===!0||t?.smoothing?.smoothOnEdit===!0}function Yse(t,e){return Os(t,e)<.001}function Jse(t,e){return Os(t,e)===0}function Zse(t,e){for(let r=0;r<t.length;r++)for(let n=0;n<e.length;n++)if(Jse(t[r],e[n]))return[r,n]}function kf(t,e,r){return(t+e+r)%e}function BE(t,e,r,n){const[,i,o]=t,[,a,s]=e,c=o.length,l=s.length;let f=t[0],u=e[0];if(!o[f]||!s[u]||!o[i]||!s[a])return[void 0,void 0];for(;f!==i&&u!==a;){if(r(s[u],o[f]))return[f,u];f=kf(f,c,n),u=kf(u,l,n)}return[void 0,void 0]}function Qse(t,e){const[r,n]=Zse(t,e)||[],i=(c,l)=>Yse(c,l)===!1,[o,a]=BE([kf(r,t.length,1),r,t],[kf(n,e.length,1),n,e],i,1),[s]=BE([kf(o,t.length,-1),o,t],[kf(a,e.length,-1),a,e],i,-1);return[o,s]}function A2(t,e,r){const{interpolation:n,smoothing:i}=t,o=e;if(n){const{knotsRatioPercentageOnAdd:a,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:l=!1}=i,f=r?s:a;if(r?l:c){const[d,h]=r?Qse(e,r):[0,e.length-1];return!e[d]||!e[h]?e:g1(e,d,h,f)}}return o}const H0=t=>{if(t.shiftKey)return t.ctrlKey?Qr.ShiftCtrl:t.altKey?Qr.ShiftAlt:t.metaKey?Qr.ShiftMeta:Qr.Shift;if(t.ctrlKey)return t.altKey?Qr.CtrlAlt:t.metaKey?Qr.CtrlMeta:Qr.Ctrl;if(t.altKey)return t.metaKey&&Qr.AltMeta||Qr.Alt;if(t.metaKey)return Qr.Meta};function s3(t,e){const r=t[0],n=t[t.length-1],i=xt();Qo(i,n[0]-r[0],n[1]-r[1]),cs(i,i);const o=xt(),a=xt();Qo(o,-i[1],i[0]),Qo(a,i[1],-i[0]);const s=[(r[0]+n[0])/2,(r[1]+n[1])/2],c={dist:0,index:null};for(let u=0;u<t.length;u++){const d=t[u],h=nC(d,s);h>c.dist&&(c.dist=h,c.index=u)}return[t[c.index],s].map(e.canvasToWorld)}function ece(t,e){const{viewport:r}=t,n=e.data.contour.polyline.map(r.worldToCanvas);return s3(n,r)}const{addCanvasPointsToArray:c3,pointsAreWithinCloseContourProximity:cP,getFirstLineSegmentIntersectionIndexes:lP,getSubPixelSpacingAndXYDirections:tce}=Vl;function nce(t,e,r){this.isDrawing=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=Ce(o),{viewport:c}=s,l=H0(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:f,xDir:u,yDir:d}=tce(c,this.configuration.subPixelResolution)||{};!f||!u||!d||(this.drawData={canvasPoints:[a],polylineIndex:0,contourHoleProcessingEnabled:l,newAnnotation:!0},this.commonData={annotation:e,viewportIdsToRender:r,spacing:f,xDir:u,yDir:d,movingTextBox:!1},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpDrawCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_END,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpDrawCallback),St(o))}function rce(t){Ue.isInteractingWithTool=!1,t.removeEventListener(V.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(V.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(V.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(V.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(V.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(V.TOUCH_TAP,this.mouseUpDrawCallback),Vt(t)}function ice(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=Ce(n),{viewport:s}=a,{annotation:c,viewportIdsToRender:l,xDir:f,yDir:u,spacing:d,movingTextBox:h}=this.commonData,{polylineIndex:g,canvasPoints:p,newAnnotation:m}=this.drawData;this.createMemo(n,c,{newAnnotation:m});const w=p[p.length-1],v=s.canvasToWorld(w),y=Ie();qt(y,i,v);const C=Math.abs(ft(y,f)),x=Math.abs(ft(y,u));if(!(C<=d[0]&&x<=d[1])){if(h){this.isDrawing=!1;const{deltaPoints:T}=e,S=T.world,{textBox:_}=c.data.handles,{worldPosition:E}=_;E[0]+=S[0],E[1]+=S[1],E[2]+=S[2],_.hasMoved=!0}else{const T=this.findCrossingIndexDuringCreate(t);if(T!==void 0)this.applyCreateOnCross(t,T);else{const S=c3(n,p,o,this.commonData);this.drawData.polylineIndex=g+S}c.invalidated=!0}Me(l),c.invalidated&&Gt(c,n,Nt.HandlesUpdated)}}function oce(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:r,contourHoleProcessingEnabled:n}=this.drawData,i=r[0],o=r[r.length-1],a=t.detail,{element:s}=a;this.doneEditMemo(),this.drawData.newAnnotation=!1,e&&!cP(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:n}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:n})}function ace(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:r}=this.drawData,{contourHoleProcessingEnabled:n,minPointsToSave:i}=e??{};if(i&&r.length<i||this.haltDrawing(t,r))return!1;const{annotation:o,viewportIdsToRender:a}=this.commonData,s=Ce(t),{viewport:c,renderingEngine:l}=s;c3(t,r,r[0],this.commonData),r.pop();const f=R2(this.configuration,o)?A2(this.configuration,r):r;this.updateContourPolyline(o,{points:f,closed:!0,targetWindingDirection:to.Clockwise},c);const{textBox:u}=o.data.handles;return u?.hasMoved||h2(o,n),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(a),this.deactivateDraw(t),!0}function sce(){const{canvasPoints:t}=this.drawData,e=t.length,r=[t[0],t[e-1]],n=t.slice(0,-1).slice(1),i=lP(n,r[0],r[1],!1);if(i){const o=i[1];o===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,o)}}function cce(t,e){const{canvasPoints:r}=this.drawData,{contourHoleProcessingEnabled:n}=e??{};if(this.haltDrawing(t,r))return!1;const{annotation:i,viewportIdsToRender:o}=this.commonData,a=Ce(t),{viewport:s,renderingEngine:c}=a,l=R2(this.configuration,i)?A2(this.configuration,r):r;this.updateContourPolyline(i,{points:l,closed:!1},s);const{textBox:f}=i.data.handles,u=i.data.contour.polyline;return i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=s3(r,s)),f.hasMoved||h2(i,n),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(o),this.deactivateDraw(t),!0}function lce(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{canvasPoints:a}=this.drawData,s=a.slice(0,-1),c=lP(s,i,o,!1);return c===void 0?void 0:c[0]}function uce(t,e){const r=t.detail,{element:n}=r,{canvasPoints:i,contourHoleProcessingEnabled:o}=this.drawData,{annotation:a,viewportIdsToRender:s}=this.commonData;c3(n,i,i[e],this.commonData),i.pop();const c=i.slice(e),l=Mg(c);if(Dt(l,0)){i.splice(e+1);return}i.splice(0,e);const f={contourHoleProcessingEnabled:o,minPointsToSave:3};this.completeDrawClosedContour(n,f)&&this.activateClosedContourEdit(t,a,s)}function fce(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:r,contourHoleProcessingEnabled:n}=this.drawData,i=r[0],o=r[r.length-1];e&&!cP(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:n}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:n})}function dce(t,e){const r=Math.max(e*3,3);return t.length<r}function hce(t,e){const{subPixelResolution:r}=this.configuration;if(dce(e,r)){const{annotation:n,viewportIdsToRender:i}=this.commonData,o=Ce(t),{renderingEngine:a}=o;return kt(n.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(i),this.deactivateDraw(t),!0}return!1}function gce(t){t.activateDraw=nce.bind(t),t.deactivateDraw=rce.bind(t),t.applyCreateOnCross=uce.bind(t),t.findCrossingIndexDuringCreate=lce.bind(t),t.completeDrawOpenContour=cce.bind(t),t.removeCrossedLinesOnCompleteDraw=sce.bind(t),t.mouseDragDrawCallback=ice.bind(t),t.mouseUpDrawCallback=oce.bind(t),t.completeDrawClosedContour=ace.bind(t),t.cancelDrawing=fce.bind(t),t.haltDrawing=hce.bind(t)}const{addCanvasPointsToArray:pce,getFirstLineSegmentIntersectionIndexes:rf}=Vl;function mce(t,e){const r=t.detail,{element:n,currentPoints:i,lastPoints:o}=r,a=i.canvas,s=o.canvas,{editCanvasPoints:c,prevCanvasPoints:l}=this.editData,f=rf(l,a,s,e);if(f)this.editData.startCrossingIndex=f[0],this.removePointsUpUntilFirstCrossing(e);else if(l.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const u=c[0],d=[];for(let p=0;p<l.length;p++){const m=l[p],w=Xn(m,u);d.push({distance:w,index:p})}d.sort((p,m)=>p.distance-m.distance);const h=[d[0],d[1]],g=Math.min(h[0].index,h[1].index);this.editData.startCrossingIndex=g}else{const u=xt();Mn(u,c[1],c[0]),cs(u,u);const d=6,h=[c[0][0]-u[0]*d,c[0][1]-u[1]*d],g=rf(l,h,c[0],e);if(g){const p=[h];pce(n,p,c[0],this.commonData),c.unshift(...p),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=g[0]}}}function vce(t){const{editCanvasPoints:e,prevCanvasPoints:r}=this.editData;let n=0;for(let i=0;i<e.length-1;i++){const o=[e[i],e[i+1]],a=!!rf(r,o[0],o[1],t);if(n++,a)break}e.splice(0,n),this.editData.editIndex=e.length-1}function yce(t,e){const r=t.detail,{currentPoints:n,lastPoints:i}=r,o=n.canvas,a=i.canvas,{prevCanvasPoints:s}=this.editData;return!!rf(s,o,a,e)}function wce(t){const{prevCanvasPoints:e,editCanvasPoints:r}=this.editData;for(let n=r.length-1;n>0;n--){const i=[r[n],r[n-1]],o=!!rf(e,i[0],i[1],t);if(r.pop(),o)break}}function Cce(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:r}=this.editData;if(r===void 0)return;const n=t[t.length-1],i=[];for(let a=0;a<e.length;a++){const s=e[a],c=Xn(s,n);i.push({distance:c,index:a})}i.sort((a,s)=>a.distance-s.distance);const o=t.slice(0,-1);for(let a=0;a<i.length;a++){const{index:s}=i[a],c=e[s],l=t[t.length-1];if(!rf(o,c,l,!1))return s}return-1}function xce(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{editCanvasPoints:a}=this.editData,s=a.slice(0,-2),c=rf(s,i,o,!1);if(!c)return;const l=c[0],f=a.length-l;for(let u=0;u<f;u++)a.pop()}function Tce(t){t.checkForFirstCrossing=mce.bind(t),t.removePointsUpUntilFirstCrossing=vce.bind(t),t.checkForSecondCrossing=yce.bind(t),t.findSnapIndex=Cce.bind(t),t.removePointsAfterSecondCrossing=wce.bind(t),t.checkAndRemoveCrossesOnEditLine=xce.bind(t)}const{getSubPixelSpacingAndXYDirections:Sce,addCanvasPointsToArray:uP,getArea:GE}=Vl;function _ce(t,e,r){this.isEditingClosed=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=Ce(o);if(!s)return;const{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:d}=Sce(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[a],startCrossingIndex:void 0,editIndex:0,annotation:e},this.commonData={annotation:e,viewportIdsToRender:r,spacing:f,xDir:u,yDir:d,movingTextBox:!1},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpClosedContourEditCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),o.addEventListener(V.TOUCH_END,this.mouseUpClosedContourEditCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpClosedContourEditCallback),St(o)}function Ece(t){Ue.isInteractingWithTool=!1,t.removeEventListener(V.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(V.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(V.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(V.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(V.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(V.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Vt(t)}function bce(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=Ce(n),{viewport:s}=a,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:d,editCanvasPoints:h,startCrossingIndex:g,annotation:p}=this.editData;this.createMemo(n,p);const m=h[h.length-1],w=s.canvasToWorld(m),v=Ie();qt(v,i,w);const y=Math.abs(ft(v,l)),C=Math.abs(ft(v,f));if(y<=u[0]&&C<=u[1])return;g!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const x=uP(n,h,o,this.commonData),T=d+x;if(this.editData.editIndex=T,g===void 0&&h.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),g!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),Me(c)}function Dce(t){const e=t.detail,{element:r}=e,n=Ce(r),{viewport:i,renderingEngine:o}=n,{annotation:a,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Ga(a,{points:c,closed:!0,targetWindingDirection:to.Clockwise},i),a.autoGenerated&&(a.autoGenerated=!1),Gt(a,r);const f=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[f],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0,annotation:a},Me(s)}function Ice(t){const{prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n,snapIndex:i}=this.editData;if(n===void 0||i===void 0)return;const o=t.detail,{element:a}=o,s=[...r];uP(a,s,e[i],this.commonData),s.length>r.length&&s.pop();let c,l;n>i?(c=i,l=n):(c=n,l=i);const f=Xn(e[c],s[0]),u=Xn(e[c],s[s.length-1]),d=Xn(e[l],s[0]),h=Xn(e[l],s[s.length-1]),g=[];for(let x=0;x<c;x++){const T=e[x];g.push([T[0],T[1]])}let p=f+h,m=u+d;if(p<m)for(let x=0;x<s.length;x++){const T=s[x];g.push([T[0],T[1]])}else for(let x=s.length-1;x>=0;x--){const T=s[x];g.push([T[0],T[1]])}for(let x=l;x<e.length;x++){const T=e[x];g.push([T[0],T[1]])}const w=[];for(let x=c;x<l;x++){const T=e[x];w.push([T[0],T[1]])}if(p=d+u,m=h+f,p<m)for(let x=0;x<s.length;x++){const T=s[x];w.push([T[0],T[1]])}else for(let x=s.length-1;x>=0;x--){const T=s[x];w.push([T[0],T[1]])}const v=GE(g),y=GE(w);return v>y?g:w}function Mce(t){const e=t.detail,{element:r}=e;this.completeClosedContourEdit(r)}function Oce(t){const e=Ce(t),{viewport:r}=e,{annotation:n,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:o,prevCanvasPoints:a}=this.editData;if(o){const s=R2(this.configuration,n)?A2(this.configuration,o,a):o,c=this.configuration?.decimate||{};Ga(n,{points:s,closed:!0,targetWindingDirection:to.Clockwise},r,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}}),n.autoGenerated&&(n.autoGenerated=!1),Gt(n,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,Me(i),this.deactivateClosedContourEdit(t)}function Pce(t){this.completeClosedContourEdit(t)}function Rce(t){t.activateClosedContourEdit=_ce.bind(t),t.deactivateClosedContourEdit=Ece.bind(t),t.mouseDragClosedContourEditCallback=bce.bind(t),t.mouseUpClosedContourEditCallback=Mce.bind(t),t.finishEditAndStartNewEdit=Dce.bind(t),t.fuseEditPointsWithClosedContour=Ice.bind(t),t.cancelClosedContourEdit=Pce.bind(t),t.completeClosedContourEdit=Oce.bind(t)}const{addCanvasPointsToArray:fP,getSubPixelSpacingAndXYDirections:Ace}=Vl;function Lce(t,e,r){this.isEditingOpen=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=Ce(o),{viewport:c}=s;this.doneEditMemo();const l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:d}=Ace(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[a],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:r,spacing:f,xDir:u,yDir:d,movingTextBox:!1},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpOpenContourEditCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),o.addEventListener(V.TOUCH_END,this.mouseUpOpenContourEditCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpOpenContourEditCallback),St(o)}function Nce(t){Ue.isInteractingWithTool=!1,t.removeEventListener(V.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(V.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(V.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(V.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(V.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(V.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Vt(t)}function Vce(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=Ce(n),{viewport:s}=a,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:d,editCanvasPoints:h,startCrossingIndex:g}=this.editData,p=h[h.length-1],m=s.canvasToWorld(p),w=Ie();this.createMemo(n,this.commonData.annotation),qt(w,i,m);const v=Math.abs(ft(w,l)),y=Math.abs(ft(w,f));if(v<=u[0]&&y<=u[1])return;g!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const C=fP(n,h,o,this.commonData),x=d+C;this.editData.editIndex=x,g===void 0&&h.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),g!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),Me(c)}function kce(t){const e=t.detail,{element:r}=e,n=Ce(r),{viewport:i}=n,{annotation:o,viewportIdsToRender:a}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Ga(o,{points:s,closed:!1},i);const c=o.data.contour.polyline;o.data.handles.points=[c[0],c[c.length-1]],o.data.handles.activeHandleIndex=1,Gt(o,r),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.doneEditMemo(),this.deactivateOpenContourEdit(r),this.activateOpenContourEndEdit(t,o,a,null)}function Fce(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{snapIndex:a,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||a===void 0)return!1;if(a===-1)return!0;if(a!==0&&a!==s.length-1)return!1;const l=i,f=o,u=s[a],d=xt(),h=xt();Qo(d,l[0]-f[0],l[1]-f[1]),Qo(h,l[0]-u[0],l[1]-u[1]);const g=oc(d,h),p=Math.sqrt(d[0]*d[0]+d[1]*d[1]),m=Math.sqrt(h[0]*h[0]+h[1]*h[1]);return Math.acos(g/(p*m))<Math.PI/2}function Uce(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=n;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<n;s++){const c=e[s];i.push([c[0],c[1]])}const o=Xn(e[n],r[0]),a=Xn(e[n],r[r.length-1]);if(o<a)for(let s=0;s<r.length;s++){const c=r[s];i.push([c[0],c[1]])}else for(let s=r.length-1;s>=0;s--){const c=r[s];i.push([c[0],c[1]])}return i}function Bce(t){const{prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n,snapIndex:i}=this.editData;if(n===void 0||i===void 0)return;const o=t.detail,{element:a}=o,s=[...r];fP(a,s,e[i],this.commonData),s.length>r.length&&s.pop();let c,l;n>i?(c=i,l=n):(c=n,l=i);const f=Xn(e[c],s[0]),u=Xn(e[c],s[s.length-1]),d=Xn(e[l],s[0]),h=Xn(e[l],s[s.length-1]),g=[];for(let w=0;w<c;w++){const v=e[w];g.push([v[0],v[1]])}const p=f+h,m=u+d;if(p<m)for(let w=0;w<s.length;w++){const v=s[w];g.push([v[0],v[1]])}else for(let w=s.length-1;w>=0;w--){const v=s[w];g.push([v[0],v[1]])}for(let w=l;w<e.length;w++){const v=e[w];g.push([v[0],v[1]])}return g}function Gce(t){const e=t.detail,{element:r}=e,n=Ce(r),{viewport:i,renderingEngine:o}=n,{annotation:a,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Ga(a,{points:c,closed:!1},i);const f=a.data.contour.polyline;a.data.handles.points=[f[0],f[f.length-1]],Gt(a,r);const u=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},Me(s)}function Wce(t){const e=t.detail,{element:r}=e;this.completeOpenContourEdit(r)}function $ce(t){const e=Ce(t),{viewport:r}=e,{annotation:n,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:o,prevCanvasPoints:a}=this.editData;if(o){const s=R2(this.configuration)?A2(this.configuration,o,a):o,c=this.configuration?.decimate||{};Ga(n,{points:s,closed:!1},r,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}});const l=n.data.contour.polyline;n.data.handles.points=[l[0],l[l.length-1]],n.data.isOpenUShapeContour&&(n.data.openUShapeContourVectorToPeak=s3(o,r)),Gt(n,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,Me(i),this.deactivateOpenContourEdit(t)}function zce(t){this.completeOpenContourEdit(t)}function jce(t){t.activateOpenContourEdit=Lce.bind(t),t.deactivateOpenContourEdit=Nce.bind(t),t.mouseDragOpenContourEditCallback=Vce.bind(t),t.mouseUpOpenContourEditCallback=Wce.bind(t),t.fuseEditPointsWithOpenContour=Bce.bind(t),t.finishEditOpenOnSecondCrossing=Gce.bind(t),t.checkIfShouldOverwriteAnEnd=Fce.bind(t),t.fuseEditPointsForOpenContourEndEdit=Uce.bind(t),t.openContourEditOverwriteEnd=kce.bind(t),t.cancelOpenContourEdit=zce.bind(t),t.completeOpenContourEdit=$ce.bind(t)}const{getSubPixelSpacingAndXYDirections:Hce}=Vl;function Kce(t,e,r,n){this.isDrawing=!0;const i=t.detail,{element:o}=i,a=Ce(o),{viewport:s}=a,{spacing:c,xDir:l,yDir:f}=Hce(s,this.configuration.subPixelResolution),u=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&u.reverse();let h=!1;n?.worldPosition&&(h=!0),this.drawData={canvasPoints:u,polylineIndex:u.length-1},this.commonData={annotation:e,viewportIdsToRender:r,spacing:c,xDir:l,yDir:f,movingTextBox:h},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpDrawCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_END,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpDrawCallback),St(o)}function Xce(t){t.activateOpenContourEndEdit=Kce.bind(t)}function dP(t){return(t.childAnnotationUIDs??[]).map(r=>vn(r).data.contour.polyline)}function Lg(t,e){const r=dP(t),n=[];return r.forEach(i=>{const o=i.length,a=new Array(o);for(let s=0;s<o;s++)a[s]=e.worldToCanvas(i[s]);n.push(a)}),n}const{pointsAreWithinCloseContourProximity:qce}=Vl;function Yce(t,e){const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:n,lineDash:i,color:o,fillColor:a,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:r}),{closed:c}=e.data.contour;return{color:o,width:n,lineDash:i,fillColor:a,fillOpacity:s,closePath:c}}function Jce(t,e,r){t?.viewport?.getImageData()&&(r.data.contour.closed?this.renderClosedContour(t,e,r):r.data.isOpenUShapeContour?(Zce(t,r),this.renderOpenUShapedContour(t,e,r)):this.renderOpenContour(t,e,r))}function Zce(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=ece(t,e))}function Qce(t,e,r){if(r.parentAnnotationUID)return;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(l=>n.worldToCanvas(l)),a=Lg(r,n),s=[o,...a];yc(e,r.annotationUID,"1",s,i)}function ele(t,e,r){const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(c=>n.worldToCanvas(c));aa(e,r.annotationUID,"1",o,i);const s=r.data.handles.activeHandleIndex;if(this.configuration.alwaysRenderOpenContourHandles?.enabled===!0){const c=this.configuration.alwaysRenderOpenContourHandles.radius,l="0",f=[o[0],o[o.length-1]];s===0?f.shift():s===1&&f.pop(),Wn(e,r.annotationUID,l,f,{color:i.color,handleRadius:c})}if(s!==null){const l=s===0?0:o.length-1,f=o[l];Wn(e,r.annotationUID,"1",[f],{color:i.color})}}function tle(t,e,r){const{viewport:n}=t,{openUShapeContourVectorToPeak:i}=r.data,{polyline:o}=r.data.contour;if(this.renderOpenContour(t,e,r),!i)return;const a=n.worldToCanvas(o[0]),s=n.worldToCanvas(o[o.length-1]),c=[n.worldToCanvas(i[0]),n.worldToCanvas(i[1])],l=this._getRenderingOptions(t,r);aa(e,r.annotationUID,"first-to-last",[a,s],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"}),aa(e,r.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"})}function nle(t,e,r){const n=this._getRenderingOptions(t,r),{allowOpenContours:i}=this.configuration,{canvasPoints:o}=this.drawData;if(n.closePath=!1,aa(e,r.annotationUID,"1",o,n),i){const a=o[0],s=o[o.length-1];qce(a,s,this.configuration.closeContourProximity)?aa(e,r.annotationUID,"2",[s,a],n):Wn(e,r.annotationUID,"0",[a],{color:n.color,handleRadius:2})}}function rle(t,e,r){const{viewport:n}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,r);return}const o=Lg(r,n),a=[i,...o],s=this._getRenderingOptions(t,r),c="preview-1";r.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),yc(e,r.annotationUID,c,a,s)}function ile(t,e,r){const{fusedCanvasPoints:n}=this.editData;if(n===void 0){this.renderOpenContour(t,e,r);return}const i=this._getRenderingOptions(t,r);aa(e,r.annotationUID,"preview-1",n,i)}function ole(t,e,r){if(r.parentAnnotationUID)return;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(g=>n.worldToCanvas(g)),a=Lg(r,n),s="1",c=o[0],l=6,f=100,u=[];for(let g=0;g<f;g++){const p=g/f*2*Math.PI,m=c[0]+l*Math.cos(p),w=c[1]+l*Math.sin(p);u.push([m,w])}const d=[[c[0]-l*2,c[1]],[c[0]+l*2,c[1]],[c[0],c[1]-l*2],[c[0],c[1]+l*2]];yc(e,r.annotationUID,s+"-crosshair_v",[d[0],d[1]],i),yc(e,r.annotationUID,s+"-crosshair_h",[d[2],d[3]],i);const h=[u,...a];yc(e,r.annotationUID,s,h,i)}function ale(t){t.renderContour=Jce.bind(t),t.renderClosedContour=Qce.bind(t),t.renderOpenContour=ele.bind(t),t.renderPointContourWithMarker=ole.bind(t),t.renderOpenUShapedContour=tle.bind(t),t.renderContourBeingDrawn=nle.bind(t),t.renderClosedContourBeingEdited=rle.bind(t),t.renderOpenContourBeingEdited=ile.bind(t),t._getRenderingOptions=Yce.bind(t)}function po(t){const e=sle(t),r=(e.top[1]+e.bottom[1])/2;return[e.right[0],r]}function sle(t){const e=[t[0],t[1]].sort(a),r=[t[0],t[1]].sort(s),n=e[e.length-1],i=r[0],o=r[r.length-1];return{top:i,bottom:o,right:n};function a(c,l){return c[0]<l[0]?-1:1}function s(c,l){return c[1]<l[1]?-1:1}}const cle=Object.freeze(Object.defineProperty({__proto__:null,getTextBoxCoordsCanvas:po},Symbol.toStringTag,{value:"Module"}));function Pc(t,e){if(t instanceof ir){const r=Ms(e),n=Ae.getVolume(r);return!!n?.scaling&&Object.keys(n.scaling).length>0}else if(t instanceof qn){const{preScale:r}=t.getImageData()||{};return!!r?.scaled}else return!1}const{DefaultHistoryMemo:Df}=ox,ih=class ih{constructor(e,r){this.isPrimary=!1;const n=ih.mergeDefaultProps(ih.defaults,r),i=jr(n,e),{configuration:o={},supportedInteractionTypes:a,toolGroupId:s}=i;this.toolGroupId=s,this.supportedInteractionTypes=a||[],this.configuration=Object.assign({},o),this.mode=_n.Disabled}static mergeDefaultProps(e={},r){return r?jr(e,r):e}get toolName(){return this.getToolName()}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,r){const{strategies:n,activeStrategy:i}=this.configuration;return n[i]?.call(this,e,r)}applyActiveStrategyCallback(e,r,n,...i){const{strategies:o,activeStrategy:a}=this.configuration;if(!o[a])throw new Error(`applyActiveStrategyCallback: active strategy ${a} not found, check tool configuration or spellings`);return o[a][n]?.call(this,e,r,...i)}setConfiguration(e){this.configuration=jr(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const r=e.split("imageId:")[1],n=cr(r);let i=$m(n);return!i||!i.length||(i=i.filter(o=>o.getCurrentImageId()===r),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const r=Ms(e),n=gg(r);return!n||!n.length?void 0:n[0].getImageData()}else if(e.startsWith("videoId:")){const r=cr(e),n=$m(r);return!n||!n.length?void 0:n[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const r=e.getViewReferenceId?.();if(r)return r;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}undo(){this.doneEditMemo(),Df.undo()}redo(){Df.redo()}static createZoomPanMemo(e){const r={pan:e.getPan(),zoom:e.getZoom()},n={restoreMemo:()=>{const i=e.getPan(),o=e.getZoom();e.setZoom(r.zoom),e.setPan(r.pan),e.render(),r.pan=i,r.zoom=o}};return Df.push(n),n}doneEditMemo(){this.memo?.commitMemo?.()&&Df.push(this.memo),this.memo=null}static startGroupRecording(){Df.startGroupRecording()}static endGroupRecording(){Df.endGroupRecording()}static calculateLengthInIndex(e,r,n=!1){const i=e?.scale||1,o=e?.scaleY||i,a=e?.scaleZ||i;let s=0;const c=r.length,l=n?0:1;let f=n?r[c-1]:r[0];for(let u=l;u<c;u++){const d=r[u],h=(d[0]-f[0])/i,g=(d[1]-f[1])/o,p=(d[2]-f[2])/a;s+=Math.sqrt(h*h+g*g+p*p),f=d}return s}static isInsideVolume(e,r){const{length:n}=r;for(let i=0;i<n;i++)if(!Or(r[i],e))return!1;return!0}};ih.defaults={configuration:{strategies:{},defaultStrategy:void 0,activeStrategy:void 0,strategyOptions:{}}};let vr=ih;vr.toolName="BaseTool";function hP(t){if(t){if(t.data&&t.highlighted)return _a.Highlighted;if(Dg(t.annotationUID))return _a.Selected;if(pr(t.annotationUID))return _a.Locked;if(t.data&&t.autoGenerated)return _a.AutoGenerated}return _a.Default}function lle(t,e,r){const n=Gi("textBoxFontSize",t,e,r),i=Gi("textBoxFontFamily",t,e,r);return`${n}px ${i}`}const ule=Object.freeze(Object.defineProperty({__proto__:null,getFont:lle,getState:hP,style:vx},Symbol.toStringTag,{value:"Module"}));class As extends vr{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:r,imageId:n}=e.detail,i=cr(n),o=Ba();o.getFramesOfReference().forEach(s=>{const l=o.getAnnotations(s)[this.getToolName()];!l||!l.length||(l.forEach(f=>{if(!f.metadata?.referencedImageId)return;cr(f.metadata.referencedImageId)===i&&(f.invalidated=!0,f.data.cachedStats={})}),$0(r))})}}filterInteractableAnnotationsForElement(e,r){if(!r?.length)return[];const n=Ce(e),{viewport:i}=n;return Rg(i,r)}static createAnnotation(...e){let r={annotationUID:null,highlighted:!0,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:this.toolName},data:{handles:{points:new Array,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{},label:""}};for(const n of e)r=jr(r,n);return r}createAnnotation(e,r,...n){const i=e.detail,{currentPoints:o,element:a}=i,{world:s}=o,c=Ce(a),{viewport:l}=c,f=l.getCamera(),{viewPlaneNormal:u,viewUp:d,position:h}=f,g=this.getReferencedImageId(l,s,u,d),p=l.getViewReference({points:[s]});return As.createAnnotation({metadata:{toolName:this.getToolName(),...p,referencedImageId:g,viewUp:d,cameraPosition:h},data:{handles:{points:r||[]}}},...n)}getReferencedImageId(e,r,n,i){const o=this.getTargetId(e);let a=o.split(/^[a-zA-Z]+:/)[1];if(e instanceof ir){const s=Ms(o),c=Ae.getVolume(s);a=_c(c,r,n)}return a}getStyle(e,r,n){return Gi(e,r,hP(n),this.mode)}}As.toolName="AnnotationDisplayTool";const{DefaultHistoryMemo:ly}=ox,{PointsManager:fle}=gn;class $n extends As{static createAnnotationForViewport(e,...r){return this.createAnnotation({metadata:e.getViewReference()},...r)}static createAndAddAnnotation(e,...r){const n=this.createAnnotationForViewport(e,...r);Ft(n,e.element),Gt(n,e.element)}constructor(e,r){super(e,r),this.mouseMoveCallback=(n,i)=>{if(!i)return!1;const{element:o,currentPoints:a}=n.detail,s=a.canvas;let c=!1;for(const l of i){if(pr(l.annotationUID)||!mr(l.annotationUID))continue;const{data:f}=l,u=f.handles?f.handles.activeHandleIndex:void 0,d=this._imagePointNearToolOrHandle(o,l,s,6),h=d&&!l.highlighted,g=!d&&l.highlighted;h||g?(l.highlighted=!l.highlighted,c=!0):f.handles&&f.handles.activeHandleIndex!==u&&(c=!0)}return c},this.isSuvScaled=$n.isSuvScaled,e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,r,n,i){const o=Ce(e),{viewport:a}=o,{data:s}=r,{isCanvasAnnotation:c}=s,{points:l,textBox:f}=s.handles;if(f){const{worldBoundingBox:u}=f;if(u){const d={topLeft:a.worldToCanvas(u.topLeft),topRight:a.worldToCanvas(u.topRight),bottomLeft:a.worldToCanvas(u.bottomLeft),bottomRight:a.worldToCanvas(u.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottomRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottomRight[1])return s.handles.activeHandleIndex=null,f}}for(let u=0;u<l?.length;u++){const d=l[u],h=c?d.slice(0,2):a.worldToCanvas(d);if(Xn(n,h)<i===!0)return s.handles.activeHandleIndex=u,d}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,r){return{visibility:this.getStyle("textBoxVisibility",e,r),fontFamily:this.getStyle("textBoxFontFamily",e,r),fontSize:this.getStyle("textBoxFontSize",e,r),color:this.getStyle("textBoxColor",e,r),shadow:this.getStyle("textBoxShadow",e,r),background:this.getStyle("textBoxBackground",e,r),lineWidth:this.getStyle("textBoxLinkLineWidth",e,r),lineDash:this.getStyle("textBoxLinkLineDash",e,r),textBoxBorderRadius:this.getStyle("textBoxBorderRadius",e,r),textBoxMargin:this.getStyle("textBoxMargin",e,r),textBoxLinkLineColor:this.getStyle("textBoxLinkLineColor",e,r)}}static isSuvScaled(e,r,n){if(e instanceof ir){const o=Ms(r);return Ae.getVolume(o)?.scaling?.PT!==void 0}return typeof(n&&ut("scalingModule",n))?.suvbw=="number"}getAnnotationStyle(e){const{annotation:r,styleSpecifier:n}=e,i=p=>this.getStyle(p,n,r),{annotationUID:o}=r,a=mr(o),s=pr(o),c=i("lineWidth"),l=i("lineDash"),f=i("angleArcLineDash"),u=i("color"),d=i("markerSize"),h=i("shadow"),g=this.getLinkedTextBoxStyle(n,r);return{visibility:a,locked:s,color:u,lineWidth:c,lineDash:l,lineOpacity:1,fillColor:u,fillOpacity:0,shadow:h,textbox:g,markerSize:d,angleArcLineDash:f}}_imagePointNearToolOrHandle(e,r,n,i){if(this.getHandleNearImagePoint(e,r,n,i)||this.isPointNearTool(e,r,n,i,"mouse"))return!0}static createAnnotationState(e,r){const{data:n,annotationUID:i}=e,o={...n,cachedStats:{}};delete o.contour,delete o.spline;const a={annotationUID:i,data:structuredClone(o),deleting:r},s=n.contour;return s&&(a.data.contour={...s,polyline:null,pointsManager:fle.create3(s.polyline.length,s.polyline)}),a}static createAnnotationMemo(e,r,n){if(!r)return;const{newAnnotation:i,deleting:o=i?!1:void 0}=n||{},{annotationUID:a}=r,s=$n.createAnnotationState(r,o),c={restoreMemo:()=>{const l=$n.createAnnotationState(r,o),{viewport:f}=Ce(e)||{};if(f?.setViewReference(r.metadata),s.deleting===!0){if(s.deleting=!1,Object.assign(r.data,s.data),r.data.contour){const d=r.data;d.contour.polyline=s.data.contour.pointsManager.points,delete s.data.contour.pointsManager,d.segmentation&&Ec(r)}s.data=l.data,Ft(r,e),ia(r.annotationUID,!0),f?.render();return}if(s.deleting===!1){s.deleting=!0,s.data=l.data,ia(r.annotationUID),kt(r.annotationUID),f?.render();return}const u=vn(a);if(!u){console.warn("No current annotation");return}Object.assign(u.data,s.data),u.data.contour&&(u.data.contour.polyline=s.data.contour.pointsManager.points),s.data=l.data,u.invalidated=!0,Gt(u,e,Nt.History)},id:a,operationType:"annotation"};return ly.push(c),c}createMemo(e,r,n){this.memo||=$n.createAnnotationMemo(e,r,n)}startGroupRecording(){ly.startGroupRecording()}endGroupRecording(){ly.endGroupRecording()}static hydrateBase(e,r,n,i={}){if(!r)return null;const{viewport:o}=r,a=o.getFrameOfReferenceUID(),s=o.getCamera(),c=i.viewplaneNormal??s.viewPlaneNormal,l=i.viewUp??s.viewUp,f=i.toolInstance||new e;let u,d=c,h=l;if(i.referencedImageId)u=i.referencedImageId,d=void 0,h=void 0;else if(o instanceof qn){const g=ax(n[0],o);g!==void 0&&(u=o.getImageIds()[g])}else if(o instanceof ir)u=f.getReferencedImageId(o,n[0],c,l);else throw new Error("Unsupported viewport type");return{FrameOfReferenceUID:a,referencedImageId:u,viewPlaneNormal:d,viewUp:h,instance:f,viewport:o}}}$n.toolName="AnnotationTool";class dle extends $n{constructor(e,r){super(e,r)}static getContourSequence(e,r){const{data:n}=e,i=[];for(const s of n.contour.polyline)for(const c of s)i.push(c.toFixed(2));const{referencedImageId:o}=e.metadata,a=r.get("ImageSopInstanceReference",o);return{NumberOfContourPoints:i.length/3,ContourImageSequence:a,ContourGeometricType:"CLOSED_PLANAR",ContourData:i}}renderAnnotation(e,r){let n=!1;const{viewport:i}=e,{element:o}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let a=$t(this.getToolName(),o);if(!a?.length||(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length))return n;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let l=0;l<a.length;l++){const f=a[l];c.annotationUID=f.annotationUID;const u=this.getAnnotationStyle({annotation:f,styleSpecifier:c});if(!u.visibility)continue;const d=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:f,annotationStyle:u,svgDrawingHelper:r});n||=d,f.invalidated=!1}return n}createAnnotation(e){const r=super.createAnnotation(e);return Object.assign(r.data,{contour:{polyline:[],closed:!1}}),Object.assign(r,{interpolationUID:"",autoGenerated:!1}),r}addAnnotation(e,r){return Ft(e,r)}cancelAnnotation(e){}moveAnnotation(e,r){const{points:n}=e.data.handles;for(let i=0,o=n.length;i<o;i++){const a=n[i];a[0]+=r[0],a[1]+=r[1],a[2]+=r[2]}e.invalidated=!0,_g(e).forEach(i=>this.moveAnnotation(i,r))}updateContourPolyline(e,r,n,i){const o=this.configuration?.decimate||{};Ga(e,r,n,{decimate:{enabled:!!o.enabled,epsilon:o.epsilon},updateWindingDirection:i?.updateWindingDirection})}getPolylinePoints(e){return e.data.contour?.polyline??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:r,annotationStyle:n,svgDrawingHelper:i}=e,o=e.annotation;if(o.parentAnnotationUID)return;const{annotationUID:a}=o,{viewport:s}=r,{worldToCanvas:c}=s,l=this.getPolylinePoints(o).map(w=>c(w)),{lineWidth:f,lineDash:u,color:d,fillColor:h,fillOpacity:g}=n,p=Lg(o,s),m=[l,...p];return yc(i,a,"contourPolyline",m,{color:d,lineDash:u,lineWidth:Math.max(.1,f),fillColor:h,fillOpacity:g}),!0}}class hle{constructor(){this.annotationUIDs=new Set,this._isVisible=!0,this.visibleFilter=this.unboundVisibleFilter.bind(this)}unboundVisibleFilter(e){return!this._isVisible||!this.annotationUIDs.has(e)}has(e){return this.annotationUIDs.has(e)}setVisible(e=!0,r,n){this._isVisible!==e&&(this._isVisible=e,this.annotationUIDs.forEach(i=>{const o=vn(i);if(!o){this.annotationUIDs.delete(i);return}if(o.isVisible===e||!e&&n?.(i)===!1)return;o.isVisible=e;const a={...r,annotation:o};Xe(ke,V.ANNOTATION_MODIFIED,a)}))}get isVisible(){return this._isVisible}findNearby(e,r){const n=[...this.annotationUIDs];if(n.length===0)return null;if(!e)return n[r===1?0:n.length-1];const i=n.indexOf(e);return i===-1||i+r<0||i+r>=n.length?null:n[i+r]}add(...e){e.forEach(r=>this.annotationUIDs.add(r))}remove(...e){e.forEach(r=>this.annotationUIDs.delete(r))}clear(){this.annotationUIDs.clear()}}const Ra={...hie,...lie,resetAnnotationManager:Goe},gle=Object.freeze(Object.defineProperty({__proto__:null,AnnotationGroup:hle,FrameOfReferenceSpecificAnnotationManager:gO,config:ule,locking:Ooe,selection:Loe,state:Ra,visibility:Uoe},Symbol.toStringTag,{value:"Module"})),WE="PlanarFreehandContourSegmentationTool";function l3(t,e=[]){const{viewport:r,sliceData:n,annotation:i}=t,o=new Map,{toolName:a,originalToolName:s}=i.metadata,c=s||a,l=($t(c,r.element)||[]).filter(f=>!f.metadata.originalToolName||f.metadata.originalToolName===c);if(c!==WE){const f=$t(WE,r.element);f?.length&&f.forEach(u=>{const{metadata:d}=u;d.originalToolName===c&&d.originalToolName!==d.toolName&&l.push(u)})}if(!l?.length)return o;for(let f=0;f<n.numberOfSlices;f++){const u=l.filter(h=>h.metadata.sliceIndex===f);if(!u?.length)continue;const d=u.filter(h=>e.every(g=>{const m=(g.parentKey?g.parentKey(h):h)?.[g.key];return Array.isArray(m)?m.every((w,v)=>w===g.value[v]):m===g.value}));d.length&&o.set(f,d)}return o}function ple(t,e){const r=l3(t,e),n=[];if(!r?.size)return n;for(const i of r.values())i.forEach(o=>{n.push(o)});return n}function gP(t,e,r){const n=jr({data:{},metadata:{}},r);return Object.assign(n,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(n.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...r.data.contour,polyline:t}}),n}function mle(t,e){const r=l3(e,[{key:"interpolationUID",value:e.interpolationUID}]),n=vle(r);if(!n){console.warn("No annotations found to interpolate",r);return}const i=yle(r,t.annotationUID),o=[];for(let a=n[0]+1;a<n[1];a++)if(wle(r,a)){const s=xle(a,n,r);(s?.[0]===i||s?.[1]===i)&&Cle(s,o,a)}return{interpolationData:r,interpolationList:o}}function vle(t){let e=1/0,r=-1/0,n=!1;for(const[i,o]of t.entries())o.length&&(e=Math.min(i,e),r=Math.max(i,r),n=!0);if(n)return[e,r]}function yle(t,e){for(const[r,n]of t)for(let i=0;i<n.length;i++)if(n[i].annotationUID===e)return r}function wle(t,e){const r=t.get(e);return!r?.length||r.length===1&&r[0].autoGenerated}function Cle(t,e,r){const[n]=t;e[n]||={pair:t,list:[]},e[n].list.push(r)}function xle(t,e,r){const n=[];let i=!0;for(let o=t-1;o>=e[0];o--){const a=r.get(o);if(a?.length){if(a[0].autoGenerated)continue;a.length>1&&(i=!1),n.push(o);break}}if(!(!i||!n.length)){for(let o=t+1;o<=e[1];o++){const a=r.get(o);if(a?.length){if(a[0].autoGenerated)continue;a.length>1&&(i=!1),n.push(o);break}}if(!(!i||n.length<2))return n}}const{PointsManager:$E}=gn;function Tle(t,e=12){const r=$E.create3(e);r.sources=[];const{sources:n}=r,{length:i,sources:o=[]}=t,a=5;if(i<a*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,a*2));o.forEach(()=>n.push($E.create3(e)));const c=Sle(t,a),l=_le(c,e),f=[];if(l?.length>2){let u=-1;const d=s/3;l.forEach(p=>{const[m,,w]=p,v=Math.ceil((m+w)/2);w-u<d||(v-m>2*d?(If(f,u,m,s,i),u=If(f,m,v,s,i)):u=If(f,u,v,s,i),w-u>d&&(u=If(f,u,w,s,i)))});const h=f[0];W5(h+i-u,i)>2*d&&If(f,u,h-d,s,i)}else{const u=Math.floor(i/e);If(f,-1,i-u,u,i)}return f.forEach(u=>{const d=t.getPointArray(u);r.push(d),o.forEach((h,g)=>n[g].push(h.getPoint(u)))}),r}function Sle(t,e=6){const{length:r}=t,n=Ie(),i=Ie(),o=new Float32Array(r);for(let a=0;a<r;a++){const s=t.getPoint(a),c=t.getPoint(a-e),l=t.getPoint((a+e)%r);an(n,s,c),an(i,l,s);const f=ft(n,i)/(p0(n)*p0(i));o[a]=f}return o}function _le(t,e){const{max:r,deviation:n}=Ele(t),{length:i}=t;if(n<.01||i<e*3)return[];const o=[];let a=null,s,c=0;for(let l=0;l<i;l++){const f=t[l];f<r-n?a?(a[2]=l,f<s&&(s=f,c=l),a[1]=c):(s=f,c=l,a=[l,l,l]):a&&(o.push(a),a=null)}return a&&(o[0][0]===0?o[0][0]=a[0]:(a[1]=c,a[2]=i-1,o.push(a))),o}function If(t,e,r,n,i){r<e&&(r+=i);const o=r-e,a=Math.ceil(o/n);if(a<=0)return t[t.length-1]!==r&&t.push(W5(r,i)),r;for(let s=1;s<=a;s++){const c=W5(e+s*o/a,i);t.push(c)}return t[t.length-1]}function W5(t,e){return(Math.round(t)+e)%e}function Ele(t){const{length:e}=t;let r=0,n=1/0,i=-1/0,o=0;for(let s=0;s<e;s++){const c=t[s];r+=c,n=Math.min(n,c),i=Math.max(i,c)}const a=r/e;for(let s=0;s<e;s++){const c=t[s]-a;o+=c*c}return{mean:a,max:i,min:n,sumSq:o,deviation:Math.sqrt(o/e)}}function ble(t){const{parentAnnotationUID:e,annotationUID:r}=t;if(!e)return t.interpolationUID;const n=Ra.getAnnotation(e),{interpolationUID:i}=n,o=n.childAnnotationUIDs.indexOf(r);return t.interpolationUID=`${i}-${o}`,t.interpolationUID}const{PointsManager:vd}=gn,zE=.2;function um(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:r}=t;queueMicrotask(()=>{try{e&&(r.isInterpolationUpdate=!0,r.autoGenerated=!1),Dle(t)}finally{e&&(r.autoGenerated=!0)}})}function Dle(t){const{annotation:e}=t;ble(e);const{interpolationData:r,interpolationList:n}=mle(e,t)||{};if(!r||!n)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let l=0;l<n.length;l++)n[l]&&Ile(n[l].list,n[l].pair,r,i);const{id:o,renderingEngineId:a,element:s}=t.viewport,c={annotation:e,element:s,viewportId:o,renderingEngineId:a};n.length&&(Xe(t.viewport.element,V.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c),Xe(ke,V.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c))}function Ile(t,e,r,n){const i=r.get(e[0])[0],o=r.get(e[1])[0],a=JE(i.data.contour.polyline),s=JE(o.data.contour.polyline),{c1Interp:c,c2Interp:l}=Ale(a,s);c.kIndex=e[0],l.kIndex=e[1],t.forEach(function(f){Mle(c,l,f,e,r,a.x.length>s.x.length,n)})}function Mle(t,e,r,n,i,o,a){const[s,c]=n,l=(r-s)/(c-s),f=i.get(s)[0],u=i.get(c)[0],d=Rle(t,e,l,o),h=l>.5?u:f,g=Tle(d);i.has(r)?Ple(d,g,r,h,a):Ole(d,g,r,h,a)}function Ole(t,e,r,n,i){const o=t.points,{viewport:a}=i,s=gP(o,e,n),c=a.getViewReference({sliceIndex:r});if(!c)throw new Error(`Can't find slice ${r}`);Object.assign(s.metadata,c),Ra.addAnnotation(s,a.element),n.onInterpolationComplete?.(s,n);const{parentAnnotationUID:l}=n;if(l){const f=Ra.getAnnotation(l),u=pP(f,r,i);D2(a,u,s)}}function pP(t,e,r){const{viewport:n}=r,i=Ra.getAnnotations(t.metadata.toolName,n.element);for(let o=0;o<i.length;o++){const a=i[o];if(a.interpolationUID===t.interpolationUID&&a.metadata.sliceIndex===e)return a}}function Ple(t,e,r,n,i){const o=pP(n,r,i),a=t.points,s=gP(a,e,o);Object.assign(o,{metadata:s.metadata,data:s.data})}function Rle(t,e,r,n){const i=n?t.I:e.I,o=vd.fromXYZ(t),a=vd.fromXYZ(e),{length:s}=o,c=vd.create3(s),l=Ie(),f=Ie(),u=vd.create3(s);u.kIndex=t.kIndex;const d=vd.create3(s);d.kIndex=e.kIndex;for(let h=0;h<t.x.length;h++)if(i[h]){const g=o.getPoint(h),p=a.getPoint(h);u.push(g),d.push(p),an(l,p,g),c.push(tn(f,g,l,r))}return c.sources=[u,d],c}function Ale(t,e){const r=YE(t),n=YE(e),i=Math.max(Math.ceil(r[r.length-1]/zE),Math.ceil(n[n.length-1]/zE)),o=qE(r),a=qE(n),s=i+e.x.length,c=i+t.x.length,l=XE(s,o),f=XE(c,a),u=KE(s-2,t.x.length),d=KE(c-2,e.x.length),h=HE(l,u),g=HE(f,d),p=jE(t,h),m=jE(e,g);return Nle(p,m),Lle(p,m)}function Lle(t,e){const r={x:[],y:[],z:[],I:[]},n={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(r.x.push(t.x[i]),r.y.push(t.y[i]),r.z.push(t.z[i]),r.I.push(t.I[i]),n.x.push(e.x[i]),n.y.push(e.y[i]),n.z.push(e.z[i]),n.I.push(e.I[i]));return{c1Interp:r,c2Interp:n}}function Nle(t,e){const r=t.x.length,n={startingNode:0,totalSquaredXYLengths:1/0};for(let o=0;o<r;o++){let a=o,s=0;for(let c=0;c<r;c++)s+=(t.x[a]-e.x[c])**2+(t.y[a]-e.y[c])**2+(t.z[a]-e.z[c])**2,a++,a===r&&(a=0);s<n.totalSquaredXYLengths&&(n.totalSquaredXYLengths=s,n.startingNode=o)}const i=n.startingNode;Ep(t.x,i),Ep(t.y,i),Ep(t.z,i),Ep(t.I,i)}function Ep(t,e){e-=t.length*Math.floor(e/t.length);const r=t.splice(0,e);return t.push(...r),t}function jE(t,e){const r={x:[],y:[],z:[],I:[]};for(let n=0;n<t.x.length-1;n++){r.x.push(t.x[n]),r.y.push(t.y[n]),r.z.push(t.z[n]),r.I.push(!0);const i=(t.x[n+1]-t.x[n])/(e[n]+1),o=(t.y[n+1]-t.y[n])/(e[n]+1),a=(t.z[n+1]-t.z[n])/(e[n]+1);for(let s=0;s<e[n]-1;s++)r.x.push(r.x[r.x.length-1]+i),r.y.push(r.y[r.y.length-1]+o),r.z.push(r.z[r.z.length-1]+a),r.I.push(!1)}return r}function HE(t,e){const r=[];for(let a=0;a<t.length;++a)r[a]=a;r.sort(function(a,s){return t[a]<t[s]?-1:1});const n=[];for(let a=0;a<e.length;a++)n.push(e[r[a]]);const i=n.reduce(function(a,s,c){return s&&a.push(c),a},[]),o=[];for(let a=0;a<i.length-1;a++)o.push(i[a+1]-i[a]);return o}function KE(t,e){const r=new Array(t+e);return r.fill(!1,0,t),r.fill(!0,t,t+e),r}function XE(t,e){const r=1/(t-1),n=[r];for(let i=1;i<t-2;i++)n.push(n[n.length-1]+r);return n.concat(e)}function qE(t){const e=[];for(let r=0;r<t.length;r++)e.push(t[r]/t[t.length-1]);return e}function YE(t){const e=[0];for(let r=1;r<t.x.length;r++){const n=Math.sqrt((t.x[r]-t.x[r-1])**2+(t.y[r]-t.y[r-1])**2+(t.z[r]-t.z[r-1])**2);e.push(e[r-1]+n)}return e}function JE(t){const e={x:[],y:[],z:[]};for(let r=0;r<t.length;r++)e.x[r]=t[r][0],e.y[r]=t[r][1],e.z[r]=t[r][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function ZE(t){const{annotation:e}=t,r=l3(t,[{key:"interpolationUID",value:t.interpolationUID}]),n=e.metadata.sliceIndex;let i=-1,o=t.sliceData.numberOfSlices;for(const[s,c]of r.entries())s===n||!c.find(f=>!f.autoGenerated)||(s<n?i=Math.max(s,i):o=Math.min(s,o));const a=[];for(const[s,c]of r.entries())s<=i||s>=o||s===n||c.forEach(l=>{l.autoGenerated&&(Ra.removeAnnotation(l.annotationUID),a.push(l))});if(a.length){const s={annotations:a,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};Xe(t.viewport.element,V.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&o<t.sliceData.numberOfSlices){const s=r.get(o)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};um(c)}}function fm(t){const e=Qx(t);return e?.length?e.find(n=>n.getImageIds().some(i=>i===t.metadata.referencedImageId))??e[0]:void 0}const{uuidv4:Vle}=gn,kle=[Nt.HandlesUpdated,Nt.InterpolationUpdated],Yo=class Yo{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static removeTool(e){this.toolNames.includes(e)&&(this.toolNames=this.toolNames.filter(r=>r!==e))}static acceptAutoGenerated(e,r={}){const{toolNames:n,segmentationId:i,segmentIndex:o,sliceIndex:a}=r;for(const s of n||Yo.toolNames){const c=Ra.getAnnotations(s,e);if(c?.length)for(const l of c){const{interpolationUID:f,data:u,autoGenerated:d,metadata:h}=l;f&&(l.interpolationCompleted=!0),d&&(o&&o!==u.segmentation.segmentIndex||a!==void 0&&h&&a!==h.sliceIndex||i&&i!==u.segmentation.segmentationId||(Ec(l),l.autoGenerated=!1))}}}};Yo.toolNames=[],Yo.handleAnnotationCompleted=e=>{const r=e.detail.annotation;if(!r?.metadata)return;const{toolName:n,originalToolName:i}=r.metadata;if(!Yo.toolNames.includes(n)&&!Yo.toolNames.includes(i))return;const o=fm(r);if(!o){console.warn("Unable to find viewport for",r);return}const a=uy(o),s={viewport:o,sliceData:a,annotation:r,interpolationUID:r.interpolationUID},c=!!r.interpolationUID;if(r.autoGenerated=!1,c){ZE(s),um(s);return}const l=[{key:"segmentIndex",value:r.data.segmentation.segmentIndex,parentKey:h=>h.data.segmentation},{key:"viewPlaneNormal",value:r.metadata.viewPlaneNormal,parentKey:h=>h.metadata},{key:"viewUp",value:r.metadata.viewUp,parentKey:h=>h.metadata}];let f=ple(s,l);const{sliceIndex:u}=r.metadata,d=new Set;f.forEach(h=>{if(h.interpolationCompleted||h.metadata.sliceIndex===u){const{interpolationUID:g}=h;d.add(g)}}),f=f.filter(h=>!d.has(h.interpolationUID)),r.interpolationUID=f[0]?.interpolationUID||Vle(),s.interpolationUID=r.interpolationUID,um(s)},Yo.handleAnnotationUpdate=e=>{const r=e.detail.annotation,{changeType:n=Nt.HandlesUpdated}=e.detail;if(!r?.metadata)return;const{toolName:i,originalToolName:o}=r.metadata;if(!Yo.toolNames.includes(i)&&!Yo.toolNames.includes(o)||!kle.includes(n))return;const a=fm(r);if(!a){console.warn("Unable to find matching viewport for annotation interpolation",r);return}r.autoGenerated&&(Ec(r),r.autoGenerated=!1);const s=uy(a),c={viewport:a,sliceData:s,annotation:r,interpolationUID:r.interpolationUID,isInterpolationUpdate:n===Nt.InterpolationUpdated};um(c)},Yo.handleAnnotationDelete=e=>{const r=e.detail.annotation;if(!r?.metadata)return;const{toolName:n}=r.metadata;if(!Yo.toolNames.includes(n)||r.autoGenerated)return;const i=fm(r);if(!i){console.warn("No viewport, can't delete interpolated results",r);return}const o=uy(i),a={viewport:i,sliceData:o,annotation:r,interpolationUID:r.interpolationUID};r.autoGenerated=!1,ZE(a)};let sa=Yo;function uy(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function mP(t){t.forEach(e=>{const r=Kr(e);if(!r){console.warn(`ToolGroup not available for ${e}`);return}r.getViewportsInfo().forEach(i=>{const{renderingEngineId:o,viewportId:a}=i,s=Bn(o);if(!s){console.warn(`RenderingEngine not available for ${o}`);return}const c=s.getViewport(a);$0(c.element)})})}function vP(t,e={}){const r=t.annotationUIDsMap,n=e.segmentIndices?.length?e.segmentIndices:Array.from(r.keys()),i=new Map;return n.forEach(o=>{const a=r.get(o);let s=Array.from(a);s=s.filter(l=>!vn(l).parentAnnotationUID);const c=s.map(l=>{const f=vn(l),u=f.childAnnotationUIDs?.length,d=u&&f.childAnnotationUIDs.map(p=>{const m=vn(p);return{polyline:m.data.contour.polyline,isClosed:m.data.contour.closed}}),h=u&&d.map(p=>p.isClosed),g=u&&d.map(p=>p.polyline);return{polyline:f.data.contour.polyline,isClosed:f.data.contour.closed,annotationUID:f.annotationUID,referencedImageId:f.metadata.referencedImageId,holesPolyline:g,holesUIDs:f.childAnnotationUIDs,holesClosed:h}});i.set(o,c)}),{segmentIndices:n,annotationUIDsInSegmentMap:i}}function QE(t,e){if(!t||t.length===0)return[];if(!e)return[...t];const r=t[0],n=t[t.length-1];return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]?[...t]:[...t,r]}function Fle(t,e){const{annotationUIDsInSegmentMap:r}=vP(t);if(!r.has(e)){console.warn(`No contour information found for segmentIndex ${e}`);return}const n=new Map,i=r.get(e);for(const o of i){n.set(o.annotationUID,QE(o.polyline,o.isClosed));for(let a=0;a<o.holesUIDs?.length;a++)n.set(o.holesUIDs[a],QE(o.holesPolyline[a],o.holesClosed[a]))}return n}function Ng(t,e){const r=kx(t),n=Ut(t);if(!n||!n.representationData.Contour)return;const i=n.representationData.Contour,{annotationUIDsMap:o}=i;if(!o||!o.get(e))return;const a=Fle(i,e);if(!a)return;const s=Array.from(a?.keys()),c=new Map;for(const l of s){const f=vn(l),u=Ux(r,f);c.set(l,ko(a.get(l),u))}return c}function Ule(t,e,r={epsilon:.1}){const n=Ut(t);if(!n){console.warn(`Invalid segmentation given ${t}`);return}if(!n.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const i=kx(t);if(!i){console.warn("No viewport associated to the segmentation found");return}const o=Ng(t,e);if(!o){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const a=Array.from(o?.keys());for(const s of a){const c=vn(s);if(!c)continue;const l=o.get(s),f=E2(l,r.epsilon),u=Ux(i,c);u&&(c.data.contour.polyline=f.map(d=>u.canvasToWorld(d)),Cx(c))}}function L2(t){t&&(t.parentAnnotationUID&&B0(t),kt(t.annotationUID),Na(t))}function Ble(t,e){const{viewPlaneNormal:r}=t.metadata,{viewPlaneNormal:n}=e.metadata,i=ft(r,n);if(!Yu(1,Math.abs(i)))return!1;const{polyline:a}=t.data.contour,{polyline:s}=e.data.contour,c=ft(r,a[0]),l=ft(r,s[0]);return Yu(c,l)}function yP(t,e,r){let n=-1;if(e.forEach((i,o)=>{n>=0||i.a==t.b&&(n=o)}),n>=0){const i=e[n];return e.splice(n,1),r.push(i.b),r[0]==i.b?{remainingLines:e,contourPoints:r,type:"CLOSED_PLANAR"}:yP(i,e,r)}return{remainingLines:e,contourPoints:r,type:"OPEN_PLANAR"}}function u3(t){if(t.length==0)return[];const e=[],r=t.shift();e.push(r.a),e.push(r.b);const n=yP(r,t,e);if(n.remainingLines.length==0)return[{type:n.type,contourPoints:n.contourPoints}];{const i=u3(n.remainingLines);return i.push({type:n.type,contourPoints:n.contourPoints}),i}}function Gle(t){return u3(t)}const Wle={findContours:u3,findContoursFromReducedSet:Gle};function $le(t,e=!1){const r=t.getPoints(),n=t.getLines(),i=new Array(r.getNumberOfPoints()).fill(0).map((c,l)=>r.getPoint(l).slice()),o=new Array(n.getNumberOfCells()).fill(0).map((c,l)=>{const f=n.getCell(l*3).slice();return{a:f[0],b:f[1]}});if(e)return{points:i,lines:o};const a=[];for(const[c,l]of i.entries()){const f=a.findIndex(u=>u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]);if(f>=0)o.map(u=>(u.a===c&&(u.a=f),u.b===c&&(u.b=f),u));else{const u=a.length;a.push(l),o.map(d=>(d.a===c&&(d.a=u),d.b===c&&(d.b=u),d))}}const s=o.filter(c=>c.a!==c.b);return{points:a,lines:s}}const zle=(t,e)=>{const r=t[0],n=t[1];let i=!1;for(let o=0,a=e.length-1;o<e.length;a=o++){const s=e[o][0],c=e[o][1],l=e[a][0],f=e[a][1];c>n!=f>n&&r<(l-s)*(n-c)/(f-c)+s&&(i=!i)}return i};function jle(t,e,r){const n=[];t.contourPoints.forEach(o=>{n.push([r[o][0],r[o][1]])});let i=0;return e.contourPoints.forEach(o=>{zle([r[o][0],r[o][1]],n)||i++}),i===0}function Hle(t,e,r=!0){const n=t.filter(s=>s.type!=="CLOSED_PLANAR"),i=t.filter(s=>s.type==="CLOSED_PLANAR"),o=[];let a=[];return i.forEach((s,c)=>{const l=[];i.forEach((f,u)=>{c!=u&&jle(s,f,e)&&l.push(u)}),l.length>0?o.push({contour:s,holes:l}):a.push(c)}),r&&(o.forEach(s=>{s.contour.type="CLOSEDPLANAR_XOR",n.push(s.contour),s.holes.forEach(c=>{i[c].type="CLOSEDPLANAR_XOR",n.push(i[c]),a=a.filter(l=>l!==c)})}),a.forEach(s=>{n.push(i[s])})),n}const Kle={processContourHoles:Hle};function Xle(t,e){return df(e,t)}function f3(t){const e=[],r=[];t.forEach((n,i)=>{x2(n)&&r.push({polyline:n,originalIndex:i})});for(let n=0;n<r.length;n++){const i=r[n],o=Math.abs(oa(i.polyline)),a=[];for(let s=0;s<r.length;s++){if(n===s)continue;const c=r[s];Math.abs(oa(c.polyline))<o&&Xle(c.polyline,i.polyline)&&a.push(c.originalIndex)}a.length>0&&e.push({contourIndex:i.originalIndex,holeIndexes:a.sort((s,c)=>s-c)})}return e.sort((n,i)=>n.contourIndex-i.contourIndex)}let e4=!1;function N2(){if(e4)return;e4=!0;const t=()=>new Worker(new URL(""+new URL("computeWorker-B9Af7yv4.js",import.meta.url).href,import.meta.url),{name:"compute",type:"module"}),e=Is(),i={maxWorkerInstances:1,autoTerminateOnIdle:goe().computeWorker?.autoTerminateOnIdle??{enabled:!0,idleTimeThreshold:2e3}};e.registerWorker("compute",t,i)}function V2(){return An.getState().segmentations}function qle(t){const{segmentationId:e,representation:r,config:n}=t,{type:i,data:o}=r,a=o?{...o}:{};if(!a)throw new Error("Segmentation representation data may not be undefined");i===yt.Contour&&Yle(a);const s=Jle(n?.segments,i,a);return delete n?.segments,{segmentationId:e,label:n?.label??null,cachedStats:n?.cachedStats??{},segments:s,representationData:{[i]:{...a}}}}function Yle(t){t.geometryIds=t.geometryIds??[],t.annotationUIDsMap=t.annotationUIDsMap??new Map}function Jle(t,e,r){const n={};return t?Object.entries(t).forEach(([i,o])=>{const{label:a,locked:s,cachedStats:c,active:l,...f}=o,u={segmentIndex:Number(i),label:a??`Segment ${i}`,locked:s??!1,cachedStats:c??{},active:l??!1,...f};n[i]=u}):e===yt.Contour?Zle(n,r):e===yt.Surface?Qle(n,r):n[1]=eue(),n}function Zle(t,e){const{geometryIds:r}=e;r?.forEach(n=>{const i=Ae.getGeometry(n);if(i?.data){const{segmentIndex:o}=i.data;t[o]={segmentIndex:o}}})}function Qle(t,e){const{geometryIds:r}=e;r?.forEach(n=>{const i=Ae.getGeometry(n);if(i?.data){const{segmentIndex:o}=i.data;t[o]={segmentIndex:o}}})}function eue(){return{segmentIndex:1,label:"Segment 1",locked:!1,cachedStats:{},active:!0}}function wP(t,e){const r=An;t.forEach(n=>{const i=qle(n);r.addSegmentation(i),e||la(i.segmentationId)})}const tue={[yt.Labelmap]:t3,[yt.Contour]:e3,[yt.Surface]:Rx},a0=new Map;function d3(t,e,r){const n=tue[r].getUpdateFunction(t);n&&CP(e,r,n)}function CP(t,e,r){a0.has(t)||a0.set(t,new Map);const n=a0.get(t);n.has(e)&&h3(t,e);const i=rue(t,e,r);ke.addEventListener(V.SEGMENTATION_DATA_MODIFIED,i),n.set(e,i)}function h3(t,e){const r=a0.get(t);if(!r)return;const n=r.get(e);n&&(ke.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,n),r.delete(e))}function nue(t){const e=a0.get(t);if(e){for(const r of e.values())ke.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,r);a0.delete(t)}}function rue(t,e,r){const n=j0(i=>{const o=i.detail?.segmentationId,a=Ut(o);o===t&&a?.representationData?.[e]&&(r(t),la(t))},300);return(i=>{n(i)})}function K0(t,e,r){return TP(t,e,r)}function xP(t,e,r){return TP(t,e,r)}function TP(t,e,r){const{segmentationId:n,type:i}=e;return iue(t,n,i,r),An.removeSegmentationRepresentations(t,{segmentationId:n,type:i})}function SP(){An.getAllViewportSegmentationRepresentations().forEach(({viewportId:e,representations:r})=>{r.forEach(({segmentationId:n,type:i})=>{K0(e,{segmentationId:n,type:i})})}),An.resetState()}function _P(t,e,r){K0(t,{segmentationId:e,type:yt.Labelmap},r)}function EP(t,e,r){K0(t,{segmentationId:e,type:yt.Contour},r)}function bP(t,e,r){K0(t,{segmentationId:e,type:yt.Surface},r)}function iue(t,e,r,n){ho(t,{segmentationId:e,type:r}).forEach(a=>{a.type===yt.Labelmap?t3.removeRepresentation(t,a.segmentationId,n):a.type===yt.Contour?e3.removeRepresentation(t,a.segmentationId,n):a.type===yt.Surface&&Rx.removeRepresentation(t,a.segmentationId,n),h3(a.segmentationId,a.type)});const{viewport:o}=xn(t)||{};o&&o.render()}function g3(t){const e=An;e.getAllViewportSegmentationRepresentations().filter(({representations:n})=>n.some(i=>i.segmentationId===t)).map(({viewportId:n})=>n).forEach(n=>{xP(n,{segmentationId:t})}),e.removeSegmentation(t),Dx(t)}function DP(){const t=An;t.getState().segmentations.map(n=>n.segmentationId).forEach(n=>{g3(n)}),t.resetState()}function IP(){return An.getNextColorLUTIndex()}const p1=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]];function qd(t,e){const r=An,n=e??IP();let i=[...t];if(Dt(i[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),i=[[0,0,0,0],...i]),i=i.map(o=>o.length===3?[o[0],o[1],o[2],255]:o),i.length<255){const o=p1.slice(i.length);i=[...i,...o]}return r.addColorLUT(i,n),n}function oue(t){An.removeColorLUT(t)}function MP(t,e){return OP(t).map(o=>(e&&o.type===e,Ut(o.segmentationId))).filter(o=>o!==void 0)}function OP(t){return An.getState().viewportSegRepresentations[t]}function PP(t,e){return An.updateLabelmapSegmentationImageReferences(t,e)}function aue(t,e){return An.getStackSegmentationImageIdsForViewport(t,e)}function sue(){An.resetState()}const cue=Object.freeze(Object.defineProperty({__proto__:null,addColorLUT:qd,addSegmentations:wP,destroy:sue,getColorLUT:bg,getCurrentLabelmapImageIdForViewport:kl,getCurrentLabelmapImageIdsForViewport:Ic,getNextColorLUTIndex:IP,getSegmentation:Ut,getSegmentationRepresentation:Ix,getSegmentationRepresentations:ho,getSegmentationRepresentationsBySegmentationId:uO,getSegmentations:V2,getStackSegmentationImageIdsForViewport:aue,getViewportIdsWithSegmentation:ff,getViewportSegmentationRepresentations:OP,getViewportSegmentations:MP,removeAllSegmentationRepresentations:SP,removeAllSegmentations:DP,removeColorLUT:oue,removeContourRepresentation:EP,removeLabelmapRepresentation:_P,removeSegmentation:g3,removeSegmentationRepresentation:K0,removeSurfaceRepresentation:bP,updateLabelmapSegmentationImageReferences:PP},Symbol.toStringTag,{value:"Module"}));function RP(t){if("volumeId"in t){if(t=t,!Ae.getVolume(t.volumeId))throw new Error(`volumeId of ${t.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else if("imageIds"in t){if(t=t,!t.imageIds)throw new Error("The segmentationInput.representationData.imageIds is undefined, please provide a valid representationData.imageIds for stack data")}else throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData")}function lue(t){if(!t.representation.data)throw new Error("The segmentationInput.representationData.data is undefined, please provide a valid representationData.data");const e=t.representation.data;RP(e)}function uue(t){RP(t)}const fue=Object.freeze(Object.defineProperty({__proto__:null,validate:uue,validatePublic:lue},Symbol.toStringTag,{value:"Module"}));function AP(t){const e=Ae.getVolume(t);if(!e)return null;const r=e.referencedVolumeId;let n;if(r)n=Ae.getVolume(r);else{const i=e.imageIds,a=Ae.getImage(i[0]).referencedImageId;n=Ae.getVolumeContainingImageId(a)?.volume}return n}function due({operationData:t}){const{volumeId:e}=t;if(!e){const c=new CustomEvent(Ge.ERROR_EVENT,{detail:{type:"Segmentation",message:"No volume id found for the segmentation"},cancelable:!0});return ke.dispatchEvent(c),null}const r=Ae.getVolume(e),n=AP(e);if(!r||!n)return null;const{imageData:i}=r,{voxelManager:o}=r,{voxelManager:a,imageData:s}=n;return{segmentationImageData:i,segmentationVoxelManager:o,segmentationScalarData:null,imageScalarData:null,imageVoxelManager:a,imageData:s}}function hue({operationData:t,viewport:e,strategy:r}){const{segmentationId:n}=t;let i,o,a,s,c,l;if(r.ensureSegmentationVolumeFor3DManipulation)r.ensureSegmentationVolumeFor3DManipulation({operationData:t,viewport:e}),o=t.segmentationVoxelManager,i=t.segmentationImageData,a=null;else{const f=kl(e.id,n);if(!f)return null;const u=y2(e.id,n);if(!u)return null;const d=Ae.getImage(f);i=u.actor.getMapper().getInputData(),o=d.voxelManager;const h=t.imageId,g=Ae.getImage(h);if(!g)return null;a=g.getPixelData?.()}if(r.ensureImageVolumeFor3DManipulation)r.ensureImageVolumeFor3DManipulation({operationData:t,viewport:e}),c=t.imageVoxelManager,s=t.imageScalarData,l=t.imageData;else{const f=e.getCurrentImageId();if(!f)return null;const u=Ae.getImage(f);l=u?null:e.getImageData(),s=u?.getPixelData()||l.getScalarData(),c=u?.voxelManager}return{segmentationImageData:i,segmentationScalarData:a,imageScalarData:s,segmentationVoxelManager:o,imageVoxelManager:c,imageData:l}}function p3({operationData:t,viewport:e,strategy:r}){return t?"volumeId"in t&&t.volumeId!=null||"referencedVolumeId"in t&&t.referencedVolumeId!=null?due({operationData:t}):hue({operationData:t,viewport:e,strategy:r}):null}function X0(t){const{representationData:e}=Ut(t);let{volumeId:r}=e.Labelmap,n;if(r&&(n=Ae.getVolume(r),n))return n;const{imageIds:i}=e.Labelmap;if(r=Ae.generateVolumeId(i),!(!i||i.length===0||!Nl(i)))return n=pg(r,i),n}const LP={[ht.EnsureSegmentationVolumeFor3DManipulation]:t=>{const{operationData:e,viewport:r}=t,{segmentationId:n,imageIds:i}=e,o=r?r.getImageIds():i.map(c=>Ae.getImage(c).referencedImageId);if(!Nl(o))throw new Error("Volume is not reconstructable for sphere manipulation");const s=X0(n);s&&(e.segmentationVoxelManager=s.voxelManager,e.segmentationImageData=s.imageData)}};function k2(t){if(!t?.length||!Nl(t))return;const r=Ae.generateVolumeId(t);let n=Ae.getVolume(r);return n||(n=pg(r,t),n)}const NP={[ht.EnsureImageVolumeFor3DManipulation]:t=>{const{operationData:e,viewport:r}=t;let n;if(r){if(n=r.getImageIds(),!Nl(n))throw new Error("Volume is not reconstructable for sphere manipulation")}else n=Ut(e.segmentationId).representationData.Labelmap.imageIds.map(s=>Ae.getImage(s).referencedImageId);const i=k2(n);if(!i)throw new Error("Failed to create or get image volume");e.imageVoxelManager=i.voxelManager,e.imageData=i.imageData}},Es=(t,e)=>{Xe(ke,Ge.WEB_WORKER_PROGRESS,{progress:e,type:t})},VP=(t,e)=>{const r=Ut(t),{representationData:n}=r,{Labelmap:i}=n;if(!i)return console.debug("No labelmap found for segmentation",t),null;const o=i.volumeId,a=i.imageIds,s={segmentationId:t,volumeId:o,imageIds:a};let c=!1;if(a){const f=a.map(u=>Ae.getImage(u).referencedImageId);c=Nl(f)}let l=e;return l?Array.isArray(l)||(l=[l,255]):l=[no(t)],{operationData:s,segVolumeId:o,segImageIds:a,reconstructableVolume:c,indices:l}},kP=t=>p3({operationData:t,strategy:{ensureSegmentationVolumeFor3DManipulation:LP.ensureSegmentationVolumeFor3DManipulation,ensureImageVolumeFor3DManipulation:NP.ensureImageVolumeFor3DManipulation}}),FP=t=>{const e=[],r=[];for(const n of t){const i=Ae.getImage(n),o=i.getPixelData(),{origin:a,direction:s,spacing:c,dimensions:l}=r2(i);e.push({scalarData:o,dimensions:l,spacing:c,origin:a,direction:s});const f=i.referencedImageId;if(f){const u=Ae.getImage(f);if(!u)continue;const d=u.getPixelData(),h=u.voxelManager,g=[u.rowPixelSpacing,u.columnPixelSpacing];r.push({scalarData:d,dimensions:h?h.dimensions:[u.columns,u.rows,1],spacing:g})}}return{segmentationInfo:e,imageInfo:r}},gue=(t,e)=>{let r;if(t){const s=Ae.getVolume(t).imageIds,c=Ae.getImage(s[0]);c&&(r=c.referencedImageId)}else e?.length&&(r=Ae.getImage(e[0]).referencedImageId);const n=Ae.getImage(r),i=ut("scalingModule",r),o={isPreScaled:!!n?.preScale?.scaled,isSuvScaled:typeof i?.suvbw=="number"};return{refImageId:r,modalityUnitOptions:o}},{Labelmap:pue}=yt;async function UP({segmentations:t}){N2(),Es(No.GENERATE_CONTOUR_SETS,0);const{representationData:e,segments:r=[0,1],segmentationId:n}=t;let{volumeId:i}=e[pue];if(!i){const g=X0(n);g&&(i=g.volumeId)}const o=Ae.getVolume(i);if(!o){console.warn(`No volume found for ${i}`);return}const c={scalarData:o.voxelManager.getCompleteScalarDataArray(),dimensions:o.dimensions,spacing:o.imageData.getSpacing(),origin:o.imageData.getOrigin(),direction:o.imageData.getDirection()},l=Array.isArray(r)?r.filter(g=>g!==null).map(g=>g.segmentIndex||g):Object.values(r).filter(g=>g!==null).map(g=>g.segmentIndex||g),f=await Is().executeTask("compute","generateContourSetsFromLabelmapVolume",{segmentation:c,indices:l,mode:"individual"}),u=o.imageIds.map(g=>{const p=Ae.getImage(g)?.referencedImageId;return p?Ae.getImage(p):void 0}),d=u.map(g=>r2(g)),h=f.map(g=>{const p=r[g.segment.segmentIndex]||{};if(!g.sliceContours.length)return null;const m=g.sliceContours[0].polyData.points[0];let w;if(m){const v=d.findIndex(y=>{const{scanAxisNormal:C,origin:x}=y,T=ps(C,x);return T9(m,T)});v!==-1&&(w=u[v].imageId)}return{label:p.label,color:p.color,metadata:{FrameOfReferenceUID:o.metadata.FrameOfReferenceUID,referencedImageId:w},sliceContours:g.sliceContours.map(v=>({contours:v.contours,polyData:v.polyData,FrameNumber:v.sliceIndex+1,sliceIndex:v.sliceIndex,FrameOfReferenceUID:o.metadata.FrameOfReferenceUID,referencedImageId:w}))}}).filter(g=>g!==null);return Es(No.GENERATE_CONTOUR_SETS,100),h}class BP{constructor(){}static getContourSequence(e,r){const{data:n}=e,{projectionPoints:i,projectionPointsImageIds:o}=n.cachedStats;return i.map((a,s)=>{const c=mue(a),l=vue(o[s],r);return{NumberOfContourPoints:c.length/3,ContourImageSequence:l,ContourGeometricType:"CLOSED_PLANAR",ContourData:c}})}}BP.toolName="RectangleROIStartEndThreshold";function mue(t){return[...t[0],...t[1],...t[3],...t[2]].flat().map(i=>i.toFixed(2))}function vue(t,e){const r=e.get("sopCommonModule",t);return{ReferencedSOPClassUID:r.sopClassUID,ReferencedSOPInstanceUID:r.sopInstanceUID}}function yue(t){if(!t?.data)throw new Error("Tool data is empty");if(!t.metadata||!t.metadata.referencedImageId)throw new Error("Tool data is not associated with any imageId")}const oh=class oh{constructor(){}static convert(e,r,n){yue(e);const{toolName:i}=e.metadata,o=oh.TOOL_NAMES[i];if(!o)throw new Error(`Unknown tool type: ${i}, cannot convert to RTSSReport`);const a=o.getContourSequence(e,n),s=r.color?.slice(0,3)||[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255)];return{ReferencedROINumber:r.segmentIndex,ROIDisplayColor:s,ContourSequence:Array.isArray(a)?a:[a]}}static register(e){oh.TOOL_NAMES[e.toolName]=e}};oh.TOOL_NAMES={};let _0=oh;_0.register(BP);function wue(t,e){sa.acceptAutoGenerated(t,e)}const{isEqual:Cue}=gn;function $5(t,e){const{polyline:r}=t.data.contour,{points:n}=t.data.handles,{length:i}=n;if(e===i)return r.length;if(e<0&&(e=(e+i)%i),e===0)return 0;const o=n[e],a=r.findIndex(c=>Cue(o,c));if(a!==-1)return a;let s=1/0;return r.reduce((c,l,f)=>{const u=U8(l,o);return u<s?(s=u,f):c},-1)}function GP(t,e){if(!t||t.length===0)return[];if(e<=0)return[];const r=[];for(let n=0;n<t.length;n++){const i=t[n];if(!i||i.length<3)continue;x2(i)&&Math.abs(oa(i))/100<e&&r.push(n)}return r}const xue=Object.freeze(Object.defineProperty({__proto__:null,AnnotationToPointData:_0,acceptAutogeneratedInterpolations:wue,areCoplanarContours:Ble,contourFinder:Wle,detectContourHoles:Kle,findContourHoles:f3,findHandlePolylineIndex:$5,findIslands:GP,generateContourSetsFromLabelmap:UP,getContourHolesDataCanvas:Lg,getContourHolesDataWorld:dP,getDeduplicatedVTKPolyDataPoints:$le,updateContourPolyline:Ga},Symbol.toStringTag,{value:"Module"}));function Tue(t,e){const r=Ut(t);if(!r){console.warn(`Invalid segmentation given ${t}`);return}if(!r.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const n=Ng(t,e);if(!n){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const i=Array.from(n?.keys()),o=i.map(s=>n.get(s)),a=f3(o);a?.length>0&&a.forEach(s=>{s.holeIndexes.forEach(c=>{const l=vn(i[c]);L2(l)})})}function Sue(t,e,r={threshold:3}){const n=Ut(t);if(!n){console.warn(`Invalid segmentation given ${t}`);return}if(!n.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const i=Ng(t,e);if(!i){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const o=Array.from(i?.keys()),a=o.map(c=>i.get(c)),s=GP(a,r.threshold);s?.length>0&&s.forEach(c=>{const l=vn(o[c]);L2(l)})}function _ue(t,e,r={knotsRatioPercentage:30}){const n=Ut(t);if(!n){console.warn(`Invalid segmentation given ${t}`);return}if(!n.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const i=n.representationData.Contour,{annotationUIDsMap:o}=i;if(!o){console.warn(`No contours found for segmentation ${t}`);return}if(!o.has(e)){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}o.get(e).forEach(s=>{const c=vn(s);if(!c)return;const l=c.data.contour.polyline;if(!l||l.length<3)return;const f=g1(l,0,l.length-1,r.knotsRatioPercentage);c.data.contour.polyline=f})}function Eue(t,e,r,n){const i=Ut(t);if(!i){console.warn(`Invalid segmentation given ${t}`);return}if(!i.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const{annotationUIDsMap:o}=i?.representationData.Contour||{};if(!o){console.warn(`No annotation map found for segmentation ${t}`);return}const a=o?.get(e);if(!a){console.warn(`Segmentation index ${e} has no annotations in segmentation ${t}`);return}let s;if(r&&typeof n=="number"){const d=Ut(r);if(!d){console.warn(`Target segmentation ${r} does not exist.`);return}if(!d.representationData.Contour){console.warn(`No contour representation found for target segmentation ${r}`);return}s=d.representationData.Contour.annotationUIDsMap.get(n),s||(s=new Set,d.representationData.Contour.annotationUIDsMap.set(n,s))}const c=Ng(t,e);if(!c){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const l=Array.from(c?.keys()),f=l.map(d=>c.get(d)),u=f3(f);u?.length>0&&u.forEach(d=>{d.holeIndexes.forEach(h=>{const g=vn(l[h]);B0(g),r&&typeof n=="number"?s.add(g.annotationUID):a.add(g.annotationUID)})})}const bue=Object.freeze(Object.defineProperty({__proto__:null,convertContourHoles:Eue,decimateContours:Ule,extractSegmentPolylines:Ng,getAnnotationMapFromSegmentation:vP,getAnnotationsUIDMapFromSegmentation:Fh,getViewportAssociatedToSegmentation:Fx,getViewportWithMatchingViewPlaneNormal:Ux,removeCompleteContourAnnotation:L2,removeContourHoles:Tue,removeContourIslands:Sue,smoothContours:_ue},Symbol.toStringTag,{value:"Module"}));function Due(t,e,r){const n=Fh(t.segmentationId);if(!n)return;const i=n.get(e);i&&i.forEach(o=>{w2(o,r)})}function Iue(t,e){const r=Ut(t);if(!r)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=r;return n[e].locked}function Mue(t,e,r=!0){const n=Ut(t);if(!n)throw new Error(`No segmentation state found for ${t}`);const{segments:i}=n;i[e].locked=r,n?.representationData?.Contour&&Due(n,e,r),la(t)}function hf(t){const e=Ut(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:r}=e;return Object.keys(r).filter(i=>r[i].locked).map(i=>parseInt(i))}const Oue=Object.freeze(Object.defineProperty({__proto__:null,getLockedSegmentIndices:hf,isSegmentIndexLocked:Iue,setSegmentIndexLocked:Mue},Symbol.toStringTag,{value:"Module"}));function Pue(t,e){if(!t)throw new Error("addColorLUT: colorLUT is required");return qd(t,e)}function Rue(t,e,r){if(!bg(r))throw new Error(`setColorLUT: could not find colorLUT with index ${r}`);const n=ho(t,{segmentationId:e});if(!n)throw new Error(`viewport specific state for viewport ${t} does not exist`);n.forEach(i=>{i.colorLUTIndex=r}),us(t,e)}function bs(t,e,r){const n=ho(t,{segmentationId:e});if(!n||n.length===0)return null;const i=n[0],{colorLUTIndex:o}=i,a=bg(o);let s=a[r];if(!s){if(typeof r!="number")return console.warn(`Can't create colour for LUT index ${r}`),null;s=a[r]=[0,0,0,0]}return s}function WP(t,e,r,n){const i=bs(t,e,r);for(let o=0;o<n.length;o++)i[o]=n[o];us(t,e)}const Aue=Object.freeze(Object.defineProperty({__proto__:null,addColorLUT:Pue,getSegmentIndexColor:bs,setColorLUT:Rue,setSegmentIndexColor:WP},Symbol.toStringTag,{value:"Module"}));function $P(t,e){return An.getSegmentationRepresentationVisibility(t,e)}function zP({segmentationId:t,segmentIndex:e,viewportId:r,autoGenerated:n=!1}){const i=bs(r,t,e),o=$P(r,{segmentationId:t,type:yt.Contour}),s=nf(r)?.segmentationId===t,c=fo.getRenderInactiveSegmentations(r),f=fo.getStyle({viewportId:r,segmentationId:t,type:yt.Contour,segmentIndex:e});let u=1,d,h=1,g=0,p=f.renderFill??!0,m=f.renderOutline??!0;n?(u=f.outlineWidthAutoGenerated??u,d=f.outlineDashAutoGenerated??d,h=f.outlineOpacity??h,g=f.fillAlphaAutoGenerated??g):s?(u=f.outlineWidth??u,d=f.outlineDash??d,h=f.outlineOpacity??h,g=f.fillAlpha??g):(u=f.outlineWidthInactive??u,d=f.outlineDashInactive??d,h=f.outlineOpacityInactive??h,g=f.fillAlphaInactive??g,p=f.renderFillInactive??p,m=f.renderOutlineInactive??m),no(t)===e&&(u+=f.activeSegmentOutlineWidthDelta),u=m?u:0,g=p?g:0;const w=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${h})`,v=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,C=!Px(r,{segmentationId:t,type:yt.Contour}).has(e);return{color:w,fillColor:v,lineWidth:u,fillOpacity:g,lineDash:d,textbox:{color:w},visibility:s?o&&C:c}}const Y3=class Y3 extends dle{constructor(e,r){super(e,r),this.configuration.interpolation?.enabled&&sa.addTool(this.getToolName())}onSetToolConfiguration(){this.configuration.interpolation?.enabled?sa.addTool(this.getToolName()):sa.removeTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const r=e.detail,{element:n}=r,i=Ce(n);if(!i)return;const{viewport:o}=i,a=super.createAnnotation(e);if(!this.isContourSegmentationTool())return a;const s=nf(o.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,l=no(c);return jr(a,{data:{segmentation:{segmentationId:c,segmentIndex:l}}})}addAnnotation(e,r){const n=super.addAnnotation(e,r);return this.isContourSegmentationTool()&&Ec(e),n}cancelAnnotation(e){this.isContourSegmentationTool()&&Na(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const r=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return r;const n=this._getContourSegmentationStyle(e);return jr(r,n)}renderAnnotationInstance(e){const{annotation:r}=e,{invalidated:n}=r,i=super.renderAnnotationInstance(e);if(n&&this.isContourSegmentationTool()){const{segmentationId:o}=r.data.segmentation;ui(o);const s=ff(o).map(c=>lr(c).id);mP(s)}return i}filterInteractableAnnotationsForElement(e,r){if(!r||!r.length)return;const n=super.filterInteractableAnnotationsForElement(e,r);if(!n||!n.length)return;const i=Ce(e),{viewport:o}=i;return n.filter(a=>{const s=a?.data?.segmentation?.segmentationId;return s?!!An.getSegmentationRepresentation(o.id,{segmentationId:s,type:yt.Contour}):!0})}_getContourSegmentationStyle(e){const r=e.annotation,{segmentationId:n,segmentIndex:i}=r.data.segmentation,{viewportId:o}=e.styleSpecifier,a=ho(o,{segmentationId:n});if(!a?.length)return{};a.length>1?a.find(m=>m.segmentationId===n&&m.type===yt.Contour):a[0];const{autoGenerated:s}=r,l=hf(n).includes(i),{color:f,fillColor:u,lineWidth:d,fillOpacity:h,lineDash:g,visibility:p}=zP({segmentationId:n,segmentIndex:i,viewportId:o,autoGenerated:s});return{color:f,fillColor:u,lineWidth:d,fillOpacity:h,lineDash:g,textbox:{color:f},visibility:p,locked:l}}};Y3.PreviewSegmentIndex=255;let Wh=Y3;function jP(t,e){const r=ut("generalSeriesModule",t);return Rc(r.modality,t,e)}function Rc(t,e,r){return t==="CT"?"HU":t==="PT"?Lue(e,r):""}function Lue(t,e){return e.isPreScaled?e.isSuvScaled?"SUV":ut("generalSeriesModule",t)?.modality==="PT"?ut("petSeriesModule",t)?.units||"unitless":"unknown":"raw"}const{pointCanProjectOnLine:t4}=Vl,{EPSILON:Nue}=Mc,Vue=1-Nue,ah=class ah extends Wh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:Qr.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:kue,statsCalculator:_s}}){super(e,r),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=n=>{const i=n.detail,{element:o}=i,a=this.createAnnotation(n);this.addAnnotation(a,o);const s=vt(o,this.getToolName());return this.activateDraw(n,a,s),n.preventDefault(),Me(s),a},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,c=vt(s,this.getToolName());this.activateOpenContourEndEdit(n,i,c,o)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o,s=vt(a,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(n,i,s):this.activateOpenContourEdit(n,i,s),n.preventDefault()},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{polyline:l}=i.data.contour;let f=c.worldToCanvas(l[0]);for(let h=1;h<l.length;h++){const g=f,p=c.worldToCanvas(l[h]);if(t4(o,g,p,a))return!0;f=p}if(!i.data.contour.closed)return!1;const u=c.worldToCanvas(l[0]),d=c.worldToCanvas(l[l.length-1]);return t4(o,u,d,a)},this.cancel=n=>{const i=this.isDrawing,o=this.isEditingOpen,a=this.isEditingClosed;i?this.cancelDrawing(n):o?this.cancelOpenContourEdit(n):a&&this.cancelClosedContourEdit(n)},this._calculateCachedStats=(n,i,o,a)=>{const{data:s}=n,{cachedStats:c}=s,{polyline:l,closed:f}=s.contour,u=Object.keys(c);for(let h=0;h<u.length;h++){const g=u[h],p=this.getTargetImageData(g);if(!p)continue;const{imageData:m,metadata:w}=p,v=l.map(ae=>i.worldToCanvas(ae)),y={isPreScaled:Pc(i,g),isSuvScaled:this.isSuvScaled(i,g,n.metadata.referencedImageId)},C=Rc(w.Modality,n.metadata.referencedImageId,y),x=s.contour.polyline,T=x.length,S=new Array(T);for(let ae=0;ae<T;ae++)S[ae]=i.worldToCanvas(x[ae]);const{maxX:_,maxY:E,minX:D,minY:b}=Al(S),I=i.canvasToWorld([D,b]),O=Lr(m,I),M=i.canvasToWorld([_,E]),R=Lr(m,M),B=Fo(p,[O,R]),k=v[0],L=i.canvasToWorld(k),F=i.canvasToWorld([k[0]+1,k[1]]),j=i.canvasToWorld([k[0],k[1]+1]),J=Nr(L,F),ie=Nr(L,j),fe={targetId:g,viewport:i,canvasCoordinates:v,points:l,imageData:m,metadata:w,cachedStats:c,modalityUnit:C,calibratedScale:B,deltaInX:J,deltaInY:ie};f?this.updateClosedCachedStats(fe):this.updateOpenCachedStats(fe)}const d=n.invalidated;return n.invalidated=!1,d&&Gt(n,a.viewport.element,Nt.StatsUpdated),c},this._renderStats=(n,i,o,a)=>{const{data:s}=n,c=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:o.viewport.id,annotationUID:n.annotationUID},f=this.getLinkedTextBoxStyle(l,n);if(!f.visibility)return;const u=this.configuration.getTextLines(s,c);if(!u||u.length===0)return;const d=s.contour.polyline.map(C=>i.worldToCanvas(C));if(!s.handles.textBox.hasMoved){const C=po(d);s.handles.textBox.worldPosition=i.canvasToWorld(C)}const h=i.worldToCanvas(s.handles.textBox.worldPosition),p=Ei(a,n.annotationUID??"","1",u,h,d,{},f),{x:m,y:w,width:v,height:y}=p;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([m,w]),topRight:i.canvasToWorld([m+v,w]),bottomLeft:i.canvasToWorld([m,w+y]),bottomRight:i.canvasToWorld([m+v,w+y])}},gce(this),Tce(this),Rce(this),jce(this),Xce(this),ale(this),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,r){if(!r?.length)return[];const n=super.filterInteractableAnnotationsForElement(e,r);if(!n?.length)return[];const i=Ce(e),{viewport:o}=i;let a;if(o instanceof zn){const s=o.getCamera(),{spacingInNormalDirection:c}=N0(o,s);a=this.filterAnnotationsWithinSlice(n,s,c)}else a=Rg(o,r);return a}filterAnnotationsWithinSlice(e,r,n){const{viewPlaneNormal:i}=r,o=e.filter(l=>{let f=l.metadata.viewPlaneNormal;if(!l.metadata.referencedImageId&&!f&&l.metadata.FrameOfReferenceUID){for(const d of l.data.contour.polyline){const h=an(Ie(),d,r.focalPoint),g=ft(h,r.viewPlaneNormal);if(!Dt(g,0))return!1}return l.metadata.viewPlaneNormal=r.viewPlaneNormal,l.metadata.cameraFocalPoint=r.focalPoint,!0}if(!f){const{referencedImageId:d}=l.metadata,{imageOrientationPatient:h}=ut("imagePlaneModule",d),g=mt(h[0],h[1],h[2]),p=mt(h[3],h[4],h[5]);f=Ie(),nn(f,g,p),l.metadata.viewPlaneNormal=f}const u=Math.abs(ft(i,f))>Vue;return f&&u});if(!o.length)return[];const a=n/2,{focalPoint:s}=r,c=[];for(const l of o){const u=l.data.contour.polyline[0];if(!l.isVisible)continue;const d=Ie();an(d,s,u);const h=ft(d,i);Math.abs(h)<a&&c.push(l)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const r=e.detail.currentPoints.world,n=super.createAnnotation(e),i=a=>{a.data.handles.points.length=0};return jr(n,{data:{contour:{polyline:[[...r]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:r,targetId:n,svgDrawingHelper:i}=e,o=e.annotation;let a=!1;const{viewport:s,renderingEngine:c}=r,l=this.isDrawing,f=this.isEditingOpen,u=this.isEditingClosed;if(!(l||f||u))this.configuration.displayOnePointAsCrosshairs&&o.data.contour.polyline.length===1?this.renderPointContourWithMarker(r,i,o):this.renderContour(r,i,o);else{const d=this.commonData.annotation.annotationUID;if(o.annotationUID===d)if(l)this.renderContourBeingDrawn(r,i,o);else if(u)this.renderClosedContourBeingEdited(r,i,o);else if(f)this.renderOpenContourBeingEdited(r,i,o);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&o.data.contour.polyline.length===1?this.renderPointContourWithMarker(r,i,o):this.renderContour(r,i,o);a=!0}if(this.configuration.calculateStats)return o.invalidated&&this._calculateStatsIfActive(o,n,s,c,r),this._renderStats(o,s,r,i),a}_calculateStatsIfActive(e,r,n,i,o){const a=this.commonData?.annotation.annotationUID;if(!(e.annotationUID===a&&!this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:s}=e;s.cachedStats[r]?.unit?e.invalidated&&this._throttledCalculateCachedStats(e,n,i,o):(s.cachedStats[r]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,unit:null},this._calculateCachedStats(e,n,i,o))}}updateClosedCachedStats({viewport:e,points:r,imageData:n,metadata:i,cachedStats:o,targetId:a,modalityUnit:s,canvasCoordinates:c,calibratedScale:l,deltaInX:f,deltaInY:u}){const{scale:d,areaUnit:h,unit:g}=l,{voxelManager:p}=e.getImageData(),m=r.map(J=>n.worldToIndex(J));let w=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER,y=Number.MAX_SAFE_INTEGER,C=Number.MIN_SAFE_INTEGER,x=Number.MAX_SAFE_INTEGER,T=Number.MIN_SAFE_INTEGER;for(let J=0;J<r.length;J++){const ie=m[J].map(Math.floor);w=Math.min(w,ie[0]),v=Math.max(v,ie[0]),y=Math.min(y,ie[1]),C=Math.max(C,ie[1]),x=Math.min(x,ie[2]),T=Math.max(T,ie[2])}let S=Mg(c)/d/d;S*=f*u;const _=ah.calculateLengthInIndex(l,m,closed),E=.01*(v-w),D=.01*(C-y),b=.01*(T-x);w=Math.floor(w-E),v=Math.ceil(v+E),y=Math.floor(y-D),C=Math.ceil(C+D),x=Math.floor(x-b),T=Math.ceil(T+b);const I=[[w,v],[y,C],[x,T]],O=n.indexToWorld([v,C,T]),M=e.worldToCanvas(O);let R=0,A=[],B=0,k;p&&(k=p.forEach(this.configuration.statsCalculator.statsCallback,{imageData:n,isInObject:(J,ie)=>{let fe=!0;const ae=e.worldToCanvas(J);return ae[1]!=R&&(B=0,R=ae[1],A=BO(c,ae,[M[0],ae[1]]),A.sort((function(de){return function(we,_e){return we[de]===_e[de]?0:we[de]<_e[de]?-1:1}})(0))),A.length&&ae[0]>A[0][0]&&(A.shift(),B++),B%2===0&&(fe=!1),fe},boundsIJK:I,returnPoints:this.configuration.storePointData}));const L=this.configuration.statsCalculator.getStatistics(),F={name:"area",value:S,unit:h,type:ra.Area},j={name:"perimeter",value:_,unit:g,type:ra.Linear};o[a]={Modality:i.Modality,area:S,perimeter:_,mean:L.mean?.value,max:L.max?.value,min:L.min?.value,stdDev:L.stdDev?.value,statsArray:[F,j,...L.array],pointsInShape:k,areaUnit:h,modalityUnit:s,unit:g}}updateOpenCachedStats({targetId:e,metadata:r,cachedStats:n,modalityUnit:i,calibratedScale:o,imageData:a,points:s}){const{unit:c}=o,l=s.map(d=>a.worldToIndex(d)),f=ah.calculateLengthInIndex(o,l),u={name:"length",value:f,unit:c,type:ra.Linear};n[e]={Modality:r.Modality,length:f,modalityUnit:i,unit:c,statArray:[u]}}};ah.toolName="PlanarFreehandROI";let m1=ah;function kue(t,e){const r=t.cachedStats[e],{area:n,mean:i,stdDev:o,length:a,perimeter:s,max:c,min:l,isEmptyArea:f,unit:u,areaUnit:d,modalityUnit:h}=r||{},g=[];if(fr(n)){const p=f?"Area: Oblique not supported":`Area: ${Ht(n)} ${d}`;g.push(p)}return fr(i)&&g.push(`Mean: ${Ht(i)} ${h}`),fr(c)&&g.push(`Max: ${Ht(c)} ${h}`),fr(l)&&g.push(`Min: ${Ht(l)} ${h}`),fr(o)&&g.push(`Std Dev: ${Ht(o)} ${h}`),fr(s)&&g.push(`Perimeter: ${Ht(s)} ${u}`),fr(a)&&g.push(`${Ht(a)} ${u}`),g}const A1=class A1 extends m1{constructor(e){const r=jr({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(r)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const r=e.annotation,{invalidated:n}=r,i=super.renderAnnotationInstance(e);if(n){const{segmentationId:o}=r.data.segmentation;ui(o)}return i}};A1.toolName="PlanarFreehandContourSegmentationTool",_0.register(A1);let E0=A1;const Fue={[yt.Labelmap]:t3,[yt.Contour]:e3,[yt.Surface]:Rx},bp=E0.toolName;class Uue{constructor(){this._needsRender=new Set,this._pendingRenderQueue=[],this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>Bi().flatMap(r=>r.getViewports()),this._renderFlaggedSegmentations=()=>{if(this._throwIfDestroyed(),Array.from(this._needsRender).forEach(r=>{this._triggerRender(r)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._pendingRenderQueue.length>0){const r=this._pendingRenderQueue.shift();r&&r.length>0&&this._setViewportsToBeRenderedNextFrame(r)}}}renderSegmentationsForViewport(e){const r=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(r)}renderSegmentation(e){const r=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(r)}_getViewportIdsForSegmentation(e){const r=this._getAllViewports(),n=[];for(const i of r){const o=i.id;e?ho(o,{segmentationId:e})?.length>0&&n.push(o):ho(o)?.length>0&&n.push(o)}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){if(this._animationFrameSet){this._pendingRenderQueue.push(e);return}e.forEach(r=>{this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const r=ho(e);if(!r?.length)return;const{viewport:n}=xn(e)||{};if(!n)return;const i=r.map(o=>{o.type===yt.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const a=Fue[o.type],c=Ut(o.segmentationId).representationData[o.type]!==void 0;try{a.render(n,o).then(()=>{c||d3(n,o.segmentationId,o.type)})}catch(l){console.error(l)}return Promise.resolve({segmentationId:o.segmentationId,type:o.type})});Promise.allSettled(i).then(o=>{const a=o.filter(l=>l.status==="fulfilled").map(l=>l.value);function s(l){const{element:f,viewportId:u}=l.detail;f.removeEventListener(Ge.IMAGE_RENDERED,s),a.forEach(d=>{const h={viewportId:u,segmentationId:d.segmentationId,type:d.type};Xe(ke,V.SEGMENTATION_RENDERED,{...h})})}n.element.addEventListener(Ge.IMAGE_RENDERED,s),n.render()})}_addPlanarFreeHandToolIfAbsent(e){bp in Ue.tools||xx(E0);const r=lr(e.id);r.hasTool(bp)||(r.addTool(bp),r.setToolPassive(bp))}}function q0(t){HP.renderSegmentationsForViewport(t)}function F2(t){HP.renderSegmentation(t)}const HP=new Uue;function Bue({modifiedSlicesToUse:t,representationData:e,type:r}){const n=Ae.getVolume(e[r].volumeId);if(!n){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:o}=n;let a;if(t?.length>0)a=t;else{const s=i.getDimensions()[2];a=[...Array(s).keys()]}a.forEach(s=>{o.setUpdatedFrame(s)}),i.modified()}function Gue({viewportIds:t,segmentationId:e}){t.forEach(r=>{let n=ho(r,{segmentationId:e});n=n.filter(i=>i.type===yt.Labelmap),n.forEach(i=>{if(i.segmentationId!==e)return;const o=xn(r);if(!o)return;const{viewport:a}=o;if(a instanceof zn)return;const s=Kd(r,e);s?.length&&s.forEach((c,l)=>{const f=c.actor.getMapper().getInputData(),u=Ic(r,e),d=Ae.getImage(u[l]);f.modified(),o2(f,d)})})})}const Wue=function(t){const{segmentationId:e,modifiedSlicesToUse:r}=t.detail,{representationData:n}=Ut(e),i=ff(e),o=i.some(c=>{const{viewport:l}=xn(c);return l instanceof zn}),a=i.some(c=>{const{viewport:l}=xn(c);return l instanceof qn}),s=o&&a;i.forEach(c=>{const{viewport:l}=xn(c);l instanceof zn&&Bue({modifiedSlicesToUse:s?[]:r,representationData:n,type:yt.Labelmap}),l instanceof qn&&Gue({viewportIds:i,segmentationId:e})})},KP=function(t){const{segmentationId:e}=t.detail,{representationData:r}=Ut(e);r.Labelmap&&Wue(t),F2(e)},XP=function(t){const{segmentationId:e}=t.detail;F2(e)},$ue=function(t){if(!t)return;const e=Ce(t);if(!e)return;const{viewport:r}=e;r instanceof ir||(t.addEventListener(Ge.PRE_STACK_NEW_IMAGE,$h),t.addEventListener(Ge.IMAGE_RENDERED,$h))},zue=function(t){t.removeEventListener(Ge.PRE_STACK_NEW_IMAGE,$h),t.removeEventListener(Ge.IMAGE_RENDERED,$h)};function $h(t){const e=t.detail,{viewportId:r,renderingEngineId:n}=e,{viewport:i}=Ln(r,n),o=ho(r);if(!o?.length)return;const a=o.filter(l=>l.type===yt.Labelmap),s=i.getActors();a.forEach(l=>{const{segmentationId:f}=l;PP(r,f)});const c=a.flatMap(l=>Kd(r,l.segmentationId)).filter(l=>l!==void 0);c.length&&(c.forEach(l=>{a.find(u=>Ic(r,u.segmentationId)?.includes(l.referencedId))||i.removeActors([l.uid])}),a.forEach(l=>{const{segmentationId:f}=l,u=i.getCurrentImageId(),d=Ic(r,f);if(!d)return;let h=!1;const g=p=>{const m=Ae.getImage(p);if(!m){console.warn("No derived image found in the cache for segmentation representation",l);return}const w=s.find(v=>v.referencedId===p);if(w){const v=w.actor.getMapper().getInputData();v.setDerivedImage?v.setDerivedImage(m):o2(v,m)}else{const{dimensions:v,spacing:y,direction:C}=i.getImageDataMetadata(m),x=Ae.getImage(u)||{imageId:u},{origin:T}=i.getImageDataMetadata(x),S=T,_=m.voxelManager.getConstructor(),E=m.voxelManager.getScalarData(),D=Tt.newInstance({name:"Pixels",numberOfComponents:1,values:new _(E)}),b=dg.newInstance();b.setDimensions(v[0],v[1],1),b.setSpacing(y),b.setDirection(C),b.setOrigin(S),b.getPointData().setScalars(D),b.modified(),i.addImages([{imageId:p,representationUID:`${f}-${yt.Labelmap}-${m.imageId}`,callback:({imageActor:I})=>{I.getMapper().setInputData(b)}}]),h=!0;return}};d.forEach(g),h&&q0(r),i.render(),t.type===Ge.IMAGE_RENDERED&&i.element.removeEventListener(Ge.IMAGE_RENDERED,$h)}))}const qP={enable:$ue,disable:zue};async function jue(t){const e=t.detail.annotation;if(!z0(e))return;const r=Kue(e),n=Xue(r,e);if(!n.length){Xe(ke,V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:r.element,sourceAnnotation:e});return}const i=ko(e.data.contour.polyline,r),o=tP(r,i,n);if(!o.length){Xe(ke,V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:r.element,sourceAnnotation:e});return}if(o.length>1){nP(r,e,i,o);return}const{targetAnnotation:a,targetPolyline:s,isContourHole:c}=o[0];if(c){const{contourHoleProcessingEnabled:l=!1}=t.detail;if(!l)return;D2(r,a,e)}else Xx(r,a,s,e,i)}function Hue(t,e=!1){const r="PlanarFreehandContourSegmentationTool",n=lr(t.id,t.renderingEngineId);let i;return n?n.hasTool(r)?n.getToolOptions(r)||(i=`Tool ${r} must be in active/passive state in ${n.id} toolGroup`):i=`Tool ${r} not added to ${n.id} toolGroup`:i=`ToolGroup not found for viewport ${t.id}`,i&&!e&&console.warn(i),!i}function Kue(t){const e=Qx(t);return e.find(n=>Hue(n,!0))??e[0]}function Xue(t,e){const{annotationUID:r}=e;return U0().filter(i=>i.annotationUID&&i.annotationUID!==r&&z0(i)&&hO(i,e)&&t.isReferenceViewable(i.metadata))}function que(t){const e=t.detail.annotation;Na(e)}function YP(t){const e=t.detail.annotation;z0(e)&&jue(t)}function v1(t){if(!t.detail.removed.length)return;Bi().forEach(n=>{const o=n.getViewports().map(a=>a.id);Me(o)})}function JP(t){const{viewportId:e}=t.detail;Me([e])}function ZP(t){const e=t.detail.annotation;z0(e)&&que(t)}const QP=function(t){$0(t.detail.element)},Yue=function(t){t.addEventListener(Ge.IMAGE_RENDERED,QP)},Jue=function(t){t.removeEventListener(Ge.IMAGE_RENDERED,QP)},eR={enable:Yue,disable:Jue},{Active:Zue}=_n;function Y0(t,e,r){if(Ue.isInteractingWithTool)return!1;const{renderingEngineId:n,viewportId:i}=r.detail,o=lr(i,n);if(!o)return!1;let a;const s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l],u=o.getToolInstance(l);if(f.mode===Zue&&typeof u[e]=="function"){a=o.getToolInstance(l);break}}a&&a[e](r)}const tR=Y0.bind(null,"Mouse","mouseClickCallback"),nR=Y0.bind(null,"Mouse","doubleClickCallback");function rR(t,e,r,n="mouse"){const i=n==="touch"?36:6,o=[];return e.forEach(({tool:a,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const l=a.getHandleNearImagePoint(t,c,r,i);if(l){o.push({tool:a,annotation:c,handle:l});break}}}),o}function Vg(t,e){const r=[];for(let n=0;n<e.length;n++){const i=e[n];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let o=$t(i.constructor.toolName,t);o?.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(o=i.filterInteractableAnnotationsForElement(t,o)),o?.length>0&&r.push({tool:i,annotations:o}))}return r}function m3(t,e,r,n="mouse"){const i=n==="touch"?36:6,o=[];return e.forEach(({tool:a,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(a.isPointNearTool(t,c,r,i,n)){o.push({tool:a,annotation:c});break}}}),o}const{Active:Que}=_n;function U2(t){const{renderingEngineId:e,viewportId:r,event:n}=t.detail,i=H0(n)||G0.getModifierKey(),o=lr(r,e);if(!o)return null;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary(),c=t.detail.buttons??n?.buttons??s;for(let l=0;l<a.length;l++){const f=a[l],u=o.toolOptions[f],d=u.bindings.length&&u.bindings.some(h=>h.mouseButton===c&&h.modifierKey===i);if(u.mode===Que&&d)return o.getToolInstance(f)}}function b0(t,e,r){const{renderingEngineId:n,viewportId:i}=t.detail,o=lr(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l],u=r!=null&&f.bindings.length&&f.bindings.some(d=>d.mouseButton===r);if(e.includes(f.mode)&&(!r||u)){const d=o.getToolInstance(l);a.push(d)}}return a}function efe(t,e){const r=new Map,{renderingEngineId:n,viewportId:i}=t.detail,o=lr(i,n);if(!o)return r;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary(),c=t.detail.event,l=c?.buttons??s,f=H0(c)||G0.getModifierKey();for(let u=0;u<a.length;u++){const d=a[u],h=o.getToolInstance(d),g=h.configuration?.actions??{},p=Object.values(g);if(!p?.length||!e.includes(h.mode))continue;const m=p.find(w=>w.bindings?.length&&w.bindings.some(v=>v.mouseButton===l&&v.modifierKey===f));m&&r.set(h,m)}return r}const{Active:tfe,Passive:nfe}=_n;function rfe(t){if(Ue.isInteractingWithTool)return!1;const e=t.detail,{element:r}=e,n=Ce(r),{canvas:i}=e.currentPoints;if(!n)return!1;const o=efe(t,[tfe,nfe]),a=Array.from(o.keys()),s=Vg(r,a),c=m3(r,s,i);if(c.length>0){const{tool:l,annotation:f}=c[0],u=o.get(l);return(typeof u.method=="string"?l[u.method]:u.method).call(l,t,f),!0}return!1}const{Active:ife,Passive:ofe}=_n;function iR(t){if(Ue.isInteractingWithTool)return;const e=U2(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const r=t.detail.event.buttons===1,n=b0(t,[ife],t.detail.event.buttons),i=r?b0(t,[ofe]):void 0,o=[...n||[],...i||[]];if(rfe(t))return;const s=t.detail,{element:c}=s,l=Vg(c,o),f=s.currentPoints.canvas,u=rR(c,l,f,"mouse"),d=!!t.detail.event.shiftKey;if(u.length>0){const{tool:g,annotation:p,handle:m}=n4(u);r4(p.annotationUID,d),g.handleSelectedCallback(t,p,m,"Mouse");return}const h=m3(c,l,f,"mouse");if(h.length>0){const{tool:g,annotation:p}=n4(h);r4(p.annotationUID,d),g.toolSelectedCallback(t,p,"Mouse",f);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function n4(t){if(t.length>1){const e=t.find(r=>{const n=!pr(r.annotation.annotationUID),i=mr(r.annotation.annotationUID);return n&&i});if(e)return e}return t[0]}function r4(t,e=!1){e?Dg(t)?ia(t,!1):ia(t,!0,!0):ia(t,!0,!1)}function oR(t){if(Ue.isInteractingWithTool)return;const e=U2(t);if(e&&!Ue.isMultiPartToolActive&&e.addNewAnnotation){const r=e.addNewAnnotation(t,"mouse");ia(r.annotationUID)}}function aR(t){if(Ue.isInteractingWithTool)return;const e=U2(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:afe,Passive:sfe}=_n;function sR(t){if(Ue.isInteractingWithTool||Ue.isMultiPartToolActive)return;const e=b0(t,[afe,sfe]),r=t.detail,{element:n}=r,i=Vg(n,e),o=e.filter(s=>!i.some(l=>l.tool.getToolName()===s.getToolName()));let a=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(a=s.mouseMoveCallback(t,c)||a);o.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),a===!0&&$0(n)}const cR=Y0.bind(null,"Mouse","mouseUpCallback");function lR(t){if(Ue.isInteractingWithTool)return;t.detail.buttons=Ss.Wheel|(t.detail.event.buttons||0);const e=U2(t);if(e)return e.mouseWheelCallback(t)}const cfe=function(t){t.addEventListener(V.MOUSE_CLICK,tR),t.addEventListener(V.MOUSE_DOWN,iR),t.addEventListener(V.MOUSE_DOWN_ACTIVATE,oR),t.addEventListener(V.MOUSE_DOUBLE_CLICK,nR),t.addEventListener(V.MOUSE_DRAG,aR),t.addEventListener(V.MOUSE_MOVE,sR),t.addEventListener(V.MOUSE_UP,cR),t.addEventListener(V.MOUSE_WHEEL,lR)},lfe=function(t){t.removeEventListener(V.MOUSE_CLICK,tR),t.removeEventListener(V.MOUSE_DOWN,iR),t.removeEventListener(V.MOUSE_DOWN_ACTIVATE,oR),t.removeEventListener(V.MOUSE_DOUBLE_CLICK,nR),t.removeEventListener(V.MOUSE_DRAG,aR),t.removeEventListener(V.MOUSE_MOVE,sR),t.removeEventListener(V.MOUSE_UP,cR),t.removeEventListener(V.MOUSE_WHEEL,lR)},uR={enable:cfe,disable:lfe},{Active:ufe}=_n;function fR(t){const{renderingEngineId:e,viewportId:r}=t.detail,n=Iie(),i=G0.getModifierKey(),o=lr(r,e);if(!o)return null;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary();for(let c=0;c<a.length;c++){const l=a[c],f=o.toolOptions[l];if(f.mode!==ufe)continue;if(f.bindings.length&&f.bindings.some(d=>d.mouseButton===(n??s)&&d.modifierKey===i))return o.getToolInstance(l)}}function ffe(t,e){const r=new Map,{renderingEngineId:n,viewportId:i}=t.detail,o=lr(i,n);if(!o)return r;const a=Object.keys(o.toolOptions),s=t.detail.key;for(let c=0;c<a.length;c++){const l=a[c],f=o.getToolInstance(l),u=f.configuration?.actions;if(!u)continue;const d=Object.values(u);if(!d?.length||!e.includes(f.mode))continue;const h=d.find(g=>g.bindings?.some(p=>p.key===s));h&&r.set(f,h)}return r}function dR(t){const e=fR(t);if(e){const{renderingEngineId:n,viewportId:i}=t.detail,o=lr(i,n),a=e.getToolName();Object.keys(o.toolOptions).includes(a)&&o.setViewportsCursorByToolName(a)}const r=ffe(t,[_n.Active]);if(r?.size){const{element:n}=t.detail;for(const[i,o]of[...r.entries()])(typeof o.method=="function"?o.method:i[o.method]).call(i,n,o,t)}}function hR(t){const e=fR(t);if(!e)return;const{renderingEngineId:r,viewportId:n}=t.detail,i=lr(n,r);oO();const o=e.getToolName();Object.keys(i.toolOptions).includes(o)&&i.setViewportsCursorByToolName(o)}const dfe=function(t){t.addEventListener(V.KEY_DOWN,dR),t.addEventListener(V.KEY_UP,hR)},hfe=function(t){t.removeEventListener(V.KEY_DOWN,dR),t.removeEventListener(V.KEY_UP,hR)},gR={enable:dfe,disable:hfe},{Active:gfe,Passive:pfe,Enabled:mfe}=_n,pR=function(t){b0(t,[gfe,pfe,mfe]).forEach(r=>{r.onCameraModified&&r.onCameraModified(t)})},vfe=function(t){t.addEventListener(Ge.CAMERA_MODIFIED,pR)},yfe=function(t){t.removeEventListener(Ge.CAMERA_MODIFIED,pR)},mR={enable:vfe,disable:yfe},{Active:wfe,Passive:Cfe,Enabled:xfe}=_n,vR=function(t){b0(t,[wfe,Cfe,xfe]).forEach(r=>{r.onImageSpacingCalibrated&&r.onImageSpacingCalibrated(t)})},Tfe=function(t){t.addEventListener(Ge.IMAGE_SPACING_CALIBRATED,vR)},Sfe=function(t){t.removeEventListener(Ge.IMAGE_SPACING_CALIBRATED,vR)},yR={enable:Tfe,disable:Sfe},{Active:_fe}=_n;function v3(t){const{renderingEngineId:e,viewportId:r}=t.detail,n=t.detail.event,i=lr(r,e);if(!i)return null;const o=Object.keys(i.toolOptions),a=Object.keys(n.touches).length,s=H0(n)||G0.getModifierKey(),c=i.getDefaultMousePrimary();for(let l=0;l<o.length;l++){const f=o[l],u=i.toolOptions[f],d=u.bindings.length&&u.bindings.some(h=>(h.numTouchPoints===a||a===1&&h.mouseButton===c)&&h.modifierKey===s);if(u.mode===_fe&&d)return i.getToolInstance(f)}}function i4(t,e,r){const{renderingEngineId:n,viewportId:i}=t.detail,o=lr(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l],u=r!=null&&f.bindings.length&&f.bindings.some(d=>d.numTouchPoints===r);if(e.includes(f.mode)&&(!r||u)){const d=o.getToolInstance(l);a.push(d)}}return a}const{Active:Efe,Passive:bfe}=_n;function wR(t){if(Ue.isInteractingWithTool)return;const e=v3(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const r=Object.keys(t.detail.event.touches).length===1,n=i4(t,[Efe],Object.keys(t.detail.event.touches).length),i=r?i4(t,[bfe]):void 0,o=[...n||[],...i||[],e],a=t.detail,{element:s}=a,c=Vg(s,o),l=a.currentPoints.canvas,f=rR(s,c,l,"touch"),u=!1;if(f.length>0){const{tool:h,annotation:g,handle:p}=o4(f);a4(g.annotationUID,u),h.handleSelectedCallback(t,g,p,"Touch");return}const d=m3(s,c,l,"touch");if(d.length>0){const{tool:h,annotation:g}=o4(d);a4(g.annotationUID,u),h.toolSelectedCallback(t,g,"Touch",l);return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function o4(t){return t.length>1&&t.find(e=>!pr(e.annotation.annotationUID)&&mr(e.annotation.annotationUID))||t[0]}function a4(t,e=!1){e?Dg(t)?ia(t,!1):ia(t,!0,!0):ia(t,!0,!1)}function CR(t){if(Ue.isInteractingWithTool)return;const e=v3(t);if(e&&!Ue.isMultiPartToolActive&&e.addNewAnnotation){const r=e.addNewAnnotation(t,"touch");ia(r.annotationUID)}}function xR(t){if(Ue.isInteractingWithTool)return;const e=v3(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const TR=Y0.bind(null,"Touch","touchEndCallback"),Dfe=Y0.bind(null,"Touch","touchTapCallback"),SR=Y0.bind(null,"Touch","touchPressCallback"),Ife=function(t){t.addEventListener(V.TOUCH_START,wR),t.addEventListener(V.TOUCH_START_ACTIVATE,CR),t.addEventListener(V.TOUCH_DRAG,xR),t.addEventListener(V.TOUCH_END,TR),t.addEventListener(V.TOUCH_TAP,Dfe),t.addEventListener(V.TOUCH_PRESS,SR)},Mfe=function(t){t.removeEventListener(V.TOUCH_START,wR),t.removeEventListener(V.TOUCH_START_ACTIVATE,CR),t.removeEventListener(V.TOUCH_DRAG,xR),t.removeEventListener(V.TOUCH_END,TR),t.removeEventListener(V.TOUCH_PRESS,SR)},_R={enable:Ife,disable:Mfe},Ofe=function(){ke.addEventListener(V.ANNOTATION_COMPLETED,sa.handleAnnotationCompleted),ke.addEventListener(V.ANNOTATION_MODIFIED,sa.handleAnnotationUpdate),ke.addEventListener(V.ANNOTATION_REMOVED,sa.handleAnnotationDelete)},Pfe=function(){ke.removeEventListener(V.ANNOTATION_COMPLETED,sa.handleAnnotationCompleted),ke.removeEventListener(V.ANNOTATION_MODIFIED,sa.handleAnnotationUpdate),ke.removeEventListener(V.ANNOTATION_REMOVED,sa.handleAnnotationDelete)},ER={enable:Ofe,disable:Pfe},{Active:Rfe,Passive:Afe,Enabled:Lfe}=_n,bR=function(t){b0(t,[Rfe,Afe,Lfe]).forEach(r=>{r.onResetCamera&&r.onResetCamera(t)})},Nfe=function(t){t.addEventListener(Ge.CAMERA_RESET,bR)},Vfe=function(t){t.removeEventListener(Ge.CAMERA_RESET,bR)},DR={enable:Nfe,disable:Vfe};function y3(t){const{element:e,viewportId:r}=t.detail,n=kfe(r);Ffe(e),Ufe(n,e),Kx.addViewportElement(r,e),FM.enable(e),rO.enable(e),eO.enable(e),G0.enable(e),qP.enable(e),eR.enable(e),mR.enable(e),yR.enable(e),DR.enable(e),uR.enable(e),gR.enable(e),_R.enable(e),Ue.enabledElements.push(e)}function kfe(t){const e="http://www.w3.org/2000/svg",r=document.createElementNS(e,"svg"),n=`svg-layer-${t}`;r.classList.add("svg-layer"),r.setAttribute("id",n),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.style.width="100%",r.style.height="100%",r.style.pointerEvents="none",r.style.position="absolute";const i=document.createElementNS(e,"defs"),o=document.createElementNS(e,"filter"),a=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return o.setAttribute("id",`shadow-${n}`),o.setAttribute("filterUnits","userSpaceOnUse"),a.setAttribute("result","offOut"),a.setAttribute("in","SourceGraphic"),a.setAttribute("dx","0.5"),a.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),o.appendChild(a),o.appendChild(s),o.appendChild(c),i.appendChild(o),r.appendChild(i),r}function Ffe(t){const{viewportUid:e,renderingEngineUid:r}=t.dataset,n=`${e}:${r}`;Ue.svgNodeCache[n]={}}function Ufe(t,e){e.querySelector("div.viewport-element").appendChild(t)}function IR(t,e){const r=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let n=0;n<Ue.synchronizers.length;n++){const i=Ue.synchronizers[n],o=!i.isDisabled(),a=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);o&&(a||s)&&r.push(i)}return r}const Bfe="viewport-element";function w3(t){const{element:e,viewportId:r}=t.detail;$fe(e),zfe(e),Kx.removeViewportElement(r,e),FM.disable(e),rO.disable(e),eO.disable(e),G0.disable(e),qP.disable(e),eR.disable(e),mR.disable(e),yR.disable(e),DR.disable(e),uR.disable(e),gR.disable(e),_R.disable(e),Gfe(e),Wfe(e),jfe(e)}const Gfe=t=>{const e=Ce(t);if(!e)return;IR(e.viewportId,e.renderingEngineId).forEach(n=>{n.remove(e)})},Wfe=t=>{const e=Ce(t);if(!e)return;const{renderingEngineId:r,viewportId:n}=e,i=lr(n,r);i&&i.removeViewports(r,n)};function $fe(t){const{viewportUid:e,renderingEngineUid:r}=t.dataset,n=`${e}:${r}`;delete Ue.svgNodeCache[n]}function zfe(t){const e=t.querySelector(`div.${Bfe}`),r=e.querySelector("svg");r&&e.removeChild(r)}const jfe=function(t){const e=Ue.enabledElements.findIndex(r=>r===t);e>-1&&Ue.enabledElements.splice(e,1)};function MR(t){const e=HO(t,[_n.Active,_n.Passive]),r=Vg(t,e);for(const{tool:n}of r){const i=n.cancel(t);if(i)return i}}class C3{constructor(e,r,n,i){this._viewportOptions={},this._onEvent=o=>{if(this._ignoreFiredEvents===!0||!this._targetViewports.length)return;const a=this._eventSource==="element"?Ce(o.currentTarget):xn(o.detail?.viewportId);if(!a)return;const{renderingEngineId:s,viewportId:c}=a;this._sourceViewports.find(l=>l.viewportId===c)&&this.fireEvent({renderingEngineId:s,viewportId:c},o)},this._enabled=!0,this._eventName=r,this._eventHandler=n,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this._options=i||{},this._eventSource=this._options.eventSource||"element",this._auxiliaryEvents=this._options.auxiliaryEvents||[],this.id=e}isDisabled(){return!this._enabled||!this._hasSourceElements()}setOptions(e,r={}){this._viewportOptions[e]=r}setEnabled(e){this._enabled=e}getOptions(e){return this._viewportOptions[e]}add(e){this.addTarget(e),this.addSource(e)}addSource(e){if(Dp(this._sourceViewports,e))return;const{renderingEngineId:r,viewportId:n}=e,i=Bn(r).getViewport(n);if(!i){console.warn(`Synchronizer.addSource: No viewport for ${r} ${n}`);return}(this._eventSource==="element"?i.element:ke).addEventListener(this._eventName,this._onEvent.bind(this)),this._auxiliaryEvents.forEach(({name:a,source:s})=>{(s==="element"?i.element:ke).addEventListener(a,this._onEvent.bind(this))}),this._updateDisableHandlers(),this._sourceViewports.push(e)}addTarget(e){Dp(this._targetViewports,e)||(this._targetViewports.push(e),this._updateDisableHandlers())}getSourceViewports(){return this._sourceViewports}getTargetViewports(){return this._targetViewports}destroy(){this._sourceViewports.forEach(e=>this.removeSource(e)),this._targetViewports.forEach(e=>this.removeTarget(e))}remove(e){this.removeTarget(e),this.removeSource(e)}removeSource(e){const r=s4(this._sourceViewports,e);if(r===-1)return;const n=this._eventSource==="element"?this.getViewportElement(e):ke;this._sourceViewports.splice(r,1),n.removeEventListener(this._eventName,this._eventHandler),this._auxiliaryEvents.forEach(({name:i,source:o})=>{(o==="element"?this.getViewportElement(e):ke).removeEventListener(i,this._eventHandler)}),this._updateDisableHandlers()}removeTarget(e){const r=s4(this._targetViewports,e);r!==-1&&(this._targetViewports.splice(r,1),this._updateDisableHandlers())}hasSourceViewport(e,r){return Dp(this._sourceViewports,{renderingEngineId:e,viewportId:r})}hasTargetViewport(e,r){return Dp(this._targetViewports,{renderingEngineId:e,viewportId:r})}fireEvent(e,r){if(this.isDisabled()||this._ignoreFiredEvents)return;this._ignoreFiredEvents=!0;const n=[];try{for(let i=0;i<this._targetViewports.length;i++){const o=this._targetViewports[i];if(e.viewportId===o.viewportId)continue;const s=this._eventHandler(this,e,o,r,this._options);s instanceof Promise&&n.push(s)}}catch(i){console.warn(`Synchronizer, for: ${this._eventName}`,i)}finally{n.length?Promise.allSettled(n).then(()=>{this._ignoreFiredEvents=!1}):this._ignoreFiredEvents=!1}}_hasSourceElements(){return this._sourceViewports.length!==0}_updateDisableHandlers(){const e=Hfe(this._sourceViewports,this._targetViewports),r=this.remove.bind(this),n=i=>{r(i.detail.element)};e.forEach(i=>{const o=this.getEventSource(i);o&&(o.removeEventListener(Ge.ELEMENT_DISABLED,n),o.addEventListener(Ge.ELEMENT_DISABLED,n))})}getEventSource(e){return this._eventSource==="element"?this.getViewportElement(e):ke}getViewportElement(e){const{renderingEngineId:r,viewportId:n}=e,i=Bn(r);if(!i)return null;const o=i.getViewport(n);return o?o.element:null}}function Hfe(t,e){const r=[],n=t.concat(e);for(let i=0;i<n.length;i++){const o=n[i];r.some(a=>o.renderingEngineId===a.renderingEngineId&&o.viewportId===a.viewportId)||r.push(o)}return r}function s4(t,e){return t.findIndex(r=>e.renderingEngineId===r.renderingEngineId&&e.viewportId===r.viewportId)}function Dp(t,e){return t.some(r=>r.renderingEngineId===e.renderingEngineId&&r.viewportId===e.viewportId)}function gf(t,e,r,n){if(Ue.synchronizers.some(a=>a.id===t))throw new Error(`Synchronizer with id '${t}' already exists.`);const o=new C3(t,e,r,n);return Ue.synchronizers.push(o),o}function Kfe(){for(;Ue.synchronizers.length>0;)Ue.synchronizers.pop().destroy()}function Xfe(t){return Ue.synchronizers.find(e=>e.id===t)}function qfe(){return Ue.synchronizers}function Yfe(t){const e=Ue.synchronizers.findIndex(r=>r.id===t);e>-1&&(Ue.synchronizers[e].destroy(),Ue.synchronizers.splice(e,1))}const OR=Object.freeze(Object.defineProperty({__proto__:null,createSynchronizer:gf,destroy:Kfe,destroySynchronizer:Yfe,getAllSynchronizers:qfe,getSynchronizer:Xfe,getSynchronizersForViewport:IR},Symbol.toStringTag,{value:"Module"})),Jfe=Object.freeze(Object.defineProperty({__proto__:null,Synchronizer:C3,SynchronizerManager:OR,ToolGroupManager:TM,addEnabledElement:y3,addTool:xx,cancelActiveManipulations:MR,hasTool:gie,removeEnabledElement:w3,removeTool:IM,get state(){return Ue},svgNodeCache:u2},Symbol.toStringTag,{value:"Module"})),y1=function(t){const{viewportId:e}=t.detail;q0(e)},PR=function(t){const{segmentationId:e}=t.detail;U0().filter(n=>e===n?.data?.segmentation?.segmentationId).forEach(n=>{kt(n.annotationUID)})};let z5=!1;function RR(t={}){z5||(poe(t),Qfe(),e0e(),z5=!0)}function Zfe(){AR(),LR(),CM(),Nre();const t=Ba(),e=An;t.restoreAnnotations({}),e.resetState(),z5=!1}function Qfe(){AR();const t=Ge.ELEMENT_ENABLED,e=Ge.ELEMENT_DISABLED;ke.addEventListener(t,y3),ke.addEventListener(e,w3),ER.enable()}function AR(){const t=Ge.ELEMENT_ENABLED,e=Ge.ELEMENT_DISABLED;ke.removeEventListener(t,y3),ke.removeEventListener(e,w3),ER.disable()}function e0e(){LR(),ke.addEventListener(V.ANNOTATION_COMPLETED,YP),ke.addEventListener(V.ANNOTATION_MODIFIED,JP),ke.addEventListener(V.ANNOTATION_SELECTION_CHANGE,v1),ke.addEventListener(V.ANNOTATION_SELECTION_CHANGE,v1),ke.addEventListener(V.ANNOTATION_REMOVED,ZP),ke.addEventListener(V.SEGMENTATION_MODIFIED,XP),ke.addEventListener(V.SEGMENTATION_DATA_MODIFIED,KP),ke.addEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,y1),ke.addEventListener(V.SEGMENTATION_REPRESENTATION_ADDED,y1),ke.addEventListener(V.SEGMENTATION_REMOVED,PR)}function LR(){ke.removeEventListener(V.ANNOTATION_COMPLETED,YP),ke.removeEventListener(V.ANNOTATION_MODIFIED,JP),ke.removeEventListener(V.ANNOTATION_SELECTION_CHANGE,v1),ke.removeEventListener(V.ANNOTATION_SELECTION_CHANGE,v1),ke.removeEventListener(V.ANNOTATION_REMOVED,ZP),ke.removeEventListener(V.SEGMENTATION_MODIFIED,XP),ke.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,KP),ke.removeEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,y1),ke.removeEventListener(V.SEGMENTATION_REPRESENTATION_ADDED,y1),ke.removeEventListener(V.SEGMENTATION_REMOVED,PR)}const t0e=Object.freeze(Object.defineProperty({__proto__:null,COLOR_LUT:p1},Symbol.toStringTag,{value:"Module"})),n0e="4.14.4";function r0e(t,e,r,n){const{camera:i}=n.detail,o=Bn(r.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const a=o.getViewport(r.viewportId);a.setCamera(i),a.render()}const{CAMERA_MODIFIED:i0e}=Ge;function o0e(t){return gf(t,i0e,r0e)}function a0e(t,e,r,n,i){const o=Bn(r.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const a=o.getViewport(r.viewportId),c=o.getViewport(e.viewportId).getViewPresentation(i);a.setViewPresentation(c),a.render()}const{CAMERA_MODIFIED:s0e}=Ge;function c0e(t,e){return gf(t,s0e,a0e,{viewPresentation:e})}function l0e(t,e,r,n,i){const o=n.detail,{volumeId:a,range:s,invertStateChanged:c,invert:l,colormap:f}=o,u=Bn(r.renderingEngineId);if(!u)throw new Error(`Rendering Engine does not exist: ${r.renderingEngineId}`);const d=u.getViewport(r.viewportId),h={voiRange:s};if(i?.syncInvertState&&c&&(h.invert=l),i?.syncColormap&&f&&(h.colormap=f),d instanceof ir)d._actors&&d._actors.size>1?d.setProperties(h,a):d.setProperties(h);else if(d instanceof qn)d.setProperties(h);else throw new Error("Viewport type not supported.");d.render()}function u0e(t,e){return e=Object.assign({syncInvertState:!0,syncColormap:!0},e),gf(t,Ge.VOI_MODIFIED,l0e,{auxiliaryEvents:[{name:Ge.COLORMAP_MODIFIED}],...e})}function f0e(t,e,r){const n=Bn(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=t.getOptions(r.viewportId),o=n.getViewport(r.viewportId),a=n.getViewport(e.viewportId);if(i?.syncZoom!==!1){const s=a.getZoom();o.setZoom(s)}if(i?.syncPan!==!1){const s=a.getPan();o.setPan(s)}o.render()}const{CAMERA_MODIFIED:d0e}=Ge;function h0e(t){return gf(t,d0e,f0e)}function g0e(t,e){const{viewPlaneNormal:r}=t.getCamera(),{viewPlaneNormal:n}=e.getCamera(),i=ft(r,n);return Math.abs(i)>.9}const c4=(t,e)=>Oh.get("spatialRegistrationModule",t,e);async function NR(t,e,r){const n=Bn(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=n.getViewport(e.viewportId),o=t.getOptions(r.viewportId);if(o?.disabled)return;const a=n.getViewport(r.viewportId),s=i.getCurrentImageId(),l=ut("imagePlaneModule",s).imagePositionPatient,f=a.getImageIds();if(!g0e(i,a))return;let u=c4(r.viewportId,e.viewportId);if(!u){const p=i.getFrameOfReferenceUID(),m=a.getFrameOfReferenceUID();if(p===m&&o?.useInitialPosition!==!1?u=_t(Ti()):(P7(i,a),u=c4(r.viewportId,e.viewportId)),!u)return}const d=Pt(Ie(),l,u),h=p0e(d,f);let g=h.index;a instanceof zn&&(g=f.length-h.index-1),h.index!==-1&&a.getCurrentImageIdIndex()!==h.index&&await ux(a.element,{imageIndex:g})}function p0e(t,e){return e.reduce((r,n,i)=>{const{imagePositionPatient:o}=ut("imagePlaneModule",n),a=Nr(o,t);return a<r.distance?{distance:a,index:i}:r},{distance:1/0,index:-1})}const{STACK_NEW_IMAGE:m0e,VOLUME_NEW_IMAGE:sye}=Ge;function VR(t){return gf(t,m0e,NR,{auxiliaryEvents:[{name:"VOLUME_NEW_IMAGE"}]})}function v0e(t,e,r){const n=Bn(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=n.getViewport(r.viewportId),a=n.getViewport(e.viewportId).getSlabThickness?.();a&&(i.setSlabThickness?.(a),i.render())}const{CAMERA_MODIFIED:y0e}=Ge;function w0e(t){return gf(t,y0e,v0e)}const C0e=VR,x0e=Object.freeze(Object.defineProperty({__proto__:null,createCameraPositionSynchronizer:o0e,createImageSliceSynchronizer:VR,createPresentationViewSynchronizer:c0e,createSlabThicknessSynchronizer:w0e,createStackImageSynchronizer:C0e,createVOISynchronizer:u0e,createZoomPanSynchronizer:h0e,imageSliceSyncCallback:NR},Symbol.toStringTag,{value:"Module"}));function T0e(t,e,r=5){const n=Ce(t);if(!n)throw new Error("getAnnotationNearPoint: enabledElement not found");return kR(n,e,r)}function kR(t,e,r){const{renderingEngineId:n,viewportId:i}=t,o=lr(i,n);if(!o)return null;const{_toolInstances:a}=o;for(const s in a){const c=S0e(a[s],t,e,r);if(c)return c}return null}function S0e(t,e,r,n){const{viewport:i}=e,o=$t(t.constructor.toolName,i?.element),a=i?.getCurrentImageId?.();if(o?.length){const{element:s}=e.viewport;for(const c of o){const l=c.metadata?.referencedImageId;if(!(a&&l&&a!==l||!t.isPointNearTool)&&(t.isPointNearTool(s,c,r,n,"")||t.getHandleNearImagePoint(s,c,r,n)))return c}}return null}const{calibratedPixelSpacingMetadataProvider:_0e}=gn;function E0e(t,e,r){typeof r=="number"&&(r={type:xa.USER,scale:r}),_0e.add(t,r),e.getStackViewports().forEach(i=>{i.getImageIds().includes(t)&&i.calibrateSpacing(t)})}function FR(t,e){const r=t.findIndex(([n,i])=>n===i);if(r===-1)throw new Error("3D bounding boxes not supported in an oblique plane");return t[r][0]-=e,t[r][1]+=e,t}const b0e=Object.freeze(Object.defineProperty({__proto__:null,extend2DBoundingBoxInViewAxis:FR,getBoundingBoxAroundShape:Rl,getBoundingBoxAroundShapeIJK:Rl,getBoundingBoxAroundShapeWorld:qie},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:fy}=gn;function UR(t,e,r){const[n,i]=t,o=mt((n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2),a=Nr(n,i)/2,{boundsIJK:s,topLeftWorld:c,bottomRightWorld:l}=I0e(e,r,t,o,a);return{boundsIJK:s,centerWorld:o,radiusWorld:a,topLeftWorld:c,bottomRightWorld:l}}function BR(t,e){const r=e.getDirection(),n=mt(r[0],r[1],r[2]),i=mt(r[3],r[4],r[5]),o=mt(r[6],r[7],r[8]),a=Oa(Ie(),o);return UR(t,e,{row:n,column:i,normal:a})}function D0e(t,e,r){if(!r)throw new Error("viewport is required in order to calculate the sphere bounds");const n=r.getCamera(),i=mt(n.viewUp[0],n.viewUp[1],n.viewUp[2]),o=mt(n.viewPlaneNormal[0],n.viewPlaneNormal[1],n.viewPlaneNormal[2]),a=Ie();nn(a,i,o);const s={row:a,normal:o,column:Oa(Ie(),i)};return UR(t,e,s)}function I0e(t,e,r,n,i){const o=t.getDimensions(),{row:a,column:s,normal:c}=e,l=Ie(),f=Ie();tn(l,n,c,i),tn(f,n,c,-i),tn(l,l,s,-i),tn(f,f,s,i),tn(l,l,a,-i),tn(f,f,a,i);const u=fy(t,l),d=fy(t,f),h=r.map(p=>fy(t,p));return{boundsIJK:Rl([u,d,...h],o),topLeftWorld:l,bottomRightWorld:f}}function GR(t,e=5){return parseFloat(t[0]).toFixed(e)+","+parseFloat(t[1]).toFixed(e)+","+parseFloat(t[2]).toFixed(e)+","}class M0e{static setStartRange(e,r,n=e.getCurrentImageIdIndex()){this.setRange(e,r,n)}static setEndRange(e,r,n=e.getCurrentImageIdIndex()){this.setRange(e,r,void 0,n)}static setRange(e,r,n,i){const{metadata:o}=r;n===void 0&&(n=o.sliceIndex<i?o.sliceIndex:0,i===void 0&&(i=e.getNumberOfSlices()-1));const a=e.getSliceIndexForImage(o.multiSliceReference);i===void 0&&(i=a>=n?a:e.getNumberOfSlices()-1),i=Math.max(n,i),o.sliceIndex=Math.min(n,i),o.referencedImageId=e.getCurrentImageId(o.sliceIndex),o.referencedImageURI=void 0,i===o.sliceIndex?o.multiSliceReference=void 0:i!==o.multiSliceReference?.sliceIndex&&(o.multiSliceReference={referencedImageId:e.getCurrentImageId(i),sliceIndex:i});const s={viewportId:e.id,renderingEngineId:e.renderingEngineId,changeType:Nt.MetadataReferenceModified,annotation:r};Xe(ke,V.ANNOTATION_MODIFIED,s),this.setViewportFrameRange(e,o)}static setSingle(e,r,n=e.getCurrentImageIdIndex()){this.setRange(e,r,n,n)}static getFrameRange(e){const{metadata:r}=e,{sliceIndex:n,multiSliceReference:i}=r,o=i?.sliceIndex;return o?[n+1,o+1]:n+1}static getFrameRangeStr(e){const r=this.getFrameRange(e);return Array.isArray(r)?`${r[0]}-${r[1]}`:String(r)}static setViewportFrameRange(e,r){e.setFrameRange&&r.multiSliceReference?.sliceIndex&&e.setFrameRange(r.sliceIndex+1,r.multiSliceReference.sliceIndex+1)}}function WR(t,e,r){const{imageData:n}=t,{overwrite:i,boundsIJK:o,segmentationId:a}=r;if(!a)throw new Error("Segmentation ID is required to be passed inside thresholdVolumeByRange as options");const s=r?.overlapType||0,c=t.voxelManager,l=t.voxelManager.getScalarDataLength();if(i)for(let y=0;y<l;y++)c.setAtIndex(y,0);const{baseVolumeIdx:f,volumeInfoList:u}=cO(t,e);let d,h,g;const p=(y,C,x)=>{const T=({value:M})=>{h=h+1,M>=g.lower&&M<=g.upper&&(d=d+1)},{imageData:S,dimensions:_,lower:E,upper:D}=y,b=Ex(S,_,C,x);h=0,d=0,g={lower:E,upper:D};let I=!1;const{voxelManager:O}=S.get("voxelManager");return O.forEach(T,{imageData:S,boundsIJK:b}),s===0?I=d>0:s==1&&(I=d===h),I},m=(y,C)=>{const{imageData:x,lower:T,upper:S}=y,_=x.get("voxelManager").voxelManager,E=_.toIndex(C),D=_.getAtIndex(E);return!(D<=T||D>=S)},w=({index:y,pointIJK:C,pointLPS:x})=>{let T=u.length>0;for(let S=0;S<u.length&&(u[S].volumeSize===l?T=m(u[S],C):T=p(u[S],u[f].spacing,x),!!T);S++);T&&c.setAtIndex(y,r.segmentIndex||1)};return t.voxelManager.forEach(w,{imageData:n,boundsIJK:o}),ui(r.segmentationId),t}const{transformWorldToIndex:l4}=gn,$f=class $f extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:O0e,statsCalculator:_s}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const f=this.constructor.createAnnotationForViewport(l,{data:{handles:{points:[[...s],[...s],[...s],[...s]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}}});Ft(f,a);const u=vt(a,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:u,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(u),f},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=c.worldToCanvas(f[0]),d=c.worldToCanvas(f[3]),h=this._getRectangleImageCoordinates([u,d]),g=[o[0],o[1]],{left:p,top:m,width:w,height:v}=h;return zx([p,m,w,v],g)<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;o.worldPosition?l=!0:f=c.handles.points.findIndex(g=>g===o);const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),St(s);const d=Ce(s),{renderingEngine:h}=d;Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o),this.doneEditMemo(),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a))},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world,{points:g}=u.handles;g.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:d}=i,h=Ce(o),{worldToCanvas:g,canvasToWorld:p}=h.viewport,m=d.world,{points:w}=u.handles;w[c]=[...m];let v,y,C,x,T,S,_,E;switch(c){case 0:case 3:v=g(w[0]),x=g(w[3]),y=[x[0],v[1]],C=[v[0],x[1]],S=p(y),_=p(C),w[1]=S,w[2]=_;break;case 1:case 2:y=g(w[1]),C=g(w[2]),v=[C[0],y[1]],x=[y[0],C[1]],T=p(v),E=p(x),w[0]=T,w[3]=E;break}a.invalidated=!0}this.editData.hasMoved=!0,Ce(o),Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles,v=m.map(j=>a.worldToCanvas(j));u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),{viewPlaneNormal:T,viewUp:S}=a.getCamera();if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(h,T,S,f,n);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,T,S,f,n),a instanceof zn)){const{referencedImageId:j}=h.metadata;for(const J in p.cachedStats)J.startsWith("imageId")&&f.getStackViewports().find(ae=>{const de=cr(j),we=ae.hasImageURI(de),_e=cr(ae.getCurrentImageId());return we&&_e!==de})&&delete p.cachedStats[J]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let _;if(!mr(g))continue;!pr(g)&&!this.editData&&w!==null&&w!==void 0&&(_=[v[w]]);const E=!!Gi("showHandlesAlways",{});(_||E)&&Wn(i,g,"0",E?v:_,{color:y});const D=`${g}-rect`;Hx(i,g,"0",v,{color:y,lineDash:x,lineWidth:C},D),o=!0;const I=this.getLinkedTextBoxStyle(u,h);if(!I.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const O=this.configuration.getTextLines(p,l);if(!O||O.length===0)continue;if(!p.handles.textBox.hasMoved){const j=po(v);p.handles.textBox.worldPosition=a.canvasToWorld(j)}const M=a.worldToCanvas(p.handles.textBox.worldPosition),A=Ei(i,g,"1",O,M,v,{},I),{x:B,y:k,width:L,height:F}=A;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([B,k]),topRight:a.canvasToWorld([B+L,k]),bottomLeft:a.canvasToWorld([B,k+F]),bottomRight:a.canvasToWorld([B+L,k+F])}}return o},this._getRectangleImageCoordinates=n=>{const[i,o]=n;return{left:Math.min(i[0],o[0]),top:Math.min(i[1],o[1]),width:Math.abs(i[0]-o[0]),height:Math.abs(i[1]-o[1])}},this._calculateCachedStats=(n,i,o,a,s)=>{if(!this.configuration.calculateStats)return;const{data:c}=n,{viewport:l}=s,{element:f}=l,u=c.handles.points[0],d=c.handles.points[3],{cachedStats:h}=c,g=Object.keys(h);for(let m=0;m<g.length;m++){const w=g[m],v=this.getTargetImageData(w);if(!v)continue;const{dimensions:y,imageData:C,metadata:x,voxelManager:T}=v,S=l4(C,u);S[0]=Math.floor(S[0]),S[1]=Math.floor(S[1]),S[2]=Math.floor(S[2]);const _=l4(C,d);if(_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]),this._isInsideVolume(S,_,y)){this.isHandleOutsideImage=!1;const E=Math.min(S[0],_[0]),D=Math.max(S[0],_[0]),b=Math.min(S[1],_[1]),I=Math.max(S[1],_[1]),O=Math.min(S[2],_[2]),M=Math.max(S[2],_[2]),R=[[E,D],[b,I],[O,M]],{worldWidth:A,worldHeight:B}=O2(i,o,u,d),k=[S,_],{scale:L,areaUnit:F}=Fo(v,k),j=Math.abs(A*B)/(L*L),J={isPreScaled:Pc(l,w),isSuvScaled:this.isSuvScaled(l,w,n.metadata.referencedImageId)},ie=Rc(x.Modality,n.metadata.referencedImageId,J);let fe;T&&(fe=T.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:R,imageData:C,returnPoints:this.configuration.storePointData}));const ae=this.configuration.statsCalculator.getStatistics();h[w]={Modality:x.Modality,area:j,mean:ae.mean?.value,stdDev:ae.stdDev?.value,max:ae.max?.value,min:ae.min?.value,statsArray:ae.array,pointsInShape:fe,areaUnit:F,modalityUnit:ie}}else this.isHandleOutsideImage=!0,h[w]={Modality:x.Modality}}const p=n.invalidated;return n.invalidated=!1,p&&Gt(n,f,Nt.StatsUpdated),h},this._isInsideVolume=(n,i,o)=>Or(n,o)&&Or(i,o),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}};$f.toolName="RectangleROI",$f.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=$f.hydrateBase($f,i,r,n),{toolInstance:f,...u}=n||{},d={annotationUID:n?.annotationUID||un(),data:{handles:{points:r,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(d,l.element),Me([l.id])};let zh=$f;function O0e(t,e){const r=t.cachedStats[e],{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c,min:l}=r;if(i==null)return;const f=[];return fr(n)&&f.push(`Area: ${Ht(n)} ${s}`),fr(i)&&f.push(`Mean: ${Ht(i)} ${c}`),fr(o)&&f.push(`Max: ${Ht(o)} ${c}`),fr(l)&&f.push(`Min: ${Ht(l)} ${c}`),fr(a)&&f.push(`Std Dev: ${Ht(a)} ${c}`),f}const{transformWorldToIndex:yd}=gn;class x3 extends zh{constructor(e={},r={configuration:{storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!0,getTextLines:P0e,statsCalculator:_s,showTextBox:!1,throttleTimeout:100}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u;let g,p,m;if(l instanceof qn)throw new Error("Stack Viewport Not implemented");{const S=this.getTargetId(l);m=Ms(S),p=Ae.getVolume(m),g=_c(p,s,d)}const w=Ll(p,d),v=this._getStartCoordinate(s,d),y=this._getEndCoordinate(s,w,d),C=l.getFrameOfReferenceUID(),x={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:c,viewUp:[...h],FrameOfReferenceUID:C,referencedImageId:g,toolName:this.getToolName(),volumeId:m,spacingInNormal:w},data:{label:"",startCoordinate:v,endCoordinate:y,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[g],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(x,p),Ft(x,a);const T=vt(a,this.getToolName());return this.editData={annotation:x,viewportIdsToRender:T,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(T),x},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const{metadata:u}=a,{enabledElement:d}=u;this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID);const h=this.getTargetId(d.viewport),g=Ae.getVolume(h.split(/volumeId:|\?/)[1]);this._computePointsInsideVolume(a,h,g,d),Me(s),c?En(a):Gt(a,o)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;let s=$t(this.getToolName(),a.element);if(!s?.length)return o;s=P2(s,a.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let l=0;l<s.length;l++){const f=s[l],{annotationUID:u,data:d,metadata:h}=f,{startCoordinate:g,endCoordinate:p}=d,{points:m,activeHandleIndex:w}=d.handles,{enabledElement:v}=h,y=m.map(F=>a.worldToCanvas(F));c.annotationUID=u;const C=this.getStyle("lineWidth",c,f),x=this.getStyle("lineDash",c,f),T=this.getStyle("color",c,f),S=a.getCamera().focalPoint,_=a.getCamera().viewPlaneNormal;let E=g,D=p;if(Array.isArray(g)){E=this._getCoordinateForViewplaneNormal(E,_);const F=this._getIndexOfCoordinatesForViewplaneNormal(_);d.handles.points.forEach(j=>{j[F]=E}),d.startCoordinate=E}Array.isArray(p)&&(D=this._getCoordinateForViewplaneNormal(D,_),d.endCoordinate=D,d.endCoordinate=D);const b=Cl(E),I=Cl(D),O=this._getCoordinateForViewplaneNormal(S,_),M=Cl(O);if(M<Math.min(b,I)||M>Math.max(b,I))continue;const R=v.viewport?.volumeIds.values();for(const F of R)f.invalidated&&f.metadata.volumeId===F&&this._throttledCalculateCachedStats(f,v);let A=!1;if((M===b||M===I)&&(A=!0),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let B;if(!mr(u))continue;!pr(u)&&!this.editData&&w!==null&&A&&(B=[y[w]]),B&&Wn(i,u,"0",B,{color:T});let k=x;if(A||(k=2),Og(i,u,"0",y[0],y[3],{color:T,lineDash:k,lineWidth:C}),o=!0,this.configuration.showTextBox){const F=this.getLinkedTextBoxStyle(c,f);if(!F.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const j=this.configuration.getTextLines(d,{metadata:h});if(!j||j.length===0)continue;if(!d.handles.textBox.hasMoved){const Te=po(y);d.handles.textBox.worldPosition=a.canvasToWorld(Te)}const J=a.worldToCanvas(d.handles.textBox.worldPosition),fe=Ei(i,u,"1",j,J,y,{},F),{x:ae,y:de,width:we,height:_e}=fe;d.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([ae,de]),topRight:a.canvasToWorld([ae+we,de]),bottomLeft:a.canvasToWorld([ae,de+_e]),bottomRight:a.canvasToWorld([ae+we,de+_e])}}}return o},this.configuration.calculatePointsInsideVolume?this._throttledCalculateCachedStats=$i(this._calculateCachedStatsTool,this.configuration.throttleTimeout,{trailing:!0}):this._throttledCalculateCachedStats=j0(this._calculateCachedStatsTool,this.configuration.throttleTimeout)}_computeProjectionPoints(e,r){const{data:n,metadata:i}=e,{viewPlaneNormal:o,spacingInNormal:a}=i,{imageData:s}=r,{startCoordinate:c,endCoordinate:l}=n,{points:f}=n.handles,u=yd(s,f[0]),d=yd(s,f[0]),h=Ie();s.indexToWorldVec3(u,h);const g=Ie();s.indexToWorldVec3(d,g);const p=this._getIndexOfCoordinatesForViewplaneNormal(o);p==2?(h[2]=c,g[2]=l):p==0?(h[0]=c,g[0]=l):p==1&&(h[1]=c,g[1]=l);const m=Ie();qt(m,g,h);const w=_r(m);At(m,m);const v=[];for(let y=0;y<w;y+=a)v.push(f.map(C=>{const x=Ie();return tn(x,C,m,y),Array.from(x)}));n.cachedStats.projectionPoints=v}_computePointsInsideVolume(e,r,n,i){const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:c}=a,{viewport:l}=i,f=o.cachedStats.projectionPoints,u=[[]],d=this.getTargetImageData(r),h=o.handles.points[0],g=o.handles.points[3],{worldWidth:p,worldHeight:m}=O2(s,c,h,g),w=Fo(d,o.habdles),v=Math.abs(p*m)/(w.scale*w.scale),y={isPreScaled:Pc(l,r),isSuvScaled:this.isSuvScaled(l,r,e.metadata.referencedImageId)},C=Rc(a.Modality,e.metadata.referencedImageId,y);for(let T=0;T<f.length;T++){if(!n)continue;const S=f[T][0],{dimensions:_,imageData:E,voxelManager:D}=n,b=yd(E,h),I=yd(E,S),O=this._getIndexOfCoordinatesForViewplaneNormal(s);b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]),b[O]=I[O];const M=yd(E,g);if(M[0]=Math.floor(M[0]),M[1]=Math.floor(M[1]),M[2]=Math.floor(M[2]),M[O]=I[O],this._isInsideVolume(b,M,_)){this.isHandleOutsideImage=!1;const R=Math.min(b[0],M[0]),A=Math.max(b[0],M[0]),B=Math.min(b[1],M[1]),k=Math.max(b[1],M[1]),L=Math.min(b[2],M[2]),F=Math.max(b[2],M[2]),j=[[R,A],[B,k],[L,F]],J=D.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:j,imageData:E,returnPoints:this.configuration.storePointData});u.push(J)}}const x=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=u,o.cachedStats.statistics={Modality:a.Modality,area:v,mean:x.mean?.value,stdDev:x.stdDev?.value,max:x.max?.value,statsArray:x.array,areaUnit:w.areaUnit,modalityUnit:C}}_calculateCachedStatsTool(e,r){const n=e.data,{viewport:i}=r,{cachedStats:o}=n,a=this.getTargetId(i),s=Ae.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this._computePointsInsideVolume(e,a,s,r),e.invalidated=!1,Gt(e,i.element),o}_getStartCoordinate(e,r){const n=e;return this._getCoordinateForViewplaneNormal(n,r)}_getEndCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=Ie();return tn(o,e,n,i*r),this._getCoordinateForViewplaneNormal(o,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const r=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return r.indexOf(Math.max(...r))}_getCoordinateForViewplaneNormal(e,r){const n=this._getIndexOfCoordinatesForViewplaneNormal(r);return e[n]}}function P0e(t,e={}){const r=t.cachedStats.statistics,{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Ht(n)} ${s}`),l.push(`Mean: ${Ht(i)} ${c}`),l.push(`Max: ${Ht(o)} ${c}`),l.push(`Std Dev: ${Ht(a)} ${c}`),l}x3.toolName="RectangleROIStartEndThreshold";class T3 extends zh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getTargetId(l);let p,m;if(l instanceof qn)p=g.split("imageId:")[1];else{m=Ms(g);const C=Ae.getVolume(m);p=_c(C,s,d)}const w=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:c,viewUp:[...h],FrameOfReferenceUID:w,referencedImageId:p,toolName:this.getToolName(),volumeId:m},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},segmentationId:null}};Ft(v,a);const y=vt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(y),v},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{points:g,activeHandleIndex:p}=h.handles,m=g.map(T=>a.worldToCanvas(T));l.annotationUID=d;const w=this.getStyle("lineWidth",l,u),v=this.getStyle("lineDash",l,u),y=this.getStyle("color",l,u);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;Gt(u,s);let C;if(!mr(d))continue;!pr(d)&&!this.editData&&p!==null&&(C=[m[p]]),C&&Wn(i,d,"0",C,{color:y}),Og(i,d,"0",m[0],m[3],{color:y,lineDash:v,lineWidth:w}),o=!0}return o}}}T3.toolName="RectangleROIThreshold";function $R(t,e,r={}){const n=[];return t.forEach(o=>{const{data:a}=o,{points:s}=a.handles,{imageData:c,dimensions:l}=e;let f=s;if(a.cachedStats?.projectionPoints){const{projectionPoints:h}=a.cachedStats;f=[].concat(...h)}const u=f.map(h=>Lr(c,h));let d=Rl(u,l);r.numSlicesToProject&&!a.cachedStats?.projectionPoints&&(d=FR(d,r.numSlicesToProject)),n.push(d)}),n.length===1?n[0]:n.reduce((o,a)=>({iMin:Math.min(o.iMin,a.iMin),jMin:Math.min(o.jMin,a.jMin),kMin:Math.min(o.kMin,a.kMin),iMax:Math.max(o.iMax,a.iMax),jMax:Math.max(o.jMax,a.jMax),kMax:Math.max(o.kMax,a.kMax)}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})}function R0e(t,e,r,n){const i=t.map(s=>Ra.getAnnotation(s));A0e(i);let o;for(let s=0;s<r.length;s++)(r[s].volume.voxelManager.getScalarDataLength()===e.voxelManager.getScalarDataLength()||s===0)&&(o=$R(i,r[s].volume,n));const a=WR(e,r,{...n,boundsIJK:o,segmentationId:n.segmentationId});return a.modified(),a}function A0e(t){const e=[T3.toolName,x3.toolName];for(const r of t){const n=r.metadata.toolName;if(!e.includes(n))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}function zR(t,e=1,r="mergedLabelmap"){t.forEach(({direction:l,dimensions:f,origin:u,spacing:d})=>{if(!Dt(f,t[0].dimensions)||!Dt(l,t[0].direction)||!Dt(d,t[0].spacing)||!Dt(u,t[0].origin))throw new Error("labelmaps must have the same size and shape")});const n=t[0],i=n.voxelManager.getConstructor(),o=new i(n.voxelManager.getScalarDataLength());t.forEach(l=>{const f=l.voxelManager,u=f.getScalarDataLength();for(let d=0;d<u;d++)f.getAtIndex(d)===e&&(o[d]=e)});const a={scalarData:o,metadata:n.metadata,spacing:n.spacing,origin:n.origin,direction:n.direction,dimensions:n.dimensions},s=Ae.getVolume(r);let c;return s?(c=s,c.voxelManager.setCompleteScalarDataArray(o)):c=mg(r,a),c}async function L0e(t){const{viewportId:e,renderingEngineId:r,options:n}=t;let{segmentationId:i}=t;const o=Ln(e,r);if(!o)throw new Error("element disabled");const{viewport:a}=o;if(!(a instanceof zn))throw new Error("Segmentation only supports VolumeViewport");const{uid:s}=a.getDefaultActor();if(i===void 0&&(i=`${s}-based-segmentation-${n?.volumeId??un().slice(0,8)}`),n){const c=structuredClone(n);await mg(i,c)}else{const c=a.getVolumeId();vg(c,{volumeId:i})}return i}function S3(t,e,r={}){const n=r.onFlood,i=r.onBoundary,o=r.equals,a=r.filter,s=r.diagonals||!1,c=x(e),l=T(),f=[],u=[],d=new Set,h=r.bounds;for(f.push({currentArgs:e});f.length>0;)g(f.pop());return{flooded:u};function g(_){const E=_.currentArgs,D=_.previousArgs;p(E)||(m(E),w(E)?(v(E),C(E)):y(D))}function p(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));return d.has(I)}function m(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));d.add(I)}function w(_){const E=x(_);return o?o(E,c):E===c}function v(_){u.push(_),n&&n(..._)}function y(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));h?.set(I,_),i&&i(..._)}function C(_){for(let E=0;E<l.length;E+=1){const D=l[E],b=_.slice(0);for(let I=0;I<_.length;I+=1)b[I]+=D[I];a?.(b)!==!1&&(p(b)||f.push({currentArgs:b,previousArgs:_}))}}function x(_){return t(..._)}function T(){return S(e.length).filter(function(E){const D=N0e(E);return D!==0&&(D===1||s)})}function S(_){const E=[],D=function(b){return b.split("").map(function(I){return parseInt(I,10)-1})};for(let b=0;b<Math.pow(3,_);b+=1){const I=V0e(b.toString(3),"0",_);E.push(D(I))}return E}}function N0e(t){let e=0;for(let r=0;r<t.length;r+=1)t[r]!==0&&(e+=1);return e}function V0e(t,e,r){return(new Array(r+1).join(e)+t).slice(-r)}const k0e={[ht.OnInteractionStart]:t=>{const{segmentIndex:e,previewSegmentIndex:r,segmentationVoxelManager:n,centerIJK:i,viewPlaneNormal:o,segmentationImageData:a,configuration:s}=t;if(!s?.useCenterSegmentIndex){t.centerSegmentIndexInfo.segmentIndex=null,t.centerSegmentIndexInfo.hasSegmentIndex=!1,t.centerSegmentIndexInfo.hasPreviewIndex=!1;return}let c=!1,l=!1;const f=[...n.getBoundsIJK()];Math.abs(o[0])>.8?f[0]=[i[0],i[0]]:Math.abs(o[1])>.8?f[1]=[i[1],i[1]]:Math.abs(o[2])>.8&&(f[2]=[i[2],i[2]]);const u=({value:h})=>{c||=h===e,l||=h===r};if(n.forEach(u,{imageData:a,isInObject:t.isInObject,boundsIJK:f}),!c&&!l){t.centerSegmentIndexInfo.segmentIndex=null;return}const d=n.getAtIJKPoint(i);t.centerSegmentIndexInfo.segmentIndex=d,t.centerSegmentIndexInfo.hasSegmentIndex=c,t.centerSegmentIndexInfo.hasPreviewIndex=l}},F0e={[ht.Initialize]:t=>{const{operationName:e,centerIJK:r,segmentationVoxelManager:n,imageVoxelManager:i,configuration:o,segmentIndex:a,viewport:s}=t;if(!o?.threshold?.isDynamic||!r||!a||e===ht.RejectPreview||e===ht.OnInteractionEnd)return;const c=n.getBoundsIJK(),{range:l,dynamicRadius:f=0}=o.threshold,u=l?0:f,{viewPlaneNormal:d}=s.getCamera(),h=c.map((w,v)=>{const[y,C]=w;return[Math.max(y,r[v]-u),Math.min(C,r[v]+u)]});Math.abs(d[0])>.8?h[0]=[r[0],r[0]]:Math.abs(d[1])>.8?h[1]=[r[1],r[1]]:Math.abs(d[2])>.8&&(h[2]=[r[2],r[2]]);const g=l||[1/0,-1/0],p=u*u,m=({value:w,pointIJK:v})=>{if(a5(r,v)>p)return;const C=Array.isArray(w)?p0(w):w;g[0]=Math.min(C,g[0]),g[1]=Math.max(C,g[1])};i.forEach(m,{boundsIJK:h}),o.threshold.range=g},[ht.OnInteractionStart]:t=>{const{configuration:e}=t;e?.threshold?.isDynamic&&(e.threshold.range=null)},[ht.ComputeInnerCircleRadius]:t=>{const{configuration:e,viewport:r}=t,n=e?.threshold;if(!n)return;const{dynamicRadius:i=0,isDynamic:o}=n;if(!o){n.dynamicRadiusInCanvas=0;return}if(i===0)return;const a=r.getImageData();if(!a)return;const{spacing:s}=a,c=[r.element.clientWidth/2,r.element.clientHeight/2],l=i*s[0],u=r.canvasToWorld(c).map(g=>g+l),d=r.worldToCanvas(u),h=Math.abs(c[0]-d[0]);n.dynamicRadiusInCanvas||(n.dynamicRadiusInCanvas=0),n.dynamicRadiusInCanvas=3+h}},U0e={[ht.Initialize]:t=>{t.segmentIndex=0}},{isEqual:dy}=gn,u4={toIJK:t=>t,fromIJK:t=>t,type:"acquistion"},B0e={toIJK:([t,e,r])=>[r,t,e],fromIJK:([t,e,r])=>[e,r,t],type:"jk"},G0e={toIJK:([t,e,r])=>[t,r,e],fromIJK:([t,e,r])=>[t,r,e],type:"ik"};function jR(t,e){if(!(t instanceof ir))return{...u4,boundsIJKPrime:e};const{viewPlaneNormal:r}=t.getCamera(),n=dy(Math.abs(r[0]),1)&&B0e||dy(Math.abs(r[1]),1)&&G0e||dy(Math.abs(r[2]),1)&&u4;return n?{...n,boundsIJKPrime:n.fromIJK(e)}:{toIJK:null,boundsIJKPrime:null,fromIJK:null,error:`Only mappings orthogonal to acquisition plane are permitted, but requested ${r}`}}const{RLEVoxelMap:W0e,VoxelManager:$0e}=gn,z0e=65535;var yi;(function(t){t[t.SEGMENT=-1]="SEGMENT",t[t.ISLAND=-2]="ISLAND",t[t.INTERIOR=-3]="INTERIOR",t[t.EXTERIOR=-4]="EXTERIOR",t[t.INTERIOR_SMALL=-5]="INTERIOR_SMALL",t[t.INTERIOR_TEST=-6]="INTERIOR_TEST"})(yi||(yi={}));class of{constructor(e){this.fillInternalEdge=!1,this.maxInternalRemove=128,this.maxInternalRemove=e?.maxInternalRemove??this.maxInternalRemove,this.fillInternalEdge=e?.fillInternalEdge??this.fillInternalEdge}initialize(e,r,n){const i=!!r.sourceVoxelManager,o=i?r.sourceVoxelManager:r,a=i?r:$0e.createRLEHistoryVoxelManager(o),{segmentIndex:s=1,previewSegmentIndex:c=1}=n,l=n.points||o.getPoints();if(!l?.length)return;const f=o.getBoundsIJK().map((C,x)=>[Math.min(C[0],...l.map(T=>T[x])),Math.max(C[1],...l.map(T=>T[x]))]);if(f.find(C=>C[0]<0||C[1]>z0e))return;const{toIJK:u,fromIJK:d,boundsIJKPrime:h,error:g}=jR(e,f);if(g){console.warn("Not performing island removal for planes not orthogonal to acquisition plane",g);return}const[p,m,w]=d(o.dimensions),v=new W0e(p,m,w),y=(C,x,T)=>{const S=o.toIndex(u([C,x,T])),_=o.getAtIndex(S);if(_===c||_===s)return yi.SEGMENT};return v.fillFrom(y,h),v.normalizer={toIJK:u,fromIJK:d,boundsIJKPrime:h},this.segmentSet=v,this.previewVoxelManager=a,this.segmentIndex=s,this.previewSegmentIndex=c??s,this.selectedPoints=l,!0}floodFillSegmentIsland(){const{selectedPoints:e,segmentSet:r}=this;let n=0;const{fromIJK:i}=r.normalizer;return e.forEach(o=>{const a=i(o),s=r.toIndex(a),[c,l,f]=a;r.get(s)===yi.SEGMENT&&(n+=r.floodFill(c,l,f,yi.ISLAND))}),n}removeExternalIslands(){const{previewVoxelManager:e,segmentSet:r}=this,{toIJK:n}=r.normalizer,i=(o,a)=>{const[,s,c]=r.toIJK(o);if(a.value!==yi.ISLAND)for(let l=a.start;l<a.end;l++){const f=n([l,s,c]),u=e.getAtIJKPoint(f);e.setAtIJKPoint(f,u===void 0?0:null)}};r.forEach(i,{rowModified:!0})}removeInternalIslands(){const{segmentSet:e,previewVoxelManager:r,previewSegmentIndex:n}=this,{height:i,normalizer:o,width:a}=e,{toIJK:s}=o;return e.forEachRow((c,l)=>{let f;for(const u of[...l])if(u.value===yi.ISLAND){if(!f){if(this.fillInternalEdge&&u.start>0)for(let d=0;d<u.start;d++)e.set(c+d,yi.INTERIOR);f=u;continue}for(let d=f.end;d<u.start;d++)e.set(c+d,yi.INTERIOR);f=u}if(this.fillInternalEdge&&f?.end<a)for(let u=f.end;u<a;u++)e.set(c+u,yi.INTERIOR)}),e.forEach((c,l)=>{if(l.value!==yi.INTERIOR)return;const[,f,u]=e.toIJK(c),d=f>0?e.getRun(f-1,u):null,h=f+1<i?e.getRun(f+1,u):null,g=f===i-1,p=f===0,m=of.covers(l,d)||p&&this.fillInternalEdge,w=of.covers(l,h)||g&&this.fillInternalEdge;l.end-l.start>2&&(!m||!w)&&e.floodFill(l.start,f,u,yi.EXTERIOR,{singlePlane:!0})}),e.forEach((c,l)=>{if(l.value!==yi.INTERIOR)return;const[,f,u]=e.toIJK(c),g=e.floodFill(l.start,f,u,yi.INTERIOR_TEST)>this.maxInternalRemove?yi.EXTERIOR:yi.INTERIOR_SMALL;e.floodFill(l.start,f,u,g)}),e.forEach((c,l)=>{if(l.value===yi.INTERIOR_SMALL)for(let f=l.start;f<l.end;f++){const u=s(e.toIJK(c+f));r.setAtIJKPoint(u,n)}}),r.getArrayOfModifiedSlices()}static covers(e,r){if(!r)return!1;let{start:n}=e;const{end:i}=e;for(const o of r)if(n>=o.start&&n<o.end&&(n=o.end,n>=i))return!0;return!1}}const j0e={[ht.OnInteractionEnd]:t=>{const{previewSegmentIndex:e,segmentIndex:r,viewport:n,segmentationVoxelManager:i,activeStrategy:o,memo:a}=t;if(o!=="THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL"||r===null)return;const s=new of,c=a?.voxelManager||i;if(!s.initialize(n,c,{previewSegmentIndex:e,segmentIndex:r}))return;s.floodFillSegmentIsland(),s.removeExternalIslands(),s.removeInternalIslands();const l=c.getArrayOfModifiedSlices();l&&ui(t.segmentationId,l,e)}},H0e={[ht.Preview]:function(t){const{previewSegmentIndex:e,configuration:r,enabledElement:n}=t;if(!e||!r)return;this.onInteractionStart?.(n,t);const i=this.fill(n,t);return i&&this.onInteractionEnd?.(n,t),i},[ht.Initialize]:t=>{const{segmentIndex:e,previewColor:r,previewSegmentIndex:n}=t;if(t.modified=!1,n==null||e==null)return;ff(t.segmentationId)?.forEach(o=>{WP(o,t.segmentationId,n,r)}),t.modified=!0},[ht.AcceptPreview]:t=>{const{previewSegmentIndex:e,segmentationVoxelManager:r,memo:n,segmentIndex:i,centerSegmentIndexInfo:o}=t||{},{changedIndices:a}=o||{},s=n,c=({index:l})=>{const f=r.getAtIndex(l);a?.length>0?a.includes(l)&&s.voxelManager.setAtIndex(l,0):f===e&&s.voxelManager.setAtIndex(l,i)};r.forEach(c),ui(t.segmentationId,r.getArrayOfModifiedSlices(),i),t.centerSegmentIndexInfo.changedIndices=[]},[ht.RejectPreview]:t=>{t&&M7.undoIf(e=>{const r=e;if(!r?.voxelManager)return!1;const{segmentationVoxelManager:n}=r;let i=!1;const o=({value:a})=>{a===t.previewSegmentIndex&&(i=!0)};return n.forEach(o),i})}},K0e={[ht.Fill]:t=>{const{segmentsLocked:e,segmentationImageData:r,segmentationVoxelManager:n,brushStrategy:i,centerIJK:o}=t,a=i.createIsInThreshold?.(t),{setValue:s}=i,c=a?l=>{const{value:f,index:u}=l;e.includes(f)||!a(u)||s(t,l)}:l=>s(t,l);n.forEach(c,{imageData:r,isInObject:t.isInObject,boundsIJK:t.isInObjectBoundsIJK}),n.addPoint(o)}};function X0e({operationData:t,existingValue:e,index:r}){const{previewSegmentIndex:n,memo:i,centerSegmentIndexInfo:o,previewOnHover:a,segmentIndex:s}=t,{hasPreviewIndex:c,hasSegmentIndex:l,segmentIndex:f}=o;if(f===0&&l&&c){if(e===s||a)return;if(e===n){i.voxelManager.setAtIndex(r,0);return}return}if(f===0&&l&&!c){if(e===0||e!==s)return;i.voxelManager.setAtIndex(r,n),o.changedIndices.push(r);return}if(f===0&&!l&&c){if(e===s||a)return;if(e===n){i.voxelManager.setAtIndex(r,0);return}return}if(f===0&&!l&&!c){if(e===s)return;if(e===n){i.voxelManager.setAtIndex(r,n);return}return}if(f===n&&l&&c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}if(f===n&&!l&&c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}if(f===s&&l&&c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}if(f===s&&l&&!c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}}const q0e={[ht.INTERNAL_setValue]:(t,{value:e,index:r})=>{const{segmentsLocked:n,previewSegmentIndex:i,memo:o,segmentationVoxelManager:a,centerSegmentIndexInfo:s,segmentIndex:c}=t,l=a.getAtIndex(r);if(!n.includes(e)&&!(!s&&l===c)&&!(s?.segmentIndex!==0&&l===c)){if(s?.segmentIndex===null){o.voxelManager.setAtIndex(r,i??c);return}if(!i){let f=c;s&&(f=s.segmentIndex),o.voxelManager.setAtIndex(r,f);return}X0e({operationData:t,existingValue:l,index:r})}}},Y0e={[ht.CreateIsInThreshold]:t=>{const{imageVoxelManager:e,segmentIndex:r,configuration:n}=t;if(!(!n||!r))return i=>{const o=e.getAtIndex(i),a=Array.isArray(o)?_r(o):o,{threshold:s}=n||{};return s?.range?.length?s.range[0]<=a&&a<=s.range[1]:!0}}},f4=10;function w1(){return{maxIJKs:[]}}function HR(t,e){const{value:r}=e,{maxIJKs:n}=t,i=n.length;if(typeof r!="number"||i>=f4&&r<n[0].value)return;const o={value:e.value,pointLPS:e.pointLPS?[e.pointLPS[0],e.pointLPS[1],e.pointLPS[2]]:void 0,pointIJK:e.pointIJK?[e.pointIJK[0],e.pointIJK[1],e.pointIJK[2]]:void 0};if(!i||r>=n[i-1].value)n.push(o);else for(let a=0;a<i;a++)if(r<=n[a].value){n.splice(a,0,o);break}i>=f4&&n.splice(0,1)}function KR(t,e,r){const{spacing:n,calibration:i}=r,{volumeUnit:o}=Fo({calibration:i,hasPixelSpacing:!0},[]),a=n?n[0]*n[1]*n[2]:1;return e.volume={value:Array.isArray(e.count.value)?e.count.value.map(s=>s*a):e.count.value*a,unit:o,name:"volume",label:"Volume"},e.maxIJKs=t.maxIJKs.filter(s=>s.pointIJK!==void 0),e.array.push(e.volume),t.maxIJKs=[],e}const J3=class J3 extends _s{static statsInit(e){super.statsInit(e),this.volumetricState=w1()}static statsCallback(e){super.statsCallback(e),HR(this.volumetricState,e)}static getStatistics(e){const r={...e,unit:e?.unit||"none",calibration:e?.calibration,hasPixelSpacing:e?.hasPixelSpacing},n=super.getStatistics(r);return KR(this.volumetricState,n,r)}};J3.volumetricState=w1();let zu=J3;class d4 extends LO{constructor(e){super(e),this.volumetricState=w1()}statsInit(e){super.statsInit(e),this.volumetricState=w1()}statsCallback(e){super.statsCallback(e),HR(this.volumetricState,e)}getStatistics(e){const r={...e,unit:e?.unit||"none",calibration:e?.calibration,hasPixelSpacing:e?.hasPixelSpacing},n=super.getStatistics(r);return KR(this.volumetricState,n,r)}}const J0e=Math.pow(3*1e3/(4*Math.PI),1/3);async function XR({segmentationId:t,segmentIndices:e,mode:r="collective"}){N2(),Es(No.COMPUTE_STATISTICS,0);const n=VP(t,e);if(!n)return;const{operationData:i,segVolumeId:o,segImageIds:a,reconstructableVolume:s,indices:c}=n,{refImageId:l,modalityUnitOptions:f}=gue(o,a),u=jP(l,f);return s?await Z0e({operationData:i,indices:c,unit:u,mode:r}):await Q0e({segImageIds:a,indices:c,unit:u,mode:r})}async function Z0e({operationData:t,indices:e,unit:r,mode:n}){const i=kP(t),{segmentationVoxelManager:o,imageVoxelManager:a,segmentationImageData:s,imageData:c}=i;if(!o||!s)return;const l=s.getSpacing(),{boundsIJK:f}=o;if(!f)return zu.getStatistics({spacing:l});const d={scalarData:o.getCompleteScalarDataArray(),dimensions:s.getDimensions(),spacing:s.getSpacing(),origin:s.getOrigin(),direction:s.getDirection()},h={scalarData:a.getCompleteScalarDataArray(),dimensions:c.getDimensions(),spacing:c.getSpacing(),origin:c.getOrigin(),direction:c.getDirection()};if(!h.scalarData?.length)return;const g=await Is().executeTask("compute","calculateSegmentsStatisticsVolume",{segmentationInfo:d,imageInfo:h,indices:e,unit:r,mode:n});if(Es(No.COMPUTE_STATISTICS,100),n==="collective")return C1({stats:g,unit:r,spacing:l,segmentationImageData:s,imageVoxelManager:a});{const p={};return Object.entries(g).forEach(([m,w])=>{p[m]=C1({stats:w,unit:r,spacing:l,segmentationImageData:s,imageVoxelManager:a})}),p}}const hy=(t,e)=>{if(!t.array)return;const r=t.array.findIndex(n=>n.name===e.name);r!==-1?t.array[r]=e:t.array.push(e)},C1=({stats:t,unit:e,spacing:r,segmentationImageData:n,imageVoxelManager:i})=>{if(t.mean.unit=e,t.max.unit=e,t.min.unit=e,e!=="SUV")return t;const o=r.map(a=>Math.max(1,Math.round(1.1*J0e/a)));for(const a of t.maxIJKs){const s=ede(a,o,n,i,r);if(!s)continue;const{mean:c}=s;(!t.peakValue||t.peakValue.value<=c.value)&&(t.peakValue={name:"peakValue",label:"Peak Value",value:c.value,unit:e},t.peakPoint={name:"peakLPS",label:"Peak SUV Point",value:a.pointLPS?[...a.pointLPS]:null,unit:null},hy(t,t.peakValue),hy(t,t.peakPoint))}if(t.volume&&t.mean){const a=t.volume.value,s=t.mean.value;t.lesionGlycolysis={name:"lesionGlycolysis",label:"Lesion Glycolysis",value:a*s,unit:`${t.volume.unit}${e}`},hy(t,t.lesionGlycolysis)}return t};async function Q0e({segImageIds:t,indices:e,unit:r,mode:n}){Es(No.COMPUTE_STATISTICS,0);const{segmentationInfo:i,imageInfo:o}=FP(t),a=await Is().executeTask("compute","calculateSegmentsStatisticsStack",{segmentationInfo:i,imageInfo:o,indices:e,mode:n});Es(No.COMPUTE_STATISTICS,100);const s=i[0].spacing,c=i[0],l=o[0].voxelManager;if(n==="collective")return C1({stats:a,unit:r,spacing:s,segmentationImageData:c,imageVoxelManager:l});{const f={};return Object.entries(a).forEach(([u,d])=>{f[u]=C1({stats:d,unit:r,spacing:s,segmentationImageData:c,imageVoxelManager:l})}),f}}function ede(t,e,r,n,i){const{pointIJK:o,pointLPS:a}=t;if(!o)return;const s=o.map((f,u)=>[f-e[u],f+e[u]]),c=(f,u)=>{const d=(u[0]-o[0])/e[0],h=(u[1]-o[1])/e[1],g=(u[2]-o[2])/e[2];return d*d+h*h+g*g<=1},l=({pointIJK:f,pointLPS:u})=>{const d=n.getAtIJKPoint(f);d!==void 0&&zu.statsCallback({value:d,pointLPS:u,pointIJK:f})};return zu.statsInit({storePointData:!1}),EC(r,{pointInShapeFn:c,callback:l,boundsIJK:s}),zu.getStatistics({spacing:i})}const tde={[ht.GetStatistics]:function(t,e,r){const{indices:n}=r,{segmentationId:i,viewport:o}=e;XR({segmentationId:i,segmentIndices:n})}},nde={[ht.CalculateCursorGeometry]:function(t,e){if(!e)return;const{configuration:r,activeStrategy:n,hoverData:i}=e,{viewport:o}=t,a=o.getCamera(),{brushSize:s}=r,c=mt(a.viewUp[0],a.viewUp[1],a.viewUp[2]),l=mt(a.viewPlaneNormal[0],a.viewPlaneNormal[1],a.viewPlaneNormal[2]),f=Ie();nn(f,c,l);const{canvasToWorld:u}=o,{centerCanvas:d}=i,h=u([d[0],d[1]]),g=Ie(),p=Ie(),m=Ie(),w=Ie();for(let x=0;x<=2;x++)g[x]=h[x]-c[x]*s,p[x]=h[x]+c[x]*s,m[x]=h[x]-f[x]*s,w[x]=h[x]+f[x]*s;if(!i)return;const{brushCursor:v}=i,{data:y}=v;y.handles===void 0&&(y.handles={}),y.handles.points=[g,p,m,w];const C=r.strategies[n];typeof C?.computeInnerCircleRadius=="function"&&C.computeInnerCircleRadius({configuration:r,viewport:o}),y.invalidated=!1},[ht.RenderCursor]:function(t,e,r){if(!e)return;const{configuration:n,hoverData:i}=e,{viewport:o}=t,{brushCursor:a}=i,s=a.metadata;if(!s)return;const c=s.brushCursorUID,l=a.data,{points:f}=l.handles,u=f.map(y=>o.worldToCanvas(y)),d=u[0],h=u[1],g=[Math.floor((d[0]+h[0])/2),Math.floor((d[1]+h[1])/2)],p=Math.abs(d[1]-Math.floor((d[1]+h[1])/2)),m=`rgb(${s.segmentColor?.slice(0,3)||[0,0,0]})`;if(!o.getRenderingEngine()){console.warn("Rendering Engine has been destroyed");return}Si(r,c,"0",g,p,{color:m,lineDash:this.centerSegmentIndexInfo.segmentIndex===0?[1,2]:null});const{dynamicRadiusInCanvas:v}=n?.threshold||{dynamicRadiusInCanvas:0};v&&Si(r,c,"1",g,v,{color:m})}},en={determineSegmentIndex:k0e,dynamicThreshold:F0e,erase:U0e,islandRemoval:j0e,preview:H0e,regionFill:K0e,setValue:q0e,threshold:Y0e,labelmapStatistics:tde,ensureSegmentationVolumeFor3DManipulation:LP,ensureImageVolumeFor3DManipulation:NP,circularCursor:nde},Ou=class Ou{constructor(e,...r){this._initialize=[],this._fill=[],this._onInteractionStart=[],this.fill=(o,a)=>{const s=this.initialize(o,a,ht.Fill);if(!s)return;this._fill.forEach(f=>f(s));const{segmentationVoxelManager:c,segmentIndex:l}=s;return ui(s.segmentationId,c.getArrayOfModifiedSlices(),l),s},this.onInteractionStart=(o,a)=>{const s=this.initialize(o,a);s&&this._onInteractionStart.forEach(c=>c.call(this,s))},this.addPreview=(o,a)=>{const s=this.initialize(o,a,ht.AddPreview);if(s)return s},this.configurationName=e;const n=r.find(o=>o.hasOwnProperty(ht.CalculateCursorGeometry)),i=r.find(o=>o.hasOwnProperty(ht.RenderCursor));n||r.push({[ht.CalculateCursorGeometry]:en.circularCursor.calculateCursorGeometry}),i||r.push({[ht.RenderCursor]:en.circularCursor.renderCursor}),this.compositions=r,r.forEach(o=>{const a=typeof o=="function"?o():o;if(a)for(const s in a){if(!Ou.childFunctions[s])throw new Error(`Didn't find ${s} as a brush strategy`);Ou.childFunctions[s](this,a[s])}}),this.strategyFunction=(o,a)=>this.fill(o,a);for(const o of Object.keys(Ou.childFunctions))this.strategyFunction[o]=this[o]}initialize(e,r,n){const{viewport:i}=e,o=p3({operationData:r,viewport:i,strategy:this});if(!o)return null;const{imageVoxelManager:a,segmentationVoxelManager:s,segmentationImageData:c}=o,l=r.createMemo(r.segmentationId,s),f={operationName:n,...r,segmentIndex:r.segmentIndex,enabledElement:e,imageVoxelManager:a,segmentationVoxelManager:s,segmentationImageData:c,viewport:i,centerWorld:null,isInObject:null,isInObjectBoundsIJK:null,brushStrategy:this,memo:l};return this._initialize.forEach(u=>u(f)),f}};Ou.COMPOSITIONS=en,Ou.childFunctions={[ht.OnInteractionStart]:ma(ht.OnInteractionStart,ht.Initialize),[ht.OnInteractionEnd]:ma(ht.OnInteractionEnd,ht.Initialize),[ht.Fill]:ma(ht.Fill),[ht.Initialize]:ma(ht.Initialize),[ht.CreateIsInThreshold]:Mf(ht.CreateIsInThreshold),[ht.Interpolate]:ma(ht.Interpolate,ht.Initialize),[ht.AcceptPreview]:ma(ht.AcceptPreview,ht.Initialize),[ht.RejectPreview]:ma(ht.RejectPreview,ht.Initialize),[ht.INTERNAL_setValue]:Mf(ht.INTERNAL_setValue),[ht.Preview]:Mf(ht.Preview,!1),[ht.ComputeInnerCircleRadius]:ma(ht.ComputeInnerCircleRadius),[ht.EnsureSegmentationVolumeFor3DManipulation]:ma(ht.EnsureSegmentationVolumeFor3DManipulation),[ht.EnsureImageVolumeFor3DManipulation]:ma(ht.EnsureImageVolumeFor3DManipulation),[ht.AddPreview]:ma(ht.AddPreview),[ht.GetStatistics]:Mf(ht.GetStatistics),[ht.CalculateCursorGeometry]:Mf(ht.CalculateCursorGeometry,!0),[ht.RenderCursor]:Mf(ht.RenderCursor,!0),compositions:null};let Va=Ou;function ma(t,e){const r=`_${t}`;return(n,i)=>{n[r]||=[],n[r].push(i),n[t]||=e?(o,a,...s)=>{const c=n[e](o,a,t);let l;return n[r].forEach(f=>{const u=f.call(n,c,...s);l||=u}),l}:(o,...a)=>{n[r].forEach(s=>s.call(n,o,...a))}}}function Mf(t,e=!0){return(r,n)=>{if(r[t])throw new Error(`The singleton method ${t} already exists`);r[t]=e?n:(i,o,...a)=>(o.enabledElement=i,n.call(r,o,...a))}}function qR(t,e){const{center:r,radius:n}=t,i=t.radius2||n*n;return(e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1])+(e[2]-r[2])*(e[2]-r[2])<=i}const{transformWorldToIndex:h4,transformIndexToWorld:g4,isEqual:rde}=gn;function YR(t){const[e,r,n,i]=t,o=[n[0],r[1]],a=[i[0],e[1]],s=[n[0],e[1]],c=[i[0],r[1]];return[o,a,s,c]}function ide(t,e,r,n){const i=mt(t[0],t[1],t[2]),o=Ie();tn(o,i,e,n);const a=Ie();tn(a,i,e,-n);const s=Ie();tn(s,i,r,n);const c=Ie();return tn(c,i,r,-n),[a,o,c,s]}function ode(t,e){if(!t.length||e<=0)return null;const r=e*e,n=t.map(o=>[o[0],o[1],o[2]]),i=[];for(let o=1;o<n.length;o++){const a=n[o-1],s=n[o],c=s[0]-a[0],l=s[1]-a[1],f=s[2]-a[2],u=c*c+l*l+f*f;i.push({start:a,vector:[c,l,f],lengthSquared:u})}return o=>{if(!o)return!1;for(const a of n){const s=o[0]-a[0],c=o[1]-a[1],l=o[2]-a[2];if(s*s+c*c+l*l<=r)return!0}for(const{start:a,vector:s,lengthSquared:c}of i){if(c===0){const C=o[0]-a[0],x=o[1]-a[1],T=o[2]-a[2];if(C*C+x*x+T*T<=r)return!0;continue}const l=o[0]-a[0],f=o[1]-a[1],u=o[2]-a[2],d=l*s[0]+f*s[1]+u*s[2],h=Math.max(0,Math.min(1,d/c)),g=a[0]+s[0]*h,p=a[1]+s[1]*h,m=a[2]+s[2]*h,w=o[0]-g,v=o[1]-p,y=o[2]-m;if(w*w+v*v+y*y<=r)return!0}return!1}}const JR={[ht.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n,viewUp:i,viewPlaneNormal:o}=t;if(!e)return;const a=Ie();e.length>=2?(nr(a,e[0],e[1]),Jn(a,a,.5)):$1(a,e[0]),t.centerWorld=a,t.centerIJK=h4(n,a);const s=e.length>=2?Nr(e[0],e[1])/2:0,c=e.map(y=>r.worldToCanvas(y)),f=YR(c).map(y=>r.canvasToWorld(y)),u=mt(i[0],i[1],i[2]);At(u,u);const d=mt(o[0],o[1],o[2]);At(d,d);const h=Ie();nn(h,u,d),At(h,h);const p=(t.strokePointsWorld&&t.strokePointsWorld.length>0?t.strokePointsWorld:[t.centerWorld]).map(y=>ea(y)),w=p.flatMap(y=>ide(y,u,h,s)).map(y=>h4(n,y)),v=Rl(w,n.getDimensions());t.strokePointsWorld=p,t.isInObject=ZR(f,{strokePointsWorld:p,segmentationImageData:n,radius:s}),t.isInObjectBoundsIJK=v}};function ZR(t=[],e={}){if(!t||t.length!==4)throw new Error("createPointInEllipse: cornersInWorld must have 4 points");const[r,n,i,o]=t,a=Ie();nr(a,r,n),Jn(a,a,.5);const s=Ie();qt(s,o,r);const c=_r(s)/2;At(s,s);const l=Ie();qt(l,i,r);const f=_r(l)/2;At(l,l);const u=Ie();nn(u,s,l),At(u,u);const d=e.radius??Math.max(c,f),h=ode(e.strokePointsWorld||[],d);if(rde(c,f)){const g=c,p={center:a,radius:g,radius2:g*g};return(m,w)=>{let v=m;return!v&&w&&e.segmentationImageData&&(v=g4(e.segmentationImageData,w)),v?h?.(v)?!0:qR(p,v):!1}}return(g,p)=>{let m=g;if(!m&&p&&e.segmentationImageData&&(m=g4(e.segmentationImageData,p)),!m)return!1;if(h?.(m))return!0;const w=Ie();qt(w,m,a);const v=ft(w,u),y=Ie();tn(y,w,u,-v);const C=Ie(),x=Ie();qt(x,a,r),qt(C,y,x);const T=ft(C,s),S=ft(C,l);return T*T/(c*c)+S*S/(f*f)<=1}}const QR=new Va("Circle",en.regionFill,en.setValue,JR,en.determineSegmentIndex,en.preview,en.labelmapStatistics),ade=new Va("CircleThreshold",en.regionFill,en.setValue,JR,en.determineSegmentIndex,en.dynamicThreshold,en.threshold,en.preview,en.islandRemoval,en.labelmapStatistics),B2=QR.strategyFunction,sde=ade.strategyFunction;function cde(){throw new Error("Not yet implemented")}const{transformWorldToIndex:p4}=gn,lde={[ht.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n}=t;if(!e)return;const i=Ie();e.length>=2?(nr(i,e[0],e[1]),Jn(i,i,.5)):$1(i,e[0]),t.centerWorld=i,t.centerIJK=p4(n,i);const o=D0e(e.slice(0,2),n,r),a=e.map(p=>r.worldToCanvas(p)),c=YR(a).map(p=>r.canvasToWorld(p)),l=e.length>=2?Nr(e[0],e[1])/2:void 0,f=t.strokePointsWorld&&t.strokePointsWorld.length>0?t.strokePointsWorld:[t.centerWorld],u=o.boundsIJK,d=t.centerIJK,g=f.reduce((p,m)=>{if(!m)return p;const w=p4(n,m),v=[w[0]-d[0],w[1]-d[1],w[2]-d[2]],y=[[u[0][0]+v[0],u[0][1]+v[0]],[u[1][0]+v[1],u[1][1]+v[1]],[u[2][0]+v[2],u[2][1]+v[2]]];return p?[[Math.min(p[0][0],y[0][0]),Math.max(p[0][1],y[0][1])],[Math.min(p[1][0],y[1][0]),Math.max(p[1][1],y[1][1])],[Math.min(p[2][0],y[2][0]),Math.max(p[2][1],y[2][1])]]:y},null)??o.boundsIJK;if(n){const p=n.getDimensions();t.isInObjectBoundsIJK=[[Math.max(0,Math.min(g[0][0],p[0]-1)),Math.max(0,Math.min(g[0][1],p[0]-1))],[Math.max(0,Math.min(g[1][0],p[1]-1)),Math.max(0,Math.min(g[1][1],p[1]-1))],[Math.max(0,Math.min(g[2][0],p[2]-1)),Math.max(0,Math.min(g[2][1],p[2]-1))]]}else t.isInObjectBoundsIJK=g;t.isInObject=ZR(c,{strokePointsWorld:t.strokePointsWorld,segmentationImageData:n,radius:l})}},G2=new Va("Sphere",en.regionFill,en.setValue,lde,en.determineSegmentIndex,en.preview,en.labelmapStatistics,en.ensureSegmentationVolumeFor3DManipulation),eA=G2.strategyFunction,ude=new Va("SphereThreshold",...G2.compositions,en.dynamicThreshold,en.threshold,en.ensureSegmentationVolumeFor3DManipulation,en.ensureImageVolumeFor3DManipulation),fde=new Va("SphereThreshold",...G2.compositions,en.dynamicThreshold,en.threshold,en.islandRemoval,en.ensureSegmentationVolumeFor3DManipulation,en.ensureImageVolumeFor3DManipulation),dde=ude.strategyFunction,hde=fde.strategyFunction,gde=new Va("EraseSphere",en.erase,...G2.compositions),tA=gde.strategyFunction,pde=new Va("EraseCircle",en.erase,...QR.compositions),nA=pde.strategyFunction,{VoxelManager:j5,RLEVoxelMap:mde}=gn;function H5(t,e){return iA(t,e)}function rA(t){const{segmentationVoxelManager:e,undoVoxelManager:r,redoVoxelManager:n}=this,i=t===!1?n:r;i.forEach(({value:a,pointIJK:s})=>{e.setAtIJKPoint(s,a)});const o=i.getArrayOfModifiedSlices();ui(this.segmentationId,o)}function iA(t,e){const r=j5.createRLEHistoryVoxelManager(e);return{segmentationId:t,restoreMemo:rA,commitMemo:vde,segmentationVoxelManager:e,voxelManager:r,id:un(),operationType:"labelmap"}}function vde(){if(this.redoVoxelManager)return!0;if(!this.voxelManager.modifiedSlices.size)return!1;const{segmentationVoxelManager:t}=this,e=j5.createRLEHistoryVoxelManager(t);mde.copyMap(e.map,this.voxelManager.map);for(const n of this.voxelManager.modifiedSlices.keys())e.modifiedSlices.add(n);this.undoVoxelManager=e;const r=j5.createRLEVolumeVoxelManager({dimensions:this.segmentationVoxelManager.dimensions});return this.redoVoxelManager=r,e.forEach(({index:n,pointIJK:i,value:o})=>{const a=t.getAtIJKPoint(i);a!==o&&r.setAtIndex(n,a)}),!0}const yde=Object.freeze(Object.defineProperty({__proto__:null,createLabelmapMemo:H5,createRleMemo:iA,restoreMemo:rA},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:oA}=gn,aA={[ht.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n}=t;if(!e)return;const i=mt(0,0,0);e.forEach(s=>{nr(i,i,s)}),Jn(i,i,1/e.length),t.centerWorld=i,t.centerIJK=oA(n,i);const{boundsIJK:o,pointInShapeFn:a}=wde(r,e,n);t.isInObject=a,t.isInObjectBoundsIJK=o}};function wde(t,e,r){let n=e.map(y=>oA(r,y));n=n.map(y=>y.map(C=>Math.round(C)));const i=Rl(n,r.getDimensions()),[o,a,s,c]=e,l=Ie(),f=Ie();qt(l,a,o),qt(f,c,o);const u=_r(l),d=_r(f);At(l,l),At(f,f);const h=Ie();nn(h,l,f),At(h,h);const g=r.getDirection(),p=r.getSpacing(),{viewPlaneNormal:m}=t.getCamera(),w=Ll({direction:g,spacing:p},m);return{boundsIJK:i,pointInShapeFn:y=>{const C=Ie();qt(C,y,o);const x=ft(C,l),T=ft(C,f),S=Math.abs(ft(C,h));return x>=-w&&x<=u+w&&T>=-w&&T<=d+w&&S<=w}}}const Cde=new Va("Rectangle",en.regionFill,en.setValue,aA,en.determineSegmentIndex,en.preview,en.labelmapStatistics),xde=new Va("RectangleThreshold",en.regionFill,en.setValue,aA,en.determineSegmentIndex,en.dynamicThreshold,en.threshold,en.preview,en.islandRemoval,en.labelmapStatistics),_3=Cde.strategyFunction,Tde=xde.strategyFunction,Sde=Object.freeze(Object.defineProperty({__proto__:null,fillInsideCircle:B2,fillInsideRectangle:_3,fillOutsideCircle:cde,thresholdInsideRectangle:Tde},Symbol.toStringTag,{value:"Module"})),sh=class sh extends vr{constructor(e,r){super(e,r),this.memoMap=new Map,this.acceptedMemoIds=new Map,this.centerSegmentIndexInfo={segmentIndex:null,hasSegmentIndex:!1,hasPreviewIndex:!1,changedIndices:[]}}_historyRedoHandler(e){const{id:r,operationType:n}=e.detail;if(n==="labelmap"){if(this.acceptedMemoIds.has(r)){this._hoverData=null;const i=this.acceptedMemoIds.get(r),o=i?.element,a=this.getOperationData(o);a.segmentIndex=i?.segmentIndex,o&&this.applyActiveStrategyCallback(Ce(o),a,ht.AcceptPreview)}this._previewData.isDrag=!0}}get _previewData(){return sh.previewData}hasPreviewData(){return!!this._previewData.preview}shouldResolvePreviewRequests(){return(this.mode==="Active"||this.mode==="Enabled")&&this.hasPreviewData()}createMemo(e,r){const n=r.id;if(this.memo&&this.memo.segmentationVoxelManager===r)return this.memo;let i=this.memoMap.get(n);return i?i.redoVoxelManager&&(i=H5(e,r),this.memoMap.set(n,i)):(i=H5(e,r),this.memoMap.set(n,i)),this.memo=i,i}createEditData(e){const r=Ce(e),{viewport:n}=r,i=nf(n.id);if(!i){const l=new CustomEvent(Ge.ERROR_EVENT,{detail:{type:"Segmentation",message:"No active segmentation detected, create a segmentation representation before using the brush tool"},cancelable:!0});return ke.dispatchEvent(l),null}const{segmentationId:o}=i,a=hf(o),{representationData:s}=Ut(o);return this.getEditData({viewport:n,representationData:s,segmentsLocked:a,segmentationId:o})}getEditData({viewport:e,representationData:r,segmentsLocked:n,segmentationId:i}){if(e instanceof ir){const{volumeId:o}=r[yt.Labelmap],a=e.getActors();if(e instanceof qn){const u=new CustomEvent(Ge.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return ke.dispatchEvent(u),null}const c=a.map(u=>Ae.getVolume(u.referencedId)),l=Ae.getVolume(o),f=c.find(u=>Dt(u.dimensions,l.dimensions))?.volumeId||c[0]?.volumeId;return{volumeId:o,referencedVolumeId:this.configuration.threshold?.volumeId??f,segmentsLocked:n}}else{const o=kl(e.id,i);return o?{imageId:o,segmentsLocked:n}:void 0}}createHoverData(e,r){const n=Ce(e),{viewport:i}=n,o=i.getCamera(),{viewPlaneNormal:a,viewUp:s}=o,c=[i.id],{segmentIndex:l,segmentationId:f,segmentColor:u}=this.getActiveSegmentationData(i)||{};return{brushCursor:{metadata:{viewPlaneNormal:[...a],viewUp:[...s],FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:u},data:{}},centerCanvas:r,segmentIndex:l,viewport:i,segmentationId:f,segmentColor:u,viewportIdsToRender:c}}getActiveSegmentationData(e){const r=e.id,n=nf(r);if(!n)return;const{segmentationId:i}=n,o=no(i);if(!o)return;const a=bs(r,i,o);return{segmentIndex:o,segmentationId:i,segmentColor:a}}getOperationData(e){const r=this._editData||this.createEditData(e),{segmentIndex:n,segmentationId:i,brushCursor:o}=this._hoverData||this.createHoverData(e),{data:a,metadata:s={}}=o||{},{viewPlaneNormal:c,viewUp:l}=s,f=this.configuration.preview?.previewColors?.[n],{viewport:u}=Ce(e),d=bs(u.id,i,n);if(!f&&!d)return;let h=null,g=null;return this.configuration.preview?.enabled&&(h=f||_de(...d),g=255),{...r,points:a?.handles?.points,segmentIndex:n,viewPlaneNormal:c,previewOnHover:!this._previewData.isDrag,toolGroupId:this.toolGroupId,segmentationId:i,viewUp:l,centerSegmentIndexInfo:this.centerSegmentIndexInfo,activeStrategy:this.configuration.activeStrategy,configuration:this.configuration,previewColor:h,previewSegmentIndex:g,createMemo:this.createMemo.bind(this),hoverData:this._hoverData}}addPreview(e=this._previewData.element,r){const{_previewData:n}=this,i=r?.acceptReject;i===!0?this.acceptPreview(e):i===!1&&this.rejectPreview(e);const o=Ce(e),a=this.applyActiveStrategyCallback(o,this.getOperationData(e),ht.AddPreview);return n.isDrag=!0,a?.modified&&(n.preview=a,n.element=e),a}rejectPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const r=Ce(e);this.applyActiveStrategyCallback(r,this.getOperationData(e),ht.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(e=this._previewData.element){if(!e)return;const r=this.getOperationData(e);this.memo&&this.memo.id&&this.acceptedMemoIds.set(this.memo.id,{element:e,segmentIndex:r.segmentIndex});const n=Ce(e);this.applyActiveStrategyCallback(n,r,ht.AcceptPreview),this.doneEditMemo(),this._previewData.preview=null,this._previewData.isDrag=!1}static viewportContoursToLabelmap(e,r){const n=r?.removeContours??!0,i=U0(),o=Rg(e,i);if(!o?.length)return;const a=o.filter(m=>m.data.contour?.polyline?.length);if(!a.length)return;const c=new sh({},{configuration:{strategies:{FILL_INSIDE_CIRCLE:B2},activeStrategy:"FILL_INSIDE_CIRCLE"}}).addPreview(e.element),{memo:l,segmentationId:f}=c,u=l?.voxelManager,d=u.sourceVoxelManager||u,{dimensions:h}=u,g=e.getDefaultActor().actor.getMapper().getInputData();for(const m of a){const w=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],{polyline:v}=m.data.contour;for(const b of v)g.worldToIndex(b).forEach((O,M)=>{w[M][0]=Math.min(w[M][0],O),w[M][1]=Math.max(w[M][1],O)});w.forEach((b,I)=>{b[0]=Math.round(Math.max(0,b[0])),b[1]=Math.round(Math.min(h[I]-1,b[1]))});const y=no(f),C=m.data.handles?.[0]||v[0],x=g.worldToIndex(C).map(Math.round),T=d.getAtIJKPoint(x)||0;let S=!1,_=!1;for(const b of v){const I=g.worldToIndex(b).map(Math.round),O=d.getAtIJKPoint(I);O===T?S=!0:O>=0&&(_=!0)}const D=S&&_?T:T===0?y:0;for(let b=w[0][0];b<=w[0][1];b++)for(let I=w[1][0];I<=w[1][1];I++)for(let O=w[2][0];O<=w[2][1];O++){const M=g.indexToWorld([b,I,O]);$x(M,v)&&u.setAtIJK(b,I,O,D)}n&&kt(m.annotationUID)}const p=u.getArrayOfModifiedSlices();ui(f,p)}};sh.previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1};let af=sh;function _de(t,e,r,n,i=.4){return[Math.round(t+(255-t)*i),Math.round(e+(255-e)*i),Math.round(r+(255-r)*i),n]}class sf extends af{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:B2,ERASE_INSIDE_CIRCLE:nA,FILL_INSIDE_SPHERE:eA,ERASE_INSIDE_SPHERE:tA,THRESHOLD_INSIDE_CIRCLE:sde,THRESHOLD_INSIDE_SPHERE:dde,THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL:hde},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",brushSize:25,useCenterSegmentIndex:!1,preview:{enabled:!1,previewColors:{0:[255,255,255,128]},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[ht.AcceptPreview]:{method:ht.AcceptPreview,bindings:[{key:"Enter"}]},[ht.RejectPreview]:{method:ht.RejectPreview,bindings:[{key:"Escape"}]},[ht.Interpolate]:{method:ht.Interpolate,bindings:[{key:"i"}],configuration:{useBallStructuringElement:!0,noUseDistanceTransform:!0,noUseExtrapolation:!0}},interpolateExtrapolation:{method:ht.Interpolate,bindings:[{key:"e"}],configuration:{}}}}}){super(e,r),this._lastDragInfo=null,this.onSetToolPassive=n=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=n=>{this.disableCursor()},this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c}=s;this._editData=this.createEditData(o),this._activateDraw(o),St(o),n.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const l=Da(a.canvas),f=c.canvasToWorld([l[0],l[1]]);this._lastDragInfo={canvas:l,world:ea(f)};const u=this._hoverData||this.createHoverData(o);Me(u.viewportIdsToRender);const d=this.getOperationData(o);return d?(this.applyActiveStrategyCallback(s,d,ht.OnInteractionStart),!0):!1},this.mouseMoveCallback=n=>{if(this.isPrimary&&this.mode===_n.Active){if(this.updateCursor(n),!this.configuration.preview.enabled)return;const{previewTimeMs:i,previewMoveDistance:o,dragMoveDistance:a}=this.configuration.preview,{currentPoints:s,element:c}=n.detail,{canvas:l}=s,{startPoint:f,timer:u,timerStart:d,isDrag:h}=this._previewData;if(h)return;const g=Xn(l,f),p=Date.now()-d;if((g>o||p>i&&g>a)&&(u&&(window.clearTimeout(u),this._previewData.timer=null),h||this.rejectPreview(c)),!this._previewData.timer){const m=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:m,startPoint:l,element:c})}}},this.previewCallback=()=>{if(this._previewData.isDrag){this._previewData.timer=null;return}this._previewData.timer=null;const n=this.getOperationData(this._previewData.element),i=Ce(this._previewData.element);if(!i)return;const{viewport:o}=i,a=this.configuration.activeStrategy,s=p3({operationData:n,viewport:o,strategy:a});if(!n)return;const c=this.createMemo(n.segmentationId,s.segmentationVoxelManager);this._previewData.preview=this.applyActiveStrategyCallback(Ce(this._previewData.element),{...n,...s,memo:c},ht.Preview)},this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c}=s;this.updateCursor(n);const{viewportIdsToRender:l}=this._hoverData;Me(l);const f=Xn(a.canvas,this._previewData.startPoint),{dragTimeMs:u,dragMoveDistance:d}=this.configuration.preview;if(!this._previewData.isDrag&&Date.now()-this._previewData.timerStart<u&&f<d)return;if(this._previewData.timer&&(window.clearTimeout(this._previewData.timer),this._previewData.timer=null),!this._lastDragInfo){const w=this._previewData.startPoint,v=c.canvasToWorld([w[0],w[1]]);this._lastDragInfo={canvas:Da(w),world:ea(v)}}const h=a.canvas,g=c.canvasToWorld([h[0],h[1]]);this._hoverData=this.createHoverData(o,h),this._calculateCursor(o,h);const p=this.getOperationData(o);if(!p)return;p.strokePointsWorld=[ea(this._lastDragInfo.world),ea(g)],this._previewData.preview=this.applyActiveStrategy(s,p);const m=Da(h);this._lastDragInfo={canvas:m,world:ea(g)},this._previewData.element=o,this._previewData.timerStart=Date.now()+u,this._previewData.isDrag=!0,this._previewData.startPoint=m},this._endCallback=n=>{const i=n.detail,{element:o}=i,a=Ce(o),s=this.getOperationData(o);s&&(!this._previewData.preview&&!this._previewData.isDrag&&this.applyActiveStrategy(a,s),this.doneEditMemo(),this._deactivateDraw(o),Vt(o),this.updateCursor(n),this._editData=null,this._lastDragInfo=null,this.applyActiveStrategyCallback(a,s,ht.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(o))},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}updateCursor(e){const r=e.detail,{element:n}=r,{currentPoints:i}=r,o=i.canvas;this._hoverData=this.createHoverData(n,o),this._calculateCursor(n,o),this._hoverData&&(sf.activeCursorTool=this,Me(this._hoverData.viewportIdsToRender))}_calculateCursor(e,r){const n=Ce(e);this.applyActiveStrategyCallback(n,this.getOperationData(e),ht.CalculateCursorGeometry)}getStatistics(e,r){if(!e)return;const n=Ce(e);return this.applyActiveStrategyCallback(n,this.getOperationData(e),ht.GetStatistics,r)}rejectPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const r=Ce(e);r&&(this.applyActiveStrategyCallback(r,this.getOperationData(e),ht.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1)}acceptPreview(e=this._previewData.element){e&&super.acceptPreview(e)}interpolate(e,r){if(!e)return;const n=Ce(e);this._previewData.preview=this.applyActiveStrategyCallback(n,this.getOperationData(e),ht.Interpolate,r.configuration),this._previewData.isDrag=!0}invalidateBrushCursor(){if(this._hoverData===void 0)return;const{data:e}=this._hoverData.brushCursor,{viewport:r}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(r)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,r){if(!this._hoverData||sf.activeCursorTool!==this)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;if(this._hoverData.brushCursor.data.invalidated===!0){const{centerCanvas:a}=this._hoverData,{element:s}=n;this._calculateCursor(s,a)}this.applyActiveStrategyCallback(e,this.getOperationData(n.element),ht.RenderCursor,r)}}sf.toolName="Brush";function J0(t,e){const r=Kr(t);if(r===void 0)return[];const n=r._toolInstances;return Object.keys(n).length?e&&n[e]?[n[e]]:Object.values(n).filter(o=>o instanceof sf):[]}function Ede(t,e,r){const n=Kr(t);if(n===void 0)return;J0(t,r).forEach(a=>{const s=a.configuration.minRadius,c=a.configuration.maxRadius;let l=s?Math.max(e,s):e;l=c?Math.min(l,c):l,a.configuration.brushSize=l,a.invalidateBrushCursor()});const o=n.getViewportIds();Me(o)}function bde(t,e){const r=Kr(t);if(r===void 0)return;const n=r._toolInstances;if(!Object.keys(n).length)return;const o=J0(t,e)[0];if(o)return o.configuration.brushSize}function Dde(t,e){const r=Kr(t);if(r===void 0||(J0(t).forEach(a=>{a.configuration.activeStrategy.toLowerCase().includes("threshold")&&(a.configuration={...a.configuration,threshold:{...a.configuration.threshold,...e}})}),!r.getViewportsInfo().length))return;const o=r.getViewportIds();Me(o)}function Ide(t){const e=Kr(t);if(e===void 0)return;const r=e._toolInstances;if(!Object.keys(r).length)return;const i=J0(t)[0];if(i)return i.configuration.threshold.range}const ch=class ch{static statsInit(e){const{storePointData:r,indices:n,mode:i}=e;this.mode=i,this.indices=n,this.calculators.clear(),this.mode==="individual"?n.forEach(o=>{this.calculators.set(o,new d4({storePointData:r}))}):this.calculators.set(n,new d4({storePointData:r}))}static statsCallback(e){const{segmentIndex:r,...n}=e;if(!r)throw new Error("Segment index is required for stats calculation");const i=this.mode==="individual"?this.calculators.get(r):this.calculators.get(this.indices);if(!i)throw new Error(`No calculator found for segment ${r}`);i.statsCallback(n)}static getStatistics(e){if(this.mode==="individual"){const n={};return this.calculators.forEach((i,o)=>{n[o]=i.getStatistics(e)}),n}return this.calculators.get(this.indices).getStatistics(e)}};ch.calculators=new Map,ch.indices=[],ch.mode="collective";let K5=ch;function Mde(t,e,r,n,i){if(!i)throw new Error("Segmentation ID is required to be passed inside thresholdSegmentationByRange");const{baseVolumeIdx:o,volumeInfoList:a}=cO(t,r),{voxelManager:s}=a[o],c=s,l=t.voxelManager.getScalarDataLength(),f=t.voxelManager;return a.forEach(u=>{const{volumeSize:d}=u;d===l?Pde(f,c,e,u):Ode(f,c,e,u,a,o,n)}),ui(i),t}function Ode(t,e,r,n,i,o,a){const{imageData:s,lower:c,upper:l,dimensions:f}=n;let u,d,h;const g=t.getScalarDataLength();for(let p=0;p<g;p++)if(g.getAtIndex(p)===r){const m=Ex(s,f,i[o].spacing,i[o].imageData.getPoint(p)),w=({value:y})=>{u=u+1,y>=h.lower&&y<=h.upper&&(d=d+1)};u=0,d=0,h={lower:c,upper:l};let v=!1;t.forEach(w,{imageData:s,boundsIJK:m}),v=a===0?d>0:d===u,t.setAtIndex(p,v?r:0)}return{total:u,range:h,overlaps:d}}function Pde(t,e,r,n){const{lower:i,upper:o}=n,a=t.getScalarDataLength();for(let s=0;s<a;s++)if(t.getAtIndex[s]===r){const c=e.getAtIndex(s);t.setAtIndex(s,c>=i&&c<=o?r:0)}}function m4(t,e,r){const n=r.toIJK(t),i=r.toIJK(e),o=Ie(),{testIJK:a}=r,s=an(Ie(),n,i),c=Math.round(Math.max(...s.map(Math.abs)));if(c<2)return!0;const l=Jn(Ie(),s,1/c);for(let f=1;f<c;f++)if(tn(o,i,l,f),!a(o))return!1;return!0}function Rde({dimensions:t,imageData:e,voxelManager:r,segmentIndex:n,containedSegmentIndices:i}){const o=t[0],a=o*t[1];return{testCenter:(s,c)=>{const l=nr(Ie(),s,c).map(m=>m/2),f=e.worldToIndex(l).map(Math.round),[u,d,h]=f,g=u+d*o+h*a,p=r.getAtIndex(g);return p===n||i?.has(p)},toIJK:s=>e.worldToIndex(s),testIJK:s=>{const[c,l,f]=s,u=Math.round(c)+Math.round(l)*o+Math.round(f)*a,d=r.getAtIndex(u);return d===n||i?.has(d)}}}function Ade(t,e,r){const n=Ae.getVolume(t);if(!n){console.warn(`No volume found for ${t}`);return}return Rde({dimensions:n.dimensions,imageData:n.imageData,voxelManager:n.voxelManager,segmentIndex:e,containedSegmentIndices:r})}const wd=.01;function Lde(t,e,r){const{sliceContours:n}=t,{segmentIndex:i,containedSegmentIndices:o}=r;let a;const s=Ade(e,i,o);for(const c of n){const l=Nde(c,s,a);l&&(a=l)}return a&&Object.assign(a,r),a}function Nde(t,e,r={maxMajor:0,maxMinor:0}){const{points:n}=t.polyData,{maxMinor:i,maxMajor:o}=r;let a=o*o,s=i*i,c;for(let m=0;m<n.length;m++)for(let w=m+1;w<n.length;w++){const v=n[m],y=n[w],C=a5(v,y);C<a||C-wd<a+wd&&c||e.testCenter(v,y)&&m4(v,y,e)&&(a=C-wd,c=[m,w],s=0)}if(!c)return;a=Math.sqrt(a+wd);const l=n[c[0]],f=n[c[1]],u=an(Ie(),l,f);Jn(u,u,1/a);let d;for(let m=0;m<n.length;m++)for(let w=m+1;w<n.length;w++){const v=n[m],y=n[w],C=a5(v,y);if(C<=s)continue;const x=an(Ie(),v,y);Math.abs(ft(x,u))/Math.sqrt(C)>wd||e.testCenter(v,y)&&m4(v,y,e)&&(s=C,d=[m,w])}if(!d)return;s=Math.sqrt(s);const h=n[d[0]],g=n[d[1]];return{majorAxis:[l,f],minorAxis:[h,g],maxMajor:a,maxMinor:s,...t}}async function sA(t){const e=await UP({segmentations:t});if(!e?.length||!e[0].sliceContours.length)return;const{segments:r=[null,{label:"Unspecified",color:null,containedSegmentIndices:null}]}=t,n=X0(t.segmentationId);if(!n)return;const i=r.findIndex(o=>!!o);if(i!==-1)return r[i].segmentIndex=i,Lde(e[0],n.volumeId,r[i])}function cA(t,e){const{majorAxis:r,minorAxis:n,label:i="",sliceIndex:o}=t,[a,s]=r,[c,l]=n,f=[a,s,c,l];return{highlighted:!0,invalidated:!0,metadata:{toolName:"Bidirectional",...e.getViewReference({sliceIndex:o})},data:{handles:{points:f,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:i,cachedStats:{}},isLocked:!1,isVisible:!0}}const ic=class ic extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Vde}}){super(e,r),this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles;let u=c.worldToCanvas(f[0]),d=c.worldToCanvas(f[1]),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},g=Ir([h.start.x,h.start.y],[h.end.x,h.end.y],[o[0],o[1]]);return g<=a||(u=c.worldToCanvas(f[2]),d=c.worldToCanvas(f[3]),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},g=Ir([h.start.x,h.start.y],[h.end.x,h.end.y],[o[0],o[1]]),g<=a)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),St(a),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,c=i.data;i.highlighted=!0;let l=!1,f;o.worldPosition?l=!0:f=c.handles.points.findIndex(g=>g===o);const u=vt(s,this.getToolName());St(s),this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s);const d=Ce(s),{renderingEngine:h}=d;Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;this.doneEditMemo(),f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const{renderingEngine:u}=Ce(o);if(this.editData.handleIndex!==void 0){const{points:d}=f.handles,h=Nr(d[0],d[1]);if(Nr(d[2],d[3])>h){const p=[[...d[2]],[...d[3]]],m=[...d[0]],w=[...d[1]],v=xt();Qo(v,p[1][0]-p[0][0],p[1][1]-p[1][0]);const y=xt();Qo(y,-v[1],v[0]);const C=xt();Qo(C,w[0]-m[0],w[1]-m[0]);let x;oc(C,y)>0?x=[m,w]:x=[w,m],f.handles.points=[p[0],p[1],x[0],x[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=Ce(a),{viewport:c}=s,{worldToCanvas:l}=c,{annotation:f,viewportIdsToRender:u,handleIndex:d,newAnnotation:h}=this.editData;this.createMemo(a,f,{newAnnotation:h});const{data:g}=f,p=o.world;g.handles.points[d]=[...p];const m=g.handles.points.map(l),w={longLineSegment:{start:{x:m[0][0],y:m[0][1]},end:{x:m[1][0],y:m[1][1]}},shortLineSegment:{start:{x:m[2][0],y:m[2][1]},end:{x:m[3][0],y:m[3][1]}}},y=Xn(m[0],m[1])/3,C=w.longLineSegment.start.x-w.longLineSegment.end.x,x=w.longLineSegment.start.y-w.longLineSegment.end.y,T=Math.sqrt(C*C+x*x),S=C/T,_=x/T,E=(w.longLineSegment.start.x+w.longLineSegment.end.x)/2,D=(w.longLineSegment.start.y+w.longLineSegment.end.y)/2,b=E+y*_,I=D-y*S,O=E-y*_,M=D+y*S;g.handles.points[2]=c.canvasToWorld([b,I]),g.handles.points[3]=c.canvasToWorld([O,M]),f.invalidated=!0,Me(u),Gt(f,a,Nt.HandlesUpdated),this.editData.hasMoved=!0},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragModifyHandle(n),a.invalidated=!0;Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this._dragModifyHandle=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=Ce(a),{viewport:c}=s,{annotation:l,handleIndex:f}=this.editData,{data:u}=l,d=o.world,h=[c.worldToCanvas(u.handles.points[0]),c.worldToCanvas(u.handles.points[1]),c.worldToCanvas(u.handles.points[2]),c.worldToCanvas(u.handles.points[3])],g={start:{x:h[0][0],y:h[0][1]},end:{x:h[1][0],y:h[1][1]}},p={start:{x:h[2][0],y:h[2][1]},end:{x:h[3][0],y:h[3][1]}},m=[...d],w=c.worldToCanvas(m);if(f===0||f===1){const y=h[f===0?1:0],C=Qo(xt(),w[0]-y[0],w[1]-y[1]),x=Qo(xt(),h[f][0]-y[0],h[f][1]-y[1]);cs(C,C),cs(x,x);const T={start:{x:y[0],y:y[1]},end:{x:w[0],y:w[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(T,p))return;const S=y,_=this._getSignedAngle(x,C);let E=h[2][0],D=h[2][1],b=h[3][0],I=h[3][1];E-=S[0],D-=S[1],b-=S[0],I-=S[1];const O=E*Math.cos(_)-D*Math.sin(_),M=E*Math.sin(_)+D*Math.cos(_),R=b*Math.cos(_)-I*Math.sin(_),A=b*Math.sin(_)+I*Math.cos(_);E=O+S[0],D=M+S[1],b=R+S[0],I=A+S[1];const B=c.canvasToWorld([E,D]),k=c.canvasToWorld([b,I]);u.handles.points[f]=m,u.handles.points[2]=B,u.handles.points[3]=k}else{const v=f===2?3:2,y={longLineSegment:{start:g.start,end:g.end},shortLineSegment:{start:p.start,end:p.end}},C=Mn(xt(),[y.longLineSegment.end.x,y.longLineSegment.end.y],[y.longLineSegment.start.x,y.longLineSegment.start.y]),x=cs(xt(),C),T=Mn(xt(),[w[0],w[1]],[h[f][0],h[f][1]]),S=bm(T),_=this._getSignedAngle(x,T),E=Math.cos(_)*S,D=bd(xt(),[h[v][0],h[v][1]],x,E);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:w[0],y:w[1]},end:{x:D[0],y:D[1]}},{start:{x:y.longLineSegment.start.x,y:y.longLineSegment.start.y},end:{x:y.longLineSegment.end.x,y:y.longLineSegment.end.y}})||!c1([w[0],w[1]],[D[0],D[1]],[g.start.x,g.start.y],[g.end.x,g.end.y]))return;u.handles.points[v]=c.canvasToWorld(D),u.handles.points[f]=m}},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!0;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles,v=m.map(ie=>a.worldToCanvas(ie));u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x,shadow:T}=this.getAnnotationStyle({annotation:h,styleSpecifier:u});if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,width:null,unit:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let S;if(!mr(g))continue;!pr(g)&&!this.editData&&w!==null&&(S=[v[w]]);const _=!!Gi("showHandlesAlways",{});(S||_)&&Wn(i,g,"0",_?v:S,{color:y});const E=`${g}-line-1`,D=`${g}-line-2`;Yt(i,g,"0",v[0],v[1],{color:y,lineDash:x,lineWidth:C,shadow:T},E),Yt(i,g,"1",v[2],v[3],{color:y,lineDash:x,lineWidth:C,shadow:T},D),o=!0;const O=this.getLinkedTextBoxStyle(u,h);if(!O.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const M=this.configuration.getTextLines(p,l);if(!M||M.length===0)continue;let R;p.handles.textBox.hasMoved||(R=po(v),p.handles.textBox.worldPosition=a.canvasToWorld(R));const A=a.worldToCanvas(p.handles.textBox.worldPosition),k=Ei(i,g,"1",M,A,v,{},O),{x:L,y:F,width:j,height:J}=k;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([L,F]),topRight:a.canvasToWorld([L+j,F]),bottomLeft:a.canvasToWorld([L,F+J]),bottomRight:a.canvasToWorld([L+j,F+J])}}return o},this._movingLongAxisWouldPutItThroughShortAxis=(n,i)=>{const o=xt();Qo(o,i.end.x-i.start.x,i.end.y-i.start.y),cs(o,o);const a={start:{x:i.start.x-o[0]*10,y:i.start.y-o[1]*10},end:{x:i.end.x+o[0]*10,y:i.end.y+o[1]*10}};return!c1([a.start.x,a.start.y],[a.end.x,a.end.y],[n.start.x,n.start.y],[n.end.x,n.end.y])},this._calculateCachedStats=(n,i,o)=>{const{data:a}=n,{element:s}=o.viewport;a.handles.points[0],a.handles.points[1],a.handles.points[2],a.handles.points[3];const{cachedStats:c}=a,l=Object.keys(c);for(let u=0;u<l.length;u++){const d=l[u],h=this.getTargetImageData(d);if(!h)continue;const{imageData:g,dimensions:p}=h,m=a.handles.points.map(D=>g.worldToIndex(D)),w=m.slice(0,2),v=m.slice(2,4),y=Fo(h,m),C=ic.calculateLengthInIndex(y,w),x=ic.calculateLengthInIndex(y,v),{unit:T}=y,S=C>x?C:x,_=C>x?x:C,E=T;this.isHandleOutsideImage=!ic.isInsideVolume(p,m),c[d]={length:S,width:_,unit:T,widthUnit:E,statsArray:[{value:S,name:"height",unit:T,type:ra.Linear},{value:_,name:"width",unit:T,type:ra.Linear}]}}const f=n.invalidated;return n.invalidated=!1,f&&Gt(n,s,Nt.StatsUpdated),c},this._getSignedAngle=(n,i)=>Math.atan2(n[0]*i[1]-n[1]*i[0],n[0]*i[0]+n[1]*i[1]),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,o=n.world;this.isDrawing=!0;const a=this.createAnnotation(e,[[...o],[...o],[...o],[...o]]);Ft(a,i);const s=vt(i,this.getToolName());return this.editData={annotation:a,viewportIdsToRender:s,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),St(i),e.preventDefault(),Me(s),a}};ic.toolName="Bidirectional",ic.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=ic.hydrateBase(ic,i,r[0],n),[f,u]=r,[d,h]=f,[g,p]=u,m=[d,h,g,p],{toolInstance:w,...v}=n||{},y={annotationUID:n?.annotationUID||un(),data:{handles:{points:m,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...v}};return Ft(y,l.element),Me([l.id]),y};let jh=ic;function Vde(t,e){const{cachedStats:r,label:n}=t,{length:i,width:o,unit:a}=r[e],s=[];return n&&s.push(n),i===void 0||s.push(`L: ${Ht(i)} ${a||a}`,`W: ${Ht(o)} ${a}`),s}async function kde(t,e){console.warn("Deprecation Alert: There is a new getSegmentLargestBidirectional function that handles volume, stack and individual segment cases properly. This function is deprecated and will be removed in a future version.");const{data:r}=e,n=Ce(t),i=(r.getSegment||Fde)(n,r);if(!i)return;const o=n.viewport.getFrameOfReferenceUID(),a=V2(),{segmentIndex:s,segmentationId:c}=i,l=Ra.getAnnotations(this.toolName||jh.toolName,o);let f=!1;const u=l.filter(h=>{const g=h.data.segment;return g?(g.segmentationId===c&&g.segmentIndex===s&&(f=!0,h.data.segment=g),!0):!1});f||u.push({data:{segment:i}});let d;if(u.forEach(async h=>{const g=[],p=h.data.segment,{segmentIndex:m,segmentationId:w}=p;g[m]=p,Ra.removeAnnotation(h.annotationUID);const v=await sA({...a.find(x=>x.segmentationId===w),segments:g});if(!v)return;const y=cA(v,n.viewport);y.annotationUID=h.annotationUID,y.data.segment=p;const C=Ra.addAnnotation(y,o);if(p.segmentIndex===i.segmentIndex&&p.segmentationId===i.segmentationId){d=v;const{style:x}=i;x&&vx.setAnnotationStyles(C,x)}}),d){const{sliceIndex:h}=d,g=n.viewport.getImageIds();ux(t,{imageIndex:g.length-1-h}),n.viewport.render()}else console.warn("No bidirectional found");return d}function Fde(t,e){const r=V2();if(!r.length)return;const n=e.segmentationId||r[0].segmentationId,i=e.segmentIndex??no(n);if(!i)return;const o=e.segmentData?.get(i);return{label:`Segment ${i}`,segmentIndex:i,segmentationId:n,...o}}function lA(t){const e=Kr(t);if(e===void 0)return;J0(t).forEach(a=>{a.invalidateBrushCursor()});const n=e.getViewportsInfo();if(!Object.keys(n).map(a=>n[a]).length)return;const o=e.getViewportIds();Me(o)}function E3(t,e,r={}){const n=Ut(t),i=n.representationData,o=r?.representationType??Object.keys(i)[0];if(!o)throw new Error(`Segmentation ${t} does not have any representations`);switch(o){case yt.Labelmap:return Ude(n,e,r);case yt.Contour:return Bde(n,e,r);default:return}}function Ude(t,e,{viewport:r}){const n=t.representationData.Labelmap;if(r instanceof ir){const{volumeId:h}=n,g=Ae.getVolume(h);return g?g.imageData.getScalarValueFromWorld(e):void 0}const i=Ic(r.id,t.segmentationId);if(i.length>1){console.warn("Segment selection for labelmaps with multiple imageIds in stack viewports is not supported yet.");return}const o=i[0];if(!Ae.getImage(o))return;const c=y2(r.id,t.segmentationId)?.actor.getMapper().getInputData(),l=Lr(c,e),f=c.getDimensions();return(c.voxelManager||La.createScalarVolumeVoxelManager({dimensions:f,scalarData:c.getPointData().getScalars().getData()})).getAtIJKPoint(l)}function Bde(t,e,{viewport:r}){const n=t.representationData.Contour,i=Array.from(n.annotationUIDsMap.keys()),{viewPlaneNormal:o}=r.getCamera();for(const a of i){const s=n.annotationUIDsMap.get(a);if(s)for(const c of s){const l=vn(c);if(!l)continue;const{polyline:f}=l.data.contour;if(Dt(o,l.metadata.viewPlaneNormal)&&$x(e,f))return Number(a)}}}function uA(t,e,{viewport:r,searchRadius:n}){const o=Ut(t).representationData.Labelmap;if(r instanceof ir){const{volumeId:p}=o,m=Ae.getVolume(p);if(!m)return;const w=m.voxelManager,v=m.imageData,y=Lr(v,e),C=w.getAtIJK(y[0],y[1],y[2]),x=r.worldToCanvas(e);return Wde(x,C,r,v,n)?C:void 0}const a=kl(r.id,t);if(!Ae.getImage(a))return;const l=y2(r.id,t)?.actor.getMapper().getInputData(),f=Lr(l,e),u=l.getDimensions(),d=l.voxelManager||La.createScalarVolumeVoxelManager({dimensions:u,scalarData:l.getPointData().getScalars().getData()}),h=d.getAtIJKPoint(f);return Gde(f,u,d,h)?h:void 0}function fA(t,e,r=1){const n=Array.from({length:2*r+1},(i,o)=>o-r);for(const i of n)for(const o of n)for(const a of n){if(i===0&&o===0&&a===0)continue;const s=t(i,o,a);if(s!==void 0&&e!==s)return!0}return!1}function Gde(t,e,r,n,i){return fA((a,s,c)=>{const l=[t[0]+a,t[1]+s,t[2]+c];return r.getAtIJK(l[0],l[1],l[2])},n,i)}function Wde(t,e,r,n,i){return fA((a,s)=>{const c=[t[0]+a,t[1]+s],l=r.canvasToWorld(c),f=n.get("voxelManager").voxelManager,u=Lr(n,l);return f.getAtIJK(u[0],u[1],u[2])},e,i)}function dA(t){const e=Ut(t),{annotationUIDsMap:r}=e.representationData.Contour;for(const[n,i]of r.entries())if(Array.from(i).find(a=>vn(a).highlighted))return n}const $de=`
const MAX_STRENGTH = 65535f;

// Workgroup size - X*Y*Z must be multiple of 32 for better performance
override workGroupSizeX = 1u;
override workGroupSizeY = 1u;
override workGroupSizeZ = 1u;

// Compare the current voxel to neighbors using a 9x9x9 window
override windowSize = 9i;

struct Params {
  size: vec3u,
  iteration: u32,
}

// New structure to track bounds of modified voxels
struct Bounds {
  minX: atomic<i32>,
  minY: atomic<i32>,
  minZ: atomic<i32>,
  maxX: atomic<i32>,
  maxY: atomic<i32>,
  maxZ: atomic<i32>,
}

@group(0) @binding(0) var<uniform> params: Params;
@group(0) @binding(1) var<storage> volumePixelData: array<f32>;
@group(0) @binding(2) var<storage, read_write> labelmap: array<u32>;
@group(0) @binding(3) var<storage, read_write> strengthData: array<f32>;
@group(0) @binding(4) var<storage> prevLabelmap: array<u32>;
@group(0) @binding(5) var<storage> prevStrengthData: array<f32>;
@group(0) @binding(6) var<storage, read_write> updatedVoxelsCounter: array<atomic<u32>>;
@group(0) @binding(7) var<storage, read_write> modifiedBounds: Bounds;

fn getPixelIndex(ijkPos: vec3u) -> u32 {
  let numPixelsPerSlice = params.size.x * params.size.y;
  return ijkPos.x + ijkPos.y * params.size.x + ijkPos.z * numPixelsPerSlice;
}

fn updateBounds(position: vec3i) {
  // Atomically update min bounds (use min operation)
  let oldMinX = atomicMin(&modifiedBounds.minX, position.x);
  let oldMinY = atomicMin(&modifiedBounds.minY, position.y);
  let oldMinZ = atomicMin(&modifiedBounds.minZ, position.z);

  // Atomically update max bounds (use max operation)
  let oldMaxX = atomicMax(&modifiedBounds.maxX, position.x);
  let oldMaxY = atomicMax(&modifiedBounds.maxY, position.y);
  let oldMaxZ = atomicMax(&modifiedBounds.maxZ, position.z);
}

@compute @workgroup_size(workGroupSizeX, workGroupSizeY, workGroupSizeZ)
fn main(
  @builtin(global_invocation_id) globalId: vec3u,
) {
  // Make sure it will not get out of bounds for volume with sizes that
  // are not multiple of workGroupSize
  if (
    globalId.x >= params.size.x ||
    globalId.y >= params.size.y ||
    globalId.z >= params.size.z
  ) {
    return;
  }

  // Initialize bounds for the first iteration
  if (params.iteration == 0 && globalId.x == 0 && globalId.y == 0 && globalId.z == 0) {
    // Initialize to opposite extremes to ensure any update will improve the bounds
    atomicStore(&modifiedBounds.minX, i32(params.size.x));
    atomicStore(&modifiedBounds.minY, i32(params.size.y));
    atomicStore(&modifiedBounds.minZ, i32(params.size.z));
    atomicStore(&modifiedBounds.maxX, -1);
    atomicStore(&modifiedBounds.maxY, -1);
    atomicStore(&modifiedBounds.maxZ, -1);
  }

  let currentCoord = vec3i(globalId);
  let currentPixelIndex = getPixelIndex(globalId);

  let numPixels = arrayLength(&volumePixelData);
  let currentPixelValue = volumePixelData[currentPixelIndex];

  if (params.iteration == 0) {
    // All non-zero initial labels are given maximum strength
    strengthData[currentPixelIndex] = select(MAX_STRENGTH, 0., labelmap[currentPixelIndex] == 0);

    // Update bounds for non-zero initial labels
    if (labelmap[currentPixelIndex] != 0) {
      updateBounds(currentCoord);
    }
    return;
  }

  // It should at least copy the values from previous state
  var newLabel = prevLabelmap[currentPixelIndex];
  var newStrength = prevStrengthData[currentPixelIndex];

  let window = i32(ceil(f32(windowSize - 1) * .5));
  let minWindow = -1i * window;
  let maxWindow = 1i * window;

  for (var k = minWindow; k <= maxWindow; k++) {
    for (var j = minWindow; j <= maxWindow; j++) {
      for (var i = minWindow; i <= maxWindow; i++) {
        // Skip current voxel
        if (i == 0 && j == 0 && k == 0) {
          continue;
        }

        let neighborCoord = currentCoord + vec3i(i, j, k);

        //  Boundary conditions. Do not grow outside of the volume
        if (
          neighborCoord.x < 0i || neighborCoord.x >= i32(params.size.x) ||
          neighborCoord.y < 0i || neighborCoord.y >= i32(params.size.y) ||
          neighborCoord.z < 0i || neighborCoord.z >= i32(params.size.z)
        ) {
          continue;
        }

        let neighborIndex = getPixelIndex(vec3u(neighborCoord));
        let neighborPixelValue = volumePixelData[neighborIndex];
        let prevNeighborStrength = prevStrengthData[neighborIndex];
        let strengthCost = abs(neighborPixelValue - currentPixelValue);
        let takeoverStrength = prevNeighborStrength - strengthCost;

        if (takeoverStrength > newStrength) {
          newLabel = prevLabelmap[neighborIndex];
          newStrength = takeoverStrength;
        }
      }
    }
  }

  if (labelmap[currentPixelIndex] != newLabel) {
    atomicAdd(&updatedVoxelsCounter[params.iteration], 1u);

    // Update bounds for modified voxels
    updateBounds(currentCoord);
  }

  labelmap[currentPixelIndex] = newLabel;
  strengthData[currentPixelIndex] = newStrength;
}
`,zde=1024*1024*1024,v4=1.99*zde,gy={windowSize:3,maxProcessingTime:3e4,inspection:{numCyclesInterval:5,numCyclesBelowThreshold:3,threshold:1e-4}};async function W2(t,e,r=gy){const n=[8,8,4],{windowSize:i,maxProcessingTime:o}=Object.assign({},gy,r),a=Object.assign({},gy.inspection,r.inspection),s=Ae.getVolume(t),c=Ae.getVolume(e),[l,f,u]=s.dimensions;if(c.dimensions[0]!==l||c.dimensions[1]!==f||c.dimensions[2]!==u)throw new Error("Volume and labelmap must have the same size");let d=Math.floor(Math.sqrt(f**2+l**2+u**2)/2);d=Math.min(d,500);const h=c.voxelManager.getCompleteScalarDataArray();let g=s.voxelManager.getCompleteScalarDataArray();g instanceof Float32Array||(g=new Float32Array(g));const p={maxStorageBufferBindingSize:v4,maxBufferSize:v4},w=await(await navigator.gpu?.requestAdapter()).requestDevice({requiredLimits:p}),v=g.byteLength,y=d*Uint32Array.BYTES_PER_ELEMENT,C=6*Int32Array.BYTES_PER_ELEMENT,x=w.createShaderModule({code:$de}),T=3,S=new Uint32Array([l,f,u,0]),_=w.createBuffer({size:S.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),E=w.createBuffer({size:v,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});w.queue.writeBuffer(E,0,g);const D=[0,1].map(()=>w.createBuffer({size:v,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}));w.queue.writeBuffer(D[0],0,new Uint32Array(h));const b=[0,1].map(()=>w.createBuffer({size:v,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST})),I=w.createBuffer({size:y,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}),O=w.createBuffer({size:C,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}),M=new Int32Array([l,f,u,-1,-1,-1]);w.queue.writeBuffer(O,0,M);const R=w.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:6,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:7,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),A=[0,1].map(ge=>{const De=D[ge],Ne=b[ge],We=D[(ge+1)%2],re=b[(ge+1)%2];return w.createBindGroup({layout:R,entries:[{binding:0,resource:{buffer:_}},{binding:1,resource:{buffer:E}},{binding:2,resource:{buffer:De}},{binding:3,resource:{buffer:Ne}},{binding:4,resource:{buffer:We}},{binding:5,resource:{buffer:re}},{binding:6,resource:{buffer:I}},{binding:7,resource:{buffer:O}}]})}),B=w.createComputePipeline({layout:w.createPipelineLayout({bindGroupLayouts:[R]}),compute:{module:x,entryPoint:"main",constants:{workGroupSizeX:n[0],workGroupSizeY:n[1],workGroupSizeZ:n[2],windowSize:i}}}),k=[Math.ceil(l/n[0]),Math.ceil(f/n[1]),Math.ceil(u/n[2])],L=w.createBuffer({size:y,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),F=o?performance.now()+o:0;let j=a.numCyclesInterval,J=0;for(let ge=0;ge<d;ge++){S[T]=ge,w.queue.writeBuffer(_,0,S);const De=w.createCommandEncoder(),Ne=De.beginComputePass();if(Ne.setPipeline(B),Ne.setBindGroup(0,A[ge%2]),Ne.dispatchWorkgroups(k[0],k[1],k[2]),Ne.end(),De.copyBufferToBuffer(I,ge*Uint32Array.BYTES_PER_ELEMENT,L,ge*Uint32Array.BYTES_PER_ELEMENT,Uint32Array.BYTES_PER_ELEMENT),w.queue.submit([De.finish()]),ge>0&&!(ge%j)){await L.mapAsync(GPUMapMode.READ,0,y);const re=L.getMappedRange(0,y),ve=new Uint32Array(re.slice(0))[ge]/g.length;if(L.unmap(),ge>=1&&ve<a.threshold){if(j=1,J++,J===a.numCyclesBelowThreshold)break}else j=a.numCyclesInterval}if(F&&performance.now()>F){console.warn(`Exceeded processing time limit (${o})ms`);break}}const ie=w.createCommandEncoder(),fe=(d+1)%2,ae=w.createBuffer({size:v,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),de=w.createBuffer({size:C,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});ie.copyBufferToBuffer(D[fe],0,ae,0,v),ie.copyBufferToBuffer(O,0,de,0,C),w.queue.submit([ie.finish()]),await ae.mapAsync(GPUMapMode.READ,0,v);const we=ae.getMappedRange(0,v),_e=new Uint32Array(we);h.set(_e),ae.unmap(),await de.mapAsync(GPUMapMode.READ,0,C);const Te=de.getMappedRange(0,C),G=new Int32Array(Te.slice(0));de.unmap();const P=G[0],$=G[1],W=G[2],q=G[3],Q=G[4],ee=G[5];c.voxelManager.setCompleteScalarDataArray(h),c.voxelManager.clearBounds(),c.voxelManager.setBounds([[P,q],[$,Q],[W,ee]])}const{transformWorldToIndex:Hh}=gn,jde=254,Hde=255,Kde=.1,Xde=.8;function qde(t,e){const{topLeftWorld:r,bottomRightWorld:n}=e,i=Hh(t.imageData,r),o=Hh(t.imageData,n);return{...e,topLeftIJK:i,bottomRightIJK:o}}function Yde(t,e){const r=t.imageData.getDirection(),n=mt(r[3],r[4],r[5]),{center:i,radius:o}=e,a=t.imageData,s=tn(Ie(),i,n,-o),c=tn(Ie(),i,n,o),l=BR([c,s],a);return qde(t,l)}function Jde(t,e,r){const n=t.imageData,i=r.getCamera(),{ijkVecRowDir:o,ijkVecColDir:a}=l2(n,i);if([o,a].some(f=>!Dt(Math.abs(f[0]),1)&&!Dt(Math.abs(f[1]),1)&&!Dt(Math.abs(f[2]),1))){console.warn("Oblique view is not supported!");return}const{boundsIJK:c}=Yde(t,e),l={minX:c[0][0],maxX:c[0][1]+1,minY:c[1][0],maxY:c[1][1]+1,minZ:c[2][0],maxZ:c[2][1]+1};return fx(t.volumeId,l,{targetBuffer:{type:"Float32Array"}})}function Zde(t,e,r,n){const i=t.voxelManager.getCompleteScalarDataArray(),o=r.center,[a,s,c]=t.dimensions,l=a*s,f=Hh(t.imageData,o),u=i[f[2]*l+f[1]*a+f[0]],d=n.positiveSeedValue??jde,h=n.positiveSeedVariance??Kde,g=Math.abs(u*h),p=u-g,m=u+g,w=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],v=f[2]*l+f[1]*a+f[0];e.voxelManager.setAtIndex(v,d);const y=[f];for(;y.length;){const C=y.shift(),[x,T,S]=C;for(let _=0,E=w.length;_<E;_++){const D=w[_],b=x+D[0],I=T+D[1],O=S+D[2];if(b<0||b>=a||I<0||I>=s||O<0||O>=c)continue;const M=O*l+I*a+b,R=i[M];e.voxelManager.getAtIndex(M)===d||R<p||R>m||(e.voxelManager.setAtIndex(M,d),y.push([b,I,O]))}}}function Qde(t,e,r,n,i){const o=t.voxelManager.getCompleteScalarDataArray(),[a,s,c]=e.dimensions,l=a*s,{worldVecRowDir:f,worldVecSliceDir:u}=l2(e.imageData,n.getCamera()),d=Hh(t.imageData,r.center),h=o[d[2]*a*s+d[1]*a+d[0]],g=i.negativeSeedVariance??Xde,p=i?.negativeSeedValue??Hde,m=Math.abs(h*g),w=h-m,v=h+m,y=360,C=2*Math.PI/y,x=og(Tc(),u,C),T=ea(f);for(let S=0;S<y;S++){const _=tn(Ie(),r.center,T,r.radius),E=Hh(e.imageData,_),[D,b,I]=E;if(iU(T,T,x),D<0||D>=a||b<0||b>=s||I<0||I>=c)continue;const O=D+b*a+I*l,M=o[O];(M<w||M>v)&&e.voxelManager.setAtIndex(O,p)}}async function ehe(t,e,r,n){const i=await vg(t.volumeId);return Zde(t,i,e,n),Qde(t,i,e,r,n),i}async function hA(t,e,r,n){const i=Ae.getVolume(t),o=Jde(i,e,r),a=await ehe(o,e,r,n);return await W2(o.volumeId,a.volumeId),a}const the=254,nhe=255,rhe=[-1/0,-995],ihe=[0,1900];function ohe(t,e,r){const{negativeSeedValue:n=nhe,negativePixelRange:i=rhe}=r,o=t.voxelManager.getCompleteScalarDataArray(),[a,s,c]=e.dimensions,l=Math.floor(c/2),f=new Array(a*s).fill(!1),u=l*a*s,d=(g,p)=>{const m=[[g,p]];for(;m.length;){const[w,v]=m.shift(),y=v*a+w;if(w<0||w>=a||v<0||v>=s||f[y])continue;f[y]=!0;const C=u+y,x=o[C];x<i[0]||x>i[1]||(e.voxelManager.setAtIndex(C,n),m.push([w-1,v]),m.push([w+1,v]),m.push([w,v-1]),m.push([w,v+1]))}},h=(g,p,m,w)=>{for(let v=g;v!==p;v+=m){const y=w*a+v,C=u+y,x=o[C];if(x<i[0]||x>i[1])break;f[y]||d(v,w)}};for(let g=0;g<s;g++)h(0,a-1,1,g),h(a-1,0,-1,g)}function ahe(t,e,r){const{positiveSeedValue:n=the,positivePixelRange:i=ihe}=r,o=t.voxelManager.getCompleteScalarDataArray();e.voxelManager.getCompleteScalarDataArray();const[a,s,c]=e.dimensions,l=Math.floor(c/2),f=Math.max(l-3,0),u=Math.max(f+5,c),d=a*s;for(let h=f;h<u;h++){const g=h*d;for(let p=0;p<s;p++){const m=p*a;for(let w=0;w<a;w++){const v=g+m+w,y=o[v];y>=i[0]&&y<=i[1]&&e.voxelManager.setAtIndex(v,n)}}}}async function she(t,e){const r=vg(t.volumeId);return ahe(t,r,e),ohe(t,r,e),r}async function gA(t,e,r){const{boundingBox:n}=e,{ijkTopLeft:i,ijkBottomRight:o}=n,a={minX:i[0],maxX:o[0],minY:i[1],maxY:o[1],minZ:i[2],maxZ:o[2]},s=fx(t,a,{targetBuffer:{type:"Float32Array"}}),c=await she(s,r);return await W2(s.volumeId,c.volumeId),c}const che=254,lhe=255,uhe=1,pA=1.8,fhe=3.2,X5=30,dhe=70,hhe=50,{transformWorldToIndex:ghe}=gn,Ld=1e5;function mA(t,e,r){const{dimensions:n,imageData:i}=t,[o,a,s]=n,c=t.voxelManager,l=c.getCompleteScalarDataArray(),f=o*a,u=r?.initialNeighborhoodRadius??uhe,d=r?.positiveStdDevMultiplier??pA,h=r?.negativeStdDevMultiplier??fhe,g=r?.negativeSeedMargin??X5,p=r?.negativeSeedsTargetPatches??dhe,m=ghe(i,e).map(Math.round),w=c.toIndex(m);if(m[0]<0||m[0]>=o||m[1]<0||m[1]>=a||m[2]<0||m[2]>=s)return console.warn("Click position is outside volume bounds."),null;const v=V7(l,n,m,u);v.count===0&&(v.mean=l[w],v.stdDev=0);const y=v.mean-d*v.stdDev,C=v.mean+d*v.stdDev,x=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]];let T=1/0,S=1/0,_=1/0,E=-1/0,D=-1/0,b=-1/0;const I=new Set,O=[],M=l[w];if(M>=y&&M<=C)I.add(w),O.push(m),T=E=m[0],S=D=m[1],_=b=m[2];else return console.warn("Clicked voxel intensity is outside the calculated positive range. No positive seeds generated."),{positiveSeedIndices:new Set,negativeSeedIndices:new Set};let R=0;for(;R<O.length&&I.size<Ld;){const[W,q,Q]=O[R++];T=Math.min(W,T),S=Math.min(q,S),_=Math.min(Q,_),E=Math.max(W,E),D=Math.max(q,D),b=Math.max(Q,b);for(let ee=0;ee<x.length;ee++){const[ge,De,Ne]=x[ee],We=W+ge,re=q+De,se=Q+Ne;if(We<0||We>=o||re<0||re>=a||se<0||se>=s)continue;const ve=se*f+re*o+We;if(I.has(ve))continue;const le=l[ve];le>=y&&le<=C&&(I.add(ve),I.size<Ld&&O.push([We,re,se]))}}if(I.size>=Ld&&console.debug(`Reached maximum number of positive seeds (${Ld}). Stopping BFS.`),I.size===0)return console.warn("No positive seeds found after BFS."),{positiveSeedIndices:new Set,negativeSeedIndices:new Set};let A=0,B=0;I.forEach(W=>{const q=l[W];A+=q,B+=q*q});const k=I.size,L=A/k,F=B/k-L*L,j=Math.sqrt(Math.max(0,F)),J=h*j,ie=Math.max(0,T-g),fe=Math.max(0,S-g),ae=Math.max(0,_-g),de=Math.min(o-1,E+g),we=Math.min(a-1,D+g),_e=Math.min(s-1,b+g),Te=new Set;let G=0,P=0;const $=p*hhe;for(;P<p&&G<$;){G++;const W=Math.floor(Math.random()*(de-ie+1)+ie),q=Math.floor(Math.random()*(we-fe+1)+fe),Q=Math.floor(Math.random()*(_e-ae+1)+ae),ee=Q*f+q*o+W;if(I.has(ee)||Te.has(ee))continue;const ge=l[ee];if(Math.abs(ge-L)>J){let De=!1;for(let Ne=-1;Ne<=1;Ne++){const We=q+Ne;if(!(We<0||We>=a))for(let re=-1;re<=1;re++){const se=W+re;if(se<0||se>=o)continue;const ve=Q*f+We*o+se;I.has(ve)||Te.has(ve)||(Te.add(ve),De=!0)}}De&&P++}}return Te.size===0&&console.warn("Could not find any negative seeds. GrowCut might fail or produce poor results."),console.debug("positiveSeedIndices",I.size),console.debug("negativeSeedIndices",Te.size),{positiveSeedIndices:I,negativeSeedIndices:Te}}async function vA({referencedVolumeId:t,worldPosition:e,options:r}){const n=Ae.getVolume(t),i=vg(t);i.voxelManager.forEach(({index:f,value:u})=>{u!==0&&i.voxelManager.setAtIndex(f,0)});const o=r.seeds??mA(n,e,r),a=r?.positiveSeedValue??che,s=r?.negativeSeedValue??lhe;if(!o)return null;const{positiveSeedIndices:c,negativeSeedIndices:l}=o;return c.size<10||c.size>Ld||l.size<10?(console.warn("Not enough seeds found. GrowCut might fail or produce poor results."),i):(c.forEach(f=>{i.voxelManager.setAtIndex(f,a)}),l.forEach(f=>{i.voxelManager.setAtIndex(f,s)}),await W2(t,i.volumeId,r),i)}const phe=Object.freeze(Object.defineProperty({__proto__:null,run:W2,runGrowCutForBoundingBox:gA,runGrowCutForSphere:hA,runOneClickGrowCut:vA},Symbol.toStringTag,{value:"Module"}));function Kh(t,e){const r=Ut(t);typeof e=="string"&&(console.warn("segmentIndex is a string, converting to number"),e=Number(e)),Object.values(r.segments).forEach(i=>{i.active=!1}),r.segments[e]||(r.segments[e]={segmentIndex:e,label:"",locked:!1,cachedStats:{},active:!1}),r.segments[e].active!==!0&&(r.segments[e].active=!0,la(t));const n=ff(t);n.forEach(i=>{ho(i,{segmentationId:t}).forEach(a=>{a.segments[e]||(a.segments[e]={visible:!0})})}),n.forEach(i=>{const o=lr(i);lA(o.id)})}const mhe=Object.freeze(Object.defineProperty({__proto__:null,getActiveSegmentIndex:no,setActiveSegmentIndex:Kh},Symbol.toStringTag,{value:"Module"}));function vhe(t,e){const{segmentationId:r,config:n}=e,i={colorLUTIndex:yhe(n),...n};An.addSegmentationRepresentation(t,r,e.type,i);const{viewport:o}=xn(t)||{};if(o&&d3(o,r,e.type),!no(r)){let a=1;const s=An.getSegmentation(r);if(s){const c=Object.keys(s.segments);c.length>0&&(a=c.map(l=>Number(l)).sort()[0]),Kh(r,a)}}e.type===yt.Contour&&Me([t]),e.type===yt.Surface&&ui(r),la(r)}function yhe(t){const{colorLUTOrIndex:e}=t||{};return e===void 0?qd(JSON.parse(JSON.stringify(p1))):typeof e=="number"?e:Array.isArray(e)&&e.every(n=>Array.isArray(n)&&n.length===4)?qd(e):qd(JSON.parse(JSON.stringify(p1)))}function Z0(t,e){e.map(r=>vhe(t,r))}function b3(t,e){return Z0(t,e.map(r=>({...r,type:yt.Contour})))}function whe(t){const e={};for(const[r,n]of Object.entries(t))e[r]=b3(r,n);return e}function yA(t,e){return Z0(t,e.map(r=>({...r,type:yt.Labelmap})))}function Che(t){for(const[e,r]of Object.entries(t))yA(e,r.map(n=>({...n,type:yt.Labelmap})))}function wA(t,e){return Z0(t,e.map(r=>({...r,type:yt.Surface})))}function xhe(t){const e={};for(const[r,n]of Object.entries(t))e[r]=wA(r,n);return e}async function The({segmentationId:t,viewportId:e,imageIds:r,options:n}){const i=Ut(t);if(n?.removeOriginal){const o=i.representationData.Labelmap;Ae.getVolume(o.volumeId)&&Ae.removeVolumeLoadObject(o.volumeId),i.representationData.Labelmap={imageIds:r}}else i.representationData.Labelmap={...i.representationData.Labelmap,imageIds:r};await Z0(e,[{segmentationId:t,type:yt.Labelmap}]),ke.addEventListenerOnce(V.SEGMENTATION_RENDERED,()=>ui(t))}async function She({volumeId:t}){return{imageIds:Ae.getVolume(t).imageIds}}function _he({segmentationId:t,options:e}){const r=Ut(t);if(!r)return;const{volumeId:n}=r.representationData.Labelmap,i=Ae.getVolume(n);return The({segmentationId:t,viewportId:e.viewportId,imageIds:i.imageIds,options:e})}async function CA(t){return lO(t)}async function Ehe({segmentationId:t,segmentIndices:e,mode:r="individual"}){N2(),Es(No.COMPUTE_LARGEST_BIDIRECTIONAL,0);const n=VP(t,e);if(!n)return;const{operationData:i,segImageIds:o,reconstructableVolume:a,indices:s}=n,c=a?await bhe({operationData:i,indices:s,mode:r}):await Dhe({segImageIds:o,indices:s,mode:r});return Es(No.COMPUTE_LARGEST_BIDIRECTIONAL,100),c}async function bhe({operationData:t,indices:e,mode:r}){const n=kP(t),{segmentationVoxelManager:i,segmentationImageData:o}=n,s={scalarData:i.getCompleteScalarDataArray(),dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection()};return await Is().executeTask("compute","getSegmentLargestBidirectionalInternal",{segmentationInfo:s,indices:e,mode:r})}async function Dhe({segImageIds:t,indices:e,mode:r}){const{segmentationInfo:n}=FP(t);return await Is().executeTask("compute","getSegmentLargestBidirectionalInternal",{segmentationInfo:n,indices:e,mode:r,isStack:!0})}function Ihe(t){const e=Ut(t);if(!e)return null;let r;const n=e.representationData.Labelmap;if("imageIds"in n){const{imageIds:i}=n,o=Ae.getImage(i[0]),a=Ae.getVolumeContainingImageId(o.referencedImageId);if(a?.volume)return a.volume;r=i.map(s=>Ae.getImage(s).referencedImageId)}else if("volumeId"in n){const{volumeId:i,referencedVolumeId:o}=n;if(o){const s=Ae.getVolume(o);if(s)return s}const a=Ae.getVolume(i);a&&(r=a.imageIds.map(s=>Ae.getImage(s).referencedImageId))}return k2(r)}async function Mhe({segmentationIds:t,segmentIndex:e}){N2(),Es(No.COMPUTE_STATISTICS,0);const r=Ut(t[0]),{imageIds:n}=r.representationData.Labelmap;if(!Nl(n))throw new Error("Invalid volume - TMTV cannot be calculated");return await Ohe({segmentationIds:t,segmentIndex:e})}async function Ohe({segmentationIds:t,segmentIndex:e}){const r=t.map(p=>X0(p)),n=zR(r,e);if(!n)throw new Error("Invalid volume - TMTV cannot be calculated");const{imageData:i,dimensions:o,direction:a,origin:s,voxelManager:c}=n,l=i.getSpacing(),u={scalarData:c.getCompleteScalarDataArray(),dimensions:o,spacing:l,origin:s,direction:a},d=Ihe(t[0]),h={dimensions:d.dimensions,spacing:d.spacing,origin:d.origin,direction:d.direction,scalarData:d.voxelManager.getCompleteScalarDataArray()};if(h.scalarData.length===0||u.scalarData.length===0)return{[e]:{name:"TMTV",value:0}};const g=await Is().executeTask("compute","computeMetabolicStats",{segmentationInfo:u,imageInfo:h});return Es(No.COMPUTE_STATISTICS,100),g}const Phe=Object.freeze(Object.defineProperty({__proto__:null,IslandRemoval:of,LabelmapMemo:yde,SegmentStatsCalculator:K5,VolumetricCalculator:zu,computeMetabolicStats:Mhe,computeStackLabelmapFromVolume:She,computeVolumeLabelmapFromStack:CA,contourAndFindLargestBidirectional:sA,createBidirectionalToolData:cA,createLabelmapVolumeForViewport:L0e,createMergedLabelmapForIndex:zR,floodFill:S3,getBrushSizeForToolGroup:bde,getBrushThresholdForToolGroup:Ide,getBrushToolInstances:J0,getHoveredContourSegmentationAnnotation:dA,getOrCreateImageVolume:k2,getOrCreateSegmentationVolume:X0,getReferenceVolumeForSegmentationVolume:AP,getSegmentIndexAtLabelmapBorder:uA,getSegmentIndexAtWorldPoint:E3,getSegmentLargestBidirectional:Ehe,getStatistics:XR,getUniqueSegmentIndices:iP,growCut:phe,invalidateBrushCursor:lA,rectangleROIThresholdVolumeByRange:R0e,segmentContourAction:kde,setBrushSizeForToolGroup:Ede,setBrushThresholdForToolGroup:Dde,thresholdSegmentationByRange:Mde,thresholdVolumeByRange:WR,triggerSegmentationRender:q0,triggerSegmentationRenderBySegmentationId:F2,validateLabelmap:fue},Symbol.toStringTag,{value:"Module"}));function Rhe(t){let e="";const r=t[0]<0?"R":"L",n=t[1]<0?"A":"P",i=t[2]<0?"F":"H",o=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])],a=1e-4;for(let s=0;s<3;s++)if(o[0]>a&&o[0]>o[1]&&o[0]>o[2])e+=r,o[0]=0;else if(o[1]>a&&o[1]>o[0]&&o[1]>o[2])e+=n,o[1]=0;else if(o[2]>a&&o[2]>o[0]&&o[2]>o[1])e+=i,o[2]=0;else if(o[0]>a&&o[1]>a&&o[0]===o[1])e+=r+n,o[0]=0,o[1]=0;else if(o[0]>a&&o[2]>a&&o[0]===o[2])e+=r+i,o[0]=0,o[2]=0;else if(o[1]>a&&o[2]>a&&o[1]===o[2])e+=n+i,o[1]=0,o[2]=0;else break;return e}function Ahe(t){let e=t.replace("H","f");return e=e.replace("F","h"),e=e.replace("R","l"),e=e.replace("L","r"),e=e.replace("A","p"),e=e.replace("P","a"),e=e.toUpperCase(),e}const Lhe=Object.freeze(Object.defineProperty({__proto__:null,getOrientationStringLPS:Rhe,invertOrientationStringLPS:Ahe},Symbol.toStringTag,{value:"Module"}));var s0;(function(t){t.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",t.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"})(s0||(s0={}));const D3={};function xA(t,e){const r=Ce(t),{viewportId:n}=r;D3[n]=e}function I3(t){const e=Ce(t),{viewportId:r}=e;return D3[r]}function Nhe(t){return D3[t]}const{ViewportStatus:TA}=go,{triggerEvent:py}=gn,SA=!0,q5=new Map;function Vhe(t,e){let r,n;if(t===void 0)throw new Error("playClip: element must not be undefined");const i=Ce(t);if(!i)throw new Error("playClip: element must be a valid Cornerstone enabled element");e||(e={}),e.dynamicCineEnabled=e.dynamicCineEnabled??!0;const{viewport:o}=i,a=Whe(o,e);let s=I3(t);const c=e.dynamicCineEnabled;if(c&&EA(t),s?Y5(t,{stopDynamicCine:!c,viewportId:o.id}):(s={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:e.frameTimeVector??void 0,speed:e.frameTimeVectorSpeedMultiplier??1,reverse:e.reverse??!1,loop:e.loop??!0,bounce:e.bounce??!1},xA(t,s)),s.dynamicCineEnabled=e.dynamicCineEnabled,(e.framesPerSecond<0||e.framesPerSecond>0)&&(s.framesPerSecond=Number(e.framesPerSecond),s.reverse=s.framesPerSecond<0,s.ignoreFrameTimeVector=!0),s.ignoreFrameTimeVector!==!0&&s.frameTimeVector&&s.frameTimeVector.length===a.numScrollSteps&&a.frameTimeVectorEnabled){const{timeouts:u,isTimeVarying:d}=khe(s.frameTimeVector,s.speed);r=u,n=d}e.bounce!==void 0&&(s.bounce=e.bounce);const l=()=>{const{numScrollSteps:u,currentStepIndex:d}=a;let h=d+(s.reverse?-1:1);if(h<0||h>=u)if(s.bounce)s.reverse=!s.reverse,h=d+(s.reverse?-1:1),h=Math.max(0,Math.min(u-1,h));else if(s.loop)h=s.reverse?u-1:0;else{Y5(t,{stopDynamicCine:!c,viewportId:o.id}),py(t,s0.CLIP_STOPPED,{element:t});return}const p=h-d;if(p)try{a.scroll(p)}catch(m){console.warn("Play clip not scrolling",m),bA(s),py(t,s0.CLIP_STOPPED,{element:t})}};if(c){const u=M3(o);u&&q5.set(u.volumeId,t)}a.play?s.framesPerSecond=a.play(e.framesPerSecond):r&&r.length>0&&n?(s.usingFrameTimeVector=!0,s.intervalId=window.setTimeout(function u(){s.intervalId=window.setTimeout(u,r[a.currentStepIndex]),l()},0)):(s.usingFrameTimeVector=!1,s.intervalId=window.setInterval(l,1e3/Math.abs(s.framesPerSecond)));const f={element:t};py(t,s0.CLIP_STARTED,f)}function _A(t,e={}){Y5(t,{stopDynamicCine:!0,...e})}function Y5(t,e={stopDynamicCine:!0,viewportId:void 0}){const{stopDynamicCine:r,viewportId:n}=e,i=Ce(t);let o;const a=i?.viewport;if(i){const{viewport:s}=i;o=I3(s.element)}else if(n)o=Nhe(n);else return;o&&bA(o),a instanceof w0?a.pause():r&&a instanceof ir&&EA(t)}function EA(t){const{viewport:e}=Ce(t);if(e instanceof zn){const r=M3(e);if(r?.isDynamicVolume()){const n=q5.get(r.volumeId);q5.delete(r.volumeId),n&&n!==t&&_A(n)}}}function khe(t,e){let r,n,i,o=0;const a=t.length,s=[];let c=!1;for((typeof e!="number"||e<=0)&&(e=1),r=1;r<a;r++)i=Number(t[r])/e|0,s.push(i),r===1?n=i:i!==n&&(c=!0),o+=i;return s.length>0&&(c?i=o/s.length|0:i=s[0],s.push(i)),{timeouts:s,isTimeVarying:c}}function bA(t){const e=t.intervalId;typeof e<"u"&&(t.intervalId=void 0,t.usingFrameTimeVector?clearTimeout(e):clearInterval(e))}function M3(t){if(!(t instanceof zn))return;const e=t.getAllVolumeIds();if(!e?.length)return;const n=e.find(i=>Ae.getVolume(i)?.isDynamicVolume())??e[0];return Ae.getVolume(n)}function Fhe(t,e){const r=t.getImageIds();return{get numScrollSteps(){return r.length},get currentStepIndex(){return t.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(n){if(this.waitForRenderedCount<=e&&t.viewportStatus!==TA.RENDERED){this.waitForRenderedCount++;return}this.waitForRenderedCount=0,ef(t,{delta:n,debounceLoading:SA})}}}function Uhe(t,e){return{get numScrollSteps(){return t.getNumberOfSlices()},get currentStepIndex(){return t.getSliceIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(r){if(this.waitForRenderedCount<=e&&t.viewportStatus!==TA.RENDERED){this.waitForRenderedCount++;return}this.waitForRenderedCount=0,ef(t,{delta:r,debounceLoading:SA})},play(r){return r&&t.setPlaybackRate(r/24),t.play(),t.getFrameRate()}}}function Bhe(t,e){const{volumeId:r}=e,n={viewPlaneNormal:Ie(),scrollInfo:null},i=()=>{const o=t.getCamera();if(!n.scrollInfo||!o5(o.viewPlaneNormal,n.viewPlaneNormal)){const s=Bu(t,r);n.viewPlaneNormal=o.viewPlaneNormal,n.scrollInfo=s}return n.scrollInfo};return{get numScrollSteps(){return i().numScrollSteps},get currentStepIndex(){return i().currentStepIndex},get frameTimeVectorEnabled(){const o=t.getCamera(),a=e.direction.slice(6,9).map(c=>-c),s=ft(a,o.viewPlaneNormal);return Yu(s,1)},scroll(o){i().currentStepIndex+=o,ef(t,{delta:o})}}}function Ghe(t){return{get numScrollSteps(){return t.numDimensionGroups},get currentStepIndex(){return t.dimensionGroupNumber-1},get frameTimeVectorEnabled(){return!1},scroll(e){t.scroll(e)}}}function Whe(t,e){if(t instanceof qn)return Fhe(t,e.waitForRendered??30);if(t instanceof zn){const r=M3(t);return e.dynamicCineEnabled&&r?.isDynamicVolume()?Ghe(r):Bhe(t,r)}if(t instanceof w0)return Uhe(t,e.waitForRendered??30);throw new Error("Unknown viewport type")}const $he=Object.freeze(Object.defineProperty({__proto__:null,Events:s0,addToolState:xA,getToolState:I3,playClip:Vhe,stopClip:_A},Symbol.toStringTag,{value:"Module"}));function zhe(t,e){const r=e?.knotsRatioPercentage||30;return!t?.data?.contour?.polyline?.length||r<=0}function jhe(t,e){const r=Ti(),n=nr(Ie(),e,t),i=Math.abs(t[0])>.1?mt(-t[1],t[0],0):mt(0,-t[2],t[1]);return eC(r,e,n,i),r}function Ip(t,e=Math.floor(Math.random()*(t.length-1))){if(e===0)return 0;const r=[...t],{length:n}=t;for(let i=0;i<n;i++)t[i]=r[(i+e+n)%n];return e}function DA(t,e){if(zhe(t,e))return!1;const{viewPlaneNormal:r}=t.metadata,{closed:n,polyline:i}=t.data.contour,o=jhe(r,t.data.contour.polyline[0]),a=t.data.contour.polyline.map(f=>{const u=Pt(Ie(),f,o);return[u[0],u[1]]});let s=n?Ip(a):0,c=g1(a,0,a.length-1,e?.knotsRatioPercentage||30);if(c===a)return!1;Ip(c,-s);for(let f=1;f<e?.loop;f++)s=n?Ip(c):0,c=g1(c,0,c.length-1,e?.knotsRatioPercentage||30),Ip(c,-s);const l=gr(Ti(),o);return t.data.contour.polyline=c.map(f=>Pt([0,0,0],[...f,0],l)),!0}const Hhe={smoothAnnotation:DA},Khe=Object.freeze(Object.defineProperty({__proto__:null,default:Hhe,smoothAnnotation:DA},Symbol.toStringTag,{value:"Module"})),{isEqual:Mp}=gn,Xhe=mt(1,0,0),qhe=mt(0,1,0),Yhe=mt(0,0,1),y4=[Xhe,qhe,Yhe];function Jhe(t){const e=qt(Ie(),t[0],t[1]),r=qt(Ie(),t[0],t[2]),n=w4(e,y4),i=w4(r,y4);return[...n,...i].every(a=>Mp(a,0)||Mp(a,90)||Mp(a,180)||Mp(a,270))}function w4(t,e){return e.map(r=>tC(t,r)*180/Math.PI)}const Zhe=Object.freeze(Object.defineProperty({__proto__:null,getBoundsIJKFromRectangleAnnotations:$R,isAxisAlignedRectangle:Jhe},Symbol.toStringTag,{value:"Module"})),IA={};function MA(t,e){const r=Ce(t),{viewportId:n}=r;IA[n]=e}function Q0(t){const e=Ce(t),{viewportId:r}=e;return IA[r]}const ju=Zt.Prefetch,Qhe=0;function ege(t,e){t=Math.round(t)||0,e=Math.round(e)||0;const r=[];let n=e-t+1;if(n<=0)return r;for(;n--;)r[n]=e--;return r}function tge(t,e){let r=0,n=t.length-1;return t.forEach((i,o)=>{i<e?r=Math.max(o,r):i>e&&(n=Math.min(o,n))}),{low:r,high:n}}function ed(t){const e=Ce(t);if(!e)return null;const{viewport:r}=e;return r instanceof qn?{currentImageIdIndex:r.getCurrentImageIdIndex(),imageIds:r.getImageIds()}:null}function $2(t){return function(e){const r=e.detail;let n;try{n=ed(t)}catch{return}if(!n||!n.imageIds||n.imageIds.length===0)return;const o=n.imageIds.indexOf(r.imageId);if(o<0)return;const a=Q0(t);!a||!a.indicesToRequest||!a.indicesToRequest.length||a.indicesToRequest.push(o)}}const nge=t=>{const e=new Set(t.imageIds);return r=>r.type!==ju||!e.has(r.additionalDetails.imageId)},{imageRetrieveMetadataProvider:rge}=gn;let Yd={maxImagesToPrefetch:1/0,preserveExistingPool:!0},J5;const ige=10;function OA(t){const e=Q0(t);if(!e)return;const r=e||{},n=ed(t);if(!n?.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const{currentImageIdIndex:i}=n;if(r.enabled=r.enabled&&(r.indicesToRequest?.length??0)>0,r.enabled===!1)return;function o(p){const m=r.indicesToRequest.indexOf(p);m>-1&&r.indicesToRequest.splice(m,1)}if(e.indicesToRequest.sort((p,m)=>p-m),r.indicesToRequest.slice().forEach(function(p){const m=n.imageIds[p];if(!m)return;(Math.abs(i-p)<6?Ae.getImageLoadObject(m):Ae.isLoaded(m))&&o(p)}),!r.indicesToRequest.length)return;Yd.preserveExistingPool||Hr.clearRequestStack(ju);const s=tge(r.indicesToRequest,n.currentImageIdIndex);let c,l;function f(p){console.log("prefetch done: %s",p);const m=n.imageIds.indexOf(p);if(o(m),r.indicesToRequest.length===0){const w={element:t,lastPrefetchedImageId:p};Xe(ke,V.STACK_PREFETCH_COMPLETE,w)}}let u=s.low,d=s.high;const h=[];for(;u>=0||d<r.indicesToRequest.length;){const p=n.currentImageIdIndex,m=p-r.indicesToRequest[u]>Yd.maxImagesToPrefetch,w=r.indicesToRequest[d]-p>Yd.maxImagesToPrefetch,v=!m&&u>=0,y=!w&&d<r.indicesToRequest.length;if(!y&&!v)break;v&&(l=r.indicesToRequest[u--],c=n.imageIds[l],h.push(c)),y&&(l=r.indicesToRequest[d++],c=n.imageIds[l],h.push(c))}const g=(p,m)=>{const{retrieveOptions:w={}}=ut(rge.IMAGE_RETRIEVE_CONFIGURATION,p,"stack")||{};return m.retrieveOptions={...m.retrieveOptions,...w.default||Object.values(w)?.[0]||{}},Ts(p,m).then(()=>f(p))};h.forEach(p=>{const m={requestType:ju};Hr.addRequest(g.bind(null,p,m),ju,{imageId:p},Qhe)})}function Z5(t){clearTimeout(J5),J5=setTimeout(function(){const e=t.target;try{OA(e)}catch{return}},ige)}function oge(t){const e=ed(t);if(!e||!e.imageIds||e.imageIds.length===0){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const r={indicesToRequest:ege(0,e.imageIds.length-1),enabled:!0,direction:1},n=r.indicesToRequest.indexOf(e.currentImageIdIndex);r.indicesToRequest.splice(n,1),MA(t,r),OA(t),t.removeEventListener(Ge.STACK_NEW_IMAGE,Z5),t.addEventListener(Ge.STACK_NEW_IMAGE,Z5);const i=$2(t);ke.removeEventListener(Ge.IMAGE_CACHE_IMAGE_REMOVED,i),ke.addEventListener(Ge.IMAGE_CACHE_IMAGE_REMOVED,i)}function age(t){clearTimeout(J5),t.removeEventListener(Ge.STACK_NEW_IMAGE,Z5);const e=$2(t);ke.removeEventListener(Ge.IMAGE_CACHE_IMAGE_REMOVED,e);const r=Q0(t);r&&r.indicesToRequest.length&&(r.enabled=!1,Hr.clearRequestStack(ju))}function sge(){return Yd}function cge(t){Yd=t}const lge={enable:oge,disable:age,getConfiguration:sge,setConfiguration:cge},{imageRetrieveMetadataProvider:uge}=gn;let Xh={maxImagesToPrefetch:1/0,minBefore:2,maxAfter:2,directionExtraImages:10,preserveExistingPool:!1},Q5;const fge=5,PA={},dge=(t,e=0)=>{const r=ed(t);if(!r)return;if(!r.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}P3(t),PA[t]=e,O3(t,e),t.removeEventListener(Ge.STACK_NEW_IMAGE,ew),t.addEventListener(Ge.STACK_NEW_IMAGE,ew);const n=$2(t);ke.removeEventListener(Ge.IMAGE_CACHE_IMAGE_REMOVED,n),ke.addEventListener(Ge.IMAGE_CACHE_IMAGE_REMOVED,n)};function O3(t,e=0){const r=ed(t);if(!r)return;if(!r?.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const n=Q0(t);if(!n)return;const i=n||{};if(i.enabled=i.enabled&&(i.indicesToRequest?.length??0)>0,i.enabled===!1)return;function o(f){const u=i.indicesToRequest.indexOf(f);u>-1&&i.indicesToRequest.splice(u,1)}const a=i.indicesToRequest.slice(),{currentImageIdIndex:s}=r;if(a.forEach(f=>{const u=r.imageIds[f];if(!u)return;(Math.abs(s-f)<6?Ae.getImageLoadObject(u):Ae.isLoaded(u))&&o(f)}),!i.indicesToRequest.length)return;Xh.preserveExistingPool||Hr.filterRequests(nge(r));function c(f){const u=r.imageIds.indexOf(f);o(u);const d=Ae.getCachedImageBasedOnImageURI(f),{stats:h}=i,g=d?.image?.decodeTimeInMS||0;if(g){h.imageIds.set(f,g),h.decodeTimeInMS+=g;const p=d?.image?.loadTimeInMS||0;h.loadTimeInMS+=p}if(!i.indicesToRequest.length&&d?.sizeInBytes){const{sizeInBytes:p}=d,m=Ae.getMaxCacheSize()/4/p;if(!i.cacheFill)h.initialTime=Date.now()-h.start,h.initialSize=h.imageIds.size,P3(t,m),O3(t,e);else if(h.imageIds.size){h.fillTime=Date.now()-h.start;const{size:w}=h.imageIds;h.fillSize=w}}if(i.indicesToRequest.length===0){const p={element:t,lastPrefetchedImageId:f};Xe(ke,V.STACK_PREFETCH_COMPLETE,p)}}const l=(f,u)=>{const{retrieveOptions:d={}}=ut(uge.IMAGE_RETRIEVE_CONFIGURATION,f,"stack")||{};return u.retrieveOptions={...u.retrieveOptions,...d.default||Object.values(d)?.[0]||{}},Ts(f,u).then(()=>c(f))};i.indicesToRequest.forEach(f=>{const u=r.imageIds[f],d={requestType:ju};Hr.addRequest(l.bind(null,u,d),ju,{imageId:u},e)})}function ew(t){clearTimeout(Q5),Q5=setTimeout(function(){const e=t.target;try{P3(e),O3(e,PA[e])}catch{return}},fge)}const hge=t=>t<0?-1:1,P3=(t,e)=>{const r=ed(t);if(!r)return;if(!r.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const{currentImageIdIndex:n}=r;let{maxAfter:i=2,minBefore:o=2}=Xh;const{directionExtraImages:a=10}=Xh,s=Q0(t)||{indicesToRequest:[],currentImageIdIndex:n,stackCount:0,enabled:!0,direction:1,stats:{start:Date.now(),imageIds:new Map,decodeTimeInMS:0,loadTimeInMS:0,totalBytes:0}},c=n-s.currentImageIdIndex;if(s.direction=hge(c),s.currentImageIdIndex=n,s.enabled=!0,s.stackCount<100&&(s.stackCount+=a),Math.abs(c)>i||!c)if(s.stackCount=0,e){const d=n/r.imageIds.length;o=Math.ceil(e*d),i=Math.ceil(e*(1-d)),s.cacheFill=!0}else s.cacheFill=!1;else c<0?(o+=s.stackCount,i=0):(i+=s.stackCount,o=0);const l=Math.max(0,n-o),f=Math.min(r.imageIds.length-1,n+i),u=[];for(let d=n+1;d<=f;d++)u.push(d);for(let d=n-1;d>=l;d--)u.push(d);s.indicesToRequest=u,MA(t,s)};function gge(t){clearTimeout(Q5),t.removeEventListener(Ge.STACK_NEW_IMAGE,ew);const e=$2(t);ke.removeEventListener(Ge.IMAGE_CACHE_IMAGE_REMOVED,e);const r=Q0(t);r&&(r.enabled=!1)}function pge(){return Xh}function mge(t){Xh=t}const vge={enable:dge,disable:gge,getConfiguration:pge,setConfiguration:mge},yge=Object.freeze(Object.defineProperty({__proto__:null,isViewportPreScaled:Pc},Symbol.toStringTag,{value:"Module"}));function wge(t,e){let r;const n=e.dimensionGroupNumbers||e.frameNumbers||Array.from({length:t.numDimensionGroups},(i,o)=>o+1);if(e.frameNumbers&&console.warn("Warning: frameNumbers parameter is deprecated. Please use dimensionGroupNumbers instead."),!e.maskVolumeId&&!e.worldCoordinate)throw new Error("You should provide either maskVolumeId or imageCoordinate");if(e.maskVolumeId&&e.worldCoordinate)throw new Error("You can only use one of maskVolumeId or imageCoordinate");if(e.maskVolumeId){const i=Ae.getVolume(e.maskVolumeId);if(!i)throw new Error("Segmentation volume not found");const[o,a]=xge(n,t,i);return[o,a]}return e.worldCoordinate?Cge(n,e.worldCoordinate,t):r}function Cge(t,e,r){const{dimensions:n,imageData:i}=r,o=i.worldToIndex(e);if(o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.floor(o[2]),!Or(o,n))throw new Error("outside bounds");const a=n[0],s=n[0]*n[1],c=[];return t.forEach(l=>{const f=o[2]*s+o[1]*a+o[0];c.push(r.voxelManager.getAtIndexAndDimensionGroup(f,l))}),c}function xge(t,e,r){const{imageData:n}=r,i=r.voxelManager,o=i.getScalarDataLength(),a=[];a.length=o;let s=0;for(let d=0,h=o;d<h;d++)i.getAtIndex(d)!==0&&(a[s++]=d);a.length=s;const c=[],l=e.voxelManager.getScalarDataLength()===o&&JSON.stringify(e.spacing)===JSON.stringify(r.spacing),f=[];if(l){for(let d=0;d<a.length;d++){const h=[],g=a[d];for(let p=0;p<t.length;p++)h.push(e.voxelManager.getAtIndexAndDimensionGroup(g,t[p]));c.push(h),f.push(i.toIJK(g))}return[c,f]}const u=({pointLPS:d,value:h,pointIJK:g})=>{if(h===0)return;const p=Ex(e.imageData,e.dimensions,e.spacing,d);let m=0;const w=new Map;t.forEach(C=>w.set(C,0));const v=({index:C})=>{for(let x=0;x<t.length;x++){const T=e.voxelManager.getAtIndexAndDimensionGroup(C,t[x]),S=t[x];w.set(S,w.get(S)+T)}m++};e.voxelManager.forEach(v,{imageData:e.imageData,boundsIJK:p});const y=[];w.forEach(C=>{y.push(C/m)}),f.push(g),c.push(y)};return r.voxelManager.forEach(u,{imageData:n}),[c,f]}function RA(t,e){const r=t.getScalarDataLength(),n=new Float32Array(r);for(const i of e){const o=t.getDimensionGroupScalarData(i);for(let a=0;a<r;a++)n[a]+=o[a]}return n}function Tge(t,e){const r=RA(t,e),n=e.length;for(let i=0;i<r.length;i++)r[i]/=n;return r}const AA={[Kf.SUM]:(t,e,r)=>{const n=RA(t,e);for(let i=0;i<n.length;i++)r(i,n[i])},[Kf.AVERAGE]:(t,e,r)=>{const n=Tge(t,e);for(let i=0;i<n.length;i++)r(i,n[i])},[Kf.SUBTRACT]:(t,e,r)=>{if(e.length!==2)throw new Error("Please provide only 2 dimension groups for subtraction.");const n=t.getScalarDataLength(),i=t.getDimensionGroupScalarData(e[0]),o=t.getDimensionGroupScalarData(e[1]);for(let a=0;a<n;a++){const s=i[a]-o[a];r(a,s)}}};function Sge(t,e,r){const{dimensionGroupNumbers:n,frameNumbers:i}=r;i&&console.warn("Warning: frameNumbers parameter is deprecated. Please use dimensionGroupNumbers instead.");const o=n||i||Array.from({length:t.numDimensionGroups},(f,u)=>u+1);if(o.length<=1)throw new Error("Please provide two or more dimension groups");const a=t.voxelManager,s=a.getScalarDataLength(),c=AA[e];if(!c)throw new Error(`Unsupported operation: ${e}`);const l=new Float32Array(s);return c(a,o,(f,u)=>{l[f]=u}),l}function _ge(t,e,r){const{dimensionGroupNumbers:n,frameNumbers:i,targetVolume:o}=r;if(!o)throw new Error("A target volume must be provided");i&&console.warn("Warning: frameNumbers parameter is deprecated. Please use dimensionGroupNumbers instead.");const a=n||i||Array.from({length:t.numDimensionGroups},(f,u)=>u+1);if(a.length<=1)throw new Error("Please provide two or more dimension groups");const s=t.voxelManager,c=o.voxelManager,l=AA[e];if(!l)throw new Error(`Unsupported operation: ${e}`);l(s,a,(f,u)=>{c.setAtIndex(f,u)}),c.resetModifiedSlices();for(let f=0;f<o.dimensions[2];f++)c.modifiedSlices.add(f)}const Ege=Object.freeze(Object.defineProperty({__proto__:null,generateImageFromTimeData:Sge,getDataInTime:wge,updateVolumeFromTimeData:_ge},Symbol.toStringTag,{value:"Module"}));function LA(t,e){const r=e*3;if(r<t.length)return mt(t[r],t[r+1],t[r+2])}function NA(t){const e=t.getLines().getData();let r=0;const n=new Map;for(;r<e.length;){const s=e[r++],c=[];for(let l=0;l<s;l++)c.push(e[r+l]);n.set(c[0],c),r+=s}const i=[],o=s=>{for(const[c,l]of s.entries())if(l!==void 0)return c;return-1};let a=o(n);for(;a!==-1;){const s=[a];for(;n.has(a);){const c=n.get(a)[1];n.has(c)&&s.push(c),n.delete(a),a=c}i.push(s),a=o(n)}return i.length?i:void 0}function VA(t){const e=NA(t);if(!e)return;const r=t.getPoints().getData();return e.map(n=>n.map(i=>LA(r,i)))}const bge=Object.freeze(Object.defineProperty({__proto__:null,getPoint:LA,getPolyDataPointIndexes:NA,getPolyDataPoints:VA},Symbol.toStringTag,{value:"Module"}));var Io;(function(t){t.Top="top",t.Left="left",t.Bottom="bottom",t.Right="right"})(Io||(Io={}));const Dge=Object.freeze(Object.defineProperty({__proto__:null,get ColorbarRangeTextPosition(){return Io}},Symbol.toStringTag,{value:"Module"})),pc=t=>t&&t.upper>t.lower,x1=t=>!!t&&t.width>0&&t.height>0,qh=(t,e)=>!!t&&!!e&&t.lower===e.lower&&t.upper===e.upper,kA=(t,e)=>!!t&&!!e&&t.width===e.width&&t.height===e.height,Ige=(t,e,r)=>[t[0]*(1-r)+e[0]*r,t[1]*(1-r)+e[1]*r,t[2]*(1-r)+e[2]*r],{clamp:Mge}=gn;class R3{constructor(e){R3.validateProps(e);const{colormap:r,size:n={width:20,height:100},imageRange:i={lower:0,upper:1},voiRange:o={lower:0,upper:1},container:a,showFullPixelValueRange:s=!1}=e;this._colormap=r,this._imageRange=i,this._voiRange=o,this._showFullImageRange=s,this._canvas=this._createRootElement(n),a&&this.appendTo(a)}get colormap(){return this._colormap}set colormap(e){this._colormap=e,this.render()}get size(){const{width:e,height:r}=this._canvas;return{width:e,height:r}}set size(e){const{_canvas:r}=this;!x1(e)||kA(r,e)||(this._setCanvasSize(r,e),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){!pc(e)||qh(e,this._imageRange)||(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){!pc(e)||qh(e,this._voiRange)||(this._voiRange=e,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(e){e!==this._showFullImageRange&&(this._showFullImageRange=e,this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}dispose(){const{_canvas:e}=this,{parentElement:r}=e;r?.removeChild(e)}static validateProps(e){const{size:r,imageRange:n,voiRange:i}=e;if(r&&!x1(r))throw new Error('Invalid "size"');if(n&&!pc(n))throw new Error('Invalid "imageRange"');if(i&&!pc(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,r){const{width:n,height:i}=r;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createRootElement(e){const r=document.createElement("canvas");return Object.assign(r.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(r,e),r}render(){if(!this._canvas.isConnected)return;const{_colormap:e}=this,{RGBPoints:r}=e,n=r.length/4,i=m=>{const w=4*m;if(!(m<0||m>=n))return{index:m,position:r[w],color:[r[w+1],r[w+2],r[w+3]]}},{width:o,height:a}=this._canvas,s=this._canvas.getContext("2d");if(!s)return;const c=o>a,l=c?o:a,{_voiRange:f}=this,u=this._showFullImageRange?this._imageRange:{...f};let d,h=i(0);const g=(u.upper-u.lower)/(l-1);let p=u.lower;for(let m=0;m<l;m++){const w=(p-f.lower)/Math.abs(f.upper-f.lower);if(h)for(let C=h.index;C<n&&!(w<=h.position);C++)d=h,h=i(C+1);let v;if(!d)v=[...h.color];else if(!h)v=[...d.color];else{const C=(w-d.position)/(h.position-d.position);v=Ige(d.color,h.color,C)}const y=v.map(C=>Mge(Math.round(C*255),0,255));s.fillStyle=`rgb(${y[0]}, ${y[1]}, ${y[2]})`,c?s.fillRect(m,0,1,a):s.fillRect(0,a-m-1,o,1),p+=g}}}const vu={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class A3{constructor(e){A3.validateProps(e);const{top:r=0,left:n=0,size:i={width:20,height:100},imageRange:o={lower:0,upper:1},voiRange:a={lower:0,upper:1},ticks:s,container:c,showFullPixelValueRange:l=!1}=e,{style:f,position:u}=s??{};this._imageRange=o,this._voiRange=a,this._font=f?.font??vu.FONT,this._color=f?.color??vu.COLOR,this._tickSize=f?.tickSize??vu.TICK_SIZE,this._tickWidth=f?.tickWidth??vu.TICK_WIDTH,this._labelMargin=f?.labelMargin??vu.TICK_LABEL_MARGIN,this._maxNumTicks=f?.maxNumTicks??vu.MAX_NUM_TICKS,this._rangeTextPosition=u??Io.Right,this._showFullPixelValueRange=l,this._canvas=this._createCanvasElement(i,r,n),c&&this.appendTo(c)}get size(){const{width:e,height:r}=this._canvas;return{width:e,height:r}}set size(e){const{_canvas:r}=this;!x1(e)||kA(r,e)||(this._setCanvasSize(r,e),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(e){const{_canvas:r}=this,n=this.top;e!==n&&(r.style.top=`${e}px`,this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(e){const{_canvas:r}=this,n=this.left;e!==n&&(r.style.left=`${e}px`,this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){!pc(e)||qh(e,this._imageRange)||(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){!pc(e)||qh(e,this._voiRange)||(this._voiRange=e,this.render())}get tickSize(){return this._tickSize}set tickSize(e){e!==this._tickSize&&(this._tickSize=e,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(e){e!==this._tickWidth&&(this._tickWidth=e,this.render())}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(e){e!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=e,this.render())}get visible(){return this._canvas.style.display==="block"}set visible(e){e!==this.visible&&(this._canvas.style.display=e?"block":"none",e&&this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}static validateProps(e){const{size:r,imageRange:n,voiRange:i}=e;if(r&&!x1(r))throw new Error('Invalid "size"');if(n&&!pc(n))throw new Error('Invalid "imageRange"');if(i&&!pc(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,r){const{width:n,height:i}=r;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createCanvasElement(e,r,n){const i=document.createElement("canvas");return Object.assign(i.style,{display:"none",position:"absolute",boxSizing:"border-box",top:`${r}px`,left:`${n}px`}),this._setCanvasSize(i,e),i}_getTicks(e){const{lower:r,upper:n}=e,o=(n-r)/(this._maxNumTicks-1),a=Math.pow(10,-Math.floor(Math.log10(Math.abs(o)))),s=o*a,l=vu.TICKS_STEPS.find(g=>g>=s)/a,f=Math.ceil(n/l)*l,u=Math.floor(r/l)*l,d=Math.round((f-u)/l)+1,h=[];for(let g=0;g<d;g++)h.push(u+g*l);return{scaleMin:u,scaleMax:f,step:l,ticks:h}}_getLeftTickInfo({position:e,labelMeasure:r}){const{width:n}=this._canvas,o=[n-this.tickSize-r.width-this._labelMargin,e],a={start:[n-this._tickSize,e],end:[n,e]};return{labelPoint:o,tickPoints:a}}_getRightTickInfo({position:e}){const r=[this._tickSize+this._labelMargin,e],n={start:[0,e],end:[this._tickSize,e]};return{labelPoint:r,tickPoints:n}}_getTopTickInfo({position:e,labelMeasure:r}){const{height:n}=this._canvas,i=n-this.tickSize-this._labelMargin,o=[e,i],a={start:[e,n-this._tickSize],end:[e,n]};return{labelPoint:o,tickPoints:a}}_getBottomTickInfo({position:e,labelMeasure:r}){const n=[e,this._tickSize+this._labelMargin],i={start:[e,0],end:[e,this._tickSize]};return{labelPoint:n,tickPoints:i}}render(){const{_canvas:e}=this;if(!e.isConnected||!this.visible)return;const{width:r,height:n}=e,i=r>=n,o=i?r:n,a=e.getContext("2d"),{_voiRange:s}=this,c=this._showFullPixelValueRange?this._imageRange:{...s},l=c.upper-c.lower,{ticks:f}=this._getTicks(c);a.clearRect(0,0,r,n),a.font=this._font,a.textBaseline=i?"top":"middle",a.textAlign=i?"center":"left",a.fillStyle=this._color,a.strokeStyle=this._color,a.lineWidth=this.tickWidth,f.forEach(u=>{let d=Math.round(o*((u-c.lower)/l));if(i||(d=n-d),d<0||d>o)return;const h=u.toString(),g=a.measureText(h);let p;i?this._rangeTextPosition===Io.Top?p=this._getTopTickInfo({position:d,labelMeasure:g}):p=this._getBottomTickInfo({position:d,labelMeasure:g}):this._rangeTextPosition===Io.Left?p=this._getLeftTickInfo({position:d,labelMeasure:g}):p=this._getRightTickInfo({position:d});const{labelPoint:m,tickPoints:w}=p,{start:v,end:y}=w;return a.beginPath(),a.moveTo(v[0],v[1]),a.lineTo(y[0],y[1]),a.fillText(h,m[0],m[1]),a.stroke(),d})}}function Oge(t,e,r){return(t>=e?[Io.Top,Io.Bottom]:[Io.Left,Io.Right]).includes(r)}class Pge{constructor({id:e,container:r}){this._containerResizeCallback=n=>{let i,o;const{contentRect:a,contentBoxSize:s}=n[0];a?(i=a.width,o=a.height):s?.length&&(i=s[0].inlineSize,o=s[0].blockSize),this._containerSize={width:i,height:o},this.onContainerResize()},this._id=e,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(e),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),r&&this.appendTo(r)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(e){const{_rootElement:r,_containerResizeObserver:n}=this,{parentElement:i}=r;!e||e===i||(i&&n.unobserve(i),e.appendChild(r),n.observe(e))}destroy(){const{_rootElement:e,_containerResizeObserver:r}=this,{parentElement:n}=e;n?.removeChild(e),r.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(e){const r=document.createElement("div");return r.id=e,r.classList.add("widget"),Object.assign(r.style,{width:"100%",height:"100%"}),r}onContainerResize(){}}const Cd={MULTIPLIER:1,RANGE_TEXT_POSITION:Io.Right,TICKS_BAR_SIZE:50};class Yh extends Pge{constructor(e){super(e),this._isMouseOver=!1,this._isInteracting=!1,this._mouseOverCallback=r=>{this._isMouseOver=!0,this.showTicks(),r.stopPropagation()},this._mouseOutCallback=r=>{this._isMouseOver=!1,this.hideTicks(),r.stopPropagation()},this._mouseDownCallback=r=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(r),r.stopPropagation()},this._mouseDragCallback=(r,n)=>{const i=this.getVOIMultipliers(),o=this._getPointsFromMouseEvent(r),{points:a,voiRange:s}=n,c=Mo(xt(),o.local,a.local),l=c[0]*i[0],f=c[1]*i[1];if(!l&&!f)return;const{lower:u,upper:d}=s;let{windowWidth:h,windowCenter:g}=R0(u,d);h=Math.max(h+l,1),g+=f;const p=Tl(h,g);this.voiRange=p,r.stopPropagation(),r.preventDefault()},this._mouseUpCallback=r=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),r.stopPropagation()},this._eventListenersManager=new S7,this._colormaps=Yh.getColormapsMap(e),this._activeColormapName=Yh.getInitialColormapName(e),this._canvas=this._createCanvas(e),this._ticksBar=this._createTicksBar(e),this._rangeTextPosition=e.ticks?.position??Cd.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(e){if(e===this._activeColormapName)return;const r=this._colormaps.get(e);if(!r){console.warn(`Invalid colormap name (${e})`);return}this._activeColormapName=e,this._canvas.colormap=r}get imageRange(){return this._canvas.imageRange}set imageRange(e){this._canvas.imageRange=e,this._ticksBar.imageRange=e}get voiRange(){return this._canvas.voiRange}set voiRange(e){const{voiRange:r}=this._canvas;!pc(e)||qh(e,r)||(this._canvas.voiRange=e,this._ticksBar.voiRange=e,this.onVoiChange(e))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(e){this._canvas.showFullImageRange=e,this._ticksBar.showFullPixelValueRange=e}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const e=document.createElement("div");return Object.assign(e.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),e}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[Cd.MULTIPLIER,Cd.MULTIPLIER]}onVoiChange(e){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(e){const{colormaps:r}=e;return r.reduce((n,i)=>n.set(i.Name,i),new Map)}static getInitialColormapName(e){const{activeColormapName:r,colormaps:n}=e;return!!r&&n.some(o=>o.Name===r)?r:n[0].Name}_createCanvas(e){const{imageRange:r,voiRange:n,showFullPixelValueRange:i}=e,o=this._colormaps.get(this._activeColormapName);return new R3({colormap:o,imageRange:r,voiRange:n,showFullPixelValueRange:i})}_createTicksBar(e){const r=e.ticks;return new A3({imageRange:e.imageRange,voiRange:e.voiRange,ticks:r,showFullPixelValueRange:e.showFullPixelValueRange})}_getPointsFromMouseEvent(e){const{rootElement:r}=this,n=[e.clientX,e.clientY],i=[e.pageX,e.pageY],o=r.getBoundingClientRect(),a=[i[0]-o.left-window.pageXOffset,i[1]-o.top-window.pageYOffset];return{client:n,page:i,local:a}}updateTicksBar(){const{width:e,height:r}=this.containerSize;if(e===0&&r===0)return;const{_ticksBar:n,_rangeTextPosition:i}=this,o=e>=r,a=o?e:Cd.TICKS_BAR_SIZE,s=o?Cd.TICKS_BAR_SIZE:r;if(!Oge(e,r,i))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let c,l;n.size={width:a,height:s},o?(l=0,c=i===Io.Top?-s:r):(c=0,l=i===Io.Left?-a:e),n.top=c,n.left=l}_addRootElementEventListeners(){const{_eventListenersManager:e}=this,{rootElement:r}=this;e.addEventListener(r,"mouseover",this._mouseOverCallback),e.addEventListener(r,"mouseout",this._mouseOutCallback),e.addEventListener(r,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(e){const{_eventListenersManager:r}=this,n=this._getPointsFromMouseEvent(e),i={...this._canvas.voiRange},o={points:n,voiRange:i};this._removeVOIEventListeners(),r.addEventListener(document,"voi.mouseup",this._mouseUpCallback),r.addEventListener(document,"voi.mousemove",a=>this._mouseDragCallback(a,o))}_removeVOIEventListeners(){const{_eventListenersManager:e}=this;e.removeEventListener(document,"voi.mouseup"),e.removeEventListener(document,"voi.mousemove")}}const my=4;function Rge(t,e,r){if(U7(t,e)==="PT"){const{clientWidth:i,clientHeight:o}=t.element,a=5/Math.max(i,o),s=Pc(t,e),{fixedPTWindowWidth:c=!0}=r??{},l=c?0:a;return s?[l,a]:[l,my]}return[my,my]}const{Events:al}=go,Op={lower:-1e3,upper:1e3};class Ff extends Yh{constructor(e){const{element:r,volumeId:n}=e,i=Ff._getImageRange(r,n),o=Ff._getVOIRange(r,n);super({...e,imageRange:i,voiRange:o}),this.autoHideTicks=()=>{if(this._hideTicksTimeoutId)return;const a=this._hideTicksTime-Date.now();a<=0?this.hideTicks():this._hideTicksTimeoutId=window.setTimeout(()=>{this._hideTicksTimeoutId=0,this.autoHideTicks()},a)},this._stackNewImageCallback=()=>{this.imageRange=Ff._getImageRange(this._element)},this._imageVolumeModifiedCallback=a=>{const{volumeId:s}=a.detail;if(s!==this._volumeId)return;const{_element:c}=this;this.imageRange=Ff._getImageRange(c,s)},this._viewportVOIModifiedCallback=a=>{const{viewportId:s,volumeId:c,range:l,colormap:f}=a.detail,{viewport:u}=this.enabledElement;s!==u.id||c!==this._volumeId||(this.voiRange=l,f&&(this.activeColormapName=f.name),this.showAndAutoHideTicks())},this._viewportColormapModifiedCallback=a=>{const{viewportId:s,colormap:c,volumeId:l}=a.detail,{viewport:f}=this.enabledElement;s!==f.id||l!==this._volumeId||(this.activeColormapName=c.name)},this._element=r,this._volumeId=n,this._addCornerstoneEventListener()}get element(){return this._element}get enabledElement(){return Ce(this._element)}getVOIMultipliers(){const{viewport:e}=this.enabledElement;return Rge(e,this._volumeId)}onVoiChange(e){super.onVoiChange(e);const{viewport:r}=this.enabledElement;if(r instanceof qn)r.setProperties({voiRange:e}),r.render();else if(r instanceof zn){const{_volumeId:n}=this,i=gg(n);r.setProperties({voiRange:e},n),i.forEach(o=>o.render())}}static _getImageRange(e,r){const n=Ce(e),{viewport:i}=n,o=i.getImageActor(r);if(!o)return Op;const s=o.getMapper().getInputData().getPointData().getScalars();let c;if(s)c=s.getRange();else{if(!r)throw new Error("volumeId is required when scalarData is not available");const l=Ae.getVolume(r),[f,u]=l.voxelManager.getRange();c=[f,u]}return c[0]===0&&c[1]===0?Op:{lower:c[0],upper:c[1]}}static _getVOIRange(e,r){const n=Ce(e),{viewport:i}=n,o=i.getImageActor(r);if(!o)return Op;const a=o.getProperty().getRGBTransferFunction(0).getRange();return a[0]===0&&a[1]===0?Op:{lower:a[0],upper:a[1]}}showAndAutoHideTicks(e=1e3){this._hideTicksTime=Date.now()+e,this.showTicks(),this.autoHideTicks()}_addCornerstoneEventListener(){const{_element:e}=this;ke.addEventListener(al.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.addEventListener(al.STACK_NEW_IMAGE,this._stackNewImageCallback),e.addEventListener(al.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.addEventListener(al.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}destroy(){super.destroy();const{_element:e}=this;ke.removeEventListener(al.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.removeEventListener(al.STACK_NEW_IMAGE,this._stackNewImageCallback),e.removeEventListener(al.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.removeEventListener(al.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}}const Age=Object.freeze(Object.defineProperty({__proto__:null,Colorbar:Yh,Enums:Dge,ViewportColorbar:Ff},Symbol.toStringTag,{value:"Module"}));function FA(t,e,r,n,i){const o=[];let a=0;const s=t.scalarData;let c,l,f;if(t.color)for(l=0;l<i;l++)for(f=0;f<n;f++){c=((l+r)*t.columns+(f+e))*4;const u=s[c],d=s[c+1],h=s[c+2];o[a++]=.2126*u+.7152*d+.0722*h}else for(l=0;l<i;l++)for(f=0;f<n;f++)c=(l+r)*t.columns+(f+e),o[a++]=s[c];return o}function UA(t,e,r){const n=t.length;let i=r,o=e,a=0;if(n<2)return{min:i,max:o,mean:(e+r)/2};for(let s=0;s<n;s++){const c=t[s];i=Math.min(i,c),o=Math.max(o,c),a+=c}return{min:i,max:o,mean:a/n}}function BA(t){if(t instanceof zn)return Lge(t);if(t instanceof qn)return Nge(t);throw new Error("Viewport not supported")}function Lge(t){const{scalarData:e,width:r,height:n}=sx(t),{min:i,max:o}=ix(e);return{scalarData:e,minPixelValue:i,maxPixelValue:o,width:r,height:n,rows:r,columns:n}}function Nge(t){const e=t.getImageData(),{scalarData:r}=e,{min:n,max:i}=ix(r),o=e.dimensions[0],a=e.dimensions[1],{rows:s,columns:c,color:l}=t.getCornerstoneImage();return{scalarData:r,width:o,height:a,minPixelValue:n,maxPixelValue:i,rows:s,columns:c,color:l}}const Vge=Object.freeze(Object.defineProperty({__proto__:null,calculateMinMaxMean:UA,extractWindowLevelRegionToolData:BA,getLuminanceFromRegion:FA},Symbol.toStringTag,{value:"Module"})),kge=Object.freeze(Object.defineProperty({__proto__:null,colorbar:Age,windowLevel:Vge},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:tw}=gn;function Fge(t,e,r,n){const{boundsIJK:i,centerWorld:o,radiusWorld:a}=Uge(e,t,n),s={center:o,radius:a},c=t.getDimensions();La.createScalarVolumeVoxelManager({dimensions:c,scalarData:t.getPointData().getScalars().getData()}).forEach(r,{boundsIJK:i,isInObject:f=>qR(s,f),imageData:t})}function Uge(t,e,r){const[n,i]=t,o=mt((n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2),a=Nr(n,i)/2;let s;if(!r){const c=tw(e,o),l=e.getSpacing(),f=Math.min(...l),u=Math.ceil(a/f);return s=[[c[0]-u,c[0]+u],[c[1]-u,c[1]+u],[c[2]-u,c[2]+u]],{boundsIJK:s,centerWorld:o,radiusWorld:a}}return s=Bge(e,r,t,o,a),{boundsIJK:s,centerWorld:o,radiusWorld:a}}function Bge(t,e,r,n,i){const[o,a]=r,s=t.getDimensions(),c=e.getCamera(),l=mt(c.viewUp[0],c.viewUp[1],c.viewUp[2]),f=mt(c.viewPlaneNormal[0],c.viewPlaneNormal[1],c.viewPlaneNormal[2]),u=Ie();nn(u,l,f);const d=Ie(),h=Ie();tn(d,a,f,i),tn(h,o,f,-i),tn(d,d,u,-i),tn(h,h,u,i);const g=[tw(t,d),tw(t,h)];return Rl(g,s)}function GA(t){if(!Array.isArray(t)||t.length!==9)throw new Error("Matrix must be an array of 9 numbers");if(!t.every(e=>typeof e=="number"&&!isNaN(e)))throw new Error("Matrix must contain only valid numbers")}function WA(t){GA(t);const e=[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]]],r=e[0][0]*(e[1][1]*e[2][2]-e[1][2]*e[2][1])-e[0][1]*(e[1][0]*e[2][2]-e[1][2]*e[2][0])+e[0][2]*(e[1][0]*e[2][1]-e[1][1]*e[2][0]);if(Math.abs(r)<1e-10)throw new Error("Matrix is not invertible (determinant is zero)");const n=[[e[1][1]*e[2][2]-e[1][2]*e[2][1],-(e[0][1]*e[2][2]-e[0][2]*e[2][1]),e[0][1]*e[1][2]-e[0][2]*e[1][1]],[-(e[1][0]*e[2][2]-e[1][2]*e[2][0]),e[0][0]*e[2][2]-e[0][2]*e[2][0],-(e[0][0]*e[1][2]-e[0][2]*e[1][0])],[e[1][0]*e[2][1]-e[1][1]*e[2][0],-(e[0][0]*e[2][1]-e[0][1]*e[2][0]),e[0][0]*e[1][1]-e[0][1]*e[1][0]]],i=[];for(let o=0;o<3;o++)for(let a=0;a<3;a++)i.push(n[o][a]/r);return i}function vy(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return t.map(r=>r/e)}function Gge(t){GA(t);const e=t.slice(0,3),r=t.slice(3,6),n=t.slice(6,9),i=vy(e),o=vy(r),a=vy(n),s={x:[1,0,0],y:[0,1,0],z:[0,0,1]},c=1e-10,l=i.every((u,d)=>Math.abs(u-s.x[d])<c)&&o.every((u,d)=>Math.abs(u-s.y[d])<c)&&a.every((u,d)=>Math.abs(u-s.z[d])<c),f=l?[...s.x,...s.y,...s.z]:WA([...i,...o,...a]);return{isStandard:l,rotationMatrix:f}}function Wge(t,e,r){const n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return[r[0]*n+r[1]*i+r[2]*o+e[0],r[3]*n+r[4]*i+r[5]*o+e[1],r[6]*n+r[7]*i+r[8]*o+e[2]]}function $ge(t,e,r){const n=[];for(let i=0;i<r.length;i+=3){const o=r.slice(i,i+3),a=Wge(o,e,t);n.push(...a)}return n}const zge=Object.freeze(Object.defineProperty({__proto__:null,checkStandardBasis:Gge,inverse3x3Matrix:WA,rotatePoints:$ge},Symbol.toStringTag,{value:"Module"}));function $A(t,e,r){t.data.label=r,Gt(t,e,Nt.LabelChange)}function jge(t,e){const{data:r}=t,{points:n}=r.handles,{focalPoint:i,viewPlaneNormal:o}=e.getCamera(),a=ft(an(Ie(),n[0],i),o);return n.forEach(s=>{nr(s,s,Jn(Ie(),[-o[0],-o[1],-o[2]],a))}),e instanceof qn&&(t.metadata.referencedImageId=e.getCurrentImageId()),t}function Hge(t,e,r){const n=e*r,i=t.length/n;if(![1,3,4].includes(i))throw new Error("Buffer must be 1, 3, or 4 channels per pixel");const o=Array.from({length:r},()=>new Array(e).fill(!1));for(let m=0;m<r;m++)for(let w=0;w<e;w++){const y=(m*e+w)*i;let C=!1;for(let x=0;x<Math.min(3,i);x++)if(t[y+x]>0){C=!0;break}o[m][w]=C}const a=Array.from({length:r},()=>new Array(e).fill(0));let s=0;const c={};for(let m=0;m<r;m++)for(let w=0;w<e;w++)if(o[m][w]&&a[m][w]===0){s++;const v=(x,T)=>x<0||x>=e||T<0||T>=r?!1:o[T][x]&&a[T][x]===0;let y=0;S3(v,[w,m],{onFlood:(x,T)=>{a[T][x]=s,y++},diagonals:!1}),c[s]=y}if(s===0)return[];const l=Object.keys(c).reduce((m,w)=>c[m]>c[w]?m:w);function f(m,w){if(a[w][m]!==+l)return!1;for(const[v,y]of[[1,0],[-1,0],[0,1],[0,-1]]){const C=m+v,x=w+y;if(C<0||C>=e||x<0||x>=r||a[x][C]!==+l)return!0}return!1}let u=null;e:for(let m=0;m<r;m++)for(let w=0;w<e;w++)if(f(w,m)){u=[w,m];break e}if(!u)return[];const d=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]],h=[];let g=u,p=[u[0]-1,u[1]];do{h.push([g[0],g[1]]);const m=p[0]-g[0],w=p[1]-g[1];let v=d.findIndex(C=>C[0]===m&&C[1]===w);v<0&&(v=0);let y=null;for(let C=1;C<=8;C++){const[x,T]=d[(v+C)%8],S=g[0]+x,_=g[1]+T;if(S>=0&&S<e&&_>=0&&_<r&&f(S,_)){y=[S,_];const[E,D]=d[(v+C-1+8)%8];p=[g[0]+E,g[1]+D];break}}if(!y)break;g=y}while(g[0]!==u[0]||g[1]!==u[1]);return h}function Kge(t){const e=E2(t,2),r=WO(e);return{simplified:e,hull:r}}function Xge(t,e=7){if(!t.length)throw new Error("Convex hull is empty");const r=t.length,n=w=>(w+1)%r,i=(w,v)=>{const y=[];for(let C=w;y.push(C),C!==v;C=n(C));return y};let o=0,a=0;for(let w=1;w<r;w++)t[w][0]<t[o][0]&&(o=w),t[w][0]>t[a][0]&&(a=w);const s=t[o],c=t[a],l=i(o,a),f=i(a,o),u=Math.min(...t.map(w=>w[1])),d=l.some(w=>t[w][1]===u)?l:f,h=Math.min(...d.map(w=>t[w][1]));let g=d.map(w=>t[w]).filter(w=>Math.abs(w[1]-h)<=e);g.length<2&&(g=d.map(w=>t[w]).sort((w,v)=>w[1]-v[1]).slice(0,2));const p=g.reduce((w,v)=>v[0]<w[0]?v:w,g[0]),m=g.reduce((w,v)=>v[0]>w[0]?v:w,g[0]);return{P1:p,P2:s,P3:c,P4:m}}function qge(t,e,r,n,i,o={}){const{maxDist:a=15,slack:s=2}=o,c={P1:{dx:-1,dy:-1},P2:{dx:-1,dy:1},P3:{dx:1,dy:1},P4:{dx:1,dy:-1}};function l(f,{dx:u,dy:d},h=5){const g=u<0?f[0]-a:f[0]-s,p=u<0?f[0]+s:f[0]+a,m=d<0?f[1]-a:f[1]-s,w=d<0?f[1]+s:f[1]+a;let v=f;for(const[y,C]of i){if(y<g||y>p||C<m||C>w)continue;const x=Math.round(y),T=Math.round(C);if(x<0||x>=e||T<0||T>=r)continue;const S=(x-v[0])*u,_=(T-v[0])*d;t[T*e+x]>h&&(S>0||_>0)&&(v=[y,C])}return v}return{P1:l(n.P1,c.P1),P2:l(n.P2,c.P2),P3:l(n.P3,c.P3),P4:l(n.P4,c.P4)}}function Yge(t,e,r,n,i){const o=Xge(n);return qge(t,e,r,o,i,{maxDist:20})}function C4(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function Jge(t){const{P1:e,P2:r,P3:n,P4:i}=t,o=c1(e,r,i,n,!0);if(!o)throw new Error("Fan edges appear parallel  no apex found");const a=o;let s=C4(a,e)*(180/Math.PI),c=C4(a,i)*(180/Math.PI);if(c<=s){const p=s;s=c,c=p}const l=Math.hypot(e[0]-a[0],e[1]-a[1]),f=Math.hypot(i[0]-a[0],i[1]-a[1]),u=Math.hypot(r[0]-a[0],r[1]-a[1]),d=Math.hypot(n[0]-a[0],n[1]-a[1]),h=Math.min(l,f),g=Math.max(u,d);return{center:a,startAngle:s,endAngle:c,innerRadius:h,outerRadius:g}}function Nd(t,e,r,n,i={}){const{strokeStyle:o="#f00",lineWidth:a=2,quality:s=.92}=i,c=document.createElement("canvas");c.width=e,c.height=r;const l=c.getContext("2d"),f=e*r,u=t.length/f,d=l.createImageData(e,r),h=d.data;for(let g=0;g<f;g++){const p=g*u,m=g*4;if(u===1){const w=t[p];h[m]=w,h[m+1]=w,h[m+2]=w,h[m+3]=255}else h[m]=t[p],h[m+1]=t[p+1],h[m+2]=t[p+2],h[m+3]=u===4?t[p+3]:255}if(l.putImageData(d,0,0),n.length>0){l.strokeStyle=o,l.lineWidth=a,l.beginPath(),l.moveTo(n[0][0]+.5,n[0][1]+.5);for(let g=1;g<n.length;g++)l.lineTo(n[g][0]+.5,n[g][1]+.5);l.closePath(),l.stroke()}return c.toDataURL("image/jpeg",s)}function L3(t){const e=Ae.getImage(t);if(!e)return;const r=e.width,n=e.height;return{pixelData:e.getPixelData(),width:r,height:n}}function zA(t,e){const r=document.createElement("a");r.href=t,r.download=e,document.body.appendChild(r),r.style.display="none",r.click(),r.remove()}function Zge(t,e,r,n,i={}){const{center:o,startAngle:a,endAngle:s,innerRadius:c,outerRadius:l}=n,{strokeStyle:f="#0ff",lineWidth:u=2,quality:d=.92}=i,h=a*Math.PI/180,g=s*Math.PI/180,p=document.createElement("canvas");p.width=e,p.height=r;const m=p.getContext("2d"),w=e*r,v=t.length/w,y=m.createImageData(e,r),C=y.data;for(let x=0;x<w;x++){const T=x*4;if(v===1){const S=t[x];C[T]=S,C[T+1]=S,C[T+2]=S,C[T+3]=255}else{const S=x*v;C[T]=t[S],C[T+1]=t[S+1],C[T+2]=t[S+2],C[T+3]=v===4?t[S+3]:255}}m.putImageData(y,0,0),m.beginPath();for(let x=h;x<=g;x+=.01){const T=o[0]+c*Math.cos(x),S=o[1]+c*Math.sin(x);x===h?m.moveTo(T,S):m.lineTo(T,S)}for(let x=g;x>=h;x-=.01){const T=o[0]+l*Math.cos(x),S=o[1]+l*Math.sin(x);m.lineTo(T,S)}return m.closePath(),m.strokeStyle=f,m.lineWidth=u,m.stroke(),p.toDataURL("image/jpeg",d)}function Qge(t,e=5){const{contour:r,simplified:n,hull:i,refined:o,fanGeometry:a}=N3(t),{pixelData:s,width:c,height:l}=L3(t)||{};if(!s)return;let f;e===1?f=Nd(s,c,l,r):e===2?f=Nd(s,c,l,n):e===3?f=Nd(s,c,l,i):e===4?f=Nd(s,c,l,[o.P1,o.P2,o.P3,o.P4]):f=Zge(s,c,l,a,{strokeStyle:"#f00",lineWidth:3,quality:.95}),zA(f,"contour.jpg")}function N3(t){const{pixelData:e,width:r,height:n}=L3(t)||{};if(!e)return;const i=Hge(e,r,n),{simplified:o,hull:a}=Kge(i),s=Yge(e,r,n,a,o),c=Jge({P1:s.P1,P2:s.P2,P3:s.P3,P4:s.P4});return{contour:i,simplified:o,hull:a,refined:s,fanGeometry:c}}const epe=Object.freeze(Object.defineProperty({__proto__:null,calculateFanGeometry:N3,default:zA,downloadFanJpeg:Qge,exportContourJpeg:Nd,getPixelData:L3},Symbol.toStringTag,{value:"Module"})),tpe=Ht,npe=Object.freeze(Object.defineProperty({__proto__:null,AnnotationMultiSlice:M0e,IslandRemoval:of,annotationHydration:woe,boundingBox:b0e,calibrateImageSpacing:E0e,cine:$he,contourSegmentation:use,contours:xue,debounce:j0,drawing:cle,dynamicVolume:Ege,geometricSurfaceUtils:zge,getAnnotationNearPoint:T0e,getAnnotationNearPointOnEnabledElement:kR,getCalibratedAspect:n3,getCalibratedLengthUnitsAndScale:Fo,getCalibratedProbeUnitsAndValue:h1,getClosestImageIdForStackViewport:Ax,getOrCreateImageVolume:k2,getPixelValueUnits:Rc,getPixelValueUnitsImageId:jP,getSphereBoundsInfo:BR,getViewportForAnnotation:fm,isObject:a3,math:yae,moveAnnotationToViewPlane:jge,normalizeViewportPlane:jR,orientation:Lhe,planar:Hse,planarFreehandROITool:Khe,pointInSurroundingSphereCallback:Fge,pointToString:GR,polyDataUtils:bge,rectangleROITool:Zhe,roundNumber:tpe,segmentation:Phe,setAnnotationLabel:$A,stackContextPrefetch:vge,stackPrefetch:lge,throttle:$i,touch:kie,triggerAnnotationRender:$0,triggerAnnotationRenderForToolGroupIds:mP,triggerAnnotationRenderForViewportIds:Me,triggerEvent:Xe,usFanExtraction:epe,viewport:yge,viewportFilters:Gae,voi:kge},Symbol.toStringTag,{value:"Module"})),rpe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function jA(t,e){const r=An;t.forEach(n=>{r.updateSegmentation(n.segmentationId,n.payload),e||la(n.segmentationId)})}function ipe(t,e,r){An.setSegmentationRepresentationVisibility(t,e,r)}function ope(t,e,r){const n=ho(t,e);n&&n.forEach(i=>{ipe(t,{segmentationId:i.segmentationId,type:i.type},r)})}function ape(t,e){return $P(t,e)}function spe(t,e,r,n){const i=ho(t,e);i&&(i.forEach(o=>{!o.segments||!o.segments[r]||(o.segments[r].visible=n)}),F2(e.segmentationId),us(t,e.segmentationId))}function cpe(t,e,r){return!HA(t,e).has(r)}function HA(t,e){const r=Ix(t,e);return r?Object.entries(r.segments).reduce((i,[o,a])=>(a.visible||i.add(Number(o)),i),new Set):new Set}const lpe=Object.freeze(Object.defineProperty({__proto__:null,getHiddenSegmentIndices:HA,getSegmentIndexVisibility:cpe,getSegmentationRepresentationVisibility:ape,setSegmentIndexVisibility:spe,setSegmentationRepresentationVisibility:ope},Symbol.toStringTag,{value:"Module"}));function upe(t){return fo.getStyle(t)}function fpe(t,e,r){fo.setStyle(t,e,r),!t.viewportId&&!t.segmentationId&&V2().forEach(i=>{q0(i.segmentationId)}),us(t.viewportId,t.segmentationId,t.type)}function dpe(t,e){fo.setRenderInactiveSegmentations(t,e),q0(t),MP(t).forEach(n=>{us(t,n.segmentationId)})}function hpe(t){return fo.getRenderInactiveSegmentations(t)}function gpe(){fo.resetToGlobalStyle(),q0()}function ppe(t){return fo.hasCustomStyle(t)}const mpe=Object.freeze(Object.defineProperty({__proto__:null,getRenderInactiveSegmentations:hpe,getStyle:upe,hasCustomStyle:ppe,resetToGlobalStyle:gpe,setRenderInactiveSegmentations:dpe,setStyle:fpe},Symbol.toStringTag,{value:"Module"})),vpe=Object.freeze(Object.defineProperty({__proto__:null,color:Aue,style:mpe,visibility:lpe},Symbol.toStringTag,{value:"Module"}));async function ype(t){const e=coe(t);return la(t.segmentationId),e}function KA(t,e){const r=Ut(t);if(r.representationData.Labelmap){const{representationData:n}=r,i=n.Labelmap;("imageIds"in i||"volumeId"in i)&&("imageIds"in i?i.imageIds.map(a=>Ae.getImage(a)):[Ae.getVolume(i.volumeId)]).forEach(a=>{if(!a)return;const{voxelManager:s}=a;s.forEach(({value:c,index:l})=>{c===e&&s.setAtIndex(l,0)})}),ui(t)}else throw new Error("Invalid segmentation type, only labelmap is supported right now")}function wpe(t,e){const r=Fh(t);if(!r)return;const n=r.get(e);n&&n.forEach(i=>{const o=vn(i);z0(o)&&L2(o)})}function Cpe(t,e,r={setNextSegmentAsActive:!0}){const n=Ut(t);if(n?.representationData.Contour)wpe(t,e);else if(n?.representationData.Labelmap)KA(t,e);else throw new Error("Invalid segmentation type");const i=no(t)===e,{segments:o}=n;delete o[e];const a={...o};if(jA([{segmentationId:t,payload:{segments:a}}]),i&&r.setNextSegmentAsActive){const c=Object.keys(o).map(Number).sort((d,h)=>d-h),l=c.indexOf(e),f=c[l+1],u=c[l-1];f!==void 0?Kh(t,f):u!==void 0&&Kh(t,u)}ff(t).forEach(c=>{ho(c,{segmentationId:t}).forEach(f=>{delete f.segments[e]})})}function xpe(t){const e=An,r=Ut(t);return e.getLabelmapImageIds(r.representationData)}const Tpe={clearSegmentValue:KA,convertStackToVolumeLabelmap:ype,computeVolumeLabelmapFromStack:CA,convertVolumeToStackLabelmap:_he},Spe=Object.freeze(Object.defineProperty({__proto__:null,activeSegmentation:Ase,addContourRepresentationToViewport:b3,addContourRepresentationToViewportMap:whe,addDefaultSegmentationListener:d3,addLabelmapRepresentationToViewport:yA,addLabelmapRepresentationToViewportMap:Che,addRepresentationData:Mx,addSegmentationListener:CP,addSegmentationRepresentations:Z0,addSegmentations:wP,addSurfaceRepresentationToViewport:wA,addSurfaceRepresentationToViewportMap:xhe,config:vpe,defaultSegmentationStateManager:An,getActiveSegmentation:nf,getCurrentLabelmapImageIdsForViewport:Ic,getLabelmapImageIds:xpe,getLabelmapImageIdsForImageId:_se,helpers:Tpe,removeAllSegmentationListeners:nue,removeAllSegmentationRepresentations:SP,removeAllSegmentations:DP,removeContourRepresentation:EP,removeLabelmapRepresentation:_P,removeSegment:Cpe,removeSegmentation:g3,removeSegmentationListener:h3,removeSegmentationRepresentation:K0,removeSegmentationRepresentations:xP,removeSurfaceRepresentation:bP,segmentIndex:mhe,segmentLocking:Oue,segmentationStyle:fo,state:cue,strategies:Sde,triggerSegmentationEvents:eoe,updateSegmentations:jA,utilities:bue},Symbol.toStringTag,{value:"Module"}));class V3{constructor(e){this._controlPoints=[],this._invalidated=!1,this._length=0,this._controlPoints=[],this._resolution=e?.resolution??20,this._fixedResolution=e?.fixedResolution??!1,this._closed=e?.closed??!1,this._invalidated=!0}get controlPoints(){return this._controlPoints}get numControlPoints(){return this._controlPoints.length}get resolution(){return this._resolution}set resolution(e){this._fixedResolution||this._resolution===e||(this._resolution=e,this.invalidated=!0)}get fixedResolution(){return this._fixedResolution}get closed(){return this._closed}set closed(e){this._closed!==e&&(this._closed=e,this.invalidated=!0)}get aabb(){return this._update(),this._aabb}get length(){return this._update(),this._length}get invalidated(){return this._invalidated}set invalidated(e){this._invalidated=e}hasTangentPoints(){return!1}addControlPoint(e){this._controlPoints.push([e[0],e[1]]),this.invalidated=!0}addControlPoints(e){e.forEach(r=>this.addControlPoint(r))}addControlPointAtU(e){const r=this._getLineSegmentAt(e),{start:n,end:i}=r.points,o=Math.floor(e),a=this._curveSegments[o],s=e-Math.floor(o),c=[n[0]+s*(i[0]-n[0]),n[1]+s*(i[1]-n[1])],l=this._controlPoints.indexOf(a.controlPoints.p1)+1;return this._controlPoints.splice(l,0,c),this.invalidated=!0,{index:l,point:c}}deleteControlPointByIndex(e){const r=this._closed?3:1;return e>=0&&e<this._controlPoints.length&&this._controlPoints.length>r?(this._controlPoints.splice(e,1),this.invalidated=!0,!0):!1}clearControlPoints(){this._controlPoints=[],this.invalidated=!0}setControlPoints(e){this.clearControlPoints(),this.addControlPoints(e)}updateControlPoint(e,r){if(e<0||e>=this._controlPoints.length)throw new Error("Index out of bounds");this._controlPoints[e]=[...r],this.invalidated=!0}getControlPoints(){return this._controlPoints.map(e=>[e[0],e[1]])}getClosestControlPoint(e){const r=this._controlPoints;let n=1/0,i=-1;for(let o=0,a=r.length;o<a;o++){const s=r[o],c=e[0]-s[0],l=e[1]-s[1],f=c*c+l*l;f<n&&(n=f,i=o)}return{index:i,point:i===-1?void 0:[...r[i]],distance:Math.sqrt(n)}}getClosestControlPointWithinDistance(e,r){const n=this.getClosestControlPoint(e);return n.distance<=r?n:void 0}getClosestPoint(e){this._update();const r=this._getCurveSegmmentsDistanceSquaredInfo(e);if(!r.length)return;r.sort((u,d)=>u.distanceSquared-d.distanceSquared);let n,i=-1,o=1/0,a,s;for(let u=0;u<r.length;u++){const d=r[u];if(d.distanceSquared>o)continue;const{curveSegmentIndex:h,curveSegment:g}=d,{lineSegments:p}=g;for(let m=0;m<p.length;m++){const w=p[m],{point:v,distanceSquared:y}=s1(w.points.start,w.points.end,e);y<o&&(s=w,i=h,a=d.curveSegment,n=v,o=y)}}const l=(s.previousLineSegmentsLength+Os(s.points.start,n))/a.length,f=i+l;return{point:n,uValue:f,distance:Math.sqrt(o)}}getClosestPointOnControlPointLines(e){const r=[...this._controlPoints];if(this._closed&&r.push(this._controlPoints[0]),!r.length)return;let n,i=1/0,o=r[0];for(let a=1,s=r.length;a<s;a++){const c=r[a],{point:l,distanceSquared:f}=s1(o,c,e);f<i&&(n=l,i=f),o=c}return{point:n,distance:Math.sqrt(i)}}getPolylinePoints(){return this._update(),this._convertCurveSegmentsToPolyline(this._curveSegments)}getPreviewPolylinePoints(e,r){if(this._closed)return[];this._update();const i=this.getClosestControlPointWithinDistance(e,r)?.index===0,o=this.getPreviewCurveSegments(e,i);return o?.length?this._convertCurveSegmentsToPolyline(o):[]}isPointNearCurve(e,r){this._update();const n=this._getCurveSegmmentsWithinDistance(e,r),i=r*r;for(let o=0;o<n.length;o++){const{lineSegments:a}=n[o];for(let s=0;s<a.length;s++){const c=a[s];if(Ig(c.points.start,c.points.end,e)<=i)return!0}}return!1}containsPoint(e){if(this._update(),this._controlPoints.length<3)return!1;const n=[...this._curveSegments],i=this._getClosingCurveSegmentWithStraightLineSegment();i&&n.push(i);let o=0;for(let a=0;a<n.length;a++){const s=n[a],{aabb:c}=s;if(!(e[0]<=c.maxX&&e[1]>=c.minY&&e[1]<c.maxY))continue;const{lineSegments:f}=s;for(let u=0;u<f.length;u++){const d=f[u],{aabb:h}=d;if(e[0]<=h.maxX&&e[1]>=h.minY&&e[1]<h.maxY){const{start:p,end:m}=d.points,w=p[0]===m[0],v=(e[1]-p[1])*(m[0]-p[0])/(m[1]-p[1])+p[0];o+=w||e[0]<=v?1:0}}}return o%2===1}_update(){if(!this._invalidated)return;const e=this.getSplineCurves();let r=0,n=1/0,i=1/0,o=-1/0,a=-1/0;for(let s=0,c=e.length;s<c;s++){const{aabb:l,length:f}=e[s];n=n<=l.minX?n:l.minX,i=i<=l.minY?i:l.minY,o=o>=l.maxX?o:l.maxX,a=a>=l.maxY?a:l.maxY,r+=f}this._curveSegments=e,this._aabb={minX:n,minY:i,maxX:o,maxY:a},this._length=r,this._invalidated=!1}_convertCurveSegmentsToPolyline(e){this._update();const r=[];return e.forEach(({lineSegments:n},i)=>{n.forEach((o,a)=>{i===0&&a===0&&r.push([...o.points.start]),r.push([...o.points.end])})}),r}_getCurveSegmmentsDistanceSquaredInfo(e){this._update();const r=[],{_curveSegments:n}=this;for(let i=0;i<n.length;i++){const o=n[i],a=a1(o.aabb,e);r.push({curveSegmentIndex:i,curveSegment:o,distanceSquared:a})}return r}_getCurveSegmmentsWithinDistance(e,r){this._update();const n=r*r;if(a1(this.aabb,e)>n)return[];const i=this._getCurveSegmmentsDistanceSquaredInfo(e),o=[];for(let a=0,s=i.length;a<s;a++){const{curveSegment:c,distanceSquared:l}=i[a];l<=n&&o.push(c)}return o}_getLineSegmentAt(e){this._update();const r=Math.floor(e),n=e-r,i=this._curveSegments[r],{lineSegments:o}=i,a=i.length*n;for(let s=0;s<o.length;s++){const c=o[s],l=c.previousLineSegmentsLength+c.length;if(a>=c.previousLineSegmentsLength&&a<=l)return c}}_getClosingCurveSegmentWithStraightLineSegment(){if(this.closed)return;const e=this._controlPoints,r=e[0],n=e[e.length-1],i={points:{start:[...r],end:[...n]},aabb:{minX:Math.min(r[0],n[0]),minY:Math.min(r[1],n[1]),maxX:Math.max(r[0],n[0]),maxY:Math.max(r[1],n[1])}};return{aabb:{minX:i.aabb.minX,minY:i.aabb.minY,maxX:i.aabb.maxX,maxY:i.aabb.maxY},lineSegments:[i]}}}const _pe=1e-8;class k3 extends V3{getPreviewCurveSegments(e,r){const n=this._getNumCurveSegments()+1,i=Math.max(0,n-2),o=r?n:n-1,a=this.getTransformMatrix(),s=[...this.controlPoints],c=[];r||s.push(e);for(let l=i;l<=o;l++){const f=this._getCurveSegment(l,a,s,r);c.push(f)}return c}getSplineCurves(){const e=this._getNumCurveSegments(),r=new Array(e);if(e<=0)return[];const n=this.getTransformMatrix();let i=0;for(let o=0;o<e;o++){const a=this._getCurveSegment(o,n);a.previousCurveSegmentsLength=i,r[o]=a,i+=a.length}return r}_getNumCurveSegments(e=this.controlPoints,r=this.closed){return r?e.length:Math.max(0,e.length-1)}_getPoint(e,r,n=this.controlPoints,i=this.closed){const o=this._getNumCurveSegments(n,i),a=Math.floor(e);let s=a%o;const c=e-a;if(s<0||s>=o)if(this.closed)s=(o+s)%o;else return;const{p0:f,p1:u,p2:d,p3:h}=this._getCurveSegmentPoints(s,n,i),g=c*c,p=g*c,m=Kp(1,c,g,p),w=lc(B8(),m,r);return[tS(w,Kp(f[0],u[0],d[0],h[0])),tS(w,Kp(f[1],u[1],d[1],h[1]))]}_getCurveSegmentPoints(e,r=this.controlPoints,n=this.closed){const i=this._getNumCurveSegments(r,n),o=e,a=o-1,s=n?(o+1)%i:o+1,c=s+1,l=r[o],f=r[s];let u,d;return a>=0?u=r[a]:u=n?r[r.length-1]:N5(f,l),c<r.length?d=r[c]:d=n?r[0]:N5(l,f),{p0:u,p1:l,p2:f,p3:d}}_getLineSegments(e,r,n=this.controlPoints,i=this.closed){const o=this._getNumCurveSegments(n,i),a=this.resolution+1,s=1/a,c=e;let l=c+1;!i&&e===o-1&&(l-=_pe);const f=[];let u,d,h=0;for(let g=0,p=c;g<=a;g++,p+=s){p=p>l?l:p;const m=this._getPoint(p,r,n,i);if(!g){u=m;continue}d=m;const w=d[0]-u[0],v=d[1]-u[1],y=Math.sqrt(w**2+v**2),C={minX:u[0]<=d[0]?u[0]:d[0],maxX:u[0]>=d[0]?u[0]:d[0],minY:u[1]<=d[1]?u[1]:d[1],maxY:u[1]>=d[1]?u[1]:d[1]};f.push({points:{start:u,end:d},aabb:C,length:y,previousLineSegmentsLength:h}),u=d,h+=y}return f}_getCurveSegment(e,r=this.getTransformMatrix(),n=this.controlPoints,i=this.closed){const{p0:o,p1:a,p2:s,p3:c}=this._getCurveSegmentPoints(e,n,i),l=this._getLineSegments(e,r,n,i);let f=0,u=1/0,d=1/0,h=-1/0,g=-1/0;return l.forEach(({aabb:p,length:m})=>{u=Math.min(u,p.minX),d=Math.min(d,p.minY),h=Math.max(h,p.maxX),g=Math.max(g,p.maxY),f+=m}),{controlPoints:{p0:o,p1:a,p2:s,p3:c},aabb:{minX:u,minY:d,maxX:h,maxY:g},length:f,previousCurveSegmentsLength:0,lineSegments:l}}}const Epe=k8(Ti(),Xw(1,4,1,0,-3,0,3,0,3,-6,3,0,-1,3,-3,1),1/6);class XA extends k3{getTransformMatrix(){return Epe}}class Jh extends k3{constructor(e){super(e),this._scale=e?.scale??.5,this._fixedScale=e?.fixedScale??!1}get scale(){return this._scale}set scale(e){this._fixedScale||this._scale===e||(this._scale=e,this.invalidated=!0)}get fixedScale(){return this._fixedScale}getTransformMatrix(){const{scale:e}=this,r=2*e;return[0,1,0,0,-e,0,e,0,r,e-3,3-r,-e,-e,2-e,e-2,e]}}class qA extends Jh{constructor(){super({scale:.5,fixedScale:!0})}}class YA extends Jh{constructor(){super({resolution:0,fixedResolution:!0,scale:0,fixedScale:!0})}}class JA extends V3{getSplineCurves(){return[]}getLineSegments(){return[]}getPreviewCurveSegments(e,r){return[]}}const bpe=[1,0,0,-2,2,0,1,-2,1];class Dpe extends JA{hasTangentPoints(){return!0}getTransformMatrix(){return bpe}}const Ipe=Object.freeze(Object.defineProperty({__proto__:null,BSpline:XA,CardinalSpline:Jh,CatmullRomSpline:qA,CubicSpline:k3,LinearSpline:YA,QuadraticBezier:Dpe,QuadraticSpline:JA,Spline:V3},Symbol.toStringTag,{value:"Module"}));class ZA extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{limitToViewport:!1,ignoreX:!1,ignoreY:!1,ignoreZ:!1}}){super(e,r)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_checkImageInViewport(e,r){const{canvas:n}=e,i=window.devicePixelRatio,o=0,a=n.width/i,s=0,c=n.height/i,l=e.getDefaultActor(),f=e.getRenderer();let u;l&&ta(l)?u=l.actor.getMapper().getInputData().getBounds():u=f.computeVisiblePropBounds();const[d,h]=e.worldToCanvas([u[0],u[2],u[4]]),[g,p]=e.worldToCanvas([u[1],u[3],u[5]]);if(e.getZoom()<=1){if(d+r[0]<o&&r[0]<0||g+r[0]>a&&r[0]>0||h+r[1]<s&&r[1]<0||p+r[1]>c&&r[1]>0)return!1}else if(d+r[0]>o&&r[0]>0||g+r[0]<a&&r[0]<0||h+r[1]>s&&r[1]>0||p+r[1]<c&&r[1]<0)return!1;return!0}_dragCallback(e){const{element:r,deltaPoints:n}=e.detail,i=Ce(r),o=n.world,a=n.canvas;if(o[0]===0&&o[1]===0&&o[2]===0)return;this.configuration.ignoreX&&(o[0]=0),this.configuration.ignoreY&&(o[1]=0),this.configuration.ignoreZ&&(o[2]=0);const s=i.viewport,c=s.getCamera(),{focalPoint:l,position:f}=c;if(this.configuration.limitToViewport&&!this._checkImageInViewport(s,a))return;const u=[f[0]-o[0],f[1]-o[1],f[2]-o[2]],d=[l[0]-o[0],l[1]-o[1],l[2]-o[2]];s.setCamera({focalPoint:d,position:u}),s.render()}}ZA.toolName="Pan";class QA extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2,rotateSampleDistanceFactor:2}}){super(e,r),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a,f=s.getDefaultActor().actor.getMapper();if(!("getSampleDistance"in f||"getCurrentSampleDistance"in f))return!0;const d=f.getSampleDistance();if(!this._hasResolutionChanged){const{rotateSampleDistanceFactor:h}=this.configuration;f.setSampleDistance(d*h),this._hasResolutionChanged=!0,this.cleanUp!==null&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{f.setSampleDistance(d),s.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})}return!0},this._getViewportsInfo=()=>Kr(this.toolGroupId).viewportsInfo,this.onSetToolActive=()=>{const n=()=>{this._getViewportsInfo().forEach(({viewportId:o,renderingEngineId:a})=>{if(!this._resizeObservers.has(o)){const{viewport:s}=Ln(o,a)||{viewport:null};if(!s)return;const{element:c}=s,l=new ResizeObserver(()=>{const f=Ln(o,a);if(!f)return;const{viewport:u}=f,d=u.getViewPresentation();u.resetCamera(),u.setViewPresentation(d),u.render()});l.observe(c),this._resizeObservers.set(o,l)}})};n(),this._viewportAddedListener=i=>{i.detail.toolGroupId===this.toolGroupId&&n()},ke.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)},this.onSetToolDisabled=()=>{this._resizeObservers.forEach((n,i)=>{n.disconnect(),this._resizeObservers.delete(i)}),this._viewportAddedListener&&(ke.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)},this.rotateCamera=(n,i,o,a)=>{const s=n.getVtkActiveCamera(),c=s.getViewUp(),l=s.getFocalPoint(),f=s.getPosition(),u=[0,0,0],d=[0,0,0],h=[0,0,0],g=_t(new Float32Array(16));Gn(g,g,i),ci(g,g,a,o),Gn(g,g,[-i[0],-i[1],-i[2]]),Pt(u,f,g),Pt(d,l,g),_t(g),ci(g,g,a,o),Pt(h,c,g),n.setCamera({position:u,viewUp:h,focalPoint:d})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:r,currentPoints:n,lastPoints:i}=e.detail,o=n.canvas,a=i.canvas,{rotateIncrementDegrees:s}=this.configuration,c=Ce(r),{viewport:l}=c,f=l.getCamera(),u=r.clientWidth,d=r.clientHeight,h=[o[0]/u,o[1]/d],g=[a[0]/u,a[1]/d],p=[u*.5,d*.5],m=l.canvasToWorld(p),v=(1+Math.abs([.5,.5][0]))**2,y=[g[0],0,0],C=[h[0],0,0],x=y[0]**2,T=C[0]**2,S=x>v?0:Math.sqrt(v-x),_=T>v?0:Math.sqrt(v-T),E=[y[0],0,S];pt.normalize(E);const D=[C[0],0,_];pt.normalize(D);const b=pt.dot(E,D);if(Math.abs(b)>1e-4){const I=-2*Math.acos(pt.clampValue(b,-1,1))*Math.sign(h[0]-g[0])*s,O=f.viewUp,M=f.viewPlaneNormal,R=[0,0,0],A=[0,0,0];pt.cross(O,M,R),pt.normalize(R),pt.cross(M,R,A),pt.normalize(A),pt.normalize(O),this.rotateCamera(l,m,A,I);const B=(g[1]-h[1])*s;this.rotateCamera(l,m,R,B),l.render()}}}QA.toolName="TrackballRotate";function Mpe(t,e){e.classHierarchy.push("vtkSphereSource"),t.requestData=(r,n)=>{let i=n[0];const o=i?i.getPoints().getDataType():e.pointType;i=i?.initialize()||rr.newInstance();let a=0,{thetaResolution:s}=e,c=e.startTheta<e.endTheta?e.startTheta:e.endTheta;c*=Math.PI/180;let l=e.endTheta>e.startTheta?e.endTheta:e.startTheta;l*=Math.PI/180;let f=e.startPhi<e.endPhi?e.startPhi:e.endPhi;f*=Math.PI/180;let u=e.endPhi>e.startPhi?e.endPhi:e.startPhi;u*=Math.PI/180,Math.abs(c-l)<2*Math.PI&&++s;const d=(l-c)/e.thetaResolution,h=e.startPhi<=0?1:0,g=e.phiResolution+(e.endPhi>=180?-1:0),p=e.phiResolution*s+2,m=e.phiResolution*2*e.thetaResolution;let w=0,v=K.newTypedArray(o,p*3),y=new Float32Array(p*3),C=0,x=new Uint32Array(m*5);e.startPhi<=0&&(v[w*3+0]=e.center[0],v[w*3+1]=e.center[1],v[w*3+2]=e.center[2]+e.radius,y[w*3+0]=0,y[w*3+1]=0,y[w*3+2]=1,w++,a++),e.endPhi>=180&&(v[w*3+0]=e.center[0],v[w*3+1]=e.center[1],v[w*3+2]=e.center[2]-e.radius,y[w*3+0]=0,y[w*3+1]=0,y[w*3+2]=-1,w++,a++);const T=e.phiResolution-a,S=(u-f)/(e.phiResolution-1);for(let D=0;D<s;D++){const b=c+D*d;for(let I=h;I<g;I++){const O=f+I*S,M=e.radius*Math.sin(O);y[w*3+0]=M*Math.cos(b),y[w*3+1]=M*Math.sin(b),y[w*3+2]=e.radius*Math.cos(O),v[w*3+0]=y[w*3+0]+e.center[0],v[w*3+1]=y[w*3+1]+e.center[1],v[w*3+2]=y[w*3+2]+e.center[2];let R=Math.sqrt(y[w*3+0]*y[w*3+0]+y[w*3+1]*y[w*3+1]+y[w*3+2]*y[w*3+2]);R=R===0?1:R,y[w*3+0]/=R,y[w*3+1]/=R,y[w*3+2]/=R,w++}}const _=T*s;if(Math.abs(c-l)<2*Math.PI&&--s,e.startPhi<=0)for(let D=0;D<s;D++)x[C++]=3,x[C++]=T*D+a,x[C++]=T*(D+1)%_+a,x[C++]=0;if(e.endPhi>=180){const D=T-1+a;for(let b=0;b<s;b++)x[C++]=3,x[C++]=T*b+D,x[C++]=a-1,x[C++]=T*(b+1)%_+D}for(let D=0;D<s;D++)for(let b=0;b<T-1;b++){const I=T*D+b+a,O=I+1,M=(T*(D+1)+b)%_+a+1;e.latLongTessellation?(x[C++]=4,x[C++]=I,x[C++]=O,x[C++]=M,x[C++]=M-1):(x[C++]=3,x[C++]=I,x[C++]=O,x[C++]=M,x[C++]=3,x[C++]=I,x[C++]=M,x[C++]=M-1)}v=v.subarray(0,w*3),i.getPoints().setData(v,3),y=y.subarray(0,w*3);const E=Tt.newInstance({name:"Normals",values:y,numberOfComponents:3});i.getPointData().setNormals(E),x=x.subarray(0,C),i.getPolys().setData(x,1),n[0]=i}}const Ope={radius:.5,latLongTessellation:!1,thetaResolution:8,startTheta:0,endTheta:360,phiResolution:8,startPhi:0,endPhi:180,center:[0,0,0],pointType:"Float64Array"};function eL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ope,r),K.obj(t,e),K.setGet(t,e,["radius","latLongTessellation","thetaResolution","startTheta","endTheta","phiResolution","startPhi","endPhi"]),K.setGetArray(t,e,["center"],3),K.algo(t,e,0,1),Mpe(t,e)}const Ppe=K.newInstance(eL,"vtkSphereSource");var Rpe={newInstance:Ppe,extend:eL};const Ko={XMIN:0,XMAX:1,YMIN:2,YMAX:3,ZMIN:4,ZMAX:5},Rt={XMIN:0,XMAX:1,YMIN:2,YMAX:3,ZMIN:4,ZMAX:5,XMIN_YMIN_ZMIN:6,XMIN_YMIN_ZMAX:7,XMIN_YMAX_ZMIN:8,XMIN_YMAX_ZMAX:9,XMAX_YMIN_ZMIN:10,XMAX_YMIN_ZMAX:11,XMAX_YMAX_ZMIN:12,XMAX_YMAX_ZMAX:13};class tL extends vr{constructor(e={},r={configuration:{showCornerSpheres:!0,showHandles:!0,showClippingPlanes:!0,mobile:{enabled:!1,opacity:.8},initialCropFactor:.08,sphereColors:{SAGITTAL:[1,1,0],CORONAL:[0,1,0],AXIAL:[1,0,0],CORNERS:[0,0,1]},sphereRadius:8,grabSpherePixelDistance:20,rotateIncrementDegrees:2,rotateSampleDistanceFactor:2}}){super(e,r),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.originalClippingPlanes=[],this.draggingSphereIndex=null,this.toolCenter=[0,0,0],this.cornerDragOffset=null,this.faceDragOffset=null,this.sphereStates=[],this.edgeLines={},this.onSetToolConfiguration=()=>{console.debug("Setting tool settoolconfiguration : volumeCropping")},this.onSetToolEnabled=()=>{console.debug("Setting tool enabled: volumeCropping")},this.onCameraModified=n=>{const{element:i}=n.currentTarget?{element:n.currentTarget}:n.detail,o=Ce(i);this._updateClippingPlanes(o.viewport),o.viewport.render()},this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a,f=s.getDefaultActor().actor.getMapper(),u=[n.detail.currentPoints.canvas[0],n.detail.currentPoints.canvas[1]];this.draggingSphereIndex=null,this.cornerDragOffset=null,this.faceDragOffset=null;for(let g=0;g<this.sphereStates.length;++g){const p=s.worldToCanvas(this.sphereStates[g].point);if(Math.sqrt(Math.pow(u[0]-p[0],2)+Math.pow(u[1]-p[1],2))<this.configuration.grabSpherePixelDistance){this.draggingSphereIndex=g,o.style.cursor="grabbing";const w=this.sphereStates[g],v=s.canvasToWorld(u);if(w.isCorner)this.cornerDragOffset=[w.point[0]-v[0],w.point[1]-v[1],w.point[2]-v[2]],this.faceDragOffset=null;else{const y={x:0,y:1,z:2}[w.axis];this.faceDragOffset=w.point[y]-v[y],this.cornerDragOffset=null}return!0}}if(!("getSampleDistance"in f||"getCurrentSampleDistance"in f))return!0;const h=f.getSampleDistance();if(!this._hasResolutionChanged){const{rotateSampleDistanceFactor:g}=this.configuration;f.setSampleDistance(h*g),this._hasResolutionChanged=!0,this.cleanUp!==null&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{if(f.setSampleDistance(h),n.target.style.cursor="",this.draggingSphereIndex!==null){const p=this.sphereStates[this.draggingSphereIndex],[m]=this._getViewportsInfo(),v=Bn(m.renderingEngineId).getViewport(m.viewportId);p.isCorner&&(this._updateCornerSpheres(),this._updateFaceSpheresFromCorners(),this._updateClippingPlanesFromFaceSpheres(v))}this.draggingSphereIndex=null,this.cornerDragOffset=null,this.faceDragOffset=null,s.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})}return!0},this._onMouseMoveSphere=n=>{if(this.draggingSphereIndex===null)return!1;const i=this.sphereStates[this.draggingSphereIndex];if(!i)return!1;const{viewport:o,world:a}=this._getViewportAndWorldCoords(n);if(!o||!a)return!1;if(i.isCorner){const s=this._calculateNewCornerPosition(a);this._updateSpherePosition(i,s);const c=this._parseCornerKey(i.uid);this._updateRelatedCorners(i,s,c),this._updateFaceSpheresFromCorners(),this._updateCornerSpheres()}else{const s={x:0,y:1,z:2}[i.axis];let c=a[s];this.faceDragOffset!==null&&(c+=this.faceDragOffset),i.point[s]=c,i.sphereSource.setCenter(...i.point),i.sphereSource.modified(),this._updateCornerSpheresFromFaces(),this._updateFaceSpheresFromCorners(),this._updateCornerSpheres()}return this._updateClippingPlanesFromFaceSpheres(o),o.render(),this._triggerToolChangedEvent(i),!0},this._onControlToolChange=n=>{const i=this._getViewport();if(!n.detail.toolCenter)Xe(ke,V.VOLUMECROPPING_TOOL_CHANGED,{originalClippingPlanes:this.originalClippingPlanes,viewportId:i.id,renderingEngineId:i.renderingEngineId,seriesInstanceUID:this.seriesInstanceUID});else{if(n.detail.seriesInstanceUID!==this.seriesInstanceUID)return;const o=n.detail.handleType==="min",a=o?n.detail.toolCenterMin:n.detail.toolCenterMax,s=o?[[1,0,0],[0,1,0],[0,0,1]]:[[-1,0,0],[0,-1,0],[0,0,-1]],c=o?[Ko.XMIN,Ko.YMIN,Ko.ZMIN]:[Ko.XMAX,Ko.YMAX,Ko.ZMAX],l=o?[Rt.XMIN,Rt.YMIN,Rt.ZMIN]:[Rt.XMAX,Rt.YMAX,Rt.ZMAX],f=["x","y","z"],u=[Ma.SAGITTAL,Ma.CORONAL,Ma.AXIAL];for(let d=0;d<3;++d){const h=[0,0,0];h[d]=a[d];const g=tr.newInstance({origin:h,normal:s[d]});this.originalClippingPlanes[c[d]].origin=g.getOrigin(),this.sphereStates[l[d]].point[d]=g.getOrigin()[d],this.sphereStates[l[d]].sphereSource.setCenter(...this.sphereStates[l[d]].point),this.sphereStates[l[d]].sphereSource.modified();const m=(this.sphereStates.find((v,y)=>v.axis===f[d]&&y!==l[d]).point[d]+g.getOrigin()[d])/2;this.sphereStates.forEach(v=>{!v.isCorner&&v.axis!==f[d]&&!n.detail.viewportOrientation.includes(u[d])&&(v.point[d]=m,v.sphereSource.setCenter(v.point),v.sphereActor.getProperty().setColor(v.color),v.sphereSource.modified())});const w=i.getDefaultActor()?.actor;if(w){const y=w.getMapper().getClippingPlanes();y&&y[c[d]].setOrigin(g.getOrigin())}}this._updateCornerSpheres(),i.render()}},this._getViewportsInfo=()=>Kr(this.toolGroupId).viewportsInfo,this._initialize3DViewports=n=>{if(!n||!n.length||!n[0]){console.warn("VolumeCroppingTool: No viewportsInfo available for initialization of volumecroppingtool.");return}const i=this._getViewport(),o=i.getActors();if(!o||o.length===0){console.warn("VolumeCroppingTool: No volume actors found in the viewport.");return}const a=o[0].actor.getMapper().getInputData();if(!a){console.warn("VolumeCroppingTool: No image data found for volume actor.");return}this.seriesInstanceUID=a.seriesInstanceUID||"unknown";const s=a.getBounds(),c=this.configuration.initialCropFactor||.1,l=s[1]-s[0],f=s[3]-s[2],u=s[5]-s[4],d=s[0]+c*l,h=s[1]-c*l,g=s[2]+c*f,p=s[3]-c*f,m=s[4]+c*u,w=s[5]-c*u,v=[],y=tr.newInstance({origin:[d,0,0],normal:[1,0,0]}),C=tr.newInstance({origin:[h,0,0],normal:[-1,0,0]}),x=tr.newInstance({origin:[0,g,0],normal:[0,1,0]}),T=tr.newInstance({origin:[0,p,0],normal:[0,-1,0]}),S=tr.newInstance({origin:[0,0,m],normal:[0,0,1]}),_=tr.newInstance({origin:[0,0,w],normal:[0,0,-1]}),E=i.getDefaultActor().actor.getMapper();v.push(y),v.push(C),v.push(x),v.push(T),v.push(S),v.push(_);const D=v.map(j=>({origin:[...j.getOrigin()],normal:[...j.getNormal()]}));this.originalClippingPlanes=D;const b=[d,(p+g)/2,(w+m)/2],I=[h,(p+g)/2,(w+m)/2],O=[(h+d)/2,g,(w+m)/2],M=[(h+d)/2,p,(w+m)/2],R=[(h+d)/2,(p+g)/2,m],A=[(h+d)/2,(p+g)/2,w],B=this._calculateAdaptiveSphereRadius(Math.sqrt(l*l+f*f+u*u));this._addSphere(i,b,"x","min",null,B),this._addSphere(i,I,"x","max",null,B),this._addSphere(i,O,"y","min",null,B),this._addSphere(i,M,"y","max",null,B),this._addSphere(i,R,"z","min",null,B),this._addSphere(i,A,"z","max",null,B);const k=[[d,g,m],[d,g,w],[d,p,m],[d,p,w],[h,g,m],[h,g,w],[h,p,m],[h,p,w]],L=["XMIN_YMIN_ZMIN","XMIN_YMIN_ZMAX","XMIN_YMAX_ZMIN","XMIN_YMAX_ZMAX","XMAX_YMIN_ZMIN","XMAX_YMIN_ZMAX","XMAX_YMAX_ZMIN","XMAX_YMAX_ZMAX"];for(let j=0;j<k.length;j++)this._addSphere(i,k[j],"corner",null,L[j],B);[["XMIN_YMIN_ZMIN","XMAX_YMIN_ZMIN"],["XMIN_YMIN_ZMAX","XMAX_YMIN_ZMAX"],["XMIN_YMAX_ZMIN","XMAX_YMAX_ZMIN"],["XMIN_YMAX_ZMAX","XMAX_YMAX_ZMAX"],["XMIN_YMIN_ZMIN","XMIN_YMAX_ZMIN"],["XMIN_YMIN_ZMAX","XMIN_YMAX_ZMAX"],["XMAX_YMIN_ZMIN","XMAX_YMAX_ZMIN"],["XMAX_YMIN_ZMAX","XMAX_YMAX_ZMAX"],["XMIN_YMIN_ZMIN","XMIN_YMIN_ZMAX"],["XMIN_YMAX_ZMIN","XMIN_YMAX_ZMAX"],["XMAX_YMIN_ZMIN","XMAX_YMIN_ZMAX"],["XMAX_YMAX_ZMIN","XMAX_YMAX_ZMAX"]].forEach(([j,J],ie)=>{const fe=this.sphereStates.find(de=>de.uid===`corner_${j}`),ae=this.sphereStates.find(de=>de.uid===`corner_${J}`);if(fe&&ae){const de=`edge_${j}_${J}`,{actor:we,source:_e}=this._addLine3DBetweenPoints(i,fe.point,ae.point,[.7,.7,.7],de);this.edgeLines[de]={actor:we,source:_e,key1:j,key2:J}}}),E.addClippingPlane(y),E.addClippingPlane(C),E.addClippingPlane(x),E.addClippingPlane(T),E.addClippingPlane(S),E.addClippingPlane(_),ke.addEventListener(V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,j=>{this._onControlToolChange(j)}),i.render()},this._getViewportAndWorldCoords=n=>{const i=this._getViewport(),o=n.detail.currentPoints.canvas[0],a=n.detail.currentPoints.canvas[1],s=i.canvasToWorld([o,a]);return{viewport:i,world:s}},this._getViewport=()=>{const[n]=this._getViewportsInfo();return Bn(n.renderingEngineId).getViewport(n.viewportId)},this._handleCornerSphereMovement=(n,i,o)=>{const a=this._calculateNewCornerPosition(i);this._updateSpherePosition(n,a);const s=this._parseCornerKey(n.uid);this._updateRelatedCorners(n,a,s),this._updateAfterCornerMovement(o)},this._handleFaceSphereMovement=(n,i,o)=>{const a={x:0,y:1,z:2}[n.axis];let s=i[a];this.faceDragOffset!==null&&(s+=this.faceDragOffset),n.point[a]=s,n.sphereSource.setCenter(...n.point),n.sphereSource.modified(),this._updateAfterFaceMovement(o)},this._calculateNewCornerPosition=n=>{let i=[n[0],n[1],n[2]];return this.cornerDragOffset&&(i=[n[0]+this.cornerDragOffset[0],n[1]+this.cornerDragOffset[1],n[2]+this.cornerDragOffset[2]]),i},this._parseCornerKey=n=>{const i=n.replace("corner_","");return{isXMin:i.includes("XMIN"),isXMax:i.includes("XMAX"),isYMin:i.includes("YMIN"),isYMax:i.includes("YMAX"),isZMin:i.includes("ZMIN"),isZMax:i.includes("ZMAX")}},this._updateSpherePosition=(n,i)=>{n.point=i,n.sphereSource.setCenter(...i),n.sphereSource.modified()},this._updateRelatedCorners=(n,i,o)=>{this.sphereStates.forEach(a=>{if(!a.isCorner||a===n)return;const s=a.uid.replace("corner_","");this._shouldUpdateCorner(s,o)&&this._updateCornerCoordinates(a,i,s,o)})},this._shouldUpdateCorner=(n,i)=>i.isXMin&&n.includes("XMIN")||i.isXMax&&n.includes("XMAX")||i.isYMin&&n.includes("YMIN")||i.isYMax&&n.includes("YMAX")||i.isZMin&&n.includes("ZMIN")||i.isZMax&&n.includes("ZMAX"),this._updateCornerCoordinates=(n,i,o,a)=>{(a.isXMin&&o.includes("XMIN")||a.isXMax&&o.includes("XMAX"))&&(n.point[0]=i[0]),(a.isYMin&&o.includes("YMIN")||a.isYMax&&o.includes("YMAX"))&&(n.point[1]=i[1]),(a.isZMin&&o.includes("ZMIN")||a.isZMax&&o.includes("ZMAX"))&&(n.point[2]=i[2]),n.sphereSource.setCenter(...n.point),n.sphereSource.modified()},this._updateAfterCornerMovement=n=>{this._updateFaceSpheresFromCorners(),this._updateCornerSpheres(),this._updateClippingPlanesFromFaceSpheres(n)},this._updateAfterFaceMovement=n=>{this._updateCornerSpheresFromFaces(),this._updateClippingPlanesFromFaceSpheres(n)},this._triggerToolChangedEvent=n=>{Xe(ke,V.VOLUMECROPPING_TOOL_CHANGED,{toolCenter:n.point,axis:n.isCorner?"corner":n.axis,draggingSphereIndex:this.draggingSphereIndex,seriesInstanceUID:this.seriesInstanceUID})},this._onNewVolume=()=>{const n=this._getViewportsInfo();this.originalClippingPlanes=[],this.sphereStates=[],this.edgeLines={},this._initialize3DViewports(n)},this._rotateCamera=(n,i,o,a)=>{const s=n.getVtkActiveCamera(),c=s.getViewUp(),l=s.getFocalPoint(),f=s.getPosition(),u=[0,0,0],d=[0,0,0],h=[0,0,0],g=_t(new Float32Array(16));Gn(g,g,i),ci(g,g,a,o),Gn(g,g,[-i[0],-i[1],-i[2]]),Pt(u,f,g),Pt(d,l,g),_t(g),ci(g,g,a,o),Pt(h,c,g),n.setCamera({position:u,viewUp:h,focalPoint:d})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}onSetToolActive(){if(this.sphereStates&&this.sphereStates.length>0)this.configuration.showHandles?(this.setHandlesVisible(!1),this.setClippingPlanesVisible(!1)):(this.setHandlesVisible(!0),this.setClippingPlanesVisible(!0));else{const e=this._getViewportsInfo(),r=()=>{e.forEach(({viewportId:n,renderingEngineId:i})=>{if(!this._resizeObservers.has(n)){const{viewport:o}=Ln(n,i)||{viewport:null};if(!o)return;const{element:a}=o,s=new ResizeObserver(()=>{const c=Ln(n,i);if(!c)return;const{viewport:l}=c,f=l.getViewPresentation();l.resetCamera(),l.setViewPresentation(f),l.render()});s.observe(a),this._resizeObservers.set(n,s)}})};r(),this._viewportAddedListener=n=>{n.detail.toolGroupId===this.toolGroupId&&r()},ke.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._initialize3DViewports(e),this.sphereStates&&this.sphereStates.length>0?this.setHandlesVisible(!0):(this.originalClippingPlanes=[],this._initialize3DViewports(e))}}onSetToolDisabled(){this._resizeObservers.forEach((r,n)=>{r.disconnect(),this._resizeObservers.delete(n)}),this._viewportAddedListener&&(ke.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null);const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e)}setHandlesVisible(e){this.configuration.showHandles=e,e&&(this.sphereStates[Rt.XMIN].point[0]=this.originalClippingPlanes[Ko.XMIN].origin[0],this.sphereStates[Rt.XMAX].point[0]=this.originalClippingPlanes[Ko.XMAX].origin[0],this.sphereStates[Rt.YMIN].point[1]=this.originalClippingPlanes[Ko.YMIN].origin[1],this.sphereStates[Rt.YMAX].point[1]=this.originalClippingPlanes[Ko.YMAX].origin[1],this.sphereStates[Rt.ZMIN].point[2]=this.originalClippingPlanes[Ko.ZMIN].origin[2],this.sphereStates[Rt.ZMAX].point[2]=this.originalClippingPlanes[Ko.ZMAX].origin[2],[Rt.XMIN,Rt.XMAX,Rt.YMIN,Rt.YMAX,Rt.ZMIN,Rt.ZMAX].forEach(a=>{const s=this.sphereStates[a];s.sphereSource.setCenter(...s.point),s.sphereSource.modified()}),this._updateCornerSpheres()),this._updateHandlesVisibility();const r=this._getViewportsInfo(),[n]=r;Bn(n.renderingEngineId).getViewport(n.viewportId).render()}getHandlesVisible(){return this.configuration.showHandles}getClippingPlanesVisible(){return this.configuration.showClippingPlanes}setClippingPlanesVisible(e){this.configuration.showClippingPlanes=e;const r=this._getViewport();this._updateClippingPlanes(r),r.render()}_dragCallback(e){const{element:r,currentPoints:n,lastPoints:i}=e.detail;if(this.draggingSphereIndex!==null)this._onMouseMoveSphere(e);else{const o=n.canvas,a=i.canvas,{rotateIncrementDegrees:s}=this.configuration,c=Ce(r),{viewport:l}=c,f=l.getCamera(),u=r.clientWidth,d=r.clientHeight,h=[o[0]/u,o[1]/d],g=[a[0]/u,a[1]/d],p=[u*.5,d*.5],m=l.canvasToWorld(p),v=(1+Math.abs([.5,.5][0]))**2,y=[g[0],0,0],C=[h[0],0,0],x=y[0]**2,T=C[0]**2,S=x>v?0:Math.sqrt(v-x),_=T>v?0:Math.sqrt(v-T),E=[y[0],0,S];pt.normalize(E);const D=[C[0],0,_];pt.normalize(D);const b=pt.dot(E,D);if(Math.abs(b)>1e-4){const I=-2*Math.acos(pt.clampValue(b,-1,1))*Math.sign(h[0]-g[0])*s,O=f.viewUp,M=f.viewPlaneNormal,R=[0,0,0],A=[0,0,0];pt.cross(O,M,R),pt.normalize(R),pt.cross(M,R,A),pt.normalize(A),pt.normalize(O),this._rotateCamera(l,m,A,I);const B=(g[1]-h[1])*s;this._rotateCamera(l,m,R,B)}l.render()}}_updateClippingPlanes(e){const r=e.getDefaultActor();if(!r||!r.actor){e._missingActorWarned||(console.warn("VolumeCroppingTool._updateClippingPlanes: No default actor found in viewport."),e._missingActorWarned=!0);return}const n=r.actor,i=n.getMapper(),o=n.getMatrix();if(!this.configuration.showClippingPlanes){i.removeAllClippingPlanes();return}const a=Jo();xl(a,o);const s=Jo();xc(s,a),g0(s,s);const c=this.originalClippingPlanes;if(!c||!c.length)return;i.removeAllClippingPlanes();const l=[],f=[];for(let u=0;u<c.length;++u){const d=c[u],h=Ie();Pt(h,new Float32Array(d.origin),o);const g=[h[0],h[1],h[2]],p=Ie();yh(p,new Float32Array(d.normal),s),At(p,p);const m=[p[0],p[1],p[2]];l.push(g),f.push(m)}for(let u=0;u<l.length;++u){const d=tr.newInstance({origin:l[u],normal:f[u]});i.addClippingPlane(d)}}_updateHandlesVisibility(){this.sphereStates.forEach(e=>{e.sphereActor&&e.sphereActor.setVisibility(this.configuration.showHandles)}),Object.values(this.edgeLines).forEach(({actor:e})=>{e&&e.setVisibility(this.configuration.showHandles)})}_addLine3DBetweenPoints(e,r,n,i=[.7,.7,.7],o=""){if(r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2])return{actor:null,source:null};const a=Ju.newInstance();a.setNumberOfPoints(2),a.setPoint(0,r[0],r[1],r[2]),a.setPoint(1,n[0],n[1],n[2]);const s=Ml.newInstance({values:[2,0,1]}),c=rr.newInstance();c.setPoints(a),c.setLines(s);const l=Ui.newInstance();l.setInputData(c);const f=Lo.newInstance();return f.setMapper(l),f.getProperty().setColor(...i),f.getProperty().setLineWidth(.5),f.getProperty().setOpacity(1),f.getProperty().setInterpolationToFlat(),f.getProperty().setAmbient(1),f.getProperty().setDiffuse(0),f.getProperty().setSpecular(0),f.setVisibility(this.configuration.showHandles),e.addActor({actor:f,uid:o}),{actor:f,source:c}}_addSphere(e,r,n,i,o=null,a){const s=o?`corner_${o}`:`${n}_${i}`;if(this.sphereStates.find(w=>w.uid===s))return;const l=Rpe.newInstance();l.setCenter(r),l.setRadius(a);const f=Ui.newInstance();f.setInputConnection(l.getOutputPort());const u=Lo.newInstance();u.setMapper(f);let d=[0,1,0];const h=this.configuration.sphereColors||{};o?d=h.CORNERS||[0,0,1]:n==="z"?d=h.AXIAL||[1,0,0]:n==="x"?d=h.SAGITTAL||[1,1,0]:n==="y"&&(d=h.CORONAL||[0,1,0]);const g=this.sphereStates.findIndex(w=>w.uid===s);g===-1?this.sphereStates.push({point:r.slice(),axis:n,uid:s,sphereSource:l,sphereActor:u,isCorner:!!o,color:d}):(this.sphereStates[g].point=r.slice(),this.sphereStates[g].sphereSource=l),!e.getActors().find(w=>w.uid===s)&&(u.getProperty().setColor(d),u.setVisibility(this.configuration.showHandles),e.addActor({actor:u,uid:s}))}_calculateAdaptiveSphereRadius(e){this.configuration.sphereRadius!==void 0&&this.configuration.sphereRadius;const r=this.configuration.sphereRadiusScale||.01,n=e*r,i=this.configuration.minSphereRadius||2,o=this.configuration.maxSphereRadius||50;return Math.max(i,Math.min(o,n))}_updateClippingPlanesFromFaceSpheres(e){const r=e.getDefaultActor().actor.getMapper();this.originalClippingPlanes[0].origin=[...this.sphereStates[Rt.XMIN].point],this.originalClippingPlanes[1].origin=[...this.sphereStates[Rt.XMAX].point],this.originalClippingPlanes[2].origin=[...this.sphereStates[Rt.YMIN].point],this.originalClippingPlanes[3].origin=[...this.sphereStates[Rt.YMAX].point],this.originalClippingPlanes[4].origin=[...this.sphereStates[Rt.ZMIN].point],this.originalClippingPlanes[5].origin=[...this.sphereStates[Rt.ZMAX].point],r.removeAllClippingPlanes();for(let n=0;n<6;++n){const i=this.originalClippingPlanes[n].origin,o=this.originalClippingPlanes[n].normal,a=tr.newInstance({origin:i,normal:o});r.addClippingPlane(a)}}_updateCornerSpheresFromFaces(){const e=this.sphereStates[Rt.XMIN].point[0],r=this.sphereStates[Rt.XMAX].point[0],n=this.sphereStates[Rt.YMIN].point[1],i=this.sphereStates[Rt.YMAX].point[1],o=this.sphereStates[Rt.ZMIN].point[2],a=this.sphereStates[Rt.ZMAX].point[2],s=[{key:"XMIN_YMIN_ZMIN",pos:[e,n,o]},{key:"XMIN_YMIN_ZMAX",pos:[e,n,a]},{key:"XMIN_YMAX_ZMIN",pos:[e,i,o]},{key:"XMIN_YMAX_ZMAX",pos:[e,i,a]},{key:"XMAX_YMIN_ZMIN",pos:[r,n,o]},{key:"XMAX_YMIN_ZMAX",pos:[r,n,a]},{key:"XMAX_YMAX_ZMIN",pos:[r,i,o]},{key:"XMAX_YMAX_ZMAX",pos:[r,i,a]}];for(const c of s){const l=this.sphereStates.find(f=>f.uid===`corner_${c.key}`);l&&(l.point[0]=c.pos[0],l.point[1]=c.pos[1],l.point[2]=c.pos[2],l.sphereSource.setCenter(...l.point),l.sphereSource.modified())}}_updateFaceSpheresFromCorners(){const e=[this.sphereStates[Rt.XMIN_YMIN_ZMIN].point,this.sphereStates[Rt.XMIN_YMIN_ZMAX].point,this.sphereStates[Rt.XMIN_YMAX_ZMIN].point,this.sphereStates[Rt.XMIN_YMAX_ZMAX].point,this.sphereStates[Rt.XMAX_YMIN_ZMIN].point,this.sphereStates[Rt.XMAX_YMIN_ZMAX].point,this.sphereStates[Rt.XMAX_YMAX_ZMIN].point,this.sphereStates[Rt.XMAX_YMAX_ZMAX].point],r=e.map(u=>u[0]),n=e.map(u=>u[1]),i=e.map(u=>u[2]),o=Math.min(...r),a=Math.max(...r),s=Math.min(...n),c=Math.max(...n),l=Math.min(...i),f=Math.max(...i);this.sphereStates[Rt.XMIN].point=[o,(s+c)/2,(l+f)/2],this.sphereStates[Rt.XMAX].point=[a,(s+c)/2,(l+f)/2],this.sphereStates[Rt.YMIN].point=[(o+a)/2,s,(l+f)/2],this.sphereStates[Rt.YMAX].point=[(o+a)/2,c,(l+f)/2],this.sphereStates[Rt.ZMIN].point=[(o+a)/2,(s+c)/2,l],this.sphereStates[Rt.ZMAX].point=[(o+a)/2,(s+c)/2,f],[Rt.XMIN,Rt.XMAX,Rt.YMIN,Rt.YMAX,Rt.ZMIN,Rt.ZMAX].forEach(u=>{const d=this.sphereStates[u];d.sphereSource.setCenter(...d.point),d.sphereSource.modified()})}_updateCornerSpheres(){const e=this.sphereStates[Rt.XMIN].point[0],r=this.sphereStates[Rt.XMAX].point[0],n=this.sphereStates[Rt.YMIN].point[1],i=this.sphereStates[Rt.YMAX].point[1],o=this.sphereStates[Rt.ZMIN].point[2],a=this.sphereStates[Rt.ZMAX].point[2],s=[{key:"XMIN_YMIN_ZMIN",pos:[e,n,o]},{key:"XMIN_YMIN_ZMAX",pos:[e,n,a]},{key:"XMIN_YMAX_ZMIN",pos:[e,i,o]},{key:"XMIN_YMAX_ZMAX",pos:[e,i,a]},{key:"XMAX_YMIN_ZMIN",pos:[r,n,o]},{key:"XMAX_YMIN_ZMAX",pos:[r,n,a]},{key:"XMAX_YMAX_ZMIN",pos:[r,i,o]},{key:"XMAX_YMAX_ZMAX",pos:[r,i,a]}];for(const c of s){const l=this.sphereStates.find(f=>f.uid===`corner_${c.key}`);l&&(l.point[0]=c.pos[0],l.point[1]=c.pos[1],l.point[2]=c.pos[2],l.sphereSource.setCenter(...l.point),l.sphereSource.modified())}Object.values(this.edgeLines).forEach(({source:c,key1:l,key2:f})=>{const u=this.sphereStates.find(h=>h.uid===`corner_${l}`),d=this.sphereStates.find(h=>h.uid===`corner_${f}`);if(u&&d){const h=c.getPoints();h.setPoint(0,u.point[0],u.point[1],u.point[2]),h.setPoint(1,d.point[0],d.point[1],d.point[2]),h.modified(),c.modified()}})}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.removeEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.addEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}}tL.toolName="VolumeCropping";function Ape(){return"rgb(0, 200, 0)"}function Lpe(){return!0}const yy={DRAG:1};class nL extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse"],configuration:{viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},extendReferenceLines:!0,initialCropFactor:.2,mobile:{enabled:!1,opacity:.8},lineColors:{AXIAL:[1,0,0],CORONAL:[0,1,0],SAGITTAL:[1,1,0],UNKNOWN:[0,0,1]},lineWidth:1.5,lineWidthActive:2.5}}){super(e,r),this._virtualAnnotations=[],this.sphereStates=[],this.draggingSphereIndex=null,this.toolCenter=[0,0,0],this.toolCenterMin=[0,0,0],this.toolCenterMax=[0,0,0],this.initializeViewport=({renderingEngineId:i,viewportId:o})=>{if(!i||!o){console.warn("VolumeCroppingControlTool: Missing renderingEngineId or viewportId");return}const a=Ln(o,i);if(!a)return;const{viewport:s}=a;this._updateToolCentersFromViewport(s);const{element:c}=s,{position:l,focalPoint:f,viewPlaneNormal:u}=s.getCamera();let d=this._getAnnotations(a);d=this.filterInteractableAnnotationsForElement(c,d),d?.length&&kt(d[0].annotationUID);const h=this._getOrientationFromNormal(s.getCamera().viewPlaneNormal),g={highlighted:!1,metadata:{cameraPosition:[...l],cameraFocalPoint:[...f],toolName:this.getToolName()},data:{handles:{toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax},activeOperation:null,activeViewportIds:[],viewportId:o,referenceLines:[],orientation:h}};return Ft(g,c),{normal:u,point:s.canvasToWorld([100,100])}},this._getViewportsInfo=()=>Kr(this.toolGroupId).viewportsInfo,this.resetCroppingSpheres=()=>{const i=this._getViewportsInfo();for(const o of i){const{viewportId:a,renderingEngineId:s}=o,c=Ln(a,s),l=c.viewport;l.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!0,suppressEvents:!0}),l.resetSlabThickness();const{element:p}=l;let m=this._getAnnotations(c);m=this.filterInteractableAnnotationsForElement(p,m),m.length&&kt(m[0].annotationUID),l.render()}this._computeToolCenter(i)},this.computeToolCenter=()=>{this._getViewportsInfo()},this._computeToolCenter=i=>{if(!i||!i[0]){console.warn("  _computeToolCenter : No valid viewportsInfo for computeToolCenter.");return}const o=["AXIAL","CORONAL","SAGITTAL"],a=i.map(u=>{if(u.renderingEngineId){const h=Bn(u.renderingEngineId).getViewport(u.viewportId);if(h&&h.getCamera){const g=this._getOrientationFromNormal(h.getCamera().viewPlaneNormal);if(g)return g}}return null}).filter(Boolean),s=o.find(u=>!a.includes(u)),c=[],l=[],f=i.filter(u=>{let d=null;if(u.renderingEngineId){const g=Bn(u.renderingEngineId).getViewport(u.viewportId);g&&g.getCamera&&(d=this._getOrientationFromNormal(g.getCamera().viewPlaneNormal))}return d&&o.includes(d)});if(f.forEach(u=>{const{normal:d,point:h}=this.initializeViewport(u);c.push(d),l.push(h)}),f.length===2&&s){const u=[0,0,0];nn(u,c[0],c[1]),At(u,u);const d=[(l[0][0]+l[1][0])/2,(l[0][1]+l[1][1])/2,(l[0][2]+l[1][2])/2],g={highlighted:!1,metadata:{cameraPosition:[...d],cameraFocalPoint:[...d],toolName:this.getToolName()},data:{handles:{activeOperation:null,toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax},activeViewportIds:[],viewportId:s,referenceLines:[],orientation:null},isVirtual:!0,virtualNormal:u};this._virtualAnnotations=[g]}else if(f.length===1){let u=null;const d=f[0];if(d.renderingEngineId){const v=Bn(d.renderingEngineId).getViewport(d.viewportId);v&&v.getCamera&&(u=this._getOrientationFromNormal(v.getCamera().viewPlaneNormal))}const h=l[0],g={AXIAL:[0,0,1],CORONAL:[0,1,0],SAGITTAL:[1,0,0]},m=o.filter(w=>w!==u).map(w=>{const v=g[w];return{highlighted:!1,metadata:{cameraPosition:[...h],cameraFocalPoint:[...h],toolName:this.getToolName()},data:{handles:{activeOperation:null,toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax},activeViewportIds:[],viewportId:w,referenceLines:[],orientation:w},isVirtual:!0,virtualNormal:v}});this._virtualAnnotations=m}i&&i.length&&Me(i.map(({viewportId:u})=>u))},this.cancel=()=>{console.log("Not implemented yet")},this.isPointNearTool=(i,o,a,s)=>!!this._pointNearTool(i,o,a,6),this.toolSelectedCallback=(i,o,a)=>{const s=i.detail,{element:c}=s;o.highlighted=!0,this._activateModify(c),St(c),i.preventDefault()},this.onResetCamera=i=>{this.resetCroppingSpheres()},this.mouseMoveCallback=(i,o)=>{if(!o)return;const{element:a,currentPoints:s}=i.detail,c=s.canvas;let l=!1;for(let f=0;f<o.length;f++){const u=o[f];if(pr(u.annotationUID))continue;const{data:d,highlighted:h}=u;if(!d.handles)continue;d.handles.activeOperation,d.activeViewportIds&&d.activeViewportIds.length>0&&[...d.activeViewportIds],d.activeViewportIds=[];let g=!1;g=this._pointNearTool(a,u,c,6),(g&&!h||!g&&h)&&(u.highlighted=!h,l=!0)}return l},this.filterInteractableAnnotationsForElement=(i,o)=>{if(!o||!o.length)return[];const a=Ce(i);let s=null;return a.viewport&&a.viewport.getCamera&&(s=this._getOrientationFromNormal(a.viewport.getCamera().viewPlaneNormal)),o.filter(l=>!!(l.isVirtual||l.data.orientation&&s&&l.data.orientation===s))},this.renderAnnotation=(i,o)=>{function a(I,O,M,R){const A=O[0]-I[0],B=O[1]-I[1],k=R[0]-M[0],L=R[1]-M[1],F=-k*B+A*L;if(Math.abs(F)<1e-8)return null;const j=(-B*(I[0]-M[0])+A*(I[1]-M[1]))/F,J=(k*(I[1]-M[1])-L*(I[0]-M[0]))/F;return j>=0&&j<=1&&J>=0&&J<=1?[I[0]+J*A,I[1]+J*B]:null}const s=this._getViewportsInfo();if(!s||s.length===0)return!1;let c=!1;const{viewport:l,renderingEngine:f}=i,{element:u}=l;let d=this._getAnnotations(i);this._virtualAnnotations&&this._virtualAnnotations.length&&(d=d.concat(this._virtualAnnotations));const h=l.getCamera(),p=this.filterInteractableAnnotationsForElement(u,d)[0];if(!p||!p.data)return c;const m=p.annotationUID,{clientWidth:w,clientHeight:v}=l.canvas,y=Math.sqrt(w*w+v*v),C=p.data,x=d,T=l.worldToCanvas(this.toolCenterMin),S=l.worldToCanvas(this.toolCenterMax),_=[],E=[0,0,w,v];x.forEach(I=>{const O=I.data,M="isVirtual"in I&&I.isVirtual===!0;O.handles.toolCenter=this.toolCenter;let R,A,B,k,L,F,j;if(M){const ee=s.filter(ge=>ge.viewportId!==O.viewportId);if(ee.length===2){const ge=f.getViewport(ee[0].viewportId),De=f.getViewport(ee[1].viewportId),Ne=ge.getCamera().viewPlaneNormal,We=De.getCamera().viewPlaneNormal,re=Ie();nn(re,Ne,We),At(re,re),A={viewPlaneNormal:re,position:O.handles.toolCenter,focalPoint:O.handles.toolCenter,viewUp:[0,1,0]},B=l.canvas.clientWidth,k=l.canvas.clientHeight,L=Math.sqrt(B*B+k*k),F=[B*.5,k*.5],j=O.handles.toolCenter,R={id:O.viewportId,canvas:l.canvas,canvasToWorld:()=>O.handles.toolCenter}}else A={viewPlaneNormal:I.virtualNormal??[0,0,1],position:O.handles.toolCenter,focalPoint:O.handles.toolCenter,viewUp:[0,1,0]},B=l.canvas.clientWidth,k=l.canvas.clientHeight,L=Math.sqrt(B*B+k*k),F=[B*.5,k*.5],j=O.handles.toolCenter,R={id:O.viewportId,canvas:l.canvas,canvasToWorld:()=>O.handles.toolCenter}}else R=f.getViewport(O.viewportId),A=R.getCamera(),B=R.canvas.clientWidth,k=R.canvas.clientHeight,L=Math.sqrt(B*B+k*k),F=[B*.5,k*.5],j=R.canvasToWorld(F);const J=this._getReferenceLineControllable(R.id),ie=[0,0,0];pt.cross(h.viewPlaneNormal,A.viewPlaneNormal,ie),pt.normalize(ie),pt.multiplyScalar(ie,L);const fe=[0,0,0];pt.add(j,ie,fe);const ae=[0,0,0];pt.subtract(j,ie,ae);const de=l.worldToCanvas(fe),we=l.worldToCanvas([j[0]??0,j[1]??0,j[2]??0]),_e=xt();Mn(_e,de,we),cs(_e,_e);const Te=xt();as(Te,_e,y*100);const G=Da(J?T:we),P=xt(),$=xt();Zr(P,G,Te),Mn($,G,Te),Fu(P,$,E),_.push([R,P,$,"min"]);const W=Da(J?S:we),q=xt(),Q=xt();Zr(q,W,Te),Mn(Q,W,Te),Fu(q,Q,E),_.push([R,q,Q,"max"])}),C.referenceLines=_;const D=this._getReferenceLineColor(l.id),b=D!==void 0?D:"rgb(200, 200, 200)";if(_.forEach((I,O)=>{const M=[];for(let ae=0;ae<_.length;++ae){if(ae===O)continue;const de=_[ae],we=a(I[1],I[2],de[1],de[2]);we&&M.push({with:de[3],point:we})}const R=I[0];let A=null;if(R&&R.id){const ae=d.find(de=>de.data.viewportId===R.id);if(ae&&ae.data.orientation)A=String(ae.data.orientation).toUpperCase();else{const de=R.id.toUpperCase();de.includes("AXIAL")?A="AXIAL":de.includes("CORONAL")?A="CORONAL":de.includes("SAGITTAL")&&(A="SAGITTAL")}}const B=this.configuration.lineColors||{},k=B[A]||B.unknown||[1,0,0],L=Array.isArray(k)?`rgb(${k.map(ae=>Math.round(ae*255)).join(",")})`:k,F=this._getReferenceLineControllable(R.id),j=C.activeViewportIds.find(ae=>ae===R.id);let J=this.configuration.lineWidth??1.5;C.handles.activeOperation!==null&&C.handles.activeOperation===yy.DRAG&&j&&(J=this.configuration.activeLineWidth??2.5);const fe=`${O}`;if(F&&(M.length===2&&Yt(o,m,fe,M[0].point,M[1].point,{color:L,lineWidth:J}),this.configuration.extendReferenceLines&&M.length===2&&this.configuration.extendReferenceLines&&M.length===2)){const ae=M.map(de=>({...de,distance:Xn(I[1],de.point)})).sort((de,we)=>de.distance-we.distance);Yt(o,m,fe+"_dashed_before",I[1],ae[0].point,{color:L,lineWidth:J,lineDash:[4,4]}),Yt(o,m,fe+"_dashed_after",ae[1].point,I[2],{color:L,lineWidth:J,lineDash:[4,4]})}}),c=!0,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:I}=this.configuration,O=I?.xOffset||.95,M=I?.yOffset||.05,R=[w*O,v*M],A=I?.circleRadius||y*.01;Si(o,m,"0",R,A,{color:b,fill:b})}return c},this._getAnnotations=i=>{const{viewport:o}=i,a=$t(this.getToolName(),o.element)||[],s=this._getViewportsInfo().map(({viewportId:l})=>l);return a.filter(l=>{const{data:f}=l;return s.includes(f.viewportId)})},this._onSphereMoved=i=>{if(i.detail.originalClippingPlanes)this._syncWithVolumeCroppingTool(i.detail.originalClippingPlanes);else{if(i.detail.seriesInstanceUID!==this.seriesInstanceUID)return;const{draggingSphereIndex:o,toolCenter:a}=i.detail,s=[...this.toolCenterMin],c=[...this.toolCenterMax];if(o>=0&&o<=5){const l=Math.floor(o/2),f=o%2===0;(f?s:c)[l]=a[l],this.setToolCenter(s,"min"),this.setToolCenter(c,"max");return}if(o>=6&&o<=13){const l=o;l<10?s[0]=a[0]:c[0]=a[0],[6,7,10,11].includes(l)?s[1]=a[1]:c[1]=a[1],l%2===0?s[2]=a[2]:c[2]=a[2],this.setToolCenter(s,"min"),this.setToolCenter(c,"max")}}},this._onNewVolume=()=>{const i=this._getViewportsInfo();if(i&&i.length>0){const{viewportId:o,renderingEngineId:a}=i[0],c=Bn(a).getViewport(o),l=c.getActors();if(l.length>0){const f=l[0].actor.getMapper().getInputData();f&&(this.seriesInstanceUID=f.seriesInstanceUID,this._updateToolCentersFromViewport(c),($t(this.getToolName(),o)||[]).forEach(d=>{d.data&&d.data.handles&&(d.data.handles.toolCenter=[...this.toolCenter])}))}}this._computeToolCenter(i),Xe(ke,V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,{toolGroupId:this.toolGroupId,viewportsInfo:i,seriesInstanceUID:this.seriesInstanceUID})},this._getAnnotationsForViewportsWithDifferentCameras=(i,o)=>{const{viewportId:a,renderingEngine:s,viewport:c}=i,l=o.filter(g=>g.data.viewportId!==a);if(!l||!l.length)return[];const f=c.getCamera(),{viewPlaneNormal:u,position:d}=f;return l.filter(g=>{const{viewportId:p}=g.data,w=s.getViewport(p).getCamera();return!(Dt(w.viewPlaneNormal,u,.01)&&Dt(w.position,d,1))})},this._filterViewportWithSameOrientation=(i,o,a)=>{const{renderingEngine:s}=i,{data:c}=o,l=s.getViewport(c.viewportId),f=a.filter(g=>{const{data:p}=g,m=s.getViewport(p.viewportId);return this._getReferenceLineControllable(m.id)===!0});if(!f||!f.length)return[];const u=l.getCamera(),d=u.viewPlaneNormal;return pt.normalize(d),f.filter(g=>{const{viewportId:p}=g.data,w=s.getViewport(p).getCamera(),v=w.viewPlaneNormal;return pt.normalize(v),Dt(d,v,.01)&&Dt(u.viewUp,w.viewUp,.01)})},this._activateModify=i=>{Ue.isInteractingWithTool=!this.configuration.mobile?.enabled,i.addEventListener(V.MOUSE_UP,this._endCallback),i.addEventListener(V.MOUSE_DRAG,this._dragCallback),i.addEventListener(V.MOUSE_CLICK,this._endCallback),i.addEventListener(V.TOUCH_END,this._endCallback),i.addEventListener(V.TOUCH_DRAG,this._dragCallback),i.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=i=>{Ue.isInteractingWithTool=!1,i.removeEventListener(V.MOUSE_UP,this._endCallback),i.removeEventListener(V.MOUSE_DRAG,this._dragCallback),i.removeEventListener(V.MOUSE_CLICK,this._endCallback),i.removeEventListener(V.TOUCH_END,this._endCallback),i.removeEventListener(V.TOUCH_DRAG,this._dragCallback),i.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._endCallback=i=>{const o=i.detail,{element:a}=o;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(a),Vt(a),this.editData=null;const c=vt(a,this.getToolName(),!1);Me(c)},this._dragCallback=i=>{const o=i.detail,a=o.deltaPoints.world;if(Math.abs(a[0])<.001&&Math.abs(a[1])<.001&&Math.abs(a[2])<.001)return;const{element:s}=o,c=Ce(s),{viewport:l}=c;if(l.type===Fn.VOLUME_3D)return;const f=this._getAnnotations(c),d=this.filterInteractableAnnotationsForElement(s,f)[0];if(!d)return;const{handles:h}=d.data;if(h.activeOperation===yy.DRAG){h.activeType==="min"?(this.toolCenterMin[0]+=a[0],this.toolCenterMin[1]+=a[1],this.toolCenterMin[2]+=a[2]):h.activeType==="max"?(this.toolCenterMax[0]+=a[0],this.toolCenterMax[1]+=a[1],this.toolCenterMax[2]+=a[2]):(this.toolCenter[0]+=a[0],this.toolCenter[1]+=a[1],this.toolCenter[2]+=a[2]);const g=this._getViewportsInfo();Me(g.map(({viewportId:p})=>p)),Xe(ke,V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,{toolGroupId:this.toolGroupId,toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax,handleType:h.activeType,viewportOrientation:[],seriesInstanceUID:this.seriesInstanceUID})}},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||Ape,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||Lpe;const n=Kr(this.toolGroupId)?.viewportsInfo;if(ke.addEventListener(V.VOLUMECROPPING_TOOL_CHANGED,this._onSphereMoved),n&&n.length>0){const{viewportId:i,renderingEngineId:o}=n[0];Ln(i,o);const c=Bn(o).getViewport(i).getActors();if(!c||!c.length){console.warn(`VolumeCroppingControlTool: No volume actors found in viewport ${i}.`);return}const l=c[0].actor.getMapper().getInputData();if(l){const f=l.getDimensions(),u=l.getSpacing(),d=l.getOrigin();this.seriesInstanceUID=l.seriesInstanceUID||"unknown";const h=this.configuration.initialCropFactor??.2;this.toolCenter=[d[0]+h*(f[0]-1)*u[0],d[1]+h*(f[1]-1)*u[1],d[2]+h*(f[2]-1)*u[2]];const g=1-h;this.toolCenterMin=[d[0]+h*(f[0]-1)*u[0],d[1]+h*(f[1]-1)*u[1],d[2]+h*(f[2]-1)*u[2]],this.toolCenterMax=[d[0]+g*(f[0]-1)*u[0],d[1]+g*(f[1]-1)*u[1],d[2]+g*(f[2]-1)*u[2]]}}}_updateToolCentersFromViewport(e){const r=e.getActors();if(!r||!r.length)return;const n=r[0].actor.getMapper().getInputData();if(!n)return;this.seriesInstanceUID=n.seriesInstanceUID||"unknown";const i=n.getDimensions(),o=n.getSpacing(),a=n.getOrigin(),s=this.configuration.initialCropFactor??.2,c=s/2,l=1-s/2;this.toolCenter=[a[0]+(c+l)/2*(i[0]-1)*o[0],a[1]+(c+l)/2*(i[1]-1)*o[1],a[2]+(c+l)/2*(i[2]-1)*o[2]],this.toolCenterMin=[a[0]+c*(i[0]-1)*o[0],a[1]+c*(i[1]-1)*o[1],a[2]+c*(i[2]-1)*o[2]],this.toolCenterMax=[a[0]+l*(i[0]-1)*o[0],a[1]+l*(i[1]-1)*o[1],a[2]+l*(i[2]-1)*o[2]]}onSetToolInactive(){console.debug(`VolumeCroppingControlTool: onSetToolInactive called for tool ${this.getToolName()}`)}onSetToolActive(){const e=this._getViewportsInfo();let r=!1;for(const n of e){const i=Ln(n.viewportId,n.renderingEngineId),o=this._getAnnotations(i);if(o&&o.length>0){r=!0;break}}if(!r)this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e),Xe(ke,V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,{toolGroupId:this.toolGroupId,viewportsInfo:e,seriesInstanceUID:this.seriesInstanceUID});else for(const n of e){const i=Ln(n.viewportId,n.renderingEngineId);if(!i)continue;const o=this._getAnnotations(i);o&&o.length>0&&o.forEach(a=>{kt(a.annotationUID)}),i.viewport.render()}}onSetToolEnabled(){console.debug(`VolumeCroppingControlTool: onSetToolEnabled called for tool ${this.getToolName()}`),this._getViewportsInfo()}onSetToolDisabled(){console.debug(`VolumeCroppingControlTool: onSetToolDisabled called for tool ${this.getToolName()}`);const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:r,viewportId:n})=>{const i=Ln(n,r);if(!i)return;const o=this._getAnnotations(i);o?.length&&o.forEach(a=>{kt(a.annotationUID)})})}_getOrientationFromNormal(e){if(!e)return null;const r={AXIAL:[0,0,1],CORONAL:[0,1,0],SAGITTAL:[1,0,0]},n=.01;for(const[i,o]of Object.entries(r))if(Math.abs(e[0]-o[0])<n&&Math.abs(e[1]-o[1])<n&&Math.abs(e[2]-o[2])<n||Math.abs(e[0]+o[0])<n&&Math.abs(e[1]+o[1])<n&&Math.abs(e[2]+o[2])<n)return i;return null}_syncWithVolumeCroppingTool(e){const r=e;if(r.length>=6){this.toolCenterMin=[r[0].origin[0],r[2].origin[1],r[4].origin[2]],this.toolCenterMax=[r[1].origin[0],r[3].origin[1],r[5].origin[2]],this.toolCenter=[(this.toolCenterMin[0]+this.toolCenterMax[0])/2,(this.toolCenterMin[1]+this.toolCenterMax[1])/2,(this.toolCenterMin[2]+this.toolCenterMax[2])/2];const n=this._getViewportsInfo();n.forEach(({viewportId:i,renderingEngineId:o})=>{const a=Ln(i,o);a&&this._getAnnotations(a).forEach(c=>{if(c.data&&c.data.handles&&c.data.orientation){const l=c.data.orientation;l==="AXIAL"?(c.data.handles.toolCenterMin=[r[0].origin[0],r[2].origin[1],c.data.handles.toolCenterMin[2]],c.data.handles.toolCenterMax=[r[1].origin[0],r[3].origin[1],c.data.handles.toolCenterMax[2]]):l==="CORONAL"?(c.data.handles.toolCenterMin=[r[0].origin[0],c.data.handles.toolCenterMin[1],r[4].origin[2]],c.data.handles.toolCenterMax=[r[1].origin[0],c.data.handles.toolCenterMax[1],r[5].origin[2]]):l==="SAGITTAL"&&(c.data.handles.toolCenterMin=[c.data.handles.toolCenterMin[0],r[2].origin[1],r[4].origin[2]],c.data.handles.toolCenterMax=[c.data.handles.toolCenterMax[0],r[3].origin[1],r[5].origin[2]]),c.data.handles.toolCenter=[(c.data.handles.toolCenterMin[0]+c.data.handles.toolCenterMax[0])/2,(c.data.handles.toolCenterMin[1]+c.data.handles.toolCenterMax[1])/2,(c.data.handles.toolCenterMin[2]+c.data.handles.toolCenterMax[2])/2]}})}),this._virtualAnnotations&&this._virtualAnnotations.length>0&&this._virtualAnnotations.forEach(i=>{if(i.data&&i.data.handles&&i.data.orientation){const o=i.data.orientation.toUpperCase();o==="AXIAL"?(i.data.handles.toolCenterMin=[r[0].origin[0],r[2].origin[1],i.data.handles.toolCenterMin[2]],i.data.handles.toolCenterMax=[r[1].origin[0],r[3].origin[1],i.data.handles.toolCenterMax[2]]):o==="CORONAL"?(i.data.handles.toolCenterMin=[r[0].origin[0],i.data.handles.toolCenterMin[1],r[4].origin[2]],i.data.handles.toolCenterMax=[r[1].origin[0],i.data.handles.toolCenterMax[1],r[5].origin[2]]):o==="SAGITTAL"&&(i.data.handles.toolCenterMin=[i.data.handles.toolCenterMin[0],r[2].origin[1],r[4].origin[2]],i.data.handles.toolCenterMax=[i.data.handles.toolCenterMax[0],r[3].origin[1],r[5].origin[2]]),i.data.handles.toolCenter=[(i.data.handles.toolCenterMin[0]+i.data.handles.toolCenterMax[0])/2,(i.data.handles.toolCenterMin[1]+i.data.handles.toolCenterMax[1])/2,(i.data.handles.toolCenterMin[2]+i.data.handles.toolCenterMax[2])/2]}}),Me(n.map(({viewportId:i})=>i))}}setToolCenter(e,r){r==="min"?this.toolCenterMin=[...e]:r==="max"&&(this.toolCenterMax=[...e]);const n=this._getViewportsInfo();Me(n.map(({viewportId:i})=>i))}addNewAnnotation(e){const r=e.detail,{element:n}=r,i=Ce(n),{viewport:o}=i,a=this._getAnnotations(i),s=this.filterInteractableAnnotationsForElement(o.element,a);if(!s||s.length===0||!s[0])return null;const{data:c}=s[0],l=[],f=c.referenceLines||[];for(let u=0;u<f.length;++u){const d=f[u][0];this._getReferenceLineControllable(d.id)&&(l.push(d.id),u++)}return c.activeViewportIds=[...l],c.handles.activeOperation=yy.DRAG,e.preventDefault(),St(n),this._activateModify(n),s[0]}handleSelectedCallback(e,r,n,i){this.toolSelectedCallback(e,r,i)}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.removeEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.addEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_applyDeltaShiftToSelectedViewportCameras(e,r,n){r.forEach(i=>{this._applyDeltaShiftToViewportCamera(e,i,n)})}_applyDeltaShiftToViewportCamera(e,r,n){const{data:i}=r,o=e.getViewport(i.viewportId),a=o.getCamera(),s=a.viewPlaneNormal,c=pt.dot(n,s),l=[...s];if(pt.multiplyScalar(l,c),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const f=[0,0,0],u=[0,0,0];pt.add(a.focalPoint,l,f),pt.add(a.position,l,u),o.setCamera({focalPoint:f,position:u}),o.render()}}_pointNearTool(e,r,n,i){const{data:o}=r,a=o.referenceLines,s=[];if(a)for(let c=0;c<a.length;++c){const l=a[c][0],f=a[c][1],u=a[c][2],d=a[c][3];Ir(f,u,[n[0],n[1]])<=i&&(s.push(l.id),o.handles.activeOperation=1,o.handles.activeType=d)}return o.activeViewportIds=[...s],this.editData={annotation:r},o.handles.activeOperation===1}}nL.toolName="VolumeCroppingControl";const wy=4,x4=1024,Npe="PT";class rL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this._getImageDynamicRangeFromMiddleSlice=(n,i)=>{const o=Math.floor(i[2]/2),a=i[0]*i[1];let s,c;n instanceof Float32Array?(s=4,c=Float32Array):n instanceof Uint8Array?(s=1,c=Uint8Array):n instanceof Uint16Array?(s=2,c=Uint16Array):n instanceof Int16Array&&(s=2,c=Int16Array);const l=n.buffer,f=o*a*s,u=new c(l,f,a),{max:d,min:h}=this._getMinMax(u,a);return d-h}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){const{element:r,deltaPoints:n}=e.detail,i=Ce(r),{viewport:o}=i;let a,s,c,l,f,u,d=!1;const h=o.getProperties();if(o instanceof zn){a=o.getVolumeId(),u=gg(a),{lower:s,upper:c}=h.voiRange;const g=Ae.getVolume(a);if(!g)throw new Error("Volume not found "+a);l=g.metadata.Modality,d=g.scaling&&Object.keys(g.scaling).length>0}else if(h.voiRange){l=o.modality,{lower:s,upper:c}=h.voiRange;const{preScale:g={scaled:!1}}=o.getImageData?.()||{};d=g.scaled&&g.scalingParameters?.suvbw!==void 0}else throw new Error("Viewport is not a valid type");if(l===Npe&&d?f=this.getPTScaledNewRange({deltaPointsCanvas:n.canvas,lower:s,upper:c,clientHeight:r.clientHeight,isPreScaled:d,viewport:o,volumeId:a}):f=this.getNewRange({viewport:o,deltaPointsCanvas:n.canvas,volumeId:a,lower:s,upper:c}),!(f.lower>=f.upper)&&(o.setProperties({voiRange:f}),o.render(),o instanceof zn)){u.forEach(g=>{o!==g&&g.render()});return}}getPTScaledNewRange({deltaPointsCanvas:e,lower:r,upper:n,clientHeight:i,viewport:o,volumeId:a,isPreScaled:s}){let c=wy;s?c=5/i:c=this._getMultiplierFromDynamicRange(o,a)||wy;const f=e[1]*c;return n-=f,n=s?Math.max(n,.1):n,{lower:r,upper:n}}getNewRange({viewport:e,deltaPointsCanvas:r,volumeId:n,lower:i,upper:o}){const a=this._getMultiplierFromDynamicRange(e,n)||wy,s=r[0]*a,c=r[1]*a;let{windowWidth:l,windowCenter:f}=R0(i,o);l+=s,f+=c,l=Math.max(l,1);const u=e.getProperties().VOILUTFunction;return Tl(l,f,u)}_getMultiplierFromDynamicRange(e,r){let n;if(r){const o=Ae.getVolume(r),{voxelManager:a}=e.getImageData(),c=a.getMiddleSliceData().reduce((d,h)=>[Math.min(d[0],h),Math.max(d[1],h)],[1/0,-1/0]),l=o?.metadata?.BitsStored,f=l?2**l:1/0,u=c[1]-c[0];n=Number.isFinite(u)?Math.min(u,f):f}else n=this._getImageDynamicRangeFromViewport(e);const i=n/x4;return Number.isFinite(i)?i>1?Math.round(i):i:x4}_getImageDynamicRangeFromViewport(e){const{imageData:r,voxelManager:n}=e.getImageData();if(n?.getRange){const s=n.getRange();return s[1]-s[0]}const i=r.getDimensions();if(r.getRange){const s=r.getRange();return s[1]-s[0]}let o;if(r.getScalarData?o=r.getScalarData():o=r.getPointData().getScalars().getData(),i[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(o,i);let a;if(o.getRange)a=o.getRange();else{const{min:s,max:c}=this._getMinMax(o,o.length);a=[s,c]}return a[1]-a[0]}_getMinMax(e,r){let n=1/0,i=-1/0;for(let o=0;o<r;o++){const a=e[o];a<n&&(n=a),a>i&&(i=a)}return{max:i,min:n}}}rL.toolName="WindowLevel";class iL extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const f=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=this.getReferencedImageId(l,s,u,d),g=l.getFrameOfReferenceUID(),p={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:g,referencedImageId:h},data:{handles:{points:[[...s],[...s],[...s],[...s]]},cachedStats:{}}};Ft(p,a);const m=vt(a,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:m},this._activateDraw(a),St(a),n.preventDefault(),Me(m),p},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData;this._deactivateDraw(o),Vt(o),this.editData=null,this.isDrawing=!1,kt(a.annotationUID),Me(s),En(a),this.applyWindowLevelRegion(a,o)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData,{data:c}=a,{currentPoints:l}=i,f=Ce(o),{worldToCanvas:u,canvasToWorld:d}=f.viewport,h=l.world,{points:g}=c.handles,p=3;g[p]=[...h];const m=u(g[0]),w=u(g[3]),v=[w[0],m[1]],y=[m[0],w[1]],C=d(v),x=d(y);g[1]=C,g[2]=x,a.invalidated=!0,Me(s)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{points:g}=h.handles,p=g.map(x=>a.worldToCanvas(x));l.annotationUID=d;const{color:m,lineWidth:w,lineDash:v}=this.getAnnotationStyle({annotation:u,styleSpecifier:l});if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const y=`${d}-rect`;Og(i,d,"0",p[0],p[3],{color:m,lineDash:v,lineWidth:w},y),o=!0}return o},this.applyWindowLevelRegion=(n,i)=>{const o=Ce(i),{viewport:a}=o,s=BA(a),{data:c}=n,{points:l}=c.handles,f=l.map(S=>a.worldToCanvas(S)),u=f[0],d=f[3];let h=Math.min(u[0],d[0]),g=Math.min(u[1],d[1]),p=Math.abs(u[0]-d[0]),m=Math.abs(u[1]-d[1]);h=jm(h,0,s.width),g=jm(g,0,s.height),p=Math.floor(Math.min(p,Math.abs(s.width-h))),m=Math.floor(Math.min(m,Math.abs(s.height-g)));const w=FA(s,Math.round(h),Math.round(g),p,m),v=UA(w,s.minPixelValue,s.maxPixelValue);this.configuration.minWindowWidth===void 0&&(this.configuration.minWindowWidth=10);const y=Math.max(Math.abs(v.max-v.min),this.configuration.minWindowWidth),C=v.mean,x=a.getProperties().VOILUTFunction,T=Tl(y,C,x);a.setProperties({voiRange:T}),a.render()},this.cancel=()=>null,this.isPointNearTool=()=>null,this.toolSelectedCallback=()=>null,this.handleSelectedCallback=()=>null,this._activateModify=()=>null,this._deactivateModify=()=>null}}iL.toolName="WindowLevelRegion";class oL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,r),this.deltaY=1}mouseWheelCallback(e){this._scroll(e)}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){this._scrollDrag(e)}_scrollDrag(e){const{deltaPoints:r,viewportId:n,renderingEngineId:i}=e.detail,{viewport:o}=Ln(n,i),{debounceIfNotLoaded:a,invert:s,loop:c}=this.configuration,l=r.canvas[1];let f;o instanceof zn&&(f=o.getVolumeId());const u=this._getPixelPerImage(o),d=l+this.deltaY;if(u)if(Math.abs(d)>=u){const h=Math.round(d/u);ef(o,{delta:s?-h:h,volumeId:f,debounceLoading:a,loop:c}),this.deltaY=d%u}else this.deltaY=d}_scroll(e){const{wheel:r,element:n}=e.detail,{direction:i}=r,{invert:o}=this.configuration,{viewport:a}=Ce(n),s=i*(o?-1:1);ef(a,{delta:s,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:a instanceof ir?a.getVolumeId():void 0,scrollSlabs:this.configuration.scrollSlabs})}_getPixelPerImage(e){const{element:r}=e,n=e.getNumberOfSlices();return Math.max(2,r.offsetHeight/Math.max(n,8))}}oL.toolName="StackScroll";class aL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.mouseWheelCallback=n=>{const{element:i,wheel:o}=n.detail,a=Ce(i),{viewport:s}=a,{invert:c}=this.configuration,l=o.direction*10*(c?-1:1);this.setAngle(s,l)},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:r,currentPoints:n,startPoints:i}=e.detail,o=n.world,a=i.world,s=Ce(r),{viewport:c}=s,l=c.getCamera(),f=r.clientWidth,u=r.clientHeight,d=[f*.5,u*.5],h=c.canvasToWorld(d);let g=o0([a,h],[h,o]);const{viewPlaneNormal:p}=l,m=an(Ie(),h,a),w=an(Ie(),h,o),v=nn(Ie(),m,w);ft(p,v)>0&&(g=-g),!Number.isNaN(g)&&this.setAngle(c,g)}setAngle(e,r){const{viewPlaneNormal:n,viewUp:i}=e.getCamera();if(e instanceof ir){const o=(r+360)%360*Math.PI/180,a=_t(new Float32Array(16));ci(a,a,o,n);const s=Pt(Ie(),i,a);e.setCamera({viewUp:s})}else{const{rotation:o}=e.getViewPresentation();e.setViewPresentation({rotation:(o+r+360)%360})}e.render()}}aL.toolName="PlanarRotate";class sL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,r),this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=a.world,l=Ce(o).viewport.getCamera(),{focalPoint:f}=l;this.initialMousePosWorld=s;let u=mt(f[0]-s[0],f[1]-s[1],f[2]-s[2]);return u=At(Ie(),u),this.dirVec=u,!1},this.preTouchStartCallback=n=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(n)},this._dragParallelProjection=(n,i,o,a=!1)=>{const{element:s,deltaPoints:c}=n.detail,l=a?n.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{parallelScale:u,focalPoint:d,position:h}=o,g=5/f[1],p=l*g*(this.configuration.invert?-1:1),m=(1-p)*u;let w=d,v=h;if(!this.configuration.zoomToCenter){const S=Nr(d,this.initialMousePosWorld);v=tn(Ie(),h,this.dirVec,-S*p),w=tn(Ie(),d,this.dirVec,-S*p)}const y=i.getImageData();let C=[1,1,1],x=m,T=!1;if(y){C=y.spacing;const{dimensions:S}=y,_=S[0]*C[0],E=S[1]*C[1],D=f[0]/f[1],b=Aa().rendering?.useLegacyCameraFOV?1.1:1,I=i.options?.displayArea,O=I?.imageArea?.[0]??b,M=I?.imageArea?.[1]??b,R=_*O,A=E*M,B=R/A;let k;B>D?k=R/D*.5:k=A*.5;const{minZoomScale:L,maxZoomScale:F}=this.configuration,j=k/F,J=k/L;m<j?(x=j,T=!0):m>J&&(x=J,T=!0)}i.setCamera({parallelScale:x,focalPoint:T?d:w,position:T?h:v})},this._dragPerspectiveProjection=(n,i,o,a=!1)=>{const{element:s,deltaPoints:c}=n.detail,l=a?n.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{position:u,focalPoint:d,viewPlaneNormal:h}=o,g=pt.distance2BetweenPoints(u,d),p=Math.sqrt(g)/f[1],m=[-h[0],-h[1],-h[2]],w=this.configuration.invert?l/p:l*p;let v=w*m[0];u[0]+=v,d[0]+=v,v=w*m[1],u[1]+=v,d[1]+=v,v=w*m[2],u[2]+=v,d[2]+=v,i.setCamera({position:u,focalPoint:d})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}mouseWheelCallback(e){this._zoom(e)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:n,currentPoints:i}=e.detail,o=Ce(n),{viewport:a}=o,s=a.getCamera(),c=i.world,{focalPoint:l}=s;this.initialMousePosWorld=c;let f=mt(l[0]-c[0],l[1]-c[1],l[2]-c[2]);f=At(Ie(),f),this.dirVec=f,s.parallelProjection?this._dragParallelProjection(e,a,s,!0):this._dragPerspectiveProjection(e,a,s,!0),a.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:r}=e.detail,n=Ce(r),{viewport:i}=n,o=i.getCamera();o.parallelProjection?this._dragParallelProjection(e,i,o):this._dragPerspectiveProjection(e,i,o),i.render()}_zoom(e){const{element:r,points:n}=e.detail,i=Ce(r),{viewport:o}=i;o.getCamera();const s=e.detail.wheel.direction,c={detail:{element:r,eventName:V.MOUSE_WHEEL,renderingEngineId:i.renderingEngineId,viewportId:o.id,camera:{},deltaPoints:{page:n.page,client:n.client,world:n.world,canvas:[0,-s*5]},startPoints:n,lastPoints:n,currentPoints:n}};o.type===Fn.STACK&&this.preMouseDownCallback(c),this._dragCallback(c)}_panCallback(e){const{element:r,deltaPoints:n}=e.detail,i=Ce(r),o=n.world,a=i.viewport.getCamera(),{focalPoint:s,position:c}=a,l=[c[0]-o[0],c[1]-o[1],c[2]-o[2]],f=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];i.viewport.setCamera({focalPoint:f,position:l}),i.viewport.render()}}sL.toolName="Zoom";class cL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}){super(e,r)}mouseClickCallback(e){const{element:r,currentPoints:n}=e.detail,i=Ce(r),{viewport:o,renderingEngine:a}=i,s=o.getVolumeId();if(!s)throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");let c=-1/0;const l=(g,p)=>{if(g>c)return c=g,p},f=i3(o,n.world,s,l);if(!f||!f.length)return;const{targetViewportIds:u,toolGroupId:d}=this.configuration;a.getViewports().filter(g=>{if(u?.indexOf(g.id)>=0)return!0;const p=lr(g.id,a.id);return!!(d&&d===p?.id)}).forEach(g=>{g instanceof zn?g.jumpToWorld(f):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")})}}cL.toolName="MIPJumpToClickTool";const{RENDERING_DEFAULTS:Cy}=Mc;function Vpe(){return"rgb(0, 200, 0)"}function kpe(){return!0}function Fpe(){return!0}function Upe(){return!0}const va={DRAG:1,ROTATE:2,SLAB:3};class lL extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},handleRadius:3,enableHDPIHandles:!1,referenceLinesCenterGapRadius:20,referenceLinesCenterGapRatio:null,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:ds.MAXIMUM_INTENSITY_BLEND,centerPoint:{enabled:!1,color:"rgba(255, 255, 0, 0.5)",size:2},mobile:{enabled:!1,opacity:.8,handleRadius:9,referenceLinesCenterGapRatio:.05}}}){super(e,r),this.toolCenter=[0,0,0],this.initializeViewport=({renderingEngineId:n,viewportId:i})=>{const o=Ln(i,n);if(!o)return;const{FrameOfReferenceUID:a,viewport:s}=o,{element:c}=s,{position:l,focalPoint:f,viewPlaneNormal:u}=s.getCamera();let d=this._getAnnotations(o);d=this.filterInteractableAnnotationsForElement(c,d),d?.length&&kt(d[0].annotationUID);const h={highlighted:!1,metadata:{cameraPosition:[...l],cameraFocalPoint:[...f],FrameOfReferenceUID:a,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:i}};return Ft(h,c),{normal:u,point:s.canvasToWorld([s.canvas.clientWidth/2,s.canvas.clientHeight/2])}},this._getViewportsInfo=()=>Kr(this.toolGroupId).viewportsInfo,this.resetCrosshairs=()=>{const n=this._getViewportsInfo();for(const i of n){const{viewportId:o,renderingEngineId:a}=i,s=Ln(o,a),c=s.viewport;c.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!0,suppressEvents:!0}),c.resetSlabThickness();const{element:g}=c;let p=this._getAnnotations(s);p=this.filterInteractableAnnotationsForElement(g,p),p.length&&kt(p[0].annotationUID),c.render()}this._computeToolCenter(n)},this.computeToolCenter=()=>{const n=this._getViewportsInfo();this._computeToolCenter(n)},this._computeToolCenter=n=>{if(!n.length||n.length===1){console.warn("For crosshairs to operate, at least two viewports must be given.");return}const[i,o,a]=n,{normal:s,point:c}=this.initializeViewport(i),{normal:l,point:f}=this.initializeViewport(o);let u=[0,0,0],d=Ie();a?{normal:u,point:d}=this.initializeViewport(a):(nr(d,c,f),Jn(d,d,.5),nn(u,s,l));const h=ps(s,c),g=ps(l,f),p=ps(u,d),m=x9(h,g,p);this.setToolCenter(m)},this.addNewAnnotation=n=>{const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.world,c=Ce(o),{viewport:l}=c;this._jump(c,s);const f=this._getAnnotations(c),u=this.filterInteractableAnnotationsForElement(l.element,f),{data:d}=u[0],{rotationPoints:h}=d.handles,g=[];for(let p=0;p<h.length-1;++p){const m=h[p][1],w=this._getReferenceLineControllable(m.id),v=this._getReferenceLineDraggableRotatable(m.id);!w||!v||(g.push(m.id),p++)}return d.activeViewportIds=[...g],d.handles.activeOperation=va.DRAG,n.preventDefault(),St(o),this._activateModify(o),u[0]},this.cancel=()=>{console.log("Not implemented yet")},this.handleSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0,this._activateModify(a),St(a),n.preventDefault()},this.isPointNearTool=(n,i,o,a)=>!!this._pointNearTool(n,i,o,6),this.toolSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a;i.highlighted=!0,this._activateModify(s),St(s),n.preventDefault()},this.onCameraModified=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{renderingEngine:s}=a,c=a.viewport,l=this._getAnnotations(a),u=this.filterInteractableAnnotationsForElement(o,l)[0];if(!u)return;const d=c.getCamera(),h=u.metadata.cameraPosition,g=[0,0,0];pt.subtract(d.position,h,g);const p=u.metadata.cameraFocalPoint,m=[0,0,0];pt.subtract(d.focalPoint,p,m),u.metadata.cameraPosition=[...d.position],u.metadata.cameraFocalPoint=[...d.focalPoint];const w=this._getReferenceLineControllable(c.id),v=this._getReferenceLineDraggableRotatable(c.id);if(!Dt(d.position,h,.001)&&w&&v){let x=!1;Dt(g,m,.001)||(x=!0);const S=Math.abs(pt.dot(g,d.viewPlaneNormal))<.01;!x&&!S&&(this.toolCenter[0]+=g[0],this.toolCenter[1]+=g[1],this.toolCenter[2]+=g[2],Xe(ke,V.CROSSHAIR_TOOL_CENTER_CHANGED,{toolGroupId:this.toolGroupId,toolCenter:this.toolCenter}))}this.configuration.autoPan?.enabled&&lr(c.id,s.id).getViewportIds().filter(S=>S!==c.id).forEach(S=>{this._autoPanViewportIfNecessary(S,s)});const C=vt(o,this.getToolName(),!1);Me(C)},this.onResetCamera=n=>{this.resetCrosshairs()},this.mouseMoveCallback=(n,i)=>{const{element:o,currentPoints:a}=n.detail,s=a.canvas;let c=!1;for(let l=0;l<i.length;l++){const f=i[l];if(pr(f.annotationUID))continue;const{data:u,highlighted:d}=f;if(!u.handles)continue;const h=u.handles.activeOperation,g=u.activeViewportIds&&u.activeViewportIds.length>0?[...u.activeViewportIds]:[];u.activeViewportIds=[],u.handles.activeOperation=null;const p=this.getHandleNearImagePoint(o,f,s,6);let m=!1;p?m=!0:m=this._pointNearTool(o,f,s,6),m&&!d||!m&&d?(f.highlighted=!d,c=!0):(u.handles.activeOperation!==h||!this._areViewportIdArraysEqual(u.activeViewportIds,g))&&(c=!0)}return c},this.filterInteractableAnnotationsForElement=(n,i)=>{if(!i||!i.length)return[];const o=Ce(n),{viewportId:a}=o;return i.filter(c=>c.data.viewportId===a)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a,renderingEngine:s}=n,{element:c}=a,l=this._getAnnotations(n),f=a.getCamera(),d=this.filterInteractableAnnotationsForElement(c,l)[0];if(!l?.length||!d?.data)return o;const h=d.annotationUID,{clientWidth:g,clientHeight:p}=a.canvas,m=Math.sqrt(g*g+p*p),w=Math.min(g,p),v=d.data,y=a.worldToCanvas(this.toolCenter),C=this._filterAnnotationsByUniqueViewportOrientations(n,l),x=[],T=[0,0,g,p];C.forEach(b=>{const{data:I}=b;I.handles.toolCenter=this.toolCenter;const O=s.getViewport(I.viewportId),M=O.getCamera(),R=this._getReferenceLineControllable(O.id),A=this._getReferenceLineDraggableRotatable(O.id),B=this._getReferenceLineSlabThicknessControlsOn(O.id),{clientWidth:k,clientHeight:L}=O.canvas,F=Math.sqrt(k*k+L*L),j=[k*.5,L*.5],J=O.canvasToWorld(j),ie=[0,0,0];pt.cross(f.viewPlaneNormal,M.viewPlaneNormal,ie),pt.normalize(ie),pt.multiplyScalar(ie,F);const fe=[0,0,0];pt.add(J,ie,fe);const ae=[0,0,0];pt.subtract(J,ie,ae);const de=a.worldToCanvas(fe),we=a.worldToCanvas(J),_e=xt();Mn(_e,de,we),cs(_e,_e);const Te=xt();as(Te,_e,m*100);const G=xt();as(G,_e,w*.4);const P=xt();as(P,_e,w*.2);const $=xt(),W=this.configuration.mobile,{referenceLinesCenterGapRatio:q}=W?.enabled?W:this.configuration,Q=q>0?w*q:this.configuration.referenceLinesCenterGapRadius;as($,_e,C.length===2?Q:0);const ee=xt(),ge=xt(),De=xt(),Ne=xt();let We=Da(y);(!A||!R)&&(We=Da(we)),Zr(ee,We,$),Zr(ge,We,Te),Mn(De,We,$),Mn(Ne,We,Te),Fu(ee,ge,T),Fu(De,Ne,T);const re=xt();Mn(re,y,G);const se=xt();Zr(se,y,G);let ve=Da(y);!A&&B&&(ve=Da(we));let le=[...this.toolCenter];!A&&B&&(le=[...J]);const pe=[0,0,0];pt.subtract(fe,ae,pe),pt.normalize(pe);const{viewPlaneNormal:$e}=f,{matrix:oe}=ti.buildFromDegree().rotate(90,$e),st=[0,0,0];Pt(st,pe,oe);const gt=O.getSlabThickness(),ct=[...st];pt.multiplyScalar(ct,gt);const Ee=[0,0,0];pt.add(le,ct,Ee);const ze=a.worldToCanvas(Ee),qe=xt();Mn(qe,ve,ze);const Je=xt();Mn(Je,ve,Te),Zr(Je,Je,qe);const lt=xt();Zr(lt,ve,Te),Zr(lt,lt,qe),Fu(Je,lt,T);const Pe=xt();Zr(Pe,ve,Te),Mn(Pe,Pe,qe);const Fe=xt();Mn(Fe,ve,Te),Mn(Fe,Fe,qe),Fu(Pe,Fe,T);const nt=xt(),wt=xt(),yn=xt(),bn=xt();Mn(nt,ve,P),Zr(nt,nt,qe),Zr(wt,ve,P),Zr(wt,wt,qe),Mn(yn,ve,P),Mn(yn,yn,qe),Zr(bn,ve,P),Mn(bn,bn,qe),x.push([O,ee,ge,De,Ne,Je,lt,Pe,Fe,re,se,nt,wt,yn,bn])});const S=[],_=[],E=this._getReferenceLineColor(a.id),D=E!==void 0?E:"rgb(200, 200, 200)";if(x.forEach((b,I)=>{const O=b[0],M=this._getReferenceLineColor(O.id),R=this._getReferenceLineControllable(O.id),A=this._getReferenceLineDraggableRotatable(O.id)||this.configuration.mobile?.enabled,B=this._getReferenceLineSlabThicknessControlsOn(O.id)||this.configuration.mobile?.enabled,k=v.activeViewportIds.find(ie=>ie===O.id);let L=M!==void 0?M:"rgb(200, 200, 200)",F=1;const j=v.handles.activeOperation!==null&&v.handles.activeOperation===va.DRAG&&k;j&&(F=2.5);let J=`${I}`;if(R&&A?(J=`${I}One`,Yt(i,h,J,b[1],b[2],{color:L,lineWidth:F}),J=`${I}Two`,Yt(i,h,J,b[3],b[4],{color:L,lineWidth:F})):Yt(i,h,J,b[2],b[4],{color:L,lineWidth:F}),R){L=M!==void 0?M:"rgb(200, 200, 200)";const ie=v.handles.activeOperation===va.ROTATE,fe=[b[9],b[10]],ae=[a.canvasToWorld(b[9]),O,b[1],b[2]],de=[a.canvasToWorld(b[10]),O,b[3],b[4]];S.push(ae,de);const we=v.handles.activeOperation===va.SLAB,_e=[b[11],b[12],b[13],b[14]],Te=[a.canvasToWorld(b[11]),O,b[5],b[6]],G=[a.canvasToWorld(b[12]),O,b[5],b[6]],P=[a.canvasToWorld(b[13]),O,b[7],b[8]],$=[a.canvasToWorld(b[14]),O,b[7],b[8]];_.push(Te,G,P,$);let W=this.configuration.handleRadius*(this.configuration.enableHDPIHandles?window.devicePixelRatio:1),q=1;if(this.configuration.mobile?.enabled&&(W=this.configuration.mobile.handleRadius,q=this.configuration.mobile.opacity),(j||this.configuration.mobile?.enabled)&&!ie&&!we&&A&&B){let ee=`${I}One`;Wn(i,h,ee,fe,{color:L,handleRadius:W,opacity:q,type:"circle"}),ee=`${I}Two`,Wn(i,h,ee,_e,{color:L,handleRadius:W,opacity:q,type:"rect"})}else if(j&&!ie&&!we&&A){const ee=`${I}`;Wn(i,h,ee,fe,{color:L,handleRadius:W,opacity:q,type:"circle"})}else if(k&&!ie&&!we&&B){const ee=`${I}`;Wn(i,h,ee,_e,{color:L,handleRadius:W,opacity:q,type:"rect"})}else if(ie&&A){const ee=`${I}`,ge=this.configuration.handleRadius*(this.configuration.enableHDPIHandles?window.devicePixelRatio:1);Wn(i,h,ee,fe,{color:L,handleRadius:ge,fill:L,type:"circle"})}else if(we&&k&&B){const ee=this.configuration.handleRadius*(this.configuration.enableHDPIHandles?window.devicePixelRatio:1);Wn(i,h,J,_e,{color:L,handleRadius:ee,fill:L,type:"rect"})}O.getSlabThickness()>.5&&B&&(J=`${I}STOne`,Yt(i,h,J,b[5],b[6],{color:L,width:1,lineDash:[2,3]}),J=`${I}STTwo`,Yt(i,h,J,b[7],b[8],{color:L,width:b,lineDash:[2,3]}))}}),o=!0,v.handles.rotationPoints=S,v.handles.slabThicknessPoints=_,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:b}=this.configuration,I=b?.xOffset||.95,O=b?.yOffset||.05,M=[g*I,p*O],R=b?.circleRadius||m*.01;Si(i,h,"0",M,R,{color:D,fill:D})}if(this.configuration.centerPoint?.enabled){const M=this.configuration.centerPoint.color||"rgba(255, 255, 0, 0.5)",R=Math.min(this.configuration.centerPoint.size||2,5);Si(i,h,"centerPoint",y,R,{color:M,fill:M})}return o},this._getAnnotations=n=>{const{viewport:i}=n,o=$t(this.getToolName(),i.element)||[],a=this._getViewportsInfo().map(({viewportId:c})=>c);return o.filter(c=>{const{data:l}=c;return a.includes(l.viewportId)})},this._onNewVolume=()=>{const n=this._getViewportsInfo();this._computeToolCenter(n)},this._areViewportIdArraysEqual=(n,i)=>n.length!==i.length?!1:(n.forEach(o=>{let a=!1;for(let s=0;s<i.length;++s)if(o===i[s]){a=!0;break}if(a===!1)return!1}),!0),this._getAnnotationsForViewportsWithDifferentCameras=(n,i)=>{const{viewportId:o,renderingEngine:a,viewport:s}=n,c=i.filter(h=>h.data.viewportId!==o);if(!c||!c.length)return[];const l=s.getCamera(),{viewPlaneNormal:f,position:u}=l;return c.filter(h=>{const{viewportId:g}=h.data,m=a.getViewport(g).getCamera();return!(Dt(m.viewPlaneNormal,f,.01)&&Dt(m.position,u,1))})},this._filterViewportWithSameOrientation=(n,i,o)=>{const{renderingEngine:a}=n,{data:s}=i,c=a.getViewport(s.viewportId),l=o.filter(h=>{const{data:g}=h,p=a.getViewport(g.viewportId);return this._getReferenceLineControllable(p.id)===!0});if(!l||!l.length)return[];const f=c.getCamera(),u=f.viewPlaneNormal;return pt.normalize(u),l.filter(h=>{const{viewportId:g}=h.data,m=a.getViewport(g).getCamera(),w=m.viewPlaneNormal;return pt.normalize(w),Dt(u,w,.01)&&Dt(f.viewUp,m.viewUp,.01)})},this._filterAnnotationsByUniqueViewportOrientations=(n,i)=>{const{renderingEngine:o,viewport:a}=n,c=a.getCamera().viewPlaneNormal;pt.normalize(c);const l=i.filter(h=>{const{data:g}=h,p=o.getViewport(g.viewportId),m=this._getReferenceLineControllable(p.id);return a!==p&&m===!0}),f=[];for(let h=0;h<l.length;++h){const g=l[h],{viewportId:p}=g.data,w=o.getViewport(p).getCamera(),v=w.viewPlaneNormal;if(pt.normalize(v),Dt(c,v,.01)||Ad(c,v,.01))continue;let y=!1;for(let C=0;C<f.length;++C){const x=f[C],{viewportId:T}=x.data,_=o.getViewport(T).getCamera();Dt(_.viewPlaneNormal,w.viewPlaneNormal,.01)&&Dt(_.position,w.position,1)&&(y=!0)}y||f.push(g)}const u=i.filter(h=>{const{data:g}=h,p=o.getViewport(g.viewportId),m=this._getReferenceLineControllable(p.id);return a!==p&&m!==!0});for(let h=0;h<u.length;++h){const g=u[h],{viewportId:p}=g.data,w=o.getViewport(p).getCamera(),v=w.viewPlaneNormal;if(pt.normalize(v),Dt(c,v,.01)||Ad(c,v,.01))continue;let y=!1;for(let C=0;C<f.length;++C){const x=f[C],{viewportId:T}=x.data,_=o.getViewport(T).getCamera();Dt(_.viewPlaneNormal,w.viewPlaneNormal,.01)&&Dt(_.position,w.position,1)&&(y=!0)}y||f.push(g)}const d=this._getAnnotationsForViewportsWithDifferentCameras(n,i);for(let h=0;h<d.length;++h){const g=d[h];if(f.some(C=>C===g))continue;const{viewportId:p}=g.data,w=o.getViewport(p).getCamera(),v=w.viewPlaneNormal;if(pt.normalize(v),Dt(c,v,.01)||Ad(c,v,.01))continue;let y=!1;for(let C=0;C<f.length;++C){const x=f[C],{viewportId:T}=x.data,_=o.getViewport(T).getCamera();Dt(_.viewPlaneNormal,w.viewPlaneNormal,.01)&&Dt(_.position,w.position,1)&&(y=!0)}y||f.push(g)}return f},this._checkIfViewportsRenderingSameScene=(n,i)=>{const o=n.getAllVolumeIds(),a=i.getAllVolumeIds();return o.length===a.length&&o.every(s=>a.includes(s))},this._jump=(n,i)=>{Ue.isInteractingWithTool=!0;const{viewport:o,renderingEngine:a}=n,s=this._getAnnotations(n),c=[0,0,0];pt.subtract(i,this.toolCenter,c);const f=this._getAnnotationsForViewportsWithDifferentCameras(n,s).filter(u=>{const{data:d}=u,h=a.getViewport(d.viewportId),g=this._checkIfViewportsRenderingSameScene(o,h);return this._getReferenceLineControllable(h.id)&&this._getReferenceLineDraggableRotatable(h.id)&&g});return f.length===0?(Ue.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(a,f,c),Ue.isInteractingWithTool=!1,!0)},this._activateModify=n=>{Ue.isInteractingWithTool=!this.configuration.mobile?.enabled,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._endCallback=n=>{const i=n.detail,{element:o}=i;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(o),Vt(o),this.editData=null;const s=vt(o,this.getToolName(),!1);Me(s)},this._dragCallback=n=>{const i=n.detail,o=i.deltaPoints.world;if(Math.abs(o[0])<.001&&Math.abs(o[1])<.001&&Math.abs(o[2])<.001)return;const{element:a}=i,s=Ce(a),{renderingEngine:c,viewport:l}=s,f=this._getAnnotations(s),d=this.filterInteractableAnnotationsForElement(a,f)[0];if(!d)return;const{handles:h}=d.data,{currentPoints:g}=n.detail,p=g.canvas;if(h.activeOperation===va.DRAG){const w=this._getAnnotationsForViewportsWithDifferentCameras(s,f).filter(v=>{const{data:y}=v,C=c.getViewport(y.viewportId),x=this._getReferenceLineControllable(C.id),T=this._getReferenceLineDraggableRotatable(C.id);return x===!0&&T===!0&&d.data.activeViewportIds.find(S=>S===C.id)});this._applyDeltaShiftToSelectedViewportCameras(c,w,o)}else if(h.activeOperation===va.ROTATE){const w=this._getAnnotationsForViewportsWithDifferentCameras(s,f).filter(I=>{const{data:O}=I,M=c.getViewport(O.viewportId),R=this._getReferenceLineControllable(M.id),A=this._getReferenceLineDraggableRotatable(M.id);return R===!0&&A===!0}),v=xt(),y=xt(),C=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],x=l.worldToCanvas(C),T=i.currentPoints.canvas,S=xt();Mo(S,T,i.deltaPoints.canvas),Mo(v,S,x),Mo(y,T,x);let _=hU(v,y);this._isClockWise(x,S,T)&&(_*=-1),_=Math.round(_*100)/100;const E=l.getCamera().viewPlaneNormal,{matrix:D}=ti.buildFromRadian().translate(C[0],C[1],C[2]).rotate(_,E).translate(-C[0],-C[1],-C[2]),b=[];w.forEach(I=>{const{data:O}=I;O.handles.toolCenter=C;const M=c.getViewport(O.viewportId),R=M.getCamera(),{viewUp:A,position:B,focalPoint:k}=R;A[0]+=B[0],A[1]+=B[1],A[2]+=B[2],Pt(k,k,D),Pt(B,B,D),Pt(A,A,D),A[0]-=B[0],A[1]-=B[1],A[2]-=B[2],M.setCamera({position:B,viewUp:A,focalPoint:k}),b.push(M.id)}),c.renderViewports(b)}else if(h.activeOperation===va.SLAB){const w=this._getAnnotationsForViewportsWithDifferentCameras(s,f).filter(C=>{const{data:x}=C,T=c.getViewport(x.viewportId),S=this._getReferenceLineControllable(T.id),_=this._getReferenceLineSlabThicknessControlsOn(T.id);return S===!0&&_===!0&&d.data.activeViewportIds.find(E=>E===T.id)});if(w.length===0)return;const v=this._filterViewportWithSameOrientation(s,w[0],f),y=[];y.push(l.id),v.forEach(C=>{const{data:x}=C,T=c.getViewport(x.viewportId),_=T.getCamera().viewPlaneNormal,E=pt.dot(o,_),D=[..._];if(pt.multiplyScalar(D,E),Math.abs(D[0])>.001||Math.abs(D[1])>.001||Math.abs(D[2])>.001){const b=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]),I=i.lastPoints.world,O=[0,0,0],M=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(T.id)){const{rotationPoints:fe}=this.editData.annotation.data.handles,ae=fe.filter(de=>de[1].uid===T.id);if(ae.length===2){const de=l.canvasToWorld(ae[0][3]),we=l.canvasToWorld(ae[1][3]);pt.add(de,we,M),pt.multiplyScalar(M,.5)}}pt.subtract(I,M,O);const A=pt.dot(O,_),B=[..._];pt.multiplyScalar(B,A);const k=[B[0],B[1],B[2]];At(k,k);const L=[D[0],D[1],D[2]];At(L,L);let F=T.getSlabThickness();Ad(k,L,.001)?F-=b:F+=b,F=Math.abs(F),F=Math.max(Cy.MINIMUM_SLAB_THICKNESS,F),this._pointNearReferenceLine(d,p,6,T)&&(F=Cy.MINIMUM_SLAB_THICKNESS),lr(T.id,c.id).getToolInstance(this.getToolName()).setSlabThickness(T,F),y.push(T.id)}}),c.renderViewports(y)}},this._pointNearReferenceLine=(n,i,o,a)=>{const{data:s}=n,{rotationPoints:c}=s.handles;for(let l=0;l<c.length-1;++l){const f=c[l][1];if(f.id!==a.id||!this._getReferenceLineControllable(f.id))continue;const d={start:{x:c[l][2][0],y:c[l][2][1]},end:{x:c[l][3][0],y:c[l][3][1]}},h=Ir([d.start.x,d.start.y],[d.end.x,d.end.y],[i[0],i[1]]),g={start:{x:c[l+1][2][0],y:c[l+1][2][1]},end:{x:c[l+1][3][0],y:c[l+1][3][1]}},p=Ir([g.start.x,g.start.y],[g.end.x,g.end.y],[i[0],i[1]]);if(h<=o||p<=o)return!0;l++}return!1},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||Vpe,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||kpe,this._getReferenceLineDraggableRotatable=e.configuration?.getReferenceLineDraggableRotatable||Fpe,this._getReferenceLineSlabThicknessControlsOn=e.configuration?.getReferenceLineSlabThicknessControlsOn||Upe}onSetToolActive(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e)}onSetToolPassive(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolEnabled(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolDisabled(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:r,viewportId:n})=>{const i=Ln(n,r);if(!i)return;const o=this._getAnnotations(i);o?.length&&o.forEach(a=>{kt(a.annotationUID)})})}setToolCenter(e,r=!1){this._getViewportsInfo().map(({renderingEngineId:i,viewportId:o})=>{const s=Bn(i).getViewport(o),c=s.getCamera(),{focalPoint:l,position:f,viewPlaneNormal:u}=c,d=[e[0]-l[0],e[1]-l[1],e[2]-l[2]],h=d[0]*u[0]+d[1]*u[1]+d[2]*u[2],g=[h*u[0],h*u[1],h*u[2]],p=[l[0]+g[0],l[1]+g[1],l[2]+g[2]],m=[f[0]+g[0],f[1]+g[1],f[2]+g[2]];s.setCamera({focalPoint:p,position:m}),s.render()}),this.toolCenter=e,r||Xe(ke,V.CROSSHAIR_TOOL_CENTER_CHANGED,{toolGroupId:this.toolGroupId,toolCenter:this.toolCenter})}getHandleNearImagePoint(e,r,n,i){const o=Ce(e),{viewport:a}=o;let s=this._getRotationHandleNearImagePoint(a,r,n,i);if(s!==null||(s=this._getSlabThicknessHandleNearImagePoint(a,r,n,i),s!==null))return s}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.removeEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.addEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_autoPanViewportIfNecessary(e,r){const n=r.getViewport(e),{clientWidth:i,clientHeight:o}=n.canvas,a=n.worldToCanvas(this.toolCenter),s=this.configuration.autoPan.panSize,c=[a[0],a[1]];if(a[0]<0?c[0]=s:a[0]>i&&(c[0]=i-s),a[1]<0?c[1]=s:a[1]>o&&(c[1]=o-s),c[0]===a[0]&&c[1]===a[1])return;const l=n.canvasToWorld(c),f=[l[0]-this.toolCenter[0],l[1]-this.toolCenter[1],l[2]-this.toolCenter[2]],u=n.getCamera(),{focalPoint:d,position:h}=u,g=[h[0]-f[0],h[1]-f[1],h[2]-f[2]],p=[d[0]-f[0],d[1]-f[1],d[2]-f[2]];n.setCamera({focalPoint:p,position:g}),n.render()}setSlabThickness(e,r){let n;const{filterActorUIDsToSetSlabThickness:i}=this.configuration;i&&i.length>0&&(n=i);let o=this.configuration.slabThicknessBlendMode;r===Cy.MINIMUM_SLAB_THICKNESS&&(o=ds.COMPOSITE),e.setBlendMode(o,n,!1),e.setSlabThickness(r,n)}_isClockWise(e,r,n){return(r[0]-e[0])*(n[1]-e[1])-(r[1]-e[1])*(n[0]-e[0])>0}_applyDeltaShiftToSelectedViewportCameras(e,r,n){r.forEach(i=>{this._applyDeltaShiftToViewportCamera(e,i,n)})}_applyDeltaShiftToViewportCamera(e,r,n){const{data:i}=r,o=e.getViewport(i.viewportId),a=o.getCamera(),s=a.viewPlaneNormal,c=pt.dot(n,s),l=[...s];if(pt.multiplyScalar(l,c),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const f=[0,0,0],u=[0,0,0];pt.add(a.focalPoint,l,f),pt.add(a.position,l,u),o.setCamera({focalPoint:f,position:u}),o.render()}}_getRotationHandleNearImagePoint(e,r,n,i){const{data:o}=r,{rotationPoints:a}=o.handles;for(let s=0;s<a.length;s++){const c=a[s][0],l=a[s][1];if(!this._getReferenceLineControllable(l.id)||!this._getReferenceLineDraggableRotatable(l.id))continue;const d=e.worldToCanvas(c);if(Xn(n,d)<i)return o.handles.activeOperation=va.ROTATE,this.editData={annotation:r},c}return null}_getSlabThicknessHandleNearImagePoint(e,r,n,i){const{data:o}=r,{slabThicknessPoints:a}=o.handles;for(let s=0;s<a.length;s++){const c=a[s][0],l=a[s][1];if(!this._getReferenceLineControllable(l.id)||!this._getReferenceLineSlabThicknessControlsOn(l.id))continue;const d=e.worldToCanvas(c);if(Xn(n,d)<i)return o.handles.activeOperation=va.SLAB,o.activeViewportIds=[l.id],this.editData={annotation:r},c}return null}_pointNearTool(e,r,n,i){const o=Ce(e),{viewport:a}=o,{clientWidth:s,clientHeight:c}=a.canvas,l=Math.sqrt(s*s+c*c),{data:f}=r,{rotationPoints:u}=f.handles,{slabThicknessPoints:d}=f.handles,h=[];for(let g=0;g<u.length-1;++g){const p=u[g][1],m=this._getReferenceLineControllable(p.id),w=this._getReferenceLineDraggableRotatable(p.id);if(!m||!w)continue;const v={start:{x:u[g][2][0],y:u[g][2][1]},end:{x:u[g][3][0],y:u[g][3][1]}},y=Ir([v.start.x,v.start.y],[v.end.x,v.end.y],[n[0],n[1]]),C={start:{x:u[g+1][2][0],y:u[g+1][2][1]},end:{x:u[g+1][3][0],y:u[g+1][3][1]}},x=Ir([C.start.x,C.start.y],[C.end.x,C.end.y],[n[0],n[1]]);(y<=i||x<=i)&&(h.push(p.id),f.handles.activeOperation=va.DRAG),g++}for(let g=0;g<d.length-1;++g){const p=d[g][1];if(h.find(O=>O===p.id))continue;const m=this._getReferenceLineControllable(p.id),w=this._getReferenceLineSlabThicknessControlsOn(p.id);if(!m||!w)continue;const v=d[g][2],y=d[g][3],C=xt();Zr(C,v,y),as(C,C,.5);const x=xt();Mn(x,v,C),cs(x,x);const T=xt();as(T,x,l*.05);const S=xt(),_=xt();Zr(S,C,T),Mn(_,C,T);const E={start:{x:S[0],y:S[1]},end:{x:v[0],y:v[1]}},D=Ir([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]),b={start:{x:_[0],y:_[1]},end:{x:y[0],y:y[1]}},I=Ir([b.start.x,b.start.y],[b.end.x,b.end.y],[n[0],n[1]]);(D<=i||I<=i)&&(h.push(p.id),f.handles.activeOperation=null),g++}return f.activeViewportIds=[...h],this.editData={annotation:r},f.handles.activeOperation===va.DRAG}}lL.toolName="Crosshairs";const Pp="magnify-viewport";class uL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}){super(e,r),this._hasBeenRemoved=!1,this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c,renderingEngine:l}=s;if(!(c instanceof qn))throw new Error("MagnifyTool only works on StackViewports");const f=this._getReferencedImageId(c);if(!f)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const u=vt(o,this.getToolName());return this.editData={referencedImageId:f,viewportIdsToRender:u,enabledElement:s,renderingEngine:l,currentPoints:a},this._createMagnificationViewport(),this._activateDraw(o),St(o),n.preventDefault(),Me(u),!0},this.preTouchStartCallback=n=>{this.preMouseDownCallback(n)},this._createMagnificationViewport=()=>{const{enabledElement:n,referencedImageId:i,viewportIdsToRender:o,renderingEngine:a,currentPoints:s}=this.editData,{viewport:c}=n,{element:l}=c,f=c.getProperties(),{rotation:u}=c.getViewPresentation(),{canvas:d,world:h}=s;let g;if(g=l.querySelector(".magnifyTool"),g===null){const m=document.createElement("div");m.classList.add("magnifyTool"),m.style.display="block",m.style.width=`${this.configuration.magnifyWidth}px`,m.style.height=`${this.configuration.magnifyHeight}px`,m.style.position="absolute",g=m,l.querySelector(".viewport-element").appendChild(m);const v={viewportId:Pp,type:Fn.STACK,element:g};a.enableElement(v)}g.style.top=`${d[1]-this.configuration.magnifyHeight/2}px`,g.style.left=`${d[0]-this.configuration.magnifyWidth/2}px`;const p=a.getViewport(Pp);p.setStack([i]).then(()=>{if(this._hasBeenRemoved)return;p.setProperties(f),p.setViewPresentation({rotation:u});const{parallelScale:m}=c.getCamera(),{focalPoint:w,position:v,viewPlaneNormal:y}=p.getCamera(),C=Math.sqrt(Math.pow(w[0]-v[0],2)+Math.pow(w[1]-v[1],2)+Math.pow(w[2]-v[2],2)),x=[h[0],h[1],h[2]],T=[x[0]+C*y[0],x[1]+C*y[1],x[2]+C*y[2]];p.setCamera({parallelScale:m*(1/this.configuration.magnifySize),focalPoint:x,position:T}),p.render()}),g.style.display="block",Me(o)},this._cancelCallback=n=>{n.preventDefault(),n.stopPropagation(),this._dragEndCallback(n)},this._dragCallback=n=>{const i=n.detail,{deltaPoints:o,element:a,currentPoints:s}=i,c=o.world,l=s.canvas,f=Ce(a),{renderingEngine:u}=f,d=u.getViewport(Pp),h=a.querySelector(".magnifyTool");if(!h)return;h.style.top=`${l[1]-this.configuration.magnifyHeight/2}px`,h.style.left=`${l[0]-this.configuration.magnifyWidth/2}px`;const{focalPoint:g,position:p}=d.getCamera(),m=[p[0]+c[0],p[1]+c[1],p[2]+c[2]],w=[g[0]+c[0],g[1]+c[1],g[2]+c[2]];d.setCamera({focalPoint:w,position:m}),d.render()},this._dragEndCallback=n=>{let{element:i}=n.detail;if(i===void 0){const{enabledElement:l}=this.editData,{viewport:f}=l;i=f.element}const o=Ce(i),{renderingEngine:a}=o;a.disableElement(Pp);const s=i.querySelector(".viewport-element"),c=s.querySelector(".magnifyTool");s.removeChild(c),this._deactivateDraw(i),Vt(i),this._hasBeenRemoved=!0},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,this._hasBeenRemoved=!1,n.addEventListener(V.MOUSE_UP,this._dragEndCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._dragEndCallback),n.addEventListener("contextmenu",this._cancelCallback),n.addEventListener(V.TOUCH_END,this._dragEndCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._dragEndCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._dragEndCallback),n.removeEventListener("contextmenu",this._cancelCallback),n.removeEventListener(V.TOUCH_END,this._dragEndCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)}}_getReferencedImageId(e){const r=this.getTargetId(e);let n;return e instanceof qn&&(n=r.split("imageId:")[1]),n}}uL.toolName="Magnify";const Bpe="advancedMagnifyTool",Gpe=125,{Events:sl}=go,T4=t=>!!t.representationUID;var nw;(function(t){t.ShowZoomFactorsList="showZoomFactorsList"})(nw||(nw={}));const Wpe="AdvancedMagnify",$pe=1-Po,Z3=class Z3 extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:Ss.Secondary,modifierKey:Qr.Shift}]}}}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=Ce(a),{viewport:c,renderingEngine:l}=s,f=o.world,u=o.canvas,{magnifyingGlass:d}=this.configuration,{radius:h,zoomFactor:g,autoPan:p}=d,m=this._getWorldHandlePoints(c,u,h),w=c.getCamera(),{viewPlaneNormal:v,viewUp:y}=w,C=this.getReferencedImageId(c,f,v,y),x=un(),T=un(),S=c.getFrameOfReferenceUID(),_={annotationUID:x,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...v],viewUp:[...y],FrameOfReferenceUID:S,referencedImageId:C},data:{sourceViewportId:c.id,magnifyViewportId:T,zoomFactor:g,isCanvasAnnotation:!1,handles:{points:m,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(_,{magnifyViewportId:T,sourceEnabledElement:s,position:u,radius:h,zoomFactor:g,autoPan:{enabled:p.enabled,padding:p.padding,callback:D=>{const b=_.data.handles.points,{world:I}=D.delta;for(let O=0,M=b.length;O<M;O++){const R=b[O];R[0]+=I[0],R[1]+=I[1],R[2]+=I[2]}_.invalidated=!0}}}),Ft(_,a);const E=vt(a,this.getToolName());return n.preventDefault(),Me(E),_},this.onSetToolDisabled=()=>{this.magnifyViewportManager.dispose(),U0().forEach(i=>{i.metadata.toolName===this.getToolName()&&kt(i.annotationUID)})},this.isPointNearTool=(n,i,o,a)=>{const{viewport:s}=Ce(n),{points:c}=i.data.handles,{radius:l,center:f}=this._getCanvasCircleData(s,c),u=bl([f,o]);return Math.abs(u-l)<a*2},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},St(a),this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;const{points:l}=c.handles,f=l.findIndex(d=>d===o),u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f},this._activateModify(s),St(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{data:l}=a;l.handles.activeHandleIndex=null,this._deactivateModify(o),Vt(o),this.editData=null,this.isDrawing=!1,Me(s),c&&En(a)},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{viewport:a}=Ce(o),{deltaPoints:s}=i,c=s?.canvas??[0,0,0],{annotation:l,viewportIdsToRender:f}=this.editData,{points:u}=l.data.handles,d=this._getWorldDeltaFromCanvasDelta(a,u,c);this._applyWorldDelta(u,d),l.invalidated=!0,this.editData.hasMoved=!0,Me(f)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c}=this.editData,{data:l}=a;if(c===void 0){const{deltaPoints:f}=i,u=f.canvas??[0,0,0],d=l.handles.points,h=this._getWorldDeltaFromCanvasDelta(Ce(o).viewport,d,u);this._applyWorldDelta(d,h),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,{viewport:a}=Ce(o),{annotation:s}=this.editData,{data:c}=s,{points:l}=c.handles,{center:f}=this._getCanvasCircleData(a,l),{currentPoints:u}=i,d=u.canvas,h=bl([f,d]),p=this._getCanvasHandlePoints(f,h).map(m=>a.canvasToWorld(m));l[0]=p[0],l[1]=p[1],l[2]=p[2],l[3]=p[3]},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length)return o;c=c?.filter(u=>u.data.sourceViewportId===a.id);const l=this.filterInteractableAnnotationsForElement(s,c);if(!l?.length)return o;const f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let u=0;u<l.length;u++){const d=l[u],{annotationUID:h,data:g}=d,{magnifyViewportId:p,zoomFactor:m,handles:w}=g,{points:v,activeHandleIndex:y}=w,{center:C,radius:x,canvasPoints:T}=this._getCanvasCircleData(a,v);f.annotationUID=h,this.getStyle("lineWidth",f,d),this.getStyle("lineDash",f,d);const S=this.getStyle("color",f,d);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let _;if(!mr(h))continue;if(!pr(h)&&!this.editData&&y!==null){const I=T[y];_=[[I[0],I[1],0]]}_&&Wn(i,h,"0",_,{color:S});const E=`${h}-advancedMagnify`;Si(i,h,"0",C,x,{color:S,lineWidth:5},E);const b=this.magnifyViewportManager.getViewport(p);b.position=C,b.radius=x,b.zoomFactor=m,b.update(),o=!0}return o},this._getWorldHandlePoints=(n,i,o)=>this._getCanvasHandlePoints(i,o).map(s=>n.canvasToWorld(s)),this._getCanvasCircleData=(n,i)=>{const o=i.map(u=>n.worldToCanvas(u)),a=o[0],s=o[2],c=o[3],l=Math.abs(s[1]-a[1])*.5,f=[c[0]+l,a[1]+l];return{canvasPoints:o,center:f,radius:l}},this._getCanvasHandlePoints=(n,i)=>[[n[0],n[1]-i,0],[n[0]+i,n[1],0],[n[0],n[1]+i,0],[n[0]-i,n[1],0]],this.magnifyViewportManager=Uf.getInstance()}showZoomFactorsList(e,r){const{element:n,currentPoints:i}=e.detail,o=Ce(n),{viewport:a}=o,{canvas:s}=i,c=n.querySelector(":scope .viewport-element"),l=r.data.zoomFactor,f=()=>u.parentElement.removeChild(u),u=this._getZoomFactorsListDropdown(l,d=>{d!==void 0&&(r.data.zoomFactor=Number.parseFloat(d),r.invalidated=!0),f(),a.render()});Object.assign(u.style,{left:`${s[0]}px`,top:`${s[1]}px`}),c.appendChild(u),u.focus()}_getZoomFactorsListDropdown(e,r){const{zoomFactorList:n}=this.configuration.magnifyingGlass,i=document.createElement("select");return i.size=5,Object.assign(i.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach(o=>{i.addEventListener(o,a=>a.stopPropagation())}),i.addEventListener("change",o=>{o.stopPropagation(),r(i.value)}),i.addEventListener("keydown",o=>{((o.keyCode??o.which===27)||o.key?.toLowerCase()==="escape")&&(o.stopPropagation(),r())}),n.forEach(o=>{const a=document.createElement("option");a.label=o,a.title=`Zoom factor ${o.toFixed(1)}`,a.value=o,a.defaultSelected=o===e,i.add(a)}),i}_getWorldDeltaFromCanvasDelta(e,r,n){if(!n)return[0,0,0];const i=r[0],o=e.worldToCanvas(i),a=e.canvasToWorld([o[0]+n[0],o[1]+n[1]]);return[a[0]-i[0],a[1]-i[1],a[2]-i[2]]}_applyWorldDelta(e,r){if(r)for(let n=0,i=e.length;n<i;n++){const o=e[n];o[0]+=r[0],o[1]+=r[1],o[2]+=r[2]}}};Z3.Actions=nw;let Zh=Z3;class Uf{constructor(){this.createViewport=(e,r)=>{const{magnifyViewportId:n,sourceEnabledElement:i,position:o,radius:a,zoomFactor:s,autoPan:c}=r,{viewport:l}=i,{element:f}=l,u=new zpe({magnifyViewportId:n,sourceEnabledElement:i,radius:a,position:o,zoomFactor:s,autoPan:c});return this._addSourceElementEventListener(f),this._magnifyViewportsMap.set(u.viewportId,{annotation:e,magnifyViewport:u,magnifyViewportInfo:r}),u},this._annotationRemovedCallback=e=>{const{annotation:r}=e.detail;r.metadata.toolName===Wpe&&this.destroyViewport(r.data.magnifyViewportId)},this._newStackImageCallback=e=>{const{viewportId:r,imageId:n}=e.detail,i=this._getMagnifyViewportsMapEntriesBySourceViewportId(r),{viewport:o}=xn(r);o.stackActorReInitialized&&this._reset(r),i.forEach(({annotation:a})=>{a.metadata.referencedImageId=n,a.invalidated=!0})},this._newVolumeImageCallback=e=>{const{renderingEngineId:r,viewportId:n}=e.detail,o=Bn(r).getViewport(n),{viewPlaneNormal:a}=o.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(n).forEach(({annotation:c})=>{const{viewPlaneNormal:l}=c.metadata;if(!(Math.abs(ft(l,a))>$pe))return;const{handles:u}=c.data,d=o.canvasToWorld([0,0]),h=an(Ie(),d,u.points[0]),g=ft(h,a),p=Jn(Ie(),a,g);for(let m=0,w=u.points.length;m<w;m++){const v=u.points[m];v[0]+=p[0],v[1]+=p[1],v[2]+=p[2]}c.invalidated=!0})},this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){return Uf._singleton=Uf._singleton??new Uf,Uf._singleton}getViewport(e){return this._magnifyViewportsMap.get(e)?.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(e){const r=this._magnifyViewportsMap.get(e);if(r){const{magnifyViewport:n}=r,{viewport:i}=n.sourceEnabledElement,{element:o}=i;this._removeSourceElementEventListener(o),n.dispose(),this._magnifyViewportsMap.delete(e)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach(r=>this.destroyViewport(r))}_getMagnifyViewportsMapEntriesBySourceViewportId(e){return Array.from(this._magnifyViewportsMap.values()).filter(({magnifyViewport:n})=>{const{viewport:i}=n.sourceEnabledElement;return i.id===e})}_reset(e){this._getMagnifyViewportsMapEntriesBySourceViewportId(e).forEach(({magnifyViewport:n,annotation:i,magnifyViewportInfo:o})=>{this.destroyViewport(n.viewportId);const a=xn(e);this.createViewport(i,{...o,sourceEnabledElement:{...a}})})}_addEventListeners(){ke.addEventListener(V.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){ke.removeEventListener(V.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(e){e.addEventListener(sl.STACK_NEW_IMAGE,this._newStackImageCallback);const r=i=>{const{viewportId:o}=i.detail;this._reset(o)};e.addEventListener(sl.VIEWPORT_NEW_IMAGE_SET,r);const n=i=>{const{viewportId:o}=i.detail;this._reset(o)};e.addEventListener(sl.VOLUME_VIEWPORT_NEW_VOLUME,n),e.addEventListener(sl.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.newStackHandler=r,e.newVolumeHandler=n}_removeSourceElementEventListener(e){e.removeEventListener(sl.STACK_NEW_IMAGE,this._newStackImageCallback),e.removeEventListener(sl.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.removeEventListener(sl.VIEWPORT_NEW_IMAGE_SET,e.newStackHandler),e.removeEventListener(sl.VOLUME_VIEWPORT_NEW_VOLUME,e.newVolumeHandler),delete e.newStackHandler,delete e.newVolumeHandler}_initialize(){this._addEventListeners()}}class zpe{constructor({magnifyViewportId:e,sourceEnabledElement:r,radius:n=Gpe,position:i=[0,0],zoomFactor:o,autoPan:a}){this._enabledElement=null,this._sourceToolGroup=null,this._magnifyToolGroup=null,this._isViewportReady=!1,this._radius=0,this._resized=!1,this._canAutoPan=!1,this._viewportId=e??un(),this._sourceEnabledElement=r,this._autoPan=a,this.radius=n,this.position=i,this.zoomFactor=o,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=j0(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(e){Math.abs(this._radius-e)>1e-5&&(this._radius=e,this._resized=!0)}update(){const{radius:e,position:r,visible:n}=this,{viewport:i}=this._enabledElement,{element:o}=i,a=2*e,[s,c]=r;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(o.style,{display:n?"block":"hidden",width:`${a}px`,height:`${a}px`,left:`${-e}px`,top:`${-e}px`,transform:`translate(${s}px, ${c}px)`}),this._isViewportReady&&(this._syncViewports(),i.render())}dispose(){const{viewport:e}=this._enabledElement,{element:r}=e,n=e.getRenderingEngine();this._removeEventListeners(r),n.disableElement(e.id),r.parentNode&&r.parentNode.removeChild(r)}_handleToolModeChanged(e){const{_magnifyToolGroup:r}=this,{toolGroupId:n,toolName:i,mode:o,toolBindingsOptions:a}=e.detail;if(this._sourceToolGroup?.id===n)switch(o){case _n.Active:r.setToolActive(i,a);break;case _n.Passive:r.setToolPassive(i);break;case _n.Enabled:r.setToolEnabled(i);break;case _n.Disabled:r.setToolDisabled(i);break;default:throw new Error(`Unknow tool mode (${o})`)}}_inheritBorderRadius(e){const r=e.querySelector(".viewport-element"),n=e.querySelector(".cornerstone-canvas");r.style.borderRadius="inherit",n.style.borderRadius="inherit"}_createViewportNode(){const e=document.createElement("div"),{radius:r}=this,n=r*2;return e.classList.add(Bpe),Object.assign(e.style,{display:"block",width:`${n}px`,height:`${n}px`,position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:`${-r}px`,top:`${-r}px`,transform:"translate(-1000px, -1000px)"}),e}_convertZoomFactorToParallelScale(e,r,n){const{parallelScale:i}=e.getCamera(),o=r.canvas.offsetWidth/e.canvas.offsetWidth;return i*(1/n)*o}_isStackViewport(e){return"setStack"in e}_isVolumeViewport(e){return"addVolumes"in e}_cloneToolGroups(e,r){const n=e.getActors(),i=`${r.id}-toolGroup`,o=lr(e.id,e.renderingEngineId),a=o.clone(i,s=>{const c=o.getToolInstance(s);return c instanceof $n&&!(c instanceof Zh)});return a.addViewport(r.id,r.renderingEngineId),n.filter(T4).forEach(s=>{Z0(this.viewportId,[{segmentationId:s.referencedId,type:yt.Labelmap}])}),{sourceToolGroup:o,magnifyToolGroup:a}}_cloneStack(e,r){const n=e.getImageIds();r.setStack(n).then(()=>{this._isViewportReady=!0,this.update()})}_cloneVolumes(e,r){const i=e.getActors().filter(o=>!T4(o)).map(o=>({volumeId:o.referencedId}));return r.setVolumes(i).then(()=>{this._isViewportReady=!0,this.update()}),r}_cloneViewport(e,r){const{viewportId:n}=this,i=e.getRenderingEngine(),{options:o}=e,a={element:r,viewportId:n,type:e.type,defaultOptions:{...o}};i.enableElement(a);const s=i.getViewport(n);this._isStackViewport(e)?this._cloneStack(e,s):this._isVolumeViewport(e)&&this._cloneVolumes(e,s),this._inheritBorderRadius(r);const c=this._cloneToolGroups(e,s);this._sourceToolGroup=c.sourceToolGroup,this._magnifyToolGroup=c.magnifyToolGroup}_cancelMouseEventCallback(e){e.stopPropagation(),e.preventDefault()}_browserMouseUpCallback(e){const{element:r}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),r.addEventListener("mouseup",this._cancelMouseEventCallback),r.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(e){const{element:r}=this._enabledElement.viewport;this._canAutoPan=!!e.target?.closest(".advancedMagnifyTool"),document.addEventListener("mouseup",this._browserMouseUpCallback),r.removeEventListener("mouseup",this._cancelMouseEventCallback),r.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(e){if(!Ue.isInteractingWithTool)return;const{_autoPan:r}=this;if(!r.enabled||!this._canAutoPan)return;const{currentPoints:n}=e.detail,{viewport:i}=this._enabledElement,{canvasToWorld:o}=i,{canvas:a}=n,{radius:s}=this,c=[s,s],l=Os(c,a),f=s-r.padding;if(l<=f)return;const u=l-f,d=Mo(xt(),a,c);cs(d,d),as(d,d,u);const h=Zr(xt(),this.position,d),g=o(this.position),p=o(h),m=an(Ie(),p,g),w={points:{currentPosition:{canvas:this.position,world:g},newPosition:{canvas:h,world:p}},delta:{canvas:d,world:m}};r.callback(w)}_addBrowserEventListeners(e){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),e.addEventListener("mousedown",this._cancelMouseEventCallback),e.addEventListener("mouseup",this._cancelMouseEventCallback),e.addEventListener("mousemove",this._cancelMouseEventCallback),e.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(e){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),e.removeEventListener("mousedown",this._cancelMouseEventCallback),e.removeEventListener("mouseup",this._cancelMouseEventCallback),e.removeEventListener("mousemove",this._cancelMouseEventCallback),e.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(e){ke.addEventListener(V.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(V.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(V.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(e)}_removeEventListeners(e){ke.removeEventListener(V.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(V.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(V.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(e)}_initialize(){const{_sourceEnabledElement:e}=this,{viewport:r}=e,{canvas:n}=r,i=this._createViewportNode();n.parentNode.appendChild(i),this._addEventListeners(i),this._cloneViewport(r,i),this._enabledElement=Ce(i)}_syncViewportsCameras(e,r){const n=e.canvasToWorld(this.position),i=this._convertZoomFactorToParallelScale(e,r,this.zoomFactor),{focalPoint:o,position:a,viewPlaneNormal:s}=r.getCamera(),c=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)+Math.pow(o[2]-a[2],2)),l=[n[0],n[1],n[2]],f=[l[0]+c*s[0],l[1]+c*s[1],l[2]+c*s[2]];r.setCamera({parallelScale:i,focalPoint:l,position:f})}_syncStackViewports(e,r){r.setImageIdIndex(e.getCurrentImageIdIndex())}_syncViewports(){const{viewport:e}=this._sourceEnabledElement,{viewport:r}=this._enabledElement,n=e.getProperties();r.getImageData()&&(r.setProperties(n),this._syncViewportsCameras(e,r),this._isStackViewport(e)&&this._syncStackViewports(e,r),this._syncViewportsCameras(e,r),r.render())}_resizeViewport(){const{viewport:e}=this._enabledElement;e.getRenderingEngine().resize()}}Zh.toolName="AdvancedMagnify";const{EPSILON:xy}=Mc;class fL extends As{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",enforceSameFrameOfReference:!0,showFullDimension:!1}}){super(e,r),this.editData=null,this._init=()=>{const i=Bi()[0];if(!i)return;let o=i.getViewports();o=b2(o,this.getToolName());const a=i.getViewport(this.configuration.sourceViewportId);if(!a?.getImageData())return;const{element:s}=a,{viewUp:c,viewPlaneNormal:l}=a.getCamera(),f=zm(a);let u=this.editData?.annotation;const d=a.getFrameOfReferenceUID();if(u)this.editData.annotation.data.handles.points=f;else{const h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...c],FrameOfReferenceUID:d,referencedImageId:null},data:{handles:{points:f}}};Ft(h,s),u=h}this.editData={sourceViewportId:a.id,renderingEngine:i,annotation:u},Me(o.filter(h=>h.id!==a.id).map(h=>h.id))},this.onSetToolEnabled=()=>{this._init()},this.onSetToolConfiguration=()=>{this._init()},this.onCameraModified=n=>{this._init()},this.renderAnnotation=(n,i)=>{const{viewport:o}=n;if(!this.editData)return!1;const{annotation:a,sourceViewportId:s}=this.editData;let c=!1;const{viewport:l}=xn(s)||{};if(!l||l.id===o.id||!a||!a?.data?.handles?.points||this.configuration.enforceSameFrameOfReference&&l.getFrameOfReferenceUID()!==o.getFrameOfReferenceUID())return c;const f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=a.data.handles.points[0],d=a.data.handles.points[1],h=a.data.handles.points[2],g=a.data.handles.points[3],{focalPoint:p,viewPlaneNormal:m,viewUp:w}=o.getCamera(),{viewPlaneNormal:v}=l.getCamera();if(this.isParallel(m,v))return c;const y=ps(m,p),C=[u,h,d,g],x=[u,d,h,g];let T=C,S=qt(Ie(),C[0],C[1]);S=At(Ie(),S);let _=qt(Ie(),C[2],C[0]);_=At(Ie(),_);const E=nn(Ie(),S,_);if(this.isParallel(E,m))return c;this.isPerpendicular(S,m)&&(T=x);const D=v0(T[0],T[1],y),b=v0(T[2],T[3],y),{annotationUID:I}=a;f.annotationUID=I;const O=this.getStyle("lineWidth",f,a),M=this.getStyle("lineDash",f,a),R=this.getStyle("color",f,a),A=this.getStyle("shadow",f,a);let B=[D,b].map(F=>o.worldToCanvas(F));if(this.configuration.showFullDimension&&(B=this.handleFullDimension(o,D,m,w,b,B)),B.length<2)return c;const k=`${I}-line`;return Yt(i,I,"1",B[0],B[1],{color:R,width:O,lineDash:M,shadow:A},k),c=!0,c},this.isPerpendicular=(n,i)=>{const o=ft(n,i);return Math.abs(o)<xy}}handleFullDimension(e,r,n,i,o,a){e.getRenderingEngine();const s=this.getTargetId(e),c=this.getTargetImageData(s),l=this.getReferencedImageId(e,r,n,i);if(l&&c)try{const{imageData:f,dimensions:u}=c,[d,h,g,p]=[f.indexToWorld([0,0,0]),f.indexToWorld([u[0]-1,0,0]),f.indexToWorld([u[0]-1,u[1]-1,0]),f.indexToWorld([0,u[1]-1,0])].map(v=>b5(l,v)),[m,w]=[r,o].map(v=>b5(l,v));a=[[d,h],[h,g],[p,g],[d,p]].map(([v,y])=>this.intersectInfiniteLines(v,y,m,w)).filter(v=>v&&this.isInBound(v,u)).map(v=>{const y=O7(l,v);return e.worldToCanvas(y)})}catch(f){console.log(f)}return a}intersectInfiniteLines(e,r,n,i){const[o,a]=e,[s,c]=r,[l,f]=n,[u,d]=i,h=c-a,g=o-s,p=s*a-o*c,m=d-f,w=l-u,v=u*f-l*d;if(Math.abs(h*w-m*g)<xy)return;const y=(g*v-w*p)/(h*w-m*g),C=(m*p-h*v)/(h*w-m*g);return[y,C]}isParallel(e,r){return Math.abs(ft(e,r))>1-xy}isInBound(e,r){return e[0]>=0&&e[0]<=r[0]&&e[1]>=0&&e[1]<=r[1]}}fL.toolName="ReferenceLines";const{EPSILON:S4}=Mc;class dL extends As{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}){super(e,r),this.onSetToolEnabled=()=>{this._init()},this.onSetToolActive=()=>{this._init()},this._init=()=>{const n=this.configuration.sourceImageIds;if(!n?.length){console.warn("OverlayGridTool: No sourceImageIds provided in configuration");return}const i=ut("imagePlaneModule",n[0]);if(!i){console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");return}const{frameOfReferenceUID:o}=i,a=Kr(this.toolGroupId).viewportsInfo;if(!a?.length){console.warn("OverlayGridTool: No viewports found");return}if(!$t(this.getToolName(),o)?.length){const c=n.map(f=>this.calculateImageIdPointSets(f)),l={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:o,referencedImageId:null},data:{viewportData:new Map,pointSets:c}};Ft(l,o)}Me(a.map(({viewportId:c})=>c))},this.calculateImageIdPointSets=n=>{const{imagePositionPatient:i,rows:o,columns:a,rowCosines:s,columnCosines:c,rowPixelSpacing:l,columnPixelSpacing:f}=ut("imagePlaneModule",n),u=[...i],d=[...i],h=[...i],g=[...i];return tn(d,i,c,a*f),tn(h,i,s,o*l),tn(g,h,c,a*f),{pointSet1:[u,h,d,g],pointSet2:[u,d,h,g]}},this.renderAnnotation=(n,i)=>{const o=this.configuration.sourceImageIds;let a=!1;if(!o?.length)return a;const{viewport:s,FrameOfReferenceUID:c}=n;if(s.getImageIds().length<2)return a;const f=$t(this.getToolName(),c);if(!f?.length)return a;const u=f[0],{annotationUID:d}=u,{focalPoint:h,viewPlaneNormal:g}=s.getCamera(),p={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},m=this.getImageIdNormal(o[0]);if(this.isParallel(g,m))return a;const w=ps(g,h),v=u.data.pointSets,y=u.data.viewportData;for(let C=0;C<o.length;C++){const{pointSet1:x,pointSet2:T}=v[C],S=y.get(s.id)||this.initializeViewportData(y,s.id);if(!S.pointSetsToUse[C]){let B=x,k=qt(Ie(),x[0],x[1]);k=At(Ie(),k),this.isPerpendicular(k,g)&&(B=T),S.pointSetsToUse[C]=B,S.lineStartsWorld[C]=v0(B[0],B[1],w),S.lineEndsWorld[C]=v0(B[2],B[3],w)}const _=S.lineStartsWorld[C],E=S.lineEndsWorld[C];p.annotationUID=d;const D=this.getStyle("lineWidth",p,u),b=this.getStyle("lineDash",p,u),I=this.getStyle("color",p,u),O=this.getStyle("shadow",p,u),M=[_,E].map(B=>s.worldToCanvas(B)),R=`${d}-line`,A=`${C}`;Yt(i,d,A,M[0],M[1],{color:I,width:D,lineDash:b,shadow:O},R)}return a=!0,a},this.initializeViewportData=(n,i)=>(n.set(i,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),n.get(i)),this.isPerpendicular=(n,i)=>{const o=ft(n,i);return Math.abs(o)<S4}}isParallel(e,r){return Math.abs(ft(e,r))>1-S4}getImageIdNormal(e){const{imageOrientationPatient:r}=ut("imagePlaneModule",e),n=mt(r[0],r[1],r[2]),i=mt(r[3],r[4],r[5]);return nn(Ie(),n,i)}}dL.toolName="OverlayGrid";class hL extends As{constructor(e={},r={configuration:{opacity:.5}}){super(e,r),this._init=()=>{const n=Kr(this.toolGroupId).viewportsInfo;if(!n?.length){console.warn(this.getToolName()+"Tool: No viewports found");return}const i=Bn(n[0].renderingEngineId)?.getViewport(n[0].viewportId);if(!i)return;const o=i.getFrameOfReferenceUID();if(!$t(this.getToolName(),o)?.length){const s=new Map;jpe(s,n);const c={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:o,referencedImageId:null},data:{actorsWorldPointsMap:s}};Ft(c,o)}Me(n.map(({viewportId:s})=>s))},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=n=>{this._init()},this.renderAnnotation=(n,i)=>{const{viewport:o,FrameOfReferenceUID:a}=n;let s=!1;const c=$t(this.getToolName(),a);if(!c?.length)return s;const l=c[0],{annotationUID:f}=l,u=l.data.actorsWorldPointsMap;gL(u,o);const d=o.getActors(),h=pL(o);return d.forEach(g=>{if(!g?.clippingFilter)return;const p=u.get(g.uid);if(!p||!p.get(h))return;let m=1;const{worldPointsSet:w,color:v}=p.get(h);for(let y=0;y<w.length;y++){const x=w[y].map(_=>o.worldToCanvas(_)),T={color:v,fillColor:v,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},S=g.uid+"#"+m;yc(i,f,S,x,T),m++}}),s=!0,s}}}function jpe(t,e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const i=Bn(n)?.getViewport(r);gL(t,i)})}function gL(t,e){const r=e.getActors(),n=pL(e);r.forEach(i=>{if(!i?.clippingFilter)return;let o=t.get(i.uid);if(o||(o=new Map,t.set(i.uid,o)),!o.get(n)){const a=i.clippingFilter.getOutputData(),s=VA(a);if(!s)return;const c=i.actor.getProperty().getColor(),l=Hpe(c);o.set(n,{worldPointsSet:s,color:l})}})}function pL(t){const{viewPlaneNormal:e}=t.getCamera(),r=t.getCurrentImageIdIndex();return`${t.id}-${GR(e)}-${r}`}function Hpe(t){function e(r){let n=Math.floor(r*255).toString(16);return n.length===1&&(n="0"+n),n}return"#"+e(t[0])+e(t[1])+e(t[2])}hL.toolName="SegmentationIntersection";class mL extends As{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}){super(e,r),this.isDrawing=!1,this.isHandleOutsideImage=!1,this._elementWithCursor=null,this._currentCursorWorldPosition=null,this._currentCanvasPosition=null,this._disableCursorEnabled=!1,this.mouseMoveCallback=n=>{const{detail:i}=n,{element:o,currentPoints:a}=i;this._currentCursorWorldPosition=a.world,this._currentCanvasPosition=a.canvas,this._elementWithCursor=o;const s=this.getActiveAnnotation(o);return s===null?(this.createInitialAnnotation(a.world,o),!1):(this.updateAnnotationPosition(o,s),!1)},this.createInitialAnnotation=(n,i)=>{const o=Ce(i);if(!o)throw new Error("No enabled element found");const{viewport:a,renderingEngine:s}=o;this.isDrawing=!0;const c=a.getCamera(),{viewPlaneNormal:l,viewUp:f}=c;if(!l||!f)throw new Error("Camera not found");const u=this.getReferencedImageId(a,n,l,f),d=a.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...f],FrameOfReferenceUID:d,referencedImageId:u},data:{label:"",handles:{points:[[...n]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if($t(this.getToolName(),i).length>0)return null;if(Ft(h,i)===null)return;const m=vt(i,this.getToolName(),!1);Me(m)},this.onCameraModified=n=>{const i=n.detail,{element:o,previousCamera:a,camera:s}=i,l=Ce(o).viewport;if(o!==this._elementWithCursor)return;const f=a.focalPoint,u=s.viewPlaneNormal,d=s.focalPoint,h=[0,0,0];if(pt.subtract(d,f,h),h.reduce((m,w)=>m+w,0)===0)return;const g=pt.dot(h,u);if(Math.abs(g)<.01||!this._currentCanvasPosition)return;const p=l.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=p,this.updateAnnotationPosition(o,this.getActiveAnnotation(o))},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a,FrameOfReferenceUID:s}=n,c=this._elementWithCursor===a.element;this.configuration.positionSync&&!c&&this.updateViewportImage(a);const{element:l}=a;let f=$t(this.getToolName(),l);if(!f?.length||(f=this.filterInteractableAnnotationsForElement(l,f),!f?.length))return o;const u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<f.length;d++){const h=f[d],{annotationUID:g,data:p}=h,{handles:m}=p,{points:w}=m;if(!g)return o;u.annotationUID=g;const v=parseFloat(this.getStyle("lineWidth",u,h)),y=v,C=this.getStyle("lineDash",u,h),x=this.getStyle("color",u,h);if(w[0].some(I=>isNaN(I)))return o;const T=w.map(I=>a.worldToCanvas(I));if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(g))continue;const S={upper:"upper",right:"right",lower:"lower",left:"left"},[_,E]=T[0],D=c?20:7,b=c?5:7;Yt(i,g,S.upper,[_,E-(D/2+b)],[_,E-D/2],{color:x,lineDash:C,lineWidth:y}),Yt(i,g,S.lower,[_,E+(D/2+b)],[_,E+D/2],{color:x,lineDash:C,lineWidth:y}),Yt(i,g,S.right,[_+(D/2+b),E],[_+D/2,E],{color:x,lineDash:C,lineWidth:y}),Yt(i,g,S.left,[_-(D/2+b),E],[_-D/2,E],{color:x,lineDash:C,lineWidth:y}),o=!0}return o},this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const e=Kr(this.toolGroupId).viewportsInfo;if(!e)return;e.map(n=>Ln(n.viewportId,n.renderingEngineId)).forEach(n=>{n&&St(n.viewport.element)})}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const e=Kr(this.toolGroupId).viewportsInfo;if(!e)return;e.map(n=>Ln(n.viewportId,n.renderingEngineId)).forEach(n=>{n&&Vt(n.viewport.element)})}getActiveAnnotation(e){const r=$t(this.getToolName(),e);return r.length?r[0]:null}updateAnnotationPosition(e,r){const n=this._currentCursorWorldPosition;if(!n||!r.data?.handles?.points)return;r.data.handles.points=[[...n]],r.invalidated=!0;const i=vt(e,this.getToolName(),!1);Ce(e)&&Me(i)}filterInteractableAnnotationsForElement(e,r){if(!(r instanceof Array)||r.length===0)return[];const n=r[0],i=Ce(e)?.viewport;if(!i)return[];const o=i.getCamera(),{viewPlaneNormal:a,focalPoint:s}=o;if(!a||!s)return[];const c=n.data?.handles?.points;if(!(c instanceof Array)||c.length!==1)return[];const l=c[0],f=ps(a,s);return _h(f,l)<this.configuration.displayThreshold?[n]:[]}updateViewportImage(e){const r=this._currentCursorWorldPosition;if(!(!r||r.some(n=>isNaN(n)))){if(e instanceof qn){const n=ax(r,e);if(n===null)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof zn){const{focalPoint:n,viewPlaneNormal:i}=e.getCamera();if(!n||!i)return;const o=ps(i,n),a=_h(o,r,!0);if(Math.abs(a)<.5)return;const s=At(Ie(),mt(...i)),c=Jn(Ie(),s,a),l=nr(Ie(),mt(...n),c);{e.setCamera({focalPoint:l});const f=e.getRenderingEngine();f&&f.renderViewport(e.id)}}}}}mL.toolName="ReferenceCursors";const _4=[];class vL extends As{constructor(e={},r={configuration:{viewportId:"",scaleLocation:"bottom"}}){super(e,r),this.editData=null,this._init=()=>{const i=Bi()[0];if(!i)return;const o=Kr(this.toolGroupId).viewportsInfo;if(!o)return;const a=o.map(g=>Ln(g.viewportId,g.renderingEngineId));let{viewport:s}=a[0];const{FrameOfReferenceUID:c}=a[0];if(this.configuration.viewportId&&a.forEach(g=>{g.viewport.id==this.configuration.viewportId&&(s=g.viewport)}),!s)return;const{viewUp:l,viewPlaneNormal:f}=s.getCamera(),u=zm(s);let d=this.editData?.annotation;const h=$t(this.getToolName(),s.element);h.length&&(d=h.filter(g=>g.data?.viewportId==s.id)[0]),a.forEach(g=>{const{viewport:p}=g;if(!_4.includes(p.id)){const m={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...l],FrameOfReferenceUID:c,referencedImageId:null},data:{handles:{points:zm(p)},viewportId:p.id}};_4.push(p.id),Ft(m,p.element),d=m}}),this.editData?.annotation&&this.editData.annotation.data.viewportId==s.id&&(this.editData.annotation.data.handles.points=u,this.editData.annotation.data.viewportId=s.id),this.editData={viewport:s,renderingEngine:i,annotation:d}},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=n=>{this.configuration.viewportId=n.detail.viewportId,this._init()},this.computeScaleSize=(n,i,o)=>{const a=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let s;return o=="top"||o=="bottom"?s=a.filter(c=>c<n*.6&&c>n*.2):s=a.filter(c=>c<i*.6&&c>i*.2),s[0]},this.computeEndScaleTicks=(n,i)=>{const o={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]},a=[[n[1][0]+o[i][0][0],n[1][1]+o[i][0][0]],[n[1][0]+o[i][1][0],n[1][1]+o[i][1][1]]],s=[[n[0][0]+o[i][0][0],n[0][1]+o[i][0][0]],[n[0][0]+o[i][1][0],n[0][1]+o[i][1][1]]];return{endTick1:a,endTick2:s}},this.computeInnerScaleTicks=(n,i,o,a,s)=>{let c;i=="bottom"||i=="top"?c=s[0][0]-a[0][0]:(i=="left"||i=="right")&&(c=s[0][1]-a[0][1]);const l=[],f=[],u=[];let d=n;n>=50&&(d=n/10);const h=c/d;for(let g=0;g<d-1;g++){const p={bottom:[[h*(g+1),0],[h*(g+1),5]],top:[[h*(g+1),0],[h*(g+1),-5]],left:[[0,h*(g+1)],[-5,h*(g+1)]],right:[[0,h*(g+1)],[5,h*(g+1)]]};l.push(`${o}-tick${g}`),f.push(`tick${g}`),(g+1)%5==0?u.push([[a[0][0]+p[i][0][0],a[0][1]+p[i][0][1]],[a[1][0]+p[i][0][0],a[1][1]+p[i][0][1]]]):u.push([[a[0][0]+p[i][0][0],a[0][1]+p[i][0][1]],[a[1][0]+p[i][1][0],a[1][1]+p[i][1][1]]])}return{tickIds:l,tickUIDs:f,tickCoordinates:u}},this.computeWorldScaleCoordinates=(n,i,o)=>{let a,s=qt(Ie(),o[0],o[1]);s=At(Ie(),s);let c=qt(Ie(),o[2],o[0]);c=At(Ie(),c);const l={bottom:[o[1],o[2]],top:[o[0],o[3]],right:[o[2],o[3]],left:[o[0],o[1]]},f=nr(Ie(),l[i][0],l[i][0]).map(d=>d/2),u=n/2/Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2));return i=="top"||i=="bottom"?a=[qt(Ie(),f,c.map(d=>d*u)),nr(Ie(),f,c.map(d=>d*u))]:(i=="left"||i=="right")&&(a=[nr(Ie(),f,s.map(d=>d*u)),qt(Ie(),f,s.map(d=>d*u))]),a},this.computeCanvasScaleCoordinates=(n,i,o,a,s)=>{let c;if(s=="top"||s=="bottom"){const l=i[0][0]-i[1][0];c=[[n.width/2-l/2,o.height],[n.width/2+l/2,o.height]]}else if(s=="left"||s=="right"){const l=i[0][1]-i[1][1];c=[[a.width,n.height/2-l/2],[a.width,n.height/2+l/2]]}return c},this.computeScaleBounds=(n,i,o,a)=>{const s=i*Math.min(1e3,n.width),c=o*Math.min(1e3,n.height),l={bottom:[-c,-s],top:[c,s],left:[c,s],right:[-c,-s]},f={bottom:[n.height,n.width],top:[0,n.width],left:[n.height,0],right:[n.height,n.width]};return{height:f[a][0]+l[a][0],width:f[a][1]+l[a][1]}}}renderAnnotation(e,r){if(!this.editData||!this.editData.viewport)return;const n=this.configuration.scaleLocation,{viewport:i}=e,a=$t(this.getToolName(),i.element).filter(de=>de.data?.viewportId==i.id)[0],s=e.viewport.canvas,c=!1;if(!i||!a)return c;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},f={width:s.width/window.devicePixelRatio||1,height:s.height/window.devicePixelRatio||1},u=a.data.handles.points[0],d=a.data.handles.points[1],h=a.data.handles.points[2],g=a.data.handles.points[3],p=[u,h,d,g],m=Nr(h,g),w=Nr(u,h),v=this.computeScaleBounds(f,.05,.05,n),y=this.computeScaleBounds(f,.05,.05,n),C=this.computeScaleSize(m,w,n),x=this.computeWorldScaleCoordinates(C,n,p).map(de=>i.worldToCanvas(de)),T=this.computeCanvasScaleCoordinates(f,x,y,v,n),S=this.computeEndScaleTicks(T,n),{annotationUID:_}=a;l.annotationUID=_;const E=this.getStyle("lineWidth",l,a),D=this.getStyle("lineDash",l,a),b=this.getStyle("color",l,a),I=this.getStyle("shadow",l,a),O=`${_}-scaleline`;Yt(r,_,"1",T[0],T[1],{color:b,width:E,lineDash:D,shadow:I},O);const R=`${_}-left`;Yt(r,_,"2",S.endTick1[0],S.endTick1[1],{color:b,width:E,lineDash:D,shadow:I},R);const B=`${_}-right`;Yt(r,_,"3",S.endTick2[0],S.endTick2[1],{color:b,width:E,lineDash:D,shadow:I},B);const L={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},F=[T[0][0]+L[n][0],T[0][1]+L[n][1]],j=this._getTextLines(C),{tickIds:J,tickUIDs:ie,tickCoordinates:fe}=this.computeInnerScaleTicks(C,n,_,S.endTick1,S.endTick2);for(let de=0;de<ie.length;de++)Yt(r,_,ie[de],fe[de][0],fe[de][1],{color:b,width:E,lineDash:D,shadow:I},J[de]);return Dc(r,_,"text0",j,[F[0],F[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:b}),c}_getTextLines(e){let r,n;return e>=50?(r=e/10,n=" cm"):(r=e,n=" mm"),[r.toString().concat(n)]}}vL.toolName="ScaleOverlay";const yL=(t,e,r)=>{if(!e?.data?.contour?.polyline?.length)return;const{polyline:n}=e.data.contour,{length:i}=n;let o=1/0;for(let a=0;a<i;a++){const s=t.worldToCanvas(n[a]),c=Os(s,r);o=Math.min(o,c)}if(!(o===1/0||isNaN(o)))return o},Q3=class Q3{constructor(){this.toolInfo={toolSize:null,radius:null,maxToolSize:null}}renderShape(e,r,n){Si(e,"SculptorTool","0",r,this.toolInfo.toolSize,n)}configureToolSize(e){const r=this.toolInfo;if(r.toolSize&&r.maxToolSize)return;const i=e.detail.element,a=Math.min(i.clientWidth,i.clientHeight)/24;r.toolSize=a,r.radius=null,r.maxToolSize=a}updateToolSize(e,r,n){const i=this.toolInfo,o=yL(r,n,e);o>0&&(i.toolSize=Math.min(i.maxToolSize,o),this.computeWorldRadius(r,!0))}getMaxSpacing(e){return Math.max(this.toolInfo.toolSize/4,e)}computeWorldRadius(e,r=!1){if(!this.toolInfo.radius||r){const n=e.canvasToWorld([0,0]),i=e.canvasToWorld([this.toolInfo.toolSize,0]);this.toolInfo.radius=_r(an(Ie(),n,i))}return this.toolInfo.radius}getEdge(e,r,n,i){const o=nr(Ie(),r,n||r);Jn(o,o,.5);const a=e.worldToCanvas(o),s=Mo(xt(),a,i),c=Math.atan2(s[1],s[0]),l=this.interpolatePoint(e,c,i),f=e.worldToCanvas(l);return{point:l,angle:c,canvasPoint:f}}interpolatePoint(e,r,n){const[i,o]=n,a=this.toolInfo.toolSize,s=Math.cos(r)*a,c=Math.sin(r)*a,l=[i+s,o+c];return e.canvasToWorld(l)}isInCursor(e,r){return Nr(e,r)<this.toolInfo.radius}};Q3.shapeName="Circle";let Jd=Q3;const{isEqual:Kpe}=gn;class wL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}){super(e,r),this.registeredShapes=new Map,this.isActive=!1,this.commonData={activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0,external:!0,closed:!1},this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i;if(this.configureToolSize(n),this.selectFreehandTool(i),this.commonData.activeAnnotationUID!==null)return this.isActive=!0,St(o),this.activateModify(o),!0},this.mouseMoveCallback=n=>{this.mode===_n.Active?(this.configureToolSize(n),this.updateCursor(n)):this.commonData.canvasLocation=void 0},this.endCallback=n=>{const i=n.detail,{element:o}=i;this.isActive=!1,this.deactivateModify(o),Vt(o);const a=this.getToolInstance(o);a.doneEditMemo?.();const c=this.filterSculptableAnnotationsForElement(o).find(l=>l.annotationUID===this.commonData.activeAnnotationUID);a.configuration.calculateStats&&(c.invalidated=!0),Gt(c,o,Nt.HandlesUpdated)},this.dragCallback=n=>{const i=n.detail,o=i.element;this.updateCursor(n);const a=this.filterSculptableAnnotationsForElement(o),s=a.find(l=>l.annotationUID===this.commonData.activeAnnotationUID);if(!a?.length||!this.isActive)return;const c=s.data.contour.polyline;this.sculpt(i,c)},this.registerShapes(Jd.shapeName,Jd),this.setToolShape(this.configuration.toolShape)}registerShapes(e,r){const n=new r;this.registeredShapes.set(e,n)}sculpt(e,r){const n=this.configuration,i=e.element,o=Ce(i),{viewport:a}=o,s=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:e.currentPoints.world,mouseCanvasPoint:e.currentPoints.canvas,points:r,maxSpacing:s.getMaxSpacing(n.minSpacing),element:i,contours:[{annotationUID:this.commonData.activeAnnotationUID,points:r}]};const c=this.intersect(a,s);if(!c.length)return;const l=this.getContourSelections(c,r.length),{closed:f}=this.commonData;for(const u of l){const d=new Array,h=u[u.length-1];let g=f?h.relIndex:0,p;for(const m of u)m.isEnter?(Ty(d,r,g,m.index),p=m):this.interpolatePoints(a,p,m,r,d),g=m.index;if(l.length>1&&oa(d.map(a.worldToCanvas))<0){console.warn("Skipping internal area");continue}!f&&g<r.length-1&&Ty(d,r,g),r.splice(0,r.length),Ty(r,d);return}}intersect(e,r){const{contours:n,mousePoint:i,mouseCanvasPoint:o}=this.sculptData,{closed:a}=this.commonData;r.computeWorldRadius(e);const s=new Array;for(const c of n){const{annotationUID:l,points:f}=c;let u=!1;const{length:d}=f;for(let h=0;h<=d;h++){const g=h%d,p=f[g],m=r.isInCursor(p,i);if(h===0){if(u=m,!a&&m){const v=r.getEdge(e,p,null,o);s.push({annotationUID:l,isEnter:m,index:h,point:v.point,angle:v.angle})}continue}if(g===0&&!a){if(u){const v=r.getEdge(e,f[d-1],null,o);s.push({annotationUID:l,isEnter:!1,index:d-1,point:v.point,angle:v.angle})}continue}if(u===m)continue;u=m;const w=r.getEdge(e,p,f[h-1],o);s.push({annotationUID:l,isEnter:m,index:h,point:w.point,angle:w.angle})}}return s}interpolatePoints(e,r,n,i,o){const{external:a,closed:s}=this.commonData,c=i[r.index%i.length],l=i[n.index%i.length],f=an(Ie(),l,c);if(Kpe(_r(f),0))return;const u=this.registeredShapes.get(this.selectedShape),d=(r.angle+2*Math.PI)%(Math.PI*2),h=(n.angle+2*Math.PI)%(Math.PI*2);let g=h<d?h+2*Math.PI:h;const p=h>d?h-2*Math.PI:h;(a&&!s&&Math.abs(p-d)<Math.abs(g-d)||a&&s)&&(g=p);const m=Math.ceil(Math.abs(d-g)/.25);for(let w=0;w<=m;w++){const v=(d*(m-w)+w*g)/m;o.push(u.interpolatePoint(e,v,this.sculptData.mouseCanvasPoint))}}getContourSelections(e,r){const n=new Array,i=e.length/2;if(!i||e.length%2)return n;let o=Number.NEGATIVE_INFINITY;for(let a=0;a<i;a++){const s=this.findNext(e,o);if(!s){console.error("Couldnt' find an entry");continue}const c=this.findNext(e,s.angle,!1);if(!c){console.error("Couldn't find an exit for",s);continue}c.relIndex||=c.index<s.index?c.index+r:c.index,n.push([s,c])}n.sort((a,s)=>a[0].index-s[0].index);for(let a=0;a<n.length-1;){const s=n[a],c=this.findMergeable(n,s,a);c?s.push(...c):a++}return n.length>1&&console.warn("************* More than 1 result",n),n}findMergeable(e,r,n){const i=r[r.length-1];for(let o=n+1;o<e.length;o++){const[a]=e[o];if(a.index>=i.relIndex){const s=e[o];return e.splice(o,1),s}}}findNext(e,r,n=!0){if(e.length===1){const[s]=e;return e.splice(0,1),s}let i,o;for(let s=0;s<e.length;s++){const c=e[s];if(c.isEnter==n){const l=(c.angle-r+2*Math.PI)%(2*Math.PI);(!i||l<o)&&(i={i:s,intersection:c},o=l)}}if(!i){console.warn("Couldn't find an exit point for entry",JSON.stringify(e));return}e.splice(i.i,1);const{intersection:a}=i;return a}interpolatePointsWithinMaxSpacing(e,r,n,i){const{element:o}=this.sculptData,a=Ce(o),{viewport:s}=a,c=Xpe(e+1,r.length),l=s.worldToCanvas(r[e]),f=s.worldToCanvas(r[c]);Os(l,f)>i&&n.push(e)}updateCursor(e){const r=e.detail,n=r.element,i=Ce(n),{viewport:o}=i;this.commonData.viewportIdsToRender=[o.id];const a=this.filterSculptableAnnotationsForElement(n);if(!a?.length)return;const s=a.find(c=>c.annotationUID===this.commonData.activeAnnotationUID);if(this.commonData.canvasLocation=r.currentPoints.canvas,this.isActive)s.highlighted=!0;else{const c=this.registeredShapes.get(this.selectedShape),l=r.currentPoints.canvas;c.updateToolSize(l,o,s)}Me(this.commonData.viewportIdsToRender)}getToolInstance(e){const r=Ce(e),{renderingEngineId:n,viewportId:i}=r;return lr(i,n).getToolInstance(this.configuration.referencedToolName)}filterSculptableAnnotationsForElement(e){const{configuration:r}=this,n=[],i=this.getToolInstance(e);return r.referencedToolNames.forEach(o=>{const a=$t(o,e);a&&n.push(...a)}),i.filterInteractableAnnotationsForElement(e,n)}configureToolSize(e){this.registeredShapes.get(this.selectedShape).configureToolSize(e)}selectFreehandTool(e){const r=this.getClosestFreehandToolOnElement(e);if(r===void 0)return;const n=vn(r);if(this.commonData.activeAnnotationUID=r,this.commonData.closed=n.data.contour.closed,this.commonData.external=!0,this.commonData.closed){const{element:i}=e,o=Ce(i),{viewport:a}=o,s=n.data.contour.polyline.map(l=>a.worldToCanvas(l)),c=e.currentPoints.canvas;this.commonData.external=!Fi(s,c,{closed:!0})}}getClosestFreehandToolOnElement(e){const{element:r}=e,n=Ce(r),{viewport:i}=n,o=this.configuration,a=this.filterSculptableAnnotationsForElement(r);if(!a?.length)return;const s=e.currentPoints.canvas,c={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let l=0;l<a?.length;l++){if(a[l].isLocked||!a[l].isVisible)continue;const f=yL(i,a[l],s);f!==-1&&f<c.distance&&(c.distance=f,c.toolIndex=l,c.annotationUID=a[l].annotationUID)}return this.commonData.isEditingOpenContour=!a[c.toolIndex].data.contour.closed,o.referencedToolName=a[c.toolIndex].metadata.toolName,c.annotationUID}activateModify(e){const r=vn(this.commonData.activeAnnotationUID);this.getToolInstance(e).createMemo?.(e,r),e.addEventListener(V.MOUSE_UP,this.endCallback),e.addEventListener(V.MOUSE_CLICK,this.endCallback),e.addEventListener(V.MOUSE_DRAG,this.dragCallback),e.addEventListener(V.TOUCH_TAP,this.endCallback),e.addEventListener(V.TOUCH_END,this.endCallback),e.addEventListener(V.TOUCH_DRAG,this.dragCallback)}deactivateModify(e){e.removeEventListener(V.MOUSE_UP,this.endCallback),e.removeEventListener(V.MOUSE_CLICK,this.endCallback),e.removeEventListener(V.MOUSE_DRAG,this.dragCallback),e.removeEventListener(V.TOUCH_TAP,this.endCallback),e.removeEventListener(V.TOUCH_END,this.endCallback),e.removeEventListener(V.TOUCH_DRAG,this.dragCallback)}setToolShape(e){this.selectedShape=this.registeredShapes.get(e)??Jd.shapeName}renderAnnotation(e,r){const{viewport:n}=e,{element:i}=n,o=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==_n.Active||!o.includes(n.id)||!this.filterSculptableAnnotationsForElement(i)?.length)return;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};let c=Gi("color",s,_a.Default,this.mode);this.isActive&&(c=Gi("color",s,_a.Highlighted,this.mode)),this.registeredShapes.get(this.selectedShape).renderShape(r,this.commonData.canvasLocation,{color:c})}}function Ty(t,e,r=0,n=e.length){n<r&&(n=n+e.length);for(let i=r;i<n;i++)t.push(e[i%e.length])}const Xpe=(t,e)=>(t+e)%e;wL.toolName="SculptorTool";const qpe={Z:[0,0,1]};class CL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:qpe.Z,rotateIncrementDegrees:30}}){super(e,r)}mouseWheelCallback(e){const{element:r,wheel:n}=e.detail,i=Ce(r),{viewport:o}=i,{direction:a,rotateIncrementDegrees:s}=this.configuration,c=o.getCamera(),{viewUp:l,position:f,focalPoint:u}=c,{direction:d}=n,[h,g,p]=u,[m,w,v]=a,y=d*(s*Math.PI)/180,C=[0,0,0],x=[0,0,0],T=[0,0,0],S=_t(new Float32Array(16));Gn(S,S,[h,g,p]),ci(S,S,y,[m,w,v]),Gn(S,S,[-h,-g,-p]),Pt(C,f,S),Pt(x,u,S),_t(S),ci(S,S,y,[m,w,v]),Pt(T,l,S),o.setCamera({position:C,viewUp:T,focalPoint:x}),o.render()}}CL.toolName="VolumeRotateMouseWheel";const lh=class lh extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:Ype,changeTextCallback:Jpe,preventHandleOutsideImage:!1}}){super(e,r),this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{annotationUID:l}=i,f=i.data.handles.points[0],u=c.worldToCanvas(f);if(Xn(o,u)<a)return!0;const h=n.querySelector("svg");if(!h)return!1;const g=h.querySelector(`g[data-annotation-uid="${l}"]`);if(!g)return!1;const p=g,m=p.getBBox(),w=p.getAttribute("transform");let v=0,y=0;if(w){const S=w.match(/translate\(([-\d.]+)\s+([-\d.]+)\)/);S&&(v=parseFloat(S[1]),y=parseFloat(S[2]))}const C=m.x+v,x=m.y+y;return o[0]>=C&&o[0]<=C+m.width&&o[1]>=x&&o[1]<=x+m.height},this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,newAnnotation:!0,viewportIdsToRender:l,offset:[0,0,0]},n.preventDefault(),Me(l),this.configuration.getTextCallback(f=>{if(!f){kt(c.annotationUID),Me(l),this.isDrawing=!1;return}Vt(a),c.data.label=f,En(c),Me(l)}),this.createMemo(a,c,{newAnnotation:!0}),c},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a,currentPoints:s}=o;i.highlighted=!0;const c=vt(a,this.getToolName());let l=[0,0,0];if(s&&s.world){const f=s.world,u=i.data.handles.points[0];l=[u[0]-f[0],u[1]-f[1],u[2]-f[2]]}this.editData={annotation:i,viewportIdsToRender:c,offset:l},this._activateModify(a),St(a),Me(c),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData;this._deactivateDraw(o),this._deactivateModify(o),Vt(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a)},this._dragCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,offset:f}=this.editData;f?c.data.handles.points[0]=[s[0]+f[0],s[1]+f[1],s[2]+f[2]]:c.data.handles.points[0]=[...s],c.invalidated=!0,Me(l),Gt(c,a,Nt.LabelChange)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length)return o;c=this.filterInteractableAnnotationsForElement(s,c);const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,g=h.handles.points[0];l.annotationUID=d;const p=a.worldToCanvas(g);if(o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(d)||!h.label)continue;const m=this.getLinkedTextBoxStyle(l,u);Dc(i,d,"1",[h.label],p,{...m,padding:0})}return o}}handleSelectedCallback(e,r,n,i){}_doneChangingTextCallback(e,r,n){r.data.label=n;const i=vt(e,this.getToolName());Me(i),Gt(r,e)}_isInsideVolume(e,r,n){return Or(e,n)&&Or(r,n)}};lh.toolName="Label",lh.hydrate=(e,r,n,i)=>{const o=xn(e);if(!o)return;const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:c,viewUp:l}=a.getCamera(),f=new lh,u=f.getReferencedImageId(a,r,c,l),d={annotationUID:i?.annotationUID||un(),data:{label:n,handles:{points:[r]}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:f.getToolName(),viewPlaneNormal:c,FrameOfReferenceUID:s,referencedImageId:u,...i}};Ft(d,a.element),Me([a.id])};let T1=lh;function Ype(t){return t(prompt("Enter your annotation:"))}function Jpe(t,e,r){return r(prompt("Enter your annotation:"))}T1.toolName="Label";const fl=class fl extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Zpe,actions:{undo:{method:"undo",bindings:[{key:"z"}]},redo:{method:"redo",bindings:[{key:"y"}]}}}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ir([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&En(a),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:f}),l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:d}=i,h=d.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:v,lineWidth:y,lineDash:C,shadow:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),T=m.map(F=>a.worldToCanvas(F));if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let S;if(!mr(g))continue;!pr(g)&&!this.editData&&w!==null&&(S=[T[w]]);const _=!!Gi("showHandlesAlways",{});(S||_)&&Wn(i,g,"0",T,{color:v,lineDash:C,lineWidth:y});const E=`${g}-line`;if(Yt(i,g,"1",T[0],T[1],{color:v,width:y,lineDash:C,shadow:x},E),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const b=this.getLinkedTextBoxStyle(u,h);if(!b.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const I=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const F=po(T);p.handles.textBox.worldPosition=a.canvasToWorld(F)}const O=a.worldToCanvas(p.handles.textBox.worldPosition),R=Ei(i,g,"1",I,O,T,{},b),{x:A,y:B,width:k,height:L}=R;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([A,B]),topRight:a.canvasToWorld([A+k,B]),bottomLeft:a.canvasToWorld([A,B+L]),bottomRight:a.canvasToWorld([A+k,B+L])}}return o},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o),Me(l),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport,{cachedStats:a}=i,s=Object.keys(a);for(let l=0;l<s.length;l++){const f=s[l],u=this.getTargetImageData(f);if(!u)continue;const{imageData:d,dimensions:h}=u,g=i.handles.points.map(y=>d.worldToIndex(y)),p=Fo(u,g),{unit:m}=p,w=fl.calculateLengthInIndex(p,g);this.isHandleOutsideImage=!fl.isInsideVolume(h,g);const v={name:"length",value:w,unit:m,type:ra.Linear};a[f]={length:w,unit:m,statsArray:[v]}}const c=e.invalidated;return e.invalidated=!1,c&&Gt(e,o,Nt.StatsUpdated),a}};fl.toolName="Length",fl.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=fl.hydrateBase(fl,i,r,n),{toolInstance:f,...u}=n||{},d={annotationUID:n?.annotationUID||un(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(d,l.element),Me([l.id])};let rw=fl;function Zpe(t,e){const r=t.cachedStats[e],{length:n,unit:i}=r;return n==null||isNaN(n)?void 0:[`${Ht(n)} ${i}`]}const{transformWorldToIndex:E4}=gn,eT=class eT extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Qpe}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ir([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a),Ce(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const u=Ce(o),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&En(a),this.editData=null,this.isDrawing=!1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:f}),l){const{deltaPoints:g}=i,p=g.world,{textBox:m}=u.handles,{worldPosition:w}=m;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],m.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;u.handles.points.forEach(w=>{w[0]+=p[0],w[1]+=p[1],w[2]+=p[2]}),a.invalidated=!0}else{const{currentPoints:g}=i,p=g.world;u.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0;const d=Ce(o),{renderingEngine:h}=d;Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Ce(n),Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:v,lineWidth:y,lineDash:C,shadow:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),T=m.map(L=>a.worldToCanvas(L));let S;if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!mr(g))continue;!pr(g)&&!this.editData&&w!==null&&(S=[T[w]]);const _=!!Gi("showHandlesAlways",{});if((S||_)&&Wn(i,g,"0",T,{color:v,lineDash:C,lineWidth:y}),zO(i,g,"0",T[0],T[1],{color:v,width:y,lineDash:C}),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const D=this.getLinkedTextBoxStyle(u,h);if(!D.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const b=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const L=po(T);p.handles.textBox.worldPosition=a.canvasToWorld(L)}const I=a.worldToCanvas(p.handles.textBox.worldPosition),M=Ei(i,g,"1",b,I,T,{},D),{x:R,y:A,width:B,height:k}=M;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([R,A]),topRight:a.canvasToWorld([R+B,A]),bottomLeft:a.canvasToWorld([R,A+k]),bottomRight:a.canvasToWorld([R+B,A+k])}}return o},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(d=>d===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o);const f=Ce(o),{renderingEngine:u}=f;Me(l),e.preventDefault()}_calculateHeight(e,r){const n=r[0]-e[0],i=r[1]-e[1],o=r[2]-e[2];if(n==0)return i!=0?Math.abs(o):0;if(i==0)return Math.abs(o);if(o==0)return Math.abs(i)}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport,a=i.handles.points[0],s=i.handles.points[1],{cachedStats:c}=i,l=Object.keys(c);for(let u=0;u<l.length;u++){const d=l[u],h=this.getTargetImageData(d);if(!h)continue;const{imageData:g,dimensions:p}=h,m=E4(g,a),w=E4(g,s),v=[m,w],{scale:y,unit:C}=Fo(h,v),x=this._calculateHeight(a,s)/y,T=this._isInsideVolume(m,w,p);this.isHandleOutsideImage=T,c[d]={height:x,unit:C}}const f=e.invalidated;return e.invalidated=!1,f&&Gt(e,o,Nt.StatsUpdated),c}_isInsideVolume(e,r,n){return Or(e,n)&&Or(r,n)}};eT.toolName="Height";let iw=eT;function Qpe(t,e){const r=t.cachedStats[e],{height:n,unit:i}=r;return n==null||isNaN(n)?void 0:[`${Ht(n)} ${i}`]}const{transformWorldToIndex:eme}=gn,dl=class dl extends $n{constructor(e={},r){super(e,$n.mergeDefaultProps(dl.probeDefaults,r)),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const f=this.constructor.createAnnotationForViewport(l,{data:{handles:{points:[[...s]]}}});Ft(f,a);const u=vt(a,this.getToolName());return this.editData={annotation:f,newAnnotation:!0,viewportIdsToRender:u},this._activateModify(a),St(a),n.preventDefault(),Me(u),f},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{viewportId:l,renderingEngine:f}=Ce(o);this.eventDispatchDetail={viewportId:l,renderingEngineId:f.id},this._deactivateModify(o),Vt(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,newAnnotation:f}=this.editData,{data:u}=c;this.createMemo(a,c,{newAnnotation:f}),u.handles.points[0]=[...s],c.invalidated=!0,Me(l)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],g=h.annotationUID,p=h.data,m=p.handles.points[0],w=a.worldToCanvas(m);u.annotationUID=g;const{color:v,lineWidth:y}=this.getAnnotationStyle({annotation:h,styleSpecifier:u});if(p.cachedStats||(p.cachedStats={}),!p.cachedStats[l]||p.cachedStats[l].value===null)p.cachedStats[l]={Modality:null,index:null,value:null},this._calculateCachedStats(h,f,n,Nt.StatsUpdated);else if(h.invalidated&&(this._calculateCachedStats(h,f,n),a instanceof zn)){const{referencedImageId:S}=h.metadata;for(const _ in p.cachedStats)_.startsWith("imageId")&&f.getStackViewports().find(b=>{const I=cr(S),O=b.hasImageURI(I),M=cr(b.getCurrentImageId());return O&&M!==I})&&delete p.cachedStats[_]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(g))continue;Wn(i,g,"0",[w],{color:v,lineWidth:y,handleRadius:this.configuration.handleRadius}),o=!0;const x=this.getLinkedTextBoxStyle(u,h);if(!x.visibility)continue;const T=this.configuration.getTextLines(p,l);if(T){const S=[w[0]+this.configuration.textCanvasOffset.x,w[1]+this.configuration.textCanvasOffset.y];Dc(i,g,"0",T,[S[0],S[1]],x)}}return o}}isPointNearTool(e,r,n,i){const o=Ce(e),{viewport:a}=o,{data:s}=r,c=s.handles.points[0],l=a.worldToCanvas(c);return Xn(n,l)<i}toolSelectedCallback(){}getHandleNearImagePoint(e,r,n,i){const o=Ce(e),{viewport:a}=o,{data:s}=r,c=s.handles.points[0],l=a.worldToCanvas(c);if(Xn(n,l)<i===!0)return c}handleSelectedCallback(e,r){const n=e.detail,{element:i}=n;r.highlighted=!0;const o=vt(i,this.getToolName());this.editData={annotation:r,viewportIdsToRender:o},this._activateModify(i),St(i),Me(o),e.preventDefault()}_calculateCachedStats(e,r,n,i=Nt.StatsUpdated){const o=e.data,{renderingEngineId:a,viewport:s}=n,{element:c}=s,l=o.handles.points[0],{cachedStats:f}=o,u=Object.keys(f);for(let h=0;h<u.length;h++){const g=u[h],p={isPreScaled:Pc(s,g),isSuvScaled:this.isSuvScaled(s,g,e.metadata.referencedImageId)},m=this.getTargetImageData(g);if(!m)continue;const{dimensions:w,imageData:v,metadata:y,voxelManager:C}=m,x=y.Modality;let T=eme(v,l);if(T=rU(T,T),Or(T,w)){this.isHandleOutsideImage=!1;let S=C.getAtIJKPoint(T);if(g.startsWith("imageId:")){const E=g.split("imageId:")[1],D=cr(E),I=$m(D)[0];T[2]=I.getCurrentImageIdIndex()}let _;if(x==="US"){const E=h1(m,[T]),D=E.values.every(b=>b!==null);S=D?E.values:S,_=D?E.units:"raw"}else _=Rc(x,e.metadata.referencedImageId,p);f[g]={index:T,value:S,Modality:x,modalityUnit:_},e.invalidated=!0}else this.isHandleOutsideImage=!0,f[g]={index:T,Modality:x}}const d=e.invalidated;return e.invalidated=!1,d&&Gt(e,c,i),f}};dl.toolName="Probe",dl.probeDefaults={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:tme,handleRadius:"6",textCanvasOffset:{x:6,y:-6}}},dl.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,viewUp:c,instance:l,viewport:f}=dl.hydrateBase(dl,i,r,n),{toolInstance:u,...d}=n||{},h={annotationUID:n?.annotationUID||un(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...d}};Ft(h,f.element),Me([f.id])};let S1=dl;function tme(t,e){const r=t.cachedStats[e],{index:n,value:i,modalityUnit:o}=r;if(i===void 0||!n)return;const a=[];if(a.push(`(${n[0]}, ${n[1]}, ${n[2]})`),i instanceof Array&&o instanceof Array)for(let s=0;s<i.length;s++)a.push(`${Ht(i[s])} ${o[s]}`);else a.push(`${Ht(i)} ${o}`);return a}const tT=class tT extends S1{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:nme}}){super(e,r),this.postMouseDownCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:g},data:{label:"",handles:{points:[[...s]]},cachedStats:{}}},m=vt(a,this.getToolName());return this.editData={annotation:p,newAnnotation:!0,viewportIdsToRender:m},this._activateModify(a),St(a),n.preventDefault(),Me(m),p},this.postTouchStartCallback=n=>this.postMouseDownCallback(n),this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;if(!this.editData||!this.filterInteractableAnnotationsForElement(a.element,[this.editData.annotation])?.length)return o;const c=this.getTargetId(a),l=a.getRenderingEngine(),f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=this.editData.annotation,d=u.annotationUID,h=u.data,g=h.handles.points[0],p=a.worldToCanvas(g);f.annotationUID=d;const{color:m}=this.getAnnotationStyle({annotation:u,styleSpecifier:f});if(!h.cachedStats[c]||h.cachedStats[c].value===null?(h.cachedStats[c]={Modality:null,index:null,value:null},this._calculateCachedStats(u,l,n)):u.invalidated&&this._calculateCachedStats(u,l,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;Wn(i,d,"0",[p],{color:m}),o=!0;const v=this.configuration.getTextLines(h,c);if(v){const y=[p[0]+6,p[1]-6];Dc(i,d,"0",v,[y[0],y[1]],this.getLinkedTextBoxStyle(f,u))}return o}}};tT.toolName="DragProbe";let ow=tT;function nme(t,e){const r=t.cachedStats[e],{index:n,value:i,modalityUnit:o}=r;if(i===void 0)return;const a=[];return a.push(`(${n[0]}, ${n[1]}, ${n[2]})`),a.push(`${i.toFixed(2)} ${o}`),a}const{transformWorldToIndex:b4}=gn,zf=class zf extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,calculateStats:!0,getTextLines:rme,statsCalculator:_s}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s],[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,centerWorld:s,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=f.map(_=>c.worldToCanvas(_)),[d,h,g,p]=u,m=Math.hypot(g[0]-p[0],g[1]-p[1]),w=Math.hypot(h[0]-d[0],h[1]-d[1]),v=Math.atan2(g[1]-p[1],g[0]-p[0]),y=[(g[0]+p[0])/2,(h[1]+d[1])/2],C={center:y,xRadius:(m-a)/2,yRadius:(w-a)/2,angle:v},x={center:y,xRadius:(m+a)/2,yRadius:(w+a)/2,angle:v},T=this._pointInEllipseCanvas(C,o);return!!(this._pointInEllipseCanvas(x,o)&&!T)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},St(a),this._activateModify(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f,u,d,h,g,p;if(o.worldPosition)l=!0;else{const{points:w}=c.handles,{viewport:v}=Ce(s),{worldToCanvas:y,canvasToWorld:C}=v;f=w.findIndex(T=>T===o);const x=w.map(y);p=x[f],h=Math.abs(x[2][0]-x[3][0]),g=Math.abs(x[0][1]-x[1][1]),u=[(x[2][0]+x[3][0])/2,(x[0][1]+x[1][1])/2],d=C(u)}const m=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:m,handleIndex:f,canvasWidth:h,canvasHeight:g,centerWorld:d,originalHandleCanvas:p,movingTextBox:l},this._activateModify(s),St(s),Me(m),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(this.doneEditMemo(),a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{viewport:l}=c,{canvasToWorld:f}=l,{annotation:u,viewportIdsToRender:d,centerWorld:h,newAnnotation:g}=this.editData;this.createMemo(o,u,{newAnnotation:g});const p=l.worldToCanvas(h),{data:m}=u,w=Math.abs(s[0]-p[0]),v=Math.abs(s[1]-p[1]),y=[p[0],p[1]-v],C=[p[0],p[1]+v],x=[p[0]-w,p[1]],T=[p[0]+w,p[1]];m.handles.points=[f(y),f(C),f(x),f(T)],u.invalidated=!0,this.editData.hasMoved=!0,Me(d),Gt(u,o,Nt.HandlesUpdated)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:g}=i,p=g.world,{textBox:m}=u.handles,{worldPosition:w}=m;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],m.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;u.handles.points.forEach(w=>{w[0]+=p[0],w[1]+=p[1],w[2]+=p[2]}),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;const d=Ce(o),{renderingEngine:h}=d;Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,{viewport:a}=Ce(o),{canvasToWorld:s,worldToCanvas:c}=a,{annotation:l,canvasWidth:f,canvasHeight:u,handleIndex:d,centerWorld:h,originalHandleCanvas:g}=this.editData,p=a.worldToCanvas(h),{data:m}=l,{points:w}=m.handles,{currentPoints:v}=i,y=v.canvas;if(d===0||d===1){const C=Math.abs(y[1]-p[1]),x=[p[0],p[1]-C],T=[p[0],p[1]+C];w[0]=s(x),w[1]=s(T);const S=y[0]-g[0],_=f/2+S,E=[p[0]-_,p[1]],D=[p[0]+_,p[1]];w[2]=s(E),w[3]=s(D)}else{const C=Math.abs(y[0]-p[0]),x=[p[0]-C,p[1]],T=[p[0]+C,p[1]];w[2]=s(x),w[3]=s(T);const S=y[1]-g[1],_=u/2+S,E=[p[0],p[1]-_],D=[p[0],p[1]+_];w[0]=s(E),w[1]=s(D)}},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{handles:m}=p,{points:w,activeHandleIndex:v}=m;u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),T=w.map(ie=>a.worldToCanvas(ie)),S=V5(T),{centerPointRadius:_}=this.configuration;if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(h,a,f);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,a,f,n),a instanceof zn)){const{referencedImageId:ie}=h.metadata;for(const fe in p.cachedStats)fe.startsWith("imageId")&&f.getStackViewports().find(we=>{const _e=cr(ie),Te=we.hasImageURI(_e),G=cr(we.getCurrentImageId());return Te&&G!==_e})&&delete p.cachedStats[fe]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let E;if(!mr(g))continue;!pr(g)&&!this.editData&&v!==null&&(E=[T[v]]);const D=!!Gi("showHandlesAlways",{});(E||D)&&Wn(i,g,"0",D?T:E,{color:y});const b=`${g}-ellipse`,I="0";if(jx(i,g,I,T,{color:y,lineDash:x,lineWidth:C},b),_>0&&Math.min(Math.abs(S[0][0]-S[1][0])/2,Math.abs(S[0][1]-S[1][1])/2)>3*_){const fe=this._getCanvasEllipseCenter(T);Si(i,g,`${I}-center`,fe,_,{color:y,lineDash:x,lineWidth:C})}o=!0;const O=this.getLinkedTextBoxStyle(u,h);if(!O.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const M=this.configuration.getTextLines(p,l);if(!M||M.length===0)continue;let R;p.handles.textBox.hasMoved||(R=po(S),p.handles.textBox.worldPosition=a.canvasToWorld(R));const A=a.worldToCanvas(p.handles.textBox.worldPosition),k=Ei(i,g,"1",M,A,T,{},O),{x:L,y:F,width:j,height:J}=k;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([L,F]),topRight:a.canvasToWorld([L+j,F]),bottomLeft:a.canvasToWorld([L,F+J]),bottomRight:a.canvasToWorld([L+j,F+J])}}return o},this._calculateCachedStats=(n,i,o)=>{if(!this.configuration.calculateStats)return;const a=n.data,{element:s}=i,{points:c}=a.handles,l=c.map(x=>i.worldToCanvas(x)),{viewPlaneNormal:f,viewUp:u}=i.getCamera(),[d,h]=V5(l),g=i.canvasToWorld(d),p=i.canvasToWorld(h),{cachedStats:m}=a,w=Object.keys(m),v=g,y=p;for(let x=0;x<w.length;x++){const T=w[x],S=this.getTargetImageData(T);if(!S)continue;const{dimensions:_,imageData:E,metadata:D,voxelManager:b}=S,I=b4(E,v);I[0]=Math.floor(I[0]),I[1]=Math.floor(I[1]),I[2]=Math.floor(I[2]);const O=b4(E,y);if(O[0]=Math.floor(O[0]),O[1]=Math.floor(O[1]),O[2]=Math.floor(O[2]),this._isInsideVolume(I,O,_)){const M=Math.min(I[0],O[0]),R=Math.max(I[0],O[0]),A=Math.min(I[1],O[1]),B=Math.max(I[1],O[1]),k=Math.min(I[2],O[2]),L=Math.max(I[2],O[2]),F=[[M,R],[A,B],[k,L]],j=[(g[0]+p[0])/2,(g[1]+p[1])/2,(g[2]+p[2])/2],J=Math.abs(g[0]-p[0])/2,ie=Math.abs(g[1]-p[1])/2,fe=Math.abs(g[2]-p[2])/2,ae={center:j,xRadius:J<vc/2?0:J,yRadius:ie<vc/2?0:ie,zRadius:fe<vc/2?0:fe},{worldWidth:de,worldHeight:we}=Ag(f,u,v,y),_e=de===0&&we===0,Te=[I,O],{scale:G,areaUnit:P}=Fo(S,Te),$=n3(S),W=Math.abs(Math.PI*(de/G/2)*(we/$/G/2)),q={isPreScaled:Pc(i,T),isSuvScaled:this.isSuvScaled(i,T,n.metadata.referencedImageId)},Q=Rc(D.Modality,n.metadata.referencedImageId,q);let ee;b&&(ee=b.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:De=>C2(ae,De,{fast:!0}),boundsIJK:F,imageData:E,returnPoints:this.configuration.storePointData}));const ge=this.configuration.statsCalculator.getStatistics();m[T]={Modality:D.Modality,area:W,mean:ge.mean?.value,max:ge.max?.value,min:ge.min?.value,stdDev:ge.stdDev?.value,statsArray:ge.array,pointsInShape:ee,isEmptyArea:_e,areaUnit:P,modalityUnit:Q}}else this.isHandleOutsideImage=!0,m[T]={Modality:D.Modality}}const C=n.invalidated;return n.invalidated=!1,C&&Gt(n,s,Nt.StatsUpdated),m},this._isInsideVolume=(n,i,o)=>Or(n,o)&&Or(i,o),this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(e,r){const{xRadius:n,yRadius:i,center:o,angle:a}=e,s=dU(xt(),r,o,-a);if(n<=0||i<=0)return!1;const c=[s[0]-o[0],s[1]-o[1]];return c[0]*c[0]/(n*n)+c[1]*c[1]/(i*i)<=1}_getCanvasEllipseCenter(e){const[r,n,i,o]=e,a=[i[0],n[1]],s=[o[0],r[1]];return[(a[0]+s[0])/2,(a[1]+s[1])/2]}};zf.toolName="EllipticalROI",zf.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=zf.hydrateBase(zf,i,r,n),{toolInstance:f,...u}=n||{},d={annotationUID:n?.annotationUID||un(),data:{handles:{points:r,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(d,l.element),Me([l.id])};let aw=zf;function rme(t,e){const r=t.cachedStats[e],{area:n,mean:i,stdDev:o,max:a,isEmptyArea:s,areaUnit:c,modalityUnit:l,min:f}=r,u=[];if(fr(n)){const d=s?"Area: Oblique not supported":`Area: ${Ht(n)} ${c}`;u.push(d)}return fr(i)&&u.push(`Mean: ${Ht(i)} ${l}`),fr(a)&&u.push(`Max: ${Ht(a)} ${l}`),fr(f)&&u.push(`Min: ${Ht(f)} ${l}`),fr(o)&&u.push(`Std Dev: ${Ht(o)} ${l}`),u}const{transformWorldToIndex:D4}=gn,Pu=class Pu extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,calculateStats:!0,getTextLines:ime,statsCalculator:_s,simplified:!0}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;this.isDrawing=!0;let c;this.configuration.simplified?c=[[...s],[...s]]:c=[[...s],[...s],[...s],[...s],[...s]];const l=this.createAnnotation(n,c);Ft(l,a);const f=vt(a,this.getToolName());return this.editData={annotation:l,viewportIdsToRender:f,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(f),l},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{points:l}=i.data.handles,f=l.map(g=>c.worldToCanvas(g)),u=f[0],d=bl([u,f[1]]),h=bl([u,o]);return Math.abs(h-d)<a/2},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},St(a),this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;if(o.worldPosition)l=!0;else{const{points:d}=c.handles;f=d.findIndex(h=>h===o)}const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),St(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(this.doneEditMemo(),a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o,currentPoints:a}=i,{world:s,canvas:c}=a,l=Ce(o),{viewport:f}=l,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h,newAnnotation:g}=this.editData;this.createMemo(o,d,{newAnnotation:g});const{data:p}=d,m=p.handles.points[0],w=f.worldToCanvas(m);if(this.configuration.simplified)p.handles.points[1]=s;else{const v=Xn(w,c);p.handles.points[0]=[...m],p.handles.points[1]=u([w[0],w[1]-v]),p.handles.points[2]=u([w[0],w[1]+v]),p.handles.points[3]=u([w[0]-v,w[1]]),p.handles.points[4]=u([w[0]+v,w[1]])}d.invalidated=!0,this.editData.hasMoved=!0,Me(h),Gt(d,o,Nt.HandlesUpdated)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{canvasToWorld:s,worldToCanvas:c}=a.viewport,{annotation:l,handleIndex:f}=this.editData,{data:u}=l,{points:d}=u.handles,{currentPoints:h,deltaPoints:g}=i;if(f===0){const p=g.world;d.forEach(m=>{nr(m,m,p)})}else{const p=d[0],m=c(p),w=h.canvas,v=Xn(m,w);d[1]=s([m[0],m[1]-v]),d[2]=s([m[0],m[1]+v]),d[3]=s([m[0]-v,m[1]]),d[4]=s([m[0]+v,m[1]])}l.invalidated=!0},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData;return i.highlighted=!1,i.data.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{handles:m}=p,{points:w,activeHandleIndex:v}=m;u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),T=w.map(R=>a.worldToCanvas(R)),S=T[0],_=bl([S,T[1]]),E=ku([S,T[1]]),{centerPointRadius:D}=this.configuration;if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(h,a,f,n);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,a,f,n),a instanceof zn)){const{referencedImageId:R}=h.metadata;for(const A in p.cachedStats)A.startsWith("imageId")&&f.getStackViewports().find(L=>{const F=cr(R),j=L.hasImageURI(F),J=cr(L.getCurrentImageId());return j&&J!==F})&&delete p.cachedStats[A]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let b;if(!mr(g))continue;!pr(g)&&!this.editData&&v!==null&&(this.configuration.simplified?b=[T[v]]:b=T);const I=!!Gi("showHandlesAlways",{});(b||I)&&Wn(i,g,"0",I?T:b,{color:y});const O=`${g}-circle`,M="0";if(Si(i,g,M,S,_,{color:y,lineDash:x,lineWidth:C},O),D>0&&_>3*D&&Si(i,g,`${M}-center`,S,D,{color:y,lineDash:x,lineWidth:C}),o=!0,this.configuration.calculateStats){const R=this.getLinkedTextBoxStyle(u,h);if(!R.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(p,l);if(!A||A.length===0)continue;let B;p.handles.textBox.hasMoved||(B=po(E),p.handles.textBox.worldPosition=a.canvasToWorld(B));const k=a.worldToCanvas(p.handles.textBox.worldPosition),F=Ei(i,g,"1",A,k,[S,T[1]],{},R),{x:j,y:J,width:ie,height:fe}=F;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([j,J]),topRight:a.canvasToWorld([j+ie,J]),bottomLeft:a.canvasToWorld([j,J+fe]),bottomRight:a.canvasToWorld([j+ie,J+fe])}}}return o},this._calculateCachedStats=(n,i,o,a)=>{if(!this.configuration.calculateStats)return;const{data:s}=n,{element:c}=i,l=n.invalidated,{points:f}=s.handles,u=f.map(C=>i.worldToCanvas(C)),d=u[0],h=u[1],[g,p]=ku([d,h]),m=i.canvasToWorld(g),w=i.canvasToWorld(p),{cachedStats:v}=s,y=Object.keys(v);for(let C=0;C<y.length;C++){const x=y[C],T=this.getTargetImageData(x);if(!T)continue;const{dimensions:S,imageData:_,metadata:E,voxelManager:D}=T,b=f.map(ae=>_.worldToIndex(ae)),I=Fo(T,b),O=Pu.calculateLengthInIndex(I,b),M=Math.PI*O*O,R=2*Math.PI*O,A=O===0,{unit:B,areaUnit:k}=I,L={name:"area",value:M,unit:k,type:ra.Area},F={name:"circumference",value:R,unit:B,type:ra.Linear},j={name:"radius",value:O,unit:B,type:ra.Linear},J=[L,j,F];v[x]={Modality:E.Modality,area:M,isEmptyArea:A,areaUnit:k,radius:O,radiusUnit:B,perimeter:R,statsArray:J};const ie=D4(_,m),fe=D4(_,w);if(this.isHandleOutsideImage=!vr.isInsideVolume(S,[ie,fe]),!this.isHandleOutsideImage){const ae=Math.min(ie[0],fe[0]),de=Math.max(ie[0],fe[0]),we=Math.min(ie[1],fe[1]),_e=Math.max(ie[1],fe[1]),Te=Math.min(ie[2],fe[2]),G=Math.max(ie[2],fe[2]),P=[[ae,de],[we,_e],[Te,G]],$=f[0],W=Math.abs(m[0]-w[0])/2,q=Math.abs(m[1]-w[1])/2,Q=Math.abs(m[2]-w[2])/2,ee={center:$,xRadius:W<vc/2?0:W,yRadius:q<vc/2?0:q,zRadius:Q<vc/2?0:Q},ge={isPreScaled:Pc(i,x),isSuvScaled:this.isSuvScaled(i,x,n.metadata.referencedImageId)},De=Rc(E.Modality,n.metadata.referencedImageId,ge);let Ne;D&&(Ne=D.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:re=>C2(ee,re,{fast:!0}),boundsIJK:P,imageData:_,returnPoints:this.configuration.storePointData}));const We=this.configuration.statsCalculator.getStatistics();v[x]={...v[x],Modality:E.Modality,mean:We.mean?.value,max:We.max?.value,min:We.min?.value,pointsInShape:Ne,stdDev:We.stdDev?.value,modalityUnit:De,statsArray:[...J,...We.array]}}}return n.invalidated=!1,l&&Gt(n,c,Nt.StatsUpdated),v},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}};Pu.toolName="CircleROI",Pu.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=Pu.hydrateBase(Pu,i,r,n),{toolInstance:f,...u}=n||{},d={annotationUID:n?.annotationUID||un(),data:{handles:{points:r,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(d,l.element),Me([l.id])};let Qh=Pu;function ime(t,e){const r=t.cachedStats[e],{radius:n,radiusUnit:i,area:o,mean:a,stdDev:s,max:c,min:l,isEmptyArea:f,areaUnit:u,modalityUnit:d}=r,h=[];if(fr(n)){const g=f?"Radius: Oblique not supported":`Radius: ${Ht(n)} ${i}`;h.push(g)}if(fr(o)){const g=f?"Area: Oblique not supported":`Area: ${Ht(o)} ${u}`;h.push(g)}return fr(a)&&h.push(`Mean: ${Ht(a)} ${d}`),fr(c)&&h.push(`Max: ${Ht(c)} ${d}`),fr(l)&&h.push(`Min: ${Ht(l)} ${d}`),fr(s)&&h.push(`Std Dev: ${Ht(s)} ${d}`),h}const Rp=5,nT=class nT extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,degrees:[45,135,225,315],diameters:[10,30,60]}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{label:"",handles:{points:[[...s]]}}};Ft(m,a);const w=vt(a,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:w,newAnnotation:!0},this._activateDraw(a),St(a),n.preventDefault(),Me(w),m},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=c.worldToCanvas(f[0]),d=bl([u,o]);return Math.abs(d)<a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},St(a),this._activateModify(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const{renderingEngine:u}=Ce(o);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a)},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{renderingEngine:l,viewport:f}=c,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h}=this.editData,{data:g}=d;g.handles.points=[u(s),u(s)],d.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData,{data:c}=a,{deltaPoints:l}=i,f=l.world;c.handles.points.forEach(g=>{g[0]+=f[0],g[1]+=f[1],g[2]+=f[2]}),a.invalidated=!0;const d=Ce(o),{renderingEngine:h}=d;Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{canvasToWorld:s,worldToCanvas:c}=a.viewport,{annotation:l}=this.editData,{data:f}=l,{points:u}=f.handles,d=u.map(y=>c(y)),{currentPoints:h}=i,g=h.canvas,p=g[0]-d[0][0],m=g[1]-d[0][1],w=g,v=[d[1][0]+p,d[1][1]+m];u[0]=s(w),u[1]=s(v)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;i.highlighted=!1,s.handles.activeHandleIndex=null;const{renderingEngine:c}=Ce(n);return Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{handles:g}=h,{points:p}=g;l.annotationUID=d;const{color:m,lineWidth:w,lineDash:v}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),C=p.map(b=>a.worldToCanvas(b))[0];if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(d))continue;let x=`${d}-crosshair-vertical`,T=[C[0],C[1]+Rp],S=[C[0],C[1]-Rp];Yt(i,d,x,T,S,{color:m,lineDash:v,lineWidth:w}),x=`${d}-crosshair-horizontal`,T=[C[0]+Rp,C[1]],S=[C[0]-Rp,C[1]],Yt(i,d,x,T,S,{color:m,lineDash:v,lineWidth:w});const _=this.configuration.diameters.map(b=>this.worldMeasureToCanvas(b,a));for(let b=0;b<_.length;b++){const I=`${d}-circle-${b}`,O=`${d}-circle-${b}`;Si(i,d,O,C,_[b]/2,{color:m,lineDash:v,lineWidth:w},I)}const E=b=>b*Math.PI/180,D=this.configuration.degrees.map(b=>E(b));for(let b=0;b<D.length;b++){const I=`${d}-line-${b}`,O=[Math.cos(D[b])*_[0]/2+C[0],Math.sin(D[b])*_[0]/2+C[1]],M=[Math.cos(D[b])*_[2]/2+C[0],Math.sin(D[b])*_[2]/2+C[1]];Yt(i,d,I,O,M,{color:m,lineDash:v,lineWidth:w})}o=!0}return o}}worldMeasureToCanvas(e,r){const n=r.canvasToWorld([r.canvas.width/2,r.canvas.height/2]),{viewUp:i}=r.getCamera(),o=tn(Ie(),n,i,e),a=r.worldToCanvas(n),s=r.worldToCanvas(o);return Math.sqrt(Math.pow(s[0]-a[0],2)+Math.pow(s[1]-a[1],2))}};nT.toolName="ETDRSGrid";let sw=nT;const I4=3,M4=10,ome={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var rc;(function(t){t.Cardinal="CARDINAL",t.Linear="LINEAR",t.CatmullRom="CATMULLROM",t.BSpline="BSPLINE"})(rc||(rc={}));var Zd;(function(t){t.AddControlPoint="addControlPoint",t.DeleteControlPoint="deleteControlPoint"})(Zd||(Zd={}));const ame=["CatmullRomSplineROI","LinearSplineROI","BSplineROI","CardinalSplineROI"],hl=class hl extends Wh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,simplifiedSpline:!1,getTextLines:sme,contourHoleAdditionModifierKey:Qr.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[rc.Cardinal]:{Class:Jh,scale:.5},[rc.CatmullRom]:{Class:qA},[rc.Linear]:{Class:YA},[rc.BSpline]:{Class:XA,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:rc.CatmullRom,drawPreviewEnabled:!0,enableTwoPointPreview:!1,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[Zd.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:Ss.Primary,modifierKey:Qr.Shift}]},[Zd.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:Ss.Primary,modifierKey:Qr.Ctrl}]}}}}){super(e,r),this.splineToolNames=["CatmullRomSplineROI","LinearSplineROI","BSplineROI","CardinalSplineROI"],this.isHandleOutsideImage=!1,this.fireChangeOnUpdate=null,this.isPointNearTool=(n,i,o,a)=>{const{instance:s}=i.data.spline;return s.isPointNearCurve(o,a)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;if(o.worldPosition)l=!0;else{const{points:d}=c.handles;f=d.findIndex(h=>h===o)}const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,contourHoleProcessingEnabled:l}=this.editData,{data:f}=a;a.autoGenerated=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o);const u=Ce(o),d=this.getTargetImageData(this.getTargetId(u.viewport)),{imageData:h,dimensions:g}=d;this.isHandleOutsideImage=f.handles.points.map(m=>Lr(h,m)).some(m=>!Or(m,g)),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID);const p=c?Nt.Completed:Nt.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=a.annotationUID,this.fireChangeOnUpdate.changeType=p):this.fireChangeOnUpdate={annotationUID:a.annotationUID,changeType:p,contourHoleProcessingEnabled:l},Me(s),this.doneEditMemo(),this.editData=null,this.isDrawing=!1},this._keyDownCallback=n=>{const i=n.detail,{element:o}=i,a=i.key??"",{lastControlPointDeletionKeys:s}=this.configuration.spline;if(!s.includes(a))return;const{annotation:l}=this.editData,{data:f}=l;if(f.handles.points.length===I4){this.cancel(o);return}else{const u=f.handles.points.length-1;this._deleteControlPointByIndex(o,l,u)}n.preventDefault()},this._mouseMoveCallback=n=>{const{drawPreviewEnabled:i}=this.configuration.spline;if(!i)return;const{element:o}=n.detail,{renderingEngine:a}=Ce(o),s=vt(o,this.getToolName());this.editData.lastCanvasPoint=n.detail.currentPoints.canvas,Me(s),n.preventDefault()},this._mouseDownCallback=n=>{const i=n.type===V.MOUSE_DOUBLE_CLICK,{annotation:o,viewportIdsToRender:a}=this.editData,{data:s}=o;if(s.contour.closed)return;this.doneEditMemo();const c=n.detail,{currentPoints:l,element:f}=c,{canvas:u,world:d}=l;let h=s.handles.points.length>=2&&i,g=!0;if(s.handles.points.length&&this.createMemo(f,o,{newAnnotation:s.handles.points.length===1}),s.handles.points.length>=3){this.createMemo(f,o);const{instance:p}=s.spline;p.getClosestControlPointWithinDistance(u,M4)?.index===0&&(g=!1,h=!0)}g&&s.handles.points.push(d),s.contour.closed=s.contour.closed||h,o.invalidated=!0,Me(a),s.contour.closed&&this._endCallback(n),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:f}),l){const{deltaPoints:g}=i,p=g.world,{textBox:m}=u.handles,{worldPosition:w}=m;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],m.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;this.moveAnnotation(a,p)}else{const{currentPoints:g}=i,p=g.world;u.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0;const d=Ce(o),{renderingEngine:h}=d;Me(s)},this.triggerAnnotationCompleted=(n,i)=>{const o=V.ANNOTATION_COMPLETED,a={annotation:n,changeType:Nt.Completed,contourHoleProcessingEnabled:i};Xe(ke,o,a)},this.triggerAnnotationModified=(n,i,o=Nt.StatsUpdated)=>{const{viewportId:a,renderingEngineId:s}=i,c=V.ANNOTATION_MODIFIED;Xe(ke,c,{annotation:n,viewportId:a,renderingEngineId:s,changeType:o})},this.triggerChangeEvent=(n,i,o=Nt.StatsUpdated,a)=>{o===Nt.Completed?this.triggerAnnotationCompleted(n,a):this.triggerAnnotationModified(n,i,o)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.KEY_DOWN,this._keyDownCallback),n.addEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.addEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.KEY_DOWN,this._keyDownCallback),n.removeEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.removeEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._renderStats=(n,i,o,a)=>{const s=n.data,c=this.getTargetId(i);if(!s.spline.instance.closed||!a.visibility)return;const l=this.configuration.getTextLines(s,c);if(!l||l.length===0)return;const f=s.handles.points.map(v=>i.worldToCanvas(v));if(!s.handles.textBox.hasMoved){const v=po(f);s.handles.textBox.worldPosition=i.canvasToWorld(v)}const u=i.worldToCanvas(s.handles.textBox.worldPosition),h=Ei(o,n.annotationUID??"","textBox",l,u,f,{},a),{x:g,y:p,width:m,height:w}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([g,p]),topRight:i.canvasToWorld([g+m,p]),bottomLeft:i.canvasToWorld([g,p+w]),bottomRight:i.canvasToWorld([g+m,p+w])}},this.addControlPointCallback=(n,i)=>{const{data:o}=i,a=o.spline.type,s=this._getSplineConfig(a),c=s.controlPointAdditionDistance;if(s.controlPointAdditionEnabled===!1)return;const l=n.detail,{element:f}=l,u=Ce(f),{renderingEngine:d,viewport:h}=u,{canvasToWorld:g}=h,{instance:p}=o.spline,m=n.detail.currentPoints.canvas,w=p.getClosestPoint(m);if(w.distance>c)return;const{index:v,point:y}=p.addControlPointAtU(w.uValue);o.handles.points.splice(v,0,g(y)),i.invalidated=!0;const C=vt(f,this.getToolName());Me(C)},this.deleteControlPointCallback=(n,i)=>{const o=i.data.spline.type,a=this._getSplineConfig(o),s=a.controlPointDeletionDistance;if(a.controlPointDeletionEnabled===!1)return;const c=n.detail,{element:l,currentPoints:f}=c,{canvas:u}=f,{instance:d}=i.data.spline,h=d.getClosestControlPointWithinDistance(u,s);h&&this._deleteControlPointByIndex(l,i,h.index)},this._calculateCachedStats=(n,i)=>{if(!this.configuration.calculateStats)return;const o=n.data;if(!o.contour.closed)return;const a=Ce(i);if(!a)return;const{viewport:s}=a,{cachedStats:c}=o,{polyline:l}=o.contour,f=Object.keys(c);for(let d=0;d<f.length;d++){const h=f[d],g=this.getTargetImageData(h);if(!g)continue;const{metadata:p}=g,m=l.map(b=>s.worldToCanvas(b)),w=m[0],v=s.canvasToWorld(w),y=s.canvasToWorld([w[0]+1,w[1]]),C=s.canvasToWorld([w[0],w[1]+1]),x=Nr(v,y),T=Nr(v,C),{imageData:S}=g,{scale:_,areaUnit:E}=Fo(g,()=>{const{maxX:b,maxY:I,minX:O,minY:M}=Al(m),R=s.canvasToWorld([O,M]),A=Lr(S,R),B=s.canvasToWorld([b,I]),k=Lr(S,B);return[A,k]});let D=Mg(m)/_/_;D*=x*T,c[h]={Modality:p.Modality,area:D,areaUnit:E}}const u=n.invalidated;return n.invalidated=!1,u&&this.triggerAnnotationModified(n,a,Nt.StatsUpdated),c},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0}),this.annotationCompletedBinded=this.annotationCompleted.bind(this)}annotationCompleted(e){const{sourceAnnotation:r}=e.detail;!this.splineToolNames.includes(r?.metadata?.toolName)||!this.configuration.simplifiedSpline||!this.isContourSegmentationTool()||Vx(r)}initializeListeners(){ke.addEventListener(V.ANNOTATION_COMPLETED,this.annotationCompletedBinded)}removeListeners(){ke.removeEventListener(V.ANNOTATION_COMPLETED,this.annotationCompletedBinded)}onSetToolEnabled(){this.initializeListeners()}onSetToolActive(){this.initializeListeners()}onSetToolDisabled(){this.removeListeners()}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{canvas:o}=n,a=H0(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,s=this.createAnnotation(e);this.isDrawing=!0,this.addAnnotation(s,i);const c=vt(i,this.getToolName());return this.editData={annotation:s,viewportIdsToRender:c,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:o,contourHoleProcessingEnabled:a},this._activateDraw(i),e.preventDefault(),Me(c),s}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e);const{annotation:r,viewportIdsToRender:n,newAnnotation:i}=this.editData;i&&kt(r.annotationUID),super.cancelAnnotation(r);const o=Ce(e),{renderingEngine:a}=o;return Me(n),this.editData=null,r.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(e){const{enabledElement:r,targetId:n,svgDrawingHelper:i,annotationStyle:o}=e,{viewport:a}=r,{worldToCanvas:s}=a,{element:c}=a,l=e.annotation,{annotationUID:f,data:u,highlighted:d}=l,{handles:h}=u,{points:g,activeHandleIndex:p}=h,m=this.editData?.newAnnotation,{lineWidth:w,lineDash:v,color:y,locked:C}=o,x=g.map(M=>s(M)),{drawPreviewEnabled:T}=this.configuration.spline,S=l.data.spline.type,_=this._getSplineConfig(S),E=l.data.spline.instance,D=_g(l);if(D.findIndex(M=>!M)!==-1)throw new Error(`Can't find annotation for child ${l.childAnnotationUIDs.join()}`);[l,...D].filter(M=>this._isSplineROIAnnotation(M)).forEach(M=>{const A=this._updateSplineInstance(c,M).getPolylinePoints();this.updateContourPolyline(M,{points:A,closed:u.contour.closed,targetWindingDirection:to.Clockwise},a,{updateWindingDirection:u.contour.closed})}),super.renderAnnotationInstance(e),!u.cachedStats[n]||u.cachedStats[n].areaUnit==null?(u.cachedStats[n]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(l,c)):l.invalidated&&this._throttledCalculateCachedStats(l,c);let O;if(!C&&!this.editData&&p!==null&&(O=[x[p]]),(O||m||d)&&Wn(i,f,"0",x,{color:y,lineWidth:w,handleRadius:"3"}),T&&E.numControlPoints>=1&&this.editData?.lastCanvasPoint&&!E.closed){const{lastCanvasPoint:M}=this.editData,{enableTwoPointPreview:R}=this.configuration.spline;if(E.numControlPoints===1&&R){const B=[x[0],M];aa(i,f,"previewSplineChange",B,{color:"#9EA0CA",lineDash:v,lineWidth:1})}else if(E.numControlPoints>1){const A=E.getPreviewPolylinePoints(M,M4);aa(i,f,"previewSplineChange",A,{color:"#9EA0CA",lineDash:v,lineWidth:1})}}if(_.showControlPointsConnectors){const M=[...x];E.closed&&M.push(x[0]),aa(i,f,"controlPointsConnectors",M,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(l,a,i,o.textbox),this.fireChangeOnUpdate?.annotationUID===f&&(this.triggerChangeEvent(l,r,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),l.invalidated=!1,!0}createInterpolatedSplineControl(e){if(e.data.handles.points?.length)return;const{polyline:r}=e.data.contour;if(!r||!r.length)return;e.data.handles.points=[];const{points:n}=e.data.handles,i=Math.max(10,Math.floor(r.length/20));for(let o=0;o<r.length-i;o+=i)n.push(r[o]);n.push(r[r.length-1])}isSplineAnnotation(e){return ame.includes(e?.metadata?.toolName)}createSplineObjectFromType(e,r){const n=this._getSplineConfig(r),i=new n.Class;e.data.spline={type:n.type,instance:i,resolution:n.resolution}}createAnnotation(e){const r=super.createAnnotation(e),{world:n}=e.detail.currentPoints,{type:i}=this.configuration.spline,o=this._getSplineConfig(i),a=new o.Class,s=()=>({type:o.type,instance:a,resolution:o.resolution});let c;return this.configuration.interpolation?.enabled&&(c=l=>{l.data.spline||=s(),this.createInterpolatedSplineControl(l)}),jr(r,{data:{handles:{points:[[...n]]},spline:s(),cachedStats:{}},onInterpolationComplete:c})}_deleteControlPointByIndex(e,r,n){const i=Ce(e),{points:o}=r.data.handles;o.length===3?kt(r.annotationUID):o.splice(n,1);const{renderingEngine:a}=i,s=vt(e,this.getToolName());r.invalidated=!0,Me(s)}_isSplineROIAnnotation(e){return!!e.data?.spline}_getSplineConfig(e){const{configuration:r}=this,n=r.spline.configuration;return Object.assign({type:e},ome,n[e])}_updateSplineInstance(e,r){const n=Ce(e),{viewport:i}=n,{worldToCanvas:o}=i,{data:a}=r,{type:s,instance:c}=r.data.spline,l=this._getSplineConfig(s),u=a.handles.points.map(o),d=l.resolution!==void 0?parseInt(l.resolution):void 0,h=l.scale!==void 0?parseFloat(l.scale):void 0;return c.setControlPoints(u),c.closed=!!a.contour.closed,!c.fixedResolution&&d!==void 0&&c.resolution!==d&&(c.resolution=d,r.invalidated=!0),c instanceof Jh&&!c.fixedScale&&h!==void 0&&c.scale!==h&&(c.scale=h,r.invalidated=!0),c}};hl.toolName="SplineROI",hl.SplineTypes=rc,hl.Actions=Zd,hl.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;if(r.length<I4){console.warn("Spline requires at least 3 control points");return}const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,viewUp:c,instance:l,viewport:f}=hl.hydrateBase(hl,i,r,n),u=n?.splineType||rc.CatmullRom,h=l._getSplineConfig(u).Class,g=new h,{toolInstance:p,...m}=n||{},w={annotationUID:n?.annotationUID||un(),data:{handles:{points:r},label:"",cachedStats:{},spline:{type:u,instance:g},contour:{closed:!0}},highlighted:!1,autoGenerated:!1,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...m}};Ft(w,f.element),Me([f.id])};let _1=hl;function sme(t,e){const r=t.cachedStats[e],{area:n,isEmptyArea:i,areaUnit:o}=r,a=[];if(n){const s=i?"Area: Oblique not supported":`Area: ${Ht(n)} ${o}`;a.push(s)}return a}const rT=class rT extends _1{constructor(e){const r=jr({configuration:{calculateStats:!1}},e);super(r),this.annotationCutMergeCompletedBinded=this.annotationCutMergeCompleted.bind(this)}isContourSegmentationTool(){return!0}initializeListeners(){ke.addEventListener(V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,this.annotationCutMergeCompletedBinded)}removeListeners(){ke.removeEventListener(V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,this.annotationCutMergeCompletedBinded)}annotationCutMergeCompleted(e){const{sourceAnnotation:r}=e.detail;this.toolName!==r?.metadata?.toolName||!this.splineToolNames.includes(r?.metadata?.toolName)||!this.configuration.simplifiedSpline||Vx(r)}};rT.toolName="SplineContourSegmentationTool";let cw=rT;class cme{constructor({numBits:e,getPriority:r,areEqual:n}){this._bucketCount=1<<e,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=typeof r<"u"?r:i=>i,this._areEqual=typeof n=="function"?n:(i,o)=>i===o}push(e){const r=this._getBucketIndex(e),n=this._buckets[r],i={value:e,next:n};this._buckets[r]=i,this._size++}pop(){if(this._size===0)throw new Error("Cannot pop because the queue is empty.");for(;this._buckets[this._currentBucketIndex]===null;)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const e=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=e.next,this._size--,e.value}remove(e){if(!e)return!1;const r=this._getBucketIndex(e),n=this._buckets[r];let i=n,o;for(;i!==null&&!this._areEqual(e,i.value);)o=i,i=i.next;return i===null?!1:(i===n?this._buckets[r]=i.next:o.next=i.next,this._size--,!0)}isEmpty(){return this._size===0}_getBucketIndex(e){return this._getPriority(e)&this._mask}_buildArray(e){const r=new Array(e);return r.fill(null),r}}const Sy=4294967295,lme=2/(3*Math.PI);class E1{constructor(e,r,n){this._getPointIndex=(o,a)=>{const{width:s}=this;return o*s+a},this._getPointCoordinate=o=>{const a=o%this.width,s=Math.floor(o/this.width);return[a,s]},this._getPointCost=o=>Math.round(this.searchGranularity*this.costs[o]);const i=e.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=r,this.height=n,this.grayscalePixelData=e,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(i),this.parents=new Uint32Array(i),this.costs=new Float32Array(i)}startSearch(e){const r=this._getPointIndex(e[1],e[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(Sy),this.costs.fill(1/0),this.priorityQueueNew=new cme({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=e,this.costs[r]=0,this.priorityQueueNew.push(r)}findMinNearby(e,r=2){const[n,i]=e,{costs:o}=this,a=[Math.max(0,n-r),Math.min(n+r+1,this.width)],s=[Math.max(0,i-r),Math.min(i+r+1,this.height)];let c=o[this._getPointIndex(i,n)]*.8,l=e;for(let f=a[0];f<a[1];f++)for(let u=s[0];u<s[1];u++){const d=1-(Math.abs(f-e[0])+Math.abs(u-e[1]))/r/2,g=o[this._getPointIndex(u,f)]*.8+d*.2;g<c&&(l=[f,u],c=g)}return l}findPathToPoint(e){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:r,_getPointIndex:n,_getPointCoordinate:i}=this,o=n(r[1],r[0]),a=n(e[1],e[0]),{visited:s,parents:c,costs:l,priorityQueueNew:f}=this;if(a===o)return[];for(;!f.isEmpty()&&c[a]===Sy;){const h=f.pop();if(s[h])continue;const g=i(h),p=this._getNeighborPoints(g);s[h]=!0;for(let m=0,w=p.length;m<w;m++){const v=p[m],y=n(v[1],v[0]),C=this._getWeightedDistance(g,v),x=l[h]+C;x<l[y]&&(l[y]!==1/0&&f.remove(y),l[y]=x,c[y]=h,f.push(y))}}const u=[];let d=a;for(;d!==Sy;)u.push(i(d)),d=c[d];return u.reverse()}_getDeltaX(e,r){const{grayscalePixelData:n,width:i}=this;let o=this._getPointIndex(r,e);return e+1===i&&o--,n[o+1]-n[o]}_getDeltaY(e,r){const{grayscalePixelData:n,width:i,height:o}=this;let a=this._getPointIndex(r,e);return r+1===o&&(a-=i),n[a]-n[a+i]}_getGradientMagnitude(e,r){const n=this._getDeltaX(e,r),i=this._getDeltaY(e,r);return Math.sqrt(n*n+i*i)}_getLaplace(e,r){const{grayscalePixelData:n,_getPointIndex:i}=this,o=n[i(r-2,e)],a=n[i(r-1,e-1)],s=n[i(r-1,e)],c=n[i(r-1,e+1)],l=n[i(r,e-2)],f=n[i(r,e-1)],u=n[i(r,e)],d=n[i(r,e+1)],h=n[i(r,e+2)],g=n[i(r+1,e-1)],p=n[i(r+1,e)],m=n[i(r+1,e+1)],w=n[i(r+2,e)];let v=o;return v+=a+2*s+c,v+=l+2*f-16*u+2*d+h,v+=g+2*p+m,v+=w,v}_computeGradient(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0,o=0,a=0,s=0;for(s=0;s<r-1;s++){for(a=0;a<e-1;a++)n[i]=this._getGradientMagnitude(a,s),o=Math.max(n[i],o),i++;n[i]=n[i-1],i++}for(let c=n.length;i<c;i++)n[i]=n[i-e];for(let c=0,l=n.length;c<l;c++)n[c]=1-n[c]/o;return n}_computeLaplace(){const{width:e,height:r,_getPointIndex:n}=this,i=new Float32Array(e*r);i.fill(1,0,n(2,0));for(let o=2;o<r-2;o++){i[n(o,0)]=1,i[n(o,1)]=1;for(let a=2;a<e-2;a++)i[n(o,a)]=this._getLaplace(a,o)>.33?0:1;i[n(o,e-2)]=1,i[n(o,e-1)]=1}return i.fill(1,n(r-2,0)),i}_computeGradientX(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0;for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[i++]=this._getDeltaX(a,o);return n}_computeGradientY(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0;for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[i++]=this._getDeltaY(a,o);return n}_getGradientUnitVector(e,r){const{gradXNew:n,gradYNew:i,_getPointIndex:o}=this,a=n[o(r,e)],s=i[o(r,e)];let c=Math.sqrt(a*a+s*s);return c=Math.max(c,1e-100),[a/c,s/c]}_getGradientDirection(e,r,n,i){const o=this._getGradientUnitVector(e,r),a=this._getGradientUnitVector(n,i);let s=o[1]*(n-e)-o[0]*(i-r),c=a[1]*(n-e)-a[0]*(i-r);s<0&&(s=-s,c=-c),e!==n&&r!==i&&(s*=Math.SQRT1_2,c*=Math.SQRT1_2),c=Math.min(Math.max(c,-1),1);const l=lme*(Math.acos(Math.min(s,1))+Math.acos(c));return isNaN(l)||!isFinite(l)?(console.warn("Found non-direction:",e,r,n,i,s,c,l),1):l}getCost(e,r){return this._getWeightedDistance(e,r)}_getWeightedDistance(e,r){const{_getPointIndex:n,width:i,height:o}=this,[a,s]=e,[c,l]=r;if(c<0||c>=i||l<0||l>=o)return 1;if(a<0||s<0||a>=i||s>=o)return 0;const f=n(l,c);let u=this.gradMagnitude[f];(a===c||s===l)&&(u*=Math.SQRT1_2);const d=this.laplace[f],h=this._getGradientDirection(a,s,c,l);return .43*u+.43*d+.11*h}_getNeighborPoints(e){const{width:r,height:n}=this,i=[],o=Math.max(e[0]-1,0),a=Math.max(e[1]-1,0),s=Math.min(e[0]+1,r-1),c=Math.min(e[1]+1,n-1);for(let l=a;l<=c;l++)for(let f=o;f<=s;f++)(f!==e[0]||l!==e[1])&&i.push([f,l]);return i}static createInstanceFromRawPixelData(e,r,n,i){const o=e.length,a=new Float32Array(o),{lower:s,upper:c}=i,l=c-s;for(let f=0,u=e.length;f<u;f++)a[f]=Math.max(0,Math.min(1,(e[f]-s)/l));return new E1(a,r,n)}}class tc{constructor(e,r){this.pointArray=e?e.slice():[],this._controlPointIndexes=r?r.slice():[]}getPoint(e){return this.pointArray[e]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(e){const r=this.pointArray.indexOf(e);if(r!==-1)return this._controlPointIndexes.indexOf(r)!==-1;throw new Error("Error: isControlPoint called with not in list point.")}addPoint(e){this.pointArray.push(e)}addControlPoint(e){const r=this.pointArray.indexOf(e);if(r!==-1)this._controlPointIndexes.push(r);else throw new Error("Cannot mark a non registered point as control point.")}getControlPoints(){return this._controlPointIndexes.map(e=>this.pointArray[e])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(e){this.pointArray.splice(this.pointArray.length-e,e)}addPoints(e){this.pointArray=this.pointArray.concat(e)}prependPath(e){const r=e.pointArray.length,n=[];this.pointArray=e.pointArray.concat(this.pointArray);for(let i=0;i<this._controlPointIndexes.length;++i)n[i]=this._controlPointIndexes[i]+r;this._controlPointIndexes=e._controlPointIndexes.concat(n)}appendPath(e){this.addPoints(e.pointArray),e._controlPointIndexes.forEach(r=>this._controlPointIndexes.push(r))}}const ume=10**2,iT=class iT extends Wh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextLines:fme,calculateStats:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:Qr.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{cancelInProgress:{method:"cancelInProgress",bindings:[{key:"Escape"}]}}}}){super(e,r),this.isHandleOutsideImage=!1,this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,l=a*a,f=i.data.contour.polyline.map(d=>c.worldToCanvas(d));let u=f[f.length-1];for(let d=0;d<f.length;d++){const h=f[d];if(Ig(u,h,o)<=l)return!0;u=h}return!1},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1};const c=Ce(a),{renderingEngine:l}=c;this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;if(o.worldPosition)l=!0;else{const{points:g}=c.handles;f=g.findIndex(p=>p===o)}const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s);const d=Ce(s),{renderingEngine:h}=d;Me(u),n.preventDefault()},this._endCallback=(n,i=!1)=>{const o=n.detail,{element:a}=o,{annotation:s,viewportIdsToRender:c,newAnnotation:l,contourHoleProcessingEnabled:f}=this.editData,{data:u}=s;this.doneEditMemo(),u.handles.activeHandleIndex=null,this._deactivateModify(a),this._deactivateDraw(a);const d=Ce(a);if(this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage||i){kt(s.annotationUID),this.clearEditData(),Me(c);return}Me(c);const h=l?Nt.Completed:Nt.HandlesUpdated;this.triggerChangeEvent(s,d,h,f),this.clearEditData()},this.triggerChangeEvent=(n,i,o=Nt.StatsUpdated,a=!1)=>{o===Nt.Completed?h2(n,a):Gt(n,i.viewport.element,o)},this._mouseDownCallback=n=>{const i=n.type===V.MOUSE_DOUBLE_CLICK,{annotation:o,viewportIdsToRender:a,worldToSlice:s,sliceToWorld:c,newAnnotation:l}=this.editData;if(this.editData.closed)return;const f=n.detail,{element:u}=f,{currentPoints:d}=f,{canvas:h,world:g}=d;let p=g;const m=Ce(u),{viewport:w,renderingEngine:v}=m,y=this.editData.currentPath.getControlPoints();let C=y.length>=2&&i;if(this.doneEditMemo(),this.createMemo(u,o,{newAnnotation:l&&y.length===1}),y.length>=2){const S={index:-1,distSquared:1/0};for(let _=0,E=y.length;_<E;_++){const D=y[_],b=c(D),I=w.worldToCanvas(b),O=bc(h,I);O<=ume&&O<S.distSquared&&(S.distSquared=O,S.index=_)}S.index===0&&(C=!0)}const{snapHandleNearby:x}=this.configuration;if(x&&!this.editData.closed){const S=new tc,_=this.scissors.findMinNearby(s(g),1),E=this.scissors.findPathToPoint(_);S.addPoints(E),S.prependPath(this.editData.confirmedPath),p=c(_),this.editData.currentPath=S}this.editData.closed=this.editData.closed||C,this.editData.confirmedPath=this.editData.currentPath;const T=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(T),o.data.handles.points.push(c(T)),this.scissors.startSearch(s(p)),o.invalidated=!0,Me(a),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(n)),n.preventDefault()},this._mouseMoveCallback=n=>{const{element:i,currentPoints:o}=n.detail,{world:a,canvas:s}=o,{renderingEngine:c}=Ce(i),l=vt(i,this.getToolName());this.editData.lastCanvasPoint=s;const{width:f,height:u}=this.scissors,{worldToSlice:d}=this.editData,h=d(a);if(h[0]<0||h[1]<0||h[0]>=f||h[1]>=u)return;const g=this.scissors.findPathToPoint(h),p=new tc;p.addPoints(g),p.prependPath(this.editData.confirmedPath),this.editData.currentPath=p,Me(l),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,movingTextBox:c,handleIndex:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(c){const{deltaPoints:g}=i,p=g.world,{textBox:m}=u.handles,{worldPosition:w}=m;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],m.hasMoved=!0}else if(l===void 0)console.warn("Drag annotation not implemented");else{const{currentPoints:g}=i,p=g.world;this.editHandle(p,o,a,l)}this.editData.hasMoved=!0;const d=Ce(o),{renderingEngine:h}=d;Me(s)},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData;return a&&kt(i.annotationUID),Me(o),this.doneEditMemo(),this.scissors=null,i.annotationUID},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.addEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.removeEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._calculateCachedStats=(n,i)=>{if(!this.configuration.calculateStats)return;const o=n.data;if(!o.contour.closed)return;const a=Ce(i),{viewport:s,renderingEngine:c}=a,{cachedStats:l}=o,{polyline:f}=o.contour,u=Object.keys(l);for(let h=0;h<u.length;h++){const g=u[h],p=this.getTargetImageData(g);if(!p)continue;const{metadata:m}=p,w=f.map(I=>s.worldToCanvas(I)),v=w[0],y=s.canvasToWorld(v),C=s.canvasToWorld([v[0]+1,v[1]]),x=s.canvasToWorld([v[0],v[1]+1]),T=Nr(y,C),S=Nr(y,x),{imageData:_}=p,{scale:E,areaUnit:D}=Fo(p,()=>{const{maxX:I,maxY:O,minX:M,minY:R}=Al(w),A=s.canvasToWorld([M,R]),B=Lr(_,A),k=s.canvasToWorld([I,O]),L=Lr(_,k);return[B,L]});let b=Mg(w)/E/E;b*=T*S,l[g]={Modality:m.Modality,area:b,areaUnit:D}}const d=n.invalidated;return n.invalidated=!1,d&&this.triggerAnnotationModified(n,a,Nt.StatsUpdated),l},this._renderStats=(n,i,o,a)=>{const s=n.data,c=this.getTargetId(i);if(!s.contour.closed||!a.visibility)return;const l=this.configuration.getTextLines(s,c);if(!l||l.length===0)return;const f=s.handles.points.map(v=>i.worldToCanvas(v));if(!s.handles.textBox.hasMoved){const v=po(f);s.handles.textBox.worldPosition=i.canvasToWorld(v)}const u=i.worldToCanvas(s.handles.textBox.worldPosition),h=Ei(o,n.annotationUID??"","textBox",l,u,f,{},a),{x:g,y:p,width:m,height:w}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([g,p]),topRight:i.canvasToWorld([g+m,p]),bottomLeft:i.canvasToWorld([g,p+w]),bottomRight:i.canvasToWorld([g+m,p+w])}},this.triggerAnnotationModified=(n,i,o=Nt.StatsUpdated)=>{const{viewportId:a,renderingEngineId:s}=i,c=V.ANNOTATION_MODIFIED;Xe(ke,c,{annotation:n,viewportId:a,renderingEngineId:s,changeType:o})},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}setupBaseEditData(e,r,n,i,o){const a=Ce(r),{viewport:s}=a;this.isDrawing=!0;const c=s.getImageData(),{imageData:l}=c;let f,u,d,h,g;if(!(s instanceof zn))d=c.dimensions[0],h=c.dimensions[1],f=S=>{const _=Lr(l,S);return[_[0],_[1]]},u=S=>y0(l,[S[0],S[1],0]),g=c.scalarData;else if(s instanceof zn){const S=sx(s),{sliceToIndexMatrix:_,indexToSliceMatrix:E}=S;f=D=>{const b=Lr(l,D),I=Pt([0,0,0],b,E);return[I[0],I[1]]},u=D=>{const b=Pt([0,0,0],[D[0],D[1],0],_);return y0(l,b)},g=S.scalarData,d=S.width,h=S.height}else throw new Error("Viewport not supported");g=L7(g,d,h);const{voiRange:p}=s.getProperties(),m=f(e);this.scissors=E1.createInstanceFromRawPixelData(g,d,h,p),i&&(this.scissorsNext=E1.createInstanceFromRawPixelData(g,d,h,p),this.scissorsNext.startSearch(f(i))),this.scissors.startSearch(m);const w=!i,v=new tc,y=new tc,C=w?void 0:new tc;v.addPoint(m),v.addControlPoint(m);const x=vt(r,this.getToolName()),T=s.worldToCanvas(e);this.editData={annotation:n,viewportIdsToRender:x,newAnnotation:w,hasMoved:!1,lastCanvasPoint:T,confirmedPath:v,currentPath:y,confirmedPathNext:C,closed:!1,handleIndex:this.editData?.handleIndex??n.handles?.activeHandleIndex,worldToSlice:f,sliceToWorld:u,contourHoleProcessingEnabled:o}}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{world:o}=n,a=this.createAnnotation(e),s=H0(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(o,i,a,void 0,s),this.addAnnotation(a,i),this._activateDraw(i),e.preventDefault(),Me(this.editData.viewportIdsToRender),a}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(e,r,n,i){const{data:o}=n,{points:a}=o.handles,{length:s}=a,c=a[(i-1+s)%s],l=a[(i+1)%s];if(!this.editData?.confirmedPathNext){this.setupBaseEditData(c,r,n,l);const{polyline:y}=o.contour,C=new tc,x=new tc,{worldToSlice:T}=this.editData,S=$5(n,i-1),_=$5(n,i+1);if(_===-1||S===-1)throw new Error(`Can't find handle index ${_===-1&&l} ${S===-1&&c}`);i===0?x.addPoints(y.slice(_+1,S).map(T)):(C.addPoints(y.slice(0,S+1).map(T)),x.addPoints(y.slice(_,y.length).map(T))),this.editData.confirmedPath=C,this.editData.confirmedPathNext=x}const{editData:f,scissors:u}=this,{worldToSlice:d,sliceToWorld:h}=f,{activeHandleIndex:g}=o.handles;if(g==null)o.handles.activeHandleIndex=i;else if(g!==i)throw new Error(`Trying to edit a different handle than the one currently being edited ${i}!==${o.handles.activeHandleIndex}`);const p=d(e);if(p[0]<0||p[0]>=u.width||p[1]<0||p[1]>=u.height)return;a[i]=h(p);const m=u.findPathToPoint(p),w=this.scissorsNext.findPathToPoint(p),v=new tc;v.prependPath(f.confirmedPath),i!==0&&v.addPoints(m),v.addPoints(w.reverse()),v.appendPath(f.confirmedPathNext),i===0&&v.addPoints(m),f.currentPath=v,n.invalidated=!0,f.hasMoved=!0,f.closed=!0}renderAnnotation(e,r){return this.updateAnnotation(this.editData?.currentPath),super.renderAnnotation(e,r)}isContourSegmentationTool(){return!1}createAnnotation(e){const r=super.createAnnotation(e),{world:n}=e.detail.currentPoints;return jr(r,{data:{handles:{points:[[...n]]}}})}cancelInProgress(e,r,n){if(!this.editData){this.undo();return}this._endCallback(n,!0)}renderAnnotationInstance(e){const{annotation:r,enabledElement:n,svgDrawingHelper:i,annotationStyle:o,targetId:a}=e,{viewport:s}=n,{element:c}=s,{worldToCanvas:l}=s,{annotationUID:f,data:u,highlighted:d}=r,{handles:h}=u,g=this.editData?.newAnnotation,{lineWidth:p,lineDash:m,color:w}=o;if(d||g&&r.annotationUID===this.editData?.annotation?.annotationUID){const y=h.points.map(l);Wn(i,f,"0",y,{color:w,lineDash:m,lineWidth:p})}return super.renderAnnotationInstance(e),!u.cachedStats[a]||u.cachedStats[a]?.areaUnit===null?(u.cachedStats[a]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(r,c)):r.invalidated&&this._throttledCalculateCachedStats(r,c),this._renderStats(r,s,i,o.textbox),!0}updateAnnotation(e){if(!this.editData||!e)return;const{annotation:r,sliceToWorld:n,worldToSlice:i,closed:o,newAnnotation:a}=this.editData;let{pointArray:s}=e;s.length>1&&(s=[...s,s[0]]);const c=a&&o?to.Clockwise:void 0;this.updateContourPolyline(r,{points:s,closed:o,targetWindingDirection:c},{canvasToWorld:n,worldToCanvas:i})}};iT.toolName="LivewireContour";let b1=iT;function fme(t,e){const r=t.cachedStats[e],{area:n,areaUnit:i}=r,o=[];if(n){const a=`Area: ${Ht(n)} ${i}`;o.push(a)}return o}const L1=class L1 extends b1{updateInterpolatedAnnotation(e,r){this.editData||!e.invalidated||!e.data.handles.interpolationSources||(e.data.contour.originalPolyline=e.data.contour.polyline,queueMicrotask(()=>{if(!e.data.handles.interpolationSources)return;const{points:n}=e.data.handles,{element:i}=r.viewport;this.setupBaseEditData(n[0],i,e);const{length:o}=n,{scissors:a}=this,{nearestEdge:s,repeatInterpolation:c}=this.configuration.interpolation;e.data.handles.originalPoints=n;const{worldToSlice:l,sliceToWorld:f}=this.editData,u=[];if(s){let h=l(n[n.length-1]);n.forEach((g,p)=>{const m=l(g);h=m,u.push(m),a.startSearch(h),a.findPathToPoint(m),a.findPathToPoint(l(n[(p+3)%n.length]));const w=a.findMinNearby(m,s);Dt(m,w)||(u[p]=w,h=w,n[p]=f(w))})}const d=new tc;for(let h=0;h<o;h++){a.startSearch(l(n[h]));const g=a.findPathToPoint(l(n[(h+1)%o]));d.addPoints(g)}this.updateAnnotation(d),this.scissors=null,this.scissorsNext=null,this.editData=null,e.data.handles.interpolationSources=null,c&&Gt(e,r.viewport.element,Nt.InterpolationUpdated)}))}renderAnnotationInstance(e){const{enabledElement:r,svgDrawingHelper:n}=e,i=e.annotation,{annotationUID:o}=i,{viewport:a}=r,{worldToCanvas:s}=a,{showInterpolationPolyline:c}=this.configuration.interpolation||{};this.updateInterpolatedAnnotation?.(i,r);const{originalPolyline:l}=i.data.contour,f=super.renderAnnotationInstance(e);if(c&&l&&i.autoGenerated){const u=l.map(s);u.push(u[0]),aa(n,o,"interpolationContour-0",u,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return f}isContourSegmentationTool(){return!0}};L1.toolName="LivewireContourSegmentationTool",_0.register(L1);let lw=L1;const Ru=class Ru extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:dme,changeTextCallback:hme,preventHandleOutsideImage:!1,arrowFirst:!0,arrowHeadStyle:"legacy"}}){super(e,r),this.addNewAnnotation=n=>{this.startGroupRecording();const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const{arrowFirst:c}=this.configuration,l=this.createAnnotation(n,[[...s],[...s]],{data:{handles:{arrowFirst:c}}});Ft(l,a);const f=vt(a,this.getToolName());return this.editData={annotation:l,viewportIdsToRender:f,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(f),l},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ir([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l,movingTextBox:f}=this.editData,{data:u}=a;c&&!l||(u.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),c?this.configuration.getTextCallback(d=>{if(!d){kt(a.annotationUID),Me(s),this.editData=null,this.isDrawing=!1;return}a.data.label=d,Gt(a,o,Nt.HandlesUpdated),En(a),this.createMemo(o,a,{newAnnotation:!!this.memo}),$A(a,o,d),this.endGroupRecording(),this.doneEditMemo(),Me(s)}):f||Gt(a,o,Nt.HandlesUpdated),this.doneEditMemo(),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:d}=i,h=d.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this.touchTapCallback=n=>{n.detail.taps==2&&this.doubleClickCallback(n)},this.doubleClickCallback=n=>{const i=n.detail,{element:o}=i;let a=$t(this.getToolName(),o);if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return;const s=a.find(l=>this.isPointNearTool(o,l,i.currentPoints.canvas,6));if(!s)return;const c=s;this.configuration.changeTextCallback(s,n.detail,this._doneChangingTextCallback.bind(this,o,c)),this.editData=null,this.isDrawing=!1,n.stopImmediatePropagation(),n.preventDefault()},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{handles:g,label:p}=h,{points:m,activeHandleIndex:w}=g;l.annotationUID=d;const{color:v,lineWidth:y,lineDash:C,markerSize:x}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),T=m.map(k=>a.worldToCanvas(k));let S;if(!pr(d)&&!this.editData&&w!==null&&(S=[T[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(d))continue;const _=!!Gi("showHandlesAlways",{});(S||_)&&Wn(i,d,"0",T,{color:v,lineWidth:y});const E="1";if(this.configuration.arrowFirst?u1(i,d,E,T[1],T[0],{color:v,width:y,lineDash:C,viaMarker:this.configuration.arrowHeadStyle!=="legacy",markerSize:x}):u1(i,d,E,T[0],T[1],{color:v,width:y,lineDash:C,viaMarker:this.configuration.arrowHeadStyle!=="legacy",markerSize:x}),o=!0,!p)continue;const D=this.getLinkedTextBoxStyle(l,u);if(!D.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!h.handles.textBox.hasMoved){const k=T[1];h.handles.textBox.worldPosition=a.canvasToWorld(k)}const b=a.worldToCanvas(h.handles.textBox.worldPosition),O=Ei(i,d,"1",[p],b,T,{},D),{x:M,y:R,width:A,height:B}=O;h.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([M,R]),topRight:a.canvasToWorld([M+A,R]),bottomLeft:a.canvasToWorld([M,R+B]),bottomRight:a.canvasToWorld([M+A,R+B])}}return o}}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(d=>d===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o);const f=Ce(o),{renderingEngine:u}=f;Me(l),e.preventDefault()}_doneChangingTextCallback(e,r,n){r.data.label=n;const i=vt(e,this.getToolName());Me(i),Gt(r,e)}_isInsideVolume(e,r,n){return Or(e,n)&&Or(r,n)}};Ru.toolName="ArrowAnnotate",Ru.hydrate=(e,r,n,i)=>{const o=xn(e);if(!o)return;const{FrameOfReferenceUID:a,referencedImageId:s,viewPlaneNormal:c,instance:l,viewport:f}=Ru.hydrateBase(Ru,o,r,i),{toolInstance:u,...d}=i||{},h=Ru.createAnnotation({annotationUID:i?.annotationUID||un(),data:{label:n||"",handles:{points:r}},autoGenerated:!1,metadata:{toolName:l.getToolName(),viewPlaneNormal:c,FrameOfReferenceUID:a,referencedImageId:s,...d}});Ft(h,f.element),Me([f.id])};let uw=Ru;function dme(t){return t(prompt("Enter your annotation:"))}function hme(t,e,r){return r(prompt("Enter your annotation:"))}const jf=class jf extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,showAngleArc:!1,arcOffset:5,preventHandleOutsideImage:!1,getTextLines:gme}}){super(e,r),this.addNewAnnotation=n=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[f,u,d]=l.handles.points,h=c.worldToCanvas(f),g=c.worldToCanvas(u),p={start:{x:h[0],y:h[1]},end:{x:g[0],y:g[1]}};if(Ir([p.start.x,p.start.y],[p.end.x,p.end.y],[o[0],o[1]])<=a)return!0;if(!d)return!1;const w=c.worldToCanvas(d),v={start:{x:g[0],y:g[1]},end:{x:w[0],y:w[1]}};return Ir([v.start.x,v.start.y],[v.end.x,v.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;if(this.angleStartedNotYetCompleted&&f.handles.points.length===2){this.editData.handleIndex=2;return}this.angleStartedNotYetCompleted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const u=Ce(o),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&En(a),this.editData=null,this.isDrawing=!1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:f}),l){const{deltaPoints:g}=i,p=g.world,{textBox:m}=u.handles,{worldPosition:w}=m;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],m.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;u.handles.points.forEach(w=>{w[0]+=p[0],w[1]+=p[1],w[2]+=p[2]}),a.invalidated=!0}else{const{currentPoints:g}=i,p=g.world;u.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0;const d=Ce(o),{renderingEngine:h}=d;Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,this.angleStartedNotYetCompleted=!1,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:v,lineWidth:y,lineDash:C,angleArcLineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),T=m.map(L=>a.worldToCanvas(L));!p.cachedStats[l]||p.cachedStats[l].angle==null?(p.cachedStats[l]={angle:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n);let S;if(!pr(h.annotationUID)&&!this.editData&&w!==null&&(S=[T[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(g))continue;const _=!!Gi("showHandlesAlways",{});(S||_)&&Wn(i,g,"0",T,{color:v,lineDash:C,lineWidth:y});let E="1";if(Yt(i,g,E,T[0],T[1],{color:v,width:y,lineDash:C}),o=!0,T.length!==3)return o;if(E="2",Yt(i,g,E,T[1],T[2],{color:v,width:y,lineDash:C}),this.configuration.showAngleArc){const L=T[1],F=this.configuration.arcOffset,j=Math.min(Ir([L[0],L[1]],[T[0][0],T[0][1]],[T[2][0],T[2][1]]),Ir([L[0],L[1]],[T[2][0],T[2][1]],[T[0][0],T[0][1]]))/F,J=[];let ie=Math.atan2(T[0][1]-L[1],T[0][0]-L[0]),fe=Math.atan2(T[2][1]-L[1],T[2][0]-L[0]);if(fe<ie&&(fe+=2*Math.PI),fe-ie>Math.PI){const we=ie;ie=fe,fe=we+2*Math.PI}const de=32;for(let we=0;we<=de;we++){const _e=ie+we/de*(fe-ie);J.push([L[0]+j*Math.cos(_e),L[1]+j*Math.sin(_e)])}yc(i,g,"3",J,{color:v,width:y,lineDash:x})}if(!p.cachedStats[l]?.angle)continue;const D=this.getLinkedTextBoxStyle(u,h);if(!D.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const b=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const L=T[1];p.handles.textBox.worldPosition=a.canvasToWorld(L)}const I=a.worldToCanvas(p.handles.textBox.worldPosition),M=Ei(i,g,"1",b,I,T,{},D),{x:R,y:A,width:B,height:k}=M;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([R,A]),topRight:a.canvasToWorld([R+B,A]),bottomLeft:a.canvasToWorld([R,A+k]),bottomRight:a.canvasToWorld([R+B,A+k])}}return o},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(d=>d===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o);const f=Ce(o),{renderingEngine:u}=f;Me(l),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport;if(i.handles.points.length!==3)return;const a=i.handles.points[0],s=i.handles.points[1],c=i.handles.points[2],{cachedStats:l}=i,f=Object.keys(l);for(let d=0;d<f.length;d++){const h=f[d],g=o0([a,s],[s,c]),{dimensions:p,imageData:m}=this.getTargetImageData(h);this.isHandleOutsideImage=[a,s,c].map(w=>Lr(m,w)).some(w=>!Or(w,p)),l[h]={angle:isNaN(g)?"Incomplete Angle":g}}const u=e.invalidated;return e.invalidated=!1,u&&Gt(e,o,Nt.StatsUpdated),l}};jf.toolName="Angle",jf.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=jf.hydrateBase(jf,i,r,n),{toolInstance:f,...u}=n||{},d={annotationUID:n?.annotationUID||un(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(d,l.element),Me([l.id])};let fw=jf;function gme(t,e){const r=t.cachedStats[e],{angle:n}=r;return n===void 0?void 0:isNaN(n)?[`${n}`]:[`${Ht(n)} `]}const pme=(...t)=>{const e=t[0].length===2?[0,0]:[0,0,0],r=t.length;for(const n of t)e[0]+=n[0]/r,e[1]+=n[1]/r,e.length===3&&(e[2]+=n[2]/r);return e},ec=pme,oT=class oT extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:mme,showArcLines:!1}}){super(e,r),this.addNewAnnotation=n=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{distanceToPoint:f,distanceToPoint2:u}=this.distanceToLines({viewport:c,points:l.handles.points,canvasCoords:o,proximity:a});return f<=a||u<=a},this.toolSelectedCallback=(n,i,o,a,s=6)=>{const c=n.detail,{element:l}=c;i.highlighted=!0;const f=vt(l,this.getToolName()),u=Ce(l),{renderingEngine:d,viewport:h}=u,{isNearFirstLine:g,isNearSecondLine:p}=this.distanceToLines({viewport:h,points:i.data.handles.points,canvasCoords:a,proximity:s});this.editData={annotation:i,viewportIdsToRender:f,movingTextBox:!1,isNearFirstLine:g,isNearSecondLine:p},this._activateModify(l),St(l),Me(f),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;if(this.doneEditMemo(),this.angleStartedNotYetCompleted&&f.handles.points.length<4){Vt(o),this.editData.handleIndex=f.handles.points.length;return}this.angleStartedNotYetCompleted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const u=Ce(o),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a),this.editData=null,this.isDrawing=!1},this._mouseDownCallback=n=>{const{annotation:i,handleIndex:o}=this.editData,a=n.detail,{element:s,currentPoints:c}=a,l=c.world,{data:f}=i;if(o===1){f.handles.points[1]=l,this.editData.hasMoved=f.handles.points[1][0]!==f.handles.points[0][0]||f.handles.points[1][1]!==f.handles.points[0][0];return}if(o===3){f.handles.points[3]=l,this.editData.hasMoved=f.handles.points[3][0]!==f.handles.points[2][0]||f.handles.points[3][1]!==f.handles.points[2][0],this.angleStartedNotYetCompleted=!1;return}this.editData.hasMoved=!1,St(s),f.handles.points[2]=f.handles.points[3]=l,this.editData.handleIndex=f.handles.points.length-1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,isNearFirstLine:f,isNearSecondLine:u,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:h}=a;if(l){const{deltaPoints:m}=i,w=m.world,{textBox:v}=h.handles,{worldPosition:y}=v;y[0]+=w[0],y[1]+=w[1],y[2]+=w[2],v.hasMoved=!0}else if(c===void 0&&(f||u)){const{deltaPoints:m}=i,w=m.world,v=h.handles.points;f?[v[0],v[1]].forEach(C=>{C[0]+=w[0],C[1]+=w[1],C[2]+=w[2]}):u&&[v[2],v[3]].forEach(C=>{C[0]+=w[0],C[1]+=w[1],C[2]+=w[2]}),a.invalidated=!0}else{const{currentPoints:m}=i,w=m.world;h.handles.points[c]=[...w],a.invalidated=!0}this.editData.hasMoved=!0;const g=Ce(o),{renderingEngine:p}=g;Me(s),a.invalidated&&Gt(a,o,Nt.HandlesUpdated)},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;s.handles.points.length<4&&kt(i.annotationUID),i.highlighted=!1,s.handles.activeHandleIndex=null;const c=Ce(n),{renderingEngine:l}=c;return Me(o),a&&En(i),this.editData=null,this.angleStartedNotYetCompleted=!1,i.annotationUID},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_START,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_START,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_START,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_START,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:v,lineWidth:y,lineDash:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),x=m.map(_e=>a.worldToCanvas(_e));!p.cachedStats[l]||p.cachedStats[l].angle==null?(p.cachedStats[l]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n);let T;if(!pr(g)&&!this.editData&&w!==null&&(T=[x[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!mr(g))continue;const S=!!Gi("showHandlesAlways",{});(T||S)&&Wn(i,g,"0",x,{color:v,lineDash:C,lineWidth:y});const _=[x[0],x[1]],E=[x[2],x[3]];let D="line1";if(Yt(i,g,D,_[0],_[1],{color:v,width:y,lineDash:C}),o=!0,x.length<4)return o;D="line2",Yt(i,g,D,E[0],E[1],{color:v,width:y,lineDash:C}),D="linkLine";const b=ec(_[0],_[1]),I=ec(E[0],E[1]);Yt(i,g,D,b,I,{color:v,lineWidth:"1",lineDash:"1,4"});const{arc1Start:O,arc1End:M,arc2End:R,arc2Start:A}=p.cachedStats[l].points.canvas,{arc1Angle:B,arc2Angle:k}=p.cachedStats[l];if(this.configuration.showArcLines&&(D="arc1",Yt(i,g,D,O,M,{color:v,lineWidth:"1"}),D="arc2",Yt(i,g,D,A,R,{color:v,lineWidth:"1"})),!p.cachedStats[l]?.angle)continue;const L=this.getLinkedTextBoxStyle(u,h);if(!L.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const F=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const _e=po(x);p.handles.textBox.worldPosition=a.canvasToWorld(_e)}const j=a.worldToCanvas(p.handles.textBox.worldPosition),ie=Ei(i,g,"cobbAngleText",F,j,x,{},L),{x:fe,y:ae,width:de,height:we}=ie;if(p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([fe,ae]),topRight:a.canvasToWorld([fe+de,ae]),bottomLeft:a.canvasToWorld([fe,ae+we]),bottomRight:a.canvasToWorld([fe+de,ae+we])},this.configuration.showArcLines){const _e="arcAngle1",Te=[`${B.toFixed(2)} `],G=ec(O,M);Dc(i,g,_e,Te,G,{...L,padding:3});const P="arcAngle2",$=[`${k.toFixed(2)} `],W=ec(A,R);Dc(i,g,P,$,W,{...L,padding:3})}}return o},this.distanceToLines=({viewport:n,points:i,canvasCoords:o,proximity:a})=>{const[s,c,l,f]=i,u=n.worldToCanvas(s),d=n.worldToCanvas(c),h=n.worldToCanvas(l),g=n.worldToCanvas(f),p={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},m={start:{x:h[0],y:h[1]},end:{x:g[0],y:g[1]}},w=Ir([p.start.x,p.start.y],[p.end.x,p.end.y],[o[0],o[1]]),v=Ir([m.start.x,m.start.y],[m.end.x,m.end.y],[o[0],o[1]]);let y=!1,C=!1;return w<=a?y=!0:v<=a&&(C=!0),{distanceToPoint:w,distanceToPoint2:v,isNearFirstLine:y,isNearSecondLine:C}},this.getArcsStartEndPoints=({firstLine:n,secondLine:i,mid1:o,mid2:a})=>{const s=[o,a],c=o0(n,s),l=o0(i,s),f=c>90?1:0,u=l>90?0:1,d=ec(s[0],s[1]),h=Math.sqrt((s[1][0]-s[0][0])**2+(s[1][1]-s[0][1])**2),g=.1,p=ec(n[0],n[1]),m=ec(i[0],i[1]),w=[n[f][0]-p[0],n[f][1]-p[1]],v=Math.sqrt(w[0]**2+w[1]**2),y=[w[0]/v,w[1]/v],C=[p[0]+y[0]*h*g,p[1]+y[1]*h*g],x=[d[0]-o[0],d[1]-o[1]],T=Math.sqrt(x[0]**2+x[1]**2),S=[x[0]/T,x[1]/T],_=[o[0]+S[0]*h*g,o[1]+S[1]*h*g],E=[i[u][0]-m[0],i[u][1]-m[1]],D=Math.sqrt(E[0]**2+E[1]**2),b=[E[0]/D,E[1]/D],I=[m[0]+b[0]*h*g,m[1]+b[1]*h*g],O=[d[0]-a[0],d[1]-a[1]],M=Math.sqrt(O[0]**2+O[1]**2),R=[O[0]/M,O[1]/M],A=[a[0]+R[0]*h*g,a[1]+R[1]*h*g];return{arc1Start:C,arc1End:_,arc2Start:I,arc2End:A,arc1Angle:c>90?180-c:c,arc2Angle:l>90?180-l:l}},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(e,r,n,i="mouse"){const o=e.detail,{element:a}=o,{data:s}=r;r.highlighted=!0;let c=!1,l;n.worldPosition?c=!0:l=s.handles.points.findIndex(u=>u===n);const f=vt(a,this.getToolName());this.editData={annotation:r,viewportIdsToRender:f,handleIndex:l,movingTextBox:c},this._activateModify(a),St(a),Me(f),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data;if(i.handles.points.length!==4)return;const o=[null,null],a=[null,null];let s=Number.MAX_VALUE;for(let _=0;_<2;_+=1)for(let E=2;E<4;E+=1){const D=Nr(i.handles.points[_],i.handles.points[E]);D<s&&(s=D,o[1]=i.handles.points[_],o[0]=i.handles.points[(_+1)%2],a[0]=i.handles.points[E],a[1]=i.handles.points[2+(E-1)%2])}const{viewport:c}=n,{element:l}=c,f=i.handles.points.map(_=>c.worldToCanvas(_)),u=[f[0],f[1]],d=[f[2],f[3]],h=ec(u[0],u[1]),g=ec(d[0],d[1]),{arc1Start:p,arc1End:m,arc2End:w,arc2Start:v,arc1Angle:y,arc2Angle:C}=this.getArcsStartEndPoints({firstLine:u,secondLine:d,mid1:h,mid2:g}),{cachedStats:x}=i,T=Object.keys(x);for(let _=0;_<T.length;_++){const E=T[_];x[E]={angle:o0(o,a),arc1Angle:y,arc2Angle:C,points:{canvas:{arc1Start:p,arc1End:m,arc2End:w,arc2Start:v},world:{arc1Start:c.canvasToWorld(p),arc1End:c.canvasToWorld(m),arc2End:c.canvasToWorld(w),arc2Start:c.canvasToWorld(v)}}}}const S=e.invalidated;return e.invalidated=!1,S&&Gt(e,l,Nt.StatsUpdated),x}};oT.toolName="CobbAngle";let dw=oT;function mme(t,e){const r=t.cachedStats[e],{angle:n}=r;return n===void 0?void 0:[`${n.toFixed(2)} `]}const{transformWorldToIndex:O4}=gn,aT=class aT extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:vme,displayBothAxesDistances:!1}}){super(e,r),this.addNewAnnotation=n=>{if(this.startedDrawing)return;this.startedDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;if(!(l instanceof qn))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");St(a),this.isDrawing=!0;const f=this.createAnnotation(n,[[...s],[...s]]);Ft(f,a);const u=vt(a,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:u,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(u),f},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ir([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;if(this.startedDrawing&&f.handles.points.length===1){this.editData.handleIndex=1;return}this.startedDrawing=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const u=Ce(o),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a),this.editData=null,this.isDrawing=!1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l}=this.editData,{data:f}=a;if(l){const{deltaPoints:h}=i,g=h.world,{textBox:p}=f.handles,{worldPosition:m}=p;m[0]+=g[0],m[1]+=g[1],m[2]+=g[2],p.hasMoved=!0}else if(c===void 0){const{deltaPoints:h}=i,g=h.world;f.handles.points.forEach(m=>{m[0]+=g[0],m[1]+=g[1],m[2]+=g[2]}),a.invalidated=!0}else{const{currentPoints:h}=i,g=h.world;f.handles.points[c]=[...g],a.invalidated=!0}this.editData.hasMoved=!0;const u=Ce(o),{renderingEngine:d}=u;Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,this.startedDrawing=!1,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m}=p.handles;u.annotationUID=g;const w=this.getStyle("color",u,h),v=m.map(M=>a.worldToCanvas(M));if(!p.cachedStats[l]||p.cachedStats[l].xValues==null?(p.cachedStats[l]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let y="0";if(l1(i,g,y,v[0],{color:w},0),o=!0,v.length!==2)return o;if(y="1",l1(i,g,y,v[1],{color:w},1),p.cachedStats[l].isUnitless){const M=`${g}-line-1`;Yt(i,g,"1",v[0],v[1],{color:w,width:1,shadow:this.configuration.shadow},M)}else{const M=v[0],R=v[1],A=R[1]-M[1],B=R[0]-M[0],k=p.cachedStats[l].isHorizontal;let L=[0,0];k?L=[M[0]+B,M[1]]:L=[M[0],M[1]+A];let F=`${g}-line-1`,j="1";Yt(i,g,j,v[0],L,{color:w,width:1,shadow:this.configuration.shadow},F),F=`${g}-line-2`,j="2",Yt(i,g,j,v[1],L,{color:w,width:1,lineDash:[1,1],shadow:this.configuration.shadow},F)}const x=this.getLinkedTextBoxStyle(u,h);if(!x.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const T=this.configuration.getTextLines(p,l,this.configuration);if(!p.handles.textBox.hasMoved){const M=v[1];p.handles.textBox.worldPosition=a.canvasToWorld(M)}const S=a.worldToCanvas(p.handles.textBox.worldPosition),E=Ei(i,g,"1",T,S,v,{},x),{x:D,y:b,width:I,height:O}=E;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([D,b]),topRight:a.canvasToWorld([D+I,b]),bottomLeft:a.canvasToWorld([D,b+O]),bottomRight:a.canvasToWorld([D+I,b+O])}}return o},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(e,r,n,i){}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;const s=vt(o,this.getToolName());let c;n.worldPosition||(c=a.handles.points.findIndex(u=>u===n)),this.editData={handleIndex:c,annotation:r,viewportIdsToRender:s},this._activateModify(o),St(o);const l=Ce(o),{renderingEngine:f}=l;Me(s),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport;if(i.handles.points.length!==2)return;const{cachedStats:a}=i,s=Object.keys(a);for(let l=0;l<s.length;l++){const f=s[l],u=this.getTargetImageData(f);if(!u)continue;const{imageData:d}=u,h=i.handles.points[0],g=i.handles.points[1],p=O4(d,h),m=O4(d,g),{values:w,units:v}=h1(u,[p]),{values:y,units:C}=h1(u,[m]);let x,T,S,_,E=!1;if(v[0]!==C[0]||v[1]!==C[1]||v[0]==="raw"&&C[0]==="raw"){const D=Os(h,g);x=[D,0],T=[D,0],S=["px"],E=!0}else{const D=n.viewport.worldToCanvas(h),b=n.viewport.worldToCanvas(g),I=b[1]-D[1],O=b[0]-D[0];_=Math.abs(O)>Math.abs(I),x=[w[0],y[0]],T=[w[1],y[1]],S=[v[0],v[1]]}a[f]={xValues:x,yValues:T,isHorizontal:_,units:S,isUnitless:E}}const c=e.invalidated;return e.invalidated=!1,c&&Gt(e,o,Nt.StatsUpdated),a}};aT.toolName="UltrasoundDirectionalTool";let hw=aT;function vme(t,e,r){const n=t.cachedStats[e],{xValues:i,yValues:o,units:a,isUnitless:s,isHorizontal:c}=n;if(s)return[`${Ht(i[0])} px`];if(r.displayBothAxesDistances){const l=Math.abs(i[1]-i[0]),f=Math.abs(o[1]-o[0]);return[`${Ht(l)} ${a[0]}`,`${Ht(f)} ${a[1]}`]}if(c){const l=Math.abs(i[1]-i[0]);return[`${Ht(l)} ${a[0]}`]}else{const l=Math.abs(o[1]-o[0]);return[`${Ht(l)} ${a[1]}`]}}function yme(t){return(t%360+360)%360}function gw(t,e){const r=e[0]-t[0],n=e[1]-t[1],i=Math.atan2(n,r)*(180/Math.PI);return yme(i)}function D1(t,e){const r=gw(t,e[0]),n=gw(t,e[1]);return r<n?[r,n]:[n,r]}function pw(t){if(!t.length)return[];t.sort((r,n)=>r[0]-n[0]);const e=[t[0].slice()];for(let r=1;r<t.length;r++){const n=e[e.length-1],i=t[r];i[0]<=n[1]?n[1]=Math.max(n[1],i[1]):e.push(i.slice())}return e}function P4(t,e){const[r,n]=e;if(n<=r)return[];const i=t.map(([f,u])=>[Math.max(f,r),Math.min(u,n)]).filter(([f,u])=>u>f);if(i.length===0)return[[r,n]];i.sort((f,u)=>f[0]-u[0]);const o=[];let[a,s]=i[0];for(let f=1;f<i.length;f++){const[u,d]=i[f];u<=s?s=Math.max(s,d):(o.push([a,s]),[a,s]=[u,d])}o.push([a,s]);const c=[];let l=r;for(const[f,u]of o)f>l&&c.push([l,f]),l=Math.max(l,u);return l<n&&c.push([l,n]),c}function xL(t,e){const r=[];for(const n of e){const i=Math.max(t[0],n[0]),o=Math.min(t[1],n[1]);i<o&&r.push([i,o])}return r}function wme(t,e,r){const n=e.map(f=>D1(t,f)),i=pw(n),o=i.reduce((f,[u,d])=>f+(d-u),0);if(o===0)return 0;const a=[];for(const f of r){const u=D1(t,f),d=xL(u,i);a.push(...d)}const l=pw(a).reduce((f,[u,d])=>f+(d-u),0)/o*100;return Math.min(100,Math.max(0,l))}const{transformIndexToWorld:R4}=gn,er=class er extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Cme,center:null,innerRadius:null,outerRadius:null,startAngle:null,endAngle:null,bLineColor:"rgb(60, 255, 60)",pleuraColor:"rgb(0, 4, 255)",drawDepthGuide:!0,depth_ratio:.5,depthGuideColor:"rgb(0, 255, 255)",depthGuideThickness:4,depthGuideDashLength:20,depthGuideDashGap:16,depthGuideOpacity:.2,fanOpacity:.1,showFanAnnotations:!0,updatePercentageCallback:null,actions:{undo:{method:"undo",bindings:[{key:"z"}]},redo:{method:"redo",bindings:[{key:"y"}]}}}}){super(e,r),this.pleuraAnnotations=[],this.bLineAnnotations=[],this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;St(a),this.isDrawing=!0;const{viewPlaneNormal:f,viewUp:u,position:d}=l.getCamera(),h=this.getReferencedImageId(l,s,f,u),g={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[s]}),toolName:this.getToolName(),referencedImageId:h,viewUp:u,cameraPosition:d},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null},annotationType:this.getActiveAnnotationType(),label:""}};Ft(g,a);const p=vt(a,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:p,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(p),g},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ir([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&En(a),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{viewport:a}=Ce(o)||{};if(!a)return;const{annotation:s,viewportIdsToRender:c,handleIndex:l,movingTextBox:f,newAnnotation:u}=this.editData,{data:d}=s;if(this.createMemo(o,s,{newAnnotation:u}),f){const{deltaPoints:h}=i,g=h.world,{textBox:p}=d.handles,{worldPosition:m}=p;m[0]+=g[0],m[1]+=g[1],m[2]+=g[2],p.hasMoved=!0}else if(l===void 0){const{deltaPoints:h}=i,g=h.world,p=d.handles.points;p.every(w=>{const v=[w[0]+g[0],w[1]+g[1],w[2]+g[2]];return this.isInsideFanShape(a,v)})&&(p.forEach(w=>{w[0]+=g[0],w[1]+=g[1],w[2]+=g[2]}),s.invalidated=!0)}else{const{currentPoints:h}=i,g=h.world;this.isInsideFanShape(a,g)&&(d.handles.points[l]=[...g],s.invalidated=!0)}this.editData.hasMoved=!0,Me(c),s.invalidated&&Gt(s,o,Nt.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Vt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&En(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;if(!this.getFanShapeGeometryParameters(a))return;const{imageData:c}=a.getImageData()||{};if(!c)return o;this.configuration.drawDepthGuide&&this.drawDepthGuide(i,a);let l=$t(this.getToolName(),s);if(!l?.length||(l=this.filterInteractableAnnotationsForElement(s,l),!l?.length))return o;this.getTargetId(a),a.getRenderingEngine();const f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=a.worldToCanvas(R4(c,this.configuration.center)),d=this.getIndexToCanvasRatio(a),h=this.configuration.innerRadius*d,g=this.configuration.outerRadius*d,p=a.getCurrentImageId(),m=l.filter(S=>S.data.annotationType===er.USPleuraBLineAnnotationType.PLEURA&&S.metadata.referencedImageId===p).map(S=>{const _=S.data.handles.points.map(D=>a.worldToCanvas(D));return D1(u,_)}),w=pw(m),v=[],y=[],C=S=>{const{annotationUID:_,data:E}=S,{points:D,activeHandleIndex:b}=E.handles;f.annotationUID=_;const{color:I,lineWidth:O,lineDash:M,shadow:R}=this.getAnnotationStyle({annotation:S,styleSpecifier:f}),A=D.map(F=>a.worldToCanvas(F));if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let B;if(!mr(_))return;!pr(_)&&!this.editData&&b!==null&&(B=[A[b]]),B&&Wn(i,_,"0",A,{color:this.getColorForLineType(S),fill:this.getColorForLineType(S),lineDash:M,lineWidth:O});const k=`${_}-line`;if(Yt(i,_,"1",A[0],A[1],{color:this.getColorForLineType(S),width:O,lineDash:M,shadow:R},k),this.configuration.showFanAnnotations){const F=D1(u,A);let j=0;S.data.annotationType===er.USPleuraBLineAnnotationType.BLINE?P4(y,F).forEach(ie=>{xL(ie,w).forEach(ae=>{j++;const de=j,we=`${_}-fan-${de}`,_e=`2-${de}`;B5(i,_,_e,u,h,g,ae[0],ae[1],{color:"transparent",fill:this.getColorForLineType(S),fillOpacity:this.configuration.fanOpacity,width:O,lineDash:M,shadow:R},we,10),y.push(ae)})}):S.data.annotationType===er.USPleuraBLineAnnotationType.PLEURA&&P4(v,F).forEach((ie,fe)=>{j++;const ae=j,de=`${_}-fan-${ae}`,we=`2-${ae}`;B5(i,_,we,u,h,g,ie[0],ie[1],{color:"transparent",fill:this.getColorForLineType(S),fillOpacity:this.configuration.fanOpacity,width:O,lineDash:M,shadow:R},de,5),v.push(ie)})}};return l.filter(S=>S.data.annotationType===er.USPleuraBLineAnnotationType.PLEURA&&S.metadata.referencedImageId===p).forEach(S=>{if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;C(S)}),l.filter(S=>S.data.annotationType===er.USPleuraBLineAnnotationType.BLINE&&S.metadata.referencedImageId===p).forEach(S=>{if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;C(S)}),o=!0,this.configuration.updatePercentageCallback&&a&&this.configuration.updatePercentageCallback(this.calculateBLinePleuraPercentage(a)),o},this.activeAnnotationType=er.USPleuraBLineAnnotationType.BLINE}static filterAnnotations(e,r=()=>!0){const n=$t(er.toolName,e);return n?.length?n.filter(o=>{const a=o.metadata.referencedImageId;return r(a)}):[]}static countAnnotations(e,r=()=>!0){const n=$t(er.toolName,e),{viewport:i}=Ce(e),o=i.getImageIds(),a=c=>{const l=o.findIndex(f=>f===c);return l===-1?0:l};if(!n?.length)return;const s=new Map;return n.forEach(c=>{const l=c.metadata.referencedImageId;if(!r(l))return;const{annotationType:f}=c.data;let u;s.has(l)?u=s.get(l):u={frame:a(l),bLine:0,pleura:0},f===er.USPleuraBLineAnnotationType.PLEURA?u.pleura++:f===er.USPleuraBLineAnnotationType.BLINE&&u.bLine++,s.set(l,u)}),s}static deleteAnnotations(e,r=()=>!1){const n=$t(er.toolName,e);n?.length&&n.forEach(i=>{r(i.metadata.referencedImageId)&&kt(i.annotationUID)})}setActiveAnnotationType(e){this.activeAnnotationType=e}getActiveAnnotationType(){return this.activeAnnotationType}deleteLastAnnotationType(e,r){let n;const i=$t(er.toolName,e);if(r===er.USPleuraBLineAnnotationType.PLEURA?n=i.filter(o=>o.data.annotationType===er.USPleuraBLineAnnotationType.PLEURA):r===er.USPleuraBLineAnnotationType.BLINE&&(n=i.filter(o=>o.data.annotationType===er.USPleuraBLineAnnotationType.BLINE)),n?.length>0){const o=n.pop();kt(o.annotationUID)}}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o),Me(l),e.preventDefault()}isInsideFanShape(e,r){if(!this.getFanShapeGeometryParameters(e))return!1;const{imageData:n}=e.getImageData()||{};if(n){const i=e.worldToCanvas(n.indexToWorld(this.configuration.center)),o=e.worldToCanvas(r),a=gw(i,o);return a>=this.configuration.startAngle&&a<=this.configuration.endAngle}}updateFanGeometryConfiguration(e){e&&(this.isFanShapeGeometryParametersValid(e)&&(this.configuration.center=[e.center[0],e.center[1],0]),this.configuration.innerRadius=e.innerRadius,this.configuration.outerRadius=e.outerRadius,this.configuration.startAngle=e.startAngle,this.configuration.endAngle=e.endAngle)}deriveFanGeometryFromViewport(e){const r=e.getCurrentImageId(),{fanGeometry:n}=N3(r)||{};n&&this.updateFanGeometryConfiguration(n)}isFanShapeGeometryParametersValid(e){return e||(e=this.configuration),e?.center&&e?.innerRadius>0&&e?.outerRadius&&e?.startAngle>0&&e?.startAngle<360&&e?.endAngle>0&&e?.endAngle<360}getFanShapeGeometryParameters(e){if(this.isFanShapeGeometryParametersValid())return!0;if(!this.isFanShapeGeometryParametersValid()){const r=e.getCurrentImageId(),n=ut("ultrasoundFanShapeGeometry",r);this.updateFanGeometryConfiguration(n)}return this.isFanShapeGeometryParametersValid()||this.deriveFanGeometryFromViewport(e),this.isFanShapeGeometryParametersValid()}calculateBLinePleuraPercentage(e){if(!this.getFanShapeGeometryParameters(e))return;const{imageData:r}=e.getImageData()||{};if(!r)return;const{element:n}=e,i=e.worldToCanvas(r.indexToWorld(this.configuration.center)),o=e.getCurrentImageId(),a=$t(this.getToolName(),n)||[],s=a.filter(l=>l.data.annotationType===er.USPleuraBLineAnnotationType.PLEURA&&l.metadata.referencedImageId===o).map(l=>l.data.handles.points.map(u=>e.worldToCanvas(u))),c=a.filter(l=>l.data.annotationType===er.USPleuraBLineAnnotationType.BLINE&&l.metadata.referencedImageId===o).map(l=>l.data.handles.points.map(u=>e.worldToCanvas(u)));return wme(i,s,c)}getColorForLineType(e){const{annotationType:r}=e.data,{bLineColor:n,pleuraColor:i}=this.configuration;return r===er.USPleuraBLineAnnotationType.BLINE?n:r===er.USPleuraBLineAnnotationType.PLEURA?i:n}getIndexToCanvasRatio(e){const{imageData:r}=e.getImageData()||{},n=e.worldToCanvas(r.indexToWorld([1,0,0])),i=e.worldToCanvas(r.indexToWorld([2,0,0])),o=[i[0]-n[0],i[1]-n[1]];return Math.sqrt(o[0]*o[0]+o[1]*o[1])}drawDepthGuide(e,r){if(!this.getFanShapeGeometryParameters(r))return;const{imageData:n}=r.getImageData()||{};if(!n)return;const i=g=>g*180/Math.PI,o=g=>g*Math.PI/180,a=g=>r.worldToCanvas(R4(n,g)),s=this.configuration.innerRadius+this.configuration.depth_ratio*(this.configuration.outerRadius-this.configuration.innerRadius),c=this.configuration.startAngle,f=this.configuration.endAngle-c,u=o(f)*s;let d=Math.round(u/(this.configuration.depthGuideDashLength+this.configuration.depthGuideDashGap));d<=0&&(d=Math.max(15,Math.round(f/5)));const h=f/d;for(let g=0;g<d;g++){const p=o(c+g*h),m=o(c+g*h+i(this.configuration.depthGuideDashLength)/s),w=[this.configuration.center[0]+s*Math.cos(p),this.configuration.center[1]+s*Math.sin(p),0],v=[this.configuration.center[0]+s*Math.cos(m),this.configuration.center[1]+s*Math.sin(m),0];Yt(e,r.id,`depthGuide-${g}`,a(w),a(v),{color:this.configuration.depthGuideColor,lineWidth:this.configuration.depthGuideThickness,strokeOpacity:this.configuration.depthGuideOpacity})}}_isInsideVolume(e,r,n){return Or(e,n)&&Or(r,n)}};er.toolName="UltrasoundPleuraBLineTool",er.USPleuraBLineAnnotationType={BLINE:"bLine",PLEURA:"pleura"},er.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=er.hydrateBase(er,i,r,n),{toolInstance:f,...u}=n||{},d={annotationUID:n?.annotationUID||un(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(d,l.element),Me([l.id])};let mw=er;function Cme(t,e){return[""]}const uh=class uh extends $n{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:xme,changeTextCallback:Tme,canvasPosition:[10,10],canvasSize:10,handleRadius:"6",seriesLevel:!1,isPoint:!1}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c}=s,l=a.world,f=this.constructor.createAnnotationForViewport(c,{data:{handles:{points:[[...l]]},seriesLevel:this.configuration.seriesLevel,isPoint:this.configuration.isPoint}});Ft(f,o);const u=vt(o,this.getToolName());return n.preventDefault(),Me(u),this.configuration.getTextCallback(d=>{if(!d){kt(f.annotationUID),Me(u),this.isDrawing=!1;return}f.data.label=d,En(f),Me(u)}),this.createMemo(o,f,{newAnnotation:!0}),f},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i;if(!l?.isPoint)return!1;const{canvasPosition:f,canvasSize:u}=this.configuration;return f?.length?Math.abs(o[0]-f[0]+u/2)<=u/2&&Math.abs(o[1]-f[1]+u/2)<=u/2:!1},this.toolSelectedCallback=(n,i)=>{i.highlighted=!0,n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{viewportId:l,renderingEngine:f}=Ce(o);this.eventDispatchDetail={viewportId:l,renderingEngineId:f.id},this._deactivateModify(o),Vt(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&En(a)},this.doubleClickCallback=n=>{const i=n.detail,{element:o}=i;let a=$t(this.getToolName(),o);if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return;const s=a.find(l=>this.isPointNearTool(o,l,i.currentPoints.canvas,6));if(!s)return;const c=s;this.createMemo(o,c),this.configuration.changeTextCallback(s,n.detail,this._doneChangingTextCallback.bind(this,o,c)),this.isDrawing=!1,this.doneEditMemo(),n.stopImmediatePropagation(),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,newAnnotation:f}=this.editData,{data:u}=c;this.createMemo(a,c,{newAnnotation:f}),u.handles.points[0]=[...s],c.invalidated=!0,Me(l)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u;l.annotationUID=d;const{color:g,lineWidth:p}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),{canvasPosition:m,canvasSize:w}=this.configuration,v="1";if(h?.isPoint){const y=h.handles.points[0],C=a.worldToCanvas(y);Wn(i,d,v,[C],{color:g,lineWidth:p,handleRadius:this.configuration.handleRadius})}else m?.length&&u1(i,d,v,m.map(y=>y+w),m,{color:g,width:1});if(o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o}return o}}handleSelectedCallback(e,r){const n=e.detail,{element:i}=n;r.highlighted=!0;const o=vt(i,this.getToolName());this.editData={annotation:r,viewportIdsToRender:o},this._activateModify(i),St(i),Me(o),e.preventDefault()}static setPoint(e,r=!e.data.isPoint,n){e.data.isPoint=r,Gt(e,n)}_doneChangingTextCallback(e,r,n){r.data.label=n;const i=vt(e,this.getToolName());Me(i),Gt(r,e)}cancel(e){if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(e),Vt(e);const{annotation:r,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:o}=r;return r.highlighted=!1,o.handles.activeHandleIndex=null,Me(n),i&&En(r),this.editData=null,r.annotationUID}}_isInsideVolume(e,r,n){return Or(e,n)&&Or(r,n)}};uh.toolName="KeyImage",uh.dataSeries={data:{seriesLevel:!0}},uh.dataPoint={data:{isPoint:!0}};let vw=uh;function xme(t){return t(prompt("Enter your annotation:"))}function Tme(t,e,r){return r(prompt("Enter your annotation:"))}class TL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.preMouseDownCallback=n=>this._deleteNearbyAnnotations(n,"mouse"),this.preTouchStartCallback=n=>this._deleteNearbyAnnotations(n,"touch")}_deleteNearbyAnnotations(e,r){const{renderingEngineId:n,viewportId:i,element:o,currentPoints:a}=e.detail,s=lr(i,n);if(!s)return!1;const c=s._toolInstances,l=[];for(const f in c){const u=c[f];if(typeof u.isPointNearTool!="function"||typeof u.filterInteractableAnnotationsForElement!="function")continue;const d=$t(f,o),h=u.filterInteractableAnnotationsForElement(o,d);if(h)for(const g of h)u.isPointNearTool(o,g,a.canvas,10,r)&&l.push(g.annotationUID)}for(const f of l){ia(f);const u=vn(f);$n.createAnnotationMemo(o,u,{deleting:!0}),kt(f)}return e.preventDefault(),!0}}TL.toolName="Eraser";const{transformWorldToIndex:A4,transformIndexToWorld:Sme}=gn,fh=class fh extends vr{constructor(e,r){const n=jr({configuration:{positiveStdDevMultiplier:pA,shrinkExpandIncrement:.1,islandRemoval:{enabled:!1}}},r);super(e,n)}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=Ce(n),{viewport:s,renderingEngine:c}=a,{viewUp:l}=s.getCamera(),{segmentationId:f,segmentIndex:u,labelmapVolumeId:d,referencedVolumeId:h}=await this.getLabelmapSegmentationData(s);if(!this._isOrthogonalView(s,h))throw new Error("Oblique view is not supported yet");return this.growCutData={metadata:{...s.getViewReference({points:[o]}),viewUp:l},segmentation:{segmentationId:f,segmentIndex:u,labelmapVolumeId:d,referencedVolumeId:h},viewportId:s.id,renderingEngineId:c.id},e.preventDefault(),!0}shrink(){this._runLastCommand({shrinkExpandAmount:-this.configuration.shrinkExpandIncrement})}expand(){this._runLastCommand({shrinkExpandAmount:this.configuration.shrinkExpandIncrement})}refresh(){this._runLastCommand()}async getGrowCutLabelmap(e){throw new Error("Not implemented")}async runGrowCut(){const{growCutData:e,configuration:r}=this,{segmentation:{segmentationId:n,segmentIndex:i,labelmapVolumeId:o}}=e,a=Ae.getVolume(o);let s=0;const c=async({shrinkExpandAmount:l=0}={})=>{l!==0&&(this.seeds=null),s+=l;const f=Math.max(.1,r.positiveStdDevMultiplier+s),u=l<0?Math.max(1,X5-Math.abs(s)*3):X5+s*3,d={...e,options:{...e.options||{},positiveSeedValue:i,negativeSeedValue:255,positiveStdDevMultiplier:f,negativeSeedMargin:u}},h=await this.getGrowCutLabelmap(d),{isPartialVolume:g}=r;(g?this.applyPartialGrowCutLabelmap:this.applyGrowCutLabelmap)(n,i,a,h),this._removeIslands(d)};await c(),fh.lastGrowCutCommand=c,this.growCutData=null}applyPartialGrowCutLabelmap(e,r,n,i){const o=i.voxelManager.getCompleteScalarDataArray(),a=n.voxelManager,[s,c,l]=i.dimensions,[f,u]=n.dimensions,d=s*c,h=f*u;for(let g=0;g<l;g++)for(let p=0;p<c;p++){const m=[0,p,g],w=Sme(i.imageData,m),v=A4(n.imageData,w),[y,C,x]=v,T=p*s+g*d,S=y+C*f+x*h;for(let _=0;_<s;_++){const E=o[T+_]===r?r:0;a.setAtIndex(S+_,E)}}ui(e)}applyGrowCutLabelmap(e,r,n,i){const o=n.voxelManager;i.voxelManager.forEach(({value:s,index:c})=>{s===r&&o.setAtIndex(c,s)}),ui(e)}_runLastCommand({shrinkExpandAmount:e=0}={}){const r=fh.lastGrowCutCommand;r&&r({shrinkExpandAmount:e})}async getLabelmapSegmentationData(e){const r=Oc(e.id);if(!r)throw new Error("No active segmentation found");const{segmentationId:n}=r,i=no(n),{representationData:o}=Ut(n),a=o[yt.Labelmap];let{volumeId:s,referencedVolumeId:c}=a;if(!s){const l=e.getImageIds();if(Nl(l))s=X0(n).volumeId;else{const f=e.getCurrentImageId(),u=Ae.getImage(f),d=Th(f);c=this._createFakeVolume([u.imageId,d.imageId]).volumeId;const g=kl(e.id,n),p=Th(g);s=this._createFakeVolume([g,p.imageId]).volumeId}}if(!c){const{imageIds:l}=a,f=l.map(h=>Ae.getImage(h).referencedImageId),u=Ae.generateVolumeId(f),d=Ae.getVolume(u);c=d?d.volumeId:(await pg(u,f)).volumeId}return{segmentationId:n,segmentIndex:i,labelmapVolumeId:s,referencedVolumeId:c}}_createFakeVolume(e){const r=Ae.generateVolumeId(e),n=Ae.getVolume(r);if(n)return n;const i=hg(e,r),o=i.spacing;o[2]===0&&(o[2]=1);const a=new lf({volumeId:r,dataType:i.dataType,metadata:structuredClone(i.metadata),dimensions:i.dimensions,spacing:i.spacing,origin:i.origin,direction:i.direction,referencedVolumeId:i.referencedVolumeId,imageIds:i.imageIds,referencedImageIds:i.referencedImageIds});return Ae.putVolumeSync(r,a),a}_isOrthogonalView(e,r){const i=Ae.getVolume(r).imageData,o=e.getCamera(),{ijkVecColDir:a,ijkVecSliceDir:s}=l2(i,o);return[a,s].every(c=>Dt(Math.abs(c[0]),1)||Dt(Math.abs(c[1]),1)||Dt(Math.abs(c[2]),1))}getRemoveIslandData(e){}_removeIslands(e){const{islandRemoval:r}=this.configuration;if(!r.enabled)return;const{segmentation:{segmentIndex:n,labelmapVolumeId:i},renderingEngineId:o,viewportId:a}=e,s=Ae.getVolume(i),c=this.getRemoveIslandData(e);if(!c)return;const[l,f]=s.dimensions,u=l*f,{worldIslandPoints:d=[],islandPointIndexes:h=[]}=c;let g=[...c?.ijkIslandPoints??[]];const m=Bn(o).getViewport(a),{voxelManager:w}=s,v=new of;g=g.concat(d.map(y=>A4(s.imageData,y))),g=g.concat(h.map(y=>{const C=y%l,x=Math.floor(y/l)%f,T=Math.floor(y/u);return[C,x,T]})),v.initialize(m,w,{points:g,previewSegmentIndex:n,segmentIndex:n}),v.floodFillSegmentIsland(),v.removeExternalIslands(),v.removeInternalIslands()}getSegmentStyle({segmentationId:e,viewportId:r,segmentIndex:n}){return zP({segmentationId:e,segmentIndex:n,viewportId:r})}};fh.lastGrowCutCommand=null;let D0=fh;D0.toolName="GrowCutBaseTool";const sT=class sT extends D0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{isPartialVolume:!0,positiveSeedVariance:.5,negativeSeedVariance:.9}}){super(e,r),this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,{world:s}=a,c=Ce(o),{viewport:l}=c;this.growCutData.circleBorderPoint=s,Me([l.id])},this._endCallback=async n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a;this.runGrowCut(),this._deactivateDraw(o),this.growCutData=null,Vt(o),Me([s.id])},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback)}}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=Ce(n),{viewport:s,renderingEngine:c}=a;return await super.preMouseDownCallback(e),Object.assign(this.growCutData,{circleCenterPoint:o,circleBorderPoint:o}),this._activateDraw(n),St(n),Me([s.id]),!0}async getGrowCutLabelmap(e){const{segmentation:{referencedVolumeId:r},renderingEngineId:n,viewportId:i,circleCenterPoint:o,circleBorderPoint:a,options:s}=e,l=Bn(n).getViewport(i),f=p0(an(Ie(),o,a));return hA(r,{center:o,radius:f},l,s)}_activateDraw(e){e.addEventListener(V.MOUSE_UP,this._endCallback),e.addEventListener(V.MOUSE_DRAG,this._dragCallback),e.addEventListener(V.MOUSE_CLICK,this._endCallback)}renderAnnotation(e,r){if(!this.growCutData)return;const{viewport:n}=e,{segmentation:i,circleCenterPoint:o,circleBorderPoint:a}=this.growCutData,s=n.worldToCanvas(o),c=n.worldToCanvas(a),l=Mo(xt(),c,s),f=gU(l);if(Dt(f,0))return;const u="growcut",d="0",{color:h}=this.getSegmentStyle({segmentationId:i.segmentationId,segmentIndex:i.segmentIndex,viewportId:n.id});Si(r,u,d,s,f,{color:h})}};sT.toolName="RegionSegment";let yw=sT;const cT=class cT extends D0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{isPartialVolume:!1,positiveSeedVariance:.4,negativeSeedVariance:.9,subVolumePaddingPercentage:.1,islandRemoval:{enabled:!1}}}){super(e,r),this.mouseTimer=null,this.allowedToProceed=!1}mouseMoveCallback(e){if(this.mode!==_n.Active)return;const r=e.detail,{currentPoints:n,element:i}=r,{world:o}=n;i.style.cursor="default",this.mouseTimer!==null&&(window.clearTimeout(this.mouseTimer),this.mouseTimer=null),this.mouseTimer=window.setTimeout(()=>{this.onMouseStable(e,o,i)},this.configuration.mouseStabilityDelay||500)}async onMouseStable(e,r,n){await super.preMouseDownCallback(e);const i=Ae.getVolume(this.growCutData.segmentation.referencedVolumeId),o=mA(i,r,{})||{positiveSeedIndices:new Set,negativeSeedIndices:new Set},{positiveSeedIndices:a,negativeSeedIndices:s}=o;let c;a.size/s.size>20||s.size<30?(c="not-allowed",this.allowedToProceed=!1):(c="copy",this.allowedToProceed=!0);const l=Ce(n);n&&(n.style.cursor=c,requestAnimationFrame(()=>{n.style.cursor!==c&&(n.style.cursor=c)})),this.allowedToProceed&&(this.seeds=o),l&&l.viewport&&l.viewport.render()}async preMouseDownCallback(e){if(!this.allowedToProceed)return!1;const r=e.detail,{currentPoints:n,element:i}=r;Ce(i)&&(i.style.cursor="wait",requestAnimationFrame(()=>{i.style.cursor!=="wait"&&(i.style.cursor="wait")}));const{world:a}=n;return await super.preMouseDownCallback(e),this.growCutData=jr(this.growCutData,{worldPoint:a,islandRemoval:{worldIslandPoints:[a]}}),this.growCutData.worldPoint=a,this.growCutData.islandRemoval={worldIslandPoints:[a]},await this.runGrowCut(),i&&(i.style.cursor="default"),!0}getRemoveIslandData(e){const{worldPoint:r}=e;return{worldIslandPoints:[r]}}async getGrowCutLabelmap(e){const{segmentation:{referencedVolumeId:r},worldPoint:n,options:i}=e,{subVolumePaddingPercentage:o}=this.configuration,a={...i,subVolumePaddingPercentage:o,seeds:this.seeds};return vA({referencedVolumeId:r,worldPosition:n,options:a})}};cT.toolName="RegionSegmentPlus";let ww=cT;const _me=[-1/0,-995],Eme=[0,1900],bme=[1e3,1900],{transformWorldToIndex:Ap,transformIndexToWorld:_y}=gn;class SL extends D0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{isPartialVolume:!0,positivePixelRange:Eme,negativePixelRange:_me,islandRemoval:{enabled:!0,islandPixelRange:bme}}}){super(e,r),this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,{world:s}=a,c=Ce(o),{viewport:l}=c,f=this._getHorizontalLineWorldPoints(c,s);this.growCutData.horizontalLines[1]=f,Me([l.id])},this._endCallback=async n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a;await this.runGrowCut(),this._deactivateDraw(o),this.growCutData=null,Vt(o),Me([s.id])},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback)}}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=Ce(n),{viewport:s,renderingEngine:c}=a,l=this._getHorizontalLineWorldPoints(a,o);return await super.preMouseDownCallback(e),this.growCutData.horizontalLines=[l,l],this._activateDraw(n),St(n),Me([s.id]),!0}renderAnnotation(e,r){if(!this.growCutData)return;const{segmentation:n,horizontalLines:i}=this.growCutData;if(i.length!==2)return;const{viewport:o}=e,{segmentationId:a,segmentIndex:s}=n,[c,l]=i,[f,u]=c,[d,h]=l,g=[f,u,h,d].map(T=>o.worldToCanvas(T)),p="growCutRect",m="0",{color:w,fillColor:v,lineWidth:y,fillOpacity:C,lineDash:x}=this.getSegmentStyle({segmentationId:a,segmentIndex:s,viewportId:o.id});aa(r,p,m,g,{color:w,fillColor:v,fillOpacity:C,lineWidth:y,lineDash:x,closePath:!0})}async getGrowCutLabelmap(e){const{segmentation:{segmentIndex:r,referencedVolumeId:n},renderingEngineId:i,viewportId:o,horizontalLines:a}=e,c=Bn(i).getViewport(o),[l,f]=a,u=[l[0],l[1],f[1],f[0]],d=Ae.getVolume(n),{topLeft:h,bottomRight:g}=this._getWorldBoundingBoxFromProjectedSquare(c,u),p=Ap(d.imageData,h),m=Ap(d.imageData,g),w={boundingBox:{ijkTopLeft:p,ijkBottomRight:m}},v=this.configuration,y={positiveSeedValue:r,negativeSeedValue:255,negativePixelRange:v.negativePixelRange,positivePixelRange:v.positivePixelRange};return gA(n,w,y)}getRemoveIslandData(){const{segmentation:{segmentIndex:e,referencedVolumeId:r,labelmapVolumeId:n}}=this.growCutData,i=Ae.getVolume(r),o=Ae.getVolume(n),a=i.voxelManager.getCompleteScalarDataArray(),s=o.voxelManager.getCompleteScalarDataArray(),{islandPixelRange:c}=this.configuration.islandRemoval,l=[];for(let f=0,u=s.length;f<u;f++){if(s[f]!==e)continue;const d=a[f];d>=c[0]&&d<=c[1]&&l.push(f)}return{islandPointIndexes:l}}_activateDraw(e){e.addEventListener(V.MOUSE_UP,this._endCallback),e.addEventListener(V.MOUSE_DRAG,this._dragCallback),e.addEventListener(V.MOUSE_CLICK,this._endCallback)}_projectWorldPointAcrossSlices(e,r,n){const i=this._getViewportVolume(e),{dimensions:o}=i,a=Ap(i.imageData,r),s=n.findIndex(f=>Dt(Math.abs(f),1));if(s===-1)throw new Error("Non-orthogonal direction vector");const c=[...a],l=[...a];return c[s]=0,l[s]=o[s]-1,[c,l]}_getCuboidIJKEdgePointsFromProjectedWorldPoint(e,r){const{viewPlaneNormal:n}=e.getCamera();return this._projectWorldPointAcrossSlices(e,r,n)}_getWorldCuboidCornerPoints(e,r){const n=[],i=this._getViewportVolume(e);return r.forEach(o=>{const s=this._getCuboidIJKEdgePointsFromProjectedWorldPoint(e,o).map(c=>_y(i.imageData,c));n.push(...s)}),n}_getWorldBoundingBoxFromProjectedSquare(e,r){const n=this._getWorldCuboidCornerPoints(e,r),i=[...n[0]],o=[...n[0]];return n.forEach(a=>{tU(i,i,a),nU(o,o,a)}),{topLeft:i,bottomRight:o}}_getViewportVolume(e){if(!(e instanceof ir))throw new Error("Viewport is not a BaseVolumeViewport");const r=e.getAllVolumeIds()[0];return Ae.getVolume(r)}_getHorizontalLineIJKPoints(e,r){const{viewport:n}=e,i=this._getViewportVolume(n),{dimensions:o}=i,a=Ap(i.imageData,r),{viewUp:s,viewPlaneNormal:c}=n.getCamera(),f=nn(Ie(),s,c).findIndex(h=>Dt(Math.abs(h),1)),u=[...a],d=[...a];return u[f]=0,d[f]=o[f]-1,[u,d]}_getHorizontalLineWorldPoints(e,r){const{viewport:n}=e,i=this._getViewportVolume(n),[o,a]=this._getHorizontalLineIJKPoints(e,r),s=_y(i.imageData,o),c=_y(i.imageData,a);return[s,c]}}SL.toolName="WholeBodySegment";function Dme(t,e,r=!0){const n=Object.assign({},e,{segmentIndex:0});_3(t,n)}function Ime(t,e){Dme(t,e,!0)}class _L extends af{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:_3,ERASE_INSIDE:Ime},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const f=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=Oc(l.id);if(!h)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:g}=h,p=no(g),m=hf(g),w=bs(l.id,g,p),{representationData:v}=Ut(g),y=v[yt.Labelmap],C={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:w},data:{handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null}}},x=vt(a,this.getToolName());if(this.editData={annotation:C,segmentIndex:p,segmentationId:g,segmentsLocked:m,segmentColor:w,viewportIdsToRender:x,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},l instanceof ir){const{volumeId:T}=y,S=Ae.getVolume(T);this.editData={...this.editData,volumeId:T,referencedVolumeId:S.referencedVolumeId}}else{const T=kl(l.id,g);this.editData={...this.editData,imageId:T}}return this._activateDraw(a),St(a),n.preventDefault(),Me(x),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c}=this.editData,{data:l}=a,{currentPoints:f}=i,u=Ce(o),{worldToCanvas:d,canvasToWorld:h}=u.viewport,g=f.world,{points:p}=l.handles;p[c]=[...g];let m,w,v,y,C,x,T,S;switch(c){case 0:case 3:m=d(p[0]),y=d(p[3]),w=[y[0],m[1]],v=[m[0],y[1]],x=h(w),T=h(v),p[1]=x,p[2]=T;break;case 1:case 2:w=d(p[1]),v=d(p[2]),m=[v[0],w[1]],y=[w[0],v[1]],C=h(m),S=h(y),p[0]=C,p[3]=S;break}a.invalidated=!0,this.editData.hasMoved=!0,Me(s)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=a;if(s&&!c)return;l.handles.activeHandleIndex=null,this._deactivateDraw(o),Vt(o);const f=Ce(o),u={...this.editData,points:l.handles.points,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(f,u),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{annotation:s}=this.editData,c=s.metadata,l=s.annotationUID,f=s.data,{points:u}=f.handles,d=u.map(p=>a.worldToCanvas(p)),h=`rgb(${c.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(Og(i,l,"0",d[0],d[3],{color:h}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}_L.toolName="RectangleScissor";class EL extends af{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:B2,ERASE_INSIDE:nA},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=o.canvas,l=Ce(a),{viewport:f}=l;this.isDrawing=!0;const u=f.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=Oc(f.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,m=no(p),w=hf(p),v=bs(f.id,p,m),{representationData:y}=Ut(p),C=y.Labelmap;if(!C)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const x={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:v},data:{handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},T=[f.id];if(this.editData={annotation:x,centerCanvas:c,segmentIndex:m,segmentationId:p,segmentsLocked:w,segmentColor:v,viewportIdsToRender:T,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},f instanceof ir){const{volumeId:S}=C,_=Ae.getVolume(S);this.editData={...this.editData,volumeId:S,referencedVolumeId:_.referencedVolumeId}}else{const S=kl(f.id,p);this.editData={...this.editData,imageId:S}}return this._activateDraw(a),St(a),n.preventDefault(),Me(T),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{renderingEngine:l,viewport:f}=c,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h,centerCanvas:g}=this.editData,{data:p}=d,m=Math.abs(s[0]-g[0]),w=Math.abs(s[1]-g[1]),v=Math.sqrt(m*m+w*w),y=[g[0],g[1]+v],C=[g[0],g[1]-v],x=[g[0]-v,g[1]],T=[g[0]+v,g[1]];p.handles.points=[u(y),u(C),u(x),u(T)],d.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=a,{viewPlaneNormal:f,viewUp:u}=a.metadata;if(s&&!c)return;l.handles.activeHandleIndex=null,this._deactivateDraw(o),Vt(o);const d=Ce(o),h={...this.editData,points:l.handles.points,viewPlaneNormal:f,viewUp:u,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(d,h),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_END,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{viewportIdsToRender:s}=this.editData;if(!s.includes(a.id))return o;const{annotation:c}=this.editData,l=c.metadata,f=c.annotationUID,u=c.data,{points:d}=u.handles,h=d.map(C=>a.worldToCanvas(C)),g=h[0],p=h[1],m=[Math.floor((g[0]+p[0])/2),Math.floor((g[1]+p[1])/2)],w=Math.abs(g[1]-Math.floor((g[1]+p[1])/2)),v=`rgb(${l.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(Si(i,f,"0",m,w,{color:v}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}EL.toolName="CircleScissor";class bL extends af{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:eA,ERASE_INSIDE:tA},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;this.doneEditMemo();const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=o.canvas,l=Ce(a),{viewport:f}=l;this.isDrawing=!0;const u=f.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=Oc(f.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,m=no(p),w=hf(p),v=bs(f.id,p,m);this.isDrawing=!0;const y={metadata:{viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:v},data:{invalidated:!0,handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},C=[f.id];this.editData={annotation:y,centerCanvas:c,segmentIndex:m,segmentationId:p,segmentsLocked:w,segmentColor:v,toolGroupId:this.toolGroupId,viewportIdsToRender:C,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null};const{representationData:x}=Ut(p),T=this.getEditData({viewport:f,representationData:x,segmentsLocked:w,segmentationId:p});return this.editData={...this.editData,...T},this._activateDraw(a),St(a),n.preventDefault(),Me(C),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{renderingEngine:l,viewport:f}=c,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h,centerCanvas:g}=this.editData,{data:p}=d,m=Math.abs(s[0]-g[0]),w=Math.abs(s[1]-g[1]),v=Math.sqrt(m*m+w*w),y=[g[0],g[1]+v],C=[g[0],g[1]-v],x=[g[0]-v,g[1]],T=[g[0]+v,g[1]];p.handles.points=[u(y),u(C),u(x),u(T)],d.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c,segmentIndex:l,segmentsLocked:f}=this.editData,{data:u}=a,{viewPlaneNormal:d,viewUp:h}=a.metadata;if(s&&!c)return;a.highlighted=!1,u.handles.activeHandleIndex=null,this._deactivateDraw(o),Vt(o);const g=Ce(o),p={...this.editData,points:u.handles.points,segmentIndex:l,segmentsLocked:f,viewPlaneNormal:d,viewUp:h,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(g,p),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{viewportIdsToRender:s}=this.editData;if(!s.includes(a.id))return o;const{annotation:c}=this.editData,l=c.metadata,f=c.annotationUID,u=c.data,{points:d}=u.handles,h=d.map(C=>a.worldToCanvas(C)),g=h[0],p=h[1],m=[Math.floor((g[0]+p[0])/2),Math.floor((g[1]+p[1])/2)],w=Math.abs(g[1]-Math.floor((g[1]+p[1])/2)),v=`rgb(${l.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(Si(i,f,"0",m,w,{color:v}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}bL.toolName="SphereScissor";const{transformWorldToIndex:Ey}=gn;class DL extends Qh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{simplified:!0,storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!0,getTextLines:Mme,statsCalculator:_s,showTextBox:!1,throttleTimeout:100}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u;let g,p,m;if(l instanceof qn)throw new Error("Stack Viewport Not implemented");{const _=this.getTargetId(l);m=Ms(_),p=Ae.getVolume(m),g=_c(p,s,d)}const w=Ll(p,d),v=this._getStartCoordinate(s,w,d),y=this._getEndCoordinate(s,w,d),C=l.getFrameOfReferenceUID();let x;this.configuration.simplified?x=[[...s],[...s]]:x=[[...s],[...s],[...s],[...s],[...s]];const T={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:C,referencedImageId:g,volumeId:m,spacingInNormal:w,enabledElement:c},data:{label:"",startCoordinate:v,endCoordinate:y,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:x,activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[],statistics:[]},labelmapUID:null}};this._computeProjectionPoints(T,p),Ft(T,a);const S=vt(a,this.getToolName());return this.editData={annotation:T,viewportIdsToRender:S,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(S),T},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Vt(o);const{metadata:u}=a,{enabledElement:d}=u;this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID);const h=this.getTargetId(d.viewport),g=Ae.getVolume(h.split(/volumeId:|\?/)[1]);this._computePointsInsideVolume(a,g,h,d),Me(s),c?En(a):Gt(a,o)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;let s=$t(this.getToolName(),a.element);if(!s?.length)return o;s=P2(s,a.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let l=0;l<s.length;l++){const f=s[l],{annotationUID:u,data:d,metadata:h}=f,{startCoordinate:g,endCoordinate:p}=d,{points:m,activeHandleIndex:w}=d.handles,{enabledElement:v}=h;c.annotationUID=u;const y=this.getStyle("lineWidth",c,f),C=this.getStyle("lineDash",c,f),x=this.getStyle("color",c,f),T=m.map(de=>a.worldToCanvas(de)),S=T[0],_=bl([T[0],T[1]]),{centerPointRadius:E}=this.configuration,D=ku([T[0],T[1]]),b=a.getCamera().focalPoint,I=a.getCamera().viewPlaneNormal;let O=g,M=p;Array.isArray(g)&&(O=this._getCoordinateForViewplaneNormal(O,I),d.startCoordinate=O),Array.isArray(p)&&(M=this._getCoordinateForViewplaneNormal(M,I),d.endCoordinate=M);const R=Cl(d.startCoordinate),A=Cl(d.endCoordinate),B=this._getCoordinateForViewplaneNormal(b,I),k=Cl(B);if(k<Math.min(R,A)||k>Math.max(R,A))continue;const L=Cl((d.startCoordinate+d.endCoordinate)/2);let F=!1;k===L&&(F=!0),d.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(I)]=L;const j=v.viewport?.volumeIds.values();for(const de of j)f.invalidated&&f.metadata.volumeId===de&&this._throttledCalculateCachedStats(f,v);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let J;if(!mr(u))continue;!pr(u)&&!this.editData&&w!==null&&F&&(this.configuration.simplified?J=[T[w]]:J=T),J&&Wn(i,u,"0",J,{color:x});let ie=y,fe=C;F?(ie=y,fe=[]):fe=[5,5];const ae="0";if(Si(i,u,ae,S,_,{color:x,lineDash:fe,lineWidth:ie}),E>0&&_>3*E&&Si(i,u,`${ae}-center`,S,E,{color:x,lineDash:C,lineWidth:y}),o=!0,this.configuration.showTextBox){const de=this.getLinkedTextBoxStyle(c,f);if(!de.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const we=this.configuration.getTextLines(d,{metadata:h});if(!we||we.length===0)continue;let _e;d.handles.textBox.hasMoved||(_e=po(D),d.handles.textBox.worldPosition=a.canvasToWorld(_e));const Te=a.worldToCanvas(d.handles.textBox.worldPosition),P=Ei(i,u,"1",we,Te,[T[0],T[1]],{},de),{x:$,y:W,width:q,height:Q}=P;d.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([$,W]),topRight:a.canvasToWorld([$+q,W]),bottomLeft:a.canvasToWorld([$,W+Q]),bottomRight:a.canvasToWorld([$+q,W+Q])}}}return o},this.configuration.calculatePointsInsideVolume?this._throttledCalculateCachedStats=$i(this._calculateCachedStatsTool,this.configuration.throttleTimeout,{trailing:!0}):this._throttledCalculateCachedStats=j0(this._calculateCachedStatsTool,this.configuration.throttleTimeout)}_computeProjectionPoints(e,r){const{data:n,metadata:i}=e,{viewPlaneNormal:o,spacingInNormal:a}=i,{startCoordinate:s,endCoordinate:c}=n,{points:l}=n.handles,f=this._getIndexOfCoordinatesForViewplaneNormal(o),u=ea(l[0]);u[f]=s;const d=ea(l[0]);d[f]=c;const h=Ie();qt(h,d,u);const g=_r(h);if(g===0){const w=l.map(v=>{const y=ea(v);return y[f]=s,Array.from(y)});n.cachedStats.projectionPoints=[w];return}At(h,h);const p=na(l);p[0][f]=s,p[1][f]=s;const m=[];for(let w=0;w<=g+1e-6;w+=a)m.push(p.map(v=>{const y=Ie();return tn(y,v,h,w),Array.from(y)}));n.cachedStats.projectionPoints=m}_computePointsInsideVolume(e,r,n,i){const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:c}=a,{viewport:l}=i,f=o.cachedStats.projectionPoints,u=[[]],d=this.getTargetImageData(n),h=o.handles.points.map(D=>l.worldToCanvas(D)),g=ku([h[0],h[1]])[0],p=ku([h[0],h[1]])[1],m=l.canvasToWorld(g),w=l.canvasToWorld(p),{worldWidth:v,worldHeight:y}=Ag(s,c,m,w),C=Fo(d,o.handles.points),x=n3(d),T=Math.abs(Math.PI*(v/C.scale/2)*(y/x/C.scale/2)),S={isPreScaled:Pc(l,n),isSuvScaled:this.isSuvScaled(l,n,e.metadata.referencedImageId)},_=Rc(a.Modality,e.metadata.referencedImageId,S);for(let D=0;D<f.length;D++){if(!r)continue;const b=f[D][0],I=f[D].map(de=>l.worldToCanvas(de)),[O,M]=ku([I[0],I[1]]),R=l.canvasToWorld(O),A=l.canvasToWorld(M),B=R,k=A,{dimensions:L,imageData:F,voxelManager:j}=r,J=Ey(F,B),ie=Ey(F,b),fe=this._getIndexOfCoordinatesForViewplaneNormal(s);J[0]=Math.floor(J[0]),J[1]=Math.floor(J[1]),J[2]=Math.floor(J[2]),J[fe]=ie[fe];const ae=Ey(F,k);if(ae[0]=Math.floor(ae[0]),ae[1]=Math.floor(ae[1]),ae[2]=Math.floor(ae[2]),ae[fe]=ie[fe],Qh.isInsideVolume(L,[J,ae])){const de=Math.min(J[0],ae[0]),we=Math.max(J[0],ae[0]),_e=Math.min(J[1],ae[1]),Te=Math.max(J[1],ae[1]),G=Math.min(J[2],ae[2]),P=Math.max(J[2],ae[2]),$=[[de,we],[_e,Te],[G,P]],q={center:b,xRadius:Math.abs(R[0]-A[0])/2,yRadius:Math.abs(R[1]-A[1])/2,zRadius:Math.abs(R[2]-A[2])/2},Q=j.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:ee=>C2(q,ee),boundsIJK:$,imageData:F,returnPoints:this.configuration.storePointData});u.push(Q)}}const E=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=u,o.cachedStats.statistics={Modality:a.Modality,area:T,mean:E.mean?.value,stdDev:E.stdDev?.value,max:E.max?.value,statsArray:E.array,areaUnit:C.areaUnit,modalityUnit:_}}_calculateCachedStatsTool(e,r){const n=e.data,{viewport:i}=r,{cachedStats:o}=n,a=this.getTargetId(i),s=Ae.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this._computePointsInsideVolume(e,s,a,r),e.invalidated=!1,Gt(e,i.element),o}_getStartCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=Math.round(i/2),a=Ie();return tn(a,e,n,o*-r),this._getCoordinateForViewplaneNormal(a,n)}_getEndCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=i-Math.round(i/2),a=Ie();return tn(a,e,n,o*r),this._getCoordinateForViewplaneNormal(a,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const r=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return r.indexOf(Math.max(...r))}_getCoordinateForViewplaneNormal(e,r){const n=this._getIndexOfCoordinatesForViewplaneNormal(r);return e[n]}}function Mme(t,e={}){const r=t.cachedStats.statistics,{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Ht(n)} ${s}`),l.push(`Mean: ${Ht(i)} ${c}`),l.push(`Max: ${Ht(o)} ${c}`),l.push(`Std Dev: ${Ht(a)} ${c}`),l}DL.toolName="CircleROIStartEndThreshold";const{transformWorldToIndex:L4,isEqual:by}=gn;class IL extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.preMouseDownCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c,f=l.getCamera(),{viewPlaneNormal:u}=f,d=Oc(l.id);if(!d)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:h}=d,g=no(h),p=hf(h),{representationData:m}=Ut(h);let w,v,y,C;if(this.doneEditMemo(),l instanceof ir){const{volumeId:R}=m[yt.Labelmap],A=Ae.getVolume(R);({dimensions:w,direction:v}=A),C=A.voxelManager,y=L4(A.imageData,s)}else{const R=kl(l.id,h);if(!R)throw new Error("No active segmentation imageId detected, create one before using scissors tool");const{imageData:A}=l.getImageData();w=A.getDimensions(),v=A.getDirection(),C=Ae.getImage(R).voxelManager,y=L4(A,s)}const x=this.getFixedDimension(u,v);if(x===void 0){console.warn("Oblique paint fill not yet supported");return}const{floodFillGetter:T,getLabelValue:S,getScalarDataPositionFromPlane:_,inPlaneSeedPoint:E,fixedDimensionValue:D}=this.generateHelpers(C,w,y,x);if(y[0]<0||y[0]>=w[0]||y[1]<0||y[1]>=w[1]||y[2]<0||y[2]>=w[2])return;const b=S(y[0],y[1],y[2]);if(p.includes(b))return;const I=S3(T,E),{flooded:O}=I;O.forEach(R=>{const A=_(R[0],R[1]);C.setAtIndex(A,g)});const M=this.getFramesModified(x,D,I);return ui(h,M),!0},this.getFramesModified=(n,i,o)=>{const{flooded:a}=o;if(n===2)return[i];let s=1/0,c=-1/0;for(let f=0;f<a.length;f++){const u=a[f][1];u<s&&(s=u),u>c&&(c=u)}const l=[];for(let f=s;f<=c;f++)l.push(f);return l},this.generateHelpers=(n,i,o,a=2)=>{let s,c;switch(a){case 0:s=o[0],c=[o[1],o[2]];break;case 1:s=o[1],c=[o[0],o[2]];break;case 2:s=o[2],c=[o[0],o[1]];break;default:throw new Error(`Invalid fixedDimension: ${a}`)}const l=(h,g,p)=>n.toIndex([h,g,p]),f=(h,g,p)=>n.getAtIJK(h,g,p),u=this.generateFloodFillGetter(i,a,s,f);return{getScalarDataPositionFromPlane:this.generateGetScalarDataPositionFromPlane(l,a,s),getLabelValue:f,floodFillGetter:u,inPlaneSeedPoint:c,fixedDimensionValue:s}},this.generateFloodFillGetter=(n,i,o,a)=>{let s;switch(i){case 0:s=(c,l)=>{if(!(c>=n[1]||c<0||l>=n[2]||l<0))return a(o,c,l)};break;case 1:s=(c,l)=>{if(!(c>=n[0]||c<0||l>=n[2]||l<0))return a(c,o,l)};break;case 2:s=(c,l)=>{if(!(c>=n[0]||c<0||l>=n[1]||l<0))return a(c,l,o)};break;default:throw new Error(`Invalid fixedDimension: ${i}`)}return s},this.generateGetScalarDataPositionFromPlane=(n,i,o)=>{let a;switch(i){case 0:a=(s,c)=>n(o,s,c);break;case 1:a=(s,c)=>n(s,o,c);break;case 2:a=(s,c)=>n(s,c,o);break;default:throw new Error(`Invalid fixedDimension: ${i}`)}return a}}getFixedDimension(e,r){const n=r.slice(0,3),i=r.slice(3,6),o=r.slice(6,9),a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],s=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(by(a,s))return 0;const c=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];if(by(a,c))return 1;const l=[Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2])];if(by(a,l))return 2}}IL.toolName="PaintFill";const Ome={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"};var F3={Corners:Ome};const{vtkErrorMacro:Dy}=K,{Corners:Lp}=F3;function Pme(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");const r={...t},n=[],i=$I.newInstance(),o=new ResizeObserver(d=>{t.updateViewport()});let a=null,s=null,c=null,l=null,f=null;function u(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{const d=e.parentRenderer||e._interactor.getCurrentRenderer(),[h,g,p,m]=d.getViewport(),w=e._interactor.getView(),v=w.getSize(),[y,C]=w.getViewportSize(d),x=Math.min(y,C);let T=e.viewportSize*x;T=Math.max(Math.min(e.minPixelSize,x),Math.min(e.maxPixelSize,T));const S=T/v[0],_=T/v[1];switch(e.viewportCorner){case Lp.TOP_LEFT:return[h,m-_,h+S,m];case Lp.TOP_RIGHT:return[p-S,m-_,p,m];case Lp.BOTTOM_LEFT:return[h,g,h+S,g+_];case Lp.BOTTOM_RIGHT:return[p-S,g,p,g+_];default:return Dy("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(i.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{const h=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!h)return;const g=h.getReferenceByName("position"),p=h.getReferenceByName("focalPoint"),m=h.getReferenceByName("viewUp");if(n[0]!==g[0]||n[1]!==g[1]||n[2]!==g[2]||n[3]!==p[0]||n[4]!==p[1]||n[5]!==p[2]||n[6]!==m[0]||n[7]!==m[1]||n[8]!==m[2]){n[0]=g[0],n[1]=g[1],n[2]=g[2],n[3]=p[0],n[4]=p[1],n[5]=p[2],n[6]=m[0],n[7]=m[1],n[8]=m[2];const w=i.getActiveCamera();w.setPosition(g[0],g[1],g[2]),w.setFocalPoint(p[0],p[1],p[2]),w.setViewUp(m[0],m[1],m[2]),i.resetCamera()}},t.setEnabled=d=>{if(d){if(e.enabled)return;if(!e.actor){Dy("Must set actor before enabling orientation marker.");return}if(!e._interactor){Dy("Must set interactor before enabling orientation marker.");return}const h=e.parentRenderer||e._interactor.getCurrentRenderer(),g=h.getRenderWindow();g.addRenderer(i),g.getNumberOfLayers()<2&&g.setNumberOfLayers(2),i.setLayer(g.getNumberOfLayers()-1),i.setInteractive(e.interactiveRenderer),i.addViewProp(e.actor),e.actor.setVisibility(!0),a=h.onEvent(p=>{p.type==="ActiveCameraEvent"&&(s&&s.unsubscribe(),s=p.camera.onModified(u))}),s=h.getActiveCamera().onModified(u),c=e._interactor.onAnimation(t.updateMarkerOrientation),l=e._interactor.onEndAnimation(t.updateMarkerOrientation),o.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,o.disconnect(),a.unsubscribe(),a=null,s.unsubscribe(),s=null,c.unsubscribe(),c=null,l.unsubscribe(),l=null,e.actor.setVisibility(!1),i.removeViewProp(e.actor);const h=e._interactor?.findPokedRenderer()?.getRenderWindow();h&&h.removeRenderer(i)}t.modified()},t.setViewportCorner=d=>{d!==e.viewportCorner&&(e.viewportCorner=d,t.updateViewport())},t.setViewportSize=d=>{const h=Math.min(1,Math.max(0,d));h!==e.viewportSize&&(e.viewportSize=h,t.updateViewport())},t.setActor=d=>{const h=e.enabled;t.setEnabled(!1),e.actor=d,t.setEnabled(h)},t.getRenderer=()=>i,t.delete=()=>{r.delete(),f&&(f.unsubscribe(),f=null),a&&(a.unsubscribe(),a=null),s&&(s.unsubscribe(),s=null),c&&(c.unsubscribe(),c=null),l&&(l.unsubscribe(),l=null),o.disconnect()},f=t.onModified(t.updateViewport)}const Rme={viewportCorner:F3.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function ML(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rme,r),K.obj(t,e),K.get(t,e,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),K.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),K.get(t,e,["actor"]),K.moveToProtected(t,e,["interactor"]),Pme(t,e)}const Ame=K.newInstance(ML,"vtkOrientationMarkerWidget");var N4={newInstance:Ame,extend:ML,...F3};function OL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0];const[r,n,i,o]=e,s=t.getContext("2d").getImageData(r,n,i||t.width,o||t.height),c=dg.newInstance({type:"vtkImageData"});c.setOrigin(0,0,0),c.setSpacing(1,1,1),c.setExtent(0,(i||t.width)-1,0,(o||t.height)-1,0,0);const l=Tt.newInstance({numberOfComponents:4,values:new Uint8Array(s.data.buffer)});return l.setName("scalars"),c.getPointData().setScalars(l),c}function Lme(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const n=r.getContext("2d"),{flipX:i,flipY:o,rotate:a}=e;return n.translate(r.width/2,r.height/2),n.scale(i?-1:1,o?-1:1),n.rotate(a*Math.PI/180),n.drawImage(t,-t.width/2,-t.height/2),OL(r)}var Nme={canvasToImageData:OL,imageToImageData:Lme};const PL={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:t=>t/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function RL(t,e){e.set(t)}function Vme(t,e){return RL(PL[t],e)}function kme(t,e){PL[t]=e}var Fme={applyDefinitions:RL,applyPreset:Vme,registerStylePreset:kme};const Ume={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};function Bme(t,e){e.classHierarchy.push("vtkAnnotatedCubeActor"),e.xPlusFaceProperty={...e.xPlusFaceProperty},e.xMinusFaceProperty={...e.xMinusFaceProperty},e.yPlusFaceProperty={...e.yPlusFaceProperty},e.yMinusFaceProperty={...e.yMinusFaceProperty},e.zPlusFaceProperty={...e.zPlusFaceProperty},e.zMinusFaceProperty={...e.zMinusFaceProperty};let r=null;const n=document.createElement("canvas"),i=Ui.newInstance(),o=Ol.newInstance();o.setInterpolate(!0);function a(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;l&&Object.assign(e[`${c}FaceProperty`],l);const f={...e.defaultStyle,...e[`${c}FaceProperty`]};n.width=f.resolution,n.height=f.resolution;const u=n.getContext("2d");u.fillStyle=f.faceColor,u.fillRect(0,0,n.width,n.height),f.edgeThickness>0&&(u.strokeStyle=f.edgeColor,u.lineWidth=f.edgeThickness*n.width,u.strokeRect(0,0,n.width,n.height)),u.save(),u.translate(0,n.height),u.scale(1,-1),u.translate(n.width/2,n.height/2),u.rotate(-Math.PI*(f.faceRotation/180));const d=f.fontSizeScale(f.resolution);u.fillStyle=f.fontColor,u.textAlign="center",u.textBaseline="middle",u.font=`${f.fontStyle} ${d}px "${f.fontFamily}"`,u.fillText(f.text,0,0),u.restore();const h=Nme.canvasToImageData(n);o.setInputData(h,Ume[c]),t.modified()}function s(){r=T6.newInstance({generate3DTextureCoordinates:!0}),i.setInputConnection(r.getOutputPort()),a("xPlus"),a("xMinus"),a("yPlus"),a("yMinus"),a("zPlus"),a("zMinus")}t.setDefaultStyle=c=>{e.defaultStyle={...e.defaultStyle,...c},s()},t.setXPlusFaceProperty=c=>a("xPlus",c),t.setXMinusFaceProperty=c=>a("xMinus",c),t.setYPlusFaceProperty=c=>a("yPlus",c),t.setYMinusFaceProperty=c=>a("yMinus",c),t.setZPlusFaceProperty=c=>a("zPlus",c),t.setZMinusFaceProperty=c=>a("zMinus",c),s(),i.setInputConnection(r.getOutputPort()),t.setMapper(i),t.addTexture(o)}const Gme={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:t=>t/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function AL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gme,r),Lo.extend(t,e,r),K.get(t,e,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),Bme(t,e)}const Wme=K.newInstance(AL,"vtkAnnotatedCubeActor");var V4={newInstance:Wme,extend:AL,Presets:Fme};const{vtkErrorMacro:$me}=K;function zme(t,e){let r=0;return t.map((n,i)=>i===r?(r+=n+1,n):n+e)}function Np(t,e,r,n){t.set(zme(e,r),n)}function jme(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(r,n)=>{const i=t.getNumberOfInputPorts();if(!i){$me("No input specified.");return}if(i===1){n[0]=r[0];return}const o=n[0]&&r[0]!==n[0]?n[0].initialize():rr.newInstance();let a=0,s=0,c=1,l=1,f=0,u=0,d=0,h=0,g=!0,p=!0,m=!0;for(let b=0;b<i;b++){const I=r[b];if(!I)continue;const O=I.getPoints().getNumberOfPoints();a+=O,f+=I.getVerts().getNumberOfValues(),u+=I.getLines().getNumberOfValues(),d+=I.getStrips().getNumberOfValues(),h+=I.getPolys().getNumberOfValues(),O&&(l&&(l=0,s=I.getPoints().getDataType()),c=I.getPoints().getDataType(),s=s>c?s:c);const M=I.getPointData();M?(g=g&&M.getNormals()!==null,p=p&&M.getTCoords()!==null,m=m&&M.getScalars()!==null):(g=!1,p=!1,m=!1)}e.outputPointsPrecision===Pm.SINGLE?s=Qt.FLOAT:e.outputPointsPrecision===Pm.DOUBLE&&(s=Qt.DOUBLE);const w=Ju.newInstance({dataType:s});w.setNumberOfPoints(a);const v=w.getData(),y=new Uint32Array(f),C=new Uint32Array(u),x=new Uint32Array(d),T=new Uint32Array(h);let S=null,_=null,E=null;const D=r[i-1];if(g){const b=D.getPointData().getNormals();S=Tt.newInstance({numberOfComponents:3,numberOfTuples:a,size:3*a,dataType:b.getDataType(),name:b.getName()})}if(p){const b=D.getPointData().getTCoords();_=Tt.newInstance({numberOfComponents:2,numberOfTuples:a,size:2*a,dataType:b.getDataType(),name:b.getName()})}if(m){const b=D.getPointData().getScalars();E=Tt.newInstance({numberOfComponents:b.getNumberOfComponents(),numberOfTuples:a,size:a*b.getNumberOfComponents(),dataType:b.getDataType(),name:b.getName()})}a=0,f=0,u=0,d=0,h=0;for(let b=0;b<i;b++){const I=r[b];v.set(I.getPoints().getData(),a*3),Np(y,I.getVerts().getData(),a,f),f+=I.getVerts().getNumberOfValues(),Np(C,I.getLines().getData(),a,u),u+=I.getLines().getNumberOfValues(),Np(x,I.getStrips().getData(),a,d),d+=I.getStrips().getNumberOfValues(),Np(T,I.getPolys().getData(),a,h),h+=I.getPolys().getNumberOfValues();const O=I.getPointData();if(g){const M=O.getNormals();S.getData().set(M.getData(),a*3)}if(p){const M=O.getTCoords();_.getData().set(M.getData(),a*2)}if(m){const M=O.getScalars();E.getData().set(M.getData(),a*E.getNumberOfComponents())}a+=I.getPoints().getNumberOfPoints()}o.setPoints(w),o.getVerts().setData(y),o.getLines().setData(C),o.getStrips().setData(x),o.getPolys().setData(T),S&&o.getPointData().setNormals(S),_&&o.getPointData().setTCoords(_),E&&o.getPointData().setScalars(E),n[0]=o}}const Hme={outputPointsPrecision:Pm.DEFAULT};function LL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hme,r),K.setGet(t,e,["outputPointsPrecision"]),K.obj(t,e),K.algo(t,e,1,1),jme(t,e)}const Kme=K.newInstance(LL,"vtkAppendPolyData");var NL={newInstance:Kme,extend:LL};function Xme(t,e){e.classHierarchy.push("vtkConeSource"),t.requestData=(r,n)=>{const i=2*Math.PI/e.resolution,o=-e.height/2,a=e.resolution+1,s=4*e.resolution+1+e.resolution;let c=0;const l=K.newTypedArray(e.pointType,a*3);let f=0;const u=new Uint32Array(s);l[0]=e.height/2,l[1]=0,l[2]=0,e.capping&&(u[f++]=e.resolution);for(let h=0;h<e.resolution;h++)c++,l[c*3+0]=o,l[c*3+1]=e.radius*Math.cos(h*i),l[c*3+2]=e.radius*Math.sin(h*i),e.capping&&(u[e.resolution-f+++1]=c);for(let h=0;h<e.resolution;h++)u[f++]=3,u[f++]=0,u[f++]=h+1,u[f++]=h+2>e.resolution?1:h+2;ti.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(l);const d=n[0]?.initialize()||rr.newInstance();d.getPoints().setData(l,3),d.getPolys().setData(u,1),n[0]=d}}const qme={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function VL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qme,r),K.obj(t,e),K.setGet(t,e,["height","radius","resolution","capping"]),K.setGetArray(t,e,["center","direction"],3),K.algo(t,e,0,1),Xme(t,e)}const Yme=K.newInstance(VL,"vtkConeSource");var Jme={newInstance:Yme,extend:VL};function Zme(t,e){e.classHierarchy.push("vtkCylinderSource"),t.requestData=(r,n)=>{const i=2*Math.PI/e.resolution;let o=2*e.resolution,a=5*e.resolution;e.capping&&(o=4*e.resolution,a=7*e.resolution+2);const s=K.newTypedArray(e.pointType,o*3);let c=0;const l=new Uint32Array(a),f=new Float32Array(o*3),u=Tt.newInstance({numberOfComponents:3,values:f,name:"Normals"}),d=new Float32Array(o*2),h=Tt.newInstance({numberOfComponents:2,values:d,name:"TCoords"}),g=[0,0,0],p=[0,0,0],m=[0,0,0],w=[0,0,0],v=[0,0],y=[0,0],C=e.otherRadius==null?e.radius:e.otherRadius;for(let T=0;T<e.resolution;T++){g[0]=Math.cos(T*i+e.initAngle),p[0]=g[0],m[0]=e.radius*g[0]+e.center[0],w[0]=m[0],v[0]=Math.abs(2*T/e.resolution-1),y[0]=v[0],m[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],v[1]=0,y[1]=1,g[2]=-Math.sin(T*i+e.initAngle),p[2]=g[2],m[2]=C*g[2]+e.center[2],w[2]=m[2];const S=2*T;for(let _=0;_<3;_++)f[S*3+_]=g[_],f[(S+1)*3+_]=p[_],s[S*3+_]=m[_],s[(S+1)*3+_]=w[_],_<2&&(d[S*2+_]=v[_],d[(S+1)*2+_]=y[_])}for(let T=0;T<e.resolution;T++){l[c++]=4,l[c++]=2*T,l[c++]=2*T+1;const S=(2*T+3)%(2*e.resolution);l[c++]=S,l[c++]=S-1}if(e.capping){for(let T=0;T<e.resolution;T++){m[0]=e.radius*Math.cos(T*i+e.initAngle),w[0]=m[0],v[0]=m[0],y[0]=m[0],m[0]+=e.center[0],w[0]+=e.center[0],g[1]=1,p[1]=-1,m[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],m[2]=-C*Math.sin(T*i+e.initAngle),w[2]=m[2],v[1]=m[2],y[1]=m[2],m[2]+=e.center[2],w[2]+=e.center[2];const S=2*e.resolution+T,_=3*e.resolution+e.resolution-T-1;for(let E=0;E<3;E++)f[3*S+E]=g[E],f[3*_+E]=p[E],s[3*S+E]=m[E],s[3*_+E]=w[E],E<2&&(d[2*S+E]=v[E],d[2*_+E]=y[E])}l[c++]=e.resolution;for(let T=0;T<e.resolution;T++)l[c++]=2*e.resolution+T;l[c++]=e.resolution;for(let T=0;T<e.resolution;T++)l[c++]=3*e.resolution+T}ti.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(T=>T*-1)).apply(s);const x=n[0]?.initialize()||rr.newInstance();x.getPoints().setData(s,3),x.getPolys().setData(l,1),x.getPointData().setNormals(u),x.getPointData().setTCoords(h),n[0]=x}}const Qme={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function kL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qme,r),K.obj(t,e),K.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),K.setGetArray(t,e,["center","direction"],3),K.algo(t,e,0,1),Zme(t,e)}const e1e=K.newInstance(kL,"vtkCylinderSource");var t1e={newInstance:e1e,extend:kL};function n1e(t,e){e.classHierarchy.push("vtkArrowSource"),t.requestData=(r,n)=>{const i=t1e.newInstance({capping:!0});i.setResolution(e.shaftResolution),i.setRadius(e.shaftRadius),i.setHeight(1-e.tipLength),i.setCenter(0,(1-e.tipLength)*.5,0);const o=i.getOutputData(),a=o.getPoints().getData(),s=o.getPointData().getNormals().getData();ti.buildFromDegree().rotateZ(-90).apply(a).apply(s);const c=Jme.newInstance();c.setResolution(e.tipResolution),c.setHeight(e.tipLength),c.setRadius(e.tipRadius);const l=c.getOutputData(),f=l.getPoints().getData();ti.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(f);const u=NL.newInstance();u.setInputData(o),u.addInputData(l);const d=u.getOutputData(),h=d.getPoints().getData();ti.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(h),e.invert?(ti.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(h),n[0]=d):(ti.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(h),n[0]=u.getOutputData())}}const r1e={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function FL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r1e,r),K.obj(t,e),K.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),K.setGetArray(t,e,["direction"],3),K.algo(t,e,0,1),n1e(t,e)}const i1e=K.newInstance(FL,"vtkArrowSource");var Iy={newInstance:i1e,extend:FL};function My(t){const e=t.getPoints().getBounds(),r=[-(e[0]+e[1])*.5,-(e[2]+e[3])*.5,-(e[4]+e[5])*.5];ti.buildFromDegree().translate(...r).apply(t.getPoints().getData())}function Oy(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.getPoints().getBounds(),i=[0,0,0];r?i[e]=-n[e*2+1]:i[e]=-n[e*2],ti.buildFromDegree().translate(...i).apply(t.getPoints().getData())}function Py(t,e,r,n){const i=t.getPoints().getData().length,o=new Uint8ClampedArray(i);let a=0;for(;a<i;)o[a++]=e,o[a++]=r,o[a++]=n;t.getPointData().setScalars(Tt.newInstance({name:"color",numberOfComponents:3,values:o}))}function o1e(t,e){e.classHierarchy.push("vtkAxesActor");const r=Ui.newInstance();t.setMapper(r),t.update=()=>{let i={...e.config,...e.xConfig};const o=Iy.newInstance({direction:[1,0,0],...i}).getOutputData();e.config.recenter?My(o):Oy(o,0,i.invert),Py(o,...i.color),i={...e.config,...e.yConfig};const a=Iy.newInstance({direction:[0,1,0],...i}).getOutputData();e.config.recenter?My(a):Oy(a,1,i.invert),Py(a,...i.color),i={...e.config,...e.zConfig};const s=Iy.newInstance({direction:[0,0,1],...i}).getOutputData();e.config.recenter?My(s):Oy(s,2,i.invert),Py(s,...i.color);const c=NL.newInstance();c.setInputData(o),c.addInputData(a),c.addInputData(s),r.setInputConnection(c.getOutputPort())},t.update();const n=K.debounce(t.update,0);t.setXAxisColor=i=>t.setXConfig({...t.getXConfig(),color:i}),t.setYAxisColor=i=>t.setYConfig({...t.getYConfig(),color:i}),t.setZAxisColor=i=>t.setZConfig({...t.getZConfig(),color:i}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=n,e._onXConfigChanged=n,e._onYConfigChanged=n,e._onZConfigChanged=n}function a1e(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t?.config},xConfig:{color:[255,0,0],invert:!1,...t?.xConfig},yConfig:{color:[255,255,0],invert:!1,...t?.yConfig},zConfig:{color:[0,128,0],invert:!1,...t?.zConfig}}}function UL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Lo.extend(t,e,a1e(r)),K.setGet(t,e,["config","xConfig","yConfig","zConfig"]),o1e(t,e)}const s1e=K.newInstance(UL,"vtkAxesActor");var c1e={newInstance:s1e,extend:UL},I1;(function(t){t[t.ANNOTATED_CUBE=1]="ANNOTATED_CUBE",t[t.AXES=2]="AXES",t[t.CUSTOM=3]="CUSTOM"})(I1||(I1={}));const is=class is extends vr{constructor(e={},r={configuration:{orientationWidget:{enabled:!0,viewportCorner:N4.Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:is.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[is.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"L",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"R",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:n=>n/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[is.OVERLAY_MARKER_TYPES.AXES]:{},[is.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}){super(e,r),this._resizeObservers=new Map,this.onSetToolEnabled=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolActive=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolDisabled=()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()},this._getViewportsInfo=()=>Kr(this.toolGroupId).viewportsInfo,this.resize=n=>{const i=this.orientationMarkers[n];if(!i)return;const{orientationWidget:o}=i;o.updateViewport()},this.orientationMarkers={},this.updatingOrientationMarker={}}_unsubscribeToViewportNewVolumeSet(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:n,renderingEngineId:i})=>{const{viewport:o}=Ln(n,i),{element:a}=o;a.removeEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this)),this._resizeObservers.get(n).unobserve(a)})};ke.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,r=>{r.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}_subscribeToViewportEvents(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:n,renderingEngineId:i})=>{const{viewport:o}=Ln(n,i),{element:a}=o;this.initViewports(),a.addEventListener(Ge.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const s=new ResizeObserver(()=>{setTimeout(()=>{const c=Ln(n,i);if(!c)return;const{viewport:l}=c;this.resize(n),l.render()},100)});s.observe(a),this._resizeObservers.set(n,s)})};e(),ke.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,r=>{r.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}cleanUpData(){Bi()[0].getViewports().forEach(i=>{const o=this.orientationMarkers[i.id];if(!o)return;const{actor:a,orientationWidget:s}=o;s?.setEnabled(!1),s?.delete(),a?.delete(),i.getRenderingEngine().getOffscreenMultiRenderWindow(i.id).getRenderWindow().render(),i.getRenderingEngine().render(),delete this.orientationMarkers[i.id]})}initViewports(){const r=Bi()[0];if(!r)return;let n=r.getViewports();n=b2(n,this.getToolName()),n.forEach(i=>{const o=i.getWidget(this.getToolName());(!o||o.isDeleted())&&this.addAxisActorInViewport(i)})}async addAxisActorInViewport(e){const r=e.id;if(!this.updatingOrientationMarker[r]){this.updatingOrientationMarker[r]=!0;const n=this.configuration.overlayMarkerType,i=this.configuration.overlayConfiguration[n];if(this.orientationMarkers[r]){const{actor:g,orientationWidget:p}=this.orientationMarkers[r];e.getRenderer().removeActor(g),p.setEnabled(!1)}let o;n===1?o=this.createAnnotationCube(i):n===2?o=c1e.newInstance():n===3&&(o=await this.createCustomActor());const a=e.getRenderer(),s=e.getRenderingEngine().getOffscreenMultiRenderWindow(r).getRenderWindow(),{enabled:c,viewportCorner:l,viewportSize:f,minPixelSize:u,maxPixelSize:d}=this.configuration.orientationWidget,h=N4.newInstance({actor:o,interactor:s.getInteractor(),parentRenderer:a});h.setEnabled(c),h.setViewportCorner(l),h.setViewportSize(f),h.setMinPixelSize(u),h.setMaxPixelSize(d),h.updateMarkerOrientation(),this.orientationMarkers[r]={orientationWidget:h,actor:o},e.addWidget(this.getToolName(),h),s.render(),e.getRenderingEngine().render(),this.updatingOrientationMarker[r]=!1}}async createCustomActor(){const e=this.configuration.overlayConfiguration[I1.CUSTOM].polyDataURL,n=await(await fetch(e)).arrayBuffer(),i=C7.newInstance();i.parseAsArrayBuffer(n),i.update();const o=rr.newInstance();o.shallowCopy(i.getOutputData()),o.getPointData().setActiveScalars("Color");const a=Ui.newInstance();a.setInputData(o),a.setColorModeToDirectScalars();const s=Lo.newInstance();return s.setMapper(a),s.rotateZ(180),s}createAnnotationCube(e){const r=V4.newInstance();return r.setDefaultStyle({...e.defaultStyle}),r.setXPlusFaceProperty({...e.faceProperties.xPlus}),r.setXMinusFaceProperty({...e.faceProperties.xMinus}),r.setYPlusFaceProperty({...e.faceProperties.yPlus}),r.setYMinusFaceProperty({...e.faceProperties.yMinus}),r.setZPlusFaceProperty({...e.faceProperties.zPlus}),r.setZMinusFaceProperty({...e.faceProperties.zMinus}),r}async createAnnotatedCubeActor(){const e=V4.newInstance(),{faceProperties:r,defaultStyle:n}=this.configuration.annotatedCube;return e.setDefaultStyle(n),Object.keys(r).forEach(i=>{const o=`set${i.charAt(0).toUpperCase()+i.slice(1)}FaceProperty`;e[o](r[i])}),e}};is.CUBE=1,is.AXIS=2,is.VTPFILE=3,is.OVERLAY_MARKER_TYPES=I1;let M1=is;M1.toolName="OrientationMarker";const dh=class dh extends vr{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:dh.SelectMode.Border,searchRadius:6}}){super(e,r),this.mouseMoveCallback=n=>{if(this.mode===_n.Active)return this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setActiveSegment(n),this.hoverTimer=null},this.configuration.hoverTimeout),!0},this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.hoverTimer=null}_setActiveSegment(e={}){if(Ue.isInteractingWithTool)return;const{element:r,currentPoints:n}=e.detail,i=n.world,o=Ce(r);if(!o)return;const{viewport:a}=o,s=Oc(a.id);s&&this._setActiveSegmentForType(s,i,a)}_setActiveSegmentForType(e,r,n){if(!n.getImageData())return;const{segmentationId:o,representationData:a}=e;let s;if(this.configuration.mode===dh.SelectMode.Inside?s=E3(o,r,{viewport:n}):a.Labelmap?s=uA(o,r,{viewport:n,searchRadius:this.configuration.searchRadius}):a.Contour?s=dA(o):a.Surface,!s||s===0)return;Kh(o,s);const l=n.getRenderingEngine().getViewports().map(f=>f.id);la(o),Me(l)}};dh.SelectMode={Inside:"Inside",Border:"Border"};let O1=dh;O1.toolName="SegmentSelectTool";const Hf=class Hf extends jh{constructor(e={}){super(e),this.renderAnnotation=(r,n)=>{let i=!0;const{viewport:o}=r,{element:a}=o,s=o.id;let c=$t(this.getToolName(),a);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(a,c),!c?.length))return i;const l=this.getTargetId(o),f=o.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:r.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:m,activeHandleIndex:w}=p.handles,v=m.map(ae=>o.worldToCanvas(ae));u.annotationUID=g;const{segmentIndex:y,segmentationId:C}=h.metadata,{lineWidth:x,lineDash:T,shadow:S}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),E=`rgb(${bs(s,C,y).slice(0,3).join(",")})`;if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,width:null,unit:null},this._calculateCachedStats(h,f,r)):h.invalidated&&this._throttledCalculateCachedStats(h,f,r),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),i;let D;if(!mr(g))continue;!pr(g)&&!this.editData&&w!==null&&(D=[v[w]]),D&&Wn(n,g,"0",D,{color:E});const b=`${g}-line-1`,I=`${g}-line-2`;Yt(n,g,"0",v[0],v[1],{color:E,lineWidth:x,lineDash:T,shadow:S},b),Yt(n,g,"1",v[2],v[3],{color:E,lineWidth:x,lineDash:T,shadow:S},I),i=!0;const R=this.getLinkedTextBoxStyle(u,h);if(!R.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}R.color=E;const A=this.configuration.getTextLines(p,l);if(!A||A.length===0)continue;let B;p.handles.textBox.hasMoved||(B=po(v),p.handles.textBox.worldPosition=o.canvasToWorld(B));const k=o.worldToCanvas(p.handles.textBox.worldPosition),F=Ei(n,g,"1",A,k,v,{},R),{x:j,y:J,width:ie,height:fe}=F;p.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([j,J]),topRight:o.canvasToWorld([j+ie,J]),bottomLeft:o.canvasToWorld([j,J+fe]),bottomRight:o.canvasToWorld([j+ie,J+fe])}}return i}}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,o=n.world,a=Ce(i),{viewport:s}=a;this.isDrawing=!0;const c=s.getCamera(),{viewPlaneNormal:l,viewUp:f}=c,u=this.getReferencedImageId(s,o,l,f),d=s.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...f],FrameOfReferenceUID:d,referencedImageId:u,...s.getViewReference({points:[o]})},data:{handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};Ft(h,i);const g=vt(i,this.getToolName());return this.editData={annotation:h,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),St(i),e.preventDefault(),Me(g),h}};Hf.toolName="SegmentBidirectional",Hf.hydrate=(e,r,n)=>{const i=xn(e);if(!i)return;const{viewport:o}=i,c=U0().filter(S=>S.metadata.toolName==="SegmentBidirectional").find(S=>{const{metadata:_}=S;return _.segmentIndex===n?.segmentIndex&&_.segmentationId===n?.segmentationId});c&&kt(c.annotationUID);const{FrameOfReferenceUID:l,referencedImageId:f,viewPlaneNormal:u,instance:d}=Hf.hydrateBase(Hf,i,r[0],n),[h,g]=r,[p,m]=h,[w,v]=g,y=[p,m,w,v],{toolInstance:C,...x}=n||{},T={annotationUID:n?.annotationUID||un(),data:{handles:{points:y,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{segmentIndex:n?.segmentIndex,segmentationId:n?.segmentationId,toolName:d.getToolName(),viewPlaneNormal:u,FrameOfReferenceUID:l,referencedImageId:f,...x}};return Ft(T,o.element),Me([o.id]),T};let Cw=Hf;class BL extends vr{constructor(e={data:{handles:{textBox:{worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,searchRadius:6,color:null,background:null}}){super(e,r),this.mouseMoveCallback=n=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setHoveredSegment(n),this.hoverTimer=null},this.configuration.hoverTimeout),!0),this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.data=e.data??{handles:{textBox:{worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}},this.hoverTimer=null}_setHoveredSegment(e={}){if(Ue.isInteractingWithTool)return;const{element:r,currentPoints:n}=e.detail,i=n.world,o=Ce(r);if(!o)return;const{viewport:a}=o,s=Oc(a.id);s&&this._setHoveredSegmentForType(s,i,a)}_setHoveredSegmentForType(e,r,n){if(!n.getImageData())return;const{segmentationId:o}=e,a=E3(o,r,{viewport:n}),s=e.segments[a],c=this.configuration.color??bs(n.id,o,a),l=s?.label,f=n.worldToCanvas(r);if(this._editData={hoveredSegmentIndex:a,hoveredSegmentLabel:l,canvasCoordinates:f,color:c},!a||a===0)return;const d=n.getRenderingEngine().getViewports().map(h=>h.id);la(o),Me(d)}renderAnnotation(e,r){if(!this._editData)return;const{viewport:n}=e,{hoveredSegmentIndex:i,hoveredSegmentLabel:o,canvasCoordinates:a,color:s}=this._editData;if(!i)return;const c=-15,l=[a[0]+c,a[1]+c],f=Dc(r,"segmentSelectLabelAnnotation","segmentSelectLabelTextBox",[o??"(unnamed segment)"],l,{color:`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${s[3]})`,background:this.configuration.background??void 0}),u=a[0],d=a[1],{width:h,height:g}=f;this.data.handles.textBox.worldBoundingBox={topLeft:n.canvasToWorld([u,d]),topRight:n.canvasToWorld([u+h,d]),bottomLeft:n.canvasToWorld([u,d+g]),bottomRight:n.canvasToWorld([u+h,d+g])}}}BL.toolName="SegmentLabelTool";const Ri=class Ri extends E0{constructor(e={}){const r=jr({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(r),this.onViewportAddedToToolGroupBinded=this.onViewportAddedToToolGroup.bind(this),this.onSegmentationModifiedBinded=this.onSegmentationModified.bind(this)}initializeListeners(){Ri.annotationsToViewportMap.clear(),Ri.viewportIdsChecked=[],ke.addEventListener(V.ANNOTATION_MODIFIED,this.annotationModified),ke.addEventListener(V.ANNOTATION_COMPLETED,this.annotationCompleted),ke.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this.onViewportAddedToToolGroupBinded),ke.addEventListener(V.SEGMENTATION_MODIFIED,this.onSegmentationModifiedBinded),ke.addEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,this.onSegmentationModifiedBinded)}cleanUpListeners(){Ri.annotationsToViewportMap.clear(),Ri.viewportIdsChecked=[],ke.removeEventListener(V.ANNOTATION_MODIFIED,this.annotationModified),ke.removeEventListener(V.ANNOTATION_COMPLETED,this.annotationCompleted),ke.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this.onViewportAddedToToolGroup.bind(this)),ke.removeEventListener(V.SEGMENTATION_MODIFIED,this.onSegmentationModified.bind(this)),ke.removeEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,this.onSegmentationModified.bind(this))}async checkContourSegmentation(e){if(Ri.viewportIdsChecked.includes(e))return;const r=nf(e);if(!r)return console.log("No active segmentation detected"),!1;const n=r.segmentationId;return r.representationData.Contour?Ri.viewportIdsChecked.push(e):(Ri.viewportIdsChecked.push(e),await b3(e,[{segmentationId:n,type:yt.Contour}]),Mx({segmentationId:n,type:yt.Contour,data:{}})),!0}onViewportAddedToToolGroup(e){const{toolGroupId:r,viewportId:n}=e.detail;r===this.toolGroupId&&this.checkContourSegmentation(n)}onSegmentationModified(e){const{segmentationId:r}=e.detail||{};if(!r)return;const n=uO(r);n&&n.forEach(async({viewportId:i})=>await this.checkContourSegmentation(i))}onSetToolEnabled(){this.initializeListeners()}onSetToolActive(){this.initializeListeners()}onSetToolDisabled(){this.cleanUpListeners()}annotationModified(e){const{annotation:r,renderingEngineId:n,viewportId:i}=e.detail,o=Bn(n)?.getViewport(i);o&&Ri.annotationsToViewportMap.set(r.annotationUID,o)}annotationCompleted(e){const{annotation:r}=e.detail,{polyline:n}=r.data?.contour||{};if(r?.metadata?.toolName===Ri.toolName&&n&&Ri.annotationsToViewportMap.has(r.annotationUID)){const i=Ri.annotationsToViewportMap.get(r.annotationUID);n.length>3&&sf.viewportContoursToLabelmap(i)}}};Ri.toolName="LabelMapEditWithContour",Ri.annotationsToViewportMap=new Map,Ri.viewportIdsChecked=[];let xw=Ri;const lT=class lT extends $n{constructor(e={}){super(e,{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),this.addNewAnnotation=r=>{const n=r.detail,{currentPoints:i,element:o}=n,a=i.world,s=Ce(o),{viewport:c}=s;this.isDrawing=!0;const l=this.constructor.createAnnotationForViewport(c,{data:{handles:{points:[[...a],[...a],[...a],[...a]]}}});Ft(l,o);const f=vt(o,this.getToolName(),!1);return this.editData={annotation:l,viewportUIDsToRender:f,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),St(o),r.preventDefault(),Me(f),l},this.getHandleNearImagePoint=(r,n,i,o)=>{const a=Ce(r),{viewport:s}=a,{data:c}=n,{points:l}=c.handles;for(let f=0;f<l.length;f++){const u=l[f],d=s.worldToCanvas(u);if(Xn(i,d)<o===!0)return c.handles.activeHandleIndex=f,u}c.handles.activeHandleIndex=null},this.isPointNearTool=(r,n,i,o)=>{const a=Ce(r),{viewport:s}=a,{data:c}=n,{points:l}=c.handles,f=s.worldToCanvas(l[0]),u=s.worldToCanvas(l[3]),d=this._getRectangleImageCoordinates([f,u]),h=[i[0],i[1]],{left:g,top:p,width:m,height:w}=d;if(zx([g,p,m,w],h)<=o)return!0},this.toolSelectedCallback=(r,n,i="mouse")=>{const o=r.detail,{element:a}=o,{data:s}=n;s.active=!0;const c=vt(a,this.getToolName(),!1);this.editData={annotation:n,viewportUIDsToRender:c},this._activateModify(a),St(a),Me(c),r.preventDefault()},this.handleSelectedCallback=(r,n,i,o="mouse")=>{const a=r.detail,{element:s}=a,{data:c}=n;c.active=!0;let l;i.worldPosition||(l=c.handles.points.findIndex(u=>u===i));const f=vt(s,this.getToolName(),!1);this.editData={annotation:n,viewportUIDsToRender:f,handleIndex:l},this._activateModify(s),St(s),Me(f),r.preventDefault()},this._endCallback=r=>{const n=r.detail,{element:i}=n,{annotation:o,viewportUIDsToRender:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=o;s&&!c||(this.doneEditMemo(),l.active=!1,l.handles.activeHandleIndex=null,this._deactivateModify(i),this._deactivateDraw(i),Vt(i),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(o.annotationUID),Me(a))},this._dragCallback=r=>{this.isDrawing=!0;const n=r.detail,{element:i}=n,{annotation:o,viewportUIDsToRender:a,handleIndex:s,newAnnotation:c}=this.editData;this.createMemo(i,o,{newAnnotation:c});const{data:l}=o;if(s===void 0){const{deltaPoints:f}=n,u=f.world,{points:d}=l.handles;d.forEach(h=>{h[0]+=u[0],h[1]+=u[1],h[2]+=u[2]}),l.invalidated=!0}else{const{currentPoints:f}=n,u=Ce(i),{worldToCanvas:d,canvasToWorld:h}=u.viewport,g=f.world,{points:p}=l.handles;p[s]=[...g];let m,w,v,y,C,x,T,S;switch(s){case 0:case 3:m=d(p[0]),y=d(p[3]),w=[y[0],m[1]],v=[m[0],y[1]],x=h(w),T=h(v),p[1]=x,p[2]=T;break;case 1:case 2:w=d(p[1]),v=d(p[2]),m=[v[0],w[1]],y=[w[0],v[1]],C=h(m),S=h(y),p[0]=C,p[3]=S;break}l.invalidated=!0}this.editData.hasMoved=!0,Ce(i),Me(a)},this._activateDraw=r=>{Ue.isInteractingWithTool=!0,r.addEventListener(V.MOUSE_UP,this._endCallback),r.addEventListener(V.MOUSE_DRAG,this._dragCallback),r.addEventListener(V.MOUSE_MOVE,this._dragCallback),r.addEventListener(V.MOUSE_CLICK,this._endCallback),r.addEventListener(V.TOUCH_END,this._endCallback),r.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=r=>{Ue.isInteractingWithTool=!1,r.removeEventListener(V.MOUSE_UP,this._endCallback),r.removeEventListener(V.MOUSE_DRAG,this._dragCallback),r.removeEventListener(V.MOUSE_MOVE,this._dragCallback),r.removeEventListener(V.MOUSE_CLICK,this._endCallback),r.removeEventListener(V.TOUCH_END,this._endCallback),r.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this._activateModify=r=>{Ue.isInteractingWithTool=!0,r.addEventListener(V.MOUSE_UP,this._endCallback),r.addEventListener(V.MOUSE_DRAG,this._dragCallback),r.addEventListener(V.MOUSE_CLICK,this._endCallback),r.addEventListener(V.TOUCH_END,this._endCallback),r.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=r=>{Ue.isInteractingWithTool=!1,r.removeEventListener(V.MOUSE_UP,this._endCallback),r.removeEventListener(V.MOUSE_DRAG,this._dragCallback),r.removeEventListener(V.MOUSE_CLICK,this._endCallback),r.removeEventListener(V.TOUCH_END,this._endCallback),r.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(r,n)=>{const{viewport:o}=r,{element:a}=o;let s=$t(this.getToolName(),a);if(!s?.length||(s=this.filterInteractableAnnotationsForElement(a,s),!s?.length))return!1;const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:r.viewport.id};for(let l=0;l<s.length;l++){const f=s[l],{annotationUID:u}=f,d=f.data,{points:h,activeHandleIndex:g}=d.handles,p=h.map(x=>o.worldToCanvas(x)),m=this.getStyle("lineWidth",c,f),w=this.getStyle("lineDash",c,f),v=this.getStyle("color",c,f);if(!o.getRenderingEngine()){console.warn("Rendering Engine has been destroyed");return}let y;!this.editData&&g!==null&&(y=[p[g]]),y&&Wn(n,u,"0",y,{color:v}),jO(n,u,"0",p[0],p[3],{color:"black",lineDash:w,lineWidth:m})}},this._getRectangleImageCoordinates=r=>{const[n,i]=r;return{left:Math.min(n[0],i[0]),top:Math.min(n[1],i[1]),width:Math.abs(n[0]-i[0]),height:Math.abs(n[1]-i[1])}},this._calculateCachedStats=(r,n,i,o,a)=>{const{data:s}=r,{viewportUID:c,renderingEngineUID:l,sceneUID:f}=a,u=s.handles.points[0],d=s.handles.points[3],{cachedStats:h}=s,g=Object.keys(h);for(let m=0;m<g.length;m++){const w=g[m],{imageVolume:v}=this._getImageVolumeFromTargetUID(w,o),{dimensions:y,scalarData:C,vtkImageData:x,metadata:T}=v,S=mt(0,0,0),_=mt(0,0,0);if(x.worldToIndexVec3(u,S),S[0]=Math.floor(S[0]),S[1]=Math.floor(S[1]),S[2]=Math.floor(S[2]),x.worldToIndexVec3(d,_),_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]),this._isInsideVolume(S,_,y)){this.isHandleOutsideImage=!1;const E=Math.min(S[0],_[0]),D=Math.max(S[0],_[0]),b=Math.min(S[1],_[1]),I=Math.max(S[1],_[1]),O=Math.min(S[2],_[2]),M=Math.max(S[2],_[2]),{worldWidth:R,worldHeight:A}=Ag(n,i,u,d),B=R*A;let k=0,L=0,F=0;const j=y[0],J=y[0]*y[1];for(let ie=O;ie<=M;ie++)for(let fe=b;fe<=I;fe++)for(let ae=E;ae<=D;ae++){const de=C[ie*J+fe*j+ae];k++,L+=de}L/=k;for(let ie=O;ie<=M;ie++)for(let fe=b;fe<=I;fe++)for(let ae=E;ae<=D;ae++){const we=C[ie*J+fe*j+ae]-L;F+=we*we}F/=k,F=Math.sqrt(F),h[w]={Modality:T.Modality,area:B,mean:L,stdDev:F}}else this.isHandleOutsideImage=!0,h[w]={Modality:T.Modality}}const p=r.invalidated;if(r.invalidated=!1,p){const m=V.ANNOTATION_MODIFIED,w={annotation:r,viewportUID:c,renderingEngineUID:l,sceneUID:f,changeType:Nt.StatsUpdated};Xe(ke,m,w)}return h},this._isInsideVolume=(r,n,i)=>Or(r,i)&&Or(n,i),this._getTargetVolumeUID=r=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const n=r.getVolumeActors();if(!(!n&&!n.length))return n[0].uid},this._throttledCalculateCachedStats=$i(this._calculateCachedStats,100,{trailing:!0})}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),Vt(e);const{annotation:r,viewportUIDsToRender:n}=this.editData,{data:i}=r;return i.active=!1,i.handles.activeHandleIndex=null,Me(n),this.editData=null,r.annotationUID}_getImageVolumeFromTargetUID(e,r){let n,i;if(e.startsWith("stackTarget")){const o=e.indexOf(":"),a=e.substring(o+1);n=r.getViewport(a).getImageData()}else n=Ae.getVolume(e);return{imageVolume:n,viewport:i}}_getTargetStackUID(e){return`stackTarget:${e.uid}`}};lT.toolName="VideoRedaction";let Tw=lT;const l1e=Object.freeze(Object.defineProperty({__proto__:null,AdvancedMagnifyTool:Zh,AngleTool:fw,AnnotationDisplayTool:As,AnnotationTool:$n,ArrowAnnotateTool:uw,BaseTool:vr,BidirectionalTool:jh,BrushTool:sf,CONSTANTS:t0e,CircleROIStartEndThresholdTool:DL,CircleROITool:Qh,CircleScissorsTool:EL,CobbAngleTool:dw,CrosshairsTool:lL,DragProbeTool:ow,ETDRSGridTool:sw,EllipticalROITool:aw,Enums:Are,EraserTool:TL,HeightTool:iw,KeyImageTool:vw,LabelMapEditWithContourTool:xw,LabelTool:T1,LabelmapBaseTool:af,LengthTool:rw,LivewireContourSegmentationTool:lw,LivewireContourTool:b1,MIPJumpToClickTool:cL,MagnifyTool:uL,OrientationMarkerTool:M1,OverlayGridTool:dL,PaintFillTool:IL,PanTool:ZA,PlanarFreehandContourSegmentationTool:E0,PlanarFreehandROITool:m1,PlanarRotateTool:aL,ProbeTool:S1,RectangleROIStartEndThresholdTool:x3,RectangleROIThresholdTool:T3,RectangleROITool:zh,RectangleScissorsTool:_L,ReferenceCursors:mL,ReferenceLinesTool:fL,RegionSegmentPlusTool:ww,RegionSegmentTool:yw,ScaleOverlayTool:vL,SculptorTool:wL,SegmentBidirectionalTool:Cw,SegmentLabelTool:BL,SegmentSelectTool:O1,SegmentationIntersectionTool:hL,SphereScissorsTool:bL,SplineContourSegmentationTool:cw,SplineROITool:_1,StackScrollTool:oL,Synchronizer:C3,SynchronizerManager:OR,ToolGroupManager:TM,TrackballRotateTool:QA,Types:rpe,UltrasoundDirectionalTool:hw,UltrasoundPleuraBLineTool:mw,VideoRedactionTool:Tw,VolumeCroppingControlTool:nL,VolumeCroppingTool:tL,VolumeRotateTool:CL,WholeBodySegmentTool:SL,WindowLevelRegionTool:iL,WindowLevelTool:rL,ZoomTool:sL,addTool:xx,annotation:gle,cancelActiveManipulations:MR,cursors:iie,destroy:Zfe,drawing:Rae,init:RR,removeTool:IM,segmentation:Spe,splines:Ipe,get state(){return Ue},store:Jfe,synchronizers:x0e,utilities:npe,version:n0e},Symbol.toStringTag,{value:"Module"}));function GL(t,e,r){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0;if(r){for(let a=0;a<n;a++)e[o++]=t[i++],e[o++]=t[i++],e[o++]=t[i++],e[o++]=255;return}e.set(t)}function u1e(t,e,r){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0,a=n,s=n*2;if(r)for(let c=0;c<n;c++)e[i++]=t[o++],e[i++]=t[a++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<n;c++)e[i++]=t[o++],e[i++]=t[a++],e[i++]=t[s++]}function f1e(t,e,r){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0;if(r){for(let a=0;a<n;a++){const s=t[i++],c=t[i++],l=t[i++];e[o++]=s+1.402*(l-128),e[o++]=s-.34414*(c-128)-.71414*(l-128),e[o++]=s+1.772*(c-128),e[o++]=255}return}for(let a=0;a<n;a++){const s=t[i++],c=t[i++],l=t[i++];e[o++]=s+1.402*(l-128),e[o++]=s-.34414*(c-128)-.71414*(l-128),e[o++]=s+1.772*(c-128)}}function d1e(t,e,r){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0,a=n,s=n*2;if(r){for(let c=0;c<n;c++){const l=t[o++],f=t[a++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128),e[i++]=255}return}for(let c=0;c<n;c++){const l=t[o++],f=t[a++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128)}}function h1e(t,e,r){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const n=t.length/2;let i=0,o=0;if(r){for(let a=0;a<n;a+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[o++]=s+1.402*(f-128),e[o++]=s-.34414*(l-128)-.71414*(f-128),e[o++]=s+1.772*(l-128),e[o++]=255,e[o++]=c+1.402*(f-128),e[o++]=c-.34414*(l-128)-.71414*(f-128),e[o++]=c+1.772*(l-128),e[o++]=255}return}for(let a=0;a<n;a+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[o++]=s+1.402*(f-128),e[o++]=s-.34414*(l-128)-.71414*(f-128),e[o++]=s+1.772*(l-128),e[o++]=c+1.402*(f-128),e[o++]=c-.34414*(l-128)-.71414*(f-128),e[o++]=c+1.772*(l-128)}}function Ry(t,e){const r=t.length,n=new Uint8ClampedArray(r);for(let i=0;i<r;++i)n[i]=t[i]>>e;return n}function Ay(t,e,r){const n=t[`${e}PaletteColorLookupTableData`];if(n)return Promise.resolve(n);const i=ut("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(o=>o?o[`${e}PaletteColorLookupTableData`]:r):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:r)}function g1e(t,e,r){const n=t.columns*t.rows,i=t.pixelData;Promise.all([Ay(t,"red",null),Ay(t,"green",null),Ay(t,"blue",null)]).then(([o,a,s])=>{if(!o||!a||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=o.length;let l=0,f=0;const u=t.redPaletteColorLookupTableDescriptor[1],d=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,h=Ry(o,d),g=Ry(a,d),p=Ry(s,d);if(r){for(let m=0;m<n;++m){let w=i[l++];w<u?w=0:w>u+c-1?w=c-1:w-=u,e[f++]=h[w],e[f++]=g[w],e[f++]=p[w],e[f++]=255}return}for(let m=0;m<n;++m){let w=i[l++];w<u?w=0:w>u+c-1?w=c-1:w-=u,e[f++]=h[w],e[f++]=g[w],e[f++]=p[w]}})}function Ly(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function Ny(t,e,r){const n=[],i=t.elements[e];for(let o=0;o<r[0];o++)r[2]===16?n[o]=t.uint16(e,o):n[o]=t.byteArray[o+i.dataOffset];return n}function p1e(t,e){e.redPaletteColorLookupTableDescriptor=Ly(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=Ly(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=Ly(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const r=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===r?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=Ny(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=Ny(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=Ny(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function m1e(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function v1e(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return m1e(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&p1e(t,e),e}function y1e(t,e){let r=e.uint16("x00283002",0);r===0&&(r=65535);let n=0;t===0?n=e.uint16("x00283002",1):n=e.int16("x00283002",1);const i=e.uint16("x00283002",2),o={id:"1",firstValueMapped:n,numBitsPerEntry:i,lut:[]};for(let a=0;a<r;a++)t===0?o.lut[a]=e.uint16("x00283006",a):o.lut[a]=e.int16("x00283006",a);return o}function k4(t,e){if(!e||!e.items||!e.items.length)return;const r=[];for(let n=0;n<e.items.length;n++){const i=e.items[n].dataSet,o=y1e(t,i);o&&r.push(o)}return r}function w1e(t){const e=t.uint16("x00280103"),r=t.uint16("x00280101");return e===0?0:-1<<r-1}function C1e(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const r=t.floatString("x00281052"),n=t.floatString("x00281053");return r!==void 0&&n!==void 0?w1e(t)*n+r<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function Ds(t,e,r){const n=[],i=t.string(e);if(!i)return;const o=i.split("\\");if(!(r&&o.length<r)){for(let a=0;a<o.length;a++)n.push(parseFloat(o[a]));return n}}var dm={exports:{}};var x1e=dm.exports,F4;function T1e(){return F4||(F4=1,(function(t,e){(function(r,n){t.exports=n(wc)})(x1e,function(r){return i=[function(a,s){a.exports=r},function(a,s,c){c.r(s),c.d(s,"isStringVr",function(){return f}),c.d(s,"isPrivateTag",function(){return u}),c.d(s,"parsePN",function(){return d}),c.d(s,"parseTM",function(){return h}),c.d(s,"parseDA",function(){return p}),c.d(s,"explicitElementToString",function(){return m}),c.d(s,"explicitDataSetToJS",function(){return w}),c.d(s,"createJPEGBasicOffsetTable",function(){return C}),c.d(s,"parseDicomDataSetExplicit",function(){return J}),c.d(s,"parseDicomDataSetImplicit",function(){return ie}),c.d(s,"readFixedString",function(){return _}),c.d(s,"alloc",function(){return fe}),c.d(s,"version",function(){return ae}),c.d(s,"bigEndianByteArrayParser",function(){return de}),c.d(s,"ByteStream",function(){return Te}),c.d(s,"sharedCopy",function(){return we}),c.d(s,"DataSet",function(){return b}),c.d(s,"findAndSetUNElementLength",function(){return S}),c.d(s,"findEndOfEncapsulatedElement",function(){return T}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return I}),c.d(s,"littleEndianByteArrayParser",function(){return G}),c.d(s,"parseDicom",function(){return W}),c.d(s,"readDicomElementExplicit",function(){return j}),c.d(s,"readDicomElementImplicit",function(){return M}),c.d(s,"readEncapsulatedImageFrame",function(){return De}),c.d(s,"readEncapsulatedPixelData",function(){return We}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return Q}),c.d(s,"readPart10Header",function(){return P}),c.d(s,"readSequenceItemsExplicit",function(){return L}),c.d(s,"readSequenceItemsImplicit",function(){return B}),c.d(s,"readSequenceItem",function(){return R}),c.d(s,"readTag",function(){return x});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},f=function(re){return l[re]},u=function(re){if(re=parseInt(re[4],16),isNaN(re))throw"dicomParser.isPrivateTag: cannot parse last character of group";return re%2==1},d=function(re){if(re!==void 0)return re=re.split("^"),{familyName:re[0],givenName:re[1],middleName:re[2],prefix:re[3],suffix:re[4]}};function h(re,se){if(2<=re.length){var ve=parseInt(re.substring(0,2),10),le=4<=re.length?parseInt(re.substring(2,4),10):void 0,pe=6<=re.length?parseInt(re.substring(4,6),10):void 0,$e=8<=re.length?re.substring(7,13):void 0,$e=$e?parseInt($e,10)*Math.pow(10,6-$e.length):void 0;if(se&&(isNaN(ve)||le!==void 0&&isNaN(le)||pe!==void 0&&isNaN(pe)||$e!==void 0&&isNaN($e)||ve<0||23<ve||le&&(le<0||59<le)||pe&&(pe<0||59<pe)||$e&&($e<0||999999<$e)))throw"invalid TM '".concat(re,"'");return{hours:ve,minutes:le,seconds:pe,fractionalSeconds:$e}}if(se)throw"invalid TM '".concat(re,"'")}function g(re,se,ve){return!isNaN(ve)&&0<se&&se<=12&&0<re&&re<=(function(le,pe){switch(le){case 2:return pe%4==0&&pe%100||pe%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}})(se,ve)}function p(re,se){if(re&&re.length===8){var ve=parseInt(re.substring(0,4),10),le=parseInt(re.substring(4,6),10),pe=parseInt(re.substring(6,8),10);if(se&&g(pe,le,ve)!==!0)throw"invalid DA '".concat(re,"'");return{year:ve,month:le,day:pe}}if(se)throw"invalid DA '".concat(re,"'")}function m(re,se){if(re===void 0||se===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(se.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var ve,le=se.vr,pe=se.tag;function $e(st,gt){for(var ct="",Ee=0;Ee<st;Ee++)Ee!==0&&(ct+="/"),ct+=gt.call(re,pe,Ee).toString();return ct}if(f(le)===!0)ve=re.string(pe);else{if(le==="AT"){var oe=re.uint32(pe);return oe===void 0?void 0:"x".concat((oe=oe<0?4294967295+oe+1:oe).toString(16).toUpperCase())}le==="US"?ve=$e(se.length/2,re.uint16):le==="SS"?ve=$e(se.length/2,re.int16):le==="UL"?ve=$e(se.length/4,re.uint32):le==="SL"?ve=$e(se.length/4,re.int32):le==="FD"?ve=$e(se.length/8,re.double):le==="FL"&&(ve=$e(se.length/4,re.float))}return ve}function w(re,se){if(re===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";se=se||{omitPrivateAttibutes:!0,maxElementLength:128};var ve,le={};for(ve in re.elements){var pe=re.elements[ve];if(se.omitPrivateAttibutes!==!0||!u(ve))if(pe.items){for(var $e=[],oe=0;oe<pe.items.length;oe++)$e.push(w(pe.items[oe].dataSet,se));le[ve]=$e}else{var st=void 0;pe.length<se.maxElementLength&&(st=m(re,pe)),le[ve]=st!==void 0?st:{dataOffset:pe.dataOffset,length:pe.length}}}return le}function v(re,se){return re.byteArray[se]===255&&re.byteArray[se+1]===217}function y(re,se,ve){for(var le,pe,$e=ve;$e<se.fragments.length;$e++)if(le=re,pe=$e,pe=se.fragments[pe],!(!v(le,pe.position+pe.length-2)&&!v(le,pe.position+pe.length-3)))return $e}function C(re,se,ve){if(re===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(se===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(se.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(se.encapsulatedPixelData!==!0||se.hadUndefinedLength!==!0||se.basicOffsetTable===void 0||se.fragments===void 0||se.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ve&&ve.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";ve=ve||se.fragments;for(var le=[],pe=0;;){le.push(se.fragments[pe].offset);var $e=y(re,se,pe);if($e===void 0||$e===se.fragments.length-1)return le;pe=$e+1}}function x(ve){if(ve===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var se=256*ve.readUint16()*256,ve=ve.readUint16();return"x".concat("00000000".concat((se+ve).toString(16)).substr(-8))}function T(re,se,ve){if(re===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(se===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(se.encapsulatedPixelData=!0,se.basicOffsetTable=[],se.fragments=[],x(re)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var le=re.readUint32()/4,pe=0;pe<le;pe++){var $e=re.readUint32();se.basicOffsetTable.push($e)}for(var oe=re.position;re.position<re.byteArray.length;){var st=x(re),gt=re.readUint32();if(st==="xfffee0dd")return re.seek(gt),void(se.length=re.position-se.dataOffset);if(st!=="xfffee000")return ve&&ve.push("unexpected tag ".concat(st," while searching for end of pixel data element with undefined length")),gt>re.byteArray.length-re.position&&(gt=re.byteArray.length-re.position),se.fragments.push({offset:re.position-oe-8,position:re.position,length:gt}),re.seek(gt),void(se.length=re.position-se.dataOffset);se.fragments.push({offset:re.position-oe-8,position:re.position,length:gt}),re.seek(gt)}ve&&ve.push("pixel data element ".concat(se.tag," missing sequence delimiter tag xfffee0dd"))}function S(re,se){if(re===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var ve=re.byteArray.length-8;re.position<=ve;)if(re.readUint16()===65534){var le=re.readUint16();if(le===57565)return re.readUint32()!==0&&re.warnings("encountered non zero length following item delimiter at position ".concat(re.position-4," while reading element of undefined length with tag ").concat(se.tag)),void(se.length=re.position-se.dataOffset)}se.length=re.byteArray.length-se.dataOffset,re.seek(re.byteArray.length-re.position)}function _(re,se,ve){if(ve<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(se+ve>re.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var le,pe="",$e=0;$e<ve;$e++){if((le=re[se+$e])===0)return se+=ve,pe;pe+=String.fromCharCode(le)}return pe}function E(re,se){for(var ve=0;ve<se.length;ve++){var le=se[ve];le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(re,le.key,le)}}function D(re,se){return re.parser!==void 0?re.parser:se}var b=(function(){function re(le,pe,$e){(function(oe,st){if(!(oe instanceof st))throw new TypeError("Cannot call a class as a function")})(this,re),this.byteArrayParser=le,this.byteArray=pe,this.elements=$e}var se,ve;return se=re,(ve=[{key:"uint16",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readUint16(this.byteArray,le.dataOffset+2*pe)}},{key:"int16",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readInt16(this.byteArray,le.dataOffset+2*pe)}},{key:"uint32",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readUint32(this.byteArray,le.dataOffset+4*pe)}},{key:"int32",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readInt32(this.byteArray,le.dataOffset+4*pe)}},{key:"float",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readFloat(this.byteArray,le.dataOffset+4*pe)}},{key:"double",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readDouble(this.byteArray,le.dataOffset+8*pe)}},{key:"numStringValues",value:function(le){if(le=this.elements[le],le&&0<le.length)return le=_(this.byteArray,le.dataOffset,le.length).match(/\\/g),le===null?1:le.length+1}},{key:"string",value:function(le,pe){if(le=this.elements[le],le&&le.Value)return le.Value;if(le&&0<le.length)return le=_(this.byteArray,le.dataOffset,le.length),0<=pe?le.split("\\")[pe].trim():le.trim()}},{key:"text",value:function(le,pe){if(le=this.elements[le],le&&0<le.length)return le=_(this.byteArray,le.dataOffset,le.length),0<=pe?le.split("\\")[pe].replace(/ +$/,""):le.replace(/ +$/,"")}},{key:"floatString",value:function(le,pe){var $e=this.elements[le];if($e&&0<$e.length&&(pe=this.string(le,pe=pe!==void 0?pe:0),pe!==void 0))return parseFloat(pe)}},{key:"intString",value:function(le,pe){var $e=this.elements[le];if($e&&0<$e.length&&(pe=this.string(le,pe=pe!==void 0?pe:0),pe!==void 0))return parseInt(pe)}},{key:"attributeTag",value:function(le){var pe=this.elements[le];if(pe&&pe.length===4){var $e=D(pe,this.byteArrayParser).readUint16,le=this.byteArray,pe=pe.dataOffset;return"x".concat("00000000".concat((256*$e(le,pe)*256+$e(le,pe+2)).toString(16)).substr(-8))}}}])&&E(se.prototype,ve),Object.defineProperty(se,"prototype",{writable:!1}),re})();function I(re,se){if(re===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var ve=re.byteArray.length-8;re.position<=ve;)if(re.readUint16()===65534){var le=re.readUint16();if(le===57357)return re.readUint32()!==0&&re.warnings("encountered non zero length following item delimiter at position ".concat(re.position-4," while reading element of undefined length with tag ").concat(se.tag)),void(se.length=re.position-se.dataOffset)}se.length=re.byteArray.length-se.dataOffset,re.seek(re.byteArray.length-re.position)}var O=function(re,se){return re.vr!==void 0?re.vr==="SQ":se.position+4<=se.byteArray.length?(re=x(se),se.seek(-4),re==="xfffee000"||re==="xfffee0dd"):(se.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function M(re,se,ve){if(re===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var le=x(re),le={tag:le,vr:ve!==void 0?ve(le):void 0,length:re.readUint32(),dataOffset:re.position};return le.length===4294967295&&(le.hadUndefinedLength=!0),le.tag===se||(!O(le,re)||u(le.tag)&&!le.hadUndefinedLength?le.hadUndefinedLength?I(re,le):re.seek(le.length):(B(re,le,ve),u(le.tag)&&(le.items=void 0))),le}function R(re){if(re===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var se={tag:x(re),length:re.readUint32(),dataOffset:re.position};if(se.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(re.position);return se}function A(re,se){var ve=R(re);return ve.length===4294967295?(ve.hadUndefinedLength=!0,ve.dataSet=(function(le,pe){for(var $e={};le.position<le.byteArray.length;){var oe=M(le,void 0,pe);if(($e[oe.tag]=oe).tag==="xfffee00d")return new b(le.byteArrayParser,le.byteArray,$e)}return le.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new b(le.byteArrayParser,le.byteArray,$e)})(re,se),ve.length=re.position-ve.dataOffset):(ve.dataSet=new b(re.byteArrayParser,re.byteArray,{}),ie(ve.dataSet,re,re.position+ve.length,{vrCallback:se})),ve}function B(re,se,ve){if(re===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(se===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";se.items=[],(se.length===4294967295?function(le,pe,$e){for(;le.position+4<=le.byteArray.length;){var oe=x(le);if(le.seek(-4),oe==="xfffee0dd")return pe.length=le.position-pe.dataOffset,le.seek(8);oe=A(le,$e),pe.items.push(oe)}le.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),pe.length=le.byteArray.length-pe.dataOffset}:function(le,pe,$e){for(var oe=pe.dataOffset+pe.length;le.position<oe;){var st=A(le,$e);pe.items.push(st)}})(re,se,ve)}function k(re,se){var ve=R(re);return ve.length===4294967295?(ve.hadUndefinedLength=!0,ve.dataSet=(function(le,pe){for(var $e={};le.position<le.byteArray.length;){var oe=j(le,pe);if(($e[oe.tag]=oe).tag==="xfffee00d")return new b(le.byteArrayParser,le.byteArray,$e)}return pe.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new b(le.byteArrayParser,le.byteArray,$e)})(re,se),ve.length=re.position-ve.dataOffset):(ve.dataSet=new b(re.byteArrayParser,re.byteArray,{}),J(ve.dataSet,re,re.position+ve.length)),ve}function L(re,se,ve){if(re===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(se===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";se.items=[],(se.length===4294967295?function(le,pe,$e){for(;le.position+4<=le.byteArray.length;){var oe=x(le);if(le.seek(-4),oe==="xfffee0dd")return pe.length=le.position-pe.dataOffset,le.seek(8);oe=k(le,$e),pe.items.push(oe)}$e.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),pe.length=le.position-pe.dataOffset}:function(le,pe,$e){for(var oe=pe.dataOffset+pe.length;le.position<oe;){var st=k(le,$e);pe.items.push(st)}})(re,se,ve)}var F=function(re){return re==="OB"||re==="OD"||re==="OL"||re==="OW"||re==="SQ"||re==="OF"||re==="UC"||re==="UR"||re==="UT"||re==="UN"?4:2};function j(re,se,ve){if(re===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var le={tag:x(re),vr:re.readFixedString(2)};return F(le.vr)===2?le.length=re.readUint16():(re.seek(2),le.length=re.readUint32()),le.dataOffset=re.position,le.length===4294967295&&(le.hadUndefinedLength=!0),le.tag===ve||(le.vr==="SQ"?L(re,le,se):le.length===4294967295?le.tag==="x7fe00010"?T(re,le,se):(le.vr==="UN"?B:I)(re,le):re.seek(le.length)),le}function J(re,se,ve){var le=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ve=ve===void 0?se.byteArray.length:ve,se===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(ve<se.position||ve>se.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var pe=re.elements;se.position<ve;){var $e=j(se,re.warnings,le.untilTag);if((pe[$e.tag]=$e).tag===le.untilTag)return}if(se.position>ve)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function ie(re,se,ve){var le=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ve=ve===void 0?re.byteArray.length:ve,se===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(ve<se.position||ve>se.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var pe=re.elements;se.position<ve;){var $e=M(se,le.untilTag,le.vrCallback);if((pe[$e.tag]=$e).tag===le.untilTag)return}}function fe(re,se){if(typeof Buffer<"u"&&re instanceof Buffer)return Buffer.alloc(se);if(re instanceof Uint8Array)return new Uint8Array(se);throw"dicomParser.alloc: unknown type for byteArray"}var ae="1.8.12",de={readUint16:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(se+2>re.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(re[se]<<8)+re[se+1]},readInt16:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(se+2>re.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return se=(re[se]<<8)+re[se+1],se=32768&se?se-65535-1:se},readUint32:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(se+4>re.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*re[se]+re[se+1])+re[se+2])+re[se+3]},readInt32:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(se+4>re.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(re[se]<<24)+(re[se+1]<<16)+(re[se+2]<<8)+re[se+3]},readFloat:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(se+4>re.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ve=new Uint8Array(4);return ve[3]=re[se],ve[2]=re[se+1],ve[1]=re[se+2],ve[0]=re[se+3],new Float32Array(ve.buffer)[0]},readDouble:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(se+8>re.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ve=new Uint8Array(8);return ve[7]=re[se],ve[6]=re[se+1],ve[5]=re[se+2],ve[4]=re[se+3],ve[3]=re[se+4],ve[2]=re[se+5],ve[1]=re[se+6],ve[0]=re[se+7],new Float64Array(ve.buffer)[0]}};function we(re,se,ve){if(typeof Buffer<"u"&&re instanceof Buffer)return re.slice(se,se+ve);if(re instanceof Uint8Array)return new Uint8Array(re.buffer,re.byteOffset+se,ve);throw"dicomParser.from: unknown type for byteArray"}function _e(re,se){for(var ve=0;ve<se.length;ve++){var le=se[ve];le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(re,le.key,le)}}var Te=(function(){function re(le,pe,$e){if((function(oe,st){if(!(oe instanceof st))throw new TypeError("Cannot call a class as a function")})(this,re),le===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(pe===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(pe instanceof Uint8Array)&&(typeof Buffer>"u"||!(pe instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if($e<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if($e>=pe.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=le,this.byteArray=pe,this.position=$e||0,this.warnings=[]}var se,ve;return se=re,(ve=[{key:"seek",value:function(le){if(this.position+le<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=le}},{key:"readByteStream",value:function(le){if(this.position+le>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var pe=we(this.byteArray,this.position,le);return this.position+=le,new re(this.byteArrayParser,pe)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var le=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,le}},{key:"readUint32",value:function(){var le=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,le}},{key:"readFixedString",value:function(le){var pe=_(this.byteArray,this.position,le);return this.position+=le,pe}}])&&_e(se.prototype,ve),Object.defineProperty(se,"prototype",{writable:!1}),re})(),G={readUint16:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(se+2>re.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return re[se]+256*re[se+1]},readInt16:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(se+2>re.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return se=re[se]+(re[se+1]<<8),se=32768&se?se-65535-1:se},readUint32:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(se+4>re.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return re[se]+256*re[se+1]+256*re[se+2]*256+256*re[se+3]*256*256},readInt32:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(se+4>re.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return re[se]+(re[se+1]<<8)+(re[se+2]<<16)+(re[se+3]<<24)},readFloat:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(se+4>re.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ve=new Uint8Array(4);return ve[0]=re[se],ve[1]=re[se+1],ve[2]=re[se+2],ve[3]=re[se+3],new Float32Array(ve.buffer)[0]},readDouble:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(se+8>re.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ve=new Uint8Array(8);return ve[0]=re[se],ve[1]=re[se+1],ve[2]=re[se+2],ve[3]=re[se+3],ve[4]=re[se+4],ve[5]=re[se+5],ve[6]=re[se+6],ve[7]=re[se+7],new Float64Array(ve.buffer)[0]}};function P(re){var se=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(re===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var ve=se.TransferSyntaxUID,le=new Te(G,re);return(function(){var pe=(function(){if(le.getSize()<=132&&ve)return!1;if(le.seek(128),le.readFixedString(4)==="DICM")return!0;if(!(se||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return le.seek(0),!1})(),$e=[],oe={};if(!pe)return le.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:ve}},warnings:$e};for(;le.position<le.byteArray.length;){var st=le.position,gt=j(le,$e);if("x0002ffff"<gt.tag){le.position=st;break}gt.parser=G,oe[gt.tag]=gt}return(pe=new b(le.byteArrayParser,le.byteArray,oe)).warnings=le.warnings,pe.position=le.position,pe})()}var $="1.2.840.10008.1.2.2";function W(re){var se=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(re===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var ve,le=function($e){if($e.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return $e=$e.elements.x00020010,$e&&$e.Value||_(re,$e.dataOffset,$e.length)};function pe(gt){var st=le(gt),oe=st!=="1.2.840.10008.1.2",st=(function(ct,Ee){var ze=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(ct!=="1.2.840.10008.1.2.1.99")return new Te(ct===$?de:G,re,Ee);if(se&&se.inflater)return ct=se.inflater(re,Ee),new Te(G,ct,0);if(ze==!0){var qe=c(0),Je=we(re,Ee,re.length-Ee),qe=qe.inflateRawSync(Je),Je=fe(re,qe.length+Ee);return re.copy(Je,0,0,Ee),qe.copy(Je,Ee),new Te(G,Je,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return qe=re.slice(Ee),Je=pako.inflateRaw(qe),(qe=fe(re,Je.length+Ee)).set(re.slice(0,Ee),0),qe.set(Je,Ee),new Te(G,qe,0)})(st,gt.position),gt=new b(st.byteArrayParser,st.byteArray,{});gt.warnings=st.warnings;try{(oe?J:ie)(gt,st,st.byteArray.length,se)}catch(ct){throw{exception:ct,dataSet:gt}}return gt}return(function($e,oe){for(var st in $e.elements)$e.elements.hasOwnProperty(st)&&(oe.elements[st]=$e.elements[st]);return $e.warnings!==void 0&&(oe.warnings=$e.warnings.concat(oe.warnings)),oe})(ve=P(re,se),pe(ve))}var q=function(re,se,ve){for(var le=0,pe=se;pe<se+ve;pe++)le+=re[pe].length;return le};function Q(re,oe,ve,le,pe){if(pe=pe||oe.fragments,re===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(oe===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(ve===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((le=le||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(oe.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(oe.encapsulatedPixelData!==!0||oe.hadUndefinedLength!==!0||oe.basicOffsetTable===void 0||oe.fragments===void 0||oe.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ve<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(ve>=oe.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(le<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(ve+le>oe.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var $e=new Te(re.byteArrayParser,re.byteArray,oe.dataOffset),oe=R($e);if(oe.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";$e.seek(oe.length);var st=$e.position;if(le===1)return we($e.byteArray,st+pe[ve].offset+8,pe[ve].length);for(var oe=q(pe,ve,le),gt=fe($e.byteArray,oe),ct=0,Ee=ve;Ee<ve+le;Ee++)for(var ze=st+pe[Ee].offset+8,qe=0;qe<pe[Ee].length;qe++)gt[ct++]=$e.byteArray[ze++];return gt}var ee=function(re,se){for(var ve=0;ve<re.length;ve++)if(re[ve].offset===se)return ve},ge=function(re,se,ve,le){if(re===se.length-1)return ve.length-le;for(var pe=se[re+1],$e=le+1;$e<ve.length;$e++)if(ve[$e].offset===pe)return $e-le;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function De(re,se,ve,le,pe){if(le=le||se.basicOffsetTable,pe=pe||se.fragments,re===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(se===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(ve===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(le===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(se.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(se.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(se.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(se.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(le.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(ve<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(ve>=le.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var $e=le[ve],$e=ee(pe,$e);if($e===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Q(re,se,$e,ge(ve,le,pe,$e),pe)}var Ne=!1;function We(re,se,ve){if(Ne||(Ne=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),re===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(se===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(ve===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(se.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(se.encapsulatedPixelData!==!0||se.hadUndefinedLength!==!0||se.basicOffsetTable===void 0||se.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(ve<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return se.basicOffsetTable.length!==0?De(re,se,ve):Q(re,se,0,se.fragments.length)}s.default={isStringVr:f,isPrivateTag:u,parsePN:d,parseTM:h,parseDA:p,explicitElementToString:m,explicitDataSetToJS:w,createJPEGBasicOffsetTable:C,parseDicomDataSetExplicit:J,parseDicomDataSetImplicit:ie,readFixedString:_,alloc:fe,version:ae,bigEndianByteArrayParser:de,ByteStream:Te,sharedCopy:we,DataSet:b,findAndSetUNElementLength:S,findEndOfEncapsulatedElement:T,findItemDelimitationItemAndSetElementLength:I,littleEndianByteArrayParser:G,parseDicom:W,readDicomElementExplicit:j,readDicomElementImplicit:M,readEncapsulatedImageFrame:De,readEncapsulatedPixelData:We,readEncapsulatedPixelDataFromFragments:Q,readPart10Header:P,readSequenceItemsExplicit:L,readSequenceItemsImplicit:B,readSequenceItem:R,readTag:x,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],o={},n.m=i,n.c=o,n.d=function(a,s,c){n.o(a,s)||Object.defineProperty(a,s,{enumerable:!0,get:c})},n.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,s){if(1&s&&(a=n(a)),8&s||4&s&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(n.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),2&s&&typeof a!="string")for(var l in a)n.d(c,l,(function(f){return a[f]}).bind(null,l));return c},n.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(s,"a",s),s},n.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},n.p="",n(n.s=1);function n(a){if(o[a])return o[a].exports;var s=o[a]={i:a,l:!1,exports:{}};return i[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var i,o})})(dm)),dm.exports}var Vi=T1e();const S1e=ka(Vi);function z2(t){const e=t.indexOf(":");let r=t.substring(e+1);const n=r.indexOf("frame=");let i;if(n!==-1){const s=r.substring(n+6);i=parseInt(s,10),r=r.substring(0,n-1)}const o=t.substring(0,e),a=i!==void 0?i-1:void 0;return{scheme:o,url:r,frame:i,pixelDataFrame:a}}let Sw={open(t,e){t.open("get",e,!0)},beforeSend:async()=>{},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function _1e(t){Sw=Object.assign(Sw,t)}function j2(){return Sw}function U3(t,e,r={},n={}){const i=j2(),o=c=>{if(typeof i.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,i.errorInterceptor(l)}},a=new XMLHttpRequest,s=new Promise(async(c,l)=>{i.open(a,t,r,n);const f=await i.beforeSend(a,e,r,n);a.responseType="arraybuffer";const u=Object.assign({},r,f);Object.keys(u).forEach(function(d){u[d]!==null&&(d==="Accept"&&t.indexOf("accept=")!==-1||a.setRequestHeader(d,u[d]))}),n.deferred={resolve:c,reject:l},n.url=t,n.imageId=e,a.onloadstart=function(d){i.onloadstart&&i.onloadstart(d,n),Xe(ke,"cornerstoneimageloadstart",{url:t,imageId:e})},a.onloadend=function(d){i.onloadend&&i.onloadend(d,n),Xe(ke,"cornerstoneimageloadend",{url:t,imageId:e})},a.onreadystatechange=function(d){i.onreadystatechange&&i.onreadystatechange(d,n),a.readyState===4&&(a.status===200||a.status===206?i.beforeProcessing(a).then(c).catch(()=>{o(a),l(a)}):(o(a),l(a)))},a.onprogress=function(d){const h=d.loaded;let g,p;d.lengthComputable&&(g=d.total,p=Math.round(h/g*100)),Xe(ke,"cornerstoneimageloadprogress",{url:t,imageId:e,loaded:h,total:g,percentComplete:p}),i.onprogress&&i.onprogress(d,n)},a.onerror=function(){o(a),l(a)},a.onabort=function(){o(a),l(a)},a.send()});return s.xhr=a,s}function E1e(t,e,r){if(r+t.length>e.length)return!1;let n=r;for(let i=0;i<t.length;i++)if(t[i]!==e[n++])return!1;return!0}function b1e(t){const e=new Uint8Array(t.length);for(let r=0,n=t.length;r<n;r++)e[r]=t.charCodeAt(r);return e}function U4(t,e,r){r=r||0;const n=b1e(e);for(let i=r;i<t.length;i++)if(n[0]===t[i]&&E1e(n,t,i))return i;return-1}const{ImageQualityStatus:B4}=go;function B3(t,e,r){r||={};const n=new Uint8Array(e),i=!!r?.isPartial;if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?B4.SUBRESOLUTION:B4.FULL_RESOLUTION,pixelData:n};let{tokenIndex:o,responseHeaders:a,boundary:s,multipartContentType:c}=r;if(o||=U4(n,`\r
\r
`),o===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(a=M1e(n,0,o).split(`\r
`),s=D1e(a),!s))throw new Error("invalid response - no boundary marker");const l=o+4,f=U4(n,s,l);if(f===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||=I1e(a),r.tokenIndex=o,r.boundary=s,r.responseHeaders=a,r.multipartContentType=c,r.isPartial=f===-1,{contentType:c,extractDone:!i||f!==-1,tokenIndex:o,responseHeaders:a,boundary:s,multipartContentType:c,pixelData:e.slice(l,f-2)}}function D1e(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function I1e(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function M1e(t,e,r){e=e||0,r=r||t.length-e;let n="";for(let i=e;i<e+r;i++)n+=String.fromCharCode(t[i]);return n}const{ImageQualityStatus:G4}=go;function G3(t,e=!0){return e?t.imageQualityStatus??G4.FULL_RESOLUTION:G4.SUBRESOLUTION}const{ProgressiveIterator:O1e}=gn;function P1e(t,e,r={},n={}){const i=j2(),{retrieveOptions:o={},streamingData:a={}}=n,s=o.minChunkSize||128*1024,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}},l=new O1e("streamRequest");return l.generate(async(f,u)=>{const d=await i.beforeSend?.(null,t,r,{}),h=Object.assign({},r,d);Object.keys(h).forEach(function(g){h[g]===null&&(h[g]=void 0),g==="Accept"&&t.indexOf("accept=")!==-1&&(h[g]=void 0)});try{const g=await fetch(t,{headers:h,signal:void 0});if(g.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${g.status}`);const p=g.body.getReader(),m=g.headers,w=m.get("content-type"),v=Number(m.get("Content-Length"));let y=!1,C=a.encodedData,x=a.lastSize||0;for(a.isPartial=!0;!y;){const{done:T,value:S}=await p.read();if(C=R1e(C,S),!C){if(y)throw new Error(`Done but no image frame available ${e}`);continue}if(y=T||C.byteLength===v,!y&&C.length<x+s)continue;x=C.length,a.isPartial=!T;const _=B3(w,C,a),E=G3(o,y),D={url:t,imageId:e,..._,percentComplete:T?100:_.pixelData?.length*100/v,imageQualityStatus:E,done:y};f.add(D,y)}}catch(g){c(),console.error(g),u(g)}}),l.getNextPromise()}function R1e(t,e){if(!t)return e;if(!e)return t;const r=new Uint8Array(t.length+e.length);return r.set(t,0),r.set(e,t.length),r}function A1e(t){const e=t.elements.x7fe00010.fragments,r=t.byteArray.length;for(const n of e){const{position:i,length:o}=n;o>r-i&&(console.log(`Truncated fragment, changing fragment length from ${n.length} to ${r-i}`),n.length=r-i)}return t}function L1e(t){let e=Vi.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let r;try{r=Vi.parseDicom(t)}catch(n){console.error(n),console.log("pixel data dataset:",n.dataSet),r=n.dataSet}return e.elements.x7fe00010=r.elements.x7fe00010,e=A1e(e),e}async function WL(t,e,r){const n=L1e(t),{uri:i,imageId:o,fileTotalLength:a}=r;return n.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:o,fetchedLength:t.length,lengthToFetch:a-t.length},s),{fetchedLength:l,lengthToFetch:f}=c,{arrayBuffer:u}=await e(i,o,{byteRange:`${l}-${l+f}`}),d=new Uint8Array(u),h=new Uint8Array(n.byteArray.length+d.length);return h.set(n.byteArray),h.set(d,n.byteArray.length),WL(h,e,r)},n}function N1e(t,e){if(!t)return;const{NumberOfFrames:r,PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i}=zL(t);if(n||r>1){const{shared:o,perFrame:a}=$L(n,i,e);return{NumberOfFrames:r,PerFrameFunctionalInformation:a,SharedFunctionalInformation:o}}return{NumberOfFrames:r}}function $L(t,e,r){const n={};(e?Object.values(e.items[0].dataSet.elements):[]).map(o=>n[o.tag]=o);const i={};return(t?Object.values(t.items[r-1].dataSet.elements):[]).map(o=>i[o.tag]=o),{shared:n,perFrame:i}}function zL(t){if(!t)return;const{elements:e,...r}=t,{x52009230:n,x52009229:i,...o}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i,otherElements:o,otherAttributtes:r}}function V1e(t,e){if(!e)return;const{NumberOfFrames:r,PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i,otherElements:o}=zL(e);if(n||r>1){const{shared:a,perFrame:s}=$L(n,i,t),c={elements:{...o,...a,...s}},l=Object.create(e);return Object.assign(l,c)}return e}let ni={};const k1e=()=>{ni={}};function W3(t){if(ni[t])return ni[t]}function F1e(t){const e=W3(t);return jL(e)}function jL(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function U1e(t){return t.indexOf("&frame=")}function B1e(t){const e=U1e(t),r=e===-1?t:t.slice(0,e),n=parseInt(t.slice(e+7),10)||1;let i;return ni[r]?i=ni[r].dataSet:i=void 0,{dataSet:i,frame:n}}function G1e(t){const e=[],r=W3(t);if(jL(r)){const n=r.intString("x00280008");for(let i=1;i<=n;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const HL={_get:W3,generateMultiframeWADOURIs:G1e,retrieveMultiframeDataset:B1e,isMultiframeDataset:F1e};let I0=0,Tu={};function W1e(t){return ni[t]!==void 0}function $1e(t){let e;if(t.includes("&frame=")){const{frame:r,dataSet:n}=HL.retrieveMultiframeDataset(t);e=V1e(r,n)}else ni[t]&&(e=ni[t].dataSet);return e}function z1e(t,e){const r=ni[t];if(!r){console.error(`No loaded dataSet for uri ${t}`);return}I0-=r.dataSet.byteArray.length,r.dataSet=e,I0+=e.byteArray.length,Xe(ke,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:H2()})}function j1e(t,e=U3,r){if(ni[t])return new Promise(o=>{ni[t].cacheCount++,o(ni[t].dataSet)});if(Tu[t])return Tu[t].cacheCount++,Tu[t];const n=e(t,r),i=new Promise((o,a)=>{n.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return a(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const l=new Uint8Array(s);let f;try{c.isPartialContent?f=await WL(l,e,{uri:t,imageId:r,fileTotalLength:c.fileTotalLength}):f=Vi.parseDicom(l)}catch(u){return a(u)}ni[t]={dataSet:f,cacheCount:i.cacheCount},I0+=f.byteArray.length,o(f),Xe(ke,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:H2()})},a).then(()=>{delete Tu[t]},()=>{delete Tu[t]})});return i.cacheCount=1,Tu[t]=i,i}function H1e(t){ni[t]&&(ni[t].cacheCount--,ni[t].cacheCount===0&&(I0-=ni[t].dataSet.byteArray.length,delete ni[t],Xe(ke,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:H2()})))}function H2(){return{cacheSizeInBytes:I0,numberOfDataSetsCached:Object.keys(ni).length}}function K1e(){k1e(),Tu={},I0=0}const Qd={isLoaded:W1e,load:j1e,unload:H1e,getInfo:H2,purge:K1e,get:$1e,update:z1e};function X1e(t){const e=[];for(let r=0;r<=30;r+=2){let n=`x60${r.toString(16)}`;n.length===4&&(n=`x600${r.toString(16)}`);const i=t.elements[`${n}3000`];if(!i)continue;const o=[];for(let a=0;a<i.length;a++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+a];o[a*8+s]=c>>s&1}e.push({rows:t.uint16(`${n}0010`),columns:t.uint16(`${n}0011`),type:t.string(`${n}0040`),x:t.int16(`${n}0050`,1)-1,y:t.int16(`${n}0050`,0)-1,pixelData:o,description:t.string(`${n}0022`),label:t.string(`${n}1500`),roiArea:t.string(`${n}1301`),roiMean:t.string(`${n}1302`),roiStandardDeviation:t.string(`${n}1303`)})}return{overlays:e}}function td(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function $3(t,e){const r=t.string("x00080008");if(r){const n=r.split("\\");if(n.length>e)return n[e]}}function q1e(t){let e;if(t.string("x00080060")?.includes("NM")){const n=$3(t,2);n&&td(n)&&t.elements.x00540022&&(e=Ds(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function Y1e(t){let e;if(t.string("x00080060")?.includes("NM")){const n=$3(t,2);n&&td(n)&&t.elements.x00540022&&(e=Ds(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function W4(t){let e=Ds(t,"x00200037",6);return!e&&t.elements.x00209116?.items?.[0]?.dataSet&&(e=Ds(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=q1e(t)),e}function $4(t){let e=Ds(t,"x00200032",3);return!e&&t.elements.x00209113?.items?.[0]?.dataSet&&(e=Ds(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=Y1e(t)),e}function z4(t){let e=Ds(t,"x00280030",2);return!e&&t.elements.x00289110?.items?.[0]?.dataSet&&(e=Ds(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function j4(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}const KL=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function H4(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(n=>{const i=n.dataSet.double("x0018602c"),o=n.dataSet.double("x0018602e"),a=n.dataSet.uint16("x00186024"),s=n.dataSet.uint16("x00186026"),c=n.dataSet.uint16("x0018601a"),l=n.dataSet.uint16("x0018601e"),f=n.dataSet.uint16("x00186018"),u=n.dataSet.uint16("x0018601c"),d=n.dataSet.int32("x00186020")||null,h=n.dataSet.int32("x00186022")||null,g=n.dataSet.uint16("x0018602a"),p=n.dataSet.uint16("x00186028"),m=n.dataSet.uint16("x00186012"),w=n.dataSet.uint16("x00186014"),v=n.dataSet.uint16("x00186016"),y=n.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:d,referencePixelY0:h,physicalDeltaX:i,physicalDeltaY:o,physicalUnitsXDirection:a,physicalUnitsYDirection:s,referencePhysicalPixelValueY:g,referencePhysicalPixelValueX:p,regionSpatialFormat:m,regionDataType:w,regionFlags:v,transducerFrequency:y}})}function J1e(t,e){const{MetadataModules:r}=go;if(Array.isArray(e))return;const n=z2(e);if(t===r.MULTIFRAME){const a=HL.retrieveMultiframeDataset(n.url);return a.dataSet?N1e(a.dataSet,a.frame):void 0}let i=n.url;n.frame&&(i=`${i}&frame=${n.frame}`);const o=Qd.get(i);if(o)return Z1e(t,e,o)}function Z1e(t,e,r){const{MetadataModules:n}=go;if(t===n.GENERAL_STUDY)return{studyDescription:r.string("x00081030"),studyDate:Vi.parseDA(r.string("x00080020")),studyTime:Vi.parseTM(r.string("x00080030")||""),accessionNumber:r.string("x00080050")};if(t===n.GENERAL_SERIES)return{modality:r.string("x00080060"),seriesInstanceUID:r.string("x0020000e"),seriesDescription:r.string("x0008103e"),seriesNumber:r.intString("x00200011"),studyInstanceUID:r.string("x0020000d"),seriesDate:Vi.parseDA(r.string("x00080021")),seriesTime:Vi.parseTM(r.string("x00080031")||""),acquisitionDate:Vi.parseDA(r.string("x00080022")),acquisitionTime:Vi.parseTM(r.string("x00080032")||"")};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:r.string("x00080018"),instanceNumber:r.intString("x00200013"),lossyImageCompression:r.string("x00282110"),lossyImageCompressionRatio:r.floatString("x00282112"),lossyImageCompressionMethod:r.string("x00282114")};if(t===n.PATIENT)return{patientID:r.string("x00100020"),patientName:r.string("x00100010")};if(t===n.PATIENT_STUDY)return{patientAge:r.intString("x00101010"),patientSize:r.floatString("x00101020"),patientSex:r.string("x00100040"),patientWeight:r.floatString("x00101030")};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=r.string("x00080060"),o=$3(r,2);return{modality:i,imageType:r.string("x00080008"),imageSubType:o,imageOrientationPatient:W4(r),imagePositionPatient:$4(r),sliceThickness:j4(r),pixelSpacing:z4(r),numberOfFrames:r.uint16("x00280008"),isNMReconstructable:td(o)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){const i=W4(r),o=$4(r),a=z4(r),s=j4(r);let c=null,l=null,f=!1;a?(l=a[0],c=a[1]):(f=!0,l=1,c=1);let u=null,d=null;return i&&(u=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],d=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:r.string("x00200052"),rows:r.uint16("x00280010"),columns:r.uint16("x00280011"),imageOrientationPatient:i,rowCosines:u,columnCosines:d,imagePositionPatient:o,sliceThickness:s,sliceLocation:r.floatString("x00201041"),pixelSpacing:a,rowPixelSpacing:l,columnPixelSpacing:c,usingDefaultValues:f}}if(t===n.CINE)return{frameTime:r.floatString("x00181063")};if(t===n.IMAGE_PIXEL)return v1e(r);if(t===n.VOI_LUT){const i=C1e(r);return{windowCenter:Ds(r,"x00281050",1),windowWidth:Ds(r,"x00281051",1),voiLUTSequence:k4(i,r.elements.x00283010),voiLUTFunction:r.string("x00281056")}}if(t===n.MODALITY_LUT)return{rescaleIntercept:r.floatString("x00281052"),rescaleSlope:r.floatString("x00281053"),rescaleType:r.string("x00281054"),modalityLUTSequence:k4(r.uint16("x00280103"),r.elements.x00283000)};if(t===n.SOP_COMMON)return{sopClassUID:r.string("x00080016"),sopInstanceUID:r.string("x00080018")};if(t===n.PET_ISOTOPE){const i=r.elements.x00540016;if(i===void 0)return;const o=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Vi.parseTM(o.string("x00181072")||""),radionuclideTotalDose:o.floatString("x00181074"),radionuclideHalfLife:o.floatString("x00181075")}}}if(t===n.OVERLAY_PLANE)return X1e(r);if(t==="transferSyntax"){let i;try{i=r.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===n.PET_SERIES)return{correctedImage:r.string("x00280051"),units:r.string("x00541001"),decayCorrection:r.string("x00541102")};if(t===n.PET_IMAGE)return{frameReferenceTime:r.floatString(r.string("x00541300")||""),actualFrameDuration:r.intString(r.string("x00181242"))};if(t===n.ULTRASOUND_ENHANCED_REGION)return H4(r);if(t===n.CALIBRATION&&r.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:H4(r)};if(t==="instance")return LC(e,KL)}let K2=[];function Q1e(t){return`dicomfile:${K2.push(t)-1}`}function e2e(t){return K2[t]}function t2e(t){K2[t]=void 0}function n2e(){K2=[]}const XL={add:Q1e,get:e2e,remove:t2e,purge:n2e};function r2e(t){const e=t.intString("x00280008"),r=t.elements.x7fe00010;return e!==r.fragments.length}function i2e(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return Vi.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(r2e(t)){const l=Vi.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return Vi.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const r=t.elements.x7fe00010.fragments,n=new Vi.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=Vi.readSequenceItem(n);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";n.seek(i.length);const o=n.position;if(e+1>r.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=o+r[e].offset+8,c=r[e].length;return new Uint8Array(n.byteArray.buffer.slice(n.byteArray.byteOffset+s,n.byteArray.byteOffset+s+c))}function o2e(t,e){return t&1<<e}function a2e(t,e,r){const n=new Uint8Array(r);for(let i=0;i<r;i++){const o=Math.floor(i/8),a=t[o+e],s=i%8;n[i]=o2e(a,s)?1:0}return n}function s2e(t,e){const r=t.elements.x7fe00010||t.elements.x7fe00008,n=t.uint16("x00280100"),i=t.uint16("x00280010"),o=t.uint16("x00280011");let a=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(a=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=r.dataOffset,l=i*o*a;let f;if(n===8){if(f=c+e*l,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l))}else if(n===16){if(f=c+e*l*2,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*2))}else if(n===1){if(f=c+e*l*.125,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return a2e(t.byteArray,f,l)}else if(n===32){if(f=c+e*l*4,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*4))}throw new Error("unsupported pixel format")}function c2e(t){const e=z2(t),r=parseInt(e.url,10),n=XL.get(r);return new Promise((i,o)=>{const a=new FileReader;a.onload=s=>{const c=s.target.result;i(c)},a.onerror=o,a.readAsArrayBuffer(n)})}function qL(t,e=0){const r=t.elements.x7fe00010||t.elements.x7fe00008;return r?r.encapsulatedPixelData?i2e(t,e):s2e(t,e):null}function z3(t){let e=t[0],r=t[0],n;const i=t.length;for(let o=1;o<i;o++)n=t[o],e=Math.min(e,n),r=Math.max(r,n);return{min:e,max:r}}function l2e(t,e,r){t.planarConfiguration===0?GL(t.pixelData,e,r):u1e(t.pixelData,e,r)}function u2e(t,e,r){t.planarConfiguration===0?f1e(t.pixelData,e,r):d1e(t.pixelData,e,r)}function f2e(t,e,r){const{photometricInterpretation:n}=t;if(t.photometricInterpretation==="RGB")l2e(t,e,r);else if(n==="YBR_RCT"||n==="YBR_ICT"||n==="YBR_PARTIAL_420")GL(t.pixelData,e,r);else if(t.photometricInterpretation==="PALETTE COLOR")g1e(t,e,r);else if(t.photometricInterpretation==="YBR_FULL_422")h1e(t.pixelData,e,r);else if(t.photometricInterpretation==="YBR_FULL")u2e(t,e,r);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function d2e(t){if(t===void 0)return!1;const{rows:e,columns:r,photometricInterpretation:n,pixelDataLength:i,planarConfiguration:o}=t;return i===4*r*e?!1:n==="PALETTE COLOR"?!0:n.endsWith("420")?i===(3*Math.ceil(r/2)+Math.floor(r/2))*e:n.endsWith("422")?i===(3*Math.ceil(r/2)+Math.floor(r/2))*Math.ceil(e/2)+Math.floor(e/2)*r:n!=="RGB"||o===1}function h2e(t){return g2e(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function g2e(t){let e;try{return decodeURIComponent(escape(t))}catch(r){if(e=r,e instanceof URIError)return t;throw e}}function p2e(t,e,r){const n=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((o,a)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){r.height=c.height,r.width=c.width,t.rows=c.height,t.columns=c.width;const l=r.getContext("2d");l.drawImage(this,0,0);const f=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(f.data.buffer),t.imageData=f,t.decodeTimeInMS=u-n;const d=z3(t.pixelData);t.smallestPixelValue=d.min,t.largestPixelValue=d.max,t.pixelDataLength=t.pixelData.length,o(t)},c.onerror=function(l){a(l)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(h2e(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{a(c)}})}function so(t,e,r,n,i){const o={...n};delete o.loader,delete o.streamingData;const a=Is(),s=o.priority||void 0;return o.transferPixelData&&r.buffer,a.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:r,options:o,decodeConfig:i},{priority:s,requestType:o?.requestType})}function m2e(t,e,r,n,i={},o){switch(e){case"1.2.840.10008.1.2":return so(t,e,r,i,o);case"1.2.840.10008.1.2.1":return so(t,e,r,i,o);case"1.2.840.10008.1.2.2":return so(t,e,r,i,o);case"1.2.840.10008.1.2.1.99":return so(t,e,r,i,o);case"1.2.840.10008.1.2.5":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?p2e(t,r,n):so(t,e,r,i,o);case"1.2.840.10008.1.2.4.51":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.57":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.70":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.80":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.81":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.90":return so(t,e,r,i,o);case"1.2.840.10008.1.2.4.91":return so(t,e,r,i,o);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return so(t,e,r,i,o)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function v2e(t){const e=ut("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function y2e(t,e){const r=t.get("modalityLutModule",e)||{},n=t.get("generalSeriesModule",e)||{},{modality:i}=n,o={rescaleSlope:r.rescaleSlope,rescaleIntercept:r.rescaleIntercept,modality:i},a=t.get("scalingModule",e)||{};return{...o,...i==="PT"&&{suvbw:a.suvbw},...i==="RTDOSE"&&{doseGridScaling:a.DoseGridScaling,doseSummation:a.DoseSummation,doseType:a.DoseType,doseUnit:a.DoseUnit}}}function YL(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}function w2e(t,e){const r=t.length/4;let n=0,i=0;for(let o=0;o<r;o++)e[i++]=t[n++],e[i++]=t[n++],e[i++]=t[n++],n++;return e}function C2e(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function j3(t,e){let r;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?r=Uint8Array:e<=65535?r=Uint16Array:e<=4294967295&&(r=Uint32Array):t>=-128&&e<=127?r=Int8Array:t>=-32768&&e<=32767&&(r=Int16Array)),r||Float32Array}function x2e(t,e,r){return j3(t,e)===r}function T2e(t){const e=t.smallestPixelValue,r=t.largestPixelValue,n=j3(e,r);if(n){const i=new n(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}let K4="";function H3(t,e,r,n={}){const i=n.useRGBA;if(n.preScale={enabled:n.preScale&&n.preScale.enabled!==void 0?n.preScale.enabled:!0},!e?.length)return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:o}=go,a=document.createElement("canvas"),s=v2e(t);if(s.decodeLevel=n.decodeLevel,n.allowFloatRendering=N1(),n.preScale.enabled){const u=y2e(t9,t);u&&(n.preScale={...n.preScale,scalingParameters:u})}const{decodeConfig:c}=j2();Object.keys(s).forEach(u=>{(typeof s[u]=="function"||s[u]instanceof Promise)&&delete s[u]});const l=m2e(s,r,e,a,n,c),f=YL(s.photometricInterpretation);return new Promise((u,d)=>{l.then(function(h){let g=!1;if(n.targetBuffer&&n.targetBuffer.type&&!f){const{arrayBuffer:E,type:D,offset:b=0,length:I}=n.targetBuffer,O=h.pixelDataLength,M=b,R=I??O-M,A={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};if(R!==h.pixelDataLength)throw new Error(`target array for image does not have the same length (${R}) as the decoded image length (${h.pixelDataLength}).`);const B=A[D],k=E?new B(E,M,R):new B(h.pixelData);if(R!==h.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");h.pixelData=k,g=!0}g||T2e(h);const p=ut(o.IMAGE_PLANE,t)||{},m=ut(o.VOI_LUT,t)||{},w=ut(o.MODALITY_LUT,t)||{},v=ut(o.SOP_COMMON,t)||{},y=ut(o.CALIBRATION,t)||{},{rows:C,columns:x}=h;if(f){if(d2e(h)){a.height=h.rows,a.width=h.columns;let b=a.getContext("2d").createImageData(h.columns,h.rows);i||(b={...b,data:new Uint8ClampedArray(3*h.columns*h.rows)}),f2e(h,b.data,i),h.imageData=b,h.pixelData=b.data,h.pixelDataLength=b.data.length}else if(!i&&h.pixelDataLength===4*C*x){const D=new Uint8Array(h.pixelData.length/4*3);h.pixelData=w2e(h.pixelData,D),h.pixelDataLength=h.pixelData.length}const E=z3(h.pixelData);h.smallestPixelValue=E.min,h.largestPixelValue=E.max}let T=h.samplesPerPixel;h.photometricInterpretation==="PALETTE COLOR"&&(T=i?4:3);const S=La.createImageVoxelManager({scalarData:h.pixelData,width:h.columns,height:h.rows,numberOfComponents:T}),_={imageId:t,dataType:h.pixelData.constructor.name,color:f,calibration:y,columnPixelSpacing:p.columnPixelSpacing,columns:h.columns,height:h.rows,preScale:h.preScale,intercept:w.rescaleIntercept?w.rescaleIntercept:0,slope:w.rescaleSlope?w.rescaleSlope:1,invert:h.photometricInterpretation==="MONOCHROME1",minPixelValue:h.smallestPixelValue,maxPixelValue:h.largestPixelValue,rowPixelSpacing:p.rowPixelSpacing,rows:h.rows,sizeInBytes:h.pixelData.byteLength,width:h.columns,windowCenter:m.windowCenter?m.windowCenter[0]:void 0,windowWidth:m.windowWidth?m.windowWidth[0]:void 0,voiLUTFunction:m.voiLUTFunction?m.voiLUTFunction:void 0,decodeTimeInMS:h.decodeTimeInMS,floatPixelData:void 0,imageFrame:h,voxelManager:S,rgba:f&&i,getPixelData:()=>h.pixelData,getCanvas:void 0,numberOfComponents:T};if(_.color&&(_.getCanvas=function(){if(K4===t)return a;const E=_.columns,D=_.rows;a.height=D,a.width=E;const b=a.getContext("2d"),I=b.createImageData(E,D),O=h.pixelData;if(O.length===E*D*4)for(let M=0;M<O.length;M++)I.data[M]=O[M];else if(O.length===E*D*3){let M=0;for(let R=0;R<O.length;R+=3)I.data[M++]=O[R],I.data[M++]=O[R+1],I.data[M++]=O[R+2],I.data[M++]=255}return h.pixelData=I.data,h.pixelDataLength=I.data.length,h.imageData=I,b.putImageData(h.imageData,0,0),K4=t,a}),w.modalityLUTSequence&&w.modalityLUTSequence.length>0&&C2e(v.sopClassUID)&&(_.modalityLUT=w.modalityLUTSequence[0]),m.voiLUTSequence&&m.voiLUTSequence.length>0&&(_.voiLUT=m.voiLUTSequence[0]),_.color&&(_.windowWidth=256,_.windowCenter=128),_.windowCenter===void 0||_.windowWidth===void 0){const E=R0(_.imageFrame.smallestPixelValue,_.imageFrame.largestPixelValue);_.windowWidth=E.windowWidth,_.windowCenter=E.windowCenter}u(_)},d)})}const{ImageQualityStatus:JL}=go;function S2e(t,e){t.decache=function(){const r=z2(e);Qd.unload(r.url)}}function _2e(t,e,r=0,n,i,o){const a=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,l)=>{t.then(f=>{const u=qL(f,r),d=f.string("x00020010"),h=new Date().getTime(),g=H3(e,u,d,i);S2e(s,e),g.then(p=>{p=p,p.data=f,p.sharedCacheKey=n;const m=new Date().getTime();p.loadTimeInMS=h-a,p.totalTimeInMS=m-a,p.imageQualityStatus=JL.FULL_RESOLUTION,o!==void 0&&o.imageDoneCallback!==void 0&&o.imageDoneCallback(p),c(p)},function(p){l({error:p,dataSet:f})})},function(f){l({error:f})})}),s}function E2e(t,e,r=0,n,i){const o=new Date().getTime();return{promise:new Promise((s,c)=>{const l=new Date().getTime();let f;try{const u=qL(t,r),d=t.string("x00020010");f=H3(e,u,d,i)}catch(u){c({error:u,dataSet:t});return}f.then(u=>{u=u,u.data=t;const d=new Date().getTime();u.loadTimeInMS=l-o,u.totalTimeInMS=d-o,u.imageQualityStatus=JL.FULL_RESOLUTION,s(u)},c)}),cancelFn:void 0}}function b2e(t){if(t==="dicomweb"||t==="wadouri")return U3;if(t==="dicomfile")return c2e}function Vy(t,e={}){const r=z2(t);e=Object.assign({},e),delete e.loader;const n=b2e(r.scheme);if(Qd.isLoaded(r.url)){const o=Qd.get(r.url,n,t);return E2e(o,t,r.pixelDataFrame,r.url,e)}const i=Qd.load(r.url,n,t);return _2e(i,t,r.frame,r.url,e)}function D2e(){Zf("dicomweb",Vy),Zf("wadouri",Vy),Zf("dicomfile",Vy),L0(J1e)}const I2e={fileManager:XL};function zt(t,e,r){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?r:t.Value[e]}function kn(t,e){const r=zt(t,e);if(r!==void 0)return parseFloat(r)}function Yi(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const r=[];for(let n=0;n<t.Value.length;n++)r.push(parseFloat(t.Value[n]));return r}function M2e(t){const e=[];for(let r=0;r<=30;r+=2){let n=`x60${r.toString(16)}`;n.length===4&&(n=`x600${r.toString(16)}`);const i=zt(t[`${n}3000`]);if(!i)continue;const o=[];for(let a=0;a<i.length;a++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+a];o[a*8+s]=c>>s&1}e.push({rows:kn(t[`${n}0010`]),columns:kn(t[`${n}0011`]),type:zt(t[`${n}0040`]),x:kn(t[`${n}0050`],1)-1,y:kn(t[`${n}0050`],0)-1,pixelData:o,description:zt(t[`${n}0022`]),label:zt(t[`${n}1500`]),roiArea:zt(t[`${n}1301`]),roiMean:zt(t[`${n}1302`]),roiStandardDeviation:zt(t[`${n}1303`])})}return{overlays:e}}function X2(t){const e=t.indexOf(":");return t.substring(e+1)}function c0(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function ZL(t,e,r){const n=(e?Object.values(e[0]):[]).map(o=>o.Value?.[0]).filter(o=>o!==void 0&&typeof o=="object"),i=(t?Object.values(t[r-1]):[]).map(o=>o.Value?.[0]).filter(o=>o!==void 0&&typeof o=="object");return{shared:n,perFrame:i}}function QL(t){let{52009230:e,52009229:r,"00280008":n,...i}=t;return e=c0(e,!1),r=c0(r,!1),n=c0(n),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:r,NumberOfFrames:n,rest:i}}function O2e(t,e){const{PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:n,NumberOfFrames:i,rest:o}=QL(e);if(r||i>1){const{shared:a,perFrame:s}=ZL(r,n,t),c=Object.assign(e,{frameNumber:t});return[...a,...s].forEach(l=>{Object.entries(l).forEach(([f,u])=>{c[f]=u})}),Object.assign(o,{"00280008":i},c)}return e}let kg=[],P1={};function eN(t){const e=t.indexOf("/frames/")+8,r=t.slice(0,e),n=parseInt(t.slice(e),10);return{metadata:kg[`${r}1`],frame:n}}function P2e(t){const e=X2(t);return eN(e)}function R2e(t){if(t[52009230]!==void 0||t[52009229]!==void 0)return!0;const e=zt(t["00280008"]);return e&&e>1}function A2e(t,e){const r=X2(t);Object.defineProperty(e,"isMultiframe",{value:R2e(e),enumerable:!1}),kg[r]=e}function L2e(t){const e=X2(t),r=kg[e];if(r&&!r?.isMultiframe)return r;const n=P1[e];if(n)return n;const i=eN(e);if(!i||!i.metadata)return;const{metadata:o,frame:a}=i;if(o){const s=O2e(a,o);return P1[e]=s,s}}function N2e(t){const e=X2(t);kg[e]=void 0,P1[e]=void 0}function V2e(){kg=[],P1={}}const tN={add:A2e,get:L2e,remove:N2e,purge:V2e};function nN(t){return zt(t["00080060"]).includes("NM")}function K3(t,e){const r=c0(t["00080008"],!1);if(r)return r[e]}function k2e(t){let e;const r=K3(t,2);if(r&&td(r)){const n=c0(t["00540022"]);n&&(e=Yi(n["00200037"],6))}return e}function F2e(t){let e;const r=K3(t,2);if(r&&td(r)){const n=c0(t["00540022"]);n&&(e=Yi(n["00200032"],3))}return e}function X4(t){let e=Yi(t["00200037"],6);return!e&&nN(t)&&(e=k2e(t)),e}function q4(t){let e=Yi(t["00200032"],3);return!e&&nN(t)&&(e=F2e(t)),e}function Pi(t,e){const r=Yi(t[e]);return r?r[0]:null}function U2e(t){return t?.Value?.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function Y4(t){const e=U2e(t["00186011"]);return!e||!e.length?null:e.map(n=>{const i=Pi(n,"0018602C"),o=Pi(n,"0018602E"),a=Pi(n,"00186024"),s=Pi(n,"00186026"),c=Pi(n,"0018601A"),l=Pi(n,"0018601E"),f=Pi(n,"00186018"),u=Pi(n,"0018601C"),d=Pi(n,"00186020"),h=Pi(n,"00186022"),g=Pi(n,"0018602A"),p=Pi(n,"00186028"),m=Pi(n,"00186012"),w=Pi(n,"00186014"),v=Pi(n,"00186016"),y=Pi(n,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:d,referencePixelY0:h,physicalDeltaX:i,physicalDeltaY:o,physicalUnitsXDirection:a,physicalUnitsYDirection:s,referencePhysicalPixelValueY:g,referencePhysicalPixelValueX:p,regionSpatialFormat:m,regionDataType:w,regionFlags:v,transducerFrequency:y}})}function B2e(t,e){const{MetadataModules:r}=go;if(t===r.MULTIFRAME){const{metadata:i,frame:o}=P2e(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:a,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=QL(i);if(a||c>1){const{shared:l,perFrame:f}=ZL(a,s,o);return{NumberOfFrames:c,PerFrameFunctionalInformation:f,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const n=tN.get(e);if(n){if(t===r.GENERAL_STUDY)return{studyDescription:zt(n["00081030"]),studyDate:zt(n["00080020"]),studyTime:zt(n["00080030"]),accessionNumber:zt(n["00080050"])};if(t===r.GENERAL_SERIES)return{modality:zt(n["00080060"]),seriesInstanceUID:zt(n["0020000E"]),seriesDescription:zt(n["0008103E"]),seriesNumber:kn(n["00200011"]),studyInstanceUID:zt(n["0020000D"]),seriesDate:zt(n["00080021"]),seriesTime:zt(n["00080031"]),acquisitionDate:zt(n["00080022"]),acquisitionTime:zt(n["00080032"])};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:zt(n["00080018"]),instanceNumber:kn(n["00200013"]),lossyImageCompression:zt(n["00282110"]),lossyImageCompressionRatio:kn(n["00282112"]),lossyImageCompressionMethod:zt(n["00282114"])};if(t===r.PATIENT)return{patientID:zt(n["00100020"]),patientName:zt(n["00100010"])};if(t===r.PATIENT_STUDY)return{patientAge:kn(n["00101010"]),patientSize:kn(n["00101020"]),patientSex:zt(n["00100040"]),patientWeight:kn(n["00101030"])};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=zt(n["00080060"]),o=K3(n,2);return{modality:i,imageType:zt(n["00080008"]),imageSubType:o,imageOrientationPatient:X4(n),imagePositionPatient:q4(n),sliceThickness:kn(n["00180050"]),spacingBetweenSlices:kn(n["00180088"]),pixelSpacing:Yi(n["00280030"],2),numberOfFrames:kn(n["00280008"]),isNMReconstructable:td(o)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){let i=X4(n),o=q4(n);const a=Yi(n["00280030"],2);let s=null,c=null,l=null,f=null,u=!1;return a?(c=a[0],s=a[1]):(u=!0,c=1,s=1),i?(l=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],f=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(l=[1,0,0],f=[0,1,0],u=!0,i=[...l,...f]),o||(o=[0,0,0],u=!0),{frameOfReferenceUID:zt(n["00200052"]),rows:kn(n["00280010"]),columns:kn(n["00280011"]),imageOrientationPatient:i,rowCosines:l,columnCosines:f,imagePositionPatient:o,sliceThickness:kn(n["00180050"]),sliceLocation:kn(n["00201041"]),pixelSpacing:a,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:u}}if(t===r.ULTRASOUND_ENHANCED_REGION)return Y4(n);if(t===r.CALIBRATION&&zt(n["00080060"])==="US")return{sequenceOfUltrasoundRegions:Y4(n)};if(t===r.IMAGE_URL)return G2e(e,n);if(t===r.CINE)return W2e(e,n);if(t===r.IMAGE_PIXEL)return{samplesPerPixel:kn(n["00280002"]),photometricInterpretation:zt(n["00280004"]),rows:kn(n["00280010"]),columns:kn(n["00280011"]),bitsAllocated:kn(n["00280100"]),bitsStored:kn(n["00280101"]),highBit:zt(n["00280102"]),pixelRepresentation:kn(n["00280103"]),planarConfiguration:kn(n["00280006"]),pixelAspectRatio:zt(n["00280034"]),smallestPixelValue:kn(n["00280106"]),largestPixelValue:kn(n["00280107"]),redPaletteColorLookupTableDescriptor:Yi(n["00281101"]),greenPaletteColorLookupTableDescriptor:Yi(n["00281102"]),bluePaletteColorLookupTableDescriptor:Yi(n["00281103"]),redPaletteColorLookupTableData:Yi(n["00281201"]),greenPaletteColorLookupTableData:Yi(n["00281202"]),bluePaletteColorLookupTableData:Yi(n["00281203"])};if(t===r.VOI_LUT)return{windowCenter:Yi(n["00281050"],1),windowWidth:Yi(n["00281051"],1),voiLUTFunction:zt(n["00281056"])};if(t===r.MODALITY_LUT)return{rescaleIntercept:kn(n["00281052"]),rescaleSlope:kn(n["00281053"]),rescaleType:zt(n["00281054"])};if(t===r.SOP_COMMON)return{sopClassUID:zt(n["00080016"]),sopInstanceUID:zt(n["00080018"])};if(t===r.PET_ISOTOPE){const i=zt(n["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:zt(i["00181072"],0,""),radiopharmaceuticalStartDateTime:zt(i["00181078"],0,""),radionuclideTotalDose:kn(i["00181074"]),radionuclideHalfLife:kn(i["00181075"])}}}if(t===r.OVERLAY_PLANE)return M2e(n);if(t==="transferSyntax")return rN(e,n);if(t===r.PET_SERIES){let i=n["00280051"],o=zt(n["00280051"]);return i&&i.Value&&Array.isArray(i.Value)&&(o=i.Value.join("\\")),{correctedImage:o,units:zt(n["00541001"]),decayCorrection:zt(n["00541102"])}}if(t===r.PET_IMAGE)return{frameReferenceTime:kn(n["00541300"]),actualFrameDuration:kn(n["00181242"])};if(t==="instance")return LC(e,KL)}}function G2e(t,e){const{transferSyntaxUID:r}=rN(t,e),n=A7(r),i=t.substring(7),o=i.replace("/frames/","/thumbnail/");let a=i.replace("/frames/","/rendered/");return n&&(a=a.replace("/rendered/1","/rendered")),{isVideo:n,rendered:a,thumbnail:o}}function W2e(t,e){return{cineRate:zt(e["00180040"]),numberOfFrames:kn(e["00280008"])}}function rN(t,e){return{transferSyntaxUID:zt(e["00020010"])||zt(e["00083002"])}}function $2e(t,e,r={},n={}){const i=j2(),{retrieveOptions:o={},streamingData:a}=n,s=a.chunkSize||j2e(e,o,"chunkSize")||65536,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}else console.warn("rangeRequest:Caught",f)};return new Promise(async(f,u)=>{const d=Object.assign({},r);Object.keys(d).forEach(function(h){(d[h]===null||d[h]===void 0)&&delete d[h]});try{a.encodedData||(a.chunkSize=s,a.rangesFetched=0);const h=H2e(a,o),{encodedData:g,responseHeaders:p}=await z2e(t,d,h,a),m=p.get("content-type"),{totalBytes:w}=a,v=w===g.byteLength,y=B3(m,g,{isPartial:!0}),C=G3(o,v||y.extractDone===!0);f({...y,imageQualityStatus:C,percentComplete:y.extractDone?100:g.byteLength*100/w})}catch(h){c(h),console.error(h),u(h)}})}async function z2e(t,e,r,n){r&&(e=Object.assign(e,{Range:`bytes=${r[0]}-${r[1]}`}));let{encodedData:i}=n;if(r[1]&&i?.byteLength>r[1])return n;const o=await fetch(t,{headers:e,signal:void 0}),a=await o.arrayBuffer(),s=new Uint8Array(a),{status:c}=o;let l;i?(l=new Uint8Array(i.length+s.length),l.set(i,0),l.set(s,i.length),n.rangesFetched=1):(l=new Uint8Array(s.length),l.set(s,0),n.rangesFetched++),n.encodedData=i=l,n.responseHeaders=o.headers;const f=o.headers.get("Content-Range");return f?n.totalBytes=Number(f.split("/")[1]):c!==206||!r?n.totalBytes=i?.byteLength:r[1]===""||i?.length<r[1]?n.totalBytes=i.byteLength:n.totalBytes=Number.MAX_SAFE_INTEGER,n}function j2e(t,e,r){const n=e[r];if(typeof n!="function")return n;const i=tN.get(t);return n(i,t)}function H2e(t,e){const{totalBytes:r,encodedData:n,chunkSize:i=65536}=t,{rangeIndex:o=0}=e;return o===-1&&(!r||!n)?[0,""]:o===-1||n?.byteLength>r-i?[n?.byteLength||0,""]:[n?.byteLength||0,i*(o+1)-1]}function K2e(t,e,r="application/octet-stream",n){const{streamingData:i,retrieveOptions:o={}}=n||{},a={Accept:r};let s=o.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${o.urlArguments}`:t;if(o.framesPath&&(s=s.replace("/frames/",o.framesPath)),i?.url!==s&&(n.streamingData={url:s}),o.rangeIndex!==void 0)return $2e(s,e,a,n);if(o.streaming)return P1e(s,e,a,n);const c=U3(s,e,a),{xhr:l}=c;return c.then(function(f){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",d=B3(u,new Uint8Array(f));return d.imageQualityStatus=G3(o,!0),d})}const{ProgressiveIterator:J4}=gn,{ImageQualityStatus:Z4}=go,X2e=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function q2e(t){const e="1.2.840.10008.1.2";if(!t)return e;const r=t.split(";"),n={};r.forEach(o=>{const a=o.split("=");if(a.length!==2)return;const s=a[1].trim().replace(/"/g,"");n[a[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return n["transfer-syntax"]?n["transfer-syntax"]:t&&!Object.keys(n).length&&i[t]?i[t]:n.type&&i[n.type]?i[n.type]:i[t]?i[t]:e}function Y2e(){return F0}const J2e="multipart/related; type=application/octet-stream; transfer-syntax=*";function Z2e(t,e={}){const r=Y2e(),n=new Date().getTime(),i=new J4("decompress");async function o(f,u,d){i.generate(async h=>{const g=J4.as(K2e(f,u,d,e));let p=10;for await(const m of g){const{pixelData:w,imageQualityStatus:v=Z4.FULL_RESOLUTION,percentComplete:y,done:C=!0,extractDone:x=!0}=m,T=q2e(m.contentType);if(!x&&!X2e.has(T))continue;const S=m.decodeLevel??(v===Z4.FULL_RESOLUTION?0:Q2e(y,e.retrieveOptions?.decodeLevel));if(!(!C&&p<=S))try{const _={...e,decodeLevel:S},E=await H3(u,w,T,_),D=new Date().getTime();E.loadTimeInMS=D-n,E.transferSyntaxUID=T,E.imageQualityStatus=v,h.add(E,C),p=S}catch(_){if(x)throw console.warn("Couldn't decode",_),_}}})}const a=e.requestType||Zt.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return r.addRequest(o.bind(this,l,t,J2e),a,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function Q2e(t,e=4){const r=t/100-.02;return r>1/4?Math.min(e,0):r>1/16?Math.min(e,1):r>1/64?Math.min(e,2):Math.min(e,3)}function eve(){Zf("wadors",Z2e),L0(B2e)}function tve(){eve(),D2e()}const nve=()=>new Worker(new URL(""+new URL("decodeImageFrameWorker-vPDN9JO6.js",import.meta.url).href,import.meta.url),{type:"module"});function rve(t={}){_1e(t),tve();const e=Is(),r=t?.maxWebWorkers||ive();e.registerWorker("dicomImageLoader",nve,{maxWorkerInstances:r})}function ive(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function ove(t,e){const{rows:r,columns:n,data:i}=t,{rows:o,columns:a,data:s}=e,c=[],l=[],f=[];for(let u=0;u<a;u++){const d=u*(n-1)/(a-1);c[u]=Math.floor(d),l[u]=Math.min(c[u]+1,n-1),f[u]=d-c[u]}for(let u=0;u<o;u++){const d=u*(r-1)/(o-1),h=Math.floor(d)*n,g=Math.min(h+n,(r-1)*n),p=d-Math.floor(d),m=1-p,w=u*a;for(let v=0;v<a;v++){const y=i[h+c[v]],C=i[h+l[v]],x=i[g+c[v]],T=i[g+l[v]],S=1-f[v];s[w+v]=(y*S+C*f[v])*m+(x*S+T*f[v])*p}}return s}function ave(t,e){const{rows:r,columns:n,pixelData:i,samplesPerPixel:o=1}=t,{rows:a,columns:s,pixelData:c}=e,l=[];for(let f=0;f<s;f++){const u=f*(n-1)/(s-1);l[f]=Math.floor(u)*o}for(let f=0;f<a;f++){const u=f*(r-1)/(a-1),d=Math.floor(u)*n*o,h=f*s;for(let g=0;g<s;g++)for(let p=0;p<o;p++)c[h+g+p]=i[d+l[g]+p]}return c}async function Q4(t,e){let r=e.buffer,n=e.byteOffset;const i=e.length;if(t.bitsAllocated===16)n%2&&(r=r.slice(n),n=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(r,n,i/2):t.pixelData=new Int16Array(r,n,i/2);else if(t.bitsAllocated===8||t.bitsAllocated===1)t.pixelData=e;else if(t.bitsAllocated===32){if(n%2&&(r=r.slice(n),n=0),t.floatPixelData||t.doubleFloatPixelData)throw new Error("Float pixel data is not supported for parsing into ImageFrame");t.pixelRepresentation===0?t.pixelData=new Uint32Array(r,n,i/4):t.pixelRepresentation===1?t.pixelData=new Int32Array(r,n,i/4):t.pixelData=new Float32Array(r,n,i/4)}return t}function sve(t){return(t&255)<<8|t>>8&255}async function cve(t,e){if(t.bitsAllocated===16){let r=e.buffer,n=e.byteOffset;const i=e.length;n%2&&(r=r.slice(n),n=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(r,n,i/2):t.pixelData=new Int16Array(r,n,i/2);for(let o=0;o<t.pixelData.length;o++)t.pixelData[o]=sve(t.pixelData[o])}else t.bitsAllocated===8&&(t.pixelData=e);return t}async function lve(t,e){if(t.bitsAllocated===8)return t.planarConfiguration?fve(t,e):uve(t,e);if(t.bitsAllocated===16)return dve(t,e);throw new Error("unsupported pixel format for RLE")}function uve(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let c=0;const l=o.getInt32(0,!0);for(let f=0;f<l;++f){c=f;let u=o.getInt32((f+1)*4,!0),d=o.getInt32((f+2)*4,!0);d===0&&(d=r.length);const h=n*l;for(;u<d;){const g=a[u++];if(g>=0&&g<=127)for(let p=0;p<g+1&&c<h;++p)s[c]=a[u++],c+=t.samplesPerPixel;else if(g<=-1&&g>=-127){const p=a[u++];for(let m=0;m<-g+1&&c<h;++m)s[c]=p,c+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(i),t}function fve(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let c=0;const l=o.getInt32(0,!0);for(let f=0;f<l;++f){c=f*n;let u=o.getInt32((f+1)*4,!0),d=o.getInt32((f+2)*4,!0);d===0&&(d=r.length);const h=n*l;for(;u<d;){const g=a[u++];if(g>=0&&g<=127)for(let p=0;p<g+1&&c<h;++p)s[c]=a[u++],c++;else if(g<=-1&&g>=-127){const p=a[u++];for(let m=0;m<-g+1&&c<h;++m)s[c]=p,c++}}}return t.pixelData=new Uint8Array(i),t}function dve(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel*2),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i),c=o.getInt32(0,!0);for(let l=0;l<c;++l){let f=0;const u=l===0?1:0;let d=o.getInt32((l+1)*4,!0),h=o.getInt32((l+2)*4,!0);for(h===0&&(h=r.length);d<h;){const g=a[d++];if(g>=0&&g<=127)for(let p=0;p<g+1&&f<n;++p)s[f*2+u]=a[d++],f++;else if(g<=-1&&g>=-127){const p=a[d++];for(let m=0;m<-g+1&&f<n;++m)s[f*2+u]=p,f++}}}return t.pixelRepresentation===0?t.pixelData=new Uint16Array(i):t.pixelData=new Int16Array(i),t}var ky={exports:{}},eb;function hve(){return eb||(eb=1,(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(N,U){a=N,s=U});var c=Object.assign({},o),l="./this.program",f=(N,U)=>{throw U},u=typeof window=="object",d=typeof importScripts=="function",h=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function p(N){return o.locateFile?o.locateFile(N,g):g+N}var m,w,v;if(h){var y=wc,C=wc;d?g=C.dirname(g)+"/":g=__dirname+"/",m=(N,U)=>(N=le(N)?new URL(N):C.normalize(N),y.readFileSync(N,U?void 0:"utf8")),v=N=>{var U=m(N,!0);return U.buffer||(U=new Uint8Array(U)),U},w=(N,U,Z)=>{N=le(N)?new URL(N):C.normalize(N),y.readFile(N,function(ce,he){ce?Z(ce):U(he.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(N){if(!(N instanceof gt))throw N}),process.on("unhandledRejection",function(N){throw N}),f=(N,U)=>{throw process.exitCode=N,U},o.inspect=function(){return"[Emscripten Module object]"}}else(u||d)&&(d?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),n&&(g=n),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",m=N=>{var U=new XMLHttpRequest;return U.open("GET",N,!1),U.send(null),U.responseText},d&&(v=N=>{var U=new XMLHttpRequest;return U.open("GET",N,!1),U.responseType="arraybuffer",U.send(null),new Uint8Array(U.response)}),w=(N,U,Z)=>{var ce=new XMLHttpRequest;ce.open("GET",N,!0),ce.responseType="arraybuffer",ce.onload=()=>{if(ce.status==200||ce.status==0&&ce.response){U(ce.response);return}Z()},ce.onerror=Z,ce.send(null)});var x=o.print||console.log.bind(console),T=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&(l=o.thisProgram),o.quit&&(f=o.quit);var S;o.wasmBinary&&(S=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&re("no native wasm support detected");var _,E=!1;function D(N,U){N||re(U)}var b=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function I(N,U,Z){for(var ce=U+Z,he=U;N[he]&&!(he>=ce);)++he;if(he-U>16&&N.buffer&&b)return b.decode(N.subarray(U,he));for(var ye="";U<he;){var xe=N[U++];if(!(xe&128)){ye+=String.fromCharCode(xe);continue}var be=N[U++]&63;if((xe&224)==192){ye+=String.fromCharCode((xe&31)<<6|be);continue}var Le=N[U++]&63;if((xe&240)==224?xe=(xe&15)<<12|be<<6|Le:xe=(xe&7)<<18|be<<12|Le<<6|N[U++]&63,xe<65536)ye+=String.fromCharCode(xe);else{var Qe=xe-65536;ye+=String.fromCharCode(55296|Qe>>10,56320|Qe&1023)}}return ye}function O(N,U){return N?I(L,N,U):""}function M(N,U,Z,ce){if(!(ce>0))return 0;for(var he=Z,ye=Z+ce-1,xe=0;xe<N.length;++xe){var be=N.charCodeAt(xe);if(be>=55296&&be<=57343){var Le=N.charCodeAt(++xe);be=65536+((be&1023)<<10)|Le&1023}if(be<=127){if(Z>=ye)break;U[Z++]=be}else if(be<=2047){if(Z+1>=ye)break;U[Z++]=192|be>>6,U[Z++]=128|be&63}else if(be<=65535){if(Z+2>=ye)break;U[Z++]=224|be>>12,U[Z++]=128|be>>6&63,U[Z++]=128|be&63}else{if(Z+3>=ye)break;U[Z++]=240|be>>18,U[Z++]=128|be>>12&63,U[Z++]=128|be>>6&63,U[Z++]=128|be&63}}return U[Z]=0,Z-he}function R(N,U,Z){return M(N,L,U,Z)}function A(N){for(var U=0,Z=0;Z<N.length;++Z){var ce=N.charCodeAt(Z);ce<=127?U++:ce<=2047?U+=2:ce>=55296&&ce<=57343?(U+=4,++Z):U+=3}return U}var B,k,L,F,j,J,ie,fe,ae;function de(N){B=N,o.HEAP8=k=new Int8Array(N),o.HEAP16=F=new Int16Array(N),o.HEAP32=J=new Int32Array(N),o.HEAPU8=L=new Uint8Array(N),o.HEAPU16=j=new Uint16Array(N),o.HEAPU32=ie=new Uint32Array(N),o.HEAPF32=fe=new Float32Array(N),o.HEAPF64=ae=new Float64Array(N)}o.INITIAL_MEMORY;var we,_e=[],Te=[],G=[];function P(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)q(o.preRun.shift());ct(_e)}function $(){ct(Te)}function W(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)ee(o.postRun.shift());ct(G)}function q(N){_e.unshift(N)}function Q(N){Te.unshift(N)}function ee(N){G.unshift(N)}var ge=0,De=null;function Ne(N){ge++,o.monitorRunDependencies&&o.monitorRunDependencies(ge)}function We(N){if(ge--,o.monitorRunDependencies&&o.monitorRunDependencies(ge),ge==0&&De){var U=De;De=null,U()}}function re(N){o.onAbort&&o.onAbort(N),N="Aborted("+N+")",T(N),E=!0,N+=". Build with -sASSERTIONS for more info.";var U=new WebAssembly.RuntimeError(N);throw s(U),U}var se="data:application/octet-stream;base64,";function ve(N){return N.startsWith(se)}function le(N){return N.startsWith("file://")}var pe;pe="libjpegturbowasm_decode.wasm",ve(pe)||(pe=p(pe));function $e(N){try{if(N==pe&&S)return new Uint8Array(S);if(v)return v(N);throw"both async and sync fetching of the wasm failed"}catch(U){re(U)}}function oe(){if(!S&&(u||d)){if(typeof fetch=="function"&&!le(pe))return fetch(pe,{credentials:"same-origin"}).then(function(N){if(!N.ok)throw"failed to load wasm binary file at '"+pe+"'";return N.arrayBuffer()}).catch(function(){return $e(pe)});if(w)return new Promise(function(N,U){w(pe,function(Z){N(new Uint8Array(Z))},U)})}return Promise.resolve().then(function(){return $e(pe)})}function st(){var N={a:He};function U(xe,be){var Le=xe.exports;o.asm=Le,_=o.asm.K,de(_.buffer),we=o.asm.M,Q(o.asm.L),We()}Ne();function Z(xe){U(xe.instance)}function ce(xe){return oe().then(function(be){return WebAssembly.instantiate(be,N)}).then(function(be){return be}).then(xe,function(be){T("failed to asynchronously prepare wasm: "+be),re(be)})}function he(){return!S&&typeof WebAssembly.instantiateStreaming=="function"&&!ve(pe)&&!le(pe)&&!h&&typeof fetch=="function"?fetch(pe,{credentials:"same-origin"}).then(function(xe){var be=WebAssembly.instantiateStreaming(xe,N);return be.then(Z,function(Le){return T("wasm streaming compile failed: "+Le),T("falling back to ArrayBuffer instantiation"),ce(Z)})}):ce(Z)}if(o.instantiateWasm)try{var ye=o.instantiateWasm(N,U);return ye}catch(xe){T("Module.instantiateWasm callback failed with error: "+xe),s(xe)}return he().catch(s),{}}function gt(N){this.name="ExitStatus",this.message="Program terminated with exit("+N+")",this.status=N}function ct(N){for(;N.length>0;)N.shift()(o)}function Ee(N){this.excPtr=N,this.ptr=N-24,this.set_type=function(U){ie[this.ptr+4>>2]=U},this.get_type=function(){return ie[this.ptr+4>>2]},this.set_destructor=function(U){ie[this.ptr+8>>2]=U},this.get_destructor=function(){return ie[this.ptr+8>>2]},this.set_refcount=function(U){J[this.ptr>>2]=U},this.set_caught=function(U){U=U?1:0,k[this.ptr+12>>0]=U},this.get_caught=function(){return k[this.ptr+12>>0]!=0},this.set_rethrown=function(U){U=U?1:0,k[this.ptr+13>>0]=U},this.get_rethrown=function(){return k[this.ptr+13>>0]!=0},this.init=function(U,Z){this.set_adjusted_ptr(0),this.set_type(U),this.set_destructor(Z),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var U=J[this.ptr>>2];J[this.ptr>>2]=U+1},this.release_ref=function(){var U=J[this.ptr>>2];return J[this.ptr>>2]=U-1,U===1},this.set_adjusted_ptr=function(U){ie[this.ptr+16>>2]=U},this.get_adjusted_ptr=function(){return ie[this.ptr+16>>2]},this.get_exception_ptr=function(){var U=Se(this.get_type());if(U)return ie[this.excPtr>>2];var Z=this.get_adjusted_ptr();return Z!==0?Z:this.excPtr}}function ze(N,U,Z){var ce=new Ee(N);throw ce.init(U,Z),N}var qe={};function Je(N){for(;N.length;){var U=N.pop(),Z=N.pop();Z(U)}}function lt(N){return this.fromWireType(J[N>>2])}var Pe={},Fe={},nt={},wt=48,yn=57;function bn(N){if(N===void 0)return"_unknown";N=N.replace(/[^a-zA-Z0-9_]/g,"$");var U=N.charCodeAt(0);return U>=wt&&U<=yn?"_"+N:N}function fn(N,U){return N=bn(N),new Function("body","return function "+N+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(U)}function sn(N,U){var Z=fn(U,function(ce){this.name=U,this.message=ce;var he=new Error(ce).stack;he!==void 0&&(this.stack=this.toString()+`
`+he.replace(/^Error(:[^\n]*)?\n/,""))});return Z.prototype=Object.create(N.prototype),Z.prototype.constructor=Z,Z.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},Z}var bi=void 0;function Kt(N){throw new bi(N)}function Be(N,U,Z){N.forEach(function(be){nt[be]=U});function ce(be){var Le=Z(be);Le.length!==N.length&&Kt("Mismatched type converter count");for(var Qe=0;Qe<N.length;++Qe)Xr(N[Qe],Le[Qe])}var he=new Array(U.length),ye=[],xe=0;U.forEach((be,Le)=>{Fe.hasOwnProperty(be)?he[Le]=Fe[be]:(ye.push(be),Pe.hasOwnProperty(be)||(Pe[be]=[]),Pe[be].push(()=>{he[Le]=Fe[be],++xe,xe===ye.length&&ce(he)}))}),ye.length===0&&ce(he)}function rt(N){var U=qe[N];delete qe[N];var Z=U.rawConstructor,ce=U.rawDestructor,he=U.fields,ye=he.map(xe=>xe.getterReturnType).concat(he.map(xe=>xe.setterArgumentType));Be([N],ye,xe=>{var be={};return he.forEach((Le,Qe)=>{var at=Le.fieldName,bt=xe[Qe],Ct=Le.getter,Jt=Le.getterContext,Xt=xe[Qe+he.length],Vn=Le.setter,Pr=Le.setterContext;be[at]={read:Ur=>bt.fromWireType(Ct(Jt,Ur)),write:(Ur,au)=>{var zo=[];Vn(Pr,Ur,Xt.toWireType(zo,au)),Je(zo)}}}),[{name:U.name,fromWireType:function(Le){var Qe={};for(var at in be)Qe[at]=be[at].read(Le);return ce(Le),Qe},toWireType:function(Le,Qe){for(var at in be)if(!(at in Qe))throw new TypeError('Missing field:  "'+at+'"');var bt=Z();for(at in be)be[at].write(bt,Qe[at]);return Le!==null&&Le.push(ce,bt),bt},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:ce}]})}function Ot(N,U,Z,ce,he){}function Tn(N){switch(N){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+N)}}function Di(){for(var N=new Array(256),U=0;U<256;++U)N[U]=String.fromCharCode(U);rn=N}var rn=void 0;function Nn(N){for(var U="",Z=N;L[Z];)U+=rn[L[Z++]];return U}var zi=void 0;function wn(N){throw new zi(N)}function Xr(N,U,Z={}){if(!("argPackAdvance"in U))throw new TypeError("registerType registeredInstance requires argPackAdvance");var ce=U.name;if(N||wn('type "'+ce+'" must have a positive integer typeid pointer'),Fe.hasOwnProperty(N)){if(Z.ignoreDuplicateRegistrations)return;wn("Cannot register type '"+ce+"' twice")}if(Fe[N]=U,delete nt[N],Pe.hasOwnProperty(N)){var he=Pe[N];delete Pe[N],he.forEach(ye=>ye())}}function Ii(N,U,Z,ce,he){var ye=Tn(Z);U=Nn(U),Xr(N,{name:U,fromWireType:function(xe){return!!xe},toWireType:function(xe,be){return be?ce:he},argPackAdvance:8,readValueFromPointer:function(xe){var be;if(Z===1)be=k;else if(Z===2)be=F;else if(Z===4)be=J;else throw new TypeError("Unknown boolean type size: "+U);return this.fromWireType(be[xe>>ye])},destructorFunction:null})}function Wa(N){if(!(this instanceof ro)||!(N instanceof ro))return!1;for(var U=this.$$.ptrType.registeredClass,Z=this.$$.ptr,ce=N.$$.ptrType.registeredClass,he=N.$$.ptr;U.baseClass;)Z=U.upcast(Z),U=U.baseClass;for(;ce.baseClass;)he=ce.upcast(he),ce=ce.baseClass;return U===ce&&Z===he}function Ac(N){return{count:N.count,deleteScheduled:N.deleteScheduled,preservePointerOnDelete:N.preservePointerOnDelete,ptr:N.ptr,ptrType:N.ptrType,smartPtr:N.smartPtr,smartPtrType:N.smartPtrType}}function ua(N){function U(Z){return Z.$$.ptrType.registeredClass.name}wn(U(N)+" instance already deleted")}var $a=!1;function mo(N){}function br(N){N.smartPtr?N.smartPtrType.rawDestructor(N.smartPtr):N.ptrType.registeredClass.rawDestructor(N.ptr)}function fi(N){N.count.value-=1;var U=N.count.value===0;U&&br(N)}function Cn(N,U,Z){if(U===Z)return N;if(Z.baseClass===void 0)return null;var ce=Cn(N,U,Z.baseClass);return ce===null?null:Z.downcast(ce)}var yr={};function vo(){return Object.keys(hi).length}function Uo(){var N=[];for(var U in hi)hi.hasOwnProperty(U)&&N.push(hi[U]);return N}var fa=[];function da(){for(;fa.length;){var N=fa.pop();N.$$.deleteScheduled=!1,N.delete()}}var di=void 0;function Lc(N){di=N,fa.length&&di&&di(da)}function Fl(){o.getInheritedInstanceCount=vo,o.getLiveInheritedInstances=Uo,o.flushPendingDeletes=da,o.setDelayFunction=Lc}var hi={};function Nc(N,U){for(U===void 0&&wn("ptr should not be undefined");N.baseClass;)U=N.upcast(U),N=N.baseClass;return U}function Bo(N,U){return U=Nc(N,U),hi[U]}function za(N,U){(!U.ptrType||!U.ptr)&&Kt("makeClassHandle requires ptr and ptrType");var Z=!!U.smartPtrType,ce=!!U.smartPtr;return Z!==ce&&Kt("Both smartPtrType and smartPtr must be specified"),U.count={value:1},ri(Object.create(N,{$$:{value:U}}))}function Ul(N){var U=this.getPointee(N);if(!U)return this.destructor(N),null;var Z=Bo(this.registeredClass,U);if(Z!==void 0){if(Z.$$.count.value===0)return Z.$$.ptr=U,Z.$$.smartPtr=N,Z.clone();var ce=Z.clone();return this.destructor(N),ce}function he(){return this.isSmartPointer?za(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:U,smartPtrType:this,smartPtr:N}):za(this.registeredClass.instancePrototype,{ptrType:this,ptr:N})}var ye=this.registeredClass.getActualType(U),xe=yr[ye];if(!xe)return he.call(this);var be;this.isConst?be=xe.constPointerType:be=xe.pointerType;var Le=Cn(U,this.registeredClass,be.registeredClass);return Le===null?he.call(this):this.isSmartPointer?za(be.registeredClass.instancePrototype,{ptrType:be,ptr:Le,smartPtrType:this,smartPtr:N}):za(be.registeredClass.instancePrototype,{ptrType:be,ptr:Le})}function ri(N){return typeof FinalizationRegistry>"u"?(ri=U=>U,N):($a=new FinalizationRegistry(U=>{fi(U.$$)}),ri=U=>{var Z=U.$$,ce=!!Z.smartPtr;if(ce){var he={$$:Z};$a.register(U,he,U)}return U},mo=U=>$a.unregister(U),ri(N))}function Ls(){if(this.$$.ptr||ua(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var N=ri(Object.create(Object.getPrototypeOf(this),{$$:{value:Ac(this.$$)}}));return N.$$.count.value+=1,N.$$.deleteScheduled=!1,N}function ha(){this.$$.ptr||ua(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&wn("Object already scheduled for deletion"),mo(this),fi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function gi(){return!this.$$.ptr}function Ns(){return this.$$.ptr||ua(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&wn("Object already scheduled for deletion"),fa.push(this),fa.length===1&&di&&di(da),this.$$.deleteScheduled=!0,this}function yo(){ro.prototype.isAliasOf=Wa,ro.prototype.clone=Ls,ro.prototype.delete=ha,ro.prototype.isDeleted=gi,ro.prototype.deleteLater=Ns}function ro(){}function ja(N,U,Z){if(N[U].overloadTable===void 0){var ce=N[U];N[U]=function(){return N[U].overloadTable.hasOwnProperty(arguments.length)||wn("Function '"+Z+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+N[U].overloadTable+")!"),N[U].overloadTable[arguments.length].apply(this,arguments)},N[U].overloadTable=[],N[U].overloadTable[ce.argCount]=ce}}function qr(N,U,Z){o.hasOwnProperty(N)?(wn("Cannot register public name '"+N+"' twice"),ja(o,N,N),o.hasOwnProperty(Z)&&wn("Cannot register multiple overloads of a function with the same number of arguments ("+Z+")!"),o[N].overloadTable[Z]=U):o[N]=U}function Bl(N,U,Z,ce,he,ye,xe,be){this.name=N,this.constructor=U,this.instancePrototype=Z,this.rawDestructor=ce,this.baseClass=he,this.getActualType=ye,this.upcast=xe,this.downcast=be,this.pureVirtualFunctions=[]}function io(N,U,Z){for(;U!==Z;)U.upcast||wn("Expected null or instance of "+Z.name+", got an instance of "+U.name),N=U.upcast(N),U=U.baseClass;return N}function Vc(N,U){if(U===null)return this.isReference&&wn("null is not a valid "+this.name),0;U.$$||wn('Cannot pass "'+Wo(U)+'" as a '+this.name),U.$$.ptr||wn("Cannot pass deleted object as a pointer of type "+this.name);var Z=U.$$.ptrType.registeredClass,ce=io(U.$$.ptr,Z,this.registeredClass);return ce}function Vs(N,U){var Z;if(U===null)return this.isReference&&wn("null is not a valid "+this.name),this.isSmartPointer?(Z=this.rawConstructor(),N!==null&&N.push(this.rawDestructor,Z),Z):0;U.$$||wn('Cannot pass "'+Wo(U)+'" as a '+this.name),U.$$.ptr||wn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&U.$$.ptrType.isConst&&wn("Cannot convert argument of type "+(U.$$.smartPtrType?U.$$.smartPtrType.name:U.$$.ptrType.name)+" to parameter type "+this.name);var ce=U.$$.ptrType.registeredClass;if(Z=io(U.$$.ptr,ce,this.registeredClass),this.isSmartPointer)switch(U.$$.smartPtr===void 0&&wn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:U.$$.smartPtrType===this?Z=U.$$.smartPtr:wn("Cannot convert argument of type "+(U.$$.smartPtrType?U.$$.smartPtrType.name:U.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:Z=U.$$.smartPtr;break;case 2:if(U.$$.smartPtrType===this)Z=U.$$.smartPtr;else{var he=U.clone();Z=this.rawShare(Z,Hi.toHandle(function(){he.delete()})),N!==null&&N.push(this.rawDestructor,Z)}break;default:wn("Unsupporting sharing policy")}return Z}function Gl(N,U){if(U===null)return this.isReference&&wn("null is not a valid "+this.name),0;U.$$||wn('Cannot pass "'+Wo(U)+'" as a '+this.name),U.$$.ptr||wn("Cannot pass deleted object as a pointer of type "+this.name),U.$$.ptrType.isConst&&wn("Cannot convert argument of type "+U.$$.ptrType.name+" to parameter type "+this.name);var Z=U.$$.ptrType.registeredClass,ce=io(U.$$.ptr,Z,this.registeredClass);return ce}function kc(N){return this.rawGetPointee&&(N=this.rawGetPointee(N)),N}function Mi(N){this.rawDestructor&&this.rawDestructor(N)}function Oi(N){N!==null&&N.delete()}function Fc(){kr.prototype.getPointee=kc,kr.prototype.destructor=Mi,kr.prototype.argPackAdvance=8,kr.prototype.readValueFromPointer=lt,kr.prototype.deleteObject=Oi,kr.prototype.fromWireType=Ul}function kr(N,U,Z,ce,he,ye,xe,be,Le,Qe,at){this.name=N,this.registeredClass=U,this.isReference=Z,this.isConst=ce,this.isSmartPointer=he,this.pointeeType=ye,this.sharingPolicy=xe,this.rawGetPointee=be,this.rawConstructor=Le,this.rawShare=Qe,this.rawDestructor=at,!he&&U.baseClass===void 0?ce?(this.toWireType=Vc,this.destructorFunction=null):(this.toWireType=Gl,this.destructorFunction=null):this.toWireType=Vs}function Uc(N,U,Z){o.hasOwnProperty(N)||Kt("Replacing nonexistant public symbol"),o[N].overloadTable!==void 0&&Z!==void 0||(o[N]=U,o[N].argCount=Z)}function ks(N,U,Z){var ce=o["dynCall_"+N];return Z&&Z.length?ce.apply(null,[U].concat(Z)):ce.call(null,U)}var Ha=[];function ur(N){var U=Ha[N];return U||(N>=Ha.length&&(Ha.length=N+1),Ha[N]=U=we.get(N)),U}function ji(N,U,Z){if(N.includes("j"))return ks(N,U,Z);var ce=ur(U).apply(null,Z);return ce}function Ka(N,U){var Z=[];return function(){return Z.length=0,Object.assign(Z,arguments),ji(N,U,Z)}}function Yr(N,U){N=Nn(N);function Z(){return N.includes("j")?Ka(N,U):ur(U)}var ce=Z();return typeof ce!="function"&&wn("unknown function pointer with signature "+N+": "+U),ce}var Bc=void 0;function ii(N){var U=It(N),Z=Nn(U);return dt(U),Z}function pi(N,U){var Z=[],ce={};function he(ye){if(!ce[ye]&&!Fe[ye]){if(nt[ye]){nt[ye].forEach(he);return}Z.push(ye),ce[ye]=!0}}throw U.forEach(he),new Bc(N+": "+Z.map(ii).join([", "]))}function Xa(N,U,Z,ce,he,ye,xe,be,Le,Qe,at,bt,Ct){at=Nn(at),ye=Yr(he,ye),be&&(be=Yr(xe,be)),Qe&&(Qe=Yr(Le,Qe)),Ct=Yr(bt,Ct);var Jt=bn(at);qr(Jt,function(){pi("Cannot construct "+at+" due to unbound types",[ce])}),Be([N,U,Z],ce?[ce]:[],function(Xt){Xt=Xt[0];var Vn,Pr;ce?(Vn=Xt.registeredClass,Pr=Vn.instancePrototype):Pr=ro.prototype;var Ur=fn(Jt,function(){if(Object.getPrototypeOf(this)!==au)throw new zi("Use 'new' to construct "+at);if(zo.constructor_body===void 0)throw new zi(at+" has no accessible constructor");var fT=zo.constructor_body[arguments.length];if(fT===void 0)throw new zi("Tried to invoke ctor of "+at+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(zo.constructor_body).toString()+") parameters instead!");return fT.apply(this,arguments)}),au=Object.create(Pr,{constructor:{value:Ur}});Ur.prototype=au;var zo=new Bl(at,Ur,au,Ct,Vn,ye,be,Qe),Fg=new kr(at,zo,!0,!1,!1),nd=new kr(at+"*",zo,!1,!1,!1),uT=new kr(at+" const*",zo,!1,!0,!1);return yr[N]={pointerType:nd,constPointerType:uT},Uc(Jt,Ur),[Fg,nd,uT]})}function qa(N,U){for(var Z=[],ce=0;ce<N;ce++)Z.push(ie[U+ce*4>>2]);return Z}function Wl(N,U){if(!(N instanceof Function))throw new TypeError("new_ called with constructor type "+typeof N+" which is not a function");var Z=fn(N.name||"unknownFunctionName",function(){});Z.prototype=N.prototype;var ce=new Z,he=N.apply(ce,U);return he instanceof Object?he:ce}function Ya(N,U,Z,ce,he){var ye=U.length;ye<2&&wn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var xe=U[1]!==null&&Z!==null,be=!1,Le=1;Le<U.length;++Le)if(U[Le]!==null&&U[Le].destructorFunction===void 0){be=!0;break}for(var Qe=U[0].name!=="void",at="",bt="",Le=0;Le<ye-2;++Le)at+=(Le!==0?", ":"")+"arg"+Le,bt+=(Le!==0?", ":"")+"arg"+Le+"Wired";var Ct="return function "+bn(N)+"("+at+`) {
if (arguments.length !== `+(ye-2)+`) {
throwBindingError('function `+N+" called with ' + arguments.length + ' arguments, expected "+(ye-2)+` args!');
}
`;be&&(Ct+=`var destructors = [];
`);var Jt=be?"destructors":"null",Xt=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Vn=[wn,ce,he,Je,U[0],U[1]];xe&&(Ct+="var thisWired = classParam.toWireType("+Jt+`, this);
`);for(var Le=0;Le<ye-2;++Le)Ct+="var arg"+Le+"Wired = argType"+Le+".toWireType("+Jt+", arg"+Le+"); // "+U[Le+2].name+`
`,Xt.push("argType"+Le),Vn.push(U[Le+2]);if(xe&&(bt="thisWired"+(bt.length>0?", ":"")+bt),Ct+=(Qe?"var rv = ":"")+"invoker(fn"+(bt.length>0?", ":"")+bt+`);
`,be)Ct+=`runDestructors(destructors);
`;else for(var Le=xe?1:2;Le<U.length;++Le){var Pr=Le===1?"thisWired":"arg"+(Le-2)+"Wired";U[Le].destructorFunction!==null&&(Ct+=Pr+"_dtor("+Pr+"); // "+U[Le].name+`
`,Xt.push(Pr+"_dtor"),Vn.push(U[Le].destructorFunction))}Qe&&(Ct+=`var ret = retType.fromWireType(rv);
return ret;
`),Ct+=`}
`,Xt.push(Ct);var Ur=Wl(Function,Xt).apply(null,Vn);return Ur}function Qn(N,U,Z,ce,he,ye){D(U>0);var xe=qa(U,Z);he=Yr(ce,he),Be([],[N],function(be){be=be[0];var Le="constructor "+be.name;if(be.registeredClass.constructor_body===void 0&&(be.registeredClass.constructor_body=[]),be.registeredClass.constructor_body[U-1]!==void 0)throw new zi("Cannot register multiple constructors with identical number of parameters ("+(U-1)+") for class '"+be.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return be.registeredClass.constructor_body[U-1]=()=>{pi("Cannot construct "+be.name+" due to unbound types",xe)},Be([],xe,function(Qe){return Qe.splice(1,0,null),be.registeredClass.constructor_body[U-1]=Ya(Le,Qe,null,he,ye),[]}),[]})}function Fs(N,U,Z,ce,he,ye,xe,be){var Le=qa(Z,ce);U=Nn(U),ye=Yr(he,ye),Be([],[N],function(Qe){Qe=Qe[0];var at=Qe.name+"."+U;U.startsWith("@@")&&(U=Symbol[U.substring(2)]),be&&Qe.registeredClass.pureVirtualFunctions.push(U);function bt(){pi("Cannot call "+at+" due to unbound types",Le)}var Ct=Qe.registeredClass.instancePrototype,Jt=Ct[U];return Jt===void 0||Jt.overloadTable===void 0&&Jt.className!==Qe.name&&Jt.argCount===Z-2?(bt.argCount=Z-2,bt.className=Qe.name,Ct[U]=bt):(ja(Ct,U,at),Ct[U].overloadTable[Z-2]=bt),Be([],Le,function(Xt){var Vn=Ya(at,Xt,Qe,ye,xe);return Ct[U].overloadTable===void 0?(Vn.argCount=Z-2,Ct[U]=Vn):Ct[U].overloadTable[Z-2]=Vn,[]}),[]})}var Ja=[],Fr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Us(N){N>4&&--Fr[N].refcount===0&&(Fr[N]=void 0,Ja.push(N))}function mi(){for(var N=0,U=5;U<Fr.length;++U)Fr[U]!==void 0&&++N;return N}function Gc(){for(var N=5;N<Fr.length;++N)if(Fr[N]!==void 0)return Fr[N];return null}function Go(){o.count_emval_handles=mi,o.get_first_emval=Gc}var Hi={toValue:N=>(N||wn("Cannot use deleted val. handle = "+N),Fr[N].value),toHandle:N=>{switch(N){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var U=Ja.length?Ja.pop():Fr.length;return Fr[U]={refcount:1,value:N},U}}}};function $l(N,U){U=Nn(U),Xr(N,{name:U,fromWireType:function(Z){var ce=Hi.toValue(Z);return Us(Z),ce},toWireType:function(Z,ce){return Hi.toHandle(ce)},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:null})}function Wo(N){if(N===null)return"null";var U=typeof N;return U==="object"||U==="array"||U==="function"?N.toString():""+N}function vi(N,U){switch(U){case 2:return function(Z){return this.fromWireType(fe[Z>>2])};case 3:return function(Z){return this.fromWireType(ae[Z>>3])};default:throw new TypeError("Unknown float type: "+N)}}function Wc(N,U,Z){var ce=Tn(Z);U=Nn(U),Xr(N,{name:U,fromWireType:function(he){return he},toWireType:function(he,ye){return ye},argPackAdvance:8,readValueFromPointer:vi(U,ce),destructorFunction:null})}function zl(N,U,Z){switch(U){case 0:return Z?function(he){return k[he]}:function(he){return L[he]};case 1:return Z?function(he){return F[he>>1]}:function(he){return j[he>>1]};case 2:return Z?function(he){return J[he>>2]}:function(he){return ie[he>>2]};default:throw new TypeError("Unknown integer type: "+N)}}function jl(N,U,Z,ce,he){U=Nn(U);var ye=Tn(Z),xe=bt=>bt;if(ce===0){var be=32-8*Z;xe=bt=>bt<<be>>>be}var Le=U.includes("unsigned"),Qe=(bt,Ct)=>{},at;Le?at=function(bt,Ct){return Qe(Ct,this.name),Ct>>>0}:at=function(bt,Ct){return Qe(Ct,this.name),Ct},Xr(N,{name:U,fromWireType:xe,toWireType:at,argPackAdvance:8,readValueFromPointer:zl(U,ye,ce!==0),destructorFunction:null})}function $c(N,U,Z){var ce=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],he=ce[U];function ye(xe){xe=xe>>2;var be=ie,Le=be[xe],Qe=be[xe+1];return new he(B,Qe,Le)}Z=Nn(Z),Xr(N,{name:Z,fromWireType:ye,argPackAdvance:8,readValueFromPointer:ye},{ignoreDuplicateRegistrations:!0})}function Za(N,U){U=Nn(U);var Z=U==="std::string";Xr(N,{name:U,fromWireType:function(ce){var he=ie[ce>>2],ye=ce+4,xe;if(Z)for(var be=ye,Le=0;Le<=he;++Le){var Qe=ye+Le;if(Le==he||L[Qe]==0){var at=Qe-be,bt=O(be,at);xe===void 0?xe=bt:(xe+="\0",xe+=bt),be=Qe+1}}else{for(var Ct=new Array(he),Le=0;Le<he;++Le)Ct[Le]=String.fromCharCode(L[ye+Le]);xe=Ct.join("")}return dt(ce),xe},toWireType:function(ce,he){he instanceof ArrayBuffer&&(he=new Uint8Array(he));var ye,xe=typeof he=="string";xe||he instanceof Uint8Array||he instanceof Uint8ClampedArray||he instanceof Int8Array||wn("Cannot pass non-string to std::string"),Z&&xe?ye=A(he):ye=he.length;var be=et(4+ye+1),Le=be+4;if(ie[be>>2]=ye,Z&&xe)R(he,Le,ye+1);else if(xe)for(var Qe=0;Qe<ye;++Qe){var at=he.charCodeAt(Qe);at>255&&(dt(Le),wn("String has UTF-16 code units that do not fit in 8 bits")),L[Le+Qe]=at}else for(var Qe=0;Qe<ye;++Qe)L[Le+Qe]=he[Qe];return ce!==null&&ce.push(dt,be),be},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:function(ce){dt(ce)}})}var zc=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Bs(N,U){for(var Z=N,ce=Z>>1,he=ce+U/2;!(ce>=he)&&j[ce];)++ce;if(Z=ce<<1,Z-N>32&&zc)return zc.decode(L.subarray(N,Z));for(var ye="",xe=0;!(xe>=U/2);++xe){var be=F[N+xe*2>>1];if(be==0)break;ye+=String.fromCharCode(be)}return ye}function Hl(N,U,Z){if(Z===void 0&&(Z=2147483647),Z<2)return 0;Z-=2;for(var ce=U,he=Z<N.length*2?Z/2:N.length,ye=0;ye<he;++ye){var xe=N.charCodeAt(ye);F[U>>1]=xe,U+=2}return F[U>>1]=0,U-ce}function Kl(N){return N.length*2}function Xl(N,U){for(var Z=0,ce="";!(Z>=U/4);){var he=J[N+Z*4>>2];if(he==0)break;if(++Z,he>=65536){var ye=he-65536;ce+=String.fromCharCode(55296|ye>>10,56320|ye&1023)}else ce+=String.fromCharCode(he)}return ce}function Gs(N,U,Z){if(Z===void 0&&(Z=2147483647),Z<4)return 0;for(var ce=U,he=ce+Z-4,ye=0;ye<N.length;++ye){var xe=N.charCodeAt(ye);if(xe>=55296&&xe<=57343){var be=N.charCodeAt(++ye);xe=65536+((xe&1023)<<10)|be&1023}if(J[U>>2]=xe,U+=4,U+4>he)break}return J[U>>2]=0,U-ce}function ql(N){for(var U=0,Z=0;Z<N.length;++Z){var ce=N.charCodeAt(Z);ce>=55296&&ce<=57343&&++Z,U+=4}return U}function Yl(N,U,Z){Z=Nn(Z);var ce,he,ye,xe,be;U===2?(ce=Bs,he=Hl,xe=Kl,ye=()=>j,be=1):U===4&&(ce=Xl,he=Gs,xe=ql,ye=()=>ie,be=2),Xr(N,{name:Z,fromWireType:function(Le){for(var Qe=ie[Le>>2],at=ye(),bt,Ct=Le+4,Jt=0;Jt<=Qe;++Jt){var Xt=Le+4+Jt*U;if(Jt==Qe||at[Xt>>be]==0){var Vn=Xt-Ct,Pr=ce(Ct,Vn);bt===void 0?bt=Pr:(bt+="\0",bt+=Pr),Ct=Xt+U}}return dt(Le),bt},toWireType:function(Le,Qe){typeof Qe!="string"&&wn("Cannot pass non-string to C++ string type "+Z);var at=xe(Qe),bt=et(4+at+U);return ie[bt>>2]=at>>be,he(Qe,bt+4,at+U),Le!==null&&Le.push(dt,bt),bt},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:function(Le){dt(Le)}})}function Jl(N,U,Z,ce,he,ye){qe[N]={name:Nn(U),rawConstructor:Yr(Z,ce),rawDestructor:Yr(he,ye),fields:[]}}function Ws(N,U,Z,ce,he,ye,xe,be,Le,Qe){qe[N].fields.push({fieldName:Nn(U),getterReturnType:Z,getter:Yr(ce,he),getterContext:ye,setterArgumentType:xe,setter:Yr(be,Le),setterContext:Qe})}function Zl(N,U){U=Nn(U),Xr(N,{isVoid:!0,name:U,argPackAdvance:0,fromWireType:function(){},toWireType:function(Z,ce){}})}function jc(){throw 1/0}var Hc={};function Ql(N){var U=Hc[N];return U===void 0?Nn(N):U}function $s(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function eu(N){return N===0?Hi.toHandle($s()):(N=Ql(N),Hi.toHandle($s()[N]))}function Kc(N){N>4&&(Fr[N].refcount+=1)}function Xc(N,U){var Z=Fe[N];return Z===void 0&&wn(U+" has unknown type "+ii(N)),Z}function qc(N){for(var U="",Z=0;Z<N;++Z)U+=(Z!==0?", ":"")+"arg"+Z;for(var ce=()=>ie,he="return function emval_allocator_"+N+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,Z=0;Z<N;++Z)he+="var argType"+Z+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+Z+`');
var arg`+Z+" = argType"+Z+`.readValueFromPointer(args);
args += argType`+Z+`['argPackAdvance'];
argTypes += 4;
`;return he+="var obj = new constructor("+U+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",he)(Xc,o,Hi.toHandle,ce)}var Yc={};function tu(N,U,Z,ce){N=Hi.toValue(N);var he=Yc[U];return he||(he=qc(U),Yc[U]=he),he(N,Z,ce)}function nu(N,U){N=Xc(N,"_emval_take_value");var Z=N.readValueFromPointer(U);return Hi.toHandle(Z)}function ru(){re("")}function zs(N,U,Z){L.copyWithin(N,U,U+Z)}function iu(){return 2147483648}function ga(N){try{return _.grow(N-B.byteLength+65535>>>16),de(_.buffer),1}catch{}}function ou(N){var U=L.length;N=N>>>0;var Z=iu();if(N>Z)return!1;let ce=(Le,Qe)=>Le+(Qe-Le%Qe)%Qe;for(var he=1;he<=4;he*=2){var ye=U*(1+.2/he);ye=Math.min(ye,N+100663296);var xe=Math.min(Z,ce(Math.max(N,ye),65536)),be=ga(xe);if(be)return!0}return!1}var js={};function Hs(){return l||"./this.program"}function $o(){if(!$o.strings){var N=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",U={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:N,_:Hs()};for(var Z in js)js[Z]===void 0?delete U[Z]:U[Z]=js[Z];var ce=[];for(var Z in U)ce.push(Z+"="+U[Z]);$o.strings=ce}return $o.strings}function Ki(N,U,Z){for(var ce=0;ce<N.length;++ce)k[U++>>0]=N.charCodeAt(ce);k[U>>0]=0}function Jc(N,U){var Z=0;return $o().forEach(function(ce,he){var ye=U+Z;ie[N+he*4>>2]=ye,Ki(ce,ye),Z+=ce.length+1}),0}function Zc(N,U){var Z=$o();ie[N>>2]=Z.length;var ce=0;return Z.forEach(function(he){ce+=he.length+1}),ie[U>>2]=ce,0}function Ks(N){f(N,new gt(N))}function Qc(N,U){Ks(N)}var Qa=Qc;function Xs(N){return 52}function te(N,U,Z,ce,he){return 70}var ne=[null,[],[]];function me(N,U){var Z=ne[N];U===0||U===10?((N===1?x:T)(I(Z,0)),Z.length=0):Z.push(U)}function Re(N,U,Z,ce){for(var he=0,ye=0;ye<Z;ye++){var xe=ie[U>>2],be=ie[U+4>>2];U+=8;for(var Le=0;Le<be;Le++)me(N,L[xe+Le]);he+=be}return ie[ce>>2]=he,0}function je(N){var U=o["_"+N];return U}function tt(N,U){k.set(N,U)}function Ye(N,U,Z,ce,he){var ye={string:Xt=>{var Vn=0;if(Xt!=null&&Xt!==0){var Pr=(Xt.length<<2)+1;Vn=ue(Pr),R(Xt,Vn,Pr)}return Vn},array:Xt=>{var Vn=ue(Xt.length);return tt(Xt,Vn),Vn}};function xe(Xt){return U==="string"?O(Xt):U==="boolean"?!!Xt:Xt}var be=je(N),Le=[],Qe=0;if(ce)for(var at=0;at<ce.length;at++){var bt=ye[Z[at]];bt?(Qe===0&&(Qe=X()),Le[at]=bt(ce[at])):Le[at]=ce[at]}var Ct=be.apply(null,Le);function Jt(Xt){return Qe!==0&&Y(Qe),xe(Xt)}return Ct=Jt(Ct),Ct}bi=o.InternalError=sn(Error,"InternalError"),Di(),zi=o.BindingError=sn(Error,"BindingError"),yo(),Fl(),Fc(),Bc=o.UnboundTypeError=sn(Error,"UnboundTypeError"),Go();var He={g:ze,A:rt,w:Ot,F:Ii,u:Xa,t:Qn,c:Fs,E:$l,m:Wc,b:jl,a:$c,l:Za,h:Yl,J:Jl,d:Ws,G:Zl,x:jc,i:Us,r:eu,p:Kc,q:tu,s:nu,j:ru,D:zs,y:ou,z:Jc,B:Zc,I:Qa,C:Xs,v:te,k:Re,o:Ze,n:ot,H:Ke,f:Ve,e:it};st(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.L).apply(null,arguments)};var et=o._malloc=function(){return(et=o._malloc=o.asm.N).apply(null,arguments)},dt=o._free=function(){return(dt=o._free=o.asm.O).apply(null,arguments)},It=o.___getTypeName=function(){return(It=o.___getTypeName=o.asm.P).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.Q).apply(null,arguments)};var Lt=o._setThrew=function(){return(Lt=o._setThrew=o.asm.R).apply(null,arguments)},X=o.stackSave=function(){return(X=o.stackSave=o.asm.S).apply(null,arguments)},Y=o.stackRestore=function(){return(Y=o.stackRestore=o.asm.T).apply(null,arguments)},ue=o.stackAlloc=function(){return(ue=o.stackAlloc=o.asm.U).apply(null,arguments)},Se=o.___cxa_is_pointer_type=function(){return(Se=o.___cxa_is_pointer_type=o.asm.V).apply(null,arguments)};o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.W).apply(null,arguments)};function Ve(N,U){var Z=X();try{ur(N)(U)}catch(ce){if(Y(Z),ce!==ce+0)throw ce;Lt(1,0)}}function Ze(N,U){var Z=X();try{return ur(N)(U)}catch(ce){if(Y(Z),ce!==ce+0)throw ce;Lt(1,0)}}function it(N,U,Z,ce){var he=X();try{ur(N)(U,Z,ce)}catch(ye){if(Y(he),ye!==ye+0)throw ye;Lt(1,0)}}function Ke(N,U,Z,ce){var he=X();try{return ur(N)(U,Z,ce)}catch(ye){if(Y(he),ye!==ye+0)throw ye;Lt(1,0)}}function ot(N,U,Z){var ce=X();try{return ur(N)(U,Z)}catch(he){if(Y(ce),he!==he+0)throw he;Lt(1,0)}}o.ccall=Ye;var z;De=function N(){z||H(),z||(De=N)};function H(N){if(ge>0||(P(),ge>0))return;function U(){z||(z=!0,o.calledRun=!0,!E&&($(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),W()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),U()},1)):U()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return H(),i.ready})})();t.exports=r})(ky)),ky.exports}var gve=hve();const pve=ka(gve),mve=new URL(""+new URL("libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url).href,import.meta.url),hm={codec:void 0,decoder:void 0};function vve(){if(hm.codec)return Promise.resolve();const t=pve({locateFile:e=>e.endsWith(".wasm")?mve.toString():e});return new Promise((e,r)=>{t.then(n=>{hm.codec=n,hm.decoder=new n.JPEGDecoder,e()},r)})}async function yve(t,e){await vve();const r=hm.decoder;r.getEncodedBuffer(t.length).set(t),r.decode();const i=r.getFrameInfo(),o=r.getDecodedBuffer(),a={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},s=wve(i,o),c={frameInfo:i};return{...e,pixelData:s,imageInfo:a,encodeOptions:c,...c,...a}}function wve(t,e){return t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const Cve="modulepreload",xve=function(t,e){return new URL(t,e).href},tb={},iN=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){let l=function(f){return Promise.all(f.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const a=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");i=l(r.map(f=>{if(f=xve(f,n),f in tb)return;tb[f]=!0;const u=f.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(n)for(let g=a.length-1;g>=0;g--){const p=a[g];if(p.href===f&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Cve,u||(h.as="script"),h.crossOrigin="",h.href=f,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((g,p)=>{h.addEventListener("load",g),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})},eh={JpegImage:void 0,decodeConfig:{}};function Tve(t){return eh.decodeConfig=t,eh.JpegImage?Promise.resolve():new Promise((e,r)=>{iN(()=>import("./jpeg-B-x1txLf.js"),[],import.meta.url).then(n=>{eh.JpegImage=n.default,e()}).catch(r)})}async function Sve(t,e){if(await Tve(),typeof eh.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const r=new eh.JpegImage;if(r.parse(e),r.colorTransform=!1,t.bitsAllocated===8)return t.pixelData=r.getData(t.columns,t.rows),t;if(t.bitsAllocated===16)return t.pixelData=r.getData16(t.columns,t.rows),t}const th={DecoderClass:void 0,decodeConfig:{}};function _ve(t){return th.decodeConfig=t,th.DecoderClass?Promise.resolve():new Promise((e,r)=>{iN(async()=>{const{Decoder:n}=await import("./lossless-CyYqoyFe.js");return{Decoder:n}},[],import.meta.url).then(({Decoder:n})=>{th.DecoderClass=n,e()},r)})}async function nb(t,e){if(await _ve(),typeof th.DecoderClass>"u")throw new Error("No JPEG Lossless decoder loaded");const r=new th.DecoderClass,n=t.bitsAllocated<=8?1:2,i=e.buffer,o=r.decode(i,e.byteOffset,e.length,n);return t.pixelRepresentation===0?t.bitsAllocated===16?(t.pixelData=new Uint16Array(o.buffer),t):(t.pixelData=new Uint8Array(o.buffer),t):(t.pixelData=new Int16Array(o.buffer),t)}var Fy={exports:{}},rb;function Eve(){return rb||(rb=1,(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(te,ne){a=te,s=ne});var c=Object.assign({},o),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",d="";function h(te){return o.locateFile?o.locateFile(te,d):d+te}var g,p,m;if(u){var w=wc,v=wc;f?d=v.dirname(d)+"/":d=__dirname+"/",g=(te,ne)=>(te=re(te)?new URL(te):v.normalize(te),w.readFileSync(te,ne?void 0:"utf8")),m=te=>{var ne=g(te,!0);return ne.buffer||(ne=new Uint8Array(ne)),ne},p=(te,ne,me)=>{te=re(te)?new URL(te):v.normalize(te),w.readFile(te,function(Re,je){Re?me(Re):ne(je.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(te){if(!(te instanceof $e))throw te}),process.on("unhandledRejection",function(te){throw te}),o.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),n&&(d=n),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",g=te=>{var ne=new XMLHttpRequest;return ne.open("GET",te,!1),ne.send(null),ne.responseText},f&&(m=te=>{var ne=new XMLHttpRequest;return ne.open("GET",te,!1),ne.responseType="arraybuffer",ne.send(null),new Uint8Array(ne.response)}),p=(te,ne,me)=>{var Re=new XMLHttpRequest;Re.open("GET",te,!0),Re.responseType="arraybuffer",Re.onload=()=>{if(Re.status==200||Re.status==0&&Re.response){ne(Re.response);return}me()},Re.onerror=me,Re.send(null)});o.print||console.log.bind(console);var y=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit;var C;o.wasmBinary&&(C=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&De("no native wasm support detected");var x,T=!1;function S(te,ne){te||De(ne)}var _=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function E(te,ne,me){for(var Re=ne+me,je=ne;te[je]&&!(je>=Re);)++je;if(je-ne>16&&te.buffer&&_)return _.decode(te.subarray(ne,je));for(var tt="";ne<je;){var Ye=te[ne++];if(!(Ye&128)){tt+=String.fromCharCode(Ye);continue}var He=te[ne++]&63;if((Ye&224)==192){tt+=String.fromCharCode((Ye&31)<<6|He);continue}var et=te[ne++]&63;if((Ye&240)==224?Ye=(Ye&15)<<12|He<<6|et:Ye=(Ye&7)<<18|He<<12|et<<6|te[ne++]&63,Ye<65536)tt+=String.fromCharCode(Ye);else{var dt=Ye-65536;tt+=String.fromCharCode(55296|dt>>10,56320|dt&1023)}}return tt}function D(te,ne){return te?E(A,te,ne):""}function b(te,ne,me,Re){if(!(Re>0))return 0;for(var je=me,tt=me+Re-1,Ye=0;Ye<te.length;++Ye){var He=te.charCodeAt(Ye);if(He>=55296&&He<=57343){var et=te.charCodeAt(++Ye);He=65536+((He&1023)<<10)|et&1023}if(He<=127){if(me>=tt)break;ne[me++]=He}else if(He<=2047){if(me+1>=tt)break;ne[me++]=192|He>>6,ne[me++]=128|He&63}else if(He<=65535){if(me+2>=tt)break;ne[me++]=224|He>>12,ne[me++]=128|He>>6&63,ne[me++]=128|He&63}else{if(me+3>=tt)break;ne[me++]=240|He>>18,ne[me++]=128|He>>12&63,ne[me++]=128|He>>6&63,ne[me++]=128|He&63}}return ne[me]=0,me-je}function I(te,ne,me){return b(te,A,ne,me)}function O(te){for(var ne=0,me=0;me<te.length;++me){var Re=te.charCodeAt(me);Re<=127?ne++:Re<=2047?ne+=2:Re>=55296&&Re<=57343?(ne+=4,++me):ne+=3}return ne}var M,R,A,B,k,L,F,j,J;function ie(te){M=te,o.HEAP8=R=new Int8Array(te),o.HEAP16=B=new Int16Array(te),o.HEAP32=L=new Int32Array(te),o.HEAPU8=A=new Uint8Array(te),o.HEAPU16=k=new Uint16Array(te),o.HEAPU32=F=new Uint32Array(te),o.HEAPF32=j=new Float32Array(te),o.HEAPF64=J=new Float64Array(te)}o.INITIAL_MEMORY;var fe,ae=[],de=[],we=[];function _e(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)P(o.preRun.shift());oe(ae)}function Te(){oe(de)}function G(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)W(o.postRun.shift());oe(we)}function P(te){ae.unshift(te)}function $(te){de.unshift(te)}function W(te){we.unshift(te)}var q=0,Q=null;function ee(te){q++,o.monitorRunDependencies&&o.monitorRunDependencies(q)}function ge(te){if(q--,o.monitorRunDependencies&&o.monitorRunDependencies(q),q==0&&Q){var ne=Q;Q=null,ne()}}function De(te){o.onAbort&&o.onAbort(te),te="Aborted("+te+")",y(te),T=!0,te+=". Build with -sASSERTIONS for more info.";var ne=new WebAssembly.RuntimeError(te);throw s(ne),ne}var Ne="data:application/octet-stream;base64,";function We(te){return te.startsWith(Ne)}function re(te){return te.startsWith("file://")}var se;se="charlswasm_decode.wasm",We(se)||(se=h(se));function ve(te){try{if(te==se&&C)return new Uint8Array(C);if(m)return m(te);throw"both async and sync fetching of the wasm failed"}catch(ne){De(ne)}}function le(){if(!C&&(l||f)){if(typeof fetch=="function"&&!re(se))return fetch(se,{credentials:"same-origin"}).then(function(te){if(!te.ok)throw"failed to load wasm binary file at '"+se+"'";return te.arrayBuffer()}).catch(function(){return ve(se)});if(p)return new Promise(function(te,ne){p(se,function(me){te(new Uint8Array(me))},ne)})}return Promise.resolve().then(function(){return ve(se)})}function pe(){var te={a:js};function ne(Ye,He){var et=Ye.exports;o.asm=et,x=o.asm.z,ie(x.buffer),fe=o.asm.C,$(o.asm.A),ge()}ee();function me(Ye){ne(Ye.instance)}function Re(Ye){return le().then(function(He){return WebAssembly.instantiate(He,te)}).then(function(He){return He}).then(Ye,function(He){y("failed to asynchronously prepare wasm: "+He),De(He)})}function je(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!We(se)&&!re(se)&&!u&&typeof fetch=="function"?fetch(se,{credentials:"same-origin"}).then(function(Ye){var He=WebAssembly.instantiateStreaming(Ye,te);return He.then(me,function(et){return y("wasm streaming compile failed: "+et),y("falling back to ArrayBuffer instantiation"),Re(me)})}):Re(me)}if(o.instantiateWasm)try{var tt=o.instantiateWasm(te,ne);return tt}catch(Ye){y("Module.instantiateWasm callback failed with error: "+Ye),s(Ye)}return je().catch(s),{}}function $e(te){this.name="ExitStatus",this.message="Program terminated with exit("+te+")",this.status=te}function oe(te){for(;te.length>0;)te.shift()(o)}function st(te){this.excPtr=te,this.ptr=te-24,this.set_type=function(ne){F[this.ptr+4>>2]=ne},this.get_type=function(){return F[this.ptr+4>>2]},this.set_destructor=function(ne){F[this.ptr+8>>2]=ne},this.get_destructor=function(){return F[this.ptr+8>>2]},this.set_refcount=function(ne){L[this.ptr>>2]=ne},this.set_caught=function(ne){ne=ne?1:0,R[this.ptr+12>>0]=ne},this.get_caught=function(){return R[this.ptr+12>>0]!=0},this.set_rethrown=function(ne){ne=ne?1:0,R[this.ptr+13>>0]=ne},this.get_rethrown=function(){return R[this.ptr+13>>0]!=0},this.init=function(ne,me){this.set_adjusted_ptr(0),this.set_type(ne),this.set_destructor(me),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var ne=L[this.ptr>>2];L[this.ptr>>2]=ne+1},this.release_ref=function(){var ne=L[this.ptr>>2];return L[this.ptr>>2]=ne-1,ne===1},this.set_adjusted_ptr=function(ne){F[this.ptr+16>>2]=ne},this.get_adjusted_ptr=function(){return F[this.ptr+16>>2]},this.get_exception_ptr=function(){var ne=Qc(this.get_type());if(ne)return F[this.excPtr>>2];var me=this.get_adjusted_ptr();return me!==0?me:this.excPtr}}function gt(te,ne,me){var Re=new st(te);throw Re.init(ne,me),te}var ct={};function Ee(te){for(;te.length;){var ne=te.pop(),me=te.pop();me(ne)}}function ze(te){return this.fromWireType(L[te>>2])}var qe={},Je={},lt={},Pe=48,Fe=57;function nt(te){if(te===void 0)return"_unknown";te=te.replace(/[^a-zA-Z0-9_]/g,"$");var ne=te.charCodeAt(0);return ne>=Pe&&ne<=Fe?"_"+te:te}function wt(te,ne){return te=nt(te),new Function("body","return function "+te+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(ne)}function yn(te,ne){var me=wt(ne,function(Re){this.name=ne,this.message=Re;var je=new Error(Re).stack;je!==void 0&&(this.stack=this.toString()+`
`+je.replace(/^Error(:[^\n]*)?\n/,""))});return me.prototype=Object.create(te.prototype),me.prototype.constructor=me,me.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},me}var bn=void 0;function fn(te){throw new bn(te)}function sn(te,ne,me){te.forEach(function(He){lt[He]=ne});function Re(He){var et=me(He);et.length!==te.length&&fn("Mismatched type converter count");for(var dt=0;dt<te.length;++dt)Nn(te[dt],et[dt])}var je=new Array(ne.length),tt=[],Ye=0;ne.forEach((He,et)=>{Je.hasOwnProperty(He)?je[et]=Je[He]:(tt.push(He),qe.hasOwnProperty(He)||(qe[He]=[]),qe[He].push(()=>{je[et]=Je[He],++Ye,Ye===tt.length&&Re(je)}))}),tt.length===0&&Re(je)}function bi(te){var ne=ct[te];delete ct[te];var me=ne.rawConstructor,Re=ne.rawDestructor,je=ne.fields,tt=je.map(Ye=>Ye.getterReturnType).concat(je.map(Ye=>Ye.setterArgumentType));sn([te],tt,Ye=>{var He={};return je.forEach((et,dt)=>{var It=et.fieldName,Lt=Ye[dt],X=et.getter,Y=et.getterContext,ue=Ye[dt+je.length],Se=et.setter,Ve=et.setterContext;He[It]={read:Ze=>Lt.fromWireType(X(Y,Ze)),write:(Ze,it)=>{var Ke=[];Se(Ve,Ze,ue.toWireType(Ke,it)),Ee(Ke)}}}),[{name:ne.name,fromWireType:function(et){var dt={};for(var It in He)dt[It]=He[It].read(et);return Re(et),dt},toWireType:function(et,dt){for(var It in He)if(!(It in dt))throw new TypeError('Missing field:  "'+It+'"');var Lt=me();for(It in He)He[It].write(Lt,dt[It]);return et!==null&&et.push(Re,Lt),Lt},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:Re}]})}function Kt(te,ne,me,Re,je){}function Be(te){switch(te){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+te)}}function rt(){for(var te=new Array(256),ne=0;ne<256;++ne)te[ne]=String.fromCharCode(ne);Ot=te}var Ot=void 0;function Tn(te){for(var ne="",me=te;A[me];)ne+=Ot[A[me++]];return ne}var Di=void 0;function rn(te){throw new Di(te)}function Nn(te,ne,me={}){if(!("argPackAdvance"in ne))throw new TypeError("registerType registeredInstance requires argPackAdvance");var Re=ne.name;if(te||rn('type "'+Re+'" must have a positive integer typeid pointer'),Je.hasOwnProperty(te)){if(me.ignoreDuplicateRegistrations)return;rn("Cannot register type '"+Re+"' twice")}if(Je[te]=ne,delete lt[te],qe.hasOwnProperty(te)){var je=qe[te];delete qe[te],je.forEach(tt=>tt())}}function zi(te,ne,me,Re,je){var tt=Be(me);ne=Tn(ne),Nn(te,{name:ne,fromWireType:function(Ye){return!!Ye},toWireType:function(Ye,He){return He?Re:je},argPackAdvance:8,readValueFromPointer:function(Ye){var He;if(me===1)He=R;else if(me===2)He=B;else if(me===4)He=L;else throw new TypeError("Unknown boolean type size: "+ne);return this.fromWireType(He[Ye>>tt])},destructorFunction:null})}function wn(te){if(!(this instanceof gi)||!(te instanceof gi))return!1;for(var ne=this.$$.ptrType.registeredClass,me=this.$$.ptr,Re=te.$$.ptrType.registeredClass,je=te.$$.ptr;ne.baseClass;)me=ne.upcast(me),ne=ne.baseClass;for(;Re.baseClass;)je=Re.upcast(je),Re=Re.baseClass;return ne===Re&&me===je}function Xr(te){return{count:te.count,deleteScheduled:te.deleteScheduled,preservePointerOnDelete:te.preservePointerOnDelete,ptr:te.ptr,ptrType:te.ptrType,smartPtr:te.smartPtr,smartPtrType:te.smartPtrType}}function Ii(te){function ne(me){return me.$$.ptrType.registeredClass.name}rn(ne(te)+" instance already deleted")}var Wa=!1;function Ac(te){}function ua(te){te.smartPtr?te.smartPtrType.rawDestructor(te.smartPtr):te.ptrType.registeredClass.rawDestructor(te.ptr)}function $a(te){te.count.value-=1;var ne=te.count.value===0;ne&&ua(te)}function mo(te,ne,me){if(ne===me)return te;if(me.baseClass===void 0)return null;var Re=mo(te,ne,me.baseClass);return Re===null?null:me.downcast(Re)}var br={};function fi(){return Object.keys(di).length}function Cn(){var te=[];for(var ne in di)di.hasOwnProperty(ne)&&te.push(di[ne]);return te}var yr=[];function vo(){for(;yr.length;){var te=yr.pop();te.$$.deleteScheduled=!1,te.delete()}}var Uo=void 0;function fa(te){Uo=te,yr.length&&Uo&&Uo(vo)}function da(){o.getInheritedInstanceCount=fi,o.getLiveInheritedInstances=Cn,o.flushPendingDeletes=vo,o.setDelayFunction=fa}var di={};function Lc(te,ne){for(ne===void 0&&rn("ptr should not be undefined");te.baseClass;)ne=te.upcast(ne),te=te.baseClass;return ne}function Fl(te,ne){return ne=Lc(te,ne),di[ne]}function hi(te,ne){(!ne.ptrType||!ne.ptr)&&fn("makeClassHandle requires ptr and ptrType");var me=!!ne.smartPtrType,Re=!!ne.smartPtr;return me!==Re&&fn("Both smartPtrType and smartPtr must be specified"),ne.count={value:1},Bo(Object.create(te,{$$:{value:ne}}))}function Nc(te){var ne=this.getPointee(te);if(!ne)return this.destructor(te),null;var me=Fl(this.registeredClass,ne);if(me!==void 0){if(me.$$.count.value===0)return me.$$.ptr=ne,me.$$.smartPtr=te,me.clone();var Re=me.clone();return this.destructor(te),Re}function je(){return this.isSmartPointer?hi(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:ne,smartPtrType:this,smartPtr:te}):hi(this.registeredClass.instancePrototype,{ptrType:this,ptr:te})}var tt=this.registeredClass.getActualType(ne),Ye=br[tt];if(!Ye)return je.call(this);var He;this.isConst?He=Ye.constPointerType:He=Ye.pointerType;var et=mo(ne,this.registeredClass,He.registeredClass);return et===null?je.call(this):this.isSmartPointer?hi(He.registeredClass.instancePrototype,{ptrType:He,ptr:et,smartPtrType:this,smartPtr:te}):hi(He.registeredClass.instancePrototype,{ptrType:He,ptr:et})}function Bo(te){return typeof FinalizationRegistry>"u"?(Bo=ne=>ne,te):(Wa=new FinalizationRegistry(ne=>{$a(ne.$$)}),Bo=ne=>{var me=ne.$$,Re=!!me.smartPtr;if(Re){var je={$$:me};Wa.register(ne,je,ne)}return ne},Ac=ne=>Wa.unregister(ne),Bo(te))}function za(){if(this.$$.ptr||Ii(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var te=Bo(Object.create(Object.getPrototypeOf(this),{$$:{value:Xr(this.$$)}}));return te.$$.count.value+=1,te.$$.deleteScheduled=!1,te}function Ul(){this.$$.ptr||Ii(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&rn("Object already scheduled for deletion"),Ac(this),$a(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ri(){return!this.$$.ptr}function Ls(){return this.$$.ptr||Ii(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&rn("Object already scheduled for deletion"),yr.push(this),yr.length===1&&Uo&&Uo(vo),this.$$.deleteScheduled=!0,this}function ha(){gi.prototype.isAliasOf=wn,gi.prototype.clone=za,gi.prototype.delete=Ul,gi.prototype.isDeleted=ri,gi.prototype.deleteLater=Ls}function gi(){}function Ns(te,ne,me){if(te[ne].overloadTable===void 0){var Re=te[ne];te[ne]=function(){return te[ne].overloadTable.hasOwnProperty(arguments.length)||rn("Function '"+me+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+te[ne].overloadTable+")!"),te[ne].overloadTable[arguments.length].apply(this,arguments)},te[ne].overloadTable=[],te[ne].overloadTable[Re.argCount]=Re}}function yo(te,ne,me){o.hasOwnProperty(te)?((me===void 0||o[te].overloadTable!==void 0&&o[te].overloadTable[me]!==void 0)&&rn("Cannot register public name '"+te+"' twice"),Ns(o,te,te),o.hasOwnProperty(me)&&rn("Cannot register multiple overloads of a function with the same number of arguments ("+me+")!"),o[te].overloadTable[me]=ne):(o[te]=ne,me!==void 0&&(o[te].numArguments=me))}function ro(te,ne,me,Re,je,tt,Ye,He){this.name=te,this.constructor=ne,this.instancePrototype=me,this.rawDestructor=Re,this.baseClass=je,this.getActualType=tt,this.upcast=Ye,this.downcast=He,this.pureVirtualFunctions=[]}function ja(te,ne,me){for(;ne!==me;)ne.upcast||rn("Expected null or instance of "+me.name+", got an instance of "+ne.name),te=ne.upcast(te),ne=ne.baseClass;return te}function qr(te,ne){if(ne===null)return this.isReference&&rn("null is not a valid "+this.name),0;ne.$$||rn('Cannot pass "'+Go(ne)+'" as a '+this.name),ne.$$.ptr||rn("Cannot pass deleted object as a pointer of type "+this.name);var me=ne.$$.ptrType.registeredClass,Re=ja(ne.$$.ptr,me,this.registeredClass);return Re}function Bl(te,ne){var me;if(ne===null)return this.isReference&&rn("null is not a valid "+this.name),this.isSmartPointer?(me=this.rawConstructor(),te!==null&&te.push(this.rawDestructor,me),me):0;ne.$$||rn('Cannot pass "'+Go(ne)+'" as a '+this.name),ne.$$.ptr||rn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&ne.$$.ptrType.isConst&&rn("Cannot convert argument of type "+(ne.$$.smartPtrType?ne.$$.smartPtrType.name:ne.$$.ptrType.name)+" to parameter type "+this.name);var Re=ne.$$.ptrType.registeredClass;if(me=ja(ne.$$.ptr,Re,this.registeredClass),this.isSmartPointer)switch(ne.$$.smartPtr===void 0&&rn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:ne.$$.smartPtrType===this?me=ne.$$.smartPtr:rn("Cannot convert argument of type "+(ne.$$.smartPtrType?ne.$$.smartPtrType.name:ne.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:me=ne.$$.smartPtr;break;case 2:if(ne.$$.smartPtrType===this)me=ne.$$.smartPtr;else{var je=ne.clone();me=this.rawShare(me,mi.toHandle(function(){je.delete()})),te!==null&&te.push(this.rawDestructor,me)}break;default:rn("Unsupporting sharing policy")}return me}function io(te,ne){if(ne===null)return this.isReference&&rn("null is not a valid "+this.name),0;ne.$$||rn('Cannot pass "'+Go(ne)+'" as a '+this.name),ne.$$.ptr||rn("Cannot pass deleted object as a pointer of type "+this.name),ne.$$.ptrType.isConst&&rn("Cannot convert argument of type "+ne.$$.ptrType.name+" to parameter type "+this.name);var me=ne.$$.ptrType.registeredClass,Re=ja(ne.$$.ptr,me,this.registeredClass);return Re}function Vc(te){return this.rawGetPointee&&(te=this.rawGetPointee(te)),te}function Vs(te){this.rawDestructor&&this.rawDestructor(te)}function Gl(te){te!==null&&te.delete()}function kc(){Mi.prototype.getPointee=Vc,Mi.prototype.destructor=Vs,Mi.prototype.argPackAdvance=8,Mi.prototype.readValueFromPointer=ze,Mi.prototype.deleteObject=Gl,Mi.prototype.fromWireType=Nc}function Mi(te,ne,me,Re,je,tt,Ye,He,et,dt,It){this.name=te,this.registeredClass=ne,this.isReference=me,this.isConst=Re,this.isSmartPointer=je,this.pointeeType=tt,this.sharingPolicy=Ye,this.rawGetPointee=He,this.rawConstructor=et,this.rawShare=dt,this.rawDestructor=It,!je&&ne.baseClass===void 0?Re?(this.toWireType=qr,this.destructorFunction=null):(this.toWireType=io,this.destructorFunction=null):this.toWireType=Bl}function Oi(te,ne,me){o.hasOwnProperty(te)||fn("Replacing nonexistant public symbol"),o[te].overloadTable!==void 0&&me!==void 0?o[te].overloadTable[me]=ne:(o[te]=ne,o[te].argCount=me)}function Fc(te,ne,me){var Re=o["dynCall_"+te];return me&&me.length?Re.apply(null,[ne].concat(me)):Re.call(null,ne)}var kr=[];function Uc(te){var ne=kr[te];return ne||(te>=kr.length&&(kr.length=te+1),kr[te]=ne=fe.get(te)),ne}function ks(te,ne,me){if(te.includes("j"))return Fc(te,ne,me);var Re=Uc(ne).apply(null,me);return Re}function Ha(te,ne){var me=[];return function(){return me.length=0,Object.assign(me,arguments),ks(te,ne,me)}}function ur(te,ne){te=Tn(te);function me(){return te.includes("j")?Ha(te,ne):Uc(ne)}var Re=me();return typeof Re!="function"&&rn("unknown function pointer with signature "+te+": "+ne),Re}var ji=void 0;function Ka(te){var ne=$o(te),me=Tn(ne);return Ki(ne),me}function Yr(te,ne){var me=[],Re={};function je(tt){if(!Re[tt]&&!Je[tt]){if(lt[tt]){lt[tt].forEach(je);return}me.push(tt),Re[tt]=!0}}throw ne.forEach(je),new ji(te+": "+me.map(Ka).join([", "]))}function Bc(te,ne,me,Re,je,tt,Ye,He,et,dt,It,Lt,X){It=Tn(It),tt=ur(je,tt),He&&(He=ur(Ye,He)),dt&&(dt=ur(et,dt)),X=ur(Lt,X);var Y=nt(It);yo(Y,function(){Yr("Cannot construct "+It+" due to unbound types",[Re])}),sn([te,ne,me],Re?[Re]:[],function(ue){ue=ue[0];var Se,Ve;Re?(Se=ue.registeredClass,Ve=Se.instancePrototype):Ve=gi.prototype;var Ze=wt(Y,function(){if(Object.getPrototypeOf(this)!==it)throw new Di("Use 'new' to construct "+It);if(Ke.constructor_body===void 0)throw new Di(It+" has no accessible constructor");var N=Ke.constructor_body[arguments.length];if(N===void 0)throw new Di("Tried to invoke ctor of "+It+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ke.constructor_body).toString()+") parameters instead!");return N.apply(this,arguments)}),it=Object.create(Ve,{constructor:{value:Ze}});Ze.prototype=it;var Ke=new ro(It,Ze,it,X,Se,tt,He,dt),ot=new Mi(It,Ke,!0,!1,!1),z=new Mi(It+"*",Ke,!1,!1,!1),H=new Mi(It+" const*",Ke,!1,!0,!1);return br[te]={pointerType:z,constPointerType:H},Oi(Y,Ze),[ot,z,H]})}function ii(te,ne){for(var me=[],Re=0;Re<te;Re++)me.push(F[ne+Re*4>>2]);return me}function pi(te,ne){if(!(te instanceof Function))throw new TypeError("new_ called with constructor type "+typeof te+" which is not a function");var me=wt(te.name||"unknownFunctionName",function(){});me.prototype=te.prototype;var Re=new me,je=te.apply(Re,ne);return je instanceof Object?je:Re}function Xa(te,ne,me,Re,je){var tt=ne.length;tt<2&&rn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Ye=ne[1]!==null&&me!==null,He=!1,et=1;et<ne.length;++et)if(ne[et]!==null&&ne[et].destructorFunction===void 0){He=!0;break}for(var dt=ne[0].name!=="void",It="",Lt="",et=0;et<tt-2;++et)It+=(et!==0?", ":"")+"arg"+et,Lt+=(et!==0?", ":"")+"arg"+et+"Wired";var X="return function "+nt(te)+"("+It+`) {
if (arguments.length !== `+(tt-2)+`) {
throwBindingError('function `+te+" called with ' + arguments.length + ' arguments, expected "+(tt-2)+` args!');
}
`;He&&(X+=`var destructors = [];
`);var Y=He?"destructors":"null",ue=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Se=[rn,Re,je,Ee,ne[0],ne[1]];Ye&&(X+="var thisWired = classParam.toWireType("+Y+`, this);
`);for(var et=0;et<tt-2;++et)X+="var arg"+et+"Wired = argType"+et+".toWireType("+Y+", arg"+et+"); // "+ne[et+2].name+`
`,ue.push("argType"+et),Se.push(ne[et+2]);if(Ye&&(Lt="thisWired"+(Lt.length>0?", ":"")+Lt),X+=(dt?"var rv = ":"")+"invoker(fn"+(Lt.length>0?", ":"")+Lt+`);
`,He)X+=`runDestructors(destructors);
`;else for(var et=Ye?1:2;et<ne.length;++et){var Ve=et===1?"thisWired":"arg"+(et-2)+"Wired";ne[et].destructorFunction!==null&&(X+=Ve+"_dtor("+Ve+"); // "+ne[et].name+`
`,ue.push(Ve+"_dtor"),Se.push(ne[et].destructorFunction))}dt&&(X+=`var ret = retType.fromWireType(rv);
return ret;
`),X+=`}
`,ue.push(X);var Ze=pi(Function,ue).apply(null,Se);return Ze}function qa(te,ne,me,Re,je,tt){S(ne>0);var Ye=ii(ne,me);je=ur(Re,je),sn([],[te],function(He){He=He[0];var et="constructor "+He.name;if(He.registeredClass.constructor_body===void 0&&(He.registeredClass.constructor_body=[]),He.registeredClass.constructor_body[ne-1]!==void 0)throw new Di("Cannot register multiple constructors with identical number of parameters ("+(ne-1)+") for class '"+He.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return He.registeredClass.constructor_body[ne-1]=()=>{Yr("Cannot construct "+He.name+" due to unbound types",Ye)},sn([],Ye,function(dt){return dt.splice(1,0,null),He.registeredClass.constructor_body[ne-1]=Xa(et,dt,null,je,tt),[]}),[]})}function Wl(te,ne,me,Re,je,tt,Ye,He){var et=ii(me,Re);ne=Tn(ne),tt=ur(je,tt),sn([],[te],function(dt){dt=dt[0];var It=dt.name+"."+ne;ne.startsWith("@@")&&(ne=Symbol[ne.substring(2)]),He&&dt.registeredClass.pureVirtualFunctions.push(ne);function Lt(){Yr("Cannot call "+It+" due to unbound types",et)}var X=dt.registeredClass.instancePrototype,Y=X[ne];return Y===void 0||Y.overloadTable===void 0&&Y.className!==dt.name&&Y.argCount===me-2?(Lt.argCount=me-2,Lt.className=dt.name,X[ne]=Lt):(Ns(X,ne,It),X[ne].overloadTable[me-2]=Lt),sn([],et,function(ue){var Se=Xa(It,ue,dt,tt,Ye);return X[ne].overloadTable===void 0?(Se.argCount=me-2,X[ne]=Se):X[ne].overloadTable[me-2]=Se,[]}),[]})}var Ya=[],Qn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Fs(te){te>4&&--Qn[te].refcount===0&&(Qn[te]=void 0,Ya.push(te))}function Ja(){for(var te=0,ne=5;ne<Qn.length;++ne)Qn[ne]!==void 0&&++te;return te}function Fr(){for(var te=5;te<Qn.length;++te)if(Qn[te]!==void 0)return Qn[te];return null}function Us(){o.count_emval_handles=Ja,o.get_first_emval=Fr}var mi={toValue:te=>(te||rn("Cannot use deleted val. handle = "+te),Qn[te].value),toHandle:te=>{switch(te){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var ne=Ya.length?Ya.pop():Qn.length;return Qn[ne]={refcount:1,value:te},ne}}}};function Gc(te,ne){ne=Tn(ne),Nn(te,{name:ne,fromWireType:function(me){var Re=mi.toValue(me);return Fs(me),Re},toWireType:function(me,Re){return mi.toHandle(Re)},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:null})}function Go(te){if(te===null)return"null";var ne=typeof te;return ne==="object"||ne==="array"||ne==="function"?te.toString():""+te}function Hi(te,ne){switch(ne){case 2:return function(me){return this.fromWireType(j[me>>2])};case 3:return function(me){return this.fromWireType(J[me>>3])};default:throw new TypeError("Unknown float type: "+te)}}function $l(te,ne,me){var Re=Be(me);ne=Tn(ne),Nn(te,{name:ne,fromWireType:function(je){return je},toWireType:function(je,tt){return tt},argPackAdvance:8,readValueFromPointer:Hi(ne,Re),destructorFunction:null})}function Wo(te,ne,me,Re,je,tt){var Ye=ii(ne,me);te=Tn(te),je=ur(Re,je),yo(te,function(){Yr("Cannot call "+te+" due to unbound types",Ye)},ne-1),sn([],Ye,function(He){var et=[He[0],null].concat(He.slice(1));return Oi(te,Xa(te,et,null,je,tt),ne-1),[]})}function vi(te,ne,me){switch(ne){case 0:return me?function(je){return R[je]}:function(je){return A[je]};case 1:return me?function(je){return B[je>>1]}:function(je){return k[je>>1]};case 2:return me?function(je){return L[je>>2]}:function(je){return F[je>>2]};default:throw new TypeError("Unknown integer type: "+te)}}function Wc(te,ne,me,Re,je){ne=Tn(ne);var tt=Be(me),Ye=Lt=>Lt;if(Re===0){var He=32-8*me;Ye=Lt=>Lt<<He>>>He}var et=ne.includes("unsigned"),dt=(Lt,X)=>{},It;et?It=function(Lt,X){return dt(X,this.name),X>>>0}:It=function(Lt,X){return dt(X,this.name),X},Nn(te,{name:ne,fromWireType:Ye,toWireType:It,argPackAdvance:8,readValueFromPointer:vi(ne,tt,Re!==0),destructorFunction:null})}function zl(te,ne,me){var Re=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],je=Re[ne];function tt(Ye){Ye=Ye>>2;var He=F,et=He[Ye],dt=He[Ye+1];return new je(M,dt,et)}me=Tn(me),Nn(te,{name:me,fromWireType:tt,argPackAdvance:8,readValueFromPointer:tt},{ignoreDuplicateRegistrations:!0})}function jl(te,ne){ne=Tn(ne);var me=ne==="std::string";Nn(te,{name:ne,fromWireType:function(Re){var je=F[Re>>2],tt=Re+4,Ye;if(me)for(var He=tt,et=0;et<=je;++et){var dt=tt+et;if(et==je||A[dt]==0){var It=dt-He,Lt=D(He,It);Ye===void 0?Ye=Lt:(Ye+="\0",Ye+=Lt),He=dt+1}}else{for(var X=new Array(je),et=0;et<je;++et)X[et]=String.fromCharCode(A[tt+et]);Ye=X.join("")}return Ki(Re),Ye},toWireType:function(Re,je){je instanceof ArrayBuffer&&(je=new Uint8Array(je));var tt,Ye=typeof je=="string";Ye||je instanceof Uint8Array||je instanceof Uint8ClampedArray||je instanceof Int8Array||rn("Cannot pass non-string to std::string"),me&&Ye?tt=O(je):tt=je.length;var He=Hs(4+tt+1),et=He+4;if(F[He>>2]=tt,me&&Ye)I(je,et,tt+1);else if(Ye)for(var dt=0;dt<tt;++dt){var It=je.charCodeAt(dt);It>255&&(Ki(et),rn("String has UTF-16 code units that do not fit in 8 bits")),A[et+dt]=It}else for(var dt=0;dt<tt;++dt)A[et+dt]=je[dt];return Re!==null&&Re.push(Ki,He),He},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:function(Re){Ki(Re)}})}var $c=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Za(te,ne){for(var me=te,Re=me>>1,je=Re+ne/2;!(Re>=je)&&k[Re];)++Re;if(me=Re<<1,me-te>32&&$c)return $c.decode(A.subarray(te,me));for(var tt="",Ye=0;!(Ye>=ne/2);++Ye){var He=B[te+Ye*2>>1];if(He==0)break;tt+=String.fromCharCode(He)}return tt}function zc(te,ne,me){if(me===void 0&&(me=2147483647),me<2)return 0;me-=2;for(var Re=ne,je=me<te.length*2?me/2:te.length,tt=0;tt<je;++tt){var Ye=te.charCodeAt(tt);B[ne>>1]=Ye,ne+=2}return B[ne>>1]=0,ne-Re}function Bs(te){return te.length*2}function Hl(te,ne){for(var me=0,Re="";!(me>=ne/4);){var je=L[te+me*4>>2];if(je==0)break;if(++me,je>=65536){var tt=je-65536;Re+=String.fromCharCode(55296|tt>>10,56320|tt&1023)}else Re+=String.fromCharCode(je)}return Re}function Kl(te,ne,me){if(me===void 0&&(me=2147483647),me<4)return 0;for(var Re=ne,je=Re+me-4,tt=0;tt<te.length;++tt){var Ye=te.charCodeAt(tt);if(Ye>=55296&&Ye<=57343){var He=te.charCodeAt(++tt);Ye=65536+((Ye&1023)<<10)|He&1023}if(L[ne>>2]=Ye,ne+=4,ne+4>je)break}return L[ne>>2]=0,ne-Re}function Xl(te){for(var ne=0,me=0;me<te.length;++me){var Re=te.charCodeAt(me);Re>=55296&&Re<=57343&&++me,ne+=4}return ne}function Gs(te,ne,me){me=Tn(me);var Re,je,tt,Ye,He;ne===2?(Re=Za,je=zc,Ye=Bs,tt=()=>k,He=1):ne===4&&(Re=Hl,je=Kl,Ye=Xl,tt=()=>F,He=2),Nn(te,{name:me,fromWireType:function(et){for(var dt=F[et>>2],It=tt(),Lt,X=et+4,Y=0;Y<=dt;++Y){var ue=et+4+Y*ne;if(Y==dt||It[ue>>He]==0){var Se=ue-X,Ve=Re(X,Se);Lt===void 0?Lt=Ve:(Lt+="\0",Lt+=Ve),X=ue+ne}}return Ki(et),Lt},toWireType:function(et,dt){typeof dt!="string"&&rn("Cannot pass non-string to C++ string type "+me);var It=Ye(dt),Lt=Hs(4+It+ne);return F[Lt>>2]=It>>He,je(dt,Lt+4,It+ne),et!==null&&et.push(Ki,Lt),Lt},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:function(et){Ki(et)}})}function ql(te,ne,me,Re,je,tt){ct[te]={name:Tn(ne),rawConstructor:ur(me,Re),rawDestructor:ur(je,tt),fields:[]}}function Yl(te,ne,me,Re,je,tt,Ye,He,et,dt){ct[te].fields.push({fieldName:Tn(ne),getterReturnType:me,getter:ur(Re,je),getterContext:tt,setterArgumentType:Ye,setter:ur(He,et),setterContext:dt})}function Jl(te,ne){ne=Tn(ne),Nn(te,{isVoid:!0,name:ne,argPackAdvance:0,fromWireType:function(){},toWireType:function(me,Re){}})}var Ws={};function Zl(te){var ne=Ws[te];return ne===void 0?Tn(te):ne}function jc(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function Hc(te){return te===0?mi.toHandle(jc()):(te=Zl(te),mi.toHandle(jc()[te]))}function Ql(te){te>4&&(Qn[te].refcount+=1)}function $s(te,ne){var me=Je[te];return me===void 0&&rn(ne+" has unknown type "+Ka(te)),me}function eu(te){for(var ne="",me=0;me<te;++me)ne+=(me!==0?", ":"")+"arg"+me;for(var Re=()=>F,je="return function emval_allocator_"+te+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,me=0;me<te;++me)je+="var argType"+me+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+me+`');
var arg`+me+" = argType"+me+`.readValueFromPointer(args);
args += argType`+me+`['argPackAdvance'];
argTypes += 4;
`;return je+="var obj = new constructor("+ne+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",je)($s,o,mi.toHandle,Re)}var Kc={};function Xc(te,ne,me,Re){te=mi.toValue(te);var je=Kc[ne];return je||(je=eu(ne),Kc[ne]=je),je(te,me,Re)}function qc(te,ne){te=$s(te,"_emval_take_value");var me=te.readValueFromPointer(ne);return mi.toHandle(me)}function Yc(){De("")}function tu(te,ne,me){A.copyWithin(te,ne,ne+me)}function nu(){return 2147483648}function ru(te){try{return x.grow(te-M.byteLength+65535>>>16),ie(x.buffer),1}catch{}}function zs(te){var ne=A.length;te=te>>>0;var me=nu();if(te>me)return!1;let Re=(et,dt)=>et+(dt-et%dt)%dt;for(var je=1;je<=4;je*=2){var tt=ne*(1+.2/je);tt=Math.min(tt,te+100663296);var Ye=Math.min(me,Re(Math.max(te,tt),65536)),He=ru(Ye);if(He)return!0}return!1}function iu(te){var ne=o["_"+te];return ne}function ga(te,ne){R.set(te,ne)}function ou(te,ne,me,Re,je){var tt={string:ue=>{var Se=0;if(ue!=null&&ue!==0){var Ve=(ue.length<<2)+1;Se=Ks(Ve),I(ue,Se,Ve)}return Se},array:ue=>{var Se=Ks(ue.length);return ga(ue,Se),Se}};function Ye(ue){return ne==="string"?D(ue):ne==="boolean"?!!ue:ue}var He=iu(te),et=[],dt=0;if(Re)for(var It=0;It<Re.length;It++){var Lt=tt[me[It]];Lt?(dt===0&&(dt=Jc()),et[It]=Lt(Re[It])):et[It]=Re[It]}var X=He.apply(null,et);function Y(ue){return dt!==0&&Zc(dt),Ye(ue)}return X=Y(X),X}bn=o.InternalError=yn(Error,"InternalError"),rt(),Di=o.BindingError=yn(Error,"BindingError"),ha(),da(),kc(),ji=o.UnboundTypeError=yn(Error,"UnboundTypeError"),Us();var js={h:gt,q:bi,r:Kt,w:zi,p:Bc,o:qa,c:Wl,v:Gc,k:$l,e:Wo,b:Wc,a:zl,j:jl,g:Gs,u:ql,d:Yl,x:Jl,i:Fs,m:Hc,l:Ql,y:Xc,n:qc,f:Yc,t:tu,s:zs};pe(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.A).apply(null,arguments)};var Hs=o._malloc=function(){return(Hs=o._malloc=o.asm.B).apply(null,arguments)},$o=o.___getTypeName=function(){return($o=o.___getTypeName=o.asm.D).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.E).apply(null,arguments)};var Ki=o._free=function(){return(Ki=o._free=o.asm.F).apply(null,arguments)},Jc=o.stackSave=function(){return(Jc=o.stackSave=o.asm.G).apply(null,arguments)},Zc=o.stackRestore=function(){return(Zc=o.stackRestore=o.asm.H).apply(null,arguments)},Ks=o.stackAlloc=function(){return(Ks=o.stackAlloc=o.asm.I).apply(null,arguments)},Qc=o.___cxa_is_pointer_type=function(){return(Qc=o.___cxa_is_pointer_type=o.asm.J).apply(null,arguments)};o.ccall=ou;var Qa;Q=function te(){Qa||Xs(),Qa||(Q=te)};function Xs(te){if(q>0||(_e(),q>0))return;function ne(){Qa||(Qa=!0,o.calledRun=!0,!T&&(Te(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),G()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),ne()},1)):ne()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return Xs(),i.ready})})();t.exports=r})(Fy)),Fy.exports}var bve=Eve();const Dve=ka(bve),Ive=new URL(""+new URL("charlswasm_decode-484ovEoR.wasm",import.meta.url).href,import.meta.url),Bf={codec:void 0,decoder:void 0,decodeConfig:{}};function Mve(t){return typeof t=="number"?Bf.codec.getExceptionMessage(t):t}function Ove(t){if(Bf.decodeConfig=t,Bf.codec)return Promise.resolve();const e=Dve({locateFile:r=>r.endsWith(".wasm")?Ive.toString():r});return new Promise((r,n)=>{e.then(i=>{Bf.codec=i,Bf.decoder=new i.JpegLSDecoder,r()},n)})}async function ib(t,e){try{await Ove();const r=Bf.decoder;r.getEncodedBuffer(t.length).set(t),r.decode();const i=r.getFrameInfo(),o=r.getInterleaveMode(),a=r.getNearLossless(),s=r.getDecodedBuffer(),c={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},l=Pve(i,s,e.signed),f={nearLossless:a,interleaveMode:o,frameInfo:i};return{...e,pixelData:l,imageInfo:c,encodeOptions:f,...f,...c}}catch(r){throw Mve(r)}}function Pve(t,e,r){return t.bitsPerSample>8?r?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):r?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var Uy={exports:{}},ob;function Rve(){return ob||(ob=1,(function(t,e){var r=(()=>{var n=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(i={}){var o,a=i,s,c,l=new Promise((X,Y)=>{s=X,c=Y}),f=typeof window=="object",u=typeof WorkerGlobalScope<"u",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",h=Object.assign({},a),g="./this.program",p="";function m(X){return a.locateFile?a.locateFile(X,p):p+X}var w,v;if(d){var y=wc;p=__dirname+"/",v=X=>{X=q(X)?new URL(X):X;var Y=y.readFileSync(X);return Y},w=async(X,Y=!0)=>{X=q(X)?new URL(X):X;var ue=y.readFileSync(X,Y?void 0:"utf8");return ue},!a.thisProgram&&process.argv.length>1&&(g=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else(f||u)&&(u?p=self.location.href:typeof document<"u"&&document.currentScript&&(p=document.currentScript.src),n&&(p=n),p.startsWith("blob:")?p="":p=p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(v=X=>{var Y=new XMLHttpRequest;return Y.open("GET",X,!1),Y.responseType="arraybuffer",Y.send(null),new Uint8Array(Y.response)}),w=async X=>{if(q(X))return new Promise((ue,Se)=>{var Ve=new XMLHttpRequest;Ve.open("GET",X,!0),Ve.responseType="arraybuffer",Ve.onload=()=>{if(Ve.status==200||Ve.status==0&&Ve.response){ue(Ve.response);return}Se(Ve.status)},Ve.onerror=Se,Ve.send(null)});var Y=await fetch(X,{credentials:"same-origin"});if(Y.ok)return Y.arrayBuffer();throw new Error(Y.status+" : "+Y.url)});var C=a.print||console.log.bind(console),x=a.printErr||console.error.bind(console);Object.assign(a,h),h=null,a.arguments&&a.arguments,a.thisProgram&&(g=a.thisProgram);var T=a.wasmBinary,S,_=!1,E,D,b,I,O,M,R,A;function B(){var X=S.buffer;a.HEAP8=E=new Int8Array(X),a.HEAP16=b=new Int16Array(X),a.HEAPU8=D=new Uint8Array(X),a.HEAPU16=I=new Uint16Array(X),a.HEAP32=O=new Int32Array(X),a.HEAPU32=M=new Uint32Array(X),a.HEAPF32=R=new Float32Array(X),a.HEAPF64=A=new Float64Array(X)}var k=[],L=[],F=[];function j(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)fe(a.preRun.shift());ve(k)}function J(){ve(L)}function ie(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)de(a.postRun.shift());ve(F)}function fe(X){k.unshift(X)}function ae(X){L.unshift(X)}function de(X){F.unshift(X)}var we=0,_e=null;function Te(X){we++,a.monitorRunDependencies?.(we)}function G(X){if(we--,a.monitorRunDependencies?.(we),we==0&&_e){var Y=_e;_e=null,Y()}}function P(X){a.onAbort?.(X),X="Aborted("+X+")",x(X),_=!0,X+=". Build with -sASSERTIONS for more info.";var Y=new WebAssembly.RuntimeError(X);throw c(Y),Y}var $="data:application/octet-stream;base64,",W=X=>X.startsWith($),q=X=>X.startsWith("file://");function Q(){var X="openjpegwasm_decode.wasm";return W(X)?X:m(X)}var ee;function ge(X){if(X==ee&&T)return new Uint8Array(T);if(v)return v(X);throw"both async and sync fetching of the wasm failed"}async function De(X){if(!T)try{var Y=await w(X);return new Uint8Array(Y)}catch{}return ge(X)}async function Ne(X,Y){try{var ue=await De(X),Se=await WebAssembly.instantiate(ue,Y);return Se}catch(Ve){x(`failed to asynchronously prepare wasm: ${Ve}`),P(Ve)}}async function We(X,Y,ue){if(!X&&typeof WebAssembly.instantiateStreaming=="function"&&!W(Y)&&!q(Y)&&!d&&typeof fetch=="function")try{var Se=fetch(Y,{credentials:"same-origin"}),Ve=await WebAssembly.instantiateStreaming(Se,ue);return Ve}catch(Ze){x(`wasm streaming compile failed: ${Ze}`),x("falling back to ArrayBuffer instantiation")}return Ne(Y,ue)}function re(){return{a:me}}async function se(){function X(Ve,Ze){return Re=Ve.exports,S=Re.F,B(),Ns=Re.I,ae(Re.G),G(),Re}Te();function Y(Ve){X(Ve.instance)}var ue=re();if(a.instantiateWasm)try{return a.instantiateWasm(ue,X)}catch(Ve){x(`Module.instantiateWasm callback failed with error: ${Ve}`),c(Ve)}ee??=Q();try{var Se=await We(T,ee,ue);return Y(Se),Se}catch(Ve){c(Ve);return}}var ve=X=>{for(;X.length>0;)X.shift()(a)};a.noExitRuntime;var le=X=>He(X),pe=()=>dt();class $e{constructor(Y){this.excPtr=Y,this.ptr=Y-24}set_type(Y){M[this.ptr+4>>2]=Y}get_type(){return M[this.ptr+4>>2]}set_destructor(Y){M[this.ptr+8>>2]=Y}get_destructor(){return M[this.ptr+8>>2]}set_caught(Y){Y=Y?1:0,E[this.ptr+12]=Y}get_caught(){return E[this.ptr+12]!=0}set_rethrown(Y){Y=Y?1:0,E[this.ptr+13]=Y}get_rethrown(){return E[this.ptr+13]!=0}init(Y,ue){this.set_adjusted_ptr(0),this.set_type(Y),this.set_destructor(ue)}set_adjusted_ptr(Y){M[this.ptr+16>>2]=Y}get_adjusted_ptr(){return M[this.ptr+16>>2]}}var oe=0,st=(X,Y,ue)=>{var Se=new $e(X);throw Se.init(Y,ue),oe=X,oe},gt=()=>P(""),ct={},Ee=X=>{for(;X.length;){var Y=X.pop(),ue=X.pop();ue(Y)}};function ze(X){return this.fromWireType(M[X>>2])}var qe={},Je={},lt={},Pe,Fe=X=>{throw new Pe(X)},nt=(X,Y,ue)=>{X.forEach(Ke=>lt[Ke]=Y);function Se(Ke){var ot=ue(Ke);ot.length!==X.length&&Fe("Mismatched type converter count");for(var z=0;z<X.length;++z)rt(X[z],ot[z])}var Ve=new Array(Y.length),Ze=[],it=0;Y.forEach((Ke,ot)=>{Je.hasOwnProperty(Ke)?Ve[ot]=Je[Ke]:(Ze.push(Ke),qe.hasOwnProperty(Ke)||(qe[Ke]=[]),qe[Ke].push(()=>{Ve[ot]=Je[Ke],++it,it===Ze.length&&Se(Ve)}))}),Ze.length===0&&Se(Ve)},wt=X=>{var Y=ct[X];delete ct[X];var ue=Y.rawConstructor,Se=Y.rawDestructor,Ve=Y.fields,Ze=Ve.map(it=>it.getterReturnType).concat(Ve.map(it=>it.setterArgumentType));nt([X],Ze,it=>{var Ke={};return Ve.forEach((ot,z)=>{var H=ot.fieldName,N=it[z],U=ot.getter,Z=ot.getterContext,ce=it[z+Ve.length],he=ot.setter,ye=ot.setterContext;Ke[H]={read:xe=>N.fromWireType(U(Z,xe)),write:(xe,be)=>{var Le=[];he(ye,xe,ce.toWireType(Le,be)),Ee(Le)}}}),[{name:Y.name,fromWireType:ot=>{var z={};for(var H in Ke)z[H]=Ke[H].read(ot);return Se(ot),z},toWireType:(ot,z)=>{for(var H in Ke)if(!(H in z))throw new TypeError(`Missing field: "${H}"`);var N=ue();for(H in Ke)Ke[H].write(N,z[H]);return ot!==null&&ot.push(Se,N),N},argPackAdvance:Ot,readValueFromPointer:ze,destructorFunction:Se}]})},yn=(X,Y,ue,Se,Ve)=>{},bn=()=>{for(var X=new Array(256),Y=0;Y<256;++Y)X[Y]=String.fromCharCode(Y);fn=X},fn,sn=X=>{for(var Y="",ue=X;D[ue];)Y+=fn[D[ue++]];return Y},bi,Kt=X=>{throw new bi(X)};function Be(X,Y,ue={}){var Se=Y.name;if(X||Kt(`type "${Se}" must have a positive integer typeid pointer`),Je.hasOwnProperty(X)){if(ue.ignoreDuplicateRegistrations)return;Kt(`Cannot register type '${Se}' twice`)}if(Je[X]=Y,delete lt[X],qe.hasOwnProperty(X)){var Ve=qe[X];delete qe[X],Ve.forEach(Ze=>Ze())}}function rt(X,Y,ue={}){return Be(X,Y,ue)}var Ot=8,Tn=(X,Y,ue,Se)=>{Y=sn(Y),rt(X,{name:Y,fromWireType:function(Ve){return!!Ve},toWireType:function(Ve,Ze){return Ze?ue:Se},argPackAdvance:Ot,readValueFromPointer:function(Ve){return this.fromWireType(D[Ve])},destructorFunction:null})},Di=X=>({count:X.count,deleteScheduled:X.deleteScheduled,preservePointerOnDelete:X.preservePointerOnDelete,ptr:X.ptr,ptrType:X.ptrType,smartPtr:X.smartPtr,smartPtrType:X.smartPtrType}),rn=X=>{function Y(ue){return ue.$$.ptrType.registeredClass.name}Kt(Y(X)+" instance already deleted")},Nn=!1,zi=X=>{},wn=X=>{X.smartPtr?X.smartPtrType.rawDestructor(X.smartPtr):X.ptrType.registeredClass.rawDestructor(X.ptr)},Xr=X=>{X.count.value-=1;var Y=X.count.value===0;Y&&wn(X)},Ii=(X,Y,ue)=>{if(Y===ue)return X;if(ue.baseClass===void 0)return null;var Se=Ii(X,Y,ue.baseClass);return Se===null?null:ue.downcast(Se)},Wa={},Ac={},ua=(X,Y)=>{for(Y===void 0&&Kt("ptr should not be undefined");X.baseClass;)Y=X.upcast(Y),X=X.baseClass;return Y},$a=(X,Y)=>(Y=ua(X,Y),Ac[Y]),mo=(X,Y)=>{(!Y.ptrType||!Y.ptr)&&Fe("makeClassHandle requires ptr and ptrType");var ue=!!Y.smartPtrType,Se=!!Y.smartPtr;return ue!==Se&&Fe("Both smartPtrType and smartPtr must be specified"),Y.count={value:1},fi(Object.create(X,{$$:{value:Y,writable:!0}}))};function br(X){var Y=this.getPointee(X);if(!Y)return this.destructor(X),null;var ue=$a(this.registeredClass,Y);if(ue!==void 0){if(ue.$$.count.value===0)return ue.$$.ptr=Y,ue.$$.smartPtr=X,ue.clone();var Se=ue.clone();return this.destructor(X),Se}function Ve(){return this.isSmartPointer?mo(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:Y,smartPtrType:this,smartPtr:X}):mo(this.registeredClass.instancePrototype,{ptrType:this,ptr:X})}var Ze=this.registeredClass.getActualType(Y),it=Wa[Ze];if(!it)return Ve.call(this);var Ke;this.isConst?Ke=it.constPointerType:Ke=it.pointerType;var ot=Ii(Y,this.registeredClass,Ke.registeredClass);return ot===null?Ve.call(this):this.isSmartPointer?mo(Ke.registeredClass.instancePrototype,{ptrType:Ke,ptr:ot,smartPtrType:this,smartPtr:X}):mo(Ke.registeredClass.instancePrototype,{ptrType:Ke,ptr:ot})}var fi=X=>typeof FinalizationRegistry>"u"?(fi=Y=>Y,X):(Nn=new FinalizationRegistry(Y=>{Xr(Y.$$)}),fi=Y=>{var ue=Y.$$,Se=!!ue.smartPtr;if(Se){var Ve={$$:ue};Nn.register(Y,Ve,Y)}return Y},zi=Y=>Nn.unregister(Y),fi(X)),Cn=()=>{Object.assign(yr.prototype,{isAliasOf(X){if(!(this instanceof yr)||!(X instanceof yr))return!1;var Y=this.$$.ptrType.registeredClass,ue=this.$$.ptr;X.$$=X.$$;for(var Se=X.$$.ptrType.registeredClass,Ve=X.$$.ptr;Y.baseClass;)ue=Y.upcast(ue),Y=Y.baseClass;for(;Se.baseClass;)Ve=Se.upcast(Ve),Se=Se.baseClass;return Y===Se&&ue===Ve},clone(){if(this.$$.ptr||rn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var X=fi(Object.create(Object.getPrototypeOf(this),{$$:{value:Di(this.$$)}}));return X.$$.count.value+=1,X.$$.deleteScheduled=!1,X},delete(){this.$$.ptr||rn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Kt("Object already scheduled for deletion"),zi(this),Xr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||rn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Kt("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}})};function yr(){}var vo=(X,Y)=>Object.defineProperty(Y,"name",{value:X}),Uo=(X,Y,ue)=>{if(X[Y].overloadTable===void 0){var Se=X[Y];X[Y]=function(...Ve){return X[Y].overloadTable.hasOwnProperty(Ve.length)||Kt(`Function '${ue}' called with an invalid number of arguments (${Ve.length}) - expects one of (${X[Y].overloadTable})!`),X[Y].overloadTable[Ve.length].apply(this,Ve)},X[Y].overloadTable=[],X[Y].overloadTable[Se.argCount]=Se}},fa=(X,Y,ue)=>{a.hasOwnProperty(X)?(Kt(`Cannot register public name '${X}' twice`),Uo(a,X,X),a[X].overloadTable.hasOwnProperty(ue)&&Kt(`Cannot register multiple overloads of a function with the same number of arguments (${ue})!`),a[X].overloadTable[ue]=Y):(a[X]=Y,a[X].argCount=ue)},da=48,di=57,Lc=X=>{X=X.replace(/[^a-zA-Z0-9_]/g,"$");var Y=X.charCodeAt(0);return Y>=da&&Y<=di?`_${X}`:X};function Fl(X,Y,ue,Se,Ve,Ze,it,Ke){this.name=X,this.constructor=Y,this.instancePrototype=ue,this.rawDestructor=Se,this.baseClass=Ve,this.getActualType=Ze,this.upcast=it,this.downcast=Ke,this.pureVirtualFunctions=[]}var hi=(X,Y,ue)=>{for(;Y!==ue;)Y.upcast||Kt(`Expected null or instance of ${ue.name}, got an instance of ${Y.name}`),X=Y.upcast(X),Y=Y.baseClass;return X};function Nc(X,Y){if(Y===null)return this.isReference&&Kt(`null is not a valid ${this.name}`),0;Y.$$||Kt(`Cannot pass "${qa(Y)}" as a ${this.name}`),Y.$$.ptr||Kt(`Cannot pass deleted object as a pointer of type ${this.name}`);var ue=Y.$$.ptrType.registeredClass,Se=hi(Y.$$.ptr,ue,this.registeredClass);return Se}function Bo(X,Y){var ue;if(Y===null)return this.isReference&&Kt(`null is not a valid ${this.name}`),this.isSmartPointer?(ue=this.rawConstructor(),X!==null&&X.push(this.rawDestructor,ue),ue):0;(!Y||!Y.$$)&&Kt(`Cannot pass "${qa(Y)}" as a ${this.name}`),Y.$$.ptr||Kt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&Y.$$.ptrType.isConst&&Kt(`Cannot convert argument of type ${Y.$$.smartPtrType?Y.$$.smartPtrType.name:Y.$$.ptrType.name} to parameter type ${this.name}`);var Se=Y.$$.ptrType.registeredClass;if(ue=hi(Y.$$.ptr,Se,this.registeredClass),this.isSmartPointer)switch(Y.$$.smartPtr===void 0&&Kt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:Y.$$.smartPtrType===this?ue=Y.$$.smartPtr:Kt(`Cannot convert argument of type ${Y.$$.smartPtrType?Y.$$.smartPtrType.name:Y.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:ue=Y.$$.smartPtr;break;case 2:if(Y.$$.smartPtrType===this)ue=Y.$$.smartPtr;else{var Ve=Y.clone();ue=this.rawShare(ue,ii.toHandle(()=>Ve.delete())),X!==null&&X.push(this.rawDestructor,ue)}break;default:Kt("Unsupporting sharing policy")}return ue}function za(X,Y){if(Y===null)return this.isReference&&Kt(`null is not a valid ${this.name}`),0;Y.$$||Kt(`Cannot pass "${qa(Y)}" as a ${this.name}`),Y.$$.ptr||Kt(`Cannot pass deleted object as a pointer of type ${this.name}`),Y.$$.ptrType.isConst&&Kt(`Cannot convert argument of type ${Y.$$.ptrType.name} to parameter type ${this.name}`);var ue=Y.$$.ptrType.registeredClass,Se=hi(Y.$$.ptr,ue,this.registeredClass);return Se}var Ul=()=>{Object.assign(ri.prototype,{getPointee(X){return this.rawGetPointee&&(X=this.rawGetPointee(X)),X},destructor(X){this.rawDestructor?.(X)},argPackAdvance:Ot,readValueFromPointer:ze,fromWireType:br})};function ri(X,Y,ue,Se,Ve,Ze,it,Ke,ot,z,H){this.name=X,this.registeredClass=Y,this.isReference=ue,this.isConst=Se,this.isSmartPointer=Ve,this.pointeeType=Ze,this.sharingPolicy=it,this.rawGetPointee=Ke,this.rawConstructor=ot,this.rawShare=z,this.rawDestructor=H,!Ve&&Y.baseClass===void 0?Se?(this.toWireType=Nc,this.destructorFunction=null):(this.toWireType=za,this.destructorFunction=null):this.toWireType=Bo}var Ls=(X,Y,ue)=>{a.hasOwnProperty(X)||Fe("Replacing nonexistent public symbol"),a[X].overloadTable!==void 0&&ue!==void 0||(a[X]=Y,a[X].argCount=ue)},ha=(X,Y,ue)=>{X=X.replace(/p/g,"i");var Se=a["dynCall_"+X];return Se(Y,...ue)},gi=[],Ns,yo=X=>{var Y=gi[X];return Y||(X>=gi.length&&(gi.length=X+1),gi[X]=Y=Ns.get(X)),Y},ro=(X,Y,ue=[])=>{if(X.includes("j"))return ha(X,Y,ue);var Se=yo(Y)(...ue);return Se},ja=(X,Y)=>(...ue)=>ro(X,Y,ue),qr=(X,Y)=>{X=sn(X);function ue(){return X.includes("j")?ja(X,Y):yo(Y)}var Se=ue();return typeof Se!="function"&&Kt(`unknown function pointer with signature ${X}: ${Y}`),Se},Bl=(X,Y)=>{var ue=vo(Y,function(Se){this.name=Y,this.message=Se;var Ve=new Error(Se).stack;Ve!==void 0&&(this.stack=this.toString()+`
`+Ve.replace(/^Error(:[^\n]*)?\n/,""))});return ue.prototype=Object.create(X.prototype),ue.prototype.constructor=ue,ue.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},ue},io,Vc=X=>{var Y=je(X),ue=sn(Y);return Ye(Y),ue},Vs=(X,Y)=>{var ue=[],Se={};function Ve(Ze){if(!Se[Ze]&&!Je[Ze]){if(lt[Ze]){lt[Ze].forEach(Ve);return}ue.push(Ze),Se[Ze]=!0}}throw Y.forEach(Ve),new io(`${X}: `+ue.map(Vc).join([", "]))},Gl=(X,Y,ue,Se,Ve,Ze,it,Ke,ot,z,H,N,U)=>{H=sn(H),Ze=qr(Ve,Ze),Ke&&=qr(it,Ke),z&&=qr(ot,z),U=qr(N,U);var Z=Lc(H);fa(Z,function(){Vs(`Cannot construct ${H} due to unbound types`,[Se])}),nt([X,Y,ue],Se?[Se]:[],ce=>{ce=ce[0];var he,ye;Se?(he=ce.registeredClass,ye=he.instancePrototype):ye=yr.prototype;var xe=vo(H,function(...Ct){if(Object.getPrototypeOf(this)!==be)throw new bi("Use 'new' to construct "+H);if(Le.constructor_body===void 0)throw new bi(H+" has no accessible constructor");var Jt=Le.constructor_body[Ct.length];if(Jt===void 0)throw new bi(`Tried to invoke ctor of ${H} with invalid number of parameters (${Ct.length}) - expected (${Object.keys(Le.constructor_body).toString()}) parameters instead!`);return Jt.apply(this,Ct)}),be=Object.create(ye,{constructor:{value:xe}});xe.prototype=be;var Le=new Fl(H,xe,be,U,he,Ze,Ke,z);Le.baseClass&&(Le.baseClass.__derivedClasses??=[],Le.baseClass.__derivedClasses.push(Le));var Qe=new ri(H,Le,!0,!1,!1),at=new ri(H+"*",Le,!1,!1,!1),bt=new ri(H+" const*",Le,!1,!0,!1);return Wa[X]={pointerType:at,constPointerType:bt},Ls(Z,xe),[Qe,at,bt]})},kc=(X,Y)=>{for(var ue=[],Se=0;Se<X;Se++)ue.push(M[Y+Se*4>>2]);return ue};function Mi(X){for(var Y=1;Y<X.length;++Y)if(X[Y]!==null&&X[Y].destructorFunction===void 0)return!0;return!1}function Oi(X,Y){if(!(X instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof X} which is not a function`);var ue=vo(X.name||"unknownFunctionName",function(){});ue.prototype=X.prototype;var Se=new ue,Ve=X.apply(Se,Y);return Ve instanceof Object?Ve:Se}function Fc(X,Y,ue,Se){var Ve=Mi(X),Ze=X.length-2,it=[],Ke=["fn"];Y&&Ke.push("thisWired");for(var ot=0;ot<Ze;++ot)it.push(`arg${ot}`),Ke.push(`arg${ot}Wired`);it=it.join(","),Ke=Ke.join(",");var z=`return function (${it}) {
`;Ve&&(z+=`var destructors = [];
`);var H=Ve?"destructors":"null",N=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];Y&&(z+=`var thisWired = classParam['toWireType'](${H}, this);
`);for(var ot=0;ot<Ze;++ot)z+=`var arg${ot}Wired = argType${ot}['toWireType'](${H}, arg${ot});
`,N.push(`argType${ot}`);if(z+=(ue||Se?"var rv = ":"")+`invoker(${Ke});
`,Ve)z+=`runDestructors(destructors);
`;else for(var ot=Y?1:2;ot<X.length;++ot){var U=ot===1?"thisWired":"arg"+(ot-2)+"Wired";X[ot].destructorFunction!==null&&(z+=`${U}_dtor(${U});
`,N.push(`${U}_dtor`))}return ue&&(z+=`var ret = retType['fromWireType'](rv);
return ret;
`),z+=`}
`,[N,z]}function kr(X,Y,ue,Se,Ve,Ze){var it=Y.length;it<2&&Kt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Ke=Y[1]!==null&&ue!==null,ot=Mi(Y),z=Y[0].name!=="void",H=[X,Kt,Se,Ve,Ee,Y[0],Y[1]],N=0;N<it-2;++N)H.push(Y[N+2]);if(!ot)for(var N=Ke?1:2;N<Y.length;++N)Y[N].destructorFunction!==null&&H.push(Y[N].destructorFunction);let[U,Z]=Fc(Y,Ke,z,Ze);U.push(Z);var ce=Oi(Function,U)(...H);return vo(X,ce)}var Uc=(X,Y,ue,Se,Ve,Ze)=>{var it=kc(Y,ue);Ve=qr(Se,Ve),nt([],[X],Ke=>{Ke=Ke[0];var ot=`constructor ${Ke.name}`;if(Ke.registeredClass.constructor_body===void 0&&(Ke.registeredClass.constructor_body=[]),Ke.registeredClass.constructor_body[Y-1]!==void 0)throw new bi(`Cannot register multiple constructors with identical number of parameters (${Y-1}) for class '${Ke.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return Ke.registeredClass.constructor_body[Y-1]=()=>{Vs(`Cannot construct ${Ke.name} due to unbound types`,it)},nt([],it,z=>(z.splice(1,0,null),Ke.registeredClass.constructor_body[Y-1]=kr(ot,z,null,Ve,Ze),[])),[]})},ks=X=>{X=X.trim();const Y=X.indexOf("(");return Y!==-1?X.substr(0,Y):X},Ha=(X,Y,ue,Se,Ve,Ze,it,Ke,ot,z)=>{var H=kc(ue,Se);Y=sn(Y),Y=ks(Y),Ze=qr(Ve,Ze),nt([],[X],N=>{N=N[0];var U=`${N.name}.${Y}`;Y.startsWith("@@")&&(Y=Symbol[Y.substring(2)]),Ke&&N.registeredClass.pureVirtualFunctions.push(Y);function Z(){Vs(`Cannot call ${U} due to unbound types`,H)}var ce=N.registeredClass.instancePrototype,he=ce[Y];return he===void 0||he.overloadTable===void 0&&he.className!==N.name&&he.argCount===ue-2?(Z.argCount=ue-2,Z.className=N.name,ce[Y]=Z):(Uo(ce,Y,U),ce[Y].overloadTable[ue-2]=Z),nt([],H,ye=>{var xe=kr(U,ye,N,Ze,it,ot);return ce[Y].overloadTable===void 0?(xe.argCount=ue-2,ce[Y]=xe):ce[Y].overloadTable[ue-2]=xe,[]}),[]})},ur=[],ji=[],Ka=X=>{X>9&&--ji[X+1]===0&&(ji[X]=void 0,ur.push(X))},Yr=()=>ji.length/2-5-ur.length,Bc=()=>{ji.push(0,1,void 0,1,null,1,!0,1,!1,1),a.count_emval_handles=Yr},ii={toValue:X=>(X||Kt("Cannot use deleted val. handle = "+X),ji[X]),toHandle:X=>{switch(X){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const Y=ur.pop()||ji.length;return ji[Y]=X,ji[Y+1]=1,Y}}}},pi={name:"emscripten::val",fromWireType:X=>{var Y=ii.toValue(X);return Ka(X),Y},toWireType:(X,Y)=>ii.toHandle(Y),argPackAdvance:Ot,readValueFromPointer:ze,destructorFunction:null},Xa=X=>rt(X,pi),qa=X=>{if(X===null)return"null";var Y=typeof X;return Y==="object"||Y==="array"||Y==="function"?X.toString():""+X},Wl=(X,Y)=>{switch(Y){case 4:return function(ue){return this.fromWireType(R[ue>>2])};case 8:return function(ue){return this.fromWireType(A[ue>>3])};default:throw new TypeError(`invalid float width (${Y}): ${X}`)}},Ya=(X,Y,ue)=>{Y=sn(Y),rt(X,{name:Y,fromWireType:Se=>Se,toWireType:(Se,Ve)=>Ve,argPackAdvance:Ot,readValueFromPointer:Wl(Y,ue),destructorFunction:null})},Qn=(X,Y,ue)=>{switch(Y){case 1:return ue?Se=>E[Se]:Se=>D[Se];case 2:return ue?Se=>b[Se>>1]:Se=>I[Se>>1];case 4:return ue?Se=>O[Se>>2]:Se=>M[Se>>2];default:throw new TypeError(`invalid integer width (${Y}): ${X}`)}},Fs=(X,Y,ue,Se,Ve)=>{Y=sn(Y);var Ze=H=>H;if(Se===0){var it=32-8*ue;Ze=H=>H<<it>>>it}var Ke=Y.includes("unsigned"),ot=(H,N)=>{},z;Ke?z=function(H,N){return ot(N,this.name),N>>>0}:z=function(H,N){return ot(N,this.name),N},rt(X,{name:Y,fromWireType:Ze,toWireType:z,argPackAdvance:Ot,readValueFromPointer:Qn(Y,ue,Se!==0),destructorFunction:null})},Ja=(X,Y,ue)=>{var Se=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ve=Se[Y];function Ze(it){var Ke=M[it>>2],ot=M[it+4>>2];return new Ve(E.buffer,ot,Ke)}ue=sn(ue),rt(X,{name:ue,fromWireType:Ze,argPackAdvance:Ot,readValueFromPointer:Ze},{ignoreDuplicateRegistrations:!0})},Fr=(X,Y,ue,Se)=>{if(!(Se>0))return 0;for(var Ve=ue,Ze=ue+Se-1,it=0;it<X.length;++it){var Ke=X.charCodeAt(it);if(Ke>=55296&&Ke<=57343){var ot=X.charCodeAt(++it);Ke=65536+((Ke&1023)<<10)|ot&1023}if(Ke<=127){if(ue>=Ze)break;Y[ue++]=Ke}else if(Ke<=2047){if(ue+1>=Ze)break;Y[ue++]=192|Ke>>6,Y[ue++]=128|Ke&63}else if(Ke<=65535){if(ue+2>=Ze)break;Y[ue++]=224|Ke>>12,Y[ue++]=128|Ke>>6&63,Y[ue++]=128|Ke&63}else{if(ue+3>=Ze)break;Y[ue++]=240|Ke>>18,Y[ue++]=128|Ke>>12&63,Y[ue++]=128|Ke>>6&63,Y[ue++]=128|Ke&63}}return Y[ue]=0,ue-Ve},Us=(X,Y,ue)=>Fr(X,D,Y,ue),mi=X=>{for(var Y=0,ue=0;ue<X.length;++ue){var Se=X.charCodeAt(ue);Se<=127?Y++:Se<=2047?Y+=2:Se>=55296&&Se<=57343?(Y+=4,++ue):Y+=3}return Y},Gc=typeof TextDecoder<"u"?new TextDecoder:void 0,Go=(X,Y=0,ue=NaN)=>{for(var Se=Y+ue,Ve=Y;X[Ve]&&!(Ve>=Se);)++Ve;if(Ve-Y>16&&X.buffer&&Gc)return Gc.decode(X.subarray(Y,Ve));for(var Ze="";Y<Ve;){var it=X[Y++];if(!(it&128)){Ze+=String.fromCharCode(it);continue}var Ke=X[Y++]&63;if((it&224)==192){Ze+=String.fromCharCode((it&31)<<6|Ke);continue}var ot=X[Y++]&63;if((it&240)==224?it=(it&15)<<12|Ke<<6|ot:it=(it&7)<<18|Ke<<12|ot<<6|X[Y++]&63,it<65536)Ze+=String.fromCharCode(it);else{var z=it-65536;Ze+=String.fromCharCode(55296|z>>10,56320|z&1023)}}return Ze},Hi=(X,Y)=>X?Go(D,X,Y):"",$l=(X,Y)=>{Y=sn(Y),rt(X,{name:Y,fromWireType(ue){for(var Se=M[ue>>2],Ve=ue+4,Ze,it,Ke=Ve,it=0;it<=Se;++it){var ot=Ve+it;if(it==Se||D[ot]==0){var z=ot-Ke,H=Hi(Ke,z);Ze===void 0?Ze=H:(Ze+="\0",Ze+=H),Ke=ot+1}}return Ye(ue),Ze},toWireType(ue,Se){Se instanceof ArrayBuffer&&(Se=new Uint8Array(Se));var Ve,Ze=typeof Se=="string";Ze||Se instanceof Uint8Array||Se instanceof Uint8ClampedArray||Se instanceof Int8Array||Kt("Cannot pass non-string to std::string"),Ze?Ve=mi(Se):Ve=Se.length;var it=tt(4+Ve+1),Ke=it+4;if(M[it>>2]=Ve,Ze)Us(Se,Ke,Ve+1);else if(Ze)for(var ot=0;ot<Ve;++ot){var z=Se.charCodeAt(ot);z>255&&(Ye(Ke),Kt("String has UTF-16 code units that do not fit in 8 bits")),D[Ke+ot]=z}else for(var ot=0;ot<Ve;++ot)D[Ke+ot]=Se[ot];return ue!==null&&ue.push(Ye,it),it},argPackAdvance:Ot,readValueFromPointer:ze,destructorFunction(ue){Ye(ue)}})},Wo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,vi=(X,Y)=>{for(var ue=X,Se=ue>>1,Ve=Se+Y/2;!(Se>=Ve)&&I[Se];)++Se;if(ue=Se<<1,ue-X>32&&Wo)return Wo.decode(D.subarray(X,ue));for(var Ze="",it=0;!(it>=Y/2);++it){var Ke=b[X+it*2>>1];if(Ke==0)break;Ze+=String.fromCharCode(Ke)}return Ze},Wc=(X,Y,ue)=>{if(ue??=2147483647,ue<2)return 0;ue-=2;for(var Se=Y,Ve=ue<X.length*2?ue/2:X.length,Ze=0;Ze<Ve;++Ze){var it=X.charCodeAt(Ze);b[Y>>1]=it,Y+=2}return b[Y>>1]=0,Y-Se},zl=X=>X.length*2,jl=(X,Y)=>{for(var ue=0,Se="";!(ue>=Y/4);){var Ve=O[X+ue*4>>2];if(Ve==0)break;if(++ue,Ve>=65536){var Ze=Ve-65536;Se+=String.fromCharCode(55296|Ze>>10,56320|Ze&1023)}else Se+=String.fromCharCode(Ve)}return Se},$c=(X,Y,ue)=>{if(ue??=2147483647,ue<4)return 0;for(var Se=Y,Ve=Se+ue-4,Ze=0;Ze<X.length;++Ze){var it=X.charCodeAt(Ze);if(it>=55296&&it<=57343){var Ke=X.charCodeAt(++Ze);it=65536+((it&1023)<<10)|Ke&1023}if(O[Y>>2]=it,Y+=4,Y+4>Ve)break}return O[Y>>2]=0,Y-Se},Za=X=>{for(var Y=0,ue=0;ue<X.length;++ue){var Se=X.charCodeAt(ue);Se>=55296&&Se<=57343&&++ue,Y+=4}return Y},zc=(X,Y,ue)=>{ue=sn(ue);var Se,Ve,Ze,it;Y===2?(Se=vi,Ve=Wc,it=zl,Ze=Ke=>I[Ke>>1]):Y===4&&(Se=jl,Ve=$c,it=Za,Ze=Ke=>M[Ke>>2]),rt(X,{name:ue,fromWireType:Ke=>{for(var ot=M[Ke>>2],z,H=Ke+4,N=0;N<=ot;++N){var U=Ke+4+N*Y;if(N==ot||Ze(U)==0){var Z=U-H,ce=Se(H,Z);z===void 0?z=ce:(z+="\0",z+=ce),H=U+Y}}return Ye(Ke),z},toWireType:(Ke,ot)=>{typeof ot!="string"&&Kt(`Cannot pass non-string to C++ string type ${ue}`);var z=it(ot),H=tt(4+z+Y);return M[H>>2]=z/Y,Ve(ot,H+4,z+Y),Ke!==null&&Ke.push(Ye,H),H},argPackAdvance:Ot,readValueFromPointer:ze,destructorFunction(Ke){Ye(Ke)}})},Bs=(X,Y,ue,Se,Ve,Ze)=>{ct[X]={name:sn(Y),rawConstructor:qr(ue,Se),rawDestructor:qr(Ve,Ze),fields:[]}},Hl=(X,Y,ue,Se,Ve,Ze,it,Ke,ot,z)=>{ct[X].fields.push({fieldName:sn(Y),getterReturnType:ue,getter:qr(Se,Ve),getterContext:Ze,setterArgumentType:it,setter:qr(Ke,ot),setterContext:z})},Kl=(X,Y)=>{Y=sn(Y),rt(X,{isVoid:!0,name:Y,argPackAdvance:0,fromWireType:()=>{},toWireType:(ue,Se)=>{}})},Xl=(X,Y,ue)=>D.copyWithin(X,Y,Y+ue),Gs=[],ql=(X,Y,ue,Se)=>(X=Gs[X],Y=ii.toValue(Y),X(null,Y,ue,Se)),Yl={},Jl=X=>{var Y=Yl[X];return Y===void 0?sn(X):Y},Ws=()=>typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")(),Zl=X=>X===0?ii.toHandle(Ws()):(X=Jl(X),ii.toHandle(Ws()[X])),jc=X=>{var Y=Gs.length;return Gs.push(X),Y},Hc=(X,Y)=>{var ue=Je[X];return ue===void 0&&Kt(`${Y} has unknown type ${Vc(X)}`),ue},Ql=(X,Y)=>{for(var ue=new Array(X),Se=0;Se<X;++Se)ue[Se]=Hc(M[Y+Se*4>>2],"parameter "+Se);return ue},$s=(X,Y,ue)=>{var Se=[],Ve=X.toWireType(Se,ue);return Se.length&&(M[Y>>2]=ii.toHandle(Se)),Ve},eu=(X,Y,ue)=>{var Se=Ql(X,Y),Ve=Se.shift();X--;var Ze=`return function (obj, func, destructorsRef, args) {
`,it=0,Ke=[];ue===0&&Ke.push("obj");for(var ot=["retType"],z=[Ve],H=0;H<X;++H)Ke.push("arg"+H),ot.push("argType"+H),z.push(Se[H]),Ze+=`  var arg${H} = argType${H}.readValueFromPointer(args${it?"+"+it:""});
`,it+=Se[H].argPackAdvance;var N=ue===1?"new func":"func.call";Ze+=`  var rv = ${N}(${Ke.join(", ")});
`,Ve.isVoid||(ot.push("emval_returnValue"),z.push($s),Ze+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Ze+=`};
`,ot.push(Ze);var U=Oi(Function,ot)(...z),Z=`methodCaller<(${Se.map(ce=>ce.name).join(", ")}) => ${Ve.name}>`;return jc(vo(Z,U))},Kc=X=>{var Y=ii.toValue(X);Ee(Y),Ka(X)},Xc=(X,Y)=>{X=Hc(X,"_emval_take_value");var ue=X.readValueFromPointer(Y);return ii.toHandle(ue)},qc=()=>2147483648,Yc=()=>qc(),tu=(X,Y)=>Math.ceil(X/Y)*Y,nu=X=>{var Y=S.buffer,ue=(X-Y.byteLength+65535)/65536|0;try{return S.grow(ue),B(),1}catch{}},ru=X=>{var Y=D.length;X>>>=0;var ue=qc();if(X>ue)return!1;for(var Se=1;Se<=4;Se*=2){var Ve=Y*(1+.2/Se);Ve=Math.min(Ve,X+100663296);var Ze=Math.min(ue,tu(Math.max(X,Ve),65536)),it=nu(Ze);if(it)return!0}return!1},zs={},iu=()=>g||"./this.program",ga=()=>{if(!ga.strings){var X=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",Y={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:X,_:iu()};for(var ue in zs)zs[ue]===void 0?delete Y[ue]:Y[ue]=zs[ue];var Se=[];for(var ue in Y)Se.push(`${ue}=${Y[ue]}`);ga.strings=Se}return ga.strings},ou=(X,Y)=>{for(var ue=0;ue<X.length;++ue)E[Y++]=X.charCodeAt(ue);E[Y]=0},js=(X,Y)=>{var ue=0;return ga().forEach((Se,Ve)=>{var Ze=Y+ue;M[X+Ve*4>>2]=Ze,ou(Se,Ze),ue+=Se.length+1}),0},Hs=(X,Y)=>{var ue=ga();M[X>>2]=ue.length;var Se=0;return ue.forEach(Ve=>Se+=Ve.length+1),M[Y>>2]=Se,0},$o=X=>52;function Ki(X,Y,ue,Se,Ve){return 70}var Jc=[null,[],[]],Zc=(X,Y)=>{var ue=Jc[X];Y===0||Y===10?((X===1?C:x)(Go(ue)),ue.length=0):ue.push(Y)},Ks=(X,Y,ue,Se)=>{for(var Ve=0,Ze=0;Ze<ue;Ze++){var it=M[Y>>2],Ke=M[Y+4>>2];Y+=8;for(var ot=0;ot<Ke;ot++)Zc(X,D[it+ot]);Ve+=Ke}return M[Se>>2]=Ve,0},Qc=X=>{var Y=a["_"+X];return Y},Qa=(X,Y)=>{E.set(X,Y)},Xs=X=>et(X),te=X=>{var Y=mi(X)+1,ue=Xs(Y);return Us(X,ue,Y),ue},ne=(X,Y,ue,Se,Ve)=>{var Ze={string:ce=>{var he=0;return ce!=null&&ce!==0&&(he=te(ce)),he},array:ce=>{var he=Xs(ce.length);return Qa(ce,he),he}};function it(ce){return Y==="string"?Hi(ce):Y==="boolean"?!!ce:ce}var Ke=Qc(X),ot=[],z=0;if(Se)for(var H=0;H<Se.length;H++){var N=Ze[ue[H]];N?(z===0&&(z=pe()),ot[H]=N(Se[H])):ot[H]=Se[H]}var U=Ke(...ot);function Z(ce){return z!==0&&le(z),it(ce)}return U=Z(U),U};Pe=a.InternalError=class extends Error{constructor(Y){super(Y),this.name="InternalError"}},bn(),bi=a.BindingError=class extends Error{constructor(Y){super(Y),this.name="BindingError"}},Cn(),Ul(),io=a.UnboundTypeError=Bl(Error,"UnboundTypeError"),Bc();var me={A:st,p:gt,e:wt,o:yn,y:Tn,m:Gl,l:Uc,b:Ha,w:Xa,i:Ya,d:Fs,a:Ja,x:$l,g:zc,f:Bs,c:Hl,z:Kl,v:Xl,C:ql,D:Ka,E:Zl,j:eu,B:Kc,k:Xc,r:Yc,q:ru,s:js,t:Hs,u:$o,n:Ki,h:Ks},Re;se();var je=X=>(je=Re.H)(X),tt=X=>(tt=Re.J)(X),Ye=X=>(Ye=Re.K)(X),He=X=>(He=Re.L)(X),et=X=>(et=Re.M)(X),dt=()=>(dt=Re.N)();a.dynCall_iji=(X,Y,ue,Se)=>(a.dynCall_iji=Re.O)(X,Y,ue,Se),a.dynCall_jji=(X,Y,ue,Se)=>(a.dynCall_jji=Re.P)(X,Y,ue,Se),a.dynCall_iiji=(X,Y,ue,Se,Ve)=>(a.dynCall_iiji=Re.Q)(X,Y,ue,Se,Ve),a.dynCall_jiji=(X,Y,ue,Se,Ve)=>(a.dynCall_jiji=Re.R)(X,Y,ue,Se,Ve),a.ccall=ne;var It;_e=function X(){It||Lt(),It||(_e=X)};function Lt(){if(we>0||(j(),we>0))return;function X(){It||(It=!0,a.calledRun=!0,!_&&(J(),s(a),a.onRuntimeInitialized?.(),ie()))}a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),X()},1)):X()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Lt(),o=l,o})})();t.exports=r,t.exports.default=r})(Uy)),Uy.exports}var Ave=Rve();const Lve=ka(Ave),Nve=new URL(""+new URL("openjpegwasm_decode-B3gWTHpv.wasm",import.meta.url).href,import.meta.url),Vd={codec:void 0,decoder:void 0,decodeConfig:{}};function Vve(t){if(Vd.decodeConfig=t,Vd.codec)return Promise.resolve();const e=Lve({locateFile:r=>r.endsWith(".wasm")?Nve.toString():r});return new Promise((r,n)=>{e.then(i=>{Vd.codec=i,Vd.decoder=new i.J2KDecoder,r()},n)})}async function ab(t,e){await Vve();const r=Vd.decoder,n=r.getEncodedBuffer(t.length);n.set(t),r.decode();const i=r.getFrameInfo(),o=r.getDecodedBuffer();new Uint8Array(o.length).set(o);const s=`x: ${r.getImageOffset().x}, y: ${r.getImageOffset().y}`,c=r.getNumDecompositions(),l=r.getNumLayers(),f=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][r.getProgressionOrder()+1],u=r.getIsReversible(),d=`${r.getBlockDimensions().width} x ${r.getBlockDimensions().height}`,h=`${r.getTileSize().width} x ${r.getTileSize().height}`,g=`${r.getTileOffset().x}, ${r.getTileOffset().y}`,p=r.getColorSpace(),m=`${o.length.toLocaleString()} bytes`,w=`${(o.length/n.length).toFixed(2)}:1`,v={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:i.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},y=kve(i,o),C={imageOffset:s,numDecompositions:c,numLayers:l,progessionOrder:f,reversible:u,blockDimensions:d,tileSize:h,tileOffset:g,colorTransform:p,decodedSize:m,compressionRatio:w};return{...e,pixelData:y,imageInfo:v,encodeOptions:C,...C,...v}}function kve(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var By={exports:{}},sb;function Fve(){return sb||(sb=1,(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(o){o=o||{};var o=typeof o<"u"?o:{},a,s;o.ready=new Promise(function(z,H){a=z,s=H});var c=Object.assign({},o),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",d="";function h(z){return o.locateFile?o.locateFile(z,d):d+z}var g,p,m;if(u){var w=wc,v=wc;f?d=v.dirname(d)+"/":d=__dirname+"/",g=(z,H)=>(z=se(z)?new URL(z):v.normalize(z),w.readFileSync(z,H?void 0:"utf8")),m=z=>{var H=g(z,!0);return H.buffer||(H=new Uint8Array(H)),H},p=(z,H,N)=>{z=se(z)?new URL(z):v.normalize(z),w.readFile(z,function(U,Z){U?N(U):H(Z.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(z){if(!(z instanceof oe))throw z}),process.on("unhandledRejection",function(z){throw z}),o.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),n&&(d=n),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",g=z=>{var H=new XMLHttpRequest;return H.open("GET",z,!1),H.send(null),H.responseText},f&&(m=z=>{var H=new XMLHttpRequest;return H.open("GET",z,!1),H.responseType="arraybuffer",H.send(null),new Uint8Array(H.response)}),p=(z,H,N)=>{var U=new XMLHttpRequest;U.open("GET",z,!0),U.responseType="arraybuffer",U.onload=()=>{if(U.status==200||U.status==0&&U.response){H(U.response);return}N()},U.onerror=N,U.send(null)});var y=o.print||console.log.bind(console),C=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit;var x;o.wasmBinary&&(x=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&Ne("no native wasm support detected");var T,S=!1;function _(z,H){z||Ne(H)}var E=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function D(z,H,N){for(var U=H+N,Z=H;z[Z]&&!(Z>=U);)++Z;if(Z-H>16&&z.buffer&&E)return E.decode(z.subarray(H,Z));for(var ce="";H<Z;){var he=z[H++];if(!(he&128)){ce+=String.fromCharCode(he);continue}var ye=z[H++]&63;if((he&224)==192){ce+=String.fromCharCode((he&31)<<6|ye);continue}var xe=z[H++]&63;if((he&240)==224?he=(he&15)<<12|ye<<6|xe:he=(he&7)<<18|ye<<12|xe<<6|z[H++]&63,he<65536)ce+=String.fromCharCode(he);else{var be=he-65536;ce+=String.fromCharCode(55296|be>>10,56320|be&1023)}}return ce}function b(z,H){return z?D(B,z,H):""}function I(z,H,N,U){if(!(U>0))return 0;for(var Z=N,ce=N+U-1,he=0;he<z.length;++he){var ye=z.charCodeAt(he);if(ye>=55296&&ye<=57343){var xe=z.charCodeAt(++he);ye=65536+((ye&1023)<<10)|xe&1023}if(ye<=127){if(N>=ce)break;H[N++]=ye}else if(ye<=2047){if(N+1>=ce)break;H[N++]=192|ye>>6,H[N++]=128|ye&63}else if(ye<=65535){if(N+2>=ce)break;H[N++]=224|ye>>12,H[N++]=128|ye>>6&63,H[N++]=128|ye&63}else{if(N+3>=ce)break;H[N++]=240|ye>>18,H[N++]=128|ye>>12&63,H[N++]=128|ye>>6&63,H[N++]=128|ye&63}}return H[N]=0,N-Z}function O(z,H,N){return I(z,B,H,N)}function M(z){for(var H=0,N=0;N<z.length;++N){var U=z.charCodeAt(N);U<=127?H++:U<=2047?H+=2:U>=55296&&U<=57343?(H+=4,++N):H+=3}return H}var R,A,B,k,L,F,j,J,ie;function fe(z){R=z,o.HEAP8=A=new Int8Array(z),o.HEAP16=k=new Int16Array(z),o.HEAP32=F=new Int32Array(z),o.HEAPU8=B=new Uint8Array(z),o.HEAPU16=L=new Uint16Array(z),o.HEAPU32=j=new Uint32Array(z),o.HEAPF32=J=new Float32Array(z),o.HEAPF64=ie=new Float64Array(z)}o.INITIAL_MEMORY;var ae,de=[],we=[],_e=[];function Te(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)$(o.preRun.shift());st(de)}function G(){st(we)}function P(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)q(o.postRun.shift());st(_e)}function $(z){de.unshift(z)}function W(z){we.unshift(z)}function q(z){_e.unshift(z)}var Q=0,ee=null;function ge(z){Q++,o.monitorRunDependencies&&o.monitorRunDependencies(Q)}function De(z){if(Q--,o.monitorRunDependencies&&o.monitorRunDependencies(Q),Q==0&&ee){var H=ee;ee=null,H()}}function Ne(z){o.onAbort&&o.onAbort(z),z="Aborted("+z+")",C(z),S=!0,z+=". Build with -sASSERTIONS for more info.";var H=new WebAssembly.RuntimeError(z);throw s(H),H}var We="data:application/octet-stream;base64,";function re(z){return z.startsWith(We)}function se(z){return z.startsWith("file://")}var ve;ve="openjphjs.wasm",re(ve)||(ve=h(ve));function le(z){try{if(z==ve&&x)return new Uint8Array(x);if(m)return m(z);throw"both async and sync fetching of the wasm failed"}catch(H){Ne(H)}}function pe(){if(!x&&(l||f)){if(typeof fetch=="function"&&!se(ve))return fetch(ve,{credentials:"same-origin"}).then(function(z){if(!z.ok)throw"failed to load wasm binary file at '"+ve+"'";return z.arrayBuffer()}).catch(function(){return le(ve)});if(p)return new Promise(function(z,H){p(ve,function(N){z(new Uint8Array(N))},H)})}return Promise.resolve().then(function(){return le(ve)})}function $e(){var z={env:te,wasi_snapshot_preview1:te};function H(he,ye){var xe=he.exports;o.asm=xe,T=o.asm.memory,fe(T.buffer),ae=o.asm.__indirect_function_table,W(o.asm.__wasm_call_ctors),De()}ge();function N(he){H(he.instance)}function U(he){return pe().then(function(ye){return WebAssembly.instantiate(ye,z)}).then(function(ye){return ye}).then(he,function(ye){C("failed to asynchronously prepare wasm: "+ye),Ne(ye)})}function Z(){return!x&&typeof WebAssembly.instantiateStreaming=="function"&&!re(ve)&&!se(ve)&&!u&&typeof fetch=="function"?fetch(ve,{credentials:"same-origin"}).then(function(he){var ye=WebAssembly.instantiateStreaming(he,z);return ye.then(N,function(xe){return C("wasm streaming compile failed: "+xe),C("falling back to ArrayBuffer instantiation"),U(N)})}):U(N)}if(o.instantiateWasm)try{var ce=o.instantiateWasm(z,H);return ce}catch(he){C("Module.instantiateWasm callback failed with error: "+he),s(he)}return Z().catch(s),{}}function oe(z){this.name="ExitStatus",this.message="Program terminated with exit("+z+")",this.status=z}function st(z){for(;z.length>0;)z.shift()(o)}function gt(z,H,N,U){Ne("Assertion failed: "+b(z)+", at: "+[H?b(H):"unknown filename",N,U?b(U):"unknown function"])}var ct=[];function Ee(z){z.add_ref()}function ze(z){var H=new nt(z);return H.get_caught()||H.set_caught(!0),H.set_rethrown(!1),ct.push(H),Ee(H),H.get_exception_ptr()}var qe=0,Je=[];function lt(z){var H=Je[z];return H||(z>=Je.length&&(Je.length=z+1),Je[z]=H=ae.get(z)),H}function Pe(z){if(z.release_ref()&&!z.get_rethrown()){var H=z.get_destructor();H&&lt(H)(z.excPtr),Re(z.excPtr)}}function Fe(){_setThrew(0);var z=ct.pop();Pe(z),qe=0}function nt(z){this.excPtr=z,this.ptr=z-24,this.set_type=function(H){j[this.ptr+4>>2]=H},this.get_type=function(){return j[this.ptr+4>>2]},this.set_destructor=function(H){j[this.ptr+8>>2]=H},this.get_destructor=function(){return j[this.ptr+8>>2]},this.set_refcount=function(H){F[this.ptr>>2]=H},this.set_caught=function(H){H=H?1:0,A[this.ptr+12>>0]=H},this.get_caught=function(){return A[this.ptr+12>>0]!=0},this.set_rethrown=function(H){H=H?1:0,A[this.ptr+13>>0]=H},this.get_rethrown=function(){return A[this.ptr+13>>0]!=0},this.init=function(H,N){this.set_adjusted_ptr(0),this.set_type(H),this.set_destructor(N),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var H=F[this.ptr>>2];F[this.ptr>>2]=H+1},this.release_ref=function(){var H=F[this.ptr>>2];return F[this.ptr>>2]=H-1,H===1},this.set_adjusted_ptr=function(H){j[this.ptr+16>>2]=H},this.get_adjusted_ptr=function(){return j[this.ptr+16>>2]},this.get_exception_ptr=function(){var H=It(this.get_type());if(H)return j[this.excPtr>>2];var N=this.get_adjusted_ptr();return N!==0?N:this.excPtr}}function wt(z){throw qe||(qe=z),z}function yn(){var z=qe;if(!z)return tt(0),0;var H=new nt(z);H.set_adjusted_ptr(z);var N=H.get_type();if(!N)return tt(0),z;for(var U=0;U<arguments.length;U++){var Z=arguments[U];if(Z===0||Z===N)break;var ce=H.ptr+16;if(dt(Z,N,ce))return tt(Z),z}return tt(N),z}function bn(){var z=qe;if(!z)return tt(0),0;var H=new nt(z);H.set_adjusted_ptr(z);var N=H.get_type();if(!N)return tt(0),z;for(var U=0;U<arguments.length;U++){var Z=arguments[U];if(Z===0||Z===N)break;var ce=H.ptr+16;if(dt(Z,N,ce))return tt(Z),z}return tt(N),z}function fn(z,H,N){var U=new nt(z);throw U.init(H,N),qe=z,z}var sn={};function bi(z){for(;z.length;){var H=z.pop(),N=z.pop();N(H)}}function Kt(z){return this.fromWireType(F[z>>2])}var Be={},rt={},Ot={},Tn=48,Di=57;function rn(z){if(z===void 0)return"_unknown";z=z.replace(/[^a-zA-Z0-9_]/g,"$");var H=z.charCodeAt(0);return H>=Tn&&H<=Di?"_"+z:z}function Nn(z,H){return z=rn(z),new Function("body","return function "+z+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(H)}function zi(z,H){var N=Nn(H,function(U){this.name=H,this.message=U;var Z=new Error(U).stack;Z!==void 0&&(this.stack=this.toString()+`
`+Z.replace(/^Error(:[^\n]*)?\n/,""))});return N.prototype=Object.create(z.prototype),N.prototype.constructor=N,N.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},N}var wn=void 0;function Xr(z){throw new wn(z)}function Ii(z,H,N){z.forEach(function(ye){Ot[ye]=H});function U(ye){var xe=N(ye);xe.length!==z.length&&Xr("Mismatched type converter count");for(var be=0;be<z.length;++be)yr(z[be],xe[be])}var Z=new Array(H.length),ce=[],he=0;H.forEach((ye,xe)=>{rt.hasOwnProperty(ye)?Z[xe]=rt[ye]:(ce.push(ye),Be.hasOwnProperty(ye)||(Be[ye]=[]),Be[ye].push(()=>{Z[xe]=rt[ye],++he,he===ce.length&&U(Z)}))}),ce.length===0&&U(Z)}function Wa(z){var H=sn[z];delete sn[z];var N=H.rawConstructor,U=H.rawDestructor,Z=H.fields,ce=Z.map(he=>he.getterReturnType).concat(Z.map(he=>he.setterArgumentType));Ii([z],ce,he=>{var ye={};return Z.forEach((xe,be)=>{var Le=xe.fieldName,Qe=he[be],at=xe.getter,bt=xe.getterContext,Ct=he[be+Z.length],Jt=xe.setter,Xt=xe.setterContext;ye[Le]={read:Vn=>Qe.fromWireType(at(bt,Vn)),write:(Vn,Pr)=>{var Ur=[];Jt(Xt,Vn,Ct.toWireType(Ur,Pr)),bi(Ur)}}}),[{name:H.name,fromWireType:function(xe){var be={};for(var Le in ye)be[Le]=ye[Le].read(xe);return U(xe),be},toWireType:function(xe,be){for(var Le in ye)if(!(Le in be))throw new TypeError('Missing field:  "'+Le+'"');var Qe=N();for(Le in ye)ye[Le].write(Qe,be[Le]);return xe!==null&&xe.push(U,Qe),Qe},argPackAdvance:8,readValueFromPointer:Kt,destructorFunction:U}]})}function Ac(z,H,N,U,Z){}function ua(z){switch(z){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+z)}}function $a(){for(var z=new Array(256),H=0;H<256;++H)z[H]=String.fromCharCode(H);mo=z}var mo=void 0;function br(z){for(var H="",N=z;B[N];)H+=mo[B[N++]];return H}var fi=void 0;function Cn(z){throw new fi(z)}function yr(z,H,N={}){if(!("argPackAdvance"in H))throw new TypeError("registerType registeredInstance requires argPackAdvance");var U=H.name;if(z||Cn('type "'+U+'" must have a positive integer typeid pointer'),rt.hasOwnProperty(z)){if(N.ignoreDuplicateRegistrations)return;Cn("Cannot register type '"+U+"' twice")}if(rt[z]=H,delete Ot[z],Be.hasOwnProperty(z)){var Z=Be[z];delete Be[z],Z.forEach(ce=>ce())}}function vo(z,H,N,U,Z){var ce=ua(N);H=br(H),yr(z,{name:H,fromWireType:function(he){return!!he},toWireType:function(he,ye){return ye?U:Z},argPackAdvance:8,readValueFromPointer:function(he){var ye;if(N===1)ye=A;else if(N===2)ye=k;else if(N===4)ye=F;else throw new TypeError("Unknown boolean type size: "+H);return this.fromWireType(ye[he>>ce])},destructorFunction:null})}function Uo(z){if(!(this instanceof Oi)||!(z instanceof Oi))return!1;for(var H=this.$$.ptrType.registeredClass,N=this.$$.ptr,U=z.$$.ptrType.registeredClass,Z=z.$$.ptr;H.baseClass;)N=H.upcast(N),H=H.baseClass;for(;U.baseClass;)Z=U.upcast(Z),U=U.baseClass;return H===U&&N===Z}function fa(z){return{count:z.count,deleteScheduled:z.deleteScheduled,preservePointerOnDelete:z.preservePointerOnDelete,ptr:z.ptr,ptrType:z.ptrType,smartPtr:z.smartPtr,smartPtrType:z.smartPtrType}}function da(z){function H(N){return N.$$.ptrType.registeredClass.name}Cn(H(z)+" instance already deleted")}var di=!1;function Lc(z){}function Fl(z){z.smartPtr?z.smartPtrType.rawDestructor(z.smartPtr):z.ptrType.registeredClass.rawDestructor(z.ptr)}function hi(z){z.count.value-=1;var H=z.count.value===0;H&&Fl(z)}function Nc(z,H,N){if(H===N)return z;if(N.baseClass===void 0)return null;var U=Nc(z,H,N.baseClass);return U===null?null:N.downcast(U)}var Bo={};function za(){return Object.keys(yo).length}function Ul(){var z=[];for(var H in yo)yo.hasOwnProperty(H)&&z.push(yo[H]);return z}var ri=[];function Ls(){for(;ri.length;){var z=ri.pop();z.$$.deleteScheduled=!1,z.delete()}}var ha=void 0;function gi(z){ha=z,ri.length&&ha&&ha(Ls)}function Ns(){o.getInheritedInstanceCount=za,o.getLiveInheritedInstances=Ul,o.flushPendingDeletes=Ls,o.setDelayFunction=gi}var yo={};function ro(z,H){for(H===void 0&&Cn("ptr should not be undefined");z.baseClass;)H=z.upcast(H),z=z.baseClass;return H}function ja(z,H){return H=ro(z,H),yo[H]}function qr(z,H){(!H.ptrType||!H.ptr)&&Xr("makeClassHandle requires ptr and ptrType");var N=!!H.smartPtrType,U=!!H.smartPtr;return N!==U&&Xr("Both smartPtrType and smartPtr must be specified"),H.count={value:1},io(Object.create(z,{$$:{value:H}}))}function Bl(z){var H=this.getPointee(z);if(!H)return this.destructor(z),null;var N=ja(this.registeredClass,H);if(N!==void 0){if(N.$$.count.value===0)return N.$$.ptr=H,N.$$.smartPtr=z,N.clone();var U=N.clone();return this.destructor(z),U}function Z(){return this.isSmartPointer?qr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:H,smartPtrType:this,smartPtr:z}):qr(this.registeredClass.instancePrototype,{ptrType:this,ptr:z})}var ce=this.registeredClass.getActualType(H),he=Bo[ce];if(!he)return Z.call(this);var ye;this.isConst?ye=he.constPointerType:ye=he.pointerType;var xe=Nc(H,this.registeredClass,ye.registeredClass);return xe===null?Z.call(this):this.isSmartPointer?qr(ye.registeredClass.instancePrototype,{ptrType:ye,ptr:xe,smartPtrType:this,smartPtr:z}):qr(ye.registeredClass.instancePrototype,{ptrType:ye,ptr:xe})}function io(z){return typeof FinalizationRegistry>"u"?(io=H=>H,z):(di=new FinalizationRegistry(H=>{hi(H.$$)}),io=H=>{var N=H.$$,U=!!N.smartPtr;if(U){var Z={$$:N};di.register(H,Z,H)}return H},Lc=H=>di.unregister(H),io(z))}function Vc(){if(this.$$.ptr||da(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var z=io(Object.create(Object.getPrototypeOf(this),{$$:{value:fa(this.$$)}}));return z.$$.count.value+=1,z.$$.deleteScheduled=!1,z}function Vs(){this.$$.ptr||da(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Cn("Object already scheduled for deletion"),Lc(this),hi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Gl(){return!this.$$.ptr}function kc(){return this.$$.ptr||da(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Cn("Object already scheduled for deletion"),ri.push(this),ri.length===1&&ha&&ha(Ls),this.$$.deleteScheduled=!0,this}function Mi(){Oi.prototype.isAliasOf=Uo,Oi.prototype.clone=Vc,Oi.prototype.delete=Vs,Oi.prototype.isDeleted=Gl,Oi.prototype.deleteLater=kc}function Oi(){}function Fc(z,H,N){if(z[H].overloadTable===void 0){var U=z[H];z[H]=function(){return z[H].overloadTable.hasOwnProperty(arguments.length)||Cn("Function '"+N+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+z[H].overloadTable+")!"),z[H].overloadTable[arguments.length].apply(this,arguments)},z[H].overloadTable=[],z[H].overloadTable[U.argCount]=U}}function kr(z,H,N){o.hasOwnProperty(z)?((N===void 0||o[z].overloadTable!==void 0&&o[z].overloadTable[N]!==void 0)&&Cn("Cannot register public name '"+z+"' twice"),Fc(o,z,z),o.hasOwnProperty(N)&&Cn("Cannot register multiple overloads of a function with the same number of arguments ("+N+")!"),o[z].overloadTable[N]=H):(o[z]=H,N!==void 0&&(o[z].numArguments=N))}function Uc(z,H,N,U,Z,ce,he,ye){this.name=z,this.constructor=H,this.instancePrototype=N,this.rawDestructor=U,this.baseClass=Z,this.getActualType=ce,this.upcast=he,this.downcast=ye,this.pureVirtualFunctions=[]}function ks(z,H,N){for(;H!==N;)H.upcast||Cn("Expected null or instance of "+N.name+", got an instance of "+H.name),z=H.upcast(z),H=H.baseClass;return z}function Ha(z,H){if(H===null)return this.isReference&&Cn("null is not a valid "+this.name),0;H.$$||Cn('Cannot pass "'+Bs(H)+'" as a '+this.name),H.$$.ptr||Cn("Cannot pass deleted object as a pointer of type "+this.name);var N=H.$$.ptrType.registeredClass,U=ks(H.$$.ptr,N,this.registeredClass);return U}function ur(z,H){var N;if(H===null)return this.isReference&&Cn("null is not a valid "+this.name),this.isSmartPointer?(N=this.rawConstructor(),z!==null&&z.push(this.rawDestructor,N),N):0;H.$$||Cn('Cannot pass "'+Bs(H)+'" as a '+this.name),H.$$.ptr||Cn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&H.$$.ptrType.isConst&&Cn("Cannot convert argument of type "+(H.$$.smartPtrType?H.$$.smartPtrType.name:H.$$.ptrType.name)+" to parameter type "+this.name);var U=H.$$.ptrType.registeredClass;if(N=ks(H.$$.ptr,U,this.registeredClass),this.isSmartPointer)switch(H.$$.smartPtr===void 0&&Cn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:H.$$.smartPtrType===this?N=H.$$.smartPtr:Cn("Cannot convert argument of type "+(H.$$.smartPtrType?H.$$.smartPtrType.name:H.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:N=H.$$.smartPtr;break;case 2:if(H.$$.smartPtrType===this)N=H.$$.smartPtr;else{var Z=H.clone();N=this.rawShare(N,Za.toHandle(function(){Z.delete()})),z!==null&&z.push(this.rawDestructor,N)}break;default:Cn("Unsupporting sharing policy")}return N}function ji(z,H){if(H===null)return this.isReference&&Cn("null is not a valid "+this.name),0;H.$$||Cn('Cannot pass "'+Bs(H)+'" as a '+this.name),H.$$.ptr||Cn("Cannot pass deleted object as a pointer of type "+this.name),H.$$.ptrType.isConst&&Cn("Cannot convert argument of type "+H.$$.ptrType.name+" to parameter type "+this.name);var N=H.$$.ptrType.registeredClass,U=ks(H.$$.ptr,N,this.registeredClass);return U}function Ka(z){return this.rawGetPointee&&(z=this.rawGetPointee(z)),z}function Yr(z){this.rawDestructor&&this.rawDestructor(z)}function Bc(z){z!==null&&z.delete()}function ii(){pi.prototype.getPointee=Ka,pi.prototype.destructor=Yr,pi.prototype.argPackAdvance=8,pi.prototype.readValueFromPointer=Kt,pi.prototype.deleteObject=Bc,pi.prototype.fromWireType=Bl}function pi(z,H,N,U,Z,ce,he,ye,xe,be,Le){this.name=z,this.registeredClass=H,this.isReference=N,this.isConst=U,this.isSmartPointer=Z,this.pointeeType=ce,this.sharingPolicy=he,this.rawGetPointee=ye,this.rawConstructor=xe,this.rawShare=be,this.rawDestructor=Le,!Z&&H.baseClass===void 0?U?(this.toWireType=Ha,this.destructorFunction=null):(this.toWireType=ji,this.destructorFunction=null):this.toWireType=ur}function Xa(z,H,N){o.hasOwnProperty(z)||Xr("Replacing nonexistant public symbol"),o[z].overloadTable!==void 0&&N!==void 0?o[z].overloadTable[N]=H:(o[z]=H,o[z].argCount=N)}function qa(z,H,N){var U=o["dynCall_"+z];return N&&N.length?U.apply(null,[H].concat(N)):U.call(null,H)}function Wl(z,H,N){if(z.includes("j"))return qa(z,H,N);var U=lt(H).apply(null,N);return U}function Ya(z,H){var N=[];return function(){return N.length=0,Object.assign(N,arguments),Wl(z,H,N)}}function Qn(z,H){z=br(z);function N(){return z.includes("j")?Ya(z,H):lt(H)}var U=N();return typeof U!="function"&&Cn("unknown function pointer with signature "+z+": "+H),U}var Fs=void 0;function Ja(z){var H=je(z),N=br(H);return me(H),N}function Fr(z,H){var N=[],U={};function Z(ce){if(!U[ce]&&!rt[ce]){if(Ot[ce]){Ot[ce].forEach(Z);return}N.push(ce),U[ce]=!0}}throw H.forEach(Z),new Fs(z+": "+N.map(Ja).join([", "]))}function Us(z,H,N,U,Z,ce,he,ye,xe,be,Le,Qe,at){Le=br(Le),ce=Qn(Z,ce),ye&&(ye=Qn(he,ye)),be&&(be=Qn(xe,be)),at=Qn(Qe,at);var bt=rn(Le);kr(bt,function(){Fr("Cannot construct "+Le+" due to unbound types",[U])}),Ii([z,H,N],U?[U]:[],function(Ct){Ct=Ct[0];var Jt,Xt;U?(Jt=Ct.registeredClass,Xt=Jt.instancePrototype):Xt=Oi.prototype;var Vn=Nn(bt,function(){if(Object.getPrototypeOf(this)!==Pr)throw new fi("Use 'new' to construct "+Le);if(Ur.constructor_body===void 0)throw new fi(Le+" has no accessible constructor");var nd=Ur.constructor_body[arguments.length];if(nd===void 0)throw new fi("Tried to invoke ctor of "+Le+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ur.constructor_body).toString()+") parameters instead!");return nd.apply(this,arguments)}),Pr=Object.create(Xt,{constructor:{value:Vn}});Vn.prototype=Pr;var Ur=new Uc(Le,Vn,Pr,at,Jt,ce,ye,be),au=new pi(Le,Ur,!0,!1,!1),zo=new pi(Le+"*",Ur,!1,!1,!1),Fg=new pi(Le+" const*",Ur,!1,!0,!1);return Bo[z]={pointerType:zo,constPointerType:Fg},Xa(bt,Vn),[au,zo,Fg]})}function mi(z,H){for(var N=[],U=0;U<z;U++)N.push(j[H+U*4>>2]);return N}function Gc(z,H){if(!(z instanceof Function))throw new TypeError("new_ called with constructor type "+typeof z+" which is not a function");var N=Nn(z.name||"unknownFunctionName",function(){});N.prototype=z.prototype;var U=new N,Z=z.apply(U,H);return Z instanceof Object?Z:U}function Go(z,H,N,U,Z){var ce=H.length;ce<2&&Cn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var he=H[1]!==null&&N!==null,ye=!1,xe=1;xe<H.length;++xe)if(H[xe]!==null&&H[xe].destructorFunction===void 0){ye=!0;break}for(var be=H[0].name!=="void",Le="",Qe="",xe=0;xe<ce-2;++xe)Le+=(xe!==0?", ":"")+"arg"+xe,Qe+=(xe!==0?", ":"")+"arg"+xe+"Wired";var at="return function "+rn(z)+"("+Le+`) {
if (arguments.length !== `+(ce-2)+`) {
throwBindingError('function `+z+" called with ' + arguments.length + ' arguments, expected "+(ce-2)+` args!');
}
`;ye&&(at+=`var destructors = [];
`);var bt=ye?"destructors":"null",Ct=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Jt=[Cn,U,Z,bi,H[0],H[1]];he&&(at+="var thisWired = classParam.toWireType("+bt+`, this);
`);for(var xe=0;xe<ce-2;++xe)at+="var arg"+xe+"Wired = argType"+xe+".toWireType("+bt+", arg"+xe+"); // "+H[xe+2].name+`
`,Ct.push("argType"+xe),Jt.push(H[xe+2]);if(he&&(Qe="thisWired"+(Qe.length>0?", ":"")+Qe),at+=(be?"var rv = ":"")+"invoker(fn"+(Qe.length>0?", ":"")+Qe+`);
`,ye)at+=`runDestructors(destructors);
`;else for(var xe=he?1:2;xe<H.length;++xe){var Xt=xe===1?"thisWired":"arg"+(xe-2)+"Wired";H[xe].destructorFunction!==null&&(at+=Xt+"_dtor("+Xt+"); // "+H[xe].name+`
`,Ct.push(Xt+"_dtor"),Jt.push(H[xe].destructorFunction))}be&&(at+=`var ret = retType.fromWireType(rv);
return ret;
`),at+=`}
`,Ct.push(at);var Vn=Gc(Function,Ct).apply(null,Jt);return Vn}function Hi(z,H,N,U,Z,ce){_(H>0);var he=mi(H,N);Z=Qn(U,Z),Ii([],[z],function(ye){ye=ye[0];var xe="constructor "+ye.name;if(ye.registeredClass.constructor_body===void 0&&(ye.registeredClass.constructor_body=[]),ye.registeredClass.constructor_body[H-1]!==void 0)throw new fi("Cannot register multiple constructors with identical number of parameters ("+(H-1)+") for class '"+ye.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return ye.registeredClass.constructor_body[H-1]=()=>{Fr("Cannot construct "+ye.name+" due to unbound types",he)},Ii([],he,function(be){return be.splice(1,0,null),ye.registeredClass.constructor_body[H-1]=Go(xe,be,null,Z,ce),[]}),[]})}function $l(z,H,N,U,Z,ce,he,ye){var xe=mi(N,U);H=br(H),ce=Qn(Z,ce),Ii([],[z],function(be){be=be[0];var Le=be.name+"."+H;H.startsWith("@@")&&(H=Symbol[H.substring(2)]),ye&&be.registeredClass.pureVirtualFunctions.push(H);function Qe(){Fr("Cannot call "+Le+" due to unbound types",xe)}var at=be.registeredClass.instancePrototype,bt=at[H];return bt===void 0||bt.overloadTable===void 0&&bt.className!==be.name&&bt.argCount===N-2?(Qe.argCount=N-2,Qe.className=be.name,at[H]=Qe):(Fc(at,H,Le),at[H].overloadTable[N-2]=Qe),Ii([],xe,function(Ct){var Jt=Go(Le,Ct,be,ce,he);return at[H].overloadTable===void 0?(Jt.argCount=N-2,at[H]=Jt):at[H].overloadTable[N-2]=Jt,[]}),[]})}var Wo=[],vi=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Wc(z){z>4&&--vi[z].refcount===0&&(vi[z]=void 0,Wo.push(z))}function zl(){for(var z=0,H=5;H<vi.length;++H)vi[H]!==void 0&&++z;return z}function jl(){for(var z=5;z<vi.length;++z)if(vi[z]!==void 0)return vi[z];return null}function $c(){o.count_emval_handles=zl,o.get_first_emval=jl}var Za={toValue:z=>(z||Cn("Cannot use deleted val. handle = "+z),vi[z].value),toHandle:z=>{switch(z){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var H=Wo.length?Wo.pop():vi.length;return vi[H]={refcount:1,value:z},H}}}};function zc(z,H){H=br(H),yr(z,{name:H,fromWireType:function(N){var U=Za.toValue(N);return Wc(N),U},toWireType:function(N,U){return Za.toHandle(U)},argPackAdvance:8,readValueFromPointer:Kt,destructorFunction:null})}function Bs(z){if(z===null)return"null";var H=typeof z;return H==="object"||H==="array"||H==="function"?z.toString():""+z}function Hl(z,H){switch(H){case 2:return function(N){return this.fromWireType(J[N>>2])};case 3:return function(N){return this.fromWireType(ie[N>>3])};default:throw new TypeError("Unknown float type: "+z)}}function Kl(z,H,N){var U=ua(N);H=br(H),yr(z,{name:H,fromWireType:function(Z){return Z},toWireType:function(Z,ce){return ce},argPackAdvance:8,readValueFromPointer:Hl(H,U),destructorFunction:null})}function Xl(z,H,N,U,Z,ce){var he=mi(H,N);z=br(z),Z=Qn(U,Z),kr(z,function(){Fr("Cannot call "+z+" due to unbound types",he)},H-1),Ii([],he,function(ye){var xe=[ye[0],null].concat(ye.slice(1));return Xa(z,Go(z,xe,null,Z,ce),H-1),[]})}function Gs(z,H,N){switch(H){case 0:return N?function(Z){return A[Z]}:function(Z){return B[Z]};case 1:return N?function(Z){return k[Z>>1]}:function(Z){return L[Z>>1]};case 2:return N?function(Z){return F[Z>>2]}:function(Z){return j[Z>>2]};default:throw new TypeError("Unknown integer type: "+z)}}function ql(z,H,N,U,Z){H=br(H);var ce=ua(N),he=Qe=>Qe;if(U===0){var ye=32-8*N;he=Qe=>Qe<<ye>>>ye}var xe=H.includes("unsigned"),be=(Qe,at)=>{},Le;xe?Le=function(Qe,at){return be(at,this.name),at>>>0}:Le=function(Qe,at){return be(at,this.name),at},yr(z,{name:H,fromWireType:he,toWireType:Le,argPackAdvance:8,readValueFromPointer:Gs(H,ce,U!==0),destructorFunction:null})}function Yl(z,H,N){var U=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Z=U[H];function ce(he){he=he>>2;var ye=j,xe=ye[he],be=ye[he+1];return new Z(R,be,xe)}N=br(N),yr(z,{name:N,fromWireType:ce,argPackAdvance:8,readValueFromPointer:ce},{ignoreDuplicateRegistrations:!0})}function Jl(z,H){H=br(H);var N=H==="std::string";yr(z,{name:H,fromWireType:function(U){var Z=j[U>>2],ce=U+4,he;if(N)for(var ye=ce,xe=0;xe<=Z;++xe){var be=ce+xe;if(xe==Z||B[be]==0){var Le=be-ye,Qe=b(ye,Le);he===void 0?he=Qe:(he+="\0",he+=Qe),ye=be+1}}else{for(var at=new Array(Z),xe=0;xe<Z;++xe)at[xe]=String.fromCharCode(B[ce+xe]);he=at.join("")}return me(U),he},toWireType:function(U,Z){Z instanceof ArrayBuffer&&(Z=new Uint8Array(Z));var ce,he=typeof Z=="string";he||Z instanceof Uint8Array||Z instanceof Uint8ClampedArray||Z instanceof Int8Array||Cn("Cannot pass non-string to std::string"),N&&he?ce=M(Z):ce=Z.length;var ye=ne(4+ce+1),xe=ye+4;if(j[ye>>2]=ce,N&&he)O(Z,xe,ce+1);else if(he)for(var be=0;be<ce;++be){var Le=Z.charCodeAt(be);Le>255&&(me(xe),Cn("String has UTF-16 code units that do not fit in 8 bits")),B[xe+be]=Le}else for(var be=0;be<ce;++be)B[xe+be]=Z[be];return U!==null&&U.push(me,ye),ye},argPackAdvance:8,readValueFromPointer:Kt,destructorFunction:function(U){me(U)}})}var Ws=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Zl(z,H){for(var N=z,U=N>>1,Z=U+H/2;!(U>=Z)&&L[U];)++U;if(N=U<<1,N-z>32&&Ws)return Ws.decode(B.subarray(z,N));for(var ce="",he=0;!(he>=H/2);++he){var ye=k[z+he*2>>1];if(ye==0)break;ce+=String.fromCharCode(ye)}return ce}function jc(z,H,N){if(N===void 0&&(N=2147483647),N<2)return 0;N-=2;for(var U=H,Z=N<z.length*2?N/2:z.length,ce=0;ce<Z;++ce){var he=z.charCodeAt(ce);k[H>>1]=he,H+=2}return k[H>>1]=0,H-U}function Hc(z){return z.length*2}function Ql(z,H){for(var N=0,U="";!(N>=H/4);){var Z=F[z+N*4>>2];if(Z==0)break;if(++N,Z>=65536){var ce=Z-65536;U+=String.fromCharCode(55296|ce>>10,56320|ce&1023)}else U+=String.fromCharCode(Z)}return U}function $s(z,H,N){if(N===void 0&&(N=2147483647),N<4)return 0;for(var U=H,Z=U+N-4,ce=0;ce<z.length;++ce){var he=z.charCodeAt(ce);if(he>=55296&&he<=57343){var ye=z.charCodeAt(++ce);he=65536+((he&1023)<<10)|ye&1023}if(F[H>>2]=he,H+=4,H+4>Z)break}return F[H>>2]=0,H-U}function eu(z){for(var H=0,N=0;N<z.length;++N){var U=z.charCodeAt(N);U>=55296&&U<=57343&&++N,H+=4}return H}function Kc(z,H,N){N=br(N);var U,Z,ce,he,ye;H===2?(U=Zl,Z=jc,he=Hc,ce=()=>L,ye=1):H===4&&(U=Ql,Z=$s,he=eu,ce=()=>j,ye=2),yr(z,{name:N,fromWireType:function(xe){for(var be=j[xe>>2],Le=ce(),Qe,at=xe+4,bt=0;bt<=be;++bt){var Ct=xe+4+bt*H;if(bt==be||Le[Ct>>ye]==0){var Jt=Ct-at,Xt=U(at,Jt);Qe===void 0?Qe=Xt:(Qe+="\0",Qe+=Xt),at=Ct+H}}return me(xe),Qe},toWireType:function(xe,be){typeof be!="string"&&Cn("Cannot pass non-string to C++ string type "+N);var Le=he(be),Qe=ne(4+Le+H);return j[Qe>>2]=Le>>ye,Z(be,Qe+4,Le+H),xe!==null&&xe.push(me,Qe),Qe},argPackAdvance:8,readValueFromPointer:Kt,destructorFunction:function(xe){me(xe)}})}function Xc(z,H,N,U,Z,ce){sn[z]={name:br(H),rawConstructor:Qn(N,U),rawDestructor:Qn(Z,ce),fields:[]}}function qc(z,H,N,U,Z,ce,he,ye,xe,be){sn[z].fields.push({fieldName:br(H),getterReturnType:N,getter:Qn(U,Z),getterContext:ce,setterArgumentType:he,setter:Qn(ye,xe),setterContext:be})}function Yc(z,H){H=br(H),yr(z,{isVoid:!0,name:H,argPackAdvance:0,fromWireType:function(){},toWireType:function(N,U){}})}function tu(z){z>4&&(vi[z].refcount+=1)}function nu(z,H){var N=rt[z];return N===void 0&&Cn(H+" has unknown type "+Ja(z)),N}function ru(z,H){z=nu(z,"_emval_take_value");var N=z.readValueFromPointer(H);return Za.toHandle(N)}function zs(){Ne("")}function iu(z,H,N){B.copyWithin(z,H,H+N)}function ga(){return 2147483648}function ou(z){try{return T.grow(z-R.byteLength+65535>>>16),fe(T.buffer),1}catch{}}function js(z){var H=B.length;z=z>>>0;var N=ga();if(z>N)return!1;let U=(xe,be)=>xe+(be-xe%be)%be;for(var Z=1;Z<=4;Z*=2){var ce=H*(1+.2/Z);ce=Math.min(ce,z+100663296);var he=Math.min(N,U(Math.max(z,ce),65536)),ye=ou(he);if(ye)return!0}return!1}function Hs(z){return 52}function $o(z,H,N,U,Z){return 70}var Ki=[null,[],[]];function Jc(z,H){var N=Ki[z];H===0||H===10?((z===1?y:C)(D(N,0)),N.length=0):N.push(H)}function Zc(z,H,N,U){for(var Z=0,ce=0;ce<N;ce++){var he=j[H>>2],ye=j[H+4>>2];H+=8;for(var xe=0;xe<ye;xe++)Jc(z,B[he+xe]);Z+=ye}return j[U>>2]=Z,0}function Ks(z){return z}function Qc(z){var H=o["_"+z];return H}function Qa(z,H){A.set(z,H)}function Xs(z,H,N,U,Z){var ce={string:Ct=>{var Jt=0;if(Ct!=null&&Ct!==0){var Xt=(Ct.length<<2)+1;Jt=et(Xt),O(Ct,Jt,Xt)}return Jt},array:Ct=>{var Jt=et(Ct.length);return Qa(Ct,Jt),Jt}};function he(Ct){return H==="string"?b(Ct):H==="boolean"?!!Ct:Ct}var ye=Qc(z),xe=[],be=0;if(U)for(var Le=0;Le<U.length;Le++){var Qe=ce[N[Le]];Qe?(be===0&&(be=Ye()),xe[Le]=Qe(U[Le])):xe[Le]=U[Le]}var at=ye.apply(null,xe);function bt(Ct){return be!==0&&He(be),he(Ct)}return at=bt(at),at}wn=o.InternalError=zi(Error,"InternalError"),$a(),fi=o.BindingError=zi(Error,"BindingError"),Mi(),Ns(),ii(),Fs=o.UnboundTypeError=zi(Error,"UnboundTypeError"),$c();var te={__assert_fail:gt,__cxa_begin_catch:ze,__cxa_end_catch:Fe,__cxa_find_matching_catch_2:yn,__cxa_find_matching_catch_3:bn,__cxa_throw:fn,__resumeException:wt,_embind_finalize_value_object:Wa,_embind_register_bigint:Ac,_embind_register_bool:vo,_embind_register_class:Us,_embind_register_class_constructor:Hi,_embind_register_class_function:$l,_embind_register_emval:zc,_embind_register_float:Kl,_embind_register_function:Xl,_embind_register_integer:ql,_embind_register_memory_view:Yl,_embind_register_std_string:Jl,_embind_register_std_wstring:Kc,_embind_register_value_object:Xc,_embind_register_value_object_field:qc,_embind_register_void:Yc,_emval_decref:Wc,_emval_incref:tu,_emval_take_value:ru,abort:zs,emscripten_memcpy_big:iu,emscripten_resize_heap:js,fd_close:Hs,fd_seek:$o,fd_write:Zc,invoke_i:Ve,invoke_ii:Lt,invoke_iii:it,invoke_iiii:Se,invoke_v:ue,invoke_vi:X,invoke_viiii:Y,invoke_viiiiii:Ze,llvm_eh_typeid_for:Ks};$e(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.__wasm_call_ctors).apply(null,arguments)};var ne=o._malloc=function(){return(ne=o._malloc=o.asm.malloc).apply(null,arguments)},me=o._free=function(){return(me=o._free=o.asm.free).apply(null,arguments)},Re=o.___cxa_free_exception=function(){return(Re=o.___cxa_free_exception=o.asm.__cxa_free_exception).apply(null,arguments)},je=o.___getTypeName=function(){return(je=o.___getTypeName=o.asm.__getTypeName).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm._embind_initialize_bindings).apply(null,arguments)},o.___errno_location=function(){return(o.___errno_location=o.asm.__errno_location).apply(null,arguments)};var tt=o.setTempRet0=function(){return(tt=o.setTempRet0=o.asm.setTempRet0).apply(null,arguments)},Ye=o.stackSave=function(){return(Ye=o.stackSave=o.asm.stackSave).apply(null,arguments)},He=o.stackRestore=function(){return(He=o.stackRestore=o.asm.stackRestore).apply(null,arguments)},et=o.stackAlloc=function(){return(et=o.stackAlloc=o.asm.stackAlloc).apply(null,arguments)},dt=o.___cxa_can_catch=function(){return(dt=o.___cxa_can_catch=o.asm.__cxa_can_catch).apply(null,arguments)},It=o.___cxa_is_pointer_type=function(){return(It=o.___cxa_is_pointer_type=o.asm.__cxa_is_pointer_type).apply(null,arguments)};o.dynCall_ji=function(){return(o.dynCall_ji=o.asm.dynCall_ji).apply(null,arguments)},o.dynCall_iiji=function(){return(o.dynCall_iiji=o.asm.dynCall_iiji).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.dynCall_jiji).apply(null,arguments)};function Lt(z,H){var N=Ye();try{return lt(z)(H)}catch(U){if(He(N),U!==U+0)throw U;_setThrew(1,0)}}function X(z,H){var N=Ye();try{lt(z)(H)}catch(U){if(He(N),U!==U+0)throw U;_setThrew(1,0)}}function Y(z,H,N,U,Z){var ce=Ye();try{lt(z)(H,N,U,Z)}catch(he){if(He(ce),he!==he+0)throw he;_setThrew(1,0)}}function ue(z){var H=Ye();try{lt(z)()}catch(N){if(He(H),N!==N+0)throw N;_setThrew(1,0)}}function Se(z,H,N,U){var Z=Ye();try{return lt(z)(H,N,U)}catch(ce){if(He(Z),ce!==ce+0)throw ce;_setThrew(1,0)}}function Ve(z){var H=Ye();try{return lt(z)()}catch(N){if(He(H),N!==N+0)throw N;_setThrew(1,0)}}function Ze(z,H,N,U,Z,ce,he){var ye=Ye();try{lt(z)(H,N,U,Z,ce,he)}catch(xe){if(He(ye),xe!==xe+0)throw xe;_setThrew(1,0)}}function it(z,H,N){var U=Ye();try{return lt(z)(H,N)}catch(Z){if(He(U),Z!==Z+0)throw Z;_setThrew(1,0)}}o.ccall=Xs;var Ke;ee=function z(){Ke||ot(),Ke||(ee=z)};function ot(z){if(Q>0||(Te(),Q>0))return;function H(){Ke||(Ke=!0,o.calledRun=!0,!S&&(G(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),P()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),H()},1)):H()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return ot(),o.ready})})();t.exports=r})(By)),By.exports}var Uve=Fve();const Bve=ka(Uve),Gve=new URL(""+new URL("openjphjs-C-BUUy4a.wasm",import.meta.url).href,import.meta.url),kd={codec:void 0,decoder:void 0,decodeConfig:{}};function Wve(t,e,r){const n={width:e,height:r};for(;t>0;)n.width=Math.ceil(n.width/2),n.height=Math.ceil(n.height/2),t--;return n}function $ve(t){if(kd.decodeConfig=t,kd.codec)return Promise.resolve();const e=Bve({locateFile:r=>r.endsWith(".wasm")?Gve.toString():r});return new Promise((r,n)=>{e.then(i=>{kd.codec=i,kd.decoder=new i.HTJ2KDecoder,r()},n)})}async function zve(t,e){await $ve();const r=new kd.codec.HTJ2KDecoder,n=r.getEncodedBuffer(t.length);n.set(t);const i=e.decodeLevel||0;r.decodeSubResolution(i);const o=r.getFrameInfo();if(e.decodeLevel>0){const{width:E,height:D}=Wve(e.decodeLevel,o.width,o.height);o.width=E,o.height=D}const a=r.getDecodedBuffer();new Uint8Array(a.length).set(a);const c=`x: ${r.getImageOffset().x}, y: ${r.getImageOffset().y}`,l=r.getNumDecompositions(),f=r.getNumLayers(),u=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][r.getProgressionOrder()+1],d=r.getIsReversible(),h=`${r.getBlockDimensions().width} x ${r.getBlockDimensions().height}`,g=`${r.getTileSize().width} x ${r.getTileSize().height}`,p=`${r.getTileOffset().x}, ${r.getTileOffset().y}`,m=`${a.length.toLocaleString()} bytes`,w=`${(a.length/n.length).toFixed(2)}:1`,v={columns:o.width,rows:o.height,bitsPerPixel:o.bitsPerSample,signed:o.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:o.componentCount};let y=jve(o,a);const{buffer:C,byteOffset:x,byteLength:T}=y,S=C.slice(x,x+T);y=new y.constructor(S);const _={imageOffset:c,numDecompositions:l,numLayers:f,progessionOrder:u,reversible:d,blockDimensions:h,tileSize:g,tileOffset:p,decodedSize:m,compressionRatio:w};return{...e,pixelData:y,imageInfo:v,encodeOptions:_,..._,...v}}function jve(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function Hve(t,e){const r=t.length,{rescaleSlope:n,rescaleIntercept:i,suvbw:o,doseGridScaling:a}=e;if(e.modality==="PT"&&typeof o=="number"&&!isNaN(o))for(let s=0;s<r;s++)t[s]=o*(t[s]*n+i);else if(e.modality==="RTDOSE"&&typeof a=="number"&&!isNaN(a))for(let s=0;s<r;s++)t[s]=t[s]*a;else for(let s=0;s<r;s++)t[s]=t[s]*n+i;return!0}const Kve={bilinear:ove,replicate:ave},cb={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};function Xve(t,e,r,n){const i=t.pixelRepresentation!==void 0&&t.pixelRepresentation===1,o=i&&t.bitsStored!==void 0?32-t.bitsStored:void 0;if(i&&o!==void 0)for(let v=0;v<t.pixelData.length;v++)t.pixelData[v]=t.pixelData[v]<<o>>o;let a=t.pixelData;t.pixelDataLength=t.pixelData.length;const{min:s,max:c}=z3(t.pixelData),l=typeof e.allowFloatRendering<"u"?e.allowFloatRendering:!0;let f=YL(t.photometricInterpretation)&&e.targetBuffer?.offset===void 0;const d=e.preScale?.enabled&&Object.values(e.preScale.scalingParameters).some(v=>typeof v=="number"&&!Number.isInteger(v)),h=!e.preScale.enabled||!l&&d,g=e.targetBuffer?.type;if(g&&e.preScale.enabled&&!h){const v=e.preScale.scalingParameters,y=_w(s,c,v);f=!x2e(y.min,y.max,cb[g])}g&&!f?a=Yve(e,t,cb,a):e.preScale.enabled&&!h?a=Jve(e,s,c,t):a=oN(s,c,t);let p=s,m=c;if(e.preScale.enabled&&!h){const v=e.preScale.scalingParameters;if(aN(v),qve(v)){Hve(a,v),t.preScale={...e.preScale,scaled:!0};const C=_w(s,c,v);p=C.min,m=C.max}}else h&&(t.preScale={enabled:!0,scaled:!1},p=s,m=c);t.pixelData=a,t.smallestPixelValue=p,t.largestPixelValue=m;const w=new Date().getTime();return t.decodeTimeInMS=w-r,t}function qve(t){const{rescaleSlope:e,rescaleIntercept:r,modality:n,doseGridScaling:i,suvbw:o}=t;return typeof e=="number"&&typeof r=="number"||n==="RTDOSE"&&typeof i=="number"||n==="PT"&&typeof o=="number"}function Yve(t,e,r,n){const{arrayBuffer:i,type:o,offset:a=0,length:s,rows:c}=t.targetBuffer,l=r[o];if(!l)throw new Error(`target array ${o} is not supported, or doesn't exist.`);c&&c!=e.rows&&Qve(e,t.targetBuffer,l);const f=e.pixelDataLength,u=a,d=s??f-u,h=e.pixelData;if(d!==h.length)throw new Error(`target array for image does not have the same length (${d}) as the decoded image length (${h.length}).`);const g=i?new l(i,u,d):new l(d);return g.set(h,0),n=g,n}function Jve(t,e,r,n){const i=t.preScale.scalingParameters;aN(i);const o=_w(e,r,i);return oN(o.min,o.max,n)}function oN(t,e,r){const n=j3(t,e),i=new n(r.pixelData.length);return i.set(r.pixelData,0),i}function _w(t,e,r){const{rescaleSlope:n,rescaleIntercept:i,modality:o,doseGridScaling:a,suvbw:s}=r;return o==="PT"&&typeof s=="number"&&!isNaN(s)?{min:s*(t*n+i),max:s*(e*n+i)}:o==="RTDOSE"&&typeof a=="number"&&!isNaN(a)?{min:t*a,max:e*a}:typeof n=="number"&&typeof i=="number"?{min:n*t+i,max:n*e+i}:{min:t,max:e}}function aN(t){if(!t)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function Zve(t,e,r){const{samplesPerPixel:n}=t,{rows:i,columns:o}=e,a=i*o*n,s=new r(a),c=s.byteLength/a;return{pixelData:s,rows:i,columns:o,frameInfo:{...t.frameInfo,rows:i,columns:o},imageInfo:{...t.imageInfo,rows:i,columns:o,bytesPerPixel:c}}}function Qve(t,e,r){const n=Zve(t,e,r),{scalingType:i="replicate"}=e;return Kve[i](t,n),Object.assign(t,n),t.pixelDataLength=t.pixelData.length,t}async function eye(t,e,r,n,i,o){const a=new Date().getTime();let s=null,c;switch(e){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":s=Q4(t,r);break;case"1.2.840.10008.1.2.2":s=cve(t,r);break;case"1.2.840.10008.1.2.1.99":s=Q4(t,r);break;case"1.2.840.10008.1.2.5":s=lve(t,r);break;case"1.2.840.10008.1.2.4.50":c={...t},s=yve(r,c);break;case"1.2.840.10008.1.2.4.51":s=Sve(t,r);break;case"1.2.840.10008.1.2.4.57":s=nb(t,r);break;case"1.2.840.10008.1.2.4.70":s=nb(t,r);break;case"1.2.840.10008.1.2.4.80":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=ib(r,c);break;case"1.2.840.10008.1.2.4.81":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=ib(r,c);break;case"1.2.840.10008.1.2.4.90":c={...t},s=ab(r,c);break;case"1.2.840.10008.1.2.4.91":c={...t},s=ab(r,c);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":c={...t},s=zve(r,c);break;default:throw new Error(`no decoder for transfer syntax ${e}`)}if(!s)throw new Error("decodePromise not defined");const l=await s,f=Xve(l,i,a);return o?.(f),f}const tye={decodeTask({imageFrame:t,transferSyntax:e,decodeConfig:r,options:n,pixelData:i,callbackFn:o}){return eye(t,e,i,r,n,o)}};Ew(tye);const X3=document.getElementById("dicomViewport"),nye=document.getElementById("status"),rye=document.getElementById("dicomFiles");let Gy,R1;function Dl(t){nye.textContent=t}function iye(t){console.error(t);const e=t&&t.message?t.message:String(t);Dl("Initialization failed: "+e+" (open DevTools Console for details)")}async function oye(){Dl("Initializing Cornerstone..."),await _b(),await RR(),(void 0).cornerstone=Rre,(void 0).dicomParser=S1e,rve();const{addTool:t,ToolGroupManager:e,PanTool:r,ZoomTool:n,WindowLevelTool:i,StackScrollTool:o,LengthTool:a,Enums:s}=l1e,c=s&&s.MouseBindings?s.MouseBindings:null,l=s&&s.KeyboardBindings?s.KeyboardBindings:null;t(r),t(n),t(i),t(o),t(a);const f="re1",u="vp1";Gy=new e7(f),Gy.enableElement({viewportId:u,type:Fn.STACK,element:X3}),R1=Gy.getViewport(u);const h=e.createToolGroup("tg1");h.addTool(o.toolName),h.addTool(i.toolName),h.addTool(r.toolName),h.addTool(n.toolName),h.addTool(a.toolName),h.addViewport(u,f),c?(h.setToolActive(i.toolName,{bindings:[{mouseButton:c.Primary}]}),h.setToolActive(r.toolName,{bindings:[{mouseButton:c.Auxiliary}]}),h.setToolActive(n.toolName,{bindings:[{mouseButton:c.Secondary}]}),h.setToolActive(o.toolName,{bindings:[{mouseButton:c.Wheel}]}),l&&l.Shift!=null?h.setToolActive(a.toolName,{bindings:[{mouseButton:c.Primary,modifierKey:l.Shift}]}):h.setToolPassive(a.toolName)):(h.setToolActive(o.toolName),h.setToolActive(i.toolName),h.setToolPassive(r.toolName),h.setToolPassive(n.toolName),h.setToolPassive(a.toolName)),R1.render(),Dl("Ready. Choose DICOM files (one series) to load.")}async function sN(t){const e=Array.from(t||[]).filter(n=>n&&n.size>0);if(e.length===0)return;Dl("Indexing files...");const r=e.map(n=>I2e.fileManager.add(n));Dl("Loading stack..."),await R1.setStack(r),R1.render(),Dl("Loaded "+r.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom.")}rye.addEventListener("change",async t=>{try{await sN(t.target.files)}catch(e){console.error(e),Dl("Load failed. Try selecting only one series.")}});X3.addEventListener("dragover",t=>{t.preventDefault()});X3.addEventListener("drop",async t=>{t.preventDefault();try{await sN(t.dataTransfer.files)}catch(e){console.error(e),Dl("Drop failed. Try selecting only one series.")}});oye().catch(iye);
