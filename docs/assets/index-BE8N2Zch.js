import{b9 as Wn,d3 as hn,t as Hn,e as Vn,as as gn,aL as la,d4 as ca,aq as fa,ar as fo,aK as po,ak as ho,cl as go,d5 as da,aI as ni,d6 as vo,ci as yo,a$ as ui,d7 as mo}from"./index-Cp4iUYqv.js";import{i as _o}from"./imageRetrievalPoolManager-DiP2nqZv.js";import{_ as pa}from"./index-Clh0oYX_.js";function Ii(e,i,a){if(e===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(e.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${e.length} must be divisible by 3`);const o=e.length/3;let h=0,r=0;if(a){for(let g=0;g<o;g++)i[r++]=e[h++],i[r++]=e[h++],i[r++]=e[h++],i[r++]=255;return}i.set(e)}function ha(e,i,a){if(e===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(e.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${e.length} must be divisible by 3`);const o=e.length/3;let h=0,r=0,g=o,w=o*2;if(a)for(let C=0;C<o;C++)i[h++]=e[r++],i[h++]=e[g++],i[h++]=e[w++],i[h++]=255;else for(let C=0;C<o;C++)i[h++]=e[r++],i[h++]=e[g++],i[h++]=e[w++]}function ga(e,i,a){if(e===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(e.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${e.length} must be divisible by 3`);const o=e.length/3;let h=0,r=0;if(a){for(let g=0;g<o;g++){const w=e[h++],C=e[h++],U=e[h++];i[r++]=w+1.402*(U-128),i[r++]=w-.34414*(C-128)-.71414*(U-128),i[r++]=w+1.772*(C-128),i[r++]=255}return}for(let g=0;g<o;g++){const w=e[h++],C=e[h++],U=e[h++];i[r++]=w+1.402*(U-128),i[r++]=w-.34414*(C-128)-.71414*(U-128),i[r++]=w+1.772*(C-128)}}function va(e,i,a){if(e===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(e.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${e.length} must be divisible by 3`);const o=e.length/3;let h=0,r=0,g=o,w=o*2;if(a){for(let C=0;C<o;C++){const U=e[r++],O=e[g++],j=e[w++];i[h++]=U+1.402*(j-128),i[h++]=U-.34414*(O-128)-.71414*(j-128),i[h++]=U+1.772*(O-128),i[h++]=255}return}for(let C=0;C<o;C++){const U=e[r++],O=e[g++],j=e[w++];i[h++]=U+1.402*(j-128),i[h++]=U-.34414*(O-128)-.71414*(j-128),i[h++]=U+1.772*(O-128)}}function bo(e,i,a){if(e===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(e.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${e.length} must be divisible by 2`);const o=e.length/2;let h=0,r=0;if(a){for(let g=0;g<o;g+=2){const w=e[h++],C=e[h++],U=e[h++],O=e[h++];i[r++]=w+1.402*(O-128),i[r++]=w-.34414*(U-128)-.71414*(O-128),i[r++]=w+1.772*(U-128),i[r++]=255,i[r++]=C+1.402*(O-128),i[r++]=C-.34414*(U-128)-.71414*(O-128),i[r++]=C+1.772*(U-128),i[r++]=255}return}for(let g=0;g<o;g+=2){const w=e[h++],C=e[h++],U=e[h++],O=e[h++];i[r++]=w+1.402*(O-128),i[r++]=w-.34414*(U-128)-.71414*(O-128),i[r++]=w+1.772*(U-128),i[r++]=C+1.402*(O-128),i[r++]=C-.34414*(U-128)-.71414*(O-128),i[r++]=C+1.772*(U-128)}}function gi(e,i){const a=e.length,o=new Uint8ClampedArray(a);for(let h=0;h<a;++h)o[h]=e[h]>>i;return o}function vi(e,i,a){const o=e[`${i}PaletteColorLookupTableData`];if(o)return Promise.resolve(o);const h=Wn("imagePixelModule",e.imageId);return h&&typeof h.then=="function"?h.then(r=>r?r[`${i}PaletteColorLookupTableData`]:a):Promise.resolve(h?h[`${i}PaletteColorLookupTableData`]:a)}function ya(e,i,a){const o=e.columns*e.rows,h=e.pixelData;Promise.all([vi(e,"red",null),vi(e,"green",null),vi(e,"blue",null)]).then(([r,g,w])=>{if(!r||!g||!w)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const C=r.length;let U=0,O=0;const j=e.redPaletteColorLookupTableDescriptor[1],H=e.redPaletteColorLookupTableDescriptor[2]===8?0:8,N=gi(r,H),Y=gi(g,H),Z=gi(w,H);if(a){for(let re=0;re<o;++re){let oe=h[U++];oe<j?oe=0:oe>j+C-1?oe=C-1:oe-=j,i[O++]=N[oe],i[O++]=Y[oe],i[O++]=Z[oe],i[O++]=255}return}for(let re=0;re<o;++re){let oe=h[U++];oe<j?oe=0:oe>j+C-1?oe=C-1:oe-=j,i[O++]=N[oe],i[O++]=Y[oe],i[O++]=Z[oe]}})}function yi(e,i){if(!(!e.elements[i]||e.elements[i].length!==6))return[e.uint16(i,0),e.uint16(i,1),e.uint16(i,2)]}function mi(e,i,a){const o=[],h=e.elements[i];for(let r=0;r<a[0];r++)a[2]===16?o[r]=e.uint16(i,r):o[r]=e.byteArray[r+h.dataOffset];return o}function Po(e,i){i.redPaletteColorLookupTableDescriptor=yi(e,"x00281101"),i.greenPaletteColorLookupTableDescriptor=yi(e,"x00281102"),i.bluePaletteColorLookupTableDescriptor=yi(e,"x00281103"),i.redPaletteColorLookupTableDescriptor[0]===0&&(i.redPaletteColorLookupTableDescriptor[0]=65536,i.greenPaletteColorLookupTableDescriptor[0]=65536,i.bluePaletteColorLookupTableDescriptor[0]=65536);const a=i.redPaletteColorLookupTableDescriptor[0],h=e.elements.x00281201.length===a?8:16;i.redPaletteColorLookupTableDescriptor[2]!==h&&(i.redPaletteColorLookupTableDescriptor[2]=h,i.greenPaletteColorLookupTableDescriptor[2]=h,i.bluePaletteColorLookupTableDescriptor[2]=h),i.redPaletteColorLookupTableData=mi(e,"x00281201",i.redPaletteColorLookupTableDescriptor),i.greenPaletteColorLookupTableData=mi(e,"x00281202",i.greenPaletteColorLookupTableDescriptor),i.bluePaletteColorLookupTableData=mi(e,"x00281203",i.bluePaletteColorLookupTableDescriptor)}function wo(e,i){e.uint16("x00280103")===0?(i.smallestPixelValue=e.uint16("x00280106"),i.largestPixelValue=e.uint16("x00280107")):(i.smallestPixelValue=e.int16("x00280106"),i.largestPixelValue=e.int16("x00280107"))}function ma(e){const i={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return wo(e,i),i.photometricInterpretation==="PALETTE COLOR"&&e.elements.x00281101&&Po(e,i),i}function To(e,i){let a=i.uint16("x00283002",0);a===0&&(a=65535);let o=0;e===0?o=i.uint16("x00283002",1):o=i.int16("x00283002",1);const h=i.uint16("x00283002",2),r={id:"1",firstValueMapped:o,numBitsPerEntry:h,lut:[]};for(let g=0;g<a;g++)e===0?r.lut[g]=i.uint16("x00283006",g):r.lut[g]=i.int16("x00283006",g);return r}function Ti(e,i){if(!i||!i.items||!i.items.length)return;const a=[];for(let o=0;o<i.items.length;o++){const h=i.items[o].dataSet,r=To(e,h);r&&a.push(r)}return a}function Eo(e){const i=e.uint16("x00280103"),a=e.uint16("x00280101");return i===0?0:-1<<a-1}function _a(e){const i=e.string("x00080016");if(i==="1.2.840.10008.5.1.4.1.1.2"||i==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const a=e.floatString("x00281052"),o=e.floatString("x00281053");return a!==void 0&&o!==void 0?Eo(e)*o+a<0?1:0:e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")}function hr(e,i,a){const o=[],h=e.string(i);if(!h)return;const r=h.split("\\");if(!(a&&r.length<a)){for(let g=0;g<r.length;g++)o.push(parseFloat(r[g]));return o}}var ii={exports:{}};var xo=ii.exports,Bi;function Ao(){return Bi||(Bi=1,(function(e,i){(function(a,o){e.exports=o(hn)})(xo,function(a){return h=[function(g,w){g.exports=a},function(g,w,C){C.r(w),C.d(w,"isStringVr",function(){return O}),C.d(w,"isPrivateTag",function(){return j}),C.d(w,"parsePN",function(){return H}),C.d(w,"parseTM",function(){return N}),C.d(w,"parseDA",function(){return Z}),C.d(w,"explicitElementToString",function(){return re}),C.d(w,"explicitDataSetToJS",function(){return oe}),C.d(w,"createJPEGBasicOffsetTable",function(){return pe}),C.d(w,"parseDicomDataSetExplicit",function(){return Je}),C.d(w,"parseDicomDataSetImplicit",function(){return Re}),C.d(w,"readFixedString",function(){return fe}),C.d(w,"alloc",function(){return At}),C.d(w,"version",function(){return Jt}),C.d(w,"bigEndianByteArrayParser",function(){return Ht}),C.d(w,"ByteStream",function(){return yt}),C.d(w,"sharedCopy",function(){return Qe}),C.d(w,"DataSet",function(){return Te}),C.d(w,"findAndSetUNElementLength",function(){return je}),C.d(w,"findEndOfEncapsulatedElement",function(){return we}),C.d(w,"findItemDelimitationItemAndSetElementLength",function(){return Ne}),C.d(w,"littleEndianByteArrayParser",function(){return mt}),C.d(w,"parseDicom",function(){return sr}),C.d(w,"readDicomElementExplicit",function(){return Ie}),C.d(w,"readDicomElementImplicit",function(){return ue}),C.d(w,"readEncapsulatedImageFrame",function(){return ot}),C.d(w,"readEncapsulatedPixelData",function(){return ur}),C.d(w,"readEncapsulatedPixelDataFromFragments",function(){return Ke}),C.d(w,"readPart10Header",function(){return Zt}),C.d(w,"readSequenceItemsExplicit",function(){return Ee}),C.d(w,"readSequenceItemsImplicit",function(){return Se}),C.d(w,"readSequenceItem",function(){return De}),C.d(w,"readTag",function(){return me});var U={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},O=function(y){return U[y]},j=function(y){if(y=parseInt(y[4],16),isNaN(y))throw"dicomParser.isPrivateTag: cannot parse last character of group";return y%2==1},H=function(y){if(y!==void 0)return y=y.split("^"),{familyName:y[0],givenName:y[1],middleName:y[2],prefix:y[3],suffix:y[4]}};function N(y,_){if(2<=y.length){var S=parseInt(y.substring(0,2),10),b=4<=y.length?parseInt(y.substring(2,4),10):void 0,D=6<=y.length?parseInt(y.substring(4,6),10):void 0,q=8<=y.length?y.substring(7,13):void 0,q=q?parseInt(q,10)*Math.pow(10,6-q.length):void 0;if(_&&(isNaN(S)||b!==void 0&&isNaN(b)||D!==void 0&&isNaN(D)||q!==void 0&&isNaN(q)||S<0||23<S||b&&(b<0||59<b)||D&&(D<0||59<D)||q&&(q<0||999999<q)))throw"invalid TM '".concat(y,"'");return{hours:S,minutes:b,seconds:D,fractionalSeconds:q}}if(_)throw"invalid TM '".concat(y,"'")}function Y(y,_,S){return!isNaN(S)&&0<_&&_<=12&&0<y&&y<=(function(b,D){switch(b){case 2:return D%4==0&&D%100||D%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}})(_,S)}function Z(y,_){if(y&&y.length===8){var S=parseInt(y.substring(0,4),10),b=parseInt(y.substring(4,6),10),D=parseInt(y.substring(6,8),10);if(_&&Y(D,b,S)!==!0)throw"invalid DA '".concat(y,"'");return{year:S,month:b,day:D}}if(_)throw"invalid DA '".concat(y,"'")}function re(y,_){if(y===void 0||_===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(_.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var S,b=_.vr,D=_.tag;function q(ve,$e){for(var Ve="",ke=0;ke<ve;ke++)ke!==0&&(Ve+="/"),Ve+=$e.call(y,D,ke).toString();return Ve}if(O(b)===!0)S=y.string(D);else{if(b==="AT"){var te=y.uint32(D);return te===void 0?void 0:"x".concat((te=te<0?4294967295+te+1:te).toString(16).toUpperCase())}b==="US"?S=q(_.length/2,y.uint16):b==="SS"?S=q(_.length/2,y.int16):b==="UL"?S=q(_.length/4,y.uint32):b==="SL"?S=q(_.length/4,y.int32):b==="FD"?S=q(_.length/8,y.double):b==="FL"&&(S=q(_.length/4,y.float))}return S}function oe(y,_){if(y===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";_=_||{omitPrivateAttibutes:!0,maxElementLength:128};var S,b={};for(S in y.elements){var D=y.elements[S];if(_.omitPrivateAttibutes!==!0||!j(S))if(D.items){for(var q=[],te=0;te<D.items.length;te++)q.push(oe(D.items[te].dataSet,_));b[S]=q}else{var ve=void 0;D.length<_.maxElementLength&&(ve=re(y,D)),b[S]=ve!==void 0?ve:{dataOffset:D.dataOffset,length:D.length}}}return b}function ie(y,_){return y.byteArray[_]===255&&y.byteArray[_+1]===217}function ce(y,_,S){for(var b,D,q=S;q<_.fragments.length;q++)if(b=y,D=q,D=_.fragments[D],!(!ie(b,D.position+D.length-2)&&!ie(b,D.position+D.length-3)))return q}function pe(y,_,S){if(y===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(_===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(_.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(_.encapsulatedPixelData!==!0||_.hadUndefinedLength!==!0||_.basicOffsetTable===void 0||_.fragments===void 0||_.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(S&&S.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";S=S||_.fragments;for(var b=[],D=0;;){b.push(_.fragments[D].offset);var q=ce(y,_,D);if(q===void 0||q===_.fragments.length-1)return b;D=q+1}}function me(S){if(S===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var _=256*S.readUint16()*256,S=S.readUint16();return"x".concat("00000000".concat((_+S).toString(16)).substr(-8))}function we(y,_,S){if(y===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(_===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(_.encapsulatedPixelData=!0,_.basicOffsetTable=[],_.fragments=[],me(y)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var b=y.readUint32()/4,D=0;D<b;D++){var q=y.readUint32();_.basicOffsetTable.push(q)}for(var te=y.position;y.position<y.byteArray.length;){var ve=me(y),$e=y.readUint32();if(ve==="xfffee0dd")return y.seek($e),void(_.length=y.position-_.dataOffset);if(ve!=="xfffee000")return S&&S.push("unexpected tag ".concat(ve," while searching for end of pixel data element with undefined length")),$e>y.byteArray.length-y.position&&($e=y.byteArray.length-y.position),_.fragments.push({offset:y.position-te-8,position:y.position,length:$e}),y.seek($e),void(_.length=y.position-_.dataOffset);_.fragments.push({offset:y.position-te-8,position:y.position,length:$e}),y.seek($e)}S&&S.push("pixel data element ".concat(_.tag," missing sequence delimiter tag xfffee0dd"))}function je(y,_){if(y===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var S=y.byteArray.length-8;y.position<=S;)if(y.readUint16()===65534){var b=y.readUint16();if(b===57565)return y.readUint32()!==0&&y.warnings("encountered non zero length following item delimiter at position ".concat(y.position-4," while reading element of undefined length with tag ").concat(_.tag)),void(_.length=y.position-_.dataOffset)}_.length=y.byteArray.length-_.dataOffset,y.seek(y.byteArray.length-y.position)}function fe(y,_,S){if(S<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(_+S>y.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var b,D="",q=0;q<S;q++){if((b=y[_+q])===0)return _+=S,D;D+=String.fromCharCode(b)}return D}function _e(y,_){for(var S=0;S<_.length;S++){var b=_[S];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}function he(y,_){return y.parser!==void 0?y.parser:_}var Te=(function(){function y(b,D,q){(function(te,ve){if(!(te instanceof ve))throw new TypeError("Cannot call a class as a function")})(this,y),this.byteArrayParser=b,this.byteArray=D,this.elements=q}var _,S;return _=y,(S=[{key:"uint16",value:function(b,D){if(b=this.elements[b],D=D!==void 0?D:0,b&&b.length!==0)return he(b,this.byteArrayParser).readUint16(this.byteArray,b.dataOffset+2*D)}},{key:"int16",value:function(b,D){if(b=this.elements[b],D=D!==void 0?D:0,b&&b.length!==0)return he(b,this.byteArrayParser).readInt16(this.byteArray,b.dataOffset+2*D)}},{key:"uint32",value:function(b,D){if(b=this.elements[b],D=D!==void 0?D:0,b&&b.length!==0)return he(b,this.byteArrayParser).readUint32(this.byteArray,b.dataOffset+4*D)}},{key:"int32",value:function(b,D){if(b=this.elements[b],D=D!==void 0?D:0,b&&b.length!==0)return he(b,this.byteArrayParser).readInt32(this.byteArray,b.dataOffset+4*D)}},{key:"float",value:function(b,D){if(b=this.elements[b],D=D!==void 0?D:0,b&&b.length!==0)return he(b,this.byteArrayParser).readFloat(this.byteArray,b.dataOffset+4*D)}},{key:"double",value:function(b,D){if(b=this.elements[b],D=D!==void 0?D:0,b&&b.length!==0)return he(b,this.byteArrayParser).readDouble(this.byteArray,b.dataOffset+8*D)}},{key:"numStringValues",value:function(b){if(b=this.elements[b],b&&0<b.length)return b=fe(this.byteArray,b.dataOffset,b.length).match(/\\/g),b===null?1:b.length+1}},{key:"string",value:function(b,D){if(b=this.elements[b],b&&b.Value)return b.Value;if(b&&0<b.length)return b=fe(this.byteArray,b.dataOffset,b.length),0<=D?b.split("\\")[D].trim():b.trim()}},{key:"text",value:function(b,D){if(b=this.elements[b],b&&0<b.length)return b=fe(this.byteArray,b.dataOffset,b.length),0<=D?b.split("\\")[D].replace(/ +$/,""):b.replace(/ +$/,"")}},{key:"floatString",value:function(b,D){var q=this.elements[b];if(q&&0<q.length&&(D=this.string(b,D=D!==void 0?D:0),D!==void 0))return parseFloat(D)}},{key:"intString",value:function(b,D){var q=this.elements[b];if(q&&0<q.length&&(D=this.string(b,D=D!==void 0?D:0),D!==void 0))return parseInt(D)}},{key:"attributeTag",value:function(b){var D=this.elements[b];if(D&&D.length===4){var q=he(D,this.byteArrayParser).readUint16,b=this.byteArray,D=D.dataOffset;return"x".concat("00000000".concat((256*q(b,D)*256+q(b,D+2)).toString(16)).substr(-8))}}}])&&_e(_.prototype,S),Object.defineProperty(_,"prototype",{writable:!1}),y})();function Ne(y,_){if(y===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var S=y.byteArray.length-8;y.position<=S;)if(y.readUint16()===65534){var b=y.readUint16();if(b===57357)return y.readUint32()!==0&&y.warnings("encountered non zero length following item delimiter at position ".concat(y.position-4," while reading element of undefined length with tag ").concat(_.tag)),void(_.length=y.position-_.dataOffset)}_.length=y.byteArray.length-_.dataOffset,y.seek(y.byteArray.length-y.position)}var qe=function(y,_){return y.vr!==void 0?y.vr==="SQ":_.position+4<=_.byteArray.length?(y=me(_),_.seek(-4),y==="xfffee000"||y==="xfffee0dd"):(_.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function ue(y,_,S){if(y===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var b=me(y),b={tag:b,vr:S!==void 0?S(b):void 0,length:y.readUint32(),dataOffset:y.position};return b.length===4294967295&&(b.hadUndefinedLength=!0),b.tag===_||(!qe(b,y)||j(b.tag)&&!b.hadUndefinedLength?b.hadUndefinedLength?Ne(y,b):y.seek(b.length):(Se(y,b,S),j(b.tag)&&(b.items=void 0))),b}function De(y){if(y===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var _={tag:me(y),length:y.readUint32(),dataOffset:y.position};if(_.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(y.position);return _}function Fe(y,_){var S=De(y);return S.length===4294967295?(S.hadUndefinedLength=!0,S.dataSet=(function(b,D){for(var q={};b.position<b.byteArray.length;){var te=ue(b,void 0,D);if((q[te.tag]=te).tag==="xfffee00d")return new Te(b.byteArrayParser,b.byteArray,q)}return b.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new Te(b.byteArrayParser,b.byteArray,q)})(y,_),S.length=y.position-S.dataOffset):(S.dataSet=new Te(y.byteArrayParser,y.byteArray,{}),Re(S.dataSet,y,y.position+S.length,{vrCallback:_})),S}function Se(y,_,S){if(y===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(_===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";_.items=[],(_.length===4294967295?function(b,D,q){for(;b.position+4<=b.byteArray.length;){var te=me(b);if(b.seek(-4),te==="xfffee0dd")return D.length=b.position-D.dataOffset,b.seek(8);te=Fe(b,q),D.items.push(te)}b.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),D.length=b.byteArray.length-D.dataOffset}:function(b,D,q){for(var te=D.dataOffset+D.length;b.position<te;){var ve=Fe(b,q);D.items.push(ve)}})(y,_,S)}function He(y,_){var S=De(y);return S.length===4294967295?(S.hadUndefinedLength=!0,S.dataSet=(function(b,D){for(var q={};b.position<b.byteArray.length;){var te=Ie(b,D);if((q[te.tag]=te).tag==="xfffee00d")return new Te(b.byteArrayParser,b.byteArray,q)}return D.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new Te(b.byteArrayParser,b.byteArray,q)})(y,_),S.length=y.position-S.dataOffset):(S.dataSet=new Te(y.byteArrayParser,y.byteArray,{}),Je(S.dataSet,y,y.position+S.length)),S}function Ee(y,_,S){if(y===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(_===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";_.items=[],(_.length===4294967295?function(b,D,q){for(;b.position+4<=b.byteArray.length;){var te=me(b);if(b.seek(-4),te==="xfffee0dd")return D.length=b.position-D.dataOffset,b.seek(8);te=He(b,q),D.items.push(te)}q.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),D.length=b.position-D.dataOffset}:function(b,D,q){for(var te=D.dataOffset+D.length;b.position<te;){var ve=He(b,q);D.items.push(ve)}})(y,_,S)}var Pe=function(y){return y==="OB"||y==="OD"||y==="OL"||y==="OW"||y==="SQ"||y==="OF"||y==="UC"||y==="UR"||y==="UT"||y==="UN"?4:2};function Ie(y,_,S){if(y===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var b={tag:me(y),vr:y.readFixedString(2)};return Pe(b.vr)===2?b.length=y.readUint16():(y.seek(2),b.length=y.readUint32()),b.dataOffset=y.position,b.length===4294967295&&(b.hadUndefinedLength=!0),b.tag===S||(b.vr==="SQ"?Ee(y,b,_):b.length===4294967295?b.tag==="x7fe00010"?we(y,b,_):(b.vr==="UN"?Se:Ne)(y,b):y.seek(b.length)),b}function Je(y,_,S){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(S=S===void 0?_.byteArray.length:S,_===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(S<_.position||S>_.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var D=y.elements;_.position<S;){var q=Ie(_,y.warnings,b.untilTag);if((D[q.tag]=q).tag===b.untilTag)return}if(_.position>S)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function Re(y,_,S){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(S=S===void 0?y.byteArray.length:S,_===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(S<_.position||S>_.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var D=y.elements;_.position<S;){var q=ue(_,b.untilTag,b.vrCallback);if((D[q.tag]=q).tag===b.untilTag)return}}function At(y,_){if(typeof Buffer<"u"&&y instanceof Buffer)return Buffer.alloc(_);if(y instanceof Uint8Array)return new Uint8Array(_);throw"dicomParser.alloc: unknown type for byteArray"}var Jt="1.8.12",Ht={readUint16:function(y,_){if(_<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(_+2>y.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(y[_]<<8)+y[_+1]},readInt16:function(y,_){if(_<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(_+2>y.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return _=(y[_]<<8)+y[_+1],_=32768&_?_-65535-1:_},readUint32:function(y,_){if(_<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(_+4>y.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*y[_]+y[_+1])+y[_+2])+y[_+3]},readInt32:function(y,_){if(_<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(_+4>y.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(y[_]<<24)+(y[_+1]<<16)+(y[_+2]<<8)+y[_+3]},readFloat:function(y,_){if(_<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(_+4>y.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var S=new Uint8Array(4);return S[3]=y[_],S[2]=y[_+1],S[1]=y[_+2],S[0]=y[_+3],new Float32Array(S.buffer)[0]},readDouble:function(y,_){if(_<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(_+8>y.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var S=new Uint8Array(8);return S[7]=y[_],S[6]=y[_+1],S[5]=y[_+2],S[4]=y[_+3],S[3]=y[_+4],S[2]=y[_+5],S[1]=y[_+6],S[0]=y[_+7],new Float64Array(S.buffer)[0]}};function Qe(y,_,S){if(typeof Buffer<"u"&&y instanceof Buffer)return y.slice(_,_+S);if(y instanceof Uint8Array)return new Uint8Array(y.buffer,y.byteOffset+_,S);throw"dicomParser.from: unknown type for byteArray"}function Ot(y,_){for(var S=0;S<_.length;S++){var b=_[S];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}var yt=(function(){function y(b,D,q){if((function(te,ve){if(!(te instanceof ve))throw new TypeError("Cannot call a class as a function")})(this,y),b===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(D===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(D instanceof Uint8Array)&&(typeof Buffer>"u"||!(D instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(q<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(q>=D.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=b,this.byteArray=D,this.position=q||0,this.warnings=[]}var _,S;return _=y,(S=[{key:"seek",value:function(b){if(this.position+b<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=b}},{key:"readByteStream",value:function(b){if(this.position+b>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var D=Qe(this.byteArray,this.position,b);return this.position+=b,new y(this.byteArrayParser,D)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var b=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,b}},{key:"readUint32",value:function(){var b=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,b}},{key:"readFixedString",value:function(b){var D=fe(this.byteArray,this.position,b);return this.position+=b,D}}])&&Ot(_.prototype,S),Object.defineProperty(_,"prototype",{writable:!1}),y})(),mt={readUint16:function(y,_){if(_<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(_+2>y.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return y[_]+256*y[_+1]},readInt16:function(y,_){if(_<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(_+2>y.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return _=y[_]+(y[_+1]<<8),_=32768&_?_-65535-1:_},readUint32:function(y,_){if(_<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(_+4>y.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return y[_]+256*y[_+1]+256*y[_+2]*256+256*y[_+3]*256*256},readInt32:function(y,_){if(_<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(_+4>y.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return y[_]+(y[_+1]<<8)+(y[_+2]<<16)+(y[_+3]<<24)},readFloat:function(y,_){if(_<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(_+4>y.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var S=new Uint8Array(4);return S[0]=y[_],S[1]=y[_+1],S[2]=y[_+2],S[3]=y[_+3],new Float32Array(S.buffer)[0]},readDouble:function(y,_){if(_<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(_+8>y.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var S=new Uint8Array(8);return S[0]=y[_],S[1]=y[_+1],S[2]=y[_+2],S[3]=y[_+3],S[4]=y[_+4],S[5]=y[_+5],S[6]=y[_+6],S[7]=y[_+7],new Float64Array(S.buffer)[0]}};function Zt(y){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(y===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var S=_.TransferSyntaxUID,b=new yt(mt,y);return(function(){var D=(function(){if(b.getSize()<=132&&S)return!1;if(b.seek(128),b.readFixedString(4)==="DICM")return!0;if(!(_||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return b.seek(0),!1})(),q=[],te={};if(!D)return b.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:S}},warnings:q};for(;b.position<b.byteArray.length;){var ve=b.position,$e=Ie(b,q);if("x0002ffff"<$e.tag){b.position=ve;break}$e.parser=mt,te[$e.tag]=$e}return(D=new Te(b.byteArrayParser,b.byteArray,te)).warnings=b.warnings,D.position=b.position,D})()}var Sr="1.2.840.10008.1.2.2";function sr(y){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(y===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var S,b=function(q){if(q.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return q=q.elements.x00020010,q&&q.Value||fe(y,q.dataOffset,q.length)};function D($e){var ve=b($e),te=ve!=="1.2.840.10008.1.2",ve=(function(Ve,ke){var st=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(Ve!=="1.2.840.10008.1.2.1.99")return new yt(Ve===Sr?Ht:mt,y,ke);if(_&&_.inflater)return Ve=_.inflater(y,ke),new yt(mt,Ve,0);if(st==!0){var Ce=C(0),Me=Qe(y,ke,y.length-ke),Ce=Ce.inflateRawSync(Me),Me=At(y,Ce.length+ke);return y.copy(Me,0,0,ke),Ce.copy(Me,ke),new yt(mt,Me,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return Ce=y.slice(ke),Me=pako.inflateRaw(Ce),(Ce=At(y,Me.length+ke)).set(y.slice(0,ke),0),Ce.set(Me,ke),new yt(mt,Ce,0)})(ve,$e.position),$e=new Te(ve.byteArrayParser,ve.byteArray,{});$e.warnings=ve.warnings;try{(te?Je:Re)($e,ve,ve.byteArray.length,_)}catch(Ve){throw{exception:Ve,dataSet:$e}}return $e}return(function(q,te){for(var ve in q.elements)q.elements.hasOwnProperty(ve)&&(te.elements[ve]=q.elements[ve]);return q.warnings!==void 0&&(te.warnings=q.warnings.concat(te.warnings)),te})(S=Zt(y,_),D(S))}var ht=function(y,_,S){for(var b=0,D=_;D<_+S;D++)b+=y[D].length;return b};function Ke(y,te,S,b,D){if(D=D||te.fragments,y===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(te===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(S===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((b=b||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(te.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(te.encapsulatedPixelData!==!0||te.hadUndefinedLength!==!0||te.basicOffsetTable===void 0||te.fragments===void 0||te.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(S<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(S>=te.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(b<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(S+b>te.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var q=new yt(y.byteArrayParser,y.byteArray,te.dataOffset),te=De(q);if(te.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";q.seek(te.length);var ve=q.position;if(b===1)return Qe(q.byteArray,ve+D[S].offset+8,D[S].length);for(var te=ht(D,S,b),$e=At(q.byteArray,te),Ve=0,ke=S;ke<S+b;ke++)for(var st=ve+D[ke].offset+8,Ce=0;Ce<D[ke].length;Ce++)$e[Ve++]=q.byteArray[st++];return $e}var Lt=function(y,_){for(var S=0;S<y.length;S++)if(y[S].offset===_)return S},Ut=function(y,_,S,b){if(y===_.length-1)return S.length-b;for(var D=_[y+1],q=b+1;q<S.length;q++)if(S[q].offset===D)return q-b;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function ot(y,_,S,b,D){if(b=b||_.basicOffsetTable,D=D||_.fragments,y===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(_===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(S===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(b===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(_.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(_.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(_.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(_.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(b.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(S<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(S>=b.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var q=b[S],q=Lt(D,q);if(q===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Ke(y,_,q,Ut(S,b,D,q),D)}var Ft=!1;function ur(y,_,S){if(Ft||(Ft=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),y===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(_===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(S===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(_.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(_.encapsulatedPixelData!==!0||_.hadUndefinedLength!==!0||_.basicOffsetTable===void 0||_.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(S<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return _.basicOffsetTable.length!==0?ot(y,_,S):Ke(y,_,0,_.fragments.length)}w.default={isStringVr:O,isPrivateTag:j,parsePN:H,parseTM:N,parseDA:Z,explicitElementToString:re,explicitDataSetToJS:oe,createJPEGBasicOffsetTable:pe,parseDicomDataSetExplicit:Je,parseDicomDataSetImplicit:Re,readFixedString:fe,alloc:At,version:Jt,bigEndianByteArrayParser:Ht,ByteStream:yt,sharedCopy:Qe,DataSet:Te,findAndSetUNElementLength:je,findEndOfEncapsulatedElement:we,findItemDelimitationItemAndSetElementLength:Ne,littleEndianByteArrayParser:mt,parseDicom:sr,readDicomElementExplicit:Ie,readDicomElementImplicit:ue,readEncapsulatedImageFrame:ot,readEncapsulatedPixelData:ur,readEncapsulatedPixelDataFromFragments:Ke,readPart10Header:Zt,readSequenceItemsExplicit:Ee,readSequenceItemsImplicit:Se,readSequenceItem:De,readTag:me,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],r={},o.m=h,o.c=r,o.d=function(g,w,C){o.o(g,w)||Object.defineProperty(g,w,{enumerable:!0,get:C})},o.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},o.t=function(g,w){if(1&w&&(g=o(g)),8&w||4&w&&typeof g=="object"&&g&&g.__esModule)return g;var C=Object.create(null);if(o.r(C),Object.defineProperty(C,"default",{enumerable:!0,value:g}),2&w&&typeof g!="string")for(var U in g)o.d(C,U,(function(O){return g[O]}).bind(null,U));return C},o.n=function(g){var w=g&&g.__esModule?function(){return g.default}:function(){return g};return o.d(w,"a",w),w},o.o=function(g,w){return Object.prototype.hasOwnProperty.call(g,w)},o.p="",o(o.s=1);function o(g){if(r[g])return r[g].exports;var w=r[g]={i:g,l:!1,exports:{}};return h[g].call(w.exports,w,w.exports,o),w.l=!0,w.exports}var h,r})})(ii)),ii.exports}var Nt=Ao();function Zn(e){const i=e.indexOf(":");let a=e.substring(i+1);const o=a.indexOf("frame=");let h;if(o!==-1){const w=a.substring(o+6);h=parseInt(w,10),a=a.substring(0,o-1)}const r=e.substring(0,i),g=h!==void 0?h-1:void 0;return{scheme:r,url:a,frame:h,pixelDataFrame:g}}let Ei={open(e,i){e.open("get",i,!0)},beforeSend:async()=>{},beforeProcessing(e){return Promise.resolve(e.response)},imageCreated(){},strict:!1};function ba(e){Ei=Object.assign(Ei,e)}function ei(){return Ei}function li(e,i,a={},o={}){const h=ei(),r=C=>{if(typeof h.errorInterceptor=="function"){const U=new Error("request failed");U.request=C,U.response=C.response,U.status=C.status,h.errorInterceptor(U)}},g=new XMLHttpRequest,w=new Promise(async(C,U)=>{h.open(g,e,a,o);const O=await h.beforeSend(g,i,a,o);g.responseType="arraybuffer";const j=Object.assign({},a,O);Object.keys(j).forEach(function(H){j[H]!==null&&(H==="Accept"&&e.indexOf("accept=")!==-1||g.setRequestHeader(H,j[H]))}),o.deferred={resolve:C,reject:U},o.url=e,o.imageId=i,g.onloadstart=function(H){h.onloadstart&&h.onloadstart(H,o),Hn(Vn,"cornerstoneimageloadstart",{url:e,imageId:i})},g.onloadend=function(H){h.onloadend&&h.onloadend(H,o),Hn(Vn,"cornerstoneimageloadend",{url:e,imageId:i})},g.onreadystatechange=function(H){h.onreadystatechange&&h.onreadystatechange(H,o),g.readyState===4&&(g.status===200||g.status===206?h.beforeProcessing(g).then(C).catch(()=>{r(g),U(g)}):(r(g),U(g)))},g.onprogress=function(H){const N=H.loaded;let Y,Z;H.lengthComputable&&(Y=H.total,Z=Math.round(N/Y*100)),Hn(Vn,"cornerstoneimageloadprogress",{url:e,imageId:i,loaded:N,total:Y,percentComplete:Z}),h.onprogress&&h.onprogress(H,o)},g.onerror=function(){r(g),U(g)},g.onabort=function(){r(g),U(g)},g.send()});return w.xhr=g,w}function Co(e,i,a){if(a+e.length>i.length)return!1;let o=a;for(let h=0;h<e.length;h++)if(e[h]!==i[o++])return!1;return!0}function So(e){const i=new Uint8Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=e.charCodeAt(a);return i}function xi(e,i,a){a=a||0;const o=So(i);for(let h=a;h<e.length;h++)if(o[0]===e[h]&&Co(o,e,h))return h;return-1}const{ImageQualityStatus:Gi}=gn;function $i(e,i,a){a||={};const o=new Uint8Array(i),h=!!a?.isPartial;if(e.indexOf("multipart")===-1)return{contentType:e,imageQualityStatus:h?Gi.SUBRESOLUTION:Gi.FULL_RESOLUTION,pixelData:o};let{tokenIndex:r,responseHeaders:g,boundary:w,multipartContentType:C}=a;if(r||=xi(o,`\r
\r
`),r===-1)throw new Error("invalid response - no multipart mime header");if(!w&&(g=Io(o,0,r).split(`\r
`),w=Ro(g),!w))throw new Error("invalid response - no boundary marker");const U=r+4,O=xi(o,w,U);if(O===-1&&!h)throw new Error("invalid response - terminating boundary not found");return C||=Do(g),a.tokenIndex=r,a.boundary=w,a.responseHeaders=g,a.multipartContentType=C,a.isPartial=O===-1,{contentType:C,extractDone:!h||O!==-1,tokenIndex:r,responseHeaders:g,boundary:w,multipartContentType:C,pixelData:i.slice(U,O-2)}}function Ro(e){for(let i=0;i<e.length;i++)if(e[i].substr(0,2)==="--")return e[i]}function Do(e){for(let i=0;i<e.length;i++)if(e[i].substr(0,13)==="Content-Type:")return e[i].substr(13).trim()}function Io(e,i,a){i=i||0,a=a||e.length-i;let o="";for(let h=i;h<i+a;h++)o+=String.fromCharCode(e[h]);return o}const{ImageQualityStatus:qi}=gn;function Oi(e,i=!0){return i?e.imageQualityStatus??qi.FULL_RESOLUTION:qi.SUBRESOLUTION}const{ProgressiveIterator:$o}=la;function Pa(e,i,a={},o={}){const h=ei(),{retrieveOptions:r={},streamingData:g={}}=o,w=r.minChunkSize||128*1024,C=O=>{if(typeof h.errorInterceptor=="function"){const j=new Error("request failed");h.errorInterceptor(j)}},U=new $o("streamRequest");return U.generate(async(O,j)=>{const H=await h.beforeSend?.(null,e,a,{}),N=Object.assign({},a,H);Object.keys(N).forEach(function(Y){N[Y]===null&&(N[Y]=void 0),Y==="Accept"&&e.indexOf("accept=")!==-1&&(N[Y]=void 0)});try{const Y=await fetch(e,{headers:N,signal:void 0});if(Y.status!==200)throw new Error(`Couldn't retrieve ${e} got status ${Y.status}`);const Z=Y.body.getReader(),re=Y.headers,oe=re.get("content-type"),ie=Number(re.get("Content-Length"));let ce=!1,pe=g.encodedData,me=g.lastSize||0;for(g.isPartial=!0;!ce;){const{done:we,value:je}=await Z.read();if(pe=Oo(pe,je),!pe){if(ce)throw new Error(`Done but no image frame available ${i}`);continue}if(ce=we||pe.byteLength===ie,!ce&&pe.length<me+w)continue;me=pe.length,g.isPartial=!we;const fe=$i(oe,pe,g),_e=Oi(r,ce),he={url:e,imageId:i,...fe,percentComplete:we?100:fe.pixelData?.length*100/ie,imageQualityStatus:_e,done:ce};O.add(he,ce)}}catch(Y){C(),console.error(Y),j(Y)}}),U.getNextPromise()}function Oo(e,i){if(!e)return i;if(!i)return e;const a=new Uint8Array(e.length+i.length);return a.set(e,0),a.set(i,e.length),a}const Lo={xhrRequest:li,streamRequest:Pa,setOptions:ba,getOptions:ei};function Uo(e){const i=e.elements.x7fe00010.fragments,a=e.byteArray.length;for(const o of i){const{position:h,length:r}=o;r>a-h&&(console.log(`Truncated fragment, changing fragment length from ${o.length} to ${a-h}`),o.length=a-h)}return e}function Fo(e){let i=Nt.parseDicom(e,{untilTag:"x7fe00010"});i.elements.x7fe00010||console.warn("Pixel data not found!");let a;try{a=Nt.parseDicom(e)}catch(o){console.error(o),console.log("pixel data dataset:",o.dataSet),a=o.dataSet}return i.elements.x7fe00010=a.elements.x7fe00010,i=Uo(i),i}async function wa(e,i,a){const o=Fo(e),{uri:h,imageId:r,fileTotalLength:g}=a;return o.fetchMore=async function(w){const C=Object.assign({uri:h,imageId:r,fetchedLength:e.length,lengthToFetch:g-e.length},w),{fetchedLength:U,lengthToFetch:O}=C,{arrayBuffer:j}=await i(h,r,{byteRange:`${U}-${U+O}`}),H=new Uint8Array(j),N=new Uint8Array(o.byteArray.length+H.length);return N.set(o.byteArray),N.set(H,o.byteArray.length),wa(N,i,a)},o}function ko(e,i){if(!e)return;const{NumberOfFrames:a,PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:h}=Ea(e);if(o||a>1){const{shared:r,perFrame:g}=Ta(o,h,i);return{NumberOfFrames:a,PerFrameFunctionalInformation:g,SharedFunctionalInformation:r}}return{NumberOfFrames:a}}function Ta(e,i,a){const o={};(i?Object.values(i.items[0].dataSet.elements):[]).map(r=>o[r.tag]=r);const h={};return(e?Object.values(e.items[a-1].dataSet.elements):[]).map(r=>h[r.tag]=r),{shared:o,perFrame:h}}function Ea(e){if(!e)return;const{elements:i,...a}=e,{x52009230:o,x52009229:h,...r}=i;return{NumberOfFrames:e.intString("x00280008"),PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:h,otherElements:r,otherAttributtes:a}}function Mo(e,i){if(!i)return;const{NumberOfFrames:a,PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:h,otherElements:r}=Ea(i);if(o||a>1){const{shared:g,perFrame:w}=Ta(o,h,e),C={elements:{...r,...g,...w}},U=Object.create(i);return Object.assign(U,C)}return i}let pt={};const jo=()=>{pt={}};function Li(e){if(pt[e])return pt[e]}function Wo(e){const i=Li(e);return xa(i)}function xa(e){if(!e)return!1;const i=e.intString("x00280008");return i&&i>1}function No(e){return e.indexOf("&frame=")}function Ho(e){const i=No(e),a=i===-1?e:e.slice(0,i),o=parseInt(e.slice(i+7),10)||1;let h;return pt[a]?h=pt[a].dataSet:h=void 0,{dataSet:h,frame:o}}function Vo(e){const i=[],a=Li(e);if(xa(a)){const o=a.intString("x00280008");for(let h=1;h<=o;h++)i.push(`${e}&frame=${h}`)}else i.push(e);return i}const Aa={_get:Li,generateMultiframeWADOURIs:Vo,retrieveMultiframeDataset:Ho,isMultiframeDataset:Wo};let qn=0,jn={};function Bo(e){return pt[e]!==void 0}function Go(e){let i;if(e.includes("&frame=")){const{frame:a,dataSet:o}=Aa.retrieveMultiframeDataset(e);i=Mo(a,o)}else pt[e]&&(i=pt[e].dataSet);return i}function qo(e,i){const a=pt[e];if(!a){console.error(`No loaded dataSet for uri ${e}`);return}qn-=a.dataSet.byteArray.length,a.dataSet=i,qn+=i.byteArray.length,Hn(Vn,"datasetscachechanged",{uri:e,action:"updated",cacheInfo:ci()})}function Jo(e,i=li,a){if(pt[e])return new Promise(r=>{pt[e].cacheCount++,r(pt[e].dataSet)});if(jn[e])return jn[e].cacheCount++,jn[e];const o=i(e,a),h=new Promise((r,g)=>{o.then(async function(w){const C={isPartialContent:!1,fileTotalLength:null};if(!(w instanceof ArrayBuffer)){if(!w.arrayBuffer)return g(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));C.isPartialContent=w.flags.isPartialContent,C.fileTotalLength=w.flags.fileTotalLength,w=w.arrayBuffer}const U=new Uint8Array(w);let O;try{C.isPartialContent?O=await wa(U,i,{uri:e,imageId:a,fileTotalLength:C.fileTotalLength}):O=Nt.parseDicom(U)}catch(j){return g(j)}pt[e]={dataSet:O,cacheCount:h.cacheCount},qn+=O.byteArray.length,r(O),Hn(Vn,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:ci()})},g).then(()=>{delete jn[e]},()=>{delete jn[e]})});return h.cacheCount=1,jn[e]=h,h}function zo(e){pt[e]&&(pt[e].cacheCount--,pt[e].cacheCount===0&&(qn-=pt[e].dataSet.byteArray.length,delete pt[e],Hn(Vn,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:ci()})))}function ci(){return{cacheSizeInBytes:qn,numberOfDataSetsCached:Object.keys(pt).length}}function Yo(){jo(),jn={},qn=0}const Bn={isLoaded:Bo,load:Jo,unload:zo,getInfo:ci,purge:Yo,get:Go,update:qo};function Xo(e){const i=[];for(let a=0;a<=30;a+=2){let o=`x60${a.toString(16)}`;o.length===4&&(o=`x600${a.toString(16)}`);const h=e.elements[`${o}3000`];if(!h)continue;const r=[];for(let g=0;g<h.length;g++)for(let w=0;w<8;w++){const C=e.byteArray[h.dataOffset+g];r[g*8+w]=C>>w&1}i.push({rows:e.uint16(`${o}0010`),columns:e.uint16(`${o}0011`),type:e.string(`${o}0040`),x:e.int16(`${o}0050`,1)-1,y:e.int16(`${o}0050`,0)-1,pixelData:r,description:e.string(`${o}0022`),label:e.string(`${o}1500`),roiArea:e.string(`${o}1301`),roiMean:e.string(`${o}1302`),roiStandardDeviation:e.string(`${o}1303`)})}return{overlays:i}}function Jn(e){return e==="RECON TOMO"||e==="RECON GATED TOMO"}function Ui(e,i){const a=e.string("x00080008");if(a){const o=a.split("\\");if(o.length>i)return o[i]}}function Qo(e){let i;if(e.string("x00080060")?.includes("NM")){const o=Ui(e,2);o&&Jn(o)&&e.elements.x00540022&&(i=hr(e.elements.x00540022.items[0].dataSet,"x00200037",6))}return i}function Ko(e){let i;if(e.string("x00080060")?.includes("NM")){const o=Ui(e,2);o&&Jn(o)&&e.elements.x00540022&&(i=hr(e.elements.x00540022.items[0].dataSet,"x00200032",3))}return i}function Ji(e){let i=hr(e,"x00200037",6);return!i&&e.elements.x00209116?.items?.[0]?.dataSet&&(i=hr(e.elements.x00209116.items[0].dataSet,"x00200037",6)),i||(i=Qo(e)),i}function zi(e){let i=hr(e,"x00200032",3);return!i&&e.elements.x00209113?.items?.[0]?.dataSet&&(i=hr(e.elements.x00209113.items[0].dataSet,"x00200032",3)),i||(i=Ko(e)),i}function Yi(e){let i=hr(e,"x00280030",2);return!i&&e.elements.x00289110?.items?.[0]?.dataSet&&(i=hr(e.elements.x00289110.items[0].dataSet,"x00280030",2)),i}function Xi(e){let i;return e.elements.x00180050?i=e.floatString("x00180050"):e.elements.x00289110&&e.elements.x00289110.items.length&&e.elements.x00289110.items[0].dataSet.elements.x00180050&&(i=e.elements.x00289110.items[0].dataSet.floatString("x00180050")),i}const Ca=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function Qi(e){const i=e.elements.x00186011;return!i||!i.items?[]:i.items.map(o=>{const h=o.dataSet.double("x0018602c"),r=o.dataSet.double("x0018602e"),g=o.dataSet.uint16("x00186024"),w=o.dataSet.uint16("x00186026"),C=o.dataSet.uint16("x0018601a"),U=o.dataSet.uint16("x0018601e"),O=o.dataSet.uint16("x00186018"),j=o.dataSet.uint16("x0018601c"),H=o.dataSet.int32("x00186020")||null,N=o.dataSet.int32("x00186022")||null,Y=o.dataSet.uint16("x0018602a"),Z=o.dataSet.uint16("x00186028"),re=o.dataSet.uint16("x00186012"),oe=o.dataSet.uint16("x00186014"),ie=o.dataSet.uint16("x00186016"),ce=o.dataSet.uint16("x00186030");return{regionLocationMinY0:C,regionLocationMaxY1:U,regionLocationMinX0:O,regionLocationMaxX1:j,referencePixelX0:H,referencePixelY0:N,physicalDeltaX:h,physicalDeltaY:r,physicalUnitsXDirection:g,physicalUnitsYDirection:w,referencePhysicalPixelValueY:Y,referencePhysicalPixelValueX:Z,regionSpatialFormat:re,regionDataType:oe,regionFlags:ie,transducerFrequency:ce}})}function Sa(e,i){const{MetadataModules:a}=gn;if(Array.isArray(i))return;const o=Zn(i);if(e===a.MULTIFRAME){const g=Aa.retrieveMultiframeDataset(o.url);return g.dataSet?ko(g.dataSet,g.frame):void 0}let h=o.url;o.frame&&(h=`${h}&frame=${o.frame}`);const r=Bn.get(h);if(r)return Ra(e,i,r)}function Ra(e,i,a){const{MetadataModules:o}=gn;if(e===o.GENERAL_STUDY)return{studyDescription:a.string("x00081030"),studyDate:Nt.parseDA(a.string("x00080020")),studyTime:Nt.parseTM(a.string("x00080030")||""),accessionNumber:a.string("x00080050")};if(e===o.GENERAL_SERIES)return{modality:a.string("x00080060"),seriesInstanceUID:a.string("x0020000e"),seriesDescription:a.string("x0008103e"),seriesNumber:a.intString("x00200011"),studyInstanceUID:a.string("x0020000d"),seriesDate:Nt.parseDA(a.string("x00080021")),seriesTime:Nt.parseTM(a.string("x00080031")||""),acquisitionDate:Nt.parseDA(a.string("x00080022")),acquisitionTime:Nt.parseTM(a.string("x00080032")||"")};if(e===o.GENERAL_IMAGE)return{sopInstanceUID:a.string("x00080018"),instanceNumber:a.intString("x00200013"),lossyImageCompression:a.string("x00282110"),lossyImageCompressionRatio:a.floatString("x00282112"),lossyImageCompressionMethod:a.string("x00282114")};if(e===o.PATIENT)return{patientID:a.string("x00100020"),patientName:a.string("x00100010")};if(e===o.PATIENT_STUDY)return{patientAge:a.intString("x00101010"),patientSize:a.floatString("x00101020"),patientSex:a.string("x00100040"),patientWeight:a.floatString("x00101030")};if(e===o.NM_MULTIFRAME_GEOMETRY){const h=a.string("x00080060"),r=Ui(a,2);return{modality:h,imageType:a.string("x00080008"),imageSubType:r,imageOrientationPatient:Ji(a),imagePositionPatient:zi(a),sliceThickness:Xi(a),pixelSpacing:Yi(a),numberOfFrames:a.uint16("x00280008"),isNMReconstructable:Jn(r)&&h.includes("NM")}}if(e===o.IMAGE_PLANE){const h=Ji(a),r=zi(a),g=Yi(a),w=Xi(a);let C=null,U=null,O=!1;g?(U=g[0],C=g[1]):(O=!0,U=1,C=1);let j=null,H=null;return h&&(j=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])],H=[parseFloat(h[3]),parseFloat(h[4]),parseFloat(h[5])]),{frameOfReferenceUID:a.string("x00200052"),rows:a.uint16("x00280010"),columns:a.uint16("x00280011"),imageOrientationPatient:h,rowCosines:j,columnCosines:H,imagePositionPatient:r,sliceThickness:w,sliceLocation:a.floatString("x00201041"),pixelSpacing:g,rowPixelSpacing:U,columnPixelSpacing:C,usingDefaultValues:O}}if(e===o.CINE)return{frameTime:a.floatString("x00181063")};if(e===o.IMAGE_PIXEL)return ma(a);if(e===o.VOI_LUT){const h=_a(a);return{windowCenter:hr(a,"x00281050",1),windowWidth:hr(a,"x00281051",1),voiLUTSequence:Ti(h,a.elements.x00283010),voiLUTFunction:a.string("x00281056")}}if(e===o.MODALITY_LUT)return{rescaleIntercept:a.floatString("x00281052"),rescaleSlope:a.floatString("x00281053"),rescaleType:a.string("x00281054"),modalityLUTSequence:Ti(a.uint16("x00280103"),a.elements.x00283000)};if(e===o.SOP_COMMON)return{sopClassUID:a.string("x00080016"),sopInstanceUID:a.string("x00080018")};if(e===o.PET_ISOTOPE){const h=a.elements.x00540016;if(h===void 0)return;const r=h.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Nt.parseTM(r.string("x00181072")||""),radionuclideTotalDose:r.floatString("x00181074"),radionuclideHalfLife:r.floatString("x00181075")}}}if(e===o.OVERLAY_PLANE)return Xo(a);if(e==="transferSyntax"){let h;try{h=a.string("x00020010")}catch{}return{transferSyntaxUID:h}}if(e===o.PET_SERIES)return{correctedImage:a.string("x00280051"),units:a.string("x00541001"),decayCorrection:a.string("x00541102")};if(e===o.PET_IMAGE)return{frameReferenceTime:a.floatString(a.string("x00541300")||""),actualFrameDuration:a.intString(a.string("x00181242"))};if(e===o.ULTRASOUND_ENHANCED_REGION)return Qi(a);if(e===o.CALIBRATION&&a.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:Qi(a)};if(e==="instance")return ca(i,Ca)}let fi=[];function Zo(e){return`dicomfile:${fi.push(e)-1}`}function es(e){return fi[e]}function ts(e){fi[e]=void 0}function rs(){fi=[]}const Da={add:Zo,get:es,remove:ts,purge:rs};function ns(e){const i=e.intString("x00280008"),a=e.elements.x7fe00010;return i!==a.fragments.length}function Ia(e,i){if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return Nt.readEncapsulatedImageFrame(e,e.elements.x7fe00010,i);if(ns(e)){const U=Nt.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return Nt.readEncapsulatedImageFrame(e,e.elements.x7fe00010,i,U)}const a=e.elements.x7fe00010.fragments,o=new Nt.ByteStream(e.byteArrayParser,e.byteArray,e.elements.x7fe00010.dataOffset),h=Nt.readSequenceItem(o);if(h.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";o.seek(h.length);const r=o.position;if(i+1>a.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const w=r+a[i].offset+8,C=a[i].length;return new Uint8Array(o.byteArray.buffer.slice(o.byteArray.byteOffset+w,o.byteArray.byteOffset+w+C))}function is(e,i){return e&1<<i}function $a(e,i,a){const o=new Uint8Array(a);for(let h=0;h<a;h++){const r=Math.floor(h/8),g=e[r+i],w=h%8;o[h]=is(g,w)?1:0}return o}function Oa(e,i){const a=e.elements.x7fe00010||e.elements.x7fe00008,o=e.uint16("x00280100"),h=e.uint16("x00280010"),r=e.uint16("x00280011");let g=e.uint16("x00280002");e.string("x00280004")==="YBR_FULL_422"&&(g=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const C=a.dataOffset,U=h*r*g;let O;if(o===8){if(O=C+i*U,O>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(O,O+U))}else if(o===16){if(O=C+i*U*2,O>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(O,O+U*2))}else if(o===1){if(O=C+i*U*.125,O>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return $a(e.byteArray,O,U)}else if(o===32){if(O=C+i*U*4,O>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(O,O+U*4))}throw new Error("unsupported pixel format")}function La(e){const i=Zn(e),a=parseInt(i.url,10),o=Da.get(a);return new Promise((h,r)=>{const g=new FileReader;g.onload=w=>{const C=w.target.result;h(C)},g.onerror=r,g.readAsArrayBuffer(o)})}function Fi(e,i=0){const a=e.elements.x7fe00010||e.elements.x7fe00008;return a?a.encapsulatedPixelData?Ia(e,i):Oa(e,i):null}function di(e){let i=e[0],a=e[0],o;const h=e.length;for(let r=1;r<h;r++)o=e[r],i=Math.min(i,o),a=Math.max(a,o);return{min:i,max:a}}function as(e,i,a){e.planarConfiguration===0?Ii(e.pixelData,i,a):ha(e.pixelData,i,a)}function os(e,i,a){e.planarConfiguration===0?ga(e.pixelData,i,a):va(e.pixelData,i,a)}function Ua(e,i,a){const{photometricInterpretation:o}=e;if(e.photometricInterpretation==="RGB")as(e,i,a);else if(o==="YBR_RCT"||o==="YBR_ICT"||o==="YBR_PARTIAL_420")Ii(e.pixelData,i,a);else if(e.photometricInterpretation==="PALETTE COLOR")ya(e,i,a);else if(e.photometricInterpretation==="YBR_FULL_422")bo(e.pixelData,i,a);else if(e.photometricInterpretation==="YBR_FULL")os(e,i,a);else throw new Error(`No color space conversion for photometric interpretation ${e.photometricInterpretation}`)}function ss(e){if(e===void 0)return!1;const{rows:i,columns:a,photometricInterpretation:o,pixelDataLength:h,planarConfiguration:r}=e;return h===4*a*i?!1:o==="PALETTE COLOR"?!0:o.endsWith("420")?h===(3*Math.ceil(a/2)+Math.floor(a/2))*i:o.endsWith("422")?h===(3*Math.ceil(a/2)+Math.floor(a/2))*Math.ceil(i/2)+Math.floor(i/2)*a:o!=="RGB"||r===1}function us(e){return ls(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}function ls(e){let i;try{return decodeURIComponent(escape(e))}catch(a){if(i=a,i instanceof URIError)return e;throw i}}function Fa(e,i,a){const o=new Date().getTime(),h=new Blob([i],{type:"image/jpeg"});return new Promise((r,g)=>{const w=new FileReader;w.readAsBinaryString===void 0?w.readAsArrayBuffer(h):w.readAsBinaryString(h),w.onload=function(){const C=new Image;C.onload=function(){a.height=C.height,a.width=C.width,e.rows=C.height,e.columns=C.width;const U=a.getContext("2d");U.drawImage(this,0,0);const O=U.getImageData(0,0,C.width,C.height),j=new Date().getTime();e.pixelData=new Uint8Array(O.data.buffer),e.imageData=O,e.decodeTimeInMS=j-o;const H=di(e.pixelData);e.smallestPixelValue=H.min,e.largestPixelValue=H.max,e.pixelDataLength=e.pixelData.length,r(e)},C.onerror=function(U){g(U)},w.readAsBinaryString===void 0?C.src=`data:image/jpeg;base64,${window.btoa(us(w.result))}`:C.src=`data:image/jpeg;base64,${window.btoa(w.result)}`},w.onerror=C=>{g(C)}})}function qt(e,i,a,o,h){const r={...o};delete r.loader,delete r.streamingData;const g=fa(),w=r.priority||void 0;return r.transferPixelData&&a.buffer,g.executeTask("dicomImageLoader","decodeTask",{imageFrame:e,transferSyntax:i,pixelData:a,options:r,decodeConfig:h},{priority:w,requestType:r?.requestType})}function cs(e,i,a,o,h={},r){switch(i){case"1.2.840.10008.1.2":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.1":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.2":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.1.99":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.5":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.50":return e.bitsAllocated===8&&(e.samplesPerPixel===3||e.samplesPerPixel===4)?Fa(e,a,o):qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.51":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.57":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.70":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.80":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.81":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.90":return qt(e,i,a,h,r);case"1.2.840.10008.1.2.4.91":return qt(e,i,a,h,r);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return qt(e,i,a,h,r)}return Promise.reject(new Error(`No decoder for transfer syntax ${i}`))}function ka(e){const i=Wn("imagePixelModule",e);return{samplesPerPixel:i.samplesPerPixel,photometricInterpretation:i.photometricInterpretation,planarConfiguration:i.planarConfiguration,rows:i.rows,columns:i.columns,bitsAllocated:i.bitsAllocated,bitsStored:i.bitsStored,pixelRepresentation:i.pixelRepresentation,smallestPixelValue:i.smallestPixelValue,largestPixelValue:i.largestPixelValue,redPaletteColorLookupTableDescriptor:i.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:i.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:i.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:i.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:i.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:i.bluePaletteColorLookupTableData,pixelData:void 0,imageId:e}}function fs(e,i){const a=e.get("modalityLutModule",i)||{},o=e.get("generalSeriesModule",i)||{},{modality:h}=o,r={rescaleSlope:a.rescaleSlope,rescaleIntercept:a.rescaleIntercept,modality:h},g=e.get("scalingModule",i)||{};return{...r,...h==="PT"&&{suvbw:g.suvbw},...h==="RTDOSE"&&{doseGridScaling:g.DoseGridScaling,doseSummation:g.DoseSummation,doseType:g.DoseType,doseUnit:g.DoseUnit}}}function ki(e){return e==="RGB"||e==="PALETTE COLOR"||e==="YBR_FULL"||e==="YBR_FULL_422"||e==="YBR_PARTIAL_422"||e==="YBR_PARTIAL_420"||e==="YBR_RCT"||e==="YBR_ICT"}function ds(e,i){const a=e.length/4;let o=0,h=0;for(let r=0;r<a;r++)i[h++]=e[o++],i[h++]=e[o++],i[h++]=e[o++],o++;return i}function ps(e){return e!=="1.2.840.10008.5.1.4.1.1.12.1"&&e!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function Mi(e,i){let a;return Number.isInteger(e)&&Number.isInteger(i)&&(e>=0?i<=255?a=Uint8Array:i<=65535?a=Uint16Array:i<=4294967295&&(a=Uint32Array):e>=-128&&i<=127?a=Int8Array:e>=-32768&&i<=32767&&(a=Int16Array)),a||Float32Array}function hs(e,i,a){return Mi(e,i)===a}function gs(e){const i=e.smallestPixelValue,a=e.largestPixelValue,o=Mi(i,a);if(o){const h=new o(e.pixelData);e.pixelData=h}else throw new Error("Could not apply a typed array to the pixel data")}let Ki="";function pi(e,i,a,o={}){const h=o.useRGBA;if(o.preScale={enabled:o.preScale&&o.preScale.enabled!==void 0?o.preScale.enabled:!0},!i?.length)return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:r}=gn,g=document.createElement("canvas"),w=ka(e);if(w.decodeLevel=o.decodeLevel,o.allowFloatRendering=fo(),o.preScale.enabled){const j=fs(po,e);j&&(o.preScale={...o.preScale,scalingParameters:j})}const{decodeConfig:C}=ei();Object.keys(w).forEach(j=>{(typeof w[j]=="function"||w[j]instanceof Promise)&&delete w[j]});const U=cs(w,a,i,g,o,C),O=ki(w.photometricInterpretation);return new Promise((j,H)=>{U.then(function(N){let Y=!1;if(o.targetBuffer&&o.targetBuffer.type&&!O){const{arrayBuffer:_e,type:he,offset:Te=0,length:Ne}=o.targetBuffer,qe=N.pixelDataLength,ue=Te,De=Ne??qe-ue,Fe={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};if(De!==N.pixelDataLength)throw new Error(`target array for image does not have the same length (${De}) as the decoded image length (${N.pixelDataLength}).`);const Se=Fe[he],He=_e?new Se(_e,ue,De):new Se(N.pixelData);if(De!==N.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");N.pixelData=He,Y=!0}Y||gs(N);const Z=Wn(r.IMAGE_PLANE,e)||{},re=Wn(r.VOI_LUT,e)||{},oe=Wn(r.MODALITY_LUT,e)||{},ie=Wn(r.SOP_COMMON,e)||{},ce=Wn(r.CALIBRATION,e)||{},{rows:pe,columns:me}=N;if(O){if(ss(N)){g.height=N.rows,g.width=N.columns;let Te=g.getContext("2d").createImageData(N.columns,N.rows);h||(Te={...Te,data:new Uint8ClampedArray(3*N.columns*N.rows)}),Ua(N,Te.data,h),N.imageData=Te,N.pixelData=Te.data,N.pixelDataLength=Te.data.length}else if(!h&&N.pixelDataLength===4*pe*me){const he=new Uint8Array(N.pixelData.length/4*3);N.pixelData=ds(N.pixelData,he),N.pixelDataLength=N.pixelData.length}const _e=di(N.pixelData);N.smallestPixelValue=_e.min,N.largestPixelValue=_e.max}let we=N.samplesPerPixel;N.photometricInterpretation==="PALETTE COLOR"&&(we=h?4:3);const je=ho.createImageVoxelManager({scalarData:N.pixelData,width:N.columns,height:N.rows,numberOfComponents:we}),fe={imageId:e,dataType:N.pixelData.constructor.name,color:O,calibration:ce,columnPixelSpacing:Z.columnPixelSpacing,columns:N.columns,height:N.rows,preScale:N.preScale,intercept:oe.rescaleIntercept?oe.rescaleIntercept:0,slope:oe.rescaleSlope?oe.rescaleSlope:1,invert:N.photometricInterpretation==="MONOCHROME1",minPixelValue:N.smallestPixelValue,maxPixelValue:N.largestPixelValue,rowPixelSpacing:Z.rowPixelSpacing,rows:N.rows,sizeInBytes:N.pixelData.byteLength,width:N.columns,windowCenter:re.windowCenter?re.windowCenter[0]:void 0,windowWidth:re.windowWidth?re.windowWidth[0]:void 0,voiLUTFunction:re.voiLUTFunction?re.voiLUTFunction:void 0,decodeTimeInMS:N.decodeTimeInMS,floatPixelData:void 0,imageFrame:N,voxelManager:je,rgba:O&&h,getPixelData:()=>N.pixelData,getCanvas:void 0,numberOfComponents:we};if(fe.color&&(fe.getCanvas=function(){if(Ki===e)return g;const _e=fe.columns,he=fe.rows;g.height=he,g.width=_e;const Te=g.getContext("2d"),Ne=Te.createImageData(_e,he),qe=N.pixelData;if(qe.length===_e*he*4)for(let ue=0;ue<qe.length;ue++)Ne.data[ue]=qe[ue];else if(qe.length===_e*he*3){let ue=0;for(let De=0;De<qe.length;De+=3)Ne.data[ue++]=qe[De],Ne.data[ue++]=qe[De+1],Ne.data[ue++]=qe[De+2],Ne.data[ue++]=255}return N.pixelData=Ne.data,N.pixelDataLength=Ne.data.length,N.imageData=Ne,Te.putImageData(N.imageData,0,0),Ki=e,g}),oe.modalityLUTSequence&&oe.modalityLUTSequence.length>0&&ps(ie.sopClassUID)&&(fe.modalityLUT=oe.modalityLUTSequence[0]),re.voiLUTSequence&&re.voiLUTSequence.length>0&&(fe.voiLUT=re.voiLUTSequence[0]),fe.color&&(fe.windowWidth=256,fe.windowCenter=128),fe.windowCenter===void 0||fe.windowWidth===void 0){const _e=go(fe.imageFrame.smallestPixelValue,fe.imageFrame.largestPixelValue);fe.windowWidth=_e.windowWidth,fe.windowCenter=_e.windowCenter}j(fe)},H)})}const{ImageQualityStatus:Ma}=gn;function vs(e,i){e.decache=function(){const a=Zn(i);Bn.unload(a.url)}}function ja(e,i,a=0,o,h,r){const g=new Date().getTime(),w={cancelFn:void 0,promise:void 0};return w.promise=new Promise((C,U)=>{e.then(O=>{const j=Fi(O,a),H=O.string("x00020010"),N=new Date().getTime(),Y=pi(i,j,H,h);vs(w,i),Y.then(Z=>{Z=Z,Z.data=O,Z.sharedCacheKey=o;const re=new Date().getTime();Z.loadTimeInMS=N-g,Z.totalTimeInMS=re-g,Z.imageQualityStatus=Ma.FULL_RESOLUTION,r!==void 0&&r.imageDoneCallback!==void 0&&r.imageDoneCallback(Z),C(Z)},function(Z){U({error:Z,dataSet:O})})},function(O){U({error:O})})}),w}function ys(e,i,a=0,o,h){const r=new Date().getTime();return{promise:new Promise((w,C)=>{const U=new Date().getTime();let O;try{const j=Fi(e,a),H=e.string("x00020010");O=pi(i,j,H,h)}catch(j){C({error:j,dataSet:e});return}O.then(j=>{j=j,j.data=e;const H=new Date().getTime();j.loadTimeInMS=U-r,j.totalTimeInMS=H-r,j.imageQualityStatus=Ma.FULL_RESOLUTION,w(j)},C)}),cancelFn:void 0}}function Wa(e){if(e==="dicomweb"||e==="wadouri")return li;if(e==="dicomfile")return La}function ai(e,i={}){const a=Zn(e);i=Object.assign({},i),delete i.loader;const o=Wa(a.scheme);if(Bn.isLoaded(a.url)){const r=Bn.get(a.url,o,e);return ys(r,e,a.pixelDataFrame,a.url,i)}const h=Bn.load(a.url,o,e);return ja(h,e,a.frame,a.url,i)}function Na(){ni("dicomweb",ai),ni("wadouri",ai),ni("dicomfile",ai),da(Sa)}const ms={getImagePixelModule:ma,getLUTs:Ti,getModalityLUTOutputPixelRepresentation:_a,getNumberValues:hr,metaDataProvider:Sa,metadataForDataset:Ra},_s={metaData:ms,dataSetCacheManager:Bn,fileManager:Da,getEncapsulatedImageFrame:Ia,getUncompressedImageFrame:Oa,loadFileRequest:La,loadImageFromPromise:ja,getLoaderForScheme:Wa,getPixelData:Fi,loadImage:ai,parseImageId:Zn,unpackBinaryFrame:$a,register:Na};function le(e,i,a){return i=i||0,!e||!e.Value||Array.isArray(e.Value)&&e.Value.length<=i?a:e.Value[i]}function bs(e,i,a){const o=le(e,i,a);if(o!==void 0)return parseFloat(String(o))}function Oe(e,i){const a=le(e,i);if(a!==void 0)return parseFloat(a)}function $t(e,i){if(!e||!e.Value||!Array.isArray(e.Value)||i&&e.Value.length<i)return;const a=[];for(let o=0;o<e.Value.length;o++)a.push(parseFloat(e.Value[o]));return a}function Ps(e){const i=[];for(let a=0;a<=30;a+=2){let o=`x60${a.toString(16)}`;o.length===4&&(o=`x600${a.toString(16)}`);const h=le(e[`${o}3000`]);if(!h)continue;const r=[];for(let g=0;g<h.length;g++)for(let w=0;w<8;w++){const C=e.Value[h.dataOffset+g];r[g*8+w]=C>>w&1}i.push({rows:Oe(e[`${o}0010`]),columns:Oe(e[`${o}0011`]),type:le(e[`${o}0040`]),x:Oe(e[`${o}0050`],1)-1,y:Oe(e[`${o}0050`],0)-1,pixelData:r,description:le(e[`${o}0022`]),label:le(e[`${o}1500`]),roiArea:le(e[`${o}1301`]),roiMean:le(e[`${o}1302`]),roiStandardDeviation:le(e[`${o}1303`])})}return{overlays:i}}function hi(e){const i=e.indexOf(":");return e.substring(i+1)}function Gn(e,i=!0){return e&&e.Value?e.Value[0]&&i?e.Value[0]:e.Value:e}function Ha(e,i,a){const o=(i?Object.values(i[0]):[]).map(r=>r.Value?.[0]).filter(r=>r!==void 0&&typeof r=="object"),h=(e?Object.values(e[a-1]):[]).map(r=>r.Value?.[0]).filter(r=>r!==void 0&&typeof r=="object");return{shared:o,perFrame:h}}function Va(e){let{52009230:i,52009229:a,"00280008":o,...h}=e;return i=Gn(i,!1),a=Gn(a,!1),o=Gn(o),{PerFrameFunctionalGroupsSequence:i,SharedFunctionalGroupsSequence:a,NumberOfFrames:o,rest:h}}function ws(e,i){const{PerFrameFunctionalGroupsSequence:a,SharedFunctionalGroupsSequence:o,NumberOfFrames:h,rest:r}=Va(i);if(a||h>1){const{shared:g,perFrame:w}=Ha(a,o,e),C=Object.assign(i,{frameNumber:e});return[...g,...w].forEach(U=>{Object.entries(U).forEach(([O,j])=>{C[O]=j})}),Object.assign(r,{"00280008":h},C)}return i}let ti=[],si={};function Ba(e){const i=e.indexOf("/frames/")+8,a=e.slice(0,i),o=parseInt(e.slice(i),10);return{metadata:ti[`${a}1`],frame:o}}function Ts(e){const i=hi(e);return Ba(i)}function Es(e){if(e[52009230]!==void 0||e[52009229]!==void 0)return!0;const i=le(e["00280008"]);return i&&i>1}function xs(e,i){const a=hi(e);Object.defineProperty(i,"isMultiframe",{value:Es(i),enumerable:!1}),ti[a]=i}function As(e){const i=hi(e),a=ti[i];if(a&&!a?.isMultiframe)return a;const o=si[i];if(o)return o;const h=Ba(i);if(!h||!h.metadata)return;const{metadata:r,frame:g}=h;if(r){const w=ws(g,r);return si[i]=w,w}}function Cs(e){const i=hi(e);ti[i]=void 0,si[i]=void 0}function Ss(){ti=[],si={}}const ji={add:xs,get:As,remove:Cs,purge:Ss};function Ga(e){return le(e["00080060"]).includes("NM")}function Wi(e,i){const a=Gn(e["00080008"],!1);if(a)return a[i]}function Rs(e){let i;const a=Wi(e,2);if(a&&Jn(a)){const o=Gn(e["00540022"]);o&&(i=$t(o["00200037"],6))}return i}function Ds(e){let i;const a=Wi(e,2);if(a&&Jn(a)){const o=Gn(e["00540022"]);o&&(i=$t(o["00200032"],3))}return i}function Zi(e){let i=$t(e["00200037"],6);return!i&&Ga(e)&&(i=Rs(e)),i}function ea(e){let i=$t(e["00200032"],3);return!i&&Ga(e)&&(i=Ds(e)),i}function It(e,i){const a=$t(e[i]);return a?a[0]:null}function Is(e){return e?.Value?.length?Array.isArray(e.Value)?e.Value:typeof e.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[e.Value]):[]:[]}function ta(e){const i=Is(e["00186011"]);return!i||!i.length?null:i.map(o=>{const h=It(o,"0018602C"),r=It(o,"0018602E"),g=It(o,"00186024"),w=It(o,"00186026"),C=It(o,"0018601A"),U=It(o,"0018601E"),O=It(o,"00186018"),j=It(o,"0018601C"),H=It(o,"00186020"),N=It(o,"00186022"),Y=It(o,"0018602A"),Z=It(o,"00186028"),re=It(o,"00186012"),oe=It(o,"00186014"),ie=It(o,"00186016"),ce=It(o,"00186030");return{regionLocationMinY0:C,regionLocationMaxY1:U,regionLocationMinX0:O,regionLocationMaxX1:j,referencePixelX0:H,referencePixelY0:N,physicalDeltaX:h,physicalDeltaY:r,physicalUnitsXDirection:g,physicalUnitsYDirection:w,referencePhysicalPixelValueY:Y,referencePhysicalPixelValueX:Z,regionSpatialFormat:re,regionDataType:oe,regionFlags:ie,transducerFrequency:ce}})}function qa(e,i){const{MetadataModules:a}=gn;if(e===a.MULTIFRAME){const{metadata:h,frame:r}=Ts(i);if(!h)return;const{PerFrameFunctionalGroupsSequence:g,SharedFunctionalGroupsSequence:w,NumberOfFrames:C}=Va(h);if(g||C>1){const{shared:U,perFrame:O}=Ha(g,w,r);return{NumberOfFrames:C,PerFrameFunctionalInformation:O,SharedFunctionalInformation:U}}return{NumberOfFrames:C}}const o=ji.get(i);if(o){if(e===a.GENERAL_STUDY)return{studyDescription:le(o["00081030"]),studyDate:le(o["00080020"]),studyTime:le(o["00080030"]),accessionNumber:le(o["00080050"])};if(e===a.GENERAL_SERIES)return{modality:le(o["00080060"]),seriesInstanceUID:le(o["0020000E"]),seriesDescription:le(o["0008103E"]),seriesNumber:Oe(o["00200011"]),studyInstanceUID:le(o["0020000D"]),seriesDate:le(o["00080021"]),seriesTime:le(o["00080031"]),acquisitionDate:le(o["00080022"]),acquisitionTime:le(o["00080032"])};if(e===a.GENERAL_IMAGE)return{sopInstanceUID:le(o["00080018"]),instanceNumber:Oe(o["00200013"]),lossyImageCompression:le(o["00282110"]),lossyImageCompressionRatio:Oe(o["00282112"]),lossyImageCompressionMethod:le(o["00282114"])};if(e===a.PATIENT)return{patientID:le(o["00100020"]),patientName:le(o["00100010"])};if(e===a.PATIENT_STUDY)return{patientAge:Oe(o["00101010"]),patientSize:Oe(o["00101020"]),patientSex:le(o["00100040"]),patientWeight:Oe(o["00101030"])};if(e===a.NM_MULTIFRAME_GEOMETRY){const h=le(o["00080060"]),r=Wi(o,2);return{modality:h,imageType:le(o["00080008"]),imageSubType:r,imageOrientationPatient:Zi(o),imagePositionPatient:ea(o),sliceThickness:Oe(o["00180050"]),spacingBetweenSlices:Oe(o["00180088"]),pixelSpacing:$t(o["00280030"],2),numberOfFrames:Oe(o["00280008"]),isNMReconstructable:Jn(r)&&h.includes("NM")}}if(e===a.IMAGE_PLANE){let h=Zi(o),r=ea(o);const g=$t(o["00280030"],2);let w=null,C=null,U=null,O=null,j=!1;return g?(C=g[0],w=g[1]):(j=!0,C=1,w=1),h?(U=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])],O=[parseFloat(h[3]),parseFloat(h[4]),parseFloat(h[5])]):(U=[1,0,0],O=[0,1,0],j=!0,h=[...U,...O]),r||(r=[0,0,0],j=!0),{frameOfReferenceUID:le(o["00200052"]),rows:Oe(o["00280010"]),columns:Oe(o["00280011"]),imageOrientationPatient:h,rowCosines:U,columnCosines:O,imagePositionPatient:r,sliceThickness:Oe(o["00180050"]),sliceLocation:Oe(o["00201041"]),pixelSpacing:g,rowPixelSpacing:C,columnPixelSpacing:w,usingDefaultValues:j}}if(e===a.ULTRASOUND_ENHANCED_REGION)return ta(o);if(e===a.CALIBRATION&&le(o["00080060"])==="US")return{sequenceOfUltrasoundRegions:ta(o)};if(e===a.IMAGE_URL)return $s(i,o);if(e===a.CINE)return Os(i,o);if(e===a.IMAGE_PIXEL)return{samplesPerPixel:Oe(o["00280002"]),photometricInterpretation:le(o["00280004"]),rows:Oe(o["00280010"]),columns:Oe(o["00280011"]),bitsAllocated:Oe(o["00280100"]),bitsStored:Oe(o["00280101"]),highBit:le(o["00280102"]),pixelRepresentation:Oe(o["00280103"]),planarConfiguration:Oe(o["00280006"]),pixelAspectRatio:le(o["00280034"]),smallestPixelValue:Oe(o["00280106"]),largestPixelValue:Oe(o["00280107"]),redPaletteColorLookupTableDescriptor:$t(o["00281101"]),greenPaletteColorLookupTableDescriptor:$t(o["00281102"]),bluePaletteColorLookupTableDescriptor:$t(o["00281103"]),redPaletteColorLookupTableData:$t(o["00281201"]),greenPaletteColorLookupTableData:$t(o["00281202"]),bluePaletteColorLookupTableData:$t(o["00281203"])};if(e===a.VOI_LUT)return{windowCenter:$t(o["00281050"],1),windowWidth:$t(o["00281051"],1),voiLUTFunction:le(o["00281056"])};if(e===a.MODALITY_LUT)return{rescaleIntercept:Oe(o["00281052"]),rescaleSlope:Oe(o["00281053"]),rescaleType:le(o["00281054"])};if(e===a.SOP_COMMON)return{sopClassUID:le(o["00080016"]),sopInstanceUID:le(o["00080018"])};if(e===a.PET_ISOTOPE){const h=le(o["00540016"]);return h===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:le(h["00181072"],0,""),radiopharmaceuticalStartDateTime:le(h["00181078"],0,""),radionuclideTotalDose:Oe(h["00181074"]),radionuclideHalfLife:Oe(h["00181075"])}}}if(e===a.OVERLAY_PLANE)return Ps(o);if(e==="transferSyntax")return Ja(i,o);if(e===a.PET_SERIES){let h=o["00280051"],r=le(o["00280051"]);return h&&h.Value&&Array.isArray(h.Value)&&(r=h.Value.join("\\")),{correctedImage:r,units:le(o["00541001"]),decayCorrection:le(o["00541102"])}}if(e===a.PET_IMAGE)return{frameReferenceTime:Oe(o["00541300"]),actualFrameDuration:Oe(o["00181242"])};if(e==="instance")return ca(i,Ca)}}function $s(e,i){const{transferSyntaxUID:a}=Ja(e,i),o=vo(a),h=e.substring(7),r=h.replace("/frames/","/thumbnail/");let g=h.replace("/frames/","/rendered/");return o&&(g=g.replace("/rendered/1","/rendered")),{isVideo:o,rendered:g,thumbnail:r}}function Os(e,i){return{cineRate:le(i["00180040"]),numberOfFrames:Oe(i["00280008"])}}function Ja(e,i){return{transferSyntaxUID:le(i["00020010"])||le(i["00083002"])}}function Ls(e,i,a={},o={}){const h=ei(),{retrieveOptions:r={},streamingData:g}=o,w=g.chunkSize||Fs(i,r,"chunkSize")||65536,C=O=>{if(typeof h.errorInterceptor=="function"){const j=new Error("request failed");h.errorInterceptor(j)}else console.warn("rangeRequest:Caught",O)};return new Promise(async(O,j)=>{const H=Object.assign({},a);Object.keys(H).forEach(function(N){(H[N]===null||H[N]===void 0)&&delete H[N]});try{g.encodedData||(g.chunkSize=w,g.rangesFetched=0);const N=ks(g,r),{encodedData:Y,responseHeaders:Z}=await Us(e,H,N,g),re=Z.get("content-type"),{totalBytes:oe}=g,ie=oe===Y.byteLength,ce=$i(re,Y,{isPartial:!0}),pe=Oi(r,ie||ce.extractDone===!0);O({...ce,imageQualityStatus:pe,percentComplete:ce.extractDone?100:Y.byteLength*100/oe})}catch(N){C(N),console.error(N),j(N)}})}async function Us(e,i,a,o){a&&(i=Object.assign(i,{Range:`bytes=${a[0]}-${a[1]}`}));let{encodedData:h}=o;if(a[1]&&h?.byteLength>a[1])return o;const r=await fetch(e,{headers:i,signal:void 0}),g=await r.arrayBuffer(),w=new Uint8Array(g),{status:C}=r;let U;h?(U=new Uint8Array(h.length+w.length),U.set(h,0),U.set(w,h.length),o.rangesFetched=1):(U=new Uint8Array(w.length),U.set(w,0),o.rangesFetched++),o.encodedData=h=U,o.responseHeaders=r.headers;const O=r.headers.get("Content-Range");return O?o.totalBytes=Number(O.split("/")[1]):C!==206||!a?o.totalBytes=h?.byteLength:a[1]===""||h?.length<a[1]?o.totalBytes=h.byteLength:o.totalBytes=Number.MAX_SAFE_INTEGER,o}function Fs(e,i,a){const o=i[a];if(typeof o!="function")return o;const h=ji.get(e);return o(h,e)}function ks(e,i){const{totalBytes:a,encodedData:o,chunkSize:h=65536}=e,{rangeIndex:r=0}=i;return r===-1&&(!a||!o)?[0,""]:r===-1||o?.byteLength>a-h?[o?.byteLength||0,""]:[o?.byteLength||0,h*(r+1)-1]}function Ni(e,i,a="application/octet-stream",o){const{streamingData:h,retrieveOptions:r={}}=o||{},g={Accept:a};let w=r.urlArguments?`${e}${e.indexOf("?")===-1?"?":"&"}${r.urlArguments}`:e;if(r.framesPath&&(w=w.replace("/frames/",r.framesPath)),h?.url!==w&&(o.streamingData={url:w}),r.rangeIndex!==void 0)return Ls(w,i,g,o);if(r.streaming)return Pa(w,i,g,o);const C=li(w,i,g),{xhr:U}=C;return C.then(function(O){const j=U.getResponseHeader("Content-Type")||"application/octet-stream",H=$i(j,new Uint8Array(O));return H.imageQualityStatus=Oi(r,!0),H})}const{ProgressiveIterator:ra}=la,{ImageQualityStatus:na}=gn,Ms=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function js(e){const i="1.2.840.10008.1.2";if(!e)return i;const a=e.split(";"),o={};a.forEach(r=>{const g=r.split("=");if(g.length!==2)return;const w=g[1].trim().replace(/"/g,"");o[g[0].trim()]=w});const h={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return o["transfer-syntax"]?o["transfer-syntax"]:e&&!Object.keys(o).length&&h[e]?h[e]:o.type&&h[o.type]?h[o.type]:h[e]?h[e]:i}function Ws(){return _o}const Ns="multipart/related; type=application/octet-stream; transfer-syntax=*";function za(e,i={}){const a=Ws(),o=new Date().getTime(),h=new ra("decompress");async function r(O,j,H){h.generate(async N=>{const Y=ra.as(Ni(O,j,H,i));let Z=10;for await(const re of Y){const{pixelData:oe,imageQualityStatus:ie=na.FULL_RESOLUTION,percentComplete:ce,done:pe=!0,extractDone:me=!0}=re,we=js(re.contentType);if(!me&&!Ms.has(we))continue;const je=re.decodeLevel??(ie===na.FULL_RESOLUTION?0:Hs(ce,i.retrieveOptions?.decodeLevel));if(!(!pe&&Z<=je))try{const fe={...i,decodeLevel:je},_e=await pi(j,oe,we,fe),he=new Date().getTime();_e.loadTimeInMS=he-o,_e.transferSyntaxUID=we,_e.imageQualityStatus=ie,N.add(_e,pe),Z=je}catch(fe){if(me)throw console.warn("Couldn't decode",fe),fe}}})}const g=i.requestType||yo.Interaction,w=i.additionalDetails||{imageId:e},C=i.priority===void 0?5:i.priority,U=e.substring(7);return a.addRequest(r.bind(this,U,e,Ns),g,w,C),{promise:h.getDonePromise(),cancelFn:void 0}}function Hs(e,i=4){const a=e/100-.02;return a>1/4?Math.min(i,0):a>1/16?Math.min(i,1):a>1/64?Math.min(i,2):Math.min(i,3)}function Ya(){ni("wadors",za),da(qa)}const Vs={getNumberString:bs,getNumberValue:Oe,getNumberValues:$t,getValue:le,metaDataProvider:qa},Bs={metaData:Vs,findIndexOfString:xi,getPixelData:Ni,loadImage:za,metaDataManager:ji,register:Ya};function Gs(){Ya(),Na()}const qs=()=>new Worker(new URL("/radiology-ai-viewer/assets/decodeImageFrameWorker-C6Q2UkgP.js",import.meta.url),{type:"module"});function Js(e={}){ba(e),Gs();const i=fa(),a=e?.maxWebWorkers||zs();i.registerWorker("dicomImageLoader",qs,{maxWorkerInstances:a})}function zs(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function Ys(e,i){if(i=i||e.transferSyntax,e.bitsAllocated===8&&i==="1.2.840.10008.1.2.4.50"&&(e.samplesPerPixel===3||e.samplesPerPixel===4))return!0}const Xs={IMPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2",EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1",DEFLATED_EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1.99",EXPLICIT_VR_BIG_ENDIAN:"1.2.840.10008.1.2.2",JPEG_BASELINE_PROCESS_1:"1.2.840.10008.1.2.4.50",JPEG_EXTENDED_PROCESS_2_4:"1.2.840.10008.1.2.4.51",JPEG_EXTENDED_PROCESSES_3_5:"1.2.840.10008.1.2.4.52",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_6_8:"1.2.840.10008.1.2.4.53",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_7_9:"1.2.840.10008.1.2.4.54",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_10_12:"1.2.840.10008.1.2.4.55",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_11_13:"1.2.840.10008.1.2.4.56",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_14:"1.2.840.10008.1.2.4.57",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_15:"1.2.840.10008.1.2.4.58",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_16_18:"1.2.840.10008.1.2.4.59",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_17_19:"1.2.840.10008.1.2.4.60",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_20_22:"1.2.840.10008.1.2.4.61",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_21_23:"1.2.840.10008.1.2.4.62",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_24_26:"1.2.840.10008.1.2.4.63",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_25_27:"1.2.840.10008.1.2.4.64",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_28:"1.2.840.10008.1.2.4.65",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_29:"1.2.840.10008.1.2.4.66",JPEG_LOSSLESS_NONHIERARCHICAL_FIRST_ORDER_PREDICTION_PROCESS_14:"1.2.840.10008.1.2.4.70",JPEG_LS_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.80",JPEG_LS_LOSSY_NEAR_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.81",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.90",JPEG_2000_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.91",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.92",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.93",JPIP_REFERENCED:"1.2.840.10008.1.2.4.94",JPIP_REFERENCED_DEFLATE:"1.2.840.10008.1.2.4.95",MPEG2_MAIN_PROFILE_MAIN_LEVEL:"1.2.840.10008.1.2.4.100",MPEG4_AVC_H264_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.101",MPEG4_AVC_H264_BD_COMPATIBLE_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.102",MPEG4_AVC_H264_HIGH_PROFILE_FOR_2D_VIDEO:"1.2.840.10008.1.2.4.103",MPEG4_AVC_H264_HIGH_PROFILE_FOR_3D_VIDEO:"1.2.840.10008.1.2.4.104",JPIP_LOSSLESS:"1.2.840.10008.1.2.4.96",JPIP_PART2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.97",RFC_2557_MIME_ENCAPSULATION:"1.2.840.10008.1.2.6.1",JPEG_XR_IMAGE_COMPRESSION:"1.2.840.10008.1.2.6.2",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.90R",JPEG_2000_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.91R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.92R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.93R"},Qs=Object.freeze(Object.defineProperty({__proto__:null,transferSyntaxes:Xs},Symbol.toStringTag,{value:"Module"}));function Ks(e,i){const{rows:a,columns:o,data:h}=e,{rows:r,columns:g,data:w}=i,C=[],U=[],O=[];for(let j=0;j<g;j++){const H=j*(o-1)/(g-1);C[j]=Math.floor(H),U[j]=Math.min(C[j]+1,o-1),O[j]=H-C[j]}for(let j=0;j<r;j++){const H=j*(a-1)/(r-1),N=Math.floor(H)*o,Y=Math.min(N+o,(a-1)*o),Z=H-Math.floor(H),re=1-Z,oe=j*g;for(let ie=0;ie<g;ie++){const ce=h[N+C[ie]],pe=h[N+U[ie]],me=h[Y+C[ie]],we=h[Y+U[ie]],je=1-O[ie];w[oe+ie]=(ce*je+pe*O[ie])*re+(me*je+we*O[ie])*Z}}return w}function Zs(e,i){const{rows:a,columns:o,pixelData:h,samplesPerPixel:r=1}=e,{rows:g,columns:w,pixelData:C}=i,U=[];for(let O=0;O<w;O++){const j=O*(o-1)/(w-1);U[O]=Math.floor(j)*r}for(let O=0;O<g;O++){const j=O*(a-1)/(g-1),H=Math.floor(j)*o*r,N=O*w;for(let Y=0;Y<w;Y++)for(let Z=0;Z<r;Z++)C[N+Y+Z]=h[H+U[Y]+Z]}return C}async function Ai(e,i){let a=i.buffer,o=i.byteOffset;const h=i.length;if(e.bitsAllocated===16)o%2&&(a=a.slice(o),o=0),e.pixelRepresentation===0?e.pixelData=new Uint16Array(a,o,h/2):e.pixelData=new Int16Array(a,o,h/2);else if(e.bitsAllocated===8||e.bitsAllocated===1)e.pixelData=i;else if(e.bitsAllocated===32){if(o%2&&(a=a.slice(o),o=0),e.floatPixelData||e.doubleFloatPixelData)throw new Error("Float pixel data is not supported for parsing into ImageFrame");e.pixelRepresentation===0?e.pixelData=new Uint32Array(a,o,h/4):e.pixelRepresentation===1?e.pixelData=new Int32Array(a,o,h/4):e.pixelData=new Float32Array(a,o,h/4)}return e}function eu(e){return(e&255)<<8|e>>8&255}async function Xa(e,i){if(e.bitsAllocated===16){let a=i.buffer,o=i.byteOffset;const h=i.length;o%2&&(a=a.slice(o),o=0),e.pixelRepresentation===0?e.pixelData=new Uint16Array(a,o,h/2):e.pixelData=new Int16Array(a,o,h/2);for(let r=0;r<e.pixelData.length;r++)e.pixelData[r]=eu(e.pixelData[r])}else e.bitsAllocated===8&&(e.pixelData=i);return e}async function Qa(e,i){if(e.bitsAllocated===8)return e.planarConfiguration?ru(e,i):tu(e,i);if(e.bitsAllocated===16)return nu(e,i);throw new Error("unsupported pixel format for RLE")}function tu(e,i){const a=i,o=e.rows*e.columns,h=new ArrayBuffer(o*e.samplesPerPixel),r=new DataView(a.buffer,a.byteOffset),g=new Int8Array(a.buffer,a.byteOffset),w=new Int8Array(h);let C=0;const U=r.getInt32(0,!0);for(let O=0;O<U;++O){C=O;let j=r.getInt32((O+1)*4,!0),H=r.getInt32((O+2)*4,!0);H===0&&(H=a.length);const N=o*U;for(;j<H;){const Y=g[j++];if(Y>=0&&Y<=127)for(let Z=0;Z<Y+1&&C<N;++Z)w[C]=g[j++],C+=e.samplesPerPixel;else if(Y<=-1&&Y>=-127){const Z=g[j++];for(let re=0;re<-Y+1&&C<N;++re)w[C]=Z,C+=e.samplesPerPixel}}}return e.pixelData=new Uint8Array(h),e}function ru(e,i){const a=i,o=e.rows*e.columns,h=new ArrayBuffer(o*e.samplesPerPixel),r=new DataView(a.buffer,a.byteOffset),g=new Int8Array(a.buffer,a.byteOffset),w=new Int8Array(h);let C=0;const U=r.getInt32(0,!0);for(let O=0;O<U;++O){C=O*o;let j=r.getInt32((O+1)*4,!0),H=r.getInt32((O+2)*4,!0);H===0&&(H=a.length);const N=o*U;for(;j<H;){const Y=g[j++];if(Y>=0&&Y<=127)for(let Z=0;Z<Y+1&&C<N;++Z)w[C]=g[j++],C++;else if(Y<=-1&&Y>=-127){const Z=g[j++];for(let re=0;re<-Y+1&&C<N;++re)w[C]=Z,C++}}}return e.pixelData=new Uint8Array(h),e}function nu(e,i){const a=i,o=e.rows*e.columns,h=new ArrayBuffer(o*e.samplesPerPixel*2),r=new DataView(a.buffer,a.byteOffset),g=new Int8Array(a.buffer,a.byteOffset),w=new Int8Array(h),C=r.getInt32(0,!0);for(let U=0;U<C;++U){let O=0;const j=U===0?1:0;let H=r.getInt32((U+1)*4,!0),N=r.getInt32((U+2)*4,!0);for(N===0&&(N=a.length);H<N;){const Y=g[H++];if(Y>=0&&Y<=127)for(let Z=0;Z<Y+1&&O<o;++Z)w[O*2+j]=g[H++],O++;else if(Y<=-1&&Y>=-127){const Z=g[H++];for(let re=0;re<-Y+1&&O<o;++re)w[O*2+j]=Z,O++}}}return e.pixelRepresentation===0?e.pixelData=new Uint16Array(h):e.pixelData=new Int16Array(h),e}var _i={exports:{}},ia;function iu(){return ia||(ia=1,(function(e,i){var a=(()=>{var o=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(o=o||__filename),(function(h){h=h||{};var r=typeof h<"u"?h:{},g,w;r.ready=new Promise(function(t,n){g=t,w=n});var C=Object.assign({},r),U="./this.program",O=(t,n)=>{throw n},j=typeof window=="object",H=typeof importScripts=="function",N=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",Y="";function Z(t){return r.locateFile?r.locateFile(t,Y):Y+t}var re,oe,ie;if(N){var ce=hn,pe=hn;H?Y=pe.dirname(Y)+"/":Y=__dirname+"/",re=(t,n)=>(t=b(t)?new URL(t):pe.normalize(t),ce.readFileSync(t,n?void 0:"utf8")),ie=t=>{var n=re(t,!0);return n.buffer||(n=new Uint8Array(n)),n},oe=(t,n,f)=>{t=b(t)?new URL(t):pe.normalize(t),ce.readFile(t,function(v,P){v?f(v):n(P.buffer)})},process.argv.length>1&&(U=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(t){if(!(t instanceof $e))throw t}),process.on("unhandledRejection",function(t){throw t}),O=(t,n)=>{throw process.exitCode=t,n},r.inspect=function(){return"[Emscripten Module object]"}}else(j||H)&&(H?Y=self.location.href:typeof document<"u"&&document.currentScript&&(Y=document.currentScript.src),o&&(Y=o),Y.indexOf("blob:")!==0?Y=Y.substr(0,Y.replace(/[?#].*/,"").lastIndexOf("/")+1):Y="",re=t=>{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(null),n.responseText},H&&(ie=t=>{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),oe=(t,n,f)=>{var v=new XMLHttpRequest;v.open("GET",t,!0),v.responseType="arraybuffer",v.onload=()=>{if(v.status==200||v.status==0&&v.response){n(v.response);return}f()},v.onerror=f,v.send(null)});var me=r.print||console.log.bind(console),we=r.printErr||console.warn.bind(console);Object.assign(r,C),C=null,r.arguments&&r.arguments,r.thisProgram&&(U=r.thisProgram),r.quit&&(O=r.quit);var je;r.wasmBinary&&(je=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&y("no native wasm support detected");var fe,_e=!1;function he(t,n){t||y(n)}var Te=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Ne(t,n,f){for(var v=n+f,P=n;t[P]&&!(P>=v);)++P;if(P-n>16&&t.buffer&&Te)return Te.decode(t.subarray(n,P));for(var E="";n<P;){var x=t[n++];if(!(x&128)){E+=String.fromCharCode(x);continue}var R=t[n++]&63;if((x&224)==192){E+=String.fromCharCode((x&31)<<6|R);continue}var $=t[n++]&63;if((x&240)==224?x=(x&15)<<12|R<<6|$:x=(x&7)<<18|R<<12|$<<6|t[n++]&63,x<65536)E+=String.fromCharCode(x);else{var B=x-65536;E+=String.fromCharCode(55296|B>>10,56320|B&1023)}}return E}function qe(t,n){return t?Ne(Ee,t,n):""}function ue(t,n,f,v){if(!(v>0))return 0;for(var P=f,E=f+v-1,x=0;x<t.length;++x){var R=t.charCodeAt(x);if(R>=55296&&R<=57343){var $=t.charCodeAt(++x);R=65536+((R&1023)<<10)|$&1023}if(R<=127){if(f>=E)break;n[f++]=R}else if(R<=2047){if(f+1>=E)break;n[f++]=192|R>>6,n[f++]=128|R&63}else if(R<=65535){if(f+2>=E)break;n[f++]=224|R>>12,n[f++]=128|R>>6&63,n[f++]=128|R&63}else{if(f+3>=E)break;n[f++]=240|R>>18,n[f++]=128|R>>12&63,n[f++]=128|R>>6&63,n[f++]=128|R&63}}return n[f]=0,f-P}function De(t,n,f){return ue(t,Ee,n,f)}function Fe(t){for(var n=0,f=0;f<t.length;++f){var v=t.charCodeAt(f);v<=127?n++:v<=2047?n+=2:v>=55296&&v<=57343?(n+=4,++f):n+=3}return n}var Se,He,Ee,Pe,Ie,Je,Re,At,Jt;function Ht(t){Se=t,r.HEAP8=He=new Int8Array(t),r.HEAP16=Pe=new Int16Array(t),r.HEAP32=Je=new Int32Array(t),r.HEAPU8=Ee=new Uint8Array(t),r.HEAPU16=Ie=new Uint16Array(t),r.HEAPU32=Re=new Uint32Array(t),r.HEAPF32=At=new Float32Array(t),r.HEAPF64=Jt=new Float64Array(t)}r.INITIAL_MEMORY;var Qe,Ot=[],yt=[],mt=[];function Zt(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)ht(r.preRun.shift());Ve(Ot)}function Sr(){Ve(yt)}function sr(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Lt(r.postRun.shift());Ve(mt)}function ht(t){Ot.unshift(t)}function Ke(t){yt.unshift(t)}function Lt(t){mt.unshift(t)}var Ut=0,ot=null;function Ft(t){Ut++,r.monitorRunDependencies&&r.monitorRunDependencies(Ut)}function ur(t){if(Ut--,r.monitorRunDependencies&&r.monitorRunDependencies(Ut),Ut==0&&ot){var n=ot;ot=null,n()}}function y(t){r.onAbort&&r.onAbort(t),t="Aborted("+t+")",we(t),_e=!0,t+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(t);throw w(n),n}var _="data:application/octet-stream;base64,";function S(t){return t.startsWith(_)}function b(t){return t.startsWith("file://")}var D;D="libjpegturbowasm_decode.wasm",S(D)||(D=Z(D));function q(t){try{if(t==D&&je)return new Uint8Array(je);if(ie)return ie(t);throw"both async and sync fetching of the wasm failed"}catch(n){y(n)}}function te(){if(!je&&(j||H)){if(typeof fetch=="function"&&!b(D))return fetch(D,{credentials:"same-origin"}).then(function(t){if(!t.ok)throw"failed to load wasm binary file at '"+D+"'";return t.arrayBuffer()}).catch(function(){return q(D)});if(oe)return new Promise(function(t,n){oe(D,function(f){t(new Uint8Array(f))},n)})}return Promise.resolve().then(function(){return q(D)})}function ve(){var t={a:k};function n(x,R){var $=x.exports;r.asm=$,fe=r.asm.K,Ht(fe.buffer),Qe=r.asm.M,Ke(r.asm.L),ur()}Ft();function f(x){n(x.instance)}function v(x){return te().then(function(R){return WebAssembly.instantiate(R,t)}).then(function(R){return R}).then(x,function(R){we("failed to asynchronously prepare wasm: "+R),y(R)})}function P(){return!je&&typeof WebAssembly.instantiateStreaming=="function"&&!S(D)&&!b(D)&&!N&&typeof fetch=="function"?fetch(D,{credentials:"same-origin"}).then(function(x){var R=WebAssembly.instantiateStreaming(x,t);return R.then(f,function($){return we("wasm streaming compile failed: "+$),we("falling back to ArrayBuffer instantiation"),v(f)})}):v(f)}if(r.instantiateWasm)try{var E=r.instantiateWasm(t,n);return E}catch(x){we("Module.instantiateWasm callback failed with error: "+x),w(x)}return P().catch(w),{}}function $e(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function Ve(t){for(;t.length>0;)t.shift()(r)}function ke(t){this.excPtr=t,this.ptr=t-24,this.set_type=function(n){Re[this.ptr+4>>2]=n},this.get_type=function(){return Re[this.ptr+4>>2]},this.set_destructor=function(n){Re[this.ptr+8>>2]=n},this.get_destructor=function(){return Re[this.ptr+8>>2]},this.set_refcount=function(n){Je[this.ptr>>2]=n},this.set_caught=function(n){n=n?1:0,He[this.ptr+12>>0]=n},this.get_caught=function(){return He[this.ptr+12>>0]!=0},this.set_rethrown=function(n){n=n?1:0,He[this.ptr+13>>0]=n},this.get_rethrown=function(){return He[this.ptr+13>>0]!=0},this.init=function(n,f){this.set_adjusted_ptr(0),this.set_type(n),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var n=Je[this.ptr>>2];Je[this.ptr>>2]=n+1},this.release_ref=function(){var n=Je[this.ptr>>2];return Je[this.ptr>>2]=n-1,n===1},this.set_adjusted_ptr=function(n){Re[this.ptr+16>>2]=n},this.get_adjusted_ptr=function(){return Re[this.ptr+16>>2]},this.get_exception_ptr=function(){var n=A(this.get_type());if(n)return Re[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function st(t,n,f){var v=new ke(t);throw v.init(n,f),t}var Ce={};function Me(t){for(;t.length;){var n=t.pop(),f=t.pop();f(n)}}function Be(t){return this.fromWireType(Je[t>>2])}var zt={},Ct={},rt={},Rr=48,Dr=57;function gr(t){if(t===void 0)return"_unknown";t=t.replace(/[^a-zA-Z0-9_]/g,"$");var n=t.charCodeAt(0);return n>=Rr&&n<=Dr?"_"+t:t}function Yt(t,n){return t=gr(t),new Function("body","return function "+t+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(n)}function We(t,n){var f=Yt(n,function(v){this.name=n,this.message=v;var P=new Error(v).stack;P!==void 0&&(this.stack=this.toString()+`
`+P.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(t.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var Vt=void 0;function ye(t){throw new Vt(t)}function ut(t,n,f){t.forEach(function(R){rt[R]=n});function v(R){var $=f(R);$.length!==t.length&&ye("Mismatched type converter count");for(var B=0;B<t.length;++B)ct(t[B],$[B])}var P=new Array(n.length),E=[],x=0;n.forEach((R,$)=>{Ct.hasOwnProperty(R)?P[$]=Ct[R]:(E.push(R),zt.hasOwnProperty(R)||(zt[R]=[]),zt[R].push(()=>{P[$]=Ct[R],++x,x===E.length&&v(P)}))}),E.length===0&&v(P)}function et(t){var n=Ce[t];delete Ce[t];var f=n.rawConstructor,v=n.rawDestructor,P=n.fields,E=P.map(x=>x.getterReturnType).concat(P.map(x=>x.setterArgumentType));ut([t],E,x=>{var R={};return P.forEach(($,B)=>{var Q=$.fieldName,ne=x[B],ee=$.getter,ge=$.getterContext,de=x[B+P.length],Ue=$.setter,tt=$.setterContext;R[Q]={read:at=>ne.fromWireType(ee(ge,at)),write:(at,Mn)=>{var or=[];Ue(tt,at,de.toWireType(or,Mn)),Me(or)}}}),[{name:n.name,fromWireType:function($){var B={};for(var Q in R)B[Q]=R[Q].read($);return v($),B},toWireType:function($,B){for(var Q in R)if(!(Q in B))throw new TypeError('Missing field:  "'+Q+'"');var ne=f();for(Q in R)R[Q].write(ne,B[Q]);return $!==null&&$.push(v,ne),ne},argPackAdvance:8,readValueFromPointer:Be,destructorFunction:v}]})}function lt(t,n,f,v,P){}function Ye(t){switch(t){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+t)}}function er(){for(var t=new Array(256),n=0;n<256;++n)t[n]=String.fromCharCode(n);be=t}var be=void 0;function Le(t){for(var n="",f=t;Ee[f];)n+=be[Ee[f++]];return n}var kt=void 0;function xe(t){throw new kt(t)}function ct(t,n,f={}){if(!("argPackAdvance"in n))throw new TypeError("registerType registeredInstance requires argPackAdvance");var v=n.name;if(t||xe('type "'+v+'" must have a positive integer typeid pointer'),Ct.hasOwnProperty(t)){if(f.ignoreDuplicateRegistrations)return;xe("Cannot register type '"+v+"' twice")}if(Ct[t]=n,delete rt[t],zt.hasOwnProperty(t)){var P=zt[t];delete zt[t],P.forEach(E=>E())}}function St(t,n,f,v,P){var E=Ye(f);n=Le(n),ct(t,{name:n,fromWireType:function(x){return!!x},toWireType:function(x,R){return R?v:P},argPackAdvance:8,readValueFromPointer:function(x){var R;if(f===1)R=He;else if(f===2)R=Pe;else if(f===4)R=Je;else throw new TypeError("Unknown boolean type size: "+n);return this.fromWireType(R[x>>E])},destructorFunction:null})}function vr(t){if(!(this instanceof Bt)||!(t instanceof Bt))return!1;for(var n=this.$$.ptrType.registeredClass,f=this.$$.ptr,v=t.$$.ptrType.registeredClass,P=t.$$.ptr;n.baseClass;)f=n.upcast(f),n=n.baseClass;for(;v.baseClass;)P=v.upcast(P),v=v.baseClass;return n===v&&f===P}function qr(t){return{count:t.count,deleteScheduled:t.deleteScheduled,preservePointerOnDelete:t.preservePointerOnDelete,ptr:t.ptr,ptrType:t.ptrType,smartPtr:t.smartPtr,smartPtrType:t.smartPtrType}}function lr(t){function n(f){return f.$$.ptrType.registeredClass.name}xe(n(t)+" instance already deleted")}var yr=!1;function Xt(t){}function Ze(t){t.smartPtr?t.smartPtrType.rawDestructor(t.smartPtr):t.ptrType.registeredClass.rawDestructor(t.ptr)}function _t(t){t.count.value-=1;var n=t.count.value===0;n&&Ze(t)}function Ae(t,n,f){if(n===f)return t;if(f.baseClass===void 0)return null;var v=Ae(t,n,f.baseClass);return v===null?null:f.downcast(v)}var Xe={};function Qt(){return Object.keys(Pt).length}function tr(){var t=[];for(var n in Pt)Pt.hasOwnProperty(n)&&t.push(Pt[n]);return t}var cr=[];function fr(){for(;cr.length;){var t=cr.pop();t.$$.deleteScheduled=!1,t.delete()}}var bt=void 0;function Jr(t){bt=t,cr.length&&bt&&bt(fr)}function vn(){r.getInheritedInstanceCount=Qt,r.getLiveInheritedInstances=tr,r.flushPendingDeletes=fr,r.setDelayFunction=Jr}var Pt={};function zr(t,n){for(n===void 0&&xe("ptr should not be undefined");t.baseClass;)n=t.upcast(n),t=t.baseClass;return n}function rr(t,n){return n=zr(t,n),Pt[n]}function mr(t,n){(!n.ptrType||!n.ptr)&&ye("makeClassHandle requires ptr and ptrType");var f=!!n.smartPtrType,v=!!n.smartPtr;return f!==v&&ye("Both smartPtrType and smartPtr must be specified"),n.count={value:1},gt(Object.create(t,{$$:{value:n}}))}function yn(t){var n=this.getPointee(t);if(!n)return this.destructor(t),null;var f=rr(this.registeredClass,n);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=n,f.$$.smartPtr=t,f.clone();var v=f.clone();return this.destructor(t),v}function P(){return this.isSmartPointer?mr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:n,smartPtrType:this,smartPtr:t}):mr(this.registeredClass.instancePrototype,{ptrType:this,ptr:t})}var E=this.registeredClass.getActualType(n),x=Xe[E];if(!x)return P.call(this);var R;this.isConst?R=x.constPointerType:R=x.pointerType;var $=Ae(n,this.registeredClass,R.registeredClass);return $===null?P.call(this):this.isSmartPointer?mr(R.registeredClass.instancePrototype,{ptrType:R,ptr:$,smartPtrType:this,smartPtr:t}):mr(R.registeredClass.instancePrototype,{ptrType:R,ptr:$})}function gt(t){return typeof FinalizationRegistry>"u"?(gt=n=>n,t):(yr=new FinalizationRegistry(n=>{_t(n.$$)}),gt=n=>{var f=n.$$,v=!!f.smartPtr;if(v){var P={$$:f};yr.register(n,P,n)}return n},Xt=n=>yr.unregister(n),gt(t))}function Ir(){if(this.$$.ptr||lr(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var t=gt(Object.create(Object.getPrototypeOf(this),{$$:{value:qr(this.$$)}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function dr(){this.$$.ptr||lr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&xe("Object already scheduled for deletion"),Xt(this),_t(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function wt(){return!this.$$.ptr}function $r(){return this.$$.ptr||lr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&xe("Object already scheduled for deletion"),cr.push(this),cr.length===1&&bt&&bt(fr),this.$$.deleteScheduled=!0,this}function Kt(){Bt.prototype.isAliasOf=vr,Bt.prototype.clone=Ir,Bt.prototype.delete=dr,Bt.prototype.isDeleted=wt,Bt.prototype.deleteLater=$r}function Bt(){}function _r(t,n,f){if(t[n].overloadTable===void 0){var v=t[n];t[n]=function(){return t[n].overloadTable.hasOwnProperty(arguments.length)||xe("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+t[n].overloadTable+")!"),t[n].overloadTable[arguments.length].apply(this,arguments)},t[n].overloadTable=[],t[n].overloadTable[v.argCount]=v}}function ft(t,n,f){r.hasOwnProperty(t)?(xe("Cannot register public name '"+t+"' twice"),_r(r,t,t),r.hasOwnProperty(f)&&xe("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[t].overloadTable[f]=n):r[t]=n}function mn(t,n,f,v,P,E,x,R){this.name=t,this.constructor=n,this.instancePrototype=f,this.rawDestructor=v,this.baseClass=P,this.getActualType=E,this.upcast=x,this.downcast=R,this.pureVirtualFunctions=[]}function Gt(t,n,f){for(;n!==f;)n.upcast||xe("Expected null or instance of "+f.name+", got an instance of "+n.name),t=n.upcast(t),n=n.baseClass;return t}function Yr(t,n){if(n===null)return this.isReference&&xe("null is not a valid "+this.name),0;n.$$||xe('Cannot pass "'+ir(n)+'" as a '+this.name),n.$$.ptr||xe("Cannot pass deleted object as a pointer of type "+this.name);var f=n.$$.ptrType.registeredClass,v=Gt(n.$$.ptr,f,this.registeredClass);return v}function Or(t,n){var f;if(n===null)return this.isReference&&xe("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),t!==null&&t.push(this.rawDestructor,f),f):0;n.$$||xe('Cannot pass "'+ir(n)+'" as a '+this.name),n.$$.ptr||xe("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&n.$$.ptrType.isConst&&xe("Cannot convert argument of type "+(n.$$.smartPtrType?n.$$.smartPtrType.name:n.$$.ptrType.name)+" to parameter type "+this.name);var v=n.$$.ptrType.registeredClass;if(f=Gt(n.$$.ptr,v,this.registeredClass),this.isSmartPointer)switch(n.$$.smartPtr===void 0&&xe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:n.$$.smartPtrType===this?f=n.$$.smartPtr:xe("Cannot convert argument of type "+(n.$$.smartPtrType?n.$$.smartPtrType.name:n.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=n.$$.smartPtr;break;case 2:if(n.$$.smartPtrType===this)f=n.$$.smartPtr;else{var P=n.clone();f=this.rawShare(f,jt.toHandle(function(){P.delete()})),t!==null&&t.push(this.rawDestructor,f)}break;default:xe("Unsupporting sharing policy")}return f}function _n(t,n){if(n===null)return this.isReference&&xe("null is not a valid "+this.name),0;n.$$||xe('Cannot pass "'+ir(n)+'" as a '+this.name),n.$$.ptr||xe("Cannot pass deleted object as a pointer of type "+this.name),n.$$.ptrType.isConst&&xe("Cannot convert argument of type "+n.$$.ptrType.name+" to parameter type "+this.name);var f=n.$$.ptrType.registeredClass,v=Gt(n.$$.ptr,f,this.registeredClass);return v}function Xr(t){return this.rawGetPointee&&(t=this.rawGetPointee(t)),t}function Rt(t){this.rawDestructor&&this.rawDestructor(t)}function Dt(t){t!==null&&t.delete()}function Qr(){nt.prototype.getPointee=Xr,nt.prototype.destructor=Rt,nt.prototype.argPackAdvance=8,nt.prototype.readValueFromPointer=Be,nt.prototype.deleteObject=Dt,nt.prototype.fromWireType=yn}function nt(t,n,f,v,P,E,x,R,$,B,Q){this.name=t,this.registeredClass=n,this.isReference=f,this.isConst=v,this.isSmartPointer=P,this.pointeeType=E,this.sharingPolicy=x,this.rawGetPointee=R,this.rawConstructor=$,this.rawShare=B,this.rawDestructor=Q,!P&&n.baseClass===void 0?v?(this.toWireType=Yr,this.destructorFunction=null):(this.toWireType=_n,this.destructorFunction=null):this.toWireType=Or}function Kr(t,n,f){r.hasOwnProperty(t)||ye("Replacing nonexistant public symbol"),r[t].overloadTable!==void 0&&f!==void 0||(r[t]=n,r[t].argCount=f)}function Lr(t,n,f){var v=r["dynCall_"+t];return f&&f.length?v.apply(null,[n].concat(f)):v.call(null,n)}var br=[];function ze(t){var n=br[t];return n||(t>=br.length&&(br.length=t+1),br[t]=n=Qe.get(t)),n}function Mt(t,n,f){if(t.includes("j"))return Lr(t,n,f);var v=ze(n).apply(null,f);return v}function Pr(t,n){var f=[];return function(){return f.length=0,Object.assign(f,arguments),Mt(t,n,f)}}function dt(t,n){t=Le(t);function f(){return t.includes("j")?Pr(t,n):ze(n)}var v=f();return typeof v!="function"&&xe("unknown function pointer with signature "+t+": "+n),v}var Zr=void 0;function vt(t){var n=ae(t),f=Le(n);return K(n),f}function Tt(t,n){var f=[],v={};function P(E){if(!v[E]&&!Ct[E]){if(rt[E]){rt[E].forEach(P);return}f.push(E),v[E]=!0}}throw n.forEach(P),new Zr(t+": "+f.map(vt).join([", "]))}function wr(t,n,f,v,P,E,x,R,$,B,Q,ne,ee){Q=Le(Q),E=dt(P,E),R&&(R=dt(x,R)),B&&(B=dt($,B)),ee=dt(ne,ee);var ge=gr(Q);ft(ge,function(){Tt("Cannot construct "+Q+" due to unbound types",[v])}),ut([t,n,f],v?[v]:[],function(de){de=de[0];var Ue,tt;v?(Ue=de.registeredClass,tt=Ue.instancePrototype):tt=Bt.prototype;var at=Yt(ge,function(){if(Object.getPrototypeOf(this)!==Mn)throw new kt("Use 'new' to construct "+Q);if(or.constructor_body===void 0)throw new kt(Q+" has no accessible constructor");var Vi=or.constructor_body[arguments.length];if(Vi===void 0)throw new kt("Tried to invoke ctor of "+Q+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(or.constructor_body).toString()+") parameters instead!");return Vi.apply(this,arguments)}),Mn=Object.create(tt,{constructor:{value:at}});at.prototype=Mn;var or=new mn(Q,at,Mn,ee,Ue,E,R,B),ri=new nt(Q,or,!0,!1,!1),zn=new nt(Q+"*",or,!1,!1,!1),Hi=new nt(Q+" const*",or,!1,!0,!1);return Xe[t]={pointerType:zn,constPointerType:Hi},Kr(ge,at),[ri,zn,Hi]})}function Tr(t,n){for(var f=[],v=0;v<t;v++)f.push(Re[n+v*4>>2]);return f}function bn(t,n){if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+typeof t+" which is not a function");var f=Yt(t.name||"unknownFunctionName",function(){});f.prototype=t.prototype;var v=new f,P=t.apply(v,n);return P instanceof Object?P:v}function Er(t,n,f,v,P){var E=n.length;E<2&&xe("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var x=n[1]!==null&&f!==null,R=!1,$=1;$<n.length;++$)if(n[$]!==null&&n[$].destructorFunction===void 0){R=!0;break}for(var B=n[0].name!=="void",Q="",ne="",$=0;$<E-2;++$)Q+=($!==0?", ":"")+"arg"+$,ne+=($!==0?", ":"")+"arg"+$+"Wired";var ee="return function "+gr(t)+"("+Q+`) {
if (arguments.length !== `+(E-2)+`) {
throwBindingError('function `+t+" called with ' + arguments.length + ' arguments, expected "+(E-2)+` args!');
}
`;R&&(ee+=`var destructors = [];
`);var ge=R?"destructors":"null",de=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Ue=[xe,v,P,Me,n[0],n[1]];x&&(ee+="var thisWired = classParam.toWireType("+ge+`, this);
`);for(var $=0;$<E-2;++$)ee+="var arg"+$+"Wired = argType"+$+".toWireType("+ge+", arg"+$+"); // "+n[$+2].name+`
`,de.push("argType"+$),Ue.push(n[$+2]);if(x&&(ne="thisWired"+(ne.length>0?", ":"")+ne),ee+=(B?"var rv = ":"")+"invoker(fn"+(ne.length>0?", ":"")+ne+`);
`,R)ee+=`runDestructors(destructors);
`;else for(var $=x?1:2;$<n.length;++$){var tt=$===1?"thisWired":"arg"+($-2)+"Wired";n[$].destructorFunction!==null&&(ee+=tt+"_dtor("+tt+"); // "+n[$].name+`
`,de.push(tt+"_dtor"),Ue.push(n[$].destructorFunction))}B&&(ee+=`var ret = retType.fromWireType(rv);
return ret;
`),ee+=`}
`,de.push(ee);var at=bn(Function,de).apply(null,Ue);return at}function Ge(t,n,f,v,P,E){he(n>0);var x=Tr(n,f);P=dt(v,P),ut([],[t],function(R){R=R[0];var $="constructor "+R.name;if(R.registeredClass.constructor_body===void 0&&(R.registeredClass.constructor_body=[]),R.registeredClass.constructor_body[n-1]!==void 0)throw new kt("Cannot register multiple constructors with identical number of parameters ("+(n-1)+") for class '"+R.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return R.registeredClass.constructor_body[n-1]=()=>{Tt("Cannot construct "+R.name+" due to unbound types",x)},ut([],x,function(B){return B.splice(1,0,null),R.registeredClass.constructor_body[n-1]=Er($,B,null,P,E),[]}),[]})}function Ur(t,n,f,v,P,E,x,R){var $=Tr(f,v);n=Le(n),E=dt(P,E),ut([],[t],function(B){B=B[0];var Q=B.name+"."+n;n.startsWith("@@")&&(n=Symbol[n.substring(2)]),R&&B.registeredClass.pureVirtualFunctions.push(n);function ne(){Tt("Cannot call "+Q+" due to unbound types",$)}var ee=B.registeredClass.instancePrototype,ge=ee[n];return ge===void 0||ge.overloadTable===void 0&&ge.className!==B.name&&ge.argCount===f-2?(ne.argCount=f-2,ne.className=B.name,ee[n]=ne):(_r(ee,n,Q),ee[n].overloadTable[f-2]=ne),ut([],$,function(de){var Ue=Er(Q,de,B,E,x);return ee[n].overloadTable===void 0?(Ue.argCount=f-2,ee[n]=Ue):ee[n].overloadTable[f-2]=Ue,[]}),[]})}var xr=[],it=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Fr(t){t>4&&--it[t].refcount===0&&(it[t]=void 0,xr.push(t))}function Et(){for(var t=0,n=5;n<it.length;++n)it[n]!==void 0&&++t;return t}function en(){for(var t=5;t<it.length;++t)if(it[t]!==void 0)return it[t];return null}function nr(){r.count_emval_handles=Et,r.get_first_emval=en}var jt={toValue:t=>(t||xe("Cannot use deleted val. handle = "+t),it[t].value),toHandle:t=>{switch(t){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var n=xr.length?xr.pop():it.length;return it[n]={refcount:1,value:t},n}}}};function Pn(t,n){n=Le(n),ct(t,{name:n,fromWireType:function(f){var v=jt.toValue(f);return Fr(f),v},toWireType:function(f,v){return jt.toHandle(v)},argPackAdvance:8,readValueFromPointer:Be,destructorFunction:null})}function ir(t){if(t===null)return"null";var n=typeof t;return n==="object"||n==="array"||n==="function"?t.toString():""+t}function xt(t,n){switch(n){case 2:return function(f){return this.fromWireType(At[f>>2])};case 3:return function(f){return this.fromWireType(Jt[f>>3])};default:throw new TypeError("Unknown float type: "+t)}}function tn(t,n,f){var v=Ye(f);n=Le(n),ct(t,{name:n,fromWireType:function(P){return P},toWireType:function(P,E){return E},argPackAdvance:8,readValueFromPointer:xt(n,v),destructorFunction:null})}function wn(t,n,f){switch(n){case 0:return f?function(P){return He[P]}:function(P){return Ee[P]};case 1:return f?function(P){return Pe[P>>1]}:function(P){return Ie[P>>1]};case 2:return f?function(P){return Je[P>>2]}:function(P){return Re[P>>2]};default:throw new TypeError("Unknown integer type: "+t)}}function Tn(t,n,f,v,P){n=Le(n);var E=Ye(f),x=ne=>ne;if(v===0){var R=32-8*f;x=ne=>ne<<R>>>R}var $=n.includes("unsigned"),B=(ne,ee)=>{},Q;$?Q=function(ne,ee){return B(ee,this.name),ee>>>0}:Q=function(ne,ee){return B(ee,this.name),ee},ct(t,{name:n,fromWireType:x,toWireType:Q,argPackAdvance:8,readValueFromPointer:wn(n,E,v!==0),destructorFunction:null})}function rn(t,n,f){var v=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],P=v[n];function E(x){x=x>>2;var R=Re,$=R[x],B=R[x+1];return new P(Se,B,$)}f=Le(f),ct(t,{name:f,fromWireType:E,argPackAdvance:8,readValueFromPointer:E},{ignoreDuplicateRegistrations:!0})}function Ar(t,n){n=Le(n);var f=n==="std::string";ct(t,{name:n,fromWireType:function(v){var P=Re[v>>2],E=v+4,x;if(f)for(var R=E,$=0;$<=P;++$){var B=E+$;if($==P||Ee[B]==0){var Q=B-R,ne=qe(R,Q);x===void 0?x=ne:(x+="\0",x+=ne),R=B+1}}else{for(var ee=new Array(P),$=0;$<P;++$)ee[$]=String.fromCharCode(Ee[E+$]);x=ee.join("")}return K(v),x},toWireType:function(v,P){P instanceof ArrayBuffer&&(P=new Uint8Array(P));var E,x=typeof P=="string";x||P instanceof Uint8Array||P instanceof Uint8ClampedArray||P instanceof Int8Array||xe("Cannot pass non-string to std::string"),f&&x?E=Fe(P):E=P.length;var R=G(4+E+1),$=R+4;if(Re[R>>2]=E,f&&x)De(P,$,E+1);else if(x)for(var B=0;B<E;++B){var Q=P.charCodeAt(B);Q>255&&(K($),xe("String has UTF-16 code units that do not fit in 8 bits")),Ee[$+B]=Q}else for(var B=0;B<E;++B)Ee[$+B]=P[B];return v!==null&&v.push(K,R),R},argPackAdvance:8,readValueFromPointer:Be,destructorFunction:function(v){K(v)}})}var nn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function kr(t,n){for(var f=t,v=f>>1,P=v+n/2;!(v>=P)&&Ie[v];)++v;if(f=v<<1,f-t>32&&nn)return nn.decode(Ee.subarray(t,f));for(var E="",x=0;!(x>=n/2);++x){var R=Pe[t+x*2>>1];if(R==0)break;E+=String.fromCharCode(R)}return E}function En(t,n,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var v=n,P=f<t.length*2?f/2:t.length,E=0;E<P;++E){var x=t.charCodeAt(E);Pe[n>>1]=x,n+=2}return Pe[n>>1]=0,n-v}function xn(t){return t.length*2}function An(t,n){for(var f=0,v="";!(f>=n/4);){var P=Je[t+f*4>>2];if(P==0)break;if(++f,P>=65536){var E=P-65536;v+=String.fromCharCode(55296|E>>10,56320|E&1023)}else v+=String.fromCharCode(P)}return v}function Mr(t,n,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var v=n,P=v+f-4,E=0;E<t.length;++E){var x=t.charCodeAt(E);if(x>=55296&&x<=57343){var R=t.charCodeAt(++E);x=65536+((x&1023)<<10)|R&1023}if(Je[n>>2]=x,n+=4,n+4>P)break}return Je[n>>2]=0,n-v}function Cn(t){for(var n=0,f=0;f<t.length;++f){var v=t.charCodeAt(f);v>=55296&&v<=57343&&++f,n+=4}return n}function Sn(t,n,f){f=Le(f);var v,P,E,x,R;n===2?(v=kr,P=En,x=xn,E=()=>Ie,R=1):n===4&&(v=An,P=Mr,x=Cn,E=()=>Re,R=2),ct(t,{name:f,fromWireType:function($){for(var B=Re[$>>2],Q=E(),ne,ee=$+4,ge=0;ge<=B;++ge){var de=$+4+ge*n;if(ge==B||Q[de>>R]==0){var Ue=de-ee,tt=v(ee,Ue);ne===void 0?ne=tt:(ne+="\0",ne+=tt),ee=de+n}}return K($),ne},toWireType:function($,B){typeof B!="string"&&xe("Cannot pass non-string to C++ string type "+f);var Q=x(B),ne=G(4+Q+n);return Re[ne>>2]=Q>>R,P(B,ne+4,Q+n),$!==null&&$.push(K,ne),ne},argPackAdvance:8,readValueFromPointer:Be,destructorFunction:function($){K($)}})}function Rn(t,n,f,v,P,E){Ce[t]={name:Le(n),rawConstructor:dt(f,v),rawDestructor:dt(P,E),fields:[]}}function jr(t,n,f,v,P,E,x,R,$,B){Ce[t].fields.push({fieldName:Le(n),getterReturnType:f,getter:dt(v,P),getterContext:E,setterArgumentType:x,setter:dt(R,$),setterContext:B})}function Dn(t,n){n=Le(n),ct(t,{isVoid:!0,name:n,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,v){}})}function an(){throw 1/0}var on={};function In(t){var n=on[t];return n===void 0?Le(t):n}function Wr(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function $n(t){return t===0?jt.toHandle(Wr()):(t=In(t),jt.toHandle(Wr()[t]))}function sn(t){t>4&&(it[t].refcount+=1)}function un(t,n){var f=Ct[t];return f===void 0&&xe(n+" has unknown type "+vt(t)),f}function ln(t){for(var n="",f=0;f<t;++f)n+=(f!==0?", ":"")+"arg"+f;for(var v=()=>Re,P="return function emval_allocator_"+t+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,f=0;f<t;++f)P+="var argType"+f+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+f+`');
var arg`+f+" = argType"+f+`.readValueFromPointer(args);
args += argType`+f+`['argPackAdvance'];
argTypes += 4;
`;return P+="var obj = new constructor("+n+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",P)(un,r,jt.toHandle,v)}var cn={};function On(t,n,f,v){t=jt.toValue(t);var P=cn[n];return P||(P=ln(n),cn[n]=P),P(t,f,v)}function Ln(t,n){t=un(t,"_emval_take_value");var f=t.readValueFromPointer(n);return jt.toHandle(f)}function Un(){y("")}function Nr(t,n,f){Ee.copyWithin(t,n,n+f)}function Fn(){return 2147483648}function pr(t){try{return fe.grow(t-Se.byteLength+65535>>>16),Ht(fe.buffer),1}catch{}}function kn(t){var n=Ee.length;t=t>>>0;var f=Fn();if(t>f)return!1;let v=($,B)=>$+(B-$%B)%B;for(var P=1;P<=4;P*=2){var E=n*(1+.2/P);E=Math.min(E,t+100663296);var x=Math.min(f,v(Math.max(t,E),65536)),R=pr(x);if(R)return!0}return!1}var Hr={};function Vr(){return U||"./this.program"}function ar(){if(!ar.strings){var t=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:t,_:Vr()};for(var f in Hr)Hr[f]===void 0?delete n[f]:n[f]=Hr[f];var v=[];for(var f in n)v.push(f+"="+n[f]);ar.strings=v}return ar.strings}function Wt(t,n,f){for(var v=0;v<t.length;++v)He[n++>>0]=t.charCodeAt(v);He[n>>0]=0}function fn(t,n){var f=0;return ar().forEach(function(v,P){var E=n+f;Re[t+P*4>>2]=E,Wt(v,E),f+=v.length+1}),0}function dn(t,n){var f=ar();Re[t>>2]=f.length;var v=0;return f.forEach(function(P){v+=P.length+1}),Re[n>>2]=v,0}function Br(t){O(t,new $e(t))}function pn(t,n){Br(t)}var Cr=pn;function Gr(t){return 52}function d(t,n,f,v,P){return 70}var p=[null,[],[]];function T(t,n){var f=p[t];n===0||n===10?((t===1?me:we)(Ne(f,0)),f.length=0):f.push(n)}function I(t,n,f,v){for(var P=0,E=0;E<f;E++){var x=Re[n>>2],R=Re[n+4>>2];n+=8;for(var $=0;$<R;$++)T(t,Ee[x+$]);P+=R}return Re[v>>2]=P,0}function F(t){var n=r["_"+t];return n}function J(t,n){He.set(t,n)}function W(t,n,f,v,P){var E={string:de=>{var Ue=0;if(de!=null&&de!==0){var tt=(de.length<<2)+1;Ue=m(tt),De(de,Ue,tt)}return Ue},array:de=>{var Ue=m(de.length);return J(de,Ue),Ue}};function x(de){return n==="string"?qe(de):n==="boolean"?!!de:de}var R=F(t),$=[],B=0;if(v)for(var Q=0;Q<v.length;Q++){var ne=E[f[Q]];ne?(B===0&&(B=l()),$[Q]=ne(v[Q])):$[Q]=v[Q]}var ee=R.apply(null,$);function ge(de){return B!==0&&c(B),x(de)}return ee=ge(ee),ee}Vt=r.InternalError=We(Error,"InternalError"),er(),kt=r.BindingError=We(Error,"BindingError"),Kt(),vn(),Qr(),Zr=r.UnboundTypeError=We(Error,"UnboundTypeError"),nr();var k={g:st,A:et,w:lt,F:St,u:wr,t:Ge,c:Ur,E:Pn,m:tn,b:Tn,a:rn,l:Ar,h:Sn,J:Rn,d:jr,G:Dn,x:an,i:Fr,r:$n,p:sn,q:On,s:Ln,j:Un,D:Nr,y:kn,z:fn,B:dn,I:Cr,C:Gr,v:d,k:I,o:V,n:X,H:M,f:L,e:z};ve(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.L).apply(null,arguments)};var G=r._malloc=function(){return(G=r._malloc=r.asm.N).apply(null,arguments)},K=r._free=function(){return(K=r._free=r.asm.O).apply(null,arguments)},ae=r.___getTypeName=function(){return(ae=r.___getTypeName=r.asm.P).apply(null,arguments)};r.__embind_initialize_bindings=function(){return(r.__embind_initialize_bindings=r.asm.Q).apply(null,arguments)};var se=r._setThrew=function(){return(se=r._setThrew=r.asm.R).apply(null,arguments)},l=r.stackSave=function(){return(l=r.stackSave=r.asm.S).apply(null,arguments)},c=r.stackRestore=function(){return(c=r.stackRestore=r.asm.T).apply(null,arguments)},m=r.stackAlloc=function(){return(m=r.stackAlloc=r.asm.U).apply(null,arguments)},A=r.___cxa_is_pointer_type=function(){return(A=r.___cxa_is_pointer_type=r.asm.V).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.W).apply(null,arguments)};function L(t,n){var f=l();try{ze(t)(n)}catch(v){if(c(f),v!==v+0)throw v;se(1,0)}}function V(t,n){var f=l();try{return ze(t)(n)}catch(v){if(c(f),v!==v+0)throw v;se(1,0)}}function z(t,n,f,v){var P=l();try{ze(t)(n,f,v)}catch(E){if(c(P),E!==E+0)throw E;se(1,0)}}function M(t,n,f,v){var P=l();try{return ze(t)(n,f,v)}catch(E){if(c(P),E!==E+0)throw E;se(1,0)}}function X(t,n,f){var v=l();try{return ze(t)(n,f)}catch(P){if(c(v),P!==P+0)throw P;se(1,0)}}r.ccall=W;var s;ot=function t(){s||u(),s||(ot=t)};function u(t){if(Ut>0||(Zt(),Ut>0))return;function n(){s||(s=!0,r.calledRun=!0,!_e&&(Sr(),g(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),sr()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),n()},1)):n()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return u(),h.ready})})();e.exports=a})(_i)),_i.exports}var au=iu();const ou=ui(au),su=new URL("/radiology-ai-viewer/assets/libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url),oi={codec:void 0,decoder:void 0};function Ka(){if(oi.codec)return Promise.resolve();const e=ou({locateFile:i=>i.endsWith(".wasm")?su.toString():i});return new Promise((i,a)=>{e.then(o=>{oi.codec=o,oi.decoder=new o.JPEGDecoder,i()},a)})}async function Za(e,i){await Ka();const a=oi.decoder;a.getEncodedBuffer(e.length).set(e),a.decode();const h=a.getFrameInfo(),r=a.getDecodedBuffer(),g={columns:h.width,rows:h.height,bitsPerPixel:h.bitsPerSample,signed:i.signed,bytesPerPixel:i.bytesPerPixel,componentsPerPixel:h.componentCount},w=uu(h,r),C={frameInfo:h};return{...i,pixelData:w,imageInfo:g,encodeOptions:C,...C,...g}}function uu(e,i){return e.isSigned?new Int8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}const lu=Ka,Qn={JpegImage:void 0,decodeConfig:{}};function eo(e){return Qn.decodeConfig=e,Qn.JpegImage?Promise.resolve():new Promise((i,a)=>{pa(()=>import("./jpeg-B-x1txLf.js"),[]).then(o=>{Qn.JpegImage=o.default,i()}).catch(a)})}async function to(e,i){if(await eo(),typeof Qn.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const a=new Qn.JpegImage;if(a.parse(i),a.colorTransform=!1,e.bitsAllocated===8)return e.pixelData=a.getData(e.columns,e.rows),e;if(e.bitsAllocated===16)return e.pixelData=a.getData16(e.columns,e.rows),e}const Kn={DecoderClass:void 0,decodeConfig:{}};function ro(e){return Kn.decodeConfig=e,Kn.DecoderClass?Promise.resolve():new Promise((i,a)=>{pa(async()=>{const{Decoder:o}=await import("./lossless-CyYqoyFe.js");return{Decoder:o}},[]).then(({Decoder:o})=>{Kn.DecoderClass=o,i()},a)})}async function Ci(e,i){if(await ro(),typeof Kn.DecoderClass>"u")throw new Error("No JPEG Lossless decoder loaded");const a=new Kn.DecoderClass,o=e.bitsAllocated<=8?1:2,h=i.buffer,r=a.decode(h,i.byteOffset,i.length,o);return e.pixelRepresentation===0?e.bitsAllocated===16?(e.pixelData=new Uint16Array(r.buffer),e):(e.pixelData=new Uint8Array(r.buffer),e):(e.pixelData=new Int16Array(r.buffer),e)}var bi={exports:{}},aa;function cu(){return aa||(aa=1,(function(e,i){var a=(()=>{var o=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(o=o||__filename),(function(h){h=h||{};var r=typeof h<"u"?h:{},g,w;r.ready=new Promise(function(d,p){g=d,w=p});var C=Object.assign({},r),U=typeof window=="object",O=typeof importScripts=="function",j=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",H="";function N(d){return r.locateFile?r.locateFile(d,H):H+d}var Y,Z,re;if(j){var oe=hn,ie=hn;O?H=ie.dirname(H)+"/":H=__dirname+"/",Y=(d,p)=>(d=y(d)?new URL(d):ie.normalize(d),oe.readFileSync(d,p?void 0:"utf8")),re=d=>{var p=Y(d,!0);return p.buffer||(p=new Uint8Array(p)),p},Z=(d,p,T)=>{d=y(d)?new URL(d):ie.normalize(d),oe.readFile(d,function(I,F){I?T(I):p(F.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(d){if(!(d instanceof q))throw d}),process.on("unhandledRejection",function(d){throw d}),r.inspect=function(){return"[Emscripten Module object]"}}else(U||O)&&(O?H=self.location.href:typeof document<"u"&&document.currentScript&&(H=document.currentScript.src),o&&(H=o),H.indexOf("blob:")!==0?H=H.substr(0,H.replace(/[?#].*/,"").lastIndexOf("/")+1):H="",Y=d=>{var p=new XMLHttpRequest;return p.open("GET",d,!1),p.send(null),p.responseText},O&&(re=d=>{var p=new XMLHttpRequest;return p.open("GET",d,!1),p.responseType="arraybuffer",p.send(null),new Uint8Array(p.response)}),Z=(d,p,T)=>{var I=new XMLHttpRequest;I.open("GET",d,!0),I.responseType="arraybuffer",I.onload=()=>{if(I.status==200||I.status==0&&I.response){p(I.response);return}T()},I.onerror=T,I.send(null)});r.print||console.log.bind(console);var ce=r.printErr||console.warn.bind(console);Object.assign(r,C),C=null,r.arguments&&r.arguments,r.thisProgram&&r.thisProgram,r.quit&&r.quit;var pe;r.wasmBinary&&(pe=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ot("no native wasm support detected");var me,we=!1;function je(d,p){d||ot(p)}var fe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function _e(d,p,T){for(var I=p+T,F=p;d[F]&&!(F>=I);)++F;if(F-p>16&&d.buffer&&fe)return fe.decode(d.subarray(p,F));for(var J="";p<F;){var W=d[p++];if(!(W&128)){J+=String.fromCharCode(W);continue}var k=d[p++]&63;if((W&224)==192){J+=String.fromCharCode((W&31)<<6|k);continue}var G=d[p++]&63;if((W&240)==224?W=(W&15)<<12|k<<6|G:W=(W&7)<<18|k<<12|G<<6|d[p++]&63,W<65536)J+=String.fromCharCode(W);else{var K=W-65536;J+=String.fromCharCode(55296|K>>10,56320|K&1023)}}return J}function he(d,p){return d?_e(Fe,d,p):""}function Te(d,p,T,I){if(!(I>0))return 0;for(var F=T,J=T+I-1,W=0;W<d.length;++W){var k=d.charCodeAt(W);if(k>=55296&&k<=57343){var G=d.charCodeAt(++W);k=65536+((k&1023)<<10)|G&1023}if(k<=127){if(T>=J)break;p[T++]=k}else if(k<=2047){if(T+1>=J)break;p[T++]=192|k>>6,p[T++]=128|k&63}else if(k<=65535){if(T+2>=J)break;p[T++]=224|k>>12,p[T++]=128|k>>6&63,p[T++]=128|k&63}else{if(T+3>=J)break;p[T++]=240|k>>18,p[T++]=128|k>>12&63,p[T++]=128|k>>6&63,p[T++]=128|k&63}}return p[T]=0,T-F}function Ne(d,p,T){return Te(d,Fe,p,T)}function qe(d){for(var p=0,T=0;T<d.length;++T){var I=d.charCodeAt(T);I<=127?p++:I<=2047?p+=2:I>=55296&&I<=57343?(p+=4,++T):p+=3}return p}var ue,De,Fe,Se,He,Ee,Pe,Ie,Je;function Re(d){ue=d,r.HEAP8=De=new Int8Array(d),r.HEAP16=Se=new Int16Array(d),r.HEAP32=Ee=new Int32Array(d),r.HEAPU8=Fe=new Uint8Array(d),r.HEAPU16=He=new Uint16Array(d),r.HEAPU32=Pe=new Uint32Array(d),r.HEAPF32=Ie=new Float32Array(d),r.HEAPF64=Je=new Float64Array(d)}r.INITIAL_MEMORY;var At,Jt=[],Ht=[],Qe=[];function Ot(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Zt(r.preRun.shift());te(Jt)}function yt(){te(Ht)}function mt(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)sr(r.postRun.shift());te(Qe)}function Zt(d){Jt.unshift(d)}function Sr(d){Ht.unshift(d)}function sr(d){Qe.unshift(d)}var ht=0,Ke=null;function Lt(d){ht++,r.monitorRunDependencies&&r.monitorRunDependencies(ht)}function Ut(d){if(ht--,r.monitorRunDependencies&&r.monitorRunDependencies(ht),ht==0&&Ke){var p=Ke;Ke=null,p()}}function ot(d){r.onAbort&&r.onAbort(d),d="Aborted("+d+")",ce(d),we=!0,d+=". Build with -sASSERTIONS for more info.";var p=new WebAssembly.RuntimeError(d);throw w(p),p}var Ft="data:application/octet-stream;base64,";function ur(d){return d.startsWith(Ft)}function y(d){return d.startsWith("file://")}var _;_="charlswasm_decode.wasm",ur(_)||(_=N(_));function S(d){try{if(d==_&&pe)return new Uint8Array(pe);if(re)return re(d);throw"both async and sync fetching of the wasm failed"}catch(p){ot(p)}}function b(){if(!pe&&(U||O)){if(typeof fetch=="function"&&!y(_))return fetch(_,{credentials:"same-origin"}).then(function(d){if(!d.ok)throw"failed to load wasm binary file at '"+_+"'";return d.arrayBuffer()}).catch(function(){return S(_)});if(Z)return new Promise(function(d,p){Z(_,function(T){d(new Uint8Array(T))},p)})}return Promise.resolve().then(function(){return S(_)})}function D(){var d={a:Hr};function p(W,k){var G=W.exports;r.asm=G,me=r.asm.z,Re(me.buffer),At=r.asm.C,Sr(r.asm.A),Ut()}Lt();function T(W){p(W.instance)}function I(W){return b().then(function(k){return WebAssembly.instantiate(k,d)}).then(function(k){return k}).then(W,function(k){ce("failed to asynchronously prepare wasm: "+k),ot(k)})}function F(){return!pe&&typeof WebAssembly.instantiateStreaming=="function"&&!ur(_)&&!y(_)&&!j&&typeof fetch=="function"?fetch(_,{credentials:"same-origin"}).then(function(W){var k=WebAssembly.instantiateStreaming(W,d);return k.then(T,function(G){return ce("wasm streaming compile failed: "+G),ce("falling back to ArrayBuffer instantiation"),I(T)})}):I(T)}if(r.instantiateWasm)try{var J=r.instantiateWasm(d,p);return J}catch(W){ce("Module.instantiateWasm callback failed with error: "+W),w(W)}return F().catch(w),{}}function q(d){this.name="ExitStatus",this.message="Program terminated with exit("+d+")",this.status=d}function te(d){for(;d.length>0;)d.shift()(r)}function ve(d){this.excPtr=d,this.ptr=d-24,this.set_type=function(p){Pe[this.ptr+4>>2]=p},this.get_type=function(){return Pe[this.ptr+4>>2]},this.set_destructor=function(p){Pe[this.ptr+8>>2]=p},this.get_destructor=function(){return Pe[this.ptr+8>>2]},this.set_refcount=function(p){Ee[this.ptr>>2]=p},this.set_caught=function(p){p=p?1:0,De[this.ptr+12>>0]=p},this.get_caught=function(){return De[this.ptr+12>>0]!=0},this.set_rethrown=function(p){p=p?1:0,De[this.ptr+13>>0]=p},this.get_rethrown=function(){return De[this.ptr+13>>0]!=0},this.init=function(p,T){this.set_adjusted_ptr(0),this.set_type(p),this.set_destructor(T),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var p=Ee[this.ptr>>2];Ee[this.ptr>>2]=p+1},this.release_ref=function(){var p=Ee[this.ptr>>2];return Ee[this.ptr>>2]=p-1,p===1},this.set_adjusted_ptr=function(p){Pe[this.ptr+16>>2]=p},this.get_adjusted_ptr=function(){return Pe[this.ptr+16>>2]},this.get_exception_ptr=function(){var p=pn(this.get_type());if(p)return Pe[this.excPtr>>2];var T=this.get_adjusted_ptr();return T!==0?T:this.excPtr}}function $e(d,p,T){var I=new ve(d);throw I.init(p,T),d}var Ve={};function ke(d){for(;d.length;){var p=d.pop(),T=d.pop();T(p)}}function st(d){return this.fromWireType(Ee[d>>2])}var Ce={},Me={},Be={},zt=48,Ct=57;function rt(d){if(d===void 0)return"_unknown";d=d.replace(/[^a-zA-Z0-9_]/g,"$");var p=d.charCodeAt(0);return p>=zt&&p<=Ct?"_"+d:d}function Rr(d,p){return d=rt(d),new Function("body","return function "+d+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(p)}function Dr(d,p){var T=Rr(p,function(I){this.name=p,this.message=I;var F=new Error(I).stack;F!==void 0&&(this.stack=this.toString()+`
`+F.replace(/^Error(:[^\n]*)?\n/,""))});return T.prototype=Object.create(d.prototype),T.prototype.constructor=T,T.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},T}var gr=void 0;function Yt(d){throw new gr(d)}function We(d,p,T){d.forEach(function(k){Be[k]=p});function I(k){var G=T(k);G.length!==d.length&&Yt("Mismatched type converter count");for(var K=0;K<d.length;++K)Le(d[K],G[K])}var F=new Array(p.length),J=[],W=0;p.forEach((k,G)=>{Me.hasOwnProperty(k)?F[G]=Me[k]:(J.push(k),Ce.hasOwnProperty(k)||(Ce[k]=[]),Ce[k].push(()=>{F[G]=Me[k],++W,W===J.length&&I(F)}))}),J.length===0&&I(F)}function Vt(d){var p=Ve[d];delete Ve[d];var T=p.rawConstructor,I=p.rawDestructor,F=p.fields,J=F.map(W=>W.getterReturnType).concat(F.map(W=>W.setterArgumentType));We([d],J,W=>{var k={};return F.forEach((G,K)=>{var ae=G.fieldName,se=W[K],l=G.getter,c=G.getterContext,m=W[K+F.length],A=G.setter,L=G.setterContext;k[ae]={read:V=>se.fromWireType(l(c,V)),write:(V,z)=>{var M=[];A(L,V,m.toWireType(M,z)),ke(M)}}}),[{name:p.name,fromWireType:function(G){var K={};for(var ae in k)K[ae]=k[ae].read(G);return I(G),K},toWireType:function(G,K){for(var ae in k)if(!(ae in K))throw new TypeError('Missing field:  "'+ae+'"');var se=T();for(ae in k)k[ae].write(se,K[ae]);return G!==null&&G.push(I,se),se},argPackAdvance:8,readValueFromPointer:st,destructorFunction:I}]})}function ye(d,p,T,I,F){}function ut(d){switch(d){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+d)}}function et(){for(var d=new Array(256),p=0;p<256;++p)d[p]=String.fromCharCode(p);lt=d}var lt=void 0;function Ye(d){for(var p="",T=d;Fe[T];)p+=lt[Fe[T++]];return p}var er=void 0;function be(d){throw new er(d)}function Le(d,p,T={}){if(!("argPackAdvance"in p))throw new TypeError("registerType registeredInstance requires argPackAdvance");var I=p.name;if(d||be('type "'+I+'" must have a positive integer typeid pointer'),Me.hasOwnProperty(d)){if(T.ignoreDuplicateRegistrations)return;be("Cannot register type '"+I+"' twice")}if(Me[d]=p,delete Be[d],Ce.hasOwnProperty(d)){var F=Ce[d];delete Ce[d],F.forEach(J=>J())}}function kt(d,p,T,I,F){var J=ut(T);p=Ye(p),Le(d,{name:p,fromWireType:function(W){return!!W},toWireType:function(W,k){return k?I:F},argPackAdvance:8,readValueFromPointer:function(W){var k;if(T===1)k=De;else if(T===2)k=Se;else if(T===4)k=Ee;else throw new TypeError("Unknown boolean type size: "+p);return this.fromWireType(k[W>>J])},destructorFunction:null})}function xe(d){if(!(this instanceof wt)||!(d instanceof wt))return!1;for(var p=this.$$.ptrType.registeredClass,T=this.$$.ptr,I=d.$$.ptrType.registeredClass,F=d.$$.ptr;p.baseClass;)T=p.upcast(T),p=p.baseClass;for(;I.baseClass;)F=I.upcast(F),I=I.baseClass;return p===I&&T===F}function ct(d){return{count:d.count,deleteScheduled:d.deleteScheduled,preservePointerOnDelete:d.preservePointerOnDelete,ptr:d.ptr,ptrType:d.ptrType,smartPtr:d.smartPtr,smartPtrType:d.smartPtrType}}function St(d){function p(T){return T.$$.ptrType.registeredClass.name}be(p(d)+" instance already deleted")}var vr=!1;function qr(d){}function lr(d){d.smartPtr?d.smartPtrType.rawDestructor(d.smartPtr):d.ptrType.registeredClass.rawDestructor(d.ptr)}function yr(d){d.count.value-=1;var p=d.count.value===0;p&&lr(d)}function Xt(d,p,T){if(p===T)return d;if(T.baseClass===void 0)return null;var I=Xt(d,p,T.baseClass);return I===null?null:T.downcast(I)}var Ze={};function _t(){return Object.keys(bt).length}function Ae(){var d=[];for(var p in bt)bt.hasOwnProperty(p)&&d.push(bt[p]);return d}var Xe=[];function Qt(){for(;Xe.length;){var d=Xe.pop();d.$$.deleteScheduled=!1,d.delete()}}var tr=void 0;function cr(d){tr=d,Xe.length&&tr&&tr(Qt)}function fr(){r.getInheritedInstanceCount=_t,r.getLiveInheritedInstances=Ae,r.flushPendingDeletes=Qt,r.setDelayFunction=cr}var bt={};function Jr(d,p){for(p===void 0&&be("ptr should not be undefined");d.baseClass;)p=d.upcast(p),d=d.baseClass;return p}function vn(d,p){return p=Jr(d,p),bt[p]}function Pt(d,p){(!p.ptrType||!p.ptr)&&Yt("makeClassHandle requires ptr and ptrType");var T=!!p.smartPtrType,I=!!p.smartPtr;return T!==I&&Yt("Both smartPtrType and smartPtr must be specified"),p.count={value:1},rr(Object.create(d,{$$:{value:p}}))}function zr(d){var p=this.getPointee(d);if(!p)return this.destructor(d),null;var T=vn(this.registeredClass,p);if(T!==void 0){if(T.$$.count.value===0)return T.$$.ptr=p,T.$$.smartPtr=d,T.clone();var I=T.clone();return this.destructor(d),I}function F(){return this.isSmartPointer?Pt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:p,smartPtrType:this,smartPtr:d}):Pt(this.registeredClass.instancePrototype,{ptrType:this,ptr:d})}var J=this.registeredClass.getActualType(p),W=Ze[J];if(!W)return F.call(this);var k;this.isConst?k=W.constPointerType:k=W.pointerType;var G=Xt(p,this.registeredClass,k.registeredClass);return G===null?F.call(this):this.isSmartPointer?Pt(k.registeredClass.instancePrototype,{ptrType:k,ptr:G,smartPtrType:this,smartPtr:d}):Pt(k.registeredClass.instancePrototype,{ptrType:k,ptr:G})}function rr(d){return typeof FinalizationRegistry>"u"?(rr=p=>p,d):(vr=new FinalizationRegistry(p=>{yr(p.$$)}),rr=p=>{var T=p.$$,I=!!T.smartPtr;if(I){var F={$$:T};vr.register(p,F,p)}return p},qr=p=>vr.unregister(p),rr(d))}function mr(){if(this.$$.ptr||St(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var d=rr(Object.create(Object.getPrototypeOf(this),{$$:{value:ct(this.$$)}}));return d.$$.count.value+=1,d.$$.deleteScheduled=!1,d}function yn(){this.$$.ptr||St(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&be("Object already scheduled for deletion"),qr(this),yr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function gt(){return!this.$$.ptr}function Ir(){return this.$$.ptr||St(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&be("Object already scheduled for deletion"),Xe.push(this),Xe.length===1&&tr&&tr(Qt),this.$$.deleteScheduled=!0,this}function dr(){wt.prototype.isAliasOf=xe,wt.prototype.clone=mr,wt.prototype.delete=yn,wt.prototype.isDeleted=gt,wt.prototype.deleteLater=Ir}function wt(){}function $r(d,p,T){if(d[p].overloadTable===void 0){var I=d[p];d[p]=function(){return d[p].overloadTable.hasOwnProperty(arguments.length)||be("Function '"+T+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+d[p].overloadTable+")!"),d[p].overloadTable[arguments.length].apply(this,arguments)},d[p].overloadTable=[],d[p].overloadTable[I.argCount]=I}}function Kt(d,p,T){r.hasOwnProperty(d)?((T===void 0||r[d].overloadTable!==void 0&&r[d].overloadTable[T]!==void 0)&&be("Cannot register public name '"+d+"' twice"),$r(r,d,d),r.hasOwnProperty(T)&&be("Cannot register multiple overloads of a function with the same number of arguments ("+T+")!"),r[d].overloadTable[T]=p):(r[d]=p,T!==void 0&&(r[d].numArguments=T))}function Bt(d,p,T,I,F,J,W,k){this.name=d,this.constructor=p,this.instancePrototype=T,this.rawDestructor=I,this.baseClass=F,this.getActualType=J,this.upcast=W,this.downcast=k,this.pureVirtualFunctions=[]}function _r(d,p,T){for(;p!==T;)p.upcast||be("Expected null or instance of "+T.name+", got an instance of "+p.name),d=p.upcast(d),p=p.baseClass;return d}function ft(d,p){if(p===null)return this.isReference&&be("null is not a valid "+this.name),0;p.$$||be('Cannot pass "'+nr(p)+'" as a '+this.name),p.$$.ptr||be("Cannot pass deleted object as a pointer of type "+this.name);var T=p.$$.ptrType.registeredClass,I=_r(p.$$.ptr,T,this.registeredClass);return I}function mn(d,p){var T;if(p===null)return this.isReference&&be("null is not a valid "+this.name),this.isSmartPointer?(T=this.rawConstructor(),d!==null&&d.push(this.rawDestructor,T),T):0;p.$$||be('Cannot pass "'+nr(p)+'" as a '+this.name),p.$$.ptr||be("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&p.$$.ptrType.isConst&&be("Cannot convert argument of type "+(p.$$.smartPtrType?p.$$.smartPtrType.name:p.$$.ptrType.name)+" to parameter type "+this.name);var I=p.$$.ptrType.registeredClass;if(T=_r(p.$$.ptr,I,this.registeredClass),this.isSmartPointer)switch(p.$$.smartPtr===void 0&&be("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:p.$$.smartPtrType===this?T=p.$$.smartPtr:be("Cannot convert argument of type "+(p.$$.smartPtrType?p.$$.smartPtrType.name:p.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:T=p.$$.smartPtr;break;case 2:if(p.$$.smartPtrType===this)T=p.$$.smartPtr;else{var F=p.clone();T=this.rawShare(T,Et.toHandle(function(){F.delete()})),d!==null&&d.push(this.rawDestructor,T)}break;default:be("Unsupporting sharing policy")}return T}function Gt(d,p){if(p===null)return this.isReference&&be("null is not a valid "+this.name),0;p.$$||be('Cannot pass "'+nr(p)+'" as a '+this.name),p.$$.ptr||be("Cannot pass deleted object as a pointer of type "+this.name),p.$$.ptrType.isConst&&be("Cannot convert argument of type "+p.$$.ptrType.name+" to parameter type "+this.name);var T=p.$$.ptrType.registeredClass,I=_r(p.$$.ptr,T,this.registeredClass);return I}function Yr(d){return this.rawGetPointee&&(d=this.rawGetPointee(d)),d}function Or(d){this.rawDestructor&&this.rawDestructor(d)}function _n(d){d!==null&&d.delete()}function Xr(){Rt.prototype.getPointee=Yr,Rt.prototype.destructor=Or,Rt.prototype.argPackAdvance=8,Rt.prototype.readValueFromPointer=st,Rt.prototype.deleteObject=_n,Rt.prototype.fromWireType=zr}function Rt(d,p,T,I,F,J,W,k,G,K,ae){this.name=d,this.registeredClass=p,this.isReference=T,this.isConst=I,this.isSmartPointer=F,this.pointeeType=J,this.sharingPolicy=W,this.rawGetPointee=k,this.rawConstructor=G,this.rawShare=K,this.rawDestructor=ae,!F&&p.baseClass===void 0?I?(this.toWireType=ft,this.destructorFunction=null):(this.toWireType=Gt,this.destructorFunction=null):this.toWireType=mn}function Dt(d,p,T){r.hasOwnProperty(d)||Yt("Replacing nonexistant public symbol"),r[d].overloadTable!==void 0&&T!==void 0?r[d].overloadTable[T]=p:(r[d]=p,r[d].argCount=T)}function Qr(d,p,T){var I=r["dynCall_"+d];return T&&T.length?I.apply(null,[p].concat(T)):I.call(null,p)}var nt=[];function Kr(d){var p=nt[d];return p||(d>=nt.length&&(nt.length=d+1),nt[d]=p=At.get(d)),p}function Lr(d,p,T){if(d.includes("j"))return Qr(d,p,T);var I=Kr(p).apply(null,T);return I}function br(d,p){var T=[];return function(){return T.length=0,Object.assign(T,arguments),Lr(d,p,T)}}function ze(d,p){d=Ye(d);function T(){return d.includes("j")?br(d,p):Kr(p)}var I=T();return typeof I!="function"&&be("unknown function pointer with signature "+d+": "+p),I}var Mt=void 0;function Pr(d){var p=ar(d),T=Ye(p);return Wt(p),T}function dt(d,p){var T=[],I={};function F(J){if(!I[J]&&!Me[J]){if(Be[J]){Be[J].forEach(F);return}T.push(J),I[J]=!0}}throw p.forEach(F),new Mt(d+": "+T.map(Pr).join([", "]))}function Zr(d,p,T,I,F,J,W,k,G,K,ae,se,l){ae=Ye(ae),J=ze(F,J),k&&(k=ze(W,k)),K&&(K=ze(G,K)),l=ze(se,l);var c=rt(ae);Kt(c,function(){dt("Cannot construct "+ae+" due to unbound types",[I])}),We([d,p,T],I?[I]:[],function(m){m=m[0];var A,L;I?(A=m.registeredClass,L=A.instancePrototype):L=wt.prototype;var V=Rr(c,function(){if(Object.getPrototypeOf(this)!==z)throw new er("Use 'new' to construct "+ae);if(M.constructor_body===void 0)throw new er(ae+" has no accessible constructor");var t=M.constructor_body[arguments.length];if(t===void 0)throw new er("Tried to invoke ctor of "+ae+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(M.constructor_body).toString()+") parameters instead!");return t.apply(this,arguments)}),z=Object.create(L,{constructor:{value:V}});V.prototype=z;var M=new Bt(ae,V,z,l,A,J,k,K),X=new Rt(ae,M,!0,!1,!1),s=new Rt(ae+"*",M,!1,!1,!1),u=new Rt(ae+" const*",M,!1,!0,!1);return Ze[d]={pointerType:s,constPointerType:u},Dt(c,V),[X,s,u]})}function vt(d,p){for(var T=[],I=0;I<d;I++)T.push(Pe[p+I*4>>2]);return T}function Tt(d,p){if(!(d instanceof Function))throw new TypeError("new_ called with constructor type "+typeof d+" which is not a function");var T=Rr(d.name||"unknownFunctionName",function(){});T.prototype=d.prototype;var I=new T,F=d.apply(I,p);return F instanceof Object?F:I}function wr(d,p,T,I,F){var J=p.length;J<2&&be("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var W=p[1]!==null&&T!==null,k=!1,G=1;G<p.length;++G)if(p[G]!==null&&p[G].destructorFunction===void 0){k=!0;break}for(var K=p[0].name!=="void",ae="",se="",G=0;G<J-2;++G)ae+=(G!==0?", ":"")+"arg"+G,se+=(G!==0?", ":"")+"arg"+G+"Wired";var l="return function "+rt(d)+"("+ae+`) {
if (arguments.length !== `+(J-2)+`) {
throwBindingError('function `+d+" called with ' + arguments.length + ' arguments, expected "+(J-2)+` args!');
}
`;k&&(l+=`var destructors = [];
`);var c=k?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],A=[be,I,F,ke,p[0],p[1]];W&&(l+="var thisWired = classParam.toWireType("+c+`, this);
`);for(var G=0;G<J-2;++G)l+="var arg"+G+"Wired = argType"+G+".toWireType("+c+", arg"+G+"); // "+p[G+2].name+`
`,m.push("argType"+G),A.push(p[G+2]);if(W&&(se="thisWired"+(se.length>0?", ":"")+se),l+=(K?"var rv = ":"")+"invoker(fn"+(se.length>0?", ":"")+se+`);
`,k)l+=`runDestructors(destructors);
`;else for(var G=W?1:2;G<p.length;++G){var L=G===1?"thisWired":"arg"+(G-2)+"Wired";p[G].destructorFunction!==null&&(l+=L+"_dtor("+L+"); // "+p[G].name+`
`,m.push(L+"_dtor"),A.push(p[G].destructorFunction))}K&&(l+=`var ret = retType.fromWireType(rv);
return ret;
`),l+=`}
`,m.push(l);var V=Tt(Function,m).apply(null,A);return V}function Tr(d,p,T,I,F,J){je(p>0);var W=vt(p,T);F=ze(I,F),We([],[d],function(k){k=k[0];var G="constructor "+k.name;if(k.registeredClass.constructor_body===void 0&&(k.registeredClass.constructor_body=[]),k.registeredClass.constructor_body[p-1]!==void 0)throw new er("Cannot register multiple constructors with identical number of parameters ("+(p-1)+") for class '"+k.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return k.registeredClass.constructor_body[p-1]=()=>{dt("Cannot construct "+k.name+" due to unbound types",W)},We([],W,function(K){return K.splice(1,0,null),k.registeredClass.constructor_body[p-1]=wr(G,K,null,F,J),[]}),[]})}function bn(d,p,T,I,F,J,W,k){var G=vt(T,I);p=Ye(p),J=ze(F,J),We([],[d],function(K){K=K[0];var ae=K.name+"."+p;p.startsWith("@@")&&(p=Symbol[p.substring(2)]),k&&K.registeredClass.pureVirtualFunctions.push(p);function se(){dt("Cannot call "+ae+" due to unbound types",G)}var l=K.registeredClass.instancePrototype,c=l[p];return c===void 0||c.overloadTable===void 0&&c.className!==K.name&&c.argCount===T-2?(se.argCount=T-2,se.className=K.name,l[p]=se):($r(l,p,ae),l[p].overloadTable[T-2]=se),We([],G,function(m){var A=wr(ae,m,K,J,W);return l[p].overloadTable===void 0?(A.argCount=T-2,l[p]=A):l[p].overloadTable[T-2]=A,[]}),[]})}var Er=[],Ge=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ur(d){d>4&&--Ge[d].refcount===0&&(Ge[d]=void 0,Er.push(d))}function xr(){for(var d=0,p=5;p<Ge.length;++p)Ge[p]!==void 0&&++d;return d}function it(){for(var d=5;d<Ge.length;++d)if(Ge[d]!==void 0)return Ge[d];return null}function Fr(){r.count_emval_handles=xr,r.get_first_emval=it}var Et={toValue:d=>(d||be("Cannot use deleted val. handle = "+d),Ge[d].value),toHandle:d=>{switch(d){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var p=Er.length?Er.pop():Ge.length;return Ge[p]={refcount:1,value:d},p}}}};function en(d,p){p=Ye(p),Le(d,{name:p,fromWireType:function(T){var I=Et.toValue(T);return Ur(T),I},toWireType:function(T,I){return Et.toHandle(I)},argPackAdvance:8,readValueFromPointer:st,destructorFunction:null})}function nr(d){if(d===null)return"null";var p=typeof d;return p==="object"||p==="array"||p==="function"?d.toString():""+d}function jt(d,p){switch(p){case 2:return function(T){return this.fromWireType(Ie[T>>2])};case 3:return function(T){return this.fromWireType(Je[T>>3])};default:throw new TypeError("Unknown float type: "+d)}}function Pn(d,p,T){var I=ut(T);p=Ye(p),Le(d,{name:p,fromWireType:function(F){return F},toWireType:function(F,J){return J},argPackAdvance:8,readValueFromPointer:jt(p,I),destructorFunction:null})}function ir(d,p,T,I,F,J){var W=vt(p,T);d=Ye(d),F=ze(I,F),Kt(d,function(){dt("Cannot call "+d+" due to unbound types",W)},p-1),We([],W,function(k){var G=[k[0],null].concat(k.slice(1));return Dt(d,wr(d,G,null,F,J),p-1),[]})}function xt(d,p,T){switch(p){case 0:return T?function(F){return De[F]}:function(F){return Fe[F]};case 1:return T?function(F){return Se[F>>1]}:function(F){return He[F>>1]};case 2:return T?function(F){return Ee[F>>2]}:function(F){return Pe[F>>2]};default:throw new TypeError("Unknown integer type: "+d)}}function tn(d,p,T,I,F){p=Ye(p);var J=ut(T),W=se=>se;if(I===0){var k=32-8*T;W=se=>se<<k>>>k}var G=p.includes("unsigned"),K=(se,l)=>{},ae;G?ae=function(se,l){return K(l,this.name),l>>>0}:ae=function(se,l){return K(l,this.name),l},Le(d,{name:p,fromWireType:W,toWireType:ae,argPackAdvance:8,readValueFromPointer:xt(p,J,I!==0),destructorFunction:null})}function wn(d,p,T){var I=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],F=I[p];function J(W){W=W>>2;var k=Pe,G=k[W],K=k[W+1];return new F(ue,K,G)}T=Ye(T),Le(d,{name:T,fromWireType:J,argPackAdvance:8,readValueFromPointer:J},{ignoreDuplicateRegistrations:!0})}function Tn(d,p){p=Ye(p);var T=p==="std::string";Le(d,{name:p,fromWireType:function(I){var F=Pe[I>>2],J=I+4,W;if(T)for(var k=J,G=0;G<=F;++G){var K=J+G;if(G==F||Fe[K]==0){var ae=K-k,se=he(k,ae);W===void 0?W=se:(W+="\0",W+=se),k=K+1}}else{for(var l=new Array(F),G=0;G<F;++G)l[G]=String.fromCharCode(Fe[J+G]);W=l.join("")}return Wt(I),W},toWireType:function(I,F){F instanceof ArrayBuffer&&(F=new Uint8Array(F));var J,W=typeof F=="string";W||F instanceof Uint8Array||F instanceof Uint8ClampedArray||F instanceof Int8Array||be("Cannot pass non-string to std::string"),T&&W?J=qe(F):J=F.length;var k=Vr(4+J+1),G=k+4;if(Pe[k>>2]=J,T&&W)Ne(F,G,J+1);else if(W)for(var K=0;K<J;++K){var ae=F.charCodeAt(K);ae>255&&(Wt(G),be("String has UTF-16 code units that do not fit in 8 bits")),Fe[G+K]=ae}else for(var K=0;K<J;++K)Fe[G+K]=F[K];return I!==null&&I.push(Wt,k),k},argPackAdvance:8,readValueFromPointer:st,destructorFunction:function(I){Wt(I)}})}var rn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ar(d,p){for(var T=d,I=T>>1,F=I+p/2;!(I>=F)&&He[I];)++I;if(T=I<<1,T-d>32&&rn)return rn.decode(Fe.subarray(d,T));for(var J="",W=0;!(W>=p/2);++W){var k=Se[d+W*2>>1];if(k==0)break;J+=String.fromCharCode(k)}return J}function nn(d,p,T){if(T===void 0&&(T=2147483647),T<2)return 0;T-=2;for(var I=p,F=T<d.length*2?T/2:d.length,J=0;J<F;++J){var W=d.charCodeAt(J);Se[p>>1]=W,p+=2}return Se[p>>1]=0,p-I}function kr(d){return d.length*2}function En(d,p){for(var T=0,I="";!(T>=p/4);){var F=Ee[d+T*4>>2];if(F==0)break;if(++T,F>=65536){var J=F-65536;I+=String.fromCharCode(55296|J>>10,56320|J&1023)}else I+=String.fromCharCode(F)}return I}function xn(d,p,T){if(T===void 0&&(T=2147483647),T<4)return 0;for(var I=p,F=I+T-4,J=0;J<d.length;++J){var W=d.charCodeAt(J);if(W>=55296&&W<=57343){var k=d.charCodeAt(++J);W=65536+((W&1023)<<10)|k&1023}if(Ee[p>>2]=W,p+=4,p+4>F)break}return Ee[p>>2]=0,p-I}function An(d){for(var p=0,T=0;T<d.length;++T){var I=d.charCodeAt(T);I>=55296&&I<=57343&&++T,p+=4}return p}function Mr(d,p,T){T=Ye(T);var I,F,J,W,k;p===2?(I=Ar,F=nn,W=kr,J=()=>He,k=1):p===4&&(I=En,F=xn,W=An,J=()=>Pe,k=2),Le(d,{name:T,fromWireType:function(G){for(var K=Pe[G>>2],ae=J(),se,l=G+4,c=0;c<=K;++c){var m=G+4+c*p;if(c==K||ae[m>>k]==0){var A=m-l,L=I(l,A);se===void 0?se=L:(se+="\0",se+=L),l=m+p}}return Wt(G),se},toWireType:function(G,K){typeof K!="string"&&be("Cannot pass non-string to C++ string type "+T);var ae=W(K),se=Vr(4+ae+p);return Pe[se>>2]=ae>>k,F(K,se+4,ae+p),G!==null&&G.push(Wt,se),se},argPackAdvance:8,readValueFromPointer:st,destructorFunction:function(G){Wt(G)}})}function Cn(d,p,T,I,F,J){Ve[d]={name:Ye(p),rawConstructor:ze(T,I),rawDestructor:ze(F,J),fields:[]}}function Sn(d,p,T,I,F,J,W,k,G,K){Ve[d].fields.push({fieldName:Ye(p),getterReturnType:T,getter:ze(I,F),getterContext:J,setterArgumentType:W,setter:ze(k,G),setterContext:K})}function Rn(d,p){p=Ye(p),Le(d,{isVoid:!0,name:p,argPackAdvance:0,fromWireType:function(){},toWireType:function(T,I){}})}var jr={};function Dn(d){var p=jr[d];return p===void 0?Ye(d):p}function an(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function on(d){return d===0?Et.toHandle(an()):(d=Dn(d),Et.toHandle(an()[d]))}function In(d){d>4&&(Ge[d].refcount+=1)}function Wr(d,p){var T=Me[d];return T===void 0&&be(p+" has unknown type "+Pr(d)),T}function $n(d){for(var p="",T=0;T<d;++T)p+=(T!==0?", ":"")+"arg"+T;for(var I=()=>Pe,F="return function emval_allocator_"+d+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,T=0;T<d;++T)F+="var argType"+T+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+T+`');
var arg`+T+" = argType"+T+`.readValueFromPointer(args);
args += argType`+T+`['argPackAdvance'];
argTypes += 4;
`;return F+="var obj = new constructor("+p+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",F)(Wr,r,Et.toHandle,I)}var sn={};function un(d,p,T,I){d=Et.toValue(d);var F=sn[p];return F||(F=$n(p),sn[p]=F),F(d,T,I)}function ln(d,p){d=Wr(d,"_emval_take_value");var T=d.readValueFromPointer(p);return Et.toHandle(T)}function cn(){ot("")}function On(d,p,T){Fe.copyWithin(d,p,p+T)}function Ln(){return 2147483648}function Un(d){try{return me.grow(d-ue.byteLength+65535>>>16),Re(me.buffer),1}catch{}}function Nr(d){var p=Fe.length;d=d>>>0;var T=Ln();if(d>T)return!1;let I=(G,K)=>G+(K-G%K)%K;for(var F=1;F<=4;F*=2){var J=p*(1+.2/F);J=Math.min(J,d+100663296);var W=Math.min(T,I(Math.max(d,J),65536)),k=Un(W);if(k)return!0}return!1}function Fn(d){var p=r["_"+d];return p}function pr(d,p){De.set(d,p)}function kn(d,p,T,I,F){var J={string:m=>{var A=0;if(m!=null&&m!==0){var L=(m.length<<2)+1;A=Br(L),Ne(m,A,L)}return A},array:m=>{var A=Br(m.length);return pr(m,A),A}};function W(m){return p==="string"?he(m):p==="boolean"?!!m:m}var k=Fn(d),G=[],K=0;if(I)for(var ae=0;ae<I.length;ae++){var se=J[T[ae]];se?(K===0&&(K=fn()),G[ae]=se(I[ae])):G[ae]=I[ae]}var l=k.apply(null,G);function c(m){return K!==0&&dn(K),W(m)}return l=c(l),l}gr=r.InternalError=Dr(Error,"InternalError"),et(),er=r.BindingError=Dr(Error,"BindingError"),dr(),fr(),Xr(),Mt=r.UnboundTypeError=Dr(Error,"UnboundTypeError"),Fr();var Hr={h:$e,q:Vt,r:ye,w:kt,p:Zr,o:Tr,c:bn,v:en,k:Pn,e:ir,b:tn,a:wn,j:Tn,g:Mr,u:Cn,d:Sn,x:Rn,i:Ur,m:on,l:In,y:un,n:ln,f:cn,t:On,s:Nr};D(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.A).apply(null,arguments)};var Vr=r._malloc=function(){return(Vr=r._malloc=r.asm.B).apply(null,arguments)},ar=r.___getTypeName=function(){return(ar=r.___getTypeName=r.asm.D).apply(null,arguments)};r.__embind_initialize_bindings=function(){return(r.__embind_initialize_bindings=r.asm.E).apply(null,arguments)};var Wt=r._free=function(){return(Wt=r._free=r.asm.F).apply(null,arguments)},fn=r.stackSave=function(){return(fn=r.stackSave=r.asm.G).apply(null,arguments)},dn=r.stackRestore=function(){return(dn=r.stackRestore=r.asm.H).apply(null,arguments)},Br=r.stackAlloc=function(){return(Br=r.stackAlloc=r.asm.I).apply(null,arguments)},pn=r.___cxa_is_pointer_type=function(){return(pn=r.___cxa_is_pointer_type=r.asm.J).apply(null,arguments)};r.ccall=kn;var Cr;Ke=function d(){Cr||Gr(),Cr||(Ke=d)};function Gr(d){if(ht>0||(Ot(),ht>0))return;function p(){Cr||(Cr=!0,r.calledRun=!0,!we&&(yt(),g(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),mt()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),p()},1)):p()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Gr(),h.ready})})();e.exports=a})(bi)),bi.exports}var fu=cu();const du=ui(fu),pu=new URL("/radiology-ai-viewer/assets/charlswasm_decode-484ovEoR.wasm",import.meta.url),Nn={codec:void 0,decoder:void 0,decodeConfig:{}};function hu(e){return typeof e=="number"?Nn.codec.getExceptionMessage(e):e}function no(e){if(Nn.decodeConfig=e,Nn.codec)return Promise.resolve();const i=du({locateFile:a=>a.endsWith(".wasm")?pu.toString():a});return new Promise((a,o)=>{i.then(h=>{Nn.codec=h,Nn.decoder=new h.JpegLSDecoder,a()},o)})}async function Si(e,i){try{await no();const a=Nn.decoder;a.getEncodedBuffer(e.length).set(e),a.decode();const h=a.getFrameInfo(),r=a.getInterleaveMode(),g=a.getNearLossless(),w=a.getDecodedBuffer(),C={columns:h.width,rows:h.height,bitsPerPixel:h.bitsPerSample,signed:i.signed,bytesPerPixel:i.bytesPerPixel,componentsPerPixel:h.componentCount},U=gu(h,w,i.signed),O={nearLossless:g,interleaveMode:r,frameInfo:h};return{...i,pixelData:U,imageInfo:C,encodeOptions:O,...O,...C}}catch(a){throw hu(a)}}function gu(e,i,a){return e.bitsPerSample>8?a?new Int16Array(i.buffer,i.byteOffset,i.byteLength/2):new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2):a?new Int8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}var Pi={exports:{}},oa;function vu(){return oa||(oa=1,(function(e,i){var a=(()=>{var o=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(o=o||__filename),(function(h={}){var r,g=h,w,C,U=new Promise((l,c)=>{w=l,C=c}),O=typeof window=="object",j=typeof WorkerGlobalScope<"u",H=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",N=Object.assign({},g),Y="./this.program",Z="";function re(l){return g.locateFile?g.locateFile(l,Z):Z+l}var oe,ie;if(H){var ce=hn;Z=__dirname+"/",ie=l=>{l=ht(l)?new URL(l):l;var c=ce.readFileSync(l);return c},oe=async(l,c=!0)=>{l=ht(l)?new URL(l):l;var m=ce.readFileSync(l,c?void 0:"utf8");return m},!g.thisProgram&&process.argv.length>1&&(Y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else(O||j)&&(j?Z=self.location.href:typeof document<"u"&&document.currentScript&&(Z=document.currentScript.src),o&&(Z=o),Z.startsWith("blob:")?Z="":Z=Z.substr(0,Z.replace(/[?#].*/,"").lastIndexOf("/")+1),j&&(ie=l=>{var c=new XMLHttpRequest;return c.open("GET",l,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),oe=async l=>{if(ht(l))return new Promise((m,A)=>{var L=new XMLHttpRequest;L.open("GET",l,!0),L.responseType="arraybuffer",L.onload=()=>{if(L.status==200||L.status==0&&L.response){m(L.response);return}A(L.status)},L.onerror=A,L.send(null)});var c=await fetch(l,{credentials:"same-origin"});if(c.ok)return c.arrayBuffer();throw new Error(c.status+" : "+c.url)});var pe=g.print||console.log.bind(console),me=g.printErr||console.error.bind(console);Object.assign(g,N),N=null,g.arguments&&g.arguments,g.thisProgram&&(Y=g.thisProgram);var we=g.wasmBinary,je,fe=!1,_e,he,Te,Ne,qe,ue,De,Fe;function Se(){var l=je.buffer;g.HEAP8=_e=new Int8Array(l),g.HEAP16=Te=new Int16Array(l),g.HEAPU8=he=new Uint8Array(l),g.HEAPU16=Ne=new Uint16Array(l),g.HEAP32=qe=new Int32Array(l),g.HEAPU32=ue=new Uint32Array(l),g.HEAPF32=De=new Float32Array(l),g.HEAPF64=Fe=new Float64Array(l)}var He=[],Ee=[],Pe=[];function Ie(){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)At(g.preRun.shift());S(He)}function Je(){S(Ee)}function Re(){if(g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;)Ht(g.postRun.shift());S(Pe)}function At(l){He.unshift(l)}function Jt(l){Ee.unshift(l)}function Ht(l){Pe.unshift(l)}var Qe=0,Ot=null;function yt(l){Qe++,g.monitorRunDependencies?.(Qe)}function mt(l){if(Qe--,g.monitorRunDependencies?.(Qe),Qe==0&&Ot){var c=Ot;Ot=null,c()}}function Zt(l){g.onAbort?.(l),l="Aborted("+l+")",me(l),fe=!0,l+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(l);throw C(c),c}var Sr="data:application/octet-stream;base64,",sr=l=>l.startsWith(Sr),ht=l=>l.startsWith("file://");function Ke(){var l="openjpegwasm_decode.wasm";return sr(l)?l:re(l)}var Lt;function Ut(l){if(l==Lt&&we)return new Uint8Array(we);if(ie)return ie(l);throw"both async and sync fetching of the wasm failed"}async function ot(l){if(!we)try{var c=await oe(l);return new Uint8Array(c)}catch{}return Ut(l)}async function Ft(l,c){try{var m=await ot(l),A=await WebAssembly.instantiate(m,c);return A}catch(L){me(`failed to asynchronously prepare wasm: ${L}`),Zt(L)}}async function ur(l,c,m){if(!l&&typeof WebAssembly.instantiateStreaming=="function"&&!sr(c)&&!ht(c)&&!H&&typeof fetch=="function")try{var A=fetch(c,{credentials:"same-origin"}),L=await WebAssembly.instantiateStreaming(A,m);return L}catch(V){me(`wasm streaming compile failed: ${V}`),me("falling back to ArrayBuffer instantiation")}return Ft(c,m)}function y(){return{a:T}}async function _(){function l(L,V){return I=L.exports,je=I.F,Se(),$r=I.I,Jt(I.G),mt(),I}yt();function c(L){l(L.instance)}var m=y();if(g.instantiateWasm)try{return g.instantiateWasm(m,l)}catch(L){me(`Module.instantiateWasm callback failed with error: ${L}`),C(L)}Lt??=Ke();try{var A=await ur(we,Lt,m);return c(A),A}catch(L){C(L);return}}var S=l=>{for(;l.length>0;)l.shift()(g)};g.noExitRuntime;var b=l=>k(l),D=()=>K();class q{constructor(c){this.excPtr=c,this.ptr=c-24}set_type(c){ue[this.ptr+4>>2]=c}get_type(){return ue[this.ptr+4>>2]}set_destructor(c){ue[this.ptr+8>>2]=c}get_destructor(){return ue[this.ptr+8>>2]}set_caught(c){c=c?1:0,_e[this.ptr+12]=c}get_caught(){return _e[this.ptr+12]!=0}set_rethrown(c){c=c?1:0,_e[this.ptr+13]=c}get_rethrown(){return _e[this.ptr+13]!=0}init(c,m){this.set_adjusted_ptr(0),this.set_type(c),this.set_destructor(m)}set_adjusted_ptr(c){ue[this.ptr+16>>2]=c}get_adjusted_ptr(){return ue[this.ptr+16>>2]}}var te=0,ve=(l,c,m)=>{var A=new q(l);throw A.init(c,m),te=l,te},$e=()=>Zt(""),Ve={},ke=l=>{for(;l.length;){var c=l.pop(),m=l.pop();m(c)}};function st(l){return this.fromWireType(ue[l>>2])}var Ce={},Me={},Be={},zt,Ct=l=>{throw new zt(l)},rt=(l,c,m)=>{l.forEach(M=>Be[M]=c);function A(M){var X=m(M);X.length!==l.length&&Ct("Mismatched type converter count");for(var s=0;s<l.length;++s)et(l[s],X[s])}var L=new Array(c.length),V=[],z=0;c.forEach((M,X)=>{Me.hasOwnProperty(M)?L[X]=Me[M]:(V.push(M),Ce.hasOwnProperty(M)||(Ce[M]=[]),Ce[M].push(()=>{L[X]=Me[M],++z,z===V.length&&A(L)}))}),V.length===0&&A(L)},Rr=l=>{var c=Ve[l];delete Ve[l];var m=c.rawConstructor,A=c.rawDestructor,L=c.fields,V=L.map(z=>z.getterReturnType).concat(L.map(z=>z.setterArgumentType));rt([l],V,z=>{var M={};return L.forEach((X,s)=>{var u=X.fieldName,t=z[s],n=X.getter,f=X.getterContext,v=z[s+L.length],P=X.setter,E=X.setterContext;M[u]={read:x=>t.fromWireType(n(f,x)),write:(x,R)=>{var $=[];P(E,x,v.toWireType($,R)),ke($)}}}),[{name:c.name,fromWireType:X=>{var s={};for(var u in M)s[u]=M[u].read(X);return A(X),s},toWireType:(X,s)=>{for(var u in M)if(!(u in s))throw new TypeError(`Missing field: "${u}"`);var t=m();for(u in M)M[u].write(t,s[u]);return X!==null&&X.push(A,t),t},argPackAdvance:lt,readValueFromPointer:st,destructorFunction:A}]})},Dr=(l,c,m,A,L)=>{},gr=()=>{for(var l=new Array(256),c=0;c<256;++c)l[c]=String.fromCharCode(c);Yt=l},Yt,We=l=>{for(var c="",m=l;he[m];)c+=Yt[he[m++]];return c},Vt,ye=l=>{throw new Vt(l)};function ut(l,c,m={}){var A=c.name;if(l||ye(`type "${A}" must have a positive integer typeid pointer`),Me.hasOwnProperty(l)){if(m.ignoreDuplicateRegistrations)return;ye(`Cannot register type '${A}' twice`)}if(Me[l]=c,delete Be[l],Ce.hasOwnProperty(l)){var L=Ce[l];delete Ce[l],L.forEach(V=>V())}}function et(l,c,m={}){return ut(l,c,m)}var lt=8,Ye=(l,c,m,A)=>{c=We(c),et(l,{name:c,fromWireType:function(L){return!!L},toWireType:function(L,V){return V?m:A},argPackAdvance:lt,readValueFromPointer:function(L){return this.fromWireType(he[L])},destructorFunction:null})},er=l=>({count:l.count,deleteScheduled:l.deleteScheduled,preservePointerOnDelete:l.preservePointerOnDelete,ptr:l.ptr,ptrType:l.ptrType,smartPtr:l.smartPtr,smartPtrType:l.smartPtrType}),be=l=>{function c(m){return m.$$.ptrType.registeredClass.name}ye(c(l)+" instance already deleted")},Le=!1,kt=l=>{},xe=l=>{l.smartPtr?l.smartPtrType.rawDestructor(l.smartPtr):l.ptrType.registeredClass.rawDestructor(l.ptr)},ct=l=>{l.count.value-=1;var c=l.count.value===0;c&&xe(l)},St=(l,c,m)=>{if(c===m)return l;if(m.baseClass===void 0)return null;var A=St(l,c,m.baseClass);return A===null?null:m.downcast(A)},vr={},qr={},lr=(l,c)=>{for(c===void 0&&ye("ptr should not be undefined");l.baseClass;)c=l.upcast(c),l=l.baseClass;return c},yr=(l,c)=>(c=lr(l,c),qr[c]),Xt=(l,c)=>{(!c.ptrType||!c.ptr)&&Ct("makeClassHandle requires ptr and ptrType");var m=!!c.smartPtrType,A=!!c.smartPtr;return m!==A&&Ct("Both smartPtrType and smartPtr must be specified"),c.count={value:1},_t(Object.create(l,{$$:{value:c,writable:!0}}))};function Ze(l){var c=this.getPointee(l);if(!c)return this.destructor(l),null;var m=yr(this.registeredClass,c);if(m!==void 0){if(m.$$.count.value===0)return m.$$.ptr=c,m.$$.smartPtr=l,m.clone();var A=m.clone();return this.destructor(l),A}function L(){return this.isSmartPointer?Xt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:c,smartPtrType:this,smartPtr:l}):Xt(this.registeredClass.instancePrototype,{ptrType:this,ptr:l})}var V=this.registeredClass.getActualType(c),z=vr[V];if(!z)return L.call(this);var M;this.isConst?M=z.constPointerType:M=z.pointerType;var X=St(c,this.registeredClass,M.registeredClass);return X===null?L.call(this):this.isSmartPointer?Xt(M.registeredClass.instancePrototype,{ptrType:M,ptr:X,smartPtrType:this,smartPtr:l}):Xt(M.registeredClass.instancePrototype,{ptrType:M,ptr:X})}var _t=l=>typeof FinalizationRegistry>"u"?(_t=c=>c,l):(Le=new FinalizationRegistry(c=>{ct(c.$$)}),_t=c=>{var m=c.$$,A=!!m.smartPtr;if(A){var L={$$:m};Le.register(c,L,c)}return c},kt=c=>Le.unregister(c),_t(l)),Ae=()=>{Object.assign(Xe.prototype,{isAliasOf(l){if(!(this instanceof Xe)||!(l instanceof Xe))return!1;var c=this.$$.ptrType.registeredClass,m=this.$$.ptr;l.$$=l.$$;for(var A=l.$$.ptrType.registeredClass,L=l.$$.ptr;c.baseClass;)m=c.upcast(m),c=c.baseClass;for(;A.baseClass;)L=A.upcast(L),A=A.baseClass;return c===A&&m===L},clone(){if(this.$$.ptr||be(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var l=_t(Object.create(Object.getPrototypeOf(this),{$$:{value:er(this.$$)}}));return l.$$.count.value+=1,l.$$.deleteScheduled=!1,l},delete(){this.$$.ptr||be(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),kt(this),ct(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||be(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}})};function Xe(){}var Qt=(l,c)=>Object.defineProperty(c,"name",{value:l}),tr=(l,c,m)=>{if(l[c].overloadTable===void 0){var A=l[c];l[c]=function(...L){return l[c].overloadTable.hasOwnProperty(L.length)||ye(`Function '${m}' called with an invalid number of arguments (${L.length}) - expects one of (${l[c].overloadTable})!`),l[c].overloadTable[L.length].apply(this,L)},l[c].overloadTable=[],l[c].overloadTable[A.argCount]=A}},cr=(l,c,m)=>{g.hasOwnProperty(l)?(ye(`Cannot register public name '${l}' twice`),tr(g,l,l),g[l].overloadTable.hasOwnProperty(m)&&ye(`Cannot register multiple overloads of a function with the same number of arguments (${m})!`),g[l].overloadTable[m]=c):(g[l]=c,g[l].argCount=m)},fr=48,bt=57,Jr=l=>{l=l.replace(/[^a-zA-Z0-9_]/g,"$");var c=l.charCodeAt(0);return c>=fr&&c<=bt?`_${l}`:l};function vn(l,c,m,A,L,V,z,M){this.name=l,this.constructor=c,this.instancePrototype=m,this.rawDestructor=A,this.baseClass=L,this.getActualType=V,this.upcast=z,this.downcast=M,this.pureVirtualFunctions=[]}var Pt=(l,c,m)=>{for(;c!==m;)c.upcast||ye(`Expected null or instance of ${m.name}, got an instance of ${c.name}`),l=c.upcast(l),c=c.baseClass;return l};function zr(l,c){if(c===null)return this.isReference&&ye(`null is not a valid ${this.name}`),0;c.$$||ye(`Cannot pass "${Tr(c)}" as a ${this.name}`),c.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`);var m=c.$$.ptrType.registeredClass,A=Pt(c.$$.ptr,m,this.registeredClass);return A}function rr(l,c){var m;if(c===null)return this.isReference&&ye(`null is not a valid ${this.name}`),this.isSmartPointer?(m=this.rawConstructor(),l!==null&&l.push(this.rawDestructor,m),m):0;(!c||!c.$$)&&ye(`Cannot pass "${Tr(c)}" as a ${this.name}`),c.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&c.$$.ptrType.isConst&&ye(`Cannot convert argument of type ${c.$$.smartPtrType?c.$$.smartPtrType.name:c.$$.ptrType.name} to parameter type ${this.name}`);var A=c.$$.ptrType.registeredClass;if(m=Pt(c.$$.ptr,A,this.registeredClass),this.isSmartPointer)switch(c.$$.smartPtr===void 0&&ye("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:c.$$.smartPtrType===this?m=c.$$.smartPtr:ye(`Cannot convert argument of type ${c.$$.smartPtrType?c.$$.smartPtrType.name:c.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:m=c.$$.smartPtr;break;case 2:if(c.$$.smartPtrType===this)m=c.$$.smartPtr;else{var L=c.clone();m=this.rawShare(m,vt.toHandle(()=>L.delete())),l!==null&&l.push(this.rawDestructor,m)}break;default:ye("Unsupporting sharing policy")}return m}function mr(l,c){if(c===null)return this.isReference&&ye(`null is not a valid ${this.name}`),0;c.$$||ye(`Cannot pass "${Tr(c)}" as a ${this.name}`),c.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`),c.$$.ptrType.isConst&&ye(`Cannot convert argument of type ${c.$$.ptrType.name} to parameter type ${this.name}`);var m=c.$$.ptrType.registeredClass,A=Pt(c.$$.ptr,m,this.registeredClass);return A}var yn=()=>{Object.assign(gt.prototype,{getPointee(l){return this.rawGetPointee&&(l=this.rawGetPointee(l)),l},destructor(l){this.rawDestructor?.(l)},argPackAdvance:lt,readValueFromPointer:st,fromWireType:Ze})};function gt(l,c,m,A,L,V,z,M,X,s,u){this.name=l,this.registeredClass=c,this.isReference=m,this.isConst=A,this.isSmartPointer=L,this.pointeeType=V,this.sharingPolicy=z,this.rawGetPointee=M,this.rawConstructor=X,this.rawShare=s,this.rawDestructor=u,!L&&c.baseClass===void 0?A?(this.toWireType=zr,this.destructorFunction=null):(this.toWireType=mr,this.destructorFunction=null):this.toWireType=rr}var Ir=(l,c,m)=>{g.hasOwnProperty(l)||Ct("Replacing nonexistent public symbol"),g[l].overloadTable!==void 0&&m!==void 0||(g[l]=c,g[l].argCount=m)},dr=(l,c,m)=>{l=l.replace(/p/g,"i");var A=g["dynCall_"+l];return A(c,...m)},wt=[],$r,Kt=l=>{var c=wt[l];return c||(l>=wt.length&&(wt.length=l+1),wt[l]=c=$r.get(l)),c},Bt=(l,c,m=[])=>{if(l.includes("j"))return dr(l,c,m);var A=Kt(c)(...m);return A},_r=(l,c)=>(...m)=>Bt(l,c,m),ft=(l,c)=>{l=We(l);function m(){return l.includes("j")?_r(l,c):Kt(c)}var A=m();return typeof A!="function"&&ye(`unknown function pointer with signature ${l}: ${c}`),A},mn=(l,c)=>{var m=Qt(c,function(A){this.name=c,this.message=A;var L=new Error(A).stack;L!==void 0&&(this.stack=this.toString()+`
`+L.replace(/^Error(:[^\n]*)?\n/,""))});return m.prototype=Object.create(l.prototype),m.prototype.constructor=m,m.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},m},Gt,Yr=l=>{var c=F(l),m=We(c);return W(c),m},Or=(l,c)=>{var m=[],A={};function L(V){if(!A[V]&&!Me[V]){if(Be[V]){Be[V].forEach(L);return}m.push(V),A[V]=!0}}throw c.forEach(L),new Gt(`${l}: `+m.map(Yr).join([", "]))},_n=(l,c,m,A,L,V,z,M,X,s,u,t,n)=>{u=We(u),V=ft(L,V),M&&=ft(z,M),s&&=ft(X,s),n=ft(t,n);var f=Jr(u);cr(f,function(){Or(`Cannot construct ${u} due to unbound types`,[A])}),rt([l,c,m],A?[A]:[],v=>{v=v[0];var P,E;A?(P=v.registeredClass,E=P.instancePrototype):E=Xe.prototype;var x=Qt(u,function(...ee){if(Object.getPrototypeOf(this)!==R)throw new Vt("Use 'new' to construct "+u);if($.constructor_body===void 0)throw new Vt(u+" has no accessible constructor");var ge=$.constructor_body[ee.length];if(ge===void 0)throw new Vt(`Tried to invoke ctor of ${u} with invalid number of parameters (${ee.length}) - expected (${Object.keys($.constructor_body).toString()}) parameters instead!`);return ge.apply(this,ee)}),R=Object.create(E,{constructor:{value:x}});x.prototype=R;var $=new vn(u,x,R,n,P,V,M,s);$.baseClass&&($.baseClass.__derivedClasses??=[],$.baseClass.__derivedClasses.push($));var B=new gt(u,$,!0,!1,!1),Q=new gt(u+"*",$,!1,!1,!1),ne=new gt(u+" const*",$,!1,!0,!1);return vr[l]={pointerType:Q,constPointerType:ne},Ir(f,x),[B,Q,ne]})},Xr=(l,c)=>{for(var m=[],A=0;A<l;A++)m.push(ue[c+A*4>>2]);return m};function Rt(l){for(var c=1;c<l.length;++c)if(l[c]!==null&&l[c].destructorFunction===void 0)return!0;return!1}function Dt(l,c){if(!(l instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof l} which is not a function`);var m=Qt(l.name||"unknownFunctionName",function(){});m.prototype=l.prototype;var A=new m,L=l.apply(A,c);return L instanceof Object?L:A}function Qr(l,c,m,A){var L=Rt(l),V=l.length-2,z=[],M=["fn"];c&&M.push("thisWired");for(var X=0;X<V;++X)z.push(`arg${X}`),M.push(`arg${X}Wired`);z=z.join(","),M=M.join(",");var s=`return function (${z}) {
`;L&&(s+=`var destructors = [];
`);var u=L?"destructors":"null",t=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];c&&(s+=`var thisWired = classParam['toWireType'](${u}, this);
`);for(var X=0;X<V;++X)s+=`var arg${X}Wired = argType${X}['toWireType'](${u}, arg${X});
`,t.push(`argType${X}`);if(s+=(m||A?"var rv = ":"")+`invoker(${M});
`,L)s+=`runDestructors(destructors);
`;else for(var X=c?1:2;X<l.length;++X){var n=X===1?"thisWired":"arg"+(X-2)+"Wired";l[X].destructorFunction!==null&&(s+=`${n}_dtor(${n});
`,t.push(`${n}_dtor`))}return m&&(s+=`var ret = retType['fromWireType'](rv);
return ret;
`),s+=`}
`,[t,s]}function nt(l,c,m,A,L,V){var z=c.length;z<2&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var M=c[1]!==null&&m!==null,X=Rt(c),s=c[0].name!=="void",u=[l,ye,A,L,ke,c[0],c[1]],t=0;t<z-2;++t)u.push(c[t+2]);if(!X)for(var t=M?1:2;t<c.length;++t)c[t].destructorFunction!==null&&u.push(c[t].destructorFunction);let[n,f]=Qr(c,M,s,V);n.push(f);var v=Dt(Function,n)(...u);return Qt(l,v)}var Kr=(l,c,m,A,L,V)=>{var z=Xr(c,m);L=ft(A,L),rt([],[l],M=>{M=M[0];var X=`constructor ${M.name}`;if(M.registeredClass.constructor_body===void 0&&(M.registeredClass.constructor_body=[]),M.registeredClass.constructor_body[c-1]!==void 0)throw new Vt(`Cannot register multiple constructors with identical number of parameters (${c-1}) for class '${M.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return M.registeredClass.constructor_body[c-1]=()=>{Or(`Cannot construct ${M.name} due to unbound types`,z)},rt([],z,s=>(s.splice(1,0,null),M.registeredClass.constructor_body[c-1]=nt(X,s,null,L,V),[])),[]})},Lr=l=>{l=l.trim();const c=l.indexOf("(");return c!==-1?l.substr(0,c):l},br=(l,c,m,A,L,V,z,M,X,s)=>{var u=Xr(m,A);c=We(c),c=Lr(c),V=ft(L,V),rt([],[l],t=>{t=t[0];var n=`${t.name}.${c}`;c.startsWith("@@")&&(c=Symbol[c.substring(2)]),M&&t.registeredClass.pureVirtualFunctions.push(c);function f(){Or(`Cannot call ${n} due to unbound types`,u)}var v=t.registeredClass.instancePrototype,P=v[c];return P===void 0||P.overloadTable===void 0&&P.className!==t.name&&P.argCount===m-2?(f.argCount=m-2,f.className=t.name,v[c]=f):(tr(v,c,n),v[c].overloadTable[m-2]=f),rt([],u,E=>{var x=nt(n,E,t,V,z,X);return v[c].overloadTable===void 0?(x.argCount=m-2,v[c]=x):v[c].overloadTable[m-2]=x,[]}),[]})},ze=[],Mt=[],Pr=l=>{l>9&&--Mt[l+1]===0&&(Mt[l]=void 0,ze.push(l))},dt=()=>Mt.length/2-5-ze.length,Zr=()=>{Mt.push(0,1,void 0,1,null,1,!0,1,!1,1),g.count_emval_handles=dt},vt={toValue:l=>(l||ye("Cannot use deleted val. handle = "+l),Mt[l]),toHandle:l=>{switch(l){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const c=ze.pop()||Mt.length;return Mt[c]=l,Mt[c+1]=1,c}}}},Tt={name:"emscripten::val",fromWireType:l=>{var c=vt.toValue(l);return Pr(l),c},toWireType:(l,c)=>vt.toHandle(c),argPackAdvance:lt,readValueFromPointer:st,destructorFunction:null},wr=l=>et(l,Tt),Tr=l=>{if(l===null)return"null";var c=typeof l;return c==="object"||c==="array"||c==="function"?l.toString():""+l},bn=(l,c)=>{switch(c){case 4:return function(m){return this.fromWireType(De[m>>2])};case 8:return function(m){return this.fromWireType(Fe[m>>3])};default:throw new TypeError(`invalid float width (${c}): ${l}`)}},Er=(l,c,m)=>{c=We(c),et(l,{name:c,fromWireType:A=>A,toWireType:(A,L)=>L,argPackAdvance:lt,readValueFromPointer:bn(c,m),destructorFunction:null})},Ge=(l,c,m)=>{switch(c){case 1:return m?A=>_e[A]:A=>he[A];case 2:return m?A=>Te[A>>1]:A=>Ne[A>>1];case 4:return m?A=>qe[A>>2]:A=>ue[A>>2];default:throw new TypeError(`invalid integer width (${c}): ${l}`)}},Ur=(l,c,m,A,L)=>{c=We(c);var V=u=>u;if(A===0){var z=32-8*m;V=u=>u<<z>>>z}var M=c.includes("unsigned"),X=(u,t)=>{},s;M?s=function(u,t){return X(t,this.name),t>>>0}:s=function(u,t){return X(t,this.name),t},et(l,{name:c,fromWireType:V,toWireType:s,argPackAdvance:lt,readValueFromPointer:Ge(c,m,A!==0),destructorFunction:null})},xr=(l,c,m)=>{var A=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],L=A[c];function V(z){var M=ue[z>>2],X=ue[z+4>>2];return new L(_e.buffer,X,M)}m=We(m),et(l,{name:m,fromWireType:V,argPackAdvance:lt,readValueFromPointer:V},{ignoreDuplicateRegistrations:!0})},it=(l,c,m,A)=>{if(!(A>0))return 0;for(var L=m,V=m+A-1,z=0;z<l.length;++z){var M=l.charCodeAt(z);if(M>=55296&&M<=57343){var X=l.charCodeAt(++z);M=65536+((M&1023)<<10)|X&1023}if(M<=127){if(m>=V)break;c[m++]=M}else if(M<=2047){if(m+1>=V)break;c[m++]=192|M>>6,c[m++]=128|M&63}else if(M<=65535){if(m+2>=V)break;c[m++]=224|M>>12,c[m++]=128|M>>6&63,c[m++]=128|M&63}else{if(m+3>=V)break;c[m++]=240|M>>18,c[m++]=128|M>>12&63,c[m++]=128|M>>6&63,c[m++]=128|M&63}}return c[m]=0,m-L},Fr=(l,c,m)=>it(l,he,c,m),Et=l=>{for(var c=0,m=0;m<l.length;++m){var A=l.charCodeAt(m);A<=127?c++:A<=2047?c+=2:A>=55296&&A<=57343?(c+=4,++m):c+=3}return c},en=typeof TextDecoder<"u"?new TextDecoder:void 0,nr=(l,c=0,m=NaN)=>{for(var A=c+m,L=c;l[L]&&!(L>=A);)++L;if(L-c>16&&l.buffer&&en)return en.decode(l.subarray(c,L));for(var V="";c<L;){var z=l[c++];if(!(z&128)){V+=String.fromCharCode(z);continue}var M=l[c++]&63;if((z&224)==192){V+=String.fromCharCode((z&31)<<6|M);continue}var X=l[c++]&63;if((z&240)==224?z=(z&15)<<12|M<<6|X:z=(z&7)<<18|M<<12|X<<6|l[c++]&63,z<65536)V+=String.fromCharCode(z);else{var s=z-65536;V+=String.fromCharCode(55296|s>>10,56320|s&1023)}}return V},jt=(l,c)=>l?nr(he,l,c):"",Pn=(l,c)=>{c=We(c),et(l,{name:c,fromWireType(m){for(var A=ue[m>>2],L=m+4,V,z,M=L,z=0;z<=A;++z){var X=L+z;if(z==A||he[X]==0){var s=X-M,u=jt(M,s);V===void 0?V=u:(V+="\0",V+=u),M=X+1}}return W(m),V},toWireType(m,A){A instanceof ArrayBuffer&&(A=new Uint8Array(A));var L,V=typeof A=="string";V||A instanceof Uint8Array||A instanceof Uint8ClampedArray||A instanceof Int8Array||ye("Cannot pass non-string to std::string"),V?L=Et(A):L=A.length;var z=J(4+L+1),M=z+4;if(ue[z>>2]=L,V)Fr(A,M,L+1);else if(V)for(var X=0;X<L;++X){var s=A.charCodeAt(X);s>255&&(W(M),ye("String has UTF-16 code units that do not fit in 8 bits")),he[M+X]=s}else for(var X=0;X<L;++X)he[M+X]=A[X];return m!==null&&m.push(W,z),z},argPackAdvance:lt,readValueFromPointer:st,destructorFunction(m){W(m)}})},ir=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,xt=(l,c)=>{for(var m=l,A=m>>1,L=A+c/2;!(A>=L)&&Ne[A];)++A;if(m=A<<1,m-l>32&&ir)return ir.decode(he.subarray(l,m));for(var V="",z=0;!(z>=c/2);++z){var M=Te[l+z*2>>1];if(M==0)break;V+=String.fromCharCode(M)}return V},tn=(l,c,m)=>{if(m??=2147483647,m<2)return 0;m-=2;for(var A=c,L=m<l.length*2?m/2:l.length,V=0;V<L;++V){var z=l.charCodeAt(V);Te[c>>1]=z,c+=2}return Te[c>>1]=0,c-A},wn=l=>l.length*2,Tn=(l,c)=>{for(var m=0,A="";!(m>=c/4);){var L=qe[l+m*4>>2];if(L==0)break;if(++m,L>=65536){var V=L-65536;A+=String.fromCharCode(55296|V>>10,56320|V&1023)}else A+=String.fromCharCode(L)}return A},rn=(l,c,m)=>{if(m??=2147483647,m<4)return 0;for(var A=c,L=A+m-4,V=0;V<l.length;++V){var z=l.charCodeAt(V);if(z>=55296&&z<=57343){var M=l.charCodeAt(++V);z=65536+((z&1023)<<10)|M&1023}if(qe[c>>2]=z,c+=4,c+4>L)break}return qe[c>>2]=0,c-A},Ar=l=>{for(var c=0,m=0;m<l.length;++m){var A=l.charCodeAt(m);A>=55296&&A<=57343&&++m,c+=4}return c},nn=(l,c,m)=>{m=We(m);var A,L,V,z;c===2?(A=xt,L=tn,z=wn,V=M=>Ne[M>>1]):c===4&&(A=Tn,L=rn,z=Ar,V=M=>ue[M>>2]),et(l,{name:m,fromWireType:M=>{for(var X=ue[M>>2],s,u=M+4,t=0;t<=X;++t){var n=M+4+t*c;if(t==X||V(n)==0){var f=n-u,v=A(u,f);s===void 0?s=v:(s+="\0",s+=v),u=n+c}}return W(M),s},toWireType:(M,X)=>{typeof X!="string"&&ye(`Cannot pass non-string to C++ string type ${m}`);var s=z(X),u=J(4+s+c);return ue[u>>2]=s/c,L(X,u+4,s+c),M!==null&&M.push(W,u),u},argPackAdvance:lt,readValueFromPointer:st,destructorFunction(M){W(M)}})},kr=(l,c,m,A,L,V)=>{Ve[l]={name:We(c),rawConstructor:ft(m,A),rawDestructor:ft(L,V),fields:[]}},En=(l,c,m,A,L,V,z,M,X,s)=>{Ve[l].fields.push({fieldName:We(c),getterReturnType:m,getter:ft(A,L),getterContext:V,setterArgumentType:z,setter:ft(M,X),setterContext:s})},xn=(l,c)=>{c=We(c),et(l,{isVoid:!0,name:c,argPackAdvance:0,fromWireType:()=>{},toWireType:(m,A)=>{}})},An=(l,c,m)=>he.copyWithin(l,c,c+m),Mr=[],Cn=(l,c,m,A)=>(l=Mr[l],c=vt.toValue(c),l(null,c,m,A)),Sn={},Rn=l=>{var c=Sn[l];return c===void 0?We(l):c},jr=()=>typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")(),Dn=l=>l===0?vt.toHandle(jr()):(l=Rn(l),vt.toHandle(jr()[l])),an=l=>{var c=Mr.length;return Mr.push(l),c},on=(l,c)=>{var m=Me[l];return m===void 0&&ye(`${c} has unknown type ${Yr(l)}`),m},In=(l,c)=>{for(var m=new Array(l),A=0;A<l;++A)m[A]=on(ue[c+A*4>>2],"parameter "+A);return m},Wr=(l,c,m)=>{var A=[],L=l.toWireType(A,m);return A.length&&(ue[c>>2]=vt.toHandle(A)),L},$n=(l,c,m)=>{var A=In(l,c),L=A.shift();l--;var V=`return function (obj, func, destructorsRef, args) {
`,z=0,M=[];m===0&&M.push("obj");for(var X=["retType"],s=[L],u=0;u<l;++u)M.push("arg"+u),X.push("argType"+u),s.push(A[u]),V+=`  var arg${u} = argType${u}.readValueFromPointer(args${z?"+"+z:""});
`,z+=A[u].argPackAdvance;var t=m===1?"new func":"func.call";V+=`  var rv = ${t}(${M.join(", ")});
`,L.isVoid||(X.push("emval_returnValue"),s.push(Wr),V+=`  return emval_returnValue(retType, destructorsRef, rv);
`),V+=`};
`,X.push(V);var n=Dt(Function,X)(...s),f=`methodCaller<(${A.map(v=>v.name).join(", ")}) => ${L.name}>`;return an(Qt(f,n))},sn=l=>{var c=vt.toValue(l);ke(c),Pr(l)},un=(l,c)=>{l=on(l,"_emval_take_value");var m=l.readValueFromPointer(c);return vt.toHandle(m)},ln=()=>2147483648,cn=()=>ln(),On=(l,c)=>Math.ceil(l/c)*c,Ln=l=>{var c=je.buffer,m=(l-c.byteLength+65535)/65536|0;try{return je.grow(m),Se(),1}catch{}},Un=l=>{var c=he.length;l>>>=0;var m=ln();if(l>m)return!1;for(var A=1;A<=4;A*=2){var L=c*(1+.2/A);L=Math.min(L,l+100663296);var V=Math.min(m,On(Math.max(l,L),65536)),z=Ln(V);if(z)return!0}return!1},Nr={},Fn=()=>Y||"./this.program",pr=()=>{if(!pr.strings){var l=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:l,_:Fn()};for(var m in Nr)Nr[m]===void 0?delete c[m]:c[m]=Nr[m];var A=[];for(var m in c)A.push(`${m}=${c[m]}`);pr.strings=A}return pr.strings},kn=(l,c)=>{for(var m=0;m<l.length;++m)_e[c++]=l.charCodeAt(m);_e[c]=0},Hr=(l,c)=>{var m=0;return pr().forEach((A,L)=>{var V=c+m;ue[l+L*4>>2]=V,kn(A,V),m+=A.length+1}),0},Vr=(l,c)=>{var m=pr();ue[l>>2]=m.length;var A=0;return m.forEach(L=>A+=L.length+1),ue[c>>2]=A,0},ar=l=>52;function Wt(l,c,m,A,L){return 70}var fn=[null,[],[]],dn=(l,c)=>{var m=fn[l];c===0||c===10?((l===1?pe:me)(nr(m)),m.length=0):m.push(c)},Br=(l,c,m,A)=>{for(var L=0,V=0;V<m;V++){var z=ue[c>>2],M=ue[c+4>>2];c+=8;for(var X=0;X<M;X++)dn(l,he[z+X]);L+=M}return ue[A>>2]=L,0},pn=l=>{var c=g["_"+l];return c},Cr=(l,c)=>{_e.set(l,c)},Gr=l=>G(l),d=l=>{var c=Et(l)+1,m=Gr(c);return Fr(l,m,c),m},p=(l,c,m,A,L)=>{var V={string:v=>{var P=0;return v!=null&&v!==0&&(P=d(v)),P},array:v=>{var P=Gr(v.length);return Cr(v,P),P}};function z(v){return c==="string"?jt(v):c==="boolean"?!!v:v}var M=pn(l),X=[],s=0;if(A)for(var u=0;u<A.length;u++){var t=V[m[u]];t?(s===0&&(s=D()),X[u]=t(A[u])):X[u]=A[u]}var n=M(...X);function f(v){return s!==0&&b(s),z(v)}return n=f(n),n};zt=g.InternalError=class extends Error{constructor(c){super(c),this.name="InternalError"}},gr(),Vt=g.BindingError=class extends Error{constructor(c){super(c),this.name="BindingError"}},Ae(),yn(),Gt=g.UnboundTypeError=mn(Error,"UnboundTypeError"),Zr();var T={A:ve,p:$e,e:Rr,o:Dr,y:Ye,m:_n,l:Kr,b:br,w:wr,i:Er,d:Ur,a:xr,x:Pn,g:nn,f:kr,c:En,z:xn,v:An,C:Cn,D:Pr,E:Dn,j:$n,B:sn,k:un,r:cn,q:Un,s:Hr,t:Vr,u:ar,n:Wt,h:Br},I;_();var F=l=>(F=I.H)(l),J=l=>(J=I.J)(l),W=l=>(W=I.K)(l),k=l=>(k=I.L)(l),G=l=>(G=I.M)(l),K=()=>(K=I.N)();g.dynCall_iji=(l,c,m,A)=>(g.dynCall_iji=I.O)(l,c,m,A),g.dynCall_jji=(l,c,m,A)=>(g.dynCall_jji=I.P)(l,c,m,A),g.dynCall_iiji=(l,c,m,A,L)=>(g.dynCall_iiji=I.Q)(l,c,m,A,L),g.dynCall_jiji=(l,c,m,A,L)=>(g.dynCall_jiji=I.R)(l,c,m,A,L),g.ccall=p;var ae;Ot=function l(){ae||se(),ae||(Ot=l)};function se(){if(Qe>0||(Ie(),Qe>0))return;function l(){ae||(ae=!0,g.calledRun=!0,!fe&&(Je(),w(g),g.onRuntimeInitialized?.(),Re()))}g.setStatus?(g.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>g.setStatus(""),1),l()},1)):l()}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);g.preInit.length>0;)g.preInit.pop()();return se(),r=U,r})})();e.exports=a,e.exports.default=a})(Pi)),Pi.exports}var yu=vu();const mu=ui(yu),_u=new URL("/radiology-ai-viewer/assets/openjpegwasm_decode-B3gWTHpv.wasm",import.meta.url),Yn={codec:void 0,decoder:void 0,decodeConfig:{}};function io(e){if(Yn.decodeConfig=e,Yn.codec)return Promise.resolve();const i=mu({locateFile:a=>a.endsWith(".wasm")?_u.toString():a});return new Promise((a,o)=>{i.then(h=>{Yn.codec=h,Yn.decoder=new h.J2KDecoder,a()},o)})}async function Ri(e,i){await io();const a=Yn.decoder,o=a.getEncodedBuffer(e.length);o.set(e),a.decode();const h=a.getFrameInfo(),r=a.getDecodedBuffer();new Uint8Array(r.length).set(r);const w=`x: ${a.getImageOffset().x}, y: ${a.getImageOffset().y}`,C=a.getNumDecompositions(),U=a.getNumLayers(),O=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][a.getProgressionOrder()+1],j=a.getIsReversible(),H=`${a.getBlockDimensions().width} x ${a.getBlockDimensions().height}`,N=`${a.getTileSize().width} x ${a.getTileSize().height}`,Y=`${a.getTileOffset().x}, ${a.getTileOffset().y}`,Z=a.getColorSpace(),re=`${r.length.toLocaleString()} bytes`,oe=`${(r.length/o.length).toFixed(2)}:1`,ie={columns:h.width,rows:h.height,bitsPerPixel:h.bitsPerSample,signed:h.isSigned,bytesPerPixel:i.bytesPerPixel,componentsPerPixel:h.componentCount},ce=bu(h,r),pe={imageOffset:w,numDecompositions:C,numLayers:U,progessionOrder:O,reversible:j,blockDimensions:H,tileSize:N,tileOffset:Y,colorTransform:Z,decodedSize:re,compressionRatio:oe};return{...i,pixelData:ce,imageInfo:ie,encodeOptions:pe,...pe,...ie}}function bu(e,i){return e.bitsPerSample>8?e.isSigned?new Int16Array(i.buffer,i.byteOffset,i.byteLength/2):new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2):e.isSigned?new Int8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}var wi={exports:{}},sa;function Pu(){return sa||(sa=1,(function(e,i){var a=(()=>{var o=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(o=o||__filename),(function(r){r=r||{};var r=typeof r<"u"?r:{},g,w;r.ready=new Promise(function(s,u){g=s,w=u});var C=Object.assign({},r),U=typeof window=="object",O=typeof importScripts=="function",j=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",H="";function N(s){return r.locateFile?r.locateFile(s,H):H+s}var Y,Z,re;if(j){var oe=hn,ie=hn;O?H=ie.dirname(H)+"/":H=__dirname+"/",Y=(s,u)=>(s=_(s)?new URL(s):ie.normalize(s),oe.readFileSync(s,u?void 0:"utf8")),re=s=>{var u=Y(s,!0);return u.buffer||(u=new Uint8Array(u)),u},Z=(s,u,t)=>{s=_(s)?new URL(s):ie.normalize(s),oe.readFile(s,function(n,f){n?t(n):u(f.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof te))throw s}),process.on("unhandledRejection",function(s){throw s}),r.inspect=function(){return"[Emscripten Module object]"}}else(U||O)&&(O?H=self.location.href:typeof document<"u"&&document.currentScript&&(H=document.currentScript.src),o&&(H=o),H.indexOf("blob:")!==0?H=H.substr(0,H.replace(/[?#].*/,"").lastIndexOf("/")+1):H="",Y=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.send(null),u.responseText},O&&(re=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),Z=(s,u,t)=>{var n=new XMLHttpRequest;n.open("GET",s,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){u(n.response);return}t()},n.onerror=t,n.send(null)});var ce=r.print||console.log.bind(console),pe=r.printErr||console.warn.bind(console);Object.assign(r,C),C=null,r.arguments&&r.arguments,r.thisProgram&&r.thisProgram,r.quit&&r.quit;var me;r.wasmBinary&&(me=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&Ft("no native wasm support detected");var we,je=!1;function fe(s,u){s||Ft(u)}var _e=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function he(s,u,t){for(var n=u+t,f=u;s[f]&&!(f>=n);)++f;if(f-u>16&&s.buffer&&_e)return _e.decode(s.subarray(u,f));for(var v="";u<f;){var P=s[u++];if(!(P&128)){v+=String.fromCharCode(P);continue}var E=s[u++]&63;if((P&224)==192){v+=String.fromCharCode((P&31)<<6|E);continue}var x=s[u++]&63;if((P&240)==224?P=(P&15)<<12|E<<6|x:P=(P&7)<<18|E<<12|x<<6|s[u++]&63,P<65536)v+=String.fromCharCode(P);else{var R=P-65536;v+=String.fromCharCode(55296|R>>10,56320|R&1023)}}return v}function Te(s,u){return s?he(Se,s,u):""}function Ne(s,u,t,n){if(!(n>0))return 0;for(var f=t,v=t+n-1,P=0;P<s.length;++P){var E=s.charCodeAt(P);if(E>=55296&&E<=57343){var x=s.charCodeAt(++P);E=65536+((E&1023)<<10)|x&1023}if(E<=127){if(t>=v)break;u[t++]=E}else if(E<=2047){if(t+1>=v)break;u[t++]=192|E>>6,u[t++]=128|E&63}else if(E<=65535){if(t+2>=v)break;u[t++]=224|E>>12,u[t++]=128|E>>6&63,u[t++]=128|E&63}else{if(t+3>=v)break;u[t++]=240|E>>18,u[t++]=128|E>>12&63,u[t++]=128|E>>6&63,u[t++]=128|E&63}}return u[t]=0,t-f}function qe(s,u,t){return Ne(s,Se,u,t)}function ue(s){for(var u=0,t=0;t<s.length;++t){var n=s.charCodeAt(t);n<=127?u++:n<=2047?u+=2:n>=55296&&n<=57343?(u+=4,++t):u+=3}return u}var De,Fe,Se,He,Ee,Pe,Ie,Je,Re;function At(s){De=s,r.HEAP8=Fe=new Int8Array(s),r.HEAP16=He=new Int16Array(s),r.HEAP32=Pe=new Int32Array(s),r.HEAPU8=Se=new Uint8Array(s),r.HEAPU16=Ee=new Uint16Array(s),r.HEAPU32=Ie=new Uint32Array(s),r.HEAPF32=Je=new Float32Array(s),r.HEAPF64=Re=new Float64Array(s)}r.INITIAL_MEMORY;var Jt,Ht=[],Qe=[],Ot=[];function yt(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Sr(r.preRun.shift());ve(Ht)}function mt(){ve(Qe)}function Zt(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)ht(r.postRun.shift());ve(Ot)}function Sr(s){Ht.unshift(s)}function sr(s){Qe.unshift(s)}function ht(s){Ot.unshift(s)}var Ke=0,Lt=null;function Ut(s){Ke++,r.monitorRunDependencies&&r.monitorRunDependencies(Ke)}function ot(s){if(Ke--,r.monitorRunDependencies&&r.monitorRunDependencies(Ke),Ke==0&&Lt){var u=Lt;Lt=null,u()}}function Ft(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",pe(s),je=!0,s+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(s);throw w(u),u}var ur="data:application/octet-stream;base64,";function y(s){return s.startsWith(ur)}function _(s){return s.startsWith("file://")}var S;S="openjphjs.wasm",y(S)||(S=N(S));function b(s){try{if(s==S&&me)return new Uint8Array(me);if(re)return re(s);throw"both async and sync fetching of the wasm failed"}catch(u){Ft(u)}}function D(){if(!me&&(U||O)){if(typeof fetch=="function"&&!_(S))return fetch(S,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+S+"'";return s.arrayBuffer()}).catch(function(){return b(S)});if(Z)return new Promise(function(s,u){Z(S,function(t){s(new Uint8Array(t))},u)})}return Promise.resolve().then(function(){return b(S)})}function q(){var s={env:d,wasi_snapshot_preview1:d};function u(P,E){var x=P.exports;r.asm=x,we=r.asm.memory,At(we.buffer),Jt=r.asm.__indirect_function_table,sr(r.asm.__wasm_call_ctors),ot()}Ut();function t(P){u(P.instance)}function n(P){return D().then(function(E){return WebAssembly.instantiate(E,s)}).then(function(E){return E}).then(P,function(E){pe("failed to asynchronously prepare wasm: "+E),Ft(E)})}function f(){return!me&&typeof WebAssembly.instantiateStreaming=="function"&&!y(S)&&!_(S)&&!j&&typeof fetch=="function"?fetch(S,{credentials:"same-origin"}).then(function(P){var E=WebAssembly.instantiateStreaming(P,s);return E.then(t,function(x){return pe("wasm streaming compile failed: "+x),pe("falling back to ArrayBuffer instantiation"),n(t)})}):n(t)}if(r.instantiateWasm)try{var v=r.instantiateWasm(s,u);return v}catch(P){pe("Module.instantiateWasm callback failed with error: "+P),w(P)}return f().catch(w),{}}function te(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}function ve(s){for(;s.length>0;)s.shift()(r)}function $e(s,u,t,n){Ft("Assertion failed: "+Te(s)+", at: "+[u?Te(u):"unknown filename",t,n?Te(n):"unknown function"])}var Ve=[];function ke(s){s.add_ref()}function st(s){var u=new rt(s);return u.get_caught()||u.set_caught(!0),u.set_rethrown(!1),Ve.push(u),ke(u),u.get_exception_ptr()}var Ce=0,Me=[];function Be(s){var u=Me[s];return u||(s>=Me.length&&(Me.length=s+1),Me[s]=u=Jt.get(s)),u}function zt(s){if(s.release_ref()&&!s.get_rethrown()){var u=s.get_destructor();u&&Be(u)(s.excPtr),I(s.excPtr)}}function Ct(){_setThrew(0);var s=Ve.pop();zt(s),Ce=0}function rt(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(u){Ie[this.ptr+4>>2]=u},this.get_type=function(){return Ie[this.ptr+4>>2]},this.set_destructor=function(u){Ie[this.ptr+8>>2]=u},this.get_destructor=function(){return Ie[this.ptr+8>>2]},this.set_refcount=function(u){Pe[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,Fe[this.ptr+12>>0]=u},this.get_caught=function(){return Fe[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,Fe[this.ptr+13>>0]=u},this.get_rethrown=function(){return Fe[this.ptr+13>>0]!=0},this.init=function(u,t){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=Pe[this.ptr>>2];Pe[this.ptr>>2]=u+1},this.release_ref=function(){var u=Pe[this.ptr>>2];return Pe[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){Ie[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return Ie[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=ae(this.get_type());if(u)return Ie[this.excPtr>>2];var t=this.get_adjusted_ptr();return t!==0?t:this.excPtr}}function Rr(s){throw Ce||(Ce=s),s}function Dr(){var s=Ce;if(!s)return J(0),0;var u=new rt(s);u.set_adjusted_ptr(s);var t=u.get_type();if(!t)return J(0),s;for(var n=0;n<arguments.length;n++){var f=arguments[n];if(f===0||f===t)break;var v=u.ptr+16;if(K(f,t,v))return J(f),s}return J(t),s}function gr(){var s=Ce;if(!s)return J(0),0;var u=new rt(s);u.set_adjusted_ptr(s);var t=u.get_type();if(!t)return J(0),s;for(var n=0;n<arguments.length;n++){var f=arguments[n];if(f===0||f===t)break;var v=u.ptr+16;if(K(f,t,v))return J(f),s}return J(t),s}function Yt(s,u,t){var n=new rt(s);throw n.init(u,t),Ce=s,s}var We={};function Vt(s){for(;s.length;){var u=s.pop(),t=s.pop();t(u)}}function ye(s){return this.fromWireType(Pe[s>>2])}var ut={},et={},lt={},Ye=48,er=57;function be(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var u=s.charCodeAt(0);return u>=Ye&&u<=er?"_"+s:s}function Le(s,u){return s=be(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function kt(s,u){var t=Le(u,function(n){this.name=u,this.message=n;var f=new Error(n).stack;f!==void 0&&(this.stack=this.toString()+`
`+f.replace(/^Error(:[^\n]*)?\n/,""))});return t.prototype=Object.create(s.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},t}var xe=void 0;function ct(s){throw new xe(s)}function St(s,u,t){s.forEach(function(E){lt[E]=u});function n(E){var x=t(E);x.length!==s.length&&ct("Mismatched type converter count");for(var R=0;R<s.length;++R)Xe(s[R],x[R])}var f=new Array(u.length),v=[],P=0;u.forEach((E,x)=>{et.hasOwnProperty(E)?f[x]=et[E]:(v.push(E),ut.hasOwnProperty(E)||(ut[E]=[]),ut[E].push(()=>{f[x]=et[E],++P,P===v.length&&n(f)}))}),v.length===0&&n(f)}function vr(s){var u=We[s];delete We[s];var t=u.rawConstructor,n=u.rawDestructor,f=u.fields,v=f.map(P=>P.getterReturnType).concat(f.map(P=>P.setterArgumentType));St([s],v,P=>{var E={};return f.forEach((x,R)=>{var $=x.fieldName,B=P[R],Q=x.getter,ne=x.getterContext,ee=P[R+f.length],ge=x.setter,de=x.setterContext;E[$]={read:Ue=>B.fromWireType(Q(ne,Ue)),write:(Ue,tt)=>{var at=[];ge(de,Ue,ee.toWireType(at,tt)),Vt(at)}}}),[{name:u.name,fromWireType:function(x){var R={};for(var $ in E)R[$]=E[$].read(x);return n(x),R},toWireType:function(x,R){for(var $ in E)if(!($ in R))throw new TypeError('Missing field:  "'+$+'"');var B=t();for($ in E)E[$].write(B,R[$]);return x!==null&&x.push(n,B),B},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:n}]})}function qr(s,u,t,n,f){}function lr(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function yr(){for(var s=new Array(256),u=0;u<256;++u)s[u]=String.fromCharCode(u);Xt=s}var Xt=void 0;function Ze(s){for(var u="",t=s;Se[t];)u+=Xt[Se[t++]];return u}var _t=void 0;function Ae(s){throw new _t(s)}function Xe(s,u,t={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=u.name;if(s||Ae('type "'+n+'" must have a positive integer typeid pointer'),et.hasOwnProperty(s)){if(t.ignoreDuplicateRegistrations)return;Ae("Cannot register type '"+n+"' twice")}if(et[s]=u,delete lt[s],ut.hasOwnProperty(s)){var f=ut[s];delete ut[s],f.forEach(v=>v())}}function Qt(s,u,t,n,f){var v=lr(t);u=Ze(u),Xe(s,{name:u,fromWireType:function(P){return!!P},toWireType:function(P,E){return E?n:f},argPackAdvance:8,readValueFromPointer:function(P){var E;if(t===1)E=Fe;else if(t===2)E=He;else if(t===4)E=Pe;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(E[P>>v])},destructorFunction:null})}function tr(s){if(!(this instanceof Dt)||!(s instanceof Dt))return!1;for(var u=this.$$.ptrType.registeredClass,t=this.$$.ptr,n=s.$$.ptrType.registeredClass,f=s.$$.ptr;u.baseClass;)t=u.upcast(t),u=u.baseClass;for(;n.baseClass;)f=n.upcast(f),n=n.baseClass;return u===n&&t===f}function cr(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function fr(s){function u(t){return t.$$.ptrType.registeredClass.name}Ae(u(s)+" instance already deleted")}var bt=!1;function Jr(s){}function vn(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function Pt(s){s.count.value-=1;var u=s.count.value===0;u&&vn(s)}function zr(s,u,t){if(u===t)return s;if(t.baseClass===void 0)return null;var n=zr(s,u,t.baseClass);return n===null?null:t.downcast(n)}var rr={};function mr(){return Object.keys(Kt).length}function yn(){var s=[];for(var u in Kt)Kt.hasOwnProperty(u)&&s.push(Kt[u]);return s}var gt=[];function Ir(){for(;gt.length;){var s=gt.pop();s.$$.deleteScheduled=!1,s.delete()}}var dr=void 0;function wt(s){dr=s,gt.length&&dr&&dr(Ir)}function $r(){r.getInheritedInstanceCount=mr,r.getLiveInheritedInstances=yn,r.flushPendingDeletes=Ir,r.setDelayFunction=wt}var Kt={};function Bt(s,u){for(u===void 0&&Ae("ptr should not be undefined");s.baseClass;)u=s.upcast(u),s=s.baseClass;return u}function _r(s,u){return u=Bt(s,u),Kt[u]}function ft(s,u){(!u.ptrType||!u.ptr)&&ct("makeClassHandle requires ptr and ptrType");var t=!!u.smartPtrType,n=!!u.smartPtr;return t!==n&&ct("Both smartPtrType and smartPtr must be specified"),u.count={value:1},Gt(Object.create(s,{$$:{value:u}}))}function mn(s){var u=this.getPointee(s);if(!u)return this.destructor(s),null;var t=_r(this.registeredClass,u);if(t!==void 0){if(t.$$.count.value===0)return t.$$.ptr=u,t.$$.smartPtr=s,t.clone();var n=t.clone();return this.destructor(s),n}function f(){return this.isSmartPointer?ft(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:s}):ft(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var v=this.registeredClass.getActualType(u),P=rr[v];if(!P)return f.call(this);var E;this.isConst?E=P.constPointerType:E=P.pointerType;var x=zr(u,this.registeredClass,E.registeredClass);return x===null?f.call(this):this.isSmartPointer?ft(E.registeredClass.instancePrototype,{ptrType:E,ptr:x,smartPtrType:this,smartPtr:s}):ft(E.registeredClass.instancePrototype,{ptrType:E,ptr:x})}function Gt(s){return typeof FinalizationRegistry>"u"?(Gt=u=>u,s):(bt=new FinalizationRegistry(u=>{Pt(u.$$)}),Gt=u=>{var t=u.$$,n=!!t.smartPtr;if(n){var f={$$:t};bt.register(u,f,u)}return u},Jr=u=>bt.unregister(u),Gt(s))}function Yr(){if(this.$$.ptr||fr(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=Gt(Object.create(Object.getPrototypeOf(this),{$$:{value:cr(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function Or(){this.$$.ptr||fr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ae("Object already scheduled for deletion"),Jr(this),Pt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function _n(){return!this.$$.ptr}function Xr(){return this.$$.ptr||fr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ae("Object already scheduled for deletion"),gt.push(this),gt.length===1&&dr&&dr(Ir),this.$$.deleteScheduled=!0,this}function Rt(){Dt.prototype.isAliasOf=tr,Dt.prototype.clone=Yr,Dt.prototype.delete=Or,Dt.prototype.isDeleted=_n,Dt.prototype.deleteLater=Xr}function Dt(){}function Qr(s,u,t){if(s[u].overloadTable===void 0){var n=s[u];s[u]=function(){return s[u].overloadTable.hasOwnProperty(arguments.length)||Ae("Function '"+t+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[u].overloadTable+")!"),s[u].overloadTable[arguments.length].apply(this,arguments)},s[u].overloadTable=[],s[u].overloadTable[n.argCount]=n}}function nt(s,u,t){r.hasOwnProperty(s)?((t===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[t]!==void 0)&&Ae("Cannot register public name '"+s+"' twice"),Qr(r,s,s),r.hasOwnProperty(t)&&Ae("Cannot register multiple overloads of a function with the same number of arguments ("+t+")!"),r[s].overloadTable[t]=u):(r[s]=u,t!==void 0&&(r[s].numArguments=t))}function Kr(s,u,t,n,f,v,P,E){this.name=s,this.constructor=u,this.instancePrototype=t,this.rawDestructor=n,this.baseClass=f,this.getActualType=v,this.upcast=P,this.downcast=E,this.pureVirtualFunctions=[]}function Lr(s,u,t){for(;u!==t;)u.upcast||Ae("Expected null or instance of "+t.name+", got an instance of "+u.name),s=u.upcast(s),u=u.baseClass;return s}function br(s,u){if(u===null)return this.isReference&&Ae("null is not a valid "+this.name),0;u.$$||Ae('Cannot pass "'+kr(u)+'" as a '+this.name),u.$$.ptr||Ae("Cannot pass deleted object as a pointer of type "+this.name);var t=u.$$.ptrType.registeredClass,n=Lr(u.$$.ptr,t,this.registeredClass);return n}function ze(s,u){var t;if(u===null)return this.isReference&&Ae("null is not a valid "+this.name),this.isSmartPointer?(t=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,t),t):0;u.$$||Ae('Cannot pass "'+kr(u)+'" as a '+this.name),u.$$.ptr||Ae("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&Ae("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var n=u.$$.ptrType.registeredClass;if(t=Lr(u.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&Ae("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?t=u.$$.smartPtr:Ae("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:t=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)t=u.$$.smartPtr;else{var f=u.clone();t=this.rawShare(t,Ar.toHandle(function(){f.delete()})),s!==null&&s.push(this.rawDestructor,t)}break;default:Ae("Unsupporting sharing policy")}return t}function Mt(s,u){if(u===null)return this.isReference&&Ae("null is not a valid "+this.name),0;u.$$||Ae('Cannot pass "'+kr(u)+'" as a '+this.name),u.$$.ptr||Ae("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&Ae("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var t=u.$$.ptrType.registeredClass,n=Lr(u.$$.ptr,t,this.registeredClass);return n}function Pr(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function dt(s){this.rawDestructor&&this.rawDestructor(s)}function Zr(s){s!==null&&s.delete()}function vt(){Tt.prototype.getPointee=Pr,Tt.prototype.destructor=dt,Tt.prototype.argPackAdvance=8,Tt.prototype.readValueFromPointer=ye,Tt.prototype.deleteObject=Zr,Tt.prototype.fromWireType=mn}function Tt(s,u,t,n,f,v,P,E,x,R,$){this.name=s,this.registeredClass=u,this.isReference=t,this.isConst=n,this.isSmartPointer=f,this.pointeeType=v,this.sharingPolicy=P,this.rawGetPointee=E,this.rawConstructor=x,this.rawShare=R,this.rawDestructor=$,!f&&u.baseClass===void 0?n?(this.toWireType=br,this.destructorFunction=null):(this.toWireType=Mt,this.destructorFunction=null):this.toWireType=ze}function wr(s,u,t){r.hasOwnProperty(s)||ct("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&t!==void 0?r[s].overloadTable[t]=u:(r[s]=u,r[s].argCount=t)}function Tr(s,u,t){var n=r["dynCall_"+s];return t&&t.length?n.apply(null,[u].concat(t)):n.call(null,u)}function bn(s,u,t){if(s.includes("j"))return Tr(s,u,t);var n=Be(u).apply(null,t);return n}function Er(s,u){var t=[];return function(){return t.length=0,Object.assign(t,arguments),bn(s,u,t)}}function Ge(s,u){s=Ze(s);function t(){return s.includes("j")?Er(s,u):Be(u)}var n=t();return typeof n!="function"&&Ae("unknown function pointer with signature "+s+": "+u),n}var Ur=void 0;function xr(s){var u=F(s),t=Ze(u);return T(u),t}function it(s,u){var t=[],n={};function f(v){if(!n[v]&&!et[v]){if(lt[v]){lt[v].forEach(f);return}t.push(v),n[v]=!0}}throw u.forEach(f),new Ur(s+": "+t.map(xr).join([", "]))}function Fr(s,u,t,n,f,v,P,E,x,R,$,B,Q){$=Ze($),v=Ge(f,v),E&&(E=Ge(P,E)),R&&(R=Ge(x,R)),Q=Ge(B,Q);var ne=be($);nt(ne,function(){it("Cannot construct "+$+" due to unbound types",[n])}),St([s,u,t],n?[n]:[],function(ee){ee=ee[0];var ge,de;n?(ge=ee.registeredClass,de=ge.instancePrototype):de=Dt.prototype;var Ue=Le(ne,function(){if(Object.getPrototypeOf(this)!==tt)throw new _t("Use 'new' to construct "+$);if(at.constructor_body===void 0)throw new _t($+" has no accessible constructor");var zn=at.constructor_body[arguments.length];if(zn===void 0)throw new _t("Tried to invoke ctor of "+$+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(at.constructor_body).toString()+") parameters instead!");return zn.apply(this,arguments)}),tt=Object.create(de,{constructor:{value:Ue}});Ue.prototype=tt;var at=new Kr($,Ue,tt,Q,ge,v,E,R),Mn=new Tt($,at,!0,!1,!1),or=new Tt($+"*",at,!1,!1,!1),ri=new Tt($+" const*",at,!1,!0,!1);return rr[s]={pointerType:or,constPointerType:ri},wr(ne,Ue),[Mn,or,ri]})}function Et(s,u){for(var t=[],n=0;n<s;n++)t.push(Ie[u+n*4>>2]);return t}function en(s,u){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var t=Le(s.name||"unknownFunctionName",function(){});t.prototype=s.prototype;var n=new t,f=s.apply(n,u);return f instanceof Object?f:n}function nr(s,u,t,n,f){var v=u.length;v<2&&Ae("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var P=u[1]!==null&&t!==null,E=!1,x=1;x<u.length;++x)if(u[x]!==null&&u[x].destructorFunction===void 0){E=!0;break}for(var R=u[0].name!=="void",$="",B="",x=0;x<v-2;++x)$+=(x!==0?", ":"")+"arg"+x,B+=(x!==0?", ":"")+"arg"+x+"Wired";var Q="return function "+be(s)+"("+$+`) {
if (arguments.length !== `+(v-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(v-2)+` args!');
}
`;E&&(Q+=`var destructors = [];
`);var ne=E?"destructors":"null",ee=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ge=[Ae,n,f,Vt,u[0],u[1]];P&&(Q+="var thisWired = classParam.toWireType("+ne+`, this);
`);for(var x=0;x<v-2;++x)Q+="var arg"+x+"Wired = argType"+x+".toWireType("+ne+", arg"+x+"); // "+u[x+2].name+`
`,ee.push("argType"+x),ge.push(u[x+2]);if(P&&(B="thisWired"+(B.length>0?", ":"")+B),Q+=(R?"var rv = ":"")+"invoker(fn"+(B.length>0?", ":"")+B+`);
`,E)Q+=`runDestructors(destructors);
`;else for(var x=P?1:2;x<u.length;++x){var de=x===1?"thisWired":"arg"+(x-2)+"Wired";u[x].destructorFunction!==null&&(Q+=de+"_dtor("+de+"); // "+u[x].name+`
`,ee.push(de+"_dtor"),ge.push(u[x].destructorFunction))}R&&(Q+=`var ret = retType.fromWireType(rv);
return ret;
`),Q+=`}
`,ee.push(Q);var Ue=en(Function,ee).apply(null,ge);return Ue}function jt(s,u,t,n,f,v){fe(u>0);var P=Et(u,t);f=Ge(n,f),St([],[s],function(E){E=E[0];var x="constructor "+E.name;if(E.registeredClass.constructor_body===void 0&&(E.registeredClass.constructor_body=[]),E.registeredClass.constructor_body[u-1]!==void 0)throw new _t("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+E.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return E.registeredClass.constructor_body[u-1]=()=>{it("Cannot construct "+E.name+" due to unbound types",P)},St([],P,function(R){return R.splice(1,0,null),E.registeredClass.constructor_body[u-1]=nr(x,R,null,f,v),[]}),[]})}function Pn(s,u,t,n,f,v,P,E){var x=Et(t,n);u=Ze(u),v=Ge(f,v),St([],[s],function(R){R=R[0];var $=R.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),E&&R.registeredClass.pureVirtualFunctions.push(u);function B(){it("Cannot call "+$+" due to unbound types",x)}var Q=R.registeredClass.instancePrototype,ne=Q[u];return ne===void 0||ne.overloadTable===void 0&&ne.className!==R.name&&ne.argCount===t-2?(B.argCount=t-2,B.className=R.name,Q[u]=B):(Qr(Q,u,$),Q[u].overloadTable[t-2]=B),St([],x,function(ee){var ge=nr($,ee,R,v,P);return Q[u].overloadTable===void 0?(ge.argCount=t-2,Q[u]=ge):Q[u].overloadTable[t-2]=ge,[]}),[]})}var ir=[],xt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function tn(s){s>4&&--xt[s].refcount===0&&(xt[s]=void 0,ir.push(s))}function wn(){for(var s=0,u=5;u<xt.length;++u)xt[u]!==void 0&&++s;return s}function Tn(){for(var s=5;s<xt.length;++s)if(xt[s]!==void 0)return xt[s];return null}function rn(){r.count_emval_handles=wn,r.get_first_emval=Tn}var Ar={toValue:s=>(s||Ae("Cannot use deleted val. handle = "+s),xt[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=ir.length?ir.pop():xt.length;return xt[u]={refcount:1,value:s},u}}}};function nn(s,u){u=Ze(u),Xe(s,{name:u,fromWireType:function(t){var n=Ar.toValue(t);return tn(t),n},toWireType:function(t,n){return Ar.toHandle(n)},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:null})}function kr(s){if(s===null)return"null";var u=typeof s;return u==="object"||u==="array"||u==="function"?s.toString():""+s}function En(s,u){switch(u){case 2:return function(t){return this.fromWireType(Je[t>>2])};case 3:return function(t){return this.fromWireType(Re[t>>3])};default:throw new TypeError("Unknown float type: "+s)}}function xn(s,u,t){var n=lr(t);u=Ze(u),Xe(s,{name:u,fromWireType:function(f){return f},toWireType:function(f,v){return v},argPackAdvance:8,readValueFromPointer:En(u,n),destructorFunction:null})}function An(s,u,t,n,f,v){var P=Et(u,t);s=Ze(s),f=Ge(n,f),nt(s,function(){it("Cannot call "+s+" due to unbound types",P)},u-1),St([],P,function(E){var x=[E[0],null].concat(E.slice(1));return wr(s,nr(s,x,null,f,v),u-1),[]})}function Mr(s,u,t){switch(u){case 0:return t?function(f){return Fe[f]}:function(f){return Se[f]};case 1:return t?function(f){return He[f>>1]}:function(f){return Ee[f>>1]};case 2:return t?function(f){return Pe[f>>2]}:function(f){return Ie[f>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function Cn(s,u,t,n,f){u=Ze(u);var v=lr(t),P=B=>B;if(n===0){var E=32-8*t;P=B=>B<<E>>>E}var x=u.includes("unsigned"),R=(B,Q)=>{},$;x?$=function(B,Q){return R(Q,this.name),Q>>>0}:$=function(B,Q){return R(Q,this.name),Q},Xe(s,{name:u,fromWireType:P,toWireType:$,argPackAdvance:8,readValueFromPointer:Mr(u,v,n!==0),destructorFunction:null})}function Sn(s,u,t){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],f=n[u];function v(P){P=P>>2;var E=Ie,x=E[P],R=E[P+1];return new f(De,R,x)}t=Ze(t),Xe(s,{name:t,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{ignoreDuplicateRegistrations:!0})}function Rn(s,u){u=Ze(u);var t=u==="std::string";Xe(s,{name:u,fromWireType:function(n){var f=Ie[n>>2],v=n+4,P;if(t)for(var E=v,x=0;x<=f;++x){var R=v+x;if(x==f||Se[R]==0){var $=R-E,B=Te(E,$);P===void 0?P=B:(P+="\0",P+=B),E=R+1}}else{for(var Q=new Array(f),x=0;x<f;++x)Q[x]=String.fromCharCode(Se[v+x]);P=Q.join("")}return T(n),P},toWireType:function(n,f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));var v,P=typeof f=="string";P||f instanceof Uint8Array||f instanceof Uint8ClampedArray||f instanceof Int8Array||Ae("Cannot pass non-string to std::string"),t&&P?v=ue(f):v=f.length;var E=p(4+v+1),x=E+4;if(Ie[E>>2]=v,t&&P)qe(f,x,v+1);else if(P)for(var R=0;R<v;++R){var $=f.charCodeAt(R);$>255&&(T(x),Ae("String has UTF-16 code units that do not fit in 8 bits")),Se[x+R]=$}else for(var R=0;R<v;++R)Se[x+R]=f[R];return n!==null&&n.push(T,E),E},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:function(n){T(n)}})}var jr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Dn(s,u){for(var t=s,n=t>>1,f=n+u/2;!(n>=f)&&Ee[n];)++n;if(t=n<<1,t-s>32&&jr)return jr.decode(Se.subarray(s,t));for(var v="",P=0;!(P>=u/2);++P){var E=He[s+P*2>>1];if(E==0)break;v+=String.fromCharCode(E)}return v}function an(s,u,t){if(t===void 0&&(t=2147483647),t<2)return 0;t-=2;for(var n=u,f=t<s.length*2?t/2:s.length,v=0;v<f;++v){var P=s.charCodeAt(v);He[u>>1]=P,u+=2}return He[u>>1]=0,u-n}function on(s){return s.length*2}function In(s,u){for(var t=0,n="";!(t>=u/4);){var f=Pe[s+t*4>>2];if(f==0)break;if(++t,f>=65536){var v=f-65536;n+=String.fromCharCode(55296|v>>10,56320|v&1023)}else n+=String.fromCharCode(f)}return n}function Wr(s,u,t){if(t===void 0&&(t=2147483647),t<4)return 0;for(var n=u,f=n+t-4,v=0;v<s.length;++v){var P=s.charCodeAt(v);if(P>=55296&&P<=57343){var E=s.charCodeAt(++v);P=65536+((P&1023)<<10)|E&1023}if(Pe[u>>2]=P,u+=4,u+4>f)break}return Pe[u>>2]=0,u-n}function $n(s){for(var u=0,t=0;t<s.length;++t){var n=s.charCodeAt(t);n>=55296&&n<=57343&&++t,u+=4}return u}function sn(s,u,t){t=Ze(t);var n,f,v,P,E;u===2?(n=Dn,f=an,P=on,v=()=>Ee,E=1):u===4&&(n=In,f=Wr,P=$n,v=()=>Ie,E=2),Xe(s,{name:t,fromWireType:function(x){for(var R=Ie[x>>2],$=v(),B,Q=x+4,ne=0;ne<=R;++ne){var ee=x+4+ne*u;if(ne==R||$[ee>>E]==0){var ge=ee-Q,de=n(Q,ge);B===void 0?B=de:(B+="\0",B+=de),Q=ee+u}}return T(x),B},toWireType:function(x,R){typeof R!="string"&&Ae("Cannot pass non-string to C++ string type "+t);var $=P(R),B=p(4+$+u);return Ie[B>>2]=$>>E,f(R,B+4,$+u),x!==null&&x.push(T,B),B},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:function(x){T(x)}})}function un(s,u,t,n,f,v){We[s]={name:Ze(u),rawConstructor:Ge(t,n),rawDestructor:Ge(f,v),fields:[]}}function ln(s,u,t,n,f,v,P,E,x,R){We[s].fields.push({fieldName:Ze(u),getterReturnType:t,getter:Ge(n,f),getterContext:v,setterArgumentType:P,setter:Ge(E,x),setterContext:R})}function cn(s,u){u=Ze(u),Xe(s,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(t,n){}})}function On(s){s>4&&(xt[s].refcount+=1)}function Ln(s,u){var t=et[s];return t===void 0&&Ae(u+" has unknown type "+xr(s)),t}function Un(s,u){s=Ln(s,"_emval_take_value");var t=s.readValueFromPointer(u);return Ar.toHandle(t)}function Nr(){Ft("")}function Fn(s,u,t){Se.copyWithin(s,u,u+t)}function pr(){return 2147483648}function kn(s){try{return we.grow(s-De.byteLength+65535>>>16),At(we.buffer),1}catch{}}function Hr(s){var u=Se.length;s=s>>>0;var t=pr();if(s>t)return!1;let n=(x,R)=>x+(R-x%R)%R;for(var f=1;f<=4;f*=2){var v=u*(1+.2/f);v=Math.min(v,s+100663296);var P=Math.min(t,n(Math.max(s,v),65536)),E=kn(P);if(E)return!0}return!1}function Vr(s){return 52}function ar(s,u,t,n,f){return 70}var Wt=[null,[],[]];function fn(s,u){var t=Wt[s];u===0||u===10?((s===1?ce:pe)(he(t,0)),t.length=0):t.push(u)}function dn(s,u,t,n){for(var f=0,v=0;v<t;v++){var P=Ie[u>>2],E=Ie[u+4>>2];u+=8;for(var x=0;x<E;x++)fn(s,Se[P+x]);f+=E}return Ie[n>>2]=f,0}function Br(s){return s}function pn(s){var u=r["_"+s];return u}function Cr(s,u){Fe.set(s,u)}function Gr(s,u,t,n,f){var v={string:ee=>{var ge=0;if(ee!=null&&ee!==0){var de=(ee.length<<2)+1;ge=G(de),qe(ee,ge,de)}return ge},array:ee=>{var ge=G(ee.length);return Cr(ee,ge),ge}};function P(ee){return u==="string"?Te(ee):u==="boolean"?!!ee:ee}var E=pn(s),x=[],R=0;if(n)for(var $=0;$<n.length;$++){var B=v[t[$]];B?(R===0&&(R=W()),x[$]=B(n[$])):x[$]=n[$]}var Q=E.apply(null,x);function ne(ee){return R!==0&&k(R),P(ee)}return Q=ne(Q),Q}xe=r.InternalError=kt(Error,"InternalError"),yr(),_t=r.BindingError=kt(Error,"BindingError"),Rt(),$r(),vt(),Ur=r.UnboundTypeError=kt(Error,"UnboundTypeError"),rn();var d={__assert_fail:$e,__cxa_begin_catch:st,__cxa_end_catch:Ct,__cxa_find_matching_catch_2:Dr,__cxa_find_matching_catch_3:gr,__cxa_throw:Yt,__resumeException:Rr,_embind_finalize_value_object:vr,_embind_register_bigint:qr,_embind_register_bool:Qt,_embind_register_class:Fr,_embind_register_class_constructor:jt,_embind_register_class_function:Pn,_embind_register_emval:nn,_embind_register_float:xn,_embind_register_function:An,_embind_register_integer:Cn,_embind_register_memory_view:Sn,_embind_register_std_string:Rn,_embind_register_std_wstring:sn,_embind_register_value_object:un,_embind_register_value_object_field:ln,_embind_register_void:cn,_emval_decref:tn,_emval_incref:On,_emval_take_value:Un,abort:Nr,emscripten_memcpy_big:Fn,emscripten_resize_heap:Hr,fd_close:Vr,fd_seek:ar,fd_write:dn,invoke_i:L,invoke_ii:se,invoke_iii:z,invoke_iiii:A,invoke_v:m,invoke_vi:l,invoke_viiii:c,invoke_viiiiii:V,llvm_eh_typeid_for:Br};q(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.__wasm_call_ctors).apply(null,arguments)};var p=r._malloc=function(){return(p=r._malloc=r.asm.malloc).apply(null,arguments)},T=r._free=function(){return(T=r._free=r.asm.free).apply(null,arguments)},I=r.___cxa_free_exception=function(){return(I=r.___cxa_free_exception=r.asm.__cxa_free_exception).apply(null,arguments)},F=r.___getTypeName=function(){return(F=r.___getTypeName=r.asm.__getTypeName).apply(null,arguments)};r.__embind_initialize_bindings=function(){return(r.__embind_initialize_bindings=r.asm._embind_initialize_bindings).apply(null,arguments)},r.___errno_location=function(){return(r.___errno_location=r.asm.__errno_location).apply(null,arguments)};var J=r.setTempRet0=function(){return(J=r.setTempRet0=r.asm.setTempRet0).apply(null,arguments)},W=r.stackSave=function(){return(W=r.stackSave=r.asm.stackSave).apply(null,arguments)},k=r.stackRestore=function(){return(k=r.stackRestore=r.asm.stackRestore).apply(null,arguments)},G=r.stackAlloc=function(){return(G=r.stackAlloc=r.asm.stackAlloc).apply(null,arguments)},K=r.___cxa_can_catch=function(){return(K=r.___cxa_can_catch=r.asm.__cxa_can_catch).apply(null,arguments)},ae=r.___cxa_is_pointer_type=function(){return(ae=r.___cxa_is_pointer_type=r.asm.__cxa_is_pointer_type).apply(null,arguments)};r.dynCall_ji=function(){return(r.dynCall_ji=r.asm.dynCall_ji).apply(null,arguments)},r.dynCall_iiji=function(){return(r.dynCall_iiji=r.asm.dynCall_iiji).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.dynCall_jiji).apply(null,arguments)};function se(s,u){var t=W();try{return Be(s)(u)}catch(n){if(k(t),n!==n+0)throw n;_setThrew(1,0)}}function l(s,u){var t=W();try{Be(s)(u)}catch(n){if(k(t),n!==n+0)throw n;_setThrew(1,0)}}function c(s,u,t,n,f){var v=W();try{Be(s)(u,t,n,f)}catch(P){if(k(v),P!==P+0)throw P;_setThrew(1,0)}}function m(s){var u=W();try{Be(s)()}catch(t){if(k(u),t!==t+0)throw t;_setThrew(1,0)}}function A(s,u,t,n){var f=W();try{return Be(s)(u,t,n)}catch(v){if(k(f),v!==v+0)throw v;_setThrew(1,0)}}function L(s){var u=W();try{return Be(s)()}catch(t){if(k(u),t!==t+0)throw t;_setThrew(1,0)}}function V(s,u,t,n,f,v,P){var E=W();try{Be(s)(u,t,n,f,v,P)}catch(x){if(k(E),x!==x+0)throw x;_setThrew(1,0)}}function z(s,u,t){var n=W();try{return Be(s)(u,t)}catch(f){if(k(n),f!==f+0)throw f;_setThrew(1,0)}}r.ccall=Gr;var M;Lt=function s(){M||X(),M||(Lt=s)};function X(s){if(Ke>0||(yt(),Ke>0))return;function u(){M||(M=!0,r.calledRun=!0,!je&&(mt(),g(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),Zt()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return X(),r.ready})})();e.exports=a})(wi)),wi.exports}var wu=Pu();const Tu=ui(wu),Eu=new URL("/radiology-ai-viewer/assets/openjphjs-C-BUUy4a.wasm",import.meta.url),Xn={codec:void 0,decoder:void 0,decodeConfig:{}};function xu(e,i,a){const o={width:i,height:a};for(;e>0;)o.width=Math.ceil(o.width/2),o.height=Math.ceil(o.height/2),e--;return o}function ao(e){if(Xn.decodeConfig=e,Xn.codec)return Promise.resolve();const i=Tu({locateFile:a=>a.endsWith(".wasm")?Eu.toString():a});return new Promise((a,o)=>{i.then(h=>{Xn.codec=h,Xn.decoder=new h.HTJ2KDecoder,a()},o)})}async function oo(e,i){await ao();const a=new Xn.codec.HTJ2KDecoder,o=a.getEncodedBuffer(e.length);o.set(e);const h=i.decodeLevel||0;a.decodeSubResolution(h);const r=a.getFrameInfo();if(i.decodeLevel>0){const{width:_e,height:he}=xu(i.decodeLevel,r.width,r.height);r.width=_e,r.height=he}const g=a.getDecodedBuffer();new Uint8Array(g.length).set(g);const C=`x: ${a.getImageOffset().x}, y: ${a.getImageOffset().y}`,U=a.getNumDecompositions(),O=a.getNumLayers(),j=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][a.getProgressionOrder()+1],H=a.getIsReversible(),N=`${a.getBlockDimensions().width} x ${a.getBlockDimensions().height}`,Y=`${a.getTileSize().width} x ${a.getTileSize().height}`,Z=`${a.getTileOffset().x}, ${a.getTileOffset().y}`,re=`${g.length.toLocaleString()} bytes`,oe=`${(g.length/o.length).toFixed(2)}:1`,ie={columns:r.width,rows:r.height,bitsPerPixel:r.bitsPerSample,signed:r.isSigned,bytesPerPixel:i.bytesPerPixel,componentsPerPixel:r.componentCount};let ce=Au(r,g);const{buffer:pe,byteOffset:me,byteLength:we}=ce,je=pe.slice(me,me+we);ce=new ce.constructor(je);const fe={imageOffset:C,numDecompositions:U,numLayers:O,progessionOrder:j,reversible:H,blockDimensions:N,tileSize:Y,tileOffset:Z,decodedSize:re,compressionRatio:oe};return{...i,pixelData:ce,imageInfo:ie,encodeOptions:fe,...fe,...ie}}function Au(e,i){return e.bitsPerSample>8?e.isSigned?new Int16Array(i.buffer,i.byteOffset,i.byteLength/2):new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2):e.isSigned?new Int8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}function Cu(e,i){const a=e.length,{rescaleSlope:o,rescaleIntercept:h,suvbw:r,doseGridScaling:g}=i;if(i.modality==="PT"&&typeof r=="number"&&!isNaN(r))for(let w=0;w<a;w++)e[w]=r*(e[w]*o+h);else if(i.modality==="RTDOSE"&&typeof g=="number"&&!isNaN(g))for(let w=0;w<a;w++)e[w]=e[w]*g;else for(let w=0;w<a;w++)e[w]=e[w]*o+h;return!0}const Su={bilinear:Ks,replicate:Zs},ua={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};function so(e,i,a,o){const h=e.pixelRepresentation!==void 0&&e.pixelRepresentation===1,r=h&&e.bitsStored!==void 0?32-e.bitsStored:void 0;if(h&&r!==void 0)for(let ie=0;ie<e.pixelData.length;ie++)e.pixelData[ie]=e.pixelData[ie]<<r>>r;let g=e.pixelData;e.pixelDataLength=e.pixelData.length;const{min:w,max:C}=di(e.pixelData),U=typeof i.allowFloatRendering<"u"?i.allowFloatRendering:!0;let O=ki(e.photometricInterpretation)&&i.targetBuffer?.offset===void 0;const H=i.preScale?.enabled&&Object.values(i.preScale.scalingParameters).some(ie=>typeof ie=="number"&&!Number.isInteger(ie)),N=!i.preScale.enabled||!U&&H,Y=i.targetBuffer?.type;if(Y&&i.preScale.enabled&&!N){const ie=i.preScale.scalingParameters,ce=Di(w,C,ie);O=!hs(ce.min,ce.max,ua[Y])}Y&&!O?g=Du(i,e,ua,g):i.preScale.enabled&&!N?g=Iu(i,w,C,e):g=uo(w,C,e);let Z=w,re=C;if(i.preScale.enabled&&!N){const ie=i.preScale.scalingParameters;if(lo(ie),Ru(ie)){Cu(g,ie),e.preScale={...i.preScale,scaled:!0};const pe=Di(w,C,ie);Z=pe.min,re=pe.max}}else N&&(e.preScale={enabled:!0,scaled:!1},Z=w,re=C);e.pixelData=g,e.smallestPixelValue=Z,e.largestPixelValue=re;const oe=new Date().getTime();return e.decodeTimeInMS=oe-a,e}function Ru(e){const{rescaleSlope:i,rescaleIntercept:a,modality:o,doseGridScaling:h,suvbw:r}=e;return typeof i=="number"&&typeof a=="number"||o==="RTDOSE"&&typeof h=="number"||o==="PT"&&typeof r=="number"}function Du(e,i,a,o){const{arrayBuffer:h,type:r,offset:g=0,length:w,rows:C}=e.targetBuffer,U=a[r];if(!U)throw new Error(`target array ${r} is not supported, or doesn't exist.`);C&&C!=i.rows&&Ou(i,e.targetBuffer,U);const O=i.pixelDataLength,j=g,H=w??O-j,N=i.pixelData;if(H!==N.length)throw new Error(`target array for image does not have the same length (${H}) as the decoded image length (${N.length}).`);const Y=h?new U(h,j,H):new U(H);return Y.set(N,0),o=Y,o}function Iu(e,i,a,o){const h=e.preScale.scalingParameters;lo(h);const r=Di(i,a,h);return uo(r.min,r.max,o)}function uo(e,i,a){const o=Mi(e,i),h=new o(a.pixelData.length);return h.set(a.pixelData,0),h}function Di(e,i,a){const{rescaleSlope:o,rescaleIntercept:h,modality:r,doseGridScaling:g,suvbw:w}=a;return r==="PT"&&typeof w=="number"&&!isNaN(w)?{min:w*(e*o+h),max:w*(i*o+h)}:r==="RTDOSE"&&typeof g=="number"&&!isNaN(g)?{min:e*g,max:i*g}:typeof o=="number"&&typeof h=="number"?{min:o*e+h,max:o*i+h}:{min:e,max:i}}function lo(e){if(!e)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function $u(e,i,a){const{samplesPerPixel:o}=e,{rows:h,columns:r}=i,g=h*r*o,w=new a(g),C=w.byteLength/g;return{pixelData:w,rows:h,columns:r,frameInfo:{...e.frameInfo,rows:h,columns:r},imageInfo:{...e.imageInfo,rows:h,columns:r,bytesPerPixel:C}}}function Ou(e,i,a){const o=$u(e,i,a),{scalingType:h="replicate"}=i;return Su[h](e,o),Object.assign(e,o),e.pixelDataLength=e.pixelData.length,e}async function co(e,i,a,o,h,r){const g=new Date().getTime();let w=null,C;switch(i){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":w=Ai(e,a);break;case"1.2.840.10008.1.2.2":w=Xa(e,a);break;case"1.2.840.10008.1.2.1.99":w=Ai(e,a);break;case"1.2.840.10008.1.2.5":w=Qa(e,a);break;case"1.2.840.10008.1.2.4.50":C={...e},w=Za(a,C);break;case"1.2.840.10008.1.2.4.51":w=to(e,a);break;case"1.2.840.10008.1.2.4.57":w=Ci(e,a);break;case"1.2.840.10008.1.2.4.70":w=Ci(e,a);break;case"1.2.840.10008.1.2.4.80":C={signed:e.pixelRepresentation===1,bytesPerPixel:e.bitsAllocated<=8?1:2,...e},w=Si(a,C);break;case"1.2.840.10008.1.2.4.81":C={signed:e.pixelRepresentation===1,bytesPerPixel:e.bitsAllocated<=8?1:2,...e},w=Si(a,C);break;case"1.2.840.10008.1.2.4.90":C={...e},w=Ri(a,C);break;case"1.2.840.10008.1.2.4.91":C={...e},w=Ri(a,C);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":C={...e},w=oo(a,C);break;default:throw new Error(`no decoder for transfer syntax ${i}`)}if(!w)throw new Error("decodePromise not defined");const U=await w,O=so(U,h,g);return r?.(O),O}const Lu={decodeTask({imageFrame:e,transferSyntax:i,decodeConfig:a,options:o,pixelData:h,callbackFn:r}){return co(e,i,h,a,o,r)}};mo(Lu);const Uu={HTJ2K:ao,JPEG2000:io,JPEGLS:no,JPEGBaseline12Bit:eo,JPEGLossless:ro,JPEGBaseline8Bit:lu},Fu={HTJ2K:oo,JPEG2000:Ri,JPEGLS:Si,JPEGBaseline12Bit:to,JPEGLossless:Ci,JPEGBaseline8Bit:Za,BigEndian:Xa,LittleEndian:Ai,RLE:Qa},Hu={constants:Qs,convertRGBColorByPixel:Ii,convertRGBColorByPlane:ha,convertYBRFullByPixel:ga,convertYBRFullByPlane:va,convertPALETTECOLOR:ya,wadouri:_s,wadors:Bs,init:Js,convertColorSpace:Ua,createImage:pi,decodeJPEGBaseline8BitColor:Fa,getImageFrame:ka,getPixelData:Ni,getMinMax:di,isColorImage:ki,isJPEGBaseline8BitColor:Ys,internal:Lo,decodeImageFrame:co,postProcessDecodedPixels:so,initializers:Uu,decoders:Fu};export{Qs as constants,Ua as convertColorSpace,ya as convertPALETTECOLOR,Ii as convertRGBColorByPixel,ha as convertRGBColorByPlane,ga as convertYBRFullByPixel,va as convertYBRFullByPlane,pi as createImage,co as decodeImageFrame,Fa as decodeJPEGBaseline8BitColor,Fu as decoders,Hu as default,ka as getImageFrame,di as getMinMax,Ni as getPixelData,Js as init,Uu as initializers,Lo as internal,ki as isColorImage,Ys as isJPEGBaseline8BitColor,so as postProcessDecodedPixels,Bs as wadors,_s as wadouri};
