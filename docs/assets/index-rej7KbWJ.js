const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DdKylV0O.js","assets/index-Cp4iUYqv.js","assets/Texture-C9D3AFRO.js","assets/imageRetrievalPoolManager-DiP2nqZv.js","assets/index-BFl08faP.js","assets/index-DY_4lxI-.js"])))=>i.map(i=>d[i]);
(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const R="modulepreload",W=function(r){return"/radiology-ai-viewer/"+r},k={},L=function(a,i,c){let e=Promise.resolve();if(i&&i.length>0){let y=function(d){return Promise.all(d.map(v=>Promise.resolve(v).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),m=s?.nonce||s?.getAttribute("nonce");e=y(i.map(d=>{if(d=W(d),d in k)return;k[d]=!0;const v=d.endsWith(".css"),g=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const u=document.createElement("link");if(u.rel=v?"stylesheet":R,v||(u.as="script"),u.crossOrigin="",u.href=d,m&&u.setAttribute("nonce",m),document.head.appendChild(u),v)return new Promise((x,l)=>{u.addEventListener("load",x),u.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${d}`)))})}))}function t(s){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=s,window.dispatchEvent(m),!m.defaultPrevented)throw s}return e.then(s=>{for(const m of s||[])m.status==="rejected"&&t(m.reason);return a().catch(t)})};function N(r){const a=r&&r.viewport,i=r&&r.container;if(!i)throw new Error("setupAIMockOverlay: container is required");window.getComputedStyle(i).position==="static"&&(i.style.position="relative");const e=document.createElement("canvas");e.style.position="absolute",e.style.inset="0",e.style.pointerEvents="none",e.style.zIndex="9998",e.style.width="100%",e.style.height="100%",i.appendChild(e);const t=e.getContext("2d");let s=!1,m=[],y=[],d=[];const v=!!(a&&typeof a.canvasToWorld=="function"&&typeof a.worldToCanvas=="function"),g=(o,n)=>v?a.canvasToWorld([o,n]):[o,n,0],u=o=>v?a.worldToCanvas(o):[o[0],o[1]],x=(o,n)=>Math.hypot(o[0]-n[0],o[1]-n[1],(o[2]||0)-(n[2]||0));function l(){const o=a&&typeof a.getCanvas=="function"&&a.getCanvas()||i.querySelector("canvas"),n=o&&o.width?o.width:i.clientWidth,p=o&&o.height?o.height:i.clientHeight;e.width!==n&&(e.width=n),e.height!==p&&(e.height=p)}function f(o,n){l();const p=o*e.width,h=n*e.height;return g(p,h)}function M(){m=[{a:f(.28,.3),b:f(.55,.58),label:"Nodule 0.87"},{a:f(.62,.22),b:f(.82,.4),label:"Mass 0.73"}],y=[(()=>{const o=f(.48,.52),n=f(.56,.52);return{c:o,e:n,w:.55}})(),(()=>{const o=f(.7,.35),n=f(.76,.35);return{c:o,e:n,w:.35}})()],d=[(()=>{const o=f(.3,.72),n=f(.52,.72);return{p1:o,p2:n,label:"AI length"}})()]}function w(){t.clearRect(0,0,e.width,e.height)}function _(){if(l(),w(),!!s){t.save(),t.lineWidth=2,t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial",t.textBaseline="top";for(const o of y){const n=u(o.c),p=u(o.e),h=Math.hypot(n[0]-p[0],n[1]-p[1]),T=t.createRadialGradient(n[0],n[1],0,n[0],n[1],h);T.addColorStop(0,"rgba(255,0,0,"+.35*o.w+")"),T.addColorStop(1,"rgba(255,0,0,0)"),t.fillStyle=T,t.beginPath(),t.arc(n[0],n[1],h,0,Math.PI*2),t.fill()}t.strokeStyle="rgba(0,255,0,0.9)",t.fillStyle="rgba(0,255,0,0.9)";for(const o of m){const n=u(o.a),p=u(o.b),h=Math.min(n[0],p[0]),T=Math.min(n[1],p[1]),q=Math.abs(n[0]-p[0]),z=Math.abs(n[1]-p[1]);t.strokeRect(h,T,q,z),t.fillText(o.label,h+3,T+3)}t.strokeStyle="rgba(255,255,0,0.95)",t.fillStyle="rgba(255,255,0,0.95)";for(const o of d){const n=u(o.p1),p=u(o.p2);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(p[0],p[1]),t.stroke();const h=x(o.p1,o.p2).toFixed(1);t.fillText(o.label+": "+h+" mm",(n[0]+p[0])/2+6,(n[1]+p[1])/2+6)}t.restore()}}const E=()=>window.requestAnimationFrame(_);return window.addEventListener("resize",E,{passive:!0}),i.addEventListener("wheel",E,{passive:!0}),i.addEventListener("pointermove",E,{passive:!0}),i.addEventListener("pointerup",E,{passive:!0}),{start(){s=!0,M(),_()},stop(){s=!1,_()},toggle(){s?this.stop():this.start()},redraw:_,destroy(){try{e.remove()}catch{}window.removeEventListener("resize",E)}}}const I=document.getElementById("dicomViewport"),P=document.getElementById("status"),V=document.getElementById("dicomFiles");let C,S,A;function b(r){P&&(P.textContent=r)}function B(r){return r?.stack||r?.message||String(r)}b("main.js running. Loading Cornerstone modules...");async function D(){try{const r=await L(()=>import("./index-DdKylV0O.js"),__vite__mapDeps([0,1,2,3])),a=await L(()=>import("./index-BFl08faP.js"),__vite__mapDeps([4,1,2])),i=await L(()=>import("./index-DY_4lxI-.js"),__vite__mapDeps([5,1,3]));if(b("Initializing Cornerstone..."),await r.init(),await a.init(),i.init({maxWebWorkers:navigator.hardwareConcurrency||1}),A=i.wadouri,!A?.fileManager?.add)throw new Error("wadouri.fileManager.add is missing. DICOM image loader did not initialize.");const{addTool:c,ToolGroupManager:e,PanTool:t,ZoomTool:s,WindowLevelTool:m,StackScrollTool:y,LengthTool:d,Enums:v}=a;c(t),c(s),c(m),c(y),c(d);const g="re1",u="vp1";C=new r.RenderingEngine(g),C.enableElement({viewportId:u,type:r.Enums.ViewportType.STACK,element:I}),S=C.getViewport(u),(()=>{try{window.__rav_viewport=I}catch{}})(),(()=>{try{if(window.__aiMock)return;let w=document.getElementById("btnAIMock");w||(w=document.createElement("button"),w.id="btnAIMock",w.type="button",w.textContent="AI Overlay (mock)",w.style.cssText="position:fixed; top:12px; right:12px; z-index:9999; padding:8px 10px; border-radius:10px; border:1px solid #999; background:#fff; color:#111; font-weight:600; cursor:pointer;",document.body.appendChild(w));const _=document.querySelector("canvas"),E=typeof viewportElement<"u"&&viewportElement||typeof I<"u"&&I||document.getElementById("viewport")||document.querySelector("[data-viewport]")||(_?_.parentElement:null);if(!E){console.warn("AI overlay: could not find viewport container");return}window.__rav_viewport=I;const o=N({viewport:I,container:E});w.addEventListener("click",()=>o.toggle()),window.__aiMock=o}catch(w){console.warn("AI overlay init failed:",w)}})();const l=e.createToolGroup("tg1");l.addTool(y.toolName),l.addTool(m.toolName),l.addTool(t.toolName),l.addTool(s.toolName),l.addTool(d.toolName),l.addViewport(u,g);const f=v?.MouseBindings??null,M=v?.KeyboardBindings??null;f?(l.setToolActive(m.toolName,{bindings:[{mouseButton:f.Primary}]}),l.setToolActive(t.toolName,{bindings:[{mouseButton:f.Auxiliary}]}),l.setToolActive(s.toolName,{bindings:[{mouseButton:f.Secondary}]}),l.setToolActive(y.toolName,{bindings:[{mouseButton:f.Wheel}]}),M?.Shift!=null?l.setToolActive(d.toolName,{bindings:[{mouseButton:f.Primary,modifierKey:M.Shift}]}):l.setToolPassive(d.toolName)):(l.setToolActive(y.toolName),l.setToolActive(m.toolName),l.setToolPassive(t.toolName),l.setToolPassive(s.toolName),l.setToolPassive(d.toolName)),S.render(),b("Ready. Choose DICOM files (one series) to load.")}catch(r){console.error(r),b("Initialization failed:\\n"+B(r))}}async function O(r){const a=Array.from(r||[]).filter(i=>i&&i.size>0);if(a.length!==0){if(!S){b("Viewer not initialized yet. See error above.");return}try{a.sort((c,e)=>c.name.localeCompare(e.name,void 0,{numeric:!0,sensitivity:"base"})),b("Indexing files...");const i=a.map(c=>A.fileManager.add(c));b("Loading stack..."),await S.setStack(i),S.render(),b("Loaded "+i.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom.")}catch(i){console.error(i),b("Load failed:\\n"+B(i)+"\\nTry selecting only one series.")}}}V?.addEventListener("change",r=>O(r.target.files));I?.addEventListener("dragover",r=>{r.preventDefault()});I?.addEventListener("drop",r=>{r.preventDefault(),O(r.dataTransfer.files)});D();(()=>{function r(){let e=document.getElementById("btnAIMock");return e||(e=document.createElement("button"),e.id="btnAIMock",e.type="button",e.textContent="AI Overlay (mock)",e.style.cssText="position:fixed; top:12px; right:12px; z-index:999999; padding:8px 10px; border-radius:10px; border:1px solid #999; background:#fff; color:#111; font-weight:600; cursor:pointer;",document.body.appendChild(e)),e}function a(){const e=document.querySelector("#viewport canvas")||document.querySelector("[data-viewport] canvas")||document.querySelector("canvas");return document.getElementById("viewport")||document.querySelector("[data-viewport]")||(e?e.parentElement:null)}function i(){if(window.__aiMock)return window.__aiMock;const e=a();if(!e)return null;const t=window.__rav_viewport||window.__cornerstoneViewport||null;try{const s=N({viewport:t,container:e});return window.__aiMock=s,s}catch(s){return console.warn("AI overlay install failed:",s),null}}function c(){r().addEventListener("click",()=>{const s=i();if(!s){alert("Viewport not ready yet. Load a DICOM series first, then click again.");return}s.toggle()}),new MutationObserver(()=>{if(!window.__aiMock){const s=a();s&&s.querySelector("canvas")&&i()}}).observe(document.documentElement,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c()})();(()=>{function r(){return document.getElementById("viewport")||document.querySelector("[data-viewport]")||(document.querySelector("canvas")?document.querySelector("canvas").parentElement:null)}const a=r();!a||a.__ravScrollGuardInstalled||(a.__ravScrollGuardInstalled=!0,a.addEventListener("wheel",i=>{try{const c=window.__rav_viewport;c&&typeof c.getImageIds=="function"&&c.getImageIds().length||(i.preventDefault(),i.stopImmediatePropagation())}catch{}},{capture:!0,passive:!1}))})();export{L as _};
