(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var $e;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED="DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED="DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOAD_PROGRESS="GEOMETRY_LOAD_PROGRESS",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED",t.ACTORS_CHANGED="CORNERSTONE_ACTORS_CHANGED"})($e||($e={}));var Jt;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(Jt||(Jt={}));var Nn;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(Nn||(Nn={}));var Hs;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(Hs||(Hs={}));const uf={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6};var dE={BlendMode:uf};const{BlendMode:Dd}=dE;var Ka;(function(t){t[t.COMPOSITE=Dd.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=Dd.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=Dd.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=Dd.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",t[t.LABELMAP_EDGE_PROJECTION_BLEND=Dd.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"})(Ka||(Ka={}));var ha;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition",t.AXIAL_REFORMAT="axial_reformat",t.CORONAL_REFORMAT="coronal_reformat",t.SAGITTAL_REFORMAT="sagittal_reformat",t.REFORMAT="reformat"})(ha||(ha={}));var xp;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE",t.MESH="MESH"})(xp||(xp={}));var Lv;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(Lv||(Lv={}));const vR=Lv;var Nv;(function(t){t.PLY="PLY",t.STL="STL",t.OBJ="OBJ",t.VTP="VTP"})(Nv||(Nv={}));const yR=Nv;var ui;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(ui||(ui={}));var Vv;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(Vv||(Vv={}));const wR=Vv;var oa;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated",t.CALIBRATED="Calibrated",t.UNKNOWN="Unknown"})(oa||(oa={}));var _i;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(_i||(_i={}));var ho;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(ho||(ho={}));var Bf;(function(t){t.FRAME="f",t.SECOND="s"})(Bf||(Bf={}));const CR=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return Bf}},Symbol.toStringTag,{value:"Module"}));var Ui;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.FRAME_MODULE="frameModule",t.WADO_WEB_CLIENT="wadoWebClient",t.INSTANCE="instance",t.IMAGE_SOP_INSTANCE_REFERENCE="ImageSopInstanceReference",t.REFERENCED_SERIES_REFERENCE="ReferencedSeriesReference",t.PREDECESSOR_SEQUENCE="PredecessorSequence",t.STUDY_DATA="StudyData",t.SERIES_DATA="SeriesData",t.IMAGE_DATA="ImageData",t.RTSS_INSTANCE_DATA="RtssInstanceData",t.NEW_INSTANCE_DATA="NewInstanceData",t.RTSS_CONTOUR="metaRTSSContour",t.SEG_BIT="metaSegBitmap",t.SR_ANNOTATION="metaSrAnnotation"})(Ui||(Ui={}));var C0;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(C0||(C0={}));var Sp;(function(t){t.RLE="RLE",t.Volume="Volume"})(Sp||(Sp={}));var Tu;(function(t){t.Tiled="tiled",t.ContextPool="contextPool"})(Tu||(Tu={}));const To=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:Ka,CalibrationTypes:oa,ContourType:vR,DynamicOperatorType:wR,Events:$e,get GenerateImageType(){return C0},GeometryType:xp,ImageQualityStatus:ho,InterpolationType:Hs,MeshType:yR,MetadataModules:Ui,OrientationAxis:ha,RenderingEngineModeEnum:Tu,RequestType:Jt,VOILUTFunctionType:ui,VideoEnums:CR,ViewportStatus:_i,ViewportType:Nn,VoxelManagerEnum:Sp},Symbol.toStringTag,{value:"Module"})),kv={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},lr={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(lr);const yo=.001;function fE(t){const e=Object.getOwnPropertyNames(t);for(const r of e){const n=t[r];n&&typeof n=="object"&&fE(n)}return Object.freeze(t)}const xR={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},Xs=fE(xR),hE=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],SR={slicer3D:[160/255,164/255,217/255]},pl=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:SR,CPU_COLORMAPS:kv,EPSILON:yo,MPR_CAMERA_VALUES:Xs,RENDERING_DEFAULTS:lr,VIEWPORT_PRESETS:hE},Symbol.toStringTag,{value:"Module"})),Id={},Gf={get:t=>Id[t],set:t=>{const e=t.id;Id[e]=t},delete:t=>delete Id[t],getAll:()=>{const e=Object.keys(Id).map(r=>Id[r]);return e.sort((r,n)=>r.id[0]==="_"&&n.id[0]!=="_"?1:r.id[0]!=="_"&&n.id[0]==="_"?-1:0),e}};function Fn(t){return Gf.get(t)}function eo(){return Gf.getAll()}const Tp=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",TR=t=>Array.isArray(t)?[]:{},Wf=(t,e)=>e&&e.clone===!0&&Tp(t)?kr(TR(t),t,e):t,$x=(t,e,r)=>{const n=t.slice();return e.forEach(function(i,o){typeof n[o]>"u"?n[o]=Wf(i,r):Tp(i)?n[o]=kr(t[o],i,r):t.indexOf(i)===-1&&(n[o]=Wf(i,r))}),n},_R=(t,e,r)=>{const n={};return Tp(t)&&Object.keys(t).forEach(function(i){n[i]=Wf(t[i],r)}),Object.keys(e).forEach(function(i){!Tp(e[i])||!t[i]?n[i]=Wf(e[i],r):n[i]=kr(t[i],e[i],r)}),n},kr=(t={},e={},r=void 0)=>{const n=Array.isArray(e),o=(r||{arrayMerge:$x}).arrayMerge||$x;return n?Array.isArray(t)?o(t,e,r):Wf(e,r):_R(t,e,r)};const gE=Symbol("Comlink.proxy"),ER=Symbol("Comlink.endpoint"),pE=Symbol("Comlink.releaseProxy"),Hm=Symbol("Comlink.finalizer"),Wg=Symbol("Comlink.thrown"),mE=t=>typeof t=="object"&&t!==null||typeof t=="function",bR={canHandle:t=>mE(t)&&t[gE],serialize(t){const{port1:e,port2:r}=new MessageChannel;return h5(t,e),[r,[r]]},deserialize(t){return t.start(),Fv(t)}},DR={canHandle:t=>mE(t)&&Wg in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},vE=new Map([["proxy",bR],["throw",DR]]);function IR(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function h5(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!IR(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:a,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(iu);let l;try{const d=s.slice(0,-1).reduce((f,h)=>f[h],t),u=s.reduce((f,h)=>f[h],t);switch(a){case"GET":l=u;break;case"SET":d[s.slice(-1)[0]]=iu(i.data.value),l=!0;break;case"APPLY":l=u.apply(d,c);break;case"CONSTRUCT":{const f=new u(...c);l=xE(f)}break;case"ENDPOINT":{const{port1:f,port2:h}=new MessageChannel;h5(t,h),l=AR(f,[f])}break;case"RELEASE":l=void 0;break;default:return}}catch(d){l={value:d,[Wg]:0}}Promise.resolve(l).catch(d=>({value:d,[Wg]:0})).then(d=>{const[u,f]=bp(d);e.postMessage(Object.assign(Object.assign({},u),{id:o}),f),a==="RELEASE"&&(e.removeEventListener("message",n),yE(e),Hm in t&&typeof t[Hm]=="function"&&t[Hm]())}).catch(d=>{const[u,f]=bp({value:new TypeError("Unserializable return value"),[Wg]:0});e.postMessage(Object.assign(Object.assign({},u),{id:o}),f)})}),e.start&&e.start()}function MR(t){return t.constructor.name==="MessagePort"}function yE(t){MR(t)&&t.close()}function Fv(t,e){const r=new Map;return t.addEventListener("message",function(i){const{data:o}=i;if(!o||!o.id)return;const a=r.get(o.id);if(a)try{a(o)}finally{r.delete(o.id)}}),Uv(t,r,[],e)}function Qh(t){if(t)throw new Error("Proxy has been released and is not useable")}function wE(t){return r0(t,new Map,{type:"RELEASE"}).then(()=>{yE(t)})}const _p=new WeakMap,Ep="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(_p.get(t)||0)-1;_p.set(t,e),e===0&&wE(t)});function OR(t,e){const r=(_p.get(e)||0)+1;_p.set(e,r),Ep&&Ep.register(t,e,t)}function PR(t){Ep&&Ep.unregister(t)}function Uv(t,e,r=[],n=function(){}){let i=!1;const o=new Proxy(n,{get(a,s){if(Qh(i),s===pE)return()=>{PR(o),wE(t),e.clear(),i=!0};if(s==="then"){if(r.length===0)return{then:()=>o};const c=r0(t,e,{type:"GET",path:r.map(l=>l.toString())}).then(iu);return c.then.bind(c)}return Uv(t,e,[...r,s])},set(a,s,c){Qh(i);const[l,d]=bp(c);return r0(t,e,{type:"SET",path:[...r,s].map(u=>u.toString()),value:l},d).then(iu)},apply(a,s,c){Qh(i);const l=r[r.length-1];if(l===ER)return r0(t,e,{type:"ENDPOINT"}).then(iu);if(l==="bind")return Uv(t,e,r.slice(0,-1));const[d,u]=zx(c);return r0(t,e,{type:"APPLY",path:r.map(f=>f.toString()),argumentList:d},u).then(iu)},construct(a,s){Qh(i);const[c,l]=zx(s);return r0(t,e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:c},l).then(iu)}});return OR(o,t),o}function RR(t){return Array.prototype.concat.apply([],t)}function zx(t){const e=t.map(bp);return[e.map(r=>r[0]),RR(e.map(r=>r[1]))]}const CE=new WeakMap;function AR(t,e){return CE.set(t,e),t}function xE(t){return Object.assign(t,{[gE]:!0})}function bp(t){for(const[e,r]of vE)if(r.canHandle(t)){const[n,i]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:t},CE.get(t)||[]]}function iu(t){switch(t.type){case"HANDLER":return vE.get(t.name).deserialize(t.value);case"RAW":return t.value}}function r0(t,e,r,n){return new Promise(i=>{const o=LR();e.set(o,i),t.start&&t.start(),t.postMessage(Object.assign({id:o},r),n)})}function LR(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function cn(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}class g5{constructor(e){this.numRequests={[Jt.Interaction]:0,[Jt.Thumbnail]:0,[Jt.Prefetch]:0,[Jt.Compute]:0},this.id=e||cn(),this.requestPool={[Jt.Interaction]:{0:[]},[Jt.Thumbnail]:{0:[]},[Jt.Prefetch]:{0:[]},[Jt.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[Jt.Interaction]:0,[Jt.Thumbnail]:0,[Jt.Prefetch]:0,[Jt.Compute]:0},this.maxNumRequests={[Jt.Interaction]:6,[Jt.Thumbnail]:6,[Jt.Prefetch]:5,[Jt.Compute]:1e3}}setMaxSimultaneousRequests(e,r){this.maxNumRequests[e]=r}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,r,n,i=0){const o={requestFn:e,type:r,additionalDetails:n};this.requestPool[r][i]===void 0&&(this.requestPool[r][i]=[]),this.requestPool[r][i].push(o),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(r=>{const n=this.requestPool[r];Object.keys(n).forEach(i=>{n[i]=n[i].filter(o=>e(o))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const r=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let i=0;i<r;i++){const o=this.getNextRequest(e);if(o===null)return!1;if(o){this.numRequests[e]++,this.awake=!0;let a;try{a=o.requestFn()}catch(s){console.warn("sendRequest failed",s)}a?.finally?a.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const r=this.getSortedPriorityGroups(e);for(const n of r)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(Jt.Interaction),r=this.sendRequests(Jt.Thumbnail),n=this.sendRequests(Jt.Prefetch),i=this.sendRequests(Jt.Compute);!e&&!r&&!n&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(n=>this.requestPool[e][n].length).sort((n,i)=>n-i)}getRequestPool(){return this.requestPool}}class SE{constructor(){this.workerRegistry={},this.workerPoolManager=new g5("webworker")}registerWorker(e,r,n={}){const{maxWorkerInstances:i=1,overwrite:o=!1,autoTerminateOnIdle:a={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!o){console.warn(`Worker type '${e}' is already registered...`);return}o&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:a.enabled,idleCheckIntervalId:null,idleTimeThreshold:a.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let c=0;c<i;c++){const l=r();s.instances.push(Fv(l)),s.nativeWorkers.push(l),s.workerFn=r}this.workerRegistry[e]=s}getNextWorkerAPI(e){const r=this.workerRegistry[e];if(!r)return console.error(`Worker type '${e}' is not registered.`),null;const n=r.instances.filter(a=>a!==null);let i=0,o=r.loadCounters[0]||0;for(let a=1;a<n.length;a++){const s=r.loadCounters[a]||0;s<o&&(i=a,o=s)}if(r.instances[i]===null){const a=r.workerFn();r.instances[i]=Fv(a),r.nativeWorkers[i]=a}return r.loadCounters[i]+=1,{api:r.instances[i],index:i}}executeTask(e,r,n={},{requestType:i=Jt.Compute,priority:o=0,options:a={},callbacks:s=[]}={}){return new Promise((c,l)=>{const d=async()=>{const{api:u,index:f}=this.getNextWorkerAPI(e);if(!u){const h=new Error(`No available worker instance for '${e}'`);console.error(h),l(h);return}try{let h=[];s.length&&(h=s.map(v=>xE(v)));const g=this.workerRegistry[e];g.processing=!0;const p=await u[r](n,...h);g.processing=!1,g.lastActiveTime[f]=Date.now(),g.autoTerminateOnIdle&&!g.idleCheckIntervalId&&g.idleTimeThreshold&&(g.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,g.idleTimeThreshold)},g.idleTimeThreshold)),c(p)}catch(h){console.error(`Error executing method '${r}' on worker '${e}':`,h),l(h)}finally{this.workerRegistry[e].loadCounters[f]--}};this.workerPoolManager.addRequest(d,i,a,o)})}terminateIdleWorkers(e,r){const n=this.workerRegistry[e];if(n.processing)return;const i=Date.now();n.instances.forEach((o,a)=>{const s=n.lastActiveTime[a],c=s!==null&&n.loadCounters[a]>0,l=i-s;!c&&l>r&&this.terminateWorkerInstance(e,a)})}terminate(e){const r=this.workerRegistry[e];if(!r){console.error(`Worker type '${e}' is not registered.`);return}r.instances.forEach((n,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,r){const n=this.workerRegistry[e],i=n.instances[r];i!==null&&(i[pE](),n.nativeWorkers[r].terminate(),n.instances[r]=null,n.lastActiveTime[r]=null)}}const Xm=4,NR=5,VR=1,jx=[1,1];function Hx({ext:t,filterType:e,texData:r,internalFormat:n,glDataType:i}){try{const o=document.createElement("canvas");o.width=Xm,o.height=Xm;const a=o.getContext("webgl2");if(!a)return!1;const s=`#version 300 es
    void main() {
      gl_PointSize = ${Xm.toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,c=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `;let l;if(t&&(l=a.getExtension(t),!l))return!1;const d=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(d,s),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))return!1;const u=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(u,c),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))return!1;const f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,u),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))return!1;const h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,n(a,l),NR,VR,0,a.RED,i(a,l),r);const g=e==="LINEAR"?a.LINEAR:a.NEAREST;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,g),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,g),a.useProgram(f),a.drawArrays(a.POINTS,0,1);const p=new Uint8Array(4);a.readPixels(jx[0],jx[1],1,1,a.RGBA,a.UNSIGNED_BYTE,p);const[v,w,m]=p,y=a.getExtension("WEBGL_lose_context");return y&&y.loseContext(),v===w&&w===m&&v!==0}catch{return!1}}function kR(){const t=new Int16Array([32767,2e3,3e3,4e3,5e3,16784,7e3,8e3,9e3,32767]);return{norm16:Hx({ext:"EXT_texture_norm16",filterType:"NEAREST",texData:t,internalFormat:(e,r)=>r.R16_SNORM_EXT,glDataType:e=>e.SHORT}),norm16Linear:Hx({ext:"EXT_texture_norm16",filterType:"LINEAR",texData:t,internalFormat:(e,r)=>r.R16_SNORM_EXT,glDataType:e=>e.SHORT})}}let Hd=!1;const Bv={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useLegacyCameraFOV:!1,strictZSpacingForVolumeViewport:!0,renderingEngineMode:Tu.ContextPool,webGlContextCount:7,volumeRendering:{sampleDistanceMultiplier:1}},debug:{statsOverlay:!1},peerImport:t=>null};let Fs={...Bv,rendering:{...Bv.rendering}},df=null,TE=!1;function FR(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function UR(){const t=FR();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function BR(){const t=kR();return t.norm16&&t.norm16Linear}function _E(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function GR(t=Fs){return Hd||(TE=BR(),Fs=kr(Bv,t),Fs.isMobile&&(Fs.rendering.webGlContextCount=1),_E()&&(t.rendering?.preferSizeOverAccuracy?Fs.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),UR()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),Fs.rendering.useCPURendering=!0),Hd=!0,df||(df=new SE),Hd)}function WR(){return TE}function p5(){return!_E()}function ff(){return Fs.rendering.useCPURendering}function $R(){return Hd}function Qa(){return Fs}function cc(){return df||(df=new SE),df}async function zR(t){return Fs.peerImport(t)}class jR{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,r){const n=i=>{this.removeEventListener(e,n),r.call(this,i)};this.addEventListener(e,n)}addEventListener(e,r){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(r)===-1&&this.listeners[e].push(r)}addEventListenerDebounced(e,r,n){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[r]){const o=a=>{i[r]&&clearTimeout(i[r].timeoutId),i[r].timeoutId=setTimeout(()=>{r.call(this,a)},n)};i[r]={original:r,handle:o,timeoutId:null},this.addEventListener(e,o)}}removeEventListenerDebounced(e,r){if(this.debouncedListeners[e]?.[r]){const n=this.debouncedListeners[e][r];this.removeEventListener(e,n.handle),clearTimeout(n.timeoutId),delete this.debouncedListeners[e][r]}}removeEventListener(e,r){if(!this.listeners[e])return;const n=this.listeners[e],i=n.length;for(let o=0;o<i;o++)if(n[o]===r){n.splice(o,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const r=this.listeners[e.type].slice(),n=r.length;for(let i=0;i<n;i++)try{r[i].call(this,e)}catch(o){console.error(`error in event listener of type:  ${e.type}`,o)}return!e.defaultPrevented}}const Fe=new jR;function Ye(t=Fe,e,r=null){if(!e)throw new Error("Event type was not defined");const n=new CustomEvent(e,{detail:r,cancelable:!0});return t?.dispatchEvent(n)}var Ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function HR(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var Km,Xx;function XR(){return Xx||(Xx=1,Km=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(i=n;i--!==0;)if(!t(e[i],r[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;i--!==0;){var a=o[i];if(!t(e[a],r[a]))return!1}return!0}return e!==e&&r!==r}),Km}var KR=XR();const m5=wa(KR);var qm,Kx;function EE(){if(Kx)return qm;Kx=1;var t=Object.prototype.toString;return qm=function(r){var n=t.call(r),i=n==="[object Arguments]";return i||(i=n!=="[object Array]"&&r!==null&&typeof r=="object"&&typeof r.length=="number"&&r.length>=0&&t.call(r.callee)==="[object Function]"),i},qm}var Ym,qx;function qR(){if(qx)return Ym;qx=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=EE(),i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),a=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(f){var h=f.constructor;return h&&h.prototype===f},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=(function(){if(typeof window>"u")return!1;for(var f in window)try{if(!l["$"+f]&&e.call(window,f)&&window[f]!==null&&typeof window[f]=="object")try{c(window[f])}catch{return!0}}catch{return!0}return!1})(),u=function(f){if(typeof window>"u"||!d)return c(f);try{return c(f)}catch{return!1}};t=function(h){var g=h!==null&&typeof h=="object",p=r.call(h)==="[object Function]",v=n(h),w=g&&r.call(h)==="[object String]",m=[];if(!g&&!p&&!v)throw new TypeError("Object.keys called on a non-object");var y=a&&p;if(w&&h.length>0&&!e.call(h,0))for(var C=0;C<h.length;++C)m.push(String(C));if(v&&h.length>0)for(var x=0;x<h.length;++x)m.push(String(x));else for(var S in h)!(y&&S==="prototype")&&e.call(h,S)&&m.push(String(S));if(o)for(var T=u(h),_=0;_<s.length;++_)!(T&&s[_]==="constructor")&&e.call(h,s[_])&&m.push(s[_]);return m}}return Ym=t,Ym}var Jm,Yx;function YR(){if(Yx)return Jm;Yx=1;var t=Array.prototype.slice,e=EE(),r=Object.keys,n=r?function(a){return r(a)}:qR(),i=Object.keys;return n.shim=function(){if(Object.keys){var a=(function(){var s=Object.keys(arguments);return s&&s.length===arguments.length})(1,2);a||(Object.keys=function(c){return e(c)?i(t.call(c)):i(c)})}else Object.keys=n;return Object.keys||n},Jm=n,Jm}var Zm,Jx;function bE(){if(Jx)return Zm;Jx=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Zm=t,Zm}var Qm,Zx;function JR(){return Zx||(Zx=1,Qm=SyntaxError),Qm}var e2,Qx;function ZR(){return Qx||(Qx=1,e2=TypeError),e2}var t2,e3;function QR(){return e3||(e3=1,t2=Object.getOwnPropertyDescriptor),t2}var n2,t3;function eA(){if(t3)return n2;t3=1;var t=QR();if(t)try{t([],"length")}catch{t=null}return n2=t,n2}var r2,n3;function tA(){if(n3)return r2;n3=1;var t=bE(),e=JR(),r=ZR(),n=eA();return r2=function(o,a,s){if(!o||typeof o!="object"&&typeof o!="function")throw new r("`obj` must be an object or a function`");if(typeof a!="string"&&typeof a!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,f=!!n&&n(o,a);if(t)t(o,a,{configurable:d===null&&f?f.configurable:!d,enumerable:c===null&&f?f.enumerable:!c,value:s,writable:l===null&&f?f.writable:!l});else if(u||!c&&!l&&!d)o[a]=s;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},r2}var i2,r3;function nA(){if(r3)return i2;r3=1;var t=bE(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},i2=e,i2}var o2,i3;function DE(){if(i3)return o2;i3=1;var t=YR(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",r=Object.prototype.toString,n=Array.prototype.concat,i=tA(),o=function(l){return typeof l=="function"&&r.call(l)==="[object Function]"},a=nA()(),s=function(l,d,u,f){if(d in l){if(f===!0){if(l[d]===u)return}else if(!o(f)||!f())return}a?i(l,d,u,!0):i(l,d,u)},c=function(l,d){var u=arguments.length>2?arguments[2]:{},f=t(d);e&&(f=n.call(f,Object.getOwnPropertySymbols(d)));for(var h=0;h<f.length;h+=1)s(l,f[h],d[f[h]],u[f[h]])};return c.supportsDescriptors=!!a,o2=c,o2}var Md={exports:{}},o3;function IE(){return o3||(o3=1,typeof self<"u"?Md.exports=self:typeof window<"u"?Md.exports=window:Md.exports=Function("return this")()),Md.exports}var a2,a3;function ME(){if(a3)return a2;a3=1;var t=IE();return a2=function(){return typeof Ws!="object"||!Ws||Ws.Math!==Math||Ws.Array!==Array?t:Ws},a2}var s2,s3;function rA(){if(s3)return s2;s3=1;var t=DE(),e=ME();return s2=function(){var n=e();if(t.supportsDescriptors){var i=Object.getOwnPropertyDescriptor(n,"globalThis");(!i||i.configurable&&(i.enumerable||!i.writable||globalThis!==n))&&Object.defineProperty(n,"globalThis",{configurable:!0,enumerable:!1,value:n,writable:!0})}else(typeof globalThis!="object"||globalThis!==n)&&(n.globalThis=n);return n},s2}var c2,c3;function iA(){if(c3)return c2;c3=1;var t=DE(),e=IE(),r=ME(),n=rA(),i=r(),o=function(){return i};return t(o,{getPolyfill:r,implementation:e,shim:n}),c2=o,c2}var oA=iA();const aA=wa(oA),aa=aA(),OE={vtkObject:()=>null};function la(t){if(t==null||t.isA)return t;if(!t.vtkClass)return aa.console&&aa.console.error&&aa.console.error("Invalid VTK object"),null;const e=OE[t.vtkClass];if(!e)return aa.console&&aa.console.error&&aa.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const r={...t};Object.keys(r).forEach(i=>{r[i]&&typeof r[i]=="object"&&r[i].vtkClass&&(r[i]=la(r[i]))});const n=e(r);return n&&n.modified&&n.modified(),n}function sA(t,e){OE[t]=e}la.register=sA;class l2 extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let Gv=0;const PE=t=>{throw new Error(`Named parameter '${t}' is missing`)},RE=Symbol("void");function cA(){return Gv}const AE={};function ou(){}const lA=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];lA.forEach(t=>{AE[t]=ou});aa.console=console.hasOwnProperty("log")?console:AE;const cl={debug:ou,error:aa.console.error||ou,info:aa.console.info||ou,log:aa.console.log||ou,warn:aa.console.warn||ou};function LE(t,e){cl[t]&&(cl[t]=e||ou)}function NE(){cl.log(...arguments)}function VE(){cl.info(...arguments)}function Dp(){cl.debug(...arguments)}function dn(){cl.error(...arguments)}function A1(){cl.warn(...arguments)}const l3={};function kE(t){l3[t]||(cl.error(t),l3[t]=!0)}const di=Object.create(null);di.Float32Array=Float32Array;di.Float64Array=Float64Array;di.Uint8Array=Uint8Array;di.Int8Array=Int8Array;di.Uint16Array=Uint16Array;di.Int16Array=Int16Array;di.Uint32Array=Uint32Array;di.Int32Array=Int32Array;di.Uint8ClampedArray=Uint8ClampedArray;try{di.BigInt64Array=BigInt64Array,di.BigUint64Array=BigUint64Array}catch{}function Z0(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(di[t]||Float64Array)(...r)}function L1(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return(di[t]||Float64Array).from(...r)}function N1(t){return t.charAt(0).toUpperCase()+t.slice(1)}function wr(t){return N1(t[0]==="_"?t.slice(1):t)}function FE(t){return t.charAt(0).toLowerCase()+t.slice(1)}function UE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const n=["TB","GB","MB","KB"];let i=Number(t),o="B";for(;i>r;)i/=r,o=n.pop();return`${i.toFixed(e)} ${o}`}function BE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const r=[];let n=t;for(;n>1e3;)r.push(`000${n%1e3}`.slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function GE(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function uA(t){return Object.values(di).some(e=>t instanceof e)}function dA(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function fA(t,e){return Object.keys(t).find(r=>t[r]===e)}function WE(t){return t&&t.isA?t.getState():t}function v5(t){setTimeout(t,0)}function $E(t,e){const r=performance.now();t.finally(()=>{const n=performance.now()-r;e(n)})}function Jn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};GE(e);const r=[];if(Number.isInteger(e.mtime)||(e.mtime=++Gv),!("classHierarchy"in e))e.classHierarchy=new l2("vtkObject");else if(!(e.classHierarchy instanceof l2)){const o=new l2;for(let a=0;a<e.classHierarchy.length;a++)o.push(e.classHierarchy[a]);e.classHierarchy=o}function n(o){r[o]=null}function i(o){function a(){n(o)}return Object.freeze({unsubscribe:a})}return t.isDeleted=()=>!!e.deleted,t.modified=o=>{if(e.deleted){dn("instance deleted - cannot call any method");return}o&&o<t.getMTime()||(e.mtime=++Gv,r.forEach(a=>a&&a(t)))},t.onModified=o=>{if(e.deleted)return dn("instance deleted - cannot call any method"),null;const a=r.length;return r.push(o),i(a)},t.getMTime=()=>e.mtime,t.isA=o=>{let a=e.classHierarchy.length;for(;a--;)if(e.classHierarchy[a]===o)return!0;return!1},t.getClassName=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-o]},t.set=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(o).forEach(l=>{const d=s?null:t[`set${N1(l)}`];d&&Array.isArray(o[l])&&d.length>1?c=d(...o[l])||c:d?c=d(o[l])||c:(["mtime"].indexOf(l)===-1&&!a&&A1(`Warning: Set value to model directly ${l}, ${o[l]}`),c=e[l]!==o[l]||c,e[l]=o[l])}),c},t.get=function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];if(!a.length)return e;const c={};return a.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=o=>e[o],t.delete=()=>{Object.keys(e).forEach(o=>delete e[o]),r.forEach((o,a)=>n(a)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const o={...e,vtkClass:t.getClassName()};Object.keys(o).forEach(s=>{o[s]===null||o[s]===void 0||s[0]==="_"?delete o[s]:o[s].isA?o[s]=o[s].getState():Array.isArray(o[s])?o[s]=o[s].map(WE):uA(o[s])&&(o[s]=Array.from(o[s]))});const a={};return Object.keys(o).sort().forEach(s=>{a[s]=o[s]}),a.mtime&&delete a.mtime,a},t.shallowCopy=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(o.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${o.getClassName()} into ${t.getClassName()}`);const s=o.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(d=>{const u=c.indexOf(d);u===-1?a&&Dp(`add ${d} in shallowCopy`):c.splice(u,1),e[d]=s[d]}),c.length&&a&&Dp(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const hA={object(t,e,r){return function(){return{...e[r.name]}}}};function ji(t,e,r){r.forEach(n=>{if(typeof n=="object"){const i=hA[n.type];i?t[`get${wr(n.name)}`]=i(t,e,n):t[`get${wr(n.name)}`]=()=>e[n.name]}else t[`get${wr(n)}`]=()=>e[n]})}const zE={enum(t,e,r){const n=`_on${wr(r.name)}Changed`;return i=>{if(typeof i=="string"){if(r.enum[i]!==void 0)return e[r.name]!==r.enum[i]?(e[r.name]=r.enum[i],t.modified(),!0):!1;throw dn(`Set Enum with invalid argument ${r}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[r.name]!==i){if(Object.keys(r.enum).map(o=>r.enum[o]).indexOf(i)!==-1){const o=e[r.name];return e[r.name]=i,e[n]?.(t,e,i,o),t.modified(),!0}throw dn(`Set Enum outside numeric range ${r}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw dn(`Set Enum with invalid argument (String/Number) ${r}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,r){r.params?.length===1&&A1('Setter of type "object" with a single "param" field is not supported');const n=`_on${wr(r.name)}Changed`;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];let s;if(o.length>1&&r.params?.length?s=r.params.reduce((c,l,d)=>Object.assign(c,{[l]:o[d]}),{}):s=o[0],!m5(e[r.name],s)){const c=e[r.name];return e[r.name]=s,e[n]?.(t,e,s,c),t.modified(),!0}return!1}}};function u3(t){if(typeof t=="object"){const e=zE[t.type];if(e)return(r,n)=>e(r,n,t);throw dn(`No setter for field ${t}`),new TypeError("No setter for field")}return function(r,n){const i=`_on${wr(t)}Changed`;return function(a){if(n.deleted)return dn("instance deleted - cannot call any method"),!1;if(n[t]!==a){const s=n[t.name];return n[t]=a,n[i]?.(r,n,a,s),r.modified(),!0}return!1}}}function xh(t,e,r){r.forEach(n=>{typeof n=="object"?t[`set${wr(n.name)}`]=u3(n)(t,e):t[`set${wr(n)}`]=u3(n)(t,e)})}function Ur(t,e,r){ji(t,e,r),xh(t,e,r)}function Q0(t,e,r){r.forEach(n=>{t[`get${wr(n)}`]=()=>e[n]?Array.from(e[n]):e[n],t[`get${wr(n)}ByReference`]=()=>e[n]})}function y5(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(o=>{if(e[o]&&n&&e[o].length!==n)throw new RangeError(`Invalid initial number of values for array (${o})`);const a=`_on${wr(o)}Changed`;t[`set${wr(o)}`]=function(){if(e.deleted)return dn("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let d=c,u,f=!1;if(d.length===1&&(d[0]==null||d[0].length>=0)&&(d=d[0],f=!0),d==null)u=e[o]!==d;else{if(n&&d.length!==n)if(d.length<n&&i!==void 0)for(d=Array.from(d),f=!1;d.length<n;)d.push(i);else throw new RangeError(`Invalid number of values for array setter (${o})`);u=e[o]==null||e[o].length!==d.length;for(let h=0;!u&&h<d.length;++h)u=e[o][h]!==d[h];u&&f&&(d=Array.from(d))}if(u){const h=e[o.name];e[o]=d,e[a]?.(t,e,d,h),t.modified()}return u},t[`set${wr(o)}From`]=s=>{const c=e[o];s.forEach((l,d)=>{c[d]=l})}})}function w5(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Q0(t,e,r),y5(t,e,r,n,i)}function Sh(t,e,r){for(let n=0;n<r.length;n++){const i=r[n];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function C5(t,e,r,n){e.inputData?e.inputData=e.inputData.map(la):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(la):e.inputConnection=[],e.output?e.output=e.output.map(la):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(la):e.inputArrayToProcess=[],e.numberOfInputs=r;function i(h){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){dn("instance deleted - cannot call any method");return}if(g>=e.numberOfInputs){dn(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[g]!==h||e.inputConnection[g])&&(e.inputData[g]=h,e.inputConnection[g]=null,t.modified&&t.modified())}function o(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]&&(e.inputData[h]=e.inputConnection[h]()),e.inputData[h]}function a(h){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){dn("instance deleted - cannot call any method");return}if(g>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",dn(p);return}e.inputData[g]=null,e.inputConnection[g]=h}function s(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]}function c(){let h=e.numberOfInputs;for(;h&&!e.inputData[h-1]&&!e.inputConnection[h-1];)h--;return h===e.numberOfInputs&&e.numberOfInputs++,h}function l(h){if(e.deleted){dn("instance deleted - cannot call any method");return}a(h,c())}function d(h){if(e.deleted){dn("instance deleted - cannot call any method");return}i(h,c())}function u(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(dn("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[h])}t.shouldUpdate=()=>{const h=t.getMTime();let g=1/0,p=n;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const v=e.output[p].getMTime();if(v<h)return!0;v<g&&(g=v)}for(p=e.numberOfInputs;p--;)if(e.inputConnection[p]?.filter.shouldUpdate()||t.getInputData(p)?.getMTime()>g)return!0;return!1};function f(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const g=()=>u(h);return g.filter=t,g}if(e.numberOfInputs){let h=e.numberOfInputs;for(;h--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=a,t.addInputData=d,t.addInputConnection=l,t.getInputData=o,t.getInputConnection=s}n&&(t.getOutputData=u,t.getOutputPort=f),t.update=()=>{const h=[];if(e.numberOfInputs){let g=0;for(;g<e.numberOfInputs;)h[g]=t.getInputData(g),g++}t.requestData&&!t.isDeleted()&&t.shouldUpdate()&&t.requestData(h,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>n||e.output.length,t.getInputArrayToProcess=h=>{const g=e.inputArrayToProcess[h],p=e.inputData[h];return g&&p?p[`get${g.fieldAssociation}`]().getArray(g.arrayName):null},t.setInputArrayToProcess=function(h,g,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<h;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[h]={arrayName:g,fieldAssociation:p,attributeType:v}}}const x5=Symbol("Event abort");function jE(t,e,r){const n=[],i=t.delete;let o=1;function a(l){for(let d=0;d<n.length;++d){const[u]=n[d];if(u===l){n.splice(d,1);return}}}function s(l){function d(){a(l)}return Object.freeze({unsubscribe:d})}function c(){if(e.deleted){dn("instance deleted - cannot call any method");return}const l=n.slice();for(let d=0;d<l.length;++d){const[,u,f]=l[d];if(u){if(f<0)setTimeout(()=>u.apply(t,arguments),1-f);else if(u.apply(t,arguments)===x5)break}}}t[`invoke${wr(r)}`]=c,t[`on${wr(r)}`]=function(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${r}`),null;if(e.deleted)return dn("instance deleted - cannot call any method"),null;const u=o++;return n.push([u,l,d]),n.sort((f,h)=>h[2]-f[2]),s(u)},t.delete=()=>{i(),n.forEach(l=>{let[d]=l;return a(d)})}}function zn(t,e){const r=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},o={};return t(o,i,n),Object.freeze(o)};return e&&la.register(e,r),r}function Th(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e.filter(a=>!!a).map(a=>a(...i))}}function S5(t){return t&&t.isA&&t.isA("vtkObject")}function Ip(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(S5(t)){if(n.indexOf(t)>=0)return r;n.push(t);const i=e(t);i!==void 0&&r.push(i);const o=t.get();Object.keys(o).forEach(a=>{const s=o[a];Array.isArray(s)?s.forEach(c=>{Ip(c,e,r,n)}):Ip(s,e,r,n)})}return r}function HE(t,e,r){var n=this;let i;const o=function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];const l=n,d=()=>{i=null,r||t.apply(l,s)},u=r&&!i;clearTimeout(i),i=setTimeout(d,e),u&&t.apply(l,s)};return o.cancel=()=>clearTimeout(i),o}function XE(t,e){let r=!1,n=null;function i(){r=!1,n!==null&&(o(...n),n=null)}function o(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];if(r){n=s;return}r=!0,t(...s),setTimeout(i,e)}return o}function T5(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=(n,i)=>{e.keystore[n]=i},t.getKey=n=>e.keystore[n],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=n=>delete e.keystore[n],t.clearKeystore=()=>t.getAllKeys().forEach(n=>delete e.keystore[n])}let gA=1;const eg="__root__";function KE(t,e){T5(t,e);const r=t.delete;e.proxyId=`${gA++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),ji(t,e,["proxyId","proxyGroup","proxyName"]),Ur(t,e,["proxyManager"]);const n={},i={};function o(l,d){i[d]||(i[d]=[]);const u=i[d];for(let f=0;f<l.length;f++)u.push(l[f].name),n[l[f].name]=l[f],l[f].children&&l[f].children.length&&o(l[f].children,l[f].name)}o(e.ui,eg),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(n).forEach(d=>delete n[d]),Object.keys(i).forEach(d=>delete i[d]),o(e.ui,eg),t.modified()};function a(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eg;return i[l]}t.updateProxyProperty=(l,d)=>{const u=n[l];u?Object.assign(u,d):n[l]={...d}},t.activate=()=>{if(e.proxyManager){const l=`setActive${wr(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,d)=>{d in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[d]=[]),e.propertyLinkSubscribers[d].push(l)},t.gcPropertyLinks=l=>{const d=e.propertyLinkSubscribers[l]||[];for(;d.length;)d.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const f=[];let h=0,g=!1;function p(C){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(g)return null;const S=[];let T=null;for(h=f.length;h--;){const E=f[h];E.instance===C?T=E:S.push(E)}if(!T)return null;const _=T.instance[`get${wr(T.propertyName)}`]();if(!dA(_,u)||x){for(u=_,g=!0;S.length;){const E=S.pop();E.instance.set({[E.propertyName]:u})}g=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=_),_}function v(C,x){const S=[];for(h=f.length;h--;){const T=f[h];T.instance===C&&(T.propertyName===x||x===void 0)&&(T.subscription.unsubscribe(),S.push(h))}for(;S.length;)f.splice(S.pop(),1)}function w(C,x){let S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const T=C.onModified(p),_=f[0];return f.push({instance:C,propertyName:x,subscription:T}),S&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?C.set({[x]:e.propertyLinkMap[l].value}):_&&p(_.instance,!0)),{unsubscribe:()=>v(C,x)}}function m(){for(;f.length;)f.pop().subscription.unsubscribe()}const y={bind:w,unbind:v,unsubscribe:m,persistent:d};return e.propertyLinkMap[l]=y,y};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eg;const d=[],u=e.proxyId,f=a(l)||[];for(let h=0;h<f.length;h++){const g=f[h],p=t[`get${wr(g)}`],v=p?p():void 0,w={id:u,name:g,value:v},m=s(g);m.length&&(w.children=m),d.push(w)}return d}t.listPropertyNames=()=>s().map(l=>l.name),t.getPropertyByName=l=>s().find(d=>d.name===l),t.getPropertyDomainByName=l=>(n[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let d=l.length;for(;d--;)e.propertyLinkMap[l[d]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:d,property:u,persistent:f,updateOnBind:h,type:g}=e.links[l];if(g==="application"){const p=e.proxyManager.getPropertyLink(d,f);t.registerPropertyLinkForGC(p,"application"),p.bind(t,u,h)}}}v5(c)}function qE(t,e,r){const n=t.delete,i=[],o=Object.keys(r);let a=o.length;for(;a--;){const s=o[a],{modelKey:c,property:l,modified:d=!0}=r[s],u=wr(l),f=wr(s);t[`get${f}`]=e[c][`get${u}`],t[`set${f}`]=e[c][`set${u}`],d&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();n()}}function YE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let l=c.length;for(;l--;){const d=c[l];e[d].set(s[d])}}const o=Object.keys(n);let a=o.length;for(;a--;){const s=o[a];e[s]=n[s];const c=r[s];t[`set${wr(s)}`]=l=>{if(l!==e[s]){e[s]=l;const d=c[l];i(d),t.modified()}}}o.length&&ji(t,e,o)}const d3=10,f3=40,h3=800;function JE(t){let e=0,r=0,n=0,i=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*d3,i=r*d3,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||i)&&t.deltaMode&&(t.deltaMode===1?(n*=f3,i*=f3):(n*=h3,i*=h3)),n&&!e&&(e=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:e,spinY:r||e,pixelX:n,pixelY:i||n}}var Z={algo:C5,capitalize:N1,chain:Th,debounce:HE,enumToString:fA,event:jE,EVENT_ABORT:x5,formatBytesToProperUnit:UE,formatNumbersWithThousandSeparator:BE,get:ji,getArray:Q0,getCurrentGlobalMTime:cA,getStateArrayMapFunc:WE,isVtkObject:S5,keystore:T5,measurePromiseExecution:$E,moveToProtected:Sh,newInstance:zn,newTypedArray:Z0,newTypedArrayFrom:L1,normalizeWheel:JE,obj:Jn,proxy:KE,proxyPropertyMapping:qE,proxyPropertyState:YE,safeArrays:GE,set:xh,setArray:y5,setGet:Ur,setGetArray:w5,setImmediate:v5,setLoggerFunction:LE,throttle:XE,traverseInstanceTree:Ip,TYPED_ARRAYS:di,uncapitalize:FE,VOID:RE,vtkDebugMacro:Dp,vtkErrorMacro:dn,vtkInfoMacro:VE,vtkLogMacro:NE,vtkOnceErrorMacro:kE,vtkWarningMacro:A1,objectSetterMap:zE,requiredParam:PE},Oi=Object.freeze({__proto__:null,requiredParam:PE,VOID:RE,setLoggerFunction:LE,vtkLogMacro:NE,vtkInfoMacro:VE,vtkDebugMacro:Dp,vtkErrorMacro:dn,vtkWarningMacro:A1,vtkOnceErrorMacro:kE,TYPED_ARRAYS:di,newTypedArray:Z0,newTypedArrayFrom:L1,capitalize:N1,_capitalize:wr,uncapitalize:FE,formatBytesToProperUnit:UE,formatNumbersWithThousandSeparator:BE,setImmediateVTK:v5,measurePromiseExecution:$E,obj:Jn,get:ji,set:xh,setGet:Ur,getArray:Q0,setArray:y5,setGetArray:w5,moveToProtected:Sh,algo:C5,EVENT_ABORT:x5,event:jE,newInstance:zn,chain:Th,isVtkObject:S5,traverseInstanceTree:Ip,debounce:HE,throttle:XE,keystore:T5,proxy:KE,proxyPropertyMapping:qE,proxyPropertyState:YE,normalizeWheel:JE,default:Z}),$g={exports:{}},pA=$g.exports,g3;function mA(){return g3||(g3=1,(function(t){(function(e,r,n){function i(c){var l=this,d=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=d(" "),l.s1=d(" "),l.s2=d(" "),l.s0-=d(c),l.s0<0&&(l.s0+=1),l.s1-=d(c),l.s1<0&&(l.s1+=1),l.s2-=d(c),l.s2<0&&(l.s2+=1),d=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function a(c,l){var d=new i(c),u=l&&l.state,f=d.next;return f.int32=function(){return d.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,u&&(typeof u=="object"&&o(u,d),f.state=function(){return o(d,{})}),f}function s(){var c=4022871197,l=function(d){d=String(d);for(var u=0;u<d.length;u++){c+=d.charCodeAt(u);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}r&&r.exports?r.exports=a:this.alea=a})(pA,t)})($g)),$g.exports}var zg={exports:{}},vA=zg.exports,p3;function yA(){return p3||(p3=1,(function(t){(function(e,r,n){function i(s){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},s===(s|0)?c.x=s:l+=s;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function a(s,c){var l=new i(s),d=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var f=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(typeof d=="object"&&o(d,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xor128=a})(vA,t)})(zg)),zg.exports}var jg={exports:{}},wA=jg.exports,m3;function CA(){return m3||(m3=1,(function(t){(function(e,r,n){function i(s){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:l+=s;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,d==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function a(s,c){var l=new i(s),d=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var f=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(typeof d=="object"&&o(d,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xorwow=a})(wA,t)})(jg)),jg.exports}var Hg={exports:{}},xA=Hg.exports,v3;function SA(){return v3||(v3=1,(function(t){(function(e,r,n){function i(s){var c=this;c.next=function(){var d=c.x,u=c.i,f,h;return f=d[u],f^=f>>>7,h=f^f<<24,f=d[u+1&7],h^=f^f>>>10,f=d[u+3&7],h^=f^f>>>3,f=d[u+4&7],h^=f^f<<7,f=d[u+7&7],f=f^f<<13,h^=f^f<<9,d[u]=h,c.i=u+1&7,h};function l(d,u){var f,h=[];if(u===(u|0))h[0]=u;else for(u=""+u,f=0;f<u.length;++f)h[f&7]=h[f&7]<<15^u.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],d.x=h,d.i=0,f=256;f>0;--f)d.next()}l(c,s)}function o(s,c){return c.x=s.x.slice(),c.i=s.i,c}function a(s,c){s==null&&(s=+new Date);var l=new i(s),d=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var f=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(d.x&&o(d,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xorshift7=a})(xA,t)})(Hg)),Hg.exports}var Xg={exports:{}},TA=Xg.exports,y3;function _A(){return y3||(y3=1,(function(t){(function(e,r,n){function i(s){var c=this;c.next=function(){var d=c.w,u=c.X,f=c.i,h,g;return c.w=d=d+1640531527|0,g=u[f+34&127],h=u[f=f+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=u[f]=g^h,c.i=f,g+(d^d>>>16)|0};function l(d,u){var f,h,g,p,v,w=[],m=128;for(u===(u|0)?(h=u,u=null):(u=u+"\0",h=0,m=Math.max(m,u.length)),g=0,p=-32;p<m;++p)u&&(h^=u.charCodeAt((p+32)%u.length)),p===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(v=v+1640531527|0,f=w[p&127]^=h+v,g=f==0?g+1:0);for(g>=128&&(w[(u&&u.length||0)&127]=-1),g=127,p=512;p>0;--p)h=w[g+34&127],f=w[g=g+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,w[g]=h^f;d.w=v,d.X=w,d.i=g}l(c,s)}function o(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function a(s,c){s==null&&(s=+new Date);var l=new i(s),d=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var f=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(d.X&&o(d,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.xor4096=a})(TA,t)})(Xg)),Xg.exports}var Kg={exports:{}},EA=Kg.exports,w3;function bA(){return w3||(w3=1,(function(t){(function(e,r,n){function i(s){var c=this,l="";c.next=function(){var u=c.b,f=c.c,h=c.d,g=c.a;return u=u<<25^u>>>7^f,f=f-h|0,h=h<<24^h>>>8^g,g=g-u|0,c.b=u=u<<20^u>>>12^f,c.c=f=f-h|0,c.d=h<<16^f>>>16^g,c.a=g-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):l+=s;for(var d=0;d<l.length+20;d++)c.b^=l.charCodeAt(d)|0,c.next()}function o(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function a(s,c){var l=new i(s),d=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var f=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(typeof d=="object"&&o(d,l),u.state=function(){return o(l,{})}),u}r&&r.exports?r.exports=a:this.tychei=a})(EA,t)})(Kg)),Kg.exports}var qg={exports:{}};const DA={},IA=Object.freeze(Object.defineProperty({__proto__:null,default:DA},Symbol.toStringTag,{value:"Module"})),Zs=HR(IA);var MA=qg.exports,C3;function OA(){return C3||(C3=1,(function(t){(function(e,r,n){var i=256,o=6,a=52,s="random",c=n.pow(i,o),l=n.pow(2,a),d=l*2,u=i-1,f;function h(C,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var _=w(v(x.entropy?[C,y(r)]:C??m(),3),T),E=new g(T),D=function(){for(var b=E.g(o),I=c,O=0;b<l;)b=(b+O)*i,I*=i,O=E.g(1);for(;b>=d;)b/=2,I/=2,O>>>=1;return(b+O)/I};return D.int32=function(){return E.g(4)|0},D.quick=function(){return E.g(4)/4294967296},D.double=D,w(y(E.S),r),(x.pass||S||function(b,I,O,M){return M&&(M.S&&p(M,E),b.state=function(){return p(E,{})}),O?(n[s]=b,I):b})(D,_,"global"in x?x.global:this==n,x.state)}function g(C){var x,S=C.length,T=this,_=0,E=T.i=T.j=0,D=T.S=[];for(S||(C=[S++]);_<i;)D[_]=_++;for(_=0;_<i;_++)D[_]=D[E=u&E+C[_%S]+(x=D[_])],D[E]=x;(T.g=function(b){for(var I,O=0,M=T.i,R=T.j,A=T.S;b--;)I=A[M=u&M+1],O=O*i+A[u&(A[M]=A[R=u&R+I])+(A[R]=I)];return T.i=M,T.j=R,O})(i)}function p(C,x){return x.i=C.i,x.j=C.j,x.S=C.S.slice(),x}function v(C,x){var S=[],T=typeof C,_;if(x&&T=="object")for(_ in C)try{S.push(v(C[_],x-1))}catch{}return S.length?S:T=="string"?C:C+"\0"}function w(C,x){for(var S=C+"",T,_=0;_<S.length;)x[u&_]=u&(T^=x[u&_]*19)+S.charCodeAt(_++);return y(x)}function m(){try{var C;return f&&(C=f.randomBytes)?C=C(i):(C=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(C)),y(C)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,y(r)]}}function y(C){return String.fromCharCode.apply(0,C)}if(w(n.random(),r),t.exports){t.exports=h;try{f=Zs}catch{}}else n["seed"+s]=h})(typeof self<"u"?self:MA,[],Math)})(qg)),qg.exports}var u2,x3;function PA(){if(x3)return u2;x3=1;var t=mA(),e=yA(),r=CA(),n=SA(),i=_A(),o=bA(),a=OA();return a.alea=t,a.xor128=e,a.xorwow=r,a.xorshift7=n,a.xor4096=i,a.tychei=o,u2=a,u2}var RA=PA();const AA=wa(RA),_5=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],LA=[1,0,0,0,1,0,0,0,1],E5=1e-6,b5=1e-12,{vtkErrorMacro:ZE,vtkWarningMacro:_u}=Z;let QE=0;const S3=20;function _h(t){return()=>ZE(`vtkMath::${t} - NOT IMPLEMENTED`)}function hf(t,e,r,n){let i;for(let o=0;o<e;o++)i=t[r*e+o],t[r*e+o]=t[n*e+o],t[n*e+o]=i}function Xd(t,e,r,n){let i;for(let o=0;o<e;o++)i=t[o*e+r],t[o*e+r]=t[o*e+n],t[o*e+n]=i}function qn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let r=0;r<t;++r)e[r]=0;return e}const NA=()=>Math.PI;function VA(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function cr(t){return t/180*Math.PI}function Mp(t){return t*180/Math.PI}const{round:kA,floor:D5,ceil:FA,min:UA,max:BA}=Math;function GA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0;for(let i=e,o=t.length;i<o;i+=r)t[i]<n&&(n=t[i]);return n}function WA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=-1/0;for(let i=e,o=t.length;i<o;i+=r)n<t[i]&&(n=t[i]);return n}function $A(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,i=-1/0;for(let o=e,a=t.length;o<a;o+=r)t[o]<n&&(n=t[o]),i<t[o]&&(i=t[o]);return[n,i]}const zA=_h("ceilLog2"),jA=_h("factorial");function zc(t){let e=1;for(;e<t;)e*=2;return e}function Kd(t){return t===zc(t)}function HA(t,e){let r=1;for(let n=1;n<=e;++n)r*=(t-n+1)/n;return Math.floor(r)}function XA(t,e){if(t<e)return 0;const r=qn(e);for(let n=0;n<e;++n)r[n]=n;return r}function KA(t,e,r){let n=0;for(let i=e-1;i>=0;--i)if(r[i]<t-e+i){let o=r[i]+1;for(;i<e;)r[i++]=o++;n=1;break}return n}function qA(t){AA(`${t}`,{global:!0}),QE=t}function YA(){return QE}function JA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+r*Math.random()}const ZA=_h("gaussian");function R0(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Hr(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function e4(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function t4(t,e){return t[0]*=e,t[1]*=e,t}function Wv(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function QA(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function jt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function eL(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[0]*e[2],r[3]=t[1]*e[0],r[4]=t[1]*e[1],r[5]=t[1]*e[2],r[6]=t[2]*e[0],r[7]=t[2]*e[1],r[8]=t[2]*e[2]}function Bi(t,e,r){const n=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],o=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=i,r[2]=o,r}function go(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function wo(t){const e=go(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function tL(t){const e=go(t,3);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e),e}function nL(t,e,r,n){const i=t[0]*t[0],o=t[1]*t[1],a=t[2]*t[2],s=Math.sqrt(i+o+a);let c,l,d;i>o&&i>a?(c=0,l=1,d=2):o>a?(c=1,l=2,d=0):(c=2,l=0,d=1);const u=t[c]/s,f=t[l]/s,h=t[d]/s,g=Math.sqrt(u*u+h*h);if(n!==0){const p=Math.sin(n),v=Math.cos(n);e&&(e[c]=(h*v-u*f*p)/g,e[l]=p*g,e[d]=(-(u*v)-f*h*p)/g),r&&(r[c]=(-(h*p)-u*f*v)/g,r[l]=v*g,r[d]=(u*p-f*h*v)/g)}else e&&(e[c]=h/g,e[l]=0,e[d]=-u/g),r&&(r[c]=-u*f/g,r[l]=g,r[d]=-f*h/g)}function rL(t,e,r){const n=jt(e,e);if(n===0)return r[0]=0,r[1]=0,r[2]=0,!1;const i=jt(t,e)/n;for(let o=0;o<3;o++)r[o]=e[o];return e4(r,i),!0}function $v(t,e){return t[0]*e[0]+t[1]*e[1]}function iL(t,e,r){const n=$v(e,e);if(n===0)return r[0]=0,r[1]=0,!1;const i=$v(t,e)/n;for(let o=0;o<2;o++)r[o]=e[o];return t4(r,i),!0}function lo(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function oL(t,e){const r=[0,0,0];return Bi(t,e,r),Math.atan2(go(r),jt(t,e))}function aL(t,e,r){const n=Math.abs(t-r);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(n**2)/(2*e))}function sL(t,e,r){const n=Math.abs(t-r);return Math.exp(-(n**2)/(2*e))}function cL(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[1]*e[0],r[3]=t[1]*e[1]}function n4(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function lL(t){const e=n4(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function ur(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function uL(t,e){let r,n,i;const o=[0,0,0];for(let a=0;a<3;a++)i=Math.abs(t[a*3]),(n=Math.abs(t[a*3+1]))>i&&(i=n),(n=Math.abs(t[a*3+2]))>i&&(i=n),o[a]=1/i;i=o[0]*Math.abs(t[0]),r=0,(n=o[1]*Math.abs(t[3]))>=i&&(i=n,r=1),(n=o[2]*Math.abs(t[6]))>=i&&(r=2),r!==0&&(hf(t,3,r,0),o[r]=o[0]),e[0]=r,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=o[1]*Math.abs(t[4]),r=1,(n=o[2]*Math.abs(t[7]))>=i&&(r=2,hf(t,3,1,2),o[2]=o[1]),e[1]=r,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function dL(t,e,r){let n=r[e[0]];r[e[0]]=r[0],r[0]=n,n=r[e[1]],r[e[1]]=r[1],r[1]=n-t[3]*r[0],n=r[e[2]],r[e[2]]=r[2],r[2]=n-t[6]*r[0]-t[7]*r[1],r[2]/=t[8],r[1]=(r[1]-t[5]*r[2])/t[4],r[0]=(r[0]-t[1]*r[1]-t[2]*r[2])/t[0]}function fL(t,e,r){const n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],l=t[6],d=t[7],u=t[8],f=+ur(s,d,c,u),h=-ur(a,l,c,u),g=+ur(a,l,s,d),p=-ur(i,d,o,u),v=+ur(n,l,o,u),w=-ur(n,l,i,d),m=+ur(i,s,o,c),y=-ur(n,a,o,c),C=+ur(n,a,i,s),x=n*f+i*h+o*g,S=f*e[0]+p*e[1]+m*e[2],T=h*e[0]+v*e[1]+y*e[2],_=g*e[0]+w*e[1]+C*e[2];r[0]=S/x,r[1]=T/x,r[2]=_/x}function Yg(t,e,r){const n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],o=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];r[0]=n,r[1]=i,r[2]=o}function zv(t,e,r){const n=[...t],i=[...e];for(let o=0;o<3;o++)r[o]=n[0]*i[o]+n[1]*i[o+3]+n[2]*i[o+6],r[o+3]=n[3]*i[o]+n[4]*i[o+3]+n[5]*i[o+6],r[o+6]=n[6]*i[o]+n[7]*i[o+3]+n[8]*i[o+6]}function hL(t,e,r,n,i,o,a){n!==i&&ZE("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let l=0;l<r;l++)for(let d=0;d<o;d++){a[l*o+d]=0;for(let u=0;u<n;u++)a[l*o+d]+=s[l*n+u]*c[d+o*u]}}function x0(t,e){let r;r=t[3],e[3]=t[1],e[1]=r,r=t[6],e[6]=t[2],e[2]=r,r=t[7],e[7]=t[5],e[5]=r,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function gL(t,e){const r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],d=t[8],u=+ur(a,l,s,d),f=-ur(o,c,s,d),h=+ur(o,c,a,l),g=-ur(n,l,i,d),p=+ur(r,c,i,d),v=-ur(r,c,n,l),w=+ur(n,a,i,s),m=-ur(r,o,i,s),y=+ur(r,o,n,a),C=r*u+n*f+i*h;C===0&&_u("Matrix has 0 determinant"),e[0]=u/C,e[3]=f/C,e[6]=h/C,e[1]=g/C,e[4]=p/C,e[7]=v/C,e[2]=w/C,e[5]=m/C,e[8]=y/C}function V1(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function r4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:E5;if(t.length!==e.length)return!1;function n(i,o){return Math.abs(i-e[o])<=r}return t.every(n)}const A0=r4;function i4(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function o4(t,e){for(let r=0;r<t;r++){for(let n=0;n<t;n++)e[r*t+n]=0;e[r*t+r]=1}return e}function pL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E5;return A0(t,_5,e)}function mL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E5;return A0(t,LA,e)}function a4(t,e){const r=t[0]*t[0],n=t[0]*t[1],i=t[0]*t[2],o=t[0]*t[3],a=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],d=t[1]*t[3],u=t[2]*t[3],f=a+s+c;let h=1/(r+f);const g=(r-f)*h;h*=2,e[0]=a*h+g,e[3]=(l+o)*h,e[6]=(d-i)*h,e[1]=(l-o)*h,e[4]=s*h+g,e[7]=(u+n)*h,e[2]=(d+i)*h,e[5]=(u-n)*h,e[8]=c*h+g}function Jg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const r=`${t}`.split("e");let n="";return+r[1]+e>0&&(n="+"),+`${Math.round(`${+r[0]}e${n}${+r[1]+e}`)}e-${e}`}function jv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Jg(t[0],r),e[1]=Jg(t[1],r),e[2]=Jg(t[2],r),e}function Eh(t,e,r,n){let i,o,a,s,c,l,d,u,f,h,g,p,v,w,m,y;const C=qn(e),x=qn(e),S=(_,E,D)=>{w=_[E],v=_[D],_[E]=w-p*(v+w*h),_[D]=v+p*(w-v*h)};for(o4(e,n),c=0;c<e;c++)C[c]=r[c]=t[c+c*e],x[c]=0;for(i=0;i<S3;i++){for(g=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)g+=Math.abs(t[c*e+s]);if(g===0)break;for(i<3?d=.2*g/(e*e):d=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(w=100*Math.abs(t[c*e+s]),i>3&&Math.abs(r[c])+w===Math.abs(r[c])&&Math.abs(r[s])+w===Math.abs(r[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>d){for(v=r[s]-r[c],Math.abs(v)+w===Math.abs(v)?f=t[c*e+s]/v:(u=.5*v/t[c*e+s],f=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(f=-f)),m=1/Math.sqrt(1+f*f),p=f*m,h=p/(1+m),v=f*t[c*e+s],x[c]-=v,x[s]+=v,r[c]-=v,r[s]+=v,t[c*e+s]=0,o=0;o<=c-1;o++)S(t,o*e+c,o*e+s);for(o=c+1;o<=s-1;o++)S(t,c*e+o,o*e+s);for(o=s+1;o<e;o++)S(t,c*e+o,s*e+o);for(o=0;o<e;o++)S(n,o*e+c,o*e+s)}for(c=0;c<e;c++)C[c]+=x[c],r[c]=C[c],x[c]=0}if(i>=S3)return _u("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(o=0;o<e-1;o++){for(a=o,y=r[a],i=o+1;i<e;i++)(r[i]>=y||Math.abs(r[i]-y)<b5)&&(a=i,y=r[a]);a!==o&&(r[a]=r[o],r[o]=y,Xd(n,e,o,a))}const T=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)n[i]>=0&&l++;if(l<T)for(i=0;i<e;i++)n[i*e+o]*=-1;return 1}function s4(t,e){const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r[0]=t[0]+t[4]+t[8],r[5]=t[0]-t[4]-t[8],r[10]=-t[0]+t[4]-t[8],r[15]=-t[0]-t[4]+t[8],r[1]=r[4]=t[7]-t[5],r[2]=r[8]=t[2]-t[6],r[3]=r[12]=t[3]-t[1],r[6]=r[9]=t[3]+t[1],r[7]=r[13]=t[2]+t[6],r[11]=r[14]=t[7]+t[5];const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],o=[...r];Eh(o,4,i,n),e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12]}function vL(t,e,r){const n=t[0]*e[0],i=t[0]*e[1],o=t[0]*e[2],a=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],d=t[1]*e[3],u=t[2]*e[0],f=t[2]*e[1],h=t[2]*e[2],g=t[2]*e[3],p=t[3]*e[0],v=t[3]*e[1],w=t[3]*e[2],m=t[3]*e[3];r[0]=n-c-h-m,r[1]=i+s+g-w,r[2]=o-d+u+v,r[3]=a+l-f+p}function c4(t,e){for(let f=0;f<9;f++)e[f]=t[f];const r=qn(3),n=qn(3);let i;for(let f=0;f<3;f++){const h=Math.abs(e[f*3]),g=Math.abs(e[f*3+1]),p=Math.abs(e[f*3+2]);i=g>h?g:h,i=p>i?p:i,r[f]=1,i!==0&&(r[f]/=i)}const o=Math.abs(e[0])*r[0],a=Math.abs(e[3])*r[1],s=Math.abs(e[6])*r[2];n[0]=0,i=o,a>=i&&(i=a,n[0]=1),s>=i&&(n[0]=2),n[0]!==0&&(Xd(e,3,n[0],0),r[n[0]]=r[0]);const c=Math.abs(e[4])*r[1],l=Math.abs(e[7])*r[2];n[1]=1,i=c,l>=i&&(n[1]=2,Xd(e,3,1,2)),n[2]=2;let d=0;if(V1(e)<0){d=1;for(let f=0;f<9;f++)e[f]=-e[f]}const u=qn(4);if(s4(e,u),a4(u,e),d)for(let f=0;f<9;f++)e[f]=-e[f];n[1]!==1&&Xd(e,3,n[1],1),n[0]!==0&&Xd(e,3,n[0],0)}function l4(t,e,r){let n,i,o,a,s,c;const l=[...t];if(Eh(l,3,e,r),e[0]===e[1]&&e[0]===e[2]){i4(r);return}for(x0(r,r),n=0;n<3;n++)if(e[(n+1)%3]===e[(n+2)%3]){for(c=Math.abs(r[n*3]),a=0,i=1;i<3;i++)c<(s=Math.abs(r[n*3+i]))&&(c=s,a=i);a!==n&&(s=e[a],e[a]=e[n],e[n]=s,hf(r,3,n,a)),r[a*3+a]<0&&(r[a*3]=-r[a*3],r[a*3+1]=-r[a*3+1],r[a*3+2]=-r[a*3+2]),i=(a+1)%3,o=(a+2)%3,r[i*3]=0,r[i*3+1]=0,r[i*3+2]=0,r[i*3+i]=1;const d=Bi([r[a*3],r[a*3+1],r[a*3+2]],[r[i*3],r[i*3+1],r[i*3+2]],[]);wo(d);const u=Bi(d,[r[a*3],r[a*3+1],r[a*3+2]],[]);for(let f=0;f<3;f++)r[o*3+f]=d[f],r[i*3+f]=u[f];x0(r,r);return}for(c=Math.abs(r[0]),a=0,n=1;n<3;n++)c<(s=Math.abs(r[n*3]))&&(c=s,a=n);if(a!==0){const d=e[a];e[a]=e[0],e[0]=d,hf(r,3,a,0)}if(Math.abs(r[4])<Math.abs(r[7])){const d=e[2];e[2]=e[1],e[1]=d,hf(r,3,1,2)}for(n=0;n<2;n++)r[n*3+n]<0&&(r[n*3]=-r[n*3],r[n*3+1]=-r[n*3+1],r[n*3+2]=-r[n*3+2]);V1(r)<0&&(r[6]=-r[6],r[7]=-r[7],r[8]=-r[8]),x0(r,r)}function yL(t,e,r,n){let i;const o=[...t],a=V1(o);if(a<0)for(i=0;i<9;i++)o[i]=-o[i];c4(o,e),x0(o,o),zv(o,e,n),l4(n,r,n),zv(e,n,e),x0(n,n),a<0&&(r[0]=-r[0],r[1]=-r[1],r[2]=-r[2])}function I5(t,e,r){let n,i,o,a,s=0,c,l,d;const u=qn(r);for(n=0;n<r;n++){for(a=0,i=0;i<r;i++)(d=Math.abs(t[n*r+i]))>a&&(a=d);if(a===0)return _u("Unable to factor linear system"),0;u[n]=1/a}for(i=0;i<r;i++){for(n=0;n<i;n++){for(c=t[n*r+i],o=0;o<n;o++)c-=t[n*r+o]*t[o*r+i];t[n*r+i]=c}for(a=0,n=i;n<r;n++){for(c=t[n*r+i],o=0;o<i;o++)c-=t[n*r+o]*t[o*r+i];t[n*r+i]=c,(l=u[n]*Math.abs(c))>=a&&(a=l,s=n)}if(i!==s){for(o=0;o<r;o++)l=t[s*r+o],t[s*r+o]=t[i*r+o],t[i*r+o]=l;u[s]=u[i]}if(e[i]=s,Math.abs(t[i*r+i])<=b5)return _u("Unable to factor linear system"),0;if(i!==r-1)for(l=1/t[i*r+i],n=i+1;n<r;n++)t[n*r+i]*=l}return 1}function M5(t,e,r,n){let i,o,a,s,c;for(a=-1,i=0;i<n;i++){if(s=e[i],c=r[s],r[s]=r[i],a>=0)for(o=a;o<=i-1;o++)c-=t[i*n+o]*r[o];else c!==0&&(a=i);r[i]=c}for(i=n-1;i>=0;i--){for(c=r[i],o=i+1;o<n;o++)c-=t[i*n+o]*r[o];r[i]=c/t[i*n+i]}}function u4(t,e,r){if(r===2){const i=qn(2),o=ur(t[0],t[1],t[2],t[3]);return o===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/o,i[1]=(-(t[2]*e[0])+t[0]*e[1])/o,e[0]=i[0],e[1]=i[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);const n=qn(r);return I5(t,n,r)===0?0:(M5(t,n,e,r),1)}function O5(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const o=n||qn(r),a=i||qn(r);if(I5(t,o,r)===0)return null;for(let s=0;s<r;s++){for(let c=0;c<r;c++)a[c]=0;a[s]=1,M5(t,o,a,r);for(let c=0;c<r;c++)e[c*r+s]=a[c]}return e}function wL(t,e){let r=+Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let o=i;o<e;o++)Math.abs(t[i*e+o])>n&&(n=Math.abs(t[i*e+o]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<r&&(r=Math.abs(t[i*e+i]));return r===0?Number.MAX_VALUE:n/r}function CL(t,e,r){return Eh(t,3,e,r)}function Hv(t,e,r,n){if(t<r)return _u("Insufficient number of samples. Underdetermined."),0;let i,o,a;const s=qn(r*r),c=qn(r),l=qn(r*r);for(a=0;a<t;a++)for(i=0;i<r;i++)for(o=i;o<r;o++)s[i*r+o]+=e[a*r+i]*e[a*r+o];for(i=0;i<r;i++)for(o=0;o<i;o++)s[i*r+o]=s[o*r+i];for(Eh(s,r,c,l),i=0;i<r;i++)n[i]=l[i*r+r-1];return 1}function xL(t,e,r,n,i,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<r||t<i)return _u("Insufficient number of samples. Underdetermined."),0;const s=qn(i);let c=1,l,d=0,u,f,h,g=0;if(a){for(f=0;f<i;f++)s[f]=1;for(u=0;u<t;u++)for(f=0;f<i;f++)Math.abs(n[u*i+f])>b5&&(c=0,s[f]=0);if(c&&i===1)return _u("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Hv(t,e,r,o);if(c)g=1;else for(f=0;f<i;f++)s[f]&&(g=1)}g&&(l=qn(r),d=Hv(t,e,r,l));const p=qn(r*r),v=qn(r*r),w=qn(r*i);for(h=0;h<t;h++)for(u=0;u<r;u++){for(f=u;f<r;f++)p[u*r+f]+=e[h*r+u]*e[h*r+f];for(f=0;f<i;f++)w[u*i+f]+=e[h*r+u]*n[h*i+f]}for(u=0;u<r;u++)for(f=0;f<u;f++)p[u*r+f]=p[f*r+u];const m=O5(p,v,r);if(m)for(u=0;u<r;u++)for(f=0;f<i;f++)for(o[u*i+f]=0,h=0;h<r;h++)o[u*i+f]+=v[u*r+h]*w[h*i+f];if(g){for(f=0;f<i;f++)if(s[f])for(u=0;u<r;u++)o[u*i+f]=l[u*i]}return g?d&&m:m}function SL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function qd(t,e){let r,n;const[i,o,a]=t,s=1/3,c=1/6,l=2/3;let d=i,u=i;o>d?d=o:o<u&&(u=o),a>d?d=a:a<u&&(u=a);const f=d;f>0?n=(d-u)/d:n=0,n>0?(i===d?r=c*(o-a)/(d-u):o===d?r=s+c*(a-i)/(d-u):r=l+c*(i-o)/(d-u),r<0&&(r+=1)):r=0,e[0]=r,e[1]=n,e[2]=f}function au(t,e){const[r,n,i]=t,o=1/3,a=1/6,s=2/3,c=5/6;let l,d,u;r>a&&r<=o?(d=1,l=(o-r)/a,u=0):r>o&&r<=.5?(d=1,u=(r-o)/a,l=0):r>.5&&r<=s?(u=1,d=(s-r)/a,l=0):r>s&&r<=c?(u=1,l=(r-s)/a,d=0):r>c&&r<=1?(l=1,u=(1-r)/a,d=0):(l=1,d=r/a,u=0),l=n*l+(1-n),d=n*d+(1-n),u=n*u+(1-n),l*=i,d*=i,u*=i,e[0]=l,e[1]=d,e[2]=u}function d4(t,e){const[r,n,i]=t;let o=(r+16)/116,a=n/500+o,s=o-i/200;o**3>.008856?o**=3:o=(o-16/116)/7.787,a**3>.008856?a**=3:a=(a-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,l=1,d=1.089;e[0]=c*a,e[1]=l*o,e[2]=d*s}function f4(t,e){const[r,n,i]=t,o=.9505,a=1,s=1.089;let c=r/o,l=n/a,d=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,d>.008856?d**=1/3:d=7.787*d+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-d)}function h4(t,e){const[r,n,i]=t;let o=r*3.2406+n*-1.5372+i*-.4986,a=r*-.9689+n*1.8758+i*.0415,s=r*.0557+n*-.204+i*1.057;o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=o;c<a&&(c=a),c<s&&(c=s),c>1&&(o/=c,a/=c,s/=c),o<0&&(o=0),a<0&&(a=0),s<0&&(s=0),e[0]=o,e[1]=a,e[2]=s}function g4(t,e){let[r,n,i]=t;r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=r*.4124+n*.3576+i*.1805,e[1]=r*.2126+n*.7152+i*.0722,e[2]=r*.0193+n*.1192+i*.9505}function fu(t,e){const r=[0,0,0];g4(t,r),f4(r,e)}function Op(t,e){const r=[0,0,0];d4(t,r),h4(r,e)}function P5(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Zg(t){return!(t[1]-t[0]<0)}function TL(t,e,r){return r[0]=Math.min(t[0],e[0]),r[1]=Math.max(t[0],e[0]),r[2]=Math.min(t[1],e[1]),r[3]=Math.max(t[1],e[1]),r[4]=Math.min(t[2],e[2]),r[5]=Math.max(t[2],e[2]),r}function ua(t,e,r){return t<e?e:t>r?r:t}function Xv(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=ua(t[0],e[0],r[0]),n[1]=ua(t[1],e[1],r[1]),n[2]=ua(t[2],e[2],r[2]),n}function _L(t,e){let r=0;return e[0]!==e[1]&&(t<e[0]?r=e[0]:t>e[1]?r=e[1]:r=t,r=(r-e[0])/(e[1]-e[0])),r}const EL=_h("GetScalarTypeFittingRange"),bL=_h("GetAdjustedScalarRange");function DL(t,e){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]<e[r]||t[r]>e[r+1]||t[r+1]<e[r]||t[r+1]>e[r+1])return 0;return 1}function IL(t,e,r){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]+r[n/2]<e[n]||t[n]-r[n/2]>e[n+1]||t[n+1]+r[n/2]<e[n]||t[n+1]-r[n/2]>e[n+1])return 0;return 1}function ML(t,e,r){if(!t||!e||!r)return 0;for(let n=0;n<3;n++)if(t[n]+r[n]<e[2*n]||t[n]-r[n]>e[2*n+1])return 0;return 1}function OL(t,e,r,n){const i=qn(3),o=qn(3),a=qn(3),s=qn(3),c=qn(3),l=qn(3);for(let C=0;C<3;++C)i[C]=t[C]-e[C],o[C]=e[C]-r[C],a[C]=r[C]-t[C],s[C]=-i[C],c[C]=-o[C],l[C]=-a[C];const d=go(s),u=go(c),f=go(a),h=qn(3);Bi(i,o,h);const g=go(h),p=d*u*f/(2*g),v=2*g*g,w=u*u*jt(i,l)/v,m=f*f*jt(s,o)/v,y=d*d*jt(a,c)/v;for(let C=0;C<3;++C)n[C]=w*t[C]+m*e[C]+y*r[C];return p}const PL=1/0,RL=-1/0,p4=t=>!Number.isFinite(t),{isFinite:AL,isNaN:Kv}=Number,Pp=Kv;function Eu(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function LL(t){let e=-1,r=-1;for(let n=0;n<t.length;n++){const i=Math.abs(t[n]);i>e&&(r=n,e=i)}return r}function m4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const r=new Array(e),n=new Array(e);for(let o=0;o<e;++o)r[o]=o,n[o]=o;for(let o=e-1;o>0;o--){let a=-1/0,s=0,c=0;for(let l=0;l<=o;++l){const d=r[l];for(let u=0;u<=o;++u){const f=n[u],h=Math.abs(t[d+e*f]);h>a&&(a=h,s=l,c=u)}}[r[o],r[s]]=[r[s],r[o]],[n[o],n[c]]=[n[c],n[o]]}const i=new Array(e*e).fill(0);for(let o=0;o<e;++o){const a=r[o]+e*n[o];i[a]=t[a]<0?-1:1}return i}function v4(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function NL(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(v4).join("")}`}function tg(t){return Math.round(t*255)}function VL(t){return t.length===3?`rgb(${t.map(tg).join(", ")})`:`rgba(${tg(t[0]||0)}, ${tg(t[1]||0)}, ${tg(t[2]||0)}, ${t[3]||0})`}var pt={Pi:NA,ldexp:VA,radiansFromDegrees:cr,degreesFromRadians:Mp,round:kA,floor:D5,ceil:FA,ceilLog2:zA,min:UA,max:BA,arrayMin:GA,arrayMax:WA,arrayRange:$A,isPowerOfTwo:Kd,nearestPowerOfTwo:zc,factorial:jA,binomial:HA,beginCombination:XA,nextCombination:KA,randomSeed:qA,getSeed:YA,random:JA,gaussian:ZA,add:R0,subtract:Hr,multiplyScalar:e4,multiplyScalar2D:t4,multiplyAccumulate:Wv,multiplyAccumulate2D:QA,dot:jt,outer:eL,cross:Bi,norm:go,normalize:wo,perpendiculars:nL,projectVector:rL,projectVector2D:iL,distance2BetweenPoints:lo,angleBetweenVectors:oL,gaussianAmplitude:aL,gaussianWeight:sL,dot2D:$v,outer2D:cL,norm2D:n4,normalize2D:lL,determinant2x2:ur,LUFactor3x3:uL,LUSolve3x3:dL,linearSolve3x3:fL,multiply3x3_vect3:Yg,multiply3x3_mat3:zv,multiplyMatrix:hL,transpose3x3:x0,invert3x3:gL,identity3x3:i4,identity:o4,isIdentity:pL,isIdentity3x3:mL,determinant3x3:V1,quaternionToMatrix3x3:a4,areEquals:r4,areMatricesEqual:A0,roundNumber:Jg,roundVector:jv,matrix3x3ToQuaternion:s4,multiplyQuaternion:vL,orthogonalize3x3:c4,diagonalize3x3:l4,singularValueDecomposition3x3:yL,solveLinearSystem:u4,invertMatrix:O5,luFactorLinearSystem:I5,luSolveLinearSystem:M5,estimateMatrixCondition:wL,jacobi:CL,jacobiN:Eh,solveHomogeneousLeastSquares:Hv,solveLeastSquares:xL,hex2float:SL,rgb2hsv:qd,hsv2rgb:au,lab2xyz:d4,xyz2lab:f4,xyz2rgb:h4,rgb2xyz:g4,rgb2lab:fu,lab2rgb:Op,uninitializeBounds:P5,areBoundsInitialized:Zg,computeBoundsFromPoints:TL,clampValue:ua,clampVector:Xv,clampAndNormalizeValue:_L,getScalarTypeFittingRange:EL,getAdjustedScalarRange:bL,extentIsWithinOtherExtent:DL,boundsIsWithinOtherBounds:IL,pointIsWithinBounds:ML,solve3PointCircle:OL,inf:PL,negInf:RL,isInf:p4,isNan:Kv,isNaN:Kv,isFinite:AL,createUninitializedBounds:Eu,getMajorAxisIndex:LL,getSparseOrthogonalMatrix:m4,floatToHex2:v4,floatRGB2HexCode:NL,float2CssRGBA:VL};const y4={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Zt={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},kL=Zt.FLOAT;var w4={DefaultDataType:kL,DataTypeByteSize:y4,VtkDataTypes:Zt};const{vtkErrorMacro:FL}=Oi,{DefaultDataType:UL}=w4,BL=1e-6;function qv(t,e,r){const n=t.length;let i=Number.MAX_VALUE,o=-Number.MAX_VALUE,a,s;for(s=e;s<n;s+=r)if(!Number.isNaN(t[s])){i=t[s],o=i;break}for(;s<n;s+=r)a=t[s],a<i?i=a:a>o&&(o=a);return{min:i,max:o}}function GL(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add(i){t>i&&(t=i),e<i&&(e=i),r++,n+=i},get(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange(){return{min:t,max:e}}}}function C4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){const i=t.length/r,o=new Float64Array(i);for(let a=0,s=0;a<i;++a){for(let c=s+r;s<c;++s)o[a]+=t[s]*t[s];o[a]**=.5}return qv(o,0,1)}return qv(t,e<0?0:e,r)}function T3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=t||[];for(;r.length<=e;)r.push(null);return r}function R5(t){return Object.prototype.toString.call(t).slice(8,-1)}function WL(t){const e=t.getNumberOfComponents();let r=0;const n=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,n);const o=go(n,e);o>r&&(r=o)}return r}const $L={computeRange:C4,createRangeHelper:GL,fastComputeRange:qv,getDataType:R5,getMaxNorm:WL};function zL(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;const i=t.getNumberOfComponents(),o=e.values.length/(i>0?i:1);if(n===o)return!0;if(n>o){const a=e.values;return e.values=Z0(e.dataType,(n+o)*i),e.values.set(a),!0}return e.size>n*i&&(e.size=n*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.allocate=n=>{r(t.getNumberOfTuples()+n)},t.resize=n=>{r(n);const i=n*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>(t.resize(0),t),t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+i]},t.setComponent=(n,i,o)=>{o!==e.values[n*e.numberOfComponents+i]&&(e.values[n*e.numberOfComponents+i]=o,t.dataChange())},t.getValue=n=>{const i=n/e.numberOfComponents,o=n%e.numberOfComponents;return t.getComponent(i,o)},t.setValue=(n,i)=>{const o=n/e.numberOfComponents,a=n%e.numberOfComponents;t.setComponent(o,a,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=n;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let o=null;return e.ranges||(e.ranges=T3(e.ranges,e.numberOfComponents)),o=e.ranges[i],o?(e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple):(o=C4(t.getData(),n,e.numberOfComponents),e.ranges[i]=o,e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple)},t.setRange=(n,i)=>{e.ranges||(e.ranges=T3(e.ranges,e.numberOfComponents));const o={min:n.min,max:n.max};return e.ranges[i]=o,e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);const i=[];for(let o=0;o<e.numberOfComponents;o++){const[a,s]=t.getRange(o),c={min:a,max:s};i.push(c)}if(e.numberOfComponents>1){const[o,a]=t.getRange(-1),s={min:o,max:a};i.push(s)}return i},t.setTuple=(n,i)=>{const o=n*e.numberOfComponents;for(let a=0;a<e.numberOfComponents;a++)e.values[o+a]=i[a]},t.setTuples=(n,i)=>{let o=n*e.numberOfComponents;const a=Math.min(i.length,e.size-o);for(let s=0;s<a;)e.values[o++]=i[s++]},t.insertTuple=(n,i)=>(e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,i),n),t.insertTuples=(n,i)=>{const o=n+i.length/e.numberOfComponents;return e.size<o*e.numberOfComponents&&(e.size=o*e.numberOfComponents,r(o)),t.setTuples(n,i),o},t.insertNextTuple=n=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,n)},t.insertNextTuples=n=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,n)},t.findTuple=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:BL;for(let o=0;o<e.size;o+=e.numberOfComponents)if(Math.abs(n[0]-e.values[o])<=i){let a=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(n[s]-e.values[o+s])>i){a=!1;break}if(a)return o/e.numberOfComponents}return-1},t.getTuple=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const o=e.numberOfComponents||1,a=n*o;switch(o){case 4:i[3]=e.values[a+3];case 3:i[2]=e.values[a+2];case 2:i[1]=e.values[a+1];case 1:i[0]=e.values[a];break;default:for(let s=o-1;s>=0;--s)i[s]=e.values[a+s]}return i},t.getTuples=(n,i)=>{const o=(n??0)*e.numberOfComponents,a=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(o,a);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>S4({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(n,i)=>{e.values=n,e.size=n.length,e.dataType=R5(n),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const n={...e,vtkClass:t.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(o=>{n[o]||delete n[o]});const i={};return Object.keys(n).sort().forEach(o=>{i[o]=n[o]}),i.mtime&&delete i.mtime,i},t.deepCopy=n=>{const i=t.getDataType(),o=e.values;t.shallowCopy(n),e.ranges=structuredClone(n.getRanges()),o?.length>=n.getNumberOfValues()&&i===n.getDataType()?(o.set(n.getData()),e.values=o,t.dataChange()):t.setData(n.getData().slice())},t.interpolateTuple=(n,i,o,a,s,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==a.getNumberOfComponents())&&FL("numberOfComponents must match");const d=i.getTuple(o),u=a.getTuple(s),f=[];switch(f.length=l,l){case 4:f[3]=d[3]+(u[3]-d[3])*c;case 3:f[2]=d[2]+(u[2]-d[2])*c;case 2:f[1]=d[1]+(u[1]-d[1])*c;case 1:f[0]=d[0]+(u[0]-d[0])*c;break;default:for(let h=0;h<l;h++)f[h]=d[h]+(u[h]-d[h])*c}return t.insertTuple(n,f)}}const jL={name:"",numberOfComponents:1,dataType:UL,rangeTuple:[0,0]};function x4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,jL,r),Array.isArray(r.values)&&r.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=L1(e.dataType,e.values)):e.values=Z0(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=R5(e.values)),Jn(t,e),xh(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");zL(t,e)}const S4=zn(x4,"vtkDataArray");var Ot={newInstance:S4,extend:x4,...$L,...w4};const HL={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},Yv={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},XL={LINEAR:0,LOG10:1};var A5={VectorMode:HL,ScalarMappingTarget:Yv,Scale:XL};const KL={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},qL={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},YL={BY_ID:0,BY_NAME:1};var L5={ColorMode:KL,GetArray:YL,ScalarMode:qL};const{ScalarMappingTarget:_3,Scale:JL,VectorMode:ka}=A5,{VtkDataTypes:Lc}=Ot,{ColorMode:ng}=L5,{vtkErrorMacro:E3}=Z;function ZL(t){return t}function b3(t){return Math.floor(t*255+.5)}function QL(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(ka.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(ka.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(ka.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(r,n)=>{if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){E3("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r){const i=n.length;for(let o=0;o<i;o++)e.annotationArray.push({value:r[o],annotation:String(n[o])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(r,n)=>{let i=t.checkForAnnotatedValue(r),o=!1;return i>=0?e.annotationArray[i].annotation!==n&&(e.annotationArray[i].annotation=n,o=!0):(e.annotationArray.push({value:r,annotation:n}),i=e.annotationArray.length-1,o=!0),o&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=r=>r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value,t.getAnnotation=r=>e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation,t.getAnnotatedValueIndex=r=>e.annotationArray.length?t.checkForAnnotatedValue(r):-1,t.removeAnnotation=r=>{const n=t.checkForAnnotatedValue(r),i=n>=0;return i&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(r,n)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(r);t.getIndexedColor(i,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=r=>t.getAnnotatedValueIndexInternal(r),t.getAnnotatedValueIndexInternal=r=>{if(e.annotatedValueMap[r]!==void 0){const n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=(r,n)=>{n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const r=e.annotationArray.length;for(let n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=(r,n,i)=>{const o=r.getNumberOfComponents();let a=null;if(n===ng.DEFAULT&&(r.getDataType()===Lc.UNSIGNED_CHAR||r.getDataType()===Lc.UNSIGNED_CHAR_CLAMPED)||n===ng.DIRECT_SCALARS&&r)a=t.convertToRGBA(r,o,r.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:Lc.UNSIGNED_CHAR},c=Z.newTypedArray(s.dataType,4*r.getNumberOfTuples());s.values=c,s.size=c.length,a=Ot.newInstance(s);let l=i;l<0&&o>1?t.mapVectorsThroughTable(r,a,_3.RGBA,-1,-1):(l<0&&(l=0),l>=o&&(l=o-1),t.mapScalarsThroughTable(r,a,_3.RGBA,l))}return a},t.mapVectorsToMagnitude=(r,n,i)=>{const o=r.getNumberOfTuples(),a=r.getNumberOfComponents(),s=n.getData(),c=r.getData();for(let l=0;l<o;l++){let d=0;for(let u=0;u<i;u++)d+=c[l*a+u]*c[l*a+u];s[l]=Math.sqrt(d)}},t.mapVectorsThroughTable=(r,n,i,o,a)=>{let s=t.getVectorMode(),c=a,l=o;const d=r.getNumberOfComponents();s===ka.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=d&&(l=d-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=d):(l<0&&(l=0),l>=d&&(l=d-1),l+c>d&&(c=d-l)),s===ka.MAGNITUDE&&(d===1||c===1)&&(s=ka.COMPONENT));let u=0;switch(l>0&&(u=l),s){case ka.COMPONENT:{t.mapScalarsThroughTable(r,n,i,u);break}case ka.RGBCOLORS:break;case ka.MAGNITUDE:default:{const f=Ot.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,f,c),t.mapScalarsThroughTable(f,n,i,0);break}}},t.luminanceToRGBA=(r,n,i,o)=>{const a=o(i),s=n.getData(),c=r.getData(),l=s.length,d=0,u=1;let f=0;for(let h=d;h<l;h+=u){const g=o(s[h]);c[f*4]=g,c[f*4+1]=g,c[f*4+2]=g,c[f*4+3]=a,f++}},t.luminanceAlphaToRGBA=(r,n,i,o)=>{const a=n.getData(),s=r.getData(),c=a.length,l=0,d=2;let u=0;for(let f=l;f<c;f+=d){const h=o(a[f]);s[u]=h,s[u+1]=h,s[u+2]=h,s[u+3]=o(a[f+1])*i,u+=4}},t.rGBToRGBA=(r,n,i,o)=>{const a=b3(i),s=n.getData(),c=r.getData(),l=s.length,d=0,u=3;let f=0;for(let h=d;h<l;h+=u)c[f*4]=o(s[h]),c[f*4+1]=o(s[h+1]),c[f*4+2]=o(s[h+2]),c[f*4+3]=a,f++},t.rGBAToRGBA=(r,n,i,o)=>{const a=n.getData(),s=r.getData(),c=a.length,l=0,d=4;let u=0;for(let f=l;f<c;f+=d)s[u*4]=o(a[f]),s[u*4+1]=o(a[f+1]),s[u*4+2]=o(a[f+2]),s[u*4+3]=o(a[f+3])*i,u++},t.convertToRGBA=(r,n,i)=>{let{alpha:o}=e;if(n===4&&o>=1&&r.getDataType()===Lc.UNSIGNED_CHAR)return r;const a=Ot.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:Lc.UNSIGNED_CHAR});if(i<=0)return a;o=o>0?o:0,o=o<1?o:1;let s=ZL;switch((r.getDataType()===Lc.FLOAT||r.getDataType()===Lc.DOUBLE)&&(s=b3),n){case 1:t.luminanceToRGBA(a,r,o,s);break;case 2:t.luminanceAlphaToRGBA(a,r,s);break;case 3:t.rGBToRGBA(a,r,o,s);break;case 4:t.rGBAToRGBA(a,r,o,s);break;default:return E3("Cannot convert colors"),null}return a},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(r,n)=>t.setMappingRange(r,n),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(r,n,i)=>{if(!r)return t.isOpaque();const o=r.getNumberOfComponents();return n===ng.DEFAULT&&r.getDataType()===Lc.UNSIGNED_CHAR||n===ng.DIRECT_SCALARS?o===3||o===1?e.alpha>=1:r.getRange(o-1)[0]===255:!0}}const eN={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:ka.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:JL.LINEAR};function T4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eN,r),Z.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],Z.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),Z.setArray(t,e,["mappingRange"],2),Z.getArray(t,e,["mappingRange"]),QL(t,e)}const tN=Z.newInstance(T4,"vtkScalarsToColors");var N5={newInstance:tN,extend:T4,...A5};const nN={RGB:0,HSV:1,LAB:2,DIVERGING:3},rN={LINEAR:0,LOG10:1};var _4={ColorSpace:nN,Scale:rN};const{ColorSpace:Ao,Scale:V5}=_4,{ScalarMappingTarget:rg}=N5,{vtkDebugMacro:iN,vtkErrorMacro:Is,vtkWarningMacro:oN}=Z;function D3(t,e){const r=t[0],n=t[1],i=t[2],o=Math.sqrt(r*r+n*n+i*i),a=o>.001?Math.acos(r/o):0,s=a>.001?Math.atan2(i,n):0;e[0]=o,e[1]=a,e[2]=s}function aN(t,e){const r=t[0],n=t[1],i=t[2];e[0]=r*Math.cos(n),e[1]=r*Math.sin(n)*Math.cos(i),e[2]=r*Math.sin(n)*Math.sin(i)}function I3(t,e){if(t[0]>=e-.1)return t[2];const r=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+r:t[2]-r}function sN(t,e){let r=t-e;for(r<0&&(r=-r);r>=2*Math.PI;)r-=2*Math.PI;return r>Math.PI&&(r=2*Math.PI-r),r}function M3(t,e,r,n){const i=[],o=[];fu(e,i),fu(r,o);const a=[],s=[];D3(i,a),D3(o,s);let c=t;if(a[1]>.05&&s[1]>.05&&sN(a[2],s[2])>.33*Math.PI){let u=Math.max(a[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(a[0]=u,a[1]=0,a[2]=0,c=2*c-1)}a[1]<.05&&s[1]>.05?a[2]=I3(s,a[0]):s[1]<.05&&a[1]>.05&&(s[2]=I3(a,s[0]));const l=[];l[0]=(1-c)*a[0]+c*s[0],l[1]=(1-c)*a[1]+c*s[1],l[2]=(1-c)*a[2]+c*s[2];const d=[];aN(l,d),Op(d,n)}function cN(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(r,n,i,o)=>t.addRGBPointLong(r,n,i,o,.5,0),t.addRGBPointLong=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(a<0||a>1)return Is("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return Is("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);const c={x:r,r:n,g:i,b:o,midpoint:a,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==r;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(r,n,i,o)=>t.addHSVPointLong(r,n,i,o,.5,0),t.addHSVPointLong=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return au([n,i,o],c),t.addRGBPoint(r,c[0],c[1],c[2],a,s)},t.setNodes=r=>{if(e.nodes!==r){const n=JSON.stringify(e.nodes);e.nodes=r;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||n!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const r=JSON.stringify(e.nodes);e.nodes.sort((o,a)=>o.x-a.x);const n=JSON.stringify(e.nodes),i=t.updateRange();return!i&&r!==n?(t.modified(),!0):i},t.updateRange=()=>{const r=[2];r[0]=e.mappingRange[0],r[1]=e.mappingRange[1];const n=e.nodes.length;return n?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[n-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),r[0]===e.mappingRange[0]&&r[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n=0;for(;n<e.nodes.length&&e.nodes[n].x!==r;n++);const i=n;if(n>=e.nodes.length)return-1;let o=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(o=t.updateRange()),o||t.modified(),i},t.movePoint=(r,n)=>{if(r!==n){t.removePoint(n);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===r){e.nodes[i].x=n,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(r,n,i,o,a,s,c,l)=>{t.sortAndUpdateRange();for(let d=0;d<e.nodes.length;)e.nodes[d].x>=r&&e.nodes[d].x<=a?e.nodes.splice(d,1):d++;t.addRGBPointLong(r,n,i,o,.5,0),t.addRGBPointLong(a,s,c,l,.5,0),t.modified()},t.addHSVSegment=(r,n,i,o,a,s,c,l)=>{const d=[n,i,o],u=[s,c,l],f=[],h=[];au(d,f),au(u,h),t.addRGBSegment(r,f[0],f[1],f[2],a,h[0],h[1],h[2])},t.mapValue=r=>{const n=[];return t.getColor(r,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},t.getColor=(r,n)=>{if(e.indexedLookup){const i=t.getSize(),o=t.getAnnotatedValueIndexInternal(r);if(o<0||i===0){const a=t.getNanColorByReference();n[0]=a[0],n[1]=a[1],n[2]=a[2]}else{const a=[];t.getNodeValue(o%i,a),n[0]=a[1],n[1]=a[2],n[2]=a[3]}return}t.getTable(r,r,1,n)},t.getRedValue=r=>{const n=[];return t.getColor(r,n),n[0]},t.getGreenValue=r=>{const n=[];return t.getColor(r,n),n[1]},t.getBlueValue=r=>{const n=[];return t.getColor(r,n),n[2]},t.logScaleEnabled=()=>e.scale===V5.LOG10,t.usingLogScale=()=>t.logScaleEnabled()&&e.mappingRange[0]>0,t.getTable=(r,n,i,o)=>{const a=t.usingLogScale(),s=a?Math.log10(Number(r)):Number(r),c=a?Math.log10(Number(n)):Number(n);if(Pp(s)||Pp(c)){for(let T=0;T<i;T++)o[T*3+0]=e.nanColor[0],o[T*3+1]=e.nanColor[1],o[T*3+2]=e.nanColor[2];return}let l=0;const d=e.nodes.length;let u=0,f=0,h=0;d!==0&&(u=e.nodes[d-1].r,f=e.nodes[d-1].g,h=e.nodes[d-1].b);let g=0,p=0,v=0;const w=[0,0,0],m=[0,0,0];let y=0,C=0;const x=[];let S=e.mappingRange;a&&(S=[Math.log10(e.mappingRange[0]),Math.log10(e.mappingRange[1])]);for(let T=0;T<i;T++){const _=3*T;if(i>1?g=s+T/(i-1)*(c-s):g=.5*(s+c),e.discretize){const E=S;if(g>=E[0]&&g<=E[1]){const D=e.numberOfValues,b=E[1]-E[0];if(D<=1)g=E[0]+b/2;else{const I=(g-E[0])/b,O=D5(D*I);g=E[0]+O/(D-1)*b}}}for(;l<d&&g>e.nodes[l].x;)l++,l<d&&(p=e.nodes[l-1].x,v=e.nodes[l].x,w[0]=e.nodes[l-1].r,m[0]=e.nodes[l].r,w[1]=e.nodes[l-1].g,m[1]=e.nodes[l].g,w[2]=e.nodes[l-1].b,m[2]=e.nodes[l].b,y=e.nodes[l-1].midpoint,C=e.nodes[l-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(g>S[1])o[_]=0,o[_+1]=0,o[_+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(o[_]=e.aboveRangeColor[0],o[_+1]=e.aboveRangeColor[1],o[_+2]=e.aboveRangeColor[2]):(o[_]=u,o[_+1]=f,o[_+2]=h));else if(g<S[0]||p4(g)&&g<0)o[_]=0,o[_+1]=0,o[_+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(o[_]=e.belowRangeColor[0],o[_+1]=e.belowRangeColor[1],o[_+2]=e.belowRangeColor[2]):d>0&&(o[_]=e.nodes[0].r,o[_+1]=e.nodes[0].g,o[_+2]=e.nodes[0].b));else if(l===0&&(Math.abs(g-s)<1e-6||e.discretize))d>0?(o[_]=e.nodes[0].r,o[_+1]=e.nodes[0].g,o[_+2]=e.nodes[0].b):(o[_]=0,o[_+1]=0,o[_+2]=0);else{let E=0;if(E=(g-p)/(v-p),E<y?E=.5*E/y:E=.5+.5*(E-y)/(1-y),C>.99)if(E<.5){o[_]=w[0],o[_+1]=w[1],o[_+2]=w[2];continue}else{o[_]=m[0],o[_+1]=m[1],o[_+2]=m[2];continue}if(C<.01){if(e.colorSpace===Ao.RGB)o[_]=(1-E)*w[0]+E*m[0],o[_+1]=(1-E)*w[1]+E*m[1],o[_+2]=(1-E)*w[2]+E*m[2];else if(e.colorSpace===Ao.HSV){const k=[],L=[];qd(w,k),qd(m,L),e.hSVWrap&&(k[0]-L[0]>.5||L[0]-k[0]>.5)&&(k[0]>L[0]?k[0]-=1:L[0]-=1);const F=[];F[0]=(1-E)*k[0]+E*L[0],F[0]<0&&(F[0]+=1),F[1]=(1-E)*k[1]+E*L[1],F[2]=(1-E)*k[2]+E*L[2],au(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else if(e.colorSpace===Ao.LAB){const k=[],L=[];fu(w,k),fu(m,L);const F=[];F[0]=(1-E)*k[0]+E*L[0],F[1]=(1-E)*k[1]+E*L[1],F[2]=(1-E)*k[2]+E*L[2],Op(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else e.colorSpace===Ao.DIVERGING?(M3(E,w,m,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]):Is("ColorSpace set to invalid value.",e.colorSpace);continue}E<.5?E=.5*(E*2)**(1+10*C):E>.5&&(E=1-.5*((1-E)*2)**(1+10*C));const D=E*E,b=D*E,I=2*b-3*D+1,O=-2*b+3*D,M=b-2*D+E,R=b-D;let A,G;if(e.colorSpace===Ao.RGB)for(let k=0;k<3;k++)A=m[k]-w[k],G=(1-C)*A,o[_+k]=I*w[k]+O*m[k]+M*G+R*G;else if(e.colorSpace===Ao.HSV){const k=[],L=[];qd(w,k),qd(m,L),e.hSVWrap&&(k[0]-L[0]>.5||L[0]-k[0]>.5)&&(k[0]>L[0]?k[0]-=1:L[0]-=1);const F=[];for(let j=0;j<3;j++)A=L[j]-k[j],G=(1-C)*A,F[j]=I*k[j]+O*L[j]+M*G+R*G,j===0&&F[j]<0&&(F[j]+=1);au(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else if(e.colorSpace===Ao.LAB){const k=[],L=[];fu(w,k),fu(m,L);const F=[];for(let j=0;j<3;j++)A=L[j]-k[j],G=(1-C)*A,F[j]=I*k[j]+O*L[j]+M*G+R*G;Op(F,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]}else e.colorSpace===Ao.DIVERGING?(M3(E,w,m,x),o[_]=x[0],o[_+1]=x[1],o[_+2]=x[2]):Is("ColorSpace set to invalid value.");for(let k=0;k<3;k++)o[_+k]=o[_+k]<0?0:o[_+k],o[_+k]=o[_+k]>1?1:o[_+k]}}},t.getUint8Table=function(r,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==o)return e.table;if(e.nodes.length===0)return Is("Attempting to lookup a value with no points in the function"),e.table;const a=o?4:3;(e.tableSize!==i||e.tableWithAlpha!==o)&&(e.table=new Uint8Array(i*a),e.tableSize=i,e.tableWithAlpha=o);const s=[];t.getTable(r,n,i,s);for(let c=0;c<i;c++)e.table[c*a+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*a+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*a+2]=Math.floor(s[c*3+2]*255+.5),o&&(e.table[c*a+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=r=>{t.removeAllPoints();const n=r.getNumberOfComponents();for(let i=0;i<r.getNumberOfTuples();i++)switch(n){case 3:{e.nodes.push({x:i,r:r.getComponent(i,0),g:r.getComponent(i,1),b:r.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:r.getComponent(i,0),r:r.getComponent(i,1),g:r.getComponent(i,2),b:r.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:r.getComponent(i,0),g:r.getComponent(i,1),b:r.getComponent(i,2),midpoint:r.getComponent(i,4),sharpness:r.getComponent(i,5)});break}case 6:{e.nodes.push({x:r.getComponent(i,0),r:r.getComponent(i,1),g:r.getComponent(i,2),b:r.getComponent(i,3),midpoint:r.getComponent(i,4),sharpness:r.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(r,n,i,o)=>{let a=0;t.removeAllPoints(),i>1&&(a=(n-r)/(i-1));for(let s=0;s<i;s++){const c={x:r+a*s,r:o[s*3],g:o[s*3+1],b:o[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(r,n)=>r<0||r>=e.nodes.length?(Is("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].r,n[2]=e.nodes[r].g,n[3]=e.nodes[r].b,n[4]=e.nodes[r].midpoint,n[5]=e.nodes[r].sharpness,1),t.setNodeValue=(r,n)=>{if(r<0||r>=e.nodes.length)return Is("Index out of range!"),-1;const i=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].r=n[1],e.nodes[r].g=n[2],e.nodes[r].b=n[3],e.nodes[r].midpoint=n[4],e.nodes[r].sharpness=n[5],i!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const r=e.nodes?.length??0;return Math.max(4094,r)},t.getIndexedColor=(r,n)=>{const i=t.getSize();if(i>0&&r>=0){const a=[];t.getNodeValue(r%i,a);for(let s=0;s<3;++s)n[s]=a[s+1];n[3]=1;return}const o=t.getNanColorByReference();n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=1},t.fillFromDataPointer=(r,n)=>{if(!(r<=0||!n)){t.removeAllPoints();for(let i=0;i<r;i++)t.addRGBPoint(n[i*4],n[i*4+1],n[i*4+2],n[i*4+3])}},t.setMappingRange=(r,n)=>{const i=[r,n],o=[r,n],a=t.getRange(),s=t.logScaleEnabled();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){Is("attempt to set zero width color range");return}s&&(i[0]<=0?console.warn("attempt to set log scale color range with non-positive minimum"):(o[0]=Math.log10(i[0]),o[1]=Math.log10(i[1])));const c=(o[1]-o[0])/(a[1]-a[0]),l=o[0]-a[0]*c;for(let d=0;d<e.nodes.length;++d)e.nodes[d].x=e.nodes[d].x*c+l;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=r=>{const n=t.getRange(),i=[];n[0]<r[0]?(t.getColor(r[0],i),t.addRGBPoint(r[0],i[0],i[1],i[2])):(t.getColor(n[0],i),t.addRGBPoint(r[0],i[0],i[1],i[2])),n[1]>r[1]?(t.getColor(r[1],i),t.addRGBPoint(r[1],i[0],i[1],i[2])):(t.getColor(n[1],i),t.addRGBPoint(r[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=r[0]&&e.nodes[o].x<=r[1]?e.nodes.splice(o,1):++o;return 1},t.estimateMinNumberOfSamples=(r,n)=>{const i=t.findMinimumXDistance();return Math.ceil((n-r)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let r=Number.MAX_VALUE;for(let n=0;n<e.nodes.length-1;n++){const i=e.nodes[n+1].x-e.nodes[n].x;i<r&&(r=i)}return r},t.mapScalarsThroughTable=(r,n,i,o)=>{if(t.getSize()===0){iN("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(r,n,i,o):t.mapData(r,n,i,o)},t.mapData=(r,n,i,o)=>{if(t.getSize()===0){oN("Transfer Function Has No Points!");return}const a=Math.floor(t.getAlpha()*255+.5),s=r.getNumberOfTuples(),c=r.getNumberOfComponents(),l=n.getData(),d=r.getData(),u=[];if(i===rg.RGBA)for(let f=0;f<s;f++){const h=d[f*c+o];t.getColor(h,u),l[f*4]=Math.floor(u[0]*255+.5),l[f*4+1]=Math.floor(u[1]*255+.5),l[f*4+2]=Math.floor(u[2]*255+.5),l[f*4+3]=a}if(i===rg.RGB)for(let f=0;f<s;f++){const h=d[f*c+o];t.getColor(h,u),l[f*3]=Math.floor(u[0]*255+.5),l[f*3+1]=Math.floor(u[1]*255+.5),l[f*3+2]=Math.floor(u[2]*255+.5)}if(i===rg.LUMINANCE)for(let f=0;f<s;f++){const h=d[f*c+o];t.getColor(h,u),l[f]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(i===rg.LUMINANCE_ALPHA)for(let f=0;f<s;f++){const h=d[f*c+o];t.getColor(h,u),l[f*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[f*2+1]=a}},t.applyColorMap=r=>{const n=JSON.stringify(e.colorSpace);r.ColorSpace&&(e.colorSpace=Ao[r.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Is(`ColorSpace ${r.ColorSpace} not supported, using RGB instead`),e.colorSpace=Ao.RGB));let i=n!==JSON.stringify(e.colorSpace);const o=i||JSON.stringify(e.nanColor);if(r.NanColor)for(e.nanColor=[].concat(r.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||o!==JSON.stringify(e.nanColor);const a=i||JSON.stringify(e.nodes);if(r.RGBPoints){const l=r.RGBPoints.length;e.nodes=[];const d=.5,u=0;for(let f=0;f<l;f+=4)e.nodes.push({x:r.RGBPoints[f],r:r.RGBPoints[f+1],g:r.RGBPoints[f+2],b:r.RGBPoints[f+3],midpoint:d,sharpness:u})}const s=t.sortAndUpdateRange(),c=!s&&(i||a!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const lN={clamping:!0,colorSpace:Ao.RGB,hSVWrap:!0,scale:V5.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function E4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lN,r),N5.extend(t,e,r),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},Z.obj(e.buildTime),Z.get(t,e,["buildTime","mappingRange"]),Z.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:Ao},{type:"enum",name:"scale",enum:V5}]),Z.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),Z.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),cN(t,e)}const uN=Z.newInstance(E4,"vtkColorTransferFunction");var Qs={newInstance:uN,extend:E4,..._4},dN=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const L0=Object.create(null);dN.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{L0[t.Name]=t});const N0=Object.keys(L0);N0.sort();function fN(t){return L0[t]}function hN(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(L0[t.Name]||(N0.push(t.Name),N0.sort()),L0[t.Name]=t)}function gN(t){const e=N0.indexOf(t);e>-1&&N0.splice(e,1),delete L0[t]}var $f={addPreset:hN,removePresetByName:gN,getPresetByName:fN,rgbPresetNames:N0};const{vtkErrorMacro:ig}=Z;function pN(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let r,n=0,i=0;e.nodes.length>0&&(n=e.nodes[0].y);for(let o=1;o<e.nodes.length;o++){if(r=e.nodes[o].y,r!==n)if(r>n)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(n=r,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const r=e.nodes.length;if(e.function=null,r>0){e.function=[];for(let n=0;n<r;n++)e.function[2*n]=e.nodes[n].x,e.function[2*n+1]=e.nodes[n].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let r=1,n=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){r=0;break}return r?n=Number.MAX_VALUE:i>0?n=e.nodes[i-1].x:e.clamping?n=-Number.MAX_VALUE:n=e.nodes[0].x,n},t.getNodeValue=(r,n)=>{const i=e.nodes.length;return r<0||r>=i?(ig("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].y,n[2]=e.nodes[r].midpoint,n[3]=e.nodes[r].sharpness,1)},t.setNodeValue=(r,n)=>{const i=e.nodes.length;if(r<0||r>=i)return ig("Index out of range!"),-1;const o=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].y=n[1],e.nodes[r].midpoint=n[2],e.nodes[r].sharpness=n[3],o!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(r,n)=>t.addPointLong(r,n,.5,0),t.addPointLong=(r,n,i,o)=>{if(i<0||i>1)return ig("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return ig("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);const a={x:r,y:n,midpoint:i,sharpness:o};e.nodes.push(a),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==r;s++);return s<e.nodes.length?s:-1},t.setNodes=r=>{e.nodes!==r&&(e.nodes=r,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((n,i)=>n.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const r=e.range.slice(),n=e.nodes.length;return n?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[n-1].x):(e.range[0]=0,e.range[1]=0),r[0]===e.range[0]&&r[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n;for(n=0;n<e.nodes.length&&e.nodes[n].x!==r;n++);if(n>=e.nodes.length)return-1;const i=n;let o=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(o=t.updateRange()),o||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(r,n,i,o)=>{t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=r&&e.nodes[a].x<=i?e.nodes.splice(a,1):a++;t.addPoint(r,n,.5,0),t.addPoint(i,o,.5,0)},t.getValue=r=>{const n=[];return t.getTable(r,r,1,n),n[0]},t.adjustRange=r=>{if(r.length<2)return 0;const n=t.getRange();n[0]<r[0]?t.addPoint(r[0],t.getValue(r[0])):t.addPoint(r[0],t.getValue(n[0])),n[1]>r[1]?t.addPoint(r[1],t.getValue(r[1])):t.addPoint(r[1],t.getValue(n[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=r[0]&&e.nodes[i].x<=r[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(r,n)=>{const i=t.findMinimumXDistance();return Math.ceil((n-r)/i)},t.findMinimumXDistance=()=>{const r=e.nodes.length;if(r<2)return-1;let n=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<r-1;i++){const o=e.nodes[i+1].x-e.nodes[i].x;o<n&&(n=o)}return n},t.getTable=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const l=e.nodes.length;let d=0;l!==0&&(d=e.nodes[l-1].y);let u=0,f=0,h=0,g=0,p=0,v=0,w=0;for(s=0;s<i;s++){const m=a*s;for(i>1?u=r+s/(i-1)*(n-r):u=.5*(r+n);c<l&&u>e.nodes[c].x;)c++,c<l&&(f=e.nodes[c-1].x,h=e.nodes[c].x,g=e.nodes[c-1].y,p=e.nodes[c].y,v=e.nodes[c-1].midpoint,w=e.nodes[c-1].sharpness,v<1e-5&&(v=1e-5),v>.99999&&(v=.99999));if(c>=l)o[m]=e.clamping?d:0;else if(c===0)o[m]=e.clamping?e.nodes[0].y:0;else{let y=(u-f)/(h-f);if(y<v?y=.5*y/v:y=.5+.5*(y-v)/(1-v),w>.99)if(y<.5){o[m]=g;continue}else{o[m]=p;continue}if(w<.01){o[m]=(1-y)*g+y*p;continue}y<.5?y=.5*(y*2)**(1+10*w):y>.5&&(y=1-.5*((1-y)*2)**(1+10*w));const C=y*y,x=C*y,S=2*x-3*C+1,T=-2*x+3*C,_=x-2*C+y,E=x-C,D=p-g,b=(1-w)*D;o[m]=S*g+T*p+_*b+E*b;const I=g<p?g:p,O=g>p?g:p;o[m]=o[m]<I?I:o[m],o[m]=o[m]>O?O:o[m]}}}}const mN={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function b4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mN,r),Z.obj(t,e),e.nodes=[],Z.setGet(t,e,["allowDuplicateScalars","clamping"]),Z.setArray(t,e,["range"],2),Z.getArray(t,e,["range"]),pN(t,e)}const vN=Z.newInstance(b4,"vtkPiecewiseFunction");var bu={newInstance:vN,extend:b4},In=1e-6,gr=typeof Float32Array<"u"?Float32Array:Array,yN=Math.PI/180;function wN(t){return t*yN}function Du(t,e){return Math.abs(t-e)<=In*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Vo(){var t=new gr(9);return gr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function el(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function CN(t){var e=new gr(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xN(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Yd(t,e,r,n,i,o,a,s,c){var l=new gr(9);return l[0]=t,l[1]=e,l[2]=r,l[3]=n,l[4]=i,l[5]=o,l[6]=a,l[7]=s,l[8]=c,l}function D4(t,e,r,n,i,o,a,s,c,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t}function Xo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function V0(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function ec(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],d=e[8],u=d*a-s*l,f=-d*o+s*c,h=l*o-a*c,g=r*u+n*f+i*h;return g?(g=1/g,t[0]=u*g,t[1]=(-d*n+i*l)*g,t[2]=(s*n-i*a)*g,t[3]=f*g,t[4]=(d*r-i*c)*g,t[5]=(-s*r+i*o)*g,t[6]=h*g,t[7]=(-l*r+n*c)*g,t[8]=(a*r-n*o)*g,t):null}function SN(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],d=e[8];return t[0]=a*d-s*l,t[1]=i*l-n*d,t[2]=n*s-i*a,t[3]=s*c-o*d,t[4]=r*d-i*c,t[5]=i*o-r*s,t[6]=o*l-a*c,t[7]=n*c-r*l,t[8]=r*a-n*o,t}function Ql(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],l=t[8];return e*(l*o-a*c)+r*(-l*i+a*s)+n*(c*i-o*s)}function vu(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=e[8],f=r[0],h=r[1],g=r[2],p=r[3],v=r[4],w=r[5],m=r[6],y=r[7],C=r[8];return t[0]=f*n+h*a+g*l,t[1]=f*i+h*s+g*d,t[2]=f*o+h*c+g*u,t[3]=p*n+v*a+w*l,t[4]=p*i+v*s+w*d,t[5]=p*o+v*c+w*u,t[6]=m*n+y*a+C*l,t[7]=m*i+y*s+C*d,t[8]=m*o+y*c+C*u,t}function TN(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=e[8],f=r[0],h=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=c,t[6]=f*n+h*a+l,t[7]=f*i+h*s+d,t[8]=f*o+h*c+u,t}function _N(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=e[8],f=Math.sin(r),h=Math.cos(r);return t[0]=h*n+f*a,t[1]=h*i+f*s,t[2]=h*o+f*c,t[3]=h*a-f*n,t[4]=h*s-f*i,t[5]=h*c-f*o,t[6]=l,t[7]=d,t[8]=u,t}function EN(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function bN(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function DN(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function IN(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function MN(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function ON(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,c=i+i,l=r*a,d=n*a,u=n*s,f=i*a,h=i*s,g=i*c,p=o*a,v=o*s,w=o*c;return t[0]=1-u-g,t[3]=d-w,t[6]=f+v,t[1]=d+w,t[4]=1-l-g,t[7]=h-p,t[2]=f-v,t[5]=h+p,t[8]=1-l-u,t}function PN(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],d=e[8],u=e[9],f=e[10],h=e[11],g=e[12],p=e[13],v=e[14],w=e[15],m=r*s-n*a,y=r*c-i*a,C=r*l-o*a,x=n*c-i*s,S=n*l-o*s,T=i*l-o*c,_=d*p-u*g,E=d*v-f*g,D=d*w-h*g,b=u*v-f*p,I=u*w-h*p,O=f*w-h*v,M=m*O-y*I+C*b+x*D-S*E+T*_;return M?(M=1/M,t[0]=(s*O-c*I+l*b)*M,t[1]=(c*D-a*O-l*E)*M,t[2]=(a*I-s*D+l*_)*M,t[3]=(i*I-n*O-o*b)*M,t[4]=(r*O-i*D+o*E)*M,t[5]=(n*D-r*I-o*_)*M,t[6]=(p*T-v*S+w*x)*M,t[7]=(v*C-g*T-w*y)*M,t[8]=(g*S-p*C+w*m)*M,t):null}function RN(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function AN(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function LN(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function NN(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function I4(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function VN(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function kN(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function FN(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function UN(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],d=t[8],u=e[0],f=e[1],h=e[2],g=e[3],p=e[4],v=e[5],w=e[6],m=e[7],y=e[8];return Math.abs(r-u)<=In*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-f)<=In*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-h)<=In*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-g)<=In*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-p)<=In*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-v)<=In*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(c-w)<=In*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-m)<=In*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(d-y)<=In*Math.max(1,Math.abs(d),Math.abs(y))}var BN=vu,GN=I4;const WN=Object.freeze(Object.defineProperty({__proto__:null,add:NN,adjoint:SN,clone:CN,copy:xN,create:Vo,determinant:Ql,equals:UN,exactEquals:FN,frob:LN,fromMat2d:MN,fromMat4:el,fromQuat:ON,fromRotation:DN,fromScaling:IN,fromTranslation:bN,fromValues:Yd,identity:Xo,invert:ec,mul:BN,multiply:vu,multiplyScalar:VN,multiplyScalarAndAdd:kN,normalFromMat4:PN,projection:RN,rotate:_N,scale:EN,set:D4,str:AN,sub:GN,subtract:I4,translate:TN,transpose:V0},Symbol.toStringTag,{value:"Module"}));function fi(){var t=new gr(16);return gr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function $N(t){var e=new gr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function k5(t,e,r,n,i,o,a,s,c,l,d,u,f,h,g,p){var v=new gr(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=n,v[4]=i,v[5]=o,v[6]=a,v[7]=s,v[8]=c,v[9]=l,v[10]=d,v[11]=u,v[12]=f,v[13]=h,v[14]=g,v[15]=p,v}function zN(t,e,r,n,i,o,a,s,c,l,d,u,f,h,g,p,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t[9]=d,t[10]=u,t[11]=f,t[12]=h,t[13]=g,t[14]=p,t[15]=v,t}function It(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mn(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Cr(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],d=e[8],u=e[9],f=e[10],h=e[11],g=e[12],p=e[13],v=e[14],w=e[15],m=r*s-n*a,y=r*c-i*a,C=r*l-o*a,x=n*c-i*s,S=n*l-o*s,T=i*l-o*c,_=d*p-u*g,E=d*v-f*g,D=d*w-h*g,b=u*v-f*p,I=u*w-h*p,O=f*w-h*v,M=m*O-y*I+C*b+x*D-S*E+T*_;return M?(M=1/M,t[0]=(s*O-c*I+l*b)*M,t[1]=(i*I-n*O-o*b)*M,t[2]=(p*T-v*S+w*x)*M,t[3]=(f*S-u*T-h*x)*M,t[4]=(c*D-a*O-l*E)*M,t[5]=(r*O-i*D+o*E)*M,t[6]=(v*C-g*T-w*y)*M,t[7]=(d*T-f*C+h*y)*M,t[8]=(a*I-s*D+l*_)*M,t[9]=(n*D-r*I-o*_)*M,t[10]=(g*S-p*C+w*m)*M,t[11]=(u*C-d*S-h*m)*M,t[12]=(s*E-a*b-c*_)*M,t[13]=(r*b-n*E+i*_)*M,t[14]=(p*y-g*x-v*m)*M,t[15]=(d*x-u*y+f*m)*M,t):null}function jN(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],d=e[8],u=e[9],f=e[10],h=e[11],g=e[12],p=e[13],v=e[14],w=e[15];return t[0]=s*(f*w-h*v)-u*(c*w-l*v)+p*(c*h-l*f),t[1]=-(n*(f*w-h*v)-u*(i*w-o*v)+p*(i*h-o*f)),t[2]=n*(c*w-l*v)-s*(i*w-o*v)+p*(i*l-o*c),t[3]=-(n*(c*h-l*f)-s*(i*h-o*f)+u*(i*l-o*c)),t[4]=-(a*(f*w-h*v)-d*(c*w-l*v)+g*(c*h-l*f)),t[5]=r*(f*w-h*v)-d*(i*w-o*v)+g*(i*h-o*f),t[6]=-(r*(c*w-l*v)-a*(i*w-o*v)+g*(i*l-o*c)),t[7]=r*(c*h-l*f)-a*(i*h-o*f)+d*(i*l-o*c),t[8]=a*(u*w-h*p)-d*(s*w-l*p)+g*(s*h-l*u),t[9]=-(r*(u*w-h*p)-d*(n*w-o*p)+g*(n*h-o*u)),t[10]=r*(s*w-l*p)-a*(n*w-o*p)+g*(n*l-o*s),t[11]=-(r*(s*h-l*u)-a*(n*h-o*u)+d*(n*l-o*s)),t[12]=-(a*(u*v-f*p)-d*(s*v-c*p)+g*(s*f-c*u)),t[13]=r*(u*v-f*p)-d*(n*v-i*p)+g*(n*f-i*u),t[14]=-(r*(s*v-c*p)-a*(n*v-i*p)+g*(n*c-i*s)),t[15]=r*(s*f-c*u)-a*(n*f-i*u)+d*(n*c-i*s),t}function HN(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],l=t[8],d=t[9],u=t[10],f=t[11],h=t[12],g=t[13],p=t[14],v=t[15],w=e*a-r*o,m=e*s-n*o,y=e*c-i*o,C=r*s-n*a,x=r*c-i*a,S=n*c-i*s,T=l*g-d*h,_=l*p-u*h,E=l*v-f*h,D=d*p-u*g,b=d*v-f*g,I=u*v-f*p;return w*I-m*b+y*D+C*E-x*_+S*T}function Wt(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=e[8],f=e[9],h=e[10],g=e[11],p=e[12],v=e[13],w=e[14],m=e[15],y=r[0],C=r[1],x=r[2],S=r[3];return t[0]=y*n+C*s+x*u+S*p,t[1]=y*i+C*c+x*f+S*v,t[2]=y*o+C*l+x*h+S*w,t[3]=y*a+C*d+x*g+S*m,y=r[4],C=r[5],x=r[6],S=r[7],t[4]=y*n+C*s+x*u+S*p,t[5]=y*i+C*c+x*f+S*v,t[6]=y*o+C*l+x*h+S*w,t[7]=y*a+C*d+x*g+S*m,y=r[8],C=r[9],x=r[10],S=r[11],t[8]=y*n+C*s+x*u+S*p,t[9]=y*i+C*c+x*f+S*v,t[10]=y*o+C*l+x*h+S*w,t[11]=y*a+C*d+x*g+S*m,y=r[12],C=r[13],x=r[14],S=r[15],t[12]=y*n+C*s+x*u+S*p,t[13]=y*i+C*c+x*f+S*v,t[14]=y*o+C*l+x*h+S*w,t[15]=y*a+C*d+x*g+S*m,t}function Xn(t,e,r){var n=r[0],i=r[1],o=r[2],a,s,c,l,d,u,f,h,g,p,v,w;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(a=e[0],s=e[1],c=e[2],l=e[3],d=e[4],u=e[5],f=e[6],h=e[7],g=e[8],p=e[9],v=e[10],w=e[11],t[0]=a,t[1]=s,t[2]=c,t[3]=l,t[4]=d,t[5]=u,t[6]=f,t[7]=h,t[8]=g,t[9]=p,t[10]=v,t[11]=w,t[12]=a*n+d*i+g*o+e[12],t[13]=s*n+u*i+p*o+e[13],t[14]=c*n+f*i+v*o+e[14],t[15]=l*n+h*i+w*o+e[15]),t}function es(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Zr(t,e,r,n){var i=n[0],o=n[1],a=n[2],s=Math.hypot(i,o,a),c,l,d,u,f,h,g,p,v,w,m,y,C,x,S,T,_,E,D,b,I,O,M,R;return s<In?null:(s=1/s,i*=s,o*=s,a*=s,c=Math.sin(r),l=Math.cos(r),d=1-l,u=e[0],f=e[1],h=e[2],g=e[3],p=e[4],v=e[5],w=e[6],m=e[7],y=e[8],C=e[9],x=e[10],S=e[11],T=i*i*d+l,_=o*i*d+a*c,E=a*i*d-o*c,D=i*o*d-a*c,b=o*o*d+l,I=a*o*d+i*c,O=i*a*d+o*c,M=o*a*d-i*c,R=a*a*d+l,t[0]=u*T+p*_+y*E,t[1]=f*T+v*_+C*E,t[2]=h*T+w*_+x*E,t[3]=g*T+m*_+S*E,t[4]=u*D+p*b+y*I,t[5]=f*D+v*b+C*I,t[6]=h*D+w*b+x*I,t[7]=g*D+m*b+S*I,t[8]=u*O+p*M+y*R,t[9]=f*O+v*M+C*R,t[10]=h*O+w*M+x*R,t[11]=g*O+m*M+S*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function F5(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],c=e[7],l=e[8],d=e[9],u=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+d*n,t[6]=s*i+u*n,t[7]=c*i+f*n,t[8]=l*i-o*n,t[9]=d*i-a*n,t[10]=u*i-s*n,t[11]=f*i-c*n,t}function U5(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],c=e[3],l=e[8],d=e[9],u=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*n,t[1]=a*i-d*n,t[2]=s*i-u*n,t[3]=c*i-f*n,t[8]=o*n+l*i,t[9]=a*n+d*i,t[10]=s*n+u*i,t[11]=c*n+f*i,t}function B5(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],c=e[3],l=e[4],d=e[5],u=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+d*n,t[2]=s*i+u*n,t[3]=c*i+f*n,t[4]=l*i-o*n,t[5]=d*i-a*n,t[6]=u*i-s*n,t[7]=f*i-c*n,t}function ed(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function k1(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function G5(t,e,r){var n=r[0],i=r[1],o=r[2],a=Math.hypot(n,i,o),s,c,l;return a<In?null:(a=1/a,n*=a,i*=a,o*=a,s=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=n*n*l+c,t[1]=i*n*l+o*s,t[2]=o*n*l-i*s,t[3]=0,t[4]=n*i*l-o*s,t[5]=i*i*l+c,t[6]=o*i*l+n*s,t[7]=0,t[8]=n*o*l+i*s,t[9]=i*o*l-n*s,t[10]=o*o*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function XN(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function KN(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qN(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M4(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,c=i+i,l=o+o,d=n*s,u=n*c,f=n*l,h=i*c,g=i*l,p=o*l,v=a*s,w=a*c,m=a*l;return t[0]=1-(h+p),t[1]=u+m,t[2]=f-w,t[3]=0,t[4]=u-m,t[5]=1-(d+p),t[6]=g+v,t[7]=0,t[8]=f+w,t[9]=g-v,t[10]=1-(d+h),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function YN(t,e){var r=new gr(3),n=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=n*n+i*i+o*o+a*a;return u>0?(r[0]=(s*a+d*n+c*o-l*i)*2/u,r[1]=(c*a+d*i+l*n-s*o)*2/u,r[2]=(l*a+d*o+s*i-c*n)*2/u):(r[0]=(s*a+d*n+c*o-l*i)*2,r[1]=(c*a+d*i+l*n-s*o)*2,r[2]=(l*a+d*o+s*i-c*n)*2),M4(t,e,r),t}function JN(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function O4(t,e){var r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],s=e[6],c=e[8],l=e[9],d=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(c,l,d),t}function Jv(t,e){var r=new gr(3);O4(r,e);var n=1/r[0],i=1/r[1],o=1/r[2],a=e[0]*n,s=e[1]*i,c=e[2]*o,l=e[4]*n,d=e[5]*i,u=e[6]*o,f=e[8]*n,h=e[9]*i,g=e[10]*o,p=a+d+g,v=0;return p>0?(v=Math.sqrt(p+1)*2,t[3]=.25*v,t[0]=(u-h)/v,t[1]=(f-c)/v,t[2]=(s-l)/v):a>d&&a>g?(v=Math.sqrt(1+a-d-g)*2,t[3]=(u-h)/v,t[0]=.25*v,t[1]=(s+l)/v,t[2]=(f+c)/v):d>g?(v=Math.sqrt(1+d-a-g)*2,t[3]=(f-c)/v,t[0]=(s+l)/v,t[1]=.25*v,t[2]=(u+h)/v):(v=Math.sqrt(1+g-a-d)*2,t[3]=(s-l)/v,t[0]=(f+c)/v,t[1]=(u+h)/v,t[2]=.25*v),t}function P4(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],c=i+i,l=o+o,d=a+a,u=i*c,f=i*l,h=i*d,g=o*l,p=o*d,v=a*d,w=s*c,m=s*l,y=s*d,C=n[0],x=n[1],S=n[2];return t[0]=(1-(g+v))*C,t[1]=(f+y)*C,t[2]=(h-m)*C,t[3]=0,t[4]=(f-y)*x,t[5]=(1-(u+v))*x,t[6]=(p+w)*x,t[7]=0,t[8]=(h+m)*S,t[9]=(p-w)*S,t[10]=(1-(u+g))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function ZN(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],c=e[3],l=o+o,d=a+a,u=s+s,f=o*l,h=o*d,g=o*u,p=a*d,v=a*u,w=s*u,m=c*l,y=c*d,C=c*u,x=n[0],S=n[1],T=n[2],_=i[0],E=i[1],D=i[2],b=(1-(p+w))*x,I=(h+C)*x,O=(g-y)*x,M=(h-C)*S,R=(1-(f+w))*S,A=(v+m)*S,G=(g+y)*T,k=(v-m)*T,L=(1-(f+p))*T;return t[0]=b,t[1]=I,t[2]=O,t[3]=0,t[4]=M,t[5]=R,t[6]=A,t[7]=0,t[8]=G,t[9]=k,t[10]=L,t[11]=0,t[12]=r[0]+_-(b*_+M*E+G*D),t[13]=r[1]+E-(I*_+R*E+k*D),t[14]=r[2]+D-(O*_+A*E+L*D),t[15]=1,t}function S0(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,c=i+i,l=r*a,d=n*a,u=n*s,f=i*a,h=i*s,g=i*c,p=o*a,v=o*s,w=o*c;return t[0]=1-u-g,t[1]=d+w,t[2]=f-v,t[3]=0,t[4]=d-w,t[5]=1-l-g,t[6]=h+p,t[7]=0,t[8]=f+v,t[9]=h-p,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function QN(t,e,r,n,i,o,a){var s=1/(r-e),c=1/(i-n),l=1/(o-a);return t[0]=o*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*c,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function R4(t,e,r,n,i){var o=1/Math.tan(e/2),a;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}var eV=R4;function tV(t,e,r,n,i){var o=1/Math.tan(e/2),a;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(n-i),t[10]=i*a,t[14]=i*n*a):(t[10]=-1,t[14]=-n),t}function nV(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+s),l=2/(i+o);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-s)*c*.5),t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function A4(t,e,r,n,i,o,a){var s=1/(e-r),c=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*c,t[14]=(a+o)*l,t[15]=1,t}var W5=A4;function rV(t,e,r,n,i,o,a){var s=1/(e-r),c=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*c,t[14]=o*l,t[15]=1,t}function $5(t,e,r,n){var i,o,a,s,c,l,d,u,f,h,g=e[0],p=e[1],v=e[2],w=n[0],m=n[1],y=n[2],C=r[0],x=r[1],S=r[2];return Math.abs(g-C)<In&&Math.abs(p-x)<In&&Math.abs(v-S)<In?It(t):(d=g-C,u=p-x,f=v-S,h=1/Math.hypot(d,u,f),d*=h,u*=h,f*=h,i=m*f-y*u,o=y*d-w*f,a=w*u-m*d,h=Math.hypot(i,o,a),h?(h=1/h,i*=h,o*=h,a*=h):(i=0,o=0,a=0),s=u*a-f*o,c=f*i-d*a,l=d*o-u*i,h=Math.hypot(s,c,l),h?(h=1/h,s*=h,c*=h,l*=h):(s=0,c=0,l=0),t[0]=i,t[1]=s,t[2]=d,t[3]=0,t[4]=o,t[5]=c,t[6]=u,t[7]=0,t[8]=a,t[9]=l,t[10]=f,t[11]=0,t[12]=-(i*g+o*p+a*v),t[13]=-(s*g+c*p+l*v),t[14]=-(d*g+u*p+f*v),t[15]=1,t)}function iV(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=n[0],c=n[1],l=n[2],d=i-r[0],u=o-r[1],f=a-r[2],h=d*d+u*u+f*f;h>0&&(h=1/Math.sqrt(h),d*=h,u*=h,f*=h);var g=c*f-l*u,p=l*d-s*f,v=s*u-c*d;return h=g*g+p*p+v*v,h>0&&(h=1/Math.sqrt(h),g*=h,p*=h,v*=h),t[0]=g,t[1]=p,t[2]=v,t[3]=0,t[4]=u*v-f*p,t[5]=f*g-d*v,t[6]=d*p-u*g,t[7]=0,t[8]=d,t[9]=u,t[10]=f,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function oV(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function aV(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function sV(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function L4(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function N4(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function cV(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function lV(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function uV(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],d=t[8],u=t[9],f=t[10],h=t[11],g=t[12],p=t[13],v=t[14],w=t[15],m=e[0],y=e[1],C=e[2],x=e[3],S=e[4],T=e[5],_=e[6],E=e[7],D=e[8],b=e[9],I=e[10],O=e[11],M=e[12],R=e[13],A=e[14],G=e[15];return Math.abs(r-m)<=In*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-y)<=In*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-C)<=In*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(o-x)<=In*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=In*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-T)<=In*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(c-_)<=In*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-E)<=In*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(d-D)<=In*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(u-b)<=In*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(f-I)<=In*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(h-O)<=In*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(g-M)<=In*Math.max(1,Math.abs(g),Math.abs(M))&&Math.abs(p-R)<=In*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(v-A)<=In*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(w-G)<=In*Math.max(1,Math.abs(w),Math.abs(G))}var Rp=Wt,dV=L4;const Ap=Object.freeze(Object.defineProperty({__proto__:null,add:sV,adjoint:jN,clone:$N,copy:fr,create:fi,determinant:HN,equals:uV,exactEquals:lV,frob:aV,fromQuat:S0,fromQuat2:YN,fromRotation:G5,fromRotationTranslation:M4,fromRotationTranslationScale:P4,fromRotationTranslationScaleOrigin:ZN,fromScaling:k1,fromTranslation:ed,fromValues:k5,fromXRotation:XN,fromYRotation:KN,fromZRotation:qN,frustum:QN,getRotation:Jv,getScaling:O4,getTranslation:JN,identity:It,invert:Cr,lookAt:$5,mul:Rp,multiply:Wt,multiplyScalar:N4,multiplyScalarAndAdd:cV,ortho:W5,orthoNO:A4,orthoZO:rV,perspective:eV,perspectiveFromFieldOfView:nV,perspectiveNO:R4,perspectiveZO:tV,rotate:Zr,rotateX:F5,rotateY:U5,rotateZ:B5,scale:es,set:zN,str:oV,sub:dV,subtract:L4,targetTo:iV,translate:Xn,transpose:Mn},Symbol.toStringTag,{value:"Module"}));function Ie(){var t=new gr(3);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Fo(t){var e=new gr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pr(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function mt(t,e,r){var n=new gr(3);return n[0]=t,n[1]=e,n[2]=r,n}function F1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ji(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function hr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function an(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function V4(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function fV(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function hV(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function gV(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function xr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function en(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Dr(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function k4(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function ga(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Lp(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Lt(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function tn(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],c=r[2];return t[0]=i*c-o*s,t[1]=o*a-n*c,t[2]=n*s-i*a,t}function Vt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function zf(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function pV(t,e,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=e[0],c=e[1],l=e[2],d=i*l-o*c,u=o*s-n*l,f=n*c-i*s,h=i*f-o*u,g=o*d-n*f,p=n*u-i*d,v=a*2;return d*=v,u*=v,f*=v,h*=2,g*=2,p*=2,t[0]=s+d+h,t[1]=c+u+g,t[2]=l+f+p,t}function z5(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2],c=Math.sqrt(r*r+n*n+i*i),l=Math.sqrt(o*o+a*a+s*s),d=c*l,u=d&&ft(t,e)/d;return Math.acos(Math.min(Math.max(u,-1),1))}function mV(t){return t[0]=0,t[1]=0,t[2]=0,t}function O3(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Zv(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(r-o)<=In*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=In*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=In*Math.max(1,Math.abs(i),Math.abs(s))}var rn=an,vV=V4,yV=Dr,Qv=k4,k0=pr;(function(){var t=Ie();return function(e,r,n,i,o,a){var s,c;for(r||(r=3),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function F4(){var t=new gr(4);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Qg(t,e,r,n){var i=new gr(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function P3(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function wV(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a,t}function R3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function $s(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}(function(){var t=F4();return function(e,r,n,i,o,a){var s,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function tc(){var t=new gr(4);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function bh(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function CV(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>In?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function A3(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],c=r[1],l=r[2],d=r[3];return t[0]=n*d+a*s+i*l-o*c,t[1]=i*d+a*c+o*s-n*l,t[2]=o*d+a*l+n*c-i*s,t[3]=a*d-n*s-i*c-o*l,t}function ep(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],c=r[0],l=r[1],d=r[2],u=r[3],f,h,g,p,v;return h=i*c+o*l+a*d+s*u,h<0&&(h=-h,c=-c,l=-l,d=-d,u=-u),1-h>In?(f=Math.acos(h),g=Math.sin(f),p=Math.sin((1-n)*f)/g,v=Math.sin(n*f)/g):(p=1-n,v=n),t[0]=p*i+v*c,t[1]=p*o+v*l,t[2]=p*a+v*d,t[3]=p*s+v*u,t}function xV(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function SV(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[a*3+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[o*3+a]-e[a*3+o])*n,t[o]=(e[o*3+i]+e[i*3+o])*n,t[a]=(e[a*3+i]+e[i*3+a])*n}return t}var L3=Qg,U4=wV;(function(){var t=Ie(),e=mt(1,0,0),r=mt(0,1,0);return function(n,i,o){var a=ft(i,o);return a<-.999999?(tn(t,e,i),k0(t)<1e-6&&tn(t,r,i),Lt(t,t),bh(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(tn(t,i,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,U4(n,n))}})();(function(){var t=tc(),e=tc();return function(r,n,i,o,a,s){return ep(t,n,a,s),ep(e,i,o,s),ep(r,t,e,2*s*(1-s)),r}})();(function(){var t=Vo();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],U4(e,SV(e,t))}})();function xt(){var t=new gr(2);return gr!=Float32Array&&(t[0]=0,t[1]=0),t}function da(t){var e=new gr(2);return e[0]=t[0],e[1]=t[1],e}function N3(t,e){var r=new gr(2);return r[0]=t,r[1]=e,r}function ko(t,e,r){return t[0]=e,t[1]=r,t}function zr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function En(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ga(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Jd(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Bn(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function Yc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Np(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function za(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Us(t,e){return t[0]*e[0]+t[1]*e[1]}function TV(t,e,r,n){var i=e[0]-r[0],o=e[1]-r[1],a=Math.sin(n),s=Math.cos(n);return t[0]=i*s-o*a+r[0],t[1]=i*a+o*s+r[1],t}function _V(t,e){var r=t[0],n=t[1],i=e[0],o=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+o*o),s=a&&(r*i+n*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}var EV=Np,mo=En,j5=Bn;(function(){var t=xt();return function(e,r,n,i,o,a){var s,c;for(r||(r=2),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}})();function Yn(t){const e=t.indexOf(":");return t.substring(e+1)}function B4(t){let e=2166136261;for(let r=0;r<t.length;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>>0).toString(36)}const bV=1073741824;class DV{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageIdsToVolumeIdCache=new Map,this._referencedImageIdToImageIdCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*bV,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const r=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(r)}this._maxCacheSize=e},this.isCacheable=e=>{const r=this.getBytesAvailable(),n=Array.from(this._imageCache.values()).reduce((o,a)=>a.sharedCacheKey?o:o+a.sizeInBytes,0);return r+n>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,r=!1)=>{const n=this._imageCache.get(e);if(!n)return;if(n.sharedCacheKey&&!r)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=n;n.image?.referencedImageId&&this._referencedImageIdToImageIdCache.delete(n.image.referencedImageId),i?.cancelFn&&i.cancelFn(),i?.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const r=this._volumeCache.get(e);if(!r)return;const{volumeLoadObject:n,volume:i}=r;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),n.cancelFn&&n.cancelFn(),i.imageIds&&i.imageIds.forEach(o=>{const a=this._imageCache.get(o);a&&a.sharedCacheKey===e&&(a.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:r,done:n}=e.next();if(n)break;this.removeImageLoadObject(r,{force:!0}),Ye(Fe,$e.IMAGE_CACHE_IMAGE_REMOVED,{imageId:r})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:r,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(r),Ye(Fe,$e.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:r})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const r=this._volumeCache.get(e);if(r)return r.timeStamp=Date.now(),r.volumeLoadObject},this.putGeometryLoadObject=(e,r)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(r.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(r.cancelFn&&typeof r.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const n={loaded:!1,geometryId:e,geometryLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),r.promise.then(i=>{try{this._putGeometryCommon(e,i,n)}catch(o){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,o),o}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const r=this._geometryCache.get(e);if(r)return r.timeStamp=Date.now(),r.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const r=this._geometryCache.get(e);if(!r)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(r.sizeInBytes);const n={geometry:r,geometryId:e};Ye(Fe,$e.GEOMETRY_CACHE_GEOMETRY_REMOVED,n),this._decacheGeometry(e)},this._decacheGeometry=e=>{const r=this._geometryCache.get(e);if(!r)return;const{geometryLoadObject:n}=r;n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImageByReferencedImageId=e=>{const r=this._referencedImageIdToImageIdCache.get(e);if(r)return this._imageCache.get(r)?.image},this.getImage=(e,r=ho.FAR_REPLICATE)=>{if(e===void 0)throw new Error("getImage: imageId must not be undefined");const n=this._imageCache.get(e);if(n&&(n.timeStamp=Date.now(),!(n.image?.imageQualityStatus<r)))return n.image},this.getVolume=(e,r=!1)=>{if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const n=this._volumeCache.get(e);return n?(n.timeStamp=Date.now(),n.volume):r?[...this._volumeCache.values()].find(i=>i.volumeId.includes(e))?.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(r=>r.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(n=>n.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:r=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(!n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,r),this.incrementImageCacheSize(-n.sizeInBytes);const i={image:n,imageId:e};Ye(Fe,$e.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const r=this._volumeCache.get(e);if(!r)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const n={volume:r,volumeId:e};Ye(Fe,$e.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const r=this._geometryCache.get(e);if(r)return r.timeStamp=Date.now(),r.geometryLoadObject}}generateVolumeId(e){const r=e.map(Yn).sort();let n=2166136261;for(const i of r){const o=B4(i);for(let a=0;a<o.length;a++)n^=o.charCodeAt(a),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24)}return`volume-${(n>>>0).toString(36)}`}getImageIdsForVolumeId(e){return Array.from(this._imageIdsToVolumeIdCache.entries()).filter(([r,n])=>n===e).map(([r])=>r)}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,r){let n=this.getBytesAvailable();if(n>=e)return n;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function o(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(o);const a=i.map(c=>c.imageId);let s=a;r&&(s=a.filter(c=>!r.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),Ye(Fe,$e.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),n=this.getBytesAvailable(),n>=e)return n;for(const c of a)if(this.removeImageLoadObject(c),Ye(Fe,$e.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),n=this.getBytesAvailable(),n>=e)return n}_putImageCommon(e,r,n){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!r){console.warn("Image is undefined");return}if(r.sizeInBytes===void 0||Number.isNaN(r.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(r.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(r.sizeInBytes))throw new Error($e.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(r.sizeInBytes),n.loaded=!0,n.image=r,n.sizeInBytes=r.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const i={image:n};r.referencedImageId&&this._referencedImageIdToImageIdCache.set(r.referencedImageId,e),Ye(Fe,$e.IMAGE_CACHE_IMAGE_ADDED,i),n.sharedCacheKey=r.sharedCacheKey}async putImageLoadObject(e,r){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(r.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const n=this._imageCache.get(e);if(n?.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(r.cancelFn&&typeof r.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...n,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),r.promise.then(o=>{try{this._putImageCommon(e,o,i)}catch(a){throw console.debug(`Error in _putImageCommon for image ${e}:`,a),a}}).catch(o=>{throw console.debug(`Error caching image ${e}:`,o),this._imageCache.delete(e),o})}putImageSync(e,r){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,n);try{this._putImageCommon(e,r,n)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(r)return r.timeStamp=Date.now(),r.imageLoadObject}isLoaded(e){const r=this._imageCache.get(e);return r?r.loaded:!1}getVolumeContainingImageId(e){const r=Array.from(this._volumeCache.keys()),n=Yn(e);for(const i of r){const o=this._volumeCache.get(i);if(!o)return;const{volume:a}=o;if(!a.imageIds.length)return;const s=a.getImageURIIndex(n);if(s>-1)return{volume:a,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const r=Yn(e),i=Array.from(this._imageCache.keys()).find(o=>Yn(o)===r);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,r,n){if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}n.loaded=!0,n.volume=r,r.imageIds?.forEach(o=>{const a=this._imageCache.get(o);a&&(a.sharedCacheKey=e)});const i={volume:n};Ye(Fe,$e.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,r){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const n={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,n);try{this._putVolumeCommon(e,r,n)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,r){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(r.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(r.cancelFn&&typeof r.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),r.promise.then(i=>{try{this._putVolumeCommon(e,i,n)}catch(o){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,o),this._volumeCache.delete(e),o}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,r,n){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!r){console.warn("Geometry is undefined");return}if(r.sizeInBytes===void 0||Number.isNaN(r.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(r.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(r.sizeInBytes))throw new Error($e.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(r.sizeInBytes),n.loaded=!0,n.geometry=r,n.sizeInBytes=r.sizeInBytes,this.incrementGeometryCacheSize(n.sizeInBytes);const i={geometry:n};Ye(Fe,$e.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,r){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const n={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,n);try{this._putGeometryCommon(e,r,n)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,r){const n=this._imageCache.get(e);if(!n){r&&this._imageCache.set(e,{image:r,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}n.loaded&&(n.loaded=!1,n.imageLoadObject=null,this.incrementImageCacheSize(-n.sizeInBytes),n.sizeInBytes=0),n.image=r||n.image}getImageQuality(e){const r=this._imageCache.get(e)?.image;return r?r.imageQualityStatus||ho.FULL_RESOLUTION:void 0}}const Ne=new DV;function G4(t,e,r){return Math.abs(t-e)<=r}function IV(t,e,r=1e-5){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!G4(t[n],e[n],r))return!1;return!0}function V3(t){return typeof t=="number"}function k3(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Et(t,e,r=1e-5){return typeof t!=typeof e||t===null||e===null?!1:V3(t)&&V3(e)?G4(t,e,r):k3(t)&&k3(e)?IV(t,e,r):!1}const W4=t=>typeof t=="number"?-t:t?.map?t.map(W4):!t,ey=t=>typeof t=="number"?Math.abs(t):t?.map?t.map(ey):t,$4=(t,e,r=void 0)=>Et(t,W4(e),r),tp=(t,e,r=void 0)=>Et(ey(t),ey(e),r);function nr(t){return Array.isArray(t)?nr(t[0]):isFinite(t)&&!isNaN(t)}function Uo(t){return Gi(t,"vtkVolume")||Gi(t,"vtkImageSlice")}function Gi(t,e){const r="isA"in t?t:t.actor;return r?!!r.isA(e):!1}const H5=new Map;function MV(t){t.name=t.name||t.Name,H5.set(t.name,t)}function jf(t){return H5.get(t)}function z4(){return Array.from(H5.keys())}function X5(t,e){const r=$f.rgbPresetNames.map(c=>$f.getPresetByName(c)),n=z4().map(c=>jf(c)),o=r.concat(n).find(c=>{const{RGBPoints:l}=c;if(l.length!==t.length)return!1;for(let d=0;d<l.length;d+=4)if(!Et(l.slice(d+1,d+4),t.slice(d+1,d+4)))return!1;return!0});if(!o)return null;const a=[];if(Gi(e,"vtkVolume")){const c=e.getProperty().getScalarOpacity(0).getDataPointer();if(!c)return{name:o.Name};for(let l=0;l<c.length;l+=2)a.push({value:c[l],opacity:c[l+1]})}return{name:o.Name,...Array.isArray(a)&&a.length>0&&{opacity:a},...typeof a=="number"&&{opacity:a}}}function OV(t){const{volumeActor:e,preset:r,opacity:n=.9,threshold:i=null,colorRange:o=[0,5]}=t;e.getMapper().setSampleDistance(1);const s=Qs.newInstance(),c=r||$f.getPresetByName("hsv");s.applyColorMap(c),s.setMappingRange(o[0],o[1]),e.getProperty().setRGBTransferFunction(0,s),K5(e,n,i)}function j4(t,e){const r=q5(t);K5(t,e,r)}function H4(t,e){const r=Y5(t);K5(t,r,e)}function K5(t,e,r){const n=t.getMapper().getInputData().get("voxelManager");if(!n?.voxelManager)throw new Error("No voxel manager was found for the volume actor, or you cannot yet update opacity with a threshold using stacked images");const i=n.voxelManager.getRange(),o=bu.newInstance();if(r!==null){const a=Math.abs(i[1]-i[0])*.001,s=Math.max(i[0],Math.min(i[1],r));o.addPoint(i[0],0),o.addPoint(s-a,0),o.addPoint(s,e),o.addPoint(i[1],e)}else o.addPoint(i[0],e),o.addPoint(i[1],e);t.getProperty().setScalarOpacity(0,o)}function q5(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return null;const r=e.getDataPointer();if(!r||r.length<=4)return null;for(let n=0;n<r.length-2;n+=2){r[n];const i=r[n+1],o=r[n+2],a=r[n+3];if(i===0&&a>0)return o}return null}function Y5(t){const e=t.getProperty().getScalarOpacity(0);if(!e)return 1;const r=e.getDataPointer();if(!r||r.length===0)return 1;let n=0;for(let i=1;i<r.length;i+=2)r[i]>n&&(n=r[i]);return n}const PV=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:X5,getColormap:jf,getColormapNames:z4,getMaxOpacity:Y5,getThresholdValue:q5,registerColormap:MV,setColorMapTransferFunctionForVolumeActor:OV,updateOpacity:j4,updateThreshold:H4},Symbol.toStringTag,{value:"Module"}));function gf(t){if(!t)return;const e=t.getSize();for(let r=0;r<e;r++){const n=[];t.getNodeValue(r,n),n[1]=1-n[1],n[2]=1-n[2],n[3]=1-n[3],t.setNodeValue(r,n)}}const RV=(t,e,r)=>e-r/4*Math.log((1-t)/t);function td(t,e){const r=Math.abs(e-t)+1,n=(t+e+1)/2;return{windowWidth:r,windowCenter:n}}function tl(t,e,r=ui.LINEAR){if(r===ui.LINEAR||r===ui.SAMPLED_SIGMOID)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(r===ui.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};throw new Error("Invalid VOI LUT function")}const AV=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:tl,toWindowLevel:td},Symbol.toStringTag,{value:"Module"}));function J5(t,e=1024){const{windowWidth:r,windowCenter:n}=td(t.lower,t.upper),o=Array.from({length:e},(s,c)=>(c+1)/(e+2)).flatMap(s=>[RV(s,n,r),s,s,s,.5,0]),a=Qs.newInstance();return a.buildFunctionFromArray(Ot.newInstance({values:o,numberOfComponents:6})),a}function br(t,e){return t.worldToIndex(e).map(Math.round)}function np(t,e){return t.worldToIndex(e)}function Vp(t){const e=t.getSize(),r=[];for(let n=0;n<e;n++){const i=[];t.getNodeValue(n,i),r.push(i)}return r}function U1(t,e){e?.length&&(t.removeAllPoints(),e.forEach(r=>{t.addRGBPoint(...r)}))}const LV=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:Vp,setTransferFunctionNodes:U1},Symbol.toStringTag,{value:"Module"}));function NV(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=r=>{if(!e.transform)return t.evaluateFunction(r);const n=[];return e.transform.transformPoint(r,n),t.evaluateFunction(n)},t.evaluateFunction=r=>{Z.vtkErrorMacro("not implemented")}}const VV={};function X4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VV,r),Z.obj(t,e),Z.setGet(t,e,["transform"]),NV(t,e)}const kV=Z.newInstance(X4,"vtkImplicitFunction");var FV={newInstance:kV,extend:X4};const ty=1e-6,K4="coincide",q4="disjoint";function UV(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function Y4(t,e,r){const n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function J4(t,e,r,n){const i=[];Hr(t,e,i);const o=jt(r,i);n[0]=t[0]-o*r[0],n[1]=t[1]-o*r[1],n[2]=t[2]-o*r[2]}function Z4(t,e,r){const n=jt(t,e);let i=jt(e,e);return i===0&&(i=1),r[0]=t[0]-n*e[0]/i,r[1]=t[1]-n*e[1]/i,r[2]=t[2]-n*e[2]/i,r}function Q4(t,e,r,n){const i=[];Hr(t,e,i);const o=jt(r,i),a=jt(r,r);a!==0?(n[0]=t[0]-o*r[0]/a,n[1]=t[1]-o*r[1]/a,n[2]=t[2]-o*r[2]/a):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function e8(t,e,r,n){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},o=[],a=[];Hr(e,t,o),Hr(r,t,a);const s=jt(n,a),c=jt(n,o);let l,d;return c<0?l=-c:l=c,s<0?d=-s*ty:d=s*ty,l<=d||(i.t=s/c,i.x[0]=t[0]+i.t*o[0],i.x[1]=t[1]+i.t*o[1],i.x[2]=t[2]+i.t*o[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function t8(t,e,r,n){const i={intersection:!1,l0:[],l1:[],error:null},o=[];Bi(e,n,o);const a=o.map(u=>Math.abs(u));if(a[0]+a[1]+a[2]<ty){const u=[];return Hr(t,r,u),jt(e,u)===0?i.error=K4:i.error=q4,i}let s;a[0]>a[1]&&a[0]>a[2]?s="x":a[1]>a[2]?s="y":s="z";const c=[],l=-jt(e,t),d=-jt(n,r);switch(s){case"x":c[0]=0,c[1]=(d*e[2]-l*n[2])/o[0],c[2]=(l*n[1]-d*e[1])/o[0];break;case"y":c[0]=(l*n[2]-d*e[2])/o[1],c[1]=0,c[2]=(d*e[0]-l*n[0])/o[1];break;case"z":c[0]=(d*e[1]-l*n[1])/o[2],c[1]=(l*n[0]-d*e[0])/o[2],c[2]=0;break}return i.l0=c,R0(c,o,i.l1),i.intersection=!0,i}const BV={evaluate:UV,distanceToPlane:Y4,projectPoint:J4,projectVector:Z4,generalizedProjectPoint:Q4,intersectWithLine:e8,intersectWithPlane:t8,DISJOINT:q4,COINCIDE:K4};function GV(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=r=>Y4(r,e.origin,e.normal),t.projectPoint=(r,n)=>{J4(r,e.origin,e.normal,n)},t.projectVector=(r,n)=>Z4(r,e.normal,n),t.push=r=>{if(r!==0)for(let n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=(r,n)=>{Q4(r,e.origin,e.normal,n)},t.evaluateFunction=(r,n,i)=>Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=r=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(r,n)=>e8(r,n,e.origin,e.normal),t.intersectWithPlane=(r,n)=>t8(r,n,e.origin,e.normal)}const WV={normal:[0,0,1],origin:[0,0,0]};function n8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WV,r),FV.extend(t,e,r),Z.setGetArray(t,e,["normal","origin"],3),GV(t,e)}const $V=Z.newInstance(n8,"vtkPlane");var Kn={newInstance:$V,extend:n8,...BV};const B1=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function r8(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function nc(t){return t?.length>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function Z5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Q5(t){return Z5(t,B1)}function kp(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=i<e?i:e,t[1]=o>e?o:e,t[2]=a<r?a:r,t[3]=s>r?s:r,t[4]=c<n?c:n,t[5]=l>n?l:n,t}function ew(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let r=0;r<e.length;++r)kp(t,...e[r]);else for(let r=0;r<e.length;r+=3)kp(t,...e.slice(r,r+3));return t}function i8(t,e,r,n,i,o,a){const[s,c,l,d,u,f]=t;return a===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],d),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],f)):(t[0]=Math.min(e,s),t[1]=Math.max(r,c),t[2]=Math.min(n,l),t[3]=Math.max(i,d),t[4]=Math.min(o,u),t[5]=Math.max(a,f)),t}function o8(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=e,t[1]=e>o?e:o,t[2]=r,t[3]=r>s?r:s,t[4]=n,t[5]=n>l?n:l,i!==e||a!==r||c!==n}function a8(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=r<a?r:a,t[3]=r,t[4]=n<c?n:c,t[5]=n,o!==e||s!==r||l!==n}function tw(t,e){return e==null?zV(t):(t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t)}function zV(t){const e=[0,0,0];let r=-1,n=0,i=0;for(let o=0;o<3;++o)i=t[o*2+1]-t[o*2],i>n&&(n=i,r=o),e[o]=i>0?1:0;if(r<0)return tw(t,.5);for(let o=0;o<3;++o)if(!e[o]){const a=.005*n;t[o*2]-=a,t[o*2+1]+=a}return t}function nw(t,e,r,n){return nc(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function rw(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function jV(t,e,r,n){if(!nc(t))return!1;const i=rw(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],nw(t,e,r,n),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function pf(t,e){return t[e*2+1]-t[e*2]}function Dh(t){return[pf(t,0),pf(t,1),pf(t,2)]}function s8(t){return t.slice(0,2)}function c8(t){return t.slice(2,4)}function l8(t){return t.slice(4,6)}function u8(t){const e=Dh(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function iw(t){if(nc(t)){const e=Dh(t);return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}return null}function d8(t){const e=iw(t);return e!==null?Math.sqrt(e):null}function G1(t){return[t[0],t[2],t[4]]}function W1(t){return[t[1],t[3],t[5]]}function og(t,e){return t<=0&&e>=0||t>=0&&e<=0}function ow(t,e){return e[0]=[t[0],t[2],t[4]],e[1]=[t[0],t[2],t[5]],e[2]=[t[0],t[3],t[4]],e[3]=[t[0],t[3],t[5]],e[4]=[t[1],t[2],t[4]],e[5]=[t[1],t[2],t[5]],e[6]=[t[1],t[3],t[4]],e[7]=[t[1],t[3],t[5]],e}function f8(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function h8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const n=ow(t,[]);for(let i=0;i<n.length;++i)Vt(n[i],n[i],e);return Q5(r),ew(r,n)}function g8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function p8(t,e,r,n){const i=[].concat(B1),o=t.getData();for(let a=0;a<o.length;a+=3){const s=[o[a],o[a+1],o[a+2]],c=jt(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=jt(s,r);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const d=jt(s,n);i[4]=Math.min(d,i[4]),i[5]=Math.max(d,i[5])}return i}function m8(t,e,r,n,i){let o=!0;const a=[];let s=0;const c=[],l=[0,0,0],d=0,u=1,f=2;for(let h=0;h<3;h++)e[h]<t[2*h]?(a[h]=u,l[h]=t[2*h],o=!1):e[h]>t[2*h+1]?(a[h]=d,l[h]=t[2*h+1],o=!1):a[h]=f;if(o)return n[0]=e[0],n[1]=e[1],n[2]=e[2],i[0]=0,1;for(let h=0;h<3;h++)a[h]!==f&&r[h]!==0?c[h]=(l[h]-e[h])/r[h]:c[h]=-1;for(let h=0;h<3;h++)c[s]<c[h]&&(s=h);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let h=0;h<3;h++)if(s!==h){if(n[h]=e[h]+c[s]*r[h],n[h]<t[2*h]||n[h]>t[2*h+1])return 0}else n[h]=l[h];return 1}function v8(t,e,r){const n=[];let i=0,o=1,a=1;for(let s=4;s<=5;++s){n[2]=t[s];for(let c=2;c<=3;++c){n[1]=t[c];for(let l=0;l<=1;++l)if(n[0]=t[l],i=Kn.evaluate(r,e,n),a&&(o=i>=0?1:-1,a=0),i===0||o>0&&i<0||o<0&&i>0)return 1}}return 0}function y8(t,e){if(!(nc(t)&&nc(e)))return!1;const r=[0,0,0,0,0,0];let n;for(let i=0;i<3;i++)if(n=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(n=!0,r[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(n=!0,r[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(n=!0,r[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(n=!0,r[i*2+1]=t[i*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function Fp(t,e){if(!(nc(t)&&nc(e)))return!1;for(let r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function Up(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function HV(t,e){return!(!Fp(t,e)||!Up(t,...G1(e))||!Up(t,...W1(e)))}function w8(t,e,r){const n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let o=0;for(let u=0;u<2;u++)for(let f=2;f<4;f++)for(let h=4;h<6;h++){const g=[t[u],t[f],t[h]];i[o++]=Kn.evaluate(r,e,g)}let a=2;for(;a--&&!(og(i[n[a][0]],i[n[a][4]])&&og(i[n[a][1]],i[n[a][5]])&&og(i[n[a][2]],i[n[a][6]])&&og(i[n[a][3]],i[n[a][7]])););if(a<0)return!1;const s=Math.sign(r[a]),c=Math.abs((t[a*2+1]-t[a*2])*r[a]);let l=s>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const f=Math.abs(i[n[a][u]])/c;s>0&&f<l&&(l=f),s<0&&f>l&&(l=f)}const d=(1-l)*t[a*2]+l*t[a*2+1];return s>0?t[a*2]=d:t[a*2+1]=d,!0}function C8(t,e){for(let n=0;n<3;++n)e[n]=e[n]<1?1:e[n];let r=e[0]*e[1]*e[2];for(;r>t;){for(let n=0;n<3;++n)e[n]=e[n]>1?e[n]-1:1;r=e[0]*e[1]*e[2]}}function x8(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];e=e<=0?1:e;let i=0;const o=[0,0,0];let a=-1,s=0;const c=Dh(t),l=c[0]+c[1]+c[2],d=l*(.001/3);for(let p=0;p<3;++p)c[p]>s&&(a=p,s=c[p]),c[p]>d?(o[p]=1,i++):o[p]=0;const u=G1(t),f=W1(t);if(i<1)return r[0]=1,r[1]=1,r[2]=1,n[0]=u[0]-.5,n[1]=f[0]+.5,n[2]=u[1]-.5,n[3]=f[1]+.5,n[4]=u[2]-.5,n[5]=f[2]+.5,1;let h=e;h/=o[0]?c[0]/l:1,h/=o[1]?c[1]/l:1,h/=o[2]?c[2]/l:1,h**=1/i;for(let p=0;p<3;++p)r[p]=o[p]?Math.floor(h*c[p]/l):1,r[p]=r[p]<1?1:r[p];C8(e,r);const g=.5*c[a]/r[a];for(let p=0;p<3;++p)o[p]?(n[2*p]=u[p],n[2*p+1]=f[p]):(n[2*p]=u[p]-g,n[2*p+1]=f[p]+g);return r[0]*r[1]*r[2]}function S8(t,e){if(t[0]>=e[0]&&t[0]<=e[1]&&t[1]>=e[2]&&t[1]<=e[3]&&t[2]>=e[4]&&t[2]<=e[5])return 0;const r=[0,0,0];return t[0]<e[0]?r[0]=e[0]-t[0]:t[0]>e[1]&&(r[0]=t[0]-e[1]),t[1]<e[2]?r[1]=e[2]-t[1]:t[1]>e[3]&&(r[1]=t[1]-e[3]),t[2]<e[4]?r[2]=e[4]-t[2]:t[2]>e[5]&&(r[2]=t[2]-e[5]),jt(r,r)}class XV{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(B1))}getBounds(){return this.bounds}equals(e){return r8(this.bounds,e)}isValid(){return nc(this.bounds)}setBounds(e){return Z5(this.bounds,e)}reset(){return Q5(this.bounds)}addPoint(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return kp(this.bounds,...r)}addPoints(e){return ew(this.bounds,e)}addBounds(e,r,n,i,o,a){return i8(this.bounds,e,r,n,i,o,a)}setMinPoint(e,r,n){return o8(this.bounds,e,r,n)}setMaxPoint(e,r,n){return a8(this.bounds,e,r,n)}inflate(e){return tw(this.bounds,e)}scale(e,r,n){return nw(this.bounds,e,r,n)}getCenter(){return rw(this.bounds)}getLength(e){return pf(this.bounds,e)}getLengths(){return Dh(this.bounds)}getMaxLength(){return u8(this.bounds)}getDiagonalLength(){return d8(this.bounds)}getDiagonalLength2(){return iw(this.bounds)}getMinPoint(){return G1(this.bounds)}getMaxPoint(){return W1(this.bounds)}getXRange(){return s8(this.bounds)}getYRange(){return c8(this.bounds)}getZRange(){return l8(this.bounds)}getCorners(e){return ow(this.bounds,e)}computeCornerPoints(e,r){return f8(this.bounds,e,r)}computeLocalBounds(e,r,n){return p8(this.bounds,e,r,n)}transformBounds(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return h8(this.bounds,e,r)}computeScale3(e){return g8(this.bounds,e)}cutWithPlane(e,r){return w8(this.bounds,e,r)}intersectBox(e,r,n,i){return m8(this.bounds,e,r,n,i)}intersectPlane(e,r){return v8(this.bounds,e,r)}intersect(e){return y8(this.bounds,e)}intersects(e){return Fp(this.bounds,e)}containsPoint(e,r,n){return Up(this.bounds,e,r,n)}contains(e){return Fp(this.bounds,e)}computeDivisions(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return x8(this.bounds,e,r,n)}distance2ToBounds(e){return S8(e,this.bounds)}}function KV(t){const e=t&&t.bounds;return new XV(e)}const qV={equals:r8,isValid:nc,setBounds:Z5,reset:Q5,addPoint:kp,addPoints:ew,addBounds:i8,setMinPoint:o8,setMaxPoint:a8,inflate:tw,scale:nw,scaleAboutCenter:jV,getCenter:rw,getLength:pf,getLengths:Dh,getMaxLength:u8,getDiagonalLength:d8,getDiagonalLength2:iw,getMinPoint:G1,getMaxPoint:W1,getXRange:s8,getYRange:c8,getZRange:l8,getCorners:ow,computeCornerPoints:f8,computeLocalBounds:p8,transformBounds:h8,computeScale3:g8,cutWithPlane:w8,intersectBox:m8,intersectPlane:v8,intersect:y8,intersects:Fp,containsPoint:Up,contains:HV,computeDivisions:x8,clampDivisions:C8,distance2ToBounds:S8,INIT_BOUNDS:B1};var bn={newInstance:KV,...qV};const YV={DISPLAY:0,WORLD:1};var T8={CoordinateSystem:YV};const{CoordinateSystem:ny}=T8;function F3(t){return()=>Z.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function JV(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let r=e.mtime;for(let n=0;n<e.textures.length;++n){const i=e.textures[n].getMTime();i>r&&(r=i)}return r},t.processSelectorPixelBuffers=(r,n)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=F3("pick"),t.hasKey=F3("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=r=>{e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=r=>{e.estimatedRenderTime+=r},t.setAllocatedRenderTime=r=>{e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=r=>e.textures.indexOf(r)!==-1,t.addTexture=r=>{r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=r=>{const n=e.textures.filter(i=>i!==r);e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(ny.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(ny.DISPLAY)}const ZV={allocatedRenderTime:10,coordinateSystem:ny.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function _8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZV,r),Z.obj(t,e),Z.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),Z.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),Z.moveToProtected(t,e,["parentProp"]),JV(t,e)}const QV=Z.newInstance(_8,"vtkProp");var E8={newInstance:QV,extend:_8,...T8};const ek=1e-6;function tk(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=n=>{e.position=e.position.map((i,o)=>i+n[o]),t.modified()},t.getOrientationWXYZ=()=>{const n=tc();Jv(n,e.rotation);const i=new Float64Array(3),o=CV(i,n);return[Mp(o),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Jv(n,e.rotation)},t.rotateX=n=>{n!==0&&(F5(e.rotation,e.rotation,cr(n)),t.modified())},t.rotateY=n=>{n!==0&&(U5(e.rotation,e.rotation,cr(n)),t.modified())},t.rotateZ=n=>{n!==0&&(B5(e.rotation,e.rotation,cr(n)),t.modified())},t.rotateWXYZ=(n,i,o,a)=>{if(n===0||i===0&&o===0&&a===0)return;const s=cr(n),c=tc();bh(c,[i,o,a],s);const l=new Float64Array(16);S0(l,c),Wt(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=n=>{if(Math.abs(n[3])>=1-ek)return;const i=S0(new Float64Array(16),n);Wt(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(n,i,o)=>n===e.orientation[0]&&i===e.orientation[1]&&o===e.orientation[2]?!1:(e.orientation=[n,i,o],It(e.rotation),t.rotateZ(o),t.rotateX(n),t.rotateY(i),t.modified(),!0),t.setOrientationFromQuaternion=n=>{const i=fi();return S0(i,n),A0(i,e.rotation)?!1:(e.rotation=i,t.modified(),!0)},t.setUserMatrix=n=>A0(e.userMatrix,n)?!1:(fr(e.userMatrix,n),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){It(e.matrix),e.userMatrix&&Wt(e.matrix,e.matrix,e.userMatrix),Xn(e.matrix,e.matrix,e.origin),Xn(e.matrix,e.matrix,e.position),Wt(e.matrix,e.matrix,e.rotation),es(e.matrix,e.matrix,e.scale),Xn(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),Mn(e.matrix,e.matrix),e.isIdentity=!0;for(let n=0;n<4;++n)for(let i=0;i<4;++i)(n===i?1:0)!==e.matrix[n+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getBoundsByReference=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n,e.bounds=[...bn.INIT_BOUNDS],e.boundsMTime.modified(),n;if(!e.mapperBounds||!n.every((i,o)=>n[o]===e.mapperBounds[o])||t.getMTime()>e.boundsMTime.getMTime()){Z.vtkDebugMacro("Recomputing bounds..."),e.mapperBounds=n,t.computeMatrix();const i=new Float64Array(16);Mn(i,e.matrix),bn.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBounds=()=>{const n=t.getBoundsByReference();try{return[...n]}catch{return n}},t.getCenter=()=>bn.getCenter(e.bounds),t.getLength=()=>bn.getLength(e.bounds),t.getXRange=()=>bn.getXRange(e.bounds),t.getYRange=()=>bn.getYRange(e.bounds),t.getZRange=()=>bn.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function r(){t.computeMatrix()}t.onModified(r),t.getProperty=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.properties[n]==null&&(e.properties[n]=t.makeProperty?.()),e.properties[n]},t.getProperties=()=>(e.properties.length===0&&(e.properties[0]=t.makeProperty?.()),e.properties),t.setProperty=(n,i)=>{const o=Number.isInteger(n),[a,s]=o?[n,i]:[0,n];return e.properties[a]===s?!1:(e.properties[a]=s,!0)},t.getMTime=()=>{let n=e.mtime;return e.properties.forEach(i=>{if(i!==null){const o=i.getMTime();n=o>n?o:n}}),n}}const nk={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[...bn.INIT_BOUNDS],properties:[],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function b8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nk,r),E8.extend(t,e,r),e.matrixMTime={},Z.obj(e.matrixMTime),Z.get(t,e,["isIdentity"]),Z.getArray(t,e,["orientation"]),Z.setGetArray(t,e,["origin","position","scale"],3),Z.setGet(t,e,["properties"]),e.matrix=It(new Float64Array(16)),e.rotation=It(new Float64Array(16)),e.userMatrix=It(new Float64Array(16)),e.transform=null,tk(t,e)}const rk=Z.newInstance(b8,"vtkProp3D");var aw={newInstance:rk,extend:b8};const D8={NEAREST:0,LINEAR:1,FAST_LINEAR:2},I8={FRACTIONAL:0,PROPORTIONAL:1},rp={DEFAULT:0,ADDITIVE:1,COLORIZE:2,CUSTOM:3},ik={OFF:0,NORMALIZED:1,RAW:2};var M8={InterpolationType:D8,OpacityMode:I8,ColorMixPreset:rp,FilterMode:ik};const{InterpolationType:Zd,OpacityMode:ok,FilterMode:Qd,ColorMixPreset:ak}=M8,{vtkErrorMacro:d2}=Z,ip=4;function sk(t,e){e.classHierarchy.push("vtkVolumeProperty");const r={...t};t.getMTime=()=>{let o=e.mtime,a;for(let s=0;s<ip;s++)e.componentData[s].colorChannels===1?e.componentData[s].grayTransferFunction&&(a=e.componentData[s].grayTransferFunction.getMTime(),o=o>a?o:a):e.componentData[s].colorChannels===3&&e.componentData[s].rGBTransferFunction&&(a=e.componentData[s].rGBTransferFunction.getMTime(),o=o>a?o:a),e.componentData[s].scalarOpacity&&(a=e.componentData[s].scalarOpacity.getMTime(),o=o>a?o:a),e.componentData[s].gradientOpacity&&(e.componentData[s].disableGradientOpacity||(a=e.componentData[s].gradientOpacity.getMTime(),o=o>a?o:a));return o},t.getColorChannels=o=>o<0||o>3?(d2("Bad index - must be between 0 and 3"),0):e.componentData[o].colorChannels,t.setGrayTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[o].grayTransferFunction!==a&&(e.componentData[o].grayTransferFunction=a,s=!0),e.componentData[o].colorChannels!==1&&(e.componentData[o].colorChannels=1,s=!0),s&&t.modified(),s},t.getGrayTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[o].grayTransferFunction===null&&(e.componentData[o].grayTransferFunction=bu.newInstance(),e.componentData[o].grayTransferFunction.addPoint(0,0),e.componentData[o].grayTransferFunction.addPoint(1024,1),e.componentData[o].colorChannels!==1&&(e.componentData[o].colorChannels=1),t.modified()),e.componentData[o].grayTransferFunction},t.setRGBTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[o].rGBTransferFunction!==a&&(e.componentData[o].rGBTransferFunction=a,s=!0),e.componentData[o].colorChannels!==3&&(e.componentData[o].colorChannels=3,s=!0),s&&t.modified(),s},t.getRGBTransferFunction=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[o].rGBTransferFunction===null&&(e.componentData[o].rGBTransferFunction=Qs.newInstance(),e.componentData[o].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[o].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[o].colorChannels!==3&&(e.componentData[o].colorChannels=3),t.modified()),e.componentData[o].rGBTransferFunction},t.setScalarOpacity=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[o].scalarOpacity!==a?(e.componentData[o].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[o].scalarOpacity===null&&(e.componentData[o].scalarOpacity=bu.newInstance(),e.componentData[o].scalarOpacity.addPoint(0,1),e.componentData[o].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[o].scalarOpacity},t.setComponentWeight=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(o<0||o>=ip)return d2("Invalid index"),!1;const s=Math.min(1,Math.max(0,a));return e.componentData[o].componentWeight!==s?(e.componentData[o].componentWeight=s,t.modified(),!0):!1},t.getComponentWeight=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return o<0||o>=ip?(d2("Invalid index"),0):e.componentData[o].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(Zd.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(Zd.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(Zd.FAST_LINEAR),t.getInterpolationTypeAsString=()=>Z.enumToString(Zd,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(o=>{const a=Z.capitalize(o);t[`set${a}`]=(s,c)=>e.componentData[s][`${o}`]!==c?(e.componentData[s][`${o}`]=c,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(o=>{const a=Z.capitalize(o);t[`get${a}`]=s=>e.componentData[s][`${o}`]}),t.setAverageIPScalarRange=(o,a)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(o,a)},t.getFilterModeAsString=()=>Z.enumToString(Qd,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(Qd.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(Qd.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(Qd.RAW)},t.setGlobalIlluminationReach=o=>r.setGlobalIlluminationReach(ua(o,0,1)),t.setVolumetricScatteringBlending=o=>r.setVolumetricScatteringBlending(ua(o,0,1)),t.setAnisotropy=o=>r.setAnisotropy(ua(o,-.99,.99)),t.setLAOKernelSize=o=>r.setLAOKernelSize(D5(ua(o,1,32))),t.setLAOKernelRadius=o=>r.setLAOKernelRadius(o>=1?o:1)}const ck=t=>({colorMixPreset:ak.DEFAULT,independentComponents:!0,interpolationType:Zd.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,ipScalarRange:[-1e6,1e6],filterMode:Qd.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7,updatedExtents:[],...t});function lk(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,ck(r)),Z.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<ip;++n)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:ok.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}Z.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius","updatedExtents"]),Z.setGetArray(t,e,["ipScalarRange"],2),Z.setGetArray(t,e,["labelOutlineThickness"]),sk(t,e)}const uk=Z.newInstance(lk,"vtkVolumeProperty");var dk={newInstance:uk,...M8};function fk(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>[t],t.makeProperty=dk.newInstance,t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return r}}const hk={mapper:null};function O8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hk,r),aw.extend(t,e,r),e.boundsMTime={},Z.obj(e.boundsMTime),Z.setGet(t,e,["mapper"]),fk(t,e)}const gk=Z.newInstance(O8,"vtkVolume");var pk={newInstance:gk,extend:O8};const{vtkErrorMacro:mk}=Z,vk=["Build","Render"];function yk(t,e){e.classHierarchy.push("vtkViewNode"),t.build=n=>{},t.render=n=>{},t.traverse=n=>{const i=n.getTraverseOperation(),o=t[i];if(o){o(n);return}t.apply(n,!0);for(let a=0;a<e.children.length;a++)e.children[a].traverse(n);t.apply(n,!1)},t.apply=(n,i)=>{const o=t[n.getOperation()];o&&o(i,n)},t.getViewNodeFor=n=>{if(e.renderable===n)return t;for(let i=0;i<e.children.length;++i){const a=e.children[i].getViewNodeFor(n);if(a)return a}},t.getFirstAncestorOfType=n=>e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null,t.getLastAncestorOfType=n=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(n);return i||(e._parent.isA(n)?e._parent:null)},t.addMissingNode=n=>{if(!n)return;const i=e._renderableChildMap.get(n);if(i!==void 0)return i.setVisited(!0),i;const o=t.createViewNode(n);if(o)return o.setParent(t),o.setVisited(!0),e._renderableChildMap.set(n,o),e.children.push(o),o},t.addMissingNodes=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!n||!n.length))for(let o=0;o<n.length;++o){const a=n[o],s=t.addMissingNode(a);if(i&&s!==void 0&&e.children[o]!==s){for(let c=o+1;c<e.children.length;++c)if(e.children[c]===s){e.children.splice(c,1),e.children.splice(o,0,s);break}}}},t.addMissingChildren=n=>{if(!(!n||!n.length))for(let i=0;i<n.length;++i){const o=n[i];if(e.children.indexOf(o)===-1){o.setParent(t),e.children.push(o);const s=o.getRenderable();s&&e._renderableChildMap.set(s,o)}o.setVisited(!0)}},t.removeNode=n=>{const i=e.children.findIndex(a=>a===n);if(i<0)return!1;const o=n.getRenderable();return o&&e._renderableChildMap.delete(o),n.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=n=>{e.visited=n},t.removeUnusedNodes=()=>{let n=0;for(let i=0;i<e.children.length;++i){const o=e.children[i];if(o.getVisited())e.children[n++]=o,o.setVisited(!1);else{const s=o.getRenderable();s&&e._renderableChildMap.delete(s),o.delete()}}e.children.length=n},t.createViewNode=n=>{if(!e.myFactory)return mk("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(n);return i&&i.setRenderable(n),i};const r=t.delete;t.delete=()=>{for(let n=0;n<e.children.length;n++)e.children[n].delete();r()}}const wk={renderable:null,myFactory:null,children:[],visited:!1};function P8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wk,r),Z.obj(t,e),Z.event(t,e,"event"),e._renderableChildMap=new Map,Z.get(t,e,["visited"]),Z.setGet(t,e,["_parent","renderable","myFactory"]),Z.getArray(t,e,["children"]),Z.moveToProtected(t,e,["parent"]),yk(t,e)}const Ck=Z.newInstance(P8,"vtkViewNode");var Ir={newInstance:Ck,extend:P8,PASS_TYPES:vk};function xk(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,i=r.getClassName(n++),o=!1;const a=Object.keys(e.overrides);for(;i&&!o;)a.indexOf(i)!==-1?o=!0:i=r.getClassName(n++);if(!o)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const Sk={};function R8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sk,r),Z.obj(t,e),xk(t,e)}const Tk=Z.newInstance(R8,"vtkViewNodeFactory");var sw={newInstance:Tk,extend:R8};const A8=Object.create(null);function ti(t,e){A8[t]=e}function _k(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const Ek={};function L8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ek,r),e.overrides=A8,sw.extend(t,e,r),_k(t,e)}const bk=Z.newInstance(L8,"vtkOpenGLViewNodeFactory");var Dk={newInstance:bk,extend:L8};function Ik(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=r=>{if(r){const n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=r=>{if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){fr(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),el(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),ec(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Mn(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const n=e._openGLRenderer.getAspectRatio();fr(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),Mn(e.keyMatrices.vcpc,e.keyMatrices.vcpc),Wt(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}const Mk={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function Ok(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mk,r),Ir.extend(t,e,r),e.keyMatrixTime={},Jn(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Ur(t,e,["context","keyMatrixTime"]),Ik(t,e)}const N8=zn(Ok);var Pk={newInstance:N8};ti("vtkCamera",N8);const{vtkDebugMacro:Rk}=Oi;function Ak(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let i=0;i<n.length;++i)n[i].getSwitch()>0&&r++;return r||(Rk("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=r=>{if(r){let n=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),n|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const o=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.colorMask(!0,!0,!0,!0),n&&i.clear(n),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.cameraPass=r=>{r&&t.clear()},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],i=r[0]-n[0],o=r[1]-n[1],a=e._parent.normalizedDisplayToDisplay(i,o),s=Math.round(a[0]),c=Math.round(a[1]),l=r[2]-n[0],d=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(l,d);let f=Math.round(u[0])-s,h=Math.round(u[1])-c;return f<0&&(f=0),h<0&&(h=0),{usize:f,vsize:h,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let r=0;const n=e.context;if(!e.renderable.getTransparent()){const o=e.renderable.getBackgroundByReference();n.clearColor(o[0],o[1],o[2],o[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,n.depthMask(!0)),n.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(r=>{r.modified()})},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const Lk={context:null,_openGLRenderWindow:null,selector:null};function Nk(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lk,r),Ir.extend(t,e,r),ji(t,e,["shaderCache"]),Ur(t,e,["selector"]),Sh(t,e,["openGLRenderWindow"]),Ak(t,e)}const V8=zn(Nk,"vtkOpenGLRenderer");var Vk={newInstance:V8};ti("vtkRenderer",V8);const{isVtkObject:kk}=Z;function k8(t){let e=0;return t.filter((r,n)=>n===e?(e+=r+1,!0):!1)}function F8(t){let e=0;for(let r=0;r<t.length;)r+=t[r]+1,e++;return e}const Fk={extractCellSizes:k8,getNumberOfCells:F8};function Uk(t,e){e.classHierarchy.push("vtkCellArray");const r={...t};t.getNumberOfCells=n=>(e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=F8(t.getData())),e.numberOfCells),t.getCellSizes=n=>(e.cellSizes!==void 0&&!n||(e.cellSizes=k8(t.getData())),e.cellSizes),t.resize=n=>{const i=t.getNumberOfTuples();r.resize(n);const o=t.getNumberOfTuples();o<i&&(o===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=n=>{r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=n=>{let i=n;const o=e.values[i++];return e.values.subarray(i,i+o)},t.insertNextCell=n=>{let i;kk(n)?i=n.getPointsIds():i=n;const o=t.getNumberOfCells();return t.insertNextTuples([i.length,...i]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(i.length),o},t.getMaxCellSize=()=>t.getCellSizes().reduce((n,i)=>Math.max(n,i),0)}function Bk(t){return{empty:!0,numberOfComponents:1,dataType:Zt.UNSIGNED_INT,...t}}function U8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ot.extend(t,e,Bk(r)),Uk(t,e)}const Gk=Z.newInstance(U8,"vtkCellArray");var ll={newInstance:Gk,extend:U8,...Fk};const{vtkErrorMacro:Wk}=Z;function $k(t,e){let r=0;e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==o&&(e.size=o*a,e.values=Z.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(a),t.modified())},t.setPoint=function(o){for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];t.setTuple(o,s)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(o,a,s)=>t.insertNextTuple([o,a,s]),t.insertPoint=(o,a)=>t.insertTuple(o,a);const n=t.getBounds;t.getBounds=()=>(r<e.mtime&&t.computeBounds(),n());const i=t.getBoundsByReference;t.getBoundsByReference=()=>(r<e.mtime&&t.computeBounds(),i()),t.computeBounds=()=>{if(t.getNumberOfComponents()===3){const o=t.getRange(0);e.bounds[0]=o[0],e.bounds[1]=o[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const s=t.getRange(2);e.bounds[4]=s[0],e.bounds[5]=s[1]}else if(t.getNumberOfComponents()===2){const o=t.getRange(0);e.bounds[0]=o[0],e.bounds[1]=o[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1],e.bounds[4]=0,e.bounds[5]=0}else Wk(`getBounds called on an array with components of ${t.getNumberOfComponents()}`),P5(e.bounds);r=Z.getCurrentGlobalMTime()},t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const zk={empty:!0,numberOfComponents:3,dataType:Zt.FLOAT,bounds:[1,-1,1,-1,1,-1]};function B8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zk,r),Ot.extend(t,e,r),Z.getArray(t,e,["bounds"],6),$k(t,e)}const jk=Z.newInstance(B8,"vtkPoints");var F0={newInstance:jk,extend:B8};function Hk(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=Z.newTypedArray(r.getDataType(),3*e.pointsIds.length));const o=r.getData();e.pointsIds.forEach((a,s)=>{let c=3*a,l=3*s;i[l]=o[c],i[++l]=o[++c],i[++l]=o[++c]}),e.points.setData(i)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(let i=r.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>e.points.getBounds(),t.getLength2=()=>{const r=bn.getLengths(t.getBounds());return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]},t.getParametricDistance=r=>{let n,i=0;for(let o=0;o<3;o++)r[o]<0?n=-r[o]:r[o]>1?n=r[o]-1:n=0,n>i&&(i=n);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=r=>{r.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(r,n,i,o,a,s,c)=>{},t.evaluatePosition=(r,n,i,o,a,s)=>{Z.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const Xk={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function G8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xk,r),Z.obj(t,e),e.points||(e.points=F0.newInstance()),Z.get(t,e,["points","pointsIds"]),Hk(t,e)}const Kk=Z.newInstance(G8,"vtkCell");var Iu={newInstance:Kk,extend:G8};function qk(t,e){let r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function Yk(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=r=>{const n=r.getPoints().getNumberOfPoints(),i=r.getNumberOfCells(),o=new Uint32Array(n);if(r.isA("vtkPolyData")){for(let a=0;a<i;++a){const{cellPointIds:s}=r.getCellPoints(a);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(n),e.maxId=n-1;for(let a=0;a<i;++a){const{cellPointIds:s}=r.getCellPoints(a);s.forEach(c=>{t.insertCellReference(c,o[c]++,a)})}}else{for(let a=0;a<i;a++)Iu.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(n),e.maxId=n-1;for(let a=0;a<i;++a)Iu.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,o[c]++,a)})}},t.allocate=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(()=>({ncells:0,cells:null})),e.extend=n,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=r=>e.array[r],t.getNcells=r=>e.array[r].ncells,t.getCells=r=>e.array[r].cells,t.insertNextPoint=r=>{e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=(r,n)=>{e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=r=>{e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=(r,n)=>{e.array[n].cells=e.array[n].cells.filter(i=>i!==r),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=(r,n)=>{e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=(r,n)=>{e.array[r].cells.length=n},t.squeeze=()=>{qk(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{e.array=[...r.array],e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=r=>{++e.array[r].ncells},t.allocateLinks=r=>{for(let n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=(r,n,i)=>{e.array[r].cells[n]=i}}const Jk={array:null,maxId:0,extend:0};function W8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jk,r),Z.obj(t,e),Yk(t,e)}const Zk=Z.newInstance(W8,"vtkCellLinks");var Qk={newInstance:Zk,extend:W8};const Vn={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},ry=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function eF(t){return t<ry.length?ry[t]:"UnknownClass"}function tF(t){return ry.findIndex(t)}function nF(t){return t<Vn.VTK_QUADRATIC_EDGE||t===Vn.VTK_CONVEX_POINT_SET||t===Vn.VTK_POLYHEDRON}function rF(t){return t===Vn.VTK_TRIANGLE_STRIP||t===Vn.VTK_POLY_LINE||t===Vn.VTK_POLY_VERTEX}const iF={getClassNameFromTypeId:eF,getTypeIdFromClassName:tF,isLinear:nF,hasSubCells:rF};function oF(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=(r,n,i)=>{e.typeArray[r]=n,e.locationArray[r]=i,r>e.maxId&&(e.maxId=r)},t.insertNextCell=(r,n)=>(t.insertCell(++e.maxId,r,n),e.maxId),t.setCellTypes=(r,n,i)=>{e.size=r,e.typeArray=n,e.locationArray=i,e.maxId=r-1},t.getCellLocation=r=>e.locationArray[r],t.deleteCell=r=>{e.typeArray[r]=Vn.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=r=>{const n=t.getNumberOfTypes();for(let i=0;i<n;++i)if(r===t.getCellType(i))return!0;return!1},t.insertNextType=r=>t.insertNextCell(r,-1),t.getCellType=r=>e.typeArray[r],t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}const aF={size:0,maxId:-1,extend:1e3};function $8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aF,r),Z.obj(t,e),Z.get(t,e,["size","maxId","extend"]),Z.getArray(t,e,["typeArray","locationArray"]),oF(t,e)}const sF=Z.newInstance($8,"vtkCellTypes");var cF={newInstance:sF,extend:$8,...iF};const z8={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var j8={IntersectionState:z8};const{IntersectionState:op}=j8;function a0(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},o=[];let a;o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2];const s=o[0]*(t[0]-e[0])+o[1]*(t[1]-e[1])+o[2]*(t[2]-e[2]),c=jt(o,o);let l=1e-5*s;return c!==0&&(i.t=s/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?a=e:i.t>1?a=r:(a=o,o[0]=e[0]+i.t*o[0],o[1]=e[1]+i.t*o[1],o[2]=e[2]+i.t*o[2]),n&&(n[0]=a[0],n[1]=a[1],n[2]=a[2]),i.distance=lo(a,t),i}function H8(t,e,r,n,i,o){const a=[],s=[],c=[];i[0]=0,o[0]=0,Hr(e,t,a),Hr(n,r,s),Hr(r,t,c);const l=[jt(a,a),-jt(a,s),-jt(a,s),jt(s,s)],d=[];if(d[0]=jt(a,c),d[1]=-jt(s,c),u4(l,d,2)===0){let u=Number.MAX_VALUE;const f=[t,e,r,n],h=[r,r,t,t],g=[n,n,e,e];o[0],o[0],i[0],i[0],i[0],i[0],o[0],o[0];let p;for(let v=0;v<4;v++)p=a0(f[v],h[v],g[v]),p.distance<u&&(u=p.distance,p.t);return op.ON_LINE}return i[0]=d[0],o[0]=d[1],i[0]>=0&&i[0]<=1&&o[0]>=0&&o[0]<=1?op.YES_INTERSECTION:op.NO_INTERSECTION}const lF={distanceToLine:a0,intersection:H8};function uF(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=()=>1,t.intersectWithLine=(n,i,o,a,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const l=[],d=[],u=[];e.points.getPoint(0,d),e.points.getPoint(1,u);const f=[],h=[],g=H8(n,i,d,u,f,h);if(c.t=f[0],c.betweenPoints=r(c.t),s[0]=h[0],g===op.YES_INTERSECTION){for(let p=0;p<3;p++)a[p]=d[p]+s[0]*(u[p]-d[p]),l[p]=n[p]+c.t*(i[p]-n[p]);if(lo(a,l)<=o*o)return c.intersect=1,c}else{let p;if(c.t<0)return p=a0(n,d,u,a),p.distance<=o*o&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=a0(i,d,u,a),p.distance<=o*o&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,p=a0(d,n,i,a),c.t=p.t,p.distance<=o*o&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,p=a0(u,n,i,a),c.t=p.t,p.distance<=o*o&&(c.intersect=1),c}return c},t.evaluateLocation=(n,i,o)=>{const a=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=a[c]+n[0]*(s[c]-a[c]);o[0]=1-n[0],o[1]=n[0]},t.evaluateOrientation=(n,i,o)=>e.orientations?(ep(i,e.orientations[0],e.orientations[1],n[0]),o[0]=1-n[0],o[1]=n[0],!0):!1}const dF={orientations:null};function X8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dF,r),Iu.extend(t,e,r),Z.setGet(t,e,["orientations"]),uF(t,e)}const fF=Z.newInstance(X8,"vtkLine");var Ti={newInstance:fF,extend:X8,...lF,...j8};const{vtkErrorMacro:U3,vtkWarningMacro:hF}=Z;function gF(t,e){e.classHierarchy.push("vtkFieldData");const r=t.getState;e.arrays&&(e.arrays=e.arrays.map(n=>({data:la(n.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=n=>{t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(i=>i),e.arrays=n.getArrays().map(i=>({data:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=n=>{const i=n.getName(),{array:o,index:a}=t.getArrayWithIndex(i);return o!=null?(e.arrays[a]={data:n},a):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=n=>{const i=e.arrays.findIndex(o=>o.data.getName()===n);return t.removeArrayByIndex(i)},t.removeArrayByIndex=n=>n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1,t.getArrays=()=>e.arrays.map(n=>n.data),t.getArray=n=>typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n),t.getArrayByName=n=>e.arrays.reduce((i,o,a)=>o.data.getName()===n?o.data:i,null),t.getArrayWithIndex=n=>{const i=e.arrays.findIndex(o=>o.data.getName()===n);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=n=>n>=0&&n<e.arrays.length?e.arrays[n].data:null,t.hasArray=n=>t.getArrayWithIndex(n).index>=0,t.getArrayName=n=>{const i=e.arrays[n];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=n=>e.copyFieldFlags[n],t.passData=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(a=>{const s=t.getFlag(a.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&a){let c=t.getArrayByName(a.getName());if(c)if(a.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<a.getNumberOfTuples()){const l=o>-1?o:i;c.insertTuple(l,a.getTuple(i))}else c.insertTuples(0,a.getTuples());else U3("Unhandled case in passData");else if(i<0||i>a.getNumberOfTuples())t.addArray(a),n.getAttributes(a).forEach(l=>{t.setAttribute(a,l)});else{const l=a.getNumberOfComponents();let d=a.getNumberOfValues();const u=o>-1?o:i;d<=u*l&&(d=(u+1)*l),c=Ot.newInstance({name:a.getName(),dataType:a.getDataType(),numberOfComponents:l,values:Z.newTypedArray(a.getDataType(),d),size:0}),c.insertTuple(u,a.getTuple(i)),t.addArray(c),n.getAttributes(a).forEach(f=>{t.setAttribute(c,f)})}}})},t.interpolateData=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let d=t.getArrayByName(c.getName());if(d)if(c.getNumberOfComponents()===d.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const u=a>-1?a:i;d.interpolateTuple(u,c,i,c,o,s),hF("Unexpected case in interpolateData")}else d.insertTuples(c.getTuples());else U3("Unhandled case in interpolateData");else if(i<0||o<0||i>c.getNumberOfTuples())t.addArray(c),n.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let f=c.getNumberOfValues();const h=a>-1?a:i;f<=h*u&&(f=(h+1)*u),d=Ot.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:Z.newTypedArray(c.getDataType(),f),size:0}),d.interpolateTuple(h,c,i,c,o,s),t.addArray(d),n.getAttributes(c).forEach(g=>{t.setAttribute(d,g)})}}})},t.copyFieldOn=n=>{e.copyFieldFlags[n]=!0},t.copyFieldOff=n=>{e.copyFieldFlags[n]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=n=>{e.arrays=n.getArrays().map(i=>{const o=i.newClone();return o.deepCopy(i),{data:o}})},t.copyFlags=n=>n.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(n=>n.data.reset()),t.getMTime=()=>e.arrays.reduce((n,i)=>i.data.getMTime()>n?i.data.getMTime():n,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((n,i)=>n+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const n=r();return n&&(n.arrays=e.arrays.map(i=>({data:i.data.getState()}))),n}}const pF={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function K8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pF,r),Z.obj(t,e),gF(t,e)}const mF=Z.newInstance(K8,"vtkFieldData");var vF={newInstance:mF,extend:K8};const yF={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},wF={MAX:0,EXACT:1,NOLIMIT:2},CF={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},xF={DUPLICATEPOINT:1,HIDDENPOINT:2},SF={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},TF="vtkGhostType",Bp={DEFAULT:0,SINGLE:1,DOUBLE:2};var q8={AttributeCopyOperations:SF,AttributeLimitTypes:wF,AttributeTypes:yF,CellGhostTypes:CF,DesiredOutputPrecision:Bp,PointGhostTypes:xF,ghostArrayName:TF};const{AttributeTypes:Nc,AttributeCopyOperations:$l}=q8,{vtkWarningMacro:ag}=Z;function _F(t,e){const r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(a){let s=r.find(c=>Nc[c.toUpperCase()]===a||typeof a!="number"&&c.toLowerCase()===a.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=a=>!0,t.setAttribute=(a,s)=>{const c=n(s);if(a&&c.toUpperCase()==="PEDIGREEIDS"&&!a.isA("vtkDataArray"))return ag(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(a&&!t.checkNumberOfComponents(a,c))return ag(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===a)return l;t.removeArrayByIndex(l)}return a?(l=t.addArray(a),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=a=>r.filter(s=>t[`get${s}`]()===a),t.setActiveAttributeByName=(a,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(a).index,s),t.setActiveAttributeByIndex=(a,s)=>{const c=n(s);if(a>=0&&a<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(a);if(!l.isA("vtkDataArray"))return ag(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return ag(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=a,t.modified(),a}return a===-1&&(e[`active${c}`]=a,t.modified()),-1},t.getActiveAttribute=a=>{const s=n(a);return t[`get${s}`]()},t.removeAllArrays=()=>{r.forEach(a=>{e[`active${a}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=a=>(a!==-1&&r.forEach(s=>{a===e[`active${s}`]?e[`active${s}`]=-1:a<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(a)),r.forEach(a=>{const s=`active${a}`;t[`get${a}`]=()=>t.getArrayByIndex(e[s]),t[`set${a}`]=c=>t.setAttribute(c,a),t[`setActive${a}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,a),t[`copy${a}Off`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[$l.PASSDATA][Nc[c]]=!1},t[`copy${a}On`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[$l.PASSDATA][Nc[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys($l).filter(a=>a!=="ALLCOPY").forEach(a=>{e.copyAttributeFlags[$l[a]]=Object.keys(Nc).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[Nc[c]]=!0,s),[])}),e.copyAttributeFlags[$l.COPYTUPLE][Nc.GLOBALIDS]=!1,e.copyAttributeFlags[$l.INTERPOLATE][Nc.GLOBALIDS]=!1,e.copyAttributeFlags[$l.COPYTUPLE][Nc.PEDIGREEIDS]=!1},t.initialize=Z.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(a=>{!e.dataArrays[a].ref&&e.dataArrays[a].type==="vtkDataArray"&&t.addArray(Ot.newInstance(e.dataArrays[a]))});const o=t.shallowCopy;t.shallowCopy=(a,s)=>{o(a,s),e.arrays=a.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,s),{data:l}})},t.initializeAttributeCopyFlags()}const EF={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Y8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EF,r),vF.extend(t,e,r),Z.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),_F(t,e)}const bF=Z.newInstance(Y8,"vtkDataSetAttributes");var B3={newInstance:bF,extend:Y8,...q8};const DF={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},IF={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var MF={FieldDataTypes:DF,FieldAssociations:IF};const ef=["pointData","cellData","fieldData"];function OF(t,e){e.classHierarchy.push("vtkDataSet"),ef.forEach(i=>{e[i]?e[i]=la(e[i]):e[i]=B3.newInstance()}),t.computeBounds=()=>{if(e.modifiedTime&&e.computeTime&&e.modifiedTime>e.computeTime||!e.computeTime){const i=t.getPoints();i?.getNumberOfPoints()?bn.setBounds(e.bounds,i.getBoundsByReference()):e.bounds=pt.createUninitializedBounds(),e.computeTime=Z.getCurrentGlobalMTime()}},t.getLength2=()=>{const i=t.getBoundsByReference();return!i||i.length!==6?0:bn.getDiagonalLength2(i)},t.getLength=()=>Math.sqrt(t.getLength2()),t.getCenter=()=>{const i=t.getBoundsByReference();return!i||i.length!==6?[0,0,0]:bn.getCenter(i)},t.getCellBounds=i=>{const o=t.getCell(i);return o?o.getBounds():pt.createUninitializedBounds()},t.getBounds=Z.chain(()=>t.computeBounds,t.getBounds),t.getBoundsByReference=Z.chain(()=>t.computeBounds,t.getBoundsByReference);const r=t.shallowCopy;t.shallowCopy=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,o),ef.forEach(a=>{e[a]=B3.newInstance(),e[a].shallowCopy(i.getReferenceByName(a))})};const n=t.getMTime;t.getMTime=()=>ef.reduce((i,o)=>Math.max(i,e[o]?.getMTime()??i),n()),t.initialize=()=>(ef.forEach(i=>e[i]?.initialize()),t)}const PF={};function J8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PF,r),Z.obj(t,e),Z.setGet(t,e,ef),Z.getArray(t,e,["bounds"],6),OF(t,e)}const RF=Z.newInstance(J8,"vtkDataSet");var nd={newInstance:RF,extend:J8,...MF};function AF(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=la(e.points):e.points=F0.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const r=t.shallowCopy;t.shallowCopy=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(o,a),e.points=F0.newInstance(),e.points.shallowCopy(o.getPoints())};const n=t.getMTime;t.getMTime=()=>{const o=n();return Math.max(o,e.points?.getMTime()??o)};const i=t.initialize;t.initialize=()=>(e.points?.initialize(),i())}const LF={};function Z8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LF,r),nd.extend(t,e,r),Z.setGet(t,e,["points"]),AF(t,e)}const NF=Z.newInstance(Z8,"vtkPointSet");var VF={newInstance:NF,extend:Z8};function kF(t,e){e.classHierarchy.push("vtkPolyLine");const r=Ti.newInstance();r.getPoints().setNumberOfPoints(2),t.getCellDimension=()=>1,t.intersectWithLine=(n,i,o,a,s,c,l)=>{const d={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null},u=t.getNumberOfPoints()-1;let f=Number.MAX_VALUE;for(let h=0;h<u;h++){const g=[0,0,0];r.getPoints().getData().set(e.points.getData().subarray(3*h,3*(h+2)));const p=r.intersectWithLine(o,a,s,c,l);if(p.intersect===1&&p.t<=d.t+s&&p.t>=n&&p.t<=i){d.intersect=1;const v=r.getParametricDistance(g);if(v<f||v===f&&p.t<d.t){d.subId=h,d.t=p.t,f=v;for(let w=0;w<3;w++)c[w],g[w]}}}return d},t.evaluateLocation=(n,i,o,a)=>(r.getPoints().getData().set(e.points.getData().subarray(3*n,3*(n+2))),r.evaluateLocation(i,o,a)),t.evaluateOrientation=(n,i,o,a)=>(e.orientations?r.setOrientations([e.orientations[n],e.orientations[n+1]]):r.setOrientations(null),r.evaluateOrientation(i,o,a)),t.getDistancesToFirstPoint=()=>{const n=e.distancesTime.getMTime();if(n<e.points.getMTime()||n<t.getMTime()){const i=t.getNumberOfPoints();if(e.distances?e.distances.length=i:e.distances=new Array(i),i>0){const o=new Array(3),a=new Array(3);let s=0;e.distances[0]=s,e.points.getPoint(0,o);for(let c=1;c<i;++c)e.points.getPoint(c,a),s+=e.distanceFunction(o,a),e.distances[c]=s,F1(o,a)}e.distancesTime.modified()}return e.distances},t.findPointIdAtDistanceFromFirstPoint=n=>{const i=t.getDistancesToFirstPoint();if(i.length<2)return-1;let o=0,a=i.length-1;if(n<i[o]||n>i[a]||i[a]===0)return-1;for(;a-o>1;){const s=Math.floor((o+a)/2);i[s]<=n?o=s:a=s}return o}}const FF={orientations:null,distanceFunction:yV};function Q8(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FF,r),Iu.extend(t,e,r),Z.setGet(t,e,["orientations","distanceFunction"]),e.distancesTime={},Z.obj(e.distancesTime,{mtime:0}),kF(t,e)}const UF=Z.newInstance(Q8,"vtkPolyLine");var BF={newInstance:UF,extend:Q8};function GF(t,e){e.classHierarchy.push("vtkPriorityQueue"),t.push=(r,n)=>{const i=e.elements.findIndex(o=>o.priority>r);e.elements.splice(i,0,{priority:r,element:n})},t.pop=()=>e.elements.length>0?e.elements.shift().element:null,t.deleteById=r=>{e.elements=e.elements.filter(n=>{let{element:i}=n;return i.id!==r})},t.length=()=>e.elements.length}const WF={elements:[]};function eb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WF,r),Z.obj(t,e),GF(t,e)}const $F=Z.newInstance(eb,"vtkPriorityQueue");var zF={newInstance:$F,extend:eb};const sg=1e-6,G3=11920929e-14,jF=1e-8,eu={FAILURE:-1,OUTSIDE:0,INSIDE:1,INTERSECTION:2,ON_LINE:3};function W3(t,e,r,n,i){return(n[t]-r[t])*(i[e]-r[e])-(i[t]-r[t])*(n[e]-r[e])}function HF(t,e,r,n){if(t[0]<r[0]||t[0]>r[1]||t[1]<r[2]||t[1]>r[3]||t[2]<r[4]||t[2]>r[5])return eu.OUTSIDE;if(wo(n)<=G3)return eu.FAILURE;let i=jF*((r[1]-r[0])*(r[1]-r[0])+(r[3]-r[2])*(r[3]-r[2])+(r[5]-r[4])*(r[5]-r[4]));i*=i,i=i===0?G3:i;const o=[],a=[];for(let d=0;d<e.length;){if(o[0]=e[d++],o[1]=e[d++],o[2]=e[d++],lo(t,o)<=i)return eu.INSIDE;const{distance:u,t:f}=Ti.distanceToLine(t,o,a);if(u<=i&&f>0&&f<1)return eu.INSIDE}let s,c;Math.abs(n[0])>Math.abs(n[1])?Math.abs(n[0])>Math.abs(n[2])?(s=1,c=2):(s=0,c=1):Math.abs(n[1])>Math.abs(n[2])?(s=0,c=2):(s=0,c=1);let l=0;for(let d=0;d<e.length;)o[0]=e[d++],o[1]=e[d++],o[2]=e[d++],d<e.length?(a[0]=e[d],a[1]=e[d+1],a[2]=e[d+2]):(a[0]=e[0],a[1]=e[1],a[2]=e[2]),o[c]<=t[c]?a[c]>t[c]&&W3(s,c,o,a,t)>0&&++l:a[c]<=t[c]&&W3(s,c,o,a,t)<0&&--l;return l===0?eu.OUTSIDE:eu.INSIDE}function XF(t,e,r){const n=t.length,i=[];e.getPoint(t[0],i),r[0]=i[0],r[1]=i[0],r[2]=i[1],r[3]=i[1],r[4]=i[2],r[5]=i[2];for(let a=1;a<n;a++)e.getPoint(t[a],i),bn.addPoint(r,...i);const o=bn.getLengths(r);return jt(o,o)}function KF(t,e,r){r.length=3,r[0]=0,r[1]=0,r[2]=0;const n=[];let i=[],o=[];const a=[],s=[];e.getPoint(t[0],n),e.getPoint(t[1],i);for(let c=2;c<t.length;c++){e.getPoint(t[c],o),Hr(o,i,a),Hr(n,i,s);const l=[0,0,0];Bi(a,s,l),R0(r,l,r),[i,o]=[o,i]}return wo(r)}function qF(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];r[0]=0,r[1]=0,r[2]=0;const n=t.length,i=[];for(let o=0;o<n;o++)e.getPoint(t[o],i),r[0]+=i[0],r[1]+=i[1],r[2]+=i[2];return r[0]/=n,r[1]/=n,r[2]/=n,r}const YF={PolygonWithPointIntersectionState:eu,pointInPolygon:HF,getBounds:XF,getNormal:KF,computeCentroid:qF};function JF(t,e){e.classHierarchy.push("vtkPolygon");function r(){const s=[0,0,0],c=[0,0,0];e.normal=[0,0,0];const l=[...e.firstPoint.point];let d=e.firstPoint;for(let u=0;u<e.pointCount;u++){Hr(d.point,l,s),Hr(d.next.point,l,c);const f=[0,0,0];Bi(s,c,f),R0(e.normal,f,e.normal),d=d.next}return wo(e.normal)}function n(s){const c=[0,0,0],l=[0,0,0],d=[0,0,0],u=[0,0,0];Hr(s.point,s.previous.point,c),Hr(s.next.point,s.point,l),Hr(s.previous.point,s.next.point,d),Bi(c,l,u);const f=jt(u,e.normal);if(f<=0)return-1;const h=go(c)+go(l)+go(d);return h*h/f}function i(s){if(e.pointCount<=3)return!0;const c=s.previous,l=s.next,d=[0,0,0];Hr(l.point,c.point,d);const u=[0,0,0];if(Bi(d,e.normal,u),wo(u),go(u)===0)return!1;let f=Kn.evaluate(u,c.point,l.next.point),h=f>sg?1:f<-sg?-1:0,g=h<0?1:0;for(let p=l.next.next;p.id!==c.id;p=p.next){const v=p.previous;f=Kn.evaluate(u,c.point,p.point);const w=f>sg?1:f<-sg?-1:0;if(w!==h){if(g||(g=w<=0?1:0),Ti.intersection(c.point,l.point,p.point,v.point,[0],[0])===z8.YES_INTERSECTION)return!1;h=w}}return g===1}function o(s,c){e.pointCount-=1;const l=s.previous,d=s.next;e.tris=e.tris.concat(s.point),e.tris=e.tris.concat(d.point),e.tris=e.tris.concat(l.point),l.next=d,d.previous=l,c.deleteById(l.id),c.deleteById(d.id);const u=n(l);u>0&&c.push(u,l);const f=n(d);f>0&&c.push(f,d),s.id===e.firstPoint.id&&(e.firstPoint=d)}function a(){r();const s=zF.newInstance();let c=e.firstPoint;for(let l=0;l<e.pointCount;l++){const d=n(c);d>0&&s.push(d,c),c=c.next}for(;e.pointCount>2&&s.length()>0;)if(e.pointCount===s.length()){const l=s.pop();o(l,s)}else{const l=s.pop();i(l)&&o(l,s)}return e.pointCount<=2}t.triangulate=()=>e.firstPoint?a():null,t.setPoints=s=>{e.pointCount=s.length,e.firstPoint={id:0,point:s[0],next:null,previous:null};let c=e.firstPoint;for(let l=1;l<e.pointCount;l++)c.next={id:l,point:s[l],next:null,previous:c},c=c.next;e.firstPoint.previous=c,c.next=e.firstPoint},t.getPointArray=()=>e.tris}const ZF={firstPoint:null,pointCount:0,tris:[]};function tb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZF,r),Z.obj(t,e),JF(t,e)}const QF=Z.newInstance(tb,"vtkPolygon");var eU={newInstance:QF,extend:tb,...YF};function cw(t,e,r,n){const i=r[0]-e[0],o=r[1]-e[1],a=r[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];n[0]=o*l-a*c,n[1]=a*s-i*l,n[2]=i*c-o*s}function Hf(t,e,r,n){cw(t,e,r,n);const i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);i!==0&&(n[0]/=i,n[1]/=i,n[2]/=i)}function nb(t){t[0]=-1,t[1]=1,t[2]=0,t[3]=-1,t[4]=0,t[5]=1}function tU(t,e,r,n,i,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],l=[],d=[],u=[],f=[];Hf(t,e,r,u),Hf(n,i,o,f);const h=-jt(u,t),g=-jt(f,n),p=[jt(f,t)+g,jt(f,e)+g,jt(f,r)+g];if(p[0]*p[1]>a&&p[0]*p[2]>a)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:d};const v=[jt(u,n)+h,jt(u,i)+h,jt(u,o)+h];if(v[0]*v[1]>a&&v[0]*v[2]>a)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:d};if(Math.abs(u[0]-f[0])<1e-9&&Math.abs(u[1]-f[1])<1e-9&&Math.abs(u[2]-f[2])<1e-9&&Math.abs(h-g)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:d};const w=[t,e,r],m=[n,i,o],y=jt(u,f),C=(h-g*y)/(y*y-1),x=(g-h*y)/(y*y-1),S=[C*u[0]+x*f[0],C*u[1]+x*f[1],C*u[2]+x*f[2]],T=Bi(u,f,[]);wo(T);let _=0,E=0;const D=[],b=[];let I=50,O=50;for(let A=0;A<3;A++){const G=A,k=(A+1)%3,L=Kn.intersectWithLine(w[G],w[k],n,f);L.intersection&&L.t>0-a&&L.t<1+a&&(L.t<1+a&&L.t>1-a&&(I=_),D[_++]=jt(L.x,T)-jt(S,T));const F=Kn.intersectWithLine(m[G],m[k],t,u);F.intersection&&F.t>0-a&&F.t<1+a&&(F.t<1+a&&F.t>1-a&&(O=E),b[E++]=jt(F.x,T)-jt(S,T))}if(_>2){_--;const A=D[2];D[2]=D[I],D[I]=A}if(E>2){E--;const A=b[2];b[2]=b[O],b[O]=A}if(_!==2||E!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:d};if(Number.isNaN(D[0])||Number.isNaN(D[1])||Number.isNaN(b[0])||Number.isNaN(b[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:d};if(D[0]>D[1]){const A=D[1];D[1]=D[0],D[0]=A}if(b[0]>b[1]){const A=b[1];b[1]=b[0],b[0]=A}let M,R;return D[1]<b[0]||b[1]<D[0]?{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:d}:(D[0]<b[0]?D[1]<b[1]?(d[0]=2,d[1]=1,M=b[0],R=D[1]):(d[0]=2,d[1]=2,M=b[0],R=b[1]):D[1]<b[1]?(d[0]=1,d[1]=1,M=D[0],R=D[1]):(d[0]=1,d[1]=2,M=D[0],R=b[1]),Wv(S,T,M,c),Wv(S,T,R,l),{intersect:!0,coplanar:s,pt1:c,pt2:l,surfaceId:d})}const nU={computeNormalDirection:cw,computeNormal:Hf,interpolationDerivs:nb,intersectWithTriangle:tU};function rU(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(r,n,i,o,a)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};a[2]=0;const c=[],l=i*i,d=[],u=[],f=[];e.points.getPoint(0,d),e.points.getPoint(1,u),e.points.getPoint(2,f);const h=[],g=[];if(Hf(d,u,f,h),h[0]!==0||h[1]!==0||h[2]!==0){const y=Kn.intersectWithLine(r,n,d,h);if(s.betweenPoints=y.betweenPoints,s.t=y.t,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],!y.intersection)return a[0]=0,a[1]=0,s.intersect=0,s;const C=t.evaluatePosition(o,c,a,g);if(C.evaluation>=0)return C.dist2<=l?(s.intersect=1,s):(s.intersect=C.evaluation,s)}const p=lo(d,u),v=lo(u,f),w=lo(f,d);e.line||(e.line=Ti.newInstance()),p>v&&p>w?(e.line.getPoints().setPoint(0,d),e.line.getPoints().setPoint(1,u)):v>w&&v>p?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,f)):(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,d));const m=e.line.intersectWithLine(r,n,i,o,a);if(s.betweenPoints=m.betweenPoints,s.t=m.t,m.intersect){const y=[],C=[],x=[];for(let S=0;S<3;S++)y[S]=d[S]-f[S],C[S]=u[S]-f[S],x[S]=o[S]-f[S];return a[0]=jt(x,y)/w,a[1]=jt(x,C)/v,s.intersect=1,s}return a[0]=0,a[1]=0,s.intersect=0,s},t.evaluatePosition=(r,n,i,o)=>{const a={subId:0,dist2:0,evaluation:-1};let s,c;const l=[],d=[],u=[],f=[];let h;const g=[],p=[],v=[];let w=0,m=0;const y=[];let C,x,S,T=[];const _=[],E=[],D=[];a.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,d),e.points.getPoint(0,u),cw(l,d,u,f),Kn.generalizedProjectPoint(r,l,f,D);let b=0;for(s=0;s<3;s++)f[s]<0?h=-f[s]:h=f[s],h>b&&(b=h,m=s);for(c=0,s=0;s<3;s++)s!==m&&(y[c++]=s);for(s=0;s<2;s++)g[s]=D[y[s]]-u[y[s]],p[s]=l[y[s]]-u[y[s]],v[s]=d[y[s]]-u[y[s]];if(w=ur(p,v),w===0)return i[0]=0,i[1]=0,a.evaluation=-1,a;if(i[0]=ur(g,v)/w,i[1]=ur(p,g)/w,o[0]=1-(i[0]+i[1]),o[1]=i[0],o[2]=i[1],o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1&&o[2]>=0&&o[2]<=1)n&&(a.dist2=lo(D,r),n[0]=D[0],n[1]=D[1],n[2]=D[2]),a.evaluation=1;else{let I;if(n){if(o[1]<0&&o[2]<0)for(C=lo(r,u),x=Ti.distanceToLine(r,l,u,I,_),S=Ti.distanceToLine(r,u,d,I,E),C<x?(a.dist2=C,T=u):(a.dist2=x,T=_),S<a.dist2&&(a.dist2=S,T=E),s=0;s<3;s++)n[s]=T[s];else if(o[2]<0&&o[0]<0)for(C=lo(r,l),x=Ti.distanceToLine(r,l,u,I,_),S=Ti.distanceToLine(r,l,d,I,E),C<x?(a.dist2=C,T=l):(a.dist2=x,T=_),S<a.dist2&&(a.dist2=S,T=E),s=0;s<3;s++)n[s]=T[s];else if(o[1]<0&&o[0]<0)for(C=lo(r,d),x=Ti.distanceToLine(r,d,u,I,_),S=Ti.distanceToLine(r,l,d,I,E),C<x?(a.dist2=C,T=d):(a.dist2=x,T=_),S<a.dist2&&(a.dist2=S,T=E),s=0;s<3;s++)n[s]=T[s];else if(o[0]<0){const O=Ti.distanceToLine(r,l,d,n);a.dist2=O.distance}else if(o[1]<0){const O=Ti.distanceToLine(r,d,u,n);a.dist2=O.distance}else if(o[2]<0){const O=Ti.distanceToLine(r,l,u,n);a.dist2=O.distance}}a.evaluation=0}return a},t.evaluateLocation=(r,n,i)=>{const o=[],a=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,a),e.points.getPoint(2,s);const c=1-r[0]-r[1];for(let l=0;l<3;l++)n[l]=o[l]*c+a[l]*r[0]+s[l]*r[1];i[0]=c,i[1]=r[0],i[2]=r[1]},t.getParametricDistance=r=>{let n,i=0;const o=[];o[0]=r[0],o[1]=r[1],o[2]=1-r[0]-r[1];for(let a=0;a<3;a++)o[a]<0?n=-o[a]:o[a]>1?n=o[a]-1:n=0,n>i&&(i=n);return i},t.derivatives=(r,n,i,o,a)=>{const s=e.points.getPoint(0),c=e.points.getPoint(1),l=e.points.getPoint(2),d=[],u=[],f=[],h=[];Hf(s,c,l,d),Hr(c,s,u),Hr(l,s,h),Bi(d,u,f);const g=wo(u);if(g<=0||wo(f)<=0){for(let x=0;x<o;x++)for(let S=0;S<3;S++)a[x*o+S]=0;return}const p=[0,0],v=[g,0],w=[jt(h,u),jt(h,f)],m=new Array(6);nb(m);const y=[v[0]-p[0],v[1]-p[1],w[0]-p[0],w[1]-p[1]],C=Z.newTypedArray(di.Float64Array,4);O5(y,C,2);for(let x=0;x<o;x++){let S=0,T=0;for(let D=0;D<3;D++)S+=m[D]*i[o*D+x],T+=m[3+D]*i[o*D+x];const _=S*C[0]+T*C[1],E=S*C[2]+T*C[3];a[3*x]=_*u[0]+E*f[0],a[3*x+1]=_*u[1]+E*f[1],a[3*x+2]=_*u[2]+E*f[2]}},t.cellBoundary=(r,n,i)=>{const o=n[0]-n[1],a=.5*(1-n[0])-n[1],s=2*n[0]+n[1]-1;return o>=0&&a>=0?(i[0]=e.pointsIds[0],i[1]=e.pointsIds[1]):a<0&&s>=0?(i[0]=e.pointsIds[1],i[1]=e.pointsIds[2]):(i[0]=e.pointsIds[2],i[1]=e.pointsIds[0]),!(n[0]<0||n[1]<0||n[0]>1||n[1]>1||1-n[0]-n[1]<0)}}const iU={};function rb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iU,r),Iu.extend(t,e,r),rU(t,e)}const oU=Z.newInstance(rb,"vtkTriangle");var lw={newInstance:oU,extend:rb,...nU};function $3(){return{intersected:!1,subId:-1,x:[0,0,0],pCoords:[0,0,0],t:-1}}function aU(t,e){e.classHierarchy.push("vtkQuad"),t.getCellDimension=()=>2,t.getCellType=()=>Vn.VTK_QUAD,t.getNumberOfEdges=()=>4,t.getNumberOfFaces=()=>0,t.intersectWithLine=(r,n,i,o,a)=>{let s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1},c;const l=e.points.getPoint(0,[]),d=e.points.getPoint(1,[]),u=e.points.getPoint(2,[]),f=e.points.getPoint(3,[]),h=lo(l,u),g=lo(d,f);if(h===g){let S,T=0,_=0;for(let E=0;E<4;E++)S=e.pointsIds[E],S>T&&(T=S,_=E);_===0||_===2?c=0:c=1}else h<g?c=0:c=1;let p=null;e.triangle?p=e.triangle.getPoints():(e.triangle=lw.newInstance(),p=F0.newInstance(),p.setNumberOfPoints(3),e.triangle.initialize(p));let v;const w=$3();let m;const y=$3();let C,x;switch(c){case 0:p.setPoint(0,...l),p.setPoint(1,...d),p.setPoint(2,...u),v=e.triangle.intersectWithLine(r,n,i,w.x,w.pCoords),p.setPoint(0,...u),p.setPoint(1,...f),p.setPoint(2,...l),m=e.triangle.intersectWithLine(r,n,i,y.x,y.pCoords),C=v.intersect&&m.intersect?v.t<=m.t:v.intersect,x=v.intersect&&m.intersect?m.t<v.t:m.intersect,C?(s=v,o[0]=w.x[0],o[1]=w.x[1],o[2]=w.x[2],a[0]=w.pCoords[0]+w.pCoords[1],a[1]=w.pCoords[1],a[2]=w.pCoords[2]):x&&(s=m,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],a[0]=1-(y.pCoords[0]+y.pCoords[1]),a[1]=1-y.pCoords[1],a[2]=y.pCoords[2]);break;case 1:p.setPoint(0,...l),p.setPoint(1,...d),p.setPoint(2,...f),v=e.triangle.intersectWithLine(r,n,i,w.x,w.pCoords),p.setPoint(0,...u),p.setPoint(1,...f),p.setPoint(2,...d),m=e.triangle.intersectWithLine(r,n,i,y.x,y.pCoords),C=v.intersect&&m.intersect?v.t<=m.t:v.intersect,x=v.intersect&&m.intersect?m.t<v.t:m.intersect,C?(s=v,o[0]=w.x[0],o[1]=w.x[1],o[2]=w.x[2],a[0]=w.pCoords[0],a[1]=w.pCoords[1],a[2]=w.pCoords[2]):x&&(s=m,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],a[0]=1-y.pCoords[0],a[1]=1-y.pCoords[1],a[2]=y.pCoords[2]);break}return s},t.interpolationFunctions=(r,n)=>{const i=1-r[0],o=1-r[1];n[0]=i*o,n[1]=r[0]*o,n[2]=r[0]*r[1],n[3]=i*r[1]},t.evaluateLocation=(r,n,i)=>{const o=[];t.interpolationFunctions(r,i),n[0]=0,n[1]=0,n[2]=0;for(let a=0;a<4;a++){e.points.getPoint(a,o);for(let s=0;s<3;s++)n[s]+=o[s]*i[a]}}}const sU={};function ib(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sU,r),Iu.extend(t,e,r),aU(t,e)}const cU=Z.newInstance(ib,"vtkQuad");var lU={newInstance:cU,extend:ib};const{vtkErrorMacro:ob}=Z;function z3(t){return()=>ob(`vtkTriangleStrip.${t} - NOT IMPLEMENTED`)}function uU(t,e){if(!Array.isArray(t)||t.length<3){ob("decomposeStrip - Invalid points array");return}let r=t[0],n=t[1];for(let i=0;i<t.length-2;i++){const o=t[i+2];i%2?e.insertNextCell([n,r,o]):e.insertNextCell([r,n,o]),r=n,n=o}}const dU={decomposeStrip:uU};function fU(t,e){e.classHierarchy.push("vtkTriangleStrip");const r=t.initialize;t.initialize=(n,i)=>{e.triangle.initialize(n,i),r(n,i)},t.getCellType=()=>Vn.VTK_TRIANGLE_STRIP,t.getCellDimension=()=>2,t.getNumberOfEdges=()=>e.pointsIds.length,t.getNumberOfFaces=()=>0,t.evaluatePosition=(n,i,o,a,s)=>{const c=[0,0,0];let l=Number.MAX_VALUE,d=0;const u=[],f=[],h=[];o[2]=0,f[0]=0,f[1]=0,f[2]=0;const g=e.triangle.getPoints();g.setNumberOfPoints(3);const v=e.triangle.getPointsIds().length;for(let w=0;w<v;w++)s[w]=0;for(let w=0;w<v-2;w++){const m=[];g.getPoint(w,m);const y=[];g.getPoint(w+1,y);const C=[];g.getPoint(w+2,C),g.setData(Float32Array.from([...m,...y,...C]),3);const x=e.triangle.evaluatePosition(n,h,c,u),S=x.dist2;x.evaluation>=0&&(S<l||S===l&&d===0)&&(d=x,i&&(i[0]=h[0],i[1]=h[1],i[2]=h[2]),o[0]=c[0],o[1]=c[1],l=S,f[0]=u[0],f[1]=u[1],f[2]=u[2])}return a[0]=l,s[0]=f[0],s[1]=f[1],s[2]=f[2],d},t.evaluateLocation=(n,i,o,a)=>{const s=[[0,1,2],[1,0,2]],c=n%2,l=e.pointsIds.length;for(let g=0;g<l;g++)a[g]=0;const d=1-i[0]-i[1];a[n]=d,a[n+1]=i[0],a[n+2]=i[1];const u=[];e.points.getPoint(n+s[c][0],u);const f=[];e.points.getPoint(n+s[c][1],f);const h=[];e.points.getPoint(n+s[c][2],h);for(let g=0;g<3;g++)o[g]=u[g]*a[n]+f[g]*a[n+1]+h[g]*a[n+2]},t.cellBoundary=(n,i,o)=>{const a=[[0,1,2],[1,0,2]],s=n%2,c=e.triangle.getPointsIds();return c[0]=e.pointsIds[a[s][0]],c[1]=e.pointsIds[a[s][1]],c[2]=e.pointsIds[a[s][2]],e.triangle.cellBoundary(0,i,o)},t.getEdge=n=>{let i,o;const a=e.pointsIds.length;return n===0?(i=0,o=1):n===a-1?(i=n-1,o=n):(i=n-1,o=n+1),e.line.getPointsIds()[0]=e.pointsIds[i],e.line.getPointsIds()[1]=e.pointsIds[o],e.line.getPoints().setPoint(0,e.points.getPoint(i)),e.line.getPoints().setPoint(1,e.points.getPoint(o)),e.line},t.intersectWithLine=(n,i,o,a,s)=>{const c=e.pointsIds.length-2,l=e.triangle.getPoints();l.setNumberOfPoints(3);for(let d=0;d<c;d++){const u=[];e.points.getPoint(e.pointsIds[d],u);const f=[];e.points.getPoint(e.pointsIds[d+1],f);const h=[];e.points.getPoint(e.pointsIds[d+2],h),l.setData(Float32Array.from([...u,...f,...h]),3);const g=e.triangle.intersectWithLine(n,i,o,a,s);if(g.intersect)return g}return!1},t.triangulate=()=>{const n=e.points.getNumberOfPoints()-2;e.tris=new Array(3*n);const i=[[0,1,2],[1,0,2]];for(let o=0;o<n;o++){const a=o%2;for(let s=0;s<3;s++)e.tris[o*3+s]=o+i[a][s]}return!0},t.getPointArray=()=>e.tris,t.derivatives=(n,i,o,a,s)=>{const c=[];e.points.getPoint(n,c);const l=[];e.points.getPoint(n+1,l);const d=[];e.points.getPoint(n+2,d);const u=e.triangle.getPoints();u.setPoint(0,...c),u.setPoint(1,...l),u.setPoint(2,...d),e.triangle.derivatives(0,i,o,a,s)},t.getParametricCenter=n=>(n[0]=.333333,n[1]=.333333,n[2]=0,Math.floor((e.pointsIds.length-2)/2)),t.contour=(n,i,o,a,s,c,l,d,u,f,h)=>z3("contour")(),t.clip=(n,i,o,a,s,c,l,d,u,f)=>z3("clip")()}const hU={line:null,triangle:null,tris:null};function ab(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hU,r),Iu.extend(t,e,r),e.line||(e.line=Ti.newInstance()),e.triangle||(e.triangle=lw.newInstance()),fU(t,e)}const gU=Z.newInstance(ab,"vtkTriangleStrip");var pU={newInstance:gU,extend:ab,...dU};const Wu=["verts","lines","polys","strips"],{vtkWarningMacro:j3}=Z,mU={[Vn.VTK_LINE]:Ti,[Vn.VTK_QUAD]:lU,[Vn.VTK_POLY_LINE]:Ti,[Vn.VTK_TRIANGLE]:lw,[Vn.VTK_TRIANGLE_STRIP]:pU,[Vn.VTK_POLY_LINE]:BF,[Vn.VTK_POLYGON]:eU};function vU(t,e){e.classHierarchy.push("vtkPolyData");function r(s){return s.replace(/(?:^\w|[A-Z]|\b\w)/g,c=>c.toUpperCase()).replace(/\s+/g,"")}function n(){e.cells=void 0,e.links=void 0}Wu.forEach(s=>{t[`getNumberOf${r(s)}`]=()=>e[s].getNumberOfCells(),e[s]?e[s]=la(e[s]):e[s]=ll.newInstance(),e[`_on${r(s)}Changed`]=n}),t.getNumberOfCells=()=>Wu.reduce((s,c)=>s+e[c].getNumberOfCells(),0);const i=t.shallowCopy;t.shallowCopy=function(s){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;i(s,c),Wu.forEach(l=>{e[l]=ll.newInstance(),e[l].shallowCopy(s.getReferenceByName(l))})};const o=t.getMTime;t.getMTime=()=>Wu.reduce((s,c)=>Math.max(s,e[c]?.getMTime()??s),o());const a=t.initialize;t.initialize=()=>(Wu.forEach(s=>e[s]?.initialize()),n(),a()),t.buildCells=()=>{const s=t.getNumberOfVerts(),c=t.getNumberOfLines(),l=t.getNumberOfPolys(),d=t.getNumberOfStrips(),u=s+c+l+d,f=new Uint8Array(u);let h=f;const g=new Uint32Array(u);let p=g;if(s){let v=0;e.verts.getCellSizes().forEach((w,m)=>{p[m]=v,h[m]=w>1?Vn.VTK_POLY_VERTEX:Vn.VTK_VERTEX,v+=w+1}),p=p.subarray(s),h=h.subarray(s)}if(c){let v=0;e.lines.getCellSizes().forEach((w,m)=>{p[m]=v,h[m]=w>2?Vn.VTK_POLY_LINE:Vn.VTK_LINE,w===1&&j3("Building VTK_LINE ",m," with only one point, but VTK_LINE needs at least two points. Check the input."),v+=w+1}),p=p.subarray(c),h=h.subarray(c)}if(l){let v=0;e.polys.getCellSizes().forEach((w,m)=>{switch(p[m]=v,w){case 3:h[m]=Vn.VTK_TRIANGLE;break;case 4:h[m]=Vn.VTK_QUAD;break;default:h[m]=Vn.VTK_POLYGON;break}w<3&&j3("Building VTK_TRIANGLE ",m," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),v+=w+1}),p+=p.subarray(l),h+=h.subarray(l)}if(d){let v=0;h.fill(Vn.VTK_TRIANGLE_STRIP,0,d),e.strips.getCellSizes().forEach((w,m)=>{p[m]=v,v+=w+1})}e.cells=cF.newInstance(),e.cells.setCellTypes(u,f,g)},t.buildLinks=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells==null&&t.buildCells(),e.links=Qk.newInstance(),s>0?e.links.allocate(s):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=s=>e.cells.getCellType(s),t.getCellPoints=s=>{const c=t.getCellType(s);let l=null;switch(c){case Vn.VTK_VERTEX:case Vn.VTK_POLY_VERTEX:l=e.verts;break;case Vn.VTK_LINE:case Vn.VTK_POLY_LINE:l=e.lines;break;case Vn.VTK_TRIANGLE:case Vn.VTK_QUAD:case Vn.VTK_POLYGON:l=e.polys;break;case Vn.VTK_TRIANGLE_STRIP:l=e.strips;break;default:return l=null,{type:0,cellPointIds:null}}const d=e.cells.getCellLocation(s),u=l.getCell(d);return{cellType:c,cellPointIds:u}},t.getPointCells=s=>e.links.getCells(s),t.getCellEdgeNeighbors=(s,c,l)=>{const d=e.links.getLink(c),u=e.links.getLink(l);return d.cells.filter(f=>f!==s&&u.cells.indexOf(f)!==-1)},t.getCell=function(s){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const l=t.getCellPoints(s),d=c||mU[l.cellType].newInstance();return d.initialize(t.getPoints(),l.cellPointIds),d},t.getMaxCellSize=()=>Wu.reduce((s,c)=>Math.max(s,e[c]?.getMaxCellSize?.()??0),0)}const yU={};function sb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yU,r),VF.extend(t,e,r),Z.get(t,e,["cells","links"]),Z.setGet(t,e,["verts","lines","polys","strips"]),vU(t,e)}const wU=Z.newInstance(sb,"vtkPolyData");var Ii={newInstance:wU,extend:sb};const{vtkErrorMacro:CU}=Z;class xU{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const r=e[0],n=e[e.length-1];if(r===n||e.length<2)return;const i=this.segmentMapping[r],o=this.segmentMapping[n];if(i!==void 0&&o!==void 0)if(Math.abs(i)===Math.abs(o)){const a=i<o?o:i,s=this.segments[a];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[a]=null,this.segmentMapping[r]=void 0,this.segmentMapping[n]=void 0}else{const a=Math.abs(i),s=Math.abs(o),c=this.segments[a],l=this.segments[s];this.segments[a]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const a=this.segments[i];for(let s=1;s<e.length;s++)a.push(e[s]);this.segmentMapping[n]=i}else{const a=this.segments[-i];this.segmentMapping[n]=i;for(let s=1;s<e.length;s++)a.unshift(e[s])}this.segmentMapping[r]=void 0}else if(o!==void 0){if(o>0){const a=this.segments[o];for(let s=1;s<e.length;s++)a.push(e[e.length-1-s]);this.segmentMapping[r]=o}else{const a=this.segments[-o];this.segmentMapping[r]=o;for(let s=1;s<e.length;s++)a.unshift(e[e.length-s-1])}this.segmentMapping[n]=void 0}else{const a=this.segments.length;this.segments.push(e),this.segmentMapping[r]=-a,this.segmentMapping[n]=a}}}function SU(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(r,n)=>{const i=r[0];if(!i){CU("Invalid or missing input");return}const o=n[0]?.initialize()||Ii.newInstance();o.shallowCopy(i);const a=new xU,s=i.getLines().getData();let c=0;for(;c<s.length;){const f=s[c++],h=[];for(let g=0;g<f;g++)h.push(s[c+g]);a.addSegment(h),c+=f}const{faces:l}=a;let d=l.length;for(let f=0;f<l.length;f++)d+=l[f].length;const u=new Uint16Array(d);c=0;for(let f=0;f<l.length;f++){const h=l[f];u[c++]=h.length;for(let g=0;g<h.length;g++)u[c++]=h[g]}o.setPolys(ll.newInstance({values:u,name:"faces"})),n[0]=o}}const TU={};function cb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TU,r),Z.obj(t,e),Z.algo(t,e,1,1),SU(t,e)}const _U=Z.newInstance(cb,"vtkClosedPolyLineToSurfaceFilter");var EU={newInstance:_U,extend:cb};const{vtkErrorMacro:H3}=Oi;function bU(t){const e=t.getPolys().getData(),r=t.getStrips().getData(),n={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(n.polyIdx<e.length){n.cellSize=e[n.polyIdx];const i=n.polyIdx+1,o=i+n.cellSize;n.polyIdx=o;let a=0;for(let s=i;s<o;++s)n.cell[a++]=e[s]}else if(n.stripIdx<r.length){n.cellSize=3,n.remainingStripLength===0&&(n.remainingStripLength=r[n.stripIdx]-2,n.stripIdx+=3);const i=n.stripIdx-2,o=n.stripIdx+1;n.stripIdx++,n.remainingStripLength--;let a=0;for(let s=i;s<o;++s)n.cell[a++]=r[s]}else if(!n.done)n.done=!0;else throw new Error("Iterator is done")}};return n.next(),n}function DU(t,e){e.classHierarchy.push("vtkCutter");const r={...t};t.getMTime=()=>{let i=r.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function n(i,o){const a=i.getPoints(),s=a.getData(),c=i.getPointData(),l=a.getNumberOfPoints(),d=[],u=[],f=[],h={},g=c.getNumberOfArrays();for(let T=0;T<g;T++)h[c.getArrayName(T)]=[];(!e.cutScalars||e.cutScalars.length<l)&&(e.cutScalars=new Float32Array(l));let p=0,v=0;for(;p<s.length;)e.cutScalars[v++]=e.cutFunction.evaluateFunction(s[p++],s[p++],s[p++]);const w=[],m=new Array(3),y=new Array(3),C=[];for(const T=bU(i);!T.done;T.next()){if(T.cellSize<=2)continue;for(let I=0;I<T.cellSize;)C[I]=e.cutScalars[T.cell[I++]];const _=C[0]>0;let E=!0;for(let I=1;I<T.cell.length;I++)if(C[I]>0!==_){E=!1;break}if(E)continue;const D=[];for(let I=0;I<T.cellSize;I++){const O=I+1===T.cellSize?0:I+1,M=C[I]>0;if(C[O]>0===M)continue;let A=I,G=O,k=C[G]-C[A];k<=0&&(A=O,G=I,k*=-1);let L=0;k!==0&&(L=(e.cutValue-C[A])/k);const F=T.cell[A],j=T.cell[G];m[0]=s[F*3],m[1]=s[F*3+1],m[2]=s[F*3+2],y[0]=s[j*3],y[1]=s[j*3+1],y[2]=s[j*3+2];const Y=[m[0]+L*(y[0]-m[0]),m[1]+L*(y[1]-m[1]),m[2]+L*(y[2]-m[2])],ie={};for(let de=0;de<g;de++){const ae=c.getArrayByIndex(de),fe=c.getArrayName(de),we=ae.getData(),_e=ae.getNumberOfComponents(),Se=new Array(_e);for(let B=0;B<_e;B++){const P=we[_e*F+B],$=we[_e*j+B];Se.push(P+L*($-P))}ie[fe]=Se}D.push({pointEdge1:F,pointEdge2:j,intersectedPoint:Y,intersectedArrays:ie,newPointID:-1})}for(let I=0;I<D.length;I++){const O=D[I];let M=!1;for(let R=0;R<w.length;R++){const A=w[R],G=O.pointEdge1===A.pointEdge1&&O.pointEdge2===A.pointEdge2,k=O.intersectedPoint[0]===A.intersectedPoint[0]&&O.intersectedPoint[1]===A.intersectedPoint[1]&&O.intersectedPoint[2]===A.intersectedPoint[2];if(G||k){M=!0,D[I].newPointID=w[R].newPointID;break}}M||(d.push(O.intersectedPoint[0]),d.push(O.intersectedPoint[1]),d.push(O.intersectedPoint[2]),Object.keys(O.intersectedArrays).forEach(R=>{h[R].push(...O.intersectedArrays[R])}),D[I].newPointID=d.length/3-1,w.push(D[I]))}const b=D.length;b===2?u.push(b,D[0].newPointID,D[1].newPointID):b>2&&(f.push(b),D.forEach(I=>{f.push(I.newPointID)}))}o.getPoints().setData(L1(a.getDataType(),d),3);const S=o.getPointData();for(let T=0;T<g;T++){const _=c.getArrayName(T),E=Ot.newInstance({name:_,dataType:c.getArrayByIndex(T).getDataType(),values:h[_],numberOfComponents:c.getArrayByIndex(T).getNumberOfComponents()});S.addArray(E)}u.length!==0&&o.getLines().setData(Uint16Array.from(u)),f.length!==0&&o.getPolys().setData(Uint16Array.from(f))}t.requestData=(i,o)=>{const a=i[0];if(!a){H3("Invalid or missing input");return}if(!e.cutFunction){H3("Missing cut function");return}const s=o[0]?.initialize()||Ii.newInstance();n(a,s),o[0]=s}}const IU={cutFunction:null,cutScalars:null,cutValue:0};function lb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IU,r),Jn(t,e),C5(t,e,1,1),Ur(t,e,["cutFunction","cutValue"]),DU(t,e)}const MU=zn(lb,"vtkCutter");var OU={newInstance:MU,extend:lb};const Ys={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var ub={ObjectType:Ys};const{ObjectType:ap}=ub,PU={};function RU(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(s){switch(s){case ap.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case ap.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case ap.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let n=null,i=null,o=!0,a="";t.getType=()=>n,t.setType=s=>{n=s},t.getHandle=()=>i,t.isReady=()=>o===!1,t.generateBuffer=s=>{const c=r(s);return i===null&&(i=e.context.createBuffer(),n=s),r(n)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(r(n),i),e.context.bufferData(r(n),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,o=!1,!0):(a="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(r(n),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(r(n),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>a}const AU={objectType:ap.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function db(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AU,r),Z.obj(t,e),Z.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),Z.moveToProtected(t,e,["openGLRenderWindow"]),RU(t,e)}const LU=Z.newInstance(db);var Ks={newInstance:LU,extend:db,...PU,...ub};const fb={FLAT:0,GOURAUD:1,PHONG:2},vo={POINTS:0,WIREFRAME:1,SURFACE:2},NU=fb;var hb={Shading:fb,Representation:vo,Interpolation:NU};function uw(t){let e=0,r=0;for(let i=0;i<3;++i){const o=t.getRange(i),a=o[1]-o[0];e+=a*a;const s=.5*(o[1]+o[0]);r+=s*s}const n=e>0&&(Math.abs(r)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&r>1e6);if(n){const i=new Float64Array(3),o=new Float64Array(3);for(let a=0;a<3;++a){const s=t.getRange(a),c=s[1]-s[0];i[a]=.5*(s[1]+s[0]),o[a]=c>0?1/c:1}return{useShiftAndScale:n,coordShift:i,coordScale:o}}return{useShiftAndScale:n,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}const{vtkErrorMacro:X3}=Z;function VU(t,e){const r=new Float64Array(3);Lp(r,e);const n=new Float64Array(16);return P4(n,tc(),t,r),n}function kU(t,e){return t===null||e===null?!1:!(O3(t,[0,0,0])&&O3(e,[1,1,1]))}function FU(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Ys.ARRAY_BUFFER),t.createVBO=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=o.points.getData();let c=null,l=null,d=null;const u=o.colors?o.colors.getNumberOfComponents():0,f=o.tcoords?o.tcoords.getNumberOfComponents():0;o.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=o.normals.getData()),o.customAttributes&&o.customAttributes.forEach(L=>{L&&(e.customData.push({data:L.getData(),offset:4*e.blockSize,components:L.getNumberOfComponents(),name:L.getName()}),e.blockSize+=L.getNumberOfComponents())}),o.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=f,e.blockSize+=f,l=o.tcoords.getData()),o.colors?(e.colorComponents=o.colors.getNumberOfComponents(),e.colorOffset=0,d=o.colors.getData(),e.colorBO||(e.colorBO=Ks.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let h=0,g=0,p=0,v=0,w=0,m=0,y;const C={anythingToPoints(L,F,j,Y){for(let ie=0;ie<L;++ie)y(F[j+ie],Y)},linesToWireframe(L,F,j,Y){for(let ie=0;ie<L-1;++ie)y(F[j+ie],Y),y(F[j+ie+1],Y)},polysToWireframe(L,F,j,Y){if(L>2)for(let ie=0;ie<L;++ie)y(F[j+ie],Y),y(F[j+(ie+1)%L],Y)},stripsToWireframe(L,F,j,Y){if(L>2){for(let ie=0;ie<L-1;++ie)y(F[j+ie],Y),y(F[j+ie+1],Y);for(let ie=0;ie<L-2;ie++)y(F[j+ie],Y),y(F[j+ie+2],Y)}},polysToSurface(L,F,j,Y){for(let ie=0;ie<L-2;ie++)y(F[j+0],Y),y(F[j+ie+1],Y),y(F[j+ie+2],Y)},stripsToSurface(L,F,j,Y){for(let ie=0;ie<L-2;ie++)y(F[j+ie],Y),y(F[j+ie+1+ie%2],Y),y(F[j+ie+1+(ie+1)%2],Y)}},x={anythingToPoints(L,F){return L},linesToWireframe(L,F){return L>1?(L-1)*2:0},polysToWireframe(L,F){return L>2?L*2:0},stripsToWireframe(L,F){return L>2?L*4-6:0},polysToSurface(L,F){return L>2?(L-2)*3:0},stripsToSurface(L,F,j){return L>2?(L-2)*3:0}};let S=null,T=null;i===vo.POINTS||n==="verts"?(S=C.anythingToPoints,T=x.anythingToPoints):i===vo.WIREFRAME||n==="lines"?(S=C[`${n}ToWireframe`],T=x[`${n}ToWireframe`]):(S=C[`${n}ToSurface`],T=x[`${n}ToSurface`]);const _=r.getData(),E=_.length;let D=0;for(let L=0;L<E;)D+=T(_[L],_),L+=_[L]+1;let b=null;const I=new Float32Array(D*e.blockSize);d&&(b=new Uint8Array(D*4));let O=0,M=0;const{useShiftAndScale:R,coordShift:A,coordScale:G}=uw(o.points);if(R?t.setCoordShiftAndScale(A,G):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),a)if(!a.points&&!a.cells)a.points=new Int32Array(D),a.cells=new Int32Array(D);else{const L=new Int32Array(D+a.points.length);L.set(a.points),a.points=L;const F=new Int32Array(D+a.cells.length);F.set(a.cells),a.cells=F}let k=o.vertexOffset;y=function(F,j){if(a&&(a.points[k]=F,a.cells[k]=m+o.cellOffset),++k,h=F*3,e.coordShiftAndScaleEnabled?(I[O++]=(s[h++]-e.coordShift[0])*e.coordScale[0],I[O++]=(s[h++]-e.coordShift[1])*e.coordScale[1],I[O++]=(s[h++]-e.coordShift[2])*e.coordScale[2]):(I[O++]=s[h++],I[O++]=s[h++],I[O++]=s[h++]),c!==null&&(o.haveCellNormals?g=(m+o.cellOffset)*3:g=F*3,I[O++]=c[g++],I[O++]=c[g++],I[O++]=c[g++]),e.customData.forEach(Y=>{w=F*Y.components;for(let ie=0;ie<Y.components;++ie)I[O++]=Y.data[w++]}),l!==null){o.useTCoordsPerCell?p=j*f:p=F*f;for(let Y=0;Y<f;++Y)I[O++]=l[p++]}d!==null&&(o.haveCellScalars?v=(m+o.cellOffset)*u:v=F*u,b[M++]=d[v++],b[M++]=d[v++],b[M++]=d[v++],b[M++]=u===4?d[v++]:255)};for(let L=0;L<E;L+=_[L]+1,m++)S(_[L],_,L+1,m+o.cellOffset);return e.elementCount=D,t.upload(I,Ys.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(b,Ys.ARRAY_BUFFER)),m},t.setCoordShiftAndScale=(r,n)=>{if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){X3("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){X3("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!Zv(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!Zv(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=kU(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=VU(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const UU={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function gb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UU,r),Ks.extend(t,e,r),Z.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),Z.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),FU(t,e)}const BU=Z.newInstance(gb);var GU={newInstance:BU,extend:gb};const{vtkErrorMacro:WU}=Z;function $U(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return WU(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const zU={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function pb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zU,r),Z.obj(t,e),Z.setGet(t,e,["shaderType","source","error","handle","context"]),$U(t,e)}const jU=Z.newInstance(pb,"vtkShader");var f2={newInstance:jU,extend:pb};const{vtkErrorMacro:Na}=Z;function HU(t,e,r,n){const i=typeof r=="string"?r:r.join(`
`),o=n===!1?e:new RegExp(e,"g"),a=t.replace(o,i);return{replace:a!==i,result:a}}function XU(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Na(e.error),0):t.link()?(t.setCompiled(!0),1):(Na(`Links failed: ${e.error}`),0):(Na(e.fragmentShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),Na(e.fragmentShader.getError()),0):(Na(e.vertexShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),Na(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=r=>{e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const n=e.context.getProgramInfoLog(e.handle);return Na(`Error linking shader ${n}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const o=new Float32Array(n);return e.context.uniformMatrix4fv(i,!1,o),!0},t.setUniformMatrix3x3=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const o=new Float32Array(n);return e.context.uniformMatrix3fv(i,!1,o),!0},t.setUniformf=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1f(i,n),!0)},t.setUniformfv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1fv(i,n),!0)},t.setUniformi=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1i(i,n),!0)},t.setUniformiv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1iv(i,n),!0)},t.setUniform2f=(r,n,i)=>{const o=t.findUniform(r);if(o===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(o,n,i),!0},t.setUniform2fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2fv(i,n),!0)},t.setUniform2i=(r,n,i)=>{const o=t.findUniform(r);if(o===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(o,n,i),!0},t.setUniform2iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2iv(i,n),!0)},t.setUniform3f=(r,n,i,o)=>{const a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(o===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n,i,o),!0},t.setUniform3fArray=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,n[0],n[1],n[2]),!0},t.setUniform3fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3fv(i,n),!0)},t.setUniform3i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,s[0],s[1],s[2]),!0},t.setUniform3iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3iv(i,n),!0)},t.setUniform4f=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4fv(i,n),!0)},t.setUniform4i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4iv(i,n),!0)},t.findUniform=r=>{if(!r||!e.linked)return-1;let n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error=`Uniform ${r} not found in current shader program.`,e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=r=>{if(!r)return!1;let n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):(Na("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=r=>{if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return Na("attempt to find uniform when the shader program is not linked"),!1;const n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=r=>{if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=r=>{if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=r=>{e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=r=>{e.lastCameraMTime=r}}const KU={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function mb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KU,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=f2.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=f2.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=f2.newInstance(),e.geometryShader.setShaderType("Geometry"),Z.obj(t,e),Z.get(t,e,["lastCameraMTime"]),Z.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),XU(t,e)}const qU=Z.newInstance(mb,"vtkShaderProgram");var Re={newInstance:qU,extend:mb,substitute:HU};function YU(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,i.buffer);for(let o=0;o<i.attributes.length;++o){const a=i.attributes[o],s=a.isMatrix?a.size:1;for(let c=0;c<s;++c)r.enableVertexAttribArray(a.index+c),r.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,1):r.vertexAttribDivisor(a.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,i.buffer);for(let o=0;o<i.attributes.length;++o){const a=i.attributes[o],s=a.isMatrix?a.size:1;for(let c=0;c<s;++c)r.enableVertexAttribArray(a.index+c),r.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,0):r.vertexAttribDivisor(a.index+c,0)),r.disableVertexAttribArray(a.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(r,n,i,o,a,s,c,l)=>t.addAttributeArrayWithDivisor(r,n,i,o,a,s,c,l,0,!1),t.addAttributeArrayWithDivisor=(r,n,i,o,a,s,c,l,d,u)=>{if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==Ys.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;const f=e.context,h={};if(h.name=i,h.index=f.getAttribLocation(e.handleProgram,i),h.offset=o,h.stride=a,h.type=s,h.size=c,h.normalize=l,h.isMatrix=u,h.divisor=d,h.Index===-1)return!1;if(n.bind(),f.enableVertexAttribArray(h.index),f.vertexAttribPointer(h.index,h.size,h.type,h.normalize,h.stride,h.offset),d>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h.index,1):f.vertexAttribDivisor(h.index,1)),h.buffer=n.getHandle(),!e.supported){let g=!1;for(let p=0;p<e.buffers.length;++p){const v=e.buffers[p];if(v.buffer===h.buffer){g=!0;let w=!1;for(let m=0;m<v.attributes.length;++m)v.attributes[m].name===i&&(w=!0,v.attributes[m]=h);w||v.attributes.push(h)}}g||e.buffers.push({buffer:h.buffer,attributes:[h]})}return!0},t.addAttributeMatrixWithDivisor=(r,n,i,o,a,s,c,l,d)=>{const u=t.addAttributeArrayWithDivisor(r,n,i,o,a,s,c,l,d,!0);if(!u)return u;const f=e.context,h=f.getAttribLocation(e.handleProgram,i);for(let g=1;g<c;g++)f.enableVertexAttribArray(h+g),f.vertexAttribPointer(h+g,c,s,l,a,o+a*g/c),d>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h+g,1):f.vertexAttribDivisor(h+g,1));return!0},t.removeAttributeArray=r=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];for(let o=0;o<i.attributes.length;++o)if(i.attributes[o].name===r)return i.attributes.splice(o,1),i.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const JU={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function vb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JU,r),e.buffers=[],Z.obj(t,e),Z.get(t,e,["supported"]),Z.setGet(t,e,["forceEmulation"]),YU(t,e)}const ZU=Z.newInstance(vb,"vtkOpenGLVertexArrayObject");var $1={newInstance:ZU,extend:vb};const Ba={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function QU(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=r=>{e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=r=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(r,n,i,o)=>{if(e.CABO.getElementCount()){const a=t.getOpenGLMode(i),s=t.haveWideLines(r,n),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),a===c.LINES&&s?(t.updateShaders(r,n,o),c.drawArraysInstanced(a,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(c.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,o),c.drawArrays(a,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(a===c.POINTS?1:0)||(a===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=r=>{if(e.pointPicking)return e.context.POINTS;const n=e.primitiveType;return r===vo.POINTS||n===Ba.Points?e.context.POINTS:r===vo.WIREFRAME||n===Ba.Lines||n===Ba.TrisEdges||n===Ba.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(r,n)=>n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(r,n,i)=>!!(i.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime()),t.updateShaders=(r,n,i)=>{if(t.getNeedToRebuildShaders(r,n,i)){const o={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(o,r,n);const a=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==t.getProgram()&&(t.setProgram(a),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,r,n),i.setPropertyShaderParameters(t,r,n),i.setCameraShaderParameters(t,r,n),i.setLightingShaderParameters(t,r,n),i.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=(r,n,i)=>{if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const o=parseFloat(n.getProperty().getLineWidth()),a=o/2;t.getProgram().setUniformf("lineWidthStepSize",o/Math.ceil(o)),t.getProgram().setUniformf("halfLineWidth",a)}e.primitiveType===Ba.Points||n.getProperty().getRepresentation()===vo.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(r,n,i)=>{let o=r.Vertex;o=Re.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,o=Re.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,i)&&(o=Re.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,o=Re.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=o},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Ba.Points?2:e.primitiveType===Ba.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const eB={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function yb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eB,r),Z.obj(t,e),e.shaderSourceTime={},Z.obj(e.shaderSourceTime),e.attributeUpdateTime={},Z.obj(e.attributeUpdateTime),Z.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=Re.newInstance(),e.VAO=$1.newInstance(),e.CABO=GU.newInstance(),QU(t,e)}const tB=Z.newInstance(yb);var lc={newInstance:tB,extend:yb,primTypes:Ba};const nB=t=>t,K3=1e-6;let wb=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=It(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?wN:nB}rotateFromDirections(e,r){const n=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16);Ji(n,e[0],e[1],e[2]),Ji(i,r[0],r[1],r[2]),Lt(n,n),Lt(i,i);const a=ft(n,i);return a>=1?this:(tn(this.tmp,n,i),pr(this.tmp)<K3&&(tn(this.tmp,[1,0,0],e),pr(this.tmp)<K3&&tn(this.tmp,[0,1,0],e)),G5(o,Math.acos(a),this.tmp),Wt(this.matrix,this.matrix,o),this)}rotate(e,r){return Ji(this.tmp,...r),Lt(this.tmp,this.tmp),Zr(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return F5(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return U5(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return B5(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,r,n){return Ji(this.tmp,e,r,n),Xn(this.matrix,this.matrix,this.tmp),this}scale(e,r,n){return Ji(this.tmp,e,r,n),es(this.matrix,this.matrix,this.tmp),this}multiply(e){return Wt(this.matrix,this.matrix,e),this}multiply3x3(e){return Wt(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Cr(this.matrix,this.matrix),this}identity(){return It(this.matrix),this}apply(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(A0(_5,this.matrix))return this;const i=n===-1?e.length:r+n*3;for(let o=r;o<i;o+=3)Ji(this.tmp,e[o],e[o+1],e[o+2]),Vt(this.tmp,this.tmp,this.matrix),e[o]=this.tmp[0],e[o+1]=this.tmp[1],e[o+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&fr(this.matrix,e),this}};function rB(){return new wb(!0)}function iB(){return new wb(!1)}var Qr={buildFromDegree:rB,buildFromRadian:iB};const oB=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],aB=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function sB(t,e){e.classHierarchy.push("vtkCubeSource"),t.requestData=(r,n)=>{const i=n[0]?.initialize()||Ii.newInstance();n[0]=i;const o=24,a=Z.newTypedArray(e.pointType,o*3);i.getPoints().setData(a,3);const s=Z.newTypedArray(e.pointType,o*3),c=Ot.newInstance({name:"Normals",values:s,numberOfComponents:3});i.getPointData().setNormals(c);let l=2;e.generate3DTextureCoordinates===!0&&(l=3);const d=Z.newTypedArray(e.pointType,o*l),u=Ot.newInstance({name:"TextureCoordinates",values:d,numberOfComponents:l});i.getPointData().setTCoords(u);const f=[0,0,0],h=[0,0,0],g=[0,0];let p=0;f[0]=-e.xLength/2,h[0]=-1,h[1]=0,h[2]=0;for(let v=0;v<2;v++){f[1]=-e.yLength/2;for(let w=0;w<2;w++){g[1]=f[1]+.5,f[2]=-e.zLength/2;for(let m=0;m<2;m++)g[0]=(f[2]+.5)*(1-2*v),a[p*3]=f[0],a[p*3+1]=f[1],a[p*3+2]=f[2],s[p*3]=h[0],s[p*3+1]=h[1],s[p*3+2]=h[2],l===2?(d[p*l]=g[0],d[p*l+1]=g[1]):(d[p*l]=2*v-1,d[p*l+1]=2*w-1,d[p*l+2]=2*m-1),p++,f[2]+=e.zLength;f[1]+=e.yLength}f[0]+=e.xLength,h[0]+=2}f[1]=-e.yLength/2,h[1]=-1,h[0]=0,h[2]=0;for(let v=0;v<2;v++){f[0]=-e.xLength/2;for(let w=0;w<2;w++){g[0]=(f[0]+.5)*(2*v-1),f[2]=-e.zLength/2;for(let m=0;m<2;m++)g[1]=(f[2]+.5)*-1,a[p*3]=f[0],a[p*3+1]=f[1],a[p*3+2]=f[2],s[p*3]=h[0],s[p*3+1]=h[1],s[p*3+2]=h[2],l===2?(d[p*l]=g[0],d[p*l+1]=g[1]):(d[p*l]=2*w-1,d[p*l+1]=2*v-1,d[p*l+2]=2*m-1),p++,f[2]+=e.zLength;f[0]+=e.xLength}f[1]+=e.yLength,h[1]+=2}f[2]=-e.zLength/2,h[2]=-1,h[0]=0,h[1]=0;for(let v=0;v<2;v++){f[1]=-e.yLength/2;for(let w=0;w<2;w++){g[1]=f[1]+.5,f[0]=-e.xLength/2;for(let m=0;m<2;m++)g[0]=(f[0]+.5)*(2*v-1),a[p*3]=f[0],a[p*3+1]=f[1],a[p*3+2]=f[2],s[p*3]=h[0],s[p*3+1]=h[1],s[p*3+2]=h[2],l===2?(d[p*l]=g[0],d[p*l+1]=g[1]):(d[p*l]=2*m-1,d[p*l+1]=2*w-1,d[p*l+2]=2*v-1),p++,f[0]+=e.xLength;f[1]+=e.yLength}f[2]+=e.zLength,h[2]+=2}if(e.rotations&&Qr.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(a).apply(s),e.center&&Qr.buildFromRadian().translate(...e.center).apply(a),e.matrix){Qr.buildFromRadian().setMatrix(e.matrix).apply(a);const v=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];Qr.buildFromRadian().setMatrix(v).apply(s)}e.generateFaces?i.getPolys().deepCopy(e._polys):i.getPolys().initialize(),e.generateLines?(i.getLines().deepCopy(e._lineCells),i.getPointData().setNormals(null)):i.getLines().initialize(),i.modified()},t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let n=0;n<arguments.length;n++)r.push(n<0||arguments.length<=n?void 0:arguments[n]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))}}const cB={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function Cb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cB,r),Z.obj(t,e),Z.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),Z.setGetArray(t,e,["center","rotations"],3),Z.setGetArray(t,e,["matrix"],16),e._polys=ll.newInstance({values:Uint16Array.from(aB)}),e._lineCells=ll.newInstance({values:Uint16Array.from(oB)}),Z.moveToProtected(t,e,["polys","lineCells"]),Z.algo(t,e,0,1),sB(t,e)}const lB=Z.newInstance(Cb,"vtkCubeSource");var xb={newInstance:lB,extend:Cb};const{vtkErrorMacro:q3}=Z;function uB(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const r={...t};t.requestData=(n,i)=>{const o=n[0];if(!o||!o.isA("vtkImageData")){q3("Invalid or missing input");return}const a=o.getSpatialExtent();if(!a){q3("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(a),e._cubeSource.setMatrix(o.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(r.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const dB={};function Sb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dB,r),Z.obj(t,e),Z.algo(t,e,1,1),e._cubeSource=xb.newInstance(),Z.moveToProtected(t,e,["cubeSource","tmpOut"]),uB(t,e)}const fB=Z.newInstance(Sb,"vtkImageDataOutlineFilter");var hB={newInstance:fB,extend:Sb};const Xf={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Dt={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var Tb={Wrap:Xf,Filter:Dt};const _b=new Float32Array(1),gB=new Int32Array(_b.buffer);function pB(t){_b[0]=t;const e=gB[0];let r=e>>16&32768,n=e>>12&2047;const i=e>>23&255;return i<103?r:i>142?(r|=31744,r|=(i===255?0:1)&&e&8388607,r):i<113?(n|=2048,r|=(n>>114-i)+(n>>113-i&1),r):(r|=i-112<<10|n>>1,r+=n&1,r)}function mB(t){const e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*2**-14*(n/2**10):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(r-15)*(1+n/2**10)}var i0={fromHalf:mB,toHalf:pB};function vB(){try{const n=new Int16Array([0,32767]),i=[1,1],o=document.createElement("canvas");o.width=4,o.height=4;const a=o.getContext("webgl2");if(!a)return!1;const s=a.getExtension("EXT_texture_norm16");if(!s)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,l=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,d=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))return!1;const u=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(u,l),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))return!1;const f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,u),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))return!1;const h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,s.R16_SNORM_EXT,2,1,0,a.RED,a.SHORT,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.useProgram(f),a.drawArrays(a.POINTS,0,1);const g=new Uint8Array(4);a.readPixels(i[0],i[1],1,1,a.RGBA,a.UNSIGNED_BYTE,g);const[p,v,w]=g,m=a.getExtension("WEBGL_lose_context");return m&&m.loseContext(),p===v&&v===w&&p!==0}catch{return!1}}let h2;function yB(){return h2===void 0&&(h2=vB()),h2}const{Wrap:Bs,Filter:Lr}=Tb,{VtkDataTypes:un}=Ot,{vtkDebugMacro:g2,vtkErrorMacro:zl,vtkWarningMacro:Y3,requiredParam:yn}=Oi,{toHalf:wB}=i0;function CB(t,e){e.classHierarchy.push("vtkOpenGLTexture");function r(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(g?e._openGLRenderWindow=g:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Lr.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Lr.LINEAR),t.setMagnificationFilter(Lr.LINEAR)):(t.setMinificationFilter(Lr.NEAREST),t.setMagnificationFilter(Lr.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Bs.REPEAT),t.setWrapS(Bs.REPEAT),t.setWrapT(Bs.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImageBitmap()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Lr.LINEAR_MIPMAP_LINEAR)),e.renderable.getImageBitmap()&&e.renderable.getImageLoaded()&&(t.create2DFromImageBitmap(e.renderable.getImageBitmap()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Lr.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Lr.LINEAR_MIPMAP_LINEAR));const v=e.renderable.getCanvas();t.create2DFromRaw({width:v.width,height:v.height,numComps:4,dataType:un.UNSIGNED_CHAR,data:v,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const v=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Lr.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw({width:v.width,height:v.height,numComps:4,dataType:un.UNSIGNED_CHAR,data:v.data,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const p=e.renderable.getInputData(0);if(p&&p.getPointData().getScalars()){const v=p.getExtent(),w=p.getPointData().getScalars(),m=[];for(let y=0;y<e.renderable.getNumberOfInputPorts();++y){const C=e.renderable.getInputData(y),x=C?C.getPointData().getScalars().getData():null;x&&m.push(x)}e.renderable.getInterpolate()&&w.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Lr.LINEAR_MIPMAP_LINEAR)),m.length%6===0?t.createCubeFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:w.getNumberOfComponents(),dataType:w.getDataType(),data:m}):t.create2DFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:w.getNumberOfComponents(),dataType:w.getDataType(),data:w.getData()}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const n=()=>{if(!((e.minificationFilter===Lr.LINEAR||e.magnificationFilter===Lr.LINEAR)&&!yB()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=g=>{g&&e.handle&&(g.activateTexture(t),g.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(g),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let g=!1;if(e.context&&e.handle){let p=0;switch(e.target){case e.context.TEXTURE_2D:p=e.context.TEXTURE_BINDING_2D;break;default:Y3("impossible case");break}g=e.context.getIntegerv(p)===e.handle}return g},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(g,p)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(g,p)),e.internalFormat||g2(`Unable to find suitable internal format for T=${g} NC= ${p}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&Y3("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(g,p)=>{let v=0;return v=e._openGLRenderWindow.getDefaultTextureInternalFormat(g,p,n(),t.useHalfFloat()),v||(v||(g2("Unsupported internal texture type!"),g2(`Unable to find suitable internal format for T=${g} NC= ${p}`)),v)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=g=>{e._forceInternalFormat=!0,g!==e.internalFormat&&(e.internalFormat=g,t.modified())},t.getFormat=(g,p)=>(e.format=t.getDefaultFormat(g,p),e.format),t.getDefaultFormat=(g,p)=>{if(e._openGLRenderWindow.getWebgl2())switch(p){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(p){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=g=>{const p=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(g){case un.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!p&&un.SHORT):return e.context.SHORT;case(n()&&!p&&un.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(p&&un.SHORT):return e.context.HALF_FLOAT;case(p&&un.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case un.FLOAT:case un.VOID:default:return e.context.FLOAT}switch(g){case un.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case un.FLOAT:case un.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const v=e.context.getExtension("OES_texture_half_float");if(v&&e.context.getExtension("OES_texture_half_float_linear"))return v.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(g){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||p)&&(e.openGLDataType=t.getDefaultDataType(g)),e.openGLDataType},t.getShiftAndScale=()=>{let g=0,p=1;switch(e.openGLDataType){case e.context.BYTE:p=127.5,g=p-128;break;case e.context.UNSIGNED_BYTE:p=255,g=0;break;case e.context.SHORT:p=32767.5,g=p-32768;break;case e.context.UNSIGNED_SHORT:p=65536,g=0;break;case e.context.INT:p=21474836475e-1,g=p-2147483648;break;case e.context.UNSIGNED_INT:p=4294967295,g=0;break;case e.context.FLOAT:}return{shift:g,scale:p}},t.getOpenGLFilterMode=g=>{switch(g){case Lr.NEAREST:return e.context.NEAREST;case Lr.LINEAR:return e.context.LINEAR;case Lr.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Lr.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Lr.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Lr.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=g=>{switch(g){case Bs.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Bs.REPEAT:return e.context.REPEAT;case Bs.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function i(g){const[p,v,w,m,y,C]=g;return[v-p+1,m-w+1,C-y+1]}function o(g){const[p,v,w]=i(g);return p*v*w}function a(g,p,v,w,m){const[y,C,x,S,T,_]=v,[E,D]=p,b=E*D;let I=m;for(let O=T;O<=_;O++){const M=O*b;for(let R=x;R<=S;R++){const A=M+R*E;for(let G=A+y,k=A+C;G<=k;G++,I++)w[I]=g[G]}}}function s(g,p){const w=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||g.constructor,m=p.reduce((S,T)=>S+o(T),0),y=new w(m),C=[e.width,e.height,e.depth];let x=0;return p.forEach(S=>{a(g,C,S,y,x),x+=o(S)}),y}t.updateArrayDataTypeForGL=function(g,p){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];const m=[];let y=e.width*e.height*e.components;v&&(y*=e.depth);const C=!!w.length;if(g!==un.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let S=0;S<p.length;S++)if(p[S])if(C)m.push(s(p[S],w,Float32Array));else{const T=p[S].length>y?p[S].subarray(0,y):p[S];m.push(new Float32Array(T))}else m.push(null);if(g!==un.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let S=0;S<p.length;S++)if(p[S])if(C)m.push(s(p[S],w,Uint8Array));else{const T=p[S].length>y?p[S].subarray(0,y):p[S];m.push(new Uint8Array(T))}else m.push(null);let x=!1;if(e._openGLRenderWindow.getWebgl2())x=e.openGLDataType===e.context.HALF_FLOAT;else{const S=e.context.getExtension("OES_texture_half_float");x=S&&e.openGLDataType===S.HALF_FLOAT_OES}if(x)for(let S=0;S<p.length;S++)if(p[S]){const T=C?s(p[S],w):p[S],_=new Uint16Array(C?T.length:y),E=_.length;for(let D=0;D<E;D++)_[D]=wB(T[D]);m.push(_)}else m.push(null);if(m.length===0)for(let S=0;S<p.length;S++)m.push(C&&p[S]?s(p[S],w):p[S]);return m};function c(g){if(e._openGLRenderWindow.getWebgl2())return g;const p=[],v=e.width,w=e.height,m=e.components;if(g&&(!Kd(v)||!Kd(w))){const y=e.context.getExtension("OES_texture_half_float"),C=zc(v),x=zc(w),S=C*x*e.components;for(let T=0;T<g.length;T++)if(g[T]!==null){let _=null;const E=w/x,D=v/C;let b=!1;e.openGLDataType===e.context.FLOAT?_=new Float32Array(S):y&&e.openGLDataType===y.HALF_FLOAT_OES?(_=new Uint16Array(S),b=!0):_=new Uint8Array(S);for(let I=0;I<x;I++){const O=I*C*m,M=I*E;let R=Math.floor(M),A=Math.ceil(M);A>=w&&(A=w-1);const G=M-R,k=1-G;R=R*v*m,A=A*v*m;for(let L=0;L<C;L++){const F=L*m,j=L*D;let Y=Math.floor(j),ie=Math.ceil(j);ie>=v&&(ie=v-1);const de=j-Y;Y*=m,ie*=m;for(let ae=0;ae<m;ae++)b?_[O+F+ae]=i0.toHalf(i0.fromHalf(g[T][R+Y+ae])*k*(1-de)+i0.fromHalf(g[T][R+ie+ae])*k*de+i0.fromHalf(g[T][A+Y+ae])*G*(1-de)+i0.fromHalf(g[T][A+ie+ae])*G*de):_[O+F+ae]=g[T][R+Y+ae]*k*(1-de)+g[T][R+ie+ae]*k*de+g[T][A+Y+ae]*G*(1-de)+g[T][A+ie+ae]*G*de}}p.push(_),e.width=C,e.height=x}else p.push(null)}if(p.length===0)for(let y=0;y<g.length;y++)p.push(g[y]);return p}function l(g){return e._openGLRenderWindow?e.resizable||e.renderable?.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(g===un.UNSIGNED_SHORT||g===un.SHORT)):!1:!1}t.create2DFromRaw=function(){let{width:g=yn("width"),height:p=yn("height"),numComps:v=yn("numComps"),dataType:w=yn("dataType"),data:m=yn("data"),flip:y=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(w,!0),t.getInternalFormat(w,v),t.getFormat(w,v),!e.internalFormat||!e.format||!e.openGLDataType)return zl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=v,e.width=g,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const C=[m],x=t.updateArrayDataTypeForGL(w,C),S=c(x);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,y),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(w)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),S[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,S[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,S[0]),e.generateMipmap&&e.context.generateMipmap(e.target),y&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*v*e._openGLRenderWindow.getDefaultTextureByteSize(w,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=function(){let{width:g=yn("width"),height:p=yn("height"),numComps:v=yn("numComps"),dataType:w=yn("dataType"),data:m=yn("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(w),t.getInternalFormat(w,v),t.getFormat(w,v),!e.internalFormat||!e.format||!e.openGLDataType)return zl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=v,e.width=g,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=m.length/6-1,t.createTexture(),t.bind();const y=t.updateArrayDataTypeForGL(w,m),C=c(y),x=[];let S=e.width,T=e.height;for(let _=0;_<C.length;_++){_%6===0&&_!==0&&(S/=2,T/=2),x[_]=Z0(w,T*S*e.components);for(let E=0;E<T;++E){const D=E*S*e.components,b=(T-E-1)*S*e.components;x[_].set(C[_].slice(b,b+S*e.components),D)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(w)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let _=0;_<6;_++){let E=0,D=e.width,b=e.height;for(;D>=1&&b>=1;){let I=null;E<=e.maxLevel&&(I=x[6*E+_]),l(w)?I!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+_,E,0,0,D,b,e.format,e.openGLDataType,I):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+_,E,e.internalFormat,D,b,0,e.format,e.openGLDataType,I),E++,D/=2,b/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*v*e._openGLRenderWindow.getDefaultTextureByteSize(w,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=function(){let{width:g=yn("width"),height:p=yn("height"),dataType:v=yn("dataType"),data:w=yn("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.getOpenGLDataType(v),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?v===un.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(zl("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=g,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(v)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),w!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,w)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,w),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(v,n(),t.useHalfFloat()),t.deactivate(),!0)},t.create2DFromImage=g=>{if(t.getOpenGLDataType(un.UNSIGNED_CHAR),t.getInternalFormat(un.UNSIGNED_CHAR,4),t.getFormat(un.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return zl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const p=!e._openGLRenderWindow.getWebgl2()&&(!Kd(g.width)||!Kd(g.height));let v=g,w=g.width,m=g.height,y=!0;const C=window.chrome;if(p||C){const x=new OffscreenCanvas(zc(g.width),zc(g.height));w=x.width,m=x.height;const S=x.getContext("2d");S.translate(0,x.height),S.scale(1,-1),S.drawImage(g,0,0,g.width,g.height,0,0,x.width,x.height),v=x,y=!1}return e.width=w,e.height=m,e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,y),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(un.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(un.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0},t.create2DFromImageBitmap=g=>(t.getOpenGLDataType(un.UNSIGNED_CHAR),t.getInternalFormat(un.UNSIGNED_CHAR,4),t.getFormat(un.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType?(zl("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.width=g.width,e.height=g.height,l(un.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(un.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0));function d(g,p,v){const w=new Array(v),m=new Array(v);for(let y=0;y<v;++y)w[y]=g[y],m[y]=p[y]-g[y]||1;return{scale:m,offset:w}}function u(g,p){for(let v=0;v<g.length;v++){const w=g[v],m=p[v]+w;if(w<-2048||w>2048||m<-2048||m>2048)return!1}return!0}function f(g,p,v,w){t.getOpenGLDataType(g);const m=u(p,v)||w;let y=!1;if(e._openGLRenderWindow.getWebgl2())y=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&m||e.openGLDataType===e.context.HALF_FLOAT;else{const C=e.context.getExtension("OES_texture_half_float");y=C&&e.openGLDataType===C.HALF_FLOAT_OES}e.canUseHalfFloat=y&&m}function h(g,p){const v=g.getNumberOfComponents(),w=g.getDataType(),m=g.getData(),y=new Array(v),C=new Array(v);for(let S=0;S<v;++S){const[T,_]=g.getRange(S);y[S]=T,C[S]=_}const x=d(y,C,v);return f(w,x.offset,x.scale,p),t.useHalfFloat()||t.getOpenGLDataType(w,!0),{numComps:v,dataType:w,data:m,scaleOffsets:x}}t.create2DFilterableFromRaw=function(){let{width:g=yn("width"),height:p=yn("height"),numComps:v=yn("numComps"),dataType:w=yn("dataType"),data:m=yn("data"),preferSizeOverAccuracy:y=!1,ranges:C=void 0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create2DFilterableFromDataArray({width:g,height:p,dataArray:Ot.newInstance({numberOfComponents:v,dataType:w,values:m,ranges:C}),preferSizeOverAccuracy:y})},t.create2DFilterableFromDataArray=function(){let{width:g=yn("width"),height:p=yn("height"),dataArray:v=yn("dataArray"),preferSizeOverAccuracy:w=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:m,dataType:y,data:C}=h(v,w);t.create2DFromRaw({width:g,height:p,numComps:m,dataType:y,data:C})},t.updateVolumeInfoForGL=(g,p)=>{let v=!1;const w=t.useHalfFloat();(!e.volumeInfo?.scale||!e.volumeInfo?.offset)&&(e.volumeInfo={scale:new Array(p),offset:new Array(p)});for(let m=0;m<p;++m)e.volumeInfo.scale[m]=1,e.volumeInfo.offset[m]=0;if(n()&&!w&&g===un.SHORT){for(let m=0;m<p;++m)e.volumeInfo.scale[m]=32767;v=!0}if(n()&&!w&&g===un.UNSIGNED_SHORT){for(let m=0;m<p;++m)e.volumeInfo.scale[m]=65535;v=!0}if(g===un.UNSIGNED_CHAR){for(let m=0;m<p;++m)e.volumeInfo.scale[m]=255;v=!0}return(g===un.FLOAT||w&&(g===un.SHORT||g===un.UNSIGNED_SHORT))&&(v=!0),v},t.create3DFromRaw=function(){let{width:g=yn("width"),height:p=yn("height"),depth:v=yn("depth"),numComps:w=yn("numComps"),dataType:m=yn("dataType"),data:y=yn("data"),updatedExtents:C=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=m,S=y;if(!t.updateVolumeInfoForGL(x,w)&&S){const O=g*p*v,M=structuredClone(e.volumeInfo),R=new Float32Array(O*w);e.volumeInfo.offset=M.offset,e.volumeInfo.scale=M.scale;let A=0;const G=M.scale.map(k=>1/k);for(let k=0;k<O;k++)for(let L=0;L<w;L++)R[A]=(S[A]-M.offset[L])*G[L],A++;x=un.FLOAT,S=R}if(t.getOpenGLDataType(x),t.getInternalFormat(x,w),t.getFormat(x,w),!e.internalFormat||!e.format||!e.openGLDataType)return zl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=w,e.width=g,e.height=p,e.depth=v,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const T=C.length>0,_=!T||!m5(e._prevTexParams,r()),E=[S],b=t.updateArrayDataTypeForGL(x,E,!0,_?[]:C),I=c(b);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),_)l(x)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),I[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,I[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,I[0]),e._prevTexParams=r();else if(T){const O=I[0];let M=0;for(let R=0;R<C.length;R++){const A=C[R],G=i(A),k=o(A),L=new O.constructor(O.buffer,M,k);M+=L.byteLength,e.context.texSubImage3D(e.target,0,A[0],A[2],A[4],G[0],G[1],G[2],e.format,e.openGLDataType,L)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(x,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(){let{width:g=yn("width"),height:p=yn("height"),depth:v=yn("depth"),numComps:w=yn("numComps"),dataType:m=yn("dataType"),data:y=yn("data"),preferSizeOverAccuracy:C=!1,ranges:x=void 0,updatedExtents:S=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create3DFilterableFromDataArray({width:g,height:p,depth:v,dataArray:Ot.newInstance({numberOfComponents:w,dataType:m,values:y,ranges:x}),preferSizeOverAccuracy:C,updatedExtents:S})},t.create3DFilterableFromDataArray=function(){let{width:g=yn("width"),height:p=yn("height"),depth:v=yn("depth"),dataArray:w=yn("dataArray"),preferSizeOverAccuracy:m=!1,updatedExtents:y=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:C,dataType:x,data:S,scaleOffsets:T}=h(w,m),_=[],E=[];for(let fe=0;fe<C;++fe)_[fe]=0,E[fe]=1;if(e.volumeInfo={scale:E,offset:_,dataComputedScale:T.scale,dataComputedOffset:T.offset,width:g,height:p,depth:v},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw({width:g,height:p,depth:v,numComps:C,dataType:x,data:S,updatedExtents:y});const D=g*p*v,b=structuredClone(T);let I=(fe,we,_e,Se,B)=>{fe[we]=_e},O=un.UNSIGNED_CHAR;if(x===un.UNSIGNED_CHAR)for(let fe=0;fe<C;++fe)b.offset[fe]=0,b.scale[fe]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(O=un.FLOAT,I=(fe,we,_e,Se,B)=>{fe[we]=(_e-Se)/B}):(O=un.UNSIGNED_CHAR,I=(fe,we,_e,Se,B)=>{fe[we]=255*(_e-Se)/B});if(t.getOpenGLDataType(O),t.getInternalFormat(O,C),t.getFormat(O,C),!e.internalFormat||!e.format||!e.openGLDataType)return zl("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=C,e.depth=1,e.numberOfDimensions=2;let M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);M>4096&&(O===un.FLOAT||C>=3)&&(M=4096);let R=1,A=1;D>M*M&&(R=Math.ceil(Math.sqrt(D/(M*M))),A=R);let G=Math.sqrt(D)/R;G=zc(G);const k=Math.floor(G*R/g),L=Math.ceil(v/k),F=zc(p*L/A);e.width=G,e.height=F,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=k,e.volumeInfo.yreps=L,e.volumeInfo.xstride=R,e.volumeInfo.ystride=A,e.volumeInfo.offset=b.offset,e.volumeInfo.scale=b.scale;let j;const Y=G*F*C;O===un.FLOAT?j=new Float32Array(Y):j=new Uint8Array(Y);let ie=0;const de=Math.floor(g/R),ae=Math.floor(p/A);for(let fe=0;fe<L;fe++){const we=Math.min(k,v-fe*k),_e=C*(e.width-we*Math.floor(g/R));for(let Se=0;Se<ae;Se++){for(let B=0;B<we;B++){const P=C*((fe*k+B)*g*p+A*Se*g);for(let $=0;$<de;$++)for(let W=0;W<C;W++)I(j,ie,S[P+R*$*C+W],b.offset[W],b.scale[W]),ie++}ie+=_e}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),l(O)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),j!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,j)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,j),t.deactivate(),!0},t.setOpenGLRenderWindow=g=>{e._openGLRenderWindow!==g&&(t.releaseGraphicsResources(),e._openGLRenderWindow=g,e.context=null,g&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=g=>g&&g.isCurrent()?g.getIntegerv(g.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=g=>{e.enableUseHalfFloat=g}}const xB={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Bs.CLAMP_TO_EDGE,wrapT:Bs.CLAMP_TO_EDGE,wrapR:Bs.CLAMP_TO_EDGE,minificationFilter:Lr.NEAREST,magnificationFilter:Lr.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function Eb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xB,r),Ir.extend(t,e,r),e.sendParametersTime={},Jn(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Jn(e.textureBuildTime,{mtime:0}),xh(t,e,["format","openGLDataType"]),Ur(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),ji(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),Sh(t,e,["openGLRenderWindow"]),CB(t,e)}const bb=zn(Eb,"vtkOpenGLTexture");var $n={newInstance:bb,extend:Eb,...Tb};ti("vtkTexture",bb);function SB(t,e){t.replaceShaderCoincidentOffset=(r,n,i)=>{const o=t.getCoincidentParameters(n,i);if(o&&(o.factor!==0||o.offset!==0)){let a=r.Fragment;a=Re.substitute(a,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(o.factor!==0?(a=Re.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=Re.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=Re.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(o.factor!==0?(a=Re.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=Re.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=Re.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=a}}}function TB(t,e){t.applyShaderReplacements=(r,n,i)=>{let o=null;if(n&&(o=n.ShaderReplacements),o)for(let a=0;a<o.length;a++){const s=o[a];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,l=r[c],d=Re.substitute(l,s.originalValue,s.replacementValue,s.replaceAll);r[c]=d.result}}},t.buildShaders=(r,n,i)=>{t.getReplacedShaderTemplate(r,n,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);const o=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,o,!0),t.replaceShaderValues(r,n,i),t.applyShaderReplacements(r,o)},t.getReplacedShaderTemplate=(r,n,i)=>{const o=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,i);let a=r.Vertex;if(o){const l=o.VertexShaderCode;l!==void 0&&l!==""&&(a=l)}r.Vertex=a;let s=r.Fragment;if(o){const l=o.FragmentShaderCode;l!==void 0&&l!==""&&(s=l)}r.Fragment=s;let c=r.Geometry;if(o){const l=o.GeometryShaderCode;l!==void 0&&(c=l)}r.Geometry=c}}var ul={implementReplaceShaderCoincidentOffset:SB,implementBuildShadersWithReplacements:TB};const{vtkWarningMacro:_B}=Z;let dw;function EB(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(r,n)=>(Vt(n,r,e.matrix),n),t.transformPoints=(r,n)=>{const i=new Float64Array(3),o=new Float64Array(3);for(let a=0;a<r.length;a+=3)i[0]=r[a],i[1]=r[a+1],i[2]=r[a+2],Vt(o,i,e.matrix),n[a]=o[0],n[a+1]=o[1],n[a+2]=o[2];return n},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(r,n)=>(e.preMultiplyFlag?Wt(n,e.matrix,r):Wt(n,r,e.matrix),n),t.transformMatrices=(r,n)=>{const i=new Float64Array(16),o=new Float64Array(16),a=e.preMultiplyFlag?()=>Wt(o,e.matrix,i):()=>Wt(o,i,e.matrix);for(let s=0;s<r.length;s+=16){for(let c=0;c<16;++c)i[c]=r[s+c];a();for(let c=0;c<16;++c)n[s+c]=o[c]}return n},t.getInverse=()=>dw({matrix:pt.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag}),t.translate=(r,n,i)=>{if(r===0&&n===0&&i===0)return;const o=fi();ed(o,[r,n,i]),e.preMultiplyFlag?Wt(e.matrix,e.matrix,o):Wt(e.matrix,o,e.matrix),t.modified()},t.rotateWXYZ=(r,n,i,o)=>{if(n===0&&i===0&&o===0){_B("No rotation applied, axis is zero vector.");return}if(r===0)return;const a=pt.radiansFromDegrees(r),s=tc();bh(s,[n,i,o],a);const c=new Float64Array(16);S0(c,s),e.preMultiplyFlag?Wt(e.matrix,e.matrix,c):Wt(e.matrix,c,e.matrix),t.modified()},t.rotateX=r=>{t.rotateWXYZ(r,1,0,0)},t.rotateY=r=>{t.rotateWXYZ(r,0,1,0)},t.rotateZ=r=>{t.rotateWXYZ(r,0,0,1)},t.scale=(r,n,i)=>{if(r===1&&n===1&&i===1)return;const o=fi();k1(o,[r,n,i]),e.preMultiplyFlag?Wt(e.matrix,e.matrix,o):Wt(e.matrix,o,e.matrix),t.modified()},t.transformNormal=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=el(Vo(),e.matrix),o=Vo();ec(o,i);const a=Vo();return V0(a,o),t.transformVector(r,n,a),pt.normalize(n),n},t.transformNormals=(r,n)=>{const i=r.getData(),o=n.getData(),a=[0,0,0],s=el(Vo(),e.matrix),c=Vo();ec(c,s);const l=Vo();V0(l,c);for(let d=0;d<i.length;d+=3)a[0]=i[d],a[1]=i[d+1],a[2]=i[d+2],t.transformVector(a,a,l),pt.normalize(a),o[d]=a[0],o[d+1]=a[1],o[d+2]=a[2]},t.transformVector=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const o=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||el(Vo(),e.matrix);return zf(n,r,o),n},t.transformVectors=(r,n)=>{const i=r.getData(),o=n.getData(),a=[0,0,0];for(let s=0;s<i.length;s+=3)a[0]=i[s],a[1]=i[s+1],a[2]=i[s+2],t.transformVector(a,a),pt.normalize(a),o[s]=a[0],o[s+1]=a[1],o[s+2]=a[2]},t.transformPointsNormalsVectors=function(r,n,i,o,a,s){let c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;const d=r.getNumberOfPoints(),u=c?.length??0,f=new Float64Array(3),h=new Float64Array(3),g=new Float64Array(3),p=new Float64Array(3);let v=!1,w=!1,m=!1;const y=[];for(let C=0;C<d;C++){if(r.getPoint(C,f),h.set(f),t.transformPoint(f,f),n.setPoint(C,...f),pt.areEquals(h,f)||(v=!0),a){const x=a.getData(),S=s.getData();f[0]=x[C*3],f[1]=x[C*3+1],f[2]=x[C*3+2],g.set(f),t.transformVector(f,f),S[C*3]=f[0],S[C*3+1]=f[1],S[C*3+2]=f[2],pt.areEquals(g,f)||(w=!0)}if(i){const x=i.getData(),S=o.getData();f[0]=x[C*3],f[1]=x[C*3+1],f[2]=x[C*3+2],p.set(f),t.transformNormal(f,f),S[C*3]=f[0],S[C*3+1]=f[1],S[C*3+2]=f[2],pt.areEquals(p,f)||(m=!0)}if(c)for(let x=0;x<u;x++){const S=c[x].getData(),T=l[x].getData();f[0]=S[C*3],f[1]=S[C*3+1],f[2]=S[C*3+2],g.set(f),t.transformVector(f,f),T[C*3]=f[0],T[C*3+1]=f[1],T[C*3+2]=f[2],!pt.arrayEqual(g,f)&&!y.includes(x)&&y.push(x)}}v&&n.modified(),w&&s.modified(),m&&o.modified(),y.forEach(C=>l[C].modified())}}const bB={preMultiplyFlag:!1,matrix:[..._5]};function Db(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bB,r),Z.obj(t,e),Z.setGet(t,e,["preMultiplyFlag"]),Z.setGetArray(t,e,["matrix"],16),EB(t,e)}dw=Z.newInstance(Db,"vtkTransform");var DB={newInstance:dw,extend:Db};function ts(t,e,r){return t.length>0?`${t.map(n=>n?.getMTime()??"x").join("/")}-${e}-${r}`:"0"}function fw(t,e){return`${e.getMTime()}`}var IB=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,MB=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const nl={NEAREST:0,LINEAR:1};var OB={InterpolationType:nl};const Ca={Off:0,PolygonOffset:1};let iy=Ca.PolygonOffset,Gp=Ca.Off;const PB=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function RB(){return iy}function AB(t){const e=iy===t;return iy=t,e}function LB(){return Gp}function z1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=Gp===t;return Gp=t,e}function NB(){return z1(Ca.Off)}function VB(){return z1(Ca.Off)}function kB(){return z1(Ca.PolygonOffset)}function FB(){return PB[Gp]}var oy={Resolve:Ca,getResolveCoincidentTopologyAsString:FB,getResolveCoincidentTopologyPolygonOffsetFaces:RB,getResolveCoincidentTopology:LB,setResolveCoincidentTopology:z1,setResolveCoincidentTopologyPolygonOffsetFaces:AB,setResolveCoincidentTopologyToDefault:NB,setResolveCoincidentTopologyToOff:VB,setResolveCoincidentTopologyToPolygonOffset:kB};function Ib(t,e,r){r.forEach(n=>{t[`get${n.method}`]=()=>e[n.key],t[`set${n.method}`]=Z.objectSetterMap.object(t,e,{name:n.key,params:["factor","offset"]})})}const hw=["Polygon","Line","Point"],UB={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},BB=()=>{},su={modified:BB};Ib(su,UB,hw.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function GB(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),Z.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(oy).forEach(r=>{t[r]=oy[r]}),Object.keys(su).filter(r=>r!=="modified").forEach(r=>{t[r]=su[r]}),Ib(t,e.topologyOffset,hw.map(r=>({key:r,method:`RelativeCoincidentTopology${r}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const r=su.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const r=su.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const r=su.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var j1={implementCoincidentTopologyMethods:GB,staticOffsetAPI:su,otherStaticMethods:oy,CATEGORIES:hw,Resolve:Ca};const{vtkErrorMacro:jl}=Oi;function J3(t,e,r){return e.identity(r),t.reduce((n,i,o)=>o===0?i?e.copy(n,i):e.identity(n):i?e.multiply(n,n,i):n,r)}function WB(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");const r=new Map;function n(c,l){if(!l)return;const u=(r.get(l)??0)-1;u<=0?(c.unregisterGraphicsResourceUser(l,t),r.delete(l)):r.set(l,u)}function i(c,l){if(!l)return;const d=r.get(l)??0,u=d+1;r.set(l,u),d<=0&&c.registerGraphicsResourceUser(l,t)}function o(c,l,d){l!==d&&(n(c,l),i(c,d))}function a(c){[...r.keys()].forEach(l=>c.unregisterGraphicsResourceUser(l,t))}t.buildPass=c=>{if(c){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const l=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(l.getActiveCamera());const d=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),d&&!d.isDeleted()&&d!==e._openGLRenderWindow&&a(d),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(c,l)=>{c&&(e.currentRenderPass=l,t.render())},t.zBufferPass=c=>{c&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=c=>t.zBufferPass(c),t.opaquePass=c=>{c&&t.render()},t.getCoincidentParameters=(c,l)=>e.renderable.getResolveCoincidentTopology()==Ca.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const c=e._openGLImageSlice.getRenderable(),l=e._openGLRenderer.getRenderable();t.renderPiece(l,c)},t.renderPiece=(c,l)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const d=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let g=0;g<d;++g){const p=e.renderable.getInputData(g);p&&!p.isDeleted()&&e.currentValidInputs.push({imageData:p,inputIndex:g})}const u=e.currentValidInputs.length;if(u<=0){jl("No input!");return}const h=e.currentValidInputs[0].imageData.getPointData().getScalars();e.multiTexturePerVolumeEnabled=u>1,e.numberOfComponents=e.multiTexturePerVolumeEnabled?u:h.getNumberOfComponents(),t.updateResliceGeometry(),t.renderPieceStart(c,l),t.renderPieceDraw(c,l),t.renderPieceFinish(c,l),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(c,l)=>{t.updateBufferObjects(c,l);const d=l.getProperties();e.currentValidInputs.forEach(g=>{let{inputIndex:p}=g;const w=d[p].getInterpolationType(),m=e.scalarTextures[p];w===nl.NEAREST?(m.setMinificationFilter(Dt.NEAREST),m.setMagnificationFilter(Dt.NEAREST)):(m.setMinificationFilter(Dt.LINEAR),m.setMagnificationFilter(Dt.LINEAR))});const u=e.currentValidInputs[0];d[u.inputIndex].getInterpolationType()===nl.NEAREST?(e.colorTexture.setMinificationFilter(Dt.NEAREST),e.colorTexture.setMagnificationFilter(Dt.NEAREST),e.pwfTexture.setMinificationFilter(Dt.NEAREST),e.pwfTexture.setMagnificationFilter(Dt.NEAREST)):(e.colorTexture.setMinificationFilter(Dt.LINEAR),e.colorTexture.setMagnificationFilter(Dt.LINEAR),e.pwfTexture.setMinificationFilter(Dt.LINEAR),e.pwfTexture.setMagnificationFilter(Dt.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(c,l)=>{const d=e.context,u=[...e.scalarTextures,e.colorTexture,e.pwfTexture];u.forEach(f=>f.activate()),t.updateShaders(e.tris,c,l),d.drawArrays(d.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),u.forEach(f=>f.deactivate())},t.renderPieceFinish=(c,l)=>{},t.updateBufferObjects=(c,l)=>{t.getNeedToRebuildBufferObjects(c,l)&&t.buildBufferObjects(c,l)},t.getNeedToRebuildBufferObjects=(c,l)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<l.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<l.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.currentValidInputs.some(d=>{let{imageData:u}=d;return e.VBOBuildTime.getMTime()<u.getMTime()})||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(d=>!!d?.getHandle())||!e.colorTexture?.getHandle()||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(c,l)=>{const d=l.getProperties();e.currentValidInputs.forEach((b,I)=>{let{imageData:O}=b;const M=O.getPointData().getScalars(),R=e._openGLRenderWindow.getGraphicsResourceForObject(M),A=fw(O,M),G=!R?.oglObject?.getHandle()||R?.hash!==A,k=d[I],L=k.getUpdatedExtents(),F=!!L.length;if(G&&!F){const j=$n.newInstance();j.setOpenGLRenderWindow(e._openGLRenderWindow);const Y=O.getDimensions();j.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),j.resetFormatAndType(),j.create3DFilterableFromDataArray({width:Y[0],height:Y[1],depth:Y[2],dataArray:M}),e._openGLRenderWindow.setGraphicsResourceForObject(M,j,A),e.scalarTextures[I]=j}else e.scalarTextures[I]=R.oglObject;if(F){k.setUpdatedExtents([]);const j=O.getDimensions();e.scalarTextures[I].create3DFilterableFromDataArray({width:j[0],height:j[1],depth:j[2],dataArray:M,updatedExtents:L})}o(e._openGLRenderWindow,e._scalarTexturesCore[I],M),e._scalarTexturesCore[I]=M});const u=e.currentValidInputs[0],f=d[u.inputIndex],h=f.getIndependentComponents(),g=h?e.numberOfComponents:1,p=h?2*g:1,v=[];for(let b=0;b<g;++b)v.push(f.getRGBTransferFunction(b));const w=ts(v,h,g),m=f.getRGBTransferFunction(),y=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!y?.oglObject?.getHandle()||y?.hash!==w){let b=e.renderable.getColorTextureWidth();b<=0&&(b=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const I=b*p*3,O=new Uint8ClampedArray(I),M=$n.newInstance();if(M.setOpenGLRenderWindow(e._openGLRenderWindow),m){const R=new Float32Array(b*3);for(let A=0;A<g;A++){const G=f.getRGBTransferFunction(A),k=G.getRange();if(G.getTable(k[0],k[1],b,R,1),h)for(let L=0;L<b*3;L++)O[A*b*6+L]=255*R[L],O[A*b*6+L+b*3]=255*R[L];else for(let L=0;L<b*3;L++)O[A*b*3+L]=255*R[L]}M.resetFormatAndType(),M.create2DFromRaw({width:b,height:p,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:O})}else{for(let R=0;R<b*3;++R){const A=255*R/((b-1)*3);for(let G=0;G<p;++G)O[G*b*3+R+0]=A,O[G*b*3+R+1]=A,O[G*b*3+R+2]=A}M.resetFormatAndType(),M.create2DFromRaw({width:b,height:1,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:O})}m&&e._openGLRenderWindow.setGraphicsResourceForObject(m,M,w),e.colorTexture=M}else e.colorTexture=y.oglObject;o(e._openGLRenderWindow,e._colorTextureCore,m),e._colorTextureCore=m;const x=[];for(let b=0;b<g;++b)x.push(f.getPiecewiseFunction(b));const S=ts(x,h,g),T=f.getPiecewiseFunction(),_=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!_?.oglObject?.getHandle()||_?.hash!==S){let b=e.renderable.getOpacityTextureWidth();b<=0&&(b=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const I=b*p,O=new Uint8ClampedArray(I),M=$n.newInstance();if(M.setOpenGLRenderWindow(e._openGLRenderWindow),T){const R=new Float32Array(I),A=new Float32Array(b);for(let G=0;G<g;++G){const k=f.getPiecewiseFunction(G);if(k===null)R.fill(1);else{const L=k.getRange();if(k.getTable(L[0],L[1],b,A,1),h)for(let F=0;F<b;F++)R[G*b*2+F]=A[F],R[G*b*2+F+b]=A[F];else for(let F=0;F<b;F++)R[F]=A[F]}}M.resetFormatAndType(),M.create2DFromRaw({width:b,height:p,numComps:1,dataType:Zt.FLOAT,data:R})}else O.fill(255),M.resetFormatAndType(),M.create2DFromRaw({width:b,height:p,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:O});T&&e._openGLRenderWindow.setGraphicsResourceForObject(T,M,S),e.pwfTexture=M}else e.pwfTexture=_.oglObject;o(e._openGLRenderWindow,e._pwfTextureCore,T),e._pwfTextureCore=T;const D=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==D){const b=Ot.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});b.setName("points");const I=Ot.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),O={points:b,cellOffset:0};if(e.renderable.getSlabThickness()>0){const M=e.resliceGeom.getPointData().getNormals();M?O.normals=M:jl("Slab mode requested without normals")}e.tris.getCABO().createVBO(I,"polys",vo.SURFACE,O)}e.VBOBuildString=D,e.VBOBuildTime.modified()},t.updateShaders=(c,l,d)=>{if(e.lastBoundBO=c,t.getNeedToRebuildShaders(c,l,d)){const u={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(u,l,d);const f=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(u.Vertex,u.Fragment,u.Geometry);f!==c.getProgram()&&(c.setProgram(f),c.getVAO().releaseGraphicsResources()),c.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(c.getProgram());c.getVAO().bind(),t.setMapperShaderParameters(c,l,d),t.setCameraShaderParameters(c,l,d),t.setPropertyShaderParameters(c,l,d)},t.setMapperShaderParameters=(c,l,d)=>{const u=c.getProgram(),f=e.currentValidInputs[0].imageData;if(c.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>c.getAttributeUpdateTime().getMTime()||c.getShaderSourceTime().getMTime()>c.getAttributeUpdateTime().getMTime())){e.scalarTextures.forEach((p,v)=>{u.setUniformi(`volumeTexture[${v}]`,p.getTextureUnit())}),u.isAttributeUsed("vertexWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"vertexWC",c.getCABO().getVertexOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||jl("Error setting vertexWC in shader VAO.")),u.isAttributeUsed("normalWC")&&(c.getVAO().addAttributeArray(u,c.getCABO(),"normalWC",c.getCABO().getNormalOffset(),c.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||jl("Error setting normalWC in shader VAO.")),u.isUniformUsed("slabThickness")&&u.setUniformf("slabThickness",e.renderable.getSlabThickness()),u.isUniformUsed("spacing")&&u.setUniform3fv("spacing",f.getSpacing()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabType")&&u.setUniformi("slabType",e.renderable.getSlabType()),u.isUniformUsed("slabTrapezoid")&&u.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const g=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null;if(u.isUniformUsed("WCTCMatrix")){const p=f.getDimensions();fr(e.tmpMat4,f.getIndexToWorld()),Xn(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),es(e.tmpMat4,e.tmpMat4,p),Cr(e.tmpMat4,e.tmpMat4),g&&Wt(e.tmpMat4,e.tmpMat4,g),u.setUniformMatrix("WCTCMatrix",e.tmpMat4)}u.isUniformUsed("vboScaling")&&u.setUniform3fv("vboScaling",c.getCABO().getCoordScale()??[1,1,1]),c.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&c.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),c.getProgram().isUniformUsed("coffset")){const h=t.getCoincidentParameters(l,d);c.getProgram().setUniformf("coffset",h.offset),c.getProgram().isUniformUsed("cfactor")&&c.getProgram().setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(c,l,d)=>{const u=e._openGLCamera.getKeyMatrices(l),f=e._openGLImageSlice.getKeyMatrices(),g=c.getCABO().getCoordShiftAndScaleEnabled()?c.getCABO().getInverseShiftAndScaleMatrix():null,p=c.getProgram();p.isUniformUsed("MCPCMatrix")&&(It(e.tmpMat4),p.setUniformMatrix("MCPCMatrix",J3([u.wcpc,f.mcwc,g],Ap,e.tmpMat4))),p.isUniformUsed("MCVCMatrix")&&(It(e.tmpMat4),p.setUniformMatrix("MCVCMatrix",J3([u.wcvc,f.mcwc,g],Ap,e.tmpMat4)))},t.setPropertyShaderParameters=(c,l,d)=>{const u=c.getProgram(),f=d.getProperty(e.currentValidInputs[0].inputIndex),h=f.getOpacity();u.setUniformf("opacity",h);const g=e.numberOfComponents,p=f.getIndependentComponents();if(p)for(let m=0;m<g;++m)u.setUniformf(`mix${m}`,f.getComponentWeight(m));for(let m=0;m<g;m++){const y=e.multiTexturePerVolumeEnabled,C=y?m:0,x=y?0:m,T=e.scalarTextures[C].getVolumeInfo(),_=T.scale[x],E=T.offset[x],D=p?m:0;let b=f.getColorWindow(),I=f.getColorLevel();const O=f.getRGBTransferFunction(D);if(O&&f.getUseLookupTableScalarRange()){const L=O.getRange();b=L[1]-L[0],I=.5*(L[1]+L[0])}const M=_/b,R=(E-I)/b+.5;u.setUniformf(`cshift${m}`,R),u.setUniformf(`cscale${m}`,M);let A=1,G=0;const k=f.getPiecewiseFunction(D);if(k){const L=k.getRange(),F=L[1]-L[0],j=.5*(L[0]+L[1]);A=_/F,G=(E-j)/F+.5}u.setUniformf(`pwfshift${m}`,G),u.setUniformf(`pwfscale${m}`,A)}const v=e.colorTexture.getTextureUnit();u.setUniformi("colorTexture1",v);const w=e.pwfTexture.getTextureUnit();u.setUniformi("pwfTexture1",w),u.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(c,l,d)=>{const u=d.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents(),f=e.renderable.getSlabThickness(),h=e.renderable.getSlabType(),g=e.renderable.getSlabTrapezoidIntegration();let p=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(p=!0),p||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastNumberOfComponents!==e.numberOfComponents||e.lastMultiTexturePerVolumeEnabled!==e.multiTexturePerVolumeEnabled||c.getProgram()?.getHandle()===0||e.lastIndependentComponents!==u||e.lastSlabThickness!==f||e.lastSlabType!==h||e.lastSlabTrapezoidIntegration!==g?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastNumberOfComponents=e.numberOfComponents,e.lastMultiTexturePerVolumeEnabled=e.multiTexturePerVolumeEnabled,e.lastIndependentComponents=u,e.lastSlabThickness=f,e.lastSlabType=h,e.lastSlabTrapezoidIntegration=g,!0):!1},t.getShaderTemplate=(c,l,d)=>{c.Vertex=IB,c.Fragment=MB,c.Geometry=""},t.replaceShaderValues=(c,l,d)=>{if(t.replaceShaderTCoord(c,l,d),t.replaceShaderPositionVC(c,l,d),e.haveSeenDepthRequest){let u=c.Fragment;u=Re.substitute(u,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,u=Re.substitute(u,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,c.Fragment=u}t.replaceShaderCoincidentOffset(c,l,d)},t.replaceShaderTCoord=(c,l,d)=>{let u=c.Vertex;const f=c.Geometry;let h=c.Fragment;const g=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],p=e.renderable.getSlabThickness();u=Re.substitute(u,"//VTK::TCoord::Dec",g).result;const v=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];u=Re.substitute(u,"//VTK::TCoord::Impl",v).result;const w=e.numberOfComponents,m=d.getProperty(e.currentValidInputs[0].inputIndex).getIndependentComponents();let y=["in vec3 fragTexCoord;",`uniform highp sampler3D volumeTexture[${e.scalarTextures.length}];`,"uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(y.push("vec4 rawSampleTexture(vec3 pos) {"),!e.multiTexturePerVolumeEnabled)y.push("return texture(volumeTexture[0], pos);","}");else{y.push("vec4 rawSample;");for(let x=0;x<e.scalarTextures.length;++x)y.push(`rawSample[${x}] = texture(volumeTexture[${x}], pos)[0];`);y.push("return rawSample;","}")}if(m){for(let x=1;x<w;x++)y=y.concat([`uniform float cshift${x};`,`uniform float cscale${x};`,`uniform float pwfshift${x};`,`uniform float pwfscale${x};`]);switch(w){case 1:y=y.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:y=y.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:y=y.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:y=y.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:jl("Unsupported number of independent coordinates.")}}p>0&&(y=y.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),y=y.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),h=Re.substitute(h,"//VTK::TCoord::Dec",y).result;let C=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = rawSampleTexture(fragTexCoord);"];if(p>0&&(C=C.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = rawSampleTexture(fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),m){const x=["r","g","b","a"];for(let S=0;S<w;++S)C=C.concat([`vec3 tcolor${S} = texture2D(colorTexture1, vec2(tvalue.${x[S]} * cscale${S} + cshift${S}, height${S})).rgb;`,`float compWeight${S} = mix${S} * texture2D(pwfTexture1, vec2(tvalue.${x[S]} * pwfscale${S} + pwfshift${S}, height${S})).r;`]);switch(w){case 1:C=C.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:C=C.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:C=C.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:jl("Unsupported number of independent coordinates.")}}else switch(w){case 1:C=C.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:C=C.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:C=C.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}h=Re.substitute(h,"//VTK::TCoord::Impl",C).result,c.Vertex=u,c.Fragment=h,c.Geometry=f},t.replaceShaderPositionVC=(c,l,d)=>{let u=c.Vertex;const f=c.Geometry;let h=c.Fragment;const g=e.renderable.getSlabThickness();let p=["attribute vec4 vertexWC;"];p=p.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),g>0&&(p=p.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),u=Re.substitute(u,"//VTK::PositionVC::Dec",p).result;let v=["gl_Position = MCPCMatrix * vertexWC;"];g>0&&(v=v.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),u=Re.substitute(u,"//VTK::PositionVC::Impl",v).result,u=Re.substitute(u,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let w=[];g>0&&(w=w.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),h=Re.substitute(h,"//VTK::PositionVC::Dec",w).result,c.Vertex=u,c.Geometry=f,c.Fragment=h};function s(c){pt.normalize(c);const l=[0,0,0];for(let d=0;d<3;++d){mV(l),l[d]=1;const u=pt.dot(c,l);if(u<-.999999||u>.999999)return[!0,d]}return[!1,2]}t.updateResliceGeometry=()=>{let c="";const l=e.currentValidInputs[0].imageData,d=l?.getBounds();let u=!0,f=2;const h=e.renderable.getSlicePolyData(),g=e.renderable.getSlicePlane();if(h)c=c.concat(`PolyData${h.getMTime()}`);else if(g){c=c.concat(`Plane${g.getMTime()}`);const p=Vo();l&&(c=c.concat(`Image${l.getMTime()}`),D4(p,...l.getDirection()),ec(p,p));const v=[...g.getNormal()];zf(v,v,p),[u,f]=s(v)}else{const p=Kn.newInstance();p.setNormal(0,0,1);let v=[0,1,0,1,0,1];l&&(v=d),p.setOrigin(v[0],v[2],.5*(v[5]+v[4])),e.renderable.setSlicePlane(p),c=c.concat(`Plane${g?.getMTime()}`),l&&(c=c.concat(`Image${l.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==c){if(h)e.resliceGeom||(e.resliceGeom=Ii.newInstance()),e.resliceGeom.getPoints().setData(h.getPoints().getData(),3),e.resliceGeom.getPolys().setData(h.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(h.getPointData().getNormals());else if(g)if(u){const p=new Float32Array(12),v=l.worldToIndex(g.getOrigin(),[0,0,0]),w=[(f+1)%3,(f+2)%3].sort(),m=l.getSpatialExtent();let y=0;for(let _=0;_<2;++_)for(let E=0;E<2;++E)p[y+f]=v[f],p[y+w[0]]=m[2*w[0]+E],p[y+w[1]]=m[2*w[1]+_],y+=3;e.transform.setMatrix(l.getIndexToWorld()),e.transform.transformPoints(p,p);const C=new Uint16Array(8);C[0]=3,C[1]=0,C[2]=1,C[3]=3,C[4]=3,C[5]=0,C[6]=3,C[7]=2;const x=g.getNormal();pt.normalize(x);const S=new Float32Array(12);for(let _=0;_<4;++_)S[3*_]=x[0],S[3*_+1]=x[1],S[3*_+2]=x[2];e.resliceGeom||(e.resliceGeom=Ii.newInstance()),e.resliceGeom.getPoints().setData(p,3),e.resliceGeom.getPolys().setData(C,1);const T=Ot.newInstance({numberOfComponents:3,values:S,name:"Normals"});e.resliceGeom.getPointData().setNormals(T)}else{e.outlineFilter.setInputData(l),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(g),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=Ii.newInstance());const p=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(p.getPoints().getData(),3),e.resliceGeom.getPolys().setData(p.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(p.getPointData().getNormals());const v=g.getNormal(),w=e.resliceGeom.getNumberOfPoints();pt.normalize(v);const m=new Float32Array(w*3);for(let C=0;C<w;++C)m[3*C]=v[0],m[3*C+1]=v[1],m[3*C+2]=v[2];const y=Ot.newInstance({numberOfComponents:3,values:m,name:"Normals"});e.resliceGeom.getPointData().setNormals(y)}else jl("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=c,e.resliceGeom?.modified()}},t.setScalarTextures=c=>{e.scalarTextures=[...c],e._externalOpenGLTexture=!0},t.delete=Th(()=>{e._openGLRenderWindow&&a(e._openGLRenderWindow)},t.delete)}const $B={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastNumberOfComponents:0,lastMultiTexturePerVolumeEnabled:!1,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,scalarTextures:[],_scalarTexturesCore:[],colorTexture:null,_colorTextureCore:null,pwfTexture:null,_pwfTextureCore:null,_externalOpenGLTexture:!1,resliceGeom:null,resliceGeomUpdateString:null,tris:null};function zB(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$B,r),Ir.extend(t,e,r),ul.implementReplaceShaderCoincidentOffset(t,e,r),ul.implementBuildShadersWithReplacements(t,e,r),e.tris=lc.newInstance(),e.scalarTextures=[],e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},Jn(e.VBOBuildTime),e.tmpMat4=It(new Float64Array(16)),e.outlineFilter=hB.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=Ii.newInstance(),e.cutter=OU.newInstance(),e.lineToSurfaceFilter=EU.newInstance(),e.transform=DB.newInstance(),ji(t,e,["scalarTextures"]),WB(t,e)}const jB=zn(zB,"vtkOpenGLImageResliceMapper");ti("vtkImageResliceMapper",jB);const HB={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var H1={SlicingMode:HB},gw=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,Ih=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:$u}=Oi,{SlicingMode:oo}=H1;function XB(t){const e=t.split(`
`),r=[];for(let n=0;n<e.length;++n){const i=e[n].trim();i.length>0&&r.push(i)}return r}function KB(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function r(n){e.openGLTexture.releaseGraphicsResources(n),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray,e._labelOutlineOpacity].forEach(i=>n.unregisterGraphicsResourceUser(i,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&r(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const o=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(o.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(o.getActiveCamera())}},t.translucentPass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.getCoincidentParameters=(n,i)=>e.renderable.getResolveCoincidentTopology()==Ca.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,n)},t.getShaderTemplate=(n,i,o)=>{n.Vertex=gw,n.Fragment=Ih,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Re.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Re.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Re.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,a=Re.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=o.getProperty().getIndependentComponents();let d=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(o.getProperty().getUseLabelOutline()&&(d=d.concat(["uniform sampler2D labelOutlineTexture1;","uniform sampler2D labelOutlineOpacityTexture1;"])),l){for(let f=1;f<c;f++)d=d.concat([`uniform float cshift${f};`,`uniform float cscale${f};`,`uniform float pwfshift${f};`,`uniform float pwfscale${f};`]);switch(c){case 1:d=d.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:d=d.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:$u("Unsupported number of independent coordinates.")}}if(s=Re.substitute(s,"//VTK::TCoord::Dec",d).result,o.getProperty().getUseLabelOutline()===!0&&(s=Re.substitute(s,"//VTK::LabelOutline::Dec",["uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,s=Re.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=Re.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),l){const f=["r","g","b","a"];let h=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let g=0;g<c;g++)h=h.concat([`vec3 tcolor${g} = mix${g} * texture2D(colorTexture1, vec2(tvalue.${f[g]} * cscale${g} + cshift${g}, height${g})).rgb;`,`float compWeight${g} = mix${g} * texture2D(pwfTexture1, vec2(tvalue.${f[g]} * pwfscale${g} + pwfshift${g}, height${g})).r;`]);switch(c){case 1:h=h.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:h=h.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:$u("Unsupported number of independent coordinates.")}s=Re.substitute(s,"//VTK::TCoord::Impl",h).result}else switch(c){case 1:s=Re.substitute(s,"//VTK::TCoord::Impl",[...XB(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  float outlineOpacity = texture2D(labelOutlineOpacityTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=Re.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=Re.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=Re.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=Re.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Re.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o)},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(dn("OpenGL has a limit of 6 clipping planes"),c=6),a=Re.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Re.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Re.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Re.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getNeedToRebuildShaders=(n,i,o)=>{const a=e.openGLTexture.getComponents(),s=o.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getProgram()?.getHandle()===0||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<o.getProperty().getMTime()||e.lastTextureComponents!==a||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(n,i,o)=>{if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,i,o)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,i,o);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,i,o),t.setCameraShaderParameters(n,i,o),t.setPropertyShaderParameters(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||$u("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),e.context.FALSE)||$u("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());const a=e.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",a);const s=e.openGLTexture.getComponents(),c=o.getProperty().getIndependentComponents();if(c)for(let f=0;f<s;f++)n.getProgram().setUniformf(`mix${f}`,o.getProperty().getComponentWeight(f));const l=e.openGLTexture.getShiftAndScale();for(let f=0;f<s;f++){let h=o.getProperty().getColorWindow(),g=o.getProperty().getColorLevel();const p=c?f:0,v=o.getProperty().getRGBTransferFunction(p);if(v&&o.getProperty().getUseLookupTableScalarRange()){const y=v.getRange();h=y[1]-y[0],g=.5*(y[1]+y[0])}const w=l.scale/h,m=(l.shift-g)/h+.5;n.getProgram().setUniformf(`cshift${f}`,m),n.getProgram().setUniformf(`cscale${f}`,w)}for(let f=0;f<s;f++){let h=1,g=0;const p=c?f:0,v=o.getProperty().getPiecewiseFunction(p);if(v){const w=v.getRange(),m=w[1]-w[0],y=.5*(w[0]+w[1]);h=l.scale/m,g=(l.shift-y)/m+.5}n.getProgram().setUniformf(`pwfshift${f}`,g),n.getProgram().setUniformf(`pwfscale${f}`,h)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const f=t.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",f.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",f.factor)}const d=e.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",d);const u=e.pwfTexture.getTextureUnit();if(n.getProgram().setUniformi("pwfTexture1",u),o.getProperty().getUseLabelOutline()){const f=e.labelOutlineThicknessTexture.getTextureUnit();n.getProgram().setUniformi("labelOutlineTexture1",f);const h=e.labelOutlineOpacityTexture.getTextureUnit();n.getProgram().setUniformi("labelOutlineOpacityTexture1",h)}if(e.renderable.getNumberOfClippingPlanes()){let f=e.renderable.getNumberOfClippingPlanes();f>6&&(dn("OpenGL has a limit of 6 clipping planes"),f=6);const g=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,p=g?fr(e.imagematinv,o.getMatrix()):o.getMatrix();g&&(Mn(p,p),Wt(p,p,g),Mn(p,p)),Mn(e.imagemat,e.currentInput.getIndexToWorld()),Wt(e.imagematinv,p,e.imagemat);const v=[];for(let w=0;w<f;w++){const m=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,w,m);for(let y=0;y<4;y++)v.push(m[y])}n.getProgram().setUniformi("numClipPlanes",f),n.getProgram().setUniform4fv("clipPlanes",v)}},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();Wt(e.imagemat,s.mcwc,l);const d=e.openGLCamera.getKeyMatrices(i);if(Wt(e.imagemat,d.wcpc,e.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){const f=n.getCABO().getInverseShiftAndScaleMatrix();Wt(e.imagemat,e.imagemat,f)}if(a.setUniformMatrix("MCPCMatrix",e.imagemat),o.getProperty().getUseLabelOutline()===!0){const f=c.getWorldToIndex(),h=c.getDimensions();let g=e.renderable.getClosestIJKAxis().ijkMode;g===oo.NONE&&(g=oo.K),a.setUniform3i("imageDimensions",h[0],h[1],h[2]),a.setUniformi("sliceAxis",g),a.setUniformMatrix("vWCtoIDX",f);const p=e.openGLCamera.getKeyMatrices(i);Cr(e.projectionToWorld,p.wcpc),e.openGLCamera.getKeyMatrices(i),a.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const v=t.getRenderTargetSize();a.setUniformf("vpWidth",v[0]),a.setUniformf("vpHeight",v[1]);const w=t.getRenderTargetOffset();a.setUniformf("vpOffsetX",w[0]/v[0]),a.setUniformf("vpOffsetY",w[1]/v[1])}},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram(),c=o.getProperty().getOpacity();a.setUniformf("opacity",c)},t.renderPieceStart=(n,i)=>{t.updateBufferObjects(n,i),e.lastBoundBO=null},t.renderPieceDraw=(n,i)=>{const o=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),i.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.activate(),e.labelOutlineOpacityTexture.activate()),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,i),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),i.getProperty().getUseLabelOutline()&&(e.labelOutlineThicknessTexture.deactivate(),e.labelOutlineOpacityTexture.deactivate()),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,i)=>{},t.renderPiece=(n,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){$u("No input!");return}t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i)},t.getNeedToRebuildBufferObjects=(n,i)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!e.openGLTexture?.getHandle()||!e.colorTexture?.getHandle()||i.getProperty().getUseLabelOutline()&&(!e.labelOutlineThicknessTexture?.getHandle()||!e.labelOutlineOpacityTexture?.getHandle())||!e.pwfTexture?.getHandle(),t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(!o)return;const a=o.getPointData()&&o.getPointData().getScalars();if(!a)return;const s=a.getDataType(),c=a.getNumberOfComponents(),l=i.getProperty(),d=l.getInterpolationType(),u=l.getIndependentComponents(),f=u?c:1,h=u?2*f:1,g=[];for(let M=0;M<f;++M)g.push(l.getRGBTransferFunction(M));const p=ts(g,u,f),v=l.getRGBTransferFunction(),w=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!w?.oglObject?.getHandle()||w?.hash!==p){e.colorTexture=$n.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let M=e.renderable.getColorTextureWidth();M<=0&&(M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const R=M*h*3,A=new Uint8ClampedArray(R);if(d===nl.NEAREST?(e.colorTexture.setMinificationFilter(Dt.NEAREST),e.colorTexture.setMagnificationFilter(Dt.NEAREST)):(e.colorTexture.setMinificationFilter(Dt.LINEAR),e.colorTexture.setMagnificationFilter(Dt.LINEAR)),v){const G=new Float32Array(M*3);for(let k=0;k<f;k++){const L=l.getRGBTransferFunction(k),F=L.getRange();if(L.getTable(F[0],F[1],M,G,1),u)for(let j=0;j<M*3;j++)A[k*M*6+j]=255*G[j],A[k*M*6+j+M*3]=255*G[j];else for(let j=0;j<M*3;j++)A[k*M*6+j]=255*G[j]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:M,height:h,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:A})}else{for(let G=0;G<M*3;++G)A[G]=255*G/((M-1)*3),A[G+1]=255*G/((M-1)*3),A[G+2]=255*G/((M-1)*3);e.colorTexture.create2DFromRaw({width:M,height:1,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:A})}v&&(e._openGLRenderWindow.setGraphicsResourceForObject(v,e.colorTexture,p),v!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(v,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=v)}else e.colorTexture=w.oglObject;const y=[];for(let M=0;M<f;++M)y.push(l.getPiecewiseFunction(M));const C=ts(y,u,f),x=l.getPiecewiseFunction(),S=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!S?.oglObject?.getHandle()||S?.hash!==C){let M=e.renderable.getOpacityTextureWidth();M<=0&&(M=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const R=M*h,A=new Uint8ClampedArray(R);if(e.pwfTexture=$n.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),d===nl.NEAREST?(e.pwfTexture.setMinificationFilter(Dt.NEAREST),e.pwfTexture.setMagnificationFilter(Dt.NEAREST)):(e.pwfTexture.setMinificationFilter(Dt.LINEAR),e.pwfTexture.setMagnificationFilter(Dt.LINEAR)),x){const G=new Float32Array(R),k=new Float32Array(M);for(let L=0;L<f;++L){const F=l.getPiecewiseFunction(L);if(F===null)G.fill(1);else{const j=F.getRange();if(F.getTable(j[0],j[1],M,k,1),u)for(let Y=0;Y<M;Y++)G[L*M*2+Y]=k[Y],G[L*M*2+Y+M]=k[Y];else for(let Y=0;Y<M;Y++)G[L*M*2+Y]=k[Y]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:M,height:h,numComps:1,dataType:Zt.FLOAT,data:G})}else A.fill(255),e.pwfTexture.create2DFromRaw({width:M,height:1,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:A});x&&(e._openGLRenderWindow.setGraphicsResourceForObject(x,e.pwfTexture,C),x!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(x,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=x)}else e.pwfTexture=S.oglObject;i.getProperty().getUseLabelOutline()&&(t.updatelabelOutlineThicknessTexture(i),t.updateLabelOutlineOpacityTexture(i));const{ijkMode:_}=e.renderable.getClosestIJKAxis();let E=e.renderable.getSlice();_!==e.renderable.getSlicingMode()&&(E=e.renderable.getSliceAtPosition(E));const D=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(E),b=o.getExtent();let I;_===oo.I&&(I=D-b[0]),_===oo.J&&(I=D-b[2]),(_===oo.K||_===oo.NONE)&&(I=D-b[4]);const O=`${E}A${o.getMTime()}A${a.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==O){const M=o.getDimensions();e.openGLTexture||(e.openGLTexture=$n.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),d===nl.NEAREST?(new Set([1,3,4]).has(c)&&s===Zt.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Dt.NEAREST),e.openGLTexture.setMagnificationFilter(Dt.NEAREST)):(c===4&&s===Zt.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(Dt.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(Dt.LINEAR),e.openGLTexture.setMagnificationFilter(Dt.LINEAR)),e.openGLTexture.setWrapS(Xf.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Xf.CLAMP_TO_EDGE);const R=M[0]*M[1]*c,A=new Float32Array(12),G=new Float32Array(8);for(let we=0;we<4;we++)G[we*2]=we%2?1:0,G[we*2+1]=we>1?1:0;const k=[oo.X,oo.Y,oo.Z].includes(e.renderable.getSlicingMode())?E:D,L=o.getSpatialExtent(),F=a.getData();let j=null;if(_===oo.I){j=new F.constructor(M[2]*M[1]*c);let we=0;for(let _e=0;_e<M[2];_e++)for(let Se=0;Se<M[1];Se++){let B=(I+Se*M[0]+_e*M[0]*M[1])*c;we=(_e*M[1]+Se)*c;const P=B+c;for(;B<P;)j[we++]=F[B++]}M[0]=M[1],M[1]=M[2],A[0]=k,A[1]=L[2],A[2]=L[4],A[3]=k,A[4]=L[3],A[5]=L[4],A[6]=k,A[7]=L[2],A[8]=L[5],A[9]=k,A[10]=L[3],A[11]=L[5]}else if(_===oo.J){j=new F.constructor(M[2]*M[0]*c);let we=0;for(let _e=0;_e<M[2];_e++)for(let Se=0;Se<M[0];Se++){let B=(Se+I*M[0]+_e*M[0]*M[1])*c;we=(_e*M[0]+Se)*c;const P=B+c;for(;B<P;)j[we++]=F[B++]}M[1]=M[2],A[0]=L[0],A[1]=k,A[2]=L[4],A[3]=L[1],A[4]=k,A[5]=L[4],A[6]=L[0],A[7]=k,A[8]=L[5],A[9]=L[1],A[10]=k,A[11]=L[5]}else _===oo.K||_===oo.NONE?(j=F.subarray(I*R,(I+1)*R),A[0]=L[0],A[1]=L[2],A[2]=k,A[3]=L[1],A[4]=L[2],A[5]=k,A[6]=L[0],A[7]=L[3],A[8]=k,A[9]=L[1],A[10]=L[3],A[11]=k):$u("Reformat slicing not yet supported.");const Y=a.getRanges();e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw({width:M[0],height:M[1],numComps:c,dataType:a.getDataType(),data:j,preferSizeOverAccuracy:!!e.renderable.getPreferSizeOverAccuracy?.(),ranges:Y}),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const ie=Ot.newInstance({numberOfComponents:3,values:A});ie.setName("points");const de=Ot.newInstance({numberOfComponents:2,values:G});de.setName("tcoords");const ae=new Uint16Array(8);ae[0]=3,ae[1]=0,ae[2]=1,ae[3]=3,ae[4]=3,ae[5]=0,ae[6]=3,ae[7]=2;const fe=Ot.newInstance({numberOfComponents:1,values:ae});e.tris.getCABO().createVBO(fe,"polys",vo.SURFACE,{points:ie,tcoords:de,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=O}},t.updateLabelOutlineOpacityTexture=n=>{let i=n.getProperty().getLabelOutlineOpacity();typeof i=="number"&&(e._cachedLabelOutlineOpacityObj?.[0]===i?i=e._cachedLabelOutlineOpacityObj:i=[i],e._cachedLabelOutlineOpacityObj=i);const o=e._openGLRenderWindow.getGraphicsResourceForObject(i),a=`${i.join("-")}`;if(!o?.oglObject?.getHandle()||o?.hash!==a){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const l=1,d=c*l,u=new Float32Array(d);for(let f=0;f<c;++f)u[f]=i[f]??i[0];e.labelOutlineOpacityTexture=$n.newInstance({resizable:!1}),e.labelOutlineOpacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineOpacityTexture.resetFormatAndType(),e.labelOutlineOpacityTexture.setMinificationFilter(Dt.NEAREST),e.labelOutlineOpacityTexture.setMagnificationFilter(Dt.NEAREST),e.labelOutlineOpacityTexture.create2DFromRaw({width:c,height:l,numComps:1,dataType:Zt.FLOAT,data:u}),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineOpacityTexture,a),i!==e._labelOutlineOpacity&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineOpacity,t)),e._labelOutlineOpacity=i)}else e.labelOutlineOpacityTexture=o.oglObject},t.updatelabelOutlineThicknessTexture=n=>{const i=n.getProperty().getLabelOutlineThicknessByReference(),o=e._openGLRenderWindow.getGraphicsResourceForObject(i),a=`${i.join("-")}`;if(!o?.oglObject?.getHandle()||o?.hash!==a){let c=e.renderable.getLabelOutlineTextureWidth();c<=0&&(c=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const l=1,d=c*l,u=new Uint8Array(d);for(let f=0;f<c;++f){const h=typeof i[f]<"u"?i[f]:i[0];u[f]=h}e.labelOutlineThicknessTexture=$n.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(Dt.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(Dt.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw({width:c,height:l,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:u}),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,a),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=o.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:n,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:n,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,i]},t.delete=Th(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const qB={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineOpacityTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function YB(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qB,r),Ir.extend(t,e,r),ul.implementReplaceShaderCoincidentOffset(t,e,r),ul.implementBuildShadersWithReplacements(t,e,r),e.tris=lc.newInstance(),e.imagemat=It(new Float64Array(16)),e.imagematinv=It(new Float64Array(16)),e.projectionToWorld=It(new Float64Array(16)),e.idxToView=It(new Float64Array(16)),e.idxNormalMatrix=Xo(new Float64Array(9)),e.modelToView=It(new Float64Array(16)),e.projectionToView=It(new Float64Array(16)),Ur(t,e,[]),e.VBOBuildTime={},Jn(e.VBOBuildTime),KB(t,e)}const Mb=zn(YB,"vtkOpenGLImageMapper");var JB={newInstance:Mb};ti("vtkAbstractImageMapper",Mb);const Hl={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:cg}=Z;function ZB(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function r(n){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>n.unregisterGraphicsResourceUser(i,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&r(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(n,i)=>e.renderable.getResolveCoincidentTopology()===Ca.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,n)},t.renderPiece=(n,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i))},t.renderPieceStart=(n,i)=>{t.updateBufferObjects(n,i)},t.renderPieceDraw=(n,i)=>{const o=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,i),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,i)=>{},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i),i.getProperty().getInterpolationType()===nl.NEAREST?(e.volumeTexture.setMinificationFilter(Dt.NEAREST),e.volumeTexture.setMagnificationFilter(Dt.NEAREST),e.colorTexture.setMinificationFilter(Dt.NEAREST),e.colorTexture.setMagnificationFilter(Dt.NEAREST),e.pwfTexture.setMinificationFilter(Dt.NEAREST),e.pwfTexture.setMagnificationFilter(Dt.NEAREST)):(e.volumeTexture.setMinificationFilter(Dt.LINEAR),e.volumeTexture.setMagnificationFilter(Dt.LINEAR),e.colorTexture.setMinificationFilter(Dt.LINEAR),e.colorTexture.setMagnificationFilter(Dt.LINEAR),e.pwfTexture.setMinificationFilter(Dt.LINEAR),e.pwfTexture.setMagnificationFilter(Dt.LINEAR))},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return o<t.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentImageDataInput.getMTime()||o<e.currentCenterlineInput.getMTime()||!e.volumeTexture?.getHandle()},t.buildBufferObjects=(n,i)=>{const o=e.currentImageDataInput,a=e.currentCenterlineInput,s=i.getProperty(),c=o?.getPointData()?.getScalars();if(!c)return;const l=e._openGLRenderWindow.getGraphicsResourceForObject(c),d=fw(o,c),u=!l?.oglObject?.getHandle()||l?.hash!==d,f=s.getUpdatedExtents(),h=!!f.length;if(u){e.volumeTexture=$n.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const O=o.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray({width:O[0],height:O[1],depth:O[2],dataArray:c,preferSizeOverAccuracy:e.renderable.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(c,e.volumeTexture,d),c!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=c}else e.volumeTexture=l.oglObject;if(h){s.setUpdatedExtents([]);const O=o.getDimensions();e.volumeTexture.create3DFilterableFromDataArray({width:O[0],height:O[1],depth:O[2],dataArray:c,updatedExtents:f})}const g=c.getNumberOfComponents(),p=i.getProperty(),v=p.getIndependentComponents(),w=v?g:1,m=v?2*w:1,y=[];for(let O=0;O<w;++O)y.push(p.getRGBTransferFunction(O));const C=ts(y,v,w),x=p.getRGBTransferFunction(),S=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!S?.oglObject?.getHandle()||S?.hash!==C){let O=e.renderable.getColorTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*m*3,R=new Uint8ClampedArray(M);if(e.colorTexture=$n.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),x){const A=new Float32Array(O*3);for(let G=0;G<w;G++){const k=p.getRGBTransferFunction(G),L=k.getRange();if(k.getTable(L[0],L[1],O,A,1),v)for(let F=0;F<O*3;F++)R[G*O*6+F]=255*A[F],R[G*O*6+F+O*3]=255*A[F];else for(let F=0;F<O*3;F++)R[G*O*6+F]=255*A[F]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:O,height:m,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:R})}else{for(let A=0;A<O*3;++A)R[A]=255*A/((O-1)*3),R[A+1]=255*A/((O-1)*3),R[A+2]=255*A/((O-1)*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw({width:O,height:1,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:R})}x&&(e._openGLRenderWindow.setGraphicsResourceForObject(x,e.colorTexture,C),x!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(x,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=x)}else e.colorTexture=S.oglObject;const _=[];for(let O=0;O<w;++O)_.push(p.getPiecewiseFunction(O));const E=ts(_,v,w),D=p.getPiecewiseFunction(),b=e._openGLRenderWindow.getGraphicsResourceForObject(D);if(!b?.oglObject?.getHandle()||b?.hash!==E){let O=e.renderable.getOpacityTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*m,R=new Uint8ClampedArray(M);if(e.pwfTexture=$n.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),D){const A=new Float32Array(M),G=new Float32Array(O);for(let k=0;k<w;++k){const L=p.getPiecewiseFunction(k);if(L===null)A.fill(1);else{const F=L.getRange();if(L.getTable(F[0],F[1],O,G,1),v)for(let j=0;j<O;j++)A[k*O*2+j]=G[j],A[k*O*2+j+O]=G[j];else for(let j=0;j<O;j++)A[k*O*2+j]=G[j]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:O,height:m,numComps:1,dataType:Zt.FLOAT,data:A})}else R.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw({width:O,height:1,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:R});D&&(e._openGLRenderWindow.setGraphicsResourceForObject(D,e.pwfTexture,E),D!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(D,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=D)}else e.pwfTexture=b.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()){const O=a.getNumberOfPoints(),M=O<=1?0:O-1,R=a.getDistancesToFirstPoint(),A=e.renderable.getHeight(),G=4*M,k=new Float32Array(3*G),L=e.renderable.getWidth();for(let P=0,$=0;P<M;++P)k.set([0,A-R[P],0],$),$+=3,k.set([L,A-R[P],0],$),$+=3,k.set([L,A-R[P+1],0],$),$+=3,k.set([0,A-R[P+1],0],$),$+=3;const F=Ot.newInstance({numberOfComponents:3,values:k});F.setName("points");const j=new Uint16Array(5*M);for(let P=0,$=0,W=0;P<M;++P)j.set([4,W+3,W+2,W+1,W],$),$+=5,W+=4;const Y=Ot.newInstance({numberOfComponents:1,values:j}),ie=a.getPoints(),de=new Float32Array(3*G),ae=new Array(3),fe=new Array(3);for(let P=0,$=0;P<M;++P)ie.getPoint(P,ae),ie.getPoint(P+1,fe),de.set(ae,$),$+=3,de.set(ae,$),$+=3,de.set(fe,$),$+=3,de.set(fe,$),$+=3;const we=Ot.newInstance({numberOfComponents:3,values:de,name:"centerlinePosition"}),_e=new Float32Array(G);for(let P=0,$=0;P<M;++P)_e.set([0,1,3,2],$),$+=4;const Se=Ot.newInstance({numberOfComponents:1,values:_e,name:"quadIndex"}),B=[we,Se];if(!e.renderable.getUseUniformOrientation()){const P=e.renderable.getOrientedCenterline().getOrientations()??[],$=new Float32Array(4*G),W=new Float32Array(4*G);for(let ee=0;ee<M;++ee){const ge=P[ee],De=P[ee+1];for(let Le=0;Le<4;++Le){const re=4*(Le+4*ee);$.set(ge,re),W.set(De,re)}}const K=Ot.newInstance({numberOfComponents:4,values:$,name:"centerlineTopOrientation"}),Q=Ot.newInstance({numberOfComponents:4,values:W,name:"centerlineBotOrientation"});B.push(K,Q)}e.tris.getCABO().createVBO(Y,"polys",vo.SURFACE,{points:F,customAttributes:B}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(n,i,o)=>{const a=e.volumeTexture.getComponents(),s=o.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),d=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return n.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==d||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==a||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=d,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(n,i,o)=>{t.getShaderTemplate(n,i,o),t.replaceShaderValues(n,i,o)},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];a=Re.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Re.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],d=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),d&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),a=Re.substitute(a,"//VTK::Color::Dec",l).result;const f=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(f.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),d&&f.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):f.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),a=Re.substitute(a,"//VTK::Color::Impl",f).result;const h=e.volumeTexture.getComponents(),g=o.getProperty().getIndependentComponents();let p=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];d&&p.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(p.push("in vec3 samplingDirVSOutput;"),d&&p.push("in vec3 projectionDirVSOutput;")):(p.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),d&&p.push("uniform vec3 bitangentDirection;"));const v=e.renderable.getCenterPoint();if(v&&p.push("uniform vec3 globalCenterPoint;"),g){for(let m=1;m<h;m++)p=p.concat([`uniform float cshift${m};`,`uniform float cscale${m};`,`uniform float pwfshift${m};`,`uniform float pwfscale${m};`]);switch(h){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:cg("Unsupported number of independent coordinates.")}}s=Re.substitute(s,"//VTK::TCoord::Dec",p).result;let w=[];if(u?(w.push("vec3 samplingDirection = samplingDirVSOutput;"),d&&w.push("vec3 projectionDirection = projectionDirVSOutput;")):(w.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),d&&w.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),v?w.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):w.push("float horizontalOffset = quadOffsetVSOutput.x;"),w.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),d){const m=e.renderable.getProjectionMode();switch(m){case Hl.MIN:w.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case Hl.MAX:case Hl.AVERAGE:default:w.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(w.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),m){case Hl.MAX:w.push("  tvalue = max(tvalue, sampledTextureValue);");break;case Hl.MIN:w.push("  tvalue = min(tvalue, sampledTextureValue);");break;case Hl.AVERAGE:default:w.push("  tvalue = tvalue + sampledTextureValue;");break}w.push("}"),m===Hl.AVERAGE&&w.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else w.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(g){const m=["r","g","b","a"];for(let y=0;y<h;++y)w=w.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${m[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${m[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(h){case 1:w=w.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:w=w.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:w=w.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:w=w.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:cg("Unsupported number of independent coordinates.")}}else switch(h){case 1:w=w.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:w=w.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:w=w.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:w=w.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=Re.substitute(s,"//VTK::TCoord::Impl",w).result,e.haveSeenDepthRequest&&(s=Re.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Re.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o)},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(Z.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),a=Re.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Re.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Re.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Re.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getShaderTemplate=(n,i,o)=>{n.Vertex=gw,n.Fragment=Ih,n.Geometry=""},t.setMapperShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=n.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(a.isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(a,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||cg("Error setting vertexMC in shader VAO.")),n.getCABO().getCustomData().forEach(h=>{h&&a.isAttributeUsed(h.name)&&!n.getVAO().addAttributeArray(a,s,h.name,h.offset,s.getStride(),e.context.FLOAT,h.components,e.context.FALSE)&&cg(`Error setting ${h.name} in shader VAO.`)}),n.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(a.setUniformi("volumeTexture",c),a.setUniformf("width",e.renderable.getWidth()),n.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),a.isUniformUsed("tangentDirection")){const h=e.renderable.getTangentDirection();n.getProgram().setUniform3fArray("tangentDirection",h)}if(a.isUniformUsed("bitangentDirection")){const h=e.renderable.getBitangentDirection();n.getProgram().setUniform3fArray("bitangentDirection",h)}if(a.isUniformUsed("centerlineOrientation")){const h=e.renderable.getUniformOrientation();n.getProgram().setUniform4fv("centerlineOrientation",h)}if(a.isUniformUsed("globalCenterPoint")){const h=e.renderable.getCenterPoint();a.setUniform3fArray("globalCenterPoint",h)}if(e.renderable.isProjectionEnabled()){const h=e.currentImageDataInput,g=h.getSpacing(),p=h.getDimensions(),v=e.renderable.getProjectionSlabThickness(),w=e.renderable.getProjectionSlabNumberOfSamples(),m=vV([],g,p);a.setUniform3fArray("volumeSizeMC",m),a.setUniformi("projectionSlabNumberOfSamples",w);const y=-.5*v;a.setUniformf("projectionConstantOffset",y);const C=v/(w-1);a.setUniformf("projectionStepLength",C)}const l=e.currentImageDataInput,d=l.getWorldToIndex(),u=k1(new Float32Array(16),Lp([],l.getDimensions())),f=Rp(u,u,d);if(a.setUniformMatrix("MCTCMatrix",f),e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(Z.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),h=6);const p=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,v=p?fr(e.imagematinv,o.getMatrix()):o.getMatrix();p&&(Mn(v,v),Wt(v,v,p),Mn(v,v)),Mn(e.imagemat,e.currentImageDataInput.getIndexToWorld()),Wt(e.imagematinv,v,e.imagemat);const w=[];for(let m=0;m<h;m++){const y=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,m,y);for(let C=0;C<4;C++)w.push(y[C])}a.setUniformi("numClipPlanes",h),a.setUniform4fv("clipPlanes",w)}if(a.isUniformUsed("coffset")){const h=t.getCoincidentParameters(i,o);a.setUniformf("coffset",h.offset),a.isUniformUsed("cfactor")&&a.setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(n,i,o)=>{const a=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(Wt(e.imagemat,s,a),n.getCABO().getCoordShiftAndScaleEnabled()){const c=n.getCABO().getInverseShiftAndScaleMatrix();Wt(e.imagemat,e.imagemat,c)}n.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=o.getProperty(),c=s.getOpacity();a.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),d=s.getIndependentComponents();if(d)for(let g=0;g<l;++g)a.setUniformf(`mix${g}`,s.getComponentWeight(g));const u=e.volumeTexture.getVolumeInfo();for(let g=0;g<l;g++){let p=s.getColorWindow(),v=s.getColorLevel();const w=d?g:0,m=s.getRGBTransferFunction(w);if(m&&s.getUseLookupTableScalarRange()){const x=m.getRange();p=x[1]-x[0],v=.5*(x[1]+x[0])}const y=u.scale[g]/p,C=(u.offset[g]-v)/p+.5;a.setUniformf(`cshift${g}`,C),a.setUniformf(`cscale${g}`,y)}const f=e.colorTexture.getTextureUnit();a.setUniformi("colorTexture1",f);for(let g=0;g<l;g++){let p=1,v=0;const w=d?g:0,m=s.getPiecewiseFunction(w);if(m){const y=m.getRange(),C=y[1]-y[0],x=.5*(y[0]+y[1]);p=u.scale[g]/C,v=(u.offset[g]-x)/C+.5}a.setUniformf(`pwfshift${g}`,v),a.setUniformf(`pwfscale${g}`,p)}const h=e.pwfTexture.getTextureUnit();a.setUniformi("pwfTexture1",h)},t.updateShaders=(n,i,o)=>{if(t.getNeedToRebuildShaders(n,i,o)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,i,o);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,i,o),t.setCameraShaderParameters(n,i,o),t.setPropertyShaderParameters(n,i,o)},t.delete=Z.chain(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const QB={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function eG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QB,r),Ir.extend(t,e,r),ul.implementReplaceShaderCoincidentOffset(t,e,r),Z.algo(t,e,2,0),e.tris=lc.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=It(new Float64Array(16)),e.imagematinv=It(new Float64Array(16)),e.VBOBuildTime={},Z.obj(e.VBOBuildTime,{mtime:0}),ZB(t,e)}const Ob=Z.newInstance(eG,"vtkOpenGLImageCPRMapper"),tG={};var nG={newInstance:Ob,...tG};ti("vtkImageCPRMapper",Ob);function rG(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{r&&e.context.depthMask(!0)},t.translucentPass=(r,n)=>{e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(fr(e.keyMatrices.mcwc,e.renderable.getMatrix()),Mn(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const iG={context:null,keyMatrixTime:null,keyMatrices:null};function oG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iG,r),Ir.extend(t,e,r),e.keyMatrixTime={},Jn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:It(new Float64Array(16))},Ur(t,e,["context"]),rG(t,e)}const Pb=zn(oG,"vtkOpenGLImageSlice");var aG={newInstance:Pb};ti("vtkImageSlice",Pb);function sG(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=r=>{!e.renderable||!e.renderable.getVisibility()||r&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementVolumeCount()}},t.traverseVolumePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0].traverse(r),t.apply(r,!1))},t.volumePass=r=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),fr(e.MCWCMatrix,e.renderable.getMatrix()),Mn(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?Xo(e.normalMatrix):(el(e.normalMatrix,e.MCWCMatrix),ec(e.normalMatrix,e.normalMatrix),V0(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const cG={};function lG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cG,r),Ir.extend(t,e,r),e.keyMatrixTime={},Jn(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Ur(t,e,["context"]),sG(t,e)}const Rb=zn(lG,"vtkOpenGLVolume");var uG={newInstance:Rb};ti("vtkVolume",Rb);function dG(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=r=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=r=>{},t.restorePreviousBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=r=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=r=>{},t.bind=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(r,n)=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){dn("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let o=i.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())o+=n;else{dn("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,i.framebufferTexture2D(i.FRAMEBUFFER,o,i.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=e.context;if(!n){dn("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())i+=r;else{dn("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,i,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=r=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else dn("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else dn("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){dn("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const r=e.context,n=$n.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(Dt.LINEAR),n.setMagnificationFilter(Dt.LINEAR),n.create2DFromRaw({width:e.glFramebuffer.width,height:e.glFramebuffer.height,numComps:4,dataType:Zt.UNSIGNED_CHAR,data:null}),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const fG={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function Ab(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fG,r),Jn(t,e),e.colorBuffers&&dn("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Q0(t,e,["colorBuffers"]),dG(t,e)}const hG=zn(Ab,"vtkFramebuffer");var Mh={newInstance:hG,extend:Ab},gG=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,pG=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

const float infinity = 3.402823466e38;

// the output of this shader
//VTK::Output::Dec

in vec3 vertexVCVSOutput;

// From Sources\\Rendering\\Core\\VolumeProperty\\Constants.js
#define COMPOSITE_BLEND 0
#define MAXIMUM_INTENSITY_BLEND 1
#define MINIMUM_INTENSITY_BLEND 2
#define AVERAGE_INTENSITY_BLEND 3
#define ADDITIVE_INTENSITY_BLEND 4
#define RADON_TRANSFORM_BLEND 5
#define LABELMAP_EDGE_PROJECTION_BLEND 6

#define vtkNumberOfLights //VTK::NumberOfLights
#define vtkMaxLaoKernelSize //VTK::MaxLaoKernelSize
#define vtkNumberOfComponents //VTK::NumberOfComponents
#define vtkBlendMode //VTK::BlendMode
#define vtkMaximumNumberOfSamples //VTK::MaximumNumberOfSamples

//VTK::EnabledColorFunctions

//VTK::EnabledLightings

//VTK::EnabledMultiTexturePerVolume

//VTK::EnabledGradientOpacity

//VTK::EnabledIndependentComponents

//VTK::vtkProportionalComponents

//VTK::vtkForceNearestComponents

uniform int twoSidedLighting;

#if vtkMaxLaoKernelSize > 0
  vec2 kernelSample[vtkMaxLaoKernelSize];
#endif

// Textures
#ifdef EnabledMultiTexturePerVolume
  #define vtkNumberOfVolumeTextures vtkNumberOfComponents
#else
  #define vtkNumberOfVolumeTextures 1
#endif
uniform highp sampler3D volumeTexture[vtkNumberOfVolumeTextures];
uniform sampler2D colorTexture;
uniform sampler2D opacityTexture;
uniform sampler2D jtexture;
uniform sampler2D labelOutlineThicknessTexture;

struct Volume {
  // ---- Volume geometry settings ----

  vec3 originVC;          // in VC
  vec3 spacing;           // in VC per IC
  vec3 inverseSpacing;    // 1/spacing
  ivec3 dimensions;       // in IC
  vec3 inverseDimensions; // 1/vec3(dimensions)
  mat3 vecISToVCMatrix;   // convert from IS to VC without translation
  mat3 vecVCToISMatrix;   // convert from VC to IS without translation
  mat4 PCWCMatrix;
  mat4 worldToIndex;
  float diagonalLength; // in VC, this is: length(size)

  // ---- Texture settings ----

  // Texture shift and scale
  vec4 colorTextureScale;
  vec4 colorTextureShift;
  vec4 opacityTextureScale;
  vec4 opacityTextureShift;

  // The heights defined below are the locations for the up to four components
  // of the transfer functions. The transfer functions have a height of (2 *
  // numberOfComponents) pixels so the values are computed to hit the middle of
  // the two rows for that component
  vec4 transferFunctionsSampleHeight;

  // ---- Mode specific settings ----

  // Independent component default preset settings per component
  vec4 independentComponentMix;

  // Additive / average blending mode settings
  vec4 ipScalarRangeMin;
  vec4 ipScalarRangeMax;

  // ---- Rendering settings ----

  // Lighting
  float ambient;
  float diffuse;
  float specular;
  float specularPower;
  int computeNormalFromOpacity;

  // Gradient opacity
  vec4 gradientOpacityScale;
  vec4 gradientOpacityShift;
  vec4 gradientOpacityMin;
  vec4 gradientOpacityMax;

  // Volume shadow
  float volumetricScatteringBlending;
  float globalIlluminationReach;
  float anisotropy;
  float anisotropySquared;

  // LAO
  int kernelSize;
  int kernelRadius;

  // Label outline
  float outlineOpacity;
};
uniform Volume volume;

struct Light {
  vec3 color;
  vec3 positionVC;
  vec3 directionVC; // normalized
  vec3 halfAngleVC;
  vec3 attenuation;
  float exponent;
  float coneAngle;
  int isPositional;
};
#if vtkNumberOfLights > 0
  uniform Light lights[vtkNumberOfLights];
#endif

uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;

// Bitmasks for label outline
const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
#define MAX_SEGMENTS 256
#define UINT_SIZE 32
// We add UINT_SIZE - 1, as we want the ceil of the division instead of the
// floor
#define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)
uint labelOutlineBitmasks[BITMASK_SIZE];

// Set the corresponding bit in the bitmask
void setLabelOutlineBit(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  labelOutlineBitmasks[arrayIndex] |= 1u << bitIndex;
}

// Check if a bit is set in the bitmask
bool isLabelOutlineBitSet(int segmentIndex) {
  int arrayIndex = segmentIndex / UINT_SIZE;
  int bitIndex = segmentIndex % UINT_SIZE;
  return ((labelOutlineBitmasks[arrayIndex] & (1u << bitIndex)) != 0u);
}

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

//VTK::ClipPlane::Dec

// A random number between 0 and 1 that only depends on the fragment
// It uses the jtexture, so this random seed repeats by blocks of 32 fragments
// in screen space
float fragmentSeed;

// sample texture is global
uniform float sampleDistance;
uniform float volumeShadowSampleDistance;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics
// rendering module is complete)
vec3 rayDirVC;

#define INV4PI 0.0796
#define EPSILON 0.001
#define PI 3.1415
#define PI2 9.8696

vec4 rawSampleTexture(vec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    rawSample[0] = texture(volumeTexture[0], pos)[0];
  #if vtkNumberOfComponents > 1
    rawSample[1] = texture(volumeTexture[1], pos)[0];
  #endif
  #if vtkNumberOfComponents > 2
    rawSample[2] = texture(volumeTexture[2], pos)[0];
  #endif
  #if vtkNumberOfComponents > 3
    rawSample[3] = texture(volumeTexture[3], pos)[0];
  #endif
    return rawSample;
  #else
    return texture(volumeTexture[0], pos);
  #endif
}

vec4 rawFetchTexture(ivec3 pos) {
  #ifdef EnabledMultiTexturePerVolume
    vec4 rawSample;
    #if vtkNumberOfComponents > 0
      rawSample[0] = texelFetch(volumeTexture[0], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 1
      rawSample[1] = texelFetch(volumeTexture[1], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 2
      rawSample[2] = texelFetch(volumeTexture[2], pos, 0)[0];
    #endif
    #if vtkNumberOfComponents > 3
      rawSample[3] = texelFetch(volumeTexture[3], pos, 0)[0];
    #endif
    return rawSample;
  #else
    return texelFetch(volumeTexture[0], pos, 0);
  #endif
}

vec4 getTextureValue(vec3 pos) {
  vec4 tmp = rawSampleTexture(pos);

  // Force nearest
  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volume.dimensions)) + 0.5) *
                      volume.inverseDimensions;
    vec4 nearestValue = rawSampleTexture(nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  // Set alpha when using dependent components
  #ifndef EnabledIndependentComponents
    #if vtkNumberOfComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumberOfComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumberOfComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

// \`height\` is usually \`volume.transferFunctionsSampleHeight[component]\`
// when using independent component and \`0.5\` otherwise. Don't move the if
// statement in these function, as the callers usually already knows if it is
// using independent component or not
float getOpacityFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.opacityTextureScale[component] +
                       volume.opacityTextureShift[component];
  return texture2D(opacityTexture, vec2(scaledScalar, height)).r;
}
vec3 getColorFromTexture(float scalar, int component, float height) {
  float scaledScalar = scalar * volume.colorTextureScale[component] +
                       volume.colorTextureShift[component];
  return texture2D(colorTexture, vec2(scaledScalar, height)).rgb;
}

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
vec3 posIStoVC(vec3 posIS) {
  return volume.vecISToVCMatrix * posIS + volume.originVC;
}

// convert vector position from vc to idx
vec3 posVCtoIS(vec3 posVC) {
  return volume.vecVCToISMatrix * (posVC - volume.originVC);
}

// Rotate vector to view coordinate
vec3 vecISToVC(vec3 dirIS) {
  return volume.vecISToVCMatrix * dirIS;
}

// Rotate vector to idx coordinate
vec3 vecVCToIS(vec3 dirVC) {
  return volume.vecVCToISMatrix * dirVC;
}

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(float normalMag, int component) {
  float goscale = volume.gradientOpacityScale[component];
  float goshift = volume.gradientOpacityShift[component];
  float gomin = volume.gradientOpacityMin[component];
  float gomax = volume.gradientOpacityMax[component];
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

#ifdef vtkClippingPlanesOn
  bool isPointClipped(vec3 posVC) {
    for (int i = 0; i < clip_numPlanes; ++i) {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0) {
        return true;
      }
    }
    return false;
  }
#endif

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward
// difference

// The output normal is in VC
vec4 computeDensityNormal(vec3 opacityUCoords[2], float opacityTextureHeight,
                          float gradientOpacity, int component) {
  // Pass the scalars through the opacity functions
  vec4 opacityG;
  opacityG.x += getOpacityFromTexture(opacityUCoords[0].x, component,
                                      opacityTextureHeight);
  opacityG.y += getOpacityFromTexture(opacityUCoords[0].y, component,
                                      opacityTextureHeight);
  opacityG.z += getOpacityFromTexture(opacityUCoords[0].z, component,
                                      opacityTextureHeight);
  opacityG.x -= getOpacityFromTexture(opacityUCoords[1].x, component,
                                      opacityTextureHeight);
  opacityG.y -= getOpacityFromTexture(opacityUCoords[1].y, component,
                                      opacityTextureHeight);
  opacityG.z -= getOpacityFromTexture(opacityUCoords[1].z, component,
                                      opacityTextureHeight);

  // Divide by spacing and convert to VC
  opacityG.xyz *= gradientOpacity * volume.inverseSpacing;
  opacityG.w = length(opacityG.xyz);
  if (opacityG.w == 0.0) {
    return vec4(0.0);
  }

  // Normalize
  opacityG.xyz = normalize(vecISToVC(opacityG.xyz));

  return opacityG;
}

// The output normal is in VC
vec4 computeNormalForDensity(vec3 posIS, out vec3 scalarInterp[2],
                             const int opacityComponent) {
  vec3 offsetedPosIS;
  for (int axis = 0; axis < 3; ++axis) {
    // Positive direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] += volume.inverseDimensions[axis];
    scalarInterp[0][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[0][axis] = 0.0;
      }
    #endif

    // Negative direction
    offsetedPosIS = posIS;
    offsetedPosIS[axis] -= volume.inverseDimensions[axis];
    scalarInterp[1][axis] =
        getTextureValue(offsetedPosIS)[opacityComponent];
    #ifdef vtkClippingPlanesOn
      if (isPointClipped(posIStoVC(offsetedPosIS))) {
        scalarInterp[1][axis] = 0.0;
      }
    #endif
  }

  vec4 result;
  result.xyz = (scalarInterp[0] - scalarInterp[1]) * volume.inverseSpacing;
  result.w = length(result.xyz);
  if (result.w == 0.0) {
    return vec4(0.0);
  }
  result.xyz = normalize(vecISToVC(result.xyz));
  return result;
}

vec4 fragCoordToPCPos(vec4 fragCoord) {
  return vec4((fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
              (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
              (fragCoord.z - 0.5) * 2.0, 1.0);
}

vec4 pcPosToWorldCoord(vec4 pcPos) {
  return volume.PCWCMatrix * pcPos;
}

vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  vec4 vertex = (worldCoord / worldCoord.w);

  vec3 index = (volume.worldToIndex * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) * volume.inverseDimensions;
}

vec3 fragCoordToWorld(vec4 fragCoord) {
  vec4 pcPos = fragCoordToPCPos(fragCoord);
  vec4 worldCoord = pcPosToWorldCoord(pcPos);
  return worldCoord.xyz;
}

//=======================================================================
// Compute the normals and gradient magnitudes for a position for independent
// components The output normals are in VC
mat4 computeMat4Normal(vec3 posIS, vec4 tValue) {
  vec3 xvec = vec3(volume.inverseDimensions.x, 0.0, 0.0);
  vec3 yvec = vec3(0.0, volume.inverseDimensions.y, 0.0);
  vec3 zvec = vec3(0.0, 0.0, volume.inverseDimensions.z);

  vec4 distX = getTextureValue(posIS + xvec) - getTextureValue(posIS - xvec);
  vec4 distY = getTextureValue(posIS + yvec) - getTextureValue(posIS - yvec);
  vec4 distZ = getTextureValue(posIS + zvec) - getTextureValue(posIS - zvec);

  // divide by spacing
  distX *= 0.5 * volume.inverseSpacing.x;
  distY *= 0.5 * volume.inverseSpacing.y;
  distZ *= 0.5 * volume.inverseSpacing.z;

  mat4 result;

  // optionally compute the 1st component
  #if vtkNumberOfComponents > 0 && !defined(vtkComponent0Proportional)
    {
      const int component = 0;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 2nd component
  #if vtkNumberOfComponents > 1 && !defined(vtkComponent1Proportional)
    {
      const int component = 1;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 3rd component
  #if vtkNumberOfComponents > 2 && !defined(vtkComponent2Proportional)
    {
      const int component = 2;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  // optionally compute the 4th component
  #if vtkNumberOfComponents > 3 && !defined(vtkComponent3Proportional)
    {
      const int component = 3;
      vec3 normal = vec3(distX[component], distY[component], distZ[component]);
      float normalLength = length(normal);
      if (normalLength > 0.0) {
        normal = normalize(vecISToVC(normal));
      }
      result[component] = vec4(normal, normalLength);
    }
  #endif

  return result;
}

//=======================================================================
// global shadow - secondary ray

// henyey greenstein phase function
float phaseFunction(float cos_angle) {
  // divide by 2.0 instead of 4pi to increase intensity
  float anisotropy = volume.anisotropy;
  if (abs(anisotropy) <= EPSILON) {
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    return 0.5;
  }
  float anisotropy2 = volume.anisotropySquared;
  return ((1.0 - anisotropy2) /
          pow(1.0 + anisotropy2 - 2.0 * anisotropy * cos_angle, 1.5)) /
         2.0;
}

// Compute the two intersection distances of the ray with the volume in VC
// The entry point is \`rayOriginVC + distanceMin * rayDirVC\` and the exit point
// is \`rayOriginVC + distanceMax * rayDirVC\` If distanceMin < distanceMax, the
// volume is not intersected The ray origin is inside the box when distanceMin <
// 0.0 < distanceMax
vec2 rayIntersectVolumeDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  // Compute origin and direction in IS
  vec3 rayOriginIS = posVCtoIS(rayOriginVC);
  vec3 rayDirIS = vecVCToIS(rayDirVC);
  // Don't check for infinity as the min/max combination afterward will always
  // find an intersection before infinity
  vec3 invDir = 1.0 / rayDirIS;

  // We have: bound = origin + t * dir
  // So: t = (1/dir) * (bound - origin)
  vec3 distancesTo0 = invDir * (vec3(0.0) - rayOriginIS);
  vec3 distancesTo1 = invDir * (vec3(1.0) - rayOriginIS);
  // Min and max distances to plane intersection per plane
  vec3 dMinPerAxis = min(distancesTo0, distancesTo1);
  vec3 dMaxPerAxis = max(distancesTo0, distancesTo1);
  // Overall first and last intersection
  float distanceMin = max(dMinPerAxis.x, max(dMinPerAxis.y, dMinPerAxis.z));
  float distanceMax = min(dMaxPerAxis.x, min(dMaxPerAxis.y, dMaxPerAxis.z));
  return vec2(distanceMin, distanceMax);
}

//=======================================================================
// local ambient occlusion
#if vtkMaxLaoKernelSize > 0

  // Return a random point on the unit sphere
  vec3 sampleDirectionUniform(int rayIndex) {
    // Each ray of each fragment should be different, two sources of randomness
    // are used. Only depends on ray index
    vec2 rayRandomness = kernelSample[rayIndex];
    // Only depends on fragment
    float fragmentRandomness = fragmentSeed;
    // Merge both source of randomness in a single uniform random variable using
    // the formula (x+y < 1 ? x+y : x+y-1). The simpler formula (x+y)/2 doesn't
    // result in a uniform distribution
    vec2 mergedRandom = rayRandomness + vec2(fragmentRandomness);
    mergedRandom -= vec2(greaterThanEqual(mergedRandom, vec2(1.0)));

    // Insipred by:
    // https://karthikkaranth.me/blog/generating-random-points-in-a-sphere/#better-choice-of-spherical-coordinates
    float u = mergedRandom[0];
    float v = mergedRandom[1];
    float theta = u * 2.0 * PI;
    float phi = acos(2.0 * v - 1.0);
    float sinTheta = sin(theta);
    float cosTheta = cos(theta);
    float sinPhi = sin(phi);
    float cosPhi = cos(phi);
    return vec3(sinPhi * cosTheta, sinPhi * sinTheta, cosPhi);
  }

  float computeLAO(vec3 posVC, vec4 normalVC, float originalOpacity) {
    // apply LAO only at selected locations, otherwise return full brightness
    if (normalVC.w <= 0.0 || originalOpacity <= 0.05) {
      return 1.0;
    }

    #ifdef EnabledGradientOpacity
      float gradientOpacityFactor = computeGradientOpacityFactor(normalVC.w, 0);
    #endif

    float visibilitySum = 0.0;
    float weightSum = 0.0;
    for (int i = 0; i < volume.kernelSize; i++) {
      // Only sample on an hemisphere around the normalVC.xyz axis, so
      // normalDotRay should be negative
      vec3 rayDirectionVC = sampleDirectionUniform(i);
      float normalDotRay = dot(normalVC.xyz, rayDirectionVC);
      if (normalDotRay > 0.0) {
        // Flip rayDirectionVC when it is in the wrong hemisphere
        rayDirectionVC = -rayDirectionVC;
        normalDotRay = -normalDotRay;
      }

      vec3 currPosIS = posVCtoIS(posVC);
      float visibility = 1.0;
      vec3 randomDirStepIS = vecVCToIS(rayDirectionVC * sampleDistance);
      for (int j = 0; j < volume.kernelRadius; j++) {
        currPosIS += randomDirStepIS;
        // If out of the volume, we are done
        if (any(lessThan(currPosIS, vec3(0.0))) ||
            any(greaterThan(currPosIS, vec3(1.0)))) {
          break;
        }
        float opacity = getOpacityFromTexture(getTextureValue(currPosIS).r, 0, 0.5);
        #ifdef EnabledGradientOpacity
          opacity *= gradientOpacityFactor;
        #endif
        visibility *= 1.0 - opacity;
        // If visibility is less than EPSILON, consider it to be 0
        if (visibility < EPSILON) {
          visibility = 0.0;
          break;
        }
      }
      float rayWeight = -normalDotRay;
      visibilitySum += visibility * rayWeight;
      weightSum += rayWeight;
    }

    // If no sample, LAO factor is one
    if (weightSum == 0.0) {
      return 1.0;
    }

    // LAO factor is the average visibility:
    // - visibility low => ambient low
    // - visibility high => ambient high
    float lao = visibilitySum / weightSum;

    // Reduce variance by clamping
    return clamp(lao, 0.3, 1.0);
  }
#endif

//=======================================================================
// Volume shadows
#if vtkNumberOfLights > 0

  // Non-memoised version
  float computeVolumeShadowWithoutCache(vec3 posVC, vec3 lightDirNormVC) {
    // modify sample distance with a random number between 1.5 and 3.0
    float rayStepLength =
        volumeShadowSampleDistance * mix(1.5, 3.0, fragmentSeed);

    // in case the first sample near surface has a very tiled light ray, we need
    // to offset start position
    vec3 initialPosVC = posVC + rayStepLength * lightDirNormVC;

    #ifdef vtkClippingPlanesOn
      float clippingPlanesMaxDistance = infinity;
      for (int i = 0; i < clip_numPlanes; ++i) {
        // Find distance of intersection with the plane
        // Points are clipped when:
        // dot(planeOrigin - (rayOrigin + distance * rayDirection), planeNormal) > 0
        // This is equivalent to:
        // dot(planeOrigin - rayOrigin, planeNormal) - distance * dot(rayDirection,
        // planeNormal) > 0.0
        // We precompute the dot products, so we clip ray points when:
        // dotOrigin - distance * dotDirection > 0.0
        float dotOrigin =
            dot(vClipPlaneOrigins[i] - initialPosVC, vClipPlaneNormals[i]);
        if (dotOrigin > 0.0) {
          // The initialPosVC is clipped by this plane
          return 1.0;
        }
        float dotDirection = dot(lightDirNormVC, vClipPlaneNormals[i]);
        if (dotDirection < 0.0) {
          // We only hit the plane if dotDirection is negative, as (distance is
          // positive)
          float intersectionDistance =
              dotOrigin / dotDirection; // negative divided by negative => positive
          clippingPlanesMaxDistance =
              min(clippingPlanesMaxDistance, intersectionDistance);
        }
      }
    #endif

    vec2 intersectionDistances =
        rayIntersectVolumeDistances(initialPosVC, lightDirNormVC);

    if (intersectionDistances[1] <= intersectionDistances[0] ||
        intersectionDistances[1] <= 0.0) {
      // Volume not hit or behind the ray
      return 1.0;
    }

    // When globalIlluminationReach is 0, no sample at all
    // When globalIlluminationReach is 1, the ray will go through the whole
    // volume
    float maxTravelDistance = mix(0.0, volume.diagonalLength,
                                  volume.globalIlluminationReach);
    float startDistance = max(intersectionDistances[0], 0.0);
    float endDistance = min(intersectionDistances[1], startDistance + maxTravelDistance);
    #ifdef vtkClippingPlanesOn
      endDistance = min(endDistance, clippingPlanesMaxDistance);
    #endif
    if (endDistance - startDistance < 0.0) {
      return 1.0;
    }

    // These two variables are used to compute posIS, without having to call
    // VCtoIS at each step
    vec3 initialPosIS = posVCtoIS(initialPosVC);
    // The light dir is scaled and rotated, but not translated, as it is a
    // vector (w = 0)
    vec3 scaledLightDirIS = vecVCToIS(lightDirNormVC);

    float shadow = 1.0;
    for (float currentDistance = startDistance; currentDistance <= endDistance;
          currentDistance += rayStepLength) {
      vec3 posIS = initialPosIS + currentDistance * scaledLightDirIS;
      vec4 scalar = getTextureValue(posIS);
      float opacity = getOpacityFromTexture(scalar.r, 0, 0.5);
      #if defined(EnabledGradientOpacity) && !defined(EnabledIndependentComponents)
        vec3 scalarInterp[2];
        vec4 normal = computeNormalForDensity(posIS, scalarInterp, 3);
        float opacityFactor = computeGradientOpacityFactor(normal.w, 0);
        opacity *= opacityFactor;
      #endif
      shadow *= 1.0 - opacity;

      // Early termination if shadow coeff is near 0.0
      if (shadow < EPSILON) {
        return 0.0;
      }
    }
    return shadow;
  }

  // Some cache for volume shadows
  struct {
    vec3 posVC;
    float shadow;
  } cachedShadows[vtkNumberOfLights];

  // Memoised version
  float computeVolumeShadow(vec3 posVC, vec3 lightDirNormVC, int lightIdx) {
    if (posVC == cachedShadows[lightIdx].posVC) {
      return cachedShadows[lightIdx].shadow;
    }
    float shadow = computeVolumeShadowWithoutCache(posVC, lightDirNormVC);
    cachedShadows[lightIdx].posVC = posVC;
    cachedShadows[lightIdx].shadow = shadow;
    return shadow;
  }

#endif

//=======================================================================
// surface light contribution
#if vtkNumberOfLights > 0
  vec3 applyLighting(vec3 tColor, vec4 normalVC) {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      float df = dot(normalVC.xyz, lights[lightIdx].directionVC);
      if (df > 0.0) {
        diffuse += df * lights[lightIdx].color;
        float sf = dot(normalVC.xyz, -lights[lightIdx].halfAngleVC);
        if (sf > 0.0) {
          specular += pow(sf, volume.specularPower) * lights[lightIdx].color;
        }
      }
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient) +
          specular * volume.specular;
  }

  vec3 applySurfaceShadowLighting(vec3 tColor, float alpha, vec3 posVC,
                                  vec4 normalVC) {
    // everything in VC
    vec3 diffuse = vec3(0.0);
    vec3 specular = vec3(0.0);
    for (int ligthIdx = 0; ligthIdx < vtkNumberOfLights; ligthIdx++) {
      vec3 vertLightDirection;
      float attenuation;
      if (lights[ligthIdx].isPositional == 1) {
        vertLightDirection = posVC - lights[ligthIdx].positionVC;
        float lightDistance = length(vertLightDirection);
        // Normalize with precomputed length
        vertLightDirection = vertLightDirection / lightDistance;
        // Base attenuation
        vec3 attenuationPolynom = lights[ligthIdx].attenuation;
        attenuation =
            1.0 / (attenuationPolynom[0] +
                  lightDistance * (attenuationPolynom[1] +
                                    lightDistance * attenuationPolynom[2]));
        // Cone attenuation
        float coneDot = dot(vertLightDirection, lights[ligthIdx].directionVC);
        // Per OpenGL standard cone angle is 90 or less for a spot light
        if (lights[ligthIdx].coneAngle <= 90.0) {
          if (coneDot >= cos(radians(lights[ligthIdx].coneAngle))) {
            // Inside the cone
            attenuation *= pow(coneDot, lights[ligthIdx].exponent);
          } else {
            // Outside the cone
            attenuation = 0.0;
          }
        }
      } else {
        vertLightDirection = lights[ligthIdx].directionVC;
        attenuation = 1.0;
      }

      float ndotL = dot(normalVC.xyz, vertLightDirection);
      if (ndotL < 0.0 && twoSidedLighting == 1) {
        ndotL = -ndotL;
      }
      if (ndotL > 0.0) {
        // Diffuse
        diffuse += ndotL * attenuation * lights[ligthIdx].color;
        // Specular
        float vdotR =
            dot(-rayDirVC, normalize(vertLightDirection - 2.0 * ndotL * normalVC.xyz));
        if (vdotR > 0.0) {
          specular += pow(vdotR, volume.specularPower) * attenuation *
                      lights[ligthIdx].color;
        }
      }
    }
    #if vtkMaxLaoKernelSize > 0
      float laoFactor = computeLAO(posVC, normalVC, alpha);
    #else
      const float laoFactor = 1.0;
    #endif
    return tColor * (diffuse * volume.diffuse +
                    volume.ambient * laoFactor) +
          specular * volume.specular;
  }

  vec3 applyVolumeShadowLighting(vec3 tColor, vec3 posVC) {
    // Here we have no effect of cones and no attenuation
    vec3 diffuse = vec3(0.0);
    for (int lightIdx = 0; lightIdx < vtkNumberOfLights; lightIdx++) {
      vec3 lightDirVC = lights[lightIdx].isPositional == 1
                            ? normalize(lights[lightIdx].positionVC - posVC)
                            : -lights[lightIdx].directionVC;
      float shadowCoeff = computeVolumeShadow(posVC, lightDirVC, lightIdx);
      float phaseAttenuation = phaseFunction(dot(rayDirVC, lightDirVC));
      diffuse += phaseAttenuation * shadowCoeff * lights[lightIdx].color;
    }
    return tColor * (diffuse * volume.diffuse + volume.ambient);
  }
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posVC,
                       vec4 surfaceNormalVC) {
  #if vtkNumberOfLights > 0
    // 0 <= volCoeff < EPSILON => only surface shadows
    // EPSILON <= volCoeff < 1 - EPSILON => mix of surface and volume shadows
    // 1 - EPSILON <= volCoeff => only volume shadows
    float volCoeff = volume.volumetricScatteringBlending *
                    (1.0 - alpha / 2.0) *
                    (1.0 - atan(surfaceNormalVC.w) * INV4PI);

    // Compute surface lighting if needed
    vec3 surfaceShadedColor = tColor;
    #ifdef EnableSurfaceLighting
      if (volCoeff < 1.0 - EPSILON) {
        surfaceShadedColor =
            applySurfaceShadowLighting(tColor, alpha, posVC, surfaceNormalVC);
      }
    #endif

    // Compute volume lighting if needed
    vec3 volumeShadedColor = tColor;
    #ifdef EnableVolumeLighting
      if (volCoeff >= EPSILON) {
        volumeShadedColor = applyVolumeShadowLighting(tColor, posVC);
      }
    #endif

    // Return the right mix
    if (volCoeff < EPSILON) {
      // Surface shadows
      return surfaceShadedColor;
    }
    if (volCoeff >= 1.0 - EPSILON) {
      // Volume shadows
      return volumeShadedColor;
    }
    // Mix of surface and volume shadows
    return mix(surfaceShadedColor, volumeShadedColor, volCoeff);
  #endif
  return tColor;
}

vec4 getColorForLabelOutline() {
  vec3 centerPosIS =
      fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = vec4(getColorFromTexture(centerValue.r, 0, 0.5),
                     getOpacityFromTexture(centerValue.r, 0, 0.5));

  int segmentIndex = int(centerValue.r * 255.0);

  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue =
      texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;
  int actualThickness = int(textureValue * 255.0);

  // If it is the background (segment index 0), we should quickly bail out.
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0) {
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't
  // invisible. Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord =
          vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j),
               gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = volume.outlineOpacity;
  }

  return tColor;
}

vec4 getColorForAdditivePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLights[2];
  normalLights[0] = normalMat[0];
  normalLights[1] = normalMat[1];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      for (int component = 0; component < 2; ++component) {
        vec3 scalarInterp[2];
        float height = volume.transferFunctionsSampleHeight[component];
        computeNormalForDensity(posIS, scalarInterp, component);
        normalLights[component] =
            computeDensityNormal(scalarInterp, height, 1.0, component);
      }
    }
  #endif

  // compute opacities
  float opacities[2];
  opacities[0] = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  opacities[1] = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);
  #ifdef EnabledGradientOpacity
    for (int component = 0; component < 2; ++component) {
      opacities[component] *=
          computeGradientOpacityFactor(normalMat[component].a, component);
    }
  #endif
  float opacitySum = opacities[0] + opacities[1];
  if (opacitySum <= 0.0) {
    return vec4(0.0);
  }

  // mix the colors and opacities
  vec3 colors[2];
  for (int component = 0; component < 2; ++component) {
    float sampleHeight = volume.transferFunctionsSampleHeight[component];
    vec3 color = getColorFromTexture(tValue[component], component, sampleHeight);
    color = applyAllLightning(color, opacities[component], posVC,
                              normalLights[component]);
    colors[component] = color;
  }
  vec3 mixedColor =
      (opacities[0] * colors[0] + opacities[1] * colors[1]) / opacitySum;
  return vec4(mixedColor, min(1.0, opacitySum));
}

vec4 getColorForColorizePreset(vec4 tValue, vec3 posVC, vec3 posIS) {
  // compute normals
  mat4 normalMat = computeMat4Normal(posIS, tValue);
  vec4 normalLight = normalMat[0];
  #if vtkNumberOfLights > 0
    if (volume.computeNormalFromOpacity == 1) {
      vec3 scalarInterp[2];
      float height = volume.transferFunctionsSampleHeight[0];
      computeNormalForDensity(posIS, scalarInterp, 0);
      normalLight = computeDensityNormal(scalarInterp, height, 1.0, 0);
    }
  #endif

  // compute opacities
  float opacity = getOpacityFromTexture(
      tValue[0], 0, volume.transferFunctionsSampleHeight[0]);
  #ifdef EnabledGradientOpacity
    opacity *= computeGradientOpacityFactor(normalMat[0].a, 0);
  #endif

  // colorizing component
  vec3 colorizingColor = getColorFromTexture(
      tValue[0], 1, volume.transferFunctionsSampleHeight[1]);
  float colorizingOpacity = getOpacityFromTexture(
      tValue[1], 1, volume.transferFunctionsSampleHeight[1]);

  // mix the colors and opacities
  vec3 color =
      getColorFromTexture(tValue[0], 0,
                          volume.transferFunctionsSampleHeight[0]) *
      mix(vec3(1.0), colorizingColor, colorizingOpacity);
  color = applyAllLightning(color, opacity, posVC, normalLight);
  return vec4(color, opacity);
}

vec4 getColorForDefaultIndependentPreset(vec4 tValue, vec3 posIS) {

  // compute the normal vectors as needed
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    mat4 normalMat = computeMat4Normal(posIS, tValue);
  #endif

  // process color and opacity for each component
  // initial value of alpha is determined by wether the first component is
  // proportional or not
  #if defined(vtkComponent0Proportional)
    // when it is proportional, it starts at 1 (neutral for multiplications)
    float alpha = 1.0;
  #else
    // when it is not proportional, it starts at 0 (neutral for additions)
    float alpha = 0.0;
  #endif

  vec3 mixedColor = vec3(0.0);
  #if vtkNumberOfComponents > 0
    {
      const int component = 0;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent0Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 1
    {
      const int component = 1;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent1Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 2
    {
      const int component = 2;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent2Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif
  #if vtkNumberOfComponents > 3
    {
      const int component = 3;
      vec3 color = getColorFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      float opacity = getOpacityFromTexture(
          tValue[component], component,
          volume.transferFunctionsSampleHeight[component]);
      #if !defined(vtkComponent3Proportional)
        float alphaContribution = volume.independentComponentMix[component] * opacity;
        #ifdef EnabledGradientOpacity
          alphaContribution *= computeGradientOpacityFactor(normalMat[component].a, component);
        #endif
        alpha += alphaContribution;
        #if vtkNumberOfLights > 0
          color = applyLighting(color, normalMat[component]);
        #endif
      #else
        color *= opacity;
        alpha *= mix(opacity, 1.0,
                    (1.0 - volume.independentComponentMix[component]));
      #endif
      mixedColor += volume.independentComponentMix[component] * color;
    }
  #endif

  return vec4(mixedColor, alpha);
}

vec4 getColorForDependentComponents(vec4 tValue, vec3 posVC, vec3 posIS) {
  #if defined(EnabledGradientOpacity) || vtkNumberOfLights > 0
    // use component 3 of the opacity texture as getTextureValue() sets alpha to
    // the opacity value
    vec3 scalarInterp[2];
    vec4 normal0 = computeNormalForDensity(posIS, scalarInterp, 3);
    float gradientOpacity = computeGradientOpacityFactor(normal0.a, 0);
  #endif

  // get color and opacity
  #if vtkNumberOfComponents == 1
    vec3 tColor = getColorFromTexture(tValue.r, 0, 0.5);
    float alpha = getOpacityFromTexture(tValue.r, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 2
    vec3 tColor = vec3(tValue.r * volume.colorTextureScale[0] +
                  volume.colorTextureShift[0]);
    float alpha = getOpacityFromTexture(tValue.a, 1, 0.5);
  #endif
  #if vtkNumberOfComponents == 3
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 0, 0.5);
  #endif
  #if vtkNumberOfComponents == 4
      vec3 tColor = tValue.rgb * volume.colorTextureScale.rgb +
              volume.colorTextureShift.rgb;
      float alpha = getOpacityFromTexture(tValue.a, 3, 0.5);
  #endif

  // Apply gradient opacity
  #if defined(EnabledGradientOpacity)
    alpha *= gradientOpacity;
  #endif

  #if vtkNumberOfComponents == 1
    if (alpha < EPSILON) {
      return vec4(0.0);
    }
  #endif

  // lighting
  #if vtkNumberOfLights > 0
    vec4 normalLight;
    if (volume.computeNormalFromOpacity == 1) {
      if (normal0[3] != 0.0) {
        normalLight =
            computeDensityNormal(scalarInterp, 0.5, gradientOpacity, 0);
        if (normalLight[3] == 0.0) {
          normalLight = normal0;
        }
      }
    } else {
      normalLight = normal0;
    }
    tColor = applyAllLightning(tColor, alpha, posVC, normalLight);
  #endif

  return vec4(tColor, alpha);
}

vec4 getColorForValue(vec4 tValue, vec3 posVC, vec3 posIS) {
  #ifdef EnableColorForValueFunctionId0
    return getColorForDependentComponents(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId1
    return getColorForAdditivePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId2
    return getColorForColorizePreset(tValue, posVC, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId3
    /*
      * Mix the color information from all the independent components to get a
      * single rgba output. See other shader functions like
      * \`getColorForAdditivePreset\` to learn how to create a custom color mix.
      * The custom color mix should return a value, but if it doesn't, it will
      * fallback on the default shading
      */
    //VTK::CustomColorMix
  #endif

  #if defined(EnableColorForValueFunctionId4) || defined(EnableColorForValueFunctionId3)
    return getColorForDefaultIndependentPreset(tValue, posIS);
  #endif

  #ifdef EnableColorForValueFunctionId5
    return getColorForLabelOutline();
  #endif
}

bool valueWithinScalarRange(vec4 val) {
  #if vtkNumberOfComponents > 1 && !defined(EnabledIndependentComponents)
    return false;
  #endif
  vec4 rangeMin = volume.ipScalarRangeMin;
  vec4 rangeMax = volume.ipScalarRangeMax;
  for (int component = 0; component < vtkNumberOfComponents; ++component) {
    if (val[component] < rangeMin[component] ||
        rangeMax[component] < val[component]) {
      return false;
    }
  }
  return true;
}

#if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
  bool checkOnEdgeForNeighbor(int xFragmentOffset, int yFragmentOffset,
                              int segmentIndex, vec3 stepIS) {
    vec3 volumeDimensions = vec3(volume.dimensions);
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(xFragmentOffset),
                                  gl_FragCoord.y + float(yFragmentOffset),
                                  gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    vec3 neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS += stepIS;
    }

    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < vtkMaximumNumberOfSamples / 2; ++k) {
      ivec3 texCoord = ivec3(neighborPosIS * volumeDimensions);
      vec4 texValue = rawFetchTexture(texCoord);
      if (int(texValue.g) == segmentIndex) {
        // not on edge
        return false;
      }
      neighborPosIS -= stepIS;
    }

    // onedge
    float sampleHeight = volume.transferFunctionsSampleHeight[1];
    vec3 tColorSegment =
        getColorFromTexture(float(segmentIndex), 1, sampleHeight);
    float pwfValueSegment =
        getOpacityFromTexture(float(segmentIndex), 1, sampleHeight);
    gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
    return true;
  }
#endif

vec4 getColorAtPos(vec3 posVC) {
  vec3 posIS = posVCtoIS(posVC);
  vec4 texValue = getTextureValue(posIS);
  return getColorForValue(texValue, posVC, posIS);
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 rayOriginVC, vec3 rayDirVC, float minDistance,
                float maxDistance) {
  // start slightly inside and apply some jitter
  vec3 stepVC = rayDirVC * sampleDistance;
  float raySteps = (maxDistance - minDistance) / sampleDistance;

  // Avoid 0.0 jitter
  float jitter = 0.01 + 0.99 * fragmentSeed;

  #if vtkBlendMode == COMPOSITE_BLEND
    // now map through opacity and color
    vec3 firstPosVC = rayOriginVC + minDistance * rayDirVC;
    vec4 firstColor = getColorAtPos(firstPosVC);

    // handle very thin volumes
    if (raySteps <= 1.0) {
      firstColor.a = 1.0 - pow(1.0 - firstColor.a, raySteps);
      gl_FragData[0] = firstColor;
      return;
    }

    // first color only counts for \`jitter\` factor of the step
    firstColor.a = 1.0 - pow(1.0 - firstColor.a, jitter);
    vec4 color = vec4(firstColor.rgb * firstColor.a, firstColor.a);
    vec3 posVC = firstPosVC + jitter * stepVC;
    float stepsTraveled = jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }
      vec4 tColor = getColorAtPos(posVC);

      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * (1.0 - color.a);
      stepsTraveled++;
      posVC += stepVC;
      if (color.a > 0.99) {
        color.a = 1.0;
        break;
      }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0) {
      vec3 endPosVC = rayOriginVC + maxDistance * rayDirVC;
      vec4 tColor = getColorAtPos(endPosVC);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb * tColor.a, tColor.a) * mix;
    }

    gl_FragData[0] = vec4(color.rgb / color.a, color.a);
  #endif

  #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND ||                                 \\
      vtkBlendMode == MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == MAXIMUM_INTENSITY_BLEND
      #define OP max
    #else
      #define OP min
    #endif

    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // Find a value to initialize the selected variables
    vec4 selectedValue;
    vec3 selectedPosVC;
    vec3 selectedPosIS;
    {
      vec3 posIS = posVCtoIS(posVC);
      selectedValue = getTextureValue(posIS);
      selectedPosVC = posVC;
      selectedPosIS = posIS;
    }

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // Get selected values
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    {
      vec3 posIS = posVCtoIS(posVC);
      vec4 previousSelectedValue = selectedValue;
      vec4 currentValue = getTextureValue(posIS);
      selectedValue = OP(selectedValue, currentValue);
      if (previousSelectedValue != selectedValue) {
        selectedPosVC = posVC;
        selectedPosIS = posIS;
      }
    }

    gl_FragData[0] = getColorForValue(selectedValue, selectedPosVC, selectedPosIS);
  #endif

  #if vtkBlendMode == ADDITIVE_INTENSITY_BLEND ||                                \\
      vtkBlendMode == AVERAGE_INTENSITY_BLEND
    vec4 sum = vec4(0.);
    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      float totalWeight = 0.0;
    #endif
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    vec3 posIS = posVCtoIS(posVC);
    vec4 value = getTextureValue(posIS);

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(value * raySteps, posVC, posIS);
      return;
    }

    if (valueWithinScalarRange(value)) {
      sum += value * jitter;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += jitter;
      #endif
    }
    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      posIS = posVCtoIS(posVC);
      value = getTextureValue(posIS);
      // One can control the scalar range by setting the AverageIPScalarRange to
      // disregard scalar values, not in the range of interest, from the average
      // computation. Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(value)) {
        sum += value;
        #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
          totalWeight++;
        #endif
      }

      stepsTraveled++;
      posVC += stepVC;
    }

    // Perform the last step along the ray using the
    // residual distance
    posVC = rayOriginVC + maxDistance * rayDirVC;
    posIS = posVCtoIS(posVC);
    value = getTextureValue(posIS);
    if (valueWithinScalarRange(value)) {
      sum += value;
      #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
        totalWeight += raySteps - stepsTraveled;
      #endif
    }

    #if vtkBlendMode == AVERAGE_INTENSITY_BLEND
      sum /= vec4(totalWeight, totalWeight, totalWeight, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posVC, posIS);
  #endif

  #if vtkBlendMode == RADON_TRANSFORM_BLEND
    float normalizedRayIntensity = 1.0;
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;

    // handle very thin volumes
    if (raySteps <= 1.0) {
      vec3 posIS = posVCtoIS(posVC);
      vec4 tValue = getTextureValue(posIS);
      normalizedRayIntensity -= raySteps * sampleDistance *
                                getOpacityFromTexture(tValue.r, 0, 0.5);
      gl_FragData[0] =
          vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
      return;
    }

    posVC += jitter * stepVC;
    stepsTraveled += jitter;

    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      vec3 posIS = posVCtoIS(posVC);
      vec4 value = getTextureValue(posIS);
      // Convert scalar value to normalizedRayIntensity coefficient and
      // accumulate normalizedRayIntensity
      normalizedRayIntensity -=
          sampleDistance * getOpacityFromTexture(value.r, 0, 0.5);

      posVC += stepVC;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] =
        vec4(getColorFromTexture(normalizedRayIntensity, 0, 0.5), 1.0);
  #endif

  #if vtkBlendMode == LABELMAP_EDGE_PROJECTION_BLEND
    // Only works with a single volume
    vec3 posVC = rayOriginVC + minDistance * rayDirVC;
    float stepsTraveled = 0.0;
    vec3 posIS = posVCtoIS(posVC);
    vec4 tValue = getTextureValue(posIS);
    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(tValue, posVC, posIS);
      return;
    }

    vec3 stepIS = vecVCToIS(stepVC);
    vec4 value = tValue;
    posIS += jitter * stepIS;
    stepsTraveled += jitter;
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the
      // segment index and later check if the bit is set via bit operations
      setLabelOutlineBit(segmentIndex);
    }

    // Sample along the ray until vtkMaximumNumberOfSamples,
    // ending slightly inside the total distance
    for (int i = 0; i < vtkMaximumNumberOfSamples; ++i) {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) {
        break;
      }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setLabelOutlineBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value = tValue;   // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = posVCtoIS(rayOriginVC + maxDistance * rayDirVC);
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue;   // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      vec3 maxPosVC = posIStoVC(maxPosIS);
      gl_FragData[0] = getColorForValue(value, maxPosVC, maxPosIS);
      return;
    }

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    vec3 volumeSpacings = volume.spacing;
    float minVoxelSpacing =
        min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base =
        vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z,
                          gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z,
                          gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not
      // been seen by the center segment
      if (!isLabelOutlineBitSet(s)) {
        continue;
      }

      // Use texture sampling for outlineThickness so that we can have
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue =
          texture2D(labelOutlineThicknessTexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out
      // faster if we find the edge
      bool onEdge = checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(actualThickness, -actualThickness, s,
                                          stepIS) ||
                    checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s,
                                          stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety
      // of the all the fragments inside. i.e., this happens when we zoom out,
      if (minVoxelSpacing >
          (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }

      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
        for (int j = -actualThickness; j <= actualThickness; j++) {
          if (i == 0 && j == 0)
            continue; // Skip the center
          if (abs(i) == actualThickness && abs(j) == actualThickness)
            continue; // Skip corners
          if (checkOnEdgeForNeighbor(i, j, s, stepIS)) {
            return;
          }
        }
      }
    }

    float sampleHeight = volume.transferFunctionsSampleHeight[0];
    vec3 tColor0 = getColorFromTexture(value.r, 0, sampleHeight);
    float pwfValue0 = getOpacityFromTexture(value.r, 0, sampleHeight);
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayOriginVC, vec3 rayDirVC) {
  vec2 dists = rayIntersectVolumeDistances(rayOriginVC, rayDirVC);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0, dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick / rayDirVC.z;
  dists.y = min(farDist, dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

float getFragmentSeed() {
  // This first noise has a diagonal pattern
  float firstNoise =
      fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);
  // This second noise is made out of blocks of CPU generated noise
  float secondNoise = texture2D(jtexture, gl_FragCoord.xy / 32.0).r;
  // Combine the two sources of noise in a way that the distribution is uniform
  // in [0,1[
  float noiseSum = firstNoise + secondNoise;
  return noiseSum < 1.0 ? noiseSum : noiseSum - 1.0;
}

void main() {
  fragmentSeed = getFragmentSeed();

  if (cameraParallel == 1) {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 rayOriginVC = vertexVCVSOutput;
  vec2 rayStartEndDistancesVC = computeRayDistances(rayOriginVC, rayDirVC);
  if (rayStartEndDistancesVC[1] <= rayStartEndDistancesVC[0] ||
      rayStartEndDistancesVC[1] <= 0.0) {
    // Volume not hit or behind the ray
    discard;
  }

  // Perform the blending operation along the ray
  applyBlend(rayOriginVC, rayDirVC, rayStartEndDistancesVC[0], rayStartEndDistancesVC[1]);
}
`;const{vtkWarningMacro:mG,vtkErrorMacro:Z3}=Oi,vG={idxToView:It(new Float64Array(16)),vecISToVCMatrix:Xo(new Float64Array(9)),modelToView:It(new Float64Array(16)),projectionToView:It(new Float64Array(16)),projectionToWorld:It(new Float64Array(16))};function yG(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function r(l,d){const u=l.getIndependentComponents(),f=l.getColorMixPreset();return u&&d>=2||!!f}function n(l){return l.getUseLabelOutline()||e.renderable.getBlendMode()===uf.LABELMAP_EDGE_PROJECTION_BLEND}const i=new Map;function o(l,d){if(!d)return;const f=(i.get(d)??0)-1;f<=0?(l.unregisterGraphicsResourceUser(d,t),i.delete(d)):i.set(d,f)}function a(l,d){if(!d)return;const u=i.get(d)??0,f=u+1;i.set(d,f),u<=0&&l.registerGraphicsResourceUser(d,t)}function s(l,d,u){d!==u&&(o(l,d),a(l,u))}function c(l){[...i.keys()].forEach(d=>l.unregisterGraphicsResourceUser(d,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(l,d)=>{if(l){const u=d.getZBufferTexture();u!==e.zBufferTexture&&(e.zBufferTexture=u)}},t.opaqueZBufferPass=(l,d)=>t.zBufferPass(l,d),t.volumePass=(l,d)=>{if(l){const u=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),u&&!u.isDeleted()&&u!==e._openGLRenderWindow&&c(u),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const f=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const h=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(h.getActiveCamera()),t.renderPiece(h,f)}},t.getShaderTemplate=(l,d,u)=>{l.Vertex=gG,l.Fragment=pG,l.Geometry=""},t.replaceShaderValues=(l,d,u)=>{let f=l.Fragment;f=Re.substitute(f,"//VTK::EnabledColorFunctions",`#define EnableColorForValueFunctionId${e.previousState.colorForValueFunctionId}`).result;const h=[];e.previousState.surfaceLightingEnabled&&h.push("Surface"),e.previousState.volumeLightingEnabled&&h.push("Volume"),f=Re.substitute(f,"//VTK::EnabledLightings",h.map(p=>`#define Enable${p}Lighting`)).result,e.previousState.multiTexturePerVolumeEnabled&&(f=Re.substitute(f,"//VTK::EnabledMultiTexturePerVolume","#define EnabledMultiTexturePerVolume").result),e.previousState.useIndependentComponents&&(f=Re.substitute(f,"//VTK::EnabledIndependentComponents","#define EnabledIndependentComponents").result),e.previousState.gradientOpacityEnabled&&(f=Re.substitute(f,"//VTK::EnabledGradientOpacity","#define EnabledGradientOpacity").result),f=Re.substitute(f,"//VTK::vtkProportionalComponents",e.previousState.proportionalComponents.map(p=>`#define vtkComponent${p}Proportional`).join(`
`)).result,f=Re.substitute(f,"//VTK::vtkForceNearestComponents",e.previousState.forceNearestComponents.map(p=>`#define vtkComponent${p}ForceNearest`).join(`
`)).result,e.previousState.hasZBufferTexture&&(f=Re.substitute(f,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,f=Re.substitute(f,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDirVC.z;","dists.y = min(zdepth,dists.y);"]).result),f=Re.substitute(f,"//VTK::BlendMode",`${e.previousState.blendMode}`).result,f=Re.substitute(f,"//VTK::NumberOfLights",`${e.previousState.numberOfLights}`).result,f=Re.substitute(f,"//VTK::MaxLaoKernelSize",`${e.previousState.maxLaoKernelSize}`).result,f=Re.substitute(f,"//VTK::NumberOfComponents",`${e.previousState.numberOfComponents}`).result,f=Re.substitute(f,"//VTK::MaximumNumberOfSamples",`${e.previousState.maximumNumberOfSamples}`).result,l.Fragment=f;const g=e.previousState.numberOfClippingPlanes;g>0&&(f=Re.substitute(f,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,f=Re.substitute(f,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${g}; i++) {`,"  float rayDirRatio = dot(rayDirVC, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result),l.Fragment=f},t.getNeedToRebuildShaders=(l,d,u)=>{const f=!!e.zBufferTexture,h=e.currentValidInputs.length,g=e.numberOfLights,p=e.numberOfComponents,v=e.useIndependentComponents,w=u.getProperties(),m=e.currentValidInputs[0],y=w[m.inputIndex],C=h>1,x=m.imageData.getBounds(),S=bn.getDiagonalLength(x),T=Math.ceil(S/t.getCurrentSampleDistance(d));T>e.renderable.getMaximumSamplesPerRay()&&mG(`The number of steps required ${T} is larger than the specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
Please either change the volumeMapper sampleDistance or its maximum number of samples.`);const _=v?p:1;let E=!1;for(let ie=0;ie<_;++ie)if(y.getUseGradientOpacity(ie)){E=!0;break}let D=0;const b=y.getLAOKernelSize();b>D&&y.getLocalAmbientOcclusion()&&y.getAmbient()>0&&(D=b);const I=e.renderable.getClippingPlanes().length,O=e.renderable.getViewSpecificProperties().OpenGL?.ShaderReplacements,M=e.currentRenderPass?.getShaderReplacement(),R=e.renderable.getBlendMode(),A=(()=>{if(R!==uf.LABELMAP_EDGE_PROJECTION_BLEND&&n(y))return 5;if(v)switch(y.getColorMixPreset()){case rp.ADDITIVE:return 1;case rp.COLORIZE:return 2;case rp.CUSTOM:return 3;default:return 4}return 0})(),G=y.getVolumetricScatteringBlending()<1,k=y.getVolumetricScatteringBlending()>0;let L=!1;for(let ie=0;ie<p;++ie)if(y.getForceNearestInterpolation(ie)){L=!0;break}const F=[],j=[];for(let ie=0;ie<p;ie++)y.getOpacityMode(ie)===I8.PROPORTIONAL&&F.push(ie),y.getForceNearestInterpolation(ie)&&j.push(ie);const Y={numberOfComponents:p,useIndependentComponents:v,proportionalComponents:F,forceNearestComponents:j,blendMode:R,numberOfLights:g,numberOfValidInputs:h,maximumNumberOfSamples:T,hasZBufferTexture:f,maxLaoKernelSize:D,numberOfClippingPlanes:I,mapperShaderReplacements:O,renderPassShaderReplacements:M,colorForValueFunctionId:A,surfaceLightingEnabled:G,volumeLightingEnabled:k,forceNearestInterpolationEnabled:L,multiTexturePerVolumeEnabled:C,gradientOpacityEnabled:E};return l.getProgram()?.getHandle()===0||!e.previousState||!m5(e.previousState,Y)?(e.previousState=Y,!0):!1},t.updateShaders=(l,d,u)=>{if(t.getNeedToRebuildShaders(l,d,u)){const f={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(f,d,u);const h=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(f.Vertex,f.Fragment,f.Geometry);h!==l.getProgram()&&(l.setProgram(h),l.getVAO().releaseGraphicsResources()),l.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(l.getProgram());l.getVAO().bind(),t.setMapperShaderParameters(l,d,u),t.setCameraShaderParameters(l,d,u),t.setPropertyShaderParameters(l,d,u),t.getClippingPlaneShaderParameters(l,d,u)},t.setMapperShaderParameters=(l,d,u)=>{const f=l.getProgram();l.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>l.getAttributeUpdateTime().getMTime()||l.getShaderSourceTime().getMTime()>l.getAttributeUpdateTime().getMTime())&&(f.isAttributeUsed("vertexDC")&&(l.getVAO().addAttributeArray(f,l.getCABO(),"vertexDC",l.getCABO().getVertexOffset(),l.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Z3("Error setting vertexDC in shader VAO.")),l.getAttributeUpdateTime().modified());const h=t.getCurrentSampleDistance(d);f.setUniformf("sampleDistance",h);const g=h*e.renderable.getVolumeShadowSamplingDistFactor();f.setUniformf("volumeShadowSampleDistance",g),e.scalarTextures.forEach((T,_)=>{f.setUniformi(`volumeTexture[${_}]`,T.getTextureUnit())});const p=u.getProperties(),v=e.currentValidInputs[0],m=p[v.inputIndex].getIpScalarRange(),y=new Float32Array(4),C=new Float32Array(4),x=(T,_,E)=>{_?.dataComputedScale?.length&&(y[T]=m[0]*_.dataComputedScale[E]+_.dataComputedOffset[E],C[T]=m[1]*_.dataComputedScale[E]+_.dataComputedOffset[E],y[T]=(y[T]-_.offset[E])/_.scale[E],C[T]=(C[T]-_.offset[E])/_.scale[E])};if(e.previousState.multiTexturePerVolumeEnabled)e.scalarTextures.forEach((T,_)=>{const E=T.getVolumeInfo();x(_,E,0)});else{const T=e.scalarTextures[0].getVolumeInfo();for(let _=0;_<4;++_)x(_,T,_)}const S="volume";if(f.setUniform4f(`${S}.ipScalarRangeMin`,y[0],y[1],y[2],y[3]),f.setUniform4f(`${S}.ipScalarRangeMax`,C[0],C[1],C[2],C[3]),e.zBufferTexture!==null){f.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const T=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();f.setUniformf("vpZWidth",T[0]),f.setUniformf("vpZHeight",T[1])}},t.setCameraShaderParameters=(l,d,u)=>{const{idxToView:f,vecISToVCMatrix:h,modelToView:g,projectionToView:p,projectionToWorld:v}=vG,w=e.openGLCamera.getKeyMatrices(d),m=e.openGLVolume.getKeyMatrices();Wt(g,w.wcvc,m.mcwc);const y=l.getProgram(),C=e.openGLCamera.getRenderable(),x=C.getParallelProjection(),S=C.getClippingRange();y.setUniformf("camThick",S[1]-S[0]),y.setUniformf("camNear",S[0]),y.setUniformf("camFar",S[1]),y.setUniformi("cameraParallel",x);const T=e.currentValidInputs[0],_=T.imageData.getBounds(),D=bn.getCorners(_,[]).map(B=>{if(Vt(B,B,g),!x){const P=-S[0]/(B[2]*pr(B));xr(B,B,P)}return Vt(B,B,w.vcpc),B}),b=bn.addPoints([...bn.INIT_BOUNDS],D);y.setUniformf("dcxmin",b[0]),y.setUniformf("dcxmax",b[1]),y.setUniformf("dcymin",b[2]),y.setUniformf("dcymax",b[3]);const I=t.getRenderTargetSize();y.setUniformf("vpWidth",I[0]),y.setUniformf("vpHeight",I[1]);const O=t.getRenderTargetOffset();y.setUniformf("vpOffsetX",O[0]/I[0]),y.setUniformf("vpOffsetY",O[1]/I[1]),Cr(p,w.vcpc),y.setUniformMatrix("PCVCMatrix",p),y.setUniformi("twoSidedLighting",d.getTwoSidedLighting());const M=new Array(2*e.previousState.maxLaoKernelSize);for(let B=0;B<e.previousState.maxLaoKernelSize;B++)M[B*2]=Math.random(),M[B*2+1]=Math.random();if(y.setUniform2fv("kernelSample",M),e.numberOfLights>0){let B=0;d.getLights().forEach(P=>{if(P.getSwitch()>0){const $=`lights[${B}]`,W=P.getColor(),K=P.getIntensity(),Q=xr([],W,K);y.setUniform3fv(`${$}.color`,Q);const ee=P.getTransformedPosition();Vt(ee,ee,g),y.setUniform3fv(`${$}.positionVC`,ee);const ge=[...P.getDirection()];zf(ge,ge,w.normalMatrix),Lt(ge,ge),y.setUniform3fv(`${$}.directionVC`,ge);const De=[-.5*ge[0],-.5*ge[1],-.5*(ge[2]-1)];y.setUniform3fv(`${$}.halfAngleVC`,De);const Le=P.getAttenuationValues();y.setUniform3fv(`${$}.attenuation`,Le);const Ge=P.getExponent();y.setUniformf(`${$}.exponent`,Ge);const re=P.getConeAngle();y.setUniformf(`${$}.coneAngle`,re);const se=P.getPositional();y.setUniformi(`${$}.isPositional`,se),B++}})}const R="volume",G=u.getProperties()[T.inputIndex],k=T.imageData,L=k.getSpatialExtent(),F=k.getSpacing(),j=k.getDimensions(),Y=k.getIndexToWorld(),ie=k.getWorldToIndex(),de=k.getDirectionByReference();Wt(f,g,Y),y.setUniform3fv(`${R}.spacing`,F);const ae=Lp([],F);y.setUniform3fv(`${R}.inverseSpacing`,ae),y.setUniform3iv(`${R}.dimensions`,j),y.setUniform3fv(`${R}.inverseDimensions`,Lp([],j)),y.setUniformMatrix(`${R}.worldToIndex`,ie),h.fill(0);const fe=V4(new Float64Array(3),j,F);h[0]=fe[0],h[4]=fe[1],h[8]=fe[2],vu(h,de,h),vu(h,m.normalMatrix,h),vu(h,w.normalMatrix,h),y.setUniformMatrix3x3(`${R}.vecISToVCMatrix`,h),y.setUniformMatrix3x3(`${R}.vecVCToISMatrix`,ec(new Float32Array(9),h));const we=mt(L[0],L[2],L[4]),_e=Vt(new Float64Array(3),we,f);y.setUniform3fv(`${R}.originVC`,_e);const Se=pr(fe);if(y.setUniformf(`${R}.diagonalLength`,Se),n(G)){const B=C.getDistance();C.setClippingRange(B,B+.1);const P=e.openGLCamera.getKeyMatrices(d);Cr(v,P.wcpc),C.setClippingRange(S[0],S[1]),e.openGLCamera.getKeyMatrices(d),y.setUniformMatrix(`${R}.PCWCMatrix`,v)}if(G.getVolumetricScatteringBlending()>0&&(y.setUniformf(`${R}.globalIlluminationReach`,G.getGlobalIlluminationReach()),y.setUniformf(`${R}.volumetricScatteringBlending`,G.getVolumetricScatteringBlending()),y.setUniformf(`${R}.anisotropy`,G.getAnisotropy()),y.setUniformf(`${R}.anisotropySquared`,G.getAnisotropy()**2)),G.getLocalAmbientOcclusion()&&G.getAmbient()>0){const B=G.getLAOKernelSize();y.setUniformi(`${R}.kernelSize`,B);const P=G.getLAOKernelRadius();y.setUniformi(`${R}.kernelRadius`,P)}else y.setUniformi(`${R}.kernelSize`,0)},t.setPropertyShaderParameters=(l,d,u)=>{const f=l.getProgram();f.setUniformi("jtexture",e.jitterTexture.getTextureUnit());const h=u.getProperties();f.setUniformi("labelOutlineThicknessTexture",e.labelOutlineThicknessTexture.getTextureUnit()),f.setUniformi("opacityTexture",e.opacityTexture.getTextureUnit()),f.setUniformi("colorTexture",e.colorTexture.getTextureUnit());const g="volume",p=e.currentValidInputs[0],v=h[p.inputIndex],w=e.previousState.numberOfComponents,m=e.previousState.useIndependentComponents;if(m){const D=new Float32Array(4);for(let O=0;O<w;O++)D[O]=v.getComponentWeight(O);f.setUniform4fv(`${g}.independentComponentMix`,D);const b=new Float32Array(4),I=1/w;for(let O=0;O<w;++O)b[O]=(O+.5)*I;f.setUniform4fv(`${g}.transferFunctionsSampleHeight`,b)}const y=e.colorForValueFunctionId;f.setUniformi(`${g}.colorForValueFunctionId`,y);const C=v.getComputeNormalFromOpacity();f.setUniformi(`${g}.computeNormalFromOpacity`,C);const x=new Float32Array(4),S=new Float32Array(4),T=new Float32Array(4),_=new Float32Array(4);for(let D=0;D<w;D++){const b=e.previousState.multiTexturePerVolumeEnabled,I=b?D:0,O=b?0:D,R=e.scalarTextures[I].getVolumeInfo(),A=m?D:0,G=R.scale[O],L=v.getRGBTransferFunction(A).getRange();x[D]=G/(L[1]-L[0]),S[D]=(R.offset[O]-L[0])/(L[1]-L[0]);const j=v.getScalarOpacity(A).getRange();T[D]=G/(j[1]-j[0]),_[D]=(R.offset[O]-j[0])/(j[1]-j[0])}if(f.setUniform4fv(`${g}.colorTextureScale`,x),f.setUniform4fv(`${g}.colorTextureShift`,S),f.setUniform4fv(`${g}.opacityTextureScale`,T),f.setUniform4fv(`${g}.opacityTextureShift`,_),e.previousState.gradientOpacityEnabled){const D=new Array(4),b=new Array(4),I=new Array(4),O=new Array(4);if(m)for(let M=0;M<w;++M){const R=e.previousState.multiTexturePerVolumeEnabled,A=R?M:0,G=R?0:M,F=e.scalarTextures[A].getVolumeInfo().scale[G];if(v.getUseGradientOpacity(M)){const Y=[v.getGradientOpacityMinimumOpacity(M),v.getGradientOpacityMaximumOpacity(M)],ie=[v.getGradientOpacityMinimumValue(M),v.getGradientOpacityMaximumValue(M)];I[M]=Y[0],O[M]=Y[1],D[M]=F*(Y[1]-Y[0])/(ie[1]-ie[0]),b[M]=-ie[0]*(Y[1]-Y[0])/(ie[1]-ie[0])+Y[0]}else I[M]=1,O[M]=1,D[M]=0,b[M]=1}else{const M=w-1,R=e.previousState.multiTexturePerVolumeEnabled,A=R?M:0,G=R?0:M,F=e.scalarTextures[A].getVolumeInfo().scale[G],j=[v.getGradientOpacityMinimumOpacity(0),v.getGradientOpacityMaximumOpacity(0)],Y=[v.getGradientOpacityMinimumValue(0),v.getGradientOpacityMaximumValue(0)];I[0]=j[0],O[0]=j[1],D[0]=F*(j[1]-j[0])/(Y[1]-Y[0]),b[0]=-Y[0]*(j[1]-j[0])/(Y[1]-Y[0])+j[0]}f.setUniform4f(`${g}.gradientOpacityScale`,D),f.setUniform4f(`${g}.gradientOpacityShift`,b),f.setUniform4f(`${g}.gradientOpacityMin`,I),f.setUniform4f(`${g}.gradientOpacityMax`,O)}const E=v.getLabelOutlineOpacity();if(f.setUniformf(`${g}.outlineOpacity`,E),e.numberOfLights>0){f.setUniformf(`${g}.ambient`,v.getAmbient()),f.setUniformf(`${g}.diffuse`,v.getDiffuse()),f.setUniformf(`${g}.specular`,v.getSpecular());const D=v.getSpecularPower();f.setUniformf(`${g}.specularPower`,D===0?1:D)}},t.getClippingPlaneShaderParameters=(l,d,u)=>{if(e.renderable.getClippingPlanes().length>0){const f=e.openGLCamera.getKeyMatrices(d),h=[],g=[],p=[],v=e.renderable.getClippingPlanes(),w=v.length;for(let y=0;y<w;++y){const C=v[y].getNormal(),x=v[y].getOrigin();zf(C,C,f.normalMatrix),Vt(x,x,f.wcvc);const S=-1*ft(x,C);h.push(C[0]),h.push(C[1]),h.push(C[2]),g.push(S),p.push(x[0]),p.push(x[1]),p.push(x[2])}const m=l.getProgram();m.setUniform3fv("vClipPlaneNormals",h),m.setUniformfv("vClipPlaneDistances",g),m.setUniform3fv("vClipPlaneOrigins",p),m.setUniformi("clip_numPlanes",w)}},t.delete=Th(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&c(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:l,vsize:d}=e._openGLRenderer.getTiledSizeAndOrigin();return[l,d]},t.getRenderTargetOffset=()=>{const{lowerLeftU:l,lowerLeftV:d}=e._openGLRenderer.getTiledSizeAndOrigin();return[l,d]},t.getCurrentSampleDistance=l=>{const d=l.getVTKWindow().getInteractor(),u=e.renderable.getSampleDistance();if(d.isAnimating()){const f=e.renderable.getInteractionSampleDistanceFactor();return u*f}return u},t.renderPieceStart=(l,d)=>{const u=l.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,u.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=u.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const h=u.getRecentAnimationFrameRate(),g=u.getDesiredUpdateRate()/h;(g>1.15||g<.85)&&(e._lastScale*=g),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const h=e._openGLRenderWindow.getFramebufferSize(),g=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(g*h[0]),e._smallViewportHeight=Math.ceil(g*h[1]),e._smallViewportHeight>h[1]&&(e._smallViewportHeight=h[1]),e._smallViewportWidth>h[0]&&(e._smallViewportWidth=h[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(h[0],h[1]),e.framebuffer.populateFramebuffer();else{const v=e.framebuffer.getSize();(!v||v[0]!==h[0]||v[1]!==h[1])&&(e.framebuffer.create(h[0],h[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const p=e.context;p.clearColor(0,0,0,0),p.colorMask(!0,!0,!0,!0),p.clear(p.COLOR_BUFFER_BIT),p.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/h[0],e._smallViewportHeight/h[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(l,d);const f=d.getProperties();e.currentValidInputs.forEach(h=>{let{inputIndex:g}=h;const v=f[g].getInterpolationType(),w=e.scalarTextures[g];v===D8.NEAREST?(w.setMinificationFilter(Dt.NEAREST),w.setMagnificationFilter(Dt.NEAREST)):(w.setMinificationFilter(Dt.LINEAR),w.setMagnificationFilter(Dt.LINEAR))}),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(l,d)=>{const u=e.context,f=[...e.scalarTextures,e.colorTexture,e.opacityTexture,e.labelOutlineThicknessTexture,e.jitterTexture];f.forEach(h=>h.activate()),t.updateShaders(e.tris,l,d),u.drawArrays(u.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),f.forEach(h=>h.deactivate())},t.renderPieceFinish=(l,d)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const g=e.copyShader;e.copyVAO=$1.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(g,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Z3("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const u=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,u[0],u[1]);const f=e.framebuffer.getColorTexture();f.activate(),e.copyShader.setUniformi("texture",f.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const h=e.context;h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),f.deactivate(),h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(l,d)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const u=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let h=0;h<u;++h){const g=e.renderable.getInputData(h);g&&!g.isDeleted()&&e.currentValidInputs.push({imageData:g,inputIndex:h})}let f=0;if(e.currentValidInputs.length>0){const h=d.getProperties(),g=e.currentValidInputs[0],v=g.imageData.getPointData().getScalars(),w=h[g.inputIndex];w.getShade()&&e.renderable.getBlendMode()===uf.COMPOSITE_BLEND&&l.getLights().forEach(C=>{C.getSwitch()>0&&f++});const m=e.currentValidInputs.length,y=m>1;e.numberOfComponents=y?m:v.getNumberOfComponents(),e.useIndependentComponents=r(w,e.numberOfComponents)}f!==e.numberOfLights&&(e.numberOfLights=f,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(l,d),t.renderPieceDraw(l,d),t.renderPieceFinish(l,d))},t.updateBufferObjects=(l,d)=>{t.getNeedToRebuildBufferObjects(l,d)&&t.buildBufferObjects(l,d)},t.getNeedToRebuildBufferObjects=(l,d)=>e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<d.getMTime()||e.VBOBuildTime.getMTime()<d.getProperty(e.currentValidInputs[0].inputIndex)?.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.currentValidInputs.some(u=>{let{imageData:f}=u;return e.VBOBuildTime.getMTime()<f.getMTime()})||e.scalarTextures.length!==e.currentValidInputs.length||!e.scalarTextures.every(u=>!!u?.getHandle())||!e.colorTexture?.getHandle()||!e.opacityTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle()||!e.jitterTexture?.getHandle(),t.buildBufferObjects=(l,d)=>{if(!e.jitterTexture.getHandle()){const R=new Float32Array(1024);for(let A=0;A<1024;++A)R[A]=Math.random();e.jitterTexture.setMinificationFilter(Dt.NEAREST),e.jitterTexture.setMagnificationFilter(Dt.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:Zt.FLOAT,data:R})}const u=d.getProperties(),f=e.currentValidInputs[0],h=u[f.inputIndex],g=e.numberOfComponents,p=e.useIndependentComponents,v=p?g:1,w=[];for(let R=0;R<v;++R)w.push(h.getScalarOpacity(R));const m=ts(w,p,v),y=h.getScalarOpacity(),C=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!C?.oglObject?.getHandle()||C.hash!==m){const R=$n.newInstance();R.setOpenGLRenderWindow(e._openGLRenderWindow);let A=e.renderable.getOpacityTextureWidth();A<=0&&(A=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const G=A*2*v,k=new Float32Array(G),L=new Float32Array(A);for(let F=0;F<v;++F){const j=h.getScalarOpacity(F),Y=t.getCurrentSampleDistance(l)/h.getScalarOpacityUnitDistance(F),ie=j.getRange();j.getTable(ie[0],ie[1],A,L,1);for(let de=0;de<A;++de)k[F*A*2+de]=1-(1-L[de])**Y,k[F*A*2+de+A]=k[F*A*2+de]}if(R.resetFormatAndType(),R.setMinificationFilter(Dt.LINEAR),R.setMagnificationFilter(Dt.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))R.create2DFromRaw({width:A,height:2*v,numComps:1,dataType:Zt.FLOAT,data:k});else{const F=new Uint8ClampedArray(G);for(let j=0;j<G;++j)F[j]=255*k[j];R.create2DFromRaw({width:A,height:2*v,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:F})}y&&e._openGLRenderWindow.setGraphicsResourceForObject(y,R,m),e.opacityTexture=R}else e.opacityTexture=C.oglObject;s(e._openGLRenderWindow,e._opacityTextureCore,y),e._opacityTextureCore=y;const S=[];for(let R=0;R<v;++R)S.push(h.getRGBTransferFunction(R));const T=ts(S,p,v),_=h.getRGBTransferFunction(),E=e._openGLRenderWindow.getGraphicsResourceForObject(_);if(!E?.oglObject?.getHandle()||E?.hash!==T){const R=$n.newInstance();R.setOpenGLRenderWindow(e._openGLRenderWindow);let A=e.renderable.getColorTextureWidth();A<=0&&(A=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const G=A*2*v*3,k=new Uint8ClampedArray(G),L=new Float32Array(A*3);for(let F=0;F<v;++F){const j=h.getRGBTransferFunction(F),Y=j.getRange();j.getTable(Y[0],Y[1],A,L,1);for(let ie=0;ie<A*3;++ie)k[F*A*6+ie]=255*L[ie],k[F*A*6+ie+A*3]=255*L[ie]}R.resetFormatAndType(),R.setMinificationFilter(Dt.LINEAR),R.setMagnificationFilter(Dt.LINEAR),R.create2DFromRaw({width:A,height:2*v,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:k}),e._openGLRenderWindow.setGraphicsResourceForObject(_,R,T),e.colorTexture=R}else e.colorTexture=E.oglObject;s(e._openGLRenderWindow,e._colorTextureCore,_),e._colorTextureCore=_,e.currentValidInputs.forEach((R,A)=>{let{imageData:G,inputIndex:k}=R;const L=u[k],F=G.getPointData().getScalars(),j=e._openGLRenderWindow.getGraphicsResourceForObject(F),Y=fw(G,F),ie=!j?.oglObject?.getHandle()||j?.hash!==Y,de=L.getUpdatedExtents(),ae=!!de.length;if(ie&&!ae){const fe=$n.newInstance();fe.setOpenGLRenderWindow(e._openGLRenderWindow);const we=G.getDimensions();fe.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),fe.resetFormatAndType(),fe.create3DFilterableFromDataArray({width:we[0],height:we[1],depth:we[2],dataArray:F,preferSizeOverAccuracy:L.getPreferSizeOverAccuracy()}),e._openGLRenderWindow.setGraphicsResourceForObject(F,fe,Y),e.scalarTextures[A]=fe}else e.scalarTextures[A]=j.oglObject;if(ae){L.setUpdatedExtents([]);const fe=G.getDimensions();e.scalarTextures[A].create3DFilterableFromDataArray({width:fe[0],height:fe[1],depth:fe[2],dataArray:F,updatedExtents:de})}s(e._openGLRenderWindow,e._scalarTexturesCore[A],F),e._scalarTexturesCore[A]=F});const b=h.getLabelOutlineThickness(),I=e._openGLRenderWindow.getGraphicsResourceForObject(b),O=b.join("-");if(!I?.oglObject?.getHandle()||I?.hash!==O){const R=$n.newInstance();R.setOpenGLRenderWindow(e._openGLRenderWindow);let A=e.renderable.getLabelOutlineTextureWidth();A<=0&&(A=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const G=1,k=A*G,L=new Uint8Array(k);for(let F=0;F<A;++F){const j=typeof b[F]<"u"?b[F]:b[0];L[F]=j}R.resetFormatAndType(),R.setMinificationFilter(Dt.NEAREST),R.setMagnificationFilter(Dt.NEAREST),R.create2DFromRaw({width:A,height:G,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:L}),b&&e._openGLRenderWindow.setGraphicsResourceForObject(b,R,O),e.labelOutlineThicknessTexture=R}else e.labelOutlineThicknessTexture=I.oglObject;if(s(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,b),e._labelOutlineThicknessTextureCore=b,!e.tris.getCABO().getElementCount()){const R=new Float32Array(12);for(let L=0;L<4;L++)R[L*3]=L%2*2-1,R[L*3+1]=L>1?1:-1,R[L*3+2]=-1;const A=new Uint16Array(8);A[0]=3,A[1]=0,A[2]=1,A[3]=3,A[4]=3,A[5]=0,A[6]=3,A[7]=2;const G=Ot.newInstance({numberOfComponents:3,values:R});G.setName("points");const k=Ot.newInstance({numberOfComponents:1,values:A});e.tris.getCABO().createVBO(k,"polys",vo.SURFACE,{points:G,cellOffset:0})}e.VBOBuildTime.modified()}}const wG={context:null,VBOBuildTime:null,scalarTextures:[],_scalarTexturesCore:[],opacityTexture:null,_opacityTextureCore:null,colorTexture:null,_colorTextureCore:null,labelOutlineThicknessTexture:null,_labelOutlineThicknessTextureCore:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,fullViewportTime:1,idxToView:null,vecISToVCMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function Lb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wG,r),Ir.extend(t,e,r),ul.implementBuildShadersWithReplacements(t,e,r),e.VBOBuildTime={},Jn(e.VBOBuildTime,{mtime:0}),e.tris=lc.newInstance(),e.jitterTexture=$n.newInstance(),e.jitterTexture.setWrapS(Xf.REPEAT),e.jitterTexture.setWrapT(Xf.REPEAT),e.framebuffer=Mh.newInstance(),Ur(t,e,["context"]),yG(t,e)}const Nb=zn(Lb,"vtkOpenGLVolumeMapper");var Vb={newInstance:Nb,extend:Lb};ti("vtkVolumeMapper",Nb);const{vtkDebugMacro:CG}=Oi;function xG(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),o=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=n.getZBufferTexture(),l=Math.floor(c.getWidth()),d=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const f=n.getFramebuffer();f?f.saveCurrentBindingsAndBuffers():CG("No framebuffer to save/restore");const h=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,h),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(l*d*4),u.viewport(0,0,l,d),u.readPixels(0,0,l,d,u.RGBA,u.UNSIGNED_BYTE,s)),f&&f.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(h)}e.renderable.invokeCallback(e.renderable.getInputData(),o,i,a,s)},t.queryPass=(r,n)=>{r&&e.renderable.getUseZValues()&&n.requestDepth()}}const SG={};function TG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SG,r),Ir.extend(t,e,r),xG(t,e)}const kb=zn(TG,"vtkOpenGLPixelSpaceCallbackMapper");var _G={newInstance:kb};ti("vtkPixelSpaceCallbackMapper",kb);const Fb=Object.create(null);function rd(t,e){Fb[t]=e}function EG(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const bG={};function DG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bG,r),e.overrides=Fb,sw.extend(t,e,r),EG(t,e)}Z.newInstance(DG,"vtkWebGPUViewNodeFactory");function IG(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(r,n,i,o)=>{if(It(r),e.renderable.getParallelProjection()){const a=e.renderable.getParallelScale(),s=a*n,c=a,l=(o[0]-1)*s,d=(o[0]+1)*s,u=(o[1]-1)*c,f=(o[1]+1)*c,h=1/(d-l),g=1/(f-u);r[0]=2*h,r[5]=2*g,r[10]=1/(i[1]-i[0]),r[12]=(d+l)*h,r[13]=(f+u)*g,r[14]=i[1]/(i[1]-i[0])}else{const a=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*a,c=i[0]*a/n):(s=i[0]*a*n,c=i[0]*a);const l=(o[0]-1)*s,d=(o[0]+1)*s,u=(o[1]-1)*c,f=(o[1]+1)*c;r[0]=2*i[0]/(d-l),r[5]=2*i[0]/(f-u),r[12]=(l+d)/(d-l),r[13]=(u+f)/(f-u),r[10]=0,r[14]=i[0],r[11]=-1,r[15]=0}},t.convertToOpenGLDepth=r=>{if(e.renderable.getParallelProjection())return 1-r;const n=e.renderable.getClippingRangeByReference();let i=-n[0]/r;return i=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(i*(n[1]-n[0])),.5*i+.5},t.getKeyMatrices=r=>{const n=r.getRenderable(),i=r.getParent();if(Math.max(i.getMTime(),t.getMTime(),n.getMTime(),e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatrixTime.getMTime()){const o=e.renderable.getViewMatrix();fr(e.keyMatrices.normalMatrix,o),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Cr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Mn(e.keyMatrices.wcvc,o);const a=r.getStabilizedCenterByReference();Xn(e.keyMatrices.scvc,e.keyMatrices.wcvc,a);const s=r.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),Wt(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Cr(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const MG={keyMatrixTime:null,keyMatrices:null};function OG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MG,r),Ir.extend(t,e,r),e.keyMatrixTime={},Z.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},Z.setGet(t,e,["keyMatrixTime"]),IG(t,e)}const PG=Z.newInstance(OG);rd("vtkCamera",PG);function RG(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=r=>{if(e.bindables.length===r.length){let n=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==r[i]&&(n=!1);if(n)return}e.bindables=r,t.modified()},t.getBindGroupLayout=r=>{const n=[];for(let i=0;i<e.bindables.length;i++){const o=e.bindables[i].getBindGroupLayoutEntry();o.binding=i,n.push(o)}return r.getBindGroupLayout({entries:n})},t.getBindGroup=r=>{let n=t.getMTime();for(let o=0;o<e.bindables.length;o++){const a=e.bindables[o].getBindGroupTime().getMTime();n=a>n?a:n}if(n<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let o=0;o<e.bindables.length;o++){const a=e.bindables[o].getBindGroupEntry();a.binding=o,i.push(a)}return e.bindGroup=r.getHandle().createBindGroup({layout:t.getBindGroupLayout(r),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=r=>{const n=[],i=r.getBindGroupLayoutCount(e.label);for(let o=0;o<e.bindables.length;o++)n.push(e.bindables[o].getShaderCode(o,i));return n.join(`
`)}}const AG={device:null,handle:null,label:null};function Ub(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AG,r),Z.obj(t,e),e.bindables=[],e.bindGroupTime={},Z.obj(e.bindGroupTime,{mtime:0}),Z.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),Z.setGet(t,e,["label","device","arrayInformation"]),RG(t,e)}const LG=Z.newInstance(Ub);var Bb={newInstance:LG,extend:Ub};function NG(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(r,n)=>{e.device=r,e.handle=e.device.getHandle().createShaderModule({code:n.getCode()})}}const VG={device:null,handle:null};function Gb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VG,r),Z.obj(t,e),Z.get(t,e,["lastCameraMTime"]),Z.setGet(t,e,["device","handle"]),NG(t,e)}const kG=Z.newInstance(Gb,"vtkWebGPUShaderModule");var FG={newInstance:kG,extend:Gb};function UG(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(r)?r.join(`
`):r;let o=!1;t.search(e)!==-1&&(o=!0);let a="";n&&(a="g");const s=new RegExp(e,a),c=t.replace(s,i);return{replace:o,result:c}}function BG(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=r=>{const n=r.getType(),i=r.getHash(),o=e._shaderModules.keys();for(let s=0;s<o.length;s++){const c=o[s];if(c.getHash()===i&&c.getType()===n)return e._shaderModules.get(c)}const a=FG.newInstance();return a.initialize(e.device,r),e._shaderModules.set(r,a),a}}const GG={shaderModules:null,device:null,window:null};function Wb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GG,r),e._shaderModules=new Map,Z.obj(t,e),Z.setGet(t,e,["device","window"]),BG(t,e)}const WG=Z.newInstance(Wb,"vtkWebGPUShaderCache");var uo={newInstance:WG,extend:Wb,substitute:UG};function $G(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(r,n)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=n;const i=[];for(let o=0;o<e.layouts.length;o++)i.push(e.layouts[o].layout);e.pipelineLayout=r.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let o=0;o<e.shaderDescriptions.length;o++){const a=e.shaderDescriptions[o],s=r.getShaderModule(a);a.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),a.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=r.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=r=>{for(let n=0;n<e.shaderDescriptions.length;n++)if(e.shaderDescriptions[n].getType()===r)return e.shaderDescriptions[n];return null},t.addBindGroupLayout=r=>{r&&e.layouts.push({layout:r.getBindGroupLayout(e.device),label:r.getLabel()})},t.getBindGroupLayout=r=>e.layouts[r].layout,t.getBindGroupLayoutCount=r=>{for(let n=0;n<e.layouts.length;n++)if(e.layouts[n].label===r)return n;return 0},t.bindVertexInput=(r,n)=>{n.bindBuffers(r)}}const zG={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function $b(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zG,r),Jn(t,e),e.layouts=[],e.shaderDescriptions=[],ji(t,e,["handle","pipelineDescription"]),Ur(t,e,["device","renderEncoder","topology","vertexState"]),$G(t,e)}const jG=zn($b,"vtkWebGPUPipeline");var HG={newInstance:jG,extend:$b};function XG(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=r=>e.outputNames.includes(r),t.addOutput=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(r),e.outputNames.push(n),e.outputInterpolations.push(i)},t.addBuiltinOutput=(r,n)=>{e.builtinOutputTypes.push(r),e.builtinOutputNames.push(n)},t.addBuiltinInput=(r,n)=>{e.builtinInputTypes.push(r),e.builtinInputNames.push(n)},t.replaceShaderCode=(r,n)=>{const i=[];let o=[];if(n&&i.push(n.getShaderCode()),r||e.builtinInputNames.length){const a=[];if(a.push(`struct ${e.type}Input
{`),r){const s=r.getOutputNamesByReference(),c=r.getOutputTypesByReference(),l=r.getOutputInterpolationsByReference();for(let d=0;d<s.length;d++)l[d]!==void 0?a.push(`  @location(${d}) @interpolate(${l[d]}) ${s[d]} : ${c[d]},`):a.push(`  @location(${d}) ${s[d]} : ${c[d]},`)}for(let s=0;s<e.builtinInputNames.length;s++)a.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);a.length>1&&(a.push("};"),o=a,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=uo.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const a=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?a.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):a.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)a.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);a.push("};"),o=o.concat(a),e.code=uo.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=uo.substitute(e.code,"//VTK::IOStructs::Dec",o).result}}const KG={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function zb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KG,r),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],Z.obj(t,e),Z.setGet(t,e,["type","hash","code"]),Z.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),XG(t,e)}const qG=Z.newInstance(zb,"vtkWebGPUShaderDescription");var Q3={newInstance:qG,extend:zb};const eS={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function YG(t){return!t||t.length<6?0:t in eS?eS[t]:(dn(`unknown format ${t}`),null)}function JG(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const r=e===1?t.length-1:t.length-3,n=Number(t[r]);if(Number.isNaN(n))return dn(`unknown format ${t}`),0;const i=5-n/2;return e*i}function ZG(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function QG(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{dn(`unknown format ${t}`);return}const r=t.split("x")[0],n=Number(r[r.length-1]);if(Number.isNaN(n)){dn(`unknown format ${t}`);return}return e+=8*(5-n/2),e+="Array",e}function eW(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{dn(`unknown format ${t}`);return}let r=1;return t[t.length-2]==="x"&&(r=Number(t[t.length-1])),r===4?`vec4<${e}>`:r===3?`vec3<${e}>`:r===2?`vec2<${e}>`:e}function tW(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function nW(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";dn(`unknown format ${t}`)}}var Wa={getDetailsFromTextureFormat:YG,getByteStrideFromBufferFormat:JG,getNumberOfComponentsFromBufferFormat:ZG,getNativeTypeFromBufferFormat:QG,getShaderTypeFromBufferFormat:eW,getByteStrideFromShaderFormat:tW,getNativeTypeFromShaderFormat:nW};function rW(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!e.includes(t[r]))return!1;return!0}function iW(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",o=n;Array.isArray(o)||(o=[o]);for(let a=0;a<e.inputs.length;a++)if(rW(e.inputs[a].names,o)){if(e.inputs[a].buffer===r)return;e.inputs[a].buffer=r;return}e.inputs.push({buffer:r,stepMode:i,names:o}),e.inputs=e.inputs.sort((a,s)=>a.names[0]<s.names[0]?-1:a.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=r=>{for(let n=0;n<e.inputs.length;n++)e.inputs[n].names.includes(r)&&e.inputs.splice(n,1)},t.getBuffer=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer;return null},t.hasAttribute=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return!0;return!1},t.getAttributeTime=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let r="",n=0;for(let i=0;i<e.inputs.length;i++)for(let o=0;o<e.inputs[i].names.length;o++){const a=e.inputs[i].buffer.getArrayInformation()[o],s=Wa.getShaderTypeFromBufferFormat(a.format);n>0&&(r+=`,
`),r=`${r}  @location(${n}) ${e.inputs[i].names[o]} : ${s}`,n++}return r},t.getVertexInputInformation=()=>{const r={};if(e.inputs.length){const n=[];let i=0;for(let o=0;o<e.inputs.length;o++){const a=e.inputs[o].buffer,s={arrayStride:a.getStrideInBytes(),stepMode:e.inputs[o].stepMode,attributes:[]},c=a.getArrayInformation();for(let l=0;l<e.inputs[o].names.length;l++)s.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;n.push(s)}r.buffers=n}return r},t.bindBuffers=r=>{for(let n=0;n<e.inputs.length;n++)r.setVertexBuffer(n,e.inputs[n].buffer.getHandle());e.indexBuffer&&r.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const oW={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function jb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oW,r),Jn(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Ur(t,e,["created","device","handle","indexBuffer"]),iW(t,e)}const aW=zn(jb,"vtkWebGPUVertexInput");var sW={newInstance:aW,extend:jb};const cW=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,lW=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function uW(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(r,n,i)=>{const o=Q3.newInstance({type:"vertex",hash:r,code:e.vertexShaderTemplate}),a=Q3.newInstance({type:"fragment",hash:r,code:e.fragmentShaderTemplate}),s=n.getShaderDescriptions();s.push(o),s.push(a);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((f,h,g)=>g.indexOf(f)===h).map(f=>`replaceShader${f.substring(7,f.length-2)}`);for(let f=0;f<u.length;f++){const h=u[f];h!=="replaceShaderIOStructs"&&e.shaderReplacements.has(h)&&e.shaderReplacements.get(h)(r,n,i)}t.replaceShaderIOStructs(r,n,i)},t.replaceShaderIOStructs=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.replaceShaderCode(null,i),n.getShaderDescription("fragment").replaceShaderCode(o)},t.replaceShaderRenderEncoder=(r,n,i)=>{e.renderEncoder.replaceShaderCode(n)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(r,n,i)=>{if(!e.WebGPURenderer)return;const o=e.WebGPURenderer.getBindGroup().getShaderCode(n),a=n.getShaderDescription("vertex");let s=a.getCode();s=uo.substitute(s,"//VTK::Renderer::Dec",[o]).result,a.setCode(s);const c=n.getShaderDescription("fragment");s=c.getCode(),s=uo.substitute(s,"//VTK::Renderer::Dec",[o]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(r,n,i)=>{const o=e.bindGroup.getShaderCode(n),a=n.getShaderDescription("vertex");let s=a.getCode();s=uo.substitute(s,"//VTK::Mapper::Dec",[o]).result,a.setCode(s);const c=n.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=uo.substitute(s,"//VTK::Mapper::Dec",[o]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let a=o.getCode();a=uo.substitute(a,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(r,n,i)=>{n.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=r=>{e.textureViews.includes(r)||e.textureViews.push(r)},t.prepareToDraw=r=>{e.renderEncoder=r,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=r=>{r.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=r=>{t.prepareToDraw(r),r.setPipeline(e.pipeline),t.draw(r)},t.draw=r=>{const n=r.getBoundPipeline();r.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(r),n.bindVertexInput(r,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?r.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):r.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const r=[...e.additionalBindables];e.UBO&&r.push(e.UBO),e.SSBO&&r.push(e.SSBO);for(let n=0;n<e.textureViews.length;n++){r.push(e.textureViews[n]);const i=e.textureViews[n].getSampler();i&&r.push(i)}return r},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=HG.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const dW={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function Hb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dW,r),Ir.extend(t,e,r),e.textureViews=[],e.vertexInput=sW.newInstance(),e.bindGroup=Bb.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||lW,e.vertexShaderTemplate=e.vertexShaderTemplate||cW,e.shaderReplacements=new Map,Z.get(t,e,["pipeline","vertexInput"]),Z.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),uW(t,e)}const fW=Z.newInstance(Hb,"vtkWebGPUSimpleMapper");var hW={newInstance:fW,extend:Hb};function gW(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),o.addOutput("vec4<f32>","vertexVC");let a=o.getCode();a=uo.substitute(a,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const r=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(r,["vertexBC"]),e.numberOfVertices=6}}const pW={};function Xb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pW,r),hW.extend(t,e,r),gW(t,e)}const mW=Z.newInstance(Xb,"vtkWebGPUFullScreenQuad");var ay={newInstance:mW,extend:Xb};const vW={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},yW={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var Oh={BufferUsage:vW,PrimitiveTypes:yW};const p2=["getMappedRange","mapAsync","unmap"];function wW(t,e,r,n){const i=n.byteLength,o=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),a=o.getMappedRange(0,i);new Uint8Array(a).set(new Uint8Array(n)),o.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(o,0,e,r,i);const c=s.finish();t.queue.submit([c]),o.destroy()}function CW(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r,usage:n,label:e.label}),e.sizeInBytes=r,e.usage=n},t.write=r=>{wW(e.device.getHandle(),e.handle,0,r.buffer)},t.createAndWrite=(r,n)=>{const i=Math.ceil(r.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:i,usage:n,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=i,e.usage=n,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(r.buffer)),e.handle.unmap()};for(let r=0;r<p2.length;r++)t[p2[r]]=function(){return e.handle[p2[r]](...arguments)}}const xW={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function Kb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xW,r),Z.obj(t,e),Z.get(t,e,["handle","sizeInBytes","usage"]),Z.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),CW(t,e)}const SW=Z.newInstance(Kb);var sy={newInstance:SW,extend:Kb,...Oh};const{Representation:tf,Interpolation:nf}=hb;function tS(t){return()=>Z.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function TW(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(r,n,i)=>{Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==i)&&(e.color[0]=r,e.color[1]=n,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=tS("ComputeCompositeColor"),t.getColor=()=>{let r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(let n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=r=>{const n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=tS("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(nf.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(nf.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(nf.PHONG),t.getInterpolationAsString=()=>Z.enumToString(nf,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(tf.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(tf.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(tf.POINTS),t.getRepresentationAsString=()=>Z.enumToString(tf,e.representation)}const _W={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:nf.GOURAUD,representation:tf.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function EW(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_W,r),Z.obj(t,e),Z.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),Z.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),TW(t,e)}const bW=Z.newInstance(EW,"vtkProperty");var Ph={newInstance:bW,...hb};const{Representation:nS}=Ph,{PrimitiveTypes:jc}=Oh;class DW{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return!0}get(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return this.values[r]}set(e,r){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=r)}}function IW(t){switch(t){case jc.Points:return"points";case jc.Lines:return"lines";case jc.Triangles:case jc.TriangleEdges:return"polys";case jc.TriangleStripEdges:case jc.TriangleStrips:return"strips";default:return""}}function lg(t,e,r){let n=t.pointIdToFlatId[e];return n<0&&(n=t.flatId,t.pointIdToFlatId[e]=n,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=r,t.flatId++),n}function MW(t,e,r){const n=t.length;for(let a=0;a<n;a++){let s=t[a];if(r.cellProvokedMap.has(s)){r.ibo[r.iboId++]=r.cellProvokedMap.get(s);for(let c=a+1;c<a+n;c++){s=t[c%n];const l=lg(r,s,e);r.ibo[r.iboId++]=l}return}}for(let a=0;a<n;a++){let s=t[a];if(!r.provokedPointIds[s]){let c=lg(r,s,e);r.provokedPointIds[s]=1,r.cellProvokedMap.set(s,c),r.flatIdToCellId[c]=e,r.ibo[r.iboId++]=c;for(let l=a+1;l<a+n;l++)s=t[l%n],c=lg(r,s,e),r.ibo[r.iboId++]=c;return}}let i=t[0],o=r.flatId;r.cellProvokedMap.set(i,o),r.flatIdToPointId[r.flatId]=i,r.flatIdToCellId[r.flatId]=e,r.flatId++,r.ibo[r.iboId++]=o;for(let a=1;a<n;a++)i=t[a],o=lg(r,i,e),r.ibo[r.iboId++]=o}function OW(t,e,r){const n=t.length;r.iboSize+=n;for(let i=0;i<n;i++){const o=t[i];if(r.cellProvokedMap.has(o))return}for(let i=0;i<n;i++){const o=t[i];if(!r.provokedPointIds[o]){r.provokedPointIds[o]=1,r.cellProvokedMap.set(o,1);return}}r.cellProvokedMap.set(t[0],1),r.extraPoints++}let Ns;const rS=new Uint32Array(1),Po=new Uint32Array(2),Vc=new Uint32Array(3),m2={anythingToPoints(t,e,r,n,i){for(let o=0;o<t;++o)rS[0]=e[r+o],Ns(rS,n,i)},linesToWireframe(t,e,r,n,i){for(let o=0;o<t-1;++o)Po[0]=e[r+o],Po[1]=e[r+o+1],Ns(Po,n,i)},polysToWireframe(t,e,r,n,i){if(t>2)for(let o=0;o<t;++o)Po[0]=e[r+o],Po[1]=e[r+(o+1)%t],Ns(Po,n,i)},stripsToWireframe(t,e,r,n,i){if(t>2){for(let o=0;o<t-1;++o)Po[0]=e[r+o],Po[1]=e[r+o+1],Ns(Po,n,i);for(let o=0;o<t-2;o++)Po[0]=e[r+o],Po[1]=e[r+o+2],Ns(Po,n,i)}},polysToSurface(t,e,r,n,i){for(let o=0;o<t-2;o++)Vc[0]=e[r],Vc[1]=e[r+o+1],Vc[2]=e[r+o+2],Ns(Vc,n,i)},stripsToSurface(t,e,r,n,i){for(let o=0;o<t-2;o++)Vc[0]=e[r+o],Vc[1]=e[r+o+1+o%2],Vc[2]=e[r+o+1+(o+1)%2],Ns(Vc,n,i)}};function PW(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=r=>{const n=r.cells,i=r.primitiveType,o=r.representation,a=r.cellOffset,s=n.getData(),c=s.length,l=IW(i),d=r.numberOfPoints,u={provokedPointIds:new Uint8Array(d),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new DW};let f=null;o===nS.POINTS||i===jc.Points?f=m2.anythingToPoints:o===nS.WIREFRAME||i===jc.Lines?f=m2[`${l}ToWireframe`]:f=m2[`${l}ToSurface`],Ns=OW;let h=a||0;for(let g=0;g<c;)u.cellProvokedMap.clear(),f(s[g],s,g+1,h,u),g+=s[g]+1,h++;d<=65535?u.flatIdToPointId=new Uint16Array(d+u.extraPoints):u.flatIdToPointId=new Uint32Array(d+u.extraPoints),d+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(d):u.pointIdToFlatId=new Int32Array(d),d+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),r.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),r.format="uint32"),h<=65535?u.flatIdToCellId=new Uint16Array(d+u.extraPoints):u.flatIdToCellId=new Uint32Array(d+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),Ns=MW,h=a||0;for(let g=0;g<c;)u.cellProvokedMap.clear(),f(s[g],s,g+1,h,u),g+=s[g]+1,h++;delete u.provokedPointIds,delete u.pointIdToFlatId,r.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const RW={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function qb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RW,r),sy.extend(t,e,r),Z.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),PW(t,e)}const AW=Z.newInstance(qb);var LW={newInstance:AW,extend:qb,...Oh};const{BufferUsage:kc}=Oh,{vtkErrorMacro:NW}=Oi,{VtkDataTypes:Xl}=Ot,VW={};function kW(t){let e;switch(t.getDataType()){case Xl.UNSIGNED_CHAR:e="uint8";break;case Xl.FLOAT:e="float32";break;case Xl.UNSIGNED_INT:e="uint32";break;case Xl.INT:e="sint32";break;case Xl.DOUBLE:e="float32";break;case Xl.UNSIGNED_SHORT:e="uint16";break;case Xl.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||NW(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function iS(t,e,r,n,i){const o={},a=t.getFlatSize();if(!a)return o;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let d,u=0;const f=r+(l?1:0),h=Z0(n,a*f);let g=t.getFlatIdToPointId();i.cellData&&(g=t.getFlatIdToCellId()),r===1?d=function(v){h[u++]=c[0]*e[v]+s[0]}:r===2?d=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1]}:r===3&&!l?d=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1],h[u++]=c[2]*e[v+2]+s[2]}:r===3&&l?d=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1],h[u++]=c[2]*e[v+2]+s[2],h[u++]=c[3]*1+s[3]}:r===4&&(d=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1],h[u++]=c[2]*e[v+2]+s[2],h[u++]=c[3]*e[v+3]+s[3]});for(let p=0;p<a;p++){const v=r*g[p];d(v)}return o.nativeArray=h,o}function FW(t,e,r,n){const i=[t[n*3]-t[r*3],t[n*3+1]-t[r*3+1],t[n*3+2]-t[r*3+2]],o=[t[e*3]-t[r*3],t[e*3+1]-t[r*3+1],t[e*3+2]-t[r*3+2]],a=[];return Bi(i,o,a),wo(a),a}function UW(t,e){const r=e.getData(),n=t.getData();if(!n||!r)return null;const i=new Int8Array(t.getNumberOfCells()*4),o=n.length;let a=0;for(let s=0;s<o;){const c=FW(r,n[s+1],n[s+2],n[s+3]);i[a++]=127*c[0],i[a++]=127*c[1],i[a++]=127*c[2],i[a++]=127,s+=n[s]+1}return i}function BW(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function r(n){n.dataArray&&!n.nativeArray&&(n.nativeArray=n.dataArray.getData());let i,o;if(n.usage===kc.Index&&(i=LW.newInstance({label:n.label}),i.setDevice(e.device),o=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(n),i.createAndWrite(n.nativeArray,o),i.setArrayInformation([{format:n.format}])),i||(i=sy.newInstance({label:n.label}),i.setDevice(e.device)),n.usage===kc.UniformArray&&(o=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(n.nativeArray,o)),n.usage===kc.Storage&&(o=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(n.nativeArray,o)),n.usage===kc.Texture&&(o=GPUBufferUsage.COPY_SRC,i.createAndWrite(n.nativeArray,o)),n.usage===kc.PointArray){o=GPUBufferUsage.VERTEX;const a=Wa.getNativeTypeFromBufferFormat(n.format),s=iS(n.indexBuffer,n.dataArray.getData(),n.dataArray.getNumberOfComponents(),a,{packExtra:n.packExtra,shift:n.shift,scale:n.scale,cellData:n.cellData,cellOffset:n.cellOffset});i.createAndWrite(s.nativeArray,o),i.setStrideInBytes(Wa.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format,interpolation:n.cellData?"flat":"perspective"}])}if(n.usage===kc.NormalsFromPoints){o=GPUBufferUsage.VERTEX;const a=Wa.getNativeTypeFromBufferFormat(n.format),s=UW(n.cells,n.dataArray),c=iS(n.indexBuffer,s,4,a,{cellData:!0});i.createAndWrite(c.nativeArray,o),i.setStrideInBytes(Wa.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format,interpolation:"flat"}])}return n.usage===kc.RawVertex&&(o=GPUBufferUsage.VERTEX,i.createAndWrite(n.nativeArray,o),i.setStrideInBytes(Wa.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format}])),i.setSourceTime(n.time),i}t.hasBuffer=n=>e.device.hasCachedObject(n),t.getBuffer=n=>n.hash?e.device.getCachedObject(n.hash,r,n):r(n),t.getBufferForPointArray=(n,i)=>{const o=kW(n),a={hash:`${n.getMTime()}I${i.getMTime()}${o}`,usage:kc.PointArray,format:o,dataArray:n,indexBuffer:i};return t.getBuffer(a)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=sy.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const n=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(n,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const GW={device:null,fullScreenQuadBuffer:null};function WW(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GW,r),Jn(t,e),Ur(t,e,["device"]),BW(t,e)}zn(WW);var Yb={...VW,...Oh};const{BufferUsage:$W}=Yb,{vtkErrorMacro:zu}=Z;function zW(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){zu(`entry named ${r} already exists`);return}e._bufferEntryNames.set(r,e.bufferEntries.length);const i=Wa.getByteStrideFromShaderFormat(n);e.bufferEntries.push({name:r,type:n,sizeInBytes:i,offset:e.sizeInBytes,nativeType:Wa.getNativeTypeFromShaderFormat(n)}),e.sizeInBytes+=i},t.send=r=>{if(!e._buffer){const n={nativeArray:e.Float32Array,usage:$W.Storage,label:e.label};e._buffer=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e._sendTime.modified();return}r.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[r]=Z.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n,i)=>{const o=e._bufferEntryNames.get(r);if(o===void 0){zu(`entry named ${r} not found in UBO`);return}const a=e.bufferEntries[o];t.createView(a.nativeType);const s=e[a.nativeType];s[(a.offset+n*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(r,n,i)=>{const o=e._bufferEntryNames.get(r);if(o===void 0){zu(`entry named ${r} not found in UBO`);return}const a=e.bufferEntries[o];t.createView(a.nativeType);const s=e[a.nativeType],c=(a.offset+n*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)s[c+l]=i[l]},t.setAllInstancesFromArray=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){zu(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let d=0;d<s;d++)a[l+d]=n[c*s+d]}},t.setAllInstancesFromArrayColorToFloat=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){zu(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let d=0;d<s;d++)a[l+d]=n[c*s+d]/255}},t.setAllInstancesFromArray3x3To4x4=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){zu(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let d=0;d<3;d++)for(let u=0;u<3;u++)a[l+d*4+u]=n[c*s+d*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(r,n)=>{const i=[`struct ${e.label}StructEntry
{`];for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];i.push(`  ${a.name}: ${a.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${r}) @group(${n}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const jW={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function Jb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jW,r),Z.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},Z.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},Z.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},Z.get(t,e,["bindGroupTime"]),Z.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),zW(t,e)}const HW=Z.newInstance(Jb,"vtkWebGPUStorageBuffer");var XW={newInstance:HW,extend:Jb};const{BufferUsage:KW}=Yb,{vtkErrorMacro:v2}=Z;function qW(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){v2(`entry named ${r} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(r,e.bufferEntries.length),e.bufferEntries.push({name:r,type:n,sizeInBytes:Wa.getByteStrideFromShaderFormat(n),offset:-1,nativeType:Wa.getNativeTypeFromShaderFormat(n),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let r=0;const n=[];let i=4;for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.sizeInBytes%16===0&&(i=Math.max(16,i)),a.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.packed===!1&&a.sizeInBytes%16===0&&(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(a.packed===!1&&a.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(!a.packed&&a.sizeInBytes%8===0)for(let s=o+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(!a.packed&&a.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let d=c+1;d<e.bufferEntries.length;d++){const u=e.bufferEntries[d];if(!u.packed&&u.sizeInBytes===4){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,l.packed=!0,l.offset=r,n.push(l),r+=l.sizeInBytes,u.packed=!0,u.offset=r,n.push(u),r+=u.sizeInBytes,s=!0;break}}}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];!a.packed&&a.sizeInBytes>4&&(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.packed||(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}e.bufferEntries=n,e._bufferEntryNames.clear();for(let o=0;o<e.bufferEntries.length;o++)e._bufferEntryNames.set(e.bufferEntries[o].name,o);e.sizeInBytes=r,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=r=>{if(!e.UBO){const n={nativeArray:e.Float32Array,usage:KW.UniformArray,label:e.label};e.UBO=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(r.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[r]=Z.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(r);if(i===void 0){v2(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType];o.lastValue!==n&&(a[o.offset/a.BYTES_PER_ELEMENT]=n,e.sendDirty=!0),o.lastValue=n},t.setArray=(r,n)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(r);if(i===void 0){v2(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType];let s=!1;for(let c=0;c<n.length;c++)(!o.lastValue||o.lastValue[c]!==n[c])&&(a[o.offset/a.BYTES_PER_ELEMENT+c]=n[c],s=!0);s&&(e.sendDirty=!0,o.lastValue=[...n])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(r,n)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];i.push(`  ${a.name}: ${a.type},`)}return i.push(`};
@binding(${r}) @group(${n}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const YW={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function Zb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YW,r),Z.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},Z.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},Z.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,Z.get(t,e,["binding","bindGroupTime"]),Z.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),qW(t,e)}const JW=Z.newInstance(Zb,"vtkWebGPUUniformBuffer");var mf={newInstance:JW,extend:Zb};const{vtkDebugMacro:ZW}=Oi,oS=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,QW=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,ug=new Float64Array(16),aS=new Float64Array(16);function e$(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function t$(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const r=e.camera.getClippingRange(),n=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),o=[],a=[];xr(a,i,.5*(r[0]+r[1])),hr(o,n,a),rn(a,o,e.stabilizedCenter),k0(a)/(r[1]-r[0])>e.recenterThreshold&&(e.stabilizedCenter=o,e.stabilizedTime.modified())},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let i=0;i<n.length;++i)n[i].getSwitch()>0&&r++;return r||(ZW("No lights are on, creating one."),e.renderable.createLight()),r},t.updateUBO=()=>{const r=e.UBO.getSendTime();if(e._parent.getMTime()>r||t.getMTime()>r||e.camera.getMTime()>r||e.renderable.getMTime()>r){const n=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",n.wcvc),e.UBO.setArray("SCPCMatrix",n.scpc),e.UBO.setArray("PCSCMatrix",n.pcsc),e.UBO.setArray("SCVCMatrix",n.scvc),e.UBO.setArray("VCPCMatrix",n.vcpc),e.UBO.setArray("WCVCNormals",n.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",e.renderable.getEnvironmentTexture()?.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const i=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[i.usize,i.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const o=e._parent.getDevice();e.UBO.sendIfNeeded(o)}},t.updateSSBO=()=>{const r=e.renderable.getLights(),n=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let o=0;o<r.length;o++)i+=r[o].getMTime();if(i!==e.lightTimeString){const o=new Float32Array(r.length*4),a=new Float32Array(r.length*4),s=new Float32Array(r.length*4),c=new Float32Array(r.length*4);for(let d=0;d<r.length;d++){const u=d*4,f=r[d].getPosition();Vt(f,f,n.wcvc),o[u]=f[0],o[u+1]=f[1],o[u+2]=f[2],o[u+3]=0,a[u]=-r[d].getDirection()[0],a[u+1]=-r[d].getDirection()[1],a[u+2]=-r[d].getDirection()[2],a[u+3]=0,s[u]=r[d].getColor()[0],s[u+1]=r[d].getColor()[1],s[u+2]=r[d].getColor()[2],s[u+3]=r[d].getIntensity()*5,c[u]=e$(r[d]),c[u+1]=Math.cos(cr(r[d].getConeAngle())),c[u+2]=Math.cos(cr(r[d].getConeAngle()+r[d].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(r.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",o),e.SSBO.setAllInstancesFromArray("LightDir",a),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=r=>{const n=t.getYInvertedTiledSizeAndOrigin();r.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),r.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},t.bindUBO=r=>{r.activateBindGroup(e.bindGroup)},t.opaquePass=r=>{r?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{if(e.renderable.getTransparent()||e.suppressClear)return;const r=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=ay.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(oS);const o=mf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&e.backgroundTex?.getImageLoaded()){e.clearFSQ.setFragmentShaderTemplate(QW);const o=mf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o);const a=r.getTextureManager().getTextureForVTKTexture(e.backgroundTex,"EnvironmentTexture");if(a.getReady()){const s=a.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([s]),e.backgroundTexLoaded=!0;const c=e.backgroundTex.getInterpolate()?"linear":"nearest";s.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:c,magFilter:c,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=ay.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(oS);const o=mf.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o)}const n=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),Mn(aS,n.normalMatrix),Rp(ug,n.scvc,n.pcsc),Rp(ug,aS,ug),e.clearFSQ.getUBO().setArray("FSQMatrix",ug),e.clearFSQ.getUBO().sendIfNeeded(r),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.convertToOpenGLDepth=r=>e.webgpuCamera.convertToOpenGLDepth(r),t.getYInvertedTiledSizeAndOrigin=()=>{const r=t.getTiledSizeAndOrigin(),n=e._parent.getSizeByReference();return r.lowerLeftV=n[1]-r.vsize-r.lowerLeftV,r},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],i=r[0]-n[0],o=r[1]-n[1],a=e._parent.normalizedDisplayToDisplay(i,o),s=Math.round(a[0]),c=Math.round(a[1]),l=r[2]-n[0],d=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(l,d);let f=Math.round(u[0])-s,h=Math.round(u[1])-c;return f<0&&(f=0),h<0&&(h=0),{usize:f,vsize:h,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=r=>{for(let n=0;n<e.children.length;n++)if((e.children[n].getPropID?e.children[n].getPropID():-1)===r)return e.children[n];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const n$={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function r$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,n$,r),Ir.extend(t,e,r),e.UBO=mf.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=XW.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=Bb.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=It(new Float64Array(16)),e.stabilizedTime={},Jn(e.stabilizedTime,{mtime:0}),ji(t,e,["bindGroup","stabilizedTime"]),Q0(t,e,["stabilizedCenter"]),Ur(t,e,["renderEncoder","selector","suppressClear","UBO"]),t$(t,e)}const i$=zn(r$,"vtkWebGPURenderer");rd("vtkRenderer",i$);function o$(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=r,e.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",e.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",e.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",e.options.magFilter=n.magFilter?n.magFilter:"nearest",e.options.minFilter=n.minFilter?n.minFilter:"nearest",e.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(r,n)=>`@binding(${r}) @group(${n}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const a$={device:null,handle:null,label:null,options:null};function Qb(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,a$,r),Z.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},Z.obj(e.bindGroupTime,{mtime:0}),Z.get(t,e,["bindGroupTime","handle","options"]),Z.setGet(t,e,["bindGroupLayoutEntry","device","label"]),o$(t,e)}const s$=Z.newInstance(Qb);var c$={newInstance:s$,extend:Qb};const{SlicingMode:sS}=H1,l$=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function u$(t,e,r){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${r}`}return"0"}const ao=new Float64Array(16),Va=new Float64Array(16),dg=new Float64Array(16),Ms=new Float64Array(4),Rr=new Float64Array(4);function d$(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const o=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(o.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),o=e.WebGPUImageSlice.getRenderable(),a=o.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||o.getProperty().getMTime()>i){const s=a.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();It(ao),Xn(ao,ao,c);const l=o.getMatrix();Mn(Va,l),Cr(Va,Va),Wt(ao,Va,ao);const d=s.getWorldToIndex();Wt(ao,d,ao),Cr(dg,ao),ed(Va,[.5,.5,.5]),Wt(ao,Va,ao);const u=s.getDimensions();It(Va),es(Va,Va,[1/u[0],1/u[1],1/u[2]]),Wt(ao,Va,ao),e.UBO.setArray("SCTCMatrix",ao);const f=e.currentInput.getExtent(),{ijkMode:h}=e.renderable.getClosestIJKAxis();let g=e.renderable.getSlice();h!==e.renderable.getSlicingMode()&&(g=e.renderable.getSliceAtPosition(g));let p=2,v=0,w=1;h===sS.I?(p=0,v=1,w=2):h===sS.J&&(p=1,v=2,w=0),Ms[p]=g,Ms[v]=f[v*2]-.5,Ms[w]=f[w*2]-.5,Ms[3]=1,$s(Ms,Ms,dg),e.UBO.setArray("Origin",Ms),Rr[p]=g,Rr[v]=f[v*2+1]+.5,Rr[w]=f[w*2]-.5,Rr[3]=1,$s(Rr,Rr,dg),P3(Rr,Rr,Ms),Rr[3]=1,e.UBO.setArray("Axis1",Rr),Rr[p]=g,Rr[v]=f[v*2]-.5,Rr[w]=f[w*2+1]+.5,Rr[3]=1,$s(Rr,Rr,dg),P3(Rr,Rr,Ms),Rr[3]=1,e.UBO.setArray("Axis2",Rr);const m=[1,1,1,1],y=[0,0,0,0],C=e.textureViews[0],x=C.getTexture().getScale(),S=C.getTexture().getNumberOfComponents();for(let T=0;T<S;T++){let _=o.getProperty().getColorWindow(),E=o.getProperty().getColorLevel();const b=o.getProperty().getRGBTransferFunction(0);if(b){const I=b.getRange();_=I[1]-I[0],E=.5*(I[1]+I[0])}m[T]=x/_,y[T]=-E/_+.5}e.UBO.setArray("cScale",m),e.UBO.setArray("cShift",y),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const a=1,s=u$(i,i.getRGBTransferFunction,a);if(e.colorTextureString!==s){e.numRows=a;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const d=new Float32Array(e.rowLength*3);for(let u=0;u<a;u++){l=i.getRGBTransferFunction(u);const f=l.getRange();l.getTable(f[0],f[1],e.rowLength,d,1);for(let h=0;h<e.rowLength;h++){const g=u*e.rowLength*8+h*4;c[g]=255*d[h*3],c[g+1]=255*d[h*3+1],c[g+2]=255*d[h*3+2],c[g+3]=255;for(let p=0;p<4;p++)c[g+e.rowLength*4+p]=c[g+p]}}}else for(let d=0;d<e.rowLength;++d){const u=255*d/(e.rowLength-1);c[d*4]=u,c[d*4+1]=u,c[d*4+2]=u,c[d*4+3]=255;for(let f=0;f<4;f++)c[d*4+e.rowLength*4+f]=c[d*4+f]}{const d={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},f=e.device.getTextureManager().getTexture(d).createView("tfunTexture");e.textureViews[1]=f}e.colorTextureString=s}};const r=t.updateBuffers;t.updateBuffers=()=>{r();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),o=e.textureViews;if(!o[0]||o[0].getTexture()!==i){const c=i.createView("imgTexture");o[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===nl.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=c$.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const n=t.getShaderReplacements();t.replaceShaderPosition=(i,o,a)=>{const s=o.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=uo.substitute(c,"//VTK::Position::Impl",l).result,s.setCode(c)},n.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,o,a)=>{const s=o.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},n.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,o,a)=>{const s=o.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=uo.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=uo.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=uo.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},n.set("replaceShaderImage",t.replaceShaderImage)}const f$={rowLength:1024};function h$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,f$,r),ay.extend(t,e,r),t.setFragmentShaderTemplate(l$),e.UBO=mf.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Jn(e.lutBuildTime,{mtime:0}),e.imagemat=It(new Float64Array(16)),e.imagematinv=It(new Float64Array(16)),e.VBOBuildTime={},Jn(e.VBOBuildTime),d$(t,e)}const g$=zn(h$,"vtkWebGPUImageMapper");rd("vtkImageMapper",g$);function p$(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const n=e.renderable.getMatrix(),i=r.getStabilizedCenterByReference();e.bufferShift[0]=n[3]-i[0],e.bufferShift[1]=n[7]-i[1],e.bufferShift[2]=n[11]-i[2],Mn(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?It(e.keyMatrices.normalMatrix):(fr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Cr(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Mn(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Xn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),Xn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const m$={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function v$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m$,r),Ir.extend(t,e,r),e.keyMatricesTime={},Jn(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Jn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:It(new Float64Array(16))},e.bufferShift=[0,0,0,0],ji(t,e,["propID","keyMatricesTime"]),p$(t,e)}const y$=zn(v$,"vtkWebGPUImageSlice");rd("vtkImageSlice",y$);function w$(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,o)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const a=e.renderable.getMapper().getBounds();if(!a||a.length!==6||a[0]>a[1])return;o.addVolume(t)}};const r=new Float64Array(3),n=new Float64Array(3);t.getBoundingCubePoints=(i,o)=>{const a=e.renderable.getMapper().getInputData();if(!a)return;const s=a.getExtent(),c=e.renderable.getMatrix();let l=0;for(let d=4;d<6;d++){r[2]=s[d];for(let u=2;u<4;u++){r[1]=s[u];for(let f=0;f<2;f++){r[0]=s[f],a.indexToWorld(r,n);let h=o+l*3;i[h++]=c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3],i[h++]=c[4]*n[0]+c[5]*n[1]+c[6]*n[2]+c[7],i[h++]=c[8]*n[0]+c[9]*n[1]+c[10]*n[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const o=e.renderable.getMatrix(),a=i.getStabilizedCenterByReference();Mn(e.keyMatrices.bcwc,o),Xn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const C$={propID:void 0,keyMatricesTime:null};function x$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,C$,r),Ir.extend(t,e,r),e.keyMatricesTime={},Z.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},Z.get(t,e,["propID","keyMatricesTime"]),w$(t,e)}const S$=Z.newInstance(x$,"vtkWebGPUVolume");rd("vtkVolume",S$);function T$(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),o=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),o,i,a,s)}}const _$={};function E$(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_$,r),Ir.extend(t,e,r),T$(t,e)}const b$=Z.newInstance(E$,"vtkWebGPUPixelSpaceCallbackMapper");rd("vtkPixelSpaceCallbackMapper",b$);const Lo={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var e6={StructuredType:Lo};const{StructuredType:Os}=e6;function D$(t){let e=0;for(let r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?Os.EMPTY:e===3?Os.XYZ_GRID:e===2?t[0]===t[1]?Os.YZ_PLANE:t[2]===t[3]?Os.XZ_PLANE:Os.XY_PLANE:e===1?t[0]<t[1]?Os.X_LINE:t[2]<t[3]?Os.Y_LINE:Os.Z_LINE:Os.SINGLE_POINT}var I$={getDataDescriptionFromExtent:D$,...e6};const{vtkErrorMacro:Kl}=Z;function M$(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Kl("instance deleted - cannot call any method"),!1;for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];const a=i.length===1?i[0]:i;if(a.length!==6)return!1;const s=e.extent.some((c,l)=>c!==a[l]);return s&&(e.extent=a.slice(),e.dataDescription=I$.getDataDescriptionFromExtent(e.extent),t.modified()),s},t.setDimensions=function(){let n,i,o;if(e.deleted){Kl("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],i=a[1],o=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2];else{Kl("Bad dimension specification");return}t.setExtent(0,n-1,0,i-1,0,o-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let i=1;for(let o=0;o<3;o++){if(n[o]===0)return 0;n[o]>1&&(i*=n[o]-1)}return i},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const i=t.getDimensions();if(i[0]===0||i[1]===0||i[2]===0)return Kl("Requesting a point from an empty image."),null;const o=new Float64Array(3);switch(e.dataDescription){case Lo.EMPTY:return null;case Lo.SINGLE_POINT:break;case Lo.X_LINE:o[0]=n;break;case Lo.Y_LINE:o[1]=n;break;case Lo.Z_LINE:o[2]=n;break;case Lo.XY_PLANE:o[0]=n%i[0],o[1]=n/i[0];break;case Lo.YZ_PLANE:o[1]=n%i[1],o[2]=n/i[1];break;case Lo.XZ_PLANE:o[0]=n%i[0],o[2]=n/i[0];break;case Lo.XYZ_GRID:o[0]=n%i[0],o[1]=n/i[0]%i[1],o[2]=n/(i[0]*i[1]);break;default:Kl("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(o,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>bn.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>bn.inflate([...e.extent],.5),t.computeTransforms=()=>{ed(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],es(e.indexToWorld,e.indexToWorld,e.spacing),Cr(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Vt(i,n,e.indexToWorld),i},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Vt(i,n,e.worldToIndex),i},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return bn.transformBounds(n,e.indexToWorld,i)},t.worldToIndexBounds=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return bn.transformBounds(n,e.worldToIndex,i)},e._onOriginChanged=t.computeTransforms,e._onDirectionChanged=t.computeTransforms,e._onSpacingChanged=t.computeTransforms,t.computeTransforms(),t.getCenter=()=>bn.getCenter(t.getBounds()),t.computeHistogram=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const o=[0,0,0,0,0,0];t.worldToIndexBounds(n,o);const a=[0,0,0],s=[0,0,0];bn.computeCornerPoints(o,a,s),jv(a,a),jv(s,s);const c=t.getDimensions();Xv(a,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],a),Xv(s,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],s);const l=c[0],d=c[0]*c[1],u=t.getPointData().getScalars().getData();let f=-1/0,h=1/0,g=0,p=0,v=0;for(let C=a[2];C<=s[2];C++)for(let x=a[1];x<=s[1];x++){let S=a[0]+x*l+C*d;for(let T=a[0];T<=s[0];T++){if(!i||i([T,x,C],o)){const _=u[S];_>f&&(f=_),_<h&&(h=_),g+=_*_,p+=_,v+=1}++S}}const w=v>0?p/v:0,m=v?Math.abs(g/v-w*w):0,y=Math.sqrt(m);return{minimum:h,maximum:f,average:w,variance:m,sigma:y,count:v}},t.computeIncrements=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=[];let a=i;for(let s=0;s<3;++s)o[s]=a,a*=n[s*2+1]-n[s*2]+1;return o},t.computeOffsetIndex=n=>{let[i,o,a]=n;const s=t.getExtent(),c=t.getPointData().getScalars().getNumberOfComponents(),l=t.computeIncrements(s,c);return Math.floor((Math.round(i)-s[0])*l[0]+(Math.round(o)-s[2])*l[1]+(Math.round(a)-s[4])*l[2])},t.getOffsetIndexFromWorld=n=>{const i=t.getExtent(),o=t.worldToIndex(n);for(let a=0;a<3;++a)if(o[a]<i[a*2]||o[a]>i[a*2+1])return Kl(`GetScalarPointer: Pixel ${o} is not in memory. Current extent = ${i}`),NaN;return t.computeOffsetIndex(o)},t.getScalarValueFromWorld=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const o=t.getPointData().getScalars().getNumberOfComponents();if(i<0||i>=o)return Kl(`GetScalarPointer: Scalar Component ${i} is not within bounds. Current Scalar numberOfComponents: ${o}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,i)};const r=t.initialize;t.initialize=()=>(t.set({direction:Xo(e.direction),spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Lo.EMPTY}),r())}const O$={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Lo.EMPTY};function t6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,O$,r),nd.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Xo(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),Z.get(t,e,["indexToWorld","worldToIndex"]),Z.setGetArray(t,e,["origin","spacing"],3),Z.setGetArray(t,e,["direction"],9),Z.getArray(t,e,["extent"],6),M$(t,e)}const P$=Z.newInstance(t6,"vtkImageData");var Rh={newInstance:P$,extend:t6};const cS=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],lS=[[0,-1,0],[0,1,0]],R$=[[0,-1,0],[0,1,0],[0,0,-1]],A$=[[0,-1,0],[0,1,0],[0,0,1]];var P0;let o0=(P0=class{static copyMap(e,r){for(const[n,i]of r.rows)e.rows.set(n,structuredClone(i))}constructor(e,r,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const o=(a,s,c)=>{const{start:l,end:d,value:u}=s;for(let f=l;f<d;f++)i[a+f]=u};this.forEach(o)},this.get=i=>{const o=i%this.jMultiple,a=(i-o)/this.jMultiple;return this.getRLE(o,a)?.value??this.defaultValue},this.getRun=(i,o)=>{const a=i+o*this.height;return this.rows.get(a)},this.set=(i,o)=>{if(o===void 0)return;const a=i%this.width,s=(i-a)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:a,end:a+1,value:o}]);return}const l=this.findIndex(c,a),d=c[l],u=c[l-1];if(!d){if(!u||u.value!==o||u.end!==a){c[l]={start:a,end:a+1,value:o};return}u.end++;return}const{start:f,end:h,value:g}=d;if(o===g&&a>=f)return;const p={start:a,end:a+1,value:o},v=a>f,w=v?l+1:l,m=v?d:u;let y=v?c[l+1]:d;if(m?.value===o&&m?.end===a){m.end++,y?.value===o&&y.start===a+1?(m.end=y.end,c.splice(l,1)):y?.start===a&&(y.start++,y.start===y.end&&(c.splice(l,1),y=c[l],y?.start===a+1&&y.value===o&&(m.end=y.end,c.splice(l,1))));return}if(y?.value===o&&y.start===a+1){y.start--,m?.end>a&&(m.end=a,m.end===m.start&&c.splice(l,1));return}if(y?.start===a&&y.end===a+1){y.value=o;const C=c[l+1];C?.start==a+1&&C.value===o&&(c.splice(l+1,1),y.end=C.end);return}a===y?.start&&y.start++,v&&h>a+1?c.splice(w,0,p,{start:a+1,end:m.end,value:m.value}):c.splice(w,0,p),m?.end>a&&(m.end=a)},this.width=e,this.height=r,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*r}toIJK(e){const r=e%this.jMultiple,n=(e-r)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[r,n,i]}toIndex([e,r,n]){return e+n*this.kMultiple+r*this.jMultiple}getRLE(e,r,n=0){const i=this.rows.get(r+n*this.height);if(!i)return;const o=this.findIndex(i,e),a=i[o];return e>=a?.start?a:void 0}has(e){const r=e%this.jMultiple,n=(e-r)/this.jMultiple;return this.getRLE(r,n)?.value!==void 0}delete(e){const r=e%this.width,n=(e-r)/this.width,i=this.rows.get(n);if(!i)return;const o=this.findIndex(i,r),a=i[o];if(!a||a.start>r)return;if(a.end===r+1){a.end--,a.start>=a.end&&(i.splice(o,1),i.length||this.rows.delete(n));return}if(a.start===r){a.start++;return}const s={value:a.value,start:r+1,end:a.end};a.end=r,i.splice(o+1,0,s)}findIndex(e,r){for(let n=0;n<e.length;n++){const{end:i}=e[n];if(r<i)return n}return e.length}forEach(e,r){const n=r?.rowModified;for(const[i,o]of this.rows){const a=n?[...o]:o;for(const s of a)e(i*this.width,s,o)}}forEachRow(e){for(const[r,n]of this.rows)e(r*this.width,n)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,r){r?r.fill(0):r=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:n,height:i,numComps:o}=this;for(let a=0;a<i;a++){const s=this.getRun(a,e);if(s)if(o===1)for(const c of s){const l=a*n,{start:d,end:u,value:f}=c;for(let h=d;h<u;h++)r[l+h]=f}else for(const c of s){const l=a*n*o,{start:d,end:u,value:f}=c;for(let h=d;h<u;h+=o)for(let g=0;g<o;g++)r[l+h+g]=f[g]}}return r}floodFill(e,r,n,i,o){const a=this.getRLE(e,r,n);if(!a)throw new Error(`Initial point ${e},${r},${n} isn't in the RLE`);const s=[[a,r,n]],c=a.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(s,c,i,o)}flood(e,r,n,i){let o=0;const{planar:a=!0,diagonals:s=!0,singlePlane:c=!1}=i||{},l={planar:a,diagonals:s,singlePlane:c};for(;e.length;){const d=e.pop(),[u]=d;if(u.value!==r)continue;u.value=n,o+=u.end-u.start;const f=this.findAdjacents(d,l).filter(h=>h&&h[0].value===r);e.push(...f)}return o}fillFrom(e,r){for(let n=r[2][0];n<=r[2][1];n++)for(let i=r[1][0];i<=r[1][1];i++){let o,a;for(let s=r[0][0];s<=r[0][1];s++){const c=e(s,i,n);if(c===void 0){o=void 0;continue}a||(a=[],this.rows.set(i+n*this.height,a)),o&&o.value!==c&&(o=void 0),o||(o={start:s,end:s,value:c},a.push(o)),o.end++}}}findAdjacents(e,{diagonals:r=!0,planar:n=!0,singlePlane:i=!1}){const[o,a,s,c]=e,{start:l,end:d}=o,u=l>0&&this.getRLE(l-1,a,s),f=d<this.width&&this.getRLE(d,a,s),h=r?[l>0?l-1:l,d<this.width?d+1:d]:[l,d],g=[];u&&g.push([u,a,s]),f&&g.push([f,a,s]);for(const p of c||(i?lS:cS)){const[,v,w]=p,m=v+a,y=w+s;if(m<0||m>=this.height||y<0||y>=this.depth)continue;const C=this.getRun(m,y);if(C)for(const x of C){const S=c||i&&lS||n&&w>0&&A$||n&&w<0&&R$||cS;x.end<=h[0]||x.start>=h[1]||g.push([x,m,y,S])}}return g}},P0.getScalarData=function(e=Uint8ClampedArray){const r=new e(this.frameSize);return this.map.updateScalarData(r),r},P0),sp=class rf{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:r=1024,dimensions:n=3,growSize:i=128}=e,o=r*n;this.growSize=i,this.array=new ArrayBuffer(o*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let r=0;r<this._length;r++)e(this.getPoint(r),r)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;return this.data.subarray(r,r+this._dimensions)}getPointArray(e){const r=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let i=0;i<this._dimensions;i++)r.push(this.data[i+n]);return r}grow(e=1,r=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+r,i=new ArrayBuffer(n*this._dimensions*this._byteSize),o=new Float32Array(i);o.set(this.data),this.data=o,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let r=0;r<e;r++){const n=r*this._dimensions,i=(this._length-1-r)*this._dimensions;for(let o=0;o<this._dimensions;o++){const a=this.data[n+o];this.data[n+o]=this.data[i+o],this.data[i+o]=a}}}getTypedArray(){return this.data}push(e){this.grow(1);const r=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+r]=e[n];this._length++}map(e){const r=[];for(let n=0;n<this._length;n++)r.push(e(this.getPoint(n),n));return r}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:r,y:n,z:i}=e;return this.forEach(o=>{r.push(o[0]),n.push(o[1]),i&&i.push(o[2])}),e}static fromXYZ({x:e,y:r,z:n}){const i=rf.create3(e.length);let o=0;for(let a=0;a<e.length;a++)i.data[o++]=e[a],i.data[o++]=r[a],i.data[o++]=n?n[a]:0;return i._length=e.length,i}subselect(e=10,r=0){const n=new rf({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const o=(r+Math.floor(this.length*i/e))%this.length;n.push(this.getPoint(o))}return n}static create3(e=128,r){e=Math.max(e,r?.length||0);const n=new rf({initialSize:e,dimensions:3});return r&&r.forEach(i=>n.push(i)),n}static create2(e=128){return new rf({initialSize:e,dimensions:2})}};function n6(t){const e=Ie(),r=t.getDimensions(),n=sp.create3(r[0]),i=sp.create3(r[1]),o=sp.create3(r[2]),a=t.getDirection(),s=a.slice(0,3),c=a.slice(3,6),l=a.slice(6,9),d=t.getSpacing(),[u,f,h]=d,g=t.indexToWorld([0,0,0]),p=mt(s[0]*u,s[1]*u,s[2]*u),v=mt(c[0]*f,c[1]*f,c[2]*f),w=mt(l[0]*h,l[1]*h,l[2]*h),m=Ie();for(let S=0;S<r[0];S++)n.push(hr(m,g,xr(m,p,S)));for(let S=0;S<r[1];S++)i.push(xr(m,v,S));for(let S=0;S<r[2];S++)o.push(xr(m,w,S));const y=n.getTypedArray(),C=i.getTypedArray(),x=o.getTypedArray();return(S,T=e)=>{const[_,E,D]=S,b=_*3,I=E*3,O=D*3;return T[0]=y[b]+C[I]+x[O],T[1]=y[b+1]+C[I+1]+x[O+1],T[2]=y[b+2]+C[I+2]+x[O+2],T}}function pw(t,e){const{pointInShapeFn:r,callback:n,boundsIJK:i,returnPoints:o=!1}=e;let a;if(t.getScalarData)a=t.getScalarData();else{const u=t.getPointData().getScalars();if(u)a=u.getData();else{const{voxelManager:f}=t.get("voxelManager")||{};f&&(a=f.getCompleteScalarDataArray())}}const s=t.getDimensions(),c=[[0,s[0]],[0,s[1]],[0,s[2]]],d=L$({imageData:t,bounds:i||c,scalarData:a,pointInShapeFn:r,callback:n});return o?d:void 0}function L$({imageData:t,bounds:e,scalarData:r,pointInShapeFn:n,callback:i}){const[[o,a],[s,c],[l,d]]=e,{numComps:u}=t,f=t.getDimensions(),h=n6(t),g=[0,0,0],p=u||r.length/f[2]/f[1]/f[0],v=f[0]*p,w=f[1]*v,m=[];for(let y=l;y<=d;y++){g[2]=y;const C=y*w;for(let x=s;x<=c;x++){g[1]=x;const S=C+x*v;for(let T=o;T<=a;T++){g[0]=T;const _=h(g);if(n(_,g)){const E=S+T*p;let D;p>2?D=[r[E],r[E+1],r[E+2]]:D=r[E],m.push({value:D,index:E,pointIJK:g,pointLPS:_.slice()}),i({value:D,index:E,pointIJK:g,pointLPS:_})}}}}return m}function N$({voxelManager:t,bounds:e,imageData:r,pointInShapeFn:n,callback:i,returnPoints:o}){const[[a,s],[c,l],[d,u]]=e,f=n6(r),h=[0,0,0],g=[];for(let p=d;p<=u;p++){h[2]=p;for(let v=c;v<=l;v++){h[1]=v;for(let w=a;w<=s;w++){h[0]=w;const m=f(h);if(n(m,h)){const y=t.toIndex(h),C=t.getAtIndex(y);o&&g.push({value:C,index:y,pointIJK:[...h],pointLPS:m.slice()}),i?.({value:C,index:y,pointIJK:h,pointLPS:m})}}}}return g}const V$=5*1024;let ns=class Ar{get id(){return this._id}constructor(e,r){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(n,i,o)=>{const a=this.toIndex([n,i,o]);return this._get(a)},this.setAtIJK=(n,i,o,a)=>{const s=this.toIndex([n,i,o]),c=this._set(s,a);return c!==!1&&(this.modifiedSlices.add(o),Ar.addBounds(this.boundsIJK,[n,i,o])),c},this.getAtIJKPoint=([n,i,o])=>this.getAtIJK(n,i,o),this.setAtIJKPoint=([n,i,o],a)=>{this.setAtIJK(n,i,o,a)},this.getAtIndex=n=>this._get(n),this.setAtIndex=(n,i)=>{const o=this._set(n,i);if(o!==!1){const a=this.toIJK(n);this.modifiedSlices.add(a[2]),Ar.addBounds(this.boundsIJK,a)}return o},this.getMiddleSliceData=()=>{const n=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:n,slicePlane:2})},this.forEach=(n,i={})=>{const o=i.boundsIJK||this.getBoundsIJK(),a=i.isInObject||this.isInObject||(()=>!0),s=i.returnPoints||!1,c=i.imageData,l=Math.min(o[0][0],o[0][1]),d=Math.max(o[0][0],o[0][1]),u=Math.min(o[1][0],o[1][1]),f=Math.max(o[1][0],o[1][1]),h=Math.min(o[2][0],o[2][1]),g=Math.max(o[2][0],o[2][1]),p=[];if(c)return N$({voxelManager:this,imageData:i.imageData,bounds:[[l,d],[u,f],[h,g]],pointInShapeFn:a,callback:n,returnPoints:s});if(this.map){if(this.map instanceof o0)return this.rleForEach(n,i);for(const v of this.map.keys()){const w=this.toIJK(v);if(!a(null,w))continue;const m=this._get(v);s&&p.push({value:m,index:v,pointIJK:w,pointLPS:null}),n({value:m,index:v,pointIJK:w,pointLPS:null})}return p}else{for(let v=h;v<=g;v++){const w=v*this.frameSize;for(let m=u;m<=f;m++){const y=w+m*this.width;for(let C=l,x=y+C;C<=d;C++,x++){const S=this.getAtIndex(x),T=[C,m,v];a(null,T)&&(s&&p.push({value:S,index:x,pointIJK:T,pointLPS:null}),n({value:S,index:x,pointIJK:[C,m,v],pointLPS:null}))}}}return p}},this.getSliceData=({sliceIndex:n,slicePlane:i})=>{const[o,a,s]=this.dimensions,c=o*a,l=n*c;let d;const u=this.getConstructor();function f(g){return typeof g=="function"}if(!f(u))return new Uint8Array(0);let h;switch(i){case 0:d=a*s,h=new u(d);for(let g=0;g<a;g++)for(let p=0;p<s;p++){const v=n+g*o+p*c;this.setSliceDataValue(h,g*s+p,this._get(v))}break;case 1:d=o*s,h=new u(d);for(let g=0;g<o;g++)for(let p=0;p<s;p++){const v=g+n*o+p*c;this.setSliceDataValue(h,g+p*o,this._get(v))}break;case 2:d=o*a,h=new u(d);for(let g=0;g<d;g++)this.setSliceDataValue(h,g,this._get(l+g));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=r._get,this._set=r._set,this._id=r._id||"",this._getConstructor=r._getConstructor,this.numberOfComponents=r.numberOfComponents||1,this.scalarData=r.scalarData,this._getScalarData=r._getScalarData,this._updateScalarData=r._updateScalarData}getMinMax(){let e,r;const n=({value:i})=>{const o=Array.isArray(i);if(e===void 0&&(e=o?[...i]:i,r=o?[...i]:i),o)for(let a=0;a<i.length;a++)e[a]=Math.min(e[a],i[a]),r[a]=Math.max(r[a],i[a]);else e=Math.min(e,i),r=Math.max(r,i)};return this.forEach(n,{boundsIJK:this.getDefaultBounds()}),{min:e,max:r}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,r){const n=r?.boundsIJK||this.getBoundsIJK(),{isWithinObject:i}=r||{},o=this.map;if(!o){console.warn("No map found, you need to use a map voxel manager to use rleForEach");return}o.defaultValue=void 0;for(let a=n[2][0];a<=n[2][1];a++)for(let s=n[1][0];s<=n[1][1];s++){const c=o.getRun(s,a);if(c)for(const l of c){const{start:d,end:u,value:f}=l,h=this.toIndex([0,s,a]);for(let g=d;g<u;g++){const p={value:f,index:h+g,pointIJK:[g,s,a]};i?.(p)!==!1&&e(p)}}}}getScalarData(e=!1){if(this.scalarData)return this._updateScalarData?.(this.scalarData),this.scalarData;if(this._getScalarData){const r=this._getScalarData();return e&&console.log("Not transient, should store value",r),r}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clearBounds(){this.boundsIJK.map(e=>{e[0]=1/0,e[1]=-1/0})}clear(){this.map?.clear(),this.clearBounds(),this.modifiedSlices.clear(),this.points?.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}setBounds(e){this.boundsIJK=e}static addBounds(e,r){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(r[0],e[0][0]),e[0][1]=Math.max(r[0],e[0][1]),e[1][0]=Math.min(r[1],e[1][0]),e[1][1]=Math.max(r[1],e[1][1]),e[2][0]=Math.min(r[2],e[2][0]),e[2][1]=Math.max(r[2],e[2][1])}addPoint(e){const r=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(r)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,r,n){if(Array.isArray(n))for(let i=0;i<n.length;i++)e[r*n.length+i]=this.toNumber(n[i]);else e[r]=this.toNumber(n)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n=3,id:i}){const o=new Ar(e,{_get:a=>(a*=n,[r[a++],r[a++],r[a++]]),_id:i||"_createRGBScalarVolumeVoxelManager",_set:(a,s)=>{a*=3;const c=!Et(r[a],s);return r[a++]=s[0],r[a++]=s[1],r[a++]=s[2],c},numberOfComponents:n,scalarData:r});return o.clear=()=>{r.fill(0)},o}static createImageVolumeVoxelManager({dimensions:e,imageIds:r,numberOfComponents:n=1,id:i}){const o=e[0]*e[1];function a(u){const f=Math.floor(u/o);if(f<0||f>=e[2])return{};const h=r[f];if(!h)return console.warn(`ImageId not found for sliceIndex: ${f}`),{pixelData:null,pixelIndex:null};const g=Ne.getImage(h);if(!g)return console.warn(`Image not found for imageId: ${h}`),{pixelData:null,pixelIndex:null};const p=g.voxelManager,v=u%o;return{voxelManager:p,pixelIndex:v}}function s(u){const{voxelManager:f,pixelIndex:h}=a(u);return!f||h===null?null:f.getAtIndex(h)}function c(u,f){const{voxelManager:h,pixelIndex:g}=a(u);if(!h||g===null)return!1;const p=h.getAtIndex(g),v=!Et(f,p);return v&&(h.setAtIndex(g,f),!0)}const l=()=>{const{voxelManager:u,pixelIndex:f}=a(0);return!u||f===null?null:u.getConstructor()},d=new Ar(e,{_get:s,_set:c,numberOfComponents:n,_getConstructor:l,_id:i||"createImageVolumeVoxelManager"});return d.getMiddleSliceData=()=>{const u=Math.floor(e[2]/2);return d.getSliceData({sliceIndex:u,slicePlane:2})},d.clear=()=>{for(const u of r)Ne.getImage(u).voxelManager.clear()},d.getRange=()=>{let u=1/0,f=-1/0;for(const h of r){const g=Ne.getImage(h);g&&(g.minPixelValue<u&&(u=g.minPixelValue),g.maxPixelValue>f&&(f=g.maxPixelValue))}return u===1/0&&f===-1/0?[0,0]:[u,f]},d._getScalarDataLength=()=>{const{voxelManager:u,pixelIndex:f}=a(0);return!u||f===null?0:u.getScalarDataLength()*e[2]},d.getCompleteScalarDataArray=()=>{const u=d._getConstructor();if(!u)return new Uint8Array(0);const f=d.getScalarDataLength(),h=new u(f),g=e[0]*e[1]*n;for(let p=0;p<e[2];p++){const{voxelManager:v,pixelIndex:w}=a(p*g/n);if(v&&w!==null){const m=p*g,y=v.getScalarData();if(n===1)h.set(y,m);else for(let C=0;C<y.length;C+=n)for(let x=0;x<n;x++)h[m+C+x]=y[C+x]}}return h},d.setCompleteScalarDataArray=u=>{const f=e[0]*e[1]*n,h=d._getConstructor();let g=1/0,p=-1/0;for(let v=0;v<e[2];v++){const{voxelManager:w}=a(v*f/n);if(w&&h){const m=v*f,y=m+f,C=new h(f);if(C.set(u.subarray(m,y)),w.scalarData)w.scalarData.set(C),w.modifiedSlices.add(v);else for(let T=0;T<f;T++)w.setAtIndex(T,C[T]);for(let T=0;T<C.length;T++){const _=C[T];g=Math.min(g,_),p=Math.max(p,_)}const x=r[v],S=Ne.getImage(x);S&&(S.minPixelValue=g,S.maxPixelValue=p)}}for(let v=0;v<e[2];v++)d.modifiedSlices.add(v);d.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},d}static createScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n,id:i}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!n&&(n=r.length/e[0]/e[1]/e[2],n>4||n<1||n===2))throw new Error(`Number of components ${n} must be 1, 3 or 4`);return n>1?Ar._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n,id:i}):Ar._createNumberVolumeVoxelManager({dimensions:e,scalarData:r,id:i})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:r,dimensionGroupNumber:n=1,timePoint:i=0,numberOfComponents:o=1,id:a}){let s=0;if(n!==void 0?s=n-1:i!==void 0&&(console.warn("Warning: timePoint parameter is deprecated. Please use dimensionGroupNumber instead. timePoint is zero-based while dimensionGroupNumber starts at 1."),s=i),!o){const d=Ne.getImage(e[0][0]);if(!d)throw new Error("Unable to determine number of components: No image found");if(o=d.getPixelData().length/(r[0]*r[1]),o>4||o<1||o===2)throw new Error(`Number of components ${o} must be 1, 3 or 4`)}const c=e.map(d=>Ar.createImageVolumeVoxelManager({dimensions:r,imageIds:d,numberOfComponents:o,id:a})),l=new Ar(r,{_get:d=>c[s]._get(d),_set:(d,u)=>c[s]._set(d,u),numberOfComponents:o,_id:a||"createScalarDynamicVolumeVoxelManager"});return l.getScalarDataLength=()=>c[s].getScalarDataLength(),l.getConstructor=()=>c[s].getConstructor(),l.getRange=()=>c[s].getRange(),l.getMiddleSliceData=()=>c[s].getMiddleSliceData(),l.setTimePoint=d=>{console.warn("Warning: setTimePoint is deprecated. Please use setDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.setDimensionGroupNumber(d+1)},l.setDimensionGroupNumber=d=>{s=d-1,l._get=u=>c[s]._get(u),l._set=(u,f)=>c[s]._set(u,f)},l.getAtIndexAndTimePoint=(d,u)=>(console.warn("Warning: getAtIndexAndTimePoint is deprecated. Please use getAtIndexAndDimensionGroup instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.getAtIndexAndDimensionGroup(d,u+1)),l.getAtIndexAndDimensionGroup=(d,u)=>c[u-1]._get(d),l.getTimePointScalarData=d=>(console.warn("Warning: getTimePointScalarData is deprecated. Please use getDimensionGroupScalarData instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),l.getDimensionGroupScalarData(d+1)),l.getDimensionGroupScalarData=d=>c[d-1].getCompleteScalarDataArray(),l.getCurrentTimePointScalarData=()=>(console.warn("Warning: getCurrentTimePointScalarData is deprecated. Please use getCurrentDimensionGroupScalarData instead."),l.getCurrentDimensionGroupScalarData()),l.getCurrentDimensionGroupScalarData=()=>c[s].getCompleteScalarDataArray(),l.getCurrentTimePoint=()=>(console.warn("Warning: getCurrentTimePoint is deprecated. Please use getCurrentDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),s),l.getCurrentDimensionGroupNumber=()=>s+1,l}static createImageVoxelManager({width:e,height:r,scalarData:n,numberOfComponents:i=1,id:o}){const a=[e,r,1];if(!i&&(i=n.length/e/r,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?Ar._createRGBScalarVolumeVoxelManager({dimensions:a,scalarData:n,numberOfComponents:i,id:o}):Ar._createNumberVolumeVoxelManager({dimensions:a,scalarData:n,id:o})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:r,id:n}){const i=new Ar(e,{_get:o=>r[o],_set:(o,a)=>{const s=r[o]!==a;return r[o]=a,s},_getConstructor:()=>r.constructor,_id:n||"_createNumberVolumeVoxelManager"});return i.scalarData=r,i.clear=()=>{i.scalarData.fill(0)},i.getMiddleSliceData=()=>{const o=Math.floor(e[2]/2);return i.getSliceData({sliceIndex:o,slicePlane:2})},i}static createMapVoxelManager({dimension:e,id:r}){const n=new Map,i=new Ar(e,{_get:n.get.bind(n),_set:(o,a)=>n.set(o,a)&&!0,_id:r||"createMapVoxelManager"});return i.map=n,i}static createHistoryVoxelManager(e,r){const n=new Map,{dimensions:i}=e,o=new Ar(i,{_get:a=>n.get(a),_set:function(a,s){if(n.has(a))s===n.get(a)&&n.delete(a);else{const c=this.sourceVoxelManager.getAtIndex(a);if(c===s)return!1;n.set(a,c)}this.sourceVoxelManager.setAtIndex(a,s)},_id:r||"createHistoryVoxelManager"});return o.map=n,o.scalarData=e.scalarData,o.sourceVoxelManager=e,o}static createRLEHistoryVoxelManager(e,r){const{dimensions:n}=e,i=new o0(n[0],n[1],n[2]),o=new Ar(n,{_get:a=>i.get(a),_set:function(a,s){const c=i.get(a);if(c===void 0){const l=this.sourceVoxelManager.getAtIndex(a);if(l===s||l===void 0&&s===0||s===null)return!1;i.set(a,l??0)}else(s===c||s===null)&&(i.delete(a),s=c);this.sourceVoxelManager.setAtIndex(a,s)},_getScalarData:o0.getScalarData,_updateScalarData:a=>(i.updateScalarData(a),a),_id:r||"createRLEHistoryVoxelManager"});return o.map=i,o.sourceVoxelManager=e,o}static createLazyVoxelManager({dimensions:e,planeFactory:r,id:n}){const i=new Map,[o,a]=e,s=o*a,c=new Ar(e,{_get:l=>i.get(Math.floor(l/s))[l%s],_set:(l,d)=>{const u=Math.floor(l/s);let f=i.get(u);return f||(f=r(o,a),i.set(u,f)),f[l%s]=d,!0},_id:n||"createLazyVoxelManager"});return c.map=i,c}static createRLEVolumeVoxelManager({dimensions:e,id:r}){const[n,i,o]=e,a=new o0(n,i,o),s=new Ar(e,{_get:c=>a.get(c),_set:(c,l)=>(a.set(c,l),!0),_getScalarData:o0.getScalarData,_updateScalarData:c=>(a.updateScalarData(c),c),_id:r||"createRLEVolumeVoxelManager"});return s.map=a,s.getPixelData=a.getPixelData.bind(a),s}static createRLEImageVoxelManager({dimensions:e,id:r}){const[n,i]=e;return Ar.createRLEVolumeVoxelManager({dimensions:[n,i,1],id:r})}static addInstanceToImage(e){const{width:r,height:n}=e,i=e.voxelManager.getScalarData();if(i.length>=r*n){e.voxelManager=Ar.createScalarVolumeVoxelManager({dimensions:[r,n,1],scalarData:i});return}e.voxelManager=Ar.createRLEVolumeVoxelManager({dimensions:[r,n,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=V$}};const k$="WebGL",Wp=Object.create(null);function r6(t,e){Wp[t]=e}function F$(){return Object.keys(Wp)}function i6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Wp[t]&&Wp[t](e)}function U$(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=r=>{t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=r=>{e.renderers=e.renderers.filter(n=>n!==r),t.modified()},t.hasRenderer=r=>e.renderers.indexOf(r)!==-1,t.newAPISpecificView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i6(r||e.defaultViewAPI,n)},t.addView=r=>{t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=r=>{e._views=e._views.filter(n=>n!==r),t.modified()},t.hasView=r=>e._views.indexOf(r)!==-1,t.preRender=()=>{e.renderers.forEach(r=>{r.isActiveCameraCreated()||r.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(r=>r.traverseAllPasses())},t.getStatistics=()=>{const r={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(n=>{n.getGraphicsMemoryInfo&&(r.gpuMemoryMB+=n.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(n=>{const i=n.getViewProps(),o=e._views[0].getViewNodeFor(n);i.forEach(a=>{if(a.getVisibility()){r.propCount+=1;const s=a.getMapper&&a.getMapper();if(s&&s.getPrimitiveCount){const c=o.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(r.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=s.getPrimitiveCount();Object.keys(l).forEach(d=>{r[d]||(r[d]=0),r[d]+=l[d]})}}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`
`),r},t.captureImages=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Z.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(r,n):void 0).filter(i=>!!i)},t.addRenderWindow=r=>e.childRenderWindows.includes(r)?!1:(e.childRenderWindows.push(r),t.modified(),!0),t.removeRenderWindow=r=>{const n=e.childRenderWindows.findIndex(i=>i===r);return n<0?!1:(e.childRenderWindows.splice(n,1),t.modified(),!0)}}const B$={defaultViewAPI:k$,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function o6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,B$,r),Z.obj(t,e),Z.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),Z.get(t,e,["neverRendered"]),Z.getArray(t,e,["renderers","childRenderWindows"]),Z.moveToProtected(t,e,["views"]),Z.event(t,e,"completion"),U$(t,e)}const G$=Z.newInstance(o6,"vtkRenderWindow");var W$={newInstance:G$,extend:o6,registerViewConstructor:r6,listViewAPIs:F$,newAPISpecificView:i6};function $$(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=r=>{e.currentOperation=r,e.currentTraverseOperation=`traverse${Z.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),r.traverse(t)}),e.delegates.forEach(i=>{i.traverse(r,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),r.traverse(t)}))}}const z$={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function a6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,z$,r),Z.obj(t,e),Z.get(t,e,["currentOperation"]),Z.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),Z.moveToProtected(t,e,["currentParent"]),$$(t,e)}const j$=Z.newInstance(a6,"vtkRenderPass");var X1={newInstance:j$,extend:a6};const{Representation:H$}=Ph,{vtkErrorMacro:uS}=Z;function X$(t){const e=Re.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const K$=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function q$(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),o=Ot.newInstance({numberOfComponents:3,values:r});o.setName("points");const a=Ot.newInstance({numberOfComponents:2,values:n});a.setName("tcoords");const s=Ot.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",H$.SURFACE,{points:o,tcoords:a,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=r=>{const n=r.getSize(),i=r.getContext();e.framebuffer=Mh.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.create(...n),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=$n.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw({width:n[0],height:n[1],numComps:4,dataType:"Float32Array",data:null}),e.translucentRTexture=$n.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw({width:n[0],height:n[1],numComps:1,dataType:"Float32Array",data:null}),e.translucentZTexture=$n.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw({width:n[0],height:n[1],dataType:"Float32Array",data:null}),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=r=>{e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),K$,"")},t.createVBO=r=>{const n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||uS("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||uS("Error setting vertexDC in copy shader VAO.")},t.traverse=(r,n,i)=>{if(e.deleted)return;const o=r.getSize(),a=r.getContext();if(e._supported=!1,n.getSelector()||!a||!r.getWebgl2()||!a.getExtension("EXT_color_buffer_half_float")&&!a.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{const c=e.framebuffer.getSize();c===null||c[0]!==o[0]||c[1]!==o[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}a.drawBuffers([a.COLOR_ATTACHMENT0]),a.clearBufferfv(a.COLOR,0,[0,0,0,0]),a.clearBufferfv(a.DEPTH,0,[1]),a.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),n.traverse(i)),a.colorMask(!0,!0,!0,!0),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1]),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),a.clearBufferfv(a.COLOR,0,[0,0,0,1]),a.clearBufferfv(a.COLOR,1,[0,0,0,0]),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFuncSeparate(a.ONE,a.ONE,a.ZERO,a.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),a.drawBuffers([a.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=$1.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.depthMask(!1),a.depthFunc(a.ALWAYS),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),a.depthMask(!0),a.depthFunc(a.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=n.getTiledSizeAndOrigin();a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?X$:null,t.releaseGraphicsResources=r=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}const Y$={framebuffer:null,copyShader:null,tris:null};function s6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y$,r),X1.extend(t,e,r),e.VBOBuildTime={},Z.obj(e.VBOBuildTime,{mtime:0}),e.tris=lc.newInstance(),Z.get(t,e,["framebuffer"]),q$(t,e)}const J$=Z.newInstance(s6,"vtkOpenGLOrderIndependentTranslucentPass");var Z$={newInstance:J$,extend:s6};function Q$(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);const i=r.getRenderable().getNumberOfLayers(),o=r.getRenderable().getRenderersByReference();for(let a=0;a<i;a++)for(let s=0;s<o.length;s++){const c=o[s],l=r.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===a){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const d=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Mh.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==d[0]||u[1]!==d[1])&&(e.framebuffer.create(d[0],d[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=Z$.newInstance()),e.translucentPass.traverse(r,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const ez={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function c6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ez,r),X1.extend(t,e,r),Z.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),Q$(t,e)}const tz=Z.newInstance(c6,"vtkForwardPass");var mw={newInstance:tz,extend:c6};const Fi={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var l6={PassTypes:Fi};const{FieldAssociations:nz}=nd;function rz(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(r,n,i,o,a)=>{},t.selectAsync=async(r,n,i,o,a)=>{const s=await t.getSourceDataAsync(r,n,i,o,a);return s?s.generateSelection(n,i,o,a):[]}}const iz={fieldAssociation:nz.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function u6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iz,r),Z.obj(t,e),Z.setGet(t,e,["fieldAssociation","captureZValues"]),rz(t,e)}const oz=Z.newInstance(u6,"vtkHardwareSelector");var az={newInstance:oz,extend:u6};const sz={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},cz={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var lz={SelectionContent:sz,SelectionField:cz};function uz(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const dz={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function d6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dz,r),Z.obj(t,e),e.properties={},Z.setGet(t,e,["contentType","fieldType","properties","selectionList"]),uz(t,e)}const fz=Z.newInstance(d6,"vtkSelectionNode");var f6={newInstance:fz,extend:d6,...lz};const{PassTypes:_r}=l6,{SelectionContent:hz,SelectionField:dS}=f6,{FieldAssociations:vf}=nd,{vtkErrorMacro:h6}=Z,Kc=1;function g6(t){return`${t.propID} ${t.compositeID}`}function p6(t,e,r,n){if(!r)return 0;const i=(e*(n[2]-n[0]+1)+t)*4;return r[i+3]}function zs(t,e,r,n){if(!r)return 0;const i=(e*(n[2]-n[0]+1)+t)*4,o=r[i],a=r[i+1];return(r[i+2]*256+a)*256+o}function m6(t,e){let r=e;return r<<=24,r|=t,r}function gz(t,e,r,n){{if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],o=zs(i[0],i[1],t.pixBuffer[_r.ACTOR_PASS],t.area);if(o<=0||o-Kc>=t.props.length)return null;const a={};a.valid=!0,a.propID=o-Kc,a.prop=t.props[a.propID];let s=zs(i[0],i[1],t.pixBuffer[_r.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),a.compositeID=s-Kc,t.captureZValues){const d=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;a.zValue=(256*t.zBuffer[d]+t.zBuffer[d+1])/65535,a.displayPosition=e}if(t.pixBuffer[_r.ID_LOW24]&&p6(i[0],i[1],t.pixBuffer[_r.ID_LOW24],t.area)===0)return a;const c=zs(i[0],i[1],t.pixBuffer[_r.ID_LOW24],t.area),l=zs(i[0],i[1],t.pixBuffer[_r.ID_HIGH24],t.area);return a.attributeID=m6(c,l),a}}function v6(t,e,r,n,i){const o=[];let a=0;return e.forEach((s,c)=>{const l=f6.newInstance();switch(l.setContentType(hz.INDICES),t){case vf.FIELD_ASSOCIATION_CELLS:l.setFieldType(dS.CELL);break;case vf.FIELD_ASSOCIATION_POINTS:l.setFieldType(dS.POINT);break;default:h6("Unknown field association")}l.getProperties().propID=s.info.propID,l.getProperties().prop=s.info.prop,l.getProperties().compositeID=s.info.compositeID,l.getProperties().attributeID=s.info.attributeID,l.getProperties().pixelCount=s.pixelCount,r&&(l.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],l.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,n)),l.setSelectionList(s.attributeIDs),o[a]=l,a++}),o}function pz(t,e,r,n,i){const o=Math.floor(e),a=Math.floor(r),s=Math.floor(n),c=Math.floor(i),l=new Map,d=[0,0];for(let u=a;u<=c;u++)for(let f=o;f<=s;f++){const g=gz(t,[f,u],0,d);if(g&&g.valid){const p=g6(g);if(!l.has(p))l.set(p,{info:g,pixelCount:1,attributeIDs:[g.attributeID]});else{const v=l.get(p);v.pixelCount++,t.captureZValues&&g.zValue<v.info.zValue&&(v.info=g),v.attributeIDs.indexOf(g.attributeID)===-1&&v.attributeIDs.push(g.attributeID)}}}return v6(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function mz(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Mh.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==n[0]||i[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===vf.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),o=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),o&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=()=>{let n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=async(n,i,o,a,s)=>{if(e._renderer=n,i===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(i,o,a,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:n,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,d=new Array(l),u=0;u<l;u++)d[u]=arguments[u];return pz(c,...d)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return h6("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const n=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=_r.MIN_KNOWN_PASS;e.currentPass<=_r.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===_r.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(o=>{e.currentPass=o,t.processPixelBuffers()}),e.currentPass=_r.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((n,i)=>{t.isPropHit(i)&&n.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=n=>{if(n===_r.ID_HIGH24){if(e.fieldAssociation===vf.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===vf.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=n=>{if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(i),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===_r.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const o=i[0].getFramebuffer();o.saveCurrentBindingsAndBuffers(),o.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),o.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=n=>{let i=0;for(let o=0;o<=e.area[3]-e.area[1];o++)for(let a=0;a<=e.area[2]-e.area[0];a++){let s=zs(a,o,n,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=n=>{e.currentPass===_r.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Kc),e.props.push(n))},t.renderCompositeIndex=n=>{e.currentPass===_r.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+Kc)},t.renderAttributeId=n=>{n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=n=>Z.enumToString(_r,n),t.isPropHit=n=>!!e.hitProps[n],t.setPropColorValueFromInt=n=>{e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=(n,i,o)=>{const a=i<0?0:i;if(console.log("getPixelInformation called",a),a===0){if(o[0]=n[0],o[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;console.log(n),console.log(e.area);const d=[n[0]-e.area[0],n[1]-e.area[1]];console.log("adjusted displayPosition",d);const u=zs(d[0],d[1],e.pixBuffer[_r.ACTOR_PASS],e.area);if(console.log("actorid",u),u<=0||u-Kc>=e.props.length)return null;const f={};f.valid=!0,f.propID=u-Kc,f.prop=e.props[f.propID];let h=zs(d[0],d[1],e.pixBuffer[_r.COMPOSITE_INDEX_PASS],e.area);if((h<0||h>16777215)&&(h=0),f.compositeID=h-Kc,e.captureZValues){const v=(d[1]*(e.area[2]-e.area[0]+1)+d[0])*4;f.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,f.displayPosition=n}if(e.pixBuffer[_r.ID_LOW24]&&p6(d[0],d[1],e.pixBuffer[_r.ID_LOW24],e.area)===0)return f;const g=zs(d[0],d[1],e.pixBuffer[_r.ID_LOW24],e.area),p=zs(d[0],d[1],e.pixBuffer[_r.ID_HIGH24],e.area);return f.attributeID=m6(g,p),f}const s=[n[0],n[1]],c=[0,0];let l=t.getPixelInformation(n,0,o);if(l&&l.valid)return l;for(let d=1;d<a;++d){for(let u=s[1]>d?s[1]-d:0;u<=s[1]+d;++u)if(c[1]=u,s[0]>=d&&(c[0]=s[0]-d,l=t.getPixelInformation(c,0,o),l&&l.valid)||(c[0]=s[0]+d,l=t.getPixelInformation(c,0,o),l&&l.valid))return l;for(let u=s[0]>=d?s[0]-(d-1):0;u<=s[0]+(d-1);++u)if(c[0]=u,s[1]>=d&&(c[1]=s[1]-d,l=t.getPixelInformation(c,0,o),l&&l.valid)||(c[1]=s[1]+d,l=t.getPixelInformation(c,0,o),l&&l.valid))return l}return o[0]=n[0],o[1]=n[1],null},t.generateSelection=(n,i,o,a)=>{const s=Math.floor(n),c=Math.floor(i),l=Math.floor(o),d=Math.floor(a),u=new Map,f=[0,0];for(let h=c;h<=d;h++)for(let g=s;g<=l;g++){const p=[g,h],v=t.getPixelInformation(p,0,f);if(v&&v.valid){const w=g6(v);if(!u.has(w))u.set(w,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{const m=u.get(w);m.pixelCount++,e.captureZValues&&v.zValue<m.info.zValue&&(m.info=v),m.attributeIDs.indexOf(v.attributeID)===-1&&m.attributeIDs.push(v.attributeID)}}}return v6(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=n=>e.rawPixBuffer[n],t.getPixelBuffer=n=>e.pixBuffer[n],t.attach=(n,i)=>{e._openGLRenderWindow=n,e._renderer=i};const r=t.setArea;t.setArea=function(){return r(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const vz={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function y6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vz,r),az.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),Z.setGetArray(t,e,["area"],4),Z.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),Z.setGetArray(t,e,["propColorValue"],3),Z.moveToProtected(t,e,["renderer","openGLRenderWindow"]),Z.event(t,e,"event"),mz(t,e)}const yz=Z.newInstance(y6,"vtkOpenGLHardwareSelector");var vw={newInstance:yz,extend:y6,...l6},y2={exports:{}},fS;function wz(){return fS||(fS=1,(function(t,e){(function(r){t.exports=r()})(function(r){var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(w,m){var y=w[0],C=w[1],x=w[2],S=w[3];y+=(C&x|~C&S)+m[0]-680876936|0,y=(y<<7|y>>>25)+C|0,S+=(y&C|~y&x)+m[1]-389564586|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&C)+m[2]+606105819|0,x=(x<<17|x>>>15)+S|0,C+=(x&S|~x&y)+m[3]-1044525330|0,C=(C<<22|C>>>10)+x|0,y+=(C&x|~C&S)+m[4]-176418897|0,y=(y<<7|y>>>25)+C|0,S+=(y&C|~y&x)+m[5]+1200080426|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&C)+m[6]-1473231341|0,x=(x<<17|x>>>15)+S|0,C+=(x&S|~x&y)+m[7]-45705983|0,C=(C<<22|C>>>10)+x|0,y+=(C&x|~C&S)+m[8]+1770035416|0,y=(y<<7|y>>>25)+C|0,S+=(y&C|~y&x)+m[9]-1958414417|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&C)+m[10]-42063|0,x=(x<<17|x>>>15)+S|0,C+=(x&S|~x&y)+m[11]-1990404162|0,C=(C<<22|C>>>10)+x|0,y+=(C&x|~C&S)+m[12]+1804603682|0,y=(y<<7|y>>>25)+C|0,S+=(y&C|~y&x)+m[13]-40341101|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&C)+m[14]-1502002290|0,x=(x<<17|x>>>15)+S|0,C+=(x&S|~x&y)+m[15]+1236535329|0,C=(C<<22|C>>>10)+x|0,y+=(C&S|x&~S)+m[1]-165796510|0,y=(y<<5|y>>>27)+C|0,S+=(y&x|C&~x)+m[6]-1069501632|0,S=(S<<9|S>>>23)+y|0,x+=(S&C|y&~C)+m[11]+643717713|0,x=(x<<14|x>>>18)+S|0,C+=(x&y|S&~y)+m[0]-373897302|0,C=(C<<20|C>>>12)+x|0,y+=(C&S|x&~S)+m[5]-701558691|0,y=(y<<5|y>>>27)+C|0,S+=(y&x|C&~x)+m[10]+38016083|0,S=(S<<9|S>>>23)+y|0,x+=(S&C|y&~C)+m[15]-660478335|0,x=(x<<14|x>>>18)+S|0,C+=(x&y|S&~y)+m[4]-405537848|0,C=(C<<20|C>>>12)+x|0,y+=(C&S|x&~S)+m[9]+568446438|0,y=(y<<5|y>>>27)+C|0,S+=(y&x|C&~x)+m[14]-1019803690|0,S=(S<<9|S>>>23)+y|0,x+=(S&C|y&~C)+m[3]-187363961|0,x=(x<<14|x>>>18)+S|0,C+=(x&y|S&~y)+m[8]+1163531501|0,C=(C<<20|C>>>12)+x|0,y+=(C&S|x&~S)+m[13]-1444681467|0,y=(y<<5|y>>>27)+C|0,S+=(y&x|C&~x)+m[2]-51403784|0,S=(S<<9|S>>>23)+y|0,x+=(S&C|y&~C)+m[7]+1735328473|0,x=(x<<14|x>>>18)+S|0,C+=(x&y|S&~y)+m[12]-1926607734|0,C=(C<<20|C>>>12)+x|0,y+=(C^x^S)+m[5]-378558|0,y=(y<<4|y>>>28)+C|0,S+=(y^C^x)+m[8]-2022574463|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^C)+m[11]+1839030562|0,x=(x<<16|x>>>16)+S|0,C+=(x^S^y)+m[14]-35309556|0,C=(C<<23|C>>>9)+x|0,y+=(C^x^S)+m[1]-1530992060|0,y=(y<<4|y>>>28)+C|0,S+=(y^C^x)+m[4]+1272893353|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^C)+m[7]-155497632|0,x=(x<<16|x>>>16)+S|0,C+=(x^S^y)+m[10]-1094730640|0,C=(C<<23|C>>>9)+x|0,y+=(C^x^S)+m[13]+681279174|0,y=(y<<4|y>>>28)+C|0,S+=(y^C^x)+m[0]-358537222|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^C)+m[3]-722521979|0,x=(x<<16|x>>>16)+S|0,C+=(x^S^y)+m[6]+76029189|0,C=(C<<23|C>>>9)+x|0,y+=(C^x^S)+m[9]-640364487|0,y=(y<<4|y>>>28)+C|0,S+=(y^C^x)+m[12]-421815835|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^C)+m[15]+530742520|0,x=(x<<16|x>>>16)+S|0,C+=(x^S^y)+m[2]-995338651|0,C=(C<<23|C>>>9)+x|0,y+=(x^(C|~S))+m[0]-198630844|0,y=(y<<6|y>>>26)+C|0,S+=(C^(y|~x))+m[7]+1126891415|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~C))+m[14]-1416354905|0,x=(x<<15|x>>>17)+S|0,C+=(S^(x|~y))+m[5]-57434055|0,C=(C<<21|C>>>11)+x|0,y+=(x^(C|~S))+m[12]+1700485571|0,y=(y<<6|y>>>26)+C|0,S+=(C^(y|~x))+m[3]-1894986606|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~C))+m[10]-1051523|0,x=(x<<15|x>>>17)+S|0,C+=(S^(x|~y))+m[1]-2054922799|0,C=(C<<21|C>>>11)+x|0,y+=(x^(C|~S))+m[8]+1873313359|0,y=(y<<6|y>>>26)+C|0,S+=(C^(y|~x))+m[15]-30611744|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~C))+m[6]-1560198380|0,x=(x<<15|x>>>17)+S|0,C+=(S^(x|~y))+m[13]+1309151649|0,C=(C<<21|C>>>11)+x|0,y+=(x^(C|~S))+m[4]-145523070|0,y=(y<<6|y>>>26)+C|0,S+=(C^(y|~x))+m[11]-1120210379|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~C))+m[2]+718787259|0,x=(x<<15|x>>>17)+S|0,C+=(S^(x|~y))+m[9]-343485551|0,C=(C<<21|C>>>11)+x|0,w[0]=y+w[0]|0,w[1]=C+w[1]|0,w[2]=x+w[2]|0,w[3]=S+w[3]|0}function o(w){var m=[],y;for(y=0;y<64;y+=4)m[y>>2]=w.charCodeAt(y)+(w.charCodeAt(y+1)<<8)+(w.charCodeAt(y+2)<<16)+(w.charCodeAt(y+3)<<24);return m}function a(w){var m=[],y;for(y=0;y<64;y+=4)m[y>>2]=w[y]+(w[y+1]<<8)+(w[y+2]<<16)+(w[y+3]<<24);return m}function s(w){var m=w.length,y=[1732584193,-271733879,-1732584194,271733878],C,x,S,T,_,E;for(C=64;C<=m;C+=64)i(y,o(w.substring(C-64,C)));for(w=w.substring(C-64),x=w.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<x;C+=1)S[C>>2]|=w.charCodeAt(C)<<(C%4<<3);if(S[C>>2]|=128<<(C%4<<3),C>55)for(i(y,S),C=0;C<16;C+=1)S[C]=0;return T=m*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(T[2],16),E=parseInt(T[1],16)||0,S[14]=_,S[15]=E,i(y,S),y}function c(w){var m=w.length,y=[1732584193,-271733879,-1732584194,271733878],C,x,S,T,_,E;for(C=64;C<=m;C+=64)i(y,a(w.subarray(C-64,C)));for(w=C-64<m?w.subarray(C-64):new Uint8Array(0),x=w.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<x;C+=1)S[C>>2]|=w[C]<<(C%4<<3);if(S[C>>2]|=128<<(C%4<<3),C>55)for(i(y,S),C=0;C<16;C+=1)S[C]=0;return T=m*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(T[2],16),E=parseInt(T[1],16)||0,S[14]=_,S[15]=E,i(y,S),y}function l(w){var m="",y;for(y=0;y<4;y+=1)m+=n[w>>y*8+4&15]+n[w>>y*8&15];return m}function d(w){var m;for(m=0;m<w.length;m+=1)w[m]=l(w[m]);return w.join("")}d(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function w(m,y){return m=m|0||0,m<0?Math.max(m+y,0):Math.min(m,y)}ArrayBuffer.prototype.slice=function(m,y){var C=this.byteLength,x=w(m,C),S=C,T,_,E,D;return y!==r&&(S=w(y,C)),x>S?new ArrayBuffer(0):(T=S-x,_=new ArrayBuffer(T),E=new Uint8Array(_),D=new Uint8Array(this,x,T),E.set(D),_)}})();function u(w){return/[\u0080-\uFFFF]/.test(w)&&(w=unescape(encodeURIComponent(w))),w}function f(w,m){var y=w.length,C=new ArrayBuffer(y),x=new Uint8Array(C),S;for(S=0;S<y;S+=1)x[S]=w.charCodeAt(S);return m?x:C}function h(w){return String.fromCharCode.apply(null,new Uint8Array(w))}function g(w,m,y){var C=new Uint8Array(w.byteLength+m.byteLength);return C.set(new Uint8Array(w)),C.set(new Uint8Array(m),w.byteLength),C}function p(w){var m=[],y=w.length,C;for(C=0;C<y-1;C+=2)m.push(parseInt(w.substr(C,2),16));return String.fromCharCode.apply(String,m)}function v(){this.reset()}return v.prototype.append=function(w){return this.appendBinary(u(w)),this},v.prototype.appendBinary=function(w){this._buff+=w,this._length+=w.length;var m=this._buff.length,y;for(y=64;y<=m;y+=64)i(this._hash,o(this._buff.substring(y-64,y)));return this._buff=this._buff.substring(y-64),this},v.prototype.end=function(w){var m=this._buff,y=m.length,C,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S;for(C=0;C<y;C+=1)x[C>>2]|=m.charCodeAt(C)<<(C%4<<3);return this._finish(x,y),S=d(this._hash),w&&(S=p(S)),this.reset(),S},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},v.prototype.setState=function(w){return this._buff=w.buff,this._length=w.length,this._hash=w.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(w,m){var y=m,C,x,S;if(w[y>>2]|=128<<(y%4<<3),y>55)for(i(this._hash,w),y=0;y<16;y+=1)w[y]=0;C=this._length*8,C=C.toString(16).match(/(.*?)(.{0,8})$/),x=parseInt(C[2],16),S=parseInt(C[1],16)||0,w[14]=x,w[15]=S,i(this._hash,w)},v.hash=function(w,m){return v.hashBinary(u(w),m)},v.hashBinary=function(w,m){var y=s(w),C=d(y);return m?p(C):C},v.ArrayBuffer=function(){this.reset()},v.ArrayBuffer.prototype.append=function(w){var m=g(this._buff.buffer,w),y=m.length,C;for(this._length+=w.byteLength,C=64;C<=y;C+=64)i(this._hash,a(m.subarray(C-64,C)));return this._buff=C-64<y?new Uint8Array(m.buffer.slice(C-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(w){var m=this._buff,y=m.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x,S;for(x=0;x<y;x+=1)C[x>>2]|=m[x]<<(x%4<<3);return this._finish(C,y),S=d(this._hash),w&&(S=p(S)),this.reset(),S},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var w=v.prototype.getState.call(this);return w.buff=h(w.buff),w},v.ArrayBuffer.prototype.setState=function(w){return w.buff=f(w.buff,!0),v.prototype.setState.call(this,w)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(w,m){var y=c(new Uint8Array(w)),C=d(y);return m?p(C):C},v})})(y2)),y2.exports}var Cz=wz();const xz=wa(Cz),Sz=["lastShaderProgramBound","context","_openGLRenderWindow"];function Tz(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(r,n,i)=>{let o=n;i.length>0&&(o=Re.substitute(o,"VSOut","GSOut").result);const a=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;a?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),o=Re.substitute(o,"//VTK::System::Dec",[`${c}
`,a?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=Re.substitute(r,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(a){l=Re.substitute(l,"varying","out").result,o=Re.substitute(o,"varying","in").result;let u="",f=0;for(;o.includes(`gl_FragData[${f}]`);)o=Re.substitute(o,`gl_FragData\\[${f}\\]`,`fragOutput${f}`).result,u+=`layout(location = ${f}) out vec4 fragOutput${f};
`,f++;o=Re.substitute(o,"//VTK::Output::Dec",u).result}const d=Re.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:o,GSSource:d}},t.readyShaderProgramArray=(r,n,i)=>{const o=t.replaceShaderValues(r,n,i),a=t.getShaderProgram(o.VSSource,o.FSSource,o.GSSource);return t.readyShaderProgram(a)},t.readyShaderProgram=r=>!r||!r.getCompiled()&&!r.compileShader()||!t.bindShaderProgram(r)?null:r,t.getShaderProgram=(r,n,i)=>{const o=`${r}${n}${i}`,a=xz.hash(o);if(!(a in e.shaderPrograms)){const s=Re.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(r),s.getFragmentShader().setSource(n),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(a),e.shaderPrograms[a]=s,s}return e.shaderPrograms[a]},t.releaseGraphicsResources=r=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(n=>e.shaderPrograms[n]).forEach(n=>n.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=r=>(e.lastShaderProgramBound===r||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),r.bind(),e.lastShaderProgramBound=r),1)}const _z={lastShaderProgramBound:null,shaderPrograms:null,context:null};function w6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_z,r),e.shaderPrograms={},Z.obj(t,e),Z.setGet(t,e,Sz),Z.moveToProtected(t,e,["openGLRenderWindow"]),Tz(t,e)}const Ez=Z.newInstance(w6,"vtkShaderCache");var bz={newInstance:Ez,extend:w6};const{vtkErrorMacro:Dz}=Z;function Iz(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&Dz("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=r=>{if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=()=>{for(let r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=r=>t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r),t.isAllocated=r=>e.textureUnits[r],t.free=r=>{e.textureUnits[r]=!1},t.freeAll=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}}const Mz={context:null,numberOfTextureUnits:0,textureUnits:0};function C6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mz,r),Z.obj(t,e),e.textureUnits=[],Z.get(t,e,["numberOfTextureUnits"]),Z.setGet(t,e,["context"]),Iz(t,e)}const Oz=Z.newInstance(C6,"vtkOpenGLTextureUnitManager");var Pz={newInstance:Oz,extend:C6};function Rz(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=r=>{const n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=(r,n,i)=>{const o=i.getViewportByReference(),a=t.getFramebufferSize();return o[0]*a[0]<=r&&o[2]*a[0]>=r&&o[1]*a[1]<=n&&o[3]*a[1]>=n},t.getViewportSize=r=>{const n=r.getViewportByReference(),i=t.getFramebufferSize();return[(n[2]-n[0])*i[0],(n[3]-n[1])*i[1]]},t.getViewportCenter=r=>{const n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r/o[0],n/o[1],i]},t.normalizedDisplayToDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r*o[0],n*o[1],i]},t.worldToView=(r,n,i,o)=>o.worldToView(r,n,i),t.viewToWorld=(r,n,i,o)=>o.viewToWorld(r,n,i),t.worldToDisplay=(r,n,i,o)=>{const a=o.worldToView(r,n,i),s=t.getViewportSize(o),c=o.viewToProjection(a[0],a[1],a[2],s[0]/s[1]),l=o.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(r,n,i,o)=>{const a=t.displayToNormalizedDisplay(r,n,i),s=o.normalizedDisplayToProjection(a[0],a[1],a[2]),c=t.getViewportSize(o),l=o.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return o.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(r,n,i,o)=>{let a=o.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const s=t.normalizedDisplayToDisplay(r,n,i);return[s[0]-a[0]-.5,s[1]-a[1]-.5,i]},t.viewportToNormalizedViewport=(r,n,i,o)=>{const a=t.getViewportSize(o);return a&&a[0]!==0&&a[1]!==0?[r/(a[0]-1),n/(a[1]-1),i]:[r,n,i]},t.normalizedViewportToViewport=(r,n,i,o)=>{const a=t.getViewportSize(o);return[r*(a[0]-1),n*(a[1]-1),i]},t.displayToLocalDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r,o[1]-n-1,i]},t.viewportToNormalizedDisplay=(r,n,i,o)=>{let a=o.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const s=r+a[0]+.5,c=n+a[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{Z.vtkErrorMacro("not implemented")},t.getPixelData=(r,n,i,o)=>{Z.vtkErrorMacro("not implemented")},t.createSelector=()=>{Z.vtkErrorMacro("not implemented")}}const Az={size:void 0,selector:void 0};function x6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Az,r),e.size||(e.size=[300,300]),Z.getArray(t,e,["size"],2),Z.get(t,e,["selector"]),Ir.extend(t,e,r),Rz(t,e)}const Lz=Z.newInstance(x6,"vtkRenderWindowViewNode");var Nz={newInstance:Lz,extend:x6};const Vz="__getUnderlyingContext";function kz(){const t=new Map,e={apply(i,o,a){return t.has(a[0])?t.get(a[0]):i.apply(o,a)}};function r(i){return{apply(o,a,s){return t.set(i,s[0]),o.apply(a,s)}}}const n=Object.create(null);return n.getParameter=(i,o,a,s)=>new Proxy(s.bind(i),e),n.depthMask=(i,o,a,s)=>new Proxy(s.bind(i),r(i.DEPTH_WRITEMASK)),{get(i,o,a){if(o===Vz)return()=>i;let s=Reflect.get(i,o,i);s instanceof Function&&(s=s.bind(i));const c=n[o];return c?c(i,o,a,s):s}}}const{vtkDebugMacro:hS,vtkErrorMacro:gS}=Z,Fz={position:"absolute",top:0,left:0,width:"100%",height:"100%"},Uz=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Vi(t,e,r){const n=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),o===t.FRAMEBUFFER_COMPLETE}let $p=0;const K1=[];function Bz(){$p++,K1.forEach(t=>t($p))}function Gz(){$p--,K1.forEach(t=>t($p))}function Wz(t){K1.push(t)}function $z(t){return K1.pop()}function pS(t){t.preventDefault()}function zz(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let r;function n(){return r||(r=kz()),r}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",pS,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function o(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(o),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(f=>{f.setOpenGLRenderWindow?.(t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&Bz(),e.textureUnitManager=Pz.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&gS("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:f}=e.el.getBoundingClientRect();e.containerSize=[u,f]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.activeFramebuffer?.getSize()||e.size,t.getPixelData=(u,f,h,g)=>{const p=new Uint8Array((h-u+1)*(g-f+1)*4);return e.context.readPixels(u,f,h-u+1,g-f+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},f=null;const h=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&h&&(f=e.canvas.getContext("webgl2",u),f&&(e.webgl2=!0,hS("using webgl2"))),f||(hS("using webgl1"),f=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(f,n())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=X1.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const f=e._textureResourceIds.get(u);if(f!==void 0){e.context.activeTexture(e.context.TEXTURE0+f);return}const h=t.getTextureUnitManager().allocate();if(h<0){gS("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,h),e.context.activeTexture(e.context.TEXTURE0+h)},t.deactivateTexture=u=>{const f=e._textureResourceIds.get(u);f!==void 0&&(t.getTextureUnitManager().free(f),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const f=e._textureResourceIds.get(u);return f!==void 0?f:-1},t.getDefaultTextureByteSize=function(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case Zt.CHAR:case Zt.SIGNED_CHAR:case Zt.UNSIGNED_CHAR:return 1;case f:case h:case Zt.UNSIGNED_SHORT:case Zt.SHORT:case Zt.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,f){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case Zt.UNSIGNED_CHAR:switch(f){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(h&&!g&&Zt.UNSIGNED_SHORT):switch(f){case 1:return h.R16_EXT;case 2:return h.RG16_EXT;case 3:return h.RGB16_EXT;case 4:default:return h.RGBA16_EXT}case(h&&!g&&Zt.SHORT):switch(f){case 1:return h.R16_SNORM_EXT;case 2:return h.RG16_SNORM_EXT;case 3:return h.RGB16_SNORM_EXT;case 4:default:return h.RGBA16_SNORM_EXT}case Zt.UNSIGNED_SHORT:case Zt.SHORT:case Zt.FLOAT:default:switch(f){case 1:return g?e.context.R16F:e.context.R32F;case 2:return g?e.context.RG16F:e.context.RG32F;case 3:return g?e.context.RGB16F:e.context.RGB32F;case 4:default:return g?e.context.RGBA16F:e.context.RGBA32F}}switch(f){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function a(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const f=document.createElement("canvas"),h=f.getContext("2d");f.width=e.canvas.width,f.height=e.canvas.height,h.drawImage(e.canvas,0,0);const g=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(m=>{m.getViewProps().forEach(C=>{if(C.getContainer){const S=C.getContainer().getElementsByTagName("canvas");for(let T=0;T<S.length;T++){const _=S[T],E=_.getBoundingClientRect(),D=E.x-g.x,b=E.y-g.y;h.drawImage(_,D,b)}}})});const w=f.toDataURL(u);f.remove(),t.invokeImageReady(w)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:f=!1,size:h=null,scale:g=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:h||g!==1?h||e.size.map(v=>v*g):null},new Promise((v,w)=>{const m=t.onImageReady(y=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=p,m.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(C=>{let{restoreParamsFn:x,arg:S}=C;return x(S)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),v(y);else{const C=document.createElement("img");if(C.style=Fz,C.src=y,e._screenshot.placeHolder=e.el.appendChild(C),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e.rootOpenGLRenderWindow?.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),f){const x=f!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(S=>{const T=S.getActiveCamera(),_=T.get("focalPoint","position","parallelScale");return{resetCameraArgs:x?{renderer:S}:void 0,resetCameraFn:x?f:S.resetCamera,restoreParamsFn:T.set,arg:JSON.parse(JSON.stringify(_))}}),e._screenshot.cameras.forEach(S=>{let{resetCameraFn:T,resetCameraArgs:_}=S;return T(_)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const u=t.get3DContext(),f=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=f[1],f[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),f=u.getExtension("OES_texture_float"),h=u.getExtension("OES_texture_half_float"),g=u.getExtension("WEBGL_debug_renderer_info"),p=u.getExtension("WEBGL_draw_buffers"),v=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),w=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",v&&u.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[f&&Vi(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",f&&Vi(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",f&&Vi(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",f&&Vi(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",f&&Vi(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[h&&Vi(u,u.RGBA,h.HALF_FLOAT_OES)?"RGBA":"",h&&Vi(u,u.RGB,h.HALF_FLOAT_OES)?"RGB":"",h&&Vi(u,u.LUMINANCE,h.HALF_FLOAT_OES)?"LUMINANCE":"",h&&Vi(u,u.ALPHA,h.HALF_FLOAT_OES)?"ALPHA":"",h&&Vi(u,u.LUMINANCE_ALPHA,h.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[f&&Vi(u,u.RGBA,u.FLOAT)?"RGBA":"",f&&Vi(u,u.RGB,u.FLOAT)?"RGB":"",f&&Vi(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",f&&Vi(u,u.ALPHA,u.FLOAT)?"ALPHA":"",f&&Vi(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?u.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",g&&u.getParameter(g.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",g&&u.getParameter(g.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],m={};for(;w.length;){const[y,C,x]=w.pop();C&&(m[C]={label:y,value:x})}return e._glInformation=m,m},t.traverseAllPasses=()=>{if(e.renderPasses)for(let f=0;f<e.renderPasses.length;++f)e.renderPasses[f].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&a();const u=e.renderable.getChildRenderWindowsByReference();for(let f=0;f<u.length;++f)t.getViewNodeFor(u[f])?.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(g=>!!g.getSelector?.()))return;const f=u.getCanvas(),h=e.canvas;e.context2D.drawImage(f,0,f.height-h.height,h.width,h.height,0,0,h.width,h.height)},t.resizeFromChildRenderWindows=()=>{const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const f=[0,0];for(let h=0;h<u.length;++h){const g=t.getViewNodeFor(u[h])?.getSize();g&&(f[0]=g[0]>f[0]?g[0]:f[0],f[1]=g[1]>f[1]?g[1]:f[1])}t.setSize(...f)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const f=e.renderable.getRenderers()[0];f.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(h=>t.setBackgroundImage(h.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=vw.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",pS),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=Z.chain(()=>{e.context&&Gz(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,f)=>{const h=l(u,f);return h&&t.invokeWindowResizeEvent({width:u,height:f}),h},t.registerGraphicsResourceUser=(u,f)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null),e._graphicsResources.get(u)?.users.add(f)},t.unregisterGraphicsResourceUser=(u,f)=>{const h=e._graphicsResources.get(u);h&&(h.users.delete(f),h.users.size||(h.oglObject?.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,f,h)=>{if(!u)return;const g=e._graphicsResources.get(u);g?.oglObject?.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:f,hash:h,users:g?.users??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(f=>{let{oglObject:h}=f;u+=h.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:f}=u;f.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{t.getViewNodeFor(u)?.releaseGraphicsResources()})};const d={...t};Uz.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):d[u](...arguments)}})}const jz={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function S6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jz,r),Nz.extend(t,e,r),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=vw.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=Dk.newInstance(),e.shaderCache=bz.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=mw.newInstance(),Z.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),Z.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),Z.setGetArray(t,e,["size"],2),Z.event(t,e,"imageReady"),Z.event(t,e,"windowResizeEvent"),zz(t,e)}const yw=Z.newInstance(S6,"vtkOpenGLRenderWindow");r6("WebGL",yw);var Hz={newInstance:yw,extend:S6,pushMonitorGLContextCount:Wz,popMonitorGLContextCount:$z};ti("vtkRenderWindow",yw);function Xz(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=r=>{if(r){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const i=e.children[n];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),fr(e.keyMatrices.mcwc,e.renderable.getMatrix()),Mn(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Xo(e.keyMatrices.normalMatrix):(el(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),ec(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),V0(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const Kz={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function qz(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kz,r),Ir.extend(t,e,r),e.keyMatrixTime={},Jn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Xo(new Float64Array(9)),mcwc:It(new Float64Array(16))},Ur(t,e,["context"]),ji(t,e,["activeTextures"]),Xz(t,e)}const T6=zn(qz);var Yz={newInstance:T6};ti("vtkActor",T6);function Jz(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=r=>{if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const i=e.children[n];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const Zz={context:null,activeTextures:null};function Qz(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zz,r),Ir.extend(t,e,r),Ur(t,e,["context"]),ji(t,e,["activeTextures"]),Jz(t,e)}const _6=zn(Qz);var ej={newInstance:_6};ti("vtkActor2D",_6);function tj(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=r=>r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=r=>{const n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=r=>{if(r)if(!Array.isArray(r))t.addClippingPlane(r);else{const n=r.length;for(let i=0;i<n&&i<6;i++)t.addClippingPlane(r[i])}},t.getClippingPlaneInDataCoords=(r,n,i)=>{const o=e.clippingPlanes,a=r;if(o){const s=o.length;if(n>=0&&n<s){const c=o[n],l=c.getNormal(),d=c.getOrigin(),u=l[0],f=l[1],h=l[2],g=-(u*d[0]+f*d[1]+h*d[2]);i[0]=u*a[0]+f*a[4]+h*a[8]+g*a[12],i[1]=u*a[1]+f*a[5]+h*a[9]+g*a[13],i[2]=u*a[2]+f*a[6]+h*a[10]+g*a[14],i[3]=u*a[3]+f*a[7]+h*a[11]+g*a[15];return}}Z.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}const nj={clippingPlanes:[]};function rj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nj,r),Z.obj(t,e),Z.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),tj(t,e)}var ij={extend:rj};function oj(t,e){t.getBounds=()=>(Z.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Eu()),t.getCenter=()=>{const r=t.getBounds();return e.center=bn.isValid(r)?bn.getCenter(r):null,e.center?.slice()},t.getLength=()=>{const r=t.getBounds();return bn.getDiagonalLength(r)}}const aj=t=>({bounds:[...bn.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function sj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aj(r)),ij.extend(t,e,r),Z.setGet(t,e,["viewSpecificProperties"]),oj(t,e)}var ww={extend:sj};const{vtkErrorMacro:mS}=Z,vS=0,yS=1,w2=2;function cj(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(let n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(r,n)=>{let i=0;const o=Number(r);return o<n.range[0]?i=n.maxIndex+vS+1.5:o>n.range[1]?i=n.maxIndex+yS+1.5:(i=(o+n.shift)*n.scale,i=i<n.maxIndex?i:n.maxIndex),Math.floor(i)},t.linearLookup=(r,n,i)=>{let o=0;Pp(r)?o=Math.floor(i.maxIndex+1.5+w2):o=t.linearIndexLookup(r,i);const a=4*o;return n.slice(a,a+4)},t.indexedLookupFunction=(r,n,i)=>{let o=t.getAnnotatedValueIndexInternal(r);o===-1&&(o=e.numberOfColors+w2);const a=4*o;return[n[a],n[a+1],n[a+2],n[a+3]]},t.lookupShiftAndScale=(r,n)=>{n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=(r,n,i,o)=>{let a=t.linearLookup;e.indexedLookup&&(a=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const l=t.getAlpha(),d=r.getNumberOfTuples(),u=r.getNumberOfComponents(),f=n.getData(),h=r.getData();if(l>=1){if(i===Yv.RGBA)for(let g=0;g<d;g++){const p=a(h[g*u+o],e.table,c);f[g*4]=p[0],f[g*4+1]=p[1],f[g*4+2]=p[2],f[g*4+3]=p[3]}}else if(i===Yv.RGBA)for(let g=0;g<d;g++){const p=a(h[g*u+o],e.table,c);f[g*4]=p[0],f[g*4+1]=p[1],f[g*4+2]=p[2],f[g*4+3]=Math.floor(p[3]*l+.5)}},t.forceBuild=()=>{let r=0,n=0,i=0,o=0;const a=e.numberOfColors-1;a&&(r=(e.hueRange[1]-e.hueRange[0])/a,n=(e.saturationRange[1]-e.saturationRange[0])/a,i=(e.valueRange[1]-e.valueRange[0])/a,o=(e.alphaRange[1]-e.alphaRange[0])/a),e.table.length=4*a+16;const s=[],c=[];for(let l=0;l<=a;l++)s[0]=e.hueRange[0]+l*r,s[1]=e.saturationRange[0]+l*n,s[2]=e.valueRange[0]+l*i,au(s,c),c[3]=e.alphaRange[0]+l*o,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=r=>{if(Array.isArray(r)){const i=r[0].length;e.numberOfColors=r.length;const o=4-i;let a=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<r.length;s++){const c=r[s];for(let l=0;l<i;l++)e.table[a++]=c[l];a+=o}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(r.getNumberOfComponents()!==4)return mS("Expected 4 components for RGBA colors"),!1;if(r.getDataType()!==Zt.UNSIGNED_CHAR)return mS("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=r.getNumberOfTuples();const n=r.getData();e.table.length=n.length;for(let i=0;i<n.length;i++)e.table[i]=n[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:r}=e,n=e.table;let i=(r+vS)*4;e.useBelowRangeColor||r===0?(n[i]=e.belowRangeColor[0]*255+.5,n[i+1]=e.belowRangeColor[1]*255+.5,n[i+2]=e.belowRangeColor[2]*255+.5,n[i+3]=e.belowRangeColor[3]*255+.5):(n[i]=n[0],n[i+1]=n[1],n[i+2]=n[2],n[i+3]=n[3]),i=(r+yS)*4,e.useAboveRangeColor||r===0?(n[i]=e.aboveRangeColor[0]*255+.5,n[i+1]=e.aboveRangeColor[1]*255+.5,n[i+2]=e.aboveRangeColor[2]*255+.5,n[i+3]=e.aboveRangeColor[3]*255+.5):(n[i]=n[4*(r-1)+0],n[i+1]=n[4*(r-1)+1],n[i+2]=n[4*(r-1)+2],n[i+3]=n[4*(r-1)+3]),i=(r+w2)*4,n[i]=e.nanColor[0]*255+.5,n[i+1]=e.nanColor[1]*255+.5,n[i+2]=e.nanColor[2]*255+.5,n[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const lj={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function E6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lj,r),N5.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},Z.obj(e.buildTime),e.opaqueFlagBuildTime={},Z.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},Z.obj(e.insertTime,{mtime:0}),Z.get(t,e,["buildTime"]),Z.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),Z.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),Z.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),Z.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),cj(t,e)}const uj=Z.newInstance(E6,"vtkLookupTable");var dj={newInstance:uj,extend:E6};const{FieldAssociations:wS}=nd,{staticOffsetAPI:fj,otherStaticMethods:hj}=j1,{ColorMode:fg,ScalarMode:ql,GetArray:C2}=L5,{VectorMode:gj}=A5,{VtkDataTypes:pj}=Ot;function Od(t){return()=>Z.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function mj(t,e){const r=t[1]%2===0?1:-1;if(t[0]+=r,t[0]>=e[0]||t[0]<0){const n=t[2]%2===0?1:-1;t[0]-=r,t[1]+=n,(t[1]>=e[1]||t[1]<0)&&(t[1]-=n,t[2]++)}}function vj(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function CS(t,e,r){const n=Math.floor(e),i=n%(2*r[0]);let o,a;i<r[0]?(t[0]=i,o=1,a=t[0]===r[0]-1):(t[0]=2*r[0]-1-i,o=-1,a=t[0]===0);const s=Math.floor(n/r[0]),c=s%(2*r[1]);let l,d;c<r[1]?(t[1]=c,l=1,d=t[1]===r[1]-1):(t[1]=2*r[1]-1-c,l=-1,d=t[1]===0),t[2]=Math.floor(s/r[1]);const u=e-n;a?d?t[2]+=u:t[1]+=l*u:t[0]+=o*u,t[0]=(t[0]+.5)/r[0],t[1]=(t[1]+.5)/r[1],t[2]=(t[2]+.5)/r[2]}const xS=new WeakMap;function yj(t,e,r,n,i,o,a){const s=new Array(arguments.length);for(let I=0;I<arguments.length;++I){const O=arguments[I];s[I]=O.getMTime?.()??O}const c=s.join("/"),l=xS.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const d=(r[1]-r[0])/(i-1),[u,f]=[r[0]-d,r[1]+d],h=u-.5*d,g=1/(f-u+d),p=u,v=(i+1)/(f-u),w=t.getData(),m=t.getNumberOfTuples(),y=t.getNumberOfComponents(),C=e<0||e>=y,x=o[2]<=1?2:3,S=Ot.newInstance({numberOfComponents:x,values:new Float32Array(m*x)}),T=S.getData(),_=[0,0,0];CS(_,i+2,o);let E=0,D=0;const b=[.5,.5,.5];for(let I=0;I<m;++I){let O;if(C){let M=0;for(let R=0;R<y;++R){const A=Number(w[E+R]);M+=A*A}O=Math.sqrt(M)}else O=Number(w[E+e]);if(n&&(O=Math.log10(O)),E+=y,Pp(O))b[0]=_[0],b[1]=_[1],b[2]=_[2];else if(a){let M=(O-p)*v;M<1?M=0:M>i&&(M=i+1),CS(b,M,o)}else{b[1]=.49;const M=(O-h)*g;M>1e3?b[0]=1e3:M<-1e3?b[0]=-1e3:b[0]=M}for(let M=0;M<x;++M)T[D++]=b[M]}return xS.set(t,{stringHash:c,textureCoordinates:S}),S}function wj(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=Eu(),e.bounds},t.setForceCompileOnly=r=>{e.forceCompileOnly=r},t.setSelectionWebGLIdsToVTKIds=r=>{e.selectionWebGLIdsToVTKIds=r},t.createDefaultLookupTable=()=>{e.lookupTable=dj.newInstance()},t.getColorModeAsString=()=>Z.enumToString(fg,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>Z.enumToString(ql,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,i,o,a)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(n===ql.DEFAULT)s=r.getPointData().getScalars(),s||(s=r.getCellData().getScalars(),c=!0);else if(n===ql.USE_POINT_DATA)s=r.getPointData().getScalars();else if(n===ql.USE_CELL_DATA)s=r.getCellData().getScalars(),c=!0;else if(n===ql.USE_POINT_FIELD_DATA){const l=r.getPointData();i===C2.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===ql.USE_CELL_FIELD_DATA){const l=r.getCellData();c=!0,i===C2.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===ql.USE_FIELD_DATA){const l=r.getFieldData();i===C2.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}return{scalars:s,cellFlag:c}},t.mapScalars=(r,n)=>{const{scalars:i,cellFlag:o}=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=o,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${n}`;if(e.colorBuildString!==a){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,o))e.mapScalarsToTexture(i,o,n);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${n}`}},e.mapScalarsToTexture=(r,n,i)=>{const o=e.lookupTable.getRange(),a=e.lookupTable.usingLogScale(),s=e.lookupTable.getAlpha(),c=a?[Math.log10(o[0]),Math.log10(o[1])]:o;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const d=e.lookupTable.getNumberOfAvailableColors(),u=2048,f=u**3-3,g=4096-2,p=2,v=n?f:g;e.numberOfColorsInRange=Math.min(Math.max(d,p),v);const w=e.numberOfColorsInRange+3,m=e.numberOfColorsInRange+2,y=n?[Math.min(Math.ceil(w/u**0),u),Math.min(Math.ceil(w/u**1),u),Math.min(Math.ceil(w/u**2),u)]:[m,2,1],C=y[0]*y[1]*y[2],x=new Float64Array(C);x.fill(NaN);const S=e.numberOfColorsInRange,T=S+2,_=[0,0,0],E=c[0],D=c[1]-c[0];for(let O=0;O<T;++O){const M=vj(_,y),R=E+D*(O-1)/(S-1),A=a?10**R:R;x[M]=A,mj(_,y)}const b=Ot.newInstance({numberOfComponents:1,values:x}),I=e.lookupTable.mapScalars(b,e.colorMode,0);e.colorTextureMap=Rh.newInstance(),e.colorTextureMap.setDimensions(y),e.colorTextureMap.getPointData().setScalars(I),e.lookupTable.setAlpha(s)}const l=e.lookupTable.getVectorMode()===gj.MAGNITUDE&&r.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=yj(r,l,c,a,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),n)},t.getIsOpaque=()=>{const r=t.getInputData(),i=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const o=t.getLookupTable();return o?(o.build(),o.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(r,n)=>n&&e.colorMode!==fg.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!r||e.colorMode===fg.DEFAULT&&r.getDataType()===pj.UNSIGNED_CHAR||e.colorMode===fg.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){const n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=()=>{const r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=Od("AcquireInvertibleLookupTable"),t.valueToColor=Od("ValueToColor"),t.colorToValue=Od("ColorToValue"),t.useInvertibleColorFor=Od("UseInvertibleColorFor"),t.clearInvertibleColor=Od("ClearInvertibleColor"),t.processSelectorPixelBuffers=(r,n)=>{if(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=r.getRawPixelBuffer(Fi.ID_LOW24),o=r.getRawPixelBuffer(Fi.ID_HIGH24),a=r.getCurrentPass(),s=r.getFieldAssociation();let c=null;s===wS.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===wS.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&n.forEach(l=>{if(a===Fi.ID_LOW24){let d=0;o&&(d+=o[l],d*=256),d+=i[l+2],d*=256,d+=i[l+1],d*=256,d+=i[l];const u=c[d],f=r.getPixelBuffer(Fi.ID_LOW24);f[l]=u&255,f[l+1]=(u&65280)>>8,f[l+2]=(u&16711680)>>16}else if(a===Fi.ID_HIGH24&&o){let d=0;d+=o[l],d*=256,d+=i[l+2],d*=256,d+=i[l+1],d*=256,d+=i[l];const u=c[d],f=r.getPixelBuffer(Fi.ID_HIGH24);f[l]=(u&4278190080)>>24}})}}const Cj={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function b6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cj,r),ww.extend(t,e,r),Z.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),Z.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),Z.setGetArray(t,e,["scalarRange"],2),j1.implementCoincidentTopologyMethods(t,e),wj(t,e)}const xj=Z.newInstance(b6,"vtkMapper");var Mu={newInstance:xj,extend:b6,...fj,...hj,...L5};const{FieldAssociations:x2}=nd,{primTypes:$r}=lc,{Representation:ju,Shading:SS}=Ph,{ScalarMode:hg}=Mu,{Filter:TS,Wrap:_S}=$n,{vtkErrorMacro:Yl}=Oi,Sj={type:"StartEvent"},Tj={type:"EndEvent"},{CoordinateSystem:_j}=E8;function Ej(t){const e=t.getSelector();return e?e.getCurrentPass():Fi.MIN_KNOWN_PASS-1}function bj(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let a=$r.Start;a<$r.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.getShaderTemplate=(n,i,o)=>{n.Vertex=gw,n.Fragment=Ih,n.Geometry=""},t.replaceShaderColor=(n,i,o)=>{let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let d=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(d=d.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(d=d.concat(["varying vec4 vertexColorVSOutput;"]),a=Re.substitute(a,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,a=Re.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=Re.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Re.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=Re.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=Re.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(o.getBackfaceProperty()&&!e.drawingEdges&&(d=d.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(d=d.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(d=d.concat(["uniform samplerBuffer texture1;"])),c=Re.substitute(c,"//VTK::Color::Impl",u).result),c=Re.substitute(c,"//VTK::Color::Dec",d).result,n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderLight=(n,i,o)=>{let a=n.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let d=[];switch(c){case 0:a=Re.substitute(a,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:a=Re.substitute(a,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)d=d.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);a=Re.substitute(a,"//VTK::Light::Dec",d).result,d=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)d=d.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${s}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${u});`,"    }"]);d=d.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=Re.substitute(a,"//VTK::Light::Impl",d,!1).result;break;case 3:for(let u=0;u<l;++u)d=d.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);a=Re.substitute(a,"//VTK::Light::Dec",d).result,d=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)d=d.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${u});`,"    }"]);d=d.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=Re.substitute(a,"//VTK::Light::Impl",d,!1).result;break;default:Yl("bad light complexity")}n.Fragment=a},t.replaceShaderNormal=(n,i,o)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=n.Vertex,c=n.Geometry,l=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=Re.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Re.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=Re.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=Re.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=Re.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=Re.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=Re.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=Re.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(o.getProperty().getRepresentation())===e.context.LINES?(l=Re.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=Re.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=Re.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=Re.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=Re.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=s,n.Geometry=c,n.Fragment=l}},t.replaceShaderPositionVC=(n,i,o)=>{e.lastBoundBO.replaceShaderPositionVC(n,i,o);let a=n.Vertex,s=n.Geometry,c=n.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=Re.substitute(a,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,a=Re.substitute(a,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Re.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=Re.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=Re.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=Re.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=Re.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(a=Re.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Re.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderTCoord=(n,i,o)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;if(e.drawingEdges)return;a=Re.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let d=2,u=2;if(l&&l.length>0&&(d=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(d=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(a=Re.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=Re.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=Re.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Re.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(d){case 1:c=Re.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Re.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Re.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(a=Re.substitute(a,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=Re.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=Re.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Re.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,d){case 1:c=Re.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Re.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Re.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=a,n.Geometry=s,n.Fragment=c}},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();a=Re.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,a=Re.substitute(a,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Re.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=Re.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getCoincidentParameters=(n,i)=>{let o={factor:0,offset:0};const a=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==Ca.PolygonOffset||a.getEdgeVisibility()&&a.getRepresentation()===ju.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===$r.Points||a.getRepresentation()===ju.POINTS?o=e.renderable.getCoincidentTopologyPointOffsetParameter():c===$r.Lines||a.getRepresentation()===ju.WIREFRAME?o=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===$r.Tris||c===$r.TriStrips)&&(o=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===$r.TrisEdges||c===$r.TriStripsEdges)&&(o=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),o.factor/=2,o.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===x2.FIELD_ASSOCIATION_POINTS&&(o.offset-=2),o},t.replaceShaderPicking=(n,i,o)=>{let a=n.Fragment,s=n.Vertex;if(a=Re.substitute(a,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===Fi.ID_LOW24||e.lastSelectionState===Fi.ID_HIGH24)&&(s=Re.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=Re.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,a=Re.substitute(a,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,a=Re.substitute(a,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case Fi.ID_LOW24:a=Re.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case Fi.ID_HIGH24:a=Re.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:a=Re.substitute(a,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,a=Re.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=a,n.Vertex=s}},t.replaceShaderValues=(n,i,o)=>{if(t.replaceShaderColor(n,i,o),t.replaceShaderNormal(n,i,o),t.replaceShaderLight(n,i,o),t.replaceShaderTCoord(n,i,o),t.replaceShaderPicking(n,i,o),t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o),t.replaceShaderPositionVC(n,i,o),e.haveSeenDepthRequest){let a=n.Fragment;a=Re.substitute(a,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,a=Re.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=a}},t.getNeedToRebuildShaders=(n,i,o)=>{let a=0,s=0;const c=n.getPrimitiveType(),l=e.currentInput;let d=!1;const u=l.getPointData().getNormals(),f=l.getCellData().getNormals(),h=o.getProperty().getInterpolation()===SS.FLAT,g=o.getProperty().getRepresentation(),p=n.getOpenGLMode(g,c);if((p===e.context.TRIANGLES||f&&!u||!h&&u||!h&&p===e.context.LINES)&&(d=!0),o.getProperty().getLighting()&&d){a=0;const y=i.getLightsByReference();for(let C=0;C<y.length;++C){const x=y[C];x.getSwitch()>0&&(s++,a===0&&(a=1)),a===1&&(s>1||x.getIntensity()!==1||!x.lightTypeIsHeadLight())&&(a=2),a<3&&x.getPositional()&&(a=3)}}let v=!1;const w=e.lastBoundBO.getReferenceByName("lastLightComplexity"),m=e.lastBoundBO.getReferenceByName("lastLightCount");return(w!==a||m!==s)&&(e.lastBoundBO.set({lastLightComplexity:a},!0),e.lastBoundBO.set({lastLightCount:s},!0),v=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||v?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(n,i,o)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(s=>{s.callback(s.userData,n,i,o)})},t.setMapperShaderParameters=(n,i,o)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Yl("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&c>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Yl("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,d)=>{n.getProgram().isAttributeUsed(`${l}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${l}MC`,n.getCABO().getCustomData()[d].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[d].components,!1)||Yl(`Error setting ${l}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Yl("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Yl("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,f=u?fr(e.tmpMat4,o.getMatrix()):o.getMatrix();u&&(Mn(f,f),Wt(f,f,u),Mn(f,f));for(let h=0;h<c;h++){const g=[];e.renderable.getClippingPlaneInDataCoords(f,h,g);for(let p=0;p<4;p++)l.push(g[p])}n.getProgram().setUniformi("numClipPlanes",c),n.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const d=a[c].getTextureUnit(),u=`texture${d+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,d)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",c.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",c.factor)}n.setMapperShaderParameters(i,o,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(n,i,o)=>{const a=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(a<2)return;const s=n.getProgram();let c=0;const l=i.getLightsByReference();for(let f=0;f<l.length;++f){const h=l[f];if(h.getSwitch()>0){const p=h.getColorByReference(),v=h.getIntensity();e.lightColor[0]=p[0]*v,e.lightColor[1]=p[1]*v,e.lightColor[2]=p[2]*v;const w=h.getDirection(),m=i.getActiveCamera().getViewMatrix(),y=[...w];h.lightTypeIsSceneLight()&&(y[0]=m[0]*w[0]+m[1]*w[1]+m[2]*w[2],y[1]=m[4]*w[0]+m[5]*w[1]+m[6]*w[2],y[2]=m[8]*w[0]+m[9]*w[1]+m[10]*w[2],wo(y)),e.lightDirection[0]=y[0],e.lightDirection[1]=y[1],e.lightDirection[2]=y[2],wo(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(a<3)return;const u=i.getActiveCamera().getViewMatrix();Mn(u,u),c=0;for(let f=0;f<l.length;++f){const h=l[f];if(h.getSwitch()>0){const p=h.getTransformedPosition(),v=new Float64Array(3);Vt(v,p,u),s.setUniform3fArray(`lightAttenuation${c}`,h.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,h.getPositional()),s.setUniformf(`lightExponent${c}`,h.getExponent()),s.setUniformf(`lightConeAngle${c}`,h.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[v[0],v[1],v[2]]),c++}}};function r(n,i,o){return i.identity(o),n.reduce((a,s,c)=>c===0?s?i.copy(a,s):i.identity(a):s?i.multiply(a,a,s):a,o)}t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),d=a.getLastCameraMTime(),f=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,h=o.getIsIdentity(),g=h?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(o.getCoordinateSystem()===_j.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();It(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,Wt(e.tmpMat4,e.tmpMat4,f),a.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else a.setUniformMatrix("MCPCMatrix",r([s.wcpc,g.mcwc,f],Ap,e.tmpMat4));a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",r([s.wcvc,g.mcwc,f],Ap,e.tmpMat4)),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",r([s.normalMatrix,g.normalMatrix],WN,e.tmpMat3)),d!==l&&(a.isUniformUsed("cameraParallel")&&a.setUniformi("cameraParallel",c.getParallelProjection()),a.setLastCameraMTime(l)),h||a.setLastCameraMTime(0)},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram();let s=o.getProperty(),c=s.getOpacity(),l=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),d=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),u=e.drawingEdges?1:s.getAmbient(),f=e.drawingEdges?0:s.getDiffuse(),h=e.drawingEdges?0:s.getSpecular();const g=s.getSpecularPower();a.setUniformf("opacityUniform",c),a.setUniform3fArray("ambientColorUniform",l),a.setUniform3fArray("diffuseColorUniform",d),a.setUniformf("ambient",u),a.setUniformf("diffuse",f);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let v=s.getSpecularColorByReference();if(a.setUniform3fArray("specularColorUniform",v),a.setUniformf("specularPowerUniform",g),a.setUniformf("specular",h),a.isUniformUsed("ambientIntensityBF")){if(s=o.getBackfaceProperty(),c=s.getOpacity(),l=s.getAmbientColor(),u=s.getAmbient(),d=s.getDiffuseColor(),f=s.getDiffuse(),v=s.getSpecularColor(),h=s.getSpecular(),a.setUniformf("ambientIntensityBF",u),a.setUniformf("diffuseIntensityBF",f),a.setUniformf("opacityUniformBF",c),a.setUniform3fArray("ambientColorUniformBF",l),a.setUniform3fArray("diffuseColorUniformBF",d),p<1)return;a.setUniformf("specularIntensityBF",h),a.setUniform3fArray("specularColorUniformBF",v),a.setUniformf("specularPowerUniformBF",g)}},t.updateMaximumPointCellIds=(n,i)=>{const o=e._openGLRenderer.getSelector();if(!o)return;if(e.selectionWebGLIdsToVTKIds?.points?.length){const s=e.selectionWebGLIdsToVTKIds.points.length;o.setMaximumPointId(s-1)}if(e.selectionWebGLIdsToVTKIds?.cells?.length){const s=e.selectionWebGLIdsToVTKIds.cells.length;o.setMaximumCellId(s-1)}o.getFieldAssociation()===x2.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(n,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const o=Ej(e._openGLRenderer);e.lastSelectionState!==o&&(e.selectionStateChanged.modified(),e.lastSelectionState=o),e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().renderProp(i),t.updateBufferObjects(n,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation(),a=i.getProperty().getEdgeVisibility()&&o===ju.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===x2.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===Fi.ID_LOW24||e.lastSelectionState===Fi.ID_HIGH24);for(let l=$r.Start;l<$r.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=a&&(l===$r.TrisEdges||l===$r.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(n,i,o,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(n,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(n,i)=>{if(t.invokeEvent(Sj),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(Tj),!e.currentInput){Yl("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context,a=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!a&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.FRONT)):(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK)),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return o<t.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentInput.getMTime()},t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===hg.USE_CELL_DATA||s===hg.USE_CELL_FIELD_DATA||s===hg.USE_FIELD_DATA||!o.getPointData().getScalars())&&s!==hg.USE_POINT_FIELD_DATA&&a&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==SS.FLAT?o.getPointData().getNormals():null;c===null&&o.getCellData().getNormals()&&(e.haveCellNormals=!0,c=o.getCellData().getNormals());const l=i.getProperty().getRepresentation();let d=o.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(d=null);let u=!1;if(e.renderable.getColorCoordinates()){d=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=$n.newInstance({resizable:!0}));const h=e.internalColorTexture;h.setMinificationFilter(TS.NEAREST),h.setMagnificationFilter(TS.NEAREST),h.setWrapS(_S.CLAMP_TO_EDGE),h.setWrapT(_S.CLAMP_TO_EDGE),h.setOpenGLRenderWindow(e._openGLRenderWindow);const g=e.renderable.getColorTextureMap(),p=g.getExtent(),v=g.getPointData().getScalars();h.create2DFromRaw({width:p[1]-p[0]+1,height:p[3]-p[2]+1,numComps:v.getNumberOfComponents(),dataType:v.getDataType(),data:v.getData()}),h.activate(),h.sendParameters(),h.deactivate()}const f=`${o.getMTime()}A${l}B${o.getMTime()}C${c?c.getMTime():1}D${a?a.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${d?d.getMTime():1}`;if(e.VBOBuildString!==f){const g={points:o.getPoints(),normals:c,tcoords:d,colors:a,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(w=>o.getPointData().getArrayByName(w))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:o.getVerts()},{inRep:"lines",cells:o.getLines()},{inRep:"polys",cells:o.getPolys()},{inRep:"strips",cells:o.getStrips()},{inRep:"polys",cells:o.getPolys()},{inRep:"strips",cells:o.getStrips()}],v=i.getProperty().getEdgeVisibility()&&l===ju.SURFACE;for(let w=$r.Start;w<$r.End;w++)w!==$r.TrisEdges&&w!==$r.TriStripsEdges?(g.cellOffset+=e.primitives[w].getCABO().createVBO(p[w].cells,p[w].inRep,l,g,e.selectionWebGLIdsToVTKIds),g.vertexOffset+=e.primitives[w].getCABO().getElementCount()):v?e.primitives[w].getCABO().createVBO(p[w].cells,p[w].inRep,ju.WIREFRAME,{...g,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[w].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=f}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(i=>{n+=i.getAllocatedGPUMemoryInBytes()}),n}}const Dj={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:Fi.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function D6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Dj,r),Ir.extend(t,e,r),ul.implementReplaceShaderCoincidentOffset(t,e,r),ul.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=$r,e.tmpMat3=Xo(new Float64Array(9)),e.tmpMat4=It(new Float64Array(16));for(let n=$r.Start;n<$r.End;n++)e.primitives[n]=lc.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ur(t,e,["context"]),e.VBOBuildTime={},Jn(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Jn(e.selectionStateChanged,{mtime:0}),bj(t,e)}const I6=zn(D6,"vtkOpenGLPolyDataMapper");var q1={newInstance:I6,extend:D6};ti("vtkMapper",I6);const{vtkErrorMacro:Pd}=Oi,{Representation:Ij}=Ph,{ObjectType:gg}=Ks,{PassTypes:Mj}=vw,Oj={type:"StartEvent"},Pj={type:"EndEvent"},Rj=64,Aj=16;function Lj(t,e,r){t[12]=(t[12]-e[0])*r[0],t[13]=(t[13]-e[1])*r[1],t[14]=(t[14]-e[2])*r[2],t[0]*=r[0],t[5]*=r[1],t[10]*=r[2]}function Nj(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const r={...t};t.renderPiece=(n,i)=>{if(t.invokeEvent(Oj),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(Pj),!e.currentInput){Pd("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const a=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!a&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.FRONT)):(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK)),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.multiply4x4WithOffset=(n,i,o,a)=>{const s=i[0],c=i[1],l=i[2],d=i[3],u=i[4],f=i[5],h=i[6],g=i[7],p=i[8],v=i[9],w=i[10],m=i[11],y=i[12],C=i[13],x=i[14],S=i[15];let T=o[a],_=o[a+1],E=o[a+2],D=o[a+3];n[0]=T*s+_*u+E*p+D*y,n[1]=T*c+_*f+E*v+D*C,n[2]=T*l+_*h+E*w+D*x,n[3]=T*d+_*g+E*m+D*S,T=o[a+4],_=o[a+5],E=o[a+6],D=o[a+7],n[4]=T*s+_*u+E*p+D*y,n[5]=T*c+_*f+E*v+D*C,n[6]=T*l+_*h+E*w+D*x,n[7]=T*d+_*g+E*m+D*S,T=o[a+8],_=o[a+9],E=o[a+10],D=o[a+11],n[8]=T*s+_*u+E*p+D*y,n[9]=T*c+_*f+E*v+D*C,n[10]=T*l+_*h+E*w+D*x,n[11]=T*d+_*g+E*m+D*S,T=o[a+12],_=o[a+13],E=o[a+14],D=o[a+15],n[12]=T*s+_*u+E*p+D*y,n[13]=T*c+_*f+E*v+D*C,n[14]=T*l+_*h+E*w+D*x,n[15]=T*d+_*g+E*m+D*S},t.replaceShaderNormal=(n,i,o)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=n.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=Re.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Re.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),n.Vertex=s}r.replaceShaderNormal(n,i,o)},t.replaceShaderClip=(n,i,o)=>{if(e.hardwareSupport){let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();a=Re.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,a=Re.substitute(a,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    vec4 gVertex = gMatrix * vertexMC;","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], gVertex);","    }"]).result,s=Re.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=Re.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s}r.replaceShaderClip(n,i,o)},t.replaceShaderColor=(n,i,o)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let d=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(d=d.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(d=d.concat(["varying vec4 vertexColorVSOutput;"]),a=Re.substitute(a,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,a=Re.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=Re.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Re.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=Re.substitute(c,"//VTK::Color::Impl",u).result,c=Re.substitute(c,"//VTK::Color::Dec",d).result,n.Vertex=a,n.Geometry=s,n.Fragment=c}r.replaceShaderColor(n,i,o)},t.replaceShaderPositionVC=(n,i,o)=>{if(e.hardwareSupport){let a=n.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=Re.substitute(a,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,a=Re.substitute(a,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(a=Re.substitute(a,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,a=Re.substitute(a,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),n.Vertex=a}r.replaceShaderPositionVC(n,i,o)},t.replaceShaderPicking=(n,i,o)=>{if(e.hardwareSupport){let a=n.Fragment,s=n.Vertex;s=Re.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=Re.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,n.Vertex=s,a=Re.substitute(a,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,a=Re.substitute(a,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,n.Fragment=a}else r.replaceShaderPicking(n,i,o)},t.updateGlyphShaderParameters=(n,i,o,a,s,c,l,d)=>{const u=o.getProgram();if(n){const f=e.normalMatrix,h=c,g=l*9,p=e.tmpMat3,v=f[0],w=f[1],m=f[2],y=f[3],C=f[4],x=f[5],S=f[6],T=f[7],_=f[8],E=h[g],D=h[g+1],b=h[g+2],I=h[g+3],O=h[g+4],M=h[g+5],R=h[g+6],A=h[g+7],G=h[g+8];p[0]=E*v+D*y+b*S,p[1]=E*w+D*C+b*T,p[2]=E*m+D*x+b*_,p[3]=I*v+O*y+M*S,p[4]=I*w+O*C+M*T,p[5]=I*m+O*x+M*_,p[6]=R*v+A*y+G*S,p[7]=R*w+A*C+G*T,p[8]=R*m+A*x+G*_,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),a){const f=a.getData();e.tmpColor[0]=f[l*4]/255,e.tmpColor[1]=f[l*4+1]/255,e.tmpColor[2]=f[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}d&&u.setUniform3fArray("mapperIndex",d.getPropColorValue())},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation(),a=e.context,s=i.getProperty().getEdgeVisibility()&&o===Ij.SURFACE,c=e.openGLCamera.getKeyMatrices(n),l=e.openGLActor.getKeyMatrices();vu(e.normalMatrix,c.normalMatrix,l.normalMatrix),Wt(e.mcpcMatrix,c.wcpc,l.mcwc),Wt(e.mcvcMatrix,c.wcvc,l.mcwc);const d=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),f=e.renderable.getColorArray(),h=d.length/16;let g=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===Mj.COMPOSITE_INDEX_PASS&&(g=!0);for(let p=e.primTypes.Start;p<e.primTypes.End;p++){const v=e.primitives[p].getCABO();if(v.getElementCount()){e.drawingEdges=s&&(p===e.primTypes.TrisEdges||p===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[p],e.primitives[p].updateShaders(n,i,t);const w=e.primitives[p].getProgram(),m=e.primitives[p].getOpenGLMode(o),y=w.isUniformUsed("normalMatrix"),C=w.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(m,0,v.getElementCount(),h):a.drawArraysInstanced(m,0,v.getElementCount(),h);else for(let x=0;x<h;++x)g&&e._openGLRenderer.getSelector().renderCompositeIndex(x),t.updateGlyphShaderParameters(y,C,e.primitives[p],f,d,u,x,g?e._openGLRenderer.getSelector():null),a.drawArrays(m,0,v.getElementCount())}}},t.setMapperShaderParameters=(n,i,o)=>{if(n.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){n.getProgram().isAttributeUsed("gMatrix")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||Pd("Error setting gMatrix in shader VAO."):n.getVAO().removeAttributeArray("gMatrix"),n.getProgram().isAttributeUsed("gNormal")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||Pd("Error setting gNormal in shader VAO."):n.getVAO().removeAttributeArray("gNormal"),n.getProgram().isAttributeUsed("gColor")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||Pd("Error setting gColor in shader VAO."):n.getVAO().removeAttributeArray("gColor"),n.getProgram().isAttributeUsed("mapperIndexVS")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||Pd("Error setting mapperIndexVS in shader VAO."):n.getVAO().removeAttributeArray("mapperIndexVS"),r.setMapperShaderParameters(n,i,o),n.getAttributeUpdateTime().modified();return}r.setMapperShaderParameters(n,i,o)},t.getNeedToRebuildBufferObjects=(n,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:r.getNeedToRebuildBufferObjects(n,i)),t.getNeedToRebuildShaders=(n,i,o)=>!!(r.getNeedToRebuildShaders(n,i,o)||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(n,i)=>{const o=e.renderable.getMatrixArray(),a=e.renderable.getInputData(0).getPoints(),{useShiftAndScale:s,coordShift:c,coordScale:l}=uw(a);if(e.hardwareSupport){const d=e.renderable.getNormalArray(),u=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=Ks.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=Ks.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=Ks.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=Ks.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),s){const f=o.buffer;for(let h=0;h<o.byteLength;h+=Rj){const g=new Float32Array(f,h,Aj);Lj(g,c,l)}}if(e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(o,gg.ARRAY_BUFFER),e.normalBuffer.upload(d,gg.ARRAY_BUFFER),u?e.colorBuffer.upload(u.getData(),gg.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const f=o.length/16,h=new Uint8Array(4*f);for(let g=0;g<f;++g){let p=g+1;const v=g*4;h[v]=p%256,p-=h[v],p/=256,h[v+1]=p%256,p-=h[v+1],p/=256,h[v+2]=p%256,h[v+3]=255}e.pickBuffer.upload(h,gg.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}if(r.buildBufferObjects(n,i),s)for(let d=Ba.Start;d<Ba.End;d++)e.primitives[d].getCABO().setCoordShiftAndScale(c,l)}}const Vj={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function kj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vj,r),q1.extend(t,e,r),e.tmpMat3=Xo(new Float64Array(9)),e.normalMatrix=Xo(new Float64Array(9)),e.mcpcMatrix=It(new Float64Array(16)),e.mcvcMatrix=It(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},Jn(e.glyphBOBuildTime,{mtime:0}),Nj(t,e)}const M6=zn(kj,"vtkOpenGLGlyph3DMapper");var Fj={newInstance:M6};ti("vtkGlyph3DMapper",M6);const{vtkErrorMacro:ES}=Oi;function Uj(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=r=>{if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=(r,n)=>{if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const o=e._openGLRenderer.getRenderable(),a=e.openGLCamera.getKeyMatrices(o),s=new Float64Array(16);if(Cr(s,a.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=o.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const n=new Float32Array(12);for(let s=0;s<4;s++)n[s*3]=s%2*2-1,n[s*3+1]=s>1?1:-1,n[s*3+2]=1;const i=Ot.newInstance({numberOfComponents:3,values:n});i.setName("points");const o=new Uint16Array(8);o[0]=3,o[1]=0,o[2]=1,o[3]=3,o[4]=3,o[5]=0,o[6]=3,o[7]=2;const a=Ot.newInstance({numberOfComponents:1,values:o});e.tris.getCABO().createVBO(a,"polys",vo.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||ES("Error setting vertexMC in shader VAO."));const r=e.renderable.getTextures();r.length||ES("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==r[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(r[0]))}}const Bj={context:null};function Gj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bj,r),Ir.extend(t,e,r),e.openGLTexture=$n.newInstance(),e.tris=lc.newInstance(),e.keyMatrixTime={},Jn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Xo(new Float64Array(9)),mcwc:It(new Float64Array(16))},Ur(t,e,["context"]),ji(t,e,["activeTextures"]),Uj(t,e)}const O6=zn(Gj);var Wj={newInstance:O6};ti("vtkSkybox",O6);var $j=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:zj}=Oi;function jj(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const r={...t};t.getShaderTemplate=(n,i,o)=>{n.Vertex=$j,n.Fragment=Ih,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Re.substitute(a,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Re.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=Re.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Re.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Re.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=Re.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Re.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,r.replaceShaderValues(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{if(n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&n.getProgram().isAttributeUsed("offsetMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"offsetMC",12,n.getCABO().getStride(),e.context.FLOAT,2,!1)||zj("Error setting 'offsetMC' in shader VAO.")),n.getProgram().isUniformUsed("invertedDepth")&&n.getProgram().setUniformf("invertedDepth",e.invert?-1:1),n.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?n.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):n.getProgram().setUniformf("scaleFactor",1)}r.setMapperShaderParameters(n,i,o)},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);a.isUniformUsed("VCPCMatrix")&&a.setUniformMatrix("VCPCMatrix",c.vcpc);const l=new Float64Array(16);if(a.isUniformUsed("MCVCMatrix"))if(o.getIsIdentity())fr(l,c.wcvc),n.getCABO().getCoordShiftAndScaleEnabled()&&Wt(l,l,n.getCABO().getInverseShiftAndScaleMatrix()),a.setUniformMatrix("MCVCMatrix",l);else{const d=e.openGLActor.getKeyMatrices();Wt(l,c.wcvc,d.mcwc),n.getCABO().getCoordShiftAndScaleEnabled()&&Wt(l,l,n.getCABO().getInverseShiftAndScaleMatrix()),a.setUniformMatrix("MCVCMatrix",l)}a.isUniformUsed("cameraParallel")&&n.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(n,i)=>e.context.TRIANGLES,t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=o.getPointData(),l=o.getPoints(),d=l.getNumberOfPoints(),u=l.getData(),f=5;let h=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(h=c.getArray(e.renderable.getScaleArray()).getData());let g=null,p=0,v=null;a?(p=a.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),g=a.getData(),v=new Uint8Array(3*d*4),s.getColorBO()||s.setColorBO(Ks.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(p);const w=new Float32Array(f*d*3);s.setStride(f*4);const m=Math.cos(cr(30));let y=0,C=0;const{useShiftAndScale:x,coordShift:S,coordScale:T}=uw(l);x&&s.setCoordShiftAndScale(S,T);let _=0,E=0;for(let D=0;D<d;++D){let b=e.renderable.getRadius();h&&(b=h[D]),y=D*3;const I=(u[y++]-S[0])*T[0],O=(u[y++]-S[1])*T[1],M=(u[y++]-S[2])*T[2];w[_++]=I,w[_++]=O,w[_++]=M,w[_++]=-2*b*m,w[_++]=-b,g&&(C=D*p,v[E++]=g[C],v[E++]=g[C+1],v[E++]=g[C+2],v[E++]=g[C+3]),w[_++]=I,w[_++]=O,w[_++]=M,w[_++]=2*b*m,w[_++]=-b,g&&(v[E++]=g[C],v[E++]=g[C+1],v[E++]=g[C+2],v[E++]=g[C+3]),w[_++]=I,w[_++]=O,w[_++]=M,w[_++]=0,w[_++]=2*b,g&&(v[E++]=g[C],v[E++]=g[C+1],v[E++]=g[C+2],v[E++]=g[C+3])}s.setElementCount(_/f),s.upload(w,Ys.ARRAY_BUFFER),a&&s.getColorBO().upload(v,Ys.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const Hj={};function Xj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hj,r),q1.extend(t,e,r),jj(t,e)}const P6=zn(Xj,"vtkOpenGLSphereMapper");var Kj={newInstance:P6};ti("vtkSphereMapper",P6);var qj=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:pg}=Oi;function Yj(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const r={...t};t.getShaderTemplate=(n,i,o)=>{n.Vertex=qj,n.Fragment=Ih,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Re.substitute(a,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Re.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=Re.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Re.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Re.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=Re.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Re.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,r.replaceShaderValues(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("orientMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"orientMC",12,n.getCABO().getStride(),e.context.FLOAT,3,!1)||pg("Error setting 'orientMC' in shader VAO.")),n.getProgram().isAttributeUsed("offsetMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"offsetMC",0,n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||pg("Error setting 'offsetMC' in shader VAO.")),n.getProgram().isAttributeUsed("radiusMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"radiusMC",24,n.getCABO().getStride(),e.context.FLOAT,1,!1)||pg("Error setting 'radiusMC' in shader VAO."))),r.setMapperShaderParameters(n,i,o)},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(a.isUniformUsed("VCPCMatrix")&&a.setUniformMatrix("VCPCMatrix",c.vcpc),o.getIsIdentity())a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",c.wcvc),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(a.isUniformUsed("MCVCMatrix")){const d=new Float64Array(16);Wt(d,c.wcvc,l.mcwc),a.setUniformMatrix("MCVCMatrix",d)}if(a.isUniformUsed("normalMatrix")){const d=new Float64Array(9);vu(d,c.normalMatrix,l.normalMatrix),a.setUniformMatrix3x3("normalMatrix",d)}}a.isUniformUsed("cameraParallel")&&n.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(n,i)=>e.context.TRIANGLES,t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=o.getPointData(),l=o.getPoints(),d=l.getNumberOfPoints(),u=l.getData();let f=3;f+=4;let h=null,g=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(Ks.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),a&&(g=a.getNumberOfComponents(),s.setColorOffset(4),h=a.getData(),s.setColorBOStride(8)),s.setColorComponents(g),s.setStride(f*4);const p=new Float32Array(f*d*12),v=new Uint8Array(12*d*(h?8:4));let w=null,m=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(w=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?m=c.getArray(e.renderable.getOrientationArray()).getData():pg([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const y=[0,1,3,0,3,2,2,3,5,2,5,4];let C=0,x=0,S=0,T=0;for(let _=0;_<d;++_){let E=e.renderable.getLength(),D=e.renderable.getRadius();w&&(E=w[_*2],D=w[_*2+1]);for(let b=0;b<y.length;++b)C=_*3,p[S++]=u[C++],p[S++]=u[C++],p[S++]=u[C++],C=_*3,p[S++]=m[C++]*E,p[S++]=m[C++]*E,p[S++]=m[C++]*E,p[S++]=D,v[T++]=255*(y[b]%2),v[T++]=y[b]>=4?255:0,v[T++]=y[b]>=2?255:0,v[T++]=255,x=_*g,h&&(v[T++]=h[x],v[T++]=h[x+1],v[T++]=h[x+2],v[T++]=h[x+3])}s.setElementCount(S/f),s.upload(p,Ys.ARRAY_BUFFER),s.getColorBO().upload(v,Ys.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const Jj={};function Zj(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jj,r),q1.extend(t,e,r),Yj(t,e)}const R6=zn(Zj,"vtkOpenGLStickMapper");var Qj={newInstance:R6};ti("vtkStickMapper",R6);function eH(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper");const r=new Map;function n(a,s){if(!s)return;const l=(r.get(s)??0)-1;l<=0?(a.unregisterGraphicsResourceUser(s,t),r.delete(s)):r.set(s,l)}function i(a,s){if(!s)return;const c=r.get(s)??0,l=c+1;r.set(s,l),c<=0&&a.registerGraphicsResourceUser(s,t)}function o(a,s,c){s!==c&&(n(a,s),i(a,c))}t.renderPiece=(a,s)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update();const c=e.renderable.getNumberOfInputPorts();e.currentValidInputs=[];for(let d=0;d<c;++d){const u=e.renderable.getInputData(d);u&&!u.isDeleted()&&e.currentValidInputs.push({imageData:u,inputIndex:d})}let l=0;if(e.currentValidInputs.length>0){const d=s.getProperties(),u=e.currentValidInputs[0],f=u.imageData,h=d[u.inputIndex];h.getShade()&&e.renderable.getBlendMode()===uf.COMPOSITE_BLEND&&a.getLights().forEach(w=>{w.getSwitch()>0&&l++});const g=e.currentValidInputs.length,p=g>1,{numberOfComponents:v}=f.get("numberOfComponents");e.numberOfComponents=p?g:v,e.numberOfComponents>1?e.useIndependentComponents=h.getIndependentComponents():e.useIndependentComponents=!1}l!==e.numberOfLights&&(e.numberOfLights=l,t.modified()),t.invokeEvent({type:"EndEvent"}),e.currentValidInputs.length!==0&&(t.renderPieceStart(a,s),t.renderPieceDraw(a,s),t.renderPieceFinish(a,s))},t.buildBufferObjects=(a,s)=>{if(!e.jitterTexture.getHandle()){const I=new Float32Array(1024);for(let O=0;O<1024;++O)I[O]=Math.random();e.jitterTexture.setMinificationFilter(Dt.NEAREST),e.jitterTexture.setMagnificationFilter(Dt.NEAREST),e.jitterTexture.create2DFromRaw({width:32,height:32,numComps:1,dataType:Zt.FLOAT,data:I})}const c=s.getProperties(),l=e.currentValidInputs[0],d=c[l.inputIndex],u=e.numberOfComponents,f=e.useIndependentComponents,h=f?u:1,g=[];for(let I=0;I<h;++I)g.push(d.getScalarOpacity(I));const p=ts(g,f,h),v=d.getScalarOpacity(),w=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!w?.oglObject?.getHandle()||w.hash!==p){const I=$n.newInstance();I.setOpenGLRenderWindow(e._openGLRenderWindow);let O=e.renderable.getOpacityTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*2*h,R=new Float32Array(M),A=new Float32Array(O);for(let G=0;G<h;++G){const k=d.getScalarOpacity(G),L=t.getCurrentSampleDistance(a)/d.getScalarOpacityUnitDistance(G),F=k.getRange();k.getTable(F[0],F[1],O,A,1);for(let j=0;j<O;++j)R[G*O*2+j]=1-(1-A[j])**L,R[G*O*2+j+O]=R[G*O*2+j]}if(I.resetFormatAndType(),I.setMinificationFilter(Dt.LINEAR),I.setMagnificationFilter(Dt.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))I.create2DFromRaw({width:O,height:2*h,numComps:1,dataType:Zt.FLOAT,data:R});else{const G=new Uint8ClampedArray(M);for(let k=0;k<M;++k)G[k]=255*R[k];I.create2DFromRaw({width:O,height:2*h,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:G})}v&&e._openGLRenderWindow.setGraphicsResourceForObject(v,I,p),e.opacityTexture=I}else e.opacityTexture=w.oglObject;o(e._openGLRenderWindow,e._opacityTextureCore,v),e._opacityTextureCore=v;const y=[];for(let I=0;I<h;++I)y.push(d.getRGBTransferFunction(I));const C=ts(y,f,h),x=d.getRGBTransferFunction(),S=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!S?.oglObject?.getHandle()||S?.hash!==C){const I=$n.newInstance();I.setOpenGLRenderWindow(e._openGLRenderWindow);let O=e.renderable.getColorTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=O*2*h*3,R=new Uint8ClampedArray(M),A=new Float32Array(O*3);for(let G=0;G<h;++G){const k=d.getRGBTransferFunction(G),L=k.getRange();k.getTable(L[0],L[1],O,A,1);for(let F=0;F<O*3;++F)R[G*O*6+F]=255*A[F],R[G*O*6+F+O*3]=255*A[F]}I.resetFormatAndType(),I.setMinificationFilter(Dt.LINEAR),I.setMagnificationFilter(Dt.LINEAR),I.create2DFromRaw({width:O,height:2*h,numComps:3,dataType:Zt.UNSIGNED_CHAR,data:R}),e._openGLRenderWindow.setGraphicsResourceForObject(x,I,C),e.colorTexture=I}else e.colorTexture=S.oglObject;o(e._openGLRenderWindow,e._colorTextureCore,x),e._colorTextureCore=x,e.currentValidInputs.forEach(({imageData:I,inputIndex:O},M)=>{if(e.scalarTextures||(e.scalarTextures=[]),!e.scalarTextures[M]){console.warn(`ScalarTexture for component ${M} not initialized, skipping.`);return}const R=e.scalarTextures[M],A=`${I.getMTime()}-${R.getMTime()}`;if(e.scalarTextureStrings||(e.scalarTextureStrings=[]),e.scalarTextureStrings[M]!==A){const G=I.getDimensions();R.setOpenGLRenderWindow(e._openGLRenderWindow),R.enableUseHalfFloat(!1);const k=R.getTextureParameters(),L=I.get("dataType").dataType;let F=!0;if(k?.dataType===L&&k?.width===G[0]&&k?.height===G[1]&&k?.depth===G[2]&&(F=!1),F){const j=e.context.getExtension("EXT_texture_norm16");R.setOglNorm16Ext(WR()?j:null),R.resetFormatAndType(),R.setTextureParameters({width:G[0],height:G[1],depth:G[2],numberOfComponents:h,dataType:L}),R.create3DFromRaw({width:G[0],height:G[1],depth:G[2],numComps:h,dataType:L,data:null}),R.update3DFromRaw()}else R.deactivate(),R.update3DFromRaw();e.scalarTextureStrings[M]=A}e._scalarTexturesCore||(e._scalarTexturesCore=[])});const _=d.getLabelOutlineThickness(),E=e._openGLRenderWindow.getGraphicsResourceForObject(_),D=_.join("-");if(!E?.oglObject?.getHandle()||E?.hash!==D){const I=$n.newInstance();I.setOpenGLRenderWindow(e._openGLRenderWindow);let O=e.renderable.getLabelOutlineTextureWidth();O<=0&&(O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE));const M=1,R=O*M,A=new Uint8Array(R);for(let G=0;G<O;++G){const k=typeof _[G]<"u"?_[G]:_[0];A[G]=k}I.resetFormatAndType(),I.setMinificationFilter(Dt.NEAREST),I.setMagnificationFilter(Dt.NEAREST),I.create2DFromRaw({width:O,height:M,numComps:1,dataType:Zt.UNSIGNED_CHAR,data:A}),_&&e._openGLRenderWindow.setGraphicsResourceForObject(_,I,D),e.labelOutlineThicknessTexture=I}else e.labelOutlineThicknessTexture=E.oglObject;if(o(e._openGLRenderWindow,e._labelOutlineThicknessTextureCore,_),e._labelOutlineThicknessTextureCore=_,!e.tris.getCABO().getElementCount()){const I=new Float32Array(12);for(let A=0;A<4;A++)I[A*3]=A%2*2-1,I[A*3+1]=A>1?1:-1,I[A*3+2]=-1;const O=new Uint16Array(8);O[0]=3,O[1]=0,O[2]=1,O[3]=3,O[4]=3,O[5]=0,O[6]=3,O[7]=2;const M=Ot.newInstance({numberOfComponents:3,values:I});M.setName("points");const R=Ot.newInstance({numberOfComponents:1,values:O});e.tris.getCABO().createVBO(R,"polys",vo.SURFACE,{points:M,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(a,s)=>{if(e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<s.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<s.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.colorTexture?.getMTime()||e.VBOBuildTime.getMTime()<e.labelOutlineThicknessTexture?.getMTime()||!e.colorTexture?.getHandle()||!e.labelOutlineThicknessTexture?.getHandle())return!0;if(e.scalarTextures&&e.scalarTextures.length>0)for(let c=0;c<e.scalarTextures.length;c++){const l=e.scalarTextures[c];if(l&&(e.VBOBuildTime.getMTime()<l.getMTime()||!l.getHandle()))return!0}if(e.currentValidInputs&&e.currentValidInputs.length>0)for(let c=0;c<e.currentValidInputs.length;c++){const l=e.currentValidInputs[c];if(l&&l.imageData&&e.VBOBuildTime.getMTime()<l.imageData.getMTime())return!0}return!1}}const tH={};function nH(t,e,r={}){Object.assign(e,tH,r),Vb.extend(t,e,r),r.scalarTexture?e.scalarTextures=[r.scalarTexture]:e.scalarTextures=[],e.scalarTextureStrings=[],e._scalarTexturesCore=[],e.previousState={},eH(t,e)}const rH=Z.newInstance(nH,"vtkStreamingOpenGLVolumeMapper"),iH={newInstance:rH},A6=Object.create(null);function Yr(t,e){A6[t]=e}function oH(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,i=r.getClassName(n++),o=!1;const a=Object.keys(e.overrides);for(;i&&!o;)a.includes(i)?o=!0:i=r.getClassName(n++);if(!o)return null;const s=e.getModelInitialValues(r),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=A6,e.getModelInitialValues=r=>{const n={};return r.getClassName()==="vtkSharedVolumeMapper"&&(n.scalarTexture=r.getScalarTexture()),n}}const aH={};function L6(t,e,r={}){Object.assign(e,aH,r),sw.extend(t,e,r),oH(t,e),Yr("vtkActor",Yz.newInstance),Yr("vtkActor2D",ej.newInstance),Yr("vtkCamera",Pk.newInstance),Yr("vtkGlyph3DMapper",Fj.newInstance),Yr("vtkImageMapper",JB.newInstance),Yr("vtkImageCPRMapper",nG.newInstance),Yr("vtkImageSlice",aG.newInstance),Yr("vtkMapper",q1.newInstance),Yr("vtkPixelSpaceCallbackMapper",_G.newInstance),Yr("vtkRenderer",Vk.newInstance),Yr("vtkSkybox",Wj.newInstance),Yr("vtkSphereMapper",Kj.newInstance),Yr("vtkStickMapper",Qj.newInstance),Yr("vtkTexture",$n.newInstance),Yr("vtkVolume",uG.newInstance),Yr("vtkVolumeMapper",Vb.newInstance),Yr("vtkSharedVolumeMapper",iH.newInstance)}const sH=Z.newInstance(L6,"vtkStreamingOpenGLViewNodeFactory"),cH={newInstance:sH,extend:L6};function lH(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function N6(t,e,r={}){Object.assign(e,r),Hz.extend(t,e,r),e.myFactory=cH.newInstance(),Yr("vtkRenderWindow",V6),lH(t,e)}const V6=Z.newInstance(N6,"vtkStreamingOpenGLRenderWindow"),uH={newInstance:V6,extend:N6},{vtkDebugMacro:mg}=Z;function dH(t,e){e.classHierarchy.push("vtkCamera");const r=new Float64Array(3),n=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),o=It(new Float64Array(16)),a=It(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),d=It(new Float64Array(16)),u=It(new Float64Array(16)),f=new Float64Array(3),h=new Float64Array(3);function g(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,v,w)=>{p===e.position[0]&&v===e.position[1]&&w===e.position[2]||(e.position[0]=p,e.position[1]=v,e.position[2]=w,t.computeDistance(),t.modified())},t.setFocalPoint=(p,v,w)=>{p===e.focalPoint[0]&&v===e.focalPoint[1]&&w===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=v,e.focalPoint[2]=w,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,mg("Distance is set to minimum."));const v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],v=e.focalPoint[1]-e.position[1],w=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+v*v+w*w),e.distance<1e-20){e.distance=1e-20,mg("Distance is set to minimum.");const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=v/e.distance,e.directionOfProjection[2]=w/e.distance,g()},t.dolly=p=>{if(p<=0)return;const v=e.distance/p;t.setPosition(e.focalPoint[0]-v*e.directionOfProjection[0],e.focalPoint[1]-v*e.directionOfProjection[1],e.focalPoint[2]-v*e.directionOfProjection[2])},t.roll=p=>{const v=e.position,w=e.focalPoint,m=e.viewUp,y=new Float64Array([m[0],m[1],m[2],0]);It(d);const C=new Float64Array([w[0]-v[0],w[1]-v[1],w[2]-v[2]]);Zr(d,d,cr(p),C),$s(y,y,d),e.viewUp[0]=y[0],e.viewUp[1]=y[1],e.viewUp[2]=y[2],t.modified()},t.azimuth=p=>{const v=e.focalPoint;It(u),Xn(u,u,v),Zr(u,u,cr(p),e.viewUp),Xn(u,u,[-v[0],-v[1],-v[2]]),Vt(f,e.position,u),t.setPosition(f[0],f[1],f[2])},t.yaw=p=>{const v=e.position;It(u),Xn(u,u,v),Zr(u,u,cr(p),e.viewUp),Xn(u,u,[-v[0],-v[1],-v[2]]),Vt(h,e.focalPoint,u),t.setFocalPoint(h[0],h[1],h[2])},t.elevation=p=>{const v=e.focalPoint,w=t.getViewMatrix(),m=[-w[0],-w[1],-w[2]];It(u),Xn(u,u,v),Zr(u,u,cr(p),m),Xn(u,u,[-v[0],-v[1],-v[2]]),Vt(f,e.position,u),t.setPosition(f[0],f[1],f[2])},t.pitch=p=>{const v=e.position,w=t.getViewMatrix(),m=[w[0],w[1],w[2]];It(u),Xn(u,u,v),Zr(u,u,cr(p),m),Xn(u,u,[-v[0],-v[1],-v[2]]),Vt(h,e.focalPoint,u),t.setFocalPoint(...h)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,v,w)=>{const m=[p,v,w];R0(e.position,m,e.position),R0(e.focalPoint,m,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const v=[...e.viewUp,1],w=[],m=[],y=[];v[0]+=e.position[0],v[1]+=e.position[1],v[2]+=e.position[2],$s(w,[...e.position,1],p),$s(m,[...e.focalPoint,1],p),$s(y,v,p),y[0]-=w[0],y[1]-=w[1],y[2]-=w[2],t.setPosition(...w.slice(0,3)),t.setFocalPoint(...m.slice(0,3)),t.setViewUp(...y.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let v=p;v<1e-20&&(v=1e-20,mg("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+v)},t.setThicknessFromFocalPoint=p=>{let v=p;v<1e-20&&(v=1e-20,mg("Thickness is set to minimum.")),t.setClippingRange(e.distance-v/2,e.distance+v/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,v)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Float64Array(24);const w=[[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1],[0,0,1,1],[0,0,-1,1]],m=t.getCompositeProjectionMatrix(p,-1,1);for(let y=0;y<6;y++)$s(w[y],w[y],m),tL(w[y]),v[4*y+0]=w[y][0],v[4*y+1]=w[y][1],v[4*y+2]=w[y][2],v[4*y+3]=w[y][3];return v},t.getCameraLightTransformMatrix=p=>(fr(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{fr(o,t.getViewMatrix()),Cr(o,o),k1(a,[e.distance,e.distance,e.distance]),Wt(o,o,a),It(e.cameraLightTransform),Xn(e.cameraLightTransform,o,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const v=L3(p[0],p[1],p[2],p[3]),w=tc(),m=L3(0,0,1,0);return xV(w,v),A3(m,v,m),A3(m,m,w),[m[0],m[1],m[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),Cr(p,p)},t.getWorldToPhysicalMatrix=p=>{It(p);const v=[3];Bi(e.physicalViewNorth,e.physicalViewUp,v),p[0]=v[0],p[1]=v[1],p[2]=v[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],Mn(p,p),Ji(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),es(p,p,s),Xn(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{Cr(o,p),Vt(s,r,o),t.computeDistance();const v=e.distance;t.setPosition(s[0],s[1],s[2]),Vt(c,n,o),an(c,c,s),Lt(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),Vt(l,i,o),an(l,l,s),Lt(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(v)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(o),Wt(o,p,o),t.computeViewParametersFromViewMatrix(o)},t.setModelTransformMatrix=p=>{e.modelTransformMatrix=p},t.getModelTransformMatrix=()=>e.modelTransformMatrix,t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(fr(o,e.viewMatrix),t.computeViewParametersFromViewMatrix(o),Mn(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.modelTransformMatrix?(Wt(o,e.viewMatrix,e.modelTransformMatrix),o):e.viewMatrix;$5(o,e.position,e.focalPoint,e.viewUp),Mn(o,o);const p=new Float64Array(16);return e.modelTransformMatrix?Wt(p,o,e.modelTransformMatrix):fr(p,o),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,v,w)=>{const m=new Float64Array(16);if(It(m),e.projectionMatrix){const x=1/e.physicalScale;return Ji(s,x,x,x),fr(m,e.projectionMatrix),es(m,m,s),Mn(m,m),m}It(o);const y=e.clippingRange[1]-e.clippingRange[0],C=[e.clippingRange[0]+(v+1)*y/2,e.clippingRange[0]+(w+1)*y/2];if(e.parallelProjection){const x=e.parallelScale*p,S=e.parallelScale,T=(e.windowCenter[0]-1)*x,_=(e.windowCenter[0]+1)*x,E=(e.windowCenter[1]-1)*S,D=(e.windowCenter[1]+1)*S;W5(o,T,_,E,D,C[0],C[1]),Mn(o,o)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const x=Math.tan(cr(e.viewAngle)/2);let S,T;e.useHorizontalViewAngle===!0?(S=e.clippingRange[0]*x,T=e.clippingRange[0]*x/p):(S=e.clippingRange[0]*x*p,T=e.clippingRange[0]*x);const _=(e.windowCenter[0]-1)*S,E=(e.windowCenter[0]+1)*S,D=(e.windowCenter[1]-1)*T,b=(e.windowCenter[1]+1)*T,I=C[0],O=C[1];o[0]=2*I/(E-_),o[5]=2*I/(b-D),o[2]=(_+E)/(E-_),o[6]=(D+b)/(b-D),o[10]=-(I+O)/(O-I),o[14]=-1,o[11]=-2*I*O/(O-I),o[15]=0}}return fr(m,o),m},t.getCompositeProjectionMatrix=(p,v,w)=>{const m=t.getViewMatrix(),y=t.getProjectionMatrix(p,v,w);return Wt(y,m,y),y},t.setDirectionOfProjection=(p,v,w)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===v&&e.directionOfProjection[2]===w)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=v,e.directionOfProjection[2]=w;const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,g()},t.setDeviceAngles=(p,v,w,m)=>{const y=[3];Bi(e.physicalViewNorth,e.physicalViewUp,y);const C=It(new Float64Array(16));Zr(C,C,cr(p),e.physicalViewUp),Zr(C,C,cr(v),y),Zr(C,C,cr(w),e.physicalViewNorth),Zr(C,C,cr(-m),e.physicalViewUp);const x=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),S=new Float64Array(e.physicalViewNorth);Vt(x,x,C),Vt(S,S,C),t.setDirectionOfProjection(x[0],x[1],x[2]),t.setViewUp(S[0],S[1],S[2]),t.modified()},t.setOrientationWXYZ=(p,v,w,m)=>{const y=It(new Float64Array(16));if(p!==0&&(v!==0||w!==0||m!==0)){const S=cr(p),T=tc();bh(T,[v,w,m],S),S0(y,T)}const C=new Float64Array(3);Vt(C,[0,0,-1],y);const x=new Float64Array(3);Vt(x,[0,1,0],y),t.setDirectionOfProjection(...C),t.setViewUp(...x),t.modified()},t.computeClippingRange=p=>{let v=null,w=null;v=e.viewPlaneNormal,w=e.position;const m=-v[0],y=-v[1],C=-v[2],x=-(m*w[0]+y*w[1]+C*w[2]),S=[m*p[0]+y*p[2]+C*p[4]+x,1e-18];for(let T=0;T<2;T++)for(let _=0;_<2;_++)for(let E=0;E<2;E++){const D=m*p[E]+y*p[2+_]+C*p[4+T]+x;S[0]=D<S[0]?D:S[0],S[1]=D>S[1]?D:S[1]}return S}}const fH={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,modelTransformMatrix:null,cameraLightTransform:fi(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function k6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fH,r),Z.obj(t,e),Z.get(t,e,["distance"]),Z.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),Z.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),Z.setGetArray(t,e,["clippingRange","windowCenter"],2),Z.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),dH(t,e)}const hH=Z.newInstance(k6,"vtkCamera");var Cw={newInstance:hH,extend:k6};function gH(t,e){e.classHierarchy.push("vtkLight");const r=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?Vt(r,e.position,e.transformMatrix):Ji(r,e.position[0],e.position[1],e.position[2]),r),t.getTransformedFocalPoint=()=>(e.transformMatrix?Vt(r,e.focalPoint,e.transformMatrix):Ji(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r),t.getDirection=()=>(e.directionMTime<e.mtime&&(rn(e.direction,e.focalPoint,e.position),wo(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=n=>{const i=new Float64Array(3);rn(i,e.position,n),e.focalPoint=i},t.setDirectionAngle=(n,i)=>{const o=cr(n),a=cr(i);t.setPosition(Math.cos(o)*Math.sin(a),Math.sin(o),Math.cos(o)*Math.cos(a)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const pH={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function mH(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pH,r),Z.obj(t,e),Z.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),Z.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),gH(t,e)}const vH=Z.newInstance(mH,"vtkLight");var yH={newInstance:vH};const{vtkErrorMacro:cp}=Z;function wH(t){return()=>cp(`vtkViewport::${t} - NOT IMPLEMENTED`)}function CH(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=n=>e.props.includes(n),t.addViewProp=n=>{n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=n=>{const i=e.props.filter(o=>o!==n);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(n);const o=n.getNestedProps();if(o&&o.length)for(let a=0;a<o.length;a++)r(o[a],i);return i}t.getViewPropsWithNestedProps=()=>{let n=[];const i=t.getActors2D();i.sort((a,s)=>a.getLayerNumber()-s.getLayerNumber());const o=e.props.filter(a=>!i.includes(a));for(let a=0;a<o.length;a++)r(o[a],n);return n=n.concat(i),n},t.addActor2D=t.addViewProp,t.removeActor2D=n=>{t.removeViewProp(n)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(n=>{e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D),t.displayToView=()=>cp("call displayToView on your view instead"),t.viewToDisplay=()=>cp("callviewtodisplay on your view instead"),t.getSize=()=>cp("call getSize on your View instead"),t.normalizedDisplayToProjection=(n,i,o)=>{const a=t.normalizedDisplayToNormalizedViewport(n,i,o);return t.normalizedViewportToProjection(a[0],a[1],a[2])},t.normalizedDisplayToNormalizedViewport=(n,i,o)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/a[0],(i-e.viewport[1])/a[1],o]},t.normalizedViewportToProjection=(n,i,o)=>[n*2-1,i*2-1,o*2-1],t.projectionToNormalizedDisplay=(n,i,o)=>{const a=t.projectionToNormalizedViewport(n,i,o);return t.normalizedViewportToNormalizedDisplay(a[0],a[1],a[2])},t.normalizedViewportToNormalizedDisplay=(n,i,o)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*a[0]+e.viewport[0],i*a[1]+e.viewport[1],o]},t.projectionToNormalizedViewport=(n,i,o)=>[(n+1)*.5,(i+1)*.5,(o+1)*.5],t.PickPropFrom=wH("PickPropFrom")}const xH={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function F6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xH,r),Z.obj(t,e),Z.event(t,e,"event"),Z.setGetArray(t,e,["viewport"],4),Z.setGetArray(t,e,["background","background2"],3),CH(t,e)}const SH=Z.newInstance(F6,"vtkViewport");var TH={newInstance:SH,extend:F6};const{vtkDebugMacro:Rd,vtkErrorMacro:Wc,vtkWarningMacro:_H}=Oi;function bS(t){return()=>Wc(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function EH(t,e){e.classHierarchy.push("vtkRenderer");const r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Rd("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const o=t.getActiveCameraAndResetIfCreated();e.lights.forEach(a=>{a.lightTypeIsSceneLight()||(a.lightTypeIsHeadLight()?(a.setPositionFrom(o.getPositionByReference()),a.setFocalPointFrom(o.getFocalPointByReference()),a.modified(o.getMTime())):a.lightTypeIsCameraLight()?a.setTransformMatrix(o.getCameraLightTransformMatrix(fi())):Wc("light has unknown light type",a.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=bS("allocateTime"),t.updateGeometry=bS("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=o=>{Rd(t.getClassName(),t,"setting Layer to ",o),e.layer!==o&&(e.layer=o,t.modified()),t.setPreserveColorBuffer(!!o)},t.setActiveCamera=o=>e.activeCamera===o?!1:(e.activeCamera=o,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:o}),!0),t.makeCamera=()=>{const o=Cw.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:o}),o},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(o=>{e.actors=e.actors.concat(o.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=o=>{e.actors=e.actors.filter(a=>a!==o),t.removeViewProp(o),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(a=>{t.removeViewProp(a)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(o=>{e.volumes=e.volumes.concat(o.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=o=>{e.volumes=e.volumes.filter(a=>a!==o),t.removeViewProp(o),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(a=>{t.removeViewProp(a)}),e.volumes=[],t.modified()},t.hasLight=o=>e.lights.includes(o),t.addLight=o=>{o&&!t.hasLight(o)&&(e.lights.push(o),t.modified())},t.removeLight=o=>{e.lights=e.lights.filter(a=>a!==o),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=o=>{e.lights=o,t.modified()},t.makeLight=yH.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(o,a,s,c)=>{let l=t.normalizedDisplayToProjection(o,a,s);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(o,a,s,c)=>{let l=t.worldToView(o,a,s);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(o,a,s)=>{if(e.activeCamera===null)return Wc("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Cr(c,c),Mn(c,c);const l=new Float64Array([o,a,s]);return Vt(l,l,c),l},t.projectionToView=(o,a,s,c)=>{if(e.activeCamera===null)return Wc("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);Cr(l,l),Mn(l,l);const d=new Float64Array([o,a,s]);return Vt(d,d,l),d},t.worldToView=(o,a,s)=>{if(e.activeCamera===null)return Wc("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Mn(c,c);const l=new Float64Array([o,a,s]);return Vt(l,l,c),l},t.viewToProjection=(o,a,s,c)=>{if(e.activeCamera===null)return Wc("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);Mn(l,l);const d=new Float64Array([o,a,s]);return Vt(d,d,l),d},t.computeVisiblePropBounds=()=>{e.allBounds[0]=bn.INIT_BOUNDS[0],e.allBounds[1]=bn.INIT_BOUNDS[1],e.allBounds[2]=bn.INIT_BOUNDS[2],e.allBounds[3]=bn.INIT_BOUNDS[3],e.allBounds[4]=bn.INIT_BOUNDS[4],e.allBounds[5]=bn.INIT_BOUNDS[5];let o=!0;t.invokeEvent(r);for(let a=0;a<e.props.length;++a){const s=e.props[a];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&Zg(c)&&(o=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return o&&(P5(e.allBounds),Rd("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!Zg(a))return Rd("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return Wc("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(a[0]+a[1])/2,s[1]=(a[2]+a[3])/2,s[2]=(a[4]+a[5])/2;let l=a[1]-a[0],d=a[3]-a[2],u=a[5]-a[4];l*=l,d*=d,u*=u;let f=l+d+u;f=f===0?1:f,f=Math.sqrt(f)*.5;const h=cr(e.activeCamera.getViewAngle()),g=f,p=f/Math.sin(h*.5),v=e.activeCamera.getViewUp();return Math.abs(jt(v,c))>.999&&(_H("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-v[2],v[0],v[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+p*c[0],s[1]+p*c[1],s[2]+p*c[2]),t.resetCameraClippingRange(a),e.activeCamera.setParallelScale(g),e.activeCamera.setPhysicalScale(f),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Zg(a))return Rd("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Wc("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(a);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=cr(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(n),!1},t.setRenderWindow=o=>{o!==e._renderWindow&&(e._vtkWindow=o,e._renderWindow=o)},t.visibleActorCount=()=>e.props.filter(o=>o.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let o=e.mtime;const a=e.activeCamera?e.activeCamera.getMTime():0;a>o&&(o=a);const s=e._createdLight?e._createdLight.getMTime():0;return s>o&&(o=s),o},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const bH={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Eu(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function U6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,bH,r),TH.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),ji(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Ur(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Q0(t,e,["actors","volumes","lights"]),w5(t,e,["background"],4,1),Sh(t,e,["renderWindow"]),EH(t,e)}const DH=zn(U6,"vtkRenderer");var B6={newInstance:DH,extend:U6};const IH={Unknown:0,LeftController:1,RightController:2},MH={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},OH={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},PH={LeftButton:1,MiddleButton:2,RightButton:3};var G6={Device:IH,Input:MH,Axis:OH,MouseButton:PH};const{Device:vg,Input:tu}=G6,{vtkWarningMacro:yg,vtkErrorMacro:wg,normalizeWheel:RH,vtkOnceErrorMacro:AH}=Z,Hu={ctrlKey:!1,altKey:!1,shiftKey:!1},S2={"xr-standard":[tu.Trigger,tu.Grip,tu.TrackPad,tu.Thumbstick,tu.A,tu.B]},xw=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Ad(t){t.cancelable&&t.preventDefault()}function Cg(t){const e=Object.create(null);return t.forEach(r=>{let{pointerId:n,position:i}=r;e[n]=i}),e}function LH(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const r={...t},n=new Set,i=new Map;let o=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{wg("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>yg("empty event loop");function a(p,v){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,v))}t.getCurrentRenderer=()=>(e.currentRenderer||a(0,0),e.currentRenderer);function s(p){const v=e._view.getCanvas(),w=v.getBoundingClientRect(),m=v.width/w.width,y=v.height/w.height,C={x:m*(p.clientX-w.left),y:y*(w.height-p.clientY+w.top),z:0,movementX:m*p.movementX,movementY:y*p.movementY};return(i.size<=1||!e.currentRenderer)&&a(C.x,C.y),C}const c=e._getScreenEventPositionFor||s;function l(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function d(p){const v=l(p);return{key:p.key,keyCode:p.charCode,...v}}function u(p){return p.pointerType||""}const f=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",Ad),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),p.addEventListener("keypress",t.handleKeyPress),p.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.tabIndex=0,p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;r.setContainer(p)&&f()};const h=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,o=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",Ad),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel),p.removeEventListener("keypress",t.handleKeyPress),p.removeEventListener("keydown",t.handleKeyDown)),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{h(),r.setContainer(null)},t.handleKeyPress=p=>{const v=d(p);t.keyPressEvent(v)},t.handleKeyDown=p=>{const v=d(p);t.keyDownEvent(v)},t.handleKeyUp=p=>{const v=d(p);t.keyUpEvent(v)},t.handlePointerEnter=p=>{const v={...l(p),position:c(p),deviceType:u(p)};t.pointerEnterEvent(v),v.deviceType==="mouse"&&t.mouseEnterEvent(v)},t.handlePointerLeave=p=>{const v={...l(p),position:c(p),deviceType:u(p)};t.pointerLeaveEvent(v),v.deviceType==="mouse"&&t.mouseLeaveEvent(v)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&Ad(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),i.has(p.pointerId)&&yg("[RenderWindowInteractor] duplicate pointerId detected"),i.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(i.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&Ad(p),i.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(i.has(p.pointerId))switch(i.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(i.has(p.pointerId)){const v=i.get(p.pointerId);v.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const v={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonPressEvent(v);break;case 1:t.middleButtonPressEvent(v);break;case 2:t.rightButtonPressEvent(v);break;default:wg(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>document.exitPointerLock?.(),t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function g(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){wg("undefined requester, can not start animating");return}if(n.has(p)){yg("requester is already registered for animating");return}n.add(p),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const v=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,v),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(p)){if(!v){const w=p&&p.getClassName?p.getClassName():p;yg(`${w} did not request an animation`)}return}n.delete(p),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,v,w)=>{p.inputSources.forEach(m=>{const y=m.gripSpace==null?null:v.getPose(m.gripSpace,w),C=m.gripSpace==null?null:v.getPose(m.targetRaySpace,w),x=m.gamepad,S=m.handedness;if(x){x.index in e.lastGamepadValues||(e.lastGamepadValues[x.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let T=0;T<x.buttons.length;++T)T in e.lastGamepadValues[x.index][S].buttons||(e.lastGamepadValues[x.index][S].buttons[T]=!1),e.lastGamepadValues[x.index][S].buttons[T]!==x.buttons[T].pressed&&y!=null&&(t.button3DEvent({gamepad:x,position:y.transform.position,orientation:y.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,pressed:x.buttons[T].pressed,device:m.handedness==="left"?vg.LeftController:vg.RightController,input:S2[x.mapping]&&S2[x.mapping][T]?S2[x.mapping][T]:tu.Trigger}),e.lastGamepadValues[x.index][S].buttons[T]=x.buttons[T].pressed),e.lastGamepadValues[x.index][S].buttons[T]&&y!=null&&t.move3DEvent({gamepad:x,position:y.transform.position,orientation:y.transform.orientation,targetPosition:C.transform.position,targetOrientation:C.transform.orientation,device:m.handedness==="left"?vg.LeftController:vg.RightController})}})},t.handleMouseMove=p=>{const v={...l(p),position:c(p),deviceType:u(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(v):(t.mouseMoveEvent(v),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),g(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{Ad(p);const v={...RH(p),...l(p),position:c(p),deviceType:u(p)};e.wheelTimeoutID===0&&(Math.abs(v.spinY)>=.3?o=Math.abs(v.spinY):o=1),v.spinY/=o,e.wheelTimeoutID===0?(t.startMouseWheelEvent(v),t.mouseWheelEvent(v)):(t.mouseWheelEvent(v),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const v={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(v);break;case 1:t.middleButtonReleaseEvent(v);break;case 2:t.rightButtonReleaseEvent(v);break;default:wg(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const v=[...i.values()];if(e.recognizeGestures&&v.length>1){const w=Cg(i);if(v.length===2){const m={...l(Hu),position:v[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(m)}t.recognizeGesture("TouchStart",w)}else if(v.length===1){const w={...l(Hu),position:c(p),deviceType:u(p)};t.leftButtonPressEvent(w)}},t.handleTouchMove=p=>{const v=[...i.values()];if(e.recognizeGestures&&v.length>1){const w=Cg(i);t.recognizeGesture("TouchMove",w)}else if(v.length===1){const w={...l(Hu),position:v[0].position,deviceType:u(p)};t.mouseMoveEvent(w)}},t.handleTouchEnd=p=>{const v=[...i.values()];if(e.recognizeGestures)if(v.length===0){const w={...l(Hu),position:c(p),deviceType:u(p)};t.leftButtonReleaseEvent(w)}else if(v.length===1){const w=Cg(i);t.recognizeGesture("TouchEnd",w);const m={...l(Hu),position:v[0].position,deviceType:u(p)};t.leftButtonPressEvent(m)}else{const w=Cg(i);t.recognizeGesture("TouchMove",w)}else if(v.length===1){const w={...l(Hu),position:v[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(w)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>e._view?.getRenderable()?.getRenderersByReference()?.[0],t.findPokedRenderer=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const w=e._view?.getRenderable()?.getRenderers();if(!w||w.length===0)return null;w.sort((S,T)=>S.getLayer()-T.getLayer());let m=null,y=null,C=null,x=w.length;for(;x--;){const S=w[x];if(e._view.isInViewport(p,v,S)&&S.getInteractive()){C=S;break}m===null&&S.getInteractive()&&(m=S),y===null&&e._view.isInViewport(p,v,S)&&(y=S)}return C===null&&(C=m),C===null&&(C=y),C==null&&(C=w[0]),C},t.render=()=>{!t.isAnimating()&&!e.inRender&&g()},xw.forEach(p=>{const v=p.charAt(0).toLowerCase()+p.slice(1);t[`${v}Event`]=w=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){AH(`
          Can not forward events without a current renderer on the interactor.
        `);return}const y={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...w};t[`invoke${p}`](y)}}),t.recognizeGesture=(p,v)=>{if(Object.keys(v).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(v).forEach(D=>{e.startingEventPositions[D]=v[D]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let w=0;const m=[],y=[];Object.keys(v).forEach(D=>{m[w]=v[D],y[w]=e.startingEventPositions[D],w++});const C=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y)),x=Math.sqrt((m[0].x-m[1].x)*(m[0].x-m[1].x)+(m[0].y-m[1].y)*(m[0].y-m[1].y));let S=Mp(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),T=Mp(Math.atan2(m[1].y-m[0].y,m[1].x-m[0].x)),_=T-S;T=T+180>=360?T-180:T+180,S=S+180>=360?S-180:S+180,Math.abs(T-S)<Math.abs(_)&&(_=T-S);const E=[];if(E[0]=(m[0].x-y[0].x+m[1].x-y[1].x)/2,E[1]=(m[0].y-y[0].y+m[1].y-y[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let D=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);D<15&&(D=15);const b=Math.abs(x-C),I=x*3.1415926*Math.abs(_)/360,O=Math.sqrt(E[0]*E[0]+E[1]*E[1]);if(b>D&&b>I&&b>O){e.currentGesture="Pinch";const M={scale:1,touches:v};t.startPinchEvent(M)}else if(I>D&&I>O){e.currentGesture="Rotate";const M={rotation:0,touches:v};t.startRotateEvent(M)}else if(O>D){e.currentGesture="Pan";const M={translation:[0,0],touches:v};t.startPanEvent(M)}}else{if(e.currentGesture==="Rotate"){const D={rotation:_,touches:v};t.rotateEvent(D)}if(e.currentGesture==="Pinch"){const D={scale:x/C,touches:v};t.pinchEvent(D)}if(e.currentGesture==="Pan"){const D={translation:E,touches:v};t.panEvent(D)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{h();const v=r.setContainer(p??null);return v&&f(),v},t.delete=()=>{for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),r.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const NH={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function W6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NH,r),Z.obj(t,e),e._animationExtendedEnd=0,Z.event(t,e,"RenderEvent"),xw.forEach(n=>Z.event(t,e,n)),Z.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),Z.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),Z.moveToProtected(t,e,["view"]),LH(t,e)}const VH=Z.newInstance(W6,"vtkRenderWindowInteractor");var kH={newInstance:VH,extend:W6,handledEvents:xw,...G6};function FH(t,e){e.classHierarchy.push("vtkActor");const r={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let n=e.properties[0].getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.properties[0]||t.getProperty(),!t.getIsOpaque()),t.makeProperty=Ph.newInstance,t.getMTime=()=>{let n=r.getMTime();if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();n=i>n?i:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();n=i>n?i:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),n=i>n?i:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(n,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,i)}}const UH={mapper:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1};function $6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UH,r),aw.extend(t,e,r),e.boundsMTime={},Z.obj(e.boundsMTime),Z.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),FH(t,e)}const BH=Z.newInstance($6,"vtkActor");var U0={newInstance:BH,extend:$6};function GH(t,e){const r=t.invokeResize;delete t.invokeResize,e.renderWindow=W$.newInstance(),e.rendererMap={},e.openGLRenderWindow=uH.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=kH.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:n,id:i,background:o})=>{const a=B6.newInstance({viewport:n,background:o||e.background});e.renderWindow.addRenderer(a),e.rendererMap[i]=a},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=n=>{const i=t.getRenderer(n);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[n]},t.getRenderer=n=>e.rendererMap[n],t.getRenderers=()=>{const{rendererMap:n}=e;return Object.keys(n).map(o=>({id:o,renderer:n[o]}))},t.resize=()=>{if(e.container){const{width:n,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(n),Math.floor(i)),r(),e.renderWindow.render()}},t.setContainer=n=>{e.container=n,e.openGLRenderWindow.setContainer(e.container)},t.delete=Z.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const WH={background:[0,0,0],container:null};function z6(t,e,r={}){Object.assign(e,WH,r),Z.obj(t,e),Z.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),Z.event(t,e,"resize"),GH(t,e)}const $H=Z.newInstance(z6),j6={newInstance:$H,extend:z6},{BlendMode:$c}=dE;function zH(t,e,r,n,i){let o=null;return i?(o=i,o.removeAllPoints()):o=bu.newInstance(),o.addPointLong(-1024,0,1,1),o.addPoint(t,e),o.addPoint(r,n),o}const jH=["getAnisotropy","getComputeNormalFromOpacity","getFilterMode","getFilterModeAsString","getGlobalIlluminationReach","getIpScalarRange","getIpScalarRangeByReference","getLAOKernelRadius","getLAOKernelSize","getLocalAmbientOcclusion","getPreferSizeOverAccuracy","getVolumetricScatteringBlending","setAnisotropy","setAverageIPScalarRange","setComputeNormalFromOpacity","setFilterMode","setFilterModeToNormalized","setFilterModeToOff","setFilterModeToRaw","setGlobalIlluminationReach","setIpScalarRange","setIpScalarRangeFrom","setLAOKernelRadius","setLAOKernelSize","setLocalAmbientOcclusion","setPreferSizeOverAccuracy","setVolumetricScatteringBlending"],HH={createRadonTransferFunction:zH};function XH(t,e){e.classHierarchy.push("vtkVolumeMapper");const r={...t};t.getBounds=()=>(e.static||t.update(),e.bounds=[...t.getInputData().getBounds()],e.bounds),t.setBlendModeToComposite=()=>{t.setBlendMode($c.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode($c.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode($c.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode($c.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode($c.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode($c.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>Z.enumToString($c,e.blendMode),t.setVolumeShadowSamplingDistFactor=n=>r.setVolumeShadowSamplingDistFactor(n>=1?n:1),jH.forEach(n=>{const i=()=>{throw new Error(`The method "volumeMapper.${n}()" doesn't exist anymore. It is a rendering property that has been moved to the volume property. Replace your code with:
volumeActor.getProperty().${n}()
`)};t[n]=i})}const KH=t=>({bounds:[...bn.INIT_BOUNDS],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:$c.COMPOSITE_BLEND,volumeShadowSamplingDistFactor:5,colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024,...t});function H6(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KH(r)),ww.extend(t,e,r),Z.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","volumeShadowSamplingDistFactor","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),Z.event(t,e,"lightingActivated"),XH(t,e)}const qH=Z.newInstance(H6,"vtkVolumeMapper");var X6={newInstance:qH,extend:H6,...HH};function YH(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const r=t.delete;t.delete=()=>{e.scalarTexture=null,r()}}const JH={scalarTexture:null};function K6(t,e,r={}){Object.assign(e,JH,r),X6.extend(t,e,r),Z.setGet(t,e,["scalarTexture"]),YH(t,e)}const ZH=Z.newInstance(K6,"vtkSharedVolumeMapper"),QH={newInstance:ZH,extend:K6};function Sw(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint32Array":return Uint32Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, Int16Array, or Uint32Array");return Float32Array}}function Tw(t,e,r={}){const{isVolumeBuffer:n=!1}=r,i=Sw(t,n),o=i.BYTES_PER_ELEMENT;return{numBytes:e*o,TypedArrayConstructor:i}}function DS(t,e){const r=Sw(e),n=new r(t.length);return n.set(t),n}function eX(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const r=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=({width:s,height:c,depth:l,numberOfComponents:d,dataType:u,data:f,preferSizeOverAccuracy:h})=>{e.inputDataType=u,e.inputNumComps=d,r({width:s,height:c,depth:l,numberOfComponents:d,dataType:u,data:f,preferSizeOverAccuracy:h})};const n=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(s,c)=>{const l=n(s,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],l},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const c=Ne.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){a();return}return t.hasUpdatedFrames()&&o()};const i=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,i()},t.modified=()=>{i();const s=Ne.getVolume(e.volumeId);if(!s)return;const c=s.imageIds;for(let l=0;l<c.length;l++)e.updatedFrames[l]=!0};function o(){const s=Ne.getVolume(e.volumeId),c=s.imageIds;for(let l=0;l<e.updatedFrames.length;l++)if(e.updatedFrames[l]){const d=Ne.getImage(c[l]);if(!d)continue;let u=d.voxelManager.getScalarData();const f=e.context;s.dataType!==u.constructor.name&&(u=DS(u,s.dataType));const[h]=t.updateArrayDataTypeForGL(s.dataType,[u]);t.bind();const g=l;f.texSubImage3D(e.target,0,0,0,g,e.width,e.height,1,e.format,e.openGLDataType,h),t.deactivate(),e.updatedFrames[l]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function a(){const s=Ne.getVolume(e.volumeId),c=s.getCurrentDimensionGroupImageIds();if(!c.length)return!1;let l;for(let d=0;d<c.length;d++){const u=c[d],f=Ne.getImage(u);let h;f?(h=f.voxelManager.getScalarData(),l=h.constructor):(l=Sw(s.dataType,!0),h=new l(e.width*e.height));const g=e.context;s.dataType!==h.constructor.name&&(h=DS(h,s.dataType));const[p]=t.updateArrayDataTypeForGL(s.dataType,[h]);t.bind();let v=d;g.texSubImage3D(e.target,0,0,0,v,e.width,e.height,1,e.format,e.openGLDataType,p),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:c,depth:l,numberOfComponents:d,dataType:u})=>{e.width??=s,e.height??=c,e.depth??=l,e.inputNumComps??=d,e.inputDataType??=u},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const tX={updatedFrames:[]};function q6(t,e,r={}){Object.assign(e,tX,r),$n.extend(t,e,r),eX(t,e)}const nX=Z.newInstance(q6,"vtkStreamingOpenGLTexture"),rX={newInstance:nX,extend:q6},iX={isPerformingCoordinateTransformation:!1};function Y6(t,e,r={}){Object.assign(e,iX,r),Cw.extend(t,e,r),Z.setGet(t,e,["isPerformingCoordinateTransformation"]),aX(t,e)}const oX=Z.newInstance(Y6,"vtkSlabCamera");function aX(t,e){e.classHierarchy.push("vtkSlabCamera");const r=It(new Float64Array(16)),n=new Float64Array(3);t.getProjectionMatrix=(i,o,a)=>{const s=fi();if(e.projectionMatrix){const f=1/e.physicalScale;return Ji(n,f,f,f),fr(s,e.projectionMatrix),es(s,s,n),Mn(s,s),s}It(r);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const d=l-c,u=[c+(o+1)*d/2,c+(a+1)*d/2];if(e.parallelProjection){const f=e.parallelScale*i,h=e.parallelScale,g=(e.windowCenter[0]-1)*f,p=(e.windowCenter[0]+1)*f,v=(e.windowCenter[1]-1)*h,w=(e.windowCenter[1]+1)*h;W5(r,g,p,v,w,u[0],u[1]),Mn(r,r)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const f=Math.tan(pt.radiansFromDegrees(e.viewAngle)/2);let h,g;e.useHorizontalViewAngle===!0?(h=c*f,g=c*f/i):(h=c*f*i,g=c*f);const p=(e.windowCenter[0]-1)*h,v=(e.windowCenter[0]+1)*h,w=(e.windowCenter[1]-1)*g,m=(e.windowCenter[1]+1)*g,y=u[0],C=u[1];r[0]=2*y/(v-p),r[5]=2*y/(m-w),r[2]=(p+v)/(v-p),r[6]=(w+m)/(m-w),r[10]=-(y+C)/(C-y),r[14]=-1,r[11]=-2*y*C/(C-y),r[15]=0}}return fr(s,r),s}}const sX={newInstance:oX,extend:Y6};class id{get numTimePoints(){return typeof this.numDimensionGroups=="number"?this.numDimensionGroups:1}constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numFrames=null;const{imageIds:r,scaling:n,dimensions:i,spacing:o,origin:a,direction:s,dataType:c,volumeId:l,referencedVolumeId:d,metadata:u,referencedImageIds:f,additionalDetails:h,voxelManager:g,numberOfComponents:p}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:v}=e;this.suppressWarnings=!0,this.imageIds=r,this.volumeId=l,this.metadata=u,this.dimensions=i,this.spacing=o,this.origin=a,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=rX.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=g??ns.createImageVolumeVoxelManager({dimensions:i,imageIds:r,numberOfComponents:p,id:l}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],v||(v=Rh.newInstance(),v.setDimensions(i),v.setSpacing(o),v.setDirection(s),v.setOrigin(a)),v.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:p||1},this.suppressWarnings),v.set({hasScalarVolume:!1},this.suppressWarnings),this.imageData=v,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),n&&(this.scaling=n),d&&(this.referencedVolumeId=d),f&&(this.referencedImageIds=f),h&&(this.additionalDetails=h)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,r)=>{const n=Yn(e);this._imageIdsIndexMap.set(e,r),this._imageURIsIndexMap.set(n,r)})}isDynamicVolume(){return this.numTimePoints?this.numTimePoints>1:!1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){Ne.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(r=>Ne.getImage(r))}}const qa=[];function od(t,e=0){let r;for(r=0;r<qa.length&&!(qa[r].priority<=e);r++);qa.splice(r,0,{priority:e,provider:t})}function cX(t){for(let e=0;e<qa.length;e++)if(qa[e].provider===t){qa.splice(e,1);break}}function lX(){for(;qa.length>0;)qa.pop()}function ut(t,...e){for(let r=0;r<qa.length;r++){const n=qa[r].provider(t,...e);if(n!==void 0)return n}}function _w(t,e,r=ut){const n={};for(const i of e)try{const o=r(i,t);if(o){const a={};for(const s in o)if(s in o){const c=J6(s);a[c]=o[s]}Object.assign(n,a)}}catch(o){console.error(`Error retrieving ${i} data:`,o)}return n}const J6=t=>t.startsWith("sop")?`SOP${t.substring(3)}`:(t.endsWith("Id")&&(t=`${t.substring(0,t.length-2)}ID`),t.charAt(0).toUpperCase()+t.slice(1)),uX=t=>t.startsWith("SOP")?`sop${t.substring(3)}`:(t.endsWith("ID")&&(t=`${t.substring(0,t.length-2)}Id`),t.charAt(0).toLowerCase()+t.slice(1)),dX=Object.freeze(Object.defineProperty({__proto__:null,addProvider:od,get:ut,getNormalized:_w,removeAllProviders:lX,removeProvider:cX,toLowerCamelTag:uX,toUpperCamelTag:J6},Symbol.toStringTag,{value:"Module"}));let Ld={};const Jc={add:(t,e)=>{Jc.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const r=e.type;Ld[t]||(Ld[t]={}),Ld[t][r]=e.metadata},get:(t,e)=>Ld[e]?.[t],clear:()=>{Ld={}}};od(Jc.get);const $i=new g5("imageLoadPool");$i.grabDelay=0;$i.setMaxSimultaneousRequests(Jt.Interaction,1e3);$i.setMaxSimultaneousRequests(Jt.Thumbnail,1e3);$i.setMaxSimultaneousRequests(Jt.Prefetch,1e3);const Z6={};let fX;function Q6(t,e){const r=Ne.getImageLoadObject(t);if(r)return IS(r.promise,t),r;const n=t.split(":")[0],i=Z6[n]||fX;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${n}'`);const o=i(t,e);return IS(o.promise,t),o}function IS(t,e){Promise.resolve(t).then(r=>{hX(r),Ye(Fe,$e.IMAGE_LOADED,{image:r})}).catch(r=>{const n={imageId:e,error:r};Ye(Fe,$e.IMAGE_LOAD_FAILED,n)})}function hX(t){if(!t.voxelManager){const{width:e,height:r,numberOfComponents:n}=t,i=ns.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:r,numberOfComponents:n});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function gX(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return Q6(t,e).promise}function dl(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const r=Q6(t,e);return Ne.getImageLoadObject(t)||Ne.putImageLoadObject(t,r),r.promise}function cy(t,e={}){if(t===void 0)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");e.imageId===void 0&&(e.imageId=`derived:${cn()}`);const{imageId:r,skipCreateBuffer:n,onCacheAdd:i,voxelRepresentation:o}=e,a=ut("imagePlaneModule",t),s=a.rows*a.columns,{TypedArrayConstructor:c}=Tw(e.targetBuffer?.type,s),l=new c(n?1:s),d=r,u=ut("imagePlaneModule",t);Jc.add(d,{type:"imagePlaneModule",metadata:u});const f=ut("generalSeriesModule",t);Jc.add(d,{type:"generalSeriesModule",metadata:f}),Jc.add(d,{type:"generalImageModule",metadata:{instanceNumber:e.instanceNumber}});const h=ut("imagePixelModule",t);Jc.add(d,{type:"imagePixelModule",metadata:{...h,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const g=eD(r,{scalarData:l,onCacheAdd:i,skipCreateBuffer:n,targetBuffer:{type:l.constructor.name},voxelRepresentation:o,dimensions:[a.columns,a.rows],spacing:[a.columnPixelSpacing,a.rowPixelSpacing],origin:a.imagePositionPatient,direction:a.imageOrientationPatient,frameOfReferenceUID:a.frameOfReferenceUID,referencedImageId:t});return g.referencedImageId=t,Ne.getImageLoadObject(r)||Ne.putImageSync(r,g),g}function pX(t,e={}){if(t.length===0)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");return t.map((n,i)=>{const o={imageId:e?.getDerivedImageId?.(n)||`derived:${cn()}`,...e};return cy(n,{...o,instanceNumber:i+1})})}function eD(t,e){const{scalarData:r,origin:n,direction:i,targetBuffer:o,skipCreateBuffer:a,onCacheAdd:s,frameOfReferenceUID:c,voxelRepresentation:l,referencedImageId:d}=e,u=e.dimensions,f=e.spacing;if(!u||!f)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const h=u[0],g=u[1],p=f[0],v=f[1],w={frameOfReferenceUID:c,rows:g,columns:h,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:n??[0,0,0],pixelSpacing:[v,p],rowPixelSpacing:v,columnPixelSpacing:p},m=h*g,y=r.length/m;let C;if(r){if(!(r instanceof Uint8Array||r instanceof Float32Array||r instanceof Uint16Array||r instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");C=r}else if(!a){const{TypedArrayConstructor:R}=Tw(o?.type,m);C=new R(m)}let x,S,T;if(C instanceof Uint8Array)x=8,S=8,T=7;else if(C instanceof Uint16Array)x=16,S=16,T=15;else if(C instanceof Int16Array)x=16,S=16,T=15;else if(C instanceof Float32Array)x=32,S=32,T=31;else throw new Error("Unsupported scalarData type");const _={samplesPerPixel:1,photometricInterpretation:C.length>u[0]*u[1]?"RGB":"MONOCHROME2",rows:g,columns:h,bitsAllocated:x,bitsStored:S,highBit:T},E={imagePlaneModule:w,imagePixelModule:_};["imagePlaneModule","imagePixelModule"].forEach(R=>{Jc.add(t,{type:R,metadata:E[R]||{}})});const D=t,b=l===Sp.RLE&&ns.createRLEImageVoxelManager({dimensions:u,id:D})||ns.createImageVoxelManager({height:g,width:h,numberOfComponents:y,scalarData:C,id:D});let I=C[0],O=C[0];for(let R=1;R<C.length;R++)C[R]<I&&(I=C[R]),C[R]>O&&(O=C[R]);const M={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:_.photometricInterpretation==="RGB",numberOfComponents:_.samplesPerPixel,dataType:o?.type,slope:1,minPixelValue:I,maxPixelValue:O,rows:_.rows,columns:_.columns,getCanvas:void 0,height:_.rows,width:_.columns,rgba:void 0,columnPixelSpacing:w.columnPixelSpacing,rowPixelSpacing:w.rowPixelSpacing,FrameOfReferenceUID:w.frameOfReferenceUID,invert:!1,getPixelData:()=>b.getScalarData(),voxelManager:b,sizeInBytes:r.byteLength,referencedImageId:d};return s?.(M),Ne.putImageSync(M.imageId,M),M}function lp(t,e){Z6[t]=e}function tD(t){const e=t[0],{pixelRepresentation:r,bitsAllocated:n,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=ut("imagePixelModule",e),c=[],l=ut("voiLutModule",e);let d;if(l){const{windowWidth:m,windowCenter:y}=l;if(d=l?.voiLUTFunction,Array.isArray(m))for(let C=0;C<m.length;C++)c.push({windowWidth:m[C],windowCenter:y[C]});else c.push({windowWidth:m,windowCenter:y})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:f}=ut("generalSeriesModule",e),{imageOrientationPatient:h,pixelSpacing:g,frameOfReferenceUID:p,columns:v,rows:w}=ut("imagePlaneModule",e);return{BitsAllocated:n,BitsStored:i,SamplesPerPixel:s,HighBit:o,PhotometricInterpretation:a,PixelRepresentation:r,Modality:u,ImageOrientationPatient:h,PixelSpacing:g,FrameOfReferenceUID:p,Columns:v,Rows:w,voiLut:c,VOILUTFunction:d,SeriesInstanceUID:f}}const T2=1;function MS(t){if(t.columnPixelSpacing!==void 0)return t.columnPixelSpacing;if(t.rowPixelSpacing!==void 0)return t.rowPixelSpacing;if(t.pixelSpacing?.[1]!==void 0)return t.pixelSpacing[1];if(t.pixelSpacing?.[0]!==void 0)return t.pixelSpacing[0]}function nD(t){const{imagePositionPatient:e,imageOrientationPatient:r}=ut("imagePlaneModule",t[0]);if(t.length===1){const{sliceThickness:v,spacingBetweenSlices:w,columnPixelSpacing:m,rowPixelSpacing:y,pixelSpacing:C}=ut("imagePlaneModule",t[0]);if(v)return v;if(w)return w;const x=MS({columnPixelSpacing:m,rowPixelSpacing:y,pixelSpacing:C});return x!==void 0?x:T2}const n=mt(r[0],r[1],r[2]),i=mt(r[3],r[4],r[5]),o=Ie();tn(o,n,i);const a=mt(e[0],e[1],e[2]),s=t[0].split(":")[0]==="wadouri";let c;function l(v){const{imagePositionPatient:w}=ut("imagePlaneModule",v),m=Ie(),y=mt(w[0],w[1],w[2]);return rn(m,a,y),ft(m,o)}if(s){const v=[t[0],t[Math.floor(t.length/2)]],w=ut("imagePlaneModule",v[1]);if(!w)throw new Error("Incomplete metadata required for volume construction.");const m=Ie(),y=mt(w.imagePositionPatient[0],w.imagePositionPatient[1],w.imagePositionPatient[2]);rn(m,a,y);const C=ft(m,o);c=Math.abs(C)/Math.floor(t.length/2)}else{const v=t.map(m=>({distance:l(m),imageId:m}));v.sort((m,y)=>y.distance-m.distance);const w=v.length;c=Math.abs(v[w-1].distance-v[0].distance)/(w-1)}const{sliceThickness:d,spacingBetweenSlices:u,columnPixelSpacing:f,rowPixelSpacing:h,pixelSpacing:g}=ut("imagePlaneModule",t[0]),{strictZSpacingForVolumeViewport:p}=Qa().rendering;if((c===0||isNaN(c))&&!p)if(u)console.debug("Could not calculate spacing. Using spacingBetweenSlices"),c=u;else if(d)console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),c=d;else{const v=MS({columnPixelSpacing:f,rowPixelSpacing:h,pixelSpacing:g});v?c=v:(console.debug(`Could not calculate spacing and no pixel spacing found. Using default thickness (${T2} mm)`),c=T2)}return c}function rD(t,e){const{imagePositionPatient:r,imageOrientationPatient:n}=ut("imagePlaneModule",t[0]);if(!e){const d=mt(n[0],n[1],n[2]),u=mt(n[3],n[4],n[5]);e=Ie(),tn(e,d,u)}const i=t[0].split(":")[0]==="wadouri",o=nD(t);let a;function s(d){const{imagePositionPatient:u}=ut("imagePlaneModule",d),f=Ie();return rn(f,r,u),ft(f,e)}if(i){const d=[t[0],t[Math.floor(t.length/2)]];a=t;const u=s(d[0]),f=s(d[1]);u-f<0&&a.reverse()}else{const d=t.map(u=>({distance:s(u),imageId:u}));d.sort((u,f)=>f.distance-u.distance),a=d.map(u=>u.imageId)}const{imagePositionPatient:c}=ut("imagePlaneModule",a[0]);return{zSpacing:o,origin:c,sortedImageIds:a}}function iD(t){const e=ut("modalityLutModule",t)||{},r=ut("generalSeriesModule",t)||{},{modality:n}=r,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:n},o=ut("scalingModule",t)||{};return{...i,...n==="PT"&&{suvbw:o.suvbw,suvbsa:o.suvbsa,suvlbm:o.suvlbm},...n==="RTDOSE"&&{doseGridScaling:o.DoseGridScaling,doseSummation:o.DoseSummation,doseType:o.DoseType,doseUnit:o.DoseUnit}}}const Ew=t=>Object.values(t).some(r=>typeof r=="number"&&!Number.isInteger(r)),OS={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function Y1(t,e){const r=tD(t),{ImageOrientationPatient:n,PixelSpacing:i,Columns:o,Rows:a}=r,s=mt(n[0],n[1],n[2]),c=mt(n[3],n[4],n[5]),l=Ie();tn(l,s,c);const{zSpacing:d,origin:u,sortedImageIds:f}=rD(t,l),h=t.length,g=[i[1],i[0],d],p=[o,a,h].map(w=>Math.floor(w)),v=[...s,...c,...l];return{dimensions:p,spacing:g,origin:u,dataType:mX(f,r),direction:v,metadata:r,imageIds:f,volumeId:e,voxelManager:null,numberOfComponents:r.PhotometricInterpretation==="RGB"?3:1}}function mX(t,e){const{BitsAllocated:r,PixelRepresentation:n}=e,i=n===1,o=vX(t);if(o)return o;const[a,s,c]=[0,Math.floor(t.length/2),t.length-1],l=[a,s,c].map(h=>iD(t[h])),d=l.some(h=>h.rescaleIntercept<0||h.rescaleSlope<0),u=l.some(h=>Ew(h)),f=p5();switch(r){case 8:return"Uint8Array";case 16:return f&&u?"Float32Array":i||d?"Int16Array":!i&&!d?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";case 64:return"Float64Array";default:throw new Error(`Bits allocated of ${r} is not defined to generate scalarData for the volume.`)}}function vX(t){const r=[0,Math.floor(t.length/2),t.length-1].map(i=>Ne.getImage(t[i]));if(!r.every(Boolean))return null;const n=r[0].getPixelData().constructor.name;return r.every(i=>i.getPixelData().constructor.name===n)&&n in OS?OS[n]:null}let zp=class oD{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const r=new oD("as iterator");return e.then(n=>{try{r.add(n,!0)}catch(i){r.reject(i)}},n=>{r.reject(n)}),r}add(e,r=!1){this.nextValue=e,this.done||=r,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,r)=>{this.waiting.resolve=e,this.waiting.reject=r})),await this.waiting.promise}yield this.nextValue}async forEach(e,r){let n=0;try{for await(const i of this){const{done:o}=this;try{await e(i,o,n),n++}catch(a){if(!o){console.warn("Caught exception in intermediate value",a);continue}if(r)r(a,o);else throw a}}}catch(i){if(r)r(i,!0);else throw i}}generate(e,r){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},n=>{this.reject(n),r?r(n):console.warn("Couldn't process because",n)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const Xu=new Map,PS="imageRetrieveConfiguration",B0={IMAGE_RETRIEVE_CONFIGURATION:PS,clear:()=>{Xu.clear()},add:(t,e)=>{Xu.set(t,e)},clone:()=>new Map(Xu),restore:t=>{Xu.clear(),t.forEach((e,r)=>{Xu.set(r,e)})},get:(t,...e)=>{if(t===PS)return e.map(r=>Xu.get(r)).find(r=>r!==void 0)}};od(B0.get.bind(B0));function Ah(t){const e=eo(),r=[];return e.forEach(n=>{const o=n.getVolumeViewports().filter(a=>a.hasVolumeId(t));r.push(...o)}),r}const ly=t=>{const e=yX(t);e?.length&&e.forEach(({renderingEngine:r,viewportIds:n})=>{r.hasBeenDestroyed||r.renderViewports(n)})};function yX(t){const e=eo(),r=[];return e.forEach(n=>{const i=Ah(t);i.length&&r.push({renderingEngine:n,viewportIds:i.map(o=>o.id)})}),r}const RS=[{id:"initialImages",retrieveType:"single"}],wX=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],_2=[{offset:-1,imageQualityStatus:ho.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:ho.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:ho.FAR_REPLICATE}],CX=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:Jt.Thumbnail,priority:5,nearbyFrames:_2},{id:"quarterThumb",decimate:4,offset:3,requestType:Jt.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:_2},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:Jt.Thumbnail,retrieveType:"multipleFast",nearbyFrames:_2},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:Jt.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:Jt.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:Jt.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:Jt.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function aD(t,e,r=0){const n=[];for(let i=r;i<t.length;i+=e)n.push(i);return n}function xX(t,e,r){if(e?.nearbyRequests?.length)for(const n of e.nearbyRequests)try{const{itemId:i,imageQualityStatus:o}=n,a=Ne.getImageQuality(i);if(a!==void 0&&a>=o)continue;const s={...r,imageId:i,imageQualityStatus:o};Ne.setPartialImage(i,s),t.successCallback(i,s)}catch(i){console.warn("Couldn't fill nearby item ",n.itemId,i)}}const g0=class g0{constructor(e){this.stages=e.stages||RS,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,r){return new SX(this,e,r).loadImages()}};g0.createProgressive=sD,g0.interleavedRetrieveStages={stages:CX},g0.singleRetrieveStages={stages:RS},g0.sequentialRetrieveStages={stages:wX};let jp=g0;class SX{constructor(e,r,n){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new zp("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=r,this.listener=n}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const r of e)this.addRequest(r);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,r){const{imageId:n,next:i}=e,o=(d,u)=>{this.listener.errorCallback(n,c||!i,d),u&&this.updateStageStatus(e.stage,d)},a=(r.loader||dl)(n,r),s=zp.as(a);let c=!1;return s.forEach(async(d,u)=>{const f=Ne.getImageQuality(n);if(!d){console.warn("No image retrieved",n);return}const{imageQualityStatus:h}=d;if(c||=h===ho.FULL_RESOLUTION,f!==void 0&&f>h){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(n,d),this.displayedIterator.add(d),u&&this.updateStageStatus(e.stage),xX(this.listener,e,d)},o).finally(()=>{if(!c&&i)Ne.setPartialImage(n),this.addRequest(i,r.streamingData);else{c||this.listener.errorCallback(n,!0,"Couldn't decode"),this.outstandingRequests--;for(let d=i;d;d=d.next)this.updateStageStatus(d.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(d=>null)}addRequest(e,r={}){const{imageId:n,stage:i}=e,o=this.listener.getLoaderImageOptions(n);if(!o)return;const{retrieveType:a="default"}=i,{retrieveOptions:s}=this,c=s[a]||s.default,l={...o,retrieveType:a,retrieveOptions:c,streamingData:r},d=i.priority??-5,u=i.requestType||Jt.Interaction,f={imageId:n};$i.addRequest(this.sendRequest.bind(this,e,l),u,f,d)}updateStageStatus(e,r,n=!1){const{id:i}=e,o=this.stageStatusMap.get(i);if(o&&(o.imageLoadPendingCount--,r?o.imageLoadFailedCount++:n||o.totalImageCount++,!n&&!o.stageStartTime&&(o.stageStartTime=Date.now()),!o.imageLoadPendingCount)){const{imageLoadFailedCount:a,totalImageCount:s,stageStartTime:c=Date.now(),startTime:l}=o,d={stageId:i,numberOfFailures:a,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};Ye(Fe,$e.IMAGE_RETRIEVAL_STAGE,d),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,r=new Map,n=(i,o)=>{const a=o<0?this.imageIds.length+o:o<1?Math.floor((this.imageIds.length-1)*o):o,s=this.imageIds[a];if(!s)throw new Error(`No value found to add to requests at ${o}`);const c={imageId:s,stage:i,index:a,nearbyRequests:this.findNearbyRequests(a,i)};this.addStageStatus(i);const l=r.get(s);l?l.next=c:e.push(c),r.set(s,c)};for(const i of this.stages)(i.positions||aD(this.imageIds,i.decimate||1,i.offset??0)).forEach(a=>{n(i,a)});return e}findNearbyRequests(e,r){const n=new Array;if(!r.nearbyFrames)return n;for(const i of r.nearbyFrames){const o=e+i.offset;o<0||o>=this.imageIds.length||n.push({itemId:this.imageIds[o],imageQualityStatus:i.imageQualityStatus,index:o})}return n}addStageStatus(e){const{id:r}=e,n=this.stageStatusMap.get(r)||{stageId:r,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return n.imageLoadPendingCount++,this.stageStatusMap.set(r,n),n}}function sD(t){return new jp(t)}const AS=Jt.Prefetch;class TX extends id{constructor(e,r){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:n}=this;if(!n||!n.loading)return;n.loading=!1,n.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:o})=>o.volumeId!==this.volumeId;$i.filterRequests(i)},this.loadStatus=r.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:r}=this,{numFrames:n}=this;for(let i=0;i<n;i++)r.setUpdatedFrame(i);this.modified(),e&&ly(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:r,framesProcessed:n,totalNumFrames:i}=e,{volumeId:o,reRenderFraction:a,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(r>this.reRenderTarget||n===i)&&(this.reRenderTarget+=a,ly(o)),n===i){s.callbacks.forEach(u=>u(e));const d={FrameOfReferenceUID:l,volumeId:o};Ye(Fe,$e.IMAGE_VOLUME_LOADING_COMPLETED,d)}}updateTextureAndTriggerEvents(e,r,n=ho.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:o,numFrames:a,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(o[i]>n||o[i]===ho.FULL_RESOLUTION)return;const d=n===ho.FULL_RESOLUTION;o[e]=n,this.framesUpdated++,d&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:a,framesProcessed:this.framesProcessed};Ye(Fe,$e.IMAGE_VOLUME_MODIFIED,u),d&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:s,complete:d,imageQualityStatus:n}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,r){const n=this.getImageIdIndex(e),{imageQualityStatus:i}=r;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",n);return}this.updateTextureAndTriggerEvents(n,e,i),this.isDynamicVolume()&&this.checkDimensionGroupCompletion(n)}errorCallback(e,r,n){if(!r)return;const{totalNumFrames:i,numFrames:o}=this,a=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:a,error:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:n,imageIdIndex:a,imageId:e};Ye(Fe,$e.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:r,loadStatus:n,numFrames:i}=this,{transferSyntaxUID:o}=ut("transferSyntax",r[0])||{},a=ut(B0.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,o,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:a?(a.create||jp.createProgressive)(a):this,n.loading===!0)return;const{loaded:s}=this.loadStatus,c=r.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:r}=ut("transferSyntax",e)||{},n=ut("imagePlaneModule",e)||{},{rows:i,columns:o}=n,a=this.getImageIdIndex(e),s=ut("modalityLutModule",e)||{},c=ut("generalSeriesModule",e)||{},l={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality},d=l.modality;if(d==="PT"||d==="RTDOSE"){const g=ut("scalingModule",e);g&&(this._addScalingToVolume(g),Object.assign(l,g))}const u=Ew(l),f=p5();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:g,rescaleIntercept:p}=l;this.isPreScaled=typeof g=="number"&&typeof p=="number"}return!f&&u&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:o},allowFloatRendering:f,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:AS,transferSyntaxUID:r,additionalDetails:{imageId:e,imageIdIndex:a,volumeId:this.volumeId},retrieveOptions:void 0}}callLoadImage(e,r,n){const{cachedFrames:i}=this;if(i[r]===ho.FULL_RESOLUTION)return;const o=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(r),Fe.removeEventListener($e.IMAGE_CACHE_IMAGE_ADDED,o))};return Fe.addEventListener($e.IMAGE_CACHE_IMAGE_ADDED,o),zp.as(dl(e,n)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,r,e))}getImageIdsRequests(e,r){this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),e.map(o=>{const a=this.getImageIdIndex(o),s=AS,c=r,l=this.getLoaderImageOptions(o),{retrieveOptions:d={}}=ut(B0.IMAGE_RETRIEVE_CONFIGURATION,o,"volume")||{};return l.retrieveOptions={...l.retrieveOptions,...d.default||Object.values(d)?.[0]||{}},{callLoadImage:this.callLoadImage.bind(this),imageId:o,imageIdIndex:a,options:l,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(r=>{if(!r)return;const{callLoadImage:n,imageId:i,imageIdIndex:o,options:a,priority:s,requestType:c,additionalDetails:l}=r;$i.addRequest(n.bind(this,i,o,a),c,l,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(n=>{console.debug("progressive loading failed to complete",n)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:r,suvlbm:n,suvbsa:i}=e,o={};n&&(o.suvbwToSuvlbm=n/r),i&&(o.suvbwToSuvbsa=i/r),r&&(o.suvbw=r),this.scaling={PT:o}}checkDimensionGroupCompletion(e){}}class _X extends TX{constructor(e,r){e.imageIds||(e.imageIds=r.imageIds),super(e,r),this.getImageIdsToLoad=()=>{const{imageIds:n}=this;return this.numFrames=n.length,n}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:r}=this;return this.getImageIdsRequests(r,e)}}function EX(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function r(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[g,p]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],v=[0,g,p];await Promise.all(v.map(w=>Ne.isLoaded(e.imageIds[w])?Promise.resolve(!0):new Promise((m,y)=>{const C=e.imageIds[w];$i.addRequest(async()=>{gX(C).then(()=>{console.log(`Prefetched imageId: ${C}`),m(!0)}).catch(x=>{y(x)})},Jt.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=Y1(e.imageIds,t),{dimensions:o,spacing:a,origin:s,direction:c,metadata:l,imageIds:d,dataType:u,numberOfComponents:f}=i;return new _X({volumeId:t,metadata:l,dimensions:o,spacing:a,origin:s,direction:c,imageIds:d,dataType:u,numberOfComponents:f},{imageIds:d,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const n=r();return{promise:n,decache:()=>{n.then(i=>{i.destroy(),i=null})},cancel:()=>{n.then(i=>{i.cancelLoading()})}}}const cD={};let up=EX;function lD(t,e){const r=t.indexOf(":"),n=t.substring(0,r);let i=cD[n];if(i==null){if(up==null||typeof up!="function")throw new Error(`No volume loader for scheme ${n} has been registered`);i=up}const o=i(t,e);return o.promise.then(function(a){Ye(Fe,$e.VOLUME_LOADED,{volume:a})},function(a){const s={volumeId:t,error:a};Ye(Fe,$e.VOLUME_LOADED_FAILED,s)}),o}function uD(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let r=Ne.getVolumeLoadObject(t);return r!==void 0?r.promise:(r=lD(t,e),r.promise.then(n=>n))}async function dD(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let r=Ne.getVolumeLoadObject(t);return r!==void 0||(r=lD(t,e),Ne.putVolumeLoadObject(t,r)),r.promise}function bX(t,e){const r=Ne.getVolume(t);if(!r)throw new Error(`Cannot created derived volume: Referenced volume with id ${t} does not exist.`);let{volumeId:n}=e;const{voxelRepresentation:i}=e;n===void 0&&(n=cn());const{metadata:o,dimensions:a,spacing:s,origin:c,direction:l}=r,d=r.isDynamicVolume()?r.getCurrentDimensionGroupImageIds():r.imageIds??[],u=pX(d,{targetBuffer:e.targetBuffer,voxelRepresentation:i}),f=u[0].dataType,h=u.map(p=>p.imageId),g=new id({volumeId:n,dataType:f,metadata:structuredClone(o),dimensions:[a[0],a[1],a[2]],spacing:s,origin:c,direction:l,referencedVolumeId:t,imageIds:h,referencedImageIds:r.imageIds??[]});return Ne.putVolumeSync(n,g),g}async function fD(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const r=Ne.getVolume(t);return r||(e.filter(o=>!Ne.getImage(o)).length===0?J1(t,e):await dD(t,{imageIds:e}))}function J1(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const r=Ne.getVolume(t);if(r)return r;const n=Y1(e,t),i=new id({volumeId:t,dataType:n.dataType,metadata:structuredClone(n.metadata),dimensions:n.dimensions,spacing:n.spacing,origin:n.origin,direction:n.direction,referencedVolumeId:n.referencedVolumeId,imageIds:n.imageIds,referencedImageIds:n.referencedImageIds});return Ne.putVolumeSync(t,i),i}function bw(t,e={}){const{metadata:r,dimensions:n,spacing:i,origin:o,direction:a,scalarData:s,targetBuffer:c,preventCache:l=!1}=e,d=Ne.getVolume(t);if(d)return d;const u=n[0]*n[1],f=s?s.constructor.name:c?.type??"Float32Array",h=u*n[2];let g;switch(f){case"Uint8Array":case"Int8Array":g=h;break;case"Uint16Array":case"Int16Array":g=h*2;break;case"Float32Array":g=h*4;break}if(!Ne.isCacheable(g))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const v=[];for(let y=0;y<n[2];y++){const C=`${t}_slice_${y}`;v.push(C);const x=s.subarray(y*u,(y+1)*u);eD(C,{scalarData:x,dimensions:[n[0],n[1]],spacing:[i[0],i[1]],origin:o,direction:a,targetBuffer:{type:f}})}const w=new id({volumeId:t,metadata:structuredClone(r),dimensions:[n[0],n[1],n[2]],spacing:i,origin:o,direction:a,imageIds:v,dataType:f}),m=ns.createImageVolumeVoxelManager({imageIds:v,dimensions:n,numberOfComponents:1,id:t});return w.voxelManager=m,l||Ne.putVolumeSync(t,w),w}function DX(){return Object.keys(cD)}function IX(){return up.name}function Z1(t,e={}){return bX(t,{...e,targetBuffer:{type:"Uint8Array",...e?.targetBuffer}})}function MX(t,e){const r=QH.newInstance();r.setInputData(t);const n=t.getSpacing(),o=(Qa().rendering?.volumeRendering?.sampleDistanceMultiplier||1)*(n[0]+n[1]+n[2])/6;return r.setMaximumSamplesPerRay(4e3),r.setSampleDistance(o),r.setScalarTexture(e),r}function OX(t){const e=X6.newInstance();e.setBlendMode(t.getBlendMode());const r=t.getInputData(),{voxelManager:n}=r.get("voxelManager"),i=n.getCompleteScalarDataArray(),o=Ot.newInstance({name:"Pixels",values:i});return r.getPointData().setScalars(o),e.setInputData(r),e.setMaximumSamplesPerRay(t.getMaximumSamplesPerRay()),e.setSampleDistance(t.getSampleDistance()),e}const PX=0,RX=Jt.Prefetch;async function Dw(t,e){let r=LX(e);!r&&e.imageIds.length&&(r=await NX(e),r=AX(e,r)),!(r.lower===0&&r.upper===0||r.lower===void 0||r.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)}function AX(t,e){const r=t.imageIds,n=Math.floor(r.length/2),i=r[n],o=ut("generalSeriesModule",i)||{};return VX(o.modality,t)?{lower:0,upper:5}:e}function LX(t){const{imageIds:e,metadata:r}=t;let n;if(e?.length){const i=Math.floor(e.length/2),o=e[i],a=ut("voiLutModule",o);if(a&&a.windowWidth&&a.windowCenter){a?.voiLUTFunction&&(n={},n.voiLUTFunction=a?.voiLUTFunction);const{windowWidth:s,windowCenter:c}=a,l=Array.isArray(s)?s[0]:s,d=Array.isArray(c)?c[0]:c;l!==0&&(n={windowWidth:l,windowCenter:d})}}else n=r.voiLut[0];if(n&&(n.windowWidth!==0||n.windowCenter!==0)){const{lower:i,upper:o}=tl(Number(n.windowWidth),Number(n.windowCenter),n.voiLUTFunction);return isNaN(i)||isNaN(o)?void 0:{lower:i,upper:o}}}async function NX(t){const{imageIds:e}=t,r=Math.floor(e.length/2),n=t.imageIds[r],i=ut("generalSeriesModule",n)||{},{modality:o}=i,a=ut("modalityLutModule",n)||{},s={rescaleSlope:a.rescaleSlope,rescaleIntercept:a.rescaleIntercept,modality:o};let c;if(o==="PT"){const h=ut("scalingModule",n);h&&(c={...s,suvbw:h.suvbw})}const l={priority:PX,requestType:RX,preScale:{scalingParameters:c}};let d=Ne.getImage(n);t.referencedImageIds?.length||(d=await dl(n,{...l,ignoreCache:!0}));let{min:u,max:f}=d.voxelManager.getMinMax();return u?.length>1&&(u=Math.min(...u),f=Math.max(...f)),{lower:u,upper:f}}function VX(t,e){return!(t!=="PT"||!e.isPreScaled||!e.scaling?.PT.suvbw)}async function uy(t,e,r,n=!1){const{volumeId:i,callback:o,blendMode:a}=t,s=await uD(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=s,d=MX(c,l);a&&d.setBlendMode(a);const u=pk.newInstance();u.setMapper(d);const{numberOfComponents:f}=c.get("numberOfComponents"),h=u.getProperty();return h.set({viewportId:r},!0),Qa().rendering.preferSizeOverAccuracy&&h.setPreferSizeOverAccuracy(!0),f===3&&u.getProperty().setIndependentComponents(!1),await Dw(u,s),o&&o({volumeActor:u,volumeId:i}),n||kX(e,r,u,i),u}function kX(t,e,r,n){const i=r.getProperty().getRGBTransferFunction(0).getRange(),o={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:n};Ye(t,$e.VOI_MODIFIED,o)}function hD(t){const e=t.getMapper().getInputData(),r=e.extentToBounds(e.getExtent());return[[r[0],r[2],r[4]],[r[0],r[2],r[5]],[r[0],r[3],r[4]],[r[0],r[3],r[5]],[r[1],r[2],r[4]],[r[1],r[2],r[5]],[r[1],r[3],r[4]],[r[1],r[3],r[5]]]}const FX=yo*yo,E2=t=>Math.abs(Math.abs(t)-1)<FX,b2=(t,e)=>E2(t[e])||E2(t[e+1])||E2(t[e+2]),UX=t=>b2(t,0)&&b2(t,3)&&b2(t,6);function Q1(t,e,r){const n=t.getMapper().getInputData();let i;const o=n.getDirection();if(UX(o))i=hD(t);else{const[u,f,h]=n.getDimensions();i=[[0,0,0],[u-1,0,0],[0,f-1,0],[u-1,f-1,0],[0,0,h-1],[u-1,0,h-1],[0,f-1,h-1],[u-1,f-1,h-1]].map(p=>n.indexToWorld(p))}const a=Qr.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(u=>a.apply(u));const s=[...r];a.apply(s);const c=s[0];let l=1/0,d=-1/0;for(let u=0;u<8;u++){const f=i[u][0];f>d&&(d=f),f<l&&(l=f)}return{min:l,max:d,current:c,actor:t,viewPlaneNormal:e,focalPoint:r}}function ml(t,e){const{direction:r,spacing:n}=t,i=r.slice(0,3),o=r.slice(3,6),a=r.slice(6,9),s=[ft(i,e),ft(o,e),ft(a,e)],c=Ie();return Ji(c,s[0]*n[0],s[1]*n[1],s[2]*n[2]),pr(c)}const cs=t=>{const e="volumeId:",r=t.includes(e)?t.substring(e.length):t,n=r.indexOf("sliceIndex=");return n===-1?r:r.substring(0,n-1)},BX=1+yo,GX=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),LS=t=>!!DX().find(e=>GX(t.volumeId,e));function ad(t,e,r,n=!1){const{viewPlaneNormal:i}=e,o=t.getActors();if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const a=o.map(l=>{const d=l.referencedId??l.uid;return Ne.getVolume(d)}).filter(l=>!!l);if(r){const l=cs(r),d=a.findIndex(g=>l.includes(g.volumeId)),u=a[d],{uid:f}=o[d],h=NS(u,i,t,n);return{imageVolume:u,spacingInNormalDirection:h,actorUID:f}}if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=a.find(LS);for(let l=0;l<a.length;l++){const d=a[l];if(c&&!LS(d))continue;const u=NS(d,i,t);u*BX<s.spacingInNormalDirection&&(s.spacingInNormalDirection=u,s.imageVolume=d,s.actorUID=o[l].uid)}return s}function NS(t,e,r,n=!1){const{slabThickness:i}=r.getProperties();let o=i;return(!i||!n)&&(o=ml(t,e)),o}function Hp(t){const e=t.getCamera(),{spacingInNormalDirection:r,imageVolume:n}=ad(t,e);if(!n)return;const{viewPlaneNormal:i,focalPoint:o}=e,a=t.getActors().find(g=>g.referencedId===n.volumeId||g.uid===n.volumeId);a||console.warn("No actor found for with actorUID of",n.volumeId);const s=a.actor,c=Q1(s,i,o),{min:l,max:d,current:u}=c,f=Math.round((d-l)/r)+1;let h=(u-l)/(d-l)*f;return h=Math.floor(h),h>f-1?h=f-1:h<0&&(h=0),{numberOfSlices:f,imageIndex:h}}const s0={};function WX(t){s0[t]!==void 0&&delete s0[t]}function $X(t){const{renderingEngineId:e,viewportId:r}=t.detail,i=Fn(e).getViewport(r);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");s0[i.id]===void 0&&(s0[i.id]=0);const o=Hp(i);if(!o){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:a,imageIndex:s}=o;if(s0[i.id]===s)return;s0[i.id]=s;const c={imageIndex:s,viewportId:r,renderingEngineId:e,numberOfSlices:a};Ye(i.element,$e.VOLUME_NEW_IMAGE,c)}function G0(t,e,r){const[n,i,o]=t,[a,s,c]=e,[l,d,u,f]=r,h=a-n,g=s-i,p=c-o,v=-1*(l*n+d*i+u*o-f)/(l*h+d*g+u*p),w=h*v+n,m=g*v+i,y=p*v+o;return[w,m,y]}function Ya(t,e,r=!1){const[n,i,o]=t,a=n*e[0]+i*e[1]+o*e[2];if(r){const s=Math.sqrt(n*n+i*i+o*o);return[n/s,i/s,o/s,a/s]}return[n,i,o,a]}function gD(t,e,r){const[n,i,o,a]=t,[s,c,l,d]=e,[u,f,h,g]=r,p=Yd(n,s,u,i,c,f,o,l,h),v=Yd(a,d,g,i,c,f,o,l,h),w=Yd(n,s,u,a,d,g,o,l,h),m=Yd(n,s,u,i,c,f,a,d,g),y=Ql(v)/Ql(p),C=Ql(w)/Ql(p),x=Ql(m)/Ql(p);return[y,C,x]}function Kf(t,e,r=!1){const[n,i,o,a]=t,[s,c,l]=e,d=n*s+i*c+o*l-a,u=Math.abs(d)/Math.sqrt(n*n+i*i+o*o);return(r?Math.sign(d):1)*u}function pD(t,e,r=yo){return Kf(e,t)<r}const zX=Object.freeze(Object.defineProperty({__proto__:null,isPointOnPlane:pD,linePlaneIntersection:G0,planeDistanceToPoint:Kf,planeEquation:Ya,threePlaneIntersection:gD},Symbol.toStringTag,{value:"Module"}));function dy(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function Bo(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(Bo);{const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=Bo(t[r]));return e}}const jX=.95;function mD(t,e){if(!t?.length||!e.FrameOfReferenceUID)return;e.planeRestriction||={FrameOfReferenceUID:e.FrameOfReferenceUID,point:t[0],inPlaneVector1:null,inPlaneVector2:null};const{planeRestriction:r}=e;if(t.length===1)return r.inPlaneVector1=null,r.inPlaneVector2=null,r;const n=rn(Ie(),t[0],t[Math.floor(t.length/2)]);Lt(n,n),r.inPlaneVector1=n,r.inPlaneVector2=null;const i=t.length;if(i>2)for(let o=Math.floor(i/3);o<i;o++){const a=rn(Ie(),t[o],t[0]),s=pr(a);if(!Et(s,0)&&ft(a,r.inPlaneVector1)<s*jX)return Lt(a,a),r.inPlaneVector2=a,r}return r}const Mf=class Mf{constructor(e){this.insetImageMultiplier=Qa().rendering?.useLegacyCameraFOV?1.1:1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=_i.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=r=>{},this.viewportWidgets=new Map,this.addWidget=(r,n)=>{this.viewportWidgets.set(r,n)},this.getWidget=r=>this.viewportWidgets.get(r),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.getRenderPasses=()=>null,this.removeWidgets=()=>{this.getWidgets().forEach(n=>{if(n.getEnabled()&&n.setEnabled(!1),n.getActor&&n.getRenderer){const i=n.getActor(),o=n.getRenderer();o&&i&&o.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=Bo(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=Bo(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===_i.NO_DATA||this.viewportStatus===_i.LOADING||(this.viewportStatus=_i.RENDERED)}setColorTransform(e,r){let n=null;if(!e&&!r)return;const i=r||[255,255,255],o=Math.max(...i),a=i.map(u=>o/u),{lower:s=0,upper:c=255}=e||{},l=(c-s+1)/255,d=s/255;return n=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${a[0]*l} 0 0 0 ${d}           0 ${a[1]*l} 0 0 ${d}           0 0 ${a[2]*l} 0 ${d}           0 0 0 1 0" />        </filter>      </svg>#colour')`,n}getRenderingEngine(){return Gf.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,r=!1){this.options=structuredClone(e),this.options?.displayArea&&this.setDisplayArea(this.options?.displayArea),r&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:r}){const n=this.getDefaultImageData();if(!n)return;const i=this.getCamera(),{viewPlaneNormal:o,viewUp:a,focalPoint:s,position:c}=i,l=tn(Ie(),o,a);let d=F1(Ie(),a);const u=ga(Ie(),o),f=Dr(c,s),g=n.getDimensions().map(x=>Math.floor(x/2)),p=[g[0],g[1],g[2]],v=n.indexToWorld(p,Ie()),w=this._getFocalPointForResetCamera(v,i,{resetPan:!0,resetToCenter:!1}),m=an(Ie(),s,w),y=pr(m),C=x=>{const S=xr(Ie(),x,2*ft(m,x));return an(S,S,m),Lt(S,S),S};if(e){const x=C(d),S=en(Ie(),w,x,y),T=en(Ie(),S,u,f);this.setCamera({viewPlaneNormal:u,position:T,focalPoint:S}),this.flipHorizontal=!this.flipHorizontal}if(r){d=ga(d,a);const x=C(l),S=en(Ie(),w,x,y),T=en(Ie(),S,u,f);this.setCamera({focalPoint:S,viewPlaneNormal:u,viewUp:d,position:T}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&Uo(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const r=this.getActors();let n=r[0];return e&&(n=r.find(o=>o.referencedId===e)),!n||!Uo(n)?null:n.actor}getActorUIDByIndex(e){const r=this.getActors()[e];if(r)return r.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){const r=this.getActors();this.removeAllActors(),this.addActors(e,{resetCamera:!0}),Ye(this.element,$e.ACTORS_CHANGED,{viewportId:this.id,removedActors:r,addedActors:e,currentActors:e})}_removeActor(e){const r=this.getActor(e);if(!r){console.warn(`Actor ${e} does not exist in ${this.id}, can't remove`);return}return this.getRenderer().removeActor(r.actor),this._actors.delete(e),r}removeActors(e){const r=[];e.forEach(i=>{const o=this._removeActor(i);o&&r.push(o)});const n=this.getActors();Ye(this.element,$e.ACTORS_CHANGED,{viewportId:this.id,removedActors:r,addedActors:[],currentActors:n})}addActors(e,r={}){const{resetCamera:n=!1}=r,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}if(e.forEach(o=>{this.addActor(o)}),n)this.resetCamera();else{const o=this.getViewPresentation(),a=this.getViewReference();this.resetCamera(),this.setViewReference(a),this.setViewPresentation(o)}Ye(this.element,$e.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:e,currentActors:this.getActors()})}addActor(e){const{uid:r,actor:n}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${r} Rendering Engine has been destroyed`);return}if(!r||!n)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(r)){console.warn(`Actor ${r} already exists for this viewport`);return}this.getRenderer()?.addActor(n),this._actors.set(r,Object.assign({},e)),this.updateCameraClippingPlanesAndRange(),Ye(this.element,$e.ACTORS_CHANGED,{viewportId:this.id,removedActors:[],addedActors:[e],currentActors:this.getActors()})}removeAllActors(){const e=this.getActors();this.getRenderer()?.removeAllViewProps(),this._actors=new Map,Ye(this.element,$e.ACTORS_CHANGED,{viewportId:this.id,removedActors:e,addedActors:[],currentActors:[]})}resetCameraNoEvent(){const e=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=e}setCameraNoEvent(e){const r=this._suppressCameraModifiedEvents;this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=r}_getViewImageDataIntersections(e,r,n){const i=n[0],o=n[1],a=n[2],s=i*r[0]+o*r[1]+a*r[2],c=e.getBounds(),l=this._getEdges(c),d=[];for(const u of l){const[[f,h,g],[p,v,w]]=u;if(i*(p-f)+o*(v-h)+a*(w-g)===0)continue;const m=G0([f,h,g],[p,v,w],[i,o,a,s]);this._isInBounds(m,c)&&d.push(m)}return d}setInterpolationType(e,r){}setDisplayArea(e,r=!1){if(!e)return;const{storeAsInitialCamera:n,type:i}=e;n&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:o}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(this.getProperties()?.interpolationType??Hs.LINEAR),this.setDisplayAreaFit(e)),n&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=o,!r&&!o){const a={viewportId:this.id,displayArea:e,storeAsInitialCamera:n};Ye(this.element,$e.DISPLAY_AREA_MODIFIED,a),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:r=1}=e,n=this.canvas,i=n.height,o=n.width;if(i<8||o<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(Hs.NEAREST),this.setCamera({parallelScale:i*c/(2*r)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:d,viewUp:u,viewPlaneNormal:f}=this.getCamera(),h=Ie();if(n.height%2&&en(h,h,u,r*.5*c),n.width%2){const g=tn(Ie(),u,f);en(h,h,g,r*.5*c)}!h[0]&&!h[1]&&!h[2]||this.setCamera({focalPoint:hr(Ie(),l,h),position:hr(Ie(),d,h)})}setDisplayAreaFit(e){const{imageArea:r,imageCanvasPoint:n}=e,i=window?.devicePixelRatio||1,o=this.getDefaultImageData();if(!o)return;const a=this.sWidth/i,s=this.sHeight/i,c=o.getDimensions(),l=this.worldToCanvas(o.indexToWorld([0,0,0])),d=this.worldToCanvas(o.indexToWorld([c[0],c[1],c[2]])),u=[Math.abs(d[0]-l[0]),Math.abs(d[1]-l[1])],[f,h]=u;let g=this.getZoom()/this.insetImageMultiplier;if(r){const[p,v]=r,w=Math.max(Math.abs(f/a),Math.abs(h/s)),m=Math.abs(p*f/a),y=Math.abs(v*h/s),C=this.getZoom(),x=this.getZoom(this.fitToCanvasCamera);g=(m>y?w/m:w/y)*C/x,this.setZoom(this.insetImageMultiplier*g,!1)}if(n){const{imagePoint:p,canvasPoint:v=p||[.5,.5]}=n,[w,m]=v,y=a*(w-.5),C=s*(m-.5),[x,S]=p||v,T=g,_=this.insetImageMultiplier*T*f*(.5-x),E=this.insetImageMultiplier*T*h*(.5-S),D=_+y,b=E+C,I=[D,b];zr(I,I,this.getPan()),this.setPan(I,!1)}}getDisplayArea(){return this.options?.displayArea}resetCamera(e){const{resetPan:r=!0,resetZoom:n=!0,resetToCenter:i=!0,storeAsInitialCamera:o=!0}=e||{},a=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera();let c;const l=this.getDefaultActor();l&&Uo(l)?c=l.actor.getMapper().getInputData().getBounds():c=a.computeVisiblePropBounds();const d=[0,0,0],u=this.getDefaultImageData();if(u){const A=u.getSpacing();c[0]=c[0]+A[0]/2,c[1]=c[1]-A[0]/2,c[2]=c[2]+A[1]/2,c[3]=c[3]-A[1]/2,c[4]=c[4]+A[2]/2,c[5]=c[5]-A[2]/2}const f=this.getVtkActiveCamera(),h=f.getViewPlaneNormal(),g=f.getViewUp();if(d[0]=(c[0]+c[1])/2,d[1]=(c[2]+c[3])/2,d[2]=(c[4]+c[5])/2,u){const G=u.getDimensions().map(L=>Math.floor(L/2)),k=[G[0],G[1],G[2]];u.indexToWorld(k,d)}let p,v;const m=Qa().rendering?.useLegacyCameraFOV??!1;if(u&&!m){const A=u.getExtent(),G=u.getSpacing();p=(A[1]-A[0])*G[0],v=(A[3]-A[2])*G[1]}else({widthWorld:p,heightWorld:v}=this._getWorldDistanceViewUpAndViewRight(c,g,h));const y=[this.sWidth,this.sHeight],C=p/v,x=y[0]/y[1],S=C/x,T=S<1?this.insetImageMultiplier*v/2:this.insetImageMultiplier*v*S/2,_=Mf.boundsRadius(c)*(this.type===Nn.VOLUME_3D?10:1),E=this.insetImageMultiplier*_,D=Math.abs(pt.dot(g,h))>.999?[-g[2],g[0],g[1]]:g,b=this._getFocalPointForResetCamera(d,s,{resetPan:r,resetToCenter:i}),I=[b[0]+E*h[0],b[1]+E*h[1],b[2]+E*h[2]];a.resetCameraClippingRange(c);const O=[-lr.MAXIMUM_RAY_DISTANCE,lr.MAXIMUM_RAY_DISTANCE];f.setPhysicalScale(_),f.setPhysicalTranslation(-b[0],-b[1],-b[2]),this.setCamera({parallelScale:n?T:s.parallelScale,focalPoint:b,position:I,viewAngle:90,viewUp:D,clippingRange:O});const M=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),o&&this.setInitialCamera(M),n&&this.setZoom(1,o);const R={type:"ResetCameraEvent",renderer:a};return a.invokeEvent(R),this.triggerCameraModifiedEventIfNecessary(s,M),u&&this.options.displayArea&&n&&r&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const n=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),o=this.worldToCanvas(an([0,0,0],e.focalPoint,i)),a=this.worldToCanvas(an([0,0,0],n,i));return En([0,0],o,a)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,r=!1){const n=this.getCamera(),{focalPoint:i,position:o}=n,a=this.canvasToWorld([0,0]),s=En([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!r)return;const c=an(Ie(),this.canvasToWorld(s),a),l=an(Ie(),i,c),d=an(Ie(),o,c);this.setCamera({...n,focalPoint:l,position:d},r)}getZoom(e=this.initialCamera){if(!e)return 1;const r=this.getVtkActiveCamera(),{parallelScale:n}=e;return n/r.getParallelScale()}setZoom(e,r=!1){const n=this.getCamera(),{parallelScale:i}=this.initialCamera,o=i/e;n.parallelScale===o&&!r||this.setCamera({...n,parallelScale:o},r)}_getFocalPointForViewPlaneReset(e){const{focalPoint:r,viewPlaneNormal:n}=this.getCamera(),i=this._getViewImageDataIntersections(e,r,n);let o=0,a=0,s=0;return i.forEach(([l,d,u])=>{o+=l,a+=d,s+=u}),[o/i.length,a/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),r=(s,c)=>s.some(l=>isNaN(l))?c:s,n=r([...e.getViewUp()],[0,1,0]),i=r([...e.getViewPlaneNormal()],[0,0,-1]),o=r([...e.getPosition()],[0,0,1]),a=r([...e.getFocalPoint()],[0,0,0]);return{viewUp:n,viewPlaneNormal:i,position:o,focalPoint:a,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,r=!1){const n=this.getVtkActiveCamera(),i=this.getCamera(),o=Object.assign({},i,e),{viewUp:a,viewPlaneNormal:s,position:c,focalPoint:l,parallelScale:d,viewAngle:u,flipHorizontal:f,flipVertical:h,clippingRange:g}=e;if(f!==void 0){const w=f&&!this.flipHorizontal||!f&&this.flipHorizontal;w&&this.flip({flipHorizontal:w})}if(h!==void 0){const w=h&&!this.flipVertical||!h&&this.flipVertical;w&&this.flip({flipVertical:w})}a!==void 0&&n.setViewUp(a),s!==void 0&&n.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&n.setPosition(...c),l!==void 0&&n.setFocalPoint(...l),d!==void 0&&n.setParallelScale(d),u!==void 0&&n.setViewAngle(u),g!==void 0&&n.setClippingRange(g);const p=i.focalPoint,v=i.viewUp;if(p&&l||v&&a){const w=n.getViewPlaneNormal(),m=n.getViewUp();let y=!1,C=!1;if(l){const x=[l[0]-p[0],l[1]-p[1],l[2]-p[2]];y=Math.abs(pt.dot(x,w))>0}if(a&&(C=!Et(m,v)),y||C){const x=this.getDefaultActor();if(!x?.actor)return;Gi(x,"vtkActor")||this.updateClippingPlanesForActors(o),(Gi(x,"vtkImageSlice")||this.type===Nn.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}r&&this.setInitialCamera(o),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,r){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const n={previousCamera:e,camera:r,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Ye(this.element,$e.CAMERA_MODIFIED,n)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(n=>{if(!n.actor)return;const i=n.actor.getMapper();let o=n?.clippingFilter?n?.clippingFilter.getClippingPlanes():i.getClippingPlanes();o.length===0&&n?.clippingFilter&&(o=[Kn.newInstance(),Kn.newInstance()]);let a=lr.MINIMUM_SLAB_THICKNESS;n.slabThickness&&(a=n.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(o,a,s,c),Ye(this.element,$e.CLIPPING_PLANES_UPDATED,{actorEntry:n,focalPoint:c,vtkPlanes:o,viewport:this})})}setOrientationOfClippingPlanes(e,r,n,i){if(e.length<2)return;const o=[n[0],n[1],n[2]];pt.multiplyScalar(o,r),e[0].setNormal(n);const a=[0,0,0];pt.subtract(i,o,a),e[0].setOrigin(a),e[1].setNormal(-n[0],-n[1],-n[2]);const s=[0,0,0];pt.add(i,o,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const r=e.actor.getMapper();let n=e?.clippingFilter?e?.clippingFilter.getClippingPlanes():r.getClippingPlanes();return n.length===0&&e?.clippingFilter&&(n=[Kn.newInstance(),Kn.newInstance()]),n}_getWorldDistanceViewUpAndViewRight(e,r,n){const i=this._getCorners(e),o=this._getCorners(e),a=tn(Ie(),r,n);let s=Qr.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]);i.forEach(f=>s.apply(f));let c=1/0,l=-1/0;for(let f=0;f<8;f++){const h=i[f][0];h>l&&(l=h),h<c&&(c=h)}s=Qr.buildFromDegree().identity().rotateFromDirections([a[0],a[1],a[2]],[1,0,0]),o.forEach(f=>s.apply(f));let d=1/0,u=-1/0;for(let f=0;f<8;f++){const h=o[f][0];h>u&&(u=h),h<d&&(d=h)}return{widthWorld:u-d,heightWorld:l-c}}getViewReference(e){const{focalPoint:r,viewPlaneNormal:n,viewUp:i}=this.getCamera(),o=this.getFrameOfReferenceUID(),a={FrameOfReferenceUID:o,cameraFocalPoint:r,viewPlaneNormal:n,viewUp:i,sliceIndex:e?.sliceIndex??this.getSliceIndex(),planeRestriction:{FrameOfReferenceUID:o,point:e?.points?.[0]||r,inPlaneVector1:i,inPlaneVector2:tn(Ie(),i,n)}};return e?.points&&mD(e.points,a.planeRestriction),a}isPlaneViewable(e,r){if(e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{focalPoint:n,viewPlaneNormal:i}=this.getCamera(),{point:o,inPlaneVector1:a,inPlaneVector2:s}=e;if(r?.withOrientation)return!0;if(a&&!Et(0,ft(i,a))||s&&!Et(0,ft(i,s)))return!1;if(r?.withNavigation)return!0;const c=rn(Ie(),o,n);return Et(0,ft(c,i))}isReferenceViewable(e,r){if(e.planeRestriction)return this.isPlaneViewable(e.planeRestriction,r);if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:n}=e,i=this.getCamera();return n&&!Et(n,i.viewPlaneNormal)&&!Et(ga(i.viewPlaneNormal,i.viewPlaneNormal),n)?r?.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0,flipHorizontal:!0,flipVertical:!0}){const r={},{rotation:n,displayArea:i,zoom:o,pan:a,flipHorizontal:s,flipVertical:c}=e;n&&(r.rotation=this.getRotation()),i&&(r.displayArea=this.getDisplayArea());const l=this.getZoom();return o&&(r.zoom=l),a&&(r.pan=this.getPan(),Ga(r.pan,r.pan,1/l)),s&&(r.flipHorizontal=this.flipHorizontal),c&&(r.flipVertical=this.flipVertical),r}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:r,zoom:n=this.getZoom(),pan:i,rotation:o,flipHorizontal:a=this.flipHorizontal,flipVertical:s=this.flipVertical}=e;r!==this.getDisplayArea()&&this.setDisplayArea(r),this.setZoom(n),i&&this.setPan(Ga([0,0],i,n)),a!==void 0&&a!==this.flipHorizontal&&this.flip({flipHorizontal:a}),s!==void 0&&s!==this.flipVertical&&this.flip({flipVertical:s}),o>=0&&this.setRotation(o)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,r,{resetPan:n=!0,resetToCenter:i=!0}){if(i&&n)return e;if(i&&!n)return dy(r.focalPoint)?e:r.focalPoint;if(!i&&n){const o=r,a=o.focalPoint,s=o.viewPlaneNormal,c=an(Ie(),e,a),l=ft(c,s),d=en(Ie(),e,s,-1*l);return[d[0],d[1],d[2]]}if(!n&&!i)return dy(r.focalPoint)?e:r.focalPoint}_isInBounds(e,r){const[n,i,o,a,s,c]=r,[l,d,u]=e;return!(l<n||l>i||d<o||d>a||u<s||u>c)}_getEdges(e){const[r,n,i,o,a,s,c,l]=this._getCorners(e);return[[r,n],[r,a],[r,i],[n,o],[n,s],[i,o],[i,c],[o,l],[a,c],[a,s],[s,l],[c,l]]}static boundsRadius(e){const r=(e[1]-e[0])**2,n=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(r+n+i||1)*.5}setDataIds(e,r){throw new Error("Unsupported operatoin setDataIds")}};Mf.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},Mf.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let W0=Mf;function vD(t,e,r=!1){const n=t.getCamera(),{focalPoint:i,viewPlaneNormal:o}=n,{spacingInNormalDirection:a,actorUID:s}=ad(t,n,e,r);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const l=c.actor;return{sliceRange:Q1(l,o,i),spacingInNormalDirection:a,camera:n}}function yu(t,e,r=!1){const{sliceRange:n,spacingInNormalDirection:i,camera:o}=vD(t,e,r),{min:a,max:s,current:c}=n,l=Math.round((s-a)/i),u=(c-a)/(s-a)*l,f=Math.round(u);return{numScrollSteps:l,currentStepIndex:f,sliceRangeInfo:{sliceRange:n,spacingInNormalDirection:i,camera:o}}}function T0(t,e,r,n,i,o){const{min:a,max:s,current:c}=r,l=Ie();rn(l,e,t);const d=Math.round((s-a)/i),f=(c-a)/(s-a)*d;let h=Math.round(f),g=[t[0]-n[0]*f*i,t[1]-n[1]*f*i,t[2]-n[2]*f*i];h+=o,h>d?h=d:h<0&&(h=0);const p=h*i;g=[g[0]+n[0]*p,g[1]+n[1]*p,g[2]+n[2]*p];const v=[g[0]+l[0],g[1]+l[1],g[2]+l[2]];return{newFocalPoint:g,newPosition:v}}function yD(t){let e=[];const[r,n]=t.getRange();t.getTable(r,n,1024,e),e=e.filter((h,g)=>g%3===0);const i=[...Array(1024).keys()].map((h,g)=>r+(n-r)/1023*g),o=e[256],a=Math.log((1-o)/o),s=i[256],c=e[256*3],l=Math.log((1-c)/c),d=i[256*3],u=Math.round(4*(d-s)/(a-l)),f=Math.round(s+u*a/4);return[Math.round(f-u/2),Math.round(f+u/2)]}function wD(t,e){const r=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:n}=HX(r),i=n[0],o=n[1]-n[0],a=Qs.newInstance(),s=[];for(let C=0;C<r.length;C+=4){let x=r[C];const S=r[C+1],T=r[C+2],_=r[C+3];x=(x-i)/o,s.push([x,S,T,_])}XX(s,n,a),t.getProperty().setRGBTransferFunction(0,a);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=bu.newInstance(),d=[];for(let C=0;C<c.length;C+=2){let x=c[C];const S=c[C+1];x=(x-i)/o,d.push([x,S])}KX(d,n,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[f,h,g,p]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,f),u.setGradientOpacityMinimumOpacity(0,h),u.setGradientOpacityMaximumValue(0,g),u.setGradientOpacityMaximumOpacity(0,p),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const v=parseFloat(e.ambient),w=parseFloat(e.diffuse),m=parseFloat(e.specular),y=parseFloat(e.specularPower);u.setAmbient(v),u.setDiffuse(w),u.setSpecular(m),u.setSpecularPower(y)}function HX(t){let e=1/0,r=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),r=Math.max(r,t[i]);const n=(r-e)/2;return{shiftRange:[-n,n],min:e,max:r}}function XX(t,e,r){const n=e[1]-e[0],i=t.map(([o,a,s,c])=>[o*n+e[0],a,s,c]);return r.removeAllPoints(),i.forEach(([o,a,s,c])=>r.addRGBPoint(o,a,s,c)),i}function KX(t,e,r){const n=e[1]-e[0],i=t.map(([o,a])=>[o*n+e[0],a]);return r.removeAllPoints(),i.forEach(([o,a])=>r.addPoint(o,a)),i}const{MPR_CAMERA_VALUES:so}=pl,{OrientationAxis:Gs}=To;function CD(t,e,r,n){let i;switch(n){case Gs.AXIAL:case Gs.AXIAL_REFORMAT:i=so.axial;break;case Gs.SAGITTAL:case Gs.SAGITTAL_REFORMAT:i=so.sagittal;break;case Gs.CORONAL:case Gs.CORONAL_REFORMAT:i=so.coronal;break;default:i=so.axial;break}const o=Lt(Ie(),t),a=Lt(Ie(),e),s=Lt(Ie(),r),c=[o,a,s],l=[mt(i.viewRight[0],i.viewRight[1],i.viewRight[2]),mt(i.viewUp[0],i.viewUp[1],i.viewUp[2]),mt(i.viewPlaneNormal[0],i.viewPlaneNormal[1],i.viewPlaneNormal[2])],d=new Set,u=p=>{let v=0,w=-2,m=!1;c.forEach((C,x)=>{if(d.has(x))return;const S=ft(p,C),T=Math.abs(S);T>w&&(w=T,v=x,m=S<0)}),d.add(v);const y=Fo(c[v]);return m&&ga(y,y),y},f=u(l[0]),h=u(l[1]),g=u(l[2]);return{viewPlaneNormal:[g[0],g[1],g[2]],viewUp:[h[0],h[1],h[2]],viewRight:[f[0],f[1],f[2]]}}function xD(t,e){if(!t.getActors()?.length)return;t.type!==Nn.ORTHOGRAPHIC&&console.warn("Viewport should be a volume viewport");let r=t.getCurrentImageId();if(r||(r=t.getImageIds()?.[0]),!r)return;const{imageOrientationPatient:n}=ut("imagePlaneModule",r),i=mt(n[0],n[1],n[2]),o=mt(n[3],n[4],n[5]),a=tn(Ie(),i,o);let{orientation:s}=e||{};const{useViewportNormal:c}=e||{};let l=a;return c&&(l=t.getCamera().viewPlaneNormal),s||(s=qX(l)),CD(i,o,a,s)}function qX(t){const e=Lt(Ie(),t),r=mt(so.axial.viewPlaneNormal[0],so.axial.viewPlaneNormal[1],so.axial.viewPlaneNormal[2]),n=mt(so.sagittal.viewPlaneNormal[0],so.sagittal.viewPlaneNormal[1],so.sagittal.viewPlaneNormal[2]),i=mt(so.coronal.viewPlaneNormal[0],so.coronal.viewPlaneNormal[1],so.coronal.viewPlaneNormal[2]),o=Math.abs(ft(e,r)),a=Math.abs(ft(e,n)),s=Math.abs(ft(e,i));return o>=a&&o>=s?Gs.AXIAL:a>=s?Gs.SAGITTAL:Gs.CORONAL}function SD(){return Qa()?.rendering?.renderingEngineMode===Tu.ContextPool}const YX=t=>!(typeof t=="number"&&Number.isFinite(t)),{vtkErrorMacro:xg}=Z;function JX(t,e){e.classHierarchy.push("vtkConvolution2DPass"),t.computeKernelWeight=function(n){const i=n.reduce((o,a)=>o+a);return i<=0?1:i},t.traverse=function(r){if(e.deleted)return;if(e.kernelDimension%2!==1){xg("Invalid kernel dimension! Kernel dimension must be odd (e.g. 3, 5, 7, ...).");return}e.kernel===null&&(e.kernel=new Float32Array(e.kernelDimension),e.kernel[Math.floor(e.kernelDimension/2)]=1);const n=e.kernelDimension*e.kernelDimension;if(e.kernel.length!==n){xg(`The given kernel is invalid. 2D convolution kernels have to be 1D arrays with ${n} components representing the ${e.kernelDimension}x${e.kernelDimension} kernel in row-major form.`);return}e.framebuffer===null&&(e.framebuffer=Mh.newInstance());const i=r.getSize(),o=r.getContext();if(o===null){e.delegates.forEach(c=>{c.traverse(r,t)});return}e.VBOBuildTime.getMTime()<t.getMTime()&&(e.tris.setOpenGLRenderWindow(r),t.buildVertexBuffer()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();const a=e.framebuffer.getSize();if((a===null||a[0]!==i[0]||a[1]!==i[1])&&(e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),e.delegates.forEach(c=>{c.traverse(r,t)}),e.framebuffer.restorePreviousBindingsAndBuffers(),e.convolutionShader!==null&&e.oldKernelDimension!==e.kernelDimension&&(e.convolutionShader=null,e.oldKernelDimension=e.kernelDimension),e.convolutionShader===null){e.convolutionShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),t.getFragmentShaderCode(e.kernelDimension),"");const c=e.convolutionShader;e.copyVAO=$1.newInstance(),e.copyVAO.setOpenGLRenderWindow(r),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(c,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),o.FLOAT,3,o.FALSE)||xg("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(c,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),o.FLOAT,2,o.FALSE)||xg("Error setting vertexDC in copy shader VAO.")}else r.getShaderCache().readyShaderProgram(e.convolutionShader);o.viewport(0,0,i[0],i[1]),o.scissor(0,0,i[0],i[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.convolutionShader.setUniformi("u_image",s.getTextureUnit()),e.convolutionShader.setUniform2f("u_textureSize",s.getWidth(),s.getHeight()),e.convolutionShader.setUniformfv("u_kernel",e.kernel),e.convolutionShader.setUniformf("u_kernelWeight",t.computeKernelWeight(e.kernel)),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate()},t.getFragmentShaderCode=r=>{const n=r*r;let i=["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D u_image;","uniform vec2 u_textureSize;",`uniform float u_kernel[${n}];`,"uniform float u_kernelWeight;","varying vec2 tcoord;","void main(){","    vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;",`    vec4 colorSum =
`].join(`
`);const o=Math.floor(r/2);let a=0;for(let s=-o;s<=o;++s)for(let c=-o;c<=o;++c)i+=`        texture2D(u_image, tcoord + onePixel * vec2(${c}, ${s})) * u_kernel[${a}]`,++a,a!==n&&(i+=` +
`);return i+=[";","    gl_FragData[0] = vec4((colorSum / u_kernelWeight).rgb, texture2D(u_image, tcoord).a);","}"].join(`
`),i},t.buildVertexBuffer=()=>{const r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),o=Ot.newInstance({numberOfComponents:3,values:r});o.setName("points");const a=Ot.newInstance({numberOfComponents:2,values:n});a.setName("tcoords");const s=Ot.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",vo.SURFACE,{points:o,tcoords:a,cellOffset:0}),e.VBOBuildTime.modified()}}const ZX={framebuffer:null,convolutionShader:null,tris:null,kernel:[0,0,0,0,1,0,0,0,0],oldKernelDimension:3,kernelDimension:3};function TD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZX,r),X1.extend(t,e,r),e.VBOBuildTime={},Z.obj(e.VBOBuildTime,{mtime:0}),e.tris=lc.newInstance(),Z.setGet(t,e,["kernel","kernelDimension"]),Z.get(t,e,["framebuffer"]),JX(t,e)}const QX=Z.newInstance(TD,"vtkConvolution2DPass");var _D={newInstance:QX,extend:TD};function ED(t){let e=mw.newInstance();if(t>0){const r=_D.newInstance();r.setDelegates([e]);const n=Math.max(0,t);r.setKernelDimension(3),r.setKernel([-n,-n,-n,-n,1+8*n,-n,-n,-n,-n]),e=r}return e}function bD(t){let e=mw.newInstance();if(t>0){const r=_D.newInstance();r.setDelegates([e]);const n=Math.min(t,1e3),i=15,a=eK(i,5),s=i*i,c=Math.floor(s/2),l=Array(s).fill(0);l[c]=1;const d=Math.min(n/10,1),u=a.map((f,h)=>(1-d)*l[h]+d*f);r.setKernelDimension(15),r.setKernel(u),e=r}return e}function eK(t,e){const r=[],n=(t-1)/2;let i=0;for(let o=0;o<t;o++)for(let a=0;a<t;a++){const s=a-n,c=o-n,l=Math.exp(-(s*s+c*c)/(2*Math.pow(e,2)));r.push(l),i+=l}return r.map(o=>o/i)}class Zn extends W0{constructor(e){if(super(e),this.useCPURendering=!1,this.sharpening=0,this.smoothing=0,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const o=this.getPan(this.fitToCanvasCamera),a=this.getPan(),s=this.getCamera(),c=mo([0,0],o,a);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),d=l?ga([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:d}),this.rotateCamera(i);const u=this.getPan(),f=this.getPan(this.fitToCanvasCamera),h=mo([0,0],u,f),g=zr([0,0],o,h);if(this.setPan(g,!1),this._suppressCameraModifiedEvents)return;const p=this.getCamera(),v={previousCamera:s,camera:p,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Ye(this.element,$e.CAMERA_MODIFIED,v)},this.setSharpening=i=>{this.sharpening=i,this.render()},this.setSmoothing=i=>{this.smoothing=i,this.render()},this.getRenderPasses=()=>{if(!this.shouldUseCustomRenderPass())return null;const i=[];try{return this.smoothing>0&&i.push(bD(this.smoothing)),this.sharpening>0&&i.push(ED(this.sharpening)),i.length?i:null}catch(o){return console.warn("Failed to create custom render passes:",o),null}},this.getDefaultProperties=i=>{let o;return i!==void 0&&(o=this.perVolumeIdDefaultProperties.get(i)),o!==void 0?o:{...this.globalDefaultProperties}},this.getProperties=i=>{if(!this._getApplicableVolumeActor(i))return;const{colormap:a,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:d,preset:u}=this.viewportProperties;if(i||=this.getVolumeId(),!Ne.getVolume(i))return null;const h=this.getActors().find(x=>x.referencedId===i);if(!h)return;const p=h.actor.getProperty().getRGBTransferFunction(0),[v,w]=this.viewportProperties?.VOILUTFunction==="SIGMOID"?yD(p):p.getRange(),m={lower:v,upper:w},y=this.getColormap(i);return{colormap:i&&y?y:a,voiRange:m,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:d,preset:u,sharpening:this.sharpening,smoothing:this.smoothing}},this.getColormap=i=>{const o=this._getApplicableVolumeActor(i);if(!o)return;const{volumeActor:a}=o,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),l=c.reduce((h,g)=>(h.push(g.x,g.r,g.g,g.b),h),[]),d=X5(l,a)||{},u=q5(a),f=Y5(a);return d.threshold=u,d.opacity=f,d},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:o,flipVertical:a}=this.getCameraNoRotation(),s=a?ga([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=z5(s,i)*180/Math.PI,l=tn([0,0,0],s,i);return ft(l,o)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorldTiled=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),s=this.getVtkDisplayCoordsTiled(i),d=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().displayToWorld(s[0],s[1],s[2],a);return o.setIsPerformingCoordinateTransformation?.(!1),[d[0],d[1],d[2]]},this.canvasToWorldContextPool=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,d=c/l,[u,f,h,g]=a.getViewport(),p=h-u,v=g-f,w=[i[0]*s,i[1]*s],m=[u+w[0]/c*p,f+(1-w[1]/l)*v,0],y=a.normalizedDisplayToProjection(m[0],m[1],m[2]),C=a.projectionToView(y[0],y[1],y[2],d),x=a.viewToWorld(C[0],C[1],C[2]);return o.setIsPerformingCoordinateTransformation?.(!1),[x[0],x[1],x[2]]},this.getVtkDisplayCoordsTiled=i=>{const o=window.devicePixelRatio||1,a=[i[0]*o,i[1]*o],l=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow().getSize(),d=[a[0]+this.sx,a[1]+this.sy];return d[1]=l[1]-d[1],[d[0],d[1],0]},this.getVtkDisplayCoordsContextPool=i=>{const o=window.devicePixelRatio||1,a=[i[0]*o,i[1]*o],s=this.getRenderer(),{width:c,height:l}=this.canvas,[d,u,f,h]=s.getViewport(),g=f-d,p=h-u,v=a[0]/c*g*c,w=a[1]/l*p*l,m=[v,p*l-w];return[m[0],m[1],0]},this.worldToCanvasTiled=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),d=c.worldToDisplay(...i,a);d[1]=l[1]-d[1];const u=[d[0]-this.sx,d[1]-this.sy],f=window.devicePixelRatio||1,h=[u[0]/f,u[1]/f];return o.setIsPerformingCoordinateTransformation(!1),h},this.worldToCanvasContextPool=i=>{const o=this.getVtkActiveCamera();o.setIsPerformingCoordinateTransformation?.(!0);const a=this.getRenderer(),{width:s,height:c}=this.canvas,l=s/c,[d,u,f,h]=a.getViewport(),g=f-d,p=h-u,v=a.worldToView(i[0],i[1],i[2]),w=a.viewToProjection(v[0],v[1],v[2],l),m=a.projectionToNormalizedDisplay(w[0],w[1],w[2]),y=(m[0]-d)/g,C=(m[1]-u)/p,x=y*s,S=(1-C)*c,T=window.devicePixelRatio||1,_=[x/T,S/T];return o.setIsPerformingCoordinateTransformation(!1),_},this.hasImageURI=i=>this.getActors().filter(a=>Gi(a,"vtkVolume")).some(({uid:a,referencedId:s})=>{const c=Ne.getVolume(s||a);return c?.getImageIdIndex?c.getImageIdIndex(i)!==void 0||c.getImageURIIndex(i)!==void 0:!1}),this.getImageIds=i=>{const o=this._getApplicableVolumeActor(i);if(!o)throw new Error(`No actor found for the given volumeId: ${i}`);const a=o.volumeId,s=Ne.getVolume(a);if(!s)throw new Error(`imageVolume with id: ${a} does not exist in cache`);return s.imageIds},this.renderingPipelineFunctions={worldToCanvas:{tiled:this.worldToCanvasTiled,contextPool:this.worldToCanvasContextPool},canvasToWorld:{tiled:this.canvasToWorldTiled,contextPool:this.canvasToWorldContextPool},getVtkDisplayCoords:{tiled:this.getVtkDisplayCoordsTiled,contextPool:this.getVtkDisplayCoordsContextPool},getRenderer:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},this.useCPURendering=ff(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");this._configureRenderingPipeline();const r=this.getRenderer(),n=sX.newInstance();switch(r.setActiveCamera(n),this.type){case Nn.ORTHOGRAPHIC:n.setParallelProjection(!0);break;case Nn.VOLUME_3D:n.setParallelProjection(!0);break;case Nn.PERSPECTIVE:n.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,r=!0){const{viewPlaneNormal:n,viewUp:i}=this._getOrientationVectors(e)||{};if(!n||!i)return;const o=this.getVtkActiveCamera();o.setDirectionOfProjection(-n[0],-n[1],-n[2]),o.setViewUpFrom(i),this.initialViewUp=i,r&&this.resetCamera({resetOrientation:!1,resetRotation:!1})}initializeVolumeNewImageEventDispatcher(){const e=n.bind(this),r=i.bind(this);function n(o){const{viewportId:a}=o.detail;a!==this.id||this.isDisabled||!this.getImageData()||$X(o)}function i(o){const{viewportId:a}=o.detail;a===this.id&&(this.element.removeEventListener($e.CAMERA_MODIFIED,e),Fe.removeEventListener($e.ELEMENT_DISABLED,r),WX(a))}this.element.removeEventListener($e.CAMERA_MODIFIED,e),this.element.addEventListener($e.CAMERA_MODIFIED,e),Fe.addEventListener($e.ELEMENT_DISABLED,r)}setVOILUTFunction(e,r,n){Object.values(ui).includes(e)||(e=ui.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,r,n),this.viewportProperties.VOILUTFunction=e}setColormap(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i,a=Qs.newInstance();let s=jf(e.name);const{name:c}=e;if(s||(s=$f.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const l=o.getProperty().getRGBTransferFunction(0).getRange();if(a.applyColorMap(s),a.setMappingRange(l[0],l[1]),o.getProperty().setRGBTransferFunction(0,a),this.viewportProperties.colormap=e,!n){const d=this.getColormap(r),u={viewportId:this.id,colormap:d,volumeId:r};Ye(this.element,$e.VOI_MODIFIED,u),Ye(this.element,$e.COLORMAP_MODIFIED,u)}}setOpacity(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n,o=bu.newInstance();typeof e.opacity=="number"?j4(i,e.opacity):(e.opacity.forEach(({opacity:c,value:l})=>{o.addPoint(l,c)}),i.getProperty().setScalarOpacity(0,o)),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity;const a=this.getColormap(r),s={viewportId:this.id,colormap:a,volumeId:r};Ye(this.element,$e.COLORMAP_MODIFIED,s)}setInvert(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const o=i.volumeId,a=this._getOrCreateColorTransferFunction(o);if(gf(a),this.viewportProperties.invert=e,!n){const s={...this.getVOIModifiedEventDetail(o),invertStateChanged:!0};Ye(this.element,$e.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const r=this._getApplicableVolumeActor(e);if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);const o=r.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),a=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:o[0],upper:o[1]},volumeId:r.volumeId,VOILUTFunction:s,colormap:a,invert:c}}_getOrCreateColorTransferFunction(e){const r=this._getApplicableVolumeActor(e);if(!r)return null;const{volumeActor:n}=r,i=n.getProperty().getRGBTransferFunction(0);if(i)return i;const o=Qs.newInstance();return n.getProperty().setRGBTransferFunction(0,o),o}setInterpolationType(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,r,n=!1){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i,a=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");if([s.lower,s.upper].some(YX)){console.warn("VOI range contains invalid values, ignoring setVOI request",s);return}const{VOILUTFunction:c}=this.getProperties(a);if(c===ui.SAMPLED_SIGMOID){const l=J5(s);o.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:d}=s;o.getProperty().getRGBTransferFunction(0).setRange(l,d)}if(!n){const l={...this.getVOIModifiedEventDetail(a)};Ye(this.element,$e.VOI_MODIFIED,l)}this.viewportProperties.voiRange=s}rotateCamera(e){const r=e-this.getRotation();this.getVtkActiveCamera().roll(-r)}setDefaultProperties(e,r){r==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(r,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const r=super.getViewReference(e),n=this.getVolumeId(e);if(e?.forFrameOfReference!==!1&&(r.volumeId=n),typeof e?.sliceIndex!="number")return r;const{viewPlaneNormal:i}=r,o=e?.sliceIndex-this.getSliceIndex(),{sliceRangeInfo:a}=yu(this,n,!0),{sliceRange:s,spacingInNormalDirection:c,camera:l}=a,{focalPoint:d,position:u}=l,{newFocalPoint:f}=T0(d,u,s,i,c,o);return r.cameraFocalPoint=f,r}isReferenceViewable(e,r){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,r))return!1;if(r?.withNavigation){const{referencedImageId:o}=e;return!o||this.hasImageURI(o)}const n=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=n&&n<=i[1]:i===void 0||i===n}scroll(e=1){const r=this.getVolumeId(),{sliceRangeInfo:n}=yu(this,r,!0);if(!n)return;const{sliceRange:i,spacingInNormalDirection:o,camera:a}=n,{focalPoint:s,viewPlaneNormal:c,position:l}=a,{newFocalPoint:d,newPosition:u}=T0(s,l,i,c,o,e);this.setCamera({focalPoint:d,position:u}),this.render()}setBestOrentation(e,r){if(!e&&!r)return;const{viewPlaneNormal:n}=this.getCamera();if(Ku(n,r)&&Ku(n,e))return;const i=this._getAcquisitionPlaneOrientation();if(Ku(i.viewPlaneNormal,r)&&Ku(i.viewPlaneNormal,e)){this.setOrientation(i);return}for(const a of Object.values(Xs))if(Ku(a.viewPlaneNormal,r)&&Ku(a.viewPlaneNormal,e)){this.setOrientation(a);return}const o=tn(Ie(),r||i.viewPlaneNormal,e);Lt(o,o),this.setOrientation({viewPlaneNormal:o})}setViewPlane(e){const{point:r,inPlaneVector1:n,inPlaneVector2:i,FrameOfReferenceUID:o}=e;this.setBestOrentation(n,i),this.setViewReference({FrameOfReferenceUID:o,cameraFocalPoint:r,viewPlaneNormal:this.getCamera().viewPlaneNormal})}setViewReference(e){if(!e)return;const r=this.getVolumeId(),{FrameOfReferenceUID:n,cameraFocalPoint:i,referencedImageId:o,planeRestriction:a,viewPlaneNormal:s,viewUp:c}=e;let{sliceIndex:l}=e;if(a&&!s)return this.setViewPlane(a);const{focalPoint:d,viewPlaneNormal:u,position:f}=this.getCamera(),h=$4(u,s),g=Et(u,s);if(typeof l=="number"&&r!==void 0&&e.volumeId===r&&(h||g)){const{currentStepIndex:p,sliceRangeInfo:v,numScrollSteps:w}=yu(this,r,!0),{sliceRange:m,spacingInNormalDirection:y}=v;h&&(l=w-l-1);const C=l-p,{newFocalPoint:x,newPosition:S}=T0(d,f,m,u,y,C);this.setCamera({focalPoint:x,position:S})}else if(n===this.getFrameOfReferenceUID()){if(s&&!h&&!g){this.setOrientation({viewPlaneNormal:s,viewUp:c}),this.setViewReference(e);return}if(o&&this.isInAcquisitionPlane()){const p=ut(Ui.IMAGE_PLANE,o),{imagePositionPatient:v}=p,{focalPoint:w}=this.getCamera(),m=an(Ie(),w,v),y=ft(m,u),C=en(Ie(),w,[-u[0],-u[1],-u[2]],y),x=an(Ie(),C,w),S=hr(Ie(),f,x);this.setCamera({focalPoint:C,position:S}),this.render();return}if(i){const p=an([0,0,0],i,d),v=s??u,w=ft(p,v);Et(w,0)||xr(p,v,w);const m=hr([0,0,0],d,p),y=hr([0,0,0],f,p);this.setCamera({focalPoint:m,position:y})}}else throw new Error(`Incompatible view refs: ${n}!==${this.getFrameOfReferenceUID()}`)}setThreshold(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n;H4(i,e.threshold),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.threshold=e.threshold;const o=this.getColormap(r),a={viewportId:this.id,colormap:o,volumeId:r};Ye(this.element,$e.COLORMAP_MODIFIED,a)}setProperties({voiRange:e,VOILUTFunction:r,invert:n,colormap:i,preset:o,interpolationType:a,slabThickness:s,sampleDistanceMultiplier:c,sharpening:l,smoothing:d}={},u,f=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:r,invert:n,colormap:i,preset:o,slabThickness:s}),n!==void 0&&this.viewportProperties.invert!==n&&this.setInvert(n,u,f),i?.name&&this.setColormap(i,u,f),i?.opacity!=null&&this.setOpacity(i,u),i?.threshold!=null&&this.setThreshold(i,u),e!==void 0&&this.setVOI(e,u,f),typeof a<"u"&&this.setInterpolationType(a),r!==void 0&&this.setVOILUTFunction(r,u,f),o!==void 0&&this.setPreset(o,u,f),s!==void 0&&this.setSlabThickness(s),c!==void 0&&this.setSampleDistanceMultiplier(c),typeof l<"u"&&this.setSharpening(l),typeof d<"u"&&this.setSmoothing(d)}shouldUseCustomRenderPass(){return!this.useCPURendering}resetToDefaultProperties(e){const r=this.globalDefaultProperties;r.colormap?.name&&this.setColormap(r.colormap,e),r.colormap?.opacity!=null&&this.setOpacity(r.colormap,e),r.voiRange!==void 0&&this.setVOI(r.voiRange,e),r.VOILUTFunction!==void 0&&this.setVOILUTFunction(r.VOILUTFunction,e),r.invert!==void 0&&this.setInvert(r.invert,e),r.slabThickness!==void 0&&(this.setSlabThickness(r.slabThickness),this.viewportProperties.slabThickness=r.slabThickness),r.sampleDistanceMultiplier!==void 0&&this.setSampleDistanceMultiplier(r.sampleDistanceMultiplier),r.preset!==void 0&&this.setPreset(r.preset,e,!1),this.render()}setPreset(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i;let a=e;typeof a=="string"&&(a=hE.find(s=>s.name===e)),a&&(wD(o,a),this.viewportProperties.preset=a,this.render(),n||Ye(this.element,$e.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:o,presetName:a.name}))}setSampleDistanceMultiplier(e){}async setVolumes(e,r=!1,n=!1){const i=e[0].volumeId,o=Ne.getVolume(i);if(!o)throw new Error(`imageVolume with id: ${i} does not exist, you need to create/allocate the volume first`);const a=o.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,a),this._FrameOfReferenceUID=a,e.forEach(c=>{this._addVolumeId(c.volumeId)});const s=[];for(let c=0;c<e.length;c++){const{volumeId:l,actorUID:d,slabThickness:u,...f}=e[c],h=await uy(e[c],this.element,this.id,n),g=d||cn();s.push({uid:g,actor:h,slabThickness:u,referencedId:l,...f})}this._setVolumeActors(s),this.viewportStatus=_i.PRE_RENDER,this.initializeColorTransferFunction(e),Ye(this.element,$e.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:s}),r&&this.render()}async addVolumes(e,r=!1,n=!1){const i=Ne.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const o=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(a=>{this._addVolumeId(a.volumeId)});for(let a=0;a<e.length;a++){const{volumeId:s,visibility:c,actorUID:l,slabThickness:d,...u}=e[a],f=await uy(e[a],this.element,this.id,n);c||f.setVisibility(!1);const h=l||cn();o.push({uid:h,actor:f,slabThickness:d,referencedId:s,...u})}this.addActors(o),this.initializeColorTransferFunction(e),r&&this.render()}removeVolumeActors(e,r=!1){this.removeActors(e),r&&this.render()}setOrientation(e,r=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const r=e[0].volumeId,n=this._getOrCreateColorTransferFunction(r);!this.initialTransferFunctionNodes&&n&&(this.initialTransferFunctionNodes=Vp(n))}_getApplicableVolumeActor(e){const r=this.getActors();if(!r?.length)return;if(e){const i=r.find(o=>o.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const n=r[0];return{volumeActor:n.actor,volumeId:n.referencedId,actorUID:n.uid}}async _isValidVolumeInputArray(e,r){const n=e.length;for(let i=1;i<n;i++){const o=Ne.getVolume(e[i].volumeId);if(r!==o.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const r of this.volumeIds)if(r.includes(e))return!0;return!1}getImageData(e){if(!this.getDefaultActor())return;e||=this.getVolumeId();const n=this.getActors()?.find(s=>s.referencedId===e);if(!Gi(n,"vtkVolume"))return;const i=n.actor,o=Ne.getVolume(e),a=i.getMapper().getInputData();return{dimensions:a.getDimensions(),spacing:a.getSpacing(),origin:a.getOrigin(),direction:a.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:o?.metadata?.Modality,FrameOfReferenceUID:o?.metadata?.FrameOfReferenceUID},get scalarData(){return o?.voxelManager?.getScalarData()},scaling:o?.scaling,hasPixelSpacing:!0,voxelManager:o?.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,r){super.setCamera(e,r),this.setCameraClippingRange()}_setVolumeActors(e){for(let r=0;r<e.length;r++)this.viewportProperties.invert=!1;this.setActors(e)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getViewUp(e){const{viewUp:r}=this.getCamera(),n=ft(r,e);if(Et(n,0))return r;if(tp(e[0],1))return[0,0,1];if(tp(e[1],1))return[0,0,1];if(tp(e[2],1))return[0,-1,0];const i=en(Ie(),r,e,-n);return Lt(i,i),i}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal)return{...e,viewUp:e.viewUp||this._getViewUp(e.viewPlaneNormal)};throw new Error("Invalid orientation object. It must contain viewPlaneNormal")}else if(typeof e=="string"){if(e==="acquisition")return this._getAcquisitionPlaneOrientation();if(e==="reformat"||e.includes("_reformat"))return xD(this,{useViewportNormal:!0});if(Xs[e])return this.viewportProperties.orientation=e,Xs[e]}throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(Xs).join(", ")}`)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const r=this.getVolumeId(),n=Ne.getVolume(r);if(!n)throw new Error(`imageVolume with id: ${r} does not exist in cache`);const{direction:i}=n,o=i.slice(6,9).map(s=>-s),a=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:o,viewUp:a}}getSlabThickness(){const e=this.getActors();let r=lr.MINIMUM_SLAB_THICKNESS;return e.forEach(n=>{n.slabThickness>r&&(r=n.slabThickness)}),r}getIntensityFromWorld(e){const r=this.getDefaultActor();if(!Gi(r,"vtkVolume"))return;const{actor:n}=r,i=n.getMapper().getInputData(),o=Ne.getVolume(this.getVolumeId()),a=br(i,e);return o.voxelManager.getAtIJKPoint(a)}getVolumeId(e){const r=this.getActors();if(!r)return;if(!e?.volumeId){const i=r.find(o=>o.actor.getClassName()==="vtkVolume");return i?.referencedId||i?.uid}const n=r.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===e?.volumeId);return n?.referencedId||n?.uid}getViewReferenceId(e={}){let{volumeId:r,sliceIndex:n}=e;if(!r){const l=this.getActors();if(!l)return;r=l.find(d=>d.actor.getClassName()==="vtkVolume")?.referencedId}const i=this.getSliceIndex();n??=i;const{viewPlaneNormal:o,focalPoint:a}=this.getCamera(),s=r.includes("?")?"&":"?",c=o.map(l=>l.toFixed(3)).join(",");return`volumeId:${r}${s}sliceIndex=${n}&viewPlaneNormal=${c}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}_configureRenderingPipeline(){const e=SD();for(const r in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,r)){const n=this.renderingPipelineFunctions[r];this[r]=e?n.contextPool:n.tiled}}}function Ku(t,e){return!e||Et(ft(t,e),0)}function tK(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(Z.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),Eu())}const nK={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1],colorTextureWidth:1024,opacityTextureWidth:1024,labelOutlineTextureWidth:1024};function rK(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nK,r),ww.extend(t,e,r),Z.setGet(t,e,["slice","useCustomExtents","colorTextureWidth","opacityTextureWidth","labelOutlineTextureWidth"]),Z.setGetArray(t,e,["customDisplayExtent"],6),Z.setGetArray(t,e,["backgroundColor"],4),tK(t,e)}var iK={extend:rK};function DD(t,e,r){const n=r.getCurrentImage(),i=n.getExtent(),o=[i[0],i[2],i[4]],{ijkMode:a}=r.getClosestIJKAxis();let s=r.isA("vtkImageArrayMapper")?r.getSubSlice():r.getSlice();a!==r.getSlicingMode()&&(s=r.getSliceAtPosition(s)),o[a]+=s;const c=[0,0,0];n.indexToWorld(o,c),o[a]+=1;const l=[0,0,0];n.indexToWorld(o,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],Lt(l,l);const d=Kn.intersectWithLine(t,e,c,l);if(d.intersection){const u=d.x,f=[0,0,0];return n.worldToIndex(u,f),{t:d.t,absoluteIJK:f}}return null}function oK(t,e,r){const n=DD(t,e,r);if(n){const o=r.getCurrentImage().getExtent(),a=[Math.round(n.absoluteIJK[0]),Math.round(n.absoluteIJK[1]),Math.round(n.absoluteIJK[2])];return a[0]<o[0]||a[0]>o[1]||a[1]<o[2]||a[1]>o[3]||a[2]<o[4]||a[2]>o[5]?null:{t:n.t,ijk:a}}return null}function aK(t,e,r){const n=DD(t,e,r);if(n){const o=r.getCurrentImage().getExtent(),a=n.absoluteIJK,s=[Math.floor(a[0]),Math.floor(a[1]),Math.floor(a[2])];if(s[0]<o[0]||s[0]>o[1]-1||s[1]<o[2]||s[1]>o[3]-1||s[2]<o[4]||s[2]>(o[5]?o[5]-1:o[5]))return null;const c=[a[0]-s[0],a[1]-s[1],a[2]-s[2]];return{t:n.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:sK,otherStaticMethods:cK}=j1,{SlicingMode:Dn}=H1;function lK(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=n=>{const i=t.getCurrentImage();let o;if(n.length===3)o=n;else if(Number.isFinite(n)){const d=i.getBounds();switch(e.slicingMode){case Dn.X:o=[n,(d[3]+d[2])/2,(d[5]+d[4])/2];break;case Dn.Y:o=[(d[1]+d[0])/2,n,(d[5]+d[4])/2];break;case Dn.Z:o=[(d[1]+d[0])/2,(d[3]+d[2])/2,n];break}}const a=[0,0,0];i.worldToIndex(o,a);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case Dn.I:l=ua(a[0],s[0],s[1]);break;case Dn.J:l=ua(a[1],s[2],s[3]);break;case Dn.K:l=ua(a[2],s[4],s[5]);break;default:return 0}return l},t.setSliceFromCamera=n=>{const i=n.getFocalPoint();switch(e.slicingMode){case Dn.I:case Dn.J:case Dn.K:{const o=t.getSliceAtPosition(i);t.setSlice(o)}break;case Dn.X:t.setSlice(i[0]);break;case Dn.Y:t.setSlice(i[1]);break;case Dn.Z:t.setSlice(i[2]);break}},t.setXSlice=n=>{t.setSlicingMode(Dn.X),t.setSlice(n)},t.setYSlice=n=>{t.setSlicingMode(Dn.Y),t.setSlice(n)},t.setZSlice=n=>{t.setSlicingMode(Dn.Z),t.setSlice(n)},t.setISlice=n=>{t.setSlicingMode(Dn.I),t.setSlice(n)},t.setJSlice=n=>{t.setSlicingMode(Dn.J),t.setSlice(n)},t.setKSlice=n=>{t.setSlicingMode(Dn.K),t.setSlice(n)},t.getSlicingModeNormal=()=>{const n=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case Dn.X:n[0]=1;break;case Dn.Y:n[1]=1;break;case Dn.Z:n[2]=1;break;case Dn.I:Yg(i,[1,0,0],n);break;case Dn.J:Yg(i,[0,1,0],n);break;case Dn.K:Yg(i,[0,0,1],n);break}return n};function r(){let n;switch(e.slicingMode){case Dn.X:n=0;break;case Dn.Y:n=1;break;case Dn.Z:n=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),o=m4(i);let a=0;for(;a<3&&o[n+3*a]===0;++a);const s=o[n+3*a]<0;e.closestIJKAxis={ijkMode:a,flip:s}}t.setSlicingMode=n=>{e.slicingMode!==n&&(e.slicingMode=n,t.getCurrentImage()&&r(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Dn.NONE)&&t.getCurrentImage()&&r(),e.closestIJKAxis),t.getBounds=()=>{const n=t.getCurrentImage();if(!n)return Eu();if(!e.useCustomExtents)return n.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:o}=t.getClosestIJKAxis();let a=e.slice;switch(o!==e.slicingMode&&(a=t.getSliceAtPosition(e.slice)),o){case Dn.I:i[0]=a,i[1]=a;break;case Dn.J:i[2]=a,i[3]=a;break;case Dn.K:i[4]=a,i[5]=a;break}return n.extentToBounds(i)},t.getBoundsForSlice=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const o=t.getCurrentImage();if(!o)return Eu();const a=o.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=n;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(n)),s){case Dn.I:a[0]=c-i,a[1]=c+i;break;case Dn.J:a[2]=c-i,a[3]=c+i;break;case Dn.K:a[4]=c-i,a[5]=c+i;break}return o.extentToBounds(a)},t.intersectWithLineForPointPicking=(n,i)=>oK(n,i,t),t.intersectWithLineForCellPicking=(n,i)=>aK(n,i,t),t.getCurrentImage=()=>t.getInputData()}const uK={slicingMode:Dn.NONE,closestIJKAxis:{ijkMode:Dn.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function ID(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uK,r),iK.extend(t,e,r),Z.get(t,e,["slicingMode"]),Z.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),j1.implementCoincidentTopologyMethods(t,e),lK(t,e)}const dK=Z.newInstance(ID,"vtkImageMapper");var fK={newInstance:dK,extend:ID,...sK,...cK,...H1};const{InterpolationType:dp}=OB,{vtkErrorMacro:VS}=Z,fp=4;function hK(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let r=e.mtime,n;for(let i=0;i<fp;i++)e.componentData[i].rGBTransferFunction&&(n=e.componentData[i].rGBTransferFunction.getMTime(),r=r>n?r:n),e.componentData[i].piecewiseFunction&&(n=e.componentData[i].piecewiseFunction.getMTime(),r=r>n?r:n);return r},t.setRGBTransferFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),e.componentData[i].rGBTransferFunction!==o?(e.componentData[i].rGBTransferFunction=o,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].rGBTransferFunction},t.setPiecewiseFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),e.componentData[i].piecewiseFunction!==o?(e.componentData[i].piecewiseFunction=o,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].piecewiseFunction},t.setScalarOpacity=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),t.setPiecewiseFunction(i,o)},t.getScalarOpacity=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(r)},t.setComponentWeight=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(r<0||r>=fp)return VS("Invalid index"),!1;const i=Math.min(1,Math.max(0,n));return e.componentData[r].componentWeight!==i?(e.componentData[r].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return r<0||r>=fp?(VS("Invalid index"),0):e.componentData[r].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(dp.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(dp.LINEAR),t.getInterpolationTypeAsString=()=>Z.enumToString(dp,e.interpolationType)}const gK=t=>({independentComponents:!1,interpolationType:dp.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1,updatedExtents:[],...t});function pK(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,gK(r)),Z.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<fp;n++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}Z.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity","updatedExtents"]),Z.setGetArray(t,e,["labelOutlineThickness"]),hK(t,e)}const mK=Z.newInstance(pK,"vtkImageProperty");var vK={newInstance:mK};function yK(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let r=e.properties[0].getOpacity()>=1;return r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=vK.newInstance,t.getBoundsForSlice=(r,n)=>{const i=e.mapper.getBoundsForSlice(r,n);if(!bn.isValid(i))return i;t.computeMatrix();const o=new Float64Array(16);return Mn(o,e.matrix),bn.transformBounds(i,o)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return e.properties.forEach(n=>{r=Math.max(r,n.getMTime());const i=n.getRGBTransferFunction();i!==null&&(r=Math.max(r,i.getMTime()))}),r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const wK={mapper:null,forceOpaque:!1,forceTranslucent:!1};function MD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wK,r),aw.extend(t,e,r),e.boundsMTime={},Z.obj(e.boundsMTime),Z.setGet(t,e,["mapper","forceOpaque","forceTranslucent"]),yK(t,e)}const CK=Z.newInstance(MD,"vtkImageSlice");var xK={newInstance:CK,extend:MD};function SK(t){return Object.values(ui).includes(t)?t:ui.LINEAR}function OD(t){const r={...ut(Ui.IMAGE_PLANE,t)};return r.columnPixelSpacing||(r.columnPixelSpacing=1),r.rowPixelSpacing||(r.rowPixelSpacing=1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}function PD(t){const e=t.imageId,{pixelRepresentation:r,bitsAllocated:n,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=ut("imagePixelModule",e),{windowWidth:c,windowCenter:l,voiLUTFunction:d}=t,{modality:u}=ut("generalSeriesModule",e),f=ut("scalingModule",e),h=ut(Ui.CALIBRATION,e),g=SK(d),p=OD(e);return{calibration:h,scalingFactor:f,voiLUTFunction:g,modality:u,imagePlaneModule:p,imagePixelModule:{bitsAllocated:n,bitsStored:i,samplesPerPixel:s,highBit:o,photometricInterpretation:a,pixelRepresentation:r,windowWidth:c,windowCenter:l,modality:u,voiLUTFunction:g}}}function em(t){const{imagePlaneModule:e,imagePixelModule:r,voiLUTFunction:n,modality:i,scalingFactor:o,calibration:a}=PD(t);let{rowCosines:s,columnCosines:c}=e;(s==null||c==null)&&(s=[1,0,0],c=[0,1,0]);const l=mt(s[0],s[1],s[2]),d=mt(c[0],c[1],c[2]),u=Ie();tn(u,l,d);let f=e.imagePositionPatient;f==null&&(f=[0,0,0]);const h=e.columnPixelSpacing||t.columnPixelSpacing,g=e.rowPixelSpacing||t.rowPixelSpacing,p=t.columns,v=t.rows,w=yo,m=1;return!r.photometricInterpretation&&t.sizeInBytes===3*t.width*t.height&&(t.numberOfComponents=3),{numberOfComponents:t.numberOfComponents||TK(r.photometricInterpretation),origin:f,direction:[...l,...d,...u],dimensions:[p,v,m],spacing:[h,g,w],numVoxels:p*v*m,imagePlaneModule:e,imagePixelModule:r,bitsAllocated:r.bitsAllocated,voiLUTFunction:n,modality:i,scalingFactor:o,calibration:a,scanAxisNormal:u}}function TK(t){let e=1;return(t==="RGB"||t?.includes("YBR")||t==="PALETTE COLOR")&&(e=3),e}var hp={exports:{}},_K=hp.exports,kS;function EK(){return kS||(kS=1,(function(t){(function(e,r){t.exports?t.exports=r():e.log=r()})(_K,function(){var e=function(){},r="undefined",n=typeof window!==r&&typeof window.navigator!==r&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],o={},a=null;function s(p,v){var w=p[v];if(typeof w.bind=="function")return w.bind(p);try{return Function.prototype.bind.call(w,p)}catch{return function(){return Function.prototype.apply.apply(w,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===r?!1:p==="trace"&&n?c:console[p]!==void 0?s(console,p):console.log!==void 0?s(console,"log"):e}function d(){for(var p=this.getLevel(),v=0;v<i.length;v++){var w=i[v];this[w]=v<p?e:this.methodFactory(w,p,this.name)}if(this.log=this.debug,typeof console===r&&p<this.levels.SILENT)return"No console available for logging"}function u(p){return function(){typeof console!==r&&(d.call(this),this[p].apply(this,arguments))}}function f(p,v,w){return l(p)||u.apply(this,arguments)}function h(p,v){var w=this,m,y,C,x="loglevel";typeof p=="string"?x+=":"+p:typeof p=="symbol"&&(x=void 0);function S(b){var I=(i[b]||"silent").toUpperCase();if(!(typeof window===r||!x)){try{window.localStorage[x]=I;return}catch{}try{window.document.cookie=encodeURIComponent(x)+"="+I+";"}catch{}}}function T(){var b;if(!(typeof window===r||!x)){try{b=window.localStorage[x]}catch{}if(typeof b===r)try{var I=window.document.cookie,O=encodeURIComponent(x),M=I.indexOf(O+"=");M!==-1&&(b=/^([^;]+)/.exec(I.slice(M+O.length+1))[1])}catch{}return w.levels[b]===void 0&&(b=void 0),b}}function _(){if(!(typeof window===r||!x)){try{window.localStorage.removeItem(x)}catch{}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function E(b){var I=b;if(typeof I=="string"&&w.levels[I.toUpperCase()]!==void 0&&(I=w.levels[I.toUpperCase()]),typeof I=="number"&&I>=0&&I<=w.levels.SILENT)return I;throw new TypeError("log.setLevel() called with invalid level: "+b)}w.name=p,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=v||f,w.getLevel=function(){return C??y??m},w.setLevel=function(b,I){return C=E(b),I!==!1&&S(C),d.call(w)},w.setDefaultLevel=function(b){y=E(b),T()||w.setLevel(b,!1)},w.resetLevel=function(){C=null,_(),d.call(w)},w.enableAll=function(b){w.setLevel(w.levels.TRACE,b)},w.disableAll=function(b){w.setLevel(w.levels.SILENT,b)},w.rebuild=function(){if(a!==w&&(m=E(a.getLevel())),d.call(w),a===w)for(var b in o)o[b].rebuild()},m=E(a?a.getLevel():"WARN");var D=T();D!=null&&(C=E(D)),d.call(w)}a=new h,a.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var w=o[v];return w||(w=o[v]=new h(v,a.methodFactory)),w};var g=typeof window!==r?window.log:void 0;return a.noConflict=function(){return typeof window!==r&&window.log===a&&(window.log=g),a},a.getLoggers=function(){return o},a.default=a,a})})(hp)),hp.exports}var bK=EK();const DK=wa(bK),RD=DK.noConflict();typeof window<"u"&&(window.log=RD);function tm(t){const e=RD.getLogger(t[0]);return e.getLogger=(...r)=>tm(`${t}.${r.join(".")}`),e}function Iw(...t){return tm(t.join("."))}const sd=tm("cs3d"),Mw=sd.getLogger("core"),IK=sd.getLogger("tools"),MK=sd.getLogger("dicomImageLoader"),OK=sd.getLogger("ai"),PK=sd.getLogger("examples"),RK=Iw("consistency","dicom"),AK=Iw("consistency","image"),LK=Object.freeze(Object.defineProperty({__proto__:null,aiLog:OK,coreLog:Mw,cs3dLog:sd,dicomConsistencyLog:RK,examplesLog:PK,getLogger:Iw,getRootLogger:tm,imageConsistencyLog:AK,loaderLog:MK,toolsLog:IK},Symbol.toStringTag,{value:"Module"}));function AD(t){const e=Qs.newInstance();let r=0,n=1024;return t.lower!==void 0&&t.upper!==void 0&&(r=t.lower,n=t.upper),e.addRGBPoint(r,0,0,0),e.addRGBPoint(n,1,1,1),e}function nm(t,e){const r=e.voxelManager.getScalarData();if(!t.getPointData)return;const n=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let o=0;o<e.columns*e.rows;o++)i[o*3]=r[o*4],i[o*3+1]=r[o*4+1],i[o*3+2]=r[o*4+2];e.rgba=!1,e.getPixelData=()=>i,n.set(i)}else n.set(r);t.modified()}function sn(){return window.performance?performance.now():Date.now()}function NK(t,e){return function(r){const n=((r-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(n,0),255)}}function VK(t){const r=Math.max(...t.lut).toString(2).length-8,n=t.lut[0]>>r,i=t.lut[t.lut.length-1]>>r,o=t.firstValueMapped+t.lut.length-1;return function(a){return a<t.firstValueMapped?n:a>=o?i:t.lut[a-t.firstValueMapped]>>r}}function LD(t,e,r){return r?VK(r):NK(t,e)}function kK(t,e,r,n,i){const o=t.maxPixelValue,a=t.minPixelValue,s=Math.min(a,0);if(t.cachedLut===void 0){const d=o-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(d)}const c=t.cachedLut.lutArray,l=LD(Array.isArray(e)?e[0]:e,Array.isArray(r)?r[0]:r,i);if(n)for(let d=a;d<=o;d++)c[d+-s]=255-l(d);else for(let d=a;d<=o;d++)c[d+-s]=l(d);return c}function FK(t,e,r){let n=sn();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=sn()-n;const o=t.minPixelValue;let a=0,s=0;const c=i.length;if(n=sn(),o<0)for(;s<c;)r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=255;else for(;s<c;)r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-n}function UK(t,e,r){let n=sn();const i=t.getPixelData();t.stats.lastGetPixelDataTime=sn()-n;const o=t.minPixelValue;let a=0,s=0;const c=i.length;if(n=sn(),o<0)for(;s<c;)r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=i[s++];else for(;s<c;)r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-n}class cd{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new cd;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const r=this.m[0]*e[0]+this.m[2]*e[1],n=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],o=this.m[1]*e[2]+this.m[3]*e[3],a=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this.m[4]=a,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),r=this.m[3]*e,n=-this.m[1]*e,i=-this.m[2]*e,o=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this.m[4]=a,this.m[5]=s}rotate(e){const r=Math.cos(e),n=Math.sin(e),i=this.m[0]*r+this.m[2]*n,o=this.m[1]*r+this.m[3]*n,a=this.m[0]*-n+this.m[2]*r,s=this.m[1]*-n+this.m[3]*r;this.m[0]=i,this.m[1]=o,this.m[2]=a,this.m[3]=s}translate(e,r){this.m[4]+=this.m[0]*e+this.m[2]*r,this.m[5]+=this.m[1]*e+this.m[3]*r}scale(e,r){this.m[0]*=e,this.m[1]*=e,this.m[2]*=r,this.m[3]*=r}transformPoint(e){const r=e[0],n=e[1];return[r*this.m[0]+n*this.m[2]+this.m[4],r*this.m[1]+n*this.m[3]+this.m[5]]}}function qf(t,e){const r=new cd;if(!t.viewport.displayedArea)return r;r.translate(t.canvas.width/2,t.canvas.height/2);const n=t.viewport.rotation;n!==0&&r.rotate(n*Math.PI/180);let i=t.viewport.scale,o=t.viewport.scale;const a=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(o*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,o=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*o),l=t.canvas.width/(a*i);i=o=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(o*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return r.scale(i,o),n!==0&&r.rotate(-n*Math.PI/180),r.translate(t.viewport.translation.x,t.viewport.translation.y),n!==0&&r.rotate(n*Math.PI/180),t.viewport.hflip&&r.scale(-1,1),t.viewport.vflip&&r.scale(1,-1),r.translate(-a/2,-s/2),r}function Ow(t,e,r){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=qf(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function Pw(t,e){const r=t.renderingTools.lastRenderedImageId,n=t.renderingTools.lastRenderedViewport;return e.imageId!==r||!n||n.windowCenter!==t.viewport.voi.windowCenter||n.windowWidth!==t.viewport.voi.windowWidth||n.invert!==t.viewport.invert||n.rotation!==t.viewport.rotation||n.hflip!==t.viewport.hflip||n.vflip!==t.viewport.vflip||n.modalityLUT!==t.viewport.modalityLUT||n.voiLUT!==t.viewport.voiLUT||n.colormap!==t.viewport.colormap}function Xp(t,e){const r=t.renderingTools.renderCanvas;r.width=e.width,r.height=e.height;const n=r.getContext("2d");n.fillStyle="white",n.fillRect(0,0,r.width,r.height);const i=n.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=n,t.renderingTools.renderCanvasData=i}function Rw(t){const e=t.image.imageId,r=t.viewport,n=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=n,t.renderingTools.lastRenderedViewport={windowCenter:r.voi.windowCenter,windowWidth:r.voi.windowWidth,invert:r.invert,rotation:r.rotation,hflip:r.hflip,vflip:r.vflip,modalityLUT:r.modalityLUT,voiLUT:r.voiLUT,colormap:r.colormap},t.renderingTools}const ND="viewport-element",VD="cornerstone-canvas",rl=1e-4;function rm(t,e=512,r=512){const n=document.createElement("canvas");return t&&(n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.style.imageRendering="pixelated",n.classList.add(VD),t.appendChild(n)),n}function BK(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(ND),t.appendChild(e),e}function Go(t){const e=`canvas.${VD}`,r=`div.${ND}`,n=t.querySelector(r)||BK(t),i=n.querySelector(e);if(i)return i;const o=rm(n),a=n.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(a.width*s),l=Math.ceil(a.height*s);return o.width=c,o.height=l,o}function GK(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(kK(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function WK(t,e,r){const n=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!n)&&(t.renderingTools.renderCanvas=rm(null,e.width,e.height));const i=t.renderingTools.renderCanvas,{windowWidth:o,windowCenter:a}=t.viewport.voi;if((o===256||o===255)&&(a===128||a===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!Pw(t,e)&&!r)return i;(!t.renderingTools.renderCanvasContext||i.width!==e.width||i.height!==e.height)&&Xp(t,e);let s=sn();const c=GK(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=sn()-s;const l=t.renderingTools.renderCanvasData,d=t.renderingTools.renderCanvasContext;return e.rgba?UK(e,c,l.data):FK(e,c,l.data),s=sn(),d.putImageData(l,0,0),e.stats.lastPutImageDataTime=sn()-s,i}function $K(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,Ow(t,n);const i=WK(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=Rw(t)}function zK(t,e,r){let n=sn();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=sn()-n;const o=i.length,a=t.minPixelValue;let s=3,c=0;if(n=sn(),i instanceof Int16Array)if(a<0)for(;c<o;)r[s]=e[i[c++]+-a],s+=4;else for(;c<o;)r[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<o;)r[s]=e[i[c++]],s+=4;else if(a<0)for(;c<o;)r[s]=e[i[c++]+-a],s+=4;else for(;c<o;)r[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-n}function jK(t,e,r){let n=sn();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=sn()-n;const o=i.length;let a=3,s=0;for(n=sn();s<o;)r[a]=e(i[s++]),a+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-n}function HK(t,e,r){let n=sn();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=sn()-n;const o=i.length,a=t.minPixelValue;let s=0,c=0,l;if(n=sn(),i instanceof Int16Array)if(a<0)for(;c<o;)l=e[i[c++]+-a],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else if(i instanceof Uint16Array)for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else if(a<0)for(;c<o;)l=e[i[c++]+-a],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-n}function XK(t,e){if(KK(t))return;const r=e.maxPixelValue*e.slope+e.intercept,n=e.minPixelValue*e.slope+e.intercept,i=r-n,o=(r+n)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:o,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=o)}function KK(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function FS(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function qK(t,e){return r=>r*t+e}function YK(t){const e=t.lut[0],r=t.lut[t.lut.length-1],n=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=n?r:t.lut[i]}function JK(t,e,r){return r?YK(r):qK(t,e)}function ZK(t,e,r,n,i,o){const a=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const f=a-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const l=t.cachedLut.lutArray,d=JK(t.slope,t.intercept,i),u=LD(e,r,o);if(t.isPreScaled)if(n)for(let f=s;f<=a;f++)l[f+-c]=255-u(f);else for(let f=s;f<=a;f++)l[f+-c]=u(f);else if(n)for(let f=s;f<=a;f++)l[f+-c]=255-u(d(f));else for(let f=s;f<=a;f++)l[f+-c]=u(d(f));return l}function kD(t,e,r){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&FS(t.cachedLut.modalityLUT,e.modalityLUT)&&FS(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!r||(XK(e,t),ZK(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function QK(t,e,r,n=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=rm(null,e.width,e.height),Xp(t,e));const o=t.renderingTools.renderCanvas;if(!Pw(t,e)&&!r)return o;(o.width!==e.width||o.height!==e.height)&&Xp(t,e),e.stats=e.stats||{};const a=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=sn();e.stats.lastLutGenerateTime=sn()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:d,windowCenter:u}=l.voi,f=u-d/2,p=255/(u+d/2-f);let v;l.invert?v=w=>255-(w-f)*p:v=w=>(w-f)*p,jK(e,v,a.data)}else{const d=kD(e,l,r);n?zK(e,d,a.data):HK(e,d,a.data)}return c=sn(),s.putImageData(a,0,0),e.stats.lastPutImageDataTime=sn()-c,o}function eq(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,Ow(t,n);const i=QK(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=Rw(t)}const fy=0,hy=1,tq=2;function nq(t,e,r){if(t>1)throw new Error("HSVToRGB expects hue < 1");const n=[];if(e===0)return n[0]=r,n[1]=r,n[2]=r,n;const i=Math.floor(t*6),o=6*t-i,a=r*(1-e),s=r*(1-e*o),c=r*(1-e*(1-o));switch(i){case 0:case 6:n[0]=r,n[1]=c,n[2]=a;break;case 1:n[0]=s,n[1]=r,n[2]=a;break;case 2:n[0]=a,n[1]=r,n[2]=c;break;case 3:n[0]=a,n[1]=s,n[2]=r;break;case 4:n[0]=c,n[1]=a,n[2]=r;break;case 5:n[0]=r,n[1]=a,n[2]=s;break}return n}function rq(t,e){let r;return t<e.Range[0]?r=e.MaxIndex+fy+1.5:t>e.Range[1]?r=e.MaxIndex+hy+1.5:r=(t+e.Shift)*e.Scale,Math.floor(r)}class Aw{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,r){this.TableRange[0]=e,this.TableRange[1]=r}setHueRange(e,r){this.HueRange[0]=e,this.HueRange[1]=r}setSaturationRange(e,r){this.SaturationRange[0]=e,this.SaturationRange[1]=r}setValueRange(e,r){this.ValueRange[0]=e,this.ValueRange[1]=r}setRange(e,r){this.InputRange[0]=e,this.InputRange[1]=r}setAlphaRange(e,r){this.AlphaRange[0]=e,this.AlphaRange[1]=r}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const r=this.NumberOfColors-1;let n,i,o,a;r?(n=(this.HueRange[1]-this.HueRange[0])/r,i=(this.SaturationRange[1]-this.SaturationRange[0])/r,o=(this.ValueRange[1]-this.ValueRange[0])/r,a=(this.AlphaRange[1]-this.AlphaRange[0])/r):n=i=o=a=0;for(let s=0;s<=r;s++){const c=this.HueRange[0]+s*n,l=this.SaturationRange[0]+s*i,d=this.ValueRange[0]+s*o,u=this.AlphaRange[0]+s*a,f=nq(c,l,d),h=[0,0,0,0];switch(this.Ramp){case"scurve":h[0]=Math.floor(127.5*(1+Math.cos((1-f[0])*Math.PI))),h[1]=Math.floor(127.5*(1+Math.cos((1-f[1])*Math.PI))),h[2]=Math.floor(127.5*(1+Math.cos((1-f[2])*Math.PI))),h[3]=Math.floor(u*255);break;case"linear":h[0]=Math.floor(f[0]*255+.5),h[1]=Math.floor(f[1]*255+.5),h[2]=Math.floor(f[2]*255+.5),h[3]=Math.floor(u*255+.5);break;case"sqrt":h[0]=Math.floor(Math.sqrt(f[0])*255+.5),h[1]=Math.floor(Math.sqrt(f[1])*255+.5),h[2]=Math.floor(Math.sqrt(f[2])*255+.5),h[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(h)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,r=e+fy,n=e+hy,i=e+tq;this.UseBelowRangeColor||e===0?this.Table[r]=this.BelowRangeColor:this.Table[r]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const r=this.getIndex(e);if(r<0)return this.NaNColor;if(r===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(r===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[r]}getIndex(e){const r={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?r.Scale=Number.MAX_VALUE:r.Scale=r.MaxIndex/(this.TableRange[1]-this.TableRange[0]),r.Range[0]=this.TableRange[0],r.Range[1]=this.TableRange[1],isNaN(e))return-1;let n=rq(e,r);return n===this.NumberOfColors+fy?n=0:n===this.NumberOfColors+hy&&(n=this.NumberOfColors-1),n}setTableValue(e,r,n,i,o){let a;if(typeof r=="number"&&n!==void 0&&i!==void 0&&o!==void 0)a=[r,n,i,o];else if(Array.isArray(r))a=r;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=a,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const US=[0,0,0,0];function iq(t,e,r){r=r===null?100:r;const n=(e-t)/(r-1),i=[];for(;r-- >0;)i.push(t),t+=n;return i[i.length-1]=e,i}function oq(t,e){let r=0,n=t.length-1;for(;r<=n;){const i=r+Math.floor((n-r)/2),o=t[i];if(o===e)return i;e<o?n=i-1:r=i+1}return r}function aq(t,e){let r;const n=[],i=e.length;for(t.sort(function(o,a){return o-a}),r=0;r<i;r++)n[r]=oq(t,e[r]);return n}function D2(t,e,r){let n;const i=[],o=[],a=[],s=[];for(r=r===null?1:r,n=0;n<e.length;n++){const d=e[n];i.push((t-1)*d[0]),o.push(d[1]),a.push(d[1])}const c=iq(0,1,t);for(n=0;n<t;n++)c[n]=(t-1)*Math.pow(c[n],r);const l=aq(i,c);for(n=1;n<t-1;n++){const d=l[n],u=(c[n]-i[d-1])/(i[d]-i[d-1]),f=o[d]-a[d-1];s[n]=u*f+a[d-1]}return s[0]=a[0],s[t-1]=o[e.length-1],s}function sq(t,e,r){let n;const i=[];e=e===null?256:e,r=r===null?1:r;const o=D2(e,t.red,r),a=D2(e,t.green,r),s=D2(e,t.blue,r);for(n=0;n<e;n++){const c=Math.round(o[n]*255),l=Math.round(a[n]*255),d=Math.round(s[n]*255),u=[c,l,d,255];i.push(u)}return i}function cq(t,e){let r=kv[t];return r||(r=kv[t]={name:"",colors:[]}),!r.colors&&r.segmentedData&&(r.colors=sq(r.segmentedData,r.numColors,r.gamma)),{getId(){return t},getColorSchemeName(){return r.name},setColorSchemeName(i){r.name=i},getNumberOfColors(){return r.colors.length},setNumberOfColors(i){for(;r.colors.length<i;)r.colors.push(US);r.colors.length=i},getColor(i){return this.isValidIndex(i)?r.colors[i]:US},getColorRepeating(i){const o=r.colors.length;return i=o?i%o:0,this.getColor(i)},setColor(i,o){this.isValidIndex(i)&&(r.colors[i]=o)},addColor(i){r.colors.push(i)},insertColor(i,o){this.isValidIndex(i)&&r.colors.splice(i,1,o)},removeColor(i){this.isValidIndex(i)&&r.colors.splice(i,1)},clearColors(){r.colors=[]},buildLookupTable(i){if(!i)return;const o=r.colors.length;i.setNumberOfTableValues(o);for(let a=0;a<o;a++)i.setTableValue(a,r.colors[a])},createLookupTable(){const i=new Aw;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<r.colors.length}}}function lq(t,e,r,n){let i=sn();const o=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=sn()-i;const a=o.length,s=t.minPixelValue;let c=0,l=0,d,u,f;if(i=sn(),r instanceof Aw?f=r.Table:f=r,s<0)for(;l<a;)d=e[o[l++]+-s],u=f[d],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];else for(;l<a;)d=e[o[l++]],u=f[d],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-i}function uq(t,e,r,n){let i=sn();const o=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=sn()-i;const a=o.length,s=t.minPixelValue;let c=0,l=0,d,u,f;if(i=sn(),r instanceof Aw?f=r.Table:f=r,s<0)for(;l<a;)d=e(o[l++]+-s),u=f[d],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];else for(;l<a;)d=e(o[l++]),u=f[d],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=sn()-i}function gy(t,e,r){return Math.max(e,Math.min(r,t))}function dq(t,e,r){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=rm(null,e.width,e.height));const n=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=cq(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const o=i.getId();if(!Pw(t,e)&&!r&&t.renderingTools.colormapId===o)return n;(!t.renderingTools.renderCanvasContext||n.width!==e.width||n.height!==e.height)&&Xp(t,e);let a=sn();(!t.renderingTools.colorLUT||r||t.renderingTools.colormapId!==o)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=o);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,d=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:f}=l.voi,h=f-u/2,v=255/(f+u/2-h);let w;l.invert?w=m=>gy(Math.floor(255-(m-h)*v),0,255):w=m=>gy(Math.floor((m-h)*v),0,255),uq(e,w,d,s.data)}else{const u=kD(e,t.viewport,r);e.stats=e.stats||{},e.stats.lastLutGenerateTime=sn()-a,lq(e,u,d,s.data)}return a=sn(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=sn()-a,n}function fq(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,Ow(t,n);const i=dq(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=Rw(t)}function FD(t,e){const r=t.image;if(!t.canvas||!t.image)return;const n=sn();if(r.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},r){let o=r.render;o||(t.viewport.colormap?o=fq:r.color?o=$K:o=eq),o(t,e)}const i=sn()-n;r.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function UD(t){return qf(t)}function Sg(t,e){const r=UD(t);return r.invert(),r.transformPoint(e)}const hq={viewport:{}};function gq(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function pq(){const t=gq(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:ui.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,hq.viewport)}function yf(t,e){if(t==null)throw new Error(e)}function mq(t){return!(t==null||t===0||t===180)}function BD(t,e=null){return yf(t,"getImageSize: parameter image must not be undefined"),yf(t.width,"getImageSize: parameter image must have width"),yf(t.height,"getImageSize: parameter image must have height"),mq(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function Lw(t,e,r=null){yf(t,"getImageScale: parameter canvas must not be undefined"),yf(e,"getImageScale: parameter image must not be undefined");const n=BD(e,r),i=e.rowPixelSpacing||1,o=e.columnPixelSpacing||1;let a=1,s=1;i<o?s=o/i:a=i/o;const c=t.height/n.height/a,l=t.width/n.width/s;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function GD(t,e,r,n){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return pq();const i=Lw(t,e,0).scaleFactor;let o;return r==="PT"&&e.isPreScaled?o={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(o={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:o,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:r,voiLUT:e.voiLUT,colormap:n!==void 0?n:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function BS(t,e){return UD(t).transformPoint(e)}function vq(t){const{image:e}=t;t.viewport.scale=Lw(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function yq(t){const{canvas:e}=t,{clientWidth:r,clientHeight:n}=e;(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}function wq(t,e,r){const n=t.viewport.scale,i=BD(t.image,t.viewport.rotation),o=Math.round(i.width*n),a=Math.round(i.height*n),s=t.viewport.translation.x,c=t.viewport.translation.y;return o===e&&a<=r||o<=e&&a===r&&s===0&&c===0}function Cq(t,e,r){const n=t.viewport.scale,i=t.canvas.width,o=t.canvas.height,a=i/e,s=o/r,c=Math.sqrt(a*s);t.viewport.scale=c*n}function xq(t,e=!1){const r=t.canvas.width,n=t.canvas.height;yq(t),t.image!==void 0&&(e||wq(t,r,n)?vq(t):Cq(t,r,n))}function Sq(t,e){const{hflip:r,vflip:n,rotation:i}=e;if(t.x*=r?-1:1,t.y*=n?-1:1,i!==0){const o=i*Math.PI/180,a=Math.cos(o),s=Math.sin(o),c=t.x*a-t.y*s,l=t.x*s+t.y*a;t.x=c,t.y=l}return t}function Tq(t,e=!0,r=!0){const{canvas:n,image:i,viewport:o}=t,a=Lw(n,i,0).scaleFactor;o.vflip=!1,o.hflip=!1,e&&(o.translation.x=0,o.translation.y=0),r&&(o.displayedArea.tlhc.x=1,o.displayedArea.tlhc.y=1,o.displayedArea.brhc.x=i.columns,o.displayedArea.brhc.y=i.rows,o.scale=a)}const GS=Mw.getLogger("utilities","getClosestImageId");function rc(t,e,r,n){const{direction:i,spacing:o,imageIds:a}=t,{ignoreSpacing:s=!1}=n||{};if(!a?.length)return;const c=i.slice(6,9),l=ft(c,r);if(Math.abs(l)<1-yo)return;let d;s||(d=ml({direction:i,spacing:o},r)/2);let u,f=1/0;for(let h=0;h<a.length;h++){const g=a[h],p=ut("imagePlaneModule",g);if(!p?.imagePositionPatient){GS.warn(`Missing imagePositionPatient for imageId: ${g}`);continue}const{imagePositionPatient:v}=p,w=Ie();rn(w,e,v);const m=Math.abs(ft(w,r));s?m<f&&(f=m,u=g):m<d&&m<f&&(f=m,u=g)}return u===void 0&&GS.warn("No imageId found within the specified criteria (half spacing or absolute closest)."),u}function _q(t,e){const r=ft(t,e),n=xr(Ie(),e,2*r);return rn(Ie(),t,n)}function WS(t,e,r,n){let i=Fo(t);if(r&&ga(i,i),e){const o=tn(Ie(),n,i);Lt(o,o),i=_q(i,o)}return i}const $S=Mw.getLogger("RenderingEngine","StackViewport");class Wn extends W0{constructor(e){super(e),this.imageIds=[],this.imageKeyToIndexMap=new Map,this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.sharpening=0,this.smoothing=0,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.setSharpening=r=>{this.sharpening=r,this.render()},this.setSmoothing=r=>{this.smoothing=r,this.render()},this.getRenderPasses=()=>{if(!this.shouldUseCustomRenderPass())return null;const r=[];try{return this.smoothing>0&&r.push(bD(this.smoothing)),this.sharpening>0&&r.push(ED(this.sharpening)),r.length?r:null}catch(n){return console.warn("Failed to create custom render passes:",n),null}},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&xq(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=r=>this.getImagePlaneReferenceData(r)?.FrameOfReferenceUID,this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=r=>{const n=fK.newInstance();n.setInputData(r);const i=xK.newInstance();return i.setMapper(n),r.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=r=>{let n;return r!==void 0&&(n=this.perImageIdDefaultProperties.get(r)),n!==void 0?n:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:r,voiRange:n,VOILUTFunction:i,interpolationType:o,invert:a,voiUpdatedWithSetProperties:s}=this;return{colormap:r,voiRange:n,VOILUTFunction:i,interpolationType:o,invert:a,isComputedVOI:!s,sharpening:this.sharpening,smoothing:this.smoothing}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:r}=this._cpuFallbackEnabledElement;return r.rotation},this.getRotationGPU=()=>{const{viewUp:r,viewPlaneNormal:n,flipVertical:i,flipHorizontal:o}=this.getCameraNoRotation(),a=WS(this.initialViewUp,o,i,n),c=z5(a,r)*180/Math.PI,l=tn(Ie(),a,r);return ft(l,n)>=0?c:(360-c)%360},this.setRotation=r=>{const n=this.getCamera();if(this.useCPURendering?this.setRotationCPU(r):this.setRotationGPU(r),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),o={previousCamera:n,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Ye(this.element,$e.CAMERA_MODIFIED,o)},this.renderImageObject=r=>{this._setCSImage(r),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,r)},this._setCSImage=r=>{r.isPreScaled=r.preScale?.scaled,this.csImage=r},this.canvasToWorldCPU=(r,n=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,o]=Sg(this._cpuFallbackEnabledElement,r),{origin:a,spacing:s,direction:c}=this.getImageData(),l=c.slice(0,3),d=c.slice(3,6);return en(n,a,l,i*s[0]),en(n,n,d,o*s[1]),n},this.worldToCanvasCPU=r=>{const{spacing:n,direction:i,origin:o}=this.getImageData(),a=i.slice(0,3),s=i.slice(3,6),c=an(Ie(),r,o),l=[ft(c,a)/n[0],ft(c,s)/n[1]];return BS(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPUContextPool=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,d=c/l,u=[r[0]*s,r[1]*s],f=n.getViewport(),[h,g,p,v]=f,w=p-h,m=v-g,y=[h+u[0]/c*w,g+(1-u[1]/l)*m,0],C=n.normalizedDisplayToProjection(y[0],y[1],y[2]),x=n.projectionToView(C[0],C[1],C[2],d),S=n.viewToWorld(x[0],x[1],x[2]);return i.setClippingRange(o[0],o[1]),[S[0],S[1],S[2]]},this.canvasToWorldGPUTiled=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),d=window.devicePixelRatio||1,u=[r[0]*d,r[1]*d],f=[u[0]+this.sx,u[1]+this.sy];f[1]=l[1]-f[1];const h=c.displayToWorld(f[0],f[1],0,n);return i.setClippingRange(o[0],o[1]),[h[0],h[1],h[2]]},this.worldToCanvasGPUContextPool=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const s=window.devicePixelRatio||1,{width:c,height:l}=this.canvas,d=c/l,u=n.worldToView(r[0],r[1],r[2]),f=n.viewToProjection(u[0],u[1],u[2],d),h=n.projectionToNormalizedDisplay(f[0],f[1],f[2]),g=n.getViewport(),[p,v,w,m]=g,y=w-p,C=m-v,x=(h[0]-p)/y*c,S=(1-(h[1]-v)/C)*l;return i.setClippingRange(o[0],o[1]),[x/s,S/s]},this.worldToCanvasGPUTiled=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),d=c.worldToDisplay(...r,n);d[1]=l[1]-d[1];const u=[d[0]-this.sx,d[1]-this.sy];i.setClippingRange(o[0],o[1]);const f=window.devicePixelRatio||1;return[u[0]/f,u[1]/f]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=(r=this.getCurrentImageIdIndex())=>this.imageIds[r],this.hasImageId=r=>this.imageKeyToIndexMap.has(r),this.hasImageURI=r=>this.imageKeyToIndexMap.has(r),this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(FD(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(r={})=>{const{resetPan:n=!0,resetZoom:i=!0}=r;return this.resetCameraCPU({resetPan:n,resetZoom:i}),!0},gpu:(r={})=>{const{resetPan:n=!0,resetZoom:i=!0}=r;return this.resetCameraGPU({resetPan:n,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:{tiled:this.canvasToWorldGPUTiled,contextPool:this.canvasToWorldGPUContextPool}},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:{tiled:this.worldToCanvasGPUTiled,contextPool:this.worldToCanvasGPUContextPool}},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:{tiled:this.getRendererTiled,contextPool:this.getRendererContextPool}},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=ff(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return ff()}_configureRenderingPipeline(e){const r=SD();this.useCPURendering=e??ff();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const i=this.renderingPipelineFunctions[n];this.useCPURendering?this[n]=i.cpu:typeof i.gpu=="object"&&i.gpu.tiled&&i.gpu.contextPool?this[n]=r?i.gpu.contextPool:i.gpu.tiled:this[n]=i.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new cd,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),r=Cw.newInstance();e.setActiveCamera(r),this.initialViewUp=[0,-1,0],r.setDirectionOfProjection(-0,-0,1),r.setViewUp(...this.initialViewUp),r.setParallelProjection(!0),r.setThicknessFromFocalPoint(.1),r.setFreezeFocalPoint(!0)}shouldUseCustomRenderPass(){return!this.useCPURendering}initializeElementDisabledHandler(){Fe.addEventListener($e.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),Fe.removeEventListener($e.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!Uo(e))return;const{actor:r}=e,n=r.getMapper().getInputData(),i=this.csImage;return{dimensions:n.getDimensions(),spacing:n.getSpacing(),origin:n.getOrigin(),direction:n.getDirection(),get scalarData(){return i?.voxelManager.getScalarData()},imageData:r.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i?.calibration,...this.calibration},preScale:{...i?.preScale},voxelManager:i?.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const r=e.spacing,n=this.csImage;return{dimensions:e.dimensions,spacing:r,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>r,worldToIndex:i=>{const o=this.worldToCanvasCPU(i),a=Sg(this._cpuFallbackEnabledElement,o);return[a[0],a[1],0]},indexToWorld:(i,o)=>{const a=BS(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(a,o)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...n?.calibration,...this.calibration},preScale:{...n?.preScale},voxelManager:n?.voxelManager}}calibrateIfNecessary(e,r){const n=ut("calibratedPixelSpacing",e),i=this.calibration!==n,o=n?.scale;return this.hasPixelSpacing=o>0||!r.usingDefaultValues&&r.rowPixelSpacing>0,r.calibration=n,i&&(this.calibration=n,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:o,calibration:n}),r}setDefaultProperties(e,r){r==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(r,e),this.getCurrentImageId()===r&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:r,VOILUTFunction:n,invert:i,interpolationType:o,sharpening:a,smoothing:s}={},c=!1){this.viewportStatus=this.csImage?_i.PRE_RENDER:_i.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??r,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??n,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??o,sharpening:this.globalDefaultProperties.sharpening??a,smoothing:this.globalDefaultProperties.smoothing??s},typeof e<"u"&&this.setColormap(e),typeof r<"u"&&this.setVOI(r,{suppressEvents:c,voiUpdatedWithSetProperties:!0}),typeof n<"u"&&this.setVOILUTFunction(n,c),typeof i<"u"&&this.setInvertColor(i),typeof o<"u"&&this.setInterpolationType(o),typeof a<"u"&&this.setSharpening(a),typeof s<"u"&&this.setSmoothing(s)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=_i.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;if(this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(Hs.LINEAR),!this.useCPURendering){const r=this.getTransferFunction();U1(r,this.initialTransferFunctionNodes);const i=Vp(r).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),o=this.getDefaultActor(),a=X5(i,o.actor);this.setColormap(a)}}resetToDefaultProperties(){this.cpuRenderingInvalidated=!0,this.viewportStatus=_i.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),r=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;r.colormap?.name&&this.setColormap(r.colormap);let n;r.voiRange==null?n=this._getVOIRangeForCurrentImage():n=r.voiRange,this.setVOI(n),this.setInterpolationType(Hs.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:r,invert:n}=this;this.setVOI(e),this.setInterpolationType(r),this.setInvertColor(n)}getCameraCPU(){const{metadata:e,viewport:r}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:n}=e,i=n.slice(6,9).map(u=>-u);let o=n.slice(3,6).map(u=>-u);if(r.rotation){const u=G5(fi(),r.rotation*Math.PI/180,i);o=Vt(Ie(),o,u)}const a=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(a),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),d=Dr(c,l)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:d,scale:r.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[o[0],o[1],o[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:r,image:n}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:o,parallelScale:a,scale:s,flipHorizontal:c,flipVertical:l}=e,{clientHeight:d}=this.element;if(o){const f=this.worldToCanvasCPU(o),h=Sg(this._cpuFallbackEnabledElement,f),g=this.worldToCanvasCPU(i.focalPoint),p=Sg(this._cpuFallbackEnabledElement,g),v=xt();En(v,N3(h[0],h[1]),N3(p[0],p[1]));const w=Sq({x:v[0],y:v[1]},r);r.translation.x-=w.x,r.translation.y-=w.y}if(a){const{rowPixelSpacing:f}=n,h=d*f*.5/a;r.scale=h,r.parallelScale=a}if(s){const{rowPixelSpacing:f}=n;r.scale=s,r.parallelScale=d*f*.5/s}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=qf(this._cpuFallbackEnabledElement);const u={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Ye(this.element,$e.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation?.x??0,e.translation?.y??0]}setPanCPU(e){const r=this.getCameraCPU();this.setCameraCPU({...r,focalPoint:[...e.map(n=>-n),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const r=this.getCameraCPU();this.setCameraCPU({...r,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:r}){const{viewport:n}=this._cpuFallbackEnabledElement;e!==void 0&&(n.hflip=e,this.flipHorizontal=n.hflip),r!==void 0&&(n.vflip=r,this.flipVertical=n.vflip)}setVOILUTFunction(e,r){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const n=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==n&&(i=!0),this.VOILUTFunction=n;const{voiRange:o}=this.getProperties();this.setVOI(o,{suppressEvents:r,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r.rotation=e}setRotationGPU(e){const r=this.getPan(this.fitToCanvasCamera),n=this.getPan(),i=mo([0,0],r,n);this.setPan(i,!1);const{flipVertical:o,flipHorizontal:a,viewPlaneNormal:s}=this.getCamera(),c=WS(this.initialViewUp,a,o,s);this.setCameraNoEvent({viewUp:c}),this.getVtkActiveCamera().roll(-e);const l=this.getPan(),d=this.getPan(this.fitToCanvasCamera),u=mo([0,0],l,d),f=zr([0,0],r,u);this.setPan(f,!1)}setInterpolationTypeGPU(e){const r=this.getDefaultActor();if(!r||!Uo(r))return;const{actor:n}=r;n.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r.pixelReplication=e!==Hs.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r&&(r.invert=e,this.invert=e)}setInvertColorGPU(e){const r=this.getDefaultActor();if(r&&Uo(r)){if(Gi(r,"vtkVolume")){const i=r.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&gf(i),this.invert=e}else if(Gi(r,"vtkImageSlice")){const i=r.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&gf(i),this.invert=e}}}setVOICPU(e,r={}){const{suppressEvents:n=!1}=r,{viewport:i,image:o}=this._cpuFallbackEnabledElement;if(!i||!o)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=o,l=Array.isArray(s)?s[0]:s,d=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:d,voiLUTFunction:o.voiLUTFunction};const{lower:u,upper:f}=tl(l,d,o.voiLUTFunction);e={lower:u,upper:f}}else{const{lower:s,upper:c}=e,{windowCenter:l,windowWidth:d}=td(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:o.voiLUTFunction}),i.voi.windowWidth=d,i.voi.windowCenter=l}this.voiRange=e;const a={viewportId:this.id,range:e};n||Ye(this.element,$e.VOI_MODIFIED,a)}getTransferFunction(){const e=this.getDefaultActor();return!e||!Uo(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,r={}){const{suppressEvents:n=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:o=!1}=r;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const a=this.getDefaultActor();if(!a||!Uo(a))return;const s=a.actor;let c=e;if(typeof c>"u"){const h=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:h[0],upper:h[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let l=s.getProperty().getRGBTransferFunction(0);const d=this.VOILUTFunction===ui.SAMPLED_SIGMOID;if((d||!l||i)&&(l=(d?J5:AD)(c),this.invert&&gf(l),s.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=Vp(l)),d||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=o),n)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};Ye(this.element,$e.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:r,suvlbm:n,suvbsa:i}=e,o={};n&&(o.suvbwToSuvlbm=n/r),i&&(o.suvbwToSuvbsa=i/r),this.scaling.PT=o}getImageDataMetadata(e){const r=e.imageId,n=em(e),{numberOfComponents:i,origin:o,direction:a,dimensions:s,spacing:c,numVoxels:l,imagePixelModule:d,voiLUTFunction:u,modality:f,scalingFactor:h,calibration:g}=n;f==="PT"&&h&&this._addScalingToViewport(h),this.modality=f;const p=this._getValidVOILUTFunction(u);this.VOILUTFunction=p,this.calibration=g;let v=this._getImagePlaneModule(r);return this.useCPURendering||(v=this.calibrateIfNecessary(r,v)),{bitsAllocated:d.bitsAllocated,numberOfComponents:i,origin:o,direction:a,dimensions:s,spacing:c,numVoxels:l,imagePlaneModule:v,imagePixelModule:d}}matchImagesForOverlay(e,r){return(i=>{const o=ut(Ui.IMAGE_PLANE,r),a=ut(Ui.IMAGE_PLANE,i),s=o.imageOrientationPatient,c=a.imageOrientationPatient;if(s&&c){if(Et(o.imageOrientationPatient,a.imageOrientationPatient)){const d=o.imagePositionPatient,u=a.imagePositionPatient;if(d&&u&&Et(d,u)){const h=o.rows,g=o.columns,p=a.rows,v=a.columns;if(h===p&&g===v)return i}}}else{const l=o.rows,d=o.columns,u=a.rows,f=a.columns;if(l===u&&d===f)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const r=this.imageIds[e];if(!r)return;const n=ut(Ui.IMAGE_PLANE,r);if(!n)return;const{imagePositionPatient:i,frameOfReferenceUID:o}=n;let{rowCosines:a,columnCosines:s}=n;a||=[1,0,0],s||=[0,1,0];const c=tn([0,0,0],s,a);return{FrameOfReferenceUID:o,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:r,sliceIndex:e}}_getCameraOrientation(e){const r=e.slice(6,9).map(i=>-i),n=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[r[0],r[1],r[2]],viewUp:[n[0],n[1],n[2]]}}createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a}){const s=new a.constructor(a.length),c=Ot.newInstance({name:"Pixels",numberOfComponents:o,values:s}),l=Rh.newInstance();return l.setDimensions(n),l.setSpacing(i),l.setDirection(r),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a}){try{this._imageData=this.createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a})}catch(s){$S.error(s)}}async setStack(e,r=0){if(this._throwIfDestroyed(),this.imageIds=e,r>e.length)throw new Error("Current image index is greater than the number of images in the stack");this.imageKeyToIndexMap.clear(),e.forEach((a,s)=>{this.imageKeyToIndexMap.set(a,s),this.imageKeyToIndexMap.set(Yn(a),s)}),this.currentImageIdIndex=r,this.targetImageIdIndex=r;const n=ut(B0.IMAGE_RETRIEVE_CONFIGURATION,e[r],"stack");this.imagesLoader=n?(n.create||sD)(n):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=Hs.LINEAR,this.invert=!1,this.viewportStatus=_i.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(r),o={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:r};return Ye(this.element,$e.VIEWPORT_NEW_IMAGE_SET,o),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,r){if(!r)return!1;const[n,i]=r.getSpacing(),[o,a]=r.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=r.getDirection(),l=c.slice(0,3),d=c.slice(3,6),u=r.getPointData().getScalars().getDataType(),f=Et(n,e.columnPixelSpacing),h=Et(i,e.rowPixelSpacing),g=f||e.columnPixelSpacing===null&&n===1,p=h||e.rowPixelSpacing===null&&i===1,v=o===e.columns,w=a===e.rows,m=Et(s.rowCosines,l),y=Et(s.columnCosines,d),C=u===e.voxelManager.getScalarData().constructor.name;return g&&p&&v&&w&&m&&y&&C}_updateVTKImageDataFromCornerstoneImage(e){let n=this._getImagePlaneModule(e.imageId).imagePositionPatient;n==null&&(n=[0,0,0]),this._imageData.setOrigin(n);const i=this.getActor(this.id);i&&(i.referencedId=e.imageId),nm(this._imageData,e)}_loadAndDisplayImage(e,r){return this.useCPURendering?this._loadAndDisplayImageCPU(e,r):this._loadAndDisplayImageGPU(e,r)}_loadAndDisplayImageCPU(e,r){return new Promise((n,i)=>{function o(h,g,p){if(this.currentImageIdIndex!==g)return;const v=h.voxelManager.getScalarData(),w=h.preScale,m=w?.scalingParameters,y=w?.scaled&&m?.rescaleIntercept%1!==0||m?.rescaleSlope%1!==0;if(v instanceof Float32Array&&y){const x={min:h.minPixelValue,max:h.maxPixelValue},_=Math.abs(x.max-x.min)/65535,E=x.min,D=v.length,b=new Uint16Array(D);let I=65535,O=0;for(let M=0;M<D;M++){const R=Math.floor((v[M]-E)/_);b[M]=R,I=Math.min(I,R),O=Math.max(O,R)}h.minPixelValue=I,h.maxPixelValue=O,h.slope=_,h.intercept=E,h.voxelManager?h.voxelManager.getScalarData=()=>b:h.getPixelData=()=>b,h.preScale={...h.preScale,scaled:!1}}this._setCSImage(h),this.viewportStatus=_i.PRE_RENDER;const C={image:h,imageId:p,imageIdIndex:g,viewportId:this.id,renderingEngineId:this.renderingEngineId};Ye(this.element,$e.STACK_NEW_IMAGE,C),this._updateToDisplayImageCPU(h),this.render(),this.currentImageIdIndex=g,n(p)}function a(h,g,p){const v={error:h,imageIdIndex:g,imageId:p};this.suppressEvents||Ye(Fe,$e.IMAGE_LOAD_ERROR,v),i(h)}function s(h,g,p){return dl(h,p).then(v=>{o.call(this,v,g,h)},v=>{a.call(this,v,g,h)})}const c=-5,l=Jt.Interaction,d={imageId:e,imageIdIndex:r},u={useRGBA:!0,requestType:l},f={imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};Ye(this.element,$e.PRE_STACK_NEW_IMAGE,f),$i.addRequest(s.bind(this,e,r,u),l,d,c)})}successCallback(e,r){const n=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==n)return;const i=this.csImage?.imageFrame,o=r?.imageFrame,a=i?.photometricInterpretation||this.csImage?.photometricInterpretation,s=o?.photometricInterpretation||r?.photometricInterpretation;a!==s&&(this.stackInvalidated=!0),this._setCSImage(r);const c={image:r,imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(r),Ye(this.element,$e.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=n}errorCallback(e,r,n){if(!r)return;const i=this.imageIds.indexOf(e),o={error:n,imageIdIndex:i,imageId:e};Ye(Fe,$e.IMAGE_LOAD_ERROR,o)}getLoaderImageOptions(e){const r=this.imageIds.indexOf(e),{transferSyntaxUID:n}=ut("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:n,priority:5,requestType:Jt.Interaction,additionalDetails:{imageId:e,imageIdIndex:r}}}async loadImages(e,r){const n=await Promise.allSettled(e.map(o=>{const a=this.getLoaderImageOptions(o);return dl(o,a).then(s=>(r.successCallback(o,s),o),s=>(r.errorCallback(o,!0,s),o))})),i=n.filter(o=>o.status==="rejected");if(i&&i.length){const o=new CustomEvent($e.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});Fe.dispatchEvent(o)}return n}_loadAndDisplayImageGPU(e,r){if(!e){console.warn("No image id set yet to load");return}const n={imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Ye(this.element,$e.PRE_STACK_NEW_IMAGE,n),this.imagesLoader.loadImages([e],this).then(()=>e)}_updateToDisplayImageCPU(e){const r=this.getImageDataMetadata(e),n=GD(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:o,voiLUTFunction:a}=n.voi;this.voiRange=tl(o,i,a),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...r},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},n,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?n:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=qf(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const r=[];e.forEach(n=>{const{imageId:i,...o}=n,a=Ne.getImage(i),{origin:s,dimensions:c,direction:l,spacing:d,numberOfComponents:u}=this.getImageDataMetadata(a),f=this.createVTKImageData({origin:s,dimensions:c,direction:l,spacing:d,numberOfComponents:u,pixelArray:a.voxelManager.getScalarData()}),h=this.createActorMapper(f);h&&(r.push({uid:n.actorUID??cn(),actor:h,referencedId:i,...o}),n.callback&&n.callback({imageActor:h,imageId:n.imageId}))}),this.addActors(r)}_updateActorToDisplayImageId(e){const r=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),n=this.getViewPresentation();if(r&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(n),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:o,dimensions:a,spacing:s,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),d=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:o,dimensions:a,spacing:s,numberOfComponents:c,pixelArray:d}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),f=this.getActors();f.length&&f[0].uid===this.id?f[0].actor=u:f.unshift({uid:this.id,actor:u,referencedId:e.imageId}),this.setActors(f);const{viewPlaneNormal:h,viewUp:g}=this._getCameraOrientation(o),p=this.getCamera();this.setCameraNoEvent({viewUp:g,viewPlaneNormal:h}),this.initialViewUp=g,this.resetCameraNoEvent(),this.setViewPresentation(n),this.triggerCameraEvent(this.getCamera(),p);const v=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const w=this._getInitialVOIRange(e);this.setVOI(w,{forceRecreateLUTFunction:!!v}),this.initialInvert=!!v,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.voiRange;const{windowCenter:r,windowWidth:n,voiLUTFunction:i}=e;let o=this._getVOIRangeFromWindowLevel(n,r,i);return o=this._getPTPreScaledRange()||o,o}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){return!(this.modality!=="PT"||!this.csImage.isPreScaled||!this.csImage.preScale?.scalingParameters.suvbw)}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,r,n=ui.LINEAR){let i,o;if(typeof r=="number"&&typeof e=="number"?(i=r,o=e):Array.isArray(r)&&Array.isArray(e)&&(i=r[0],o=e[0]),i!==void 0&&o!==void 0)return tl(o,i,n)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=_i.PRE_RENDER;const r=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const n=this.perImageIdDefaultProperties.get(r);n!==void 0?this.setProperties(n):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return r}resetCameraCPU({resetPan:e=!0,resetZoom:r=!0}){const{image:n}=this._cpuFallbackEnabledElement;if(!n)return;Tq(this._cpuFallbackEnabledElement,e,r);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:o,clientHeight:a}=this.element,s=[o/2,a/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:r}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:r,resetToCenter:!0})}scroll(e,r=!0,n=!1){const i=this.imageIds;if(isNaN(this.targetImageIdIndex))return;const o=this.targetImageIdIndex,a=i.length;let s=o+e;n?s=(s+a)%a:s=Math.max(0,Math.min(a-1,s)),this.targetImageIdIndex=s;const c=i[s];Ne.isLoaded(c)||!r?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const d={newImageIdIndex:s,imageId:c,direction:e};s!==o&&Ye(this.element,$e.STACK_VIEWPORT_SCROLL,d)}setImageIdIndex(e){if(this._throwIfDestroyed(),this.currentImageIdIndex===e)return Promise.resolve(this.getCurrentImageId());const r=this._setImageIdIndex(e);return this.targetImageIdIndex=e,r}calibrateSpacing(e){const r=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,r)}triggerCameraEvent(e,r){const n={previousCamera:r,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Ye(this.element,$e.CAMERA_MODIFIED,n)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),r={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Ye(this.element,$e.IMAGE_SPACING_CALIBRATED,r),this._publishCalibratedEvent=!1}jumpToWorld(e){const r=this.getImageIds(),n=this.getImageData(),{direction:i,spacing:o}=n,a=rc({direction:i,spacing:o,imageIds:r},e,this.getCamera().viewPlaneNormal,{ignoreSpacing:!0}),s=r.indexOf(a);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}getRendererContextPool(){return this.getRenderingEngine().getRenderer(this.id)}getRendererTiled(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow?.getRenderer(this.id)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:r,voiLUTFunction:n}=this.csImage;return this._getVOIRangeFromWindowLevel(r,e,n)}_getValidVOILUTFunction(e){return Object.values(ui).includes(e)?e:ui.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:r}=this.getImageData();return{width:r[0],height:r[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,r={}){const n=this.getCurrentImageIdIndex(),i=this.imageIds[n];if(!i||!e)return!1;const{referencedImageId:o,multiSliceReference:a}=e;if(o){if(o===i)return!0;e.referencedImageURI||=Yn(o);const{referencedImageURI:c}=e,l=this.imageKeyToIndexMap.get(c);if(r.asOverlay&&this.matchImagesForOverlay(i,o))return!0;if(l===void 0)return!1;if(r.withNavigation)return!0;const d=a&&this.imageKeyToIndexMap.get(a.referencedImageId);return n<=d&&n>=l}if(!super.isReferenceViewable(e,{...r,withOrientation:r?.asVolume}))return!1;if(e.volumeId||e.FrameOfReferenceUID)return r.asVolume;const{cameraFocalPoint:s}=e;if(r.asNearbyProjection&&s){const{spacing:c,direction:l,origin:d}=this.getImageData(),u=l.slice(6,9),f=ml({direction:l,spacing:c},u),h=an(Ie(),s,d),g=ft(h,u),p=f/2;if(Math.abs(g)<=p)return!0}return!1}getViewReference(e={}){const{sliceIndex:r=this.getCurrentImageIdIndex()}=e,n=super.getViewReference(e),i=this.getCurrentImageId(r);if(i){if(n.referencedImageId=i,this.getCurrentImageIdIndex()!==r){const o=this.getImagePlaneReferenceData(r);if(!o)return;Object.assign(n,o)}return n}}setViewReference(e){if(!e?.referencedImageId){e?.sliceIndex!==void 0&&this.scroll(e.sliceIndex-this.targetImageIdIndex);return}const{referencedImageId:r}=e;e.referencedImageURI||=Yn(r);const{referencedImageURI:n}=e,i=this.imageKeyToIndexMap.get(n);if(i===void 0){$S.error(`No image URI found for ${n}`);return}this.scroll(i-this.targetImageIdIndex)}getViewReferenceId(e={}){const{sliceIndex:r=this.currentImageIdIndex}=e;return`imageId:${this.imageIds[r]}`}getSliceIndexForImage(e){if(e){if(typeof e=="string")return this.imageKeyToIndexMap.get(e);if(e.referencedImageId)return this.imageKeyToIndexMap.get(e.referencedImageId)}}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const r=jf(e.name);this._cpuFallbackEnabledElement.viewport.colormap=r,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const n={viewportId:this.id,colormap:e};Ye(this.element,$e.COLORMAP_MODIFIED,n)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),o=i.getRGBTransferFunction(),a=jf(e.name)||$f.getPresetByName(e.name);if(o)o.applyColorMap(a),o.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,o);else{const c=Qs.newInstance();c.applyColorMap(a),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};Ye(this.element,$e.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){const r=OD(e);return this.hasPixelSpacing=!r.usingDefaultValues||this.calibration?.scale>0||this.calibration?.rowPixelSpacing>0,this.calibration||=r.calibration,r}isInAcquisitionPlane(){return!0}}function qc(t,e){const{imageData:r}=t.getImageData(),n=t.canvasToWorld(e);return br(r,n)}function $0(t,e){return t.indexToWorld(e)}function Eq(t,e){const{imageData:r}=t.getImageData(),n=$0(r,e);return t.worldToCanvas(n)}class Gn extends Zn{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:n}=Hp(this)||{};return n},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(n,i=!0)=>{const{currentStepIndex:o}=yu(this,n||this.getVolumeId(),i);return o},this.getSliceIndex=()=>{const{imageIndex:n}=Hp(this)||{};return n},this.getCurrentImageId=()=>{const n=this.getDefaultActor();if(!n||!Gi(n,"vtkVolume"))return;const i=Ne.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:o,focalPoint:a}=this.getCamera();return rc(i,a,o)},this.getSlicePlaneCoordinates=()=>{const n=this.getDefaultActor();if(!n?.actor)return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),o=Ne.getVolume(i),a=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:l}=a,d=ml(o,l),u=Q1(n.actor,l,s),f=Math.round((u.current-u.min)/d),h=Math.round((u.max-u.current)/d),g=this.getSliceIndex(),p=[];for(let v=-f;v<=h;v++){const{newFocalPoint:w}=T0(s,c,u,l,d,v);p.push({sliceIndex:g+v,point:w})}return p};const{orientation:r}=this.options;if(r&&r!==ha.ACQUISITION){this.applyViewOrientation(r);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,r=!1,n=!1){const i=e[0].volumeId,o=Ne.getVolume(i);if(!o)throw new Error(`imageVolume with id: ${i} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(o),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,o),super.setVolumes(e,r,n)}async addVolumes(e,r=!1,n=!1){const i=Ne.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane?(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1):this.options.orientation&&typeof this.options.orientation=="string"&&this.options.orientation.includes("_reformat")&&this._setViewPlaneToReformatOrientation(this.options.orientation,i),super.addVolumes(e,r,n)}jumpToWorld(e){const{focalPoint:r}=this.getCamera(),n=[0,0,0];rn(n,e,r);const i=this.getCamera(),o=i.viewPlaneNormal,a=ft(n,o),s=mt(o[0],o[1],o[2]);if(xr(s,s,a),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],l=[0,0,0];hr(c,i.focalPoint,s),hr(l,i.position,s),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,r=!0){let n,i;if(typeof e=="string"){if(e===ha.ACQUISITION)({viewPlaneNormal:n,viewUp:i}=super._getAcquisitionPlaneOrientation());else if(e===ha.REFORMAT||e.includes("_reformat"))({viewPlaneNormal:n,viewUp:i}=xD(this,{useViewportNormal:!0}));else if(Xs[e])({viewPlaneNormal:n,viewUp:i}=Xs[e]);else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:n,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:n,viewUp:i}=e),this.applyViewOrientation(e);r&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-lr.MAXIMUM_RAY_DISTANCE,lr.MAXIMUM_RAY_DISTANCE):e.setClippingRange(lr.MINIMUM_SLAB_THICKNESS,lr.MAXIMUM_RAY_DISTANCE)}_setViewPlaneToReformatOrientation(e,r){let n,i;if(r){const{direction:o}=r;({viewPlaneNormal:n,viewUp:i}=CD(o.slice(0,3),o.slice(3,6),o.slice(6,9),e))}else({viewPlaneNormal:n,viewUp:i}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:i}),this.initialViewUp=i,this.resetCamera()}_setViewPlaneToAcquisitionPlane(e){let r,n;if(e){const{direction:i}=e;r=i.slice(6,9).map(o=>-o),n=i.slice(3,6).map(o=>-o)}else({viewPlaneNormal:r,viewUp:n}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:r,viewUp:n}),this.initialViewUp=n,this.resetCamera()}getBlendMode(e){const r=this.getActors(),n=e?.length>0?r.find(i=>e.includes(i.uid)):r[0];return n?.blendMode||n?.actor.getMapper().getBlendMode()}setBlendMode(e,r=[],n=!1){let i=this.getActors();r?.length>0&&(i=i.filter(o=>r.includes(o.uid))),i.forEach(o=>{const{actor:a}=o;a.getMapper().setBlendMode?.(e),o.blendMode=e}),n&&this.render()}resetCamera(e){const{resetPan:r=!0,resetZoom:n=!0,resetRotation:i=!0,resetToCenter:o=!0,suppressEvents:a=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:r,resetZoom:n,resetToCenter:o});const l=this.getVtkActiveCamera(),d=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(h=>{if(!h.actor)return;const g=h.actor.getMapper();if(g.getClippingPlanes().length===0&&!h?.clippingFilter){const v=Kn.newInstance(),w=Kn.newInstance(),m=[v,w];let y=lr.MINIMUM_SLAB_THICKNESS;h.slabThickness&&(y=h.slabThickness),this.setOrientationOfClippingPlanes(m,y,d,u),g.addClippingPlane(v),g.addClippingPlane(w)}}),i&&Xs[this.viewportProperties.orientation]!==void 0){const h=Xs[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:h.viewUp,viewPlaneNormal:h.viewPlaneNormal})}if(!a){const h={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Ye(this.element,$e.CAMERA_RESET,h)}return!0}setSlabThickness(e,r=[]){e<.1&&(e=.1);let n=this.getActors();r?.length>0&&(n=n.filter(o=>r.includes(o.uid))),n.forEach(o=>{Gi(o,"vtkVolume")&&(o.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(n=>{Gi(n,"vtkVolume")&&(n.slabThickness=lr.MINIMUM_SLAB_THICKNESS)});const r=this.getCamera();this.updateClippingPlanesForActors(r),this.triggerCameraModifiedEventIfNecessary(r,r),this.viewportProperties.slabThickness=void 0}isInAcquisitionPlane(){const e=this.getImageData();if(!e)return!1;const{direction:r}=e,{viewPlaneNormal:n}=this.getCamera(),i=[r[6],r[7],r[8]];return Math.abs(ft(n,i))>.99}getSliceViewInfo(){const{width:e,height:r}=this.getCanvas(),n=qc(this,[0,0]),i=qc(this,[e-1,0]),o=qc(this,[0,r-1]),a=rn(Ie(),i,n),s=rn(Ie(),o,n),c=tn(Ie(),a,s);Lt(a,a),Lt(s,s),Lt(c,c);const{dimensions:l}=this.getImageData(),[d,u,f]=l,p=[[0,0,0],[d-1,0,0],[0,u-1,0],[d-1,u-1,0],[0,0,f-1],[d-1,0,f-1],[0,u-1,f-1],[d-1,u-1,f-1]].map(D=>Eq(this,D)).reduce((D,b)=>(D.minX=Math.min(D.minX,b[0]),D.minY=Math.min(D.minY,b[1]),D.maxX=Math.max(D.maxX,b[0]),D.maxY=Math.max(D.maxY,b[1]),D),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),v=qc(this,[p.minX,p.minY]),w=k5(a[0],a[1],a[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,v[0],v[1],v[2],1),m=qc(this,[p.maxX,p.maxY]),y=rn(Ie(),m,v),C=Cr(fi(),w),{viewPlaneNormal:x}=this.getCamera();if(x.filter(D=>Math.abs(D)>yo).length>1)throw new Error("getSliceInfo is not supported for oblique views");const T=x.findIndex(D=>Math.abs(D)>1-yo);if(T===-1)throw new Error("Unable to determine slice axis");const _=ft(a,y)+1,E=ft(s,y)+1;return{sliceIndex:this.getSliceIndex(),width:_,height:E,slicePlane:T,sliceToIndexMatrix:w,indexToSliceMatrix:C}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const r=super.getViewReference(e);if(!r?.volumeId)return;const n=Ne.getVolume(r.volumeId);return r.referencedImageId=rc(n,r.cameraFocalPoint,r.viewPlaneNormal),r}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const r=e?this.getActor(e):this.getDefaultActor();if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);r.slabThickness&&(r.slabThickness=lr.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const n=Ne.getVolume(e);if(!n)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(Dw(r.actor,n),Uo(r)){const l=r.actor.getProperty().getRGBTransferFunction(0);U1(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),Ye(this.element,$e.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:r}=this.getCamera(),n=lr.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:o})=>{const a=[Kn.newInstance(),Kn.newInstance()];return this.setOrientationOfClippingPlanes(a,n,r,i),{sliceIndex:o,planes:a.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}class Nw extends Zn{constructor(e){super(e),this.setSampleDistanceMultiplier=o=>{this.getActors().forEach(s=>{if(Gi(s,"vtkVolume")){const l=s.actor.getMapper();if(l&&l.getInputData){const d=l.getInputData();if(d){const u=d.getSpacing();let g=(u[0]+u[1]+u[2])/6*(o||1);g!==void 0&&l.setSampleDistance&&(l.getSampleDistance(),l.setSampleDistance(g))}}}}),this.render()},this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:r,orientation:n}=this.options,i=this.getVtkActiveCamera();r!=null&&i.setParallelProjection(r),n&&n!==ha.ACQUISITION&&this.applyViewOrientation(n)}isInAcquisitionPlane(){return!1}resetCamera({resetPan:e=!0,resetZoom:r=!0,resetToCenter:n=!0}={}){super.resetCamera({resetPan:e,resetZoom:r,resetToCenter:n});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-lr.MAXIMUM_RAY_DISTANCE,lr.MAXIMUM_RAY_DISTANCE):i.setClippingRange(lr.MINIMUM_SLAB_THICKNESS,lr.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,r){return null}setBlendMode(e,r,n){return null}resetProperties(e){const r=e?this.getActor(e):this.getDefaultActor();if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);r.slabThickness&&(r.slabThickness=lr.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||=this.getVolumeId();const n=Ne.getVolume(e);if(!n)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(Dw(r.actor,n),Uo(r)){const i=r.actor.getProperty().getRGBTransferFunction(0);U1(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),Ye(this.element,$e.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-lr.MAXIMUM_RAY_DISTANCE,lr.MAXIMUM_RAY_DISTANCE):e.setClippingRange(lr.MINIMUM_SLAB_THICKNESS,lr.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}async function bq(t,e,r,n=!1,i=!1){r.forEach(a=>{const s=t.getViewport(a);if(!s)throw new Error(`Viewport with Id ${a} does not exist`);if(!(s instanceof Zn))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const o=r.map(async a=>{await t.getViewport(a).setVolumes(e,n,i)});await Promise.all(o)}async function Dq(t,e,r,n=!1,i=!1){for(const a of r){const s=t.getViewport(a);if(!s)throw new Error(`Viewport with Id ${a} does not exist`);if(!(s instanceof Zn)){console.warn(`Viewport with Id ${a} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const o=r.map(async a=>{await t.getViewport(a).addVolumes(e,n,i)});await Promise.all(o)}function Iq(t,e,r){for(const n of r){const i=t.getViewport(n);if(!i)throw new Error(`Viewport with Id ${n} does not exist`);if(!i.addImages){console.warn(`Viewport with Id ${n} does not have addImages. Cannot add image segmentation to this viewport.`);return}}r.forEach(n=>{t.getViewport(n).addImages(e)})}class Mq{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,r){this.transferFunction[e]=r}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const r=this.transferFunction[0],n=r.getRedValue(e),i=r.getGreenValue(e),o=r.getBlueValue(e);return[n,i,o,this.opacity]}}class Oq{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class Pq{constructor(e,r){this.canvasProperties=new Mq(this),this.visibility=!1,this.mapper=new Oq(this),this.className="CanvasActor",this.derivedImage=r,this.viewport=e}renderRLE(e,r,n){const{width:i,height:o}=this.image;let{canvas:a}=this;(!a||a.width!==i||a.height!==o)&&(this.canvas=a=new window.OffscreenCanvas(i,o));const s=a.getContext("2d"),c=s.createImageData(i,o),{data:l}=c;l.fill(0);const{map:d}=n;let u=1/0,f=1/0,h=-1/0,g=-1/0;for(let w=0;w<o;w++){const m=d.getRun(w,0);if(!m)continue;f=Math.min(f,w),g=Math.max(g,w);const y=w*i<<2;let C;for(const x of m){const{start:S,end:T,value:_}=x;if(_===0){C||=[],C.push(m.indexOf(x));continue}u=Math.min(u,S),h=Math.max(h,T);const E=this.canvasProperties.getColor(_).map(b=>b*255);let D=y+(S<<2);for(let b=S;b<T;b++)l[D++]=E[0],l[D++]=E[1],l[D++]=E[2],l[D++]=E[3]}}if(u>i)return;const p=h-u,v=g-f;s.putImageData(c,0,0,u-1,f-1,p+2,v+2),r.drawImage(a,u,f,p,v,u,f,p,v)}setMapper(e){this.mapper=e}render(e,r){if(!this.visibility)return;const n=this.image||this.getImage(),{width:i,height:o}=n,a=n.getScalarData();if(!a)return;const{voxelManager:s}=n;if(s&&s.map.getRun){this.renderRLE(e,r,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==o)&&(this.canvas=c=new window.OffscreenCanvas(i,o));const l=c.getContext("2d"),d=l.createImageData(i,o),{data:u}=d;let f=0,h=0,g=1/0,p=1/0,v=-1/0,w=-1/0;for(let C=0;C<o;C++)for(let x=0;x<i;x++){const S=a[f++];if(S){g=Math.min(x,g),p=Math.min(C,p),v=Math.max(x,v),w=Math.max(C,w);const T=this.canvasProperties.getColor(S);u[h]=T[0]*255,u[h+1]=T[1]*255,u[h+2]=T[2]*255,u[h+3]=127}h+=4}if(g>i)return;const m=v-g+1,y=w-p+1;l.putImageData(d,0,0,g,p,m,y),r.drawImage(c,g,p,m,y,g,p,m,y)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:r=>e.imageData.worldToIndex(r),indexToWorld:(r,n)=>e.imageData.indexToWorld(r,n),getDimensions:()=>e.dimensions,getScalarData:()=>this.derivedImage?.getPixelData(),getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:r=>{this.derivedImage=r,this.image=null},modified:()=>null}),this.image}}const bx=class bx{static imageIdToFrames(e){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const n=r[2].split("-").map(i=>Number(i));return n.length===1?n[0]:n}static imageIdToFrameEnd(e){const r=this.imageIdToFrames(e);return Array.isArray(r)?r[1]:r}static imageIdToFrameStart(e){const r=this.imageIdToFrames(e);return Array.isArray(r)?r[0]:r}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,r){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const i=this.framesToString(r);return e.replace(this.frameRangeExtractor,`${n[1]}${i}`)}};bx.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let _0=bx;const Of=class Of extends W0{constructor(e){super({...e,canvas:e.canvas||Go(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const r=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(r)?this.numberOfFrames:r},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const r=this.canvas,{clientWidth:n,clientHeight:i}=r;(r.width!==n||r.height!==i)&&(r.width=n,r.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(r,n=[0,0,0])=>{const i=this.videoCamera.panWorld,o=this.getWorldToCanvasRatio(),a=[i[0]*o,i[1]*o],s=[r[0]-a[0],r[1]-a[1]];return n.splice(0,2,s[0]/o,s[1]/o),n},this.worldToCanvas=r=>{const n=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(r[0]+n[0])*i,(r[1]+n[1])*i]},this.getRotation=()=>0,this.canvasToIndex=r=>{const n=this.getTransform();return n.invert(),n.transformPoint(r.map(i=>i*devicePixelRatio))},this.indexToCanvas=r=>this.getTransform().transformPoint(r).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const r=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),o=this.canvasContext;o.resetTransform(),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.transform(i[0]/r,i[1]/r,i[2]/r,i[3]/r,i[4]/r,i[5]/r),o.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const s of this.getActors())s.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Ye(this.element,$e.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Ye(this.element,$e.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const a=this.getFrameNumber();this.isPlaying&&(a<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):a>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const r=typeof e=="string"?e:e.imageId,n=ut(Ui.IMAGE_PLANE,r);let i=n.rowCosines,o=n.columnCosines;(n.usingDefaultValues||i==null||o==null)&&(i=[1,0,0],o=[0,1,0]);const s=mt(i[0],i[1],i[2]),c=mt(o[0],o[1],o[2]),{rows:l,columns:d}=n,u=Ie();tn(u,s,c);let f=n.imagePositionPatient;f==null&&(f=[0,0,0]);const h=n.columnPixelSpacing||1,g=n.rowPixelSpacing||1,p=n.columns,v=n.rows,w=1,m=1;return this.hasPixelSpacing=!!n.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:f,rows:l,columns:d,direction:[...s,...c,...u],dimensions:[p,v,m],spacing:[h,g,w],hasPixelSpacing:this.hasPixelSpacing,numVoxels:p*v*m,imagePlaneModule:n}}setDataIds(e,r){this.setVideo(e[0],(r.viewReference?.sliceIndex||0)+1)}setVideo(e,r){this.imageId=Array.isArray(e)?e[0]:e;const n=ut(Ui.IMAGE_URL,e);if(!n?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=n,o=ut(Ui.GENERAL_SERIES,e);this.modality=o?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:a,numberOfFrames:s}=ut(Ui.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(a||30))),a||(a=Math.round(s/this.videoElement.duration)),this.fps=a,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(r||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(r||1),c(this)},25)})))}async setVideoURL(e){return new Promise(r=>{this.videoElement.src=e,this.videoElement.preload="auto";const n=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",n),this.refreshRenderValues(),r(!0)};this.videoElement.addEventListener("loadedmetadata",n)})}getImageIds(){const e=new Array(this.numberOfFrames),r=this.imageId.replace(/[0-9]+$/,"");for(let n=0;n<this.numberOfFrames;n++)e[n]=`${r}${n+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const r=this.videoElement,n=this.renderFrame,o=r.currentTime+e*this.scrollSpeed/this.fps;r.currentTime=o;const a=s=>{n(),r.removeEventListener("seeked",a)};r.addEventListener("seeked",a)}async start(){const e=this.videoElement,r=this.renderFrame;if(e.currentTime=0,e.paused){const n=i=>{r(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async end(){const e=this.videoElement,r=this.renderFrame;if(e.currentTime=e.duration,e.paused){const n=i=>{r(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async setTime(e){const r=this.videoElement,n=this.renderFrame;if(r.currentTime=e,r.paused){const i=o=>{n(),r.removeEventListener("seeked",i)};r.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getSliceIndexForImage(e){if(e){if(typeof e=="string")return _0.imageIdToFrameStart(e);if(e.referencedImageId)return _0.imageIdToFrameStart(e.referencedImageId)}}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,r=Bf.FRAME){this.scrollSpeed=r===Bf.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0,voiRange:{lower:0,upper:255}})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const o=new Uint8ClampedArray;return o.getRange=()=>[0,255],o.frameNumber=-1,o}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const r=e.getContext("2d");r.drawImage(this.videoElement,0,0);const i=r.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,r=e.spacing,n={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:o=>{const a=this.worldToCanvas(o),s=this.canvasToIndex(a);return[s[0],s[1],0]},indexToWorld:(o,a)=>{const s=this.indexToCanvas([o[0],o[1]]);return this.canvasToWorld(s,a)}},i={dimensions:e.dimensions,spacing:r,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:n,voxelManager:{forEach:(o,a)=>pw(a.imageData,{pointInShapeFn:a.isInObject??(()=>!0),callback:o,boundsIJK:a.boundsIJK,returnPoints:a.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(n,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const r=e.match(Of.frameRangeExtractor),n=r?e.substring(0,r.index):e;return this.imageId.includes(n)}setVOI(e){this.voiRange=e;const r=this.setColorTransform(e,this.averageWhite);this.canvas.style.filter=r}setWindowLevel(e=256,r=128){const n=r-e/2,i=r+e/2-1;this.setVOI({lower:n,upper:i}),this.setColorTransform({lower:n,upper:i},this.averageWhite)}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}setCamera(e){const{parallelScale:r,focalPoint:n}=e;if(r&&(this.videoCamera.parallelScale=this.element.clientHeight/2/r),n!==void 0){const i=this.worldToCanvas(n),o=[this.element.clientWidth/2,this.element.clientHeight/2],a=[(i[0]-o[0])/this.videoCamera.parallelScale,(i[1]-o[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-a[0],this.videoCamera.panWorld[1]-a[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(e=this.getCurrentImageIdIndex()){return this.imageId?.replace("/frames/1",`/frames/${e+1}`)}getViewReferenceId(e={}){const{sliceIndex:r}=e;return r===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(r)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${r[0]+1}-${r[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+r}`)}`}isReferenceViewable(e,r={}){let{imageURI:n}=r;const{referencedImageId:i,sliceIndex:o,multiSliceReference:a}=e;if(!super.isReferenceViewable(e))return!1;const s=this.getCurrentImageId();if(!n){const f=s.indexOf(":");n=s.substring(f+1,s.length-1)}if(r.withNavigation)return!0;const c=this.getSliceIndex();if(a){const f=_0.imageIdToFrameEnd(a.referencedImageId);return c>=o&&c<=f}if(o!==void 0)return c===o;if(!i)return!1;const l=i.match(Of.frameRangeExtractor);if(!l||!l[2])return!0;const d=l[2].split("-").map(f=>Number(f)),u=c+1;return d[0]<=u&&u<=(d[1]??d[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){const r=e?.sliceIndex??(this.isPlaying?this.frameRange[0]:this.getCurrentImageIdIndex()),n=e?.rangeEndSliceIndex??(this.isPlaying?this.frameRange[1]-1:void 0),i=n>r?{sliceIndex:n,referencedImageId:this.getCurrentImageId(n)}:void 0;return{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:r,multiSliceReference:i}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,r=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(r),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const r=Math.floor(this.videoWidth*e),n=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-r)/2,o=(this.canvas.offsetHeight-n)/2,a=i/e,s=o/e;this.videoCamera.panWorld=[a,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,r=window.devicePixelRatio||1,n=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),o=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],a=[o[0]*i,o[1]*i],s=new cd;return s.scale(r,r),s.translate(o[0],o[1]),s.scale(n,n),s.translate(e[0],e[1]),s.translate(-a[0],-a[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const r=this.getActors();e.forEach(n=>{const{imageId:i,...o}=n,a=Ne.getImage(i),s=this.createActorMapper(a),c=n.actorUID??cn();s&&(r.push({uid:c,actor:s,referencedId:i,...o}),n.callback&&n.callback({imageActor:s,imageId:i}))}),this.setActors(r)}createActorMapper(e){return new Pq(this,e)}};Of.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let Yf=Of;const Rq=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`;let Nd=null;const Aq="postrender",zS="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",p0=class p0 extends W0{constructor(e){super({...e,canvas:e.canvas||Go(e.element)}),this.imageURISet=new Set,this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.annotationRemovedListener=n=>{const{detail:i}=n,o=i?.annotation?.metadata;if(!o){this.postrender();return}const a=o.referencedImageURI??(o.referencedImageId?Yn(o.referencedImageId):null);if(a&&!this.hasImageURI(a))return;const s=o.FrameOfReferenceUID??null;s&&s!==this.frameOfReferenceUID||this.postrender()},this.voiRange={lower:0,upper:255},this.getProperties=()=>({voiRange:{...this.voiRange}}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const n=this.canvas,{clientWidth:i,clientHeight:o}=n;(n.width!==i||n.height!==o)&&(n.width=i,n.height=o),this.refreshRenderValues()},this.canvasToWorld=n=>{if(!this.metadata)return;const i=this.canvasToIndex(n);return i[1]=-i[1],this.indexToWorld(i)},this.worldToCanvas=n=>{if(!this.metadata)return;const i=this.worldToIndex(n);return i[1]=-i[1],this.indexToCanvas([i[0],i[1],0])},this.postrender=()=>{this.refreshRenderValues(),Ye(this.element,$e.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=n=>{const i=this.getTransform();i.invert();const o=i.transformPoint(n.map(a=>a*devicePixelRatio));return[o[0],o[1],0]},this.indexToCanvas=n=>this.getTransform().transformPoint([n[0],n[1]]).map(o=>o/devicePixelRatio),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=cn(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const r=this.element.firstElementChild;r.insertBefore(this.microscopyElement,r.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler),Fe.addEventListener(zS,this.annotationRemovedListener)}removeEventListeners(){this.canvas.removeEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler),Fe.removeEventListener(zS,this.annotationRemovedListener)}elementDisabledHandler(){this.removeEventListeners(),this.viewer?.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null,this.imageURISet.clear()}getImageDataMetadata(e=0){const r=this.metadataDicomweb.reduce((E,D)=>E?.NumberOfFrames<D.NumberOfFrames?D:E),{TotalPixelMatrixColumns:n,TotalPixelMatrixRows:i,ImageOrientationSlide:o,ImagedVolumeWidth:a,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=r,l=ut(Ui.IMAGE_PLANE,this.imageIds[e]);let d=o.slice(0,3),u=o.slice(3,6);(d==null||u==null)&&(d=[1,0,0],u=[0,1,0]);const f=mt(d[0],d[1],d[2]),h=mt(u[0],u[1],u[2]),g=Ie();tn(g,f,h);const{XOffsetInSlideCoordinateSystem:p=0,YOffsetInSlideCoordinateSystem:v=0,ZOffsetInSlideCoordinateSystem:w=0}=r.TotalPixelMatrixOriginSequence?.[0]||{},m=[p,v,w],y=a/n,C=s/i,x=n,S=i,T=c,_=1;return this.hasPixelSpacing=!!(a&&s),{bitsAllocated:8,numberOfComponents:3,origin:m,direction:[...f,...h,...g],dimensions:[x,S,_],spacing:[y,C,T],hasPixelSpacing:this.hasPixelSpacing,numVoxels:x*S*_,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){e.voiRange&&this.setVOI(e.voiRange)}resetProperties(){this.setProperties({voiRange:{lower:0,upper:255}})}setVOI(e){this.voiRange=e;const r=this.setColorTransform(e,this.averageWhite);this.map.getViewport().querySelectorAll(".ol-layers canvas").forEach(i=>{i.style.filter=r})}setAverageWhite(e){this.averageWhite=e,this.setColorTransform(this.voiRange,e)}getScalarData(){return null}computeTransforms(){const e=fi(),r=fi();return ed(e,this.metadata.origin),e[0]=this.metadata.direction[0],e[1]=this.metadata.direction[1],e[2]=this.metadata.direction[2],e[4]=this.metadata.direction[3],e[5]=this.metadata.direction[4],e[6]=this.metadata.direction[5],e[8]=this.metadata.direction[6],e[9]=this.metadata.direction[7],e[10]=this.metadata.direction[8],es(e,e,this.metadata.spacing),Cr(r,e),{indexToWorld:e,worldToIndex:r}}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:r}=e,n={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:o=>this.worldToIndex(o),indexToWorld:o=>this.indexToWorld(o)};return{dimensions:e.dimensions,spacing:r,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:n}}hasImageURI(e){return e?this.imageURISet.has(e):!1}setCamera(e){const r=this.getCamera(),{parallelScale:n,focalPoint:i}=e,o=this.getView(),{xSpacing:a}=this.internalCamera;if(n){const c=this.element.clientHeight/n,l=1/a/c;o.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);o.setCenter(l)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(r,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:r,centerIndex:n}=this.internalCamera,i=e*r,o=this.indexToCanvas([n[0],n[1],0]),a=this.canvasToWorld(o);return{parallelProjection:!0,focalPoint:a,position:a,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*i,viewPlaneNormal:[0,0,1]}}worldToIndexWSI(e){if(!Nd)return;const r=this.viewer.getAffine(),n=Nd.applyInverseTransform({coordinate:[e[0],e[1]],affine:r});return[n[0],n[1]]}indexToWorldWSI(e){if(!Nd)return;const r=Nd.applyTransform({coordinate:[e[0],e[1]],affine:this.viewer.getAffine()});return[r[0],r[1],0]}worldToIndex(e){const{worldToIndex:r}=this.computeTransforms(),n=Ie();return Vt(n,e,r),n}indexToWorld(e){const{indexToWorld:r}=this.computeTransforms(),n=Ie(),i=mt(...e);return Vt(n,i,r),[n[0],n[1],n[2]]}setDataIds(e,r){r?.miniNavigationOverlay!==!1&&p0.addMiniNavigationOverlayCss();const n=r?.webClient||ut(Ui.WADO_WEB_CLIENT,e[0]);if(!n)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}.`);return this.setWSI(e,n)}async setWSI(e,r){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e,this.imageURISet=new Set(e.map(s=>Yn(s)));const n=await p0.getDicomMicroscopyViewer();Nd||=n.utils,this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{const c=r.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=c["00080008"]?.Value;l?.length===1&&(c["00080008"].Value=l[0].split("\\"));const d=c["00200052"]?.Value?.[0];return this.frameOfReferenceUID?d!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=d,c}),o=[];i.forEach(s=>{const c=new n.metadata.VLWholeSlideMicroscopyImage({metadata:s}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?o.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=o;const a=new n.viewer.VolumeImageViewer({client:r,metadata:o,controls:["overview","position"],retrieveRendered:!1,bindings:{}});a.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),a.deactivateDragPanInteraction(),this.viewer=a,this.map=a.getMap(),this.map.on(Aq,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const r=this.getCamera();this.setCamera({parallelScale:r.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer.getMap(),r=window;return r.map=e,r.viewer=this.viewer,r.view=e?.getView(),r.wsi=this,e?.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const r=e.getResolution();if(!r||r<yo)return;const n=e.getCenter(),i=e.getProjection().getExtent(),o=e.getRotation(),a=e.getZoom(),{metadata:{spacing:[s,c]}}=this,l=1/r/s;Object.assign(this.internalCamera,{extent:i,centerIndex:n,worldToCanvasRatio:l,xSpacing:s,ySpacing:c,resolution:r,rotation:o,zoom:a})}getZoom(){return this.getView()?.getZoom()}setZoom(e){this.getView()?.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:r,rotation:n}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],o=new cd;return o.translate(i[0],i[1]),o.rotate(n),o.scale(1/r,-1/r),o.translate(-e[0],-e[1]),o}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=Rq,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};p0.getDicomMicroscopyViewer=async()=>zR("dicom-microscopy-viewer"),p0.overlayCssId="overlayCss";let py=p0;const WD={[Nn.ORTHOGRAPHIC]:Gn,[Nn.PERSPECTIVE]:Gn,[Nn.STACK]:Wn,[Nn.VOLUME_3D]:Nw,[Nn.VIDEO]:Yf,[Nn.WHOLE_SLIDE]:py};function ja(t){return WD[t].useCustomRenderingPipeline}const Ki={WIDTH:160,HEIGHT:96,TEXT_PADDING:3,TEXT_Y_OFFSET:2,GRAPH_Y_OFFSET:15,GRAPH_WIDTH:150,GRAPH_HEIGHT:70,FONT_SIZE:9,FONT_FAMILY:"Helvetica,Arial,sans-serif",GRAPH_ALPHA:.9},Tg={UPDATE_INTERVAL:1e3,MAX_MS_VALUE:200,MAX_FPS_VALUE:300,OVERLAY_STYLES:{position:"fixed",top:"0px",right:"0px",left:"auto",zIndex:"9999",cursor:"pointer",opacity:"0.9"}},I2={BYTES_TO_MB:1048576,MS_PER_SECOND:1e3},Ps=[{name:"FPS",foregroundColor:"#0ff",backgroundColor:"#002"},{name:"MS",foregroundColor:"#0f0",backgroundColor:"#020"},{name:"MB",foregroundColor:"#f08",backgroundColor:"#201"}];class M2{constructor(e,r,n){this.minValue=1/0,this.maxValue=0,this.name=e,this.foregroundColor=r,this.backgroundColor=n,this.devicePixelRatio=Math.round(window.devicePixelRatio||1),this.dimensions=this.calculateDimensions(),this.dom=this.createCanvas(),this.context=this.initializeContext(),this.drawInitialPanel()}update(e,r){this.updateMinMax(e),this.clearTextArea(),this.drawText(e),this.scrollGraph(),this.drawNewValue(e,r)}calculateDimensions(){const e=this.devicePixelRatio;return{width:Ki.WIDTH*e,height:Ki.HEIGHT*e,textX:Ki.TEXT_PADDING*e,textY:Ki.TEXT_Y_OFFSET*e,graphX:Ki.TEXT_PADDING*e,graphY:Ki.GRAPH_Y_OFFSET*e,graphWidth:Ki.GRAPH_WIDTH*e,graphHeight:Ki.GRAPH_HEIGHT*e}}createCanvas(){const e=document.createElement("canvas");return e.width=this.dimensions.width,e.height=this.dimensions.height,e.style.cssText=`width:${Ki.WIDTH}px;height:${Ki.HEIGHT}px`,e}initializeContext(){const e=this.dom.getContext("2d");if(!e)throw new Error("Failed to get 2D context");return e.font=`bold ${Ki.FONT_SIZE*this.devicePixelRatio}px ${Ki.FONT_FAMILY}`,e.textBaseline="top",e}drawInitialPanel(){const{width:e,height:r,textX:n,textY:i,graphX:o,graphY:a,graphWidth:s,graphHeight:c}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,r),this.context.fillStyle=this.foregroundColor,this.context.fillText(this.name,n,i),this.context.fillRect(o,a,s,c),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=Ki.GRAPH_ALPHA,this.context.fillRect(o,a,s,c),this.context.globalAlpha=1}updateMinMax(e){this.minValue=Math.min(this.minValue,e),this.maxValue=Math.max(this.maxValue,e)}clearTextArea(){const{width:e,graphY:r}=this.dimensions;this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,e,r)}drawText(e){const{textX:r,textY:n}=this.dimensions,i=this.formatText(e);this.context.fillStyle=this.foregroundColor,this.context.fillText(i,r,n)}formatText(e){const r=Math.round(e),n=Math.round(this.minValue),i=Math.round(this.maxValue);return`${r} ${this.name} (${n}-${i})`}scrollGraph(){const{graphX:e,graphY:r,graphWidth:n,graphHeight:i}=this.dimensions,o=this.devicePixelRatio;this.context.drawImage(this.dom,e+o,r,n-o,i,e,r,n-o,i)}drawNewValue(e,r){const{graphX:n,graphY:i,graphWidth:o,graphHeight:a}=this.dimensions,s=this.devicePixelRatio,c=n+o-s;this.context.fillStyle=this.foregroundColor,this.context.fillRect(c,i,s,a);const l=Math.round((1-e/r)*a);this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=Ki.GRAPH_ALPHA,this.context.fillRect(c,i,s,l),this.context.globalAlpha=1}}var Jr;(function(t){t[t.FPS=0]="FPS",t[t.MS=1]="MS",t[t.MEMORY=2]="MEMORY"})(Jr||(Jr={}));var $a;let Lq=($a=class{constructor(){this.dom=null,this.currentMode=0,this.startTime=0,this.lastUpdateTime=0,this.frameCount=0,this.panels=new Map,this.animationFrameId=null,this.isSetup=!1}static getInstance(){return $a.instance||($a.instance=new $a),$a.instance}setup(){if(!this.isSetup)try{this.dom=this.createOverlayElement(),this.startTime=performance.now(),this.lastUpdateTime=this.startTime,this.initializePanels(),this.showPanel(Jr.FPS),this.applyOverlayStyles(),document.body.appendChild(this.dom),this.startLoop(),this.isSetup=!0}catch(e){console.warn("Failed to setup stats overlay:",e)}}cleanup(){this.stopLoop(),this.dom&&this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.dom=null,this.panels.clear(),this.isSetup=!1}showPanel(e){Array.from(this.dom.children).forEach((n,i)=>{n.style.display=i===e?"block":"none"}),this.currentMode=e}update(){this.startTime=this.updateStats()}createOverlayElement(){const e=document.createElement("div");return e.addEventListener("click",this.handleClick.bind(this),!1),e}applyOverlayStyles(){Object.assign(this.dom.style,Tg.OVERLAY_STYLES)}handleClick(e){e.preventDefault();const r=this.dom.children.length;this.showPanel((this.currentMode+1)%r)}initializePanels(){const e=new M2(Ps[Jr.FPS].name,Ps[Jr.FPS].foregroundColor,Ps[Jr.FPS].backgroundColor);this.addPanel(Jr.FPS,e);const r=new M2(Ps[Jr.MS].name,Ps[Jr.MS].foregroundColor,Ps[Jr.MS].backgroundColor);if(this.addPanel(Jr.MS,r),this.isMemoryAvailable()){const n=new M2(Ps[Jr.MEMORY].name,Ps[Jr.MEMORY].foregroundColor,Ps[Jr.MEMORY].backgroundColor);this.addPanel(Jr.MEMORY,n)}}isMemoryAvailable(){return performance.memory!==void 0}addPanel(e,r){this.dom.appendChild(r.dom),this.panels.set(e,r)}startLoop(){const e=()=>{this.update(),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}updateStats(){this.frameCount++;const e=performance.now(),r=e-this.startTime,n=this.panels.get(Jr.MS);if(n&&n.update(r,Tg.MAX_MS_VALUE),e>=this.lastUpdateTime+Tg.UPDATE_INTERVAL){const i=this.frameCount*I2.MS_PER_SECOND/(e-this.lastUpdateTime),o=this.panels.get(Jr.FPS);o&&o.update(i,Tg.MAX_FPS_VALUE),this.lastUpdateTime=e,this.frameCount=0,this.updateMemoryPanel()}return e}updateMemoryPanel(){const e=this.panels.get(Jr.MEMORY);if(!e)return;const r=performance;if(r.memory){const n=r.memory.usedJSHeapSize/I2.BYTES_TO_MB,i=r.memory.jsHeapSizeLimit/I2.BYTES_TO_MB;e.update(n,i)}}},$a.instance=null,$a);const jS=Lq.getInstance(),Kp=2;class $D{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const o=this._getViewportsAsArray().map(a=>{if(a.getFrameOfReferenceUID()===n)return a.id});this.renderViewports(o)},this.id=e||cn(),this.useCPURendering=ff(),Gf.set(this),!$R())throw new Error("@cornerstonejs/core is not initialized, run init() first");this._viewports=new Map,this.hasBeenDestroyed=!1,Qa()?.debug?.statsOverlay&&jS.setup()}enableElement(e){const r=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:n,viewportId:i}=r;if(!n)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:a}=r,s=ja(a);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(r):this.addCustomViewport(r);const c=Go(n),{background:l}=r.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const r=this.getViewport(e);if(!r){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(r),!ja(r.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),r.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const r=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const n=[],i=[];r.forEach(o=>{!this.useCPURendering&&!ja(o.type)?n.push(o):i.push(o)}),this.setVtkjsDrivenViewports(n),this.setCustomViewports(i),r.forEach(o=>{const a=Go(o.element),{background:s}=o.defaultOptions;this.fillCanvasWithBackgroundColor(a,s)})}resize(e=!0,r=!0){this._throwIfDestroyed();const n=this._getViewportsAsArray(),i=[],o=[];n.forEach(a=>{ja(a.type)?o.push(a):i.push(a)}),i.length&&this._resizeVTKViewports(i,r,e),o.length&&this._resizeUsingCustomResizeHandler(o,r,e)}getViewport(e){return this._viewports?.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const r=this.getViewport(e);if(!r)throw new Error(`Viewport with Id ${e} does not exist`);if(!(r instanceof Wn))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return r}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(r=>r instanceof Wn)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),r=n=>n instanceof Zn;return e.filter(r)}render(){const r=this.getViewports().map(n=>n.id);this._setViewportsToBeRenderedNextFrame(r)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(jS.cleanup(),this.useCPURendering||(this._getViewportsAsArray().forEach(r=>{this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.removeRenderer(r.id)}),this.offscreenMultiRenderWindow&&this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),Gf.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,r){const n=e.getContext("2d");let i;if(r){const o=r.map(a=>Math.floor(255*a));i=`rgb(${o[0]}, ${o[1]}, ${o[2]})`}else i="black";n.fillStyle=i,n.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:r,defaultOptions:n}=e;let i=n;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},r===Nn.ORTHOGRAPHIC&&(i={...i,orientation:ha.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const r=[];return e.forEach(n=>{r.push(this._normalizeViewportInputEntry(n))}),r}_resizeUsingCustomResizeHandler(e,r=!0,n=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const o=i.getCamera();i.resetCamera(),r&&i.setCamera(o)}),n&&this.render()}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addCustomViewport(e){const{element:r,viewportId:n,type:i,defaultOptions:o}=e;r.tabIndex=-1;const a=Go(r),{clientWidth:s,clientHeight:c}=a;(a.width!==s||a.height!==c)&&(a.width=s,a.height=c);const l={id:n,renderingEngineId:this.id,element:r,type:i,canvas:a,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:o||{}},d=WD[i],u=new d(l);this._viewports.set(n,u);const f={element:r,viewportId:n,renderingEngineId:this.id};Ye(Fe,$e.ELEMENT_ENABLED,f)}getRenderer(e){return this.offscreenMultiRenderWindow.getRenderer(e)}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");return this.offscreenMultiRenderWindow}setCustomViewports(e){e.forEach(r=>{this.addCustomViewport(r)})}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(r=>{this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_resetViewport(e){const r=this.id,{element:n,canvas:i,id:o}=e,a={element:n,viewportId:o,renderingEngineId:r};e.removeWidgets(),Ye(Fe,$e.ELEMENT_DISABLED,a),n.removeAttribute("data-viewport-uid"),n.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(r=>{this._resetViewport(r)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}}class zD extends $D{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const r=this._getViewportsAsArray(),n=[];for(let i=0;i<r.length;i++){const o=r[i];if(this._needsRender.has(o.id)){const a=this.renderViewportUsingCustomOrVtkPipeline(o);if(n.push(a),o.setRendered(),this._needsRender.delete(o.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,n.forEach(i=>{i?.element&&Ye(i.element,$e.IMAGE_RENDERED,i)})},this.useCPURendering||(this.offscreenMultiRenderWindow=j6.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer))}enableVTKjsDrivenViewport(e){const n=this._getViewportsAsArray().filter(d=>ja(d.type)===!1),i=n.map(d=>d.canvas),o=Go(e.element);i.push(o);const{offScreenCanvasWidth:a,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(n,a,s),l={...e,canvas:o};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:a,offScreenCanvasHeight:s,xOffset:c})}addVtkjsDrivenViewport(e,r){const{element:n,canvas:i,viewportId:o,type:a,defaultOptions:s}=e;n.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:d}=r,{sxStartDisplayCoords:u,syStartDisplayCoords:f,sxEndDisplayCoords:h,syEndDisplayCoords:g,sx:p,sy:v,sWidth:w,sHeight:m}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,d);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,f,h,g],id:o,background:s.background?s.background:[0,0,0]});const y={id:o,element:n,renderingEngineId:this.id,type:a,canvas:i,sx:p,sy:v,sWidth:w,sHeight:m,defaultOptions:s||{}};let C;if(a===Nn.STACK)C=new Wn(y);else if(a===Nn.ORTHOGRAPHIC||a===Nn.PERSPECTIVE)C=new Gn(y);else if(a===Nn.VOLUME_3D)C=new Nw(y);else throw new Error(`Viewport Type ${a} is not supported`);this._viewports.set(o,C);const x={element:n,viewportId:o,renderingEngineId:this.id};C.suppressEvents||Ye(Fe,$e.ELEMENT_ENABLED,x)}setVtkjsDrivenViewports(e){if(e.length){const r=e.map(a=>Go(a.element));r.forEach(a=>{const s=window.devicePixelRatio||1,c=a.getBoundingClientRect();a.width=c.width*s,a.height=c.height*s});const{offScreenCanvasWidth:n,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(r);let o=0;for(let a=0;a<e.length;a++){const s=e[a],c=r[a],l={...s,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:n,offScreenCanvasHeight:i,xOffset:o}),o+=c.width}}}_resizeVTKViewports(e,r=!0,n=!0){const i=e.map(o=>Go(o.element));if(i.forEach(o=>{const a=window.devicePixelRatio||1;o.width=o.clientWidth*a,o.height=o.clientHeight*a}),i.length){const{offScreenCanvasWidth:o,offScreenCanvasHeight:a}=this._resizeOffScreenCanvas(i);this._resize(e,o,a)}e.forEach(o=>{const a=o.getCamera(),s=o.getRotation(),{flipHorizontal:c}=a;o.resetCameraForResize();const l=o.getDisplayArea();r&&(l?(c&&o.setCamera({flipHorizontal:c}),s&&o.setViewPresentation({rotation:s})):o.setCamera(a))}),n&&this.render()}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,r=e.getRenderWindow(),n=e.getRenderers();if(n.length){for(let i=0;i<n.length;i++){const{renderer:o,id:a}=n[i];this._needsRender.has(a)?o.setDraw(!0):o.setDraw(!1)}r.render();for(let i=0;i<n.length;i++)n[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let r;if(e.sWidth<Kp||e.sHeight<Kp){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(ja(e.type)===!0)r=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:n}=this,a=n.getOpenGLRenderWindow().get3DContext().canvas;r=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,a)}return r}_renderViewportFromVtkCanvasToOnscreenCanvas(e,r){const{element:n,canvas:i,sx:o,sy:a,sWidth:s,sHeight:c,id:l,renderingEngineId:d,suppressEvents:u}=e,{width:f,height:h}=i;return i.getContext("2d").drawImage(r,o,a,s,c,0,0,f,h),{element:n,suppressEvents:u,viewportId:l,renderingEngineId:d,viewportStatus:e.viewportStatus}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:r,offscreenMultiRenderWindow:n}=this,i=Math.max(...e.map(a=>a.height));let o=0;return e.forEach(a=>{o+=a.width}),r.width=o,r.height=i,n.resize(),{offScreenCanvasWidth:o,offScreenCanvasHeight:i}}_resize(e,r,n){let i=0;for(let o=0;o<e.length;o++){const a=e[o],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:d,sx:u,sy:f,sWidth:h,sHeight:g}=this._getViewportCoordsOnOffScreenCanvas(a,r,n,i);i+=a.canvas.width,a.sx=u,a.sy=f,a.sWidth=h,a.sHeight=g,this.offscreenMultiRenderWindow.getRenderer(a.id).setViewport(s,c,l,d)}return i}_getViewportCoordsOnOffScreenCanvas(e,r,n,i){const{canvas:o}=e,{width:a,height:s}=o,c=i,l=0,d=c/r,u=l+(n-s)/n,f=a/r,h=s/n;return{sxStartDisplayCoords:d,syStartDisplayCoords:u,sxEndDisplayCoords:d+f,syEndDisplayCoords:u+h,sx:c,sy:l,sWidth:a,sHeight:s}}}class Nq{constructor(e){this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext=new Map,this.viewportSizes=new Map,this.contextMaxSizes=new Map;for(let r=0;r<e;r++){const n=j6.newInstance(),i=document.createElement("div");n.setContainer(i),this.contexts.push(n),this.offScreenCanvasContainers.push(i)}}getContextByIndex(e){return e>=0&&e<this.contexts.length?{context:this.contexts[e],container:this.offScreenCanvasContainers[e]}:null}assignViewportToContext(e,r){this.viewportToContext.set(e,r)}getContextIndexForViewport(e){return this.viewportToContext.get(e)}getAllContexts(){return this.contexts}getContextCount(){return this.contexts.length}updateViewportSize(e,r,n){const i=this.viewportToContext.get(e);if(i===void 0)return!1;this.viewportSizes.set(e,{width:r,height:n});const o=this.contextMaxSizes.get(i),a=this.calculateMaxSizeForContext(i);return this.contextMaxSizes.set(i,a),!o||o.width!==a.width||o.height!==a.height}getMaxSizeForContext(e){return this.contextMaxSizes.get(e)}calculateMaxSizeForContext(e){let r=0,n=0;return this.viewportToContext.forEach((i,o)=>{if(i===e){const a=this.viewportSizes.get(o);a&&(r=Math.max(r,a.width),n=Math.max(n,a.height))}}),{width:r,height:n}}removeViewport(e){const r=this.viewportToContext.get(e);if(this.viewportToContext.delete(e),this.viewportSizes.delete(e),r!==void 0){const n=this.calculateMaxSizeForContext(r);this.contextMaxSizes.set(r,n)}}destroy(){this.contexts.forEach(e=>{e.delete()}),this.contexts=[],this.offScreenCanvasContainers=[],this.viewportToContext.clear(),this.viewportSizes.clear(),this.contextMaxSizes.clear()}}class HS extends $D{constructor(e){super(e),this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const o=this._getViewportsAsArray().filter(s=>this._needsRender.has(s.id));if(o.length===0){this._animationFrameSet=!1,this._animationFrameHandle=null;return}const a=o.map(s=>{const c=this.renderViewportUsingCustomOrVtkPipeline(s);return s.setRendered(),this._needsRender.delete(s.id),c});this._animationFrameSet=!1,this._animationFrameHandle=null,a.forEach(s=>{s?.element&&Ye(s.element,$e.IMAGE_RENDERED,s)})};const{rendering:r}=Qa(),{webGlContextCount:n}=r;this.useCPURendering||(this.contextPool=new Nq(n))}enableVTKjsDrivenViewport(e){const i=this._getViewportsAsArray().filter(s=>ja(s.type)===!1).map(s=>s.canvas),o=Go(e.element);i.push(o);const a={...e,canvas:o};this.addVtkjsDrivenViewport(a)}addVtkjsDrivenViewport(e){const{element:r,canvas:n,viewportId:i,type:o,defaultOptions:a}=e;r.tabIndex=-1;let s=0;if(o===Nn.STACK){const p=this.contextPool.getAllContexts();s=this._viewports.size%p.length}this.contextPool.assignViewportToContext(i,s),this.contextPool.updateViewportSize(i,n.width,n.height);const c=this.contextPool.getContextByIndex(s),{context:l,container:d}=c,u=this.contextPool.getMaxSizeForContext(s);d.width=u.width,d.height=u.height,l.resize(),l.addRenderer({viewport:[0,0,1,1],id:i,background:a.background?a.background:[0,0,0]});const f={id:i,element:r,renderingEngineId:this.id,type:o,canvas:n,sx:0,sy:0,sWidth:n.width,sHeight:n.height,defaultOptions:a||{}};let h;if(o===Nn.STACK)h=new Wn(f);else if(o===Nn.ORTHOGRAPHIC||o===Nn.PERSPECTIVE)h=new Gn(f);else if(o===Nn.VOLUME_3D)h=new Nw(f);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(i,h);const g={element:r,viewportId:i,renderingEngineId:this.id};h.suppressEvents||Ye(Fe,$e.ELEMENT_ENABLED,g)}setVtkjsDrivenViewports(e){if(e.length){const r=e.map(n=>Go(n.element));r.forEach(n=>{const i=window.devicePixelRatio||1,o=n.getBoundingClientRect();n.width=o.width*i,n.height=o.height*i});for(let n=0;n<e.length;n++){const i=e[n],o=r[n],a={...i,canvas:o};this.addVtkjsDrivenViewport(a)}}}_resizeVTKViewports(e,r=!0,n=!0){const i=e.map(o=>Go(o.element));i.forEach(o=>{const a=window.devicePixelRatio||1;o.width=o.clientWidth*a,o.height=o.clientHeight*a}),i.length&&this._resize(e),e.forEach(o=>{const a=o.getCamera(),s=o.getRotation(),{flipHorizontal:c}=a;o.resetCameraForResize();const l=o.getDisplayArea();r&&(l?(c&&o.setCamera({flipHorizontal:c}),s&&o.setViewPresentation({rotation:s})):o.setCamera(a))}),n&&this.render()}renderViewportUsingCustomOrVtkPipeline(e){if(ja(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const r=this.contextPool.getContextIndexForViewport(e.id),n=this.contextPool.getContextByIndex(r),{context:i,container:o}=n;return this._renderViewportWithContext(e,i,o)}_renderViewportWithContext(e,r,n){if(e.sWidth<Kp||e.sHeight<Kp){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(ja(e.type))return e.customRenderViewportToCanvas();if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");r.getRenderer(e.id)||r.addRenderer({viewport:[0,0,1,1],id:e.id,background:e.defaultOptions?.background||[0,0,0]});const i=r.getRenderWindow(),o=i.getViews()[0],a=o.getRenderPasses(),s=this.getViewportRenderPasses(e.id);s&&o.setRenderPasses(s),this._resizeOffScreenCanvasForViewport(e,n,r);const c=r.getRenderer(e.id),l=this.contextPool.getContextIndexForViewport(e.id),d=this.contextPool.getMaxSizeForContext(l),u=e.canvas.width,f=e.canvas.height,h=Math.min(1,u/d.width),g=Math.min(1,f/d.height);c.setViewport(0,0,h,g);const p=r.getRenderers();p.forEach(({renderer:x,id:S})=>{x.setDraw(S===e.id)});const v=this.getWidgetRenderers();v.forEach((x,S)=>{S.setDraw(x===e.id)}),i.render(),p.forEach(({renderer:x})=>x.setDraw(!1)),v.forEach((x,S)=>{S.setDraw(!1)}),a&&o.setRenderPasses(a);const y=r.getOpenGLRenderWindow().get3DContext().canvas;return this._copyToOnscreenCanvas(e,y)}_renderViewportFromVtkCanvasToOnscreenCanvas(e,r){return this._copyToOnscreenCanvas(e,r)}_resizeOffScreenCanvasForViewport(e,r,n){const i=this.contextPool.getContextIndexForViewport(e.id);if(i===void 0||!this.contextPool.updateViewportSize(e.id,e.canvas.width,e.canvas.height))return;const a=this.contextPool.getMaxSizeForContext(i);r.width===a.width&&r.height===a.height||(r.width=a.width,r.height=a.height,n.resize())}_copyToOnscreenCanvas(e,r){const{element:n,canvas:i,id:o,renderingEngineId:a,suppressEvents:s}=e,{width:c,height:l}=i,d=i.getContext("2d"),u=this.contextPool.getContextIndexForViewport(o),h=this.contextPool.getMaxSizeForContext(u).height-l;return d.drawImage(r,0,h,c,l,0,0,c,l),{element:n,suppressEvents:s,viewportId:o,renderingEngineId:a,viewportStatus:e.viewportStatus}}_resize(e){const r=new Set;for(const n of e){n.sx=0,n.sy=0,n.sWidth=n.canvas.width,n.sHeight=n.canvas.height;const i=this.contextPool.getContextIndexForViewport(n.id);this.contextPool.updateViewportSize(n.id,n.canvas.width,n.canvas.height)&&r.add(i);const a=this.contextPool.getContextByIndex(i),{context:s}=a,c=s.getRenderer(n.id),l=this.contextPool.getMaxSizeForContext(i),d=Math.min(1,n.canvas.width/l.width),u=Math.min(1,n.canvas.height/l.height);c.setViewport(0,0,d,u)}r.forEach(n=>{const i=this.contextPool.getContextByIndex(n);if(i){const{context:o,container:a}=i,s=this.contextPool.getMaxSizeForContext(n);a.width=s.width,a.height=s.height,o.resize()}})}getWidgetRenderers(){const e=this._getViewportsAsArray(),r=new Map;return e.forEach(n=>{(n.getWidgets?n.getWidgets():[]).forEach(o=>{const a=o.getRenderer?o.getRenderer():null;a&&r.set(a,n.id)})}),r}getViewportRenderPasses(e){const r=this.getViewport(e);return r?.getRenderPasses?r.getRenderPasses():null}getRenderer(e){const r=this.contextPool?.getContextIndexForViewport(e),n=this.contextPool.getContextByIndex(r),{context:i}=n;return i.getRenderer(e)}disableElement(e){const r=this.getViewport(e);if(r&&(super.disableElement(e),!ja(r.type)&&!this.useCPURendering)){const n=this.contextPool.getContextIndexForViewport(e);if(n!==void 0){const i=this.contextPool.getContextByIndex(n);if(i){const{context:o}=i;o.removeRenderer(e)}}this.contextPool.removeViewport(e)}}destroy(){this.contextPool&&this.contextPool.destroy(),super.destroy()}getOffscreenMultiRenderWindow(e){if(this.useCPURendering)throw new Error("Offscreen multi render window is not available when using CPU rendering.");const r=this.contextPool.getContextIndexForViewport(e);return this.contextPool.getContextByIndex(r).context}}class Vq{constructor(e){const n=Qa()?.rendering?.renderingEngineMode;switch(n){case Tu.Tiled:this._implementation=new zD(e);break;case Tu.ContextPool:this._implementation=new HS(e);break;default:console.warn(`RenderingEngine: Unknown rendering engine mode "${n}". Defaulting to Next rendering engine.`),this._implementation=new HS(e);break}}get id(){return this._implementation.id}enableElement(e){return this._implementation.enableElement(e)}disableElement(e){return this._implementation.disableElement(e)}setViewports(e){return this._implementation.setViewports(e)}resize(e=!0,r=!0){return this._implementation.resize(e,r)}getViewport(e){return this._implementation.getViewport(e)}getViewports(){return this._implementation.getViewports()}getStackViewport(e){return this._implementation.getStackViewport(e)}getStackViewports(){return this._implementation.getStackViewports()}getVolumeViewports(){return this._implementation.getVolumeViewports()}getRenderer(e){return this._implementation.getRenderer(e)}fillCanvasWithBackgroundColor(e,r){return this._implementation.fillCanvasWithBackgroundColor(e,r)}render(){return this._implementation.render()}renderViewports(e){return this._implementation.renderViewports(e)}renderViewport(e){return this._implementation.renderViewport(e)}destroy(){return this._implementation.destroy()}getOffscreenMultiRenderWindow(e){return this._implementation.getOffscreenMultiRenderWindow(e)}}function jD(t){return new TextDecoder("latin1").decode(t)}function kq(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=jD(t),i=e.exec(n);if(!i)return{text:n};const o=i.index+i[0].length,a=n.substring(0,o);let s=null;const c=r?r.exec(n):null;if(c){const l=n.substr(c.index);s={text:a+l,binaryBuffer:t.slice(o,c.index)}}else s={text:a,binaryBuffer:t.slice(o)};return s}var Fq={arrayBufferToString:jD,extractBinary:kq};const Vw={};function HD(t){return!!Vw[t]}function Uq(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Vw[t](e)}function XD(t,e){Vw[t]=e}var Bq={get:Uq,has:HD,registerType:XD};function KD(){const t=new ArrayBuffer(4),e=new Uint8Array(t),r=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,r[0]===3569595041?"LittleEndian":r[0]===2712847316?"BigEndian":null}const Gq=KD();function Wq(t,e){if(e<2)return;const r=new Int8Array(t),n=r.length,i=[];for(let o=0;o<n;o+=e){for(let a=0;a<e;a++)i.push(r[o+a]);for(let a=0;a<e;a++)r[o+a]=i.pop()}}var O2={ENDIANNESS:Gq,getEndianness:KD,swapBytes:Wq};const{vtkErrorMacro:qD,vtkDebugMacro:$q}=Z,kw=()=>(qD("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let z0=0;function im(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new XMLHttpRequest;return n.open(t,e,!0),r.headers&&Object.entries(r.headers).forEach(i=>{let[o,a]=i;return n.setRequestHeader(o,a)}),r.progressCallback&&n.addEventListener("progress",r.progressCallback),n}function zq(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,n)=>{const i=im("GET",t,e);i.onreadystatechange=o=>{i.readyState===4&&(i.status===200||i.status===0?r(i.response):n({xhr:i,e:o}))},i.responseType="arraybuffer",i.send()})}function jq(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return n&&n.compression?kw():r.ref&&!r.ref.pending?new Promise((i,o)=>{const a=[e,r.ref.basepath,r.ref.id].join("/"),s=im("GET",a,n);s.onreadystatechange=c=>{s.readyState===1&&(r.ref.pending=!0,++z0===1&&t?.invokeBusy&&t.invokeBusy(!0)),s.readyState===4&&(r.ref.pending=!1,s.status===200||s.status===0?(r.buffer=s.response,r.ref.encode==="JSON"?r.values=JSON.parse(r.buffer):(O2.ENDIANNESS!==r.ref.encode&&O2.ENDIANNESS&&($q(`Swap bytes of ${r.name}`),O2.swapBytes(r.buffer,y4[r.dataType])),r.values=Z.newTypedArray(r.dataType,r.buffer)),r.values.length!==r.size&&qD(`Error in FetchArray: ${r.name}, does not have the proper array size. Got ${r.values.length}, instead of ${r.size}`),delete r.ref,--z0===0&&t?.invokeBusy&&t.invokeBusy(!1),t?.modified&&t.modified(),i(r)):o({xhr:s,e:c}))},s.responseType=r.dataType!=="string"?"arraybuffer":"text",s.send()}):Promise.resolve(r)}function Hq(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?kw():new Promise((n,i)=>{const o=im("GET",e,r);o.onreadystatechange=a=>{o.readyState===1&&++z0===1&&t?.invokeBusy&&t.invokeBusy(!0),o.readyState===4&&(--z0===0&&t?.invokeBusy&&t.invokeBusy(!1),o.status===200||o.status===0?n(JSON.parse(o.responseText)):i({xhr:o,e:a}))},o.responseType="text",o.send()})}function Xq(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?kw():new Promise((n,i)=>{const o=im("GET",e,r);o.onreadystatechange=a=>{o.readyState===1&&++z0===1&&t?.invokeBusy&&t.invokeBusy(!0),o.readyState===4&&(--z0===0&&t?.invokeBusy&&t.invokeBusy(!1),o.status===200||o.status===0?n(o.responseText):i({xhr:o,e:a}))},o.responseType="text",o.send()})}function Kq(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((n,i)=>{const o=new Image;r.crossOrigin&&(o.crossOrigin=r.crossOrigin),o.onload=()=>n(o),o.onerror=i,o.src=e})}const qq={fetchArray:jq,fetchJSON:Hq,fetchText:Xq,fetchBinary:zq,fetchImage:Kq};HD("http")||XD("http",t=>qq);var gp={exports:{}},Yq=gp.exports,XS;function Jq(){return XS||(XS=1,(function(t,e){(function(r,n){t.exports=n()})(Yq,(function(){return(function(r){var n={};function i(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return r[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=r,i.c=n,i.d=function(o,a,s){i.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:s})},i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.t=function(o,a){if(1&a&&(o=i(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var c in o)i.d(s,c,(function(l){return o[l]}).bind(null,c));return s},i.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(a,"a",a),a},i.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},i.p="",i(i.s=184)})([function(r,n,i){function o(a){for(var s in a)n.hasOwnProperty(s)||(n[s]=a[s])}Object.defineProperty(n,"__esModule",{value:!0}),o(i(240)),o(i(251)),o(i(175)),o(i(107)),o(i(29)),o(i(73)),o(i(106)),o(i(30)),o(i(252)),o(i(52)),o(i(97)),o(i(253)),o(i(37)),o(i(51)),o(i(173)),o(i(176)),o(i(172)),o(i(108)),o(i(254)),o(i(255)),o(i(256)),o(i(72)),o(i(177)),o(i(105)),o(i(17)),o(i(257)),o(i(12)),o(i(174))},function(r,n,i){var o=this&&this.__values||function(y){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&y[C],S=0;if(x)return x.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&S>=y.length&&(y=void 0),{value:y&&y[S++],done:!y}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(212);n.FixedSizeSet=a.FixedSizeSet;var s=i(213);n.ObjectCache=s.ObjectCache;var c=i(214);n.CompareCache=c.CompareCache;var l=i(215);n.Lazy=l.Lazy;var d=i(216);function u(y,C,x){if(w(y))y.forEach((function(T,_){return C.call(x,_,T)}));else for(var S in y)y.hasOwnProperty(S)&&C.call(x,S,y[S])}function f(y){var C,x;if(h(y))return y;if(p(y)){var S=[];try{for(var T=o(y),_=T.next();!_.done;_=T.next()){var E=_.value;S.push(f(E))}}catch(I){C={error:I}}finally{try{_&&!_.done&&(x=T.return)&&x.call(T)}finally{if(C)throw C.error}}return S}if(g(y)){S={};for(var D in y)if(y.hasOwnProperty(D)){var b=y[D];S[D]=f(b)}return S}return y}function h(y){return!!y&&Object.prototype.toString.call(y)==="[object Function]"}function g(y){var C=typeof y;return!!y&&(C==="function"||C==="object")}function p(y){return Array.isArray(y)}function v(y){return y instanceof Set}function w(y){return y instanceof Map}function m(y){if(g(y)){var C=Object.getPrototypeOf(y),x=C.constructor;return C&&x&&typeof x=="function"&&x instanceof x&&Function.prototype.toString.call(x)===Function.prototype.toString.call(Object)}return!1}n.StringWalker=d.StringWalker,n.applyMixin=function(y,C){for(var x=[],S=2;S<arguments.length;S++)x[S-2]=arguments[S];Object.getOwnPropertyNames(C.prototype).forEach((function(T){if(T!=="constructor"){if(x.indexOf(T)!==-1){var _=Object.getOwnPropertyDescriptor(y.prototype,T);_&&Object.defineProperty(y.prototype,"_"+T,_)}var E=Object.getOwnPropertyDescriptor(C.prototype,T);E&&Object.defineProperty(y.prototype,T,E)}}))},n.applyDefaults=function y(C,x,S){S===void 0&&(S=!1);var T=f(C||{});return u(x,(function(_,E){m(E)?T[_]=y(T[_],E,S):(S||T[_]===void 0)&&(T[_]=E)})),T},n.forEachArray=function(y,C,x){y.forEach(C,x)},n.forEachObject=u,n.arrayLength=function(y){return v(y)?y.size:y.length},n.objectLength=function(y){return w(y)?y.size:Object.keys(y).length},n.getObjectValue=function(y,C){return w(y)?y.get(C):y[C]},n.removeObjectValue=function(y,C){w(y)?y.delete(C):delete y[C]},n.clone=f,n.isBoolean=function(y){return typeof y=="boolean"},n.isNumber=function(y){return typeof y=="number"},n.isString=function(y){return typeof y=="string"},n.isFunction=h,n.isObject=g,n.isArray=p,n.isSet=v,n.isMap=w,n.isEmpty=function(y){if(p(y))return!y.length;if(v(y)||w(y))return!y.size;if(g(y)){for(var C in y)if(y.hasOwnProperty(C))return!1;return!0}return!1},n.isPlainObject=m,n.isIterable=function(y){return y&&typeof y[Symbol.iterator]=="function"},n.getValue=function(y){return h(y.valueOf)?y.valueOf():y},n.utf8Encode=function(y){for(var C=new Uint8Array(4*y.length),x=0,S=0;S<y.length;S++){var T=y.charCodeAt(S);if(T<128)C[x++]=T;else{if(T<2048)C[x++]=T>>6|192;else{if(T>55295&&T<56320){if(++S>=y.length)throw new Error("Incomplete surrogate pair.");var _=y.charCodeAt(S);if(_<56320||_>57343)throw new Error("Invalid surrogate character.");T=65536+((1023&T)<<10)+(1023&_),C[x++]=T>>18|240,C[x++]=T>>12&63|128}else C[x++]=T>>12|224;C[x++]=T>>6&63|128}C[x++]=63&T|128}}return C.subarray(0,x)},n.utf8Decode=function(y){for(var C="",x=0;x<y.length;){var S=y[x++];if(S>127)if(S>191&&S<224){if(x>=y.length)throw new Error("Incomplete 2-byte sequence.");S=(31&S)<<6|63&y[x++]}else if(S>223&&S<240){if(x+1>=y.length)throw new Error("Incomplete 3-byte sequence.");S=(15&S)<<12|(63&y[x++])<<6|63&y[x++]}else{if(!(S>239&&S<248))throw new Error("Unknown multi-byte start.");if(x+2>=y.length)throw new Error("Incomplete 4-byte sequence.");S=(7&S)<<18|(63&y[x++])<<12|(63&y[x++])<<6|63&y[x++]}if(S<=65535)C+=String.fromCharCode(S);else{if(!(S<=1114111))throw new Error("Code point exceeds UTF-16 limit.");S-=65536,C+=String.fromCharCode(S>>10|55296),C+=String.fromCharCode(1023&S|56320)}}return C}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),(function(o){o[o.Before=0]="Before",o[o.Equal=1]="Equal",o[o.After=2]="After"})(n.BoundaryPosition||(n.BoundaryPosition={})),(function(o){o[o.None=0]="None",o[o.Capturing=1]="Capturing",o[o.AtTarget=2]="AtTarget",o[o.Bubbling=3]="Bubbling"})(n.EventPhase||(n.EventPhase={})),(function(o){o[o.Element=1]="Element",o[o.Attribute=2]="Attribute",o[o.Text=3]="Text",o[o.CData=4]="CData",o[o.EntityReference=5]="EntityReference",o[o.Entity=6]="Entity",o[o.ProcessingInstruction=7]="ProcessingInstruction",o[o.Comment=8]="Comment",o[o.Document=9]="Document",o[o.DocumentType=10]="DocumentType",o[o.DocumentFragment=11]="DocumentFragment",o[o.Notation=12]="Notation"})(n.NodeType||(n.NodeType={})),(function(o){o[o.Disconnected=1]="Disconnected",o[o.Preceding=2]="Preceding",o[o.Following=4]="Following",o[o.Contains=8]="Contains",o[o.ContainedBy=16]="ContainedBy",o[o.ImplementationSpecific=32]="ImplementationSpecific"})(n.Position||(n.Position={})),(function(o){o[o.Accept=1]="Accept",o[o.Reject=2]="Reject",o[o.Skip=3]="Skip"})(n.FilterResult||(n.FilterResult={})),(function(o){o[o.All=4294967295]="All",o[o.Element=1]="Element",o[o.Attribute=2]="Attribute",o[o.Text=4]="Text",o[o.CDataSection=8]="CDataSection",o[o.EntityReference=16]="EntityReference",o[o.Entity=32]="Entity",o[o.ProcessingInstruction=64]="ProcessingInstruction",o[o.Comment=128]="Comment",o[o.Document=256]="Document",o[o.DocumentType=512]="DocumentType",o[o.DocumentFragment=1024]="DocumentFragment",o[o.Notation=2048]="Notation"})(n.WhatToShow||(n.WhatToShow={})),(function(o){o[o.StartToStart=0]="StartToStart",o[o.StartToEnd=1]="StartToEnd",o[o.EndToEnd=2]="EndToEnd",o[o.EndToStart=3]="EndToStart"})(n.HowToCompare||(n.HowToCompare={}))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(241);n.Cast=o.Cast;var a=i(150);n.Guard=a.Guard;var s=i(242);n.EmptySet=s.EmptySet},function(r,n,i){var o=i(11),a=i(55).f,s=i(21),c=i(25),l=i(80),d=i(119),u=i(123);r.exports=function(f,h){var g,p,v,w,m,y=f.target,C=f.global,x=f.stat;if(g=C?o:x?o[y]||l(y,{}):(o[y]||{}).prototype)for(p in h){if(w=h[p],v=f.noTargetGet?(m=a(g,p))&&m.value:g[p],!u(C?p:y+(x?".":"#")+p,f.forced)&&v!==void 0){if(typeof w==typeof v)continue;d(w,v)}(f.sham||v&&v.sham)&&s(w,"sham",!0),c(g,p,w,f)}}},function(r,n,i){var o=i(11),a=i(81),s=i(14),c=i(58),l=i(86),d=i(124),u=a("wks"),f=o.Symbol,h=d?f:f&&f.withoutSetter||c;r.exports=function(g){return s(u,g)||(l&&s(f,g)?u[g]=f[g]:u[g]=h("Symbol."+g)),u[g]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(1),a=i(29),s=(function(){function c(){this._features={mutationObservers:!0,customElements:!0,slots:!0,steps:!0},this._window=null,this._compareCache=new o.CompareCache,this._rangeList=new o.FixedSizeSet}return c.prototype.setFeatures=function(l){if(l===void 0&&(l=!0),o.isObject(l))for(var d in l)this._features[d]=l[d]||!1;else for(var d in this._features)this._features[d]=l},Object.defineProperty(c.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"window",{get:function(){return this._window===null&&(this._window=a.create_window()),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"compareCache",{get:function(){return this._compareCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rangeList",{get:function(){return this._rangeList},enumerable:!0,configurable:!0}),Object.defineProperty(c,"instance",{get:function(){return c._instance||(c._instance=new c),c._instance},enumerable:!0,configurable:!0}),c})();n.dom=s.instance},function(r,n,i){var o=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var y={};if(m!=null)for(var C in m)Object.hasOwnProperty.call(m,C)&&(y[C]=m[C]);return y.default=m,y};Object.defineProperty(n,"__esModule",{value:!0});var a=o(i(228));n.base64=a;var s=o(i(146));n.byte=s;var c=o(i(147));n.byteSequence=c;var l=o(i(96));n.codePoint=l;var d=o(i(232));n.json=d;var u=o(i(233));n.list=u;var f=o(i(234));n.map=f;var h=o(i(235));n.namespace=h;var g=o(i(236));n.queue=g;var p=o(i(237));n.set=p;var v=o(i(238));n.stack=v;var w=o(i(239));n.string=w},function(r,n){r.exports=function(i){try{return!!i()}catch{return!0}}},function(r,n,i){var o,a=this&&this.__extends||(o=function(k,L){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,j){F.__proto__=j}||function(F,j){for(var Y in j)j.hasOwnProperty(Y)&&(F[Y]=j[Y])})(k,L)},function(k,L){function F(){this.constructor=k}o(k,L),k.prototype=L===null?Object.create(L):(F.prototype=L.prototype,new F)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(k){function L(F,j){j===void 0&&(j="");var Y=k.call(this,j)||this;return Y.name=F,Y}return a(L,k),L})(Error);n.DOMException=s;var c=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"DOMStringSizeError",F)||this}return a(L,k),L})(s);n.DOMStringSizeError=c;var l=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"WrongDocumentError","The object is in the wrong document. "+F)||this}return a(L,k),L})(s);n.WrongDocumentError=l;var d=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NoDataAllowedError",F)||this}return a(L,k),L})(s);n.NoDataAllowedError=d;var u=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NoModificationAllowedError","The object can not be modified. "+F)||this}return a(L,k),L})(s);n.NoModificationAllowedError=u;var f=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NotSupportedError","The operation is not supported. "+F)||this}return a(L,k),L})(s);n.NotSupportedError=f;var h=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InUseAttributeError",F)||this}return a(L,k),L})(s);n.InUseAttributeError=h;var g=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidStateError","The object is in an invalid state. "+F)||this}return a(L,k),L})(s);n.InvalidStateError=g;var p=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidModificationError","The object can not be modified in this way. "+F)||this}return a(L,k),L})(s);n.InvalidModificationError=p;var v=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NamespaceError","The operation is not allowed by Namespaces in XML. [XMLNS] "+F)||this}return a(L,k),L})(s);n.NamespaceError=v;var w=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidAccessError","The object does not support the operation or argument. "+F)||this}return a(L,k),L})(s);n.InvalidAccessError=w;var m=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"ValidationError",F)||this}return a(L,k),L})(s);n.ValidationError=m;var y=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"TypeMismatchError",F)||this}return a(L,k),L})(s);n.TypeMismatchError=y;var C=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"SecurityError","The operation is insecure. "+F)||this}return a(L,k),L})(s);n.SecurityError=C;var x=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NetworkError","A network error occurred. "+F)||this}return a(L,k),L})(s);n.NetworkError=x;var S=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"AbortError","The operation was aborted. "+F)||this}return a(L,k),L})(s);n.AbortError=S;var T=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"URLMismatchError","The given URL does not match another URL. "+F)||this}return a(L,k),L})(s);n.URLMismatchError=T;var _=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"QuotaExceededError","The quota has been exceeded. "+F)||this}return a(L,k),L})(s);n.QuotaExceededError=_;var E=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"TimeoutError","The operation timed out. "+F)||this}return a(L,k),L})(s);n.TimeoutError=E;var D=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidNodeTypeError","The supplied node is incorrect or has an incorrect ancestor for this operation. "+F)||this}return a(L,k),L})(s);n.InvalidNodeTypeError=D;var b=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"DataCloneError","The object can not be cloned. "+F)||this}return a(L,k),L})(s);n.DataCloneError=b;var I=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NotImplementedError","The DOM method is not implemented by this module. "+F)||this}return a(L,k),L})(s);n.NotImplementedError=I;var O=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"HierarchyRequestError","The operation would yield an incorrect node tree. "+F)||this}return a(L,k),L})(s);n.HierarchyRequestError=O;var M=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"NotFoundError","The object can not be found here. "+F)||this}return a(L,k),L})(s);n.NotFoundError=M;var R=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"IndexSizeError","The index is not in the allowed range. "+F)||this}return a(L,k),L})(s);n.IndexSizeError=R;var A=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"SyntaxError","The string did not match the expected pattern. "+F)||this}return a(L,k),L})(s);n.SyntaxError=A;var G=(function(k){function L(F){return F===void 0&&(F=""),k.call(this,"InvalidCharacterError","The string contains invalid characters. "+F)||this}return a(L,k),L})(s);n.InvalidCharacterError=G},function(r,n,i){var o=i(53),a=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],s=["scalar","sequence","mapping"];r.exports=function(c,l){var d,u;if(l=l||{},Object.keys(l).forEach((function(f){if(a.indexOf(f)===-1)throw new o('Unknown option "'+f+'" is met in definition of "'+c+'" YAML type.')})),this.tag=c,this.kind=l.kind||null,this.resolve=l.resolve||function(){return!0},this.construct=l.construct||function(f){return f},this.instanceOf=l.instanceOf||null,this.predicate=l.predicate||null,this.represent=l.represent||null,this.defaultStyle=l.defaultStyle||null,this.styleAliases=(d=l.styleAliases||null,u={},d!==null&&Object.keys(d).forEach((function(f){d[f].forEach((function(h){u[String(h)]=f}))})),u),s.indexOf(this.kind)===-1)throw new o('Unknown kind "'+this.kind+'" is specified for "'+c+'" YAML type.')}},function(r,n,i){(function(o){var a=function(s){return s&&s.Math==Math&&s};r.exports=a(typeof globalThis=="object"&&globalThis)||a(typeof window=="object"&&window)||a(typeof self=="object"&&self)||a(typeof o=="object"&&o)||Function("return this")()}).call(this,i(78))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.idl_defineConst=function(o,a,s){Object.defineProperty(o,a,{writable:!1,enumerable:!0,configurable:!1,value:s})}},function(r,n){r.exports=function(i){return typeof i=="object"?i!==null:typeof i=="function"}},function(r,n){var i={}.hasOwnProperty;r.exports=function(o,a){return i.call(o,a)}},function(r,n,i){var o=i(16),a=i(115),s=i(18),c=i(56),l=Object.defineProperty;n.f=o?l:function(d,u,f){if(s(d),u=c(u,!0),s(f),a)try{return l(d,u,f)}catch{}if("get"in f||"set"in f)throw TypeError("Accessors not supported");return"value"in f&&(d[u]=f.value),d}},function(r,n,i){var o=i(8);r.exports=!o((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}))},function(r,n,i){var o=this&&this.__values||function(y){var C=typeof Symbol=="function"&&Symbol.iterator,x=C&&y[C],S=0;if(x)return x.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&S>=y.length&&(y=void 0),{value:y&&y[S++],done:!y}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(3),s=i(2);function c(y,C,x){if(x===void 0&&(x=!1),x&&a.Guard.isElementNode(C)&&a.Guard.isShadowRoot(C.shadowRoot)&&C.shadowRoot._firstChild)return C.shadowRoot._firstChild;if(C._firstChild)return C._firstChild;if(C===y)return null;if(C._nextSibling)return C._nextSibling;for(var S=C._parent;S&&S!==y;){if(S._nextSibling)return S._nextSibling;S=S._parent}return null}function l(){var y;return(y={})[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:null}}}},y}function d(y,C,x,S){C===void 0&&(C=!1),x===void 0&&(x=!1);for(var T=C?y:c(y,y,x);T&&S&&!S(T);)T=c(y,T,x);return T}function u(y,C,x,S,T){S===void 0&&(S=!1);for(var _=c(y,C,S);_&&T&&!T(_);)_=c(y,_,S);return _}function f(y,C,x,S){var T;return C===void 0&&(C=!1),x===void 0&&(x=!1),C||y._children.size!==0?((T={})[Symbol.iterator]=function(){var _=C?y:c(y,y,x);return{next:function(){for(;_&&S&&!S(_);)_=c(y,_,x);if(_===null)return{done:!0,value:null};var E={done:!1,value:_};return _=c(y,_,x),E}}},T):l()}function h(y,C,x){C===void 0&&(C=!1);for(var S=C?y:y._parent;S&&x&&!x(S);)S=S._parent;return S}function g(y,C,x,S){for(var T=C._parent;T&&S&&!S(T);)T=T._parent;return T}function p(y){return a.Guard.isDocumentTypeNode(y)?0:a.Guard.isCharacterDataNode(y)?y._data.length:y._children.size}function v(y,C){if(C===void 0&&(C=!1),C){var x=v(y,!1);return a.Guard.isShadowRoot(x)?v(x._host,!0):x}return y._parent?v(y._parent):y}function w(y,C,x,S){x===void 0&&(x=!1),S===void 0&&(S=!1);for(var T=x?y:S&&a.Guard.isShadowRoot(y)?y._host:y._parent;T!==null;){if(T===C)return!0;T=S&&a.Guard.isShadowRoot(T)?T._host:T._parent}return!1}function m(y){for(var C=v(y),x=0,S=d(C);S!==null;){if(x++,S===y)return x;S=u(C,S)}return-1}n.tree_getFirstDescendantNode=d,n.tree_getNextDescendantNode=u,n.tree_getDescendantNodes=f,n.tree_getDescendantElements=function(y,C,x,S){var T;return C===void 0&&(C=!1),x===void 0&&(x=!1),C||y._children.size!==0?((T={})[Symbol.iterator]=function(){var _=f(y,C,x,(function(D){return a.Guard.isElementNode(D)}))[Symbol.iterator](),E=_.next().value;return{next:function(){for(;E&&S&&!S(E);)E=_.next().value;if(E===null)return{done:!0,value:null};var D={done:!1,value:E};return E=_.next().value,D}}},T):l()},n.tree_getSiblingNodes=function(y,C,x){var S;return C===void 0&&(C=!1),y._parent&&y._parent._children.size!==0?((S={})[Symbol.iterator]=function(){var T=y._parent?y._parent._firstChild:null;return{next:function(){for(;T&&(x&&!x(T)||!C&&T===y);)T=T._nextSibling;if(T===null)return{done:!0,value:null};var _={done:!1,value:T};return T=T._nextSibling,_}}},S):l()},n.tree_getFirstAncestorNode=h,n.tree_getNextAncestorNode=g,n.tree_getAncestorNodes=function(y,C,x){var S;return C===void 0&&(C=!1),C||y._parent?((S={})[Symbol.iterator]=function(){var T=h(y,C,x);return{next:function(){if(T===null)return{done:!0,value:null};var _={done:!1,value:T};return T=g(0,T,C,x),_}}},S):l()},n.tree_getCommonAncestor=function(y,C){if(y===C)return y._parent;for(var x=[],S=[],T=h(y,!0);T!==null;)x.push(T),T=g(0,T);for(var _=h(C,!0);_!==null;)S.push(_),_=g(0,_);for(var E=x.length,D=S.length,b=null,I=Math.min(E,D);I>0;I--){var O=x[--E];if(O!==S[--D])break;b=O}return b},n.tree_getFollowingNode=function(y,C){if(C._firstChild)return C._firstChild;if(C._nextSibling)return C._nextSibling;for(;;){var x=C._parent;if(x===null||x===y)return null;if(x._nextSibling)return x._nextSibling;C=x}},n.tree_getPrecedingNode=function(y,C){return C===y?null:C._previousSibling?(C=C._previousSibling)._lastChild?C._lastChild:C:C._parent},n.tree_isConstrained=function y(C){var x,S,T,_,E,D;switch(C._nodeType){case s.NodeType.Document:var b=!1,I=!1;try{for(var O=o(C._children),M=O.next();!M.done;M=O.next())switch(M.value._nodeType){case s.NodeType.ProcessingInstruction:case s.NodeType.Comment:break;case s.NodeType.DocumentType:if(b||I)return!1;b=!0;break;case s.NodeType.Element:if(I)return!1;I=!0;break;default:return!1}}catch(L){x={error:L}}finally{try{M&&!M.done&&(S=O.return)&&S.call(O)}finally{if(x)throw x.error}}break;case s.NodeType.DocumentFragment:case s.NodeType.Element:try{for(var R=o(C._children),A=R.next();!A.done;A=R.next())switch(A.value._nodeType){case s.NodeType.Element:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:break;default:return!1}}catch(L){T={error:L}}finally{try{A&&!A.done&&(_=R.return)&&_.call(R)}finally{if(T)throw T.error}}break;case s.NodeType.DocumentType:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:return!C.hasChildNodes()}try{for(var G=o(C._children),k=G.next();!k.done;k=G.next())if(!y(k.value))return!1}catch(L){E={error:L}}finally{try{k&&!k.done&&(D=G.return)&&D.call(G)}finally{if(E)throw E.error}}return!0},n.tree_nodeLength=p,n.tree_isEmpty=function(y){return p(y)===0},n.tree_rootNode=v,n.tree_isDescendantOf=function(y,C,x,S){x===void 0&&(x=!1),S===void 0&&(S=!1);for(var T=d(y,x,S);T!==null;){if(T===C)return!0;T=u(y,T,x,S)}return!1},n.tree_isAncestorOf=w,n.tree_isHostIncludingAncestorOf=function y(C,x,S){if(S===void 0&&(S=!1),w(C,x,S))return!0;var T=v(C);return!(!a.Guard.isDocumentFragmentNode(T)||T._host===null||!y(T._host,x,S))},n.tree_isSiblingOf=function(y,C,x){return x===void 0&&(x=!1),y!==C?y._parent!==null&&y._parent===C._parent:!!x},n.tree_isPreceding=function(y,C){var x=m(y),S=m(C);return x!==-1&&S!==-1&&v(y)===v(C)&&S<x},n.tree_isFollowing=function(y,C){var x=m(y),S=m(C);return x!==-1&&S!==-1&&v(y)===v(C)&&S>x},n.tree_isParentOf=function(y,C){return y._parent===C},n.tree_isChildOf=function(y,C){return C._parent===y},n.tree_previousSibling=function(y){return y._previousSibling},n.tree_nextSibling=function(y){return y._nextSibling},n.tree_firstChild=function(y){return y._firstChild},n.tree_lastChild=function(y){return y._lastChild},n.tree_treePosition=m,n.tree_index=function(y){for(var C=0;y._previousSibling!==null;)C++,y=y._previousSibling;return C},n.tree_retarget=function(y,C){for(;;){if(!y||!a.Guard.isNode(y))return y;var x=v(y);if(!a.Guard.isShadowRoot(x)||C&&a.Guard.isNode(C)&&w(x,C,!0,!0))return y;y=x.host}}},function(r,n,i){var o=i(13);r.exports=function(a){if(!o(a))throw TypeError(String(a)+" is not an object");return a}},function(r,n,i){var o=i(24),a=i(130),s=i(49),c=i(43),l=i(88),d=c.set,u=c.getterFor("Array Iterator");r.exports=l(Array,"Array",(function(f,h){d(this,{type:"Array Iterator",target:o(f),index:0,kind:h})}),(function(){var f=u(this),h=f.target,g=f.kind,p=f.index++;return!h||p>=h.length?(f.target=void 0,{value:void 0,done:!0}):g=="keys"?{value:p,done:!1}:g=="values"?{value:h[p],done:!1}:{value:[p,h[p]],done:!1}}),"values"),s.Arguments=s.Array,a("keys"),a("values"),a("entries")},function(r,n,i){var o=i(90),a=i(25),s=i(202);o||a(Object.prototype,"toString",s,{unsafe:!0})},function(r,n,i){var o=i(16),a=i(15),s=i(40);r.exports=o?function(c,l,d){return a.f(c,l,s(1,d))}:function(c,l,d){return c[l]=d,c}},function(r,n,i){var o=i(137).charAt,a=i(43),s=i(88),c=a.set,l=a.getterFor("String Iterator");s(String,"String",(function(d){c(this,{type:"String Iterator",string:String(d),index:0})}),(function(){var d,u=l(this),f=u.string,h=u.index;return h>=f.length?{value:void 0,done:!0}:(d=o(f,h),u.index+=d.length,{value:d,done:!1})}))},function(r,n,i){var o=i(11),a=i(203),s=i(19),c=i(21),l=i(5),d=l("iterator"),u=l("toStringTag"),f=s.values;for(var h in a){var g=o[h],p=g&&g.prototype;if(p){if(p[d]!==f)try{c(p,d,f)}catch{p[d]=f}if(p[u]||c(p,u,h),a[h]){for(var v in s)if(p[v]!==s[v])try{c(p,v,s[v])}catch{p[v]=s[v]}}}}},function(r,n,i){var o=i(41),a=i(35);r.exports=function(s){return o(a(s))}},function(r,n,i){var o=i(11),a=i(21),s=i(14),c=i(80),l=i(117),d=i(43),u=d.get,f=d.enforce,h=String(String).split("String");(r.exports=function(g,p,v,w){var m=!!w&&!!w.unsafe,y=!!w&&!!w.enumerable,C=!!w&&!!w.noTargetGet;typeof v=="function"&&(typeof p!="string"||s(v,"name")||a(v,"name",p),f(v).source=h.join(typeof p=="string"?p:"")),g!==o?(m?!C&&g[p]&&(y=!0):delete g[p],y?g[p]=v:a(g,p,v)):y?g[p]=v:c(p,v)})(Function.prototype,"toString",(function(){return typeof this=="function"&&u(this).source||l(this)}))},function(r,n,i){var o=i(47),a=Math.min;r.exports=function(s){return s>0?a(o(s),9007199254740991):0}},function(r,n,i){var o=i(35);r.exports=function(a){return Object(o(a))}},function(r,n,i){var o=i(16),a=i(8),s=i(14),c=Object.defineProperty,l={},d=function(u){throw u};r.exports=function(u,f){if(s(l,u))return l[u];f||(f={});var h=[][u],g=!!s(f,"ACCESSORS")&&f.ACCESSORS,p=s(f,0)?f[0]:d,v=s(f,1)?f[1]:void 0;return l[u]=!!h&&!a((function(){if(g&&!o)return!0;var w={length:-1};g?c(w,1,{enumerable:!0,get:d}):w[1]=1,h.call(w,p,v)}))}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(148),a=i(149),s=i(151),c=i(98),l=i(153),d=i(154),u=i(155),f=i(99),h=i(100),g=i(156),p=i(157),v=i(101),w=i(158),m=i(159),y=i(160),C=i(161),x=i(162),S=i(163),T=i(164),_=i(165),E=i(166),D=i(167),b=i(168),I=i(169),O=i(170);n.create_domImplementation=function(M){return o.DOMImplementationImpl._create(M)},n.create_window=function(){return a.WindowImpl._create()},n.create_xmlDocument=function(){return new s.XMLDocumentImpl},n.create_document=function(){return new c.DocumentImpl},n.create_abortController=function(){return new l.AbortControllerImpl},n.create_abortSignal=function(){return d.AbortSignalImpl._create()},n.create_documentType=function(M,R,A,G){return u.DocumentTypeImpl._create(M,R,A,G)},n.create_element=function(M,R,A,G){return f.ElementImpl._create(M,R,A,G)},n.create_htmlElement=function(M,R,A,G){return f.ElementImpl._create(M,R,A,G)},n.create_htmlUnknownElement=function(M,R,A,G){return f.ElementImpl._create(M,R,A,G)},n.create_documentFragment=function(M){return h.DocumentFragmentImpl._create(M)},n.create_shadowRoot=function(M,R){return g.ShadowRootImpl._create(M,R)},n.create_attr=function(M,R){return p.AttrImpl._create(M,R)},n.create_text=function(M,R){return v.TextImpl._create(M,R)},n.create_cdataSection=function(M,R){return w.CDATASectionImpl._create(M,R)},n.create_comment=function(M,R){return m.CommentImpl._create(M,R)},n.create_processingInstruction=function(M,R,A){return y.ProcessingInstructionImpl._create(M,R,A)},n.create_htmlCollection=function(M,R){return R===void 0&&(R=function(){return!0}),C.HTMLCollectionImpl._create(M,R)},n.create_nodeList=function(M){return x.NodeListImpl._create(M)},n.create_nodeListStatic=function(M,R){return S.NodeListStaticImpl._create(M,R)},n.create_namedNodeMap=function(M){return T.NamedNodeMapImpl._create(M)},n.create_range=function(M,R){return _.RangeImpl._create(M,R)},n.create_nodeIterator=function(M,R,A){return E.NodeIteratorImpl._create(M,R,A)},n.create_treeWalker=function(M,R){return D.TreeWalkerImpl._create(M,R)},n.create_nodeFilter=function(){return b.NodeFilterImpl._create()},n.create_mutationRecord=function(M,R,A,G,k,L,F,j,Y){return I.MutationRecordImpl._create(M,R,A,G,k,L,F,j,Y)},n.create_domTokenList=function(M,R){return O.DOMTokenListImpl._create(M,R)}},function(r,n,i){var o=this&&this.__values||function(p){var v=typeof Symbol=="function"&&Symbol.iterator,w=v&&p[v],m=0;if(w)return w.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&m>=p.length&&(p=void 0),{value:p&&p[m++],done:!p}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(17),c=i(3),l=i(72),d=new Map;function u(p,v){if(v!==p._root&&s.tree_isAncestorOf(p._reference,v,!0)){if(p._pointerBeforeReference)for(;;){var w=s.tree_getFollowingNode(p._root,v);if(w!==null&&s.tree_isDescendantOf(p._root,w,!0)&&!s.tree_isDescendantOf(v,w,!0))return void(p._reference=w);if(w===null)return void(p._pointerBeforeReference=!1)}if(v._previousSibling===null)v._parent!==null&&(p._reference=v._parent);else{for(var m=v._previousSibling,y=s.tree_getFirstDescendantNode(v._previousSibling,!0,!1);y!==null;)y!==null&&(m=y),y=s.tree_getNextDescendantNode(v._previousSibling,y,!0,!1);p._reference=m}}}function f(p,v,w,m,y){if(c.Guard.isSlot(p)&&v==="name"&&y===null){if(m===w||m===null&&w===""||m===""&&w===null)return;p._name=m===null||m===""?"":m,l.shadowTree_assignSlotablesForATree(s.tree_rootNode(p))}}function h(p,v,w,m,y){if(c.Guard.isSlotable(p)&&v==="slot"&&y===null){if(m===w||m===null&&w===""||m===""&&w===null)return;p._name=m===null||m===""?"":m,l.shadowTree_isAssigned(p)&&l.shadowTree_assignSlotables(p._assignedSlot),l.shadowTree_assignASlot(p)}}function g(p,v,w,m){v==="id"&&m===null&&(p._uniqueIdentifier=w||void 0)}n.dom_runRemovingSteps=function(p,v){},n.dom_runCloningSteps=function(p,v,w,m){},n.dom_runAdoptingSteps=function(p,v){},n.dom_runAttributeChangeSteps=function(p,v,w,m,y){var C,x;a.dom.features.slots&&(h.call(p,p,v,w,m,y),f.call(p,p,v,w,m,y)),g.call(p,p,v,m,y);try{for(var S=o(p._attributeChangeSteps),T=S.next();!T.done;T=S.next())T.value.call(p,p,v,w,m,y)}catch(_){C={error:_}}finally{try{T&&!T.done&&(x=S.return)&&x.call(S)}finally{if(C)throw C.error}}},n.dom_runInsertionSteps=function(p){},n.dom_runNodeIteratorPreRemovingSteps=function(p,v){u.call(p,p,v)},n.dom_hasSupportedTokens=function(p){return d.has(p)},n.dom_getSupportedTokens=function(p){return d.get(p)||new Set},n.dom_runEventConstructingSteps=function(p){},n.dom_runChildTextContentChangeSteps=function(p){}},function(r,n,i){var o=i(4),a=i(11),s=i(46),c=i(44),l=i(16),d=i(86),u=i(124),f=i(8),h=i(14),g=i(59),p=i(13),v=i(18),w=i(27),m=i(24),y=i(56),C=i(40),x=i(60),S=i(61),T=i(82),_=i(190),E=i(85),D=i(55),b=i(15),I=i(79),O=i(21),M=i(25),R=i(81),A=i(57),G=i(45),k=i(58),L=i(5),F=i(125),j=i(126),Y=i(62),ie=i(43),de=i(36).forEach,ae=A("hidden"),fe=L("toPrimitive"),we=ie.set,_e=ie.getterFor("Symbol"),Se=Object.prototype,B=a.Symbol,P=s("JSON","stringify"),$=D.f,W=b.f,K=_.f,Q=I.f,ee=R("symbols"),ge=R("op-symbols"),De=R("string-to-symbol-registry"),Le=R("symbol-to-string-registry"),Ge=R("wks"),re=a.QObject,se=!re||!re.prototype||!re.prototype.findChild,ve=l&&f((function(){return x(W({},"a",{get:function(){return W(this,"a",{value:7}).a}})).a!=7}))?function(ze,Ke,Je){var lt=$(Se,Ke);lt&&delete Se[Ke],W(ze,Ke,Je),lt&&ze!==Se&&W(Se,Ke,lt)}:W,le=function(ze,Ke){var Je=ee[ze]=x(B.prototype);return we(Je,{type:"Symbol",tag:ze,description:Ke}),l||(Je.description=Ke),Je},pe=u?function(ze){return typeof ze=="symbol"}:function(ze){return Object(ze)instanceof B},We=function(ze,Ke,Je){ze===Se&&We(ge,Ke,Je),v(ze);var lt=y(Ke,!0);return v(Je),h(ee,lt)?(Je.enumerable?(h(ze,ae)&&ze[ae][lt]&&(ze[ae][lt]=!1),Je=x(Je,{enumerable:C(0,!1)})):(h(ze,ae)||W(ze,ae,C(1,{})),ze[ae][lt]=!0),ve(ze,lt,Je)):W(ze,lt,Je)},oe=function(ze,Ke){v(ze);var Je=m(Ke),lt=S(Je).concat(Ee(Je));return de(lt,(function(Oe){l&&!st.call(Je,Oe)||We(ze,Oe,Je[Oe])})),ze},st=function(ze){var Ke=y(ze,!0),Je=Q.call(this,Ke);return!(this===Se&&h(ee,Ke)&&!h(ge,Ke))&&(!(Je||!h(this,Ke)||!h(ee,Ke)||h(this,ae)&&this[ae][Ke])||Je)},gt=function(ze,Ke){var Je=m(ze),lt=y(Ke,!0);if(Je!==Se||!h(ee,lt)||h(ge,lt)){var Oe=$(Je,lt);return!Oe||!h(ee,lt)||h(Je,ae)&&Je[ae][lt]||(Oe.enumerable=!0),Oe}},ct=function(ze){var Ke=K(m(ze)),Je=[];return de(Ke,(function(lt){h(ee,lt)||h(G,lt)||Je.push(lt)})),Je},Ee=function(ze){var Ke=ze===Se,Je=K(Ke?ge:m(ze)),lt=[];return de(Je,(function(Oe){!h(ee,Oe)||Ke&&!h(Se,Oe)||lt.push(ee[Oe])})),lt};d||(M((B=function(){if(this instanceof B)throw TypeError("Symbol is not a constructor");var ze=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,Ke=k(ze),Je=function(lt){this===Se&&Je.call(ge,lt),h(this,ae)&&h(this[ae],Ke)&&(this[ae][Ke]=!1),ve(this,Ke,C(1,lt))};return l&&se&&ve(Se,Ke,{configurable:!0,set:Je}),le(Ke,ze)}).prototype,"toString",(function(){return _e(this).tag})),M(B,"withoutSetter",(function(ze){return le(k(ze),ze)})),I.f=st,b.f=We,D.f=gt,T.f=_.f=ct,E.f=Ee,F.f=function(ze){return le(L(ze),ze)},l&&(W(B.prototype,"description",{configurable:!0,get:function(){return _e(this).description}}),c||M(Se,"propertyIsEnumerable",st,{unsafe:!0}))),o({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:B}),de(S(Ge),(function(ze){j(ze)})),o({target:"Symbol",stat:!0,forced:!d},{for:function(ze){var Ke=String(ze);if(h(De,Ke))return De[Ke];var Je=B(Ke);return De[Ke]=Je,Le[Je]=Ke,Je},keyFor:function(ze){if(!pe(ze))throw TypeError(ze+" is not a symbol");if(h(Le,ze))return Le[ze]},useSetter:function(){se=!0},useSimple:function(){se=!1}}),o({target:"Object",stat:!0,forced:!d,sham:!l},{create:function(ze,Ke){return Ke===void 0?x(ze):oe(x(ze),Ke)},defineProperty:We,defineProperties:oe,getOwnPropertyDescriptor:gt}),o({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:ct,getOwnPropertySymbols:Ee}),o({target:"Object",stat:!0,forced:f((function(){E.f(1)}))},{getOwnPropertySymbols:function(ze){return E.f(w(ze))}}),P&&o({target:"JSON",stat:!0,forced:!d||f((function(){var ze=B();return P([ze])!="[null]"||P({a:ze})!="{}"||P(Object(ze))!="{}"}))},{stringify:function(ze,Ke,Je){for(var lt,Oe=[ze],ke=1;arguments.length>ke;)Oe.push(arguments[ke++]);if(lt=Ke,(p(Ke)||ze!==void 0)&&!pe(ze))return g(Ke)||(Ke=function(nt,wt){if(typeof lt=="function"&&(wt=lt.call(this,nt,wt)),!pe(wt))return wt}),Oe[1]=Ke,P.apply(null,Oe)}}),B.prototype[fe]||O(B.prototype,fe,B.prototype.valueOf),Y(B,"Symbol"),G[ae]=!0},function(r,n,i){var o=i(4),a=i(16),s=i(11),c=i(14),l=i(13),d=i(15).f,u=i(119),f=s.Symbol;if(a&&typeof f=="function"&&(!("description"in f.prototype)||f().description!==void 0)){var h={},g=function(){var y=arguments.length<1||arguments[0]===void 0?void 0:String(arguments[0]),C=this instanceof g?new f(y):y===void 0?f():f(y);return y===""&&(h[C]=!0),C};u(g,f);var p=g.prototype=f.prototype;p.constructor=g;var v=p.toString,w=String(f("test"))=="Symbol(test)",m=/^Symbol\((.*)\)[^)]+$/;d(p,"description",{configurable:!0,get:function(){var y=l(this)?this.valueOf():this,C=v.call(y);if(c(h,y))return"";var x=w?C.slice(7,-1):C.replace(m,"$1");return x===""?void 0:x}}),o({global:!0,forced:!0},{Symbol:g})}},function(r,n,i){i(126)("iterator")},function(r,n,i){var o,a=this&&this.__extends||(o=function(w,m){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,C){y.__proto__=C}||function(y,C){for(var x in C)C.hasOwnProperty(x)&&(y[x]=C[x])})(w,m)},function(w,m){function y(){this.constructor=w}o(w,m),w.prototype=m===null?Object.create(m):(y.prototype=m.prototype,new y)}),s=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),d=i(70),u=i(3),f=i(9),h=i(0),g=i(152),p=i(12),v=(function(w){function m(){var y=w.call(this)||this;return y._parent=null,y._firstChild=null,y._lastChild=null,y._previousSibling=null,y._nextSibling=null,y}return a(m,w),Object.defineProperty(m.prototype,"_childNodes",{get:function(){return this.__childNodes||(this.__childNodes=h.create_nodeList(this))},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverride||c.dom.window._associatedDocument},set:function(y){this._nodeDocumentOverride=y},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_registeredObserverList",{get:function(){return this.__registeredObserverList||(this.__registeredObserverList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nodeName",{get:function(){return u.Guard.isElementNode(this)?this._htmlUppercasedQualifiedName:u.Guard.isAttrNode(this)?this._qualifiedName:u.Guard.isExclusiveTextNode(this)?"#text":u.Guard.isCDATASectionNode(this)?"#cdata-section":u.Guard.isProcessingInstructionNode(this)?this._target:u.Guard.isCommentNode(this)?"#comment":u.Guard.isDocumentNode(this)?"#document":u.Guard.isDocumentTypeNode(this)?this._name:u.Guard.isDocumentFragmentNode(this)?"#document-fragment":""},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"baseURI",{get:function(){return g.urlSerializer(this._nodeDocument._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isConnected",{get:function(){return u.Guard.isElementNode(this)&&h.shadowTree_isConnected(this)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"ownerDocument",{get:function(){return this._nodeType===l.NodeType.Document?null:this._nodeDocument},enumerable:!0,configurable:!0}),m.prototype.getRootNode=function(y){return h.tree_rootNode(this,!!y&&y.composed)},Object.defineProperty(m.prototype,"parentNode",{get:function(){return this._nodeType===l.NodeType.Attribute?null:this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"parentElement",{get:function(){return this._parent&&u.Guard.isElementNode(this._parent)?this._parent:null},enumerable:!0,configurable:!0}),m.prototype.hasChildNodes=function(){return this._firstChild!==null},Object.defineProperty(m.prototype,"childNodes",{get:function(){return this._childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nodeValue",{get:function(){return u.Guard.isAttrNode(this)?this._value:u.Guard.isCharacterDataNode(this)?this._data:null},set:function(y){y===null&&(y=""),u.Guard.isAttrNode(this)?h.attr_setAnExistingAttributeValue(this,y):u.Guard.isCharacterDataNode(this)&&h.characterData_replaceData(this,0,this._data.length,y)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"textContent",{get:function(){return u.Guard.isDocumentFragmentNode(this)||u.Guard.isElementNode(this)?h.text_descendantTextContent(this):u.Guard.isAttrNode(this)?this._value:u.Guard.isCharacterDataNode(this)?this._data:null},set:function(y){y===null&&(y=""),u.Guard.isDocumentFragmentNode(this)||u.Guard.isElementNode(this)?h.node_stringReplaceAll(y,this):u.Guard.isAttrNode(this)?h.attr_setAnExistingAttributeValue(this,y):u.Guard.isCharacterDataNode(this)&&h.characterData_replaceData(this,0,h.tree_nodeLength(this),y)},enumerable:!0,configurable:!0}),m.prototype.normalize=function(){for(var y,C,x,S,T=[],_=h.tree_getFirstDescendantNode(this,!1,!1,(function(de){return u.Guard.isExclusiveTextNode(de)}));_!==null;)T.push(_),_=h.tree_getNextDescendantNode(this,_,!1,!1,(function(de){return u.Guard.isExclusiveTextNode(de)}));for(var E=0;E<T.length;E++){var D=T[E];if(D._parent!==null){var b=h.tree_nodeLength(D);if(b!==0){var I=[],O="";try{for(var M=(y=void 0,s(h.text_contiguousExclusiveTextNodes(D))),R=M.next();!R.done;R=M.next()){var A=R.value;I.push(A),O+=A._data}}catch(de){y={error:de}}finally{try{R&&!R.done&&(C=M.return)&&C.call(M)}finally{if(y)throw y.error}}if(h.characterData_replaceData(D,b,0,O),c.dom.rangeList.size!==0)for(var G=D._nextSibling;G!==null&&u.Guard.isExclusiveTextNode(G);){var k=G,L=h.tree_index(k);try{for(var F=(x=void 0,s(c.dom.rangeList)),j=F.next();!j.done;j=F.next()){var Y=j.value;Y._start[0]===k&&(Y._start[0]=D,Y._start[1]+=b),Y._end[0]===k&&(Y._end[0]=D,Y._end[1]+=b),Y._start[0]===k._parent&&Y._start[1]===L&&(Y._start[0]=D,Y._start[1]=b),Y._end[0]===k._parent&&Y._end[1]===L&&(Y._end[0]=D,Y._end[1]=b)}}catch(de){x={error:de}}finally{try{j&&!j.done&&(S=F.return)&&S.call(F)}finally{if(x)throw x.error}}b+=h.tree_nodeLength(G),G=G._nextSibling}for(var ie=0;ie<I.length;ie++)(A=I[ie])._parent!==null&&h.mutation_remove(A,A._parent)}else h.mutation_remove(D,D._parent)}}},m.prototype.cloneNode=function(y){if(y===void 0&&(y=!1),u.Guard.isShadowRoot(this))throw new f.NotSupportedError;return h.node_clone(this,null,y)},m.prototype.isEqualNode=function(y){return y===void 0&&(y=null),y!==null&&h.node_equals(this,y)},m.prototype.isSameNode=function(y){return y===void 0&&(y=null),this===y},m.prototype.compareDocumentPosition=function(y){if(y===this)return 0;var C=y,x=this,S=null,T=null;if(u.Guard.isAttrNode(C)&&(C=(S=C)._element),u.Guard.isAttrNode(x)&&(x=(T=x)._element,S&&C&&C===x))for(var _=0;_<x._attributeList.length;_++){var E=x._attributeList[_];if(h.node_equals(E,S))return l.Position.ImplementationSpecific|l.Position.Preceding;if(h.node_equals(E,T))return l.Position.ImplementationSpecific|l.Position.Following}return C===null||x===null||h.tree_rootNode(C)!==h.tree_rootNode(x)?l.Position.Disconnected|l.Position.ImplementationSpecific|(c.dom.compareCache.check(this,y)?l.Position.Preceding:l.Position.Following):!S&&h.tree_isAncestorOf(x,C)||T&&C===x?l.Position.Contains|l.Position.Preceding:!T&&h.tree_isDescendantOf(x,C)||S&&C===x?l.Position.ContainedBy|l.Position.Following:h.tree_isPreceding(x,C)?l.Position.Preceding:l.Position.Following},m.prototype.contains=function(y){return y!==null&&h.tree_isDescendantOf(this,y,!0)},m.prototype.lookupPrefix=function(y){return y?u.Guard.isElementNode(this)?h.node_locateANamespacePrefix(this,y):u.Guard.isDocumentNode(this)?this.documentElement===null?null:h.node_locateANamespacePrefix(this.documentElement,y):u.Guard.isDocumentTypeNode(this)||u.Guard.isDocumentFragmentNode(this)?null:u.Guard.isAttrNode(this)?this._element===null?null:h.node_locateANamespacePrefix(this._element,y):this._parent!==null&&u.Guard.isElementNode(this._parent)?h.node_locateANamespacePrefix(this._parent,y):null:null},m.prototype.lookupNamespaceURI=function(y){return h.node_locateANamespace(this,y||null)},m.prototype.isDefaultNamespace=function(y){return y||(y=null),h.node_locateANamespace(this,null)===y},m.prototype.insertBefore=function(y,C){return h.mutation_preInsert(y,this,C)},m.prototype.appendChild=function(y){return h.mutation_append(y,this)},m.prototype.replaceChild=function(y,C){return h.mutation_replace(C,y,this)},m.prototype.removeChild=function(y){return h.mutation_preRemove(y,this)},m.prototype._getTheParent=function(y){return u.Guard.isSlotable(this)&&h.shadowTree_isAssigned(this)?this._assignedSlot:this._parent},m.ELEMENT_NODE=1,m.ATTRIBUTE_NODE=2,m.TEXT_NODE=3,m.CDATA_SECTION_NODE=4,m.ENTITY_REFERENCE_NODE=5,m.ENTITY_NODE=6,m.PROCESSING_INSTRUCTION_NODE=7,m.COMMENT_NODE=8,m.DOCUMENT_NODE=9,m.DOCUMENT_TYPE_NODE=10,m.DOCUMENT_FRAGMENT_NODE=11,m.NOTATION_NODE=12,m.DOCUMENT_POSITION_DISCONNECTED=1,m.DOCUMENT_POSITION_PRECEDING=2,m.DOCUMENT_POSITION_FOLLOWING=4,m.DOCUMENT_POSITION_CONTAINS=8,m.DOCUMENT_POSITION_CONTAINED_BY=16,m.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,m})(d.EventTargetImpl);n.NodeImpl=v,v.prototype._children=new u.EmptySet,p.idl_defineConst(v.prototype,"ELEMENT_NODE",1),p.idl_defineConst(v.prototype,"ATTRIBUTE_NODE",2),p.idl_defineConst(v.prototype,"TEXT_NODE",3),p.idl_defineConst(v.prototype,"CDATA_SECTION_NODE",4),p.idl_defineConst(v.prototype,"ENTITY_REFERENCE_NODE",5),p.idl_defineConst(v.prototype,"ENTITY_NODE",6),p.idl_defineConst(v.prototype,"PROCESSING_INSTRUCTION_NODE",7),p.idl_defineConst(v.prototype,"COMMENT_NODE",8),p.idl_defineConst(v.prototype,"DOCUMENT_NODE",9),p.idl_defineConst(v.prototype,"DOCUMENT_TYPE_NODE",10),p.idl_defineConst(v.prototype,"DOCUMENT_FRAGMENT_NODE",11),p.idl_defineConst(v.prototype,"NOTATION_NODE",12),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_DISCONNECTED",1),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_PRECEDING",2),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_FOLLOWING",4),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_CONTAINS",8),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_CONTAINED_BY",16),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32)},function(r,n){r.exports=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i}},function(r,n,i){var o=i(87),a=i(41),s=i(27),c=i(26),l=i(128),d=[].push,u=function(f){var h=f==1,g=f==2,p=f==3,v=f==4,w=f==6,m=f==5||w;return function(y,C,x,S){for(var T,_,E=s(y),D=a(E),b=o(C,x,3),I=c(D.length),O=0,M=S||l,R=h?M(y,I):g?M(y,0):void 0;I>O;O++)if((m||O in D)&&(_=b(T=D[O],O,E),f)){if(h)R[O]=_;else if(_)switch(f){case 3:return!0;case 5:return T;case 6:return O;case 2:d.call(R,T)}else if(v)return!1}return w?-1:p||v?v:R}};r.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6)}},function(r,n,i){var o=this&&this.__values||function(E){var D=typeof Symbol=="function"&&Symbol.iterator,b=D&&E[D],I=0;if(b)return b.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&I>=E.length&&(E=void 0),{value:E&&E[I++],done:!E}}};throw new TypeError(D?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(E,D){var b=typeof Symbol=="function"&&E[Symbol.iterator];if(!b)return E;var I,O,M=b.call(E),R=[];try{for(;(D===void 0||D-- >0)&&!(I=M.next()).done;)R.push(I.value)}catch(A){O={error:A}}finally{try{I&&!I.done&&(b=M.return)&&b.call(M)}finally{if(O)throw O.error}}return R},s=this&&this.__spread||function(){for(var E=[],D=0;D<arguments.length;D++)E=E.concat(a(arguments[D]));return E};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(9),d=i(2),u=i(3),f=i(1),h=i(7),g=i(73),p=i(17),v=i(172),w=i(72),m=i(51),y=i(30),C=i(106);function x(E,D,b){var I,O,M,R,A,G,k,L,F=D._nodeType,j=E._nodeType,Y=b?b._nodeType:null;if(F!==d.NodeType.Document&&F!==d.NodeType.DocumentFragment&&F!==d.NodeType.Element)throw new l.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+D.nodeName+".");if(p.tree_isHostIncludingAncestorOf(D,E,!0))throw new l.HierarchyRequestError("The node to be inserted cannot be an inclusive ancestor of parent node. Node is "+E.nodeName+", parent node is "+D.nodeName+".");if(b!==null&&b._parent!==D)throw new l.NotFoundError("The reference child node cannot be found under parent node. Child node is "+b.nodeName+", parent node is "+D.nodeName+".");if(j!==d.NodeType.DocumentFragment&&j!==d.NodeType.DocumentType&&j!==d.NodeType.Element&&j!==d.NodeType.Text&&j!==d.NodeType.ProcessingInstruction&&j!==d.NodeType.CData&&j!==d.NodeType.Comment)throw new l.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+E.nodeName+".");if(j===d.NodeType.Text&&F===d.NodeType.Document)throw new l.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+E.nodeName+".");if(j===d.NodeType.DocumentType&&F!==d.NodeType.Document)throw new l.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+D.nodeName+".");if(F===d.NodeType.Document){if(j===d.NodeType.DocumentFragment){var ie=0;try{for(var de=o(E._children),ae=de.next();!ae.done;ae=de.next()){var fe=ae.value;if(fe._nodeType===d.NodeType.Element)ie++;else if(fe._nodeType===d.NodeType.Text)throw new l.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+fe.nodeName+".")}}catch(Q){I={error:Q}}finally{try{ae&&!ae.done&&(O=de.return)&&O.call(de)}finally{if(I)throw I.error}}if(ie>1)throw new l.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+ie+" element nodes.");if(ie===1){try{for(var we=o(D._children),_e=we.next();!_e.done;_e=we.next())if(_e.value._nodeType===d.NodeType.Element)throw new l.HierarchyRequestError("The document node already has a document element node.")}catch(Q){M={error:Q}}finally{try{_e&&!_e.done&&(R=we.return)&&R.call(we)}finally{if(M)throw M.error}}if(b){if(Y===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");for(var Se=b._nextSibling;Se;){if(Se._nodeType===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");Se=Se._nextSibling}}}}else if(j===d.NodeType.Element){try{for(var B=o(D._children),P=B.next();!P.done;P=B.next())if(P.value._nodeType===d.NodeType.Element)throw new l.HierarchyRequestError("Document already has a document element node. Node is "+E.nodeName+".")}catch(Q){A={error:Q}}finally{try{P&&!P.done&&(G=B.return)&&G.call(B)}finally{if(A)throw A.error}}if(b){if(Y===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+E.nodeName+".");for(Se=b._nextSibling;Se;){if(Se._nodeType===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+E.nodeName+".");Se=Se._nextSibling}}}else if(j===d.NodeType.DocumentType){try{for(var $=o(D._children),W=$.next();!W.done;W=$.next())if(W.value._nodeType===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Document already has a document type node. Node is "+E.nodeName+".")}catch(Q){k={error:Q}}finally{try{W&&!W.done&&(L=$.return)&&L.call($)}finally{if(k)throw k.error}}if(b)for(var K=b._previousSibling;K;){if(K._nodeType===d.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+E.nodeName+".");K=K._previousSibling}else for(K=D._firstChild;K;){if(K._nodeType===d.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+E.nodeName+".");K=K._nextSibling}}}}function S(E,D,b){x(E,D,b);var I=b;return I===E&&(I=E._nextSibling),C.document_adopt(E,D._nodeDocument),T(E,D,I),E}function T(E,D,b,I){var O,M;if(b!==null||E._nodeType===d.NodeType.DocumentFragment){var R=E._nodeType===d.NodeType.DocumentFragment?E._children.size:1;if(b!==null&&c.dom.rangeList.size!==0){var A=p.tree_index(b);try{for(var G=o(c.dom.rangeList),k=G.next();!k.done;k=G.next()){var L=k.value;L._start[0]===D&&L._start[1]>A&&(L._start[1]+=R),L._end[0]===D&&L._end[1]>A&&(L._end[1]+=R)}}catch(_e){O={error:_e}}finally{try{k&&!k.done&&(M=G.return)&&M.call(G)}finally{if(O)throw O.error}}}var F=E._nodeType===d.NodeType.DocumentFragment?new(Array.bind.apply(Array,s([void 0],E._children))):[E];if(E._nodeType===d.NodeType.DocumentFragment)for(;E._firstChild;)_(E._firstChild,E,!0);c.dom.features.mutationObservers&&E._nodeType===d.NodeType.DocumentFragment&&m.observer_queueTreeMutationRecord(E,[],F,null,null);for(var j=b?b._previousSibling:D._lastChild,Y=b===null?-1:p.tree_index(b),ie=0;ie<F.length;ie++){var de=F[ie];if(u.Guard.isElementNode(de)&&(u.Guard.isDocumentNode(D)&&(D._documentElement=de),de._nodeDocument._hasNamespaces||de._namespace===null&&de._namespacePrefix===null||(de._nodeDocument._hasNamespaces=!0)),de._parent=D,b===null?h.set.append(D._children,de):(h.set.insert(D._children,de,Y),Y++),D._firstChild===null)de._previousSibling=null,de._nextSibling=null,D._firstChild=de,D._lastChild=de;else{var ae=b?b._previousSibling:D._lastChild,fe=b||null;de._previousSibling=ae,de._nextSibling=fe,ae&&(ae._nextSibling=de),fe&&(fe._previousSibling=de),ae||(D._firstChild=de),fe||(D._lastChild=de)}c.dom.features.slots&&D._shadowRoot!==null&&u.Guard.isSlotable(de)&&w.shadowTree_assignASlot(de),c.dom.features.steps&&u.Guard.isTextNode(de)&&y.dom_runChildTextContentChangeSteps(D),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(D))&&u.Guard.isSlot(D)&&f.isEmpty(D._assignedNodes)&&w.shadowTree_signalASlotChange(D),c.dom.features.slots&&w.shadowTree_assignSlotablesForATree(p.tree_rootNode(de));for(var we=p.tree_getFirstDescendantNode(de,!0,!0);we!==null;)c.dom.features.steps&&y.dom_runInsertionSteps(we),c.dom.features.customElements&&u.Guard.isElementNode(we)&&w.shadowTree_isConnected(we)&&(u.Guard.isCustomElementNode(we)?g.customElement_enqueueACustomElementCallbackReaction(we,"connectedCallback",[]):g.customElement_tryToUpgrade(we)),we=p.tree_getNextDescendantNode(de,we,!0,!0)}c.dom.features.mutationObservers&&(I||m.observer_queueTreeMutationRecord(D,F,[],j,b))}else(function(_e,Se,B){var P=Se._lastChild;if(u.Guard.isElementNode(_e)&&(u.Guard.isDocumentNode(Se)&&(Se._documentElement=_e),_e._nodeDocument._hasNamespaces||_e._namespace===null&&_e._namespacePrefix===null||(_e._nodeDocument._hasNamespaces=!0)),_e._parent=Se,Se._children.add(_e),Se._firstChild===null)_e._previousSibling=null,_e._nextSibling=null,Se._firstChild=_e,Se._lastChild=_e;else{var $=Se._lastChild;_e._previousSibling=$,_e._nextSibling=null,$&&($._nextSibling=_e),$||(Se._firstChild=_e),Se._lastChild=_e}c.dom.features.slots&&Se._shadowRoot!==null&&u.Guard.isSlotable(_e)&&w.shadowTree_assignASlot(_e),c.dom.features.steps&&u.Guard.isTextNode(_e)&&y.dom_runChildTextContentChangeSteps(Se),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(Se))&&u.Guard.isSlot(Se)&&f.isEmpty(Se._assignedNodes)&&w.shadowTree_signalASlotChange(Se),c.dom.features.slots&&w.shadowTree_assignSlotablesForATree(p.tree_rootNode(_e)),c.dom.features.steps&&y.dom_runInsertionSteps(_e),c.dom.features.customElements&&u.Guard.isElementNode(_e)&&w.shadowTree_isConnected(_e)&&(u.Guard.isCustomElementNode(_e)?g.customElement_enqueueACustomElementCallbackReaction(_e,"connectedCallback",[]):g.customElement_tryToUpgrade(_e)),c.dom.features.mutationObservers&&(B||m.observer_queueTreeMutationRecord(Se,[_e],[],P,null))})(E,D,I)}function _(E,D,b){var I,O,M,R,A,G,k,L;if(c.dom.rangeList.size!==0){var F=p.tree_index(E);try{for(var j=o(c.dom.rangeList),Y=j.next();!Y.done;Y=j.next()){var ie=Y.value;p.tree_isDescendantOf(E,ie._start[0],!0)&&(ie._start=[D,F]),p.tree_isDescendantOf(E,ie._end[0],!0)&&(ie._end=[D,F]),ie._start[0]===D&&ie._start[1]>F&&ie._start[1]--,ie._end[0]===D&&ie._end[1]>F&&ie._end[1]--}}catch(De){I={error:De}}finally{try{Y&&!Y.done&&(O=j.return)&&O.call(j)}finally{if(I)throw I.error}}try{for(var de=o(c.dom.rangeList),ae=de.next();!ae.done;ae=de.next())(ie=ae.value)._start[0]===D&&ie._start[1]>F&&(ie._start[1]-=1),ie._end[0]===D&&ie._end[1]>F&&(ie._end[1]-=1)}catch(De){M={error:De}}finally{try{ae&&!ae.done&&(R=de.return)&&R.call(de)}finally{if(M)throw M.error}}}if(c.dom.features.steps)try{for(var fe=o(v.nodeIterator_iteratorList()),we=fe.next();!we.done;we=fe.next()){var _e=we.value;_e._root._nodeDocument===E._nodeDocument&&y.dom_runNodeIteratorPreRemovingSteps(_e,E)}}catch(De){A={error:De}}finally{try{we&&!we.done&&(G=fe.return)&&G.call(fe)}finally{if(A)throw A.error}}var Se=E._previousSibling,B=E._nextSibling;u.Guard.isDocumentNode(D)&&u.Guard.isElementNode(E)&&(D._documentElement=null),E._parent=null,D._children.delete(E);var P=E._previousSibling,$=E._nextSibling;E._previousSibling=null,E._nextSibling=null,P&&(P._nextSibling=$),$&&($._previousSibling=P),P||(D._firstChild=$),$||(D._lastChild=P),c.dom.features.slots&&u.Guard.isSlotable(E)&&E._assignedSlot!==null&&w.shadowTree_isAssigned(E)&&w.shadowTree_assignSlotables(E._assignedSlot),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(D))&&u.Guard.isSlot(D)&&f.isEmpty(D._assignedNodes)&&w.shadowTree_signalASlotChange(D),c.dom.features.slots&&p.tree_getFirstDescendantNode(E,!0,!1,(function(De){return u.Guard.isSlot(De)}))!==null&&(w.shadowTree_assignSlotablesForATree(p.tree_rootNode(D)),w.shadowTree_assignSlotablesForATree(E)),c.dom.features.steps&&y.dom_runRemovingSteps(E,D),c.dom.features.customElements&&u.Guard.isCustomElementNode(E)&&g.customElement_enqueueACustomElementCallbackReaction(E,"disconnectedCallback",[]);for(var W=p.tree_getFirstDescendantNode(E,!1,!0);W!==null;)c.dom.features.steps&&y.dom_runRemovingSteps(W,E),c.dom.features.customElements&&u.Guard.isCustomElementNode(W)&&g.customElement_enqueueACustomElementCallbackReaction(W,"disconnectedCallback",[]),W=p.tree_getNextDescendantNode(E,W,!1,!0);if(c.dom.features.mutationObservers)for(var K=p.tree_getFirstAncestorNode(D,!0);K!==null;){try{for(var Q=(k=void 0,o(K._registeredObserverList)),ee=Q.next();!ee.done;ee=Q.next()){var ge=ee.value;ge.options.subtree&&E._registeredObserverList.push({observer:ge.observer,options:ge.options,source:ge})}}catch(De){k={error:De}}finally{try{ee&&!ee.done&&(L=Q.return)&&L.call(Q)}finally{if(k)throw k.error}}K=p.tree_getNextAncestorNode(D,K,!0)}c.dom.features.mutationObservers&&(b||m.observer_queueTreeMutationRecord(D,[],[E],Se,B)),c.dom.features.steps&&u.Guard.isTextNode(E)&&y.dom_runChildTextContentChangeSteps(D)}n.mutation_ensurePreInsertionValidity=x,n.mutation_preInsert=S,n.mutation_insert=T,n.mutation_append=function(E,D){return S(E,D,null)},n.mutation_replace=function(E,D,b){var I,O,M,R,A,G,k,L;if(b._nodeType!==d.NodeType.Document&&b._nodeType!==d.NodeType.DocumentFragment&&b._nodeType!==d.NodeType.Element)throw new l.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+b.nodeName+".");if(p.tree_isHostIncludingAncestorOf(b,D,!0))throw new l.HierarchyRequestError("The node to be inserted cannot be an ancestor of parent node. Node is "+D.nodeName+", parent node is "+b.nodeName+".");if(E._parent!==b)throw new l.NotFoundError("The reference child node cannot be found under parent node. Child node is "+E.nodeName+", parent node is "+b.nodeName+".");if(D._nodeType!==d.NodeType.DocumentFragment&&D._nodeType!==d.NodeType.DocumentType&&D._nodeType!==d.NodeType.Element&&D._nodeType!==d.NodeType.Text&&D._nodeType!==d.NodeType.ProcessingInstruction&&D._nodeType!==d.NodeType.CData&&D._nodeType!==d.NodeType.Comment)throw new l.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+D.nodeName+".");if(D._nodeType===d.NodeType.Text&&b._nodeType===d.NodeType.Document)throw new l.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+D.nodeName+".");if(D._nodeType===d.NodeType.DocumentType&&b._nodeType!==d.NodeType.Document)throw new l.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+b.nodeName+".");if(b._nodeType===d.NodeType.Document){if(D._nodeType===d.NodeType.DocumentFragment){var F=0;try{for(var j=o(D._children),Y=j.next();!Y.done;Y=j.next()){var ie=Y.value;if(ie._nodeType===d.NodeType.Element)F++;else if(ie._nodeType===d.NodeType.Text)throw new l.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+ie.nodeName+".")}}catch(ge){I={error:ge}}finally{try{Y&&!Y.done&&(O=j.return)&&O.call(j)}finally{if(I)throw I.error}}if(F>1)throw new l.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+F+" element nodes.");if(F===1){try{for(var de=o(b._children),ae=de.next();!ae.done;ae=de.next())if((P=ae.value)._nodeType===d.NodeType.Element&&P!==E)throw new l.HierarchyRequestError("The document node already has a document element node.")}catch(ge){M={error:ge}}finally{try{ae&&!ae.done&&(R=de.return)&&R.call(de)}finally{if(M)throw M.error}}for(var fe=E._nextSibling;fe;){if(fe._nodeType===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");fe=fe._nextSibling}}}else if(D._nodeType===d.NodeType.Element){try{for(var we=o(b._children),_e=we.next();!_e.done;_e=we.next())if((P=_e.value)._nodeType===d.NodeType.Element&&P!==E)throw new l.HierarchyRequestError("Document already has a document element node. Node is "+D.nodeName+".")}catch(ge){A={error:ge}}finally{try{_e&&!_e.done&&(G=we.return)&&G.call(we)}finally{if(A)throw A.error}}for(fe=E._nextSibling;fe;){if(fe._nodeType===d.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+D.nodeName+".");fe=fe._nextSibling}}else if(D._nodeType===d.NodeType.DocumentType){try{for(var Se=o(b._children),B=Se.next();!B.done;B=Se.next()){var P;if((P=B.value)._nodeType===d.NodeType.DocumentType&&P!==E)throw new l.HierarchyRequestError("Document already has a document type node. Node is "+D.nodeName+".")}}catch(ge){k={error:ge}}finally{try{B&&!B.done&&(L=Se.return)&&L.call(Se)}finally{if(k)throw k.error}}for(var $=E._previousSibling;$;){if($._nodeType===d.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+D.nodeName+".");$=$._previousSibling}}}var W=E._nextSibling;W===D&&(W=D._nextSibling);var K=E._previousSibling;C.document_adopt(D,b._nodeDocument);var Q=[];E._parent!==null&&(Q.push(E),_(E,E._parent,!0));var ee=[];return D._nodeType===d.NodeType.DocumentFragment?ee=Array.from(D._children):ee.push(D),T(D,b,W,!0),c.dom.features.mutationObservers&&m.observer_queueTreeMutationRecord(b,ee,Q,K,W),E},n.mutation_replaceAll=function(E,D){var b,I;E!==null&&C.document_adopt(E,D._nodeDocument);var O=Array.from(D._children),M=[];E&&E._nodeType===d.NodeType.DocumentFragment?M=Array.from(E._children):E!==null&&M.push(E);try{for(var R=o(O),A=R.next();!A.done;A=R.next())_(A.value,D,!0)}catch(G){b={error:G}}finally{try{A&&!A.done&&(I=R.return)&&I.call(R)}finally{if(b)throw b.error}}E!==null&&T(E,D,null,!0),c.dom.features.mutationObservers&&m.observer_queueTreeMutationRecord(D,M,O,null,null)},n.mutation_preRemove=function(E,D){if(E._parent!==D)throw new l.NotFoundError("The child node cannot be found under parent node. Child node is "+E.nodeName+", parent node is "+D.nodeName+".");return _(E,D),E},n.mutation_remove=_},function(r,n,i){function o(a){return a==null}r.exports.isNothing=o,r.exports.isObject=function(a){return typeof a=="object"&&a!==null},r.exports.toArray=function(a){return Array.isArray(a)?a:o(a)?[]:[a]},r.exports.repeat=function(a,s){var c,l="";for(c=0;c<s;c+=1)l+=a;return l},r.exports.isNegativeZero=function(a){return a===0&&Number.NEGATIVE_INFINITY===1/a},r.exports.extend=function(a,s){var c,l,d,u;if(s)for(c=0,l=(u=Object.keys(s)).length;c<l;c+=1)a[d=u[c]]=s[d];return a}},function(r,n,i){var o=i(38),a=i(53),s=i(10);function c(d,u,f){var h=[];return d.include.forEach((function(g){f=c(g,u,f)})),d[u].forEach((function(g){f.forEach((function(p,v){p.tag===g.tag&&p.kind===g.kind&&h.push(v)})),f.push(g)})),f.filter((function(g,p){return h.indexOf(p)===-1}))}function l(d){this.include=d.include||[],this.implicit=d.implicit||[],this.explicit=d.explicit||[],this.implicit.forEach((function(u){if(u.loadKind&&u.loadKind!=="scalar")throw new a("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")})),this.compiledImplicit=c(this,"implicit",[]),this.compiledExplicit=c(this,"explicit",[]),this.compiledTypeMap=(function(){var u,f,h={scalar:{},sequence:{},mapping:{},fallback:{}};function g(p){h[p.kind][p.tag]=h.fallback[p.tag]=p}for(u=0,f=arguments.length;u<f;u+=1)arguments[u].forEach(g);return h})(this.compiledImplicit,this.compiledExplicit)}l.DEFAULT=null,l.create=function(){var d,u;switch(arguments.length){case 1:d=l.DEFAULT,u=arguments[0];break;case 2:d=arguments[0],u=arguments[1];break;default:throw new a("Wrong number of arguments for Schema.create function")}if(d=o.toArray(d),u=o.toArray(u),!d.every((function(f){return f instanceof l})))throw new a("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!u.every((function(f){return f instanceof s})))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new l({include:d,explicit:u})},r.exports=l},function(r,n){r.exports=function(i,o){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:o}}},function(r,n,i){var o=i(8),a=i(42),s="".split;r.exports=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(c){return a(c)=="String"?s.call(c,""):Object(c)}:Object},function(r,n){var i={}.toString;r.exports=function(o){return i.call(o).slice(8,-1)}},function(r,n,i){var o,a,s,c=i(186),l=i(11),d=i(13),u=i(21),f=i(14),h=i(57),g=i(45),p=l.WeakMap;if(c){var v=new p,w=v.get,m=v.has,y=v.set;o=function(x,S){return y.call(v,x,S),S},a=function(x){return w.call(v,x)||{}},s=function(x){return m.call(v,x)}}else{var C=h("state");g[C]=!0,o=function(x,S){return u(x,C,S),S},a=function(x){return f(x,C)?x[C]:{}},s=function(x){return f(x,C)}}r.exports={set:o,get:a,has:s,enforce:function(x){return s(x)?a(x):o(x,{})},getterFor:function(x){return function(S){var T;if(!d(S)||(T=a(S)).type!==x)throw TypeError("Incompatible receiver, "+x+" required");return T}}}},function(r,n){r.exports=!1},function(r,n){r.exports={}},function(r,n,i){var o=i(120),a=i(11),s=function(c){return typeof c=="function"?c:void 0};r.exports=function(c,l){return arguments.length<2?s(o[c])||s(a[c]):o[c]&&o[c][l]||a[c]&&a[c][l]}},function(r,n){var i=Math.ceil,o=Math.floor;r.exports=function(a){return isNaN(a=+a)?0:(a>0?o:i)(a)}},function(r,n,i){var o=i(8);r.exports=function(a,s){var c=[][a];return!!c&&o((function(){c.call(null,s||function(){throw 1},1)}))}},function(r,n){r.exports={}},function(r,n,i){i(31),i(32),i(33),i(220),i(64),i(19),i(65),i(20),i(68),i(66),i(92),i(144),i(22),i(94),i(23);var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,v=p&&g[p],w=0;if(v)return v.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(g,p){var v=typeof Symbol=="function"&&g[Symbol.iterator];if(!v)return g;var w,m,y=v.call(g),C=[];try{for(;(p===void 0||p-- >0)&&!(w=y.next()).done;)C.push(w.value)}catch(x){m={error:x}}finally{try{w&&!w.done&&(v=y.return)&&v.call(y)}finally{if(m)throw m.error}}return C},s=this&&this.__spread||function(){for(var g=[],p=0;p<arguments.length;p++)g=g.concat(a(arguments[p]));return g};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(69),d=i(95),u=i(7),f=i(0),h=(function(){function g(p){this.level=0,this._builderOptions=p}return g.prototype.declaration=function(p,v,w){},g.prototype.docType=function(p,v,w){},g.prototype.comment=function(p){},g.prototype.text=function(p){},g.prototype.instruction=function(p,v){},g.prototype.cdata=function(p){},g.prototype.openTagBegin=function(p){},g.prototype.openTagEnd=function(p,v,w){},g.prototype.closeTag=function(p){},g.prototype.attributes=function(p){var v,w;try{for(var m=o(p),y=m.next();!y.done;y=m.next()){var C=y.value;this.attribute(C[1]===null?C[2]:C[1]+":"+C[2],C[3])}}catch(x){v={error:x}}finally{try{y&&!y.done&&(w=m.return)&&w.call(m)}finally{if(v)throw v.error}}},g.prototype.attribute=function(p,v){},g.prototype.beginElement=function(p){},g.prototype.endElement=function(p){},g.prototype.serializeNode=function(p,v){var w=p._nodeDocument!==void 0&&p._nodeDocument._hasNamespaces;if(this.level=0,this.currentNode=p,w){var m=new d.NamespacePrefixMap;m.set("xml",u.namespace.XML),this._serializeNodeNS(p,null,m,{value:1},v)}else this._serializeNode(p,v)},g.prototype._serializeNodeNS=function(p,v,w,m,y){switch(this.currentNode=p,p.nodeType){case c.NodeType.Element:this._serializeElementNS(p,v,w,m,y);break;case c.NodeType.Document:this._serializeDocumentNS(p,v,w,m,y);break;case c.NodeType.Comment:this._serializeComment(p,y);break;case c.NodeType.Text:this._serializeText(p,y);break;case c.NodeType.DocumentFragment:this._serializeDocumentFragmentNS(p,v,w,m,y);break;case c.NodeType.DocumentType:this._serializeDocumentType(p,y);break;case c.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(p,y);break;case c.NodeType.CData:this._serializeCData(p,y);break;default:throw new Error("Unknown node type: "+p.nodeType)}},g.prototype._serializeNode=function(p,v){switch(this.currentNode=p,p.nodeType){case c.NodeType.Element:this._serializeElement(p,v);break;case c.NodeType.Document:this._serializeDocument(p,v);break;case c.NodeType.Comment:this._serializeComment(p,v);break;case c.NodeType.Text:this._serializeText(p,v);break;case c.NodeType.DocumentFragment:this._serializeDocumentFragment(p,v);break;case c.NodeType.DocumentType:this._serializeDocumentType(p,v);break;case c.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(p,v);break;case c.NodeType.CData:this._serializeCData(p,v);break;default:throw new Error("Unknown node type: "+p.nodeType)}},g.prototype._serializeElementNS=function(p,v,w,m,y){var C,x,S=[];if(y&&(p.localName.indexOf(":")!==-1||!f.xml_isName(p.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var T="",_=!1,E=!1,D=w.copy(),b={},I=this._recordNamespaceInformation(p,D,b),O=v,M=p.namespaceURI;if(O===M)I!==null&&(E=!0),T=M===u.namespace.XML?"xml:"+p.localName:p.localName,this.beginElement(T),this.openTagBegin(T);else{var R=p.prefix,A=null;if(R===null&&M===I||(A=D.get(R,M)),R==="xmlns"){if(y)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");A=R}A!==null?(T=A+":"+p.localName,I!==null&&I!==u.namespace.XML&&(O=I||null),this.beginElement(T),this.openTagBegin(T)):R!==null?(R in b&&(R=this._generatePrefix(M,D,m)),D.set(R,M),T+=R+":"+p.localName,this.beginElement(T),this.openTagBegin(T),S.push([null,"xmlns",R,this._serializeAttributeValue(M,y)]),I!==null&&(O=I||null)):I===null||I!==null&&I!==M?(E=!0,T+=p.localName,O=M,this.beginElement(T),this.openTagBegin(T),S.push([null,null,"xmlns",this._serializeAttributeValue(M,y)])):(T+=p.localName,O=M,this.beginElement(T),this.openTagBegin(T))}S.push.apply(S,s(this._serializeAttributesNS(p,D,m,b,E,y))),this.attributes(S);var G=M===u.namespace.HTML;if(G&&p.childNodes.length===0&&g._VoidElementNames.has(p.localName)?(this.openTagEnd(T,!0,!0),this.endElement(T),_=!0):G||p.childNodes.length!==0?this.openTagEnd(T,!1,!1):(this.openTagEnd(T,!0,!1),this.endElement(T),_=!0),!_){if(!(G&&p.localName==="template"))try{for(var k=o(p.childNodes),L=k.next();!L.done;L=k.next()){var F=L.value;this.level++,this._serializeNodeNS(F,O,D,m,y),this.level--}}catch(j){C={error:j}}finally{try{L&&!L.done&&(x=k.return)&&x.call(k)}finally{if(C)throw C.error}}this.closeTag(T),this.endElement(T)}},g.prototype._serializeElement=function(p,v){var w,m;if(v&&(p.localName.indexOf(":")!==-1||!f.xml_isName(p.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var y=!1,C=p.localName;this.beginElement(C),this.openTagBegin(C);var x=this._serializeAttributes(p,v);if(this.attributes(x),p.hasChildNodes()?this.openTagEnd(C,!1,!1):(this.openTagEnd(C,!0,!1),this.endElement(C),y=!0),!y){try{for(var S=o(p._children),T=S.next();!T.done;T=S.next()){var _=T.value;this.level++,this._serializeNode(_,v),this.level--}}catch(E){w={error:E}}finally{try{T&&!T.done&&(m=S.return)&&m.call(S)}finally{if(w)throw w.error}}this.closeTag(C),this.endElement(C)}},g.prototype._serializeDocumentNS=function(p,v,w,m,y){var C,x;if(y&&p.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var S=o(p.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;this._serializeNodeNS(_,v,w,m,y)}}catch(E){C={error:E}}finally{try{T&&!T.done&&(x=S.return)&&x.call(S)}finally{if(C)throw C.error}}},g.prototype._serializeDocument=function(p,v){var w,m;if(v&&p.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var y=o(p._children),C=y.next();!C.done;C=y.next()){var x=C.value;this._serializeNode(x,v)}}catch(S){w={error:S}}finally{try{C&&!C.done&&(m=y.return)&&m.call(y)}finally{if(w)throw w.error}}},g.prototype._serializeComment=function(p,v){if(v&&(!f.xml_isLegalChar(p.data)||p.data.indexOf("--")!==-1||p.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");this.comment(p.data)},g.prototype._serializeText=function(p,v){if(v&&!f.xml_isLegalChar(p.data))throw new Error("Text data contains invalid characters (well-formed required).");var w=p.data.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.text(w)},g.prototype._serializeDocumentFragmentNS=function(p,v,w,m,y){var C,x;try{for(var S=o(p.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;this._serializeNodeNS(_,v,w,m,y)}}catch(E){C={error:E}}finally{try{T&&!T.done&&(x=S.return)&&x.call(S)}finally{if(C)throw C.error}}},g.prototype._serializeDocumentFragment=function(p,v){var w,m;try{for(var y=o(p._children),C=y.next();!C.done;C=y.next()){var x=C.value;this._serializeNode(x,v)}}catch(S){w={error:S}}finally{try{C&&!C.done&&(m=y.return)&&m.call(y)}finally{if(w)throw w.error}}},g.prototype._serializeDocumentType=function(p,v){if(v&&!f.xml_isPubidChar(p.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(v&&(!f.xml_isLegalChar(p.systemId)||p.systemId.indexOf('"')!==-1&&p.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");this.docType(p.name,p.publicId,p.systemId)},g.prototype._serializeProcessingInstruction=function(p,v){if(v&&(p.target.indexOf(":")!==-1||/^xml$/i.test(p.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(v&&(!f.xml_isLegalChar(p.data)||p.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");this.instruction(p.target,p.data)},g.prototype._serializeCData=function(p,v){if(v&&p.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");this.cdata(p.data)},g.prototype._serializeAttributesNS=function(p,v,w,m,y,C){var x,S,T=[],_=C?new l.LocalNameSet:void 0;try{for(var E=o(p.attributes),D=E.next();!D.done;D=E.next()){var b=D.value;if(C||y||b.namespaceURI!==null){if(C&&_&&_.has(b.namespaceURI,b.localName))throw new Error("Element contains duplicate attributes (well-formed required).");C&&_&&_.set(b.namespaceURI,b.localName);var I=b.namespaceURI,O=null;if(I!==null)if(O=v.get(b.prefix,I),I===u.namespace.XMLNS){if(b.value===u.namespace.XML||b.prefix===null&&y||b.prefix!==null&&(!(b.localName in m)||m[b.localName]!==b.value)&&v.has(b.localName,b.value))continue;if(C&&b.value===u.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(C&&b.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");b.prefix==="xmlns"&&(O="xmlns")}else O===null&&(O=b.prefix===null||v.hasPrefix(b.prefix)&&!v.has(b.prefix,I)?this._generatePrefix(I,v,w):b.prefix,T.push([null,"xmlns",O,this._serializeAttributeValue(I,C)]));if(C&&(b.localName.indexOf(":")!==-1||!f.xml_isName(b.localName)||b.localName==="xmlns"&&I===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");T.push([I,O,b.localName,this._serializeAttributeValue(b.value,C)])}else T.push([null,null,b.localName,this._serializeAttributeValue(b.value,C)])}}catch(M){x={error:M}}finally{try{D&&!D.done&&(S=E.return)&&S.call(E)}finally{if(x)throw x.error}}return T},g.prototype._serializeAttributes=function(p,v){var w,m,y=[],C=v?{}:void 0;try{for(var x=o(p.attributes),S=x.next();!S.done;S=x.next()){var T=S.value;if(v){if(v&&C&&T.localName in C)throw new Error("Element contains duplicate attributes (well-formed required).");if(v&&C&&(C[T.localName]=!0),v&&(T.localName.indexOf(":")!==-1||!f.xml_isName(T.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");y.push([null,null,T.localName,this._serializeAttributeValue(T.value,v)])}else y.push([null,null,T.localName,this._serializeAttributeValue(T.value,v)])}}catch(_){w={error:_}}finally{try{S&&!S.done&&(m=x.return)&&m.call(x)}finally{if(w)throw w.error}}return y},g.prototype._recordNamespaceInformation=function(p,v,w){var m,y,C=null;try{for(var x=o(p.attributes),S=x.next();!S.done;S=x.next()){var T=S.value,_=T.namespaceURI,E=T.prefix;if(_===u.namespace.XMLNS){if(E===null){C=T.value;continue}var D=T.localName,b=T.value;if(b===u.namespace.XML||(b===""&&(b=null),v.has(D,b)))continue;v.set(D,b),w[D]=b||""}}}catch(I){m={error:I}}finally{try{S&&!S.done&&(y=x.return)&&y.call(x)}finally{if(m)throw m.error}}return C},g.prototype._generatePrefix=function(p,v,w){var m="ns"+w.value.toString();return w.value++,v.set(m,p),m},g.prototype._serializeAttributeValue=function(p,v){if(v&&p!==null&&!f.xml_isLegalChar(p))throw new Error("Invalid characters in attribute value.");return p===null?"":p.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},g._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),g})();n.BaseWriter=h},function(r,n,i){var o=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,m=w&&v[w],y=0;if(m)return m.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&y>=v.length&&(v=void 0),{value:v&&v[y++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(v,w){var m=typeof Symbol=="function"&&v[Symbol.iterator];if(!m)return v;var y,C,x=m.call(v),S=[];try{for(;(w===void 0||w-- >0)&&!(y=x.next()).done;)S.push(y.value)}catch(T){C={error:T}}finally{try{y&&!y.done&&(m=x.return)&&m.call(x)}finally{if(C)throw C.error}}return S};Object.defineProperty(n,"__esModule",{value:!0});var s=i(6),c=i(3),l=i(7),d=i(29),u=i(17),f=i(97);function h(){var v=s.dom.window;v._mutationObserverMicrotaskQueued||(v._mutationObserverMicrotaskQueued=!0,Promise.resolve().then((function(){g()})))}function g(){var v,w,m,y,C=s.dom.window;C._mutationObserverMicrotaskQueued=!1;var x=l.set.clone(C._mutationObservers),S=l.set.clone(C._signalSlots);l.set.empty(C._signalSlots);var T=function(O){var M=l.list.clone(O._recordQueue);l.list.empty(O._recordQueue);for(var R=0;R<O._nodeList.length;R++){var A=O._nodeList[R];l.list.remove(A._registeredObserverList,(function(G){return c.Guard.isTransientRegisteredObserver(G)&&G.observer===O}))}if(!l.list.isEmpty(M))try{O._callback.call(O,M,O)}catch{}};try{for(var _=o(x),E=_.next();!E.done;E=_.next())T(E.value)}catch(O){v={error:O}}finally{try{E&&!E.done&&(w=_.return)&&w.call(_)}finally{if(v)throw v.error}}if(s.dom.features.slots)try{for(var D=o(S),b=D.next();!b.done;b=D.next()){var I=b.value;f.event_fireAnEvent("slotchange",I,void 0,{bubbles:!0})}}catch(O){m={error:O}}finally{try{b&&!b.done&&(y=D.return)&&y.call(D)}finally{if(m)throw m.error}}}function p(v,w,m,y,C,x,S,T,_){for(var E,D,b=new Map,I=u.tree_getFirstAncestorNode(w,!0);I!==null;){for(var O=0;O<I._registeredObserverList.length;O++){var M=I._registeredObserverList[O],R=M.options;if((I===w||R.subtree)&&(v!=="attributes"||R.attributes)&&(v!=="attributes"||!R.attributeFilter||R.attributeFilter.indexOf(m||"")&&y===null)&&(v!=="characterData"||R.characterData)&&(v!=="childList"||R.childList)){var A=M.observer;b.has(A)||b.set(A,null),(v==="attributes"&&R.attributeOldValue||v==="characterData"&&R.characterDataOldValue)&&b.set(A,C)}}I=u.tree_getNextAncestorNode(w,I,!0)}try{for(var G=o(b),k=G.next();!k.done;k=G.next()){var L=a(k.value,2),F=L[0],j=L[1],Y=d.create_mutationRecord(v,w,d.create_nodeListStatic(w,x),d.create_nodeListStatic(w,S),T,_,m,y,j);F._recordQueue.push(Y)}}catch(ie){E={error:ie}}finally{try{k&&!k.done&&(D=G.return)&&D.call(G)}finally{if(E)throw E.error}}h()}n.observer_queueAMutationObserverMicrotask=h,n.observer_notifyMutationObservers=g,n.observer_queueMutationRecord=p,n.observer_queueTreeMutationRecord=function(v,w,m,y,C){p("childList",v,null,null,null,w,m,y,C)},n.observer_queueAttributeMutationRecord=function(v,w,m,y){p("attributes",v,w,m,y,[],[],null,null)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(7),s=i(3),c=i(9),l=i(29),d=i(73),u=i(51),f=i(30),h=i(37),g=i(106);function p(x,S,T){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,x._localName,x._namespace,x._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&d.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[x._localName,x._value,T,x._namespace]),o.dom.features.steps&&f.dom_runAttributeChangeSteps(S,x._localName,x._value,T,x._namespace),x._value=T}function v(x,S){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,x._localName,x._namespace,null),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&d.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[x._localName,null,x._value,x._namespace]),o.dom.features.steps&&f.dom_runAttributeChangeSteps(S,x._localName,null,x._value,x._namespace),S._attributeList._asArray().push(x),x._element=S,S._nodeDocument._hasNamespaces||x._namespace===null&&x._namespacePrefix===null&&x._localName!=="xmlns"||(S._nodeDocument._hasNamespaces=!0)}function w(x,S){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,x._localName,x._namespace,x._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&d.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[x._localName,x._value,null,x._namespace]),o.dom.features.steps&&f.dom_runAttributeChangeSteps(S,x._localName,x._value,null,x._namespace);var T=S._attributeList._asArray().indexOf(x);S._attributeList._asArray().splice(T,1),x._element=null}function m(x,S,T){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(T,x._localName,x._namespace,x._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(T)&&d.customElement_enqueueACustomElementCallbackReaction(T,"attributeChangedCallback",[x._localName,x._value,S._value,x._namespace]),o.dom.features.steps&&f.dom_runAttributeChangeSteps(T,x._localName,x._value,S._value,x._namespace);var _=T._attributeList._asArray().indexOf(x);_!==-1&&(T._attributeList._asArray()[_]=S),x._element=null,S._element=T,T._nodeDocument._hasNamespaces||S._namespace===null&&S._namespacePrefix===null&&S._localName!=="xmlns"||(T._nodeDocument._hasNamespaces=!0)}function y(x,S){return S._namespace===a.namespace.HTML&&S._nodeDocument._type==="html"&&(x=x.toLowerCase()),S._attributeList._asArray().find((function(T){return T._qualifiedName===x}))||null}function C(x,S,T){var _=x||null;return T._attributeList._asArray().find((function(E){return E._namespace===_&&E._localName===S}))||null}n.element_has=function(x,S){return S._attributeList._asArray().indexOf(x)!==-1},n.element_change=p,n.element_append=v,n.element_remove=w,n.element_replace=m,n.element_getAnAttributeByName=y,n.element_getAnAttributeByNamespaceAndLocalName=C,n.element_getAnAttributeValue=function(x,S,T){T===void 0&&(T="");var _=C(T,S,x);return _===null?"":_._value},n.element_setAnAttribute=function(x,S){if(x._element!==null&&x._element!==S)throw new c.InUseAttributeError("This attribute already exists in the document: "+x._qualifiedName+" as a child of "+x._element._qualifiedName+".");var T=C(x._namespace||"",x._localName,S);return T===x?x:(T!==null?m(T,x,S):v(x,S),T)},n.element_setAnAttributeValue=function(x,S,T,_,E){_===void 0&&(_=null),E===void 0&&(E=null);var D=C(E||"",S,x);if(D===null){var b=l.create_attr(x._nodeDocument,S);return b._namespace=E,b._namespacePrefix=_,b._value=T,void v(b,x)}p(D,x,T)},n.element_removeAnAttributeByName=function(x,S){var T=y(x,S);return T!==null&&w(T,S),T},n.element_removeAnAttributeByNamespaceAndLocalName=function(x,S,T){var _=C(x,S,T);return _!==null&&w(_,T),_},n.element_createAnElement=function(x,S,T,_,E,D){_===void 0&&(_=null),E===void 0&&(E=null),D===void 0&&(D=!1);var b=null;if(!o.dom.features.customElements)return(b=l.create_element(x,S,T,_))._customElementState="uncustomized",b._customElementDefinition=null,b._is=E,b;var I=d.customElement_lookUpACustomElementDefinition(x,T,S,E);if(I!==null&&I.name!==I.localName)(b=new(g.document_elementInterface(S,a.namespace.HTML)))._localName=S,b._namespace=a.namespace.HTML,b._namespacePrefix=_,b._customElementState="undefined",b._customElementDefinition=null,b._is=E,b._nodeDocument=x,D?d.customElement_upgrade(I,b):d.customElement_enqueueACustomElementUpgradeReaction(b,I);else if(I!==null)if(D)try{var O=new I.constructor;if(console.assert(O._customElementState!==void 0),console.assert(O._customElementDefinition!==void 0),console.assert(O._namespace===a.namespace.HTML),O._attributeList.length!==0)throw new c.NotSupportedError("Custom element already has attributes.");if(O._children.size!==0)throw new c.NotSupportedError("Custom element already has child nodes.");if(O._parent!==null)throw new c.NotSupportedError("Custom element already has a parent node.");if(O._nodeDocument!==x)throw new c.NotSupportedError("Custom element is already in a document.");if(O._localName!==S)throw new c.NotSupportedError("Custom element has a different local name.");O._namespacePrefix=_,O._is=null}catch{(b=l.create_htmlUnknownElement(x,S,a.namespace.HTML,_))._customElementState="failed",b._customElementDefinition=null,b._is=null}else(b=l.create_htmlElement(x,S,a.namespace.HTML,_))._customElementState="undefined",b._customElementDefinition=null,b._is=null,d.customElement_enqueueACustomElementUpgradeReaction(b,I);else(b=new(g.document_elementInterface(S,T)))._localName=S,b._namespace=T,b._namespacePrefix=_,b._customElementState="uncustomized",b._customElementDefinition=null,b._is=E,b._nodeDocument=x,T!==a.namespace.HTML||E===null&&!d.customElement_isValidCustomElementName(S)||(b._customElementState="undefined");if(b===null)throw new Error("Unable to create element.");return b},n.element_insertAdjacent=function(x,S,T){switch(S.toLowerCase()){case"beforebegin":return x._parent===null?null:h.mutation_preInsert(T,x._parent,x);case"afterbegin":return h.mutation_preInsert(T,x,x._firstChild);case"beforeend":return h.mutation_preInsert(T,x,null);case"afterend":return x._parent===null?null:h.mutation_preInsert(T,x._parent,x._nextSibling);default:throw new c.SyntaxError(`Invalid 'where' argument. "beforebegin", "afterbegin", "beforeend" or "afterend" expected`)}}},function(r,n,i){function o(a,s){Error.call(this),this.name="YAMLException",this.reason=a,this.mark=s,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(a){var s=this.name+": ";return s+=this.reason||"(unknown reason)",!a&&this.mark&&(s+=" "+this.mark.toString()),s},r.exports=o},function(r,n,i){var o=i(39);r.exports=new o({include:[i(181)],implicit:[i(293),i(294)],explicit:[i(295),i(296),i(297),i(298)]})},function(r,n,i){var o=i(16),a=i(79),s=i(40),c=i(24),l=i(56),d=i(14),u=i(115),f=Object.getOwnPropertyDescriptor;n.f=o?f:function(h,g){if(h=c(h),g=l(g,!0),u)try{return f(h,g)}catch{}if(d(h,g))return s(!a.f.call(h,g),h[g])}},function(r,n,i){var o=i(13);r.exports=function(a,s){if(!o(a))return a;var c,l;if(s&&typeof(c=a.toString)=="function"&&!o(l=c.call(a))||typeof(c=a.valueOf)=="function"&&!o(l=c.call(a))||!s&&typeof(c=a.toString)=="function"&&!o(l=c.call(a)))return l;throw TypeError("Can't convert object to primitive value")}},function(r,n,i){var o=i(81),a=i(58),s=o("keys");r.exports=function(c){return s[c]||(s[c]=a(c))}},function(r,n){var i=0,o=Math.random();r.exports=function(a){return"Symbol("+String(a===void 0?"":a)+")_"+(++i+o).toString(36)}},function(r,n,i){var o=i(42);r.exports=Array.isArray||function(a){return o(a)=="Array"}},function(r,n,i){var o,a=i(18),s=i(188),c=i(84),l=i(45),d=i(189),u=i(116),f=i(57),h=f("IE_PROTO"),g=function(){},p=function(w){return"<script>"+w+"<\/script>"},v=function(){try{o=document.domain&&new ActiveXObject("htmlfile")}catch{}var w,m;v=o?(function(C){C.write(p("")),C.close();var x=C.parentWindow.Object;return C=null,x})(o):((m=u("iframe")).style.display="none",d.appendChild(m),m.src="javascript:",(w=m.contentWindow.document).open(),w.write(p("document.F=Object")),w.close(),w.F);for(var y=c.length;y--;)delete v.prototype[c[y]];return v()};l[h]=!0,r.exports=Object.create||function(w,m){var y;return w!==null?(g.prototype=a(w),y=new g,g.prototype=null,y[h]=w):y=v(),m===void 0?y:s(y,m)}},function(r,n,i){var o=i(121),a=i(84);r.exports=Object.keys||function(s){return o(s,a)}},function(r,n,i){var o=i(15).f,a=i(14),s=i(5)("toStringTag");r.exports=function(c,l,d){c&&!a(c=d?c:c.prototype,s)&&o(c,s,{configurable:!0,value:l})}},function(r,n,i){var o=i(8),a=i(5),s=i(129),c=a("species");r.exports=function(l){return s>=51||!o((function(){var d=[];return(d.constructor={})[c]=function(){return{foo:1}},d[l](Boolean).foo!==1}))}},function(r,n,i){var o=i(4),a=i(122).indexOf,s=i(48),c=i(28),l=[].indexOf,d=!!l&&1/[1].indexOf(1,-0)<0,u=s("indexOf"),f=c("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:d||!u||!f},{indexOf:function(h){return d?l.apply(this,arguments)||0:a(this,h,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(16),a=i(15).f,s=Function.prototype,c=s.toString,l=/^\s*function ([^ (]*)/;o&&!("name"in s)&&a(s,"name",{configurable:!0,get:function(){try{return c.call(this).match(l)[1]}catch{return""}}})},function(r,n,i){var o=i(25),a=i(18),s=i(8),c=i(136),l=RegExp.prototype,d=l.toString,u=s((function(){return d.call({source:"a",flags:"b"})!="/a/b"})),f=d.name!="toString";(u||f)&&o(RegExp.prototype,"toString",(function(){var h=a(this),g=String(h.source),p=h.flags;return"/"+g+"/"+String(p===void 0&&h instanceof RegExp&&!("flags"in l)?c.call(h):p)}),{unsafe:!0})},function(r,n,i){i(31),i(32),i(33),i(19),i(138),i(20),i(66),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}),s=this&&this.__values||function(u){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&u[f],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(1),l=i(2),d=(function(u){function f(h,g){var p=u.call(this,h)||this;return p._writerOptions=c.applyDefaults(g,{format:"object",wellFormed:!1,group:!1,verbose:!1}),p}return a(f,u),f.prototype.serialize=function(h){return this._currentList=[],this._currentIndex=0,this._listRegister=[this._currentList],this.serializeNode(h,this._writerOptions.wellFormed),this._process(this._currentList,this._writerOptions)},f.prototype._process=function(h,g){var p,v,w,m,y,C,x;if(h.length===0)return{};for(var S={},T=!1,_=0,E=0,D=0,b=0,I=0;I<h.length;I++){var O=h[I];switch(Se=Object.keys(O)[0]){case"@":continue;case"#":_++;break;case"!":E++;break;case"?":D++;break;case"$":b++;break;default:S[Se]?T=!0:S[Se]=!0}}var M=this._getAttrKey(),R=this._getNodeKey(l.NodeType.Text),A=this._getNodeKey(l.NodeType.Comment),G=this._getNodeKey(l.NodeType.ProcessingInstruction),k=this._getNodeKey(l.NodeType.CData);if(_===1&&h.length===1&&c.isString(h[0]["#"]))return h[0]["#"];if(T){var L={};for(I=0;I<h.length;I++)if(O=h[I],(Se=Object.keys(O)[0])==="@"){var F=O["@"];(B=Object.keys(F)).length===1?L[M+B[0]]=F[B[0]]:L[M]=O["@"]}var j=[];for(I=0;I<h.length;I++)switch(O=h[I],Se=Object.keys(O)[0]){case"@":break;case"#":j.push(((p={})[R]=O["#"],p));break;case"!":j.push(((v={})[A]=O["!"],v));break;case"?":j.push(((w={})[G]=O["?"],w));break;case"$":j.push(((m={})[k]=O.$,m));break;default:if(($=O)[Se].length!==0&&c.isArray($[Se][0])){for(var Y=[],ie=$[Se],de=0;de<ie.length;de++)Y.push(this._process(ie[de],g));j.push(((y={})[Se]=Y,y))}else g.verbose?j.push(((C={})[Se]=[this._process($[Se],g)],C)):j.push(((x={})[Se]=this._process($[Se],g),x))}return L[R]=j,L}var ae=1,fe=1,we=1,_e=1;for(L={},I=0;I<h.length;I++){var Se;switch(O=h[I],Se=Object.keys(O)[0]){case"@":F=O["@"];var B=Object.keys(F);if(g.group&&B.length!==1)L[M]=F;else for(var P in F)L[M+P]=F[P];break;case"#":ae=this._processSpecItem(O["#"],L,g.group,R,_,ae);break;case"!":fe=this._processSpecItem(O["!"],L,g.group,A,E,fe);break;case"?":we=this._processSpecItem(O["?"],L,g.group,G,D,we);break;case"$":_e=this._processSpecItem(O.$,L,g.group,k,b,_e);break;default:var $;if(($=O)[Se].length!==0&&c.isArray($[Se][0])){Y=[],ie=$[Se];for(var W=0;W<ie.length;W++)Y.push(this._process(ie[W],g));L[Se]=Y}else g.verbose?L[Se]=[this._process($[Se],g)]:L[Se]=this._process($[Se],g)}}return L},f.prototype._processSpecItem=function(h,g,p,v,w,m){var y,C;if(!p&&c.isArray(h)&&w+h.length>2)try{for(var x=s(h),S=x.next();!S.done;S=x.next()){var T=S.value;g[v+(m++).toString()]=T}}catch(_){y={error:_}}finally{try{S&&!S.done&&(C=x.return)&&C.call(x)}finally{if(y)throw y.error}}else g[w>1?v+(m++).toString():v]=h;return m},f.prototype.beginElement=function(h){var g,p,v=[];if(this._currentList.length===0)this._currentList.push(((g={})[h]=v,g));else{var w=this._currentList[this._currentList.length-1];this._isElementNode(w,h)?w[h].length!==0&&c.isArray(w[h][0])?w[h].push(v):w[h]=[w[h],v]:this._currentList.push(((p={})[h]=v,p))}this._currentIndex++,this._listRegister.length>this._currentIndex?this._listRegister[this._currentIndex]=v:this._listRegister.push(v),this._currentList=v},f.prototype.endElement=function(){this._currentList=this._listRegister[--this._currentIndex]},f.prototype.attribute=function(h,g){var p,v;if(this._currentList.length===0)this._currentList.push({"@":(p={},p[h]=g,p)});else{var w=this._currentList[this._currentList.length-1];this._isAttrNode(w)?w["@"][h]=g:this._currentList.push({"@":(v={},v[h]=g,v)})}},f.prototype.comment=function(h){if(this._currentList.length===0)this._currentList.push({"!":h});else{var g=this._currentList[this._currentList.length-1];this._isCommentNode(g)?c.isArray(g["!"])?g["!"].push(h):g["!"]=[g["!"],h]:this._currentList.push({"!":h})}},f.prototype.text=function(h){if(this._currentList.length===0)this._currentList.push({"#":h});else{var g=this._currentList[this._currentList.length-1];this._isTextNode(g)?c.isArray(g["#"])?g["#"].push(h):g["#"]=[g["#"],h]:this._currentList.push({"#":h})}},f.prototype.instruction=function(h,g){var p=g===""?h:h+" "+g;if(this._currentList.length===0)this._currentList.push({"?":p});else{var v=this._currentList[this._currentList.length-1];this._isInstructionNode(v)?c.isArray(v["?"])?v["?"].push(p):v["?"]=[v["?"],p]:this._currentList.push({"?":p})}},f.prototype.cdata=function(h){if(this._currentList.length===0)this._currentList.push({$:h});else{var g=this._currentList[this._currentList.length-1];this._isCDATANode(g)?c.isArray(g.$)?g.$.push(h):g.$=[g.$,h]:this._currentList.push({$:h})}},f.prototype._isAttrNode=function(h){return"@"in h},f.prototype._isTextNode=function(h){return"#"in h},f.prototype._isCommentNode=function(h){return"!"in h},f.prototype._isInstructionNode=function(h){return"?"in h},f.prototype._isCDATANode=function(h){return"$"in h},f.prototype._isElementNode=function(h,g){return g in h},f.prototype._getAttrKey=function(){return this._builderOptions.convert.att},f.prototype._getNodeKey=function(h){switch(h){case l.NodeType.Comment:return this._builderOptions.convert.comment;case l.NodeType.Text:return this._builderOptions.convert.text;case l.NodeType.ProcessingInstruction:return this._builderOptions.convert.ins;case l.NodeType.CData:return this._builderOptions.convert.cdata;default:throw new Error("Invalid node type.")}},f})(i(50).BaseWriter);n.ObjectWriter=d},function(r,n,i){var o=i(4),a=i(93);o({target:"RegExp",proto:!0,forced:/./.exec!==a},{exec:a})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(){this._items={},this._nullItems={}}return a.prototype.set=function(s,c){s===null?this._nullItems[c]=!0:(this._items[s]||(this._items[s]={}),this._items[s][c]=!0)},a.prototype.has=function(s,c){return s===null?this._nullItems[c]===!0:!!this._items[s]&&this._items[s][c]===!0},a})();n.LocalNameSet=o},function(r,n,i){var o=this&&this.__read||function(d,u){var f=typeof Symbol=="function"&&d[Symbol.iterator];if(!f)return d;var h,g,p=f.call(d),v=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)v.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(f=p.return)&&f.call(p)}finally{if(g)throw g.error}}return v};Object.defineProperty(n,"__esModule",{value:!0});var a=i(9),s=i(3),c=i(0),l=(function(){function d(){}return Object.defineProperty(d.prototype,"_eventListenerList",{get:function(){return this.__eventListenerList||(this.__eventListenerList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_eventHandlerMap",{get:function(){return this.__eventHandlerMap||(this.__eventHandlerMap={})},enumerable:!0,configurable:!0}),d.prototype.addEventListener=function(u,f,h){h===void 0&&(h={passive:!1,once:!1,capture:!1});var g,p=o(c.eventTarget_flattenMore(h),3),v=p[0],w=p[1],m=p[2];f&&(g=s.Guard.isEventListener(f)?f:{handleEvent:f},c.eventTarget_addEventListener(this,{type:u,callback:g,capture:v,passive:w,once:m,removed:!1}))},d.prototype.removeEventListener=function(u,f,h){h===void 0&&(h={capture:!1});var g=c.eventTarget_flatten(h);if(f)for(var p=0;p<this._eventListenerList.length;p++){var v=this._eventListenerList[p];if(v.type===u&&v.capture===g){if(s.Guard.isEventListener(f)&&v.callback===f){c.eventTarget_removeEventListener(this,v,p);break}if(f&&v.callback.handleEvent===f){c.eventTarget_removeEventListener(this,v,p);break}}}},d.prototype.dispatchEvent=function(u){if(u._dispatchFlag||!u._initializedFlag)throw new a.InvalidStateError;return u._isTrusted=!1,c.event_dispatch(u,this)},d.prototype._getTheParent=function(u){return null},d})();n.EventTargetImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var g in h)h.hasOwnProperty(g)&&(f[g]=h[g])})(d,u)},function(d,u){function f(){this.constructor=d}o(d,u),d.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(34),c=i(0),l=(function(d){function u(f){var h=d.call(this)||this;return h._data=f,h}return a(u,d),Object.defineProperty(u.prototype,"data",{get:function(){return this._data},set:function(f){c.characterData_replaceData(this,0,this._data.length,f)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),u.prototype.substringData=function(f,h){return c.characterData_substringData(this,f,h)},u.prototype.appendData=function(f){return c.characterData_replaceData(this,this._data.length,0,f)},u.prototype.insertData=function(f,h){c.characterData_replaceData(this,f,0,h)},u.prototype.deleteData=function(f,h){c.characterData_replaceData(this,f,h,"")},u.prototype.replaceData=function(f,h,g){c.characterData_replaceData(this,f,h,g)},Object.defineProperty(u.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),u.prototype.before=function(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.after=function(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.replaceWith=function(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},u})(s.NodeImpl);n.CharacterDataImpl=l},function(r,n,i){var o=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(w,m){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var C,x,S=y.call(w),T=[];try{for(;(m===void 0||m-- >0)&&!(C=S.next()).done;)T.push(C.value)}catch(_){x={error:_}}finally{try{C&&!C.done&&(y=S.return)&&y.call(S)}finally{if(x)throw x.error}}return T},s=this&&this.__spread||function(){for(var w=[],m=0;m<arguments.length;m++)w=w.concat(a(arguments[m]));return w};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(3),d=i(1),u=i(17),f=i(51);function h(w){c.dom.window._signalSlots.add(w),f.observer_queueAMutationObserverMicrotask()}function g(w,m){m===void 0&&(m=!1);var y=l.Cast.asNode(w)._parent;if(y===null)return null;var C=y._shadowRoot||null;if(C===null||m&&C._mode!=="open")return null;for(var x=u.tree_getFirstDescendantNode(C,!1,!0,(function(S){return l.Guard.isSlot(S)}));x!==null;){if(x._name===w._name)return x;x=u.tree_getNextDescendantNode(C,x,!1,!0,(function(S){return l.Guard.isSlot(S)}))}return null}function p(w){var m,y,C=[],x=u.tree_rootNode(w);if(!l.Guard.isShadowRoot(x))return C;var S=x._host;try{for(var T=o(S._children),_=T.next();!_.done;_=T.next()){var E=_.value;l.Guard.isSlotable(E)&&g(E)===w&&C.push(E)}}catch(D){m={error:D}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}return C}function v(w){var m,y,C=p(w);if(C.length===w._assignedNodes.length){for(var x=!0,S=0;S<C.length;S++)if(C[S]!==w._assignedNodes[S]){x=!1;break}x||h(w)}w._assignedNodes=C;try{for(var T=o(C),_=T.next();!_.done;_=T.next())_.value._assignedSlot=w}catch(E){m={error:E}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}}n.shadowTree_signalASlotChange=h,n.shadowTree_isConnected=function(w){return l.Guard.isDocumentNode(u.tree_rootNode(w,!0))},n.shadowTree_isAssigned=function(w){return w._assignedSlot!==null},n.shadowTree_findASlot=g,n.shadowTree_findSlotables=p,n.shadowTree_findFlattenedSlotables=function w(m){var y,C,x,S,T=[],_=u.tree_rootNode(m);if(!l.Guard.isShadowRoot(_))return T;var E=p(m);if(d.isEmpty(E))try{for(var D=o(m._children),b=D.next();!b.done;b=D.next()){var I=b.value;l.Guard.isSlotable(I)&&E.push(I)}}catch(G){y={error:G}}finally{try{b&&!b.done&&(C=D.return)&&C.call(D)}finally{if(y)throw y.error}}try{for(var O=o(E),M=O.next();!M.done;M=O.next()){var R=M.value;if(l.Guard.isSlot(R)&&l.Guard.isShadowRoot(u.tree_rootNode(R))){var A=w(R);T.push.apply(T,s(A))}else T.push(R)}}catch(G){x={error:G}}finally{try{M&&!M.done&&(S=O.return)&&S.call(O)}finally{if(x)throw x.error}}return T},n.shadowTree_assignSlotables=v,n.shadowTree_assignSlotablesForATree=function(w){for(var m=u.tree_getFirstDescendantNode(w,!0,!1,(function(y){return l.Guard.isSlot(y)}));m!==null;)v(m),m=u.tree_getNextDescendantNode(w,m,!0,!1,(function(y){return l.Guard.isSlot(y)}))},n.shadowTree_assignASlot=function(w){var m=g(w);m!==null&&v(m)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=/[a-z]([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*/,a=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]),s=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),c=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),l=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);n.customElement_isValidCustomElementName=function(d){return!!o.test(d)&&!a.has(d)},n.customElement_isValidElementName=function(d){return s.has(d)},n.customElement_isVoidElementName=function(d){return c.has(d)},n.customElement_isValidShadowHostName=function(d){return l.has(d)},n.customElement_enqueueACustomElementUpgradeReaction=function(d,u){},n.customElement_enqueueACustomElementCallbackReaction=function(d,u,f){},n.customElement_upgrade=function(d,u){},n.customElement_tryToUpgrade=function(d){},n.customElement_lookUpACustomElementDefinition=function(d,u,f,h){return null}},function(r,n,i){i(4)({target:"String",proto:!0},{repeat:i(259)})},function(r,n,i){i(278),i(68),i(179),i(94),Object.defineProperty(n,"__esModule",{value:!0});var o=i(109),a=(function(){function s(c){this._builderOptions=c,c.parser&&Object.assign(this,c.parser)}return s.prototype._docType=function(c,l,d,u){return c.dtd({name:l,pubID:d,sysID:u})},s.prototype._comment=function(c,l){return c.com(l)},s.prototype._text=function(c,l){return c.txt(l)},s.prototype._instruction=function(c,l,d){return c.ins(l,d)},s.prototype._cdata=function(c,l){return c.dat(l)},s.prototype._element=function(c,l,d){return l===void 0?c.ele(d):c.ele(l,d)},s.prototype._attribute=function(c,l,d,u){return l===void 0?c.att(d,u):c.att(l,d,u)},s.prototype._sanitize=function(c){return o.sanitizeInput(c,this._builderOptions.invalidCharReplacement)},s.prototype._decodeText=function(c){return c==null?c:c.replace(/&(quot|amp|apos|lt|gt);/g,(function(l,d){return s._entityTable[d]})).replace(/&#(?:x([a-fA-F0-9]+)|([0-9]+));/g,(function(l,d,u){return String.fromCodePoint(parseInt(d||u,d?16:10))}))},s.prototype._decodeAttributeValue=function(c){return this._decodeText(c)},s.prototype.parse=function(c,l){return this._parse(c,l)},s.prototype.docType=function(c,l,d,u){return this._docType(c,l,d,u)},s.prototype.comment=function(c,l){return this._comment(c,l)},s.prototype.text=function(c,l){return this._text(c,l)},s.prototype.instruction=function(c,l,d){return this._instruction(c,l,d)},s.prototype.cdata=function(c,l){return this._cdata(c,l)},s.prototype.element=function(c,l,d){return this._element(c,l,d)},s.prototype.attribute=function(c,l,d,u){return this._attribute(c,l,d,u)},s.prototype.sanitize=function(c){return this._sanitize(c)},s._entityTable={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},s})();n.BaseReader=a},function(r,n,i){var o=i(39);r.exports=o.DEFAULT=new o({include:[i(54)],explicit:[i(299),i(300),i(301)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(185);n.XMLBuilderImpl=o.XMLBuilderImpl;var a=i(304);n.XMLBuilderCBImpl=a.XMLBuilderCBImpl;var s=i(183);n.builder=s.builder,n.create=s.create,n.fragment=s.fragment,n.convert=s.convert;var c=i(309);n.createCB=c.createCB,n.fragmentCB=c.fragmentCB},function(r,n){var i;i=(function(){return this})();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}r.exports=i},function(r,n,i){var o={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,s=a&&!o.call({1:2},1);n.f=s?function(c){var l=a(this,c);return!!l&&l.enumerable}:o},function(r,n,i){var o=i(11),a=i(21);r.exports=function(s,c){try{a(o,s,c)}catch{o[s]=c}return c}},function(r,n,i){var o=i(44),a=i(118);(r.exports=function(s,c){return a[s]||(a[s]=c!==void 0?c:{})})("versions",[]).push({version:"3.6.5",mode:o?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(r,n,i){var o=i(121),a=i(84).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(s){return o(s,a)}},function(r,n,i){var o=i(47),a=Math.max,s=Math.min;r.exports=function(c,l){var d=o(c);return d<0?a(d+l,0):s(d,l)}},function(r,n){r.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(r,n){n.f=Object.getOwnPropertySymbols},function(r,n,i){var o=i(8);r.exports=!!Object.getOwnPropertySymbols&&!o((function(){return!String(Symbol())}))},function(r,n,i){var o=i(127);r.exports=function(a,s,c){if(o(a),s===void 0)return a;switch(c){case 0:return function(){return a.call(s)};case 1:return function(l){return a.call(s,l)};case 2:return function(l,d){return a.call(s,l,d)};case 3:return function(l,d,u){return a.call(s,l,d,u)}}return function(){return a.apply(s,arguments)}}},function(r,n,i){var o=i(4),a=i(195),s=i(132),c=i(133),l=i(62),d=i(21),u=i(25),f=i(5),h=i(44),g=i(49),p=i(131),v=p.IteratorPrototype,w=p.BUGGY_SAFARI_ITERATORS,m=f("iterator"),y=function(){return this};r.exports=function(C,x,S,T,_,E,D){a(S,x,T);var b,I,O,M=function(j){if(j===_&&L)return L;if(!w&&j in G)return G[j];switch(j){case"keys":case"values":case"entries":return function(){return new S(this,j)}}return function(){return new S(this)}},R=x+" Iterator",A=!1,G=C.prototype,k=G[m]||G["@@iterator"]||_&&G[_],L=!w&&k||M(_),F=x=="Array"&&G.entries||k;if(F&&(b=s(F.call(new C)),v!==Object.prototype&&b.next&&(h||s(b)===v||(c?c(b,v):typeof b[m]!="function"&&d(b,m,y)),l(b,R,!0,!0),h&&(g[R]=y))),_=="values"&&k&&k.name!=="values"&&(A=!0,L=function(){return k.call(this)}),h&&!D||G[m]===L||d(G,m,L),g[x]=L,_)if(I={values:M("values"),keys:E?L:M("keys"),entries:M("entries")},D)for(O in I)(w||A||!(O in G))&&u(G,O,I[O]);else o({target:x,proto:!0,forced:w||A},I);return I}},function(r,n,i){var o=i(4),a=i(13),s=i(59),c=i(83),l=i(26),d=i(24),u=i(134),f=i(5),h=i(63),g=i(28),p=h("slice"),v=g("slice",{ACCESSORS:!0,0:0,1:2}),w=f("species"),m=[].slice,y=Math.max;o({target:"Array",proto:!0,forced:!p||!v},{slice:function(C,x){var S,T,_,E=d(this),D=l(E.length),b=c(C,D),I=c(x===void 0?D:x,D);if(s(E)&&(typeof(S=E.constructor)!="function"||S!==Array&&!s(S.prototype)?a(S)&&(S=S[w])===null&&(S=void 0):S=void 0,S===Array||S===void 0))return m.call(E,b,I);for(T=new(S===void 0?Array:S)(y(I-b,0)),_=0;b<I;b++,_++)b in E&&u(T,_,E[b]);return T.length=_,T}})},function(r,n,i){var o={};o[i(5)("toStringTag")]="z",r.exports=String(o)==="[object z]"},function(r,n,i){i(19),i(138),i(20),i(92),i(22),i(23),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultBuilderOptions={version:"1.0",encoding:void 0,standalone:void 0,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},invalidCharReplacement:void 0,parser:void 0},n.XMLBuilderOptionKeys=new Set(Object.keys(n.DefaultBuilderOptions)),n.DefaultXMLBuilderCBOptions={format:"xml",wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,spaceBeforeSlash:!1,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}}},function(r,n,i){var o=i(139),a=i(143);r.exports=o("Set",(function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}}),a)},function(r,n,i){var o,a,s=i(136),c=i(221),l=RegExp.prototype.exec,d=String.prototype.replace,u=l,f=(o=/a/,a=/b*/g,l.call(o,"a"),l.call(a,"a"),o.lastIndex!==0||a.lastIndex!==0),h=c.UNSUPPORTED_Y||c.BROKEN_CARET,g=/()??/.exec("")[1]!==void 0;(f||g||h)&&(u=function(p){var v,w,m,y,C=this,x=h&&C.sticky,S=s.call(C),T=C.source,_=0,E=p;return x&&((S=S.replace("y","")).indexOf("g")===-1&&(S+="g"),E=String(p).slice(C.lastIndex),C.lastIndex>0&&(!C.multiline||C.multiline&&p[C.lastIndex-1]!==`
`)&&(T="(?: "+T+")",E=" "+E,_++),w=new RegExp("^(?:"+T+")",S)),g&&(w=new RegExp("^"+T+"$(?!\\s)",S)),f&&(v=C.lastIndex),m=l.call(x?w:C,E),x?m?(m.input=m.input.slice(_),m[0]=m[0].slice(_),m.index=C.lastIndex,C.lastIndex+=m[0].length):C.lastIndex=0:f&&m&&(C.lastIndex=C.global?m.index+m[0].length:v),g&&m&&m.length>1&&d.call(m[0],w,(function(){for(y=1;y<arguments.length-2;y++)arguments[y]===void 0&&(m[y]=void 0)})),m}),r.exports=u},function(r,n,i){var o=i(225),a=i(18),s=i(27),c=i(26),l=i(47),d=i(35),u=i(226),f=i(227),h=Math.max,g=Math.min,p=Math.floor,v=/\$([$&'`]|\d\d?|<[^>]*>)/g,w=/\$([$&'`]|\d\d?)/g;o("replace",2,(function(m,y,C,x){var S=x.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,T=x.REPLACE_KEEPS_$0,_=S?"$":"$0";return[function(D,b){var I=d(this),O=D?.[m];return O!==void 0?O.call(D,I,b):y.call(String(I),D,b)},function(D,b){if(!S&&T||typeof b=="string"&&b.indexOf(_)===-1){var I=C(y,D,this,b);if(I.done)return I.value}var O=a(D),M=String(this),R=typeof b=="function";R||(b=String(b));var A=O.global;if(A){var G=O.unicode;O.lastIndex=0}for(var k=[];;){var L=f(O,M);if(L===null||(k.push(L),!A))break;String(L[0])===""&&(O.lastIndex=u(M,c(O.lastIndex),G))}for(var F,j="",Y=0,ie=0;ie<k.length;ie++){L=k[ie];for(var de=String(L[0]),ae=h(g(l(L.index),M.length),0),fe=[],we=1;we<L.length;we++)fe.push((F=L[we])===void 0?F:String(F));var _e=L.groups;if(R){var Se=[de].concat(fe,ae,M);_e!==void 0&&Se.push(_e);var B=String(b.apply(void 0,Se))}else B=E(de,M,ae,fe,_e,b);ae>=Y&&(j+=M.slice(Y,ae)+B,Y=ae+de.length)}return j+M.slice(Y)}];function E(D,b,I,O,M,R){var A=I+D.length,G=O.length,k=w;return M!==void 0&&(M=s(M),k=v),y.call(R,k,(function(L,F){var j;switch(F.charAt(0)){case"$":return"$";case"&":return D;case"`":return b.slice(0,I);case"'":return b.slice(A);case"<":j=M[F.slice(1,-1)];break;default:var Y=+F;if(Y===0)return L;if(Y>G){var ie=p(Y/10);return ie===0?L:ie<=G?O[ie-1]===void 0?F.charAt(1):O[ie-1]+F.charAt(1):L}j=O[Y-1]}return j===void 0?"":j}))}}))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(){this._items={},this._nullItems=[]}return a.prototype.copy=function(){var s=new a;for(var c in this._items)s._items[c]=this._items[c].slice(0);return s._nullItems=this._nullItems.slice(0),s},a.prototype.get=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;if(l===null)return null;for(var d=null,u=0;u<l.length;u++)if((d=l[u])===s)return d;return d},a.prototype.has=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;return l!==null&&l.indexOf(s)!==-1},a.prototype.hasPrefix=function(s){if(this._nullItems.indexOf(s)!==-1)return!0;for(var c in this._items)if(this._items[c].indexOf(s)!==-1)return!0;return!1},a.prototype.set=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;c!==null&&l===null?this._items[c]=[s]:l.push(s)},a})();n.NamespacePrefixMap=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.Surrogate=/[\uD800-\uDFFF]/,n.ScalarValue=/[\uD800-\uDFFF]/,n.NonCharacter=/[\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]/,n.ASCIICodePoint=/[\u0000-\u007F]/,n.ASCIITabOrNewLine=/[\t\n\r]/,n.ASCIIWhiteSpace=/[\t\n\f\r ]/,n.C0Control=/[\u0000-\u001F]/,n.C0ControlOrSpace=/[\u0000-\u001F ]/,n.Control=/[\u0000-\u001F\u007F-\u009F]/,n.ASCIIDigit=/[0-9]/,n.ASCIIUpperHexDigit=/[0-9A-F]/,n.ASCIILowerHexDigit=/[0-9a-f]/,n.ASCIIHexDigit=/[0-9A-Fa-f]/,n.ASCIIUpperAlpha=/[A-Z]/,n.ASCIILowerAlpha=/[a-z]/,n.ASCIIAlpha=/[A-Za-z]/,n.ASCIIAlphanumeric=/[0-9A-Za-z]/},function(r,n,i){var o=this&&this.__values||function(b){var I=typeof Symbol=="function"&&Symbol.iterator,O=I&&b[I],M=0;if(O)return O.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&M>=b.length&&(b=void 0),{value:b&&b[M++],done:!b}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(b,I){var O=typeof Symbol=="function"&&b[Symbol.iterator];if(!O)return b;var M,R,A=O.call(b),G=[];try{for(;(I===void 0||I-- >0)&&!(M=A.next()).done;)G.push(M.value)}catch(k){R={error:k}}finally{try{M&&!M.done&&(O=A.return)&&O.call(A)}finally{if(R)throw R.error}}return G},s=this&&this.__spread||function(){for(var b=[],I=0;I<arguments.length;I++)b=b.concat(a(arguments[I]));return b};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),d=i(3),u=i(171),f=i(104),h=i(9),g=i(17),p=i(72),v=i(30);function w(b,I){I===void 0&&(I=void 0),I===void 0&&(I=null);var O=m(b,I,new Date,{});return O._isTrusted=!0,O}function m(b,I,O,M){var R=new b("");return R._initializedFlag=!0,R._timeStamp=O.getTime(),Object.assign(R,M),c.dom.features.steps&&v.dom_runEventConstructingSteps(R),R}function y(b,I,O,M){var R,A,G,k;O===void 0&&(O=!1),M===void 0&&(M={value:!1});var L=!1;b._dispatchFlag=!0;var F=I;if(O){var j=I._associatedDocument;d.Guard.isDocumentNode(j)&&(F=j)}var Y=null,ie=g.tree_retarget(b._relatedTarget,I);if(I!==ie||I===b._relatedTarget){var de=[];try{for(var ae=o(b._touchTargetList),fe=ae.next();!fe.done;fe=ae.next()){var we=fe.value;de.push(g.tree_retarget(we,I))}}catch(Ge){R={error:Ge}}finally{try{fe&&!fe.done&&(A=ae.return)&&A.call(ae)}finally{if(R)throw R.error}}C(b,I,F,ie,de,!1);var _e=d.Guard.isMouseEvent(b)&&b._type==="click";_e&&I._activationBehavior!==void 0&&(Y=I);for(var Se=d.Guard.isSlotable(I)&&p.shadowTree_isAssigned(I)?I:null,B=!1,P=I._getTheParent(b);P!==null&&d.Guard.isNode(P);){if(Se!==null){if(!d.Guard.isSlot(P))throw new Error("Parent node of a slotable should be a slot.");Se=null;var $=g.tree_rootNode(P,!0);d.Guard.isShadowRoot($)&&$._mode==="closed"&&(B=!0)}d.Guard.isSlotable(P)&&p.shadowTree_isAssigned(P)&&(Se=P),ie=g.tree_retarget(b._relatedTarget,P),de=[];try{for(var W=(G=void 0,o(b._touchTargetList)),K=W.next();!K.done;K=W.next())we=K.value,de.push(g.tree_retarget(we,P))}catch(Ge){G={error:Ge}}finally{try{K&&!K.done&&(k=W.return)&&k.call(W)}finally{if(G)throw G.error}}d.Guard.isWindow(P)||d.Guard.isNode(P)&&d.Guard.isNode(I)&&g.tree_isAncestorOf(g.tree_rootNode(I,!0),P,!0,!0)?(_e&&b._bubbles&&Y===null&&P._activationBehavior&&(Y=P),C(b,P,null,ie,de,B)):P===ie?P=null:(I=P,_e&&Y===null&&I._activationBehavior&&(Y=I),C(b,P,I,ie,de,B)),P!==null&&(P=P._getTheParent(b)),B=!1}for(var Q=null,ee=b._path,ge=ee.length-1;ge>=0;ge--)if((Le=ee[ge]).shadowAdjustedTarget!==null){Q=Le;break}if(Q!==null)if(d.Guard.isNode(Q.shadowAdjustedTarget)&&d.Guard.isShadowRoot(g.tree_rootNode(Q.shadowAdjustedTarget,!0)))L=!0;else if(d.Guard.isNode(Q.relatedTarget)&&d.Guard.isShadowRoot(g.tree_rootNode(Q.relatedTarget,!0)))L=!0;else for(var De=0;De<Q.touchTargetList.length;De++){var Le=Q.touchTargetList[De];if(d.Guard.isNode(Le)&&d.Guard.isShadowRoot(g.tree_rootNode(Le,!0))){L=!0;break}}for(Y!==null&&Y._legacyPreActivationBehavior!==void 0&&Y._legacyPreActivationBehavior(b),ge=ee.length-1;ge>=0;ge--)(Le=ee[ge]).shadowAdjustedTarget!==null?b._eventPhase=l.EventPhase.AtTarget:b._eventPhase=l.EventPhase.Capturing,x(Le,b,"capturing",M);for(ge=0;ge<ee.length;ge++){if((Le=ee[ge]).shadowAdjustedTarget!==null)b._eventPhase=l.EventPhase.AtTarget;else{if(!b._bubbles)continue;b._eventPhase=l.EventPhase.Bubbling}x(Le,b,"bubbling",M)}}return b._eventPhase=l.EventPhase.None,b._currentTarget=null,b._path=[],b._dispatchFlag=!1,b._stopPropagationFlag=!1,b._stopImmediatePropagationFlag=!1,L&&(b._target=null,b._relatedTarget=null,b._touchTargetList=[]),Y!==null&&(b._canceledFlag||Y._activationBehavior===void 0?Y._legacyCanceledActivationBehavior!==void 0&&Y._legacyCanceledActivationBehavior(b):Y._activationBehavior(b)),!b._canceledFlag}function C(b,I,O,M,R,A){var G=!1;d.Guard.isNode(I)&&d.Guard.isShadowRoot(g.tree_rootNode(I))&&(G=!0);var k=!1;d.Guard.isShadowRoot(I)&&I._mode==="closed"&&(k=!0),b._path.push({invocationTarget:I,invocationTargetInShadowTree:G,shadowAdjustedTarget:O,relatedTarget:M,touchTargetList:R,rootOfClosedTree:k,slotInClosedTree:A})}function x(b,I,O,M){M===void 0&&(M={value:!1});for(var R=I._path,A=-1,G=0;G<R.length;G++)if(R[G]===b){A=G;break}if(A!==-1){var k=R[A];(k.shadowAdjustedTarget!==null||A>0&&(k=R[A-1]).shadowAdjustedTarget!==null)&&(I._target=k.shadowAdjustedTarget)}if(I._relatedTarget=b.relatedTarget,I._touchTargetList=b.touchTargetList,!I._stopPropagationFlag){I._currentTarget=b.invocationTarget;var L=I._currentTarget._eventListenerList,F=new(Array.bind.apply(Array,s([void 0],L)));if(!S(I,F,O,b,M)&&I._isTrusted){var j=I._type;j==="animationend"?I._type="webkitAnimationEnd":j==="animationiteration"?I._type="webkitAnimationIteration":j==="animationstart"?I._type="webkitAnimationStart":j==="transitionend"&&(I._type="webkitTransitionEnd"),S(I,F,O,b,M),I._type=j}}}function S(b,I,O,M,R){R===void 0&&(R={value:!1});for(var A=!1,G=0;G<I.length;G++){var k=I[G];if(!k.removed){if(b._type!==k.type||(A=!0,O==="capturing"&&!k.capture)||O==="bubbling"&&k.capture)continue;if(k.once&&b._currentTarget!==null){for(var L=b._currentTarget,F=-1,j=0;j<L._eventListenerList.length;j++)if(L._eventListenerList[j]===k){F=j;break}F!==-1&&L._eventListenerList.splice(F,1)}var Y=void 0,ie=void 0;d.Guard.isWindow(Y)&&(ie=Y._currentEvent,M.invocationTargetInShadowTree===!1&&(Y._currentEvent=b)),k.passive&&(b._inPassiveListenerFlag=!0);try{k.callback.handleEvent.call(b._currentTarget,b)}catch{R.value=!0}if(k.passive&&(b._inPassiveListenerFlag=!1),d.Guard.isWindow(Y)&&(Y._currentEvent=ie),b._stopImmediatePropagationFlag)return A}}return A}function T(b,I){return null}function _(b,I){return null}function E(b,I){}function D(b,I){}n.event_setTheCanceledFlag=function(b){b._cancelable&&!b._inPassiveListenerFlag&&(b._canceledFlag=!0)},n.event_initialize=function(b,I,O,M){b._initializedFlag=!0,b._stopPropagationFlag=!1,b._stopImmediatePropagationFlag=!1,b._canceledFlag=!1,b._isTrusted=!1,b._target=null,b._type=I,b._bubbles=O,b._cancelable=M},n.event_createAnEvent=w,n.event_innerEventCreationSteps=m,n.event_dispatch=y,n.event_appendToAnEventPath=C,n.event_invoke=x,n.event_innerInvoke=S,n.event_fireAnEvent=function(b,I,O,M,R){O===void 0&&(O=f.EventImpl);var A=w(O);if(A._type=b,M)for(var G in M)A[G]=M[G];return y(A,I,R)},n.event_createLegacyEvent=function(b){var I=null;switch(b.toLowerCase()){case"beforeunloadevent":case"compositionevent":break;case"customevent":I=u.CustomEventImpl;break;case"devicemotionevent":case"deviceorientationevent":case"dragevent":break;case"event":case"events":I=f.EventImpl}if(I===null)throw new h.NotSupportedError("Event constructor not found for interface "+b+".");var O=new I("");return O._type="",O._timeStamp=new Date().getTime(),O._isTrusted=!1,O._initializedFlag=!1,O},n.event_getterEventHandlerIDLAttribute=function(b,I){return null},n.event_setterEventHandlerIDLAttribute=function(b,I,O){},n.event_determineTheTargetOfAnEventHandler=T,n.event_getTheCurrentValueOfAnEventHandler=_,n.event_activateAnEventHandler=E,n.event_deactivateAnEventHandler=D},function(r,n,i){var o,a=this&&this.__extends||(o=function(C,x){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,T){S.__proto__=T}||function(S,T){for(var _ in T)T.hasOwnProperty(_)&&(S[_]=T[_])})(C,x)},function(C,x){function S(){this.constructor=C}o(C,x),C.prototype=x===null?Object.create(x):(S.prototype=x.prototype,new S)}),s=this&&this.__values||function(C){var x=typeof Symbol=="function"&&Symbol.iterator,S=x&&C[x],T=0;if(S)return S.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&T>=C.length&&(C=void 0),{value:C&&C[T++],done:!C}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(C,x){var S=typeof Symbol=="function"&&C[Symbol.iterator];if(!S)return C;var T,_,E=S.call(C),D=[];try{for(;(x===void 0||x-- >0)&&!(T=E.next()).done;)D.push(T.value)}catch(b){_={error:b}}finally{try{T&&!T.done&&(S=E.return)&&S.call(E)}finally{if(_)throw _.error}}return D};Object.defineProperty(n,"__esModule",{value:!0});var l=i(6),d=i(2),u=i(9),f=i(34),h=i(3),g=i(1),p=i(7),v=i(152),w=i(0),m=i(12),y=(function(C){function x(){var S=C.call(this)||this;return S._children=new Set,S._encoding={name:"UTF-8",labels:["unicode-1-1-utf-8","utf-8","utf8"]},S._contentType="application/xml",S._URL={scheme:"about",username:"",password:"",host:null,port:null,path:["blank"],query:null,fragment:null,_cannotBeABaseURLFlag:!0,_blobURLEntry:null},S._origin=null,S._type="xml",S._mode="no-quirks",S._documentElement=null,S._hasNamespaces=!1,S._nodeDocumentOverwrite=null,S}return a(x,C),Object.defineProperty(x.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverwrite||this},set:function(S){this._nodeDocumentOverwrite=S},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"implementation",{get:function(){return this._implementation||(this._implementation=w.create_domImplementation(this))},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"URL",{get:function(){return v.urlSerializer(this._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"documentURI",{get:function(){return this.URL},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"origin",{get:function(){return"null"},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"compatMode",{get:function(){return this._mode==="quirks"?"BackCompat":"CSS1Compat"},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"characterSet",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"charset",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"inputEncoding",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"doctype",{get:function(){var S,T;try{for(var _=s(this._children),E=_.next();!E.done;E=_.next()){var D=E.value;if(h.Guard.isDocumentTypeNode(D))return D}}catch(b){S={error:b}}finally{try{E&&!E.done&&(T=_.return)&&T.call(_)}finally{if(S)throw S.error}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"documentElement",{get:function(){return this._documentElement},enumerable:!0,configurable:!0}),x.prototype.getElementsByTagName=function(S){return w.node_listOfElementsWithQualifiedName(S,this)},x.prototype.getElementsByTagNameNS=function(S,T){return w.node_listOfElementsWithNamespace(S,T,this)},x.prototype.getElementsByClassName=function(S){return w.node_listOfElementsWithClassNames(S,this)},x.prototype.createElement=function(S,T){if(!w.xml_isName(S))throw new u.InvalidCharacterError;this._type==="html"&&(S=S.toLowerCase());var _=null;T!==void 0&&(_=g.isString(T)?T:T.is);var E=this._type==="html"||this._contentType==="application/xhtml+xml"?p.namespace.HTML:null;return w.element_createAnElement(this,S,E,null,_,!0)},x.prototype.createElementNS=function(S,T,_){return w.document_internalCreateElementNS(this,S,T,_)},x.prototype.createDocumentFragment=function(){return w.create_documentFragment(this)},x.prototype.createTextNode=function(S){return w.create_text(this,S)},x.prototype.createCDATASection=function(S){if(this._type==="html")throw new u.NotSupportedError;if(S.indexOf("]]>")!==-1)throw new u.InvalidCharacterError;return w.create_cdataSection(this,S)},x.prototype.createComment=function(S){return w.create_comment(this,S)},x.prototype.createProcessingInstruction=function(S,T){if(!w.xml_isName(S))throw new u.InvalidCharacterError;if(T.indexOf("?>")!==-1)throw new u.InvalidCharacterError;return w.create_processingInstruction(this,S,T)},x.prototype.importNode=function(S,T){if(T===void 0&&(T=!1),h.Guard.isDocumentNode(S)||h.Guard.isShadowRoot(S))throw new u.NotSupportedError;return w.node_clone(S,this,T)},x.prototype.adoptNode=function(S){if(h.Guard.isDocumentNode(S))throw new u.NotSupportedError;if(h.Guard.isShadowRoot(S))throw new u.HierarchyRequestError;return w.document_adopt(S,this),S},x.prototype.createAttribute=function(S){if(!w.xml_isName(S))throw new u.InvalidCharacterError;return this._type==="html"&&(S=S.toLowerCase()),w.create_attr(this,S)},x.prototype.createAttributeNS=function(S,T){var _=c(w.namespace_validateAndExtract(S,T),3),E=_[0],D=_[1],b=_[2],I=w.create_attr(this,b);return I._namespace=E,I._namespacePrefix=D,I},x.prototype.createEvent=function(S){return w.event_createLegacyEvent(S)},x.prototype.createRange=function(){var S=w.create_range();return S._start=[this,0],S._end=[this,0],S},x.prototype.createNodeIterator=function(S,T,_){T===void 0&&(T=d.WhatToShow.All),_===void 0&&(_=null);var E=w.create_nodeIterator(S,S,!0);return E._whatToShow=T,E._iteratorCollection=w.create_nodeList(S),g.isFunction(_)?(E._filter=w.create_nodeFilter(),E._filter.acceptNode=_):E._filter=_,E},x.prototype.createTreeWalker=function(S,T,_){T===void 0&&(T=d.WhatToShow.All),_===void 0&&(_=null);var E=w.create_treeWalker(S,S);return E._whatToShow=T,g.isFunction(_)?(E._filter=w.create_nodeFilter(),E._filter.acceptNode=_):E._filter=_,E},x.prototype._getTheParent=function(S){return S._type==="load"?null:l.dom.window},x.prototype.getElementById=function(S){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(x.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),x.prototype.prepend=function(){for(var S=[],T=0;T<arguments.length;T++)S[T]=arguments[T];throw new Error("Mixin: ParentNode not implemented.")},x.prototype.append=function(){for(var S=[],T=0;T<arguments.length;T++)S[T]=arguments[T];throw new Error("Mixin: ParentNode not implemented.")},x.prototype.querySelector=function(S){throw new Error("Mixin: ParentNode not implemented.")},x.prototype.querySelectorAll=function(S){throw new Error("Mixin: ParentNode not implemented.")},x})(f.NodeImpl);n.DocumentImpl=y,m.idl_defineConst(y.prototype,"_nodeType",d.NodeType.Document)},function(r,n,i){var o,a=this&&this.__extends||(o=function(v,w){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,y){m.__proto__=y}||function(m,y){for(var C in y)y.hasOwnProperty(C)&&(m[C]=y[C])})(v,w)},function(v,w){function m(){this.constructor=v}o(v,w),v.prototype=w===null?Object.create(w):(m.prototype=w.prototype,new m)}),s=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,m=w&&v[w],y=0;if(m)return m.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&y>=v.length&&(v=void 0),{value:v&&v[y++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(v,w){var m=typeof Symbol=="function"&&v[Symbol.iterator];if(!m)return v;var y,C,x=m.call(v),S=[];try{for(;(w===void 0||w-- >0)&&!(y=x.next()).done;)S.push(y.value)}catch(T){C={error:T}}finally{try{y&&!y.done&&(m=x.return)&&m.call(x)}finally{if(C)throw C.error}}return S};Object.defineProperty(n,"__esModule",{value:!0});var l=i(2),d=i(34),u=i(9),f=i(7),h=i(0),g=i(12),p=(function(v){function w(){var m=v.call(this)||this;return m._children=new Set,m._namespace=null,m._namespacePrefix=null,m._localName="",m._customElementState="undefined",m._customElementDefinition=null,m._is=null,m._shadowRoot=null,m._attributeList=h.create_namedNodeMap(m),m._attributeChangeSteps=[],m._name="",m._assignedSlot=null,m}return a(w,v),Object.defineProperty(w.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"tagName",{get:function(){return this._htmlUppercasedQualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"id",{get:function(){return h.element_getAnAttributeValue(this,"id")},set:function(m){h.element_setAnAttributeValue(this,"id",m)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"className",{get:function(){return h.element_getAnAttributeValue(this,"class")},set:function(m){h.element_setAnAttributeValue(this,"class",m)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"classList",{get:function(){var m=h.element_getAnAttributeByName("class",this);return m===null&&(m=h.create_attr(this._nodeDocument,"class")),h.create_domTokenList(this,m)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"slot",{get:function(){return h.element_getAnAttributeValue(this,"slot")},set:function(m){h.element_setAnAttributeValue(this,"slot",m)},enumerable:!0,configurable:!0}),w.prototype.hasAttributes=function(){return this._attributeList.length!==0},Object.defineProperty(w.prototype,"attributes",{get:function(){return this._attributeList},enumerable:!0,configurable:!0}),w.prototype.getAttributeNames=function(){var m,y,C=[];try{for(var x=s(this._attributeList),S=x.next();!S.done;S=x.next()){var T=S.value;C.push(T._qualifiedName)}}catch(_){m={error:_}}finally{try{S&&!S.done&&(y=x.return)&&y.call(x)}finally{if(m)throw m.error}}return C},w.prototype.getAttribute=function(m){var y=h.element_getAnAttributeByName(m,this);return y?y._value:null},w.prototype.getAttributeNS=function(m,y){var C=h.element_getAnAttributeByNamespaceAndLocalName(m,y,this);return C?C._value:null},w.prototype.setAttribute=function(m,y){if(!h.xml_isName(m))throw new u.InvalidCharacterError;this._namespace===f.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toLowerCase());for(var C=null,x=0;x<this._attributeList.length;x++){var S=this._attributeList[x];if(S._qualifiedName===m){C=S;break}}if(C===null)return(C=h.create_attr(this._nodeDocument,m))._value=y,void h.element_append(C,this);h.element_change(C,this,y)},w.prototype.setAttributeNS=function(m,y,C){var x=c(h.namespace_validateAndExtract(m,y),3),S=x[0],T=x[1],_=x[2];h.element_setAnAttributeValue(this,_,C,T,S)},w.prototype.removeAttribute=function(m){h.element_removeAnAttributeByName(m,this)},w.prototype.removeAttributeNS=function(m,y){h.element_removeAnAttributeByNamespaceAndLocalName(m,y,this)},w.prototype.hasAttribute=function(m){this._namespace===f.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toLowerCase());for(var y=0;y<this._attributeList.length;y++)if(this._attributeList[y]._qualifiedName===m)return!0;return!1},w.prototype.toggleAttribute=function(m,y){if(!h.xml_isName(m))throw new u.InvalidCharacterError;this._namespace===f.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toLowerCase());for(var C=null,x=0;x<this._attributeList.length;x++){var S=this._attributeList[x];if(S._qualifiedName===m){C=S;break}}return C===null?(y===void 0||y===!0)&&((C=h.create_attr(this._nodeDocument,m))._value="",h.element_append(C,this),!0):y!==void 0&&y!==!1||(h.element_removeAnAttributeByName(m,this),!1)},w.prototype.hasAttributeNS=function(m,y){for(var C=m||null,x=0;x<this._attributeList.length;x++){var S=this._attributeList[x];if(S._namespace===C&&S._localName===y)return!0}return!1},w.prototype.getAttributeNode=function(m){return h.element_getAnAttributeByName(m,this)},w.prototype.getAttributeNodeNS=function(m,y){return h.element_getAnAttributeByNamespaceAndLocalName(m,y,this)},w.prototype.setAttributeNode=function(m){return h.element_setAnAttribute(m,this)},w.prototype.setAttributeNodeNS=function(m){return h.element_setAnAttribute(m,this)},w.prototype.removeAttributeNode=function(m){for(var y=!1,C=0;C<this._attributeList.length;C++)if(this._attributeList[C]===m){y=!0;break}if(!y)throw new u.NotFoundError;return h.element_remove(m,this),m},w.prototype.attachShadow=function(m){if(this._namespace!==f.namespace.HTML)throw new u.NotSupportedError;if(!h.customElement_isValidCustomElementName(this._localName)&&!h.customElement_isValidShadowHostName(this._localName))throw new u.NotSupportedError;if(h.customElement_isValidCustomElementName(this._localName)||this._is!==null){var y=h.customElement_lookUpACustomElementDefinition(this._nodeDocument,this._namespace,this._localName,this._is);if(y!==null&&y.disableShadow===!0)throw new u.NotSupportedError}if(this._shadowRoot!==null)throw new u.NotSupportedError;var C=h.create_shadowRoot(this._nodeDocument,this);return C._mode=m.mode,this._shadowRoot=C,C},Object.defineProperty(w.prototype,"shadowRoot",{get:function(){var m=this._shadowRoot;return m===null||m.mode==="closed"?null:m},enumerable:!0,configurable:!0}),w.prototype.closest=function(m){throw new u.NotImplementedError},w.prototype.matches=function(m){throw new u.NotImplementedError},w.prototype.webkitMatchesSelector=function(m){return this.matches(m)},w.prototype.getElementsByTagName=function(m){return h.node_listOfElementsWithQualifiedName(m,this)},w.prototype.getElementsByTagNameNS=function(m,y){return h.node_listOfElementsWithNamespace(m,y,this)},w.prototype.getElementsByClassName=function(m){return h.node_listOfElementsWithClassNames(m,this)},w.prototype.insertAdjacentElement=function(m,y){return h.element_insertAdjacent(this,m,y)},w.prototype.insertAdjacentText=function(m,y){var C=h.create_text(this._nodeDocument,y);h.element_insertAdjacent(this,m,C)},Object.defineProperty(w.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"_htmlUppercasedQualifiedName",{get:function(){var m=this._qualifiedName;return this._namespace===f.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toUpperCase()),m},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),w.prototype.prepend=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ParentNode not implemented.")},w.prototype.append=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ParentNode not implemented.")},w.prototype.querySelector=function(m){throw new Error("Mixin: ParentNode not implemented.")},w.prototype.querySelectorAll=function(m){throw new Error("Mixin: ParentNode not implemented.")},Object.defineProperty(w.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),w.prototype.before=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.after=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.replaceWith=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},Object.defineProperty(w.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),w._create=function(m,y,C,x){C===void 0&&(C=null),x===void 0&&(x=null);var S=new w;return S._localName=y,S._namespace=C,S._namespacePrefix=x,S._nodeDocument=m,S},w})(d.NodeImpl);n.ElementImpl=p,g.idl_defineConst(p.prototype,"_nodeType",l.NodeType.Element)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(12),d=(function(u){function f(h){h===void 0&&(h=null);var g=u.call(this)||this;return g._children=new Set,g._host=h,g}return a(f,u),f.prototype.getElementById=function(h){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(f.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),f.prototype.prepend=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ParentNode not implemented.")},f.prototype.append=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ParentNode not implemented.")},f.prototype.querySelector=function(h){throw new Error("Mixin: ParentNode not implemented.")},f.prototype.querySelectorAll=function(h){throw new Error("Mixin: ParentNode not implemented.")},f._create=function(h,g){g===void 0&&(g=null);var p=new f(g);return p._nodeDocument=h,p},f})(c.NodeImpl);n.DocumentFragmentImpl=d,l.idl_defineConst(d.prototype,"_nodeType",s.NodeType.DocumentFragment)},function(r,n,i){var o,a=this&&this.__extends||(o=function(h,g){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,v){p.__proto__=v}||function(p,v){for(var w in v)v.hasOwnProperty(w)&&(p[w]=v[w])})(h,g)},function(h,g){function p(){this.constructor=h}o(h,g),h.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),s=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(71),d=i(0),u=i(12),f=(function(h){function g(p){p===void 0&&(p="");var v=h.call(this,p)||this;return v._name="",v._assignedSlot=null,v}return a(g,h),Object.defineProperty(g.prototype,"wholeText",{get:function(){var p,v,w="";try{for(var m=s(d.text_contiguousTextNodes(this,!0)),y=m.next();!y.done;y=m.next())w+=y.value._data}catch(C){p={error:C}}finally{try{y&&!y.done&&(v=m.return)&&v.call(m)}finally{if(p)throw p.error}}return w},enumerable:!0,configurable:!0}),g.prototype.splitText=function(p){return d.text_split(this,p)},Object.defineProperty(g.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),g._create=function(p,v){v===void 0&&(v="");var w=new g(v);return w._nodeDocument=p,w},g})(l.CharacterDataImpl);n.TextImpl=f,u.idl_defineConst(f.prototype,"_nodeType",c.NodeType.Text)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(){}return Object.defineProperty(a.prototype,"_startNode",{get:function(){return this._start[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_startOffset",{get:function(){return this._start[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_endNode",{get:function(){return this._end[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_endOffset",{get:function(){return this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_collapsed",{get:function(){return this._start[0]===this._end[0]&&this._start[1]===this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"startContainer",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"endContainer",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"endOffset",{get:function(){return this._endOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"collapsed",{get:function(){return this._collapsed},enumerable:!0,configurable:!0}),a})();n.AbstractRangeImpl=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=(function(){function s(c){this._activeFlag=!1,this._root=c,this._whatToShow=o.WhatToShow.All,this._filter=null}return Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"whatToShow",{get:function(){return this._whatToShow},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),s})();n.TraverserImpl=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(0),s=i(12),c=(function(){function l(d,u){this._target=null,this._relatedTarget=null,this._touchTargetList=[],this._path=[],this._currentTarget=null,this._eventPhase=o.EventPhase.None,this._stopPropagationFlag=!1,this._stopImmediatePropagationFlag=!1,this._canceledFlag=!1,this._inPassiveListenerFlag=!1,this._composedFlag=!1,this._initializedFlag=!1,this._dispatchFlag=!1,this._isTrusted=!1,this._bubbles=!1,this._cancelable=!1,this._type=d,u&&(this._bubbles=u.bubbles||!1,this._cancelable=u.cancelable||!1,this._composedFlag=u.composed||!1),this._initializedFlag=!0,this._timeStamp=new Date().getTime()}return Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"srcElement",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),l.prototype.composedPath=function(){var d=[],u=this._path;if(u.length===0)return d;var f=this._currentTarget;if(f===null)throw new Error("Event currentTarget is null.");d.push(f);for(var h=0,g=0,p=u.length-1;p>=0;){if(u[p].rootOfClosedTree&&g++,u[p].invocationTarget===f){h=p;break}u[p].slotInClosedTree&&g--,p--}var v=g,w=g;for(p=h-1;p>=0;)u[p].rootOfClosedTree&&v++,v<=w&&d.unshift(u[p].invocationTarget),u[p].slotInClosedTree&&--v<w&&(w=v),p--;for(v=g,w=g,p=h+1;p<u.length;)u[p].slotInClosedTree&&v++,v<=w&&d.push(u[p].invocationTarget),u[p].rootOfClosedTree&&--v<w&&(w=v),p++;return d},Object.defineProperty(l.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),l.prototype.stopPropagation=function(){this._stopPropagationFlag=!0},Object.defineProperty(l.prototype,"cancelBubble",{get:function(){return this._stopPropagationFlag},set:function(d){d&&this.stopPropagation()},enumerable:!0,configurable:!0}),l.prototype.stopImmediatePropagation=function(){this._stopPropagationFlag=!0,this._stopImmediatePropagationFlag=!0},Object.defineProperty(l.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"returnValue",{get:function(){return!this._canceledFlag},set:function(d){d||a.event_setTheCanceledFlag(this)},enumerable:!0,configurable:!0}),l.prototype.preventDefault=function(){a.event_setTheCanceledFlag(this)},Object.defineProperty(l.prototype,"defaultPrevented",{get:function(){return this._canceledFlag},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"composed",{get:function(){return this._composedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isTrusted",{get:function(){return this._isTrusted},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),l.prototype.initEvent=function(d,u,f){u===void 0&&(u=!1),f===void 0&&(f=!1),this._dispatchFlag||a.event_initialize(this,d,u,f)},l.NONE=0,l.CAPTURING_PHASE=1,l.AT_TARGET=2,l.BUBBLING_PHASE=3,l})();n.EventImpl=c,s.idl_defineConst(c.prototype,"NONE",0),s.idl_defineConst(c.prototype,"CAPTURING_PHASE",1),s.idl_defineConst(c.prototype,"AT_TARGET",2),s.idl_defineConst(c.prototype,"BUBBLING_PHASE",3)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(9);n.traversal_filter=function(s,c){if(s._activeFlag)throw new a.InvalidStateError;var l=1<<c._nodeType-1;if((s.whatToShow&l)==0)return o.FilterResult.Skip;if(!s.filter)return o.FilterResult.Accept;s._activeFlag=!0;var d=o.FilterResult.Reject;try{d=s.filter.acceptNode(c)}catch(u){throw s._activeFlag=!1,u}return s._activeFlag=!1,d}},function(r,n,i){var o=this&&this.__read||function(w,m){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var C,x,S=y.call(w),T=[];try{for(;(m===void 0||m-- >0)&&!(C=S.next()).done;)T.push(C.value)}catch(_){x={error:_}}finally{try{C&&!C.done&&(y=S.return)&&y.call(S)}finally{if(x)throw x.error}}return T},a=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(6),c=i(3),l=i(1),d=i(99),u=i(73),f=i(17),h=i(173),g=i(30),p=i(52),v=i(37);n.document_elementInterface=function(w,m){return d.ElementImpl},n.document_internalCreateElementNS=function(w,m,y,C){var x=o(h.namespace_validateAndExtract(m,y),3),S=x[0],T=x[1],_=x[2],E=null;return C!==void 0&&(E=l.isString(C)?C:C.is),p.element_createAnElement(w,_,S,T,E,!0)},n.document_adopt=function(w,m){var y,C;if(w._nodeDocument!==m||w._parent!==null){var x=w._nodeDocument;if(w._parent&&v.mutation_remove(w,w._parent),m!==x)for(var S=f.tree_getFirstDescendantNode(w,!0,!0);S!==null;){if(S._nodeDocument=m,c.Guard.isElementNode(S))try{for(var T=(y=void 0,a(S._attributeList._asArray())),_=T.next();!_.done;_=T.next())_.value._nodeDocument=m}catch(E){y={error:E}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(y)throw y.error}}s.dom.features.customElements&&c.Guard.isElementNode(S)&&S._customElementState==="custom"&&u.customElement_enqueueACustomElementCallbackReaction(S,"adoptedCallback",[x,m]),s.dom.features.steps&&g.dom_runAdoptingSteps(S,x),S=f.tree_getNextDescendantNode(w,S,!0,!0)}}}},function(r,n,i){var o=this&&this.__values||function(f){var h=typeof Symbol=="function"&&Symbol.iterator,g=h&&f[h],p=0;if(g)return g.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&p>=f.length&&(f=void 0),{value:f&&f[p++],done:!f}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(9),l=i(17),d=i(51),u=i(30);n.characterData_replaceData=function(f,h,g,p){var v,w,m=l.tree_nodeLength(f);if(h>m)throw new c.IndexSizeError("Offset exceeds character data length. Offset: "+h+", Length: "+m+", Node is "+f.nodeName+".");h+g>m&&(g=m-h),a.dom.features.mutationObservers&&d.observer_queueMutationRecord("characterData",f,null,null,f._data,[],[],null,null);var y=f._data.substring(0,h)+p+f._data.substring(h+g);f._data=y;try{for(var C=o(a.dom.rangeList),x=C.next();!x.done;x=C.next()){var S=x.value;S._start[0]===f&&S._start[1]>h&&S._start[1]<=h+g&&(S._start[1]=h),S._end[0]===f&&S._end[1]>h&&S._end[1]<=h+g&&(S._end[1]=h),S._start[0]===f&&S._start[1]>h+g&&(S._start[1]+=p.length-g),S._end[0]===f&&S._end[1]>h+g&&(S._end[1]+=p.length-g)}}catch(T){v={error:T}}finally{try{x&&!x.done&&(w=C.return)&&w.call(C)}finally{if(v)throw v.error}}a.dom.features.steps&&s.Guard.isTextNode(f)&&f._parent!==null&&u.dom_runChildTextContentChangeSteps(f._parent)},n.characterData_substringData=function(f,h,g){var p=l.tree_nodeLength(f);if(h>p)throw new c.IndexSizeError("Offset exceeds character data length. Offset: "+h+", Length: "+p+", Node is "+f.nodeName+".");return h+g>p?f._data.substr(h):f._data.substr(h,g)}},function(r,n,i){var o=this&&this.__read||function(u,f){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var g,p,v=h.call(u),w=[];try{for(;(f===void 0||f-- >0)&&!(g=v.next()).done;)w.push(g.value)}catch(m){p={error:m}}finally{try{g&&!g.done&&(h=v.return)&&h.call(v)}finally{if(p)throw p.error}}return w},a=this&&this.__spread||function(){for(var u=[],f=0;f<arguments.length;f++)u=u.concat(o(arguments[f]));return u},s=this&&this.__values||function(u){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&u[f],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(7);function l(u){var f=c.string.splitAStringOnASCIIWhitespace(u);return new Set(f)}function d(u){return a(u).join(" ")}n.orderedSet_parse=l,n.orderedSet_serialize=d,n.orderedSet_sanitize=function(u){return d(l(u))},n.orderedSet_contains=function(u,f,h){var g,p,v,w;try{for(var m=s(f),y=m.next();!y.done;y=m.next()){var C=y.value,x=!1;try{for(var S=(v=void 0,s(u)),T=S.next();!T.done;T=S.next()){var _=T.value;if(h){if(_===C){x=!0;break}}else if(_.toUpperCase()===C.toUpperCase()){x=!0;break}}}catch(E){v={error:E}}finally{try{T&&!T.done&&(w=S.return)&&w.call(S)}finally{if(v)throw v.error}}if(!x)return!1}}catch(E){g={error:E}}finally{try{y&&!y.done&&(p=m.return)&&p.call(m)}finally{if(g)throw g.error}}return!0}},function(r,n,i){i(179),Object.defineProperty(n,"__esModule",{value:!0});var o=i(262),a=i(110),s=i(1);a.dom.setFeatures(!1),n.createDocument=function(){var c=new o.DOMImplementation().createDocument(null,"root",null);return c.documentElement&&c.removeChild(c.documentElement),c},n.sanitizeInput=function(c,l){if(c==null)return c;if(l===void 0)return c+"";var d="";c+="";for(var u=0;u<c.length;u++){var f=c.charCodeAt(u);if(f===9||f===10||f===13||f>=32&&f<=55295||f>=57344&&f<=65533)d+=c.charAt(u);else if(f>=55296&&f<=56319&&u<c.length-1){var h=c.charCodeAt(u+1);h>=56320&&h<=57343?(f=1024*(f-55296)+h-56320+65536,d+=String.fromCodePoint(f),u++):d+=s.isString(l)?l:l(c.charAt(u),u,c)}else d+=s.isString(l)?l:l(c.charAt(u),u,c)}return d}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(1),a=i(153);n.AbortController=a.AbortControllerImpl;var s=i(154);n.AbortSignal=s.AbortSignalImpl;var c=i(102);n.AbstractRange=c.AbstractRangeImpl;var l=i(157);n.Attr=l.AttrImpl;var d=i(158);n.CDATASection=d.CDATASectionImpl;var u=i(71);n.CharacterData=u.CharacterDataImpl;var f=i(263),h=i(159);n.Comment=h.CommentImpl;var g=i(171);n.CustomEvent=g.CustomEventImpl;var p=i(100);n.DocumentFragment=p.DocumentFragmentImpl;var v=i(98);n.Document=v.DocumentImpl;var w=i(264),m=i(155);n.DocumentType=m.DocumentTypeImpl;var y=i(6);n.dom=y.dom;var C=i(148);n.DOMImplementation=C.DOMImplementationImpl;var x=i(170);n.DOMTokenList=x.DOMTokenListImpl;var S=i(99);n.Element=S.ElementImpl;var T=i(104);n.Event=T.EventImpl;var _=i(70);n.EventTarget=_.EventTargetImpl;var E=i(161);n.HTMLCollection=E.HTMLCollectionImpl;var D=i(265);n.MutationObserver=D.MutationObserverImpl;var b=i(169);n.MutationRecord=b.MutationRecordImpl;var I=i(164);n.NamedNodeMap=I.NamedNodeMapImpl;var O=i(168);n.NodeFilter=O.NodeFilterImpl;var M=i(34);n.Node=M.NodeImpl;var R=i(166);n.NodeIterator=R.NodeIteratorImpl;var A=i(162);n.NodeList=A.NodeListImpl;var G=i(163);n.NodeListStatic=G.NodeListStaticImpl;var k=i(266),L=i(267),F=i(268),j=i(160);n.ProcessingInstruction=j.ProcessingInstructionImpl;var Y=i(165);n.Range=Y.RangeImpl;var ie=i(156);n.ShadowRoot=ie.ShadowRootImpl;var de=i(269),ae=i(270);n.StaticRange=ae.StaticRangeImpl;var fe=i(101);n.Text=fe.TextImpl;var we=i(103);n.Traverser=we.TraverserImpl;var _e=i(167);n.TreeWalker=_e.TreeWalkerImpl;var Se=i(149);n.Window=Se.WindowImpl;var B=i(151);n.XMLDocument=B.XMLDocumentImpl,o.applyMixin(S.ElementImpl,f.ChildNodeImpl),o.applyMixin(u.CharacterDataImpl,f.ChildNodeImpl),o.applyMixin(m.DocumentTypeImpl,f.ChildNodeImpl),o.applyMixin(v.DocumentImpl,w.DocumentOrShadowRootImpl),o.applyMixin(ie.ShadowRootImpl,w.DocumentOrShadowRootImpl),o.applyMixin(S.ElementImpl,k.NonDocumentTypeChildNodeImpl),o.applyMixin(u.CharacterDataImpl,k.NonDocumentTypeChildNodeImpl),o.applyMixin(v.DocumentImpl,L.NonElementParentNodeImpl),o.applyMixin(p.DocumentFragmentImpl,L.NonElementParentNodeImpl),o.applyMixin(v.DocumentImpl,F.ParentNodeImpl),o.applyMixin(p.DocumentFragmentImpl,F.ParentNodeImpl),o.applyMixin(S.ElementImpl,F.ParentNodeImpl),o.applyMixin(fe.TextImpl,de.SlotableImpl),o.applyMixin(S.ElementImpl,de.SlotableImpl)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),(function(o){o[o.EOF=0]="EOF",o[o.Declaration=1]="Declaration",o[o.DocType=2]="DocType",o[o.Element=3]="Element",o[o.Text=4]="Text",o[o.CDATA=5]="CDATA",o[o.PI=6]="PI",o[o.Comment=7]="Comment",o[o.ClosingTag=8]="ClosingTag"})(n.TokenType||(n.TokenType={}))},function(r,n,i){i(64),i(20),i(66);var o,a=this&&this.__extends||(o=function(l,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)f.hasOwnProperty(h)&&(u[h]=f[h])})(l,d)},function(l,d){function u(){this.constructor=l}o(l,d),l.prototype=d===null?Object.create(d):(u.prototype=d.prototype,new u)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=(function(l){function d(){return l!==null&&l.apply(this,arguments)||this}return a(d,l),d.prototype._parse=function(u,f){var h=this,g=this._builderOptions,p=null;return s.isFunction(f)?p=this.parse(u,f.apply(this)):s.isArray(f)||s.isSet(f)?s.forEachArray(f,(function(v){return p=h.parse(u,v)}),this):s.isMap(f)||s.isObject(f)?s.forEachObject(f,(function(v,w){if(s.isFunction(w)&&(w=w.apply(h)),g.ignoreConverters||v.indexOf(g.convert.att)!==0)if(g.ignoreConverters||v.indexOf(g.convert.text)!==0)if(g.ignoreConverters||v.indexOf(g.convert.cdata)!==0)if(g.ignoreConverters||v.indexOf(g.convert.comment)!==0)if(g.ignoreConverters||v.indexOf(g.convert.ins)!==0){if(!((s.isArray(w)||s.isSet(w))&&s.isEmpty(w))){if((s.isMap(w)||s.isObject(w))&&s.isEmpty(w))p=h.element(u,void 0,h.sanitize(v))||p;else if(g.keepNullNodes||w!=null)if(s.isArray(w)||s.isSet(w))s.forEachArray(w,(function(S){var T={};T[v]=S,p=h.parse(u,T)}),h);else if(s.isMap(w)||s.isObject(w))(m=h.element(u,void 0,h.sanitize(v)))&&(p=m,h.parse(m,w));else if(w!=null&&w!==""){var m;(m=h.element(u,void 0,h.sanitize(v)))&&(p=m,h.text(m,h._decodeText(h.sanitize(w))))}else p=h.element(u,void 0,h.sanitize(v))||p}}else if(s.isString(w)){var y=w.indexOf(" "),C=y===-1?w:w.substr(0,y),x=y===-1?"":w.substr(y+1);p=h.instruction(u,h.sanitize(C),h.sanitize(x))||p}else s.isArray(w)||s.isSet(w)?s.forEachArray(w,(function(S){var T=S.indexOf(" "),_=T===-1?S:S.substr(0,T),E=T===-1?"":S.substr(T+1);p=h.instruction(u,h.sanitize(_),h.sanitize(E))||p}),h):s.forEachObject(w,(function(S,T){return p=h.instruction(u,h.sanitize(S),h.sanitize(T))||p}),h);else s.isArray(w)||s.isSet(w)?s.forEachArray(w,(function(S){return p=h.comment(u,h.sanitize(S))||p}),h):p=h.comment(u,h.sanitize(w))||p;else s.isArray(w)||s.isSet(w)?s.forEachArray(w,(function(S){return p=h.cdata(u,h.sanitize(S))||p}),h):p=h.cdata(u,h.sanitize(w))||p;else p=s.isMap(w)||s.isObject(w)?h.parse(u,w):h.text(u,h._decodeText(h.sanitize(w)))||p;else if(v===g.convert.att){if(s.isArray(w)||s.isSet(w))throw new Error("Invalid attribute: "+w.toString()+". "+u._debugInfo());s.forEachObject(w,(function(S,T){p=h.attribute(u,void 0,h.sanitize(S),h._decodeAttributeValue(h.sanitize(T)))||p}))}else p=h.attribute(u,void 0,h.sanitize(v.substr(g.convert.att.length)),h._decodeAttributeValue(h.sanitize(w)))||p}),this):(g.keepNullNodes||f!=null)&&(p=this.text(u,this._decodeText(this.sanitize(f)))||p),p||u},d})(i(75).BaseReader);n.ObjectReader=c},function(r,n,i){var o=i(39);r.exports=new o({explicit:[i(286),i(287),i(288)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(a){this.level=0,this._builderOptions=a,this._writerOptions=a};n.BaseCBWriter=o},function(r,n,i){var o=i(16),a=i(8),s=i(116);r.exports=!o&&!a((function(){return Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a!=7}))},function(r,n,i){var o=i(11),a=i(13),s=o.document,c=a(s)&&a(s.createElement);r.exports=function(l){return c?s.createElement(l):{}}},function(r,n,i){var o=i(118),a=Function.toString;typeof o.inspectSource!="function"&&(o.inspectSource=function(s){return a.call(s)}),r.exports=o.inspectSource},function(r,n,i){var o=i(11),a=i(80),s=o["__core-js_shared__"]||a("__core-js_shared__",{});r.exports=s},function(r,n,i){var o=i(14),a=i(187),s=i(55),c=i(15);r.exports=function(l,d){for(var u=a(d),f=c.f,h=s.f,g=0;g<u.length;g++){var p=u[g];o(l,p)||f(l,p,h(d,p))}}},function(r,n,i){var o=i(11);r.exports=o},function(r,n,i){var o=i(14),a=i(24),s=i(122).indexOf,c=i(45);r.exports=function(l,d){var u,f=a(l),h=0,g=[];for(u in f)!o(c,u)&&o(f,u)&&g.push(u);for(;d.length>h;)o(f,u=d[h++])&&(~s(g,u)||g.push(u));return g}},function(r,n,i){var o=i(24),a=i(26),s=i(83),c=function(l){return function(d,u,f){var h,g=o(d),p=a(g.length),v=s(f,p);if(l&&u!=u){for(;p>v;)if((h=g[v++])!=h)return!0}else for(;p>v;v++)if((l||v in g)&&g[v]===u)return l||v||0;return!l&&-1}};r.exports={includes:c(!0),indexOf:c(!1)}},function(r,n,i){var o=i(8),a=/#|\.prototype\./,s=function(f,h){var g=l[c(f)];return g==u||g!=d&&(typeof h=="function"?o(h):!!h)},c=s.normalize=function(f){return String(f).replace(a,".").toLowerCase()},l=s.data={},d=s.NATIVE="N",u=s.POLYFILL="P";r.exports=s},function(r,n,i){var o=i(86);r.exports=o&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},function(r,n,i){var o=i(5);n.f=o},function(r,n,i){var o=i(120),a=i(14),s=i(125),c=i(15).f;r.exports=function(l){var d=o.Symbol||(o.Symbol={});a(d,l)||c(d,l,{value:s.f(l)})}},function(r,n){r.exports=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i}},function(r,n,i){var o=i(13),a=i(59),s=i(5)("species");r.exports=function(c,l){var d;return a(c)&&(typeof(d=c.constructor)!="function"||d!==Array&&!a(d.prototype)?o(d)&&(d=d[s])===null&&(d=void 0):d=void 0),new(d===void 0?Array:d)(l===0?0:l)}},function(r,n,i){var o,a,s=i(11),c=i(193),l=s.process,d=l&&l.versions,u=d&&d.v8;u?a=(o=u.split("."))[0]+o[1]:c&&(!(o=c.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=c.match(/Chrome\/(\d+)/))&&(a=o[1]),r.exports=a&&+a},function(r,n,i){var o=i(5),a=i(60),s=i(15),c=o("unscopables"),l=Array.prototype;l[c]==null&&s.f(l,c,{configurable:!0,value:a(null)}),r.exports=function(d){l[c][d]=!0}},function(r,n,i){var o,a,s,c=i(132),l=i(21),d=i(14),u=i(5),f=i(44),h=u("iterator"),g=!1;[].keys&&("next"in(s=[].keys())?(a=c(c(s)))!==Object.prototype&&(o=a):g=!0),o==null&&(o={}),f||d(o,h)||l(o,h,(function(){return this})),r.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:g}},function(r,n,i){var o=i(14),a=i(27),s=i(57),c=i(196),l=s("IE_PROTO"),d=Object.prototype;r.exports=c?Object.getPrototypeOf:function(u){return u=a(u),o(u,l)?u[l]:typeof u.constructor=="function"&&u instanceof u.constructor?u.constructor.prototype:u instanceof Object?d:null}},function(r,n,i){var o=i(18),a=i(197);r.exports=Object.setPrototypeOf||("__proto__"in{}?(function(){var s,c=!1,l={};try{(s=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(l,[]),c=l instanceof Array}catch{}return function(d,u){return o(d),a(u),c?s.call(d,u):d.__proto__=u,d}})():void 0)},function(r,n,i){var o=i(56),a=i(15),s=i(40);r.exports=function(c,l,d){var u=o(l);u in c?a.f(c,u,s(0,d)):c[u]=d}},function(r,n,i){var o=i(90),a=i(42),s=i(5)("toStringTag"),c=a((function(){return arguments})())=="Arguments";r.exports=o?a:function(l){var d,u,f;return l===void 0?"Undefined":l===null?"Null":typeof(u=(function(h,g){try{return h[g]}catch{}})(d=Object(l),s))=="string"?u:c?a(d):(f=a(d))=="Object"&&typeof d.callee=="function"?"Arguments":f}},function(r,n,i){var o=i(18);r.exports=function(){var a=o(this),s="";return a.global&&(s+="g"),a.ignoreCase&&(s+="i"),a.multiline&&(s+="m"),a.dotAll&&(s+="s"),a.unicode&&(s+="u"),a.sticky&&(s+="y"),s}},function(r,n,i){var o=i(47),a=i(35),s=function(c){return function(l,d){var u,f,h=String(a(l)),g=o(d),p=h.length;return g<0||g>=p?c?"":void 0:(u=h.charCodeAt(g))<55296||u>56319||g+1===p||(f=h.charCodeAt(g+1))<56320||f>57343?c?h.charAt(g):u:c?h.slice(g,g+2):f-56320+(u-55296<<10)+65536}};r.exports={codeAt:s(!1),charAt:s(!0)}},function(r,n,i){var o=i(4),a=i(27),s=i(61);o({target:"Object",stat:!0,forced:i(8)((function(){s(1)}))},{keys:function(c){return s(a(c))}})},function(r,n,i){var o=i(4),a=i(11),s=i(123),c=i(25),l=i(140),d=i(141),u=i(142),f=i(13),h=i(8),g=i(208),p=i(62),v=i(209);r.exports=function(w,m,y){var C=w.indexOf("Map")!==-1,x=w.indexOf("Weak")!==-1,S=C?"set":"add",T=a[w],_=T&&T.prototype,E=T,D={},b=function(G){var k=_[G];c(_,G,G=="add"?function(L){return k.call(this,L===0?0:L),this}:G=="delete"?function(L){return!(x&&!f(L))&&k.call(this,L===0?0:L)}:G=="get"?function(L){return x&&!f(L)?void 0:k.call(this,L===0?0:L)}:G=="has"?function(L){return!(x&&!f(L))&&k.call(this,L===0?0:L)}:function(L,F){return k.call(this,L===0?0:L,F),this})};if(s(w,typeof T!="function"||!(x||_.forEach&&!h((function(){new T().entries().next()})))))E=y.getConstructor(m,w,C,S),l.REQUIRED=!0;else if(s(w,!0)){var I=new E,O=I[S](x?{}:-0,1)!=I,M=h((function(){I.has(1)})),R=g((function(G){new T(G)})),A=!x&&h((function(){for(var G=new T,k=5;k--;)G[S](k,k);return!G.has(-0)}));R||((E=m((function(G,k){u(G,E,w);var L=v(new T,G,E);return k!=null&&d(k,L[S],L,C),L}))).prototype=_,_.constructor=E),(M||A)&&(b("delete"),b("has"),C&&b("get")),(A||O)&&b(S),x&&_.clear&&delete _.clear}return D[w]=E,o({global:!0,forced:E!=T},D),p(E,w),x||y.setStrong(E,w,C),E}},function(r,n,i){var o=i(45),a=i(13),s=i(14),c=i(15).f,l=i(58),d=i(204),u=l("meta"),f=0,h=Object.isExtensible||function(){return!0},g=function(v){c(v,u,{value:{objectID:"O"+ ++f,weakData:{}}})},p=r.exports={REQUIRED:!1,fastKey:function(v,w){if(!a(v))return typeof v=="symbol"?v:(typeof v=="string"?"S":"P")+v;if(!s(v,u)){if(!h(v))return"F";if(!w)return"E";g(v)}return v[u].objectID},getWeakData:function(v,w){if(!s(v,u)){if(!h(v))return!0;if(!w)return!1;g(v)}return v[u].weakData},onFreeze:function(v){return d&&p.REQUIRED&&h(v)&&!s(v,u)&&g(v),v}};o[u]=!0},function(r,n,i){var o=i(18),a=i(205),s=i(26),c=i(87),l=i(206),d=i(207),u=function(f,h){this.stopped=f,this.result=h};(r.exports=function(f,h,g,p,v){var w,m,y,C,x,S,T,_=c(h,g,p?2:1);if(v)w=f;else{if(typeof(m=l(f))!="function")throw TypeError("Target is not iterable");if(a(m)){for(y=0,C=s(f.length);C>y;y++)if((x=p?_(o(T=f[y])[0],T[1]):_(f[y]))&&x instanceof u)return x;return new u(!1)}w=m.call(f)}for(S=w.next;!(T=S.call(w)).done;)if(typeof(x=d(w,_,T.value,p))=="object"&&x&&x instanceof u)return x;return new u(!1)}).stop=function(f){return new u(!0,f)}},function(r,n){r.exports=function(i,o,a){if(!(i instanceof o))throw TypeError("Incorrect "+(a?a+" ":"")+"invocation");return i}},function(r,n,i){var o=i(15).f,a=i(60),s=i(210),c=i(87),l=i(142),d=i(141),u=i(88),f=i(211),h=i(16),g=i(140).fastKey,p=i(43),v=p.set,w=p.getterFor;r.exports={getConstructor:function(m,y,C,x){var S=m((function(D,b){l(D,S,y),v(D,{type:y,index:a(null),first:void 0,last:void 0,size:0}),h||(D.size=0),b!=null&&d(b,D[x],D,C)})),T=w(y),_=function(D,b,I){var O,M,R=T(D),A=E(D,b);return A?A.value=I:(R.last=A={index:M=g(b,!0),key:b,value:I,previous:O=R.last,next:void 0,removed:!1},R.first||(R.first=A),O&&(O.next=A),h?R.size++:D.size++,M!=="F"&&(R.index[M]=A)),D},E=function(D,b){var I,O=T(D),M=g(b);if(M!=="F")return O.index[M];for(I=O.first;I;I=I.next)if(I.key==b)return I};return s(S.prototype,{clear:function(){for(var D=T(this),b=D.index,I=D.first;I;)I.removed=!0,I.previous&&(I.previous=I.previous.next=void 0),delete b[I.index],I=I.next;D.first=D.last=void 0,h?D.size=0:this.size=0},delete:function(D){var b=T(this),I=E(this,D);if(I){var O=I.next,M=I.previous;delete b.index[I.index],I.removed=!0,M&&(M.next=O),O&&(O.previous=M),b.first==I&&(b.first=O),b.last==I&&(b.last=M),h?b.size--:this.size--}return!!I},forEach:function(D){for(var b,I=T(this),O=c(D,arguments.length>1?arguments[1]:void 0,3);b=b?b.next:I.first;)for(O(b.value,b.key,this);b&&b.removed;)b=b.previous},has:function(D){return!!E(this,D)}}),s(S.prototype,C?{get:function(D){var b=E(this,D);return b&&b.value},set:function(D,b){return _(this,D===0?0:D,b)}}:{add:function(D){return _(this,D=D===0?0:D,D)}}),h&&o(S.prototype,"size",{get:function(){return T(this).size}}),S},setStrong:function(m,y,C){var x=y+" Iterator",S=w(y),T=w(x);u(m,y,(function(_,E){v(this,{type:x,target:_,state:S(_),kind:E,last:void 0})}),(function(){for(var _=T(this),E=_.kind,D=_.last;D&&D.removed;)D=D.previous;return _.target&&(_.last=D=D?D.next:_.state.first)?E=="keys"?{value:D.key,done:!1}:E=="values"?{value:D.value,done:!1}:{value:[D.key,D.value],done:!1}:(_.target=void 0,{value:void 0,done:!0})}),C?"entries":"values",!C,!0),f(y)}}},function(r,n,i){var o,a=i(4),s=i(55).f,c=i(26),l=i(222),d=i(35),u=i(224),f=i(44),h="".endsWith,g=Math.min,p=u("endsWith");a({target:"String",proto:!0,forced:!!(f||p||(o=s(String.prototype,"endsWith"),!o||o.writable))&&!p},{endsWith:function(v){var w=String(d(this));l(v);var m=arguments.length>1?arguments[1]:void 0,y=c(w.length),C=m===void 0?y:g(c(m),y),x=String(v);return h?h.call(w,x,C):w.slice(C-x.length,C)===x}})},function(r,n,i){(function(o){var a=i(229),s=i(230),c=i(231);function l(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(B,P){if(l()<P)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(B=new Uint8Array(P)).__proto__=u.prototype:(B===null&&(B=new u(P)),B.length=P),B}function u(B,P,$){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(B,P,$);if(typeof B=="number"){if(typeof P=="string")throw new Error("If encoding is specified then the first argument must be a string");return g(this,B)}return f(this,B,P,$)}function f(B,P,$,W){if(typeof P=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&P instanceof ArrayBuffer?(function(K,Q,ee,ge){if(Q.byteLength,ee<0||Q.byteLength<ee)throw new RangeError("'offset' is out of bounds");if(Q.byteLength<ee+(ge||0))throw new RangeError("'length' is out of bounds");return Q=ee===void 0&&ge===void 0?new Uint8Array(Q):ge===void 0?new Uint8Array(Q,ee):new Uint8Array(Q,ee,ge),u.TYPED_ARRAY_SUPPORT?(K=Q).__proto__=u.prototype:K=p(K,Q),K})(B,P,$,W):typeof P=="string"?(function(K,Q,ee){if(typeof ee=="string"&&ee!==""||(ee="utf8"),!u.isEncoding(ee))throw new TypeError('"encoding" must be a valid string encoding');var ge=0|w(Q,ee),De=(K=d(K,ge)).write(Q,ee);return De!==ge&&(K=K.slice(0,De)),K})(B,P,$):(function(K,Q){if(u.isBuffer(Q)){var ee=0|v(Q.length);return(K=d(K,ee)).length===0||Q.copy(K,0,0,ee),K}if(Q){if(typeof ArrayBuffer<"u"&&Q.buffer instanceof ArrayBuffer||"length"in Q)return typeof Q.length!="number"||(ge=Q.length)!=ge?d(K,0):p(K,Q);if(Q.type==="Buffer"&&c(Q.data))return p(K,Q.data)}var ge;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")})(B,P)}function h(B){if(typeof B!="number")throw new TypeError('"size" argument must be a number');if(B<0)throw new RangeError('"size" argument must not be negative')}function g(B,P){if(h(P),B=d(B,P<0?0:0|v(P)),!u.TYPED_ARRAY_SUPPORT)for(var $=0;$<P;++$)B[$]=0;return B}function p(B,P){var $=P.length<0?0:0|v(P.length);B=d(B,$);for(var W=0;W<$;W+=1)B[W]=255&P[W];return B}function v(B){if(B>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|B}function w(B,P){if(u.isBuffer(B))return B.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(B)||B instanceof ArrayBuffer))return B.byteLength;typeof B!="string"&&(B=""+B);var $=B.length;if($===0)return 0;for(var W=!1;;)switch(P){case"ascii":case"latin1":case"binary":return $;case"utf8":case"utf-8":case void 0:return we(B).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*$;case"hex":return $>>>1;case"base64":return _e(B).length;default:if(W)return we(B).length;P=(""+P).toLowerCase(),W=!0}}function m(B,P,$){var W=!1;if((P===void 0||P<0)&&(P=0),P>this.length||(($===void 0||$>this.length)&&($=this.length),$<=0)||($>>>=0)<=(P>>>=0))return"";for(B||(B="utf8");;)switch(B){case"hex":return A(this,P,$);case"utf8":case"utf-8":return O(this,P,$);case"ascii":return M(this,P,$);case"latin1":case"binary":return R(this,P,$);case"base64":return I(this,P,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,P,$);default:if(W)throw new TypeError("Unknown encoding: "+B);B=(B+"").toLowerCase(),W=!0}}function y(B,P,$){var W=B[P];B[P]=B[$],B[$]=W}function C(B,P,$,W,K){if(B.length===0)return-1;if(typeof $=="string"?(W=$,$=0):$>2147483647?$=2147483647:$<-2147483648&&($=-2147483648),$=+$,isNaN($)&&($=K?0:B.length-1),$<0&&($=B.length+$),$>=B.length){if(K)return-1;$=B.length-1}else if($<0){if(!K)return-1;$=0}if(typeof P=="string"&&(P=u.from(P,W)),u.isBuffer(P))return P.length===0?-1:x(B,P,$,W,K);if(typeof P=="number")return P&=255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?K?Uint8Array.prototype.indexOf.call(B,P,$):Uint8Array.prototype.lastIndexOf.call(B,P,$):x(B,[P],$,W,K);throw new TypeError("val must be string, number or Buffer")}function x(B,P,$,W,K){var Q,ee=1,ge=B.length,De=P.length;if(W!==void 0&&((W=String(W).toLowerCase())==="ucs2"||W==="ucs-2"||W==="utf16le"||W==="utf-16le")){if(B.length<2||P.length<2)return-1;ee=2,ge/=2,De/=2,$/=2}function Le(ve,le){return ee===1?ve[le]:ve.readUInt16BE(le*ee)}if(K){var Ge=-1;for(Q=$;Q<ge;Q++)if(Le(B,Q)===Le(P,Ge===-1?0:Q-Ge)){if(Ge===-1&&(Ge=Q),Q-Ge+1===De)return Ge*ee}else Ge!==-1&&(Q-=Q-Ge),Ge=-1}else for($+De>ge&&($=ge-De),Q=$;Q>=0;Q--){for(var re=!0,se=0;se<De;se++)if(Le(B,Q+se)!==Le(P,se)){re=!1;break}if(re)return Q}return-1}function S(B,P,$,W){$=Number($)||0;var K=B.length-$;W?(W=Number(W))>K&&(W=K):W=K;var Q=P.length;if(Q%2!=0)throw new TypeError("Invalid hex string");W>Q/2&&(W=Q/2);for(var ee=0;ee<W;++ee){var ge=parseInt(P.substr(2*ee,2),16);if(isNaN(ge))return ee;B[$+ee]=ge}return ee}function T(B,P,$,W){return Se(we(P,B.length-$),B,$,W)}function _(B,P,$,W){return Se((function(K){for(var Q=[],ee=0;ee<K.length;++ee)Q.push(255&K.charCodeAt(ee));return Q})(P),B,$,W)}function E(B,P,$,W){return _(B,P,$,W)}function D(B,P,$,W){return Se(_e(P),B,$,W)}function b(B,P,$,W){return Se((function(K,Q){for(var ee,ge,De,Le=[],Ge=0;Ge<K.length&&!((Q-=2)<0);++Ge)ee=K.charCodeAt(Ge),ge=ee>>8,De=ee%256,Le.push(De),Le.push(ge);return Le})(P,B.length-$),B,$,W)}function I(B,P,$){return P===0&&$===B.length?a.fromByteArray(B):a.fromByteArray(B.slice(P,$))}function O(B,P,$){$=Math.min(B.length,$);for(var W=[],K=P;K<$;){var Q,ee,ge,De,Le=B[K],Ge=null,re=Le>239?4:Le>223?3:Le>191?2:1;if(K+re<=$)switch(re){case 1:Le<128&&(Ge=Le);break;case 2:(192&(Q=B[K+1]))==128&&(De=(31&Le)<<6|63&Q)>127&&(Ge=De);break;case 3:Q=B[K+1],ee=B[K+2],(192&Q)==128&&(192&ee)==128&&(De=(15&Le)<<12|(63&Q)<<6|63&ee)>2047&&(De<55296||De>57343)&&(Ge=De);break;case 4:Q=B[K+1],ee=B[K+2],ge=B[K+3],(192&Q)==128&&(192&ee)==128&&(192&ge)==128&&(De=(15&Le)<<18|(63&Q)<<12|(63&ee)<<6|63&ge)>65535&&De<1114112&&(Ge=De)}Ge===null?(Ge=65533,re=1):Ge>65535&&(Ge-=65536,W.push(Ge>>>10&1023|55296),Ge=56320|1023&Ge),W.push(Ge),K+=re}return(function(se){var ve=se.length;if(ve<=4096)return String.fromCharCode.apply(String,se);for(var le="",pe=0;pe<ve;)le+=String.fromCharCode.apply(String,se.slice(pe,pe+=4096));return le})(W)}n.Buffer=u,n.SlowBuffer=function(B){return+B!=B&&(B=0),u.alloc(+B)},n.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=o.TYPED_ARRAY_SUPPORT!==void 0?o.TYPED_ARRAY_SUPPORT:(function(){try{var B=new Uint8Array(1);return B.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},B.foo()===42&&typeof B.subarray=="function"&&B.subarray(1,1).byteLength===0}catch{return!1}})(),n.kMaxLength=l(),u.poolSize=8192,u._augment=function(B){return B.__proto__=u.prototype,B},u.from=function(B,P,$){return f(null,B,P,$)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(B,P,$){return(function(W,K,Q,ee){return h(K),K<=0?d(W,K):Q!==void 0?typeof ee=="string"?d(W,K).fill(Q,ee):d(W,K).fill(Q):d(W,K)})(null,B,P,$)},u.allocUnsafe=function(B){return g(null,B)},u.allocUnsafeSlow=function(B){return g(null,B)},u.isBuffer=function(B){return!(B==null||!B._isBuffer)},u.compare=function(B,P){if(!u.isBuffer(B)||!u.isBuffer(P))throw new TypeError("Arguments must be Buffers");if(B===P)return 0;for(var $=B.length,W=P.length,K=0,Q=Math.min($,W);K<Q;++K)if(B[K]!==P[K]){$=B[K],W=P[K];break}return $<W?-1:W<$?1:0},u.isEncoding=function(B){switch(String(B).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(B,P){if(!c(B))throw new TypeError('"list" argument must be an Array of Buffers');if(B.length===0)return u.alloc(0);var $;if(P===void 0)for(P=0,$=0;$<B.length;++$)P+=B[$].length;var W=u.allocUnsafe(P),K=0;for($=0;$<B.length;++$){var Q=B[$];if(!u.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(W,K),K+=Q.length}return W},u.byteLength=w,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var B=this.length;if(B%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var P=0;P<B;P+=2)y(this,P,P+1);return this},u.prototype.swap32=function(){var B=this.length;if(B%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var P=0;P<B;P+=4)y(this,P,P+3),y(this,P+1,P+2);return this},u.prototype.swap64=function(){var B=this.length;if(B%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var P=0;P<B;P+=8)y(this,P,P+7),y(this,P+1,P+6),y(this,P+2,P+5),y(this,P+3,P+4);return this},u.prototype.toString=function(){var B=0|this.length;return B===0?"":arguments.length===0?O(this,0,B):m.apply(this,arguments)},u.prototype.equals=function(B){if(!u.isBuffer(B))throw new TypeError("Argument must be a Buffer");return this===B||u.compare(this,B)===0},u.prototype.inspect=function(){var B="",P=n.INSPECT_MAX_BYTES;return this.length>0&&(B=this.toString("hex",0,P).match(/.{2}/g).join(" "),this.length>P&&(B+=" ... ")),"<Buffer "+B+">"},u.prototype.compare=function(B,P,$,W,K){if(!u.isBuffer(B))throw new TypeError("Argument must be a Buffer");if(P===void 0&&(P=0),$===void 0&&($=B?B.length:0),W===void 0&&(W=0),K===void 0&&(K=this.length),P<0||$>B.length||W<0||K>this.length)throw new RangeError("out of range index");if(W>=K&&P>=$)return 0;if(W>=K)return-1;if(P>=$)return 1;if(this===B)return 0;for(var Q=(K>>>=0)-(W>>>=0),ee=($>>>=0)-(P>>>=0),ge=Math.min(Q,ee),De=this.slice(W,K),Le=B.slice(P,$),Ge=0;Ge<ge;++Ge)if(De[Ge]!==Le[Ge]){Q=De[Ge],ee=Le[Ge];break}return Q<ee?-1:ee<Q?1:0},u.prototype.includes=function(B,P,$){return this.indexOf(B,P,$)!==-1},u.prototype.indexOf=function(B,P,$){return C(this,B,P,$,!0)},u.prototype.lastIndexOf=function(B,P,$){return C(this,B,P,$,!1)},u.prototype.write=function(B,P,$,W){if(P===void 0)W="utf8",$=this.length,P=0;else if($===void 0&&typeof P=="string")W=P,$=this.length,P=0;else{if(!isFinite(P))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");P|=0,isFinite($)?($|=0,W===void 0&&(W="utf8")):(W=$,$=void 0)}var K=this.length-P;if(($===void 0||$>K)&&($=K),B.length>0&&($<0||P<0)||P>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var Q=!1;;)switch(W){case"hex":return S(this,B,P,$);case"utf8":case"utf-8":return T(this,B,P,$);case"ascii":return _(this,B,P,$);case"latin1":case"binary":return E(this,B,P,$);case"base64":return D(this,B,P,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,B,P,$);default:if(Q)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),Q=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function M(B,P,$){var W="";$=Math.min(B.length,$);for(var K=P;K<$;++K)W+=String.fromCharCode(127&B[K]);return W}function R(B,P,$){var W="";$=Math.min(B.length,$);for(var K=P;K<$;++K)W+=String.fromCharCode(B[K]);return W}function A(B,P,$){var W=B.length;(!P||P<0)&&(P=0),(!$||$<0||$>W)&&($=W);for(var K="",Q=P;Q<$;++Q)K+=fe(B[Q]);return K}function G(B,P,$){for(var W=B.slice(P,$),K="",Q=0;Q<W.length;Q+=2)K+=String.fromCharCode(W[Q]+256*W[Q+1]);return K}function k(B,P,$){if(B%1!=0||B<0)throw new RangeError("offset is not uint");if(B+P>$)throw new RangeError("Trying to access beyond buffer length")}function L(B,P,$,W,K,Q){if(!u.isBuffer(B))throw new TypeError('"buffer" argument must be a Buffer instance');if(P>K||P<Q)throw new RangeError('"value" argument is out of bounds');if($+W>B.length)throw new RangeError("Index out of range")}function F(B,P,$,W){P<0&&(P=65535+P+1);for(var K=0,Q=Math.min(B.length-$,2);K<Q;++K)B[$+K]=(P&255<<8*(W?K:1-K))>>>8*(W?K:1-K)}function j(B,P,$,W){P<0&&(P=4294967295+P+1);for(var K=0,Q=Math.min(B.length-$,4);K<Q;++K)B[$+K]=P>>>8*(W?K:3-K)&255}function Y(B,P,$,W,K,Q){if($+W>B.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("Index out of range")}function ie(B,P,$,W,K){return K||Y(B,0,$,4),s.write(B,P,$,W,23,4),$+4}function de(B,P,$,W,K){return K||Y(B,0,$,8),s.write(B,P,$,W,52,8),$+8}u.prototype.slice=function(B,P){var $,W=this.length;if((B=~~B)<0?(B+=W)<0&&(B=0):B>W&&(B=W),(P=P===void 0?W:~~P)<0?(P+=W)<0&&(P=0):P>W&&(P=W),P<B&&(P=B),u.TYPED_ARRAY_SUPPORT)($=this.subarray(B,P)).__proto__=u.prototype;else{var K=P-B;$=new u(K,void 0);for(var Q=0;Q<K;++Q)$[Q]=this[Q+B]}return $},u.prototype.readUIntLE=function(B,P,$){B|=0,P|=0,$||k(B,P,this.length);for(var W=this[B],K=1,Q=0;++Q<P&&(K*=256);)W+=this[B+Q]*K;return W},u.prototype.readUIntBE=function(B,P,$){B|=0,P|=0,$||k(B,P,this.length);for(var W=this[B+--P],K=1;P>0&&(K*=256);)W+=this[B+--P]*K;return W},u.prototype.readUInt8=function(B,P){return P||k(B,1,this.length),this[B]},u.prototype.readUInt16LE=function(B,P){return P||k(B,2,this.length),this[B]|this[B+1]<<8},u.prototype.readUInt16BE=function(B,P){return P||k(B,2,this.length),this[B]<<8|this[B+1]},u.prototype.readUInt32LE=function(B,P){return P||k(B,4,this.length),(this[B]|this[B+1]<<8|this[B+2]<<16)+16777216*this[B+3]},u.prototype.readUInt32BE=function(B,P){return P||k(B,4,this.length),16777216*this[B]+(this[B+1]<<16|this[B+2]<<8|this[B+3])},u.prototype.readIntLE=function(B,P,$){B|=0,P|=0,$||k(B,P,this.length);for(var W=this[B],K=1,Q=0;++Q<P&&(K*=256);)W+=this[B+Q]*K;return W>=(K*=128)&&(W-=Math.pow(2,8*P)),W},u.prototype.readIntBE=function(B,P,$){B|=0,P|=0,$||k(B,P,this.length);for(var W=P,K=1,Q=this[B+--W];W>0&&(K*=256);)Q+=this[B+--W]*K;return Q>=(K*=128)&&(Q-=Math.pow(2,8*P)),Q},u.prototype.readInt8=function(B,P){return P||k(B,1,this.length),128&this[B]?-1*(255-this[B]+1):this[B]},u.prototype.readInt16LE=function(B,P){P||k(B,2,this.length);var $=this[B]|this[B+1]<<8;return 32768&$?4294901760|$:$},u.prototype.readInt16BE=function(B,P){P||k(B,2,this.length);var $=this[B+1]|this[B]<<8;return 32768&$?4294901760|$:$},u.prototype.readInt32LE=function(B,P){return P||k(B,4,this.length),this[B]|this[B+1]<<8|this[B+2]<<16|this[B+3]<<24},u.prototype.readInt32BE=function(B,P){return P||k(B,4,this.length),this[B]<<24|this[B+1]<<16|this[B+2]<<8|this[B+3]},u.prototype.readFloatLE=function(B,P){return P||k(B,4,this.length),s.read(this,B,!0,23,4)},u.prototype.readFloatBE=function(B,P){return P||k(B,4,this.length),s.read(this,B,!1,23,4)},u.prototype.readDoubleLE=function(B,P){return P||k(B,8,this.length),s.read(this,B,!0,52,8)},u.prototype.readDoubleBE=function(B,P){return P||k(B,8,this.length),s.read(this,B,!1,52,8)},u.prototype.writeUIntLE=function(B,P,$,W){B=+B,P|=0,$|=0,W||L(this,B,P,$,Math.pow(2,8*$)-1,0);var K=1,Q=0;for(this[P]=255&B;++Q<$&&(K*=256);)this[P+Q]=B/K&255;return P+$},u.prototype.writeUIntBE=function(B,P,$,W){B=+B,P|=0,$|=0,W||L(this,B,P,$,Math.pow(2,8*$)-1,0);var K=$-1,Q=1;for(this[P+K]=255&B;--K>=0&&(Q*=256);)this[P+K]=B/Q&255;return P+$},u.prototype.writeUInt8=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,1,255,0),u.TYPED_ARRAY_SUPPORT||(B=Math.floor(B)),this[P]=255&B,P+1},u.prototype.writeUInt16LE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[P]=255&B,this[P+1]=B>>>8):F(this,B,P,!0),P+2},u.prototype.writeUInt16BE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[P]=B>>>8,this[P+1]=255&B):F(this,B,P,!1),P+2},u.prototype.writeUInt32LE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[P+3]=B>>>24,this[P+2]=B>>>16,this[P+1]=B>>>8,this[P]=255&B):j(this,B,P,!0),P+4},u.prototype.writeUInt32BE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[P]=B>>>24,this[P+1]=B>>>16,this[P+2]=B>>>8,this[P+3]=255&B):j(this,B,P,!1),P+4},u.prototype.writeIntLE=function(B,P,$,W){if(B=+B,P|=0,!W){var K=Math.pow(2,8*$-1);L(this,B,P,$,K-1,-K)}var Q=0,ee=1,ge=0;for(this[P]=255&B;++Q<$&&(ee*=256);)B<0&&ge===0&&this[P+Q-1]!==0&&(ge=1),this[P+Q]=(B/ee>>0)-ge&255;return P+$},u.prototype.writeIntBE=function(B,P,$,W){if(B=+B,P|=0,!W){var K=Math.pow(2,8*$-1);L(this,B,P,$,K-1,-K)}var Q=$-1,ee=1,ge=0;for(this[P+Q]=255&B;--Q>=0&&(ee*=256);)B<0&&ge===0&&this[P+Q+1]!==0&&(ge=1),this[P+Q]=(B/ee>>0)-ge&255;return P+$},u.prototype.writeInt8=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,1,127,-128),u.TYPED_ARRAY_SUPPORT||(B=Math.floor(B)),B<0&&(B=255+B+1),this[P]=255&B,P+1},u.prototype.writeInt16LE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[P]=255&B,this[P+1]=B>>>8):F(this,B,P,!0),P+2},u.prototype.writeInt16BE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[P]=B>>>8,this[P+1]=255&B):F(this,B,P,!1),P+2},u.prototype.writeInt32LE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[P]=255&B,this[P+1]=B>>>8,this[P+2]=B>>>16,this[P+3]=B>>>24):j(this,B,P,!0),P+4},u.prototype.writeInt32BE=function(B,P,$){return B=+B,P|=0,$||L(this,B,P,4,2147483647,-2147483648),B<0&&(B=4294967295+B+1),u.TYPED_ARRAY_SUPPORT?(this[P]=B>>>24,this[P+1]=B>>>16,this[P+2]=B>>>8,this[P+3]=255&B):j(this,B,P,!1),P+4},u.prototype.writeFloatLE=function(B,P,$){return ie(this,B,P,!0,$)},u.prototype.writeFloatBE=function(B,P,$){return ie(this,B,P,!1,$)},u.prototype.writeDoubleLE=function(B,P,$){return de(this,B,P,!0,$)},u.prototype.writeDoubleBE=function(B,P,$){return de(this,B,P,!1,$)},u.prototype.copy=function(B,P,$,W){if($||($=0),W||W===0||(W=this.length),P>=B.length&&(P=B.length),P||(P=0),W>0&&W<$&&(W=$),W===$||B.length===0||this.length===0)return 0;if(P<0)throw new RangeError("targetStart out of bounds");if($<0||$>=this.length)throw new RangeError("sourceStart out of bounds");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),B.length-P<W-$&&(W=B.length-P+$);var K,Q=W-$;if(this===B&&$<P&&P<W)for(K=Q-1;K>=0;--K)B[K+P]=this[K+$];else if(Q<1e3||!u.TYPED_ARRAY_SUPPORT)for(K=0;K<Q;++K)B[K+P]=this[K+$];else Uint8Array.prototype.set.call(B,this.subarray($,$+Q),P);return Q},u.prototype.fill=function(B,P,$,W){if(typeof B=="string"){if(typeof P=="string"?(W=P,P=0,$=this.length):typeof $=="string"&&(W=$,$=this.length),B.length===1){var K=B.charCodeAt(0);K<256&&(B=K)}if(W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!u.isEncoding(W))throw new TypeError("Unknown encoding: "+W)}else typeof B=="number"&&(B&=255);if(P<0||this.length<P||this.length<$)throw new RangeError("Out of range index");if($<=P)return this;var Q;if(P>>>=0,$=$===void 0?this.length:$>>>0,B||(B=0),typeof B=="number")for(Q=P;Q<$;++Q)this[Q]=B;else{var ee=u.isBuffer(B)?B:we(new u(B,W).toString()),ge=ee.length;for(Q=0;Q<$-P;++Q)this[Q+P]=ee[Q%ge]}return this};var ae=/[^+\/0-9A-Za-z-_]/g;function fe(B){return B<16?"0"+B.toString(16):B.toString(16)}function we(B,P){var $;P=P||1/0;for(var W=B.length,K=null,Q=[],ee=0;ee<W;++ee){if(($=B.charCodeAt(ee))>55295&&$<57344){if(!K){if($>56319){(P-=3)>-1&&Q.push(239,191,189);continue}if(ee+1===W){(P-=3)>-1&&Q.push(239,191,189);continue}K=$;continue}if($<56320){(P-=3)>-1&&Q.push(239,191,189),K=$;continue}$=65536+(K-55296<<10|$-56320)}else K&&(P-=3)>-1&&Q.push(239,191,189);if(K=null,$<128){if((P-=1)<0)break;Q.push($)}else if($<2048){if((P-=2)<0)break;Q.push($>>6|192,63&$|128)}else if($<65536){if((P-=3)<0)break;Q.push($>>12|224,$>>6&63|128,63&$|128)}else{if(!($<1114112))throw new Error("Invalid code point");if((P-=4)<0)break;Q.push($>>18|240,$>>12&63|128,$>>6&63|128,63&$|128)}}return Q}function _e(B){return a.toByteArray((function(P){if((P=(function($){return $.trim?$.trim():$.replace(/^\s+|\s+$/g,"")})(P).replace(ae,"")).length<2)return"";for(;P.length%4!=0;)P+="=";return P})(B))}function Se(B,P,$,W){for(var K=0;K<W&&!(K+$>=P.length||K>=B.length);++K)P[K+$]=B[K];return K}}).call(this,i(78))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.isASCIIByte=function(o){return o>=0&&o<=127}},function(r,n,i){var o=this&&this.__read||function(s,c){var l=typeof Symbol=="function"&&s[Symbol.iterator];if(!l)return s;var d,u,f=l.call(s),h=[];try{for(;(c===void 0||c-- >0)&&!(d=f.next()).done;)h.push(d.value)}catch(g){u={error:g}}finally{try{d&&!d.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}return h},a=this&&this.__spread||function(){for(var s=[],c=0;c<arguments.length;c++)s=s.concat(o(arguments[c]));return s};Object.defineProperty(n,"__esModule",{value:!0}),n.length=function(s){return s.length},n.byteLowercase=function(s){for(var c=0;c<s.length;c++){var l=s[c];l>=65&&l<=90&&(s[c]=l+32)}},n.byteUppercase=function(s){for(var c=0;c<s.length;c++){var l=s[c];l>=97&&l<=122&&(s[c]=l-32)}},n.byteCaseInsensitiveMatch=function(s,c){if(s.length!==c.length)return!1;for(var l=0;l<s.length;l++){var d=s[l],u=c[l];if(d>=65&&d<=90&&(d+=32),u>=65&&u<=90&&(u+=32),d!==u)return!1}return!0},n.startsWith=function(s,c){for(var l=0;;){if(l>=s.length)return!1;if(l>=c.length)return!0;if(s[l]!==c[l])return!1;l++}},n.byteLessThan=function(s,c){for(var l=0;;){if(l>=s.length)return!1;if(l>=c.length)return!0;var d=s[l],u=c[l];if(d<u)return!0;if(d>u)return!1;l++}},n.isomorphicDecode=function(s){return String.fromCodePoint.apply(String,a(s))}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(7),s=i(0),c=i(12),l=(function(){function d(u){this._associatedDocument=u||o.dom.window.document}return d.prototype.createDocumentType=function(u,f,h){return s.namespace_validate(u),s.create_documentType(this._associatedDocument,u,f,h)},d.prototype.createDocument=function(u,f,h){h===void 0&&(h=null);var g=s.create_xmlDocument(),p=null;return f&&(p=s.document_internalCreateElementNS(g,u,f)),h&&g.appendChild(h),p&&g.appendChild(p),g._origin=this._associatedDocument._origin,u===a.namespace.HTML?g._contentType="application/xhtml+xml":u===a.namespace.SVG?g._contentType="image/svg+xml":g._contentType="application/xml",g},d.prototype.createHTMLDocument=function(u){var f=s.create_document();f._type="html",f._contentType="text/html",f.appendChild(s.create_documentType(f,"html","",""));var h=s.element_createAnElement(f,"html",a.namespace.HTML);f.appendChild(h);var g=s.element_createAnElement(f,"head",a.namespace.HTML);if(h.appendChild(g),u!==void 0){var p=s.element_createAnElement(f,"title",a.namespace.HTML);g.appendChild(p);var v=s.create_text(f,u);p.appendChild(v)}var w=s.element_createAnElement(f,"body",a.namespace.HTML);return h.appendChild(w),f._origin=this._associatedDocument._origin,f},d.prototype.hasFeature=function(){return!0},d._create=function(u){return new d(u)},d})();n.DOMImplementationImpl=l,c.idl_defineConst(l.prototype,"_ID","@oozcitak/dom")},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(70),c=i(1),l=i(0),d=(function(u){function f(){var h=u.call(this)||this;return h._signalSlots=new Set,h._mutationObserverMicrotaskQueued=!1,h._mutationObservers=new Set,h._iteratorList=new c.FixedSizeSet,h._associatedDocument=l.create_document(),h}return a(f,u),Object.defineProperty(f.prototype,"document",{get:function(){return this._associatedDocument},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"event",{get:function(){return this._currentEvent},enumerable:!0,configurable:!0}),f._create=function(){return new f},f})(s.EventTargetImpl);n.WindowImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=(function(){function s(){}return s.isNode=function(c){return!!c&&c._nodeType!==void 0},s.isDocumentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Document},s.isDocumentTypeNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.DocumentType},s.isDocumentFragmentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.DocumentFragment},s.isAttrNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Attribute},s.isCharacterDataNode=function(c){if(!s.isNode(c))return!1;var l=c._nodeType;return l===o.NodeType.Text||l===o.NodeType.ProcessingInstruction||l===o.NodeType.Comment||l===o.NodeType.CData},s.isTextNode=function(c){return s.isNode(c)&&(c._nodeType===o.NodeType.Text||c._nodeType===o.NodeType.CData)},s.isExclusiveTextNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Text},s.isCDATASectionNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.CData},s.isCommentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Comment},s.isProcessingInstructionNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.ProcessingInstruction},s.isElementNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Element},s.isCustomElementNode=function(c){return s.isElementNode(c)&&c._customElementState==="custom"},s.isShadowRoot=function(c){return!!c&&c.host!==void 0},s.isMouseEvent=function(c){return!!c&&c.screenX!==void 0&&c.screenY!=null},s.isSlotable=function(c){return!!c&&c._name!==void 0&&c._assignedSlot!==void 0&&(s.isTextNode(c)||s.isElementNode(c))},s.isSlot=function(c){return!!c&&c._name!==void 0&&c._assignedNodes!==void 0&&s.isElementNode(c)},s.isWindow=function(c){return!!c&&c.navigator!==void 0},s.isEventListener=function(c){return!!c&&c.handleEvent!==void 0},s.isRegisteredObserver=function(c){return!!c&&c.observer!==void 0&&c.options!==void 0},s.isTransientRegisteredObserver=function(c){return!!c&&c.source!==void 0&&s.isRegisteredObserver(c)},s})();n.Guard=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,u){d.__proto__=u}||function(d,u){for(var f in u)u.hasOwnProperty(f)&&(d[f]=u[f])})(c,l)},function(c,l){function d(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(d.prototype=l.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(){return c.call(this)||this}return a(l,c),l})(i(98).DocumentImpl);n.XMLDocumentImpl=s},function(r,n,i){var o=this&&this.__values||function(W){var K=typeof Symbol=="function"&&Symbol.iterator,Q=K&&W[K],ee=0;if(Q)return Q.call(W);if(W&&typeof W.length=="number")return{next:function(){return W&&ee>=W.length&&(W=void 0),{value:W&&W[ee++],done:!W}}};throw new TypeError(K?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(W,K){var Q=typeof Symbol=="function"&&W[Symbol.iterator];if(!Q)return W;var ee,ge,De=Q.call(W),Le=[];try{for(;(K===void 0||K-- >0)&&!(ee=De.next()).done;)Le.push(ee.value)}catch(Ge){ge={error:Ge}}finally{try{ee&&!ee.done&&(Q=De.return)&&Q.call(De)}finally{if(ge)throw ge.error}}return Le};Object.defineProperty(n,"__esModule",{value:!0});var s,c=i(1),l=i(243),d=i(7),u=i(244),f={ftp:21,file:null,http:80,https:443,ws:80,wss:443},h=/[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,g=/[ "<>`]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,p=/[ "<>`#?{}]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,v=/[ "<>`#?{}/:;=@\[\]\\\^\|]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,w=/[0-9A-Za-z!\$&-\/:;=\?@_~\xA0-\uD7FF\uE000-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uD83E\uD840-\uD87E\uD880-\uD8BE\uD8C0-\uD8FE\uD900-\uD93E\uD940-\uD97E\uD980-\uD9BE\uD9C0-\uD9FE\uDA00-\uDA3E\uDA40-\uDA7E\uDA80-\uDABE\uDAC0-\uDAFE\uDB00-\uDB3E\uDB40-\uDB7E\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDC00-\uDFFD]/,m=/[\0\t\f\r #%/:?@\[\\\]]/;function y(W){s!==void 0&&s.call(null,"Validation Error: "+W)}function C(){return{scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null}}function x(W){return W in f}function S(W){return x(W.scheme)}function T(W){return f[W]||null}function _(W){return W.username!==""||W.password!==""}function E(W,K){var Q,ee;K===void 0&&(K=!1);var ge=W.scheme+":";if(W.host!==null?(ge+="//",_(W)&&(ge+=W.username,W.password!==""&&(ge+=":"+W.password),ge+="@"),ge+=D(W.host),W.port!==null&&(ge+=":"+W.port)):W.host===null&&W.scheme==="file"&&(ge+="//"),W._cannotBeABaseURLFlag)ge+=W.path[0];else try{for(var De=o(W.path),Le=De.next();!Le.done;Le=De.next())ge+="/"+Le.value}catch(Ge){Q={error:Ge}}finally{try{Le&&!Le.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}return W.query!==null&&(ge+="?"+W.query),K||W.fragment===null||(ge+="#"+W.fragment),ge}function D(W){return c.isNumber(W)?b(W):c.isArray(W)?"["+I(W)+"]":W}function b(W){for(var K="",Q=W,ee=1;ee<=4;ee++)K=(Q%256).toString()+K,ee!==4&&(K="."+K),Q=Math.floor(Q/256);return K}function I(W){for(var K="",Q=null,ee=-1,ge=0,De=0,Le=0;Le<8;Le++)if(W[Le]===0){ge=1;for(var Ge=Le+1;Ge<8&&W[Ge]===0;Ge++)ge++;ge>De&&(De=ge,ee=Le)}De>1&&(Q=ee);for(var re=!1,se=0;se<8;se++)re&&W[se]===0||(re&&(re=!1),Q!==se?(K+=W[se].toString(16),se!==7&&(K+=":")):(K+=se===0?"::":":",re=!0));return K}function O(W,K,Q,ee,ge){var De,Le,Ge,re;if(ee===void 0){ee={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null};var se=/^[\u0000-\u001F\u0020]+/,ve=/[\u0000-\u001F\u0020]+$/;(se.test(W)||ve.test(W))&&y("Input string contains leading or trailing control characters or space."),W=(W=W.replace(se,"")).replace(ve,"")}var le=/[\u0009\u000A\u000D]/g;le.test(W)&&y("Input string contains tab or newline characters."),W=W.replace(le,"");var pe=ge===void 0?l.ParserState.SchemeStart:ge;K===void 0&&(K=null);for(var We=Q===void 0||Q==="replacement"||Q==="UTF-16BE"||Q==="UTF-16LE"?"UTF-8":Q,oe="",st=!1,gt=!1,ct=!1,Ee=new c.StringWalker(W);;){switch(pe){case l.ParserState.SchemeStart:if(d.codePoint.ASCIIAlpha.test(Ee.c()))oe+=Ee.c().toLowerCase(),pe=l.ParserState.Scheme;else{if(ge!==void 0)return y("Invalid scheme start character."),null;pe=l.ParserState.NoScheme,Ee.pointer--}break;case l.ParserState.Scheme:if(d.codePoint.ASCIIAlphanumeric.test(Ee.c())||Ee.c()==="+"||Ee.c()==="-"||Ee.c()===".")oe+=Ee.c().toLowerCase();else{if(Ee.c()!==":"){if(ge===void 0){oe="",pe=l.ParserState.NoScheme,Ee.pointer=0;continue}return y("Invalid input string."),null}if(ge!==void 0&&(x(ee.scheme)&&!x(oe)||!x(ee.scheme)&&x(oe)||(_(ee)||ee.port!==null)&&oe==="file"||ee.scheme==="file"&&(ee.host===""||ee.host===null)))return ee;if(ee.scheme=oe,ge!==void 0)return ee.port===T(ee.scheme)&&(ee.port=null),ee;oe="",ee.scheme==="file"?(Ee.remaining().startsWith("//")||y("Invalid file URL scheme, '//' expected."),pe=l.ParserState.File):S(ee)&&K!==null&&K.scheme===ee.scheme?pe=l.ParserState.SpecialRelativeOrAuthority:S(ee)?pe=l.ParserState.SpecialAuthoritySlashes:Ee.remaining().startsWith("/")?(pe=l.ParserState.PathOrAuthority,Ee.pointer++):(ee._cannotBeABaseURLFlag=!0,ee.path.push(""),pe=l.ParserState.CannotBeABaseURLPath)}break;case l.ParserState.NoScheme:if(K===null||K._cannotBeABaseURLFlag&&Ee.c()!=="#")return y("Invalid input string."),null;K._cannotBeABaseURLFlag&&Ee.c()==="#"?(ee.scheme=K.scheme,ee.path=d.list.clone(K.path),ee.query=K.query,ee.fragment="",ee._cannotBeABaseURLFlag=!0,pe=l.ParserState.Fragment):K.scheme!=="file"?(pe=l.ParserState.Relative,Ee.pointer--):(pe=l.ParserState.File,Ee.pointer--);break;case l.ParserState.SpecialRelativeOrAuthority:Ee.c()==="/"&&Ee.remaining().startsWith("/")?(pe=l.ParserState.SpecialAuthorityIgnoreSlashes,Ee.pointer++):(y("Invalid input string."),pe=l.ParserState.Relative,Ee.pointer--);break;case l.ParserState.PathOrAuthority:Ee.c()==="/"?pe=l.ParserState.Authority:(pe=l.ParserState.Path,Ee.pointer--);break;case l.ParserState.Relative:if(K===null)throw new Error("Invalid parser state. Base URL is null.");switch(ee.scheme=K.scheme,Ee.c()){case"":ee.username=K.username,ee.password=K.password,ee.host=K.host,ee.port=K.port,ee.path=d.list.clone(K.path),ee.query=K.query;break;case"/":pe=l.ParserState.RelativeSlash;break;case"?":ee.username=K.username,ee.password=K.password,ee.host=K.host,ee.port=K.port,ee.path=d.list.clone(K.path),ee.query="",pe=l.ParserState.Query;break;case"#":ee.username=K.username,ee.password=K.password,ee.host=K.host,ee.port=K.port,ee.path=d.list.clone(K.path),ee.query=K.query,ee.fragment="",pe=l.ParserState.Fragment;break;default:S(ee)&&Ee.c()==="\\"?(y("Invalid input string."),pe=l.ParserState.RelativeSlash):(ee.username=K.username,ee.password=K.password,ee.host=K.host,ee.port=K.port,ee.path=d.list.clone(K.path),ee.path.length!==0&&ee.path.splice(ee.path.length-1,1),pe=l.ParserState.Path,Ee.pointer--)}break;case l.ParserState.RelativeSlash:if(!S(ee)||Ee.c()!=="/"&&Ee.c()!=="\\")if(Ee.c()==="/")pe=l.ParserState.Authority;else{if(K===null)throw new Error("Invalid parser state. Base URL is null.");ee.username=K.username,ee.password=K.password,ee.host=K.host,ee.port=K.port,pe=l.ParserState.Path,Ee.pointer--}else Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.SpecialAuthorityIgnoreSlashes;break;case l.ParserState.SpecialAuthoritySlashes:Ee.c()==="/"&&Ee.remaining().startsWith("/")?(pe=l.ParserState.SpecialAuthorityIgnoreSlashes,Ee.pointer++):(y("Expected '//'."),pe=l.ParserState.SpecialAuthorityIgnoreSlashes,Ee.pointer--);break;case l.ParserState.SpecialAuthorityIgnoreSlashes:Ee.c()!=="/"&&Ee.c()!=="\\"?(pe=l.ParserState.Authority,Ee.pointer--):y("Unexpected '/' or '\\'.");break;case l.ParserState.Authority:if(Ee.c()==="@"){y("Unexpected '@'."),st&&(oe="%40"+oe),st=!0;try{for(var ze=(De=void 0,o(oe)),Ke=ze.next();!Ke.done;Ke=ze.next()){var Je=Ke.value;if(Je!==":"||ct){var lt=Se(Je,v);ct?ee.password+=lt:ee.username+=lt}else ct=!0}}catch(on){De={error:on}}finally{try{Ke&&!Ke.done&&(Le=ze.return)&&Le.call(ze)}finally{if(De)throw De.error}}oe=""}else if(Ee.c()===""||Ee.c()==="/"||Ee.c()==="?"||Ee.c()==="#"||S(ee)&&Ee.c()==="\\"){if(st&&oe==="")return y("Invalid input string."),null;Ee.pointer-=oe.length+1,oe="",pe=l.ParserState.Host}else oe+=Ee.c();break;case l.ParserState.Host:case l.ParserState.Hostname:if(ge!==void 0&&ee.scheme==="file")Ee.pointer--,pe=l.ParserState.FileHost;else if(Ee.c()!==":"||gt)if(Ee.c()===""||Ee.c()==="/"||Ee.c()==="?"||Ee.c()==="#"||S(ee)&&Ee.c()==="\\"){if(Ee.pointer--,S(ee)&&oe==="")return y("Invalid input string."),null;if(ge!==void 0&&oe===""&&(_(ee)||ee.port!==null))return y("Invalid input string."),ee;if((ke=F(oe,!S(ee)))===null)return null;if(ee.host=ke,oe="",pe=l.ParserState.PathStart,ge!==void 0)return ee}else Ee.c()==="["&&(gt=!0),Ee.c()==="]"&&(gt=!1),oe+=Ee.c();else{if(oe==="")return y("Invalid input string."),null;if((ke=F(oe,!S(ee)))===null)return null;if(ee.host=ke,oe="",pe=l.ParserState.Port,ge===l.ParserState.Hostname)return ee}break;case l.ParserState.Port:if(d.codePoint.ASCIIDigit.test(Ee.c()))oe+=Ee.c();else{if(!(Ee.c()===""||Ee.c()==="/"||Ee.c()==="?"||Ee.c()==="#"||S(ee)&&Ee.c()==="\\"||ge))return y("Invalid input string."),null;if(oe!==""&&oe!==""){var Oe=parseInt(oe,10);if(Oe>Math.pow(2,16)-1)return y("Invalid port number."),null;ee.port=Oe===T(ee.scheme)?null:Oe,oe=""}if(ge!==void 0)return ee;pe=l.ParserState.PathStart,Ee.pointer--}break;case l.ParserState.File:if(ee.scheme="file",Ee.c()==="/"||Ee.c()==="\\")Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.FileSlash;else if(K!==null&&K.scheme==="file")switch(Ee.c()){case"":ee.host=K.host,ee.path=d.list.clone(K.path),ee.query=K.query;break;case"?":ee.host=K.host,ee.path=d.list.clone(K.path),ee.query="",pe=l.ParserState.Query;break;case"#":ee.host=K.host,ee.path=d.list.clone(K.path),ee.query=K.query,ee.fragment="",pe=l.ParserState.Fragment;break;default:L(Ee.substring())?y("Unexpected windows drive letter in input string."):(ee.host=K.host,ee.path=d.list.clone(K.path),A(ee)),pe=l.ParserState.Path,Ee.pointer--}else pe=l.ParserState.Path,Ee.pointer--;break;case l.ParserState.FileSlash:Ee.c()==="/"||Ee.c()==="\\"?(Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.FileHost):(K===null||K.scheme!=="file"||L(Ee.substring())||(G(K.path[0])?ee.path.push(K.path[0]):ee.host=K.host),pe=l.ParserState.Path,Ee.pointer--);break;case l.ParserState.FileHost:if(Ee.c()===""||Ee.c()==="/"||Ee.c()==="\\"||Ee.c()==="?"||Ee.c()==="#")if(Ee.pointer--,ge===void 0&&k(oe))y("Unexpected windows drive letter in input string."),pe=l.ParserState.Path;else if(oe===""){if(ee.host="",ge!==void 0)return ee;pe=l.ParserState.PathStart}else{var ke;if((ke=F(oe,!S(ee)))===null)return null;if(ke==="localhost"&&(ke=""),ee.host=ke,ge!==void 0)return ee;oe="",pe=l.ParserState.PathStart}else oe+=Ee.c();break;case l.ParserState.PathStart:S(ee)?(Ee.c()==="\\"&&y("Invalid input string."),pe=l.ParserState.Path,Ee.c()!=="/"&&Ee.c()!=="\\"&&Ee.pointer--):ge===void 0&&Ee.c()==="?"?(ee.query="",pe=l.ParserState.Query):ge===void 0&&Ee.c()==="#"?(ee.fragment="",pe=l.ParserState.Fragment):Ee.c()!==""&&(pe=l.ParserState.Path,Ee.c()!=="/"&&Ee.pointer--);break;case l.ParserState.Path:if(Ee.c()===""||Ee.c()==="/"||S(ee)&&Ee.c()==="\\"||ge===void 0&&(Ee.c()==="?"||Ee.c()==="#")){if(S(ee)&&Ee.c()==="\\"&&y("Invalid input string."),R(oe))A(ee),Ee.c()==="/"||S(ee)&&Ee.c()==="\\"||ee.path.push("");else if(!M(oe)||Ee.c()==="/"||S(ee)&&Ee.c()==="\\"){if(!M(oe)){if(ee.scheme==="file"&&ee.path.length===0&&k(oe)){ee.host!==null&&ee.host!==""&&(y("Invalid input string."),ee.host="");var nt=Array.from(oe);oe=nt.slice(0,1)+":"+nt.slice(2)}ee.path.push(oe)}}else ee.path.push("");if(oe="",ee.scheme==="file"&&(Ee.c()===""||Ee.c()==="?"||Ee.c()==="#"))for(;ee.path.length>1&&ee.path[0]==="";)y("Invalid input string."),ee.path.splice(0,1);Ee.c()==="?"&&(ee.query="",pe=l.ParserState.Query),Ee.c()==="#"&&(ee.fragment="",pe=l.ParserState.Fragment)}else w.test(Ee.c())||Ee.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Ee.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Ee.remaining())||y("Percent encoded character must be followed by two hex digits."),oe+=Se(Ee.c(),p);break;case l.ParserState.CannotBeABaseURLPath:Ee.c()==="?"?(ee.query="",pe=l.ParserState.Query):Ee.c()==="#"?(ee.fragment="",pe=l.ParserState.Fragment):(Ee.c()===""||w.test(Ee.c())||Ee.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Ee.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Ee.remaining())||y("Percent encoded character must be followed by two hex digits."),Ee.c()!==""&&(ee.path[0]+=Se(Ee.c(),h)));break;case l.ParserState.Query:if(We==="UTF-8"||S(ee)&&ee.scheme!=="ws"&&ee.scheme!=="wss"||(We="UTF-8"),ge===void 0&&Ee.c()==="#")ee.fragment="",pe=l.ParserState.Fragment;else if(Ee.c()!==""){if(w.test(Ee.c())||Ee.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Ee.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Ee.remaining())||y("Percent encoded character must be followed by two hex digits."),We.toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var wt=c.utf8Encode(Ee.c());if(wt.length>=3&&wt[0]===38&&wt[1]===35&&wt[wt.length-1]===59)wt=wt.subarray(2,wt.length-1),ee.query+="%26%23"+d.byteSequence.isomorphicDecode(wt)+"%3B";else try{for(var gn=(Ge=void 0,o(wt)),Sn=gn.next();!Sn.done;Sn=gn.next()){var ln=Sn.value;ln<33||ln>126||ln===34||ln===35||ln===60||ln===62||ln===39&&S(ee)?ee.query+=fe(ln):ee.query+=String.fromCharCode(ln)}}catch(on){Ge={error:on}}finally{try{Sn&&!Sn.done&&(re=gn.return)&&re.call(gn)}finally{if(Ge)throw Ge.error}}}break;case l.ParserState.Fragment:Ee.c()===""||(Ee.c()==="\0"?y("NULL character in input string."):(w.test(Ee.c())||Ee.c()==="%"||y("Unexpected character in fragment string."),Ee.c()!=="%"||/^[A-Za-z0-9][A-Za-z0-9]/.test(Ee.remaining())||y("Unexpected character in fragment string."),ee.fragment+=Se(Ee.c(),g)))}if(Ee.eof)break;Ee.pointer++}return ee}function M(W){return W==="."||W.toLowerCase()==="%2e"}function R(W){var K=W.toLowerCase();return K===".."||K===".%2e"||K==="%2e."||K==="%2e%2e"}function A(W){var K=W.path;K.length!==0&&(W.scheme==="file"&&K.length===1&&G(K[0])||W.path.splice(W.path.length-1,1))}function G(W){return W.length>=2&&d.codePoint.ASCIIAlpha.test(W[0])&&W[1]===":"}function k(W){return W.length>=2&&d.codePoint.ASCIIAlpha.test(W[0])&&(W[1]===":"||W[1]==="|")}function L(W){return W.length>=2&&k(W)&&(W.length===2||W[2]==="/"||W[2]==="\\"||W[2]==="?"||W[2]==="#")}function F(W,K){if(K===void 0&&(K=!1),W.startsWith("["))return W.endsWith("]")?ie(W.substring(1,W.length-1)):(y("Expected ']' after '['."),null);if(K)return de(W);var Q=$(c.utf8Decode(_e(W)));if(Q===null||m.test(Q))return y("Invalid domain."),null;var ee=Y(Q);return ee===null||c.isNumber(ee)?ee:Q}function j(W,K){K===void 0&&(K={value:!1});var Q=10;return W.startsWith("0x")||W.startsWith("0X")?(K.value=!0,W=W.substr(2),Q=16):W.length>=2&&W[0]==="0"&&(K.value=!0,W=W.substr(1),Q=8),W===""?0:(Q===10?/^[0-9]+$/:Q===16?/^[0-9A-Fa-f]+$/:/^[0-7]+$/).test(W)?parseInt(W,Q):null}function Y(W){var K,Q,ee,ge,De={value:!1},Le=W.split(".");if(Le[Le.length-1]===""&&(De.value=!0,Le.length>1&&Le.pop()),Le.length>4)return W;var Ge=[];try{for(var re=o(Le),se=re.next();!se.done;se=re.next()){var ve=se.value;if(ve===""||(gt=j(ve,De))===null)return W;Ge.push(gt)}}catch(ct){K={error:ct}}finally{try{se&&!se.done&&(Q=re.return)&&Q.call(re)}finally{if(K)throw K.error}}De.value&&y("Invalid IP v4 address.");for(var le=0;le<Ge.length;le++)if(Ge[le]>255&&(y("Invalid IP v4 address."),le<Ge.length-1))return null;if(Ge[Ge.length-1]>=Math.pow(256,5-Ge.length))return y("Invalid IP v4 address."),null;var pe=Ge[Ge.length-1];Ge.pop();var We=0;try{for(var oe=o(Ge),st=oe.next();!st.done;st=oe.next()){var gt;pe+=(gt=st.value)*Math.pow(256,3-We),We++}}catch(ct){ee={error:ct}}finally{try{st&&!st.done&&(ge=oe.return)&&ge.call(oe)}finally{if(ee)throw ee.error}}return pe}function ie(W){var K,Q=[0,0,0,0,0,0,0,0],ee=0,ge=null,De=new c.StringWalker(W);if(De.c()===":"){if(!De.remaining().startsWith(":"))return y("Invalid IP v6 address."),null;De.pointer+=2,ge=ee+=1}for(;De.c()!=="";){if(ee===8)return y("Invalid IP v6 address."),null;if(De.c()!==":"){for(var Le=0,Ge=0;Ge<4&&d.codePoint.ASCIIHexDigit.test(De.c());)Le=16*Le+parseInt(De.c(),16),De.pointer++,Ge++;if(De.c()==="."){if(Ge===0||(De.pointer-=Ge,ee>6))return y("Invalid IP v6 address."),null;for(var re=0;De.c()!=="";){var se=null;if(re>0){if(!(De.c()==="."&&re<4))return y("Invalid IP v6 address."),null;De.pointer++}if(!d.codePoint.ASCIIDigit.test(De.c()))return y("Invalid IP v6 address."),null;for(;d.codePoint.ASCIIDigit.test(De.c());){var ve=parseInt(De.c(),10);if(se===null)se=ve;else{if(se===0)return y("Invalid IP v6 address."),null;se=10*se+ve}if(se>255)return y("Invalid IP v6 address."),null;De.pointer++}if(se===null)return y("Invalid IP v6 address."),null;Q[ee]=256*Q[ee]+se,++re!==2&&re!==4||ee++}if(re!==4)return y("Invalid IP v6 address."),null;break}if(De.c()===":"){if(De.pointer++,De.c()==="")return y("Invalid IP v6 address."),null}else if(De.c()!=="")return y("Invalid IP v6 address."),null;Q[ee]=Le,ee++}else{if(ge!==null)return y("Invalid IP v6 address."),null;De.pointer++,ge=++ee}}if(ge!==null){var le=ee-ge;for(ee=7;ee!==0&&le>0;)K=a([Q[ge+le-1],Q[ee]],2),Q[ee]=K[0],Q[ge+le-1]=K[1],ee--,le--}else if(ge===null&&ee!==8)return y("Invalid IP v6 address."),null;return Q}function de(W){var K,Q;if(/[\x00\t\f\r #/:?@\[\\\]]/.test(W))return y("Invalid host string."),null;var ee="";try{for(var ge=o(W),De=ge.next();!De.done;De=ge.next())ee+=Se(De.value,h)}catch(Le){K={error:Le}}finally{try{De&&!De.done&&(Q=ge.return)&&Q.call(ge)}finally{if(K)throw K.error}}return ee}function ae(W){return null}function fe(W){return"%"+("00"+W.toString(16).toUpperCase()).slice(-2)}function we(W){for(var K=function(Ge){return Ge>=48&&Ge<=57||Ge>=65&&Ge<=70||Ge>=97&&Ge<=102},Q=new Uint8Array(W.length),ee=0,ge=0;ge<W.length;ge++){var De=W[ge];if(De!==37)Q[ee]=De,ee++;else if(De===37&&ge>=W.length-2)Q[ee]=De,ee++;else if(De!==37||K(W[ge+1])&&K(W[ge+2])){var Le=parseInt(c.utf8Decode(Uint8Array.of(W[ge+1],W[ge+2])),16);Q[ee]=Le,ee++,ge+=2}else Q[ee]=De,ee++}return Q.subarray(0,ee)}function _e(W){return we(c.utf8Encode(W))}function Se(W,K){var Q,ee;if(!K.test(W))return W;var ge=c.utf8Encode(W),De="";try{for(var Le=o(ge),Ge=Le.next();!Ge.done;Ge=Le.next())De+=fe(Ge.value)}catch(re){Q={error:re}}finally{try{Ge&&!Ge.done&&(ee=Le.return)&&ee.call(Le)}finally{if(Q)throw Q.error}}return De}function B(W){var K,Q,ee,ge,De=[],Le=[];try{for(var Ge=o(W),re=Ge.next();!re.done;re=Ge.next()){var se=re.value;se===38?(De.push(Uint8Array.from(Le)),Le=[]):Le.push(se)}}catch(Ke){K={error:Ke}}finally{try{re&&!re.done&&(Q=Ge.return)&&Q.call(Ge)}finally{if(K)throw K.error}}Le.length!==0&&De.push(Uint8Array.from(Le));var ve=[];try{for(var le=o(De),pe=le.next();!pe.done;pe=le.next()){var We=pe.value;if(We.length!==0){for(var oe=We.indexOf(61),st=oe!==-1?We.slice(0,oe):We,gt=oe!==-1?We.slice(oe+1):new Uint8Array,ct=0;ct<st.length;ct++)st[ct]===43&&(st[ct]=32);for(ct=0;ct<gt.length;ct++)gt[ct]===43&&(gt[ct]=32);var Ee=c.utf8Decode(st),ze=c.utf8Decode(gt);ve.push([Ee,ze])}}}catch(Ke){ee={error:Ke}}finally{try{pe&&!pe.done&&(ge=le.return)&&ge.call(le)}finally{if(ee)throw ee.error}}return ve}function P(W){var K,Q,ee="";try{for(var ge=o(W),De=ge.next();!De.done;De=ge.next()){var Le=De.value;ee+=Le===32?"+":Le===42||Le===45||Le===46||Le>=48&&Le<=57||Le>=65&&Le<=90||Le===95||Le>=97&&Le<=122?String.fromCodePoint(Le):fe(Le)}}catch(Ge){K={error:Ge}}finally{try{De&&!De.done&&(Q=ge.return)&&Q.call(ge)}finally{if(K)throw K.error}}return ee}function $(W,K){var Q=u.domainToASCII(W);return Q===""?(y("Invalid domain name."),null):Q}n.setValidationErrorCallback=function(W){s=W},n.newURL=C,n.isSpecialScheme=x,n.isSpecial=S,n.defaultPort=T,n.includesCredentials=_,n.cannotHaveAUsernamePasswordPort=function(W){return W.host===null||W.host===""||W._cannotBeABaseURLFlag||W.scheme==="file"},n.urlSerializer=E,n.hostSerializer=D,n.iPv4Serializer=b,n.iPv6Serializer=I,n.urlParser=function(W,K,Q){var ee=O(W,K,Q);return ee===null?null:(ee.scheme!=="blob"||(ee._blobURLEntry=null),ee)},n.basicURLParser=O,n.setTheUsername=function(W,K){var Q,ee,ge="";try{for(var De=o(K),Le=De.next();!Le.done;Le=De.next())ge+=Se(Le.value,v)}catch(Ge){Q={error:Ge}}finally{try{Le&&!Le.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}W.username=ge},n.setThePassword=function(W,K){var Q,ee,ge="";try{for(var De=o(K),Le=De.next();!Le.done;Le=De.next())ge+=Se(Le.value,v)}catch(Ge){Q={error:Ge}}finally{try{Le&&!Le.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}W.password=ge},n.isSingleDotPathSegment=M,n.isDoubleDotPathSegment=R,n.shorten=A,n.isNormalizedWindowsDriveLetter=G,n.isWindowsDriveLetter=k,n.startsWithAWindowsDriveLetter=L,n.hostParser=F,n.iPv4NumberParser=j,n.iPv4Parser=Y,n.iPv6Parser=ie,n.opaqueHostParser=de,n.resolveABlobURL=ae,n.percentEncode=fe,n.percentDecode=we,n.stringPercentDecode=_e,n.utf8PercentEncode=Se,n.hostEquals=function(W,K){return W===K},n.urlEquals=function(W,K,Q){return Q===void 0&&(Q=!1),E(W,Q)===E(K,Q)},n.urlEncodedStringParser=function(W){return B(c.utf8Encode(W))},n.urlEncodedParser=B,n.urlEncodedByteSerializer=P,n.urlEncodedSerializer=function(W,K){var Q,ee;if((K===void 0||K==="replacement"||K==="UTF-16BE"||K==="UTF-16LE"?"UTF-8":K).toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var ge="";try{for(var De=o(W),Le=De.next();!Le.done;Le=De.next()){var Ge=Le.value,re=P(c.utf8Encode(Ge[0])),se=Ge[1];se=P(c.utf8Encode(se)),ge!==""&&(ge+="&"),ge+=re+"="+se}}catch(ve){Q={error:ve}}finally{try{Le&&!Le.done&&(ee=De.return)&&ee.call(De)}finally{if(Q)throw Q.error}}return ge},n.origin=function W(K){switch(K.scheme){case"blob":K._blobURLEntry;var Q=O(K.path[0]);return Q===null?l.OpaqueOrigin:W(Q);case"ftp":case"http":case"https":case"ws":case"wss":return[K.scheme,K.host===null?"":K.host,K.port,null];case"file":default:return l.OpaqueOrigin}},n.domainToASCII=$,n.domainToUnicode=function(W,K){var Q=u.domainToUnicode(W);return Q===""&&y("Invalid domain name."),Q},n.asciiSerializationOfAnOrigin=function(W){if(W[0]===""&&W[1]===""&&W[2]===null&&W[3]===null)return"null";var K=W[0]+"://"+D(W[1]);return W[2]!==null&&(K+=":"+W[2].toString()),K}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=(function(){function s(){this._signal=o.create_abortSignal()}return Object.defineProperty(s.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),s.prototype.abort=function(){o.abort_signalAbort(this._signal)},s})();n.AbortControllerImpl=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var g in h)h.hasOwnProperty(g)&&(f[g]=h[g])})(d,u)},function(d,u){function f(){this.constructor=d}o(d,u),d.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(70),c=i(0),l=(function(d){function u(){var f=d.call(this)||this;return f._abortedFlag=!1,f._abortAlgorithms=new Set,f}return a(u,d),Object.defineProperty(u.prototype,"aborted",{get:function(){return this._abortedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onabort",{get:function(){return c.event_getterEventHandlerIDLAttribute(this,"onabort")},set:function(f){c.event_setterEventHandlerIDLAttribute(this,"onabort",f)},enumerable:!0,configurable:!0}),u._create=function(){return new u},u})(s.EventTargetImpl);n.AbortSignalImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(12),d=(function(u){function f(h,g,p){var v=u.call(this)||this;return v._name="",v._publicId="",v._systemId="",v._name=h,v._publicId=g,v._systemId=p,v}return a(f,u),Object.defineProperty(f.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"publicId",{get:function(){return this._publicId},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"systemId",{get:function(){return this._systemId},enumerable:!0,configurable:!0}),f.prototype.before=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},f.prototype.after=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},f.prototype.replaceWith=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},f.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},f._create=function(h,g,p,v){p===void 0&&(p=""),v===void 0&&(v="");var w=new f(g,p,v);return w._nodeDocument=h,w},f})(c.NodeImpl);n.DocumentTypeImpl=d,l.idl_defineConst(d.prototype,"_nodeType",s.NodeType.DocumentType)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(100),c=i(1),l=i(0),d=(function(u){function f(h,g){var p=u.call(this)||this;return p._host=h,p._mode=g,p}return a(f,u),Object.defineProperty(f.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),f.prototype._getTheParent=function(h){return h._composedFlag||c.isEmpty(h._path)||l.tree_rootNode(h._path[0].invocationTarget)!==this?this._host:null},f._create=function(h,g){return new f(g,"closed")},f})(s.DocumentFragmentImpl);n.ShadowRootImpl=d},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var v in p)p.hasOwnProperty(v)&&(g[v]=p[v])})(f,h)},function(f,h){function g(){this.constructor=f}o(f,h),f.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(0),d=i(12),u=(function(f){function h(g){var p=f.call(this)||this;return p._namespace=null,p._namespacePrefix=null,p._element=null,p._value="",p._localName=g,p}return a(h,f),Object.defineProperty(h.prototype,"ownerElement",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"name",{get:function(){return this._qualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"value",{get:function(){return this._value},set:function(g){l.attr_setAnExistingAttributeValue(this,g)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix!==null?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),h._create=function(g,p){var v=new h(p);return v._nodeDocument=g,v},h})(c.NodeImpl);n.AttrImpl=u,d.idl_defineConst(u.prototype,"_nodeType",s.NodeType.Attribute),d.idl_defineConst(u.prototype,"specified",!0)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(101),c=i(2),l=i(12),d=(function(u){function f(h){return u.call(this,h)||this}return a(f,u),f._create=function(h,g){g===void 0&&(g="");var p=new f(g);return p._nodeDocument=h,p},f})(s.TextImpl);n.CDATASectionImpl=d,l.idl_defineConst(d.prototype,"_nodeType",c.NodeType.CData)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(71),l=i(12),d=(function(u){function f(h){return h===void 0&&(h=""),u.call(this,h)||this}return a(f,u),f._create=function(h,g){g===void 0&&(g="");var p=new f(g);return p._nodeDocument=h,p},f})(c.CharacterDataImpl);n.CommentImpl=d,l.idl_defineConst(d.prototype,"_nodeType",s.NodeType.Comment)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(71),l=i(12),d=(function(u){function f(h,g){var p=u.call(this,g)||this;return p._target=h,p}return a(f,u),Object.defineProperty(f.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),f._create=function(h,g,p){var v=new f(g,p);return v._nodeDocument=h,v},f})(c.CharacterDataImpl);n.ProcessingInstructionImpl=d,l.idl_defineConst(d.prototype,"_nodeType",s.NodeType.ProcessingInstruction)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(7),a=i(0),s=i(3),c=i(1),l=(function(){function d(u,f){return this._live=!0,this._root=u,this._filter=f,new Proxy(this,this)}return Object.defineProperty(d.prototype,"length",{get:function(){for(var u=this,f=0,h=a.tree_getFirstDescendantNode(this._root,!1,!1,(function(g){return s.Guard.isElementNode(g)&&u._filter(g)}));h!==null;)f++,h=a.tree_getNextDescendantNode(this._root,h,!1,!1,(function(g){return s.Guard.isElementNode(g)&&u._filter(g)}));return f},enumerable:!0,configurable:!0}),d.prototype.item=function(u){for(var f=this,h=0,g=a.tree_getFirstDescendantNode(this._root,!1,!1,(function(p){return s.Guard.isElementNode(p)&&f._filter(p)}));g!==null;){if(h===u)return g;h++,g=a.tree_getNextDescendantNode(this._root,g,!1,!1,(function(p){return s.Guard.isElementNode(p)&&f._filter(p)}))}return null},d.prototype.namedItem=function(u){var f=this;if(u==="")return null;for(var h=a.tree_getFirstDescendantNode(this._root,!1,!1,(function(v){return s.Guard.isElementNode(v)&&f._filter(v)}));h!=null;){if(h._uniqueIdentifier===u)return h;if(h._namespace===o.namespace.HTML)for(var g=0;g<h._attributeList.length;g++){var p=h._attributeList[g];if(p._localName==="name"&&p._namespace===null&&p._namespacePrefix===null&&p._value===u)return h}h=a.tree_getNextDescendantNode(this._root,h,!1,!1,(function(v){return s.Guard.isElementNode(v)&&f._filter(v)}))}return null},d.prototype[Symbol.iterator]=function(){var u=this._root,f=this._filter,h=a.tree_getFirstDescendantNode(u,!1,!1,(function(g){return s.Guard.isElementNode(g)&&f(g)}));return{next:function(){if(h===null)return{done:!0,value:null};var g={done:!1,value:h};return h=a.tree_getNextDescendantNode(u,h,!1,!1,(function(p){return s.Guard.isElementNode(p)&&f(p)})),g}}},d.prototype.get=function(u,f,h){if(!c.isString(f)||d.reservedNames.indexOf(f)!==-1)return Reflect.get(u,f,h);var g=Number(f);return isNaN(g)?u.namedItem(f)||void 0:u.item(g)||void 0},d.prototype.set=function(u,f,h,g){if(!c.isString(f)||d.reservedNames.indexOf(f)!==-1)return Reflect.set(u,f,h,g);var p=Number(f),v=isNaN(p)?u.namedItem(f)||void 0:u.item(p)||void 0;return!(!v||!v._parent)&&(a.mutation_replace(v,h,v._parent),!0)},d._create=function(u,f){return f===void 0&&(f=function(){return!0}),new d(u,f)},d.reservedNames=["_root","_live","_filter","length","item","namedItem","get","set"],d})();n.HTMLCollectionImpl=l},function(r,n,i){var o=this&&this.__values||function(d){var u=typeof Symbol=="function"&&Symbol.iterator,f=u&&d[u],h=0;if(f)return f.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&h>=d.length&&(d=void 0),{value:d&&d[h++],done:!d}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(1),c=i(0),l=(function(){function d(u){return this._live=!0,this._filter=null,this._length=0,this._root=u,new Proxy(this,this)}return Object.defineProperty(d.prototype,"length",{get:function(){return this._root._children.size},enumerable:!0,configurable:!0}),d.prototype.item=function(u){if(u<0||u>this.length-1)return null;if(u<this.length/2){for(var f=0,h=this._root._firstChild;h!==null&&f!==u;)h=h._nextSibling,f++;return h}for(f=this.length-1,h=this._root._lastChild;h!==null&&f!==u;)h=h._previousSibling,f--;return h},d.prototype.keys=function(){var u;return(u={})[Symbol.iterator]=(function(){var f=0;return{next:(function(){return f===this.length?{done:!0,value:null}:{done:!1,value:f++}}).bind(this)}}).bind(this),u},d.prototype.values=function(){var u;return(u={})[Symbol.iterator]=(function(){var f=this[Symbol.iterator]();return{next:function(){return f.next()}}}).bind(this),u},d.prototype.entries=function(){var u;return(u={})[Symbol.iterator]=(function(){var f=this[Symbol.iterator](),h=0;return{next:function(){var g=f.next();return g.done?{done:!0,value:null}:{done:!1,value:[h++,g.value]}}}}).bind(this),u},d.prototype[Symbol.iterator]=function(){return this._root._children[Symbol.iterator]()},d.prototype.forEach=function(u,f){var h,g;f===void 0&&(f=a.dom.window);var p=0;try{for(var v=o(this._root._children),w=v.next();!w.done;w=v.next()){var m=w.value;u.call(f,m,p++,this)}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}},d.prototype.get=function(u,f,h){if(!s.isString(f))return Reflect.get(u,f,h);var g=Number(f);return isNaN(g)?Reflect.get(u,f,h):u.item(g)||void 0},d.prototype.set=function(u,f,h,g){if(!s.isString(f))return Reflect.set(u,f,h,g);var p=Number(f);if(isNaN(p))return Reflect.set(u,f,h,g);var v=u.item(p)||void 0;return!!v&&!!v._parent&&(c.mutation_replace(v,h,v._parent),!0)},d._create=function(u){return new d(u)},d})();n.NodeListImpl=l},function(r,n,i){var o=this&&this.__values||function(l){var d=typeof Symbol=="function"&&Symbol.iterator,u=d&&l[d],f=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(1),c=(function(){function l(d){return this._live=!1,this._items=[],this._length=0,this._root=d,this._items=[],this._filter=function(u){return!0},new Proxy(this,this)}return Object.defineProperty(l.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),l.prototype.item=function(d){return d<0||d>this.length-1?null:this._items[d]},l.prototype.keys=function(){var d;return(d={})[Symbol.iterator]=(function(){var u=0;return{next:(function(){return u===this.length?{done:!0,value:null}:{done:!1,value:u++}}).bind(this)}}).bind(this),d},l.prototype.values=function(){var d;return(d={})[Symbol.iterator]=(function(){var u=this[Symbol.iterator]();return{next:function(){return u.next()}}}).bind(this),d},l.prototype.entries=function(){var d;return(d={})[Symbol.iterator]=(function(){var u=this[Symbol.iterator](),f=0;return{next:function(){var h=u.next();return h.done?{done:!0,value:null}:{done:!1,value:[f++,h.value]}}}}).bind(this),d},l.prototype[Symbol.iterator]=function(){var d=this._items[Symbol.iterator]();return{next:function(){return d.next()}}},l.prototype.forEach=function(d,u){var f,h;u===void 0&&(u=a.dom.window);var g=0;try{for(var p=o(this._items),v=p.next();!v.done;v=p.next()){var w=v.value;d.call(u,w,g++,this)}}catch(m){f={error:m}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}},l.prototype.get=function(d,u,f){if(!s.isString(u))return Reflect.get(d,u,f);var h=Number(u);return isNaN(h)?Reflect.get(d,u,f):d._items[h]||void 0},l.prototype.set=function(d,u,f,h){if(!s.isString(u))return Reflect.set(d,u,f,h);var g=Number(u);return isNaN(g)?Reflect.set(d,u,f,h):g>=0&&g<d._items.length&&(d._items[g]=f,!0)},l._create=function(d,u){var f=new l(d);return f._items=u,f},l})();n.NodeListStaticImpl=c},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var g in h)h.hasOwnProperty(g)&&(f[g]=h[g])})(d,u)},function(d,u){function f(){this.constructor=d}o(d,u),d.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(9),c=i(0),l=(function(d){function u(f){var h=d.call(this)||this;return h._element=f,Object.setPrototypeOf(h,u.prototype),h}return a(u,d),u.prototype._asArray=function(){return this},u.prototype.item=function(f){return this[f]||null},u.prototype.getNamedItem=function(f){return c.element_getAnAttributeByName(f,this._element)},u.prototype.getNamedItemNS=function(f,h){return c.element_getAnAttributeByNamespaceAndLocalName(f||"",h,this._element)},u.prototype.setNamedItem=function(f){return c.element_setAnAttribute(f,this._element)},u.prototype.setNamedItemNS=function(f){return c.element_setAnAttribute(f,this._element)},u.prototype.removeNamedItem=function(f){var h=c.element_removeAnAttributeByName(f,this._element);if(h===null)throw new s.NotFoundError;return h},u.prototype.removeNamedItemNS=function(f,h){var g=c.element_removeAnAttributeByNamespaceAndLocalName(f||"",h,this._element);if(g===null)throw new s.NotFoundError;return g},u._create=function(f){return new u(f)},u})(Array);n.NamedNodeMapImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(v,w){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,y){m.__proto__=y}||function(m,y){for(var C in y)y.hasOwnProperty(C)&&(m[C]=y[C])})(v,w)},function(v,w){function m(){this.constructor=v}o(v,w),v.prototype=w===null?Object.create(w):(m.prototype=w.prototype,new m)}),s=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,m=w&&v[w],y=0;if(m)return m.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&y>=v.length&&(v=void 0),{value:v&&v[y++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),d=i(102),u=i(9),f=i(0),h=i(12),g=i(3),p=(function(v){function w(){var m=v.call(this)||this,y=c.dom.window._associatedDocument;return m._start=[y,0],m._end=[y,0],c.dom.rangeList.add(m),m}return a(w,v),Object.defineProperty(w.prototype,"commonAncestorContainer",{get:function(){for(var m=this._start[0];!f.tree_isAncestorOf(this._end[0],m,!0);){if(m._parent===null)throw new Error("Parent node  is null.");m=m._parent}return m},enumerable:!0,configurable:!0}),w.prototype.setStart=function(m,y){f.range_setTheStart(this,m,y)},w.prototype.setEnd=function(m,y){f.range_setTheEnd(this,m,y)},w.prototype.setStartBefore=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;f.range_setTheStart(this,y,f.tree_index(m))},w.prototype.setStartAfter=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;f.range_setTheStart(this,y,f.tree_index(m)+1)},w.prototype.setEndBefore=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;f.range_setTheEnd(this,y,f.tree_index(m))},w.prototype.setEndAfter=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;f.range_setTheEnd(this,y,f.tree_index(m)+1)},w.prototype.collapse=function(m){m?this._end=this._start:this._start=this._end},w.prototype.selectNode=function(m){f.range_select(m,this)},w.prototype.selectNodeContents=function(m){if(g.Guard.isDocumentTypeNode(m))throw new u.InvalidNodeTypeError;var y=f.tree_nodeLength(m);this._start=[m,0],this._end=[m,y]},w.prototype.compareBoundaryPoints=function(m,y){if(m!==l.HowToCompare.StartToStart&&m!==l.HowToCompare.StartToEnd&&m!==l.HowToCompare.EndToEnd&&m!==l.HowToCompare.EndToStart)throw new u.NotSupportedError;if(f.range_root(this)!==f.range_root(y))throw new u.WrongDocumentError;var C,x;switch(m){case l.HowToCompare.StartToStart:C=this._start,x=y._start;break;case l.HowToCompare.StartToEnd:C=this._end,x=y._start;break;case l.HowToCompare.EndToEnd:C=this._end,x=y._end;break;case l.HowToCompare.EndToStart:C=this._start,x=y._end;break;default:throw new u.NotSupportedError}var S=f.boundaryPoint_position(C,x);return S===l.BoundaryPosition.Before?-1:S===l.BoundaryPosition.After?1:0},w.prototype.deleteContents=function(){var m,y,C,x;if(!f.range_collapsed(this)){var S=this._startNode,T=this._startOffset,_=this._endNode,E=this._endOffset;if(S===_&&g.Guard.isCharacterDataNode(S))f.characterData_replaceData(S,T,E-T,"");else{var D,b,I=[];try{for(var O=s(f.range_getContainedNodes(this)),M=O.next();!M.done;M=O.next()){var R=(L=M.value)._parent;R!==null&&f.range_isContained(R,this)||I.push(L)}}catch(F){m={error:F}}finally{try{M&&!M.done&&(y=O.return)&&y.call(O)}finally{if(m)throw m.error}}if(f.tree_isAncestorOf(_,S,!0))D=S,b=T;else{for(var A=S;A._parent!==null&&!f.tree_isAncestorOf(_,A._parent,!0);)A=A._parent;if(A._parent===null)throw new Error("Parent node is null.");D=A._parent,b=f.tree_index(A)+1}g.Guard.isCharacterDataNode(S)&&f.characterData_replaceData(S,T,f.tree_nodeLength(S)-T,"");try{for(var G=s(I),k=G.next();!k.done;k=G.next()){var L;(L=k.value)._parent&&f.mutation_remove(L,L._parent)}}catch(F){C={error:F}}finally{try{k&&!k.done&&(x=G.return)&&x.call(G)}finally{if(C)throw C.error}}g.Guard.isCharacterDataNode(_)&&f.characterData_replaceData(_,0,E,""),this._start=[D,b],this._end=[D,b]}}},w.prototype.extractContents=function(){return f.range_extract(this)},w.prototype.cloneContents=function(){return f.range_cloneTheContents(this)},w.prototype.insertNode=function(m){return f.range_insert(m,this)},w.prototype.surroundContents=function(m){var y,C;try{for(var x=s(f.range_getPartiallyContainedNodes(this)),S=x.next();!S.done;S=x.next()){var T=S.value;if(!g.Guard.isTextNode(T))throw new u.InvalidStateError}}catch(E){y={error:E}}finally{try{S&&!S.done&&(C=x.return)&&C.call(x)}finally{if(y)throw y.error}}if(g.Guard.isDocumentNode(m)||g.Guard.isDocumentTypeNode(m)||g.Guard.isDocumentFragmentNode(m))throw new u.InvalidNodeTypeError;var _=f.range_extract(this);m._children.size!==0&&f.mutation_replaceAll(null,m),f.range_insert(m,this),f.mutation_append(_,m),f.range_select(m,this)},w.prototype.cloneRange=function(){return f.create_range(this._start,this._end)},w.prototype.detach=function(){c.dom.rangeList.delete(this)},w.prototype.isPointInRange=function(m,y){if(f.tree_rootNode(m)!==f.range_root(this))return!1;if(g.Guard.isDocumentTypeNode(m))throw new u.InvalidNodeTypeError;if(y>f.tree_nodeLength(m))throw new u.IndexSizeError;var C=[m,y];return f.boundaryPoint_position(C,this._start)!==l.BoundaryPosition.Before&&f.boundaryPoint_position(C,this._end)!==l.BoundaryPosition.After},w.prototype.comparePoint=function(m,y){if(f.tree_rootNode(m)!==f.range_root(this))throw new u.WrongDocumentError;if(g.Guard.isDocumentTypeNode(m))throw new u.InvalidNodeTypeError;if(y>f.tree_nodeLength(m))throw new u.IndexSizeError;var C=[m,y];return f.boundaryPoint_position(C,this._start)===l.BoundaryPosition.Before?-1:f.boundaryPoint_position(C,this._end)===l.BoundaryPosition.After?1:0},w.prototype.intersectsNode=function(m){if(f.tree_rootNode(m)!==f.range_root(this))return!1;var y=m._parent;if(y===null)return!0;var C=f.tree_index(m);return f.boundaryPoint_position([y,C],this._end)===l.BoundaryPosition.Before&&f.boundaryPoint_position([y,C+1],this._start)===l.BoundaryPosition.After},w.prototype.toString=function(){var m,y,C="";if(this._startNode===this._endNode&&g.Guard.isTextNode(this._startNode))return this._startNode._data.substring(this._startOffset,this._endOffset);g.Guard.isTextNode(this._startNode)&&(C+=this._startNode._data.substring(this._startOffset));try{for(var x=s(f.range_getContainedNodes(this)),S=x.next();!S.done;S=x.next()){var T=S.value;g.Guard.isTextNode(T)&&(C+=T._data)}}catch(_){m={error:_}}finally{try{S&&!S.done&&(y=x.return)&&y.call(x)}finally{if(m)throw m.error}}return g.Guard.isTextNode(this._endNode)&&(C+=this._endNode._data.substring(0,this._endOffset)),C},w._create=function(m,y){var C=new w;return m&&(C._start=m),y&&(C._end=y),C},w.START_TO_START=0,w.START_TO_END=1,w.END_TO_END=2,w.END_TO_START=3,w})(d.AbstractRangeImpl);n.RangeImpl=p,h.idl_defineConst(p.prototype,"START_TO_START",0),h.idl_defineConst(p.prototype,"START_TO_END",1),h.idl_defineConst(p.prototype,"END_TO_END",2),h.idl_defineConst(p.prototype,"END_TO_START",3)},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var g in h)h.hasOwnProperty(g)&&(f[g]=h[g])})(d,u)},function(d,u){function f(){this.constructor=d}o(d,u),d.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(103),c=i(0),l=(function(d){function u(f,h,g){var p=d.call(this,f)||this;return p._iteratorCollection=void 0,p._reference=h,p._pointerBeforeReference=g,c.nodeIterator_iteratorList().add(p),p}return a(u,d),Object.defineProperty(u.prototype,"referenceNode",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"pointerBeforeReferenceNode",{get:function(){return this._pointerBeforeReference},enumerable:!0,configurable:!0}),u.prototype.nextNode=function(){return c.nodeIterator_traverse(this,!0)},u.prototype.previousNode=function(){return c.nodeIterator_traverse(this,!1)},u.prototype.detach=function(){c.nodeIterator_iteratorList().delete(this)},u._create=function(f,h,g){return new u(f,h,g)},u})(s.TraverserImpl);n.NodeIteratorImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(103),l=i(0),d=(function(u){function f(h,g){var p=u.call(this,h)||this;return p._current=g,p}return a(f,u),Object.defineProperty(f.prototype,"currentNode",{get:function(){return this._current},set:function(h){this._current=h},enumerable:!0,configurable:!0}),f.prototype.parentNode=function(){for(var h=this._current;h!==null&&h!==this._root;)if((h=h._parent)!==null&&l.traversal_filter(this,h)===s.FilterResult.Accept)return this._current=h,h;return null},f.prototype.firstChild=function(){return l.treeWalker_traverseChildren(this,!0)},f.prototype.lastChild=function(){return l.treeWalker_traverseChildren(this,!1)},f.prototype.nextSibling=function(){return l.treeWalker_traverseSiblings(this,!0)},f.prototype.previousNode=function(){for(var h=this._current;h!==this._root;){for(var g=h._previousSibling;g;){h=g;for(var p=l.traversal_filter(this,h);p!==s.FilterResult.Reject&&h._lastChild;)h=h._lastChild,p=l.traversal_filter(this,h);if(p===s.FilterResult.Accept)return this._current=h,h;g=h._previousSibling}if(h===this._root||h._parent===null)return null;if(h=h._parent,l.traversal_filter(this,h)===s.FilterResult.Accept)return this._current=h,h}return null},f.prototype.previousSibling=function(){return l.treeWalker_traverseSiblings(this,!1)},f.prototype.nextNode=function(){for(var h=this._current,g=s.FilterResult.Accept;;){for(;g!==s.FilterResult.Reject&&h._firstChild;)if(h=h._firstChild,(g=l.traversal_filter(this,h))===s.FilterResult.Accept)return this._current=h,h;for(var p=null,v=h;v!==null;){if(v===this._root)return null;if((p=v._nextSibling)!==null){h=p;break}v=v._parent}if((g=l.traversal_filter(this,h))===s.FilterResult.Accept)return this._current=h,h}},f._create=function(h,g){return new f(h,g)},f})(c.TraverserImpl);n.TreeWalkerImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(12),s=(function(){function c(){}return c.prototype.acceptNode=function(l){return o.FilterResult.Accept},c._create=function(){return new c},c.FILTER_ACCEPT=1,c.FILTER_REJECT=2,c.FILTER_SKIP=3,c.SHOW_ALL=4294967295,c.SHOW_ELEMENT=1,c.SHOW_ATTRIBUTE=2,c.SHOW_TEXT=4,c.SHOW_CDATA_SECTION=8,c.SHOW_ENTITY_REFERENCE=16,c.SHOW_ENTITY=32,c.SHOW_PROCESSING_INSTRUCTION=64,c.SHOW_COMMENT=128,c.SHOW_DOCUMENT=256,c.SHOW_DOCUMENT_TYPE=512,c.SHOW_DOCUMENT_FRAGMENT=1024,c.SHOW_NOTATION=2048,c})();n.NodeFilterImpl=s,a.idl_defineConst(s.prototype,"FILTER_ACCEPT",1),a.idl_defineConst(s.prototype,"FILTER_REJECT",2),a.idl_defineConst(s.prototype,"FILTER_SKIP",3),a.idl_defineConst(s.prototype,"SHOW_ALL",4294967295),a.idl_defineConst(s.prototype,"SHOW_ELEMENT",1),a.idl_defineConst(s.prototype,"SHOW_ATTRIBUTE",2),a.idl_defineConst(s.prototype,"SHOW_TEXT",4),a.idl_defineConst(s.prototype,"SHOW_CDATA_SECTION",8),a.idl_defineConst(s.prototype,"SHOW_ENTITY_REFERENCE",16),a.idl_defineConst(s.prototype,"SHOW_ENTITY",32),a.idl_defineConst(s.prototype,"SHOW_PROCESSING_INSTRUCTION",64),a.idl_defineConst(s.prototype,"SHOW_COMMENT",128),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT",256),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT_TYPE",512),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT_FRAGMENT",1024),a.idl_defineConst(s.prototype,"SHOW_NOTATION",2048)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s,c,l,d,u,f,h,g,p){this._type=s,this._target=c,this._addedNodes=l,this._removedNodes=d,this._previousSibling=u,this._nextSibling=f,this._attributeName=h,this._attributeNamespace=g,this._oldValue=p}return Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"addedNodes",{get:function(){return this._addedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"removedNodes",{get:function(){return this._removedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"attributeName",{get:function(){return this._attributeName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"attributeNamespace",{get:function(){return this._attributeNamespace},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),a._create=function(s,c,l,d,u,f,h,g,p){return new a(s,c,l,d,u,f,h,g,p)},a})();n.MutationRecordImpl=o},function(r,n,i){var o=this&&this.__values||function(u){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&u[f],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(9),c=i(7),l=i(0),d=(function(){function u(f,h){this._element=f,this._attribute=h,this._tokenSet=new Set;var g=h._localName,p=l.element_getAnAttributeValue(f,g),v=this;this._element._attributeChangeSteps.push((function(w,m,y,C,x){m===v._attribute._localName&&x===null&&(C?v._tokenSet=l.orderedSet_parse(C):v._tokenSet.clear())})),a.dom.features.steps&&l.dom_runAttributeChangeSteps(f,g,p,p,null)}return Object.defineProperty(u.prototype,"length",{get:function(){return this._tokenSet.size},enumerable:!0,configurable:!0}),u.prototype.item=function(f){var h,g,p=0;try{for(var v=o(this._tokenSet),w=v.next();!w.done;w=v.next()){var m=w.value;if(p===f)return m;p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}return null},u.prototype.contains=function(f){return this._tokenSet.has(f)},u.prototype.add=function(){for(var f,h,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];try{for(var v=o(g),w=v.next();!w.done;w=v.next()){var m=w.value;if(m==="")throw new s.SyntaxError("Cannot add an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(m))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.add(m)}}catch(y){f={error:y}}finally{try{w&&!w.done&&(h=v.return)&&h.call(v)}finally{if(f)throw f.error}}l.tokenList_updateSteps(this)},u.prototype.remove=function(){for(var f,h,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];try{for(var v=o(g),w=v.next();!w.done;w=v.next()){var m=w.value;if(m==="")throw new s.SyntaxError("Cannot remove an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(m))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.delete(m)}}catch(y){f={error:y}}finally{try{w&&!w.done&&(h=v.return)&&h.call(v)}finally{if(f)throw f.error}}l.tokenList_updateSteps(this)},u.prototype.toggle=function(f,h){if(h===void 0&&(h=void 0),f==="")throw new s.SyntaxError("Cannot toggle an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(f))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return this._tokenSet.has(f)?h!==void 0&&h!==!1||(this._tokenSet.delete(f),l.tokenList_updateSteps(this),!1):(h===void 0||h===!0)&&(this._tokenSet.add(f),l.tokenList_updateSteps(this),!0)},u.prototype.replace=function(f,h){if(f===""||h==="")throw new s.SyntaxError("Cannot replace an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(f)||c.codePoint.ASCIIWhiteSpace.test(h))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return!!this._tokenSet.has(f)&&(c.set.replace(this._tokenSet,f,h),l.tokenList_updateSteps(this),!0)},u.prototype.supports=function(f){return l.tokenList_validationSteps(this,f)},Object.defineProperty(u.prototype,"value",{get:function(){return l.tokenList_serializeSteps(this)},set:function(f){l.element_setAnAttributeValue(this._element,this._attribute._localName,f)},enumerable:!0,configurable:!0}),u.prototype[Symbol.iterator]=function(){var f=this._tokenSet[Symbol.iterator]();return{next:function(){return f.next()}}},u._create=function(f,h){return new u(f,h)},u})();n.DOMTokenListImpl=d},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var g in h)h.hasOwnProperty(g)&&(f[g]=h[g])})(d,u)},function(d,u){function f(){this.constructor=d}o(d,u),d.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(104),c=i(0),l=(function(d){function u(f,h){var g=d.call(this,f,h)||this;return g._detail=null,g._detail=h&&h.detail||null,g}return a(u,d),Object.defineProperty(u.prototype,"detail",{get:function(){return this._detail},enumerable:!0,configurable:!0}),u.prototype.initCustomEvent=function(f,h,g,p){h===void 0&&(h=!1),g===void 0&&(g=!1),p===void 0&&(p=null),this._dispatchFlag||(c.event_initialize(this,f,h,g),this._detail=p)},u})(s.EventImpl);n.CustomEventImpl=l},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(2),s=i(105),c=i(17);n.nodeIterator_traverse=function(l,d){for(var u=l._reference,f=l._pointerBeforeReference;;){if(d)if(f)f=!1;else{var h=c.tree_getFollowingNode(l._root,u);if(!h)return null;u=h}else if(f){var g=c.tree_getPrecedingNode(l.root,u);if(!g)return null;u=g}else f=!0;if(s.traversal_filter(l,u)===a.FilterResult.Accept)break}return l._reference=u,l._pointerBeforeReference=f,u},n.nodeIterator_iteratorList=function(){return o.dom.window._iteratorList}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(9),a=i(7),s=i(174);function c(l){if(!s.xml_isName(l))throw new o.InvalidCharacterError("Invalid XML name: "+l);if(!s.xml_isQName(l))throw new o.InvalidCharacterError("Invalid XML qualified name: "+l+".")}n.namespace_validate=c,n.namespace_validateAndExtract=function(l,d){l||(l=null),c(d);var u=d.split(":"),f=u.length===2?u[0]:null,h=u.length===2?u[1]:d;if(f&&l===null)throw new o.NamespaceError("Qualified name includes a prefix but the namespace is null.");if(f==="xml"&&l!==a.namespace.XML)throw new o.NamespaceError('Qualified name includes the "xml" prefix but the namespace is not the XML namespace.');if(l!==a.namespace.XMLNS&&(f==="xmlns"||d==="xmlns"))throw new o.NamespaceError('Qualified name includes the "xmlns" prefix but the namespace is not the XMLNS namespace.');if(l===a.namespace.XMLNS&&f!=="xmlns"&&d!=="xmlns")throw new o.NamespaceError('Qualified name does not include the "xmlns" prefix but the namespace is the XMLNS namespace.');return[l,f,h]},n.namespace_extractQName=function(l){c(l);var d=l.split(":");return[d.length===2?d[0]:null,d.length===2?d[1]:l]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.xml_isName=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s>=97&&s<=122||s>=65&&s<=90||s===58||s===95||s>=192&&s<=214||s>=216&&s<=246||s>=248&&s<=767||s>=880&&s<=893||s>=895&&s<=8191||s>=8204&&s<=8205||s>=8304&&s<=8591||s>=11264&&s<=12271||s>=12289&&s<=55295||s>=63744&&s<=64975||s>=65008&&s<=65533)&&(a===0||!(s===45||s===46||s>=48&&s<=57||s===183||s>=768&&s<=879||s>=8255&&s<=8256))){if(s>=55296&&s<=56319&&a<o.length-1){var c=o.charCodeAt(a+1);if(c>=56320&&c<=57343&&(a++,(s=1024*(s-55296)+c-56320+65536)>=65536&&s<=983039))continue}return!1}}return!0},n.xml_isQName=function(o){for(var a=!1,s=0;s<o.length;s++){var c=o.charCodeAt(s);if(!(c>=97&&c<=122||c>=65&&c<=90||c===95||c>=192&&c<=214||c>=216&&c<=246||c>=248&&c<=767||c>=880&&c<=893||c>=895&&c<=8191||c>=8204&&c<=8205||c>=8304&&c<=8591||c>=11264&&c<=12271||c>=12289&&c<=55295||c>=63744&&c<=64975||c>=65008&&c<=65533)&&(s===0||!(c===45||c===46||c>=48&&c<=57||c===183||c>=768&&c<=879||c>=8255&&c<=8256))){if(s===0||c!==58){if(c>=55296&&c<=56319&&s<o.length-1){var l=o.charCodeAt(s+1);if(l>=56320&&l<=57343&&(s++,(c=1024*(c-55296)+l-56320+65536)>=65536&&c<=983039))continue}return!1}if(a||s===o.length-1)return!1;a=!0}}return!0},n.xml_isLegalChar=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s===9||s===10||s===13||s>=32&&s<=55295||s>=57344&&s<=65533)){if(s>=55296&&s<=56319&&a<o.length-1){var c=o.charCodeAt(a+1);if(c>=56320&&c<=57343&&(a++,(s=1024*(s-55296)+c-56320+65536)>=65536&&s<=1114111))continue}return!1}}return!0},n.xml_isPubidChar=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s>=97&&s<=122||s>=65&&s<=90||s>=39&&s<=59||s===32||s===13||s===10||s>=35&&s<=37||s===33||s===61||s===63||s===64||s===95))return!1}return!0}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(17);n.boundaryPoint_position=function s(c,l){var d=c[0],u=c[1],f=l[0],h=l[1];if(console.assert(a.tree_rootNode(d)===a.tree_rootNode(f),"Boundary points must share the same root node."),d===f)return u===h?o.BoundaryPosition.Equal:u<h?o.BoundaryPosition.Before:o.BoundaryPosition.After;if(a.tree_isFollowing(f,d)){var g=s([f,h],[d,u]);if(g===o.BoundaryPosition.Before)return o.BoundaryPosition.After;if(g===o.BoundaryPosition.After)return o.BoundaryPosition.Before}if(a.tree_isAncestorOf(f,d)){for(var p=f;!a.tree_isChildOf(d,p);)p._parent!==null&&(p=p._parent);if(a.tree_index(p)<u)return o.BoundaryPosition.After}return o.BoundaryPosition.Before}},function(r,n,i){var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,v=p&&g[p],w=0;if(v)return v.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(7),l=i(29),d=i(108),u=i(30),f=i(37),h=i(52);n.node_stringReplaceAll=function(g,p){var v=null;g!==""&&(v=l.create_text(p._nodeDocument,g)),f.mutation_replaceAll(v,p)},n.node_clone=function g(p,v,w){var m,y,C,x,S;if(v===void 0&&(v=null),w===void 0&&(w=!1),v===null&&(v=p._nodeDocument),s.Guard.isElementNode(p)){S=h.element_createAnElement(v,p._localName,p._namespace,p._namespacePrefix,p._is,!1);try{for(var T=o(p._attributeList),_=T.next();!_.done;_=T.next()){var E=g(_.value,v);h.element_append(E,S)}}catch(R){m={error:R}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}}else if(s.Guard.isDocumentNode(p)){var D=l.create_document();D._encoding=p._encoding,D._contentType=p._contentType,D._URL=p._URL,D._origin=p._origin,D._type=p._type,D._mode=p._mode,S=D}else if(s.Guard.isDocumentTypeNode(p))S=l.create_documentType(v,p._name,p._publicId,p._systemId);else if(s.Guard.isAttrNode(p)){var b=l.create_attr(v,p.localName);b._namespace=p._namespace,b._namespacePrefix=p._namespacePrefix,b._value=p._value,S=b}else S=s.Guard.isExclusiveTextNode(p)?l.create_text(v,p._data):s.Guard.isCDATASectionNode(p)?l.create_cdataSection(v,p._data):s.Guard.isCommentNode(p)?l.create_comment(v,p._data):s.Guard.isProcessingInstructionNode(p)?l.create_processingInstruction(v,p._target,p._data):s.Guard.isDocumentFragmentNode(p)?l.create_documentFragment(v):Object.create(p);if(s.Guard.isDocumentNode(S)?(S._nodeDocument=S,v=S):S._nodeDocument=v,a.dom.features.steps&&u.dom_runCloningSteps(S,p,v,w),w)try{for(var I=o(p._children),O=I.next();!O.done;O=I.next()){var M=g(O.value,v,!0);f.mutation_append(M,S)}}catch(R){C={error:R}}finally{try{O&&!O.done&&(x=I.return)&&x.call(I)}finally{if(C)throw C.error}}return S},n.node_equals=function g(p,v){var w,m,y,C;if(p._nodeType!==v._nodeType)return!1;if(s.Guard.isDocumentTypeNode(p)&&s.Guard.isDocumentTypeNode(v)){if(p._name!==v._name||p._publicId!==v._publicId||p._systemId!==v._systemId)return!1}else if(s.Guard.isElementNode(p)&&s.Guard.isElementNode(v)){if(p._namespace!==v._namespace||p._namespacePrefix!==v._namespacePrefix||p._localName!==v._localName||p._attributeList.length!==v._attributeList.length)return!1}else if(s.Guard.isAttrNode(p)&&s.Guard.isAttrNode(v)){if(p._namespace!==v._namespace||p._localName!==v._localName||p._value!==v._value)return!1}else if(s.Guard.isProcessingInstructionNode(p)&&s.Guard.isProcessingInstructionNode(v)){if(p._target!==v._target||p._data!==v._data)return!1}else if(s.Guard.isCharacterDataNode(p)&&s.Guard.isCharacterDataNode(v)&&p._data!==v._data)return!1;if(s.Guard.isElementNode(p)&&s.Guard.isElementNode(v)){var x={};try{for(var S=o(p._attributeList),T=S.next();!T.done;T=S.next())x[(D=T.value)._localName]=D}catch(A){w={error:A}}finally{try{T&&!T.done&&(m=S.return)&&m.call(S)}finally{if(w)throw w.error}}try{for(var _=o(v._attributeList),E=_.next();!E.done;E=_.next()){var D,b=E.value;if(!(D=x[b._localName])||!g(D,b))return!1}}catch(A){y={error:A}}finally{try{E&&!E.done&&(C=_.return)&&C.call(_)}finally{if(y)throw y.error}}}if(p._children.size!==v._children.size)return!1;for(var I=p._children[Symbol.iterator](),O=v._children[Symbol.iterator](),M=I.next(),R=O.next();!M.done&&!R.done;){if(!g(M.value,R.value))return!1;M=I.next(),R=O.next()}return!0},n.node_listOfElementsWithQualifiedName=function(g,p){return g==="*"?l.create_htmlCollection(p):p._nodeDocument._type==="html"?l.create_htmlCollection(p,(function(v){return v._namespace===c.namespace.HTML&&v._qualifiedName===g.toLowerCase()||v._namespace!==c.namespace.HTML&&v._qualifiedName===g})):l.create_htmlCollection(p,(function(v){return v._qualifiedName===g}))},n.node_listOfElementsWithNamespace=function(g,p,v){return g===""&&(g=null),g==="*"&&p==="*"?l.create_htmlCollection(v):g==="*"?l.create_htmlCollection(v,(function(w){return w._localName===p})):p==="*"?l.create_htmlCollection(v,(function(w){return w._namespace===g})):l.create_htmlCollection(v,(function(w){return w._localName===p&&w._namespace===g}))},n.node_listOfElementsWithClassNames=function(g,p){var v=d.orderedSet_parse(g);if(v.size===0)return l.create_htmlCollection(p,(function(){return!1}));var w=p._nodeDocument._mode!=="quirks";return l.create_htmlCollection(p,(function(m){var y=m.classList;return d.orderedSet_contains(y._tokenSet,v,w)}))},n.node_locateANamespacePrefix=function g(p,v){if(p._namespace===v&&p._namespacePrefix!==null)return p._namespacePrefix;for(var w=0;w<p._attributeList.length;w++){var m=p._attributeList[w];if(m._namespacePrefix==="xmlns"&&m._value===v)return m._localName}return p._parent&&s.Guard.isElementNode(p._parent)?g(p._parent,v):null},n.node_locateANamespace=function g(p,v){if(s.Guard.isElementNode(p)){if(p._namespace!==null&&p._namespacePrefix===v)return p._namespace;for(var w=0;w<p._attributeList.length;w++){var m=p._attributeList[w];if(m._namespace===c.namespace.XMLNS&&m._namespacePrefix==="xmlns"&&m._localName===v||v===null&&m._namespace===c.namespace.XMLNS&&m._namespacePrefix===null&&m._localName==="xmlns")return m._value||null}return p.parentElement===null?null:g(p.parentElement,v)}return s.Guard.isDocumentNode(p)?p.documentElement===null?null:g(p.documentElement,v):s.Guard.isDocumentTypeNode(p)||s.Guard.isDocumentFragmentNode(p)?null:s.Guard.isAttrNode(p)?p._element===null?null:g(p._element,v):p._parent&&s.Guard.isElementNode(p._parent)?g(p._parent,v):null}},function(r,n,i){var o=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(9),l=i(29),d=i(17),u=i(107),f=i(37);n.text_contiguousTextNodes=function(h,g){var p;return g===void 0&&(g=!1),(p={})[Symbol.iterator]=function(){for(var v=h;v&&s.Guard.isTextNode(v._previousSibling);)v=v._previousSibling;return{next:function(){if(v&&!g&&v===h&&(v=s.Guard.isTextNode(v._nextSibling)?v._nextSibling:null),v===null)return{done:!0,value:null};var w={done:!1,value:v};return v=s.Guard.isTextNode(v._nextSibling)?v._nextSibling:null,w}}},p},n.text_contiguousExclusiveTextNodes=function(h,g){var p;return g===void 0&&(g=!1),(p={})[Symbol.iterator]=function(){for(var v=h;v&&s.Guard.isExclusiveTextNode(v._previousSibling);)v=v._previousSibling;return{next:function(){if(v&&!g&&v===h&&(v=s.Guard.isExclusiveTextNode(v._nextSibling)?v._nextSibling:null),v===null)return{done:!0,value:null};var w={done:!1,value:v};return v=s.Guard.isExclusiveTextNode(v._nextSibling)?v._nextSibling:null,w}}},p},n.text_descendantTextContent=function(h){for(var g="",p=d.tree_getFirstDescendantNode(h,!1,!1,(function(v){return s.Guard.isTextNode(v)}));p!==null;)g+=p._data,p=d.tree_getNextDescendantNode(h,p,!1,!1,(function(v){return s.Guard.isTextNode(v)}));return g},n.text_split=function(h,g){var p,v,w=h._data.length;if(g>w)throw new c.IndexSizeError;var m=w-g,y=u.characterData_substringData(h,g,m),C=l.create_text(h._nodeDocument,y),x=h._parent;if(x!==null){f.mutation_insert(C,x,h._nextSibling);try{for(var S=o(a.dom.rangeList),T=S.next();!T.done;T=S.next()){var _=T.value;_._start[0]===h&&_._start[1]>g&&(_._start[0]=C,_._start[1]-=g),_._end[0]===h&&_._end[1]>g&&(_._end[0]=C,_._end[1]-=g);var E=d.tree_index(h);_._start[0]===x&&_._start[1]===E+1&&_._start[1]++,_._end[0]===x&&_._end[1]===E+1&&_._end[1]++}}catch(D){p={error:D}}finally{try{T&&!T.done&&(v=S.return)&&v.call(S)}finally{if(p)throw p.error}}}return u.characterData_replaceData(h,g,m,""),C}},function(r,n,i){var o=i(4),a=i(41),s=i(24),c=i(48),l=[].join,d=a!=Object,u=c("join",",");o({target:"Array",proto:!0,forced:d||!u},{join:function(f){return l.call(s(this),f===void 0?",":f)}})},function(r,n,i){var o=i(4),a=i(83),s=String.fromCharCode,c=String.fromCodePoint;o({target:"String",stat:!0,forced:!!c&&c.length!=1},{fromCodePoint:function(l){for(var d,u=[],f=arguments.length,h=0;f>h;){if(d=+arguments[h++],a(d,1114111)!==d)throw RangeError(d+" is not a valid code point");u.push(d<65536?s(d):s(55296+((d-=65536)>>10),d%1024+56320))}return u.join("")}})},function(r,n,i){var o=this&&this.__read||function(c,l){var d=typeof Symbol=="function"&&c[Symbol.iterator];if(!d)return c;var u,f,h=d.call(c),g=[];try{for(;(l===void 0||l-- >0)&&!(u=h.next()).done;)g.push(u.value)}catch(p){f={error:p}}finally{try{u&&!u.done&&(d=h.return)&&d.call(h)}finally{if(f)throw f.error}}return g};Object.defineProperty(n,"__esModule",{value:!0});var a=i(111),s=(function(){function c(l,d){this._options={skipWhitespaceOnlyText:!1},this.err={line:-1,col:-1,index:-1,str:""},this._str=l,this._index=0,this._length=l.length,d&&(this._options.skipWhitespaceOnlyText=d.skipWhitespaceOnlyText||!1)}return c.prototype.nextToken=function(){if(this.eof())return{type:a.TokenType.EOF};var l=this.skipIfStartsWith("<")?this.openBracket():this.text();return this._options.skipWhitespaceOnlyText&&l.type===a.TokenType.Text&&c.isWhiteSpaceToken(l)&&(l=this.nextToken()),l},c.prototype.openBracket=function(){return this.skipIfStartsWith("?")?this.skipIfStartsWith("xml")?c.isSpace(this._str[this._index])?this.declaration():(this.seek(-3),this.pi()):this.pi():this.skipIfStartsWith("!")?this.skipIfStartsWith("--")?this.comment():this.skipIfStartsWith("[CDATA[")?this.cdata():this.skipIfStartsWith("DOCTYPE")?this.doctype():void this.throwError("Invalid '!' in opening tag."):this.skipIfStartsWith("/")?this.closeTag():this.openTag()},c.prototype.declaration=function(){for(var l="",d="",u="";!this.eof();){if(this.skipSpace(),this.skipIfStartsWith("?>"))return{type:a.TokenType.Declaration,version:l,encoding:d,standalone:u};var f=o(this.attribute(),2),h=f[0],g=f[1];h==="version"?l=g:h==="encoding"?d=g:h==="standalone"?u=g:this.throwError("Invalid attribute name: "+h)}this.throwError("Missing declaration end symbol `?>`")},c.prototype.doctype=function(){var l="",d="";this.skipSpace();var u=this.takeUntil2("[",">",!0);return this.skipSpace(),this.skipIfStartsWith("PUBLIC")?(l=this.quotedString(),d=this.quotedString()):this.skipIfStartsWith("SYSTEM")&&(d=this.quotedString()),this.skipSpace(),this.skipIfStartsWith("[")&&(this.skipUntil("]"),this.skipIfStartsWith("]")||this.throwError("Missing end bracket of DTD internal subset")),this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing doctype end symbol `>`"),{type:a.TokenType.DocType,name:u,pubId:l,sysId:d}},c.prototype.pi=function(){var l=this.takeUntilStartsWith("?>",!0);if(this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.skipSpace(),this.skipIfStartsWith("?>"))return{type:a.TokenType.PI,target:l,data:""};var d=this.takeUntilStartsWith("?>");return this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.seek(2),{type:a.TokenType.PI,target:l,data:d}},c.prototype.text=function(){var l=this.takeUntil("<");return{type:a.TokenType.Text,data:l}},c.prototype.comment=function(){var l=this.takeUntilStartsWith("-->");return this.eof()&&this.throwError("Missing comment end symbol `-->`"),this.seek(3),{type:a.TokenType.Comment,data:l}},c.prototype.cdata=function(){var l=this.takeUntilStartsWith("]]>");return this.eof()&&this.throwError("Missing CDATA end symbol `]>`"),this.seek(3),{type:a.TokenType.CDATA,data:l}},c.prototype.openTag=function(){this.skipSpace();var l=this.takeUntil2(">","/",!0);if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:a.TokenType.Element,name:l,attributes:[],selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:a.TokenType.Element,name:l,attributes:[],selfClosing:!0};for(var d=[];!this.eof();){if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:a.TokenType.Element,name:l,attributes:d,selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:a.TokenType.Element,name:l,attributes:d,selfClosing:!0};var u=this.attribute();d.push(u)}this.throwError("Missing opening element tag end symbol `>`")},c.prototype.closeTag=function(){this.skipSpace();var l=this.takeUntil(">",!0);return this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing closing element tag end symbol `>`"),{type:a.TokenType.ClosingTag,name:l}},c.prototype.attribute=function(){this.skipSpace();var l=this.takeUntil("=",!0);return this.skipSpace(),this.skipIfStartsWith("=")||this.throwError("Missing equals sign before attribute value"),[l,this.quotedString()]},c.prototype.quotedString=function(){this.skipSpace();var l=this.take(1);c.isQuote(l)||this.throwError("Missing start quote character before quoted value");var d=this.takeUntil(l);return this.skipIfStartsWith(l)||this.throwError("Missing end quote character after quoted value"),d},c.prototype.eof=function(){return this._index>=this._length},c.prototype.skipIfStartsWith=function(l){var d=l.length;if(d===1)return this._str[this._index]===l&&(this._index++,!0);for(var u=0;u<d;u++)if(this._str[this._index+u]!==l[u])return!1;return this._index+=d,!0},c.prototype.seek=function(l){this._index+=l,this._index<0&&(this._index=0),this._index>this._length&&(this._index=this._length)},c.prototype.skipSpace=function(){for(;!this.eof()&&c.isSpace(this._str[this._index]);)this._index++},c.prototype.take=function(l){if(l===1)return this._str[this._index++];var d=this._index;return this.seek(l),this._str.slice(d,this._index)},c.prototype.takeUntil=function(l,d){d===void 0&&(d=!1);for(var u=this._index;this._index<this._length;){var f=this._str[this._index];if(f===l||d&&c.isSpace(f))break;this._index++}return this._str.slice(u,this._index)},c.prototype.takeUntil2=function(l,d,u){u===void 0&&(u=!1);for(var f=this._index;this._index<this._length;){var h=this._str[this._index];if(h===l||h===d||u&&c.isSpace(h))break;this._index++}return this._str.slice(f,this._index)},c.prototype.takeUntilStartsWith=function(l,d){d===void 0&&(d=!1);for(var u=this._index,f=l.length;this._index<this._length;){for(var h=!0,g=0;g<f;g++){var p=this._str[this._index+g],v=l[g];if(d&&c.isSpace(p))return this._str.slice(u,this._index);if(p!==v){this._index++,h=!1;break}}if(h)return this._str.slice(u,this._index)}return this._index=this._length,this._str.slice(u)},c.prototype.skipUntil=function(l){for(;this._index<this._length&&this._str[this._index]!==l;)this._index++},c.isWhiteSpaceToken=function(l){for(var d=l.data,u=0;u<d.length;u++){var f=d[u];if(f!==" "&&f!==`
`&&f!=="\r"&&f!=="	"&&f!=="\f")return!1}return!0},c.isSpace=function(l){return l===" "||l===`
`||l==="\r"||l==="	"},c.isQuote=function(l){return l==='"'||l==="'"},c.prototype.throwError=function(l){for(var d=/\r\n|\r|\n/g,u=null,f=0,h=0,g=this._str.length;(u=d.exec(this._str))!==null&&u!==null;)if(f++,u.index<this._index&&(h=d.lastIndex),u.index>this._index){g=u.index;break}throw this.err={line:f,col:this._index-h,index:this._index,str:this._str.substring(h,g)},new Error(l+`
Index: `+this.err.index+`
Ln: `+this.err.line+", Col: "+this.err.col+`
Input: `+this.err.str)},c.prototype[Symbol.iterator]=function(){return this._index=0,{next:(function(){var l=this.nextToken();return l.type===a.TokenType.EOF?{done:!0,value:null}:{done:!1,value:l}}).bind(this)}},c})();n.XMLStringLexer=s},function(r,n,i){var o=i(39);r.exports=new o({include:[i(182)]})},function(r,n,i){var o=i(39);r.exports=new o({include:[i(113)],implicit:[i(289),i(290),i(291),i(292)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(91),a=i(1),s=i(3),c=i(77),l=i(109);function d(g,p){var v=f(g===void 0||u(g)?g:o.DefaultBuilderOptions),w=u(g)?p:g,m=l.createDocument();h(m,v);var y=new c.XMLBuilderImpl(m);return w!==void 0&&y.ele(w),y}function u(g){if(!a.isPlainObject(g))return!1;for(var p in g)if(g.hasOwnProperty(p)&&!o.XMLBuilderOptionKeys.has(p))return!1;return!0}function f(g){g===void 0&&(g={});var p=a.applyDefaults(g,o.DefaultBuilderOptions);if(p.convert.att.length===0||p.convert.ins.length===0||p.convert.text.length===0||p.convert.cdata.length===0||p.convert.comment.length===0)throw new Error("JS object converter strings cannot be zero length.");return p}function h(g,p,v){var w=g;w._xmlBuilderOptions=p,w._isFragment=v}n.builder=function(g,p){var v=f(u(g)?g:o.DefaultBuilderOptions),w=s.Guard.isNode(g)||a.isArray(g)?g:p;if(w===void 0)throw new Error("Invalid arguments.");if(a.isArray(w)){for(var m=[],y=0;y<w.length;y++){var C=new c.XMLBuilderImpl(w[y]);C.set(v),m.push(C)}return m}var x=new c.XMLBuilderImpl(w);return x.set(v),x},n.create=d,n.fragment=function(g,p){var v=f(g===void 0||u(g)?g:o.DefaultBuilderOptions),w=u(g)?p:g,m=l.createDocument();h(m,v,!0);var y=new c.XMLBuilderImpl(m.createDocumentFragment());return w!==void 0&&y.ele(w),y},n.convert=function(g,p,v){var w,m,y;return u(g)&&p!==void 0?(w=g,m=p,y=v):(w=o.DefaultBuilderOptions,m=g,y=p||void 0),d(w,m).end(y)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(77);n.builder=o.builder,n.create=o.create,n.fragment=o.fragment,n.convert=o.convert,n.createCB=o.createCB,n.fragmentCB=o.fragmentCB},function(r,n,i){i(31),i(32),i(33),i(191),i(192),i(194),i(64),i(19),i(198),i(199),i(89),i(201),i(65),i(20),i(66),i(22),i(23);var o=this&&this.__read||function(w,m){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var C,x,S=y.call(w),T=[];try{for(;(m===void 0||m-- >0)&&!(C=S.next()).done;)T.push(C.value)}catch(_){x={error:_}}finally{try{C&&!C.done&&(y=S.return)&&y.call(S)}finally{if(x)throw x.error}}return T},a=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(91),c=i(1),l=i(217),d=i(2),u=i(3),f=i(0),h=i(109),g=i(7),p=i(276),v=(function(){function w(m){this._domNode=m}return Object.defineProperty(w.prototype,"node",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),w.prototype.set=function(m){return this._options=c.applyDefaults(c.applyDefaults(this._options,m,!0),s.DefaultBuilderOptions),this},w.prototype.ele=function(m,y,C){var x,S,T,_,E,D;if(c.isObject(m))return new p.ObjectReader(this._options).parse(this,m);if(m!==null&&/^\s*</.test(m))return new p.XMLReader(this._options).parse(this,m);if(m!==null&&/^\s*[\{\[]/.test(m))return new p.JSONReader(this._options).parse(this,m);if(m!==null&&/^(\s*|(#.*)|(%.*))*---/.test(m))return new p.YAMLReader(this._options).parse(this,m);if((m===null||c.isString(m))&&c.isString(y))_=(x=o([m,y,C],3))[0],E=x[1],D=x[2];else{if(m===null)throw new Error("Element name cannot be null. "+this._debugInfo());_=(S=o([void 0,m,c.isObject(y)?y:void 0],3))[0],E=S[1],D=S[2]}if(D&&(D=c.getValue(D)),_=(T=o(this._extractNamespace(h.sanitizeInput(_,this._options.invalidCharReplacement),h.sanitizeInput(E,this._options.invalidCharReplacement),!0),2))[0],E=T[1],_===void 0){var b=o(f.namespace_extractQName(E),1)[0];_=this.node.lookupNamespaceURI(b)}var I=_!=null?this._doc.createElementNS(_,E):this._doc.createElement(E);this.node.appendChild(I);var O=new w(I),M=this._doc.doctype;if(I===this._doc.documentElement&&M!==null){var R=this._doc.implementation.createDocumentType(this._doc.documentElement.tagName,M.publicId,M.systemId);this._doc.replaceChild(R,M)}return D&&!c.isEmpty(D)&&O.att(D),O},w.prototype.remove=function(){var m=this.up();return m.node.removeChild(this.node),m},w.prototype.att=function(m,y,C){var x,S,T,_,E,D,b=this;if(c.isMap(m)||c.isObject(m))return c.forEachObject(m,(function(k,L){return b.att(k,L)}),this),this;if(m!=null&&(m=c.getValue(m+"")),y!=null&&(y=c.getValue(y+"")),C!=null&&(C=c.getValue(C+"")),m!==null&&!c.isString(m)||!c.isString(y)||C!==null&&!c.isString(C)){if(!c.isString(m)||y!=null&&!c.isString(y))throw new Error("Attribute name and value not specified. "+this._debugInfo());_=(S=o([void 0,m,y],3))[0],E=S[1],D=S[2]}else _=(x=o([m,y,C],3))[0],E=x[1],D=x[2];if(this._options.keepNullAttributes&&D==null)D="";else if(D==null)return this;if(!u.Guard.isElementNode(this.node))throw new Error("An attribute can only be assigned to an element node.");var I=this.node;_=(T=o(this._extractNamespace(_,E,!1),2))[0],E=T[1],E=h.sanitizeInput(E,this._options.invalidCharReplacement),_=h.sanitizeInput(_,this._options.invalidCharReplacement),D=h.sanitizeInput(D,this._options.invalidCharReplacement);var O=o(f.namespace_extractQName(E),2),M=O[0],R=O[1],A=o(f.namespace_extractQName(I.prefix?I.prefix+":"+I.localName:I.localName),1)[0],G=null;return M==="xmlns"?(_=g.namespace.XMLNS,I.namespaceURI===null&&A===R&&(G=D)):M===null&&R==="xmlns"&&A===null&&(_=g.namespace.XMLNS,G=D),G!==null&&(this._updateNamespace(G),I=this.node),_!==void 0?I.setAttributeNS(_,E,D):I.setAttribute(E,D),this},w.prototype.removeAtt=function(m,y){var C,x,S=this;if(!u.Guard.isElementNode(this.node))throw new Error("An attribute can only be removed from an element node.");if(m=c.getValue(m),y!==void 0&&(y=c.getValue(y)),m!==null&&y===void 0)x=m;else{if(m!==null&&!c.isString(m)||y===void 0)throw new Error("Attribute namespace must be a string. "+this._debugInfo());C=m,x=y}return c.isArray(x)||c.isSet(x)?c.forEachArray(x,(function(T){return C===void 0?S.removeAtt(T):S.removeAtt(C,T)}),this):C!==void 0?(x=h.sanitizeInput(x,this._options.invalidCharReplacement),C=h.sanitizeInput(C,this._options.invalidCharReplacement),this.node.removeAttributeNS(C,x)):(x=h.sanitizeInput(x,this._options.invalidCharReplacement),this.node.removeAttribute(x)),this},w.prototype.txt=function(m){if(m==null){if(!this._options.keepNullNodes)return this;m=""}var y=this._doc.createTextNode(h.sanitizeInput(m,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.com=function(m){if(m==null){if(!this._options.keepNullNodes)return this;m=""}var y=this._doc.createComment(h.sanitizeInput(m,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.dat=function(m){if(m==null){if(!this._options.keepNullNodes)return this;m=""}var y=this._doc.createCDATASection(h.sanitizeInput(m,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.ins=function(m,y){var C=this;if(y===void 0&&(y=""),y==null){if(!this._options.keepNullNodes)return this;y=""}if(c.isArray(m)||c.isSet(m))c.forEachArray(m,(function(S){var T=(S+="").indexOf(" "),_=T===-1?S:S.substr(0,T),E=T===-1?"":S.substr(T+1);C.ins(_,E)}),this);else if(c.isMap(m)||c.isObject(m))c.forEachObject(m,(function(S,T){return C.ins(S,T)}),this);else{var x=this._doc.createProcessingInstruction(h.sanitizeInput(m,this._options.invalidCharReplacement),h.sanitizeInput(y,this._options.invalidCharReplacement));this.node.appendChild(x)}return this},w.prototype.dec=function(m){return this._options.version=m.version||"1.0",this._options.encoding=m.encoding,this._options.standalone=m.standalone,this},w.prototype.dtd=function(m){var y=h.sanitizeInput(m&&m.name||(this._doc.documentElement?this._doc.documentElement.tagName:"ROOT"),this._options.invalidCharReplacement),C=h.sanitizeInput(m&&m.pubID||"",this._options.invalidCharReplacement),x=h.sanitizeInput(m&&m.sysID||"",this._options.invalidCharReplacement);if(this._doc.documentElement!==null&&y!==this._doc.documentElement.tagName)throw new Error("DocType name does not match document element name.");var S=this._doc.implementation.createDocumentType(y,C,x);return this._doc.doctype!==null?this._doc.replaceChild(S,this._doc.doctype):this._doc.insertBefore(S,this._doc.documentElement),this},w.prototype.import=function(m){var y,C,x=this._domNode,S=this._doc,T=m.node;if(u.Guard.isDocumentNode(T)){var _=T.documentElement;if(_===null)throw new Error("Imported document has no document element node. "+this._debugInfo());var E=S.importNode(_,!0);x.appendChild(E);var D=o(f.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=x.lookupNamespaceURI(D);new w(E)._updateNamespace(b)}else if(u.Guard.isDocumentFragmentNode(T))try{for(var I=a(T.childNodes),O=I.next();!O.done;O=I.next()){var M=O.value;E=S.importNode(M,!0),x.appendChild(E),u.Guard.isElementNode(E)&&(D=o(f.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=x.lookupNamespaceURI(D),new w(E)._updateNamespace(b))}}catch(R){y={error:R}}finally{try{O&&!O.done&&(C=I.return)&&C.call(I)}finally{if(y)throw y.error}}else E=S.importNode(T,!0),x.appendChild(E),u.Guard.isElementNode(E)&&(D=o(f.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=x.lookupNamespaceURI(D),new w(E)._updateNamespace(b));return this},w.prototype.doc=function(){if(this._doc._isFragment){for(var m=this.node;m&&m.nodeType!==d.NodeType.DocumentFragment;)m=m.parentNode;if(m===null)throw new Error("Node has no parent node while searching for document fragment ancestor. "+this._debugInfo());return new w(m)}return new w(this._doc)},w.prototype.root=function(){var m=this._doc.documentElement;if(!m)throw new Error("Document root element is null. "+this._debugInfo());return new w(m)},w.prototype.up=function(){var m=this._domNode.parentNode;if(!m)throw new Error("Parent node is null. "+this._debugInfo());return new w(m)},w.prototype.prev=function(){var m=this._domNode.previousSibling;if(!m)throw new Error("Previous sibling node is null. "+this._debugInfo());return new w(m)},w.prototype.next=function(){var m=this._domNode.nextSibling;if(!m)throw new Error("Next sibling node is null. "+this._debugInfo());return new w(m)},w.prototype.first=function(){var m=this._domNode.firstChild;if(!m)throw new Error("First child node is null. "+this._debugInfo());return new w(m)},w.prototype.last=function(){var m=this._domNode.lastChild;if(!m)throw new Error("Last child node is null. "+this._debugInfo());return new w(m)},w.prototype.each=function(m,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,C);S[0];){var T=this._getNextDescendantNode(this._domNode,S[0],C,S[1],S[2]);m.call(x,new w(S[0]),S[1],S[2]),S=T}return this},w.prototype.map=function(m,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);var S=[];return this.each((function(T,_,E){return S.push(m.call(x,T,_,E))}),y,C),S},w.prototype.reduce=function(m,y,C,x,S){C===void 0&&(C=!1),x===void 0&&(x=!1);var T=y;return this.each((function(_,E,D){return T=m.call(S,T,_,E,D)}),C,x),T},w.prototype.find=function(m,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,C);S[0];){var T=new w(S[0]);if(m.call(x,T,S[1],S[2]))return T;S=this._getNextDescendantNode(this._domNode,S[0],C,S[1],S[2])}},w.prototype.filter=function(m,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);var S=[];return this.each((function(T,_,E){m.call(x,T,_,E)&&S.push(T)}),y,C),S},w.prototype.every=function(m,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,C);S[0];){var T=new w(S[0]);if(!m.call(x,T,S[1],S[2]))return!1;S=this._getNextDescendantNode(this._domNode,S[0],C,S[1],S[2])}return!0},w.prototype.some=function(m,y,C,x){y===void 0&&(y=!1),C===void 0&&(C=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,C);S[0];){var T=new w(S[0]);if(m.call(x,T,S[1],S[2]))return!0;S=this._getNextDescendantNode(this._domNode,S[0],C,S[1],S[2])}return!1},w.prototype.toArray=function(m,y){m===void 0&&(m=!1),y===void 0&&(y=!1);var C=[];return this.each((function(x){return C.push(x)}),m,y),C},w.prototype.toString=function(m){return(m=m||{}).format===void 0&&(m.format="xml"),this._serialize(m)},w.prototype.toObject=function(m){return(m=m||{}).format===void 0&&(m.format="object"),this._serialize(m)},w.prototype.end=function(m){return(m=m||{}).format===void 0&&(m.format="xml"),this.doc()._serialize(m)},w.prototype._getFirstDescendantNode=function(m,y,C){return y?[this._domNode,0,0]:C?this._getNextDescendantNode(m,m,C,0,0):[this._domNode.firstChild,0,1]},w.prototype._getNextDescendantNode=function(m,y,C,x,S){if(!C)return m===y?[y.firstChild,0,S+1]:[y.nextSibling,x+1,S];if(y.firstChild)return[y.firstChild,0,S+1];if(y===m)return[null,-1,-1];if(y.nextSibling)return[y.nextSibling,x+1,S];for(var T=y.parentNode;T&&T!==m;){if(T.nextSibling)return[T.nextSibling,f.tree_index(T.nextSibling),S-1];T=T.parentNode,S--}return[null,-1,-1]},w.prototype._serialize=function(m){if(m.format==="xml")return new l.XMLWriter(this._options,m).serialize(this.node);if(m.format==="map")return new l.MapWriter(this._options,m).serialize(this.node);if(m.format==="object")return new l.ObjectWriter(this._options,m).serialize(this.node);if(m.format==="json")return new l.JSONWriter(this._options,m).serialize(this.node);if(m.format==="yaml")return new l.YAMLWriter(this._options,m).serialize(this.node);throw new Error("Invalid writer format: "+m.format+". "+this._debugInfo())},w.prototype._extractNamespace=function(m,y,C){var x=y.indexOf("@");if(x>0&&(m===void 0&&(m=y.slice(x+1)),y=y.slice(0,x)),m===void 0)m=C?this._options.defaultNamespace.ele:this._options.defaultNamespace.att;else if(m!==null&&m[0]==="@"){var S=m.slice(1);if((m=this._options.namespaceAlias[S])===void 0)throw new Error("Namespace alias `"+S+"` is not defined. "+this._debugInfo())}return[m,y]},w.prototype._updateNamespace=function(m){var y,C,x,S,T=this._domNode;if(u.Guard.isElementNode(T)&&m!==null&&T.namespaceURI!==m){var _=o(f.namespace_extractQName(T.prefix?T.prefix+":"+T.localName:T.localName),2),E=_[0],D=_[1],b=f.create_element(this._doc,D,m,E);try{for(var I=a(T.attributes),O=I.next();!O.done;O=I.next()){var M=O.value,R=M.prefix?M.prefix+":"+M.localName:M.localName,A=o(f.namespace_extractQName(R),1)[0],G=M.namespaceURI;G===null&&A!==null&&(G=T.lookupNamespaceURI(A)),G===null?b.setAttribute(R,M.value):b.setAttributeNS(G,R,M.value)}}catch(de){y={error:de}}finally{try{O&&!O.done&&(C=I.return)&&C.call(I)}finally{if(y)throw y.error}}var k=T.parentNode;if(k===null)throw new Error("Parent node is null."+this._debugInfo());k.replaceChild(b,T),this._domNode=b;try{for(var L=a(T.childNodes),F=L.next();!F.done;F=L.next()){var j=F.value.cloneNode(!0);if(b.appendChild(j),u.Guard.isElementNode(j)){var Y=o(f.namespace_extractQName(j.prefix?j.prefix+":"+j.localName:j.localName),1)[0],ie=b.lookupNamespaceURI(Y);new w(j)._updateNamespace(ie)}}}catch(de){x={error:de}}finally{try{F&&!F.done&&(S=L.return)&&S.call(L)}finally{if(x)throw x.error}}}},Object.defineProperty(w.prototype,"_doc",{get:function(){var m=this.node;if(u.Guard.isDocumentNode(m))return m;var y=m.ownerDocument;if(!y)throw new Error("Owner document is null. "+this._debugInfo());return y},enumerable:!0,configurable:!0}),w.prototype._debugInfo=function(m){var y=this.node,C=y.parentNode;m=m||y.nodeName;var x=C?C.nodeName:"";return x?"node: <"+m+">, parent: <"+x+">":"node: <"+m+">"},Object.defineProperty(w.prototype,"_options",{get:function(){var m=this._doc;if(m._xmlBuilderOptions===void 0)throw new Error("Builder options is not set.");return m._xmlBuilderOptions},set:function(m){this._doc._xmlBuilderOptions=m},enumerable:!0,configurable:!0}),w})();n.XMLBuilderImpl=v},function(r,n,i){var o=i(11),a=i(117),s=o.WeakMap;r.exports=typeof s=="function"&&/native code/.test(a(s))},function(r,n,i){var o=i(46),a=i(82),s=i(85),c=i(18);r.exports=o("Reflect","ownKeys")||function(l){var d=a.f(c(l)),u=s.f;return u?d.concat(u(l)):d}},function(r,n,i){var o=i(16),a=i(15),s=i(18),c=i(61);r.exports=o?Object.defineProperties:function(l,d){s(l);for(var u,f=c(d),h=f.length,g=0;h>g;)a.f(l,u=f[g++],d[u]);return l}},function(r,n,i){var o=i(46);r.exports=o("document","documentElement")},function(r,n,i){var o=i(24),a=i(82).f,s={}.toString,c=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];r.exports.f=function(l){return c&&s.call(l)=="[object Window]"?(function(d){try{return a(d)}catch{return c.slice()}})(l):a(o(l))}},function(r,n,i){var o=i(4),a=i(36).every,s=i(48),c=i(28),l=s("every"),d=c("every");o({target:"Array",proto:!0,forced:!l||!d},{every:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(4),a=i(36).filter,s=i(63),c=i(28),l=s("filter"),d=c("filter");o({target:"Array",proto:!0,forced:!l||!d},{filter:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(46);r.exports=o("navigator","userAgent")||""},function(r,n,i){var o=i(4),a=i(36).find,s=i(130),c=i(28),l=!0,d=c("find");"find"in[]&&Array(1).find((function(){l=!1})),o({target:"Array",proto:!0,forced:l||!d},{find:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}}),s("find")},function(r,n,i){var o=i(131).IteratorPrototype,a=i(60),s=i(40),c=i(62),l=i(49),d=function(){return this};r.exports=function(u,f,h){var g=f+" Iterator";return u.prototype=a(o,{next:s(1,h)}),c(u,g,!1,!0),l[g]=d,u}},function(r,n,i){var o=i(8);r.exports=!o((function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype}))},function(r,n,i){var o=i(13);r.exports=function(a){if(!o(a)&&a!==null)throw TypeError("Can't set "+String(a)+" as a prototype");return a}},function(r,n,i){var o=i(4),a=i(36).map,s=i(63),c=i(28),l=s("map"),d=c("map");o({target:"Array",proto:!0,forced:!l||!d},{map:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(4),a=i(200).left,s=i(48),c=i(28),l=s("reduce"),d=c("reduce",{1:0});o({target:"Array",proto:!0,forced:!l||!d},{reduce:function(u){return a(this,u,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(127),a=i(27),s=i(41),c=i(26),l=function(d){return function(u,f,h,g){o(f);var p=a(u),v=s(p),w=c(p.length),m=d?w-1:0,y=d?-1:1;if(h<2)for(;;){if(m in v){g=v[m],m+=y;break}if(m+=y,d?m<0:w<=m)throw TypeError("Reduce of empty array with no initial value")}for(;d?m>=0:w>m;m+=y)m in v&&(g=f(g,v[m],m,p));return g}};r.exports={left:l(!1),right:l(!0)}},function(r,n,i){var o=i(4),a=i(36).some,s=i(48),c=i(28),l=s("some"),d=c("some");o({target:"Array",proto:!0,forced:!l||!d},{some:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(90),a=i(135);r.exports=o?{}.toString:function(){return"[object "+a(this)+"]"}},function(r,n){r.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(r,n,i){var o=i(8);r.exports=!o((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(r,n,i){var o=i(5),a=i(49),s=o("iterator"),c=Array.prototype;r.exports=function(l){return l!==void 0&&(a.Array===l||c[s]===l)}},function(r,n,i){var o=i(135),a=i(49),s=i(5)("iterator");r.exports=function(c){if(c!=null)return c[s]||c["@@iterator"]||a[o(c)]}},function(r,n,i){var o=i(18);r.exports=function(a,s,c,l){try{return l?s(o(c)[0],c[1]):s(c)}catch(u){var d=a.return;throw d!==void 0&&o(d.call(a)),u}}},function(r,n,i){var o=i(5)("iterator"),a=!1;try{var s=0,c={next:function(){return{done:!!s++}},return:function(){a=!0}};c[o]=function(){return this},Array.from(c,(function(){throw 2}))}catch{}r.exports=function(l,d){if(!d&&!a)return!1;var u=!1;try{var f={};f[o]=function(){return{next:function(){return{done:u=!0}}}},l(f)}catch{}return u}},function(r,n,i){var o=i(13),a=i(133);r.exports=function(s,c,l){var d,u;return a&&typeof(d=c.constructor)=="function"&&d!==l&&o(u=d.prototype)&&u!==l.prototype&&a(s,u),s}},function(r,n,i){var o=i(25);r.exports=function(a,s,c){for(var l in s)o(a,l,s[l],c);return a}},function(r,n,i){var o=i(46),a=i(15),s=i(5),c=i(16),l=s("species");r.exports=function(d){var u=o(d),f=a.f;c&&u&&!u[l]&&f(u,l,{configurable:!0,get:function(){return this}})}},function(r,n,i){var o=this&&this.__generator||function(c,l){var d,u,f,h,g={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(v){return function(w){return(function(m){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,u&&(f=2&m[0]?u.return:m[0]?u.throw||((f=u.return)&&f.call(u),0):u.next)&&!(f=f.call(u,m[1])).done)return f;switch(u=0,f&&(m=[2&m[0],f.value]),m[0]){case 0:case 1:f=m;break;case 4:return g.label++,{value:m[1],done:!1};case 5:g.label++,u=m[1],m=[0];continue;case 7:m=g.ops.pop(),g.trys.pop();continue;default:if(f=g.trys,!((f=f.length>0&&f[f.length-1])||m[0]!==6&&m[0]!==2)){g=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){g.label=m[1];break}if(m[0]===6&&g.label<f[1]){g.label=f[1],f=m;break}if(f&&g.label<f[2]){g.label=f[2],g.ops.push(m);break}f[2]&&g.ops.pop(),g.trys.pop();continue}m=l.call(c,g)}catch(y){m=[6,y],u=0}finally{d=f=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}})([v,w])}}},a=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&c[l],u=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=(function(){function c(l){l===void 0&&(l=1e3),this._items=new Set,this._limit=l}return c.prototype.add=function(l){if(this._items.add(l),this._items.size>this._limit){var d=this._items.values().next();d.done||this._items.delete(d.value)}return this},c.prototype.delete=function(l){return this._items.delete(l)},c.prototype.has=function(l){return this._items.has(l)},c.prototype.clear=function(){this._items.clear()},Object.defineProperty(c.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),c.prototype.forEach=function(l,d){var u=this;this._items.forEach((function(f){return l.call(d,f,f,u)}))},c.prototype.keys=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.keys())];case 1:return l.sent(),[2]}}))},c.prototype.values=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.values())];case 1:return l.sent(),[2]}}))},c.prototype.entries=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.entries())];case 1:return l.sent(),[2]}}))},c.prototype[Symbol.iterator]=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items)];case 1:return l.sent(),[2]}}))},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return"FixedSizeSet"},enumerable:!0,configurable:!0}),c})();n.FixedSizeSet=s},function(r,n,i){var o=this&&this.__generator||function(c,l){var d,u,f,h,g={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(v){return function(w){return(function(m){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,u&&(f=2&m[0]?u.return:m[0]?u.throw||((f=u.return)&&f.call(u),0):u.next)&&!(f=f.call(u,m[1])).done)return f;switch(u=0,f&&(m=[2&m[0],f.value]),m[0]){case 0:case 1:f=m;break;case 4:return g.label++,{value:m[1],done:!1};case 5:g.label++,u=m[1],m=[0];continue;case 7:m=g.ops.pop(),g.trys.pop();continue;default:if(f=g.trys,!((f=f.length>0&&f[f.length-1])||m[0]!==6&&m[0]!==2)){g=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){g.label=m[1];break}if(m[0]===6&&g.label<f[1]){g.label=f[1],f=m;break}if(f&&g.label<f[2]){g.label=f[2],g.ops.push(m);break}f[2]&&g.ops.pop(),g.trys.pop();continue}m=l.call(c,g)}catch(y){m=[6,y],u=0}finally{d=f=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}})([v,w])}}},a=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&c[l],u=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=(function(){function c(l){l===void 0&&(l=1e3),this._items=new Map,this._limit=l}return c.prototype.get=function(l){return this._items.get(l)},c.prototype.set=function(l,d){if(this._items.set(l,d),this._items.size>this._limit){var u=this._items.keys().next();u.done||this._items.delete(u.value)}},c.prototype.delete=function(l){return this._items.delete(l)},c.prototype.has=function(l){return this._items.has(l)},c.prototype.clear=function(){this._items.clear()},Object.defineProperty(c.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),c.prototype.forEach=function(l,d){this._items.forEach((function(u,f){return l.call(d,f,u)}))},c.prototype.keys=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.keys())];case 1:return l.sent(),[2]}}))},c.prototype.values=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.values())];case 1:return l.sent(),[2]}}))},c.prototype.entries=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items.entries())];case 1:return l.sent(),[2]}}))},c.prototype[Symbol.iterator]=function(){return o(this,(function(l){switch(l.label){case 0:return[5,a(this._items)];case 1:return l.sent(),[2]}}))},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return"ObjectCache"},enumerable:!0,configurable:!0}),c})();n.ObjectCache=s},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s){s===void 0&&(s=1e3),this._items=new Map,this._limit=s}return a.prototype.check=function(s,c){if(this._items.get(s)===c)return!0;if(this._items.get(c)===s)return!1;var l=Math.random()<.5;if(l?this._items.set(s,c):this._items.set(c,s),this._items.size>this._limit){var d=this._items.keys().next();d.done||this._items.delete(d.value)}return l},a})();n.CompareCache=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s){this._initialized=!1,this._value=void 0,this._initFunc=s}return Object.defineProperty(a.prototype,"value",{get:function(){return this._initialized||(this._value=this._initFunc(),this._initialized=!0),this._value},enumerable:!0,configurable:!0}),a})();n.Lazy=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function a(s){this._pointer=0,this._chars=Array.from(s),this._length=this._chars.length}return Object.defineProperty(a.prototype,"eof",{get:function(){return this._pointer>=this._length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),a.prototype.codePoint=function(){if(this._codePoint===void 0)if(this.eof)this._codePoint=-1;else{var s=this._chars[this._pointer].codePointAt(0);this._codePoint=s!==void 0?s:-1}return this._codePoint},a.prototype.c=function(){return this._c===void 0&&(this._c=this.eof?"":this._chars[this._pointer]),this._c},a.prototype.remaining=function(){return this._remaining===void 0&&(this._remaining=this.eof?"":this._chars.slice(this._pointer+1).join("")),this._remaining},a.prototype.substring=function(){return this._substring===void 0&&(this._substring=this.eof?"":this._chars.slice(this._pointer).join("")),this._substring},Object.defineProperty(a.prototype,"pointer",{get:function(){return this._pointer},set:function(s){s!==this._pointer&&(this._pointer=s,this._codePoint=void 0,this._c=void 0,this._remaining=void 0,this._substring=void 0)},enumerable:!0,configurable:!0}),a})();n.StringWalker=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(218);n.MapWriter=o.MapWriter;var a=i(258);n.XMLWriter=a.XMLWriter;var s=i(67);n.ObjectWriter=s.ObjectWriter;var c=i(260);n.JSONWriter=c.JSONWriter;var l=i(261);n.YAMLWriter=l.YAMLWriter},function(r,n,i){i(19),i(219),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(d,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var g in h)h.hasOwnProperty(g)&&(f[g]=h[g])})(d,u)},function(d,u){function f(){this.constructor=d}o(d,u),d.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=i(67),l=(function(d){function u(f,h){var g=d.call(this,f)||this;return g._writerOptions=s.applyDefaults(h,{format:"map",wellFormed:!1,group:!1,verbose:!1}),g}return a(u,d),u.prototype.serialize=function(f){var h=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1,verbose:!1}),g=new c.ObjectWriter(this._builderOptions,h).serialize(f);return this._convertObject(g)},u.prototype._convertObject=function(f){if(s.isArray(f)){for(var h=0;h<f.length;h++)f[h]=this._convertObject(f[h]);return f}if(s.isObject(f)){var g=new Map;for(var p in f)g.set(p,this._convertObject(f[p]));return g}return f},u})(i(50).BaseWriter);n.MapWriter=l},function(r,n,i){var o=i(139),a=i(143);r.exports=o("Map",(function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}}),a)},function(r,n,i){var o=i(4),a=i(8),s=i(59),c=i(13),l=i(27),d=i(26),u=i(134),f=i(128),h=i(63),g=i(5),p=i(129),v=g("isConcatSpreadable"),w=p>=51||!a((function(){var C=[];return C[v]=!1,C.concat()[0]!==C})),m=h("concat"),y=function(C){if(!c(C))return!1;var x=C[v];return x!==void 0?!!x:s(C)};o({target:"Array",proto:!0,forced:!w||!m},{concat:function(C){var x,S,T,_,E,D=l(this),b=f(D,0),I=0;for(x=-1,T=arguments.length;x<T;x++)if(y(E=x===-1?D:arguments[x])){if(I+(_=d(E.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(S=0;S<_;S++,I++)S in E&&u(b,I,E[S])}else{if(I>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(b,I++,E)}return b.length=I,b}})},function(r,n,i){var o=i(8);function a(s,c){return RegExp(s,c)}n.UNSUPPORTED_Y=o((function(){var s=a("a","y");return s.lastIndex=2,s.exec("abcd")!=null})),n.BROKEN_CARET=o((function(){var s=a("^r","gy");return s.lastIndex=2,s.exec("str")!=null}))},function(r,n,i){var o=i(223);r.exports=function(a){if(o(a))throw TypeError("The method doesn't accept regular expressions");return a}},function(r,n,i){var o=i(13),a=i(42),s=i(5)("match");r.exports=function(c){var l;return o(c)&&((l=c[s])!==void 0?!!l:a(c)=="RegExp")}},function(r,n,i){var o=i(5)("match");r.exports=function(a){var s=/./;try{"/./"[a](s)}catch{try{return s[o]=!1,"/./"[a](s)}catch{}}return!1}},function(r,n,i){i(68);var o=i(25),a=i(8),s=i(5),c=i(93),l=i(21),d=s("species"),u=!a((function(){var v=/./;return v.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(v,"$<a>")!=="7"})),f="a".replace(/./,"$0")==="$0",h=s("replace"),g=!!/./[h]&&/./[h]("a","$0")==="",p=!a((function(){var v=/(?:)/,w=v.exec;v.exec=function(){return w.apply(this,arguments)};var m="ab".split(v);return m.length!==2||m[0]!=="a"||m[1]!=="b"}));r.exports=function(v,w,m,y){var C=s(v),x=!a((function(){var b={};return b[C]=function(){return 7},""[v](b)!=7})),S=x&&!a((function(){var b=!1,I=/a/;return v==="split"&&((I={}).constructor={},I.constructor[d]=function(){return I},I.flags="",I[C]=/./[C]),I.exec=function(){return b=!0,null},I[C](""),!b}));if(!x||!S||v==="replace"&&(!u||!f||g)||v==="split"&&!p){var T=/./[C],_=m(C,""[v],(function(b,I,O,M,R){return I.exec===c?x&&!R?{done:!0,value:T.call(I,O,M)}:{done:!0,value:b.call(O,I,M)}:{done:!1}}),{REPLACE_KEEPS_$0:f,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:g}),E=_[0],D=_[1];o(String.prototype,v,E),o(RegExp.prototype,C,w==2?function(b,I){return D.call(b,this,I)}:function(b){return D.call(b,this)})}y&&l(RegExp.prototype[C],"sham",!0)}},function(r,n,i){var o=i(137).charAt;r.exports=function(a,s,c){return s+(c?o(a,s).length:1)}},function(r,n,i){var o=i(42),a=i(93);r.exports=function(s,c){var l=s.exec;if(typeof l=="function"){var d=l.call(s,c);if(typeof d!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return d}if(o(s)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return a.call(s,c)}},function(r,n,i){(function(o){Object.defineProperty(n,"__esModule",{value:!0});var a=i(96);n.forgivingBase64Encode=function(s){return o.from(s).toString("base64")},n.forgivingBase64Decode=function(s){return s===""?"":((s=s.replace(a.ASCIIWhiteSpace,"")).length%4==0&&(s.endsWith("==")?s=s.substr(0,s.length-2):s.endsWith("=")&&(s=s.substr(0,s.length-1))),s.length%4==1?null:/[0-9A-Za-z+/]/.test(s)?o.from(s,"base64").toString("utf8"):null)}}).call(this,i(145).Buffer)},function(r,n,i){n.byteLength=function(h){var g=u(h),p=g[0],v=g[1];return 3*(p+v)/4-v},n.toByteArray=function(h){var g,p,v=u(h),w=v[0],m=v[1],y=new s((function(S,T,_){return 3*(T+_)/4-_})(0,w,m)),C=0,x=m>0?w-4:w;for(p=0;p<x;p+=4)g=a[h.charCodeAt(p)]<<18|a[h.charCodeAt(p+1)]<<12|a[h.charCodeAt(p+2)]<<6|a[h.charCodeAt(p+3)],y[C++]=g>>16&255,y[C++]=g>>8&255,y[C++]=255&g;return m===2&&(g=a[h.charCodeAt(p)]<<2|a[h.charCodeAt(p+1)]>>4,y[C++]=255&g),m===1&&(g=a[h.charCodeAt(p)]<<10|a[h.charCodeAt(p+1)]<<4|a[h.charCodeAt(p+2)]>>2,y[C++]=g>>8&255,y[C++]=255&g),y},n.fromByteArray=function(h){for(var g,p=h.length,v=p%3,w=[],m=0,y=p-v;m<y;m+=16383)w.push(f(h,m,m+16383>y?y:m+16383));return v===1?(g=h[p-1],w.push(o[g>>2]+o[g<<4&63]+"==")):v===2&&(g=(h[p-2]<<8)+h[p-1],w.push(o[g>>10]+o[g>>4&63]+o[g<<2&63]+"=")),w.join("")};for(var o=[],a=[],s=typeof Uint8Array<"u"?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,d=c.length;l<d;++l)o[l]=c[l],a[c.charCodeAt(l)]=l;function u(h){var g=h.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var p=h.indexOf("=");return p===-1&&(p=g),[p,p===g?0:4-p%4]}function f(h,g,p){for(var v,w,m=[],y=g;y<p;y+=3)v=(h[y]<<16&16711680)+(h[y+1]<<8&65280)+(255&h[y+2]),m.push(o[(w=v)>>18&63]+o[w>>12&63]+o[w>>6&63]+o[63&w]);return m.join("")}a[45]=62,a[95]=63},function(r,n){n.read=function(i,o,a,s,c){var l,d,u=8*c-s-1,f=(1<<u)-1,h=f>>1,g=-7,p=a?c-1:0,v=a?-1:1,w=i[o+p];for(p+=v,l=w&(1<<-g)-1,w>>=-g,g+=u;g>0;l=256*l+i[o+p],p+=v,g-=8);for(d=l&(1<<-g)-1,l>>=-g,g+=s;g>0;d=256*d+i[o+p],p+=v,g-=8);if(l===0)l=1-h;else{if(l===f)return d?NaN:1/0*(w?-1:1);d+=Math.pow(2,s),l-=h}return(w?-1:1)*d*Math.pow(2,l-s)},n.write=function(i,o,a,s,c,l){var d,u,f,h=8*l-c-1,g=(1<<h)-1,p=g>>1,v=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=s?0:l-1,m=s?1:-1,y=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(u=isNaN(o)?1:0,d=g):(d=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-d))<1&&(d--,f*=2),(o+=d+p>=1?v/f:v*Math.pow(2,1-p))*f>=2&&(d++,f/=2),d+p>=g?(u=0,d=g):d+p>=1?(u=(o*f-1)*Math.pow(2,c),d+=p):(u=o*Math.pow(2,p-1)*Math.pow(2,c),d=0));c>=8;i[a+w]=255&u,w+=m,u/=256,c-=8);for(d=d<<c|u,h+=c;h>0;i[a+w]=255&d,w+=m,d/=256,h-=8);i[a+w-m]|=128*y}},function(r,n){var i={}.toString;r.exports=Array.isArray||function(o){return i.call(o)=="[object Array]"}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&c[l],u=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1);function s(c){var l,d;if(c===null||a.isString(c)||a.isNumber(c))return c;if(a.isArray(c)){var u=new Array;try{for(var f=o(c),h=f.next();!h.done;h=f.next()){var g=h.value;u.push(s(g))}}catch(w){l={error:w}}finally{try{h&&!h.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}return u}if(a.isObject(c)){u=new Map;for(var p in c)if(c.hasOwnProperty(p)){var v=c[p];u.set(p,s(v))}return u}return c}n.parseJSONFromBytes=function(c){var l=a.utf8Decode(c);return JSON.parse.call(void 0,l)},n.serializeJSONToBytes=function(c){var l=JSON.stringify.call(void 0,c);return a.utf8Encode(l)},n.parseJSONIntoInfraValues=function(c){return s(JSON.parse.call(void 0,c))},n.convertAJSONDerivedJavaScriptValueToAnInfraValue=s},function(r,n,i){var o=this&&this.__generator||function(d,u){var f,h,g,p,v={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(y){return(function(C){if(f)throw new TypeError("Generator is already executing.");for(;v;)try{if(f=1,h&&(g=2&C[0]?h.return:C[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,C[1])).done)return g;switch(h=0,g&&(C=[2&C[0],g.value]),C[0]){case 0:case 1:g=C;break;case 4:return v.label++,{value:C[1],done:!1};case 5:v.label++,h=C[1],C=[0];continue;case 7:C=v.ops.pop(),v.trys.pop();continue;default:if(g=v.trys,!((g=g.length>0&&g[g.length-1])||C[0]!==6&&C[0]!==2)){v=0;continue}if(C[0]===3&&(!g||C[1]>g[0]&&C[1]<g[3])){v.label=C[1];break}if(C[0]===6&&v.label<g[1]){v.label=g[1],g=C;break}if(g&&v.label<g[2]){v.label=g[2],v.ops.push(C);break}g[2]&&v.ops.pop(),v.trys.pop();continue}C=u.call(d,v)}catch(x){C=[6,x],h=0}finally{f=g=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}})([m,y])}}},a=this&&this.__read||function(d,u){var f=typeof Symbol=="function"&&d[Symbol.iterator];if(!f)return d;var h,g,p=f.call(d),v=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)v.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(f=p.return)&&f.call(p)}finally{if(g)throw g.error}}return v},s=this&&this.__spread||function(){for(var d=[],u=0;u<arguments.length;u++)d=d.concat(a(arguments[u]));return d},c=this&&this.__values||function(d){var u=typeof Symbol=="function"&&Symbol.iterator,f=u&&d[u],h=0;if(f)return f.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&h>=d.length&&(d=void 0),{value:d&&d[h++],done:!d}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);n.append=function(d,u){d.push(u)},n.extend=function(d,u){d.push.apply(d,s(u))},n.prepend=function(d,u){d.unshift(u)},n.replace=function(d,u,f){var h,g,p=0;try{for(var v=c(d),w=v.next();!w.done;w=v.next()){var m=w.value;if(l.isFunction(u))u.call(null,m)&&(d[p]=f);else if(m===u)return void(d[p]=f);p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}},n.insert=function(d,u,f){d.splice(f,0,u)},n.remove=function(d,u){for(var f=d.length;f--;){var h=d[f];if(l.isFunction(u))u.call(null,h)&&d.splice(f,1);else if(h===u)return void d.splice(f,1)}},n.empty=function(d){d.length=0},n.contains=function(d,u){var f,h;try{for(var g=c(d),p=g.next();!p.done;p=g.next()){var v=p.value;if(l.isFunction(u)){if(u.call(null,v))return!0}else if(v===u)return!0}}catch(w){f={error:w}}finally{try{p&&!p.done&&(h=g.return)&&h.call(g)}finally{if(f)throw f.error}}return!1},n.size=function(d,u){var f,h;if(u===void 0)return d.length;var g=0;try{for(var p=c(d),v=p.next();!v.done;v=p.next()){var w=v.value;u.call(null,w)&&g++}}catch(m){f={error:m}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}return g},n.isEmpty=function(d){return d.length===0},n.forEach=function(d,u){var f,h,g,p,v,w;return o(this,(function(m){switch(m.label){case 0:return u!==void 0?[3,2]:[5,c(d)];case 1:return m.sent(),[3,9];case 2:m.trys.push([2,7,8,9]),f=c(d),h=f.next(),m.label=3;case 3:return h.done?[3,6]:(g=h.value,u.call(null,g)?[4,g]:[3,5]);case 4:m.sent(),m.label=5;case 5:return h=f.next(),[3,3];case 6:return[3,9];case 7:return p=m.sent(),v={error:p},[3,9];case 8:try{h&&!h.done&&(w=f.return)&&w.call(f)}finally{if(v)throw v.error}return[7];case 9:return[2]}}))},n.clone=function(d){return new(Array.bind.apply(Array,s([void 0],d)))},n.sortInAscendingOrder=function(d,u){return d.sort((function(f,h){return u.call(null,f,h)?-1:1}))},n.sortInDescendingOrder=function(d,u){return d.sort((function(f,h){return u.call(null,f,h)?1:-1}))}},function(r,n,i){var o=this&&this.__generator||function(d,u){var f,h,g,p,v={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(y){return(function(C){if(f)throw new TypeError("Generator is already executing.");for(;v;)try{if(f=1,h&&(g=2&C[0]?h.return:C[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,C[1])).done)return g;switch(h=0,g&&(C=[2&C[0],g.value]),C[0]){case 0:case 1:g=C;break;case 4:return v.label++,{value:C[1],done:!1};case 5:v.label++,h=C[1],C=[0];continue;case 7:C=v.ops.pop(),v.trys.pop();continue;default:if(g=v.trys,!((g=g.length>0&&g[g.length-1])||C[0]!==6&&C[0]!==2)){v=0;continue}if(C[0]===3&&(!g||C[1]>g[0]&&C[1]<g[3])){v.label=C[1];break}if(C[0]===6&&v.label<g[1]){v.label=g[1],g=C;break}if(g&&v.label<g[2]){v.label=g[2],v.ops.push(C);break}g[2]&&v.ops.pop(),v.trys.pop();continue}C=u.call(d,v)}catch(x){C=[6,x],h=0}finally{f=g=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}})([m,y])}}},a=this&&this.__values||function(d){var u=typeof Symbol=="function"&&Symbol.iterator,f=u&&d[u],h=0;if(f)return f.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&h>=d.length&&(d=void 0),{value:d&&d[h++],done:!d}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(d,u){var f=typeof Symbol=="function"&&d[Symbol.iterator];if(!f)return d;var h,g,p=f.call(d),v=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)v.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(f=p.return)&&f.call(p)}finally{if(g)throw g.error}}return v},c=this&&this.__spread||function(){for(var d=[],u=0;u<arguments.length;u++)d=d.concat(s(arguments[u]));return d};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);n.get=function(d,u){return d.get(u)},n.set=function(d,u,f){d.set(u,f)},n.remove=function(d,u){var f,h,g,p;if(l.isFunction(u)){var v=[];try{for(var w=a(d),m=w.next();!m.done;m=w.next()){var y=m.value;u.call(null,y)&&v.push(y[0])}}catch(T){f={error:T}}finally{try{m&&!m.done&&(h=w.return)&&h.call(w)}finally{if(f)throw f.error}}try{for(var C=a(v),x=C.next();!x.done;x=C.next()){var S=x.value;d.delete(S)}}catch(T){g={error:T}}finally{try{x&&!x.done&&(p=C.return)&&p.call(C)}finally{if(g)throw g.error}}}else d.delete(u)},n.contains=function(d,u){var f,h;if(l.isFunction(u)){try{for(var g=a(d),p=g.next();!p.done;p=g.next()){var v=p.value;if(u.call(null,v))return!0}}catch(w){f={error:w}}finally{try{p&&!p.done&&(h=g.return)&&h.call(g)}finally{if(f)throw f.error}}return!1}return d.has(u)},n.keys=function(d){return new Set(d.keys())},n.values=function(d){return c(d.values())},n.size=function(d,u){var f,h;if(u===void 0)return d.size;var g=0;try{for(var p=a(d),v=p.next();!v.done;v=p.next()){var w=v.value;u.call(null,w)&&g++}}catch(m){f={error:m}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}return g},n.isEmpty=function(d){return d.size===0},n.forEach=function(d,u){var f,h,g,p,v,w;return o(this,(function(m){switch(m.label){case 0:return u!==void 0?[3,2]:[5,a(d)];case 1:return m.sent(),[3,9];case 2:m.trys.push([2,7,8,9]),f=a(d),h=f.next(),m.label=3;case 3:return h.done?[3,6]:(g=h.value,u.call(null,g)?[4,g]:[3,5]);case 4:m.sent(),m.label=5;case 5:return h=f.next(),[3,3];case 6:return[3,9];case 7:return p=m.sent(),v={error:p},[3,9];case 8:try{h&&!h.done&&(w=f.return)&&w.call(f)}finally{if(v)throw v.error}return[7];case 9:return[2]}}))},n.clone=function(d){return new Map(d)},n.sortInAscendingOrder=function(d,u){var f=new(Array.bind.apply(Array,c([void 0],d)));return f.sort((function(h,g){return u.call(null,h,g)?-1:1})),new Map(f)},n.sortInDescendingOrder=function(d,u){var f=new(Array.bind.apply(Array,c([void 0],d)));return f.sort((function(h,g){return u.call(null,h,g)?1:-1})),new Map(f)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.HTML="http://www.w3.org/1999/xhtml",n.XML="http://www.w3.org/XML/1998/namespace",n.XMLNS="http://www.w3.org/2000/xmlns/",n.MathML="http://www.w3.org/1998/Math/MathML",n.SVG="http://www.w3.org/2000/svg",n.XLink="http://www.w3.org/1999/xlink"},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.enqueue=function(o,a){o.push(a)},n.dequeue=function(o){return o.shift()||null}},function(r,n,i){var o=this&&this.__generator||function(u,f){var h,g,p,v,w={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return v={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function m(y){return function(C){return(function(x){if(h)throw new TypeError("Generator is already executing.");for(;w;)try{if(h=1,g&&(p=2&x[0]?g.return:x[0]?g.throw||((p=g.return)&&p.call(g),0):g.next)&&!(p=p.call(g,x[1])).done)return p;switch(g=0,p&&(x=[2&x[0],p.value]),x[0]){case 0:case 1:p=x;break;case 4:return w.label++,{value:x[1],done:!1};case 5:w.label++,g=x[1],x=[0];continue;case 7:x=w.ops.pop(),w.trys.pop();continue;default:if(p=w.trys,!((p=p.length>0&&p[p.length-1])||x[0]!==6&&x[0]!==2)){w=0;continue}if(x[0]===3&&(!p||x[1]>p[0]&&x[1]<p[3])){w.label=x[1];break}if(x[0]===6&&w.label<p[1]){w.label=p[1],p=x;break}if(p&&w.label<p[2]){w.label=p[2],w.ops.push(x);break}p[2]&&w.ops.pop(),w.trys.pop();continue}x=f.call(u,w)}catch(S){x=[6,S],g=0}finally{h=p=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}})([y,C])}}},a=this&&this.__values||function(u){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&u[f],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(u,f){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var g,p,v=h.call(u),w=[];try{for(;(f===void 0||f-- >0)&&!(g=v.next()).done;)w.push(g.value)}catch(m){p={error:m}}finally{try{g&&!g.done&&(h=v.return)&&h.call(v)}finally{if(p)throw p.error}}return w},c=this&&this.__spread||function(){for(var u=[],f=0;f<arguments.length;f++)u=u.concat(s(arguments[f]));return u};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);function d(u,f){var h,g;try{for(var p=a(u),v=p.next();!v.done;v=p.next()){var w=v.value;if(!f.has(w))return!1}}catch(m){h={error:m}}finally{try{v&&!v.done&&(g=p.return)&&g.call(p)}finally{if(h)throw h.error}}return!0}n.append=function(u,f){u.add(f)},n.extend=function(u,f){f.forEach(u.add,u)},n.prepend=function(u,f){var h=new Set(u);u.clear(),u.add(f),h.forEach(u.add,u)},n.replace=function(u,f,h){var g,p,v=new Set;try{for(var w=a(u),m=w.next();!m.done;m=w.next()){var y=m.value;l.isFunction(f)?f.call(null,y)?v.add(h):v.add(y):y===f?v.add(h):v.add(y)}}catch(C){g={error:C}}finally{try{m&&!m.done&&(p=w.return)&&p.call(w)}finally{if(g)throw g.error}}u.clear(),v.forEach(u.add,u)},n.insert=function(u,f,h){var g,p,v=new Set,w=0;try{for(var m=a(u),y=m.next();!y.done;y=m.next()){var C=y.value;w===h&&v.add(f),v.add(C),w++}}catch(x){g={error:x}}finally{try{y&&!y.done&&(p=m.return)&&p.call(m)}finally{if(g)throw g.error}}u.clear(),v.forEach(u.add,u)},n.remove=function(u,f){var h,g,p,v;if(l.isFunction(f)){var w=[];try{for(var m=a(u),y=m.next();!y.done;y=m.next()){var C=y.value;f.call(null,C)&&w.push(C)}}catch(_){h={error:_}}finally{try{y&&!y.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}try{for(var x=a(w),S=x.next();!S.done;S=x.next()){var T=S.value;u.delete(T)}}catch(_){p={error:_}}finally{try{S&&!S.done&&(v=x.return)&&v.call(x)}finally{if(p)throw p.error}}}else u.delete(f)},n.empty=function(u){u.clear()},n.contains=function(u,f){var h,g;if(!l.isFunction(f))return u.has(f);try{for(var p=a(u),v=p.next();!v.done;v=p.next()){var w=v.value;if(f.call(null,w))return!0}}catch(m){h={error:m}}finally{try{v&&!v.done&&(g=p.return)&&g.call(p)}finally{if(h)throw h.error}}return!1},n.size=function(u,f){var h,g;if(f===void 0)return u.size;var p=0;try{for(var v=a(u),w=v.next();!w.done;w=v.next()){var m=w.value;f.call(null,m)&&p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}return p},n.isEmpty=function(u){return u.size===0},n.forEach=function(u,f){var h,g,p,v,w,m;return o(this,(function(y){switch(y.label){case 0:return f!==void 0?[3,2]:[5,a(u)];case 1:return y.sent(),[3,9];case 2:y.trys.push([2,7,8,9]),h=a(u),g=h.next(),y.label=3;case 3:return g.done?[3,6]:(p=g.value,f.call(null,p)?[4,p]:[3,5]);case 4:y.sent(),y.label=5;case 5:return g=h.next(),[3,3];case 6:return[3,9];case 7:return v=y.sent(),w={error:v},[3,9];case 8:try{g&&!g.done&&(m=h.return)&&m.call(h)}finally{if(w)throw w.error}return[7];case 9:return[2]}}))},n.clone=function(u){return new Set(u)},n.sortInAscendingOrder=function(u,f){var h=new(Array.bind.apply(Array,c([void 0],u)));return h.sort((function(g,p){return f.call(null,g,p)?-1:1})),new Set(h)},n.sortInDescendingOrder=function(u,f){var h=new(Array.bind.apply(Array,c([void 0],u)));return h.sort((function(g,p){return f.call(null,g,p)?1:-1})),new Set(h)},n.isSubsetOf=d,n.isSupersetOf=function(u,f){return d(f,u)},n.intersection=function(u,f){var h,g,p=new Set;try{for(var v=a(u),w=v.next();!w.done;w=v.next()){var m=w.value;f.has(m)&&p.add(m)}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}return p},n.union=function(u,f){var h=new Set(u);return f.forEach(h.add,h),h},n.range=function(u,f){for(var h=new Set,g=u;g<=f;g++)h.add(g);return h}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.push=function(o,a){o.push(a)},n.pop=function(o){return o.pop()||null}},function(r,n,i){var o=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],C=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&C>=w.length&&(w=void 0),{value:w&&w[C++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(96),s=i(147),c=i(146),l=i(1);function d(w,m){for(var y=0;;){var C=y<w.length?w.charCodeAt(y):null,x=y<m.length?m.charCodeAt(y):null;if(C===null)return!0;if(C!==x)return!1;y++}}function u(w){var m,y,C=Array.from(w),x=new Uint8Array(C.length),S=0;try{for(var T=o(w),_=T.next();!_.done;_=T.next()){var E=_.value.codePointAt(0);console.assert(E!==void 0&&E<=255,"isomorphicEncode requires string bytes to be less than or equal to 0x00FF."),E!==void 0&&E<=255&&(x[S++]=E)}}catch(D){m={error:D}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}return x}function f(w){return/^[\u0000-\u007F]*$/.test(w)}function h(w){var m,y,C="";try{for(var x=o(w),S=x.next();!S.done;S=x.next()){var T=S.value,_=T.codePointAt(0);C+=_!==void 0&&_>=65&&_<=90?String.fromCodePoint(_+32):T}}catch(E){m={error:E}}finally{try{S&&!S.done&&(y=x.return)&&y.call(x)}finally{if(m)throw m.error}}return C}function g(w){return w.replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,"")}function p(w,m,y){if(!l.isArray(m))return p(w,Array.from(m),y);for(var C="";y.position<m.length&&w.call(null,m[y.position]);)C+=m[y.position],y.position++;return C}function v(w,m){p((function(y){return a.ASCIIWhiteSpace.test(y)}),w,m)}n.isCodeUnitPrefix=d,n.isCodeUnitLessThan=function(w,m){if(d(m,w))return!1;if(d(w,m))return!0;for(var y=0;y<Math.min(w.length,m.length);y++){var C=w.charCodeAt(y),x=m.charCodeAt(y);if(C!==x)return C<x}return!1},n.isomorphicEncode=u,n.isASCIIString=f,n.asciiLowercase=h,n.asciiUppercase=function(w){var m,y,C="";try{for(var x=o(w),S=x.next();!S.done;S=x.next()){var T=S.value,_=T.codePointAt(0);C+=_!==void 0&&_>=97&&_<=122?String.fromCodePoint(_-32):T}}catch(E){m={error:E}}finally{try{S&&!S.done&&(y=x.return)&&y.call(x)}finally{if(m)throw m.error}}return C},n.asciiCaseInsensitiveMatch=function(w,m){return h(w)===h(m)},n.asciiEncode=function(w){return console.assert(f(w),"asciiEncode requires an ASCII string."),u(w)},n.asciiDecode=function(w){var m,y;try{for(var C=o(w),x=C.next();!x.done;x=C.next()){var S=x.value;console.assert(c.isASCIIByte(S),"asciiDecode requires an ASCII byte sequence.")}}catch(T){m={error:T}}finally{try{x&&!x.done&&(y=C.return)&&y.call(C)}finally{if(m)throw m.error}}return s.isomorphicDecode(w)},n.stripNewlines=function(w){return w.replace(/[\n\r]/g,"")},n.normalizeNewlines=function(w){return w.replace(/\r\n/g,`
`).replace(/\r/g,`
`)},n.stripLeadingAndTrailingASCIIWhitespace=g,n.stripAndCollapseASCIIWhitespace=function(w){return g(w.replace(/[\t\n\f\r ]{2,}/g," "))},n.collectASequenceOfCodePoints=p,n.skipASCIIWhitespace=v,n.strictlySplit=function w(m,y){if(!l.isArray(m))return w(Array.from(m),y);var C={position:0},x=[],S=p((function(T){return y!==T}),m,C);for(x.push(S);C.position<m.length;)console.assert(m[C.position]===y,"strictlySplit found no delimiter in input string."),C.position++,S=p((function(T){return y!==T}),m,C),x.push(S);return x},n.splitAStringOnASCIIWhitespace=function w(m){if(!l.isArray(m))return w(Array.from(m));var y={position:0},C=[];for(v(m,y);y.position<m.length;){var x=p((function(S){return!a.ASCIIWhiteSpace.test(S)}),m,y);C.push(x),v(m,y)}return C},n.splitAStringOnCommas=function w(m){if(!l.isArray(m))return w(Array.from(m));for(var y={position:0},C=[];y.position<m.length;){var x=p((function(S){return S!==","}),m,y);C.push(g(x)),y.position<m.length&&(console.assert(m[y.position]===",","splitAStringOnCommas found no delimiter in input string."),y.position++)}return C},n.concatenate=function(w,m){return m===void 0&&(m=""),w.length===0?"":w.join(m)}},function(r,n,i){var o=this&&this.__values||function(s){var c=typeof Symbol=="function"&&Symbol.iterator,l=c&&s[c],d=0;if(l)return l.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(97);n.abort_add=function(s,c){c._abortedFlag||c._abortAlgorithms.add(s)},n.abort_remove=function(s,c){c._abortAlgorithms.delete(s)},n.abort_signalAbort=function(s){var c,l;if(!s._abortedFlag){s._abortedFlag=!0;try{for(var d=o(s._abortAlgorithms),u=d.next();!u.done;u=d.next())u.value.call(s)}catch(f){c={error:f}}finally{try{u&&!u.done&&(l=d.return)&&l.call(d)}finally{if(c)throw c.error}}s._abortAlgorithms.clear(),a.event_fireAnEvent("abort",s)}}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(150),a=(function(){function s(){}return s.asNode=function(c){if(o.Guard.isNode(c))return c;throw new Error("Invalid object. Node expected.")},s})();n.Cast=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=(function(){function s(){}return Object.defineProperty(s.prototype,"size",{get:function(){return 0},enumerable:!0,configurable:!0}),s.prototype.add=function(c){throw new Error("Cannot add to an empty set.")},s.prototype.clear=function(){},s.prototype.delete=function(c){return!1},s.prototype.forEach=function(c,l){},s.prototype.has=function(c){return!1},s.prototype[Symbol.iterator]=function(){return new a},s.prototype.entries=function(){return new a},s.prototype.keys=function(){return new a},s.prototype.values=function(){return new a},Object.defineProperty(s.prototype,Symbol.toStringTag,{get:function(){return"EmptySet"},enumerable:!0,configurable:!0}),s})();n.EmptySet=o;var a=(function(){function s(){}return s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){return{done:!0,value:null}},s})()},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),(function(o){o[o.SchemeStart=0]="SchemeStart",o[o.Scheme=1]="Scheme",o[o.NoScheme=2]="NoScheme",o[o.SpecialRelativeOrAuthority=3]="SpecialRelativeOrAuthority",o[o.PathOrAuthority=4]="PathOrAuthority",o[o.Relative=5]="Relative",o[o.RelativeSlash=6]="RelativeSlash",o[o.SpecialAuthoritySlashes=7]="SpecialAuthoritySlashes",o[o.SpecialAuthorityIgnoreSlashes=8]="SpecialAuthorityIgnoreSlashes",o[o.Authority=9]="Authority",o[o.Host=10]="Host",o[o.Hostname=11]="Hostname",o[o.Port=12]="Port",o[o.File=13]="File",o[o.FileSlash=14]="FileSlash",o[o.FileHost=15]="FileHost",o[o.PathStart=16]="PathStart",o[o.Path=17]="Path",o[o.CannotBeABaseURLPath=18]="CannotBeABaseURLPath",o[o.Query=19]="Query",o[o.Fragment=20]="Fragment"})(n.ParserState||(n.ParserState={})),n.OpaqueOrigin=["","",null,null]},function(r,n,i){var o=i(245),a=i(247);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=x,n.resolve=function(S,T){return x(S,!1,!0).resolve(T)},n.resolveObject=function(S,T){return S?x(S,!1,!0).resolveObject(T):T},n.format=function(S){return a.isString(S)&&(S=x(S)),S instanceof s?S.format():s.prototype.format.call(S)},n.Url=s;var c=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),f=["'"].concat(u),h=["%","/","?",";","#"].concat(f),g=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,v=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},C=i(248);function x(S,T,_){if(S&&a.isObject(S)&&S instanceof s)return S;var E=new s;return E.parse(S,T,_),E}s.prototype.parse=function(S,T,_){if(!a.isString(S))throw new TypeError("Parameter 'url' must be a string, not "+typeof S);var E=S.indexOf("?"),D=E!==-1&&E<S.indexOf("#")?"?":"#",b=S.split(D);b[0]=b[0].replace(/\\/g,"/");var I=S=b.join(D);if(I=I.trim(),!_&&S.split("#").length===1){var O=d.exec(I);if(O)return this.path=I,this.href=I,this.pathname=O[1],O[2]?(this.search=O[2],this.query=T?C.parse(this.search.substr(1)):this.search.substr(1)):T&&(this.search="",this.query={}),this}var M=c.exec(I);if(M){var R=(M=M[0]).toLowerCase();this.protocol=R,I=I.substr(M.length)}if(_||M||I.match(/^\/\/[^@\/]+@[^@\/]+/)){var A=I.substr(0,2)==="//";!A||M&&m[M]||(I=I.substr(2),this.slashes=!0)}if(!m[M]&&(A||M&&!y[M])){for(var G,k,L=-1,F=0;F<g.length;F++)(j=I.indexOf(g[F]))!==-1&&(L===-1||j<L)&&(L=j);for((k=L===-1?I.lastIndexOf("@"):I.lastIndexOf("@",L))!==-1&&(G=I.slice(0,k),I=I.slice(k+1),this.auth=decodeURIComponent(G)),L=-1,F=0;F<h.length;F++){var j;(j=I.indexOf(h[F]))!==-1&&(L===-1||j<L)&&(L=j)}L===-1&&(L=I.length),this.host=I.slice(0,L),I=I.slice(L),this.parseHost(),this.hostname=this.hostname||"";var Y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!Y)for(var ie=this.hostname.split(/\./),de=(F=0,ie.length);F<de;F++){var ae=ie[F];if(ae&&!ae.match(p)){for(var fe="",we=0,_e=ae.length;we<_e;we++)ae.charCodeAt(we)>127?fe+="x":fe+=ae[we];if(!fe.match(p)){var Se=ie.slice(0,F),B=ie.slice(F+1),P=ae.match(v);P&&(Se.push(P[1]),B.unshift(P[2])),B.length&&(I="/"+B.join(".")+I),this.hostname=Se.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),Y||(this.hostname=o.toASCII(this.hostname));var $=this.port?":"+this.port:"",W=this.hostname||"";this.host=W+$,this.href+=this.host,Y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!w[R])for(F=0,de=f.length;F<de;F++){var K=f[F];if(I.indexOf(K)!==-1){var Q=encodeURIComponent(K);Q===K&&(Q=escape(K)),I=I.split(K).join(Q)}}var ee=I.indexOf("#");ee!==-1&&(this.hash=I.substr(ee),I=I.slice(0,ee));var ge=I.indexOf("?");if(ge!==-1?(this.search=I.substr(ge),this.query=I.substr(ge+1),T&&(this.query=C.parse(this.query)),I=I.slice(0,ge)):T&&(this.search="",this.query={}),I&&(this.pathname=I),y[R]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){$=this.pathname||"";var De=this.search||"";this.path=$+De}return this.href=this.format(),this},s.prototype.format=function(){var S=this.auth||"";S&&(S=(S=encodeURIComponent(S)).replace(/%3A/i,":"),S+="@");var T=this.protocol||"",_=this.pathname||"",E=this.hash||"",D=!1,b="";this.host?D=S+this.host:this.hostname&&(D=S+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(D+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(b=C.stringify(this.query));var I=this.search||b&&"?"+b||"";return T&&T.substr(-1)!==":"&&(T+=":"),this.slashes||(!T||y[T])&&D!==!1?(D="//"+(D||""),_&&_.charAt(0)!=="/"&&(_="/"+_)):D||(D=""),E&&E.charAt(0)!=="#"&&(E="#"+E),I&&I.charAt(0)!=="?"&&(I="?"+I),T+D+(_=_.replace(/[?#]/g,(function(O){return encodeURIComponent(O)})))+(I=I.replace("#","%23"))+E},s.prototype.resolve=function(S){return this.resolveObject(x(S,!1,!0)).format()},s.prototype.resolveObject=function(S){if(a.isString(S)){var T=new s;T.parse(S,!1,!0),S=T}for(var _=new s,E=Object.keys(this),D=0;D<E.length;D++){var b=E[D];_[b]=this[b]}if(_.hash=S.hash,S.href==="")return _.href=_.format(),_;if(S.slashes&&!S.protocol){for(var I=Object.keys(S),O=0;O<I.length;O++){var M=I[O];M!=="protocol"&&(_[M]=S[M])}return y[_.protocol]&&_.hostname&&!_.pathname&&(_.path=_.pathname="/"),_.href=_.format(),_}if(S.protocol&&S.protocol!==_.protocol){if(!y[S.protocol]){for(var R=Object.keys(S),A=0;A<R.length;A++){var G=R[A];_[G]=S[G]}return _.href=_.format(),_}if(_.protocol=S.protocol,S.host||m[S.protocol])_.pathname=S.pathname;else{for(var k=(S.pathname||"").split("/");k.length&&!(S.host=k.shift()););S.host||(S.host=""),S.hostname||(S.hostname=""),k[0]!==""&&k.unshift(""),k.length<2&&k.unshift(""),_.pathname=k.join("/")}if(_.search=S.search,_.query=S.query,_.host=S.host||"",_.auth=S.auth,_.hostname=S.hostname||S.host,_.port=S.port,_.pathname||_.search){var L=_.pathname||"",F=_.search||"";_.path=L+F}return _.slashes=_.slashes||S.slashes,_.href=_.format(),_}var j=_.pathname&&_.pathname.charAt(0)==="/",Y=S.host||S.pathname&&S.pathname.charAt(0)==="/",ie=Y||j||_.host&&S.pathname,de=ie,ae=_.pathname&&_.pathname.split("/")||[],fe=(k=S.pathname&&S.pathname.split("/")||[],_.protocol&&!y[_.protocol]);if(fe&&(_.hostname="",_.port=null,_.host&&(ae[0]===""?ae[0]=_.host:ae.unshift(_.host)),_.host="",S.protocol&&(S.hostname=null,S.port=null,S.host&&(k[0]===""?k[0]=S.host:k.unshift(S.host)),S.host=null),ie=ie&&(k[0]===""||ae[0]==="")),Y)_.host=S.host||S.host===""?S.host:_.host,_.hostname=S.hostname||S.hostname===""?S.hostname:_.hostname,_.search=S.search,_.query=S.query,ae=k;else if(k.length)ae||(ae=[]),ae.pop(),ae=ae.concat(k),_.search=S.search,_.query=S.query;else if(!a.isNullOrUndefined(S.search))return fe&&(_.hostname=_.host=ae.shift(),(P=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=P.shift(),_.host=_.hostname=P.shift())),_.search=S.search,_.query=S.query,a.isNull(_.pathname)&&a.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.href=_.format(),_;if(!ae.length)return _.pathname=null,_.search?_.path="/"+_.search:_.path=null,_.href=_.format(),_;for(var we=ae.slice(-1)[0],_e=(_.host||S.host||ae.length>1)&&(we==="."||we==="..")||we==="",Se=0,B=ae.length;B>=0;B--)(we=ae[B])==="."?ae.splice(B,1):we===".."?(ae.splice(B,1),Se++):Se&&(ae.splice(B,1),Se--);if(!ie&&!de)for(;Se--;Se)ae.unshift("..");!ie||ae[0]===""||ae[0]&&ae[0].charAt(0)==="/"||ae.unshift(""),_e&&ae.join("/").substr(-1)!=="/"&&ae.push("");var P,$=ae[0]===""||ae[0]&&ae[0].charAt(0)==="/";return fe&&(_.hostname=_.host=$?"":ae.length?ae.shift():"",(P=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=P.shift(),_.host=_.hostname=P.shift())),(ie=ie||_.host&&ae.length)&&!$&&ae.unshift(""),ae.length?_.pathname=ae.join("/"):(_.pathname=null,_.path=null),a.isNull(_.pathname)&&a.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.auth=S.auth||_.auth,_.slashes=_.slashes||S.slashes,_.href=_.format(),_},s.prototype.parseHost=function(){var S=this.host,T=l.exec(S);T&&((T=T[0])!==":"&&(this.port=T.substr(1)),S=S.substr(0,S.length-T.length)),S&&(this.hostname=S)}},function(r,n,i){(function(o,a){var s;(function(c){n&&n.nodeType,o&&o.nodeType;var l=typeof a=="object"&&a;l.global!==l&&l.window!==l&&l.self;var d,u=2147483647,f=/^xn--/,h=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=Math.floor,w=String.fromCharCode;function m(b){throw new RangeError(p[b])}function y(b,I){for(var O=b.length,M=[];O--;)M[O]=I(b[O]);return M}function C(b,I){var O=b.split("@"),M="";return O.length>1&&(M=O[0]+"@",b=O[1]),M+y((b=b.replace(g,".")).split("."),I).join(".")}function x(b){for(var I,O,M=[],R=0,A=b.length;R<A;)(I=b.charCodeAt(R++))>=55296&&I<=56319&&R<A?(64512&(O=b.charCodeAt(R++)))==56320?M.push(((1023&I)<<10)+(1023&O)+65536):(M.push(I),R--):M.push(I);return M}function S(b){return y(b,(function(I){var O="";return I>65535&&(O+=w((I-=65536)>>>10&1023|55296),I=56320|1023&I),O+=w(I)})).join("")}function T(b,I){return b+22+75*(b<26)-((I!=0)<<5)}function _(b,I,O){var M=0;for(b=O?v(b/700):b>>1,b+=v(b/I);b>455;M+=36)b=v(b/35);return v(M+36*b/(b+38))}function E(b){var I,O,M,R,A,G,k,L,F,j,Y,ie=[],de=b.length,ae=0,fe=128,we=72;for((O=b.lastIndexOf("-"))<0&&(O=0),M=0;M<O;++M)b.charCodeAt(M)>=128&&m("not-basic"),ie.push(b.charCodeAt(M));for(R=O>0?O+1:0;R<de;){for(A=ae,G=1,k=36;R>=de&&m("invalid-input"),((L=(Y=b.charCodeAt(R++))-48<10?Y-22:Y-65<26?Y-65:Y-97<26?Y-97:36)>=36||L>v((u-ae)/G))&&m("overflow"),ae+=L*G,!(L<(F=k<=we?1:k>=we+26?26:k-we));k+=36)G>v(u/(j=36-F))&&m("overflow"),G*=j;we=_(ae-A,I=ie.length+1,A==0),v(ae/I)>u-fe&&m("overflow"),fe+=v(ae/I),ae%=I,ie.splice(ae++,0,fe)}return S(ie)}function D(b){var I,O,M,R,A,G,k,L,F,j,Y,ie,de,ae,fe,we=[];for(ie=(b=x(b)).length,I=128,O=0,A=72,G=0;G<ie;++G)(Y=b[G])<128&&we.push(w(Y));for(M=R=we.length,R&&we.push("-");M<ie;){for(k=u,G=0;G<ie;++G)(Y=b[G])>=I&&Y<k&&(k=Y);for(k-I>v((u-O)/(de=M+1))&&m("overflow"),O+=(k-I)*de,I=k,G=0;G<ie;++G)if((Y=b[G])<I&&++O>u&&m("overflow"),Y==I){for(L=O,F=36;!(L<(j=F<=A?1:F>=A+26?26:F-A));F+=36)fe=L-j,ae=36-j,we.push(w(T(j+fe%ae,0))),L=v(fe/ae);we.push(w(T(L,0))),A=_(O,de,M==R),O=0,++M}++O,++I}return we.join("")}d={version:"1.4.1",ucs2:{decode:x,encode:S},decode:E,encode:D,toASCII:function(b){return C(b,(function(I){return h.test(I)?"xn--"+D(I):I}))},toUnicode:function(b){return C(b,(function(I){return f.test(I)?E(I.slice(4).toLowerCase()):I}))}},(s=(function(){return d}).call(n,i,n,o))===void 0||(o.exports=s)})()}).call(this,i(246)(r),i(78))},function(r,n){r.exports=function(i){return i.webpackPolyfill||(i.deprecate=function(){},i.paths=[],i.children||(i.children=[]),Object.defineProperty(i,"loaded",{enumerable:!0,get:function(){return i.l}}),Object.defineProperty(i,"id",{enumerable:!0,get:function(){return i.i}}),i.webpackPolyfill=1),i}},function(r,n,i){r.exports={isString:function(o){return typeof o=="string"},isObject:function(o){return typeof o=="object"&&o!==null},isNull:function(o){return o===null},isNullOrUndefined:function(o){return o==null}}},function(r,n,i){n.decode=n.parse=i(249),n.encode=n.stringify=i(250)},function(r,n,i){function o(s,c){return Object.prototype.hasOwnProperty.call(s,c)}r.exports=function(s,c,l,d){c=c||"&",l=l||"=";var u={};if(typeof s!="string"||s.length===0)return u;var f=/\+/g;s=s.split(c);var h=1e3;d&&typeof d.maxKeys=="number"&&(h=d.maxKeys);var g=s.length;h>0&&g>h&&(g=h);for(var p=0;p<g;++p){var v,w,m,y,C=s[p].replace(f,"%20"),x=C.indexOf(l);x>=0?(v=C.substr(0,x),w=C.substr(x+1)):(v=C,w=""),m=decodeURIComponent(v),y=decodeURIComponent(w),o(u,m)?a(u[m])?u[m].push(y):u[m]=[u[m],y]:u[m]=y}return u};var a=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"}},function(r,n,i){var o=function(l){switch(typeof l){case"string":return l;case"boolean":return l?"true":"false";case"number":return isFinite(l)?l:"";default:return""}};r.exports=function(l,d,u,f){return d=d||"&",u=u||"=",l===null&&(l=void 0),typeof l=="object"?s(c(l),(function(h){var g=encodeURIComponent(o(h))+u;return a(l[h])?s(l[h],(function(p){return g+encodeURIComponent(o(p))})).join(d):g+encodeURIComponent(o(l[h]))})).join(d):f?encodeURIComponent(o(f))+u+encodeURIComponent(o(l)):""};var a=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"};function s(l,d){if(l.map)return l.map(d);for(var u=[],f=0;f<l.length;f++)u.push(d(l[f],f));return u}var c=Object.keys||function(l){var d=[];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&d.push(u);return d}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(52);n.attr_setAnExistingAttributeValue=function(a,s){a._element===null?a._value=s:o.element_change(a,a._element,s)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(108),a=i(30),s=i(52);n.tokenList_validationSteps=function(c,l){if(!a.dom_hasSupportedTokens(c._attribute._localName))throw new TypeError("There are no supported tokens defined for attribute name: '"+c._attribute._localName+"'.");return a.dom_getSupportedTokens(c._attribute._localName).has(l.toLowerCase())},n.tokenList_updateSteps=function(c){(c._element.hasAttribute(c._attribute._localName)||c._tokenSet.size!==0)&&s.element_setAnAttributeValue(c._element,c._attribute._localName,o.orderedSet_serialize(c._tokenSet))},n.tokenList_serializeSteps=function(c){return s.element_getAnAttributeValue(c._element,c._attribute._localName)}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&c[l],u=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1);function s(c){return a.isBoolean(c)?c:c.capture||!1}n.eventTarget_flatten=s,n.eventTarget_flattenMore=function(c){var l=s(c),d=!1,u=!1;return a.isBoolean(c)||(d=c.once||!1,u=c.passive||!1),[l,u,d]},n.eventTarget_addEventListener=function(c,l){if(l.callback!==null){for(var d=0;d<c._eventListenerList.length;d++){var u=c._eventListenerList[d];if(u.type===l.type&&u.callback.handleEvent===l.callback.handleEvent&&u.capture===l.capture)return}c._eventListenerList.push(l)}},n.eventTarget_removeEventListener=function(c,l,d){l.removed=!0,c._eventListenerList.splice(d,1)},n.eventTarget_removeAllEventListeners=function(c){var l,d;try{for(var u=o(c._eventListenerList),f=u.next();!f.done;f=u.next())f.value.removed=!0}catch(h){l={error:h}}finally{try{f&&!f.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}c._eventListenerList.length=0}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&c[l],u=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1),s=i(29);n.parentNode_convertNodesIntoANode=function(c,l){for(var d,u,f=null,h=0;h<c.length;h++){var g=c[h];if(a.isString(g)){var p=s.create_text(l,g);c[h]=p}}if(c.length===1)f=c[0];else{var v=f=s.create_documentFragment(l);try{for(var w=o(c),m=w.next();!m.done;m=w.next())g=m.value,v.appendChild(g)}catch(y){d={error:y}}finally{try{m&&!m.done&&(u=w.return)&&u.call(w)}finally{if(d)throw d.error}}}return f}},function(r,n,i){var o=this&&this.__values||function(T){var _=typeof Symbol=="function"&&Symbol.iterator,E=_&&T[_],D=0;if(E)return E.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&D>=T.length&&(T=void 0),{value:T&&T[D++],done:!T}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(T,_){var E=typeof Symbol=="function"&&T[Symbol.iterator];if(!E)return T;var D,b,I=E.call(T),O=[];try{for(;(_===void 0||_-- >0)&&!(D=I.next()).done;)O.push(D.value)}catch(M){b={error:M}}finally{try{D&&!D.done&&(E=I.return)&&E.call(I)}finally{if(b)throw b.error}}return O},s=this&&this.__spread||function(){for(var T=[],_=0;_<arguments.length;_++)T=T.concat(a(arguments[_]));return T};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(9),d=i(3),u=i(29),f=i(17),h=i(175),g=i(107),p=i(176),v=i(37),w=i(177);function m(T){return T._startNode===T._endNode&&T._startOffset===T._endOffset}function y(T){return f.tree_rootNode(T._startNode)}function C(T,_){return f.tree_rootNode(T)===y(_)&&h.boundaryPoint_position([T,0],_._start)===c.BoundaryPosition.After&&h.boundaryPoint_position([T,f.tree_nodeLength(T)],_._end)===c.BoundaryPosition.Before}function x(T,_){var E=f.tree_isAncestorOf(_._startNode,T,!0),D=f.tree_isAncestorOf(_._endNode,T,!0);return E&&!D||!E&&D}function S(T){var _,E,D,b,I,O,M=u.create_documentFragment(T._startNode._nodeDocument);if(m(T))return M;var R=T._startNode,A=T._startOffset,G=T._endNode,k=T._endOffset;if(R===G&&d.Guard.isCharacterDataNode(R))return(W=p.node_clone(R))._data=g.characterData_substringData(R,A,k-A),v.mutation_append(W,M),g.characterData_replaceData(R,A,k-A,""),M;for(var L=R;!f.tree_isAncestorOf(G,L,!0);){if(L._parent===null)throw new Error("Parent node  is null.");L=L._parent}var F=null;if(!f.tree_isAncestorOf(G,R,!0))try{for(var j=o(L._children),Y=j.next();!Y.done;Y=j.next())if(x(fe=Y.value,T)){F=fe;break}}catch(De){_={error:De}}finally{try{Y&&!Y.done&&(E=j.return)&&E.call(j)}finally{if(_)throw _.error}}var ie=null;if(!f.tree_isAncestorOf(R,G,!0))for(var de=s(L._children),ae=de.length-1;ae>0;ae--){var fe;if(x(fe=de[ae],T)){ie=fe;break}}var we,_e,Se=[];try{for(var B=o(L._children),P=B.next();!P.done;P=B.next())if(C(ge=P.value,T)){if(d.Guard.isDocumentTypeNode(ge))throw new l.HierarchyRequestError;Se.push(ge)}}catch(De){D={error:De}}finally{try{P&&!P.done&&(b=B.return)&&b.call(B)}finally{if(D)throw D.error}}if(f.tree_isAncestorOf(G,R,!0))we=R,_e=A;else{for(var $=R;$._parent!==null&&!f.tree_isAncestorOf(G,$._parent);)$=$._parent;if($._parent===null)throw new Error("Parent node is null.");we=$._parent,_e=1+f.tree_index($)}if(d.Guard.isCharacterDataNode(F))(W=p.node_clone(R))._data=g.characterData_substringData(R,A,f.tree_nodeLength(R)-A),v.mutation_append(W,M),g.characterData_replaceData(R,A,f.tree_nodeLength(R)-A,"");else if(F!==null){var W=p.node_clone(F);v.mutation_append(W,M);var K=S(u.create_range([R,A],[F,f.tree_nodeLength(F)]));v.mutation_append(K,W)}try{for(var Q=o(Se),ee=Q.next();!ee.done;ee=Q.next()){var ge=ee.value;v.mutation_append(ge,M)}}catch(De){I={error:De}}finally{try{ee&&!ee.done&&(O=Q.return)&&O.call(Q)}finally{if(I)throw I.error}}return d.Guard.isCharacterDataNode(ie)?((W=p.node_clone(G))._data=g.characterData_substringData(G,0,k),v.mutation_append(W,M),g.characterData_replaceData(G,0,k,"")):ie!==null&&(W=p.node_clone(ie),v.mutation_append(W,M),K=S(u.create_range([ie,0],[G,k])),v.mutation_append(K,W)),T._start=[we,_e],T._end=[we,_e],M}n.range_collapsed=m,n.range_root=y,n.range_isContained=C,n.range_isPartiallyContained=x,n.range_setTheStart=function(T,_,E){if(d.Guard.isDocumentTypeNode(_))throw new l.InvalidNodeTypeError;if(E>f.tree_nodeLength(_))throw new l.IndexSizeError;var D=[_,E];y(T)===f.tree_rootNode(_)&&h.boundaryPoint_position(D,T._end)!==c.BoundaryPosition.After||(T._end=D),T._start=D},n.range_setTheEnd=function(T,_,E){if(d.Guard.isDocumentTypeNode(_))throw new l.InvalidNodeTypeError;if(E>f.tree_nodeLength(_))throw new l.IndexSizeError;var D=[_,E];y(T)===f.tree_rootNode(_)&&h.boundaryPoint_position(D,T._start)!==c.BoundaryPosition.Before||(T._start=D),T._end=D},n.range_select=function(T,_){var E=T._parent;if(E===null)throw new l.InvalidNodeTypeError;var D=f.tree_index(T);_._start=[E,D],_._end=[E,D+1]},n.range_extract=S,n.range_cloneTheContents=function T(_){var E,D,b,I,O,M,R=u.create_documentFragment(_._startNode._nodeDocument);if(m(_))return R;var A=_._startNode,G=_._startOffset,k=_._endNode,L=_._endOffset;A===k&&d.Guard.isCharacterDataNode(A)&&((P=p.node_clone(A))._data=g.characterData_substringData(A,G,L-G),v.mutation_append(P,R));for(var F=A;!f.tree_isAncestorOf(k,F,!0);){if(F._parent===null)throw new Error("Parent node  is null.");F=F._parent}var j=null;if(!f.tree_isAncestorOf(k,A,!0))try{for(var Y=o(F._children),ie=Y.next();!ie.done;ie=Y.next())if(x(we=ie.value,_)){j=we;break}}catch(ee){E={error:ee}}finally{try{ie&&!ie.done&&(D=Y.return)&&D.call(Y)}finally{if(E)throw E.error}}var de=null;if(!f.tree_isAncestorOf(A,k,!0))for(var ae=s(F._children),fe=ae.length-1;fe>0;fe--){var we;if(x(we=ae[fe],_)){de=we;break}}var _e=[];try{for(var Se=o(F._children),B=Se.next();!B.done;B=Se.next())if(C(Q=B.value,_)){if(d.Guard.isDocumentTypeNode(Q))throw new l.HierarchyRequestError;_e.push(Q)}}catch(ee){b={error:ee}}finally{try{B&&!B.done&&(I=Se.return)&&I.call(Se)}finally{if(b)throw b.error}}if(d.Guard.isCharacterDataNode(j))(P=p.node_clone(A))._data=g.characterData_substringData(A,G,f.tree_nodeLength(A)-G),v.mutation_append(P,R);else if(j!==null){var P=p.node_clone(j);v.mutation_append(P,R);var $=T(u.create_range([A,G],[j,f.tree_nodeLength(j)]));v.mutation_append($,P)}try{for(var W=o(_e),K=W.next();!K.done;K=W.next()){var Q=K.value,P=p.node_clone(Q);v.mutation_append(P,R)}}catch(ee){O={error:ee}}finally{try{K&&!K.done&&(M=W.return)&&M.call(W)}finally{if(O)throw O.error}}return d.Guard.isCharacterDataNode(de)?((P=p.node_clone(k))._data=g.characterData_substringData(k,0,L),v.mutation_append(P,R)):de!==null&&(P=p.node_clone(de),R.append(P),$=S(u.create_range([de,0],[k,L])),v.mutation_append($,P)),R},n.range_insert=function(T,_){var E,D;if(d.Guard.isProcessingInstructionNode(_._startNode)||d.Guard.isCommentNode(_._startNode)||d.Guard.isTextNode(_._startNode)&&_._startNode._parent===null||_._startNode===T)throw new l.HierarchyRequestError;var b,I=null;if(d.Guard.isTextNode(_._startNode))I=_._startNode;else{var O=0;try{for(var M=o(_._startNode._children),R=M.next();!R.done;R=M.next()){var A=R.value;if(O===_._startOffset){I=A;break}O++}}catch(k){E={error:k}}finally{try{R&&!R.done&&(D=M.return)&&D.call(M)}finally{if(E)throw E.error}}}if(I===null)b=_._startNode;else{if(I._parent===null)throw new Error("Parent node is null.");b=I._parent}v.mutation_ensurePreInsertionValidity(T,b,I),d.Guard.isTextNode(_._startNode)&&(I=w.text_split(_._startNode,_._startOffset)),T===I&&(I=T._nextSibling),T._parent!==null&&v.mutation_remove(T,T._parent);var G=I===null?f.tree_nodeLength(b):f.tree_index(I);d.Guard.isDocumentFragmentNode(T)?G+=f.tree_nodeLength(T):G++,v.mutation_preInsert(T,b,I),m(_)&&(_._end=[b,G])},n.range_getContainedNodes=function(T){var _;return(_={})[Symbol.iterator]=function(){var E=T.commonAncestorContainer,D=f.tree_getFirstDescendantNode(E);return{next:function(){for(;D&&!C(D,T);)D=f.tree_getNextDescendantNode(E,D);if(D===null)return{done:!0,value:null};var b={done:!1,value:D};return D=f.tree_getNextDescendantNode(E,D),b}}},_},n.range_getPartiallyContainedNodes=function(T){var _;return(_={})[Symbol.iterator]=function(){var E=T.commonAncestorContainer,D=f.tree_getFirstDescendantNode(E);return{next:function(){for(;D&&!x(D,T);)D=f.tree_getNextDescendantNode(E,D);if(D===null)return{done:!0,value:null};var b={done:!1,value:D};return D=f.tree_getNextDescendantNode(E,D),b}}},_}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(9);n.selectors_scopeMatchASelectorsString=function(a,s){throw new o.NotSupportedError}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(105);n.treeWalker_traverseChildren=function(s,c){for(var l=c?s._current._firstChild:s._current._lastChild;l!==null;){var d=a.traversal_filter(s,l);if(d===o.FilterResult.Accept)return s._current=l,l;if(d===o.FilterResult.Skip){var u=c?l._firstChild:l._lastChild;if(u!==null){l=u;continue}}for(;l!==null;){var f=c?l._nextSibling:l._previousSibling;if(f!==null){l=f;break}var h=l._parent;if(h===null||h===s._root||h===s._current)return null;l=h}}return null},n.treeWalker_traverseSiblings=function(s,c){var l=s._current;if(l===s._root)return null;for(;;){for(var d=c?l._nextSibling:l._previousSibling;d!==null;){l=d;var u=a.traversal_filter(s,l);if(u===o.FilterResult.Accept)return s._current=l,l;d=c?l._firstChild:l._lastChild,u!==o.FilterResult.Reject&&d!==null||(d=c?l._nextSibling:l._previousSibling)}if((l=l._parent)===null||l===s._root||a.traversal_filter(s,l)===o.FilterResult.Accept)return null}}},function(r,n,i){i(89),i(74);var o,a=this&&this.__extends||(o=function(f,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var v in p)p.hasOwnProperty(v)&&(g[v]=p[v])})(f,h)},function(f,h){function g(){this.constructor=f}o(f,h),f.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=i(2),l=i(50),d=i(3),u=(function(f){function h(g,p){var v=f.call(this,g)||this;return v._indentation={},v._lengthToLastNewline=0,v._writerOptions=s.applyDefaults(p,{wellFormed:!1,headless:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,indentTextOnlyNodes:!1,spaceBeforeSlash:!1}),v}return a(h,f),h.prototype.serialize=function(g){return this._refs={suppressPretty:!1,emptyNode:!1,markup:""},g.nodeType!==c.NodeType.Document||this._writerOptions.headless||this.declaration(this._builderOptions.version,this._builderOptions.encoding,this._builderOptions.standalone),this.serializeNode(g,this._writerOptions.wellFormed),this._writerOptions.prettyPrint&&this._refs.markup.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(this._refs.markup=this._refs.markup.slice(0,-this._writerOptions.newline.length)),this._refs.markup},h.prototype.declaration=function(g,p,v){this._beginLine(),this._refs.markup+='<?xml version="'+g+'"',p!==void 0&&(this._refs.markup+=' encoding="'+p+'"'),v!==void 0&&(this._refs.markup+=' standalone="'+(v?"yes":"no")+'"'),this._refs.markup+="?>",this._endLine()},h.prototype.docType=function(g,p,v){this._beginLine(),this._refs.markup+=p&&v?"<!DOCTYPE "+g+' PUBLIC "'+p+'" "'+v+'">':p?"<!DOCTYPE "+g+' PUBLIC "'+p+'">':v?"<!DOCTYPE "+g+' SYSTEM "'+v+'">':"<!DOCTYPE "+g+">",this._endLine()},h.prototype.openTagBegin=function(g){this._beginLine(),this._refs.markup+="<"+g},h.prototype.openTagEnd=function(g,p,v){if(this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._writerOptions.prettyPrint&&!p&&!v){for(var w=!0,m=!0,y=this.currentNode.firstChild,C=0,x=0;y;){if(d.Guard.isExclusiveTextNode(y))x++;else{if(!d.Guard.isCDATASectionNode(y)){w=!1,m=!1;break}C++}y.data!==""&&(m=!1),y=y.nextSibling}this._refs.suppressPretty=!this._writerOptions.indentTextOnlyNodes&&w&&(C<=1&&x===0||C===0),this._refs.emptyNode=m}(v||p||this._refs.emptyNode)&&this._writerOptions.allowEmptyTags?this._refs.markup+="></"+g+">":this._refs.markup+=v?" />":p||this._refs.emptyNode?this._writerOptions.spaceBeforeSlash?" />":"/>":">",this._endLine()},h.prototype.closeTag=function(g){this._refs.emptyNode||(this._beginLine(),this._refs.markup+="</"+g+">"),this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._endLine()},h.prototype.attribute=function(g,p){var v=g+'="'+p+'"';this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._refs.markup.length-this._lengthToLastNewline+1+v.length>this._writerOptions.width?(this._endLine(),this._beginLine(),this._refs.markup+=this._indent(1)+v):this._refs.markup+=" "+v},h.prototype.text=function(g){g!==""&&(this._beginLine(),this._refs.markup+=g,this._endLine())},h.prototype.cdata=function(g){g!==""&&(this._beginLine(),this._refs.markup+="<![CDATA["+g+"]]>",this._endLine())},h.prototype.comment=function(g){this._beginLine(),this._refs.markup+="<!--"+g+"-->",this._endLine()},h.prototype.instruction=function(g,p){this._beginLine(),this._refs.markup+="<?"+(p===""?g:g+" "+p)+"?>",this._endLine()},h.prototype._beginLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._indent(this._writerOptions.offset+this.level))},h.prototype._endLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._writerOptions.newline,this._lengthToLastNewline=this._refs.markup.length)},h.prototype._indent=function(g){if(g<=0)return"";if(this._indentation[g]!==void 0)return this._indentation[g];var p=this._writerOptions.indent.repeat(g);return this._indentation[g]=p,p},h})(l.BaseWriter);n.XMLWriter=u},function(r,n,i){var o=i(47),a=i(35);r.exports="".repeat||function(s){var c=String(a(this)),l="",d=o(s);if(d<0||d==1/0)throw RangeError("Wrong number of repetitions");for(;d>0;(d>>>=1)&&(c+=c))1&d&&(l+=c);return l}},function(r,n,i){i(31),i(32),i(33),i(19),i(178),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}),s=this&&this.__values||function(u){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&u[f],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(67),l=i(1),d=(function(u){function f(h,g){var p=u.call(this,h)||this;return p._writerOptions=l.applyDefaults(g,{wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),p}return a(f,u),f.prototype.serialize=function(h){var g=l.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),p=new c.ObjectWriter(this._builderOptions,g).serialize(h);return this._beginLine(this._writerOptions,0)+this._convertObject(p,this._writerOptions)},f.prototype._convertObject=function(h,g,p){var v,w,m=this;p===void 0&&(p=0);var y="",C=this._isLeafNode(h);if(l.isArray(h)){y+="[";var x=h.length,S=0;try{for(var T=s(h),_=T.next();!_.done;_=T.next()){var E=_.value;y+=this._endLine(g,p+1)+this._beginLine(g,p+1)+this._convertObject(E,g,p+1),S<x-1&&(y+=","),S++}}catch(I){v={error:I}}finally{try{_&&!_.done&&(w=T.return)&&w.call(T)}finally{if(v)throw v.error}}y+=this._endLine(g,p)+this._beginLine(g,p),y+="]"}else if(l.isObject(h)){y+="{";var D=l.objectLength(h),b=0;l.forEachObject(h,(function(I,O){C&&g.prettyPrint?y+=" ":y+=m._endLine(g,p+1)+m._beginLine(g,p+1),y+=m._key(I),g.prettyPrint&&(y+=" "),y+=m._convertObject(O,g,p+1),b<D-1&&(y+=","),b++}),this),C&&g.prettyPrint?y+=" ":y+=this._endLine(g,p)+this._beginLine(g,p),y+="}"}else y+=this._val(h);return y},f.prototype._beginLine=function(h,g){if(!h.prettyPrint)return"";var p=h.offset+g+1;return p>0?new Array(p).join(h.indent):""},f.prototype._endLine=function(h,g){return h.prettyPrint?h.newline:""},f.prototype._key=function(h){return'"'+h+'":'},f.prototype._val=function(h){return JSON.stringify(h)},f.prototype._isLeafNode=function(h){return this._descendantCount(h)<=1},f.prototype._descendantCount=function(h,g){var p=this;return g===void 0&&(g=0),l.isArray(h)?l.forEachArray(h,(function(v){return g+=p._descendantCount(v,g)}),this):l.isObject(h)?l.forEachObject(h,(function(v,w){return g+=p._descendantCount(w,g)}),this):g++,g},f})(i(50).BaseWriter);n.JSONWriter=d},function(r,n,i){i(31),i(32),i(33),i(19),i(178),i(89),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}),s=this&&this.__values||function(u){var f=typeof Symbol=="function"&&Symbol.iterator,h=f&&u[f],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(67),l=i(1),d=(function(u){function f(h,g){var p=u.call(this,h)||this;if(p._writerOptions=l.applyDefaults(g,{wellFormed:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),p._writerOptions.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(p._writerOptions.offset<0)throw new Error("YAML offset should be zero or a positive number.");return p}return a(f,u),f.prototype.serialize=function(h){var g=l.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),p=new c.ObjectWriter(this._builderOptions,g).serialize(h),v=this._beginLine(this._writerOptions,0)+"---"+this._endLine(this._writerOptions)+this._convertObject(p,this._writerOptions,0);return v.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(v=v.slice(0,-this._writerOptions.newline.length)),v},f.prototype._convertObject=function(h,g,p,v){var w,m,y=this;v===void 0&&(v=!1);var C="";if(l.isArray(h))try{for(var x=s(h),S=x.next();!S.done;S=x.next()){var T=S.value;C+=this._beginLine(g,p,!0),l.isObject(T)?l.isEmpty(T)?C+='""'+this._endLine(g):C+=this._convertObject(T,g,p,!0):C+=this._val(T)+this._endLine(g)}}catch(_){w={error:_}}finally{try{S&&!S.done&&(m=x.return)&&m.call(x)}finally{if(w)throw w.error}}else l.forEachObject(h,(function(_,E){v?(C+=y._key(_),v=!1):C+=y._beginLine(g,p)+y._key(_),l.isObject(E)?l.isEmpty(E)?C+=' ""'+y._endLine(g):C+=y._endLine(g)+y._convertObject(E,g,p+1):C+=" "+y._val(E)+y._endLine(g)}),this);return C},f.prototype._beginLine=function(h,g,p){p===void 0&&(p=!1);var v=h.offset+g+1,w=new Array(v).join(h.indent);return p?w.substr(0,w.length-2)+"-"+w.substr(-1,1):w},f.prototype._endLine=function(h){return h.newline},f.prototype._key=function(h){return'"'+h+'":'},f.prototype._val=function(h){return JSON.stringify(h)},f})(i(50).BaseWriter);n.YAMLWriter=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),i(110).dom.setFeatures(!0);var o=i(110);n.DOMImplementation=o.DOMImplementation;var a=i(271);n.DOMParser=a.DOMParser;var s=i(274);n.XMLSerializer=s.XMLSerializer},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=i(0),s=(function(){function c(){}return c.prototype.before=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];var u=o.Cast.asNode(this),f=u._parent;if(f!==null){for(var h=u._previousSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var v=l[p];if(v===h){h=h._previousSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);h=h===null?f._firstChild:h._nextSibling,a.mutation_preInsert(w,f,h)}},c.prototype.after=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];var u=o.Cast.asNode(this),f=u._parent;if(f){for(var h=u._nextSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var v=l[p];if(v===h){h=h._nextSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);a.mutation_preInsert(w,f,h)}},c.prototype.replaceWith=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];var u=o.Cast.asNode(this),f=u._parent;if(f){for(var h=u._nextSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var v=l[p];if(v===h){h=h._nextSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);u._parent===f?a.mutation_replace(u,w,f):a.mutation_preInsert(w,f,h)}},c.prototype.remove=function(){var l=o.Cast.asNode(this),d=l._parent;d&&a.mutation_remove(l,d)},c})();n.ChildNodeImpl=s},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){};n.DocumentOrShadowRootImpl=o},function(r,n,i){var o=this&&this.__values||function(d){var u=typeof Symbol=="function"&&Symbol.iterator,f=u&&d[u],h=0;if(f)return f.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&h>=d.length&&(d=void 0),{value:d&&d[h++],done:!d}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(7),l=(function(){function d(u){this._nodeList=[],this._recordQueue=[],this._callback=u;var f=a.dom.window;c.set.append(f._mutationObservers,this)}return d.prototype.observe=function(u,f){var h,g;if((f=f||{childList:!1,subtree:!1}).attributeOldValue===void 0&&f.attributeFilter===void 0||f.attributes!==void 0||(f.attributes=!0),f.characterDataOldValue!==void 0&&f.characterData===void 0&&(f.characterData=!0),!f.childList&&!f.attributes&&!f.characterData)throw new TypeError;if(f.attributeOldValue&&!f.attributes)throw new TypeError;if(f.attributeFilter!==void 0&&!f.attributes)throw new TypeError;if(f.characterDataOldValue&&!f.characterData)throw new TypeError;var p=!1,v=f,w=function(x){var S,T;if(x.observer===m){p=!0;try{for(var _=(S=void 0,o(m._nodeList)),E=_.next();!E.done;E=_.next()){var D=E.value;c.list.remove(D._registeredObserverList,(function(b){return s.Guard.isTransientRegisteredObserver(b)&&b.source===x}))}}catch(b){S={error:b}}finally{try{E&&!E.done&&(T=_.return)&&T.call(_)}finally{if(S)throw S.error}}x.options=v}},m=this;try{for(var y=o(u._registeredObserverList),C=y.next();!C.done;C=y.next())w(C.value)}catch(x){h={error:x}}finally{try{C&&!C.done&&(g=y.return)&&g.call(y)}finally{if(h)throw h.error}}p||(u._registeredObserverList.push({observer:this,options:f}),this._nodeList.push(u))},d.prototype.disconnect=function(){var u,f,h=this;try{for(var g=o(this._nodeList),p=g.next();!p.done;p=g.next()){var v=p.value;c.list.remove(v._registeredObserverList,(function(w){return w.observer===h}))}}catch(w){u={error:w}}finally{try{p&&!p.done&&(f=g.return)&&f.call(g)}finally{if(u)throw u.error}}this._recordQueue=[]},d.prototype.takeRecords=function(){var u=this._recordQueue;return this._recordQueue=[],u},d})();n.MutationObserverImpl=l},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=(function(){function s(){}return Object.defineProperty(s.prototype,"previousElementSibling",{get:function(){for(var c=o.Cast.asNode(this)._previousSibling;c;){if(o.Guard.isElementNode(c))return c;c=c._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"nextElementSibling",{get:function(){for(var c=o.Cast.asNode(this)._nextSibling;c;){if(o.Guard.isElementNode(c))return c;c=c._nextSibling}return null},enumerable:!0,configurable:!0}),s})();n.NonDocumentTypeChildNodeImpl=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=i(0),s=(function(){function c(){}return c.prototype.getElementById=function(l){for(var d=a.tree_getFirstDescendantNode(o.Cast.asNode(this),!1,!1,(function(u){return o.Guard.isElementNode(u)}));d!==null;){if(d._uniqueIdentifier===l)return d;d=a.tree_getNextDescendantNode(o.Cast.asNode(this),d,!1,!1,(function(u){return o.Guard.isElementNode(u)}))}return null},c})();n.NonElementParentNodeImpl=s},function(r,n,i){var o=this&&this.__values||function(l){var d=typeof Symbol=="function"&&Symbol.iterator,u=d&&l[d],f=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&f>=l.length&&(l=void 0),{value:l&&l[f++],done:!l}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(3),s=i(0),c=(function(){function l(){}return Object.defineProperty(l.prototype,"children",{get:function(){return s.create_htmlCollection(a.Cast.asNode(this))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"firstElementChild",{get:function(){for(var d=a.Cast.asNode(this)._firstChild;d;){if(a.Guard.isElementNode(d))return d;d=d._nextSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"lastElementChild",{get:function(){for(var d=a.Cast.asNode(this)._lastChild;d;){if(a.Guard.isElementNode(d))return d;d=d._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"childElementCount",{get:function(){var d,u,f=0;try{for(var h=o(a.Cast.asNode(this)._children),g=h.next();!g.done;g=h.next()){var p=g.value;a.Guard.isElementNode(p)&&f++}}catch(v){d={error:v}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}return f},enumerable:!0,configurable:!0}),l.prototype.prepend=function(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];var f=a.Cast.asNode(this),h=s.parentNode_convertNodesIntoANode(d,f._nodeDocument);s.mutation_preInsert(h,f,f._firstChild)},l.prototype.append=function(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];var f=a.Cast.asNode(this),h=s.parentNode_convertNodesIntoANode(d,f._nodeDocument);s.mutation_append(h,f)},l.prototype.querySelector=function(d){var u=a.Cast.asNode(this),f=s.selectors_scopeMatchASelectorsString(d,u);return f.length===0?null:f[0]},l.prototype.querySelectorAll=function(d){var u=a.Cast.asNode(this),f=s.selectors_scopeMatchASelectorsString(d,u);return s.create_nodeListStatic(u,f)},l})();n.ParentNodeImpl=c},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=(function(){function s(){}return Object.defineProperty(s.prototype,"_name",{get:function(){return this.__name||""},set:function(c){this.__name=c},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_assignedSlot",{get:function(){return this.__assignedSlot||null},set:function(c){this.__assignedSlot=c},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"assignedSlot",{get:function(){return o.shadowTree_findASlot(this,!0)},enumerable:!0,configurable:!0}),s})();n.SlotableImpl=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(102),c=i(9),l=i(3),d=(function(u){function f(h){var g=u.call(this)||this;if(l.Guard.isDocumentTypeNode(h.startContainer)||l.Guard.isAttrNode(h.startContainer)||l.Guard.isDocumentTypeNode(h.endContainer)||l.Guard.isAttrNode(h.endContainer))throw new c.InvalidNodeTypeError;return g._start=[h.startContainer,h.startOffset],g._end=[h.endContainer,h.endOffset],g}return a(f,u),f})(s.AbstractRangeImpl);n.StaticRangeImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(272);n.DOMParser=o.DOMParserImpl},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=i(273),s=(function(){function c(){}return c.prototype.parseFromString=function(l,d){if(d==="text/html")throw new Error("HTML parser not implemented.");try{return(u=new a.XMLParserImpl().parse(l))._contentType=d,u}catch(p){var u,f="http://www.mozilla.org/newlayout/xml/parsererror.xml",h=(u=o.create_xmlDocument()).createElementNS(f,"parsererror"),g=u.createElementNS(f,"error");return g.setAttribute("message",p.message),h.appendChild(g),u.appendChild(h),u}},c})();n.DOMParserImpl=s},function(r,n,i){var o=this&&this.__read||function(h,g){var p=typeof Symbol=="function"&&h[Symbol.iterator];if(!p)return h;var v,w,m=p.call(h),y=[];try{for(;(g===void 0||g-- >0)&&!(v=m.next()).done;)y.push(v.value)}catch(C){w={error:C}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(w)throw w.error}}return y},a=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(180),c=i(111),l=i(7),d=i(0),u=i(69),f=(function(){function h(){}return h.prototype.parse=function(g){for(var p,v,w,m,y=new s.XMLStringLexer(g,{skipWhitespaceOnlyText:!0}),C=d.create_document(),x=C,S=y.nextToken();S.type!==c.TokenType.EOF;){switch(S.type){case c.TokenType.Declaration:var T=S;if(T.version!=="1.0")throw new Error("Invalid xml version: "+T.version);break;case c.TokenType.DocType:var _=S;if(!d.xml_isPubidChar(_.pubId))throw new Error("DocType public identifier does not match PubidChar construct.");if(!d.xml_isLegalChar(_.sysId)||_.sysId.indexOf('"')!==-1&&_.sysId.indexOf("'")!==-1)throw new Error("DocType system identifier contains invalid characters.");x.appendChild(C.implementation.createDocumentType(_.name,_.pubId,_.sysId));break;case c.TokenType.CDATA:var E=S;if(!d.xml_isLegalChar(E.data)||E.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters.");x.appendChild(C.createCDATASection(E.data));break;case c.TokenType.Comment:var D=S;if(!d.xml_isLegalChar(D.data)||D.data.indexOf("--")!==-1||D.data.endsWith("-"))throw new Error("Comment data contains invalid characters.");x.appendChild(C.createComment(D.data));break;case c.TokenType.PI:var b=S;if(b.target.indexOf(":")!==-1||/^xml$/i.test(b.target))throw new Error("Processing instruction target contains invalid characters.");if(!d.xml_isLegalChar(b.data)||b.data.indexOf("?>")!==-1)throw new Error("Processing instruction data contains invalid characters.");x.appendChild(C.createProcessingInstruction(b.target,b.data));break;case c.TokenType.Text:var I=S;if(!d.xml_isLegalChar(I.data))throw new Error("Text data contains invalid characters.");x.appendChild(C.createTextNode(this._decodeText(I.data)));break;case c.TokenType.Element:var O=S,M=o(d.namespace_extractQName(O.name),2),R=M[0],A=M[1];if(A.indexOf(":")!==-1||!d.xml_isName(A))throw new Error("Node local name contains invalid characters.");if(R==="xmlns")throw new Error("An element cannot have the 'xmlns' prefix.");var G=x.lookupNamespaceURI(R),k={};try{for(var L=(p=void 0,a(O.attributes)),F=L.next();!F.done;F=L.next()){var j=o(F.value,2),Y=j[0],ie=j[1];if(Y==="xmlns")G=ie;else{var de=o(d.namespace_extractQName(Y),2),ae=de[0],fe=de[1];ae==="xmlns"&&(fe===R&&(G=ie),k[fe]=ie)}}}catch(K){p={error:K}}finally{try{F&&!F.done&&(v=L.return)&&v.call(L)}finally{if(p)throw p.error}}var we=G!==null?C.createElementNS(G,O.name):C.createElement(O.name);x.appendChild(we);var _e=new u.LocalNameSet;try{for(var Se=(w=void 0,a(O.attributes)),B=Se.next();!B.done;B=Se.next()){var P=o(B.value,2),$=(Y=P[0],ie=P[1],o(d.namespace_extractQName(Y),2)),W=(ae=$[0],fe=$[1],null);if(ae==="xmlns"||ae===null&&fe==="xmlns"?W=l.namespace.XMLNS:(W=we.lookupNamespaceURI(ae))!==null&&we.isDefaultNamespace(W)?W=null:W===null&&ae!==null&&(W=k[ae]||null),_e.has(W,fe))throw new Error("Element contains duplicate attributes.");if(_e.set(W,fe),W===l.namespace.XMLNS&&ie===l.namespace.XMLNS)throw new Error("XMLNS namespace is reserved.");if(fe.indexOf(":")!==-1||!d.xml_isName(fe))throw new Error("Attribute local name contains invalid characters.");if(ae==="xmlns"&&ie==="")throw new Error("Empty XML namespace is not allowed.");W!==null?we.setAttributeNS(W,Y,this._decodeAttributeValue(ie)):we.setAttribute(Y,this._decodeAttributeValue(ie))}}catch(K){w={error:K}}finally{try{B&&!B.done&&(m=Se.return)&&m.call(Se)}finally{if(w)throw w.error}}O.selfClosing||(x=we);break;case c.TokenType.ClosingTag:if(S.name!==x.nodeName)throw new Error("Closing tag name does not match opening tag name.");x._parent&&(x=x._parent)}S=y.nextToken()}return C},h.prototype._decodeText=function(g){return g==null?g:g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},h.prototype._decodeAttributeValue=function(g){return g==null?g:g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},h})();n.XMLParserImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(275);n.XMLSerializer=o.XMLSerializerImpl},function(r,n,i){var o=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(2),s=i(69),c=i(95),l=i(9),d=i(7),u=i(0),f=(function(){function h(){}return h.prototype.serializeToString=function(g){return this._xmlSerialization(g,!1)},h.prototype._xmlSerialization=function(g,p){if(g._nodeDocument===void 0||g._nodeDocument._hasNamespaces){var v=new c.NamespacePrefixMap;v.set("xml",d.namespace.XML);try{return this._serializeNodeNS(g,null,v,{value:1},p)}catch{throw new l.InvalidStateError}}else try{return this._serializeNode(g,p)}catch{throw new l.InvalidStateError}},h.prototype._serializeNodeNS=function(g,p,v,w,m){switch(g.nodeType){case a.NodeType.Element:return this._serializeElementNS(g,p,v,w,m);case a.NodeType.Document:return this._serializeDocumentNS(g,p,v,w,m);case a.NodeType.Comment:return this._serializeComment(g,m);case a.NodeType.Text:return this._serializeText(g,m);case a.NodeType.DocumentFragment:return this._serializeDocumentFragmentNS(g,p,v,w,m);case a.NodeType.DocumentType:return this._serializeDocumentType(g,m);case a.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(g,m);case a.NodeType.CData:return this._serializeCData(g,m);default:throw new Error("Unknown node type: "+g.nodeType)}},h.prototype._serializeNode=function(g,p){switch(g.nodeType){case a.NodeType.Element:return this._serializeElement(g,p);case a.NodeType.Document:return this._serializeDocument(g,p);case a.NodeType.Comment:return this._serializeComment(g,p);case a.NodeType.Text:return this._serializeText(g,p);case a.NodeType.DocumentFragment:return this._serializeDocumentFragment(g,p);case a.NodeType.DocumentType:return this._serializeDocumentType(g,p);case a.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(g,p);case a.NodeType.CData:return this._serializeCData(g,p);default:throw new Error("Unknown node type: "+g.nodeType)}},h.prototype._serializeElementNS=function(g,p,v,w,m){var y,C;if(m&&(g.localName.indexOf(":")!==-1||!u.xml_isName(g.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var x="<",S="",T=!1,_=!1,E=v.copy(),D={},b=this._recordNamespaceInformation(g,E,D),I=p,O=g.namespaceURI;if(I===O)b!==null&&(_=!0),x+=S=O===d.namespace.XML?"xml:"+g.localName:g.localName;else{var M=g.prefix,R=null;if(M===null&&O===b||(R=E.get(M,O)),M==="xmlns"){if(m)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");R=M}R!==null?(S=R+":"+g.localName,b!==null&&b!==d.namespace.XML&&(I=b||null),x+=S):M!==null?(M in D&&(M=this._generatePrefix(O,E,w)),E.set(M,O),x+=S+=M+":"+g.localName,x+=" xmlns:"+M+'="'+this._serializeAttributeValue(O,m)+'"',b!==null&&(I=b||null)):b===null||b!==null&&b!==O?(_=!0,I=O,x+=S+=g.localName,x+=' xmlns="'+this._serializeAttributeValue(O,m)+'"'):(I=O,x+=S+=g.localName)}x+=this._serializeAttributesNS(g,E,w,D,_,m);var A=O===d.namespace.HTML;if(A&&g.childNodes.length===0&&h._VoidElementNames.has(g.localName)?(x+=" /",T=!0):A||g.childNodes.length!==0||(x+="/",T=!0),x+=">",T)return x;if(!(A&&g.localName==="template"))try{for(var G=o(g._children||g.childNodes),k=G.next();!k.done;k=G.next()){var L=k.value;x+=this._serializeNodeNS(L,I,E,w,m)}}catch(F){y={error:F}}finally{try{k&&!k.done&&(C=G.return)&&C.call(G)}finally{if(y)throw y.error}}return x+="</"+S+">"},h.prototype._serializeDocumentNS=function(g,p,v,w,m){var y,C;if(m&&g.documentElement===null)throw new Error("Missing document element (well-formed required).");var x="";try{for(var S=o(g._children||g.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;x+=this._serializeNodeNS(_,p,v,w,m)}}catch(E){y={error:E}}finally{try{T&&!T.done&&(C=S.return)&&C.call(S)}finally{if(y)throw y.error}}return x},h.prototype._serializeComment=function(g,p){if(p&&(!u.xml_isLegalChar(g.data)||g.data.indexOf("--")!==-1||g.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");return"<!--"+g.data+"-->"},h.prototype._serializeText=function(g,p){if(p&&!u.xml_isLegalChar(g.data))throw new Error("Text data contains invalid characters (well-formed required).");for(var v="",w=0;w<g.data.length;w++){var m=g.data[w];v+=m==="&"?"&amp;":m==="<"?"&lt;":m===">"?"&gt;":m}return v},h.prototype._serializeDocumentFragmentNS=function(g,p,v,w,m){var y,C,x="";try{for(var S=o(g._children||g.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;x+=this._serializeNodeNS(_,p,v,w,m)}}catch(E){y={error:E}}finally{try{T&&!T.done&&(C=S.return)&&C.call(S)}finally{if(y)throw y.error}}return x},h.prototype._serializeDocumentType=function(g,p){if(p&&!u.xml_isPubidChar(g.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(p&&(!u.xml_isLegalChar(g.systemId)||g.systemId.indexOf('"')!==-1&&g.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");return g.publicId&&g.systemId?"<!DOCTYPE "+g.name+' PUBLIC "'+g.publicId+'" "'+g.systemId+'">':g.publicId?"<!DOCTYPE "+g.name+' PUBLIC "'+g.publicId+'">':g.systemId?"<!DOCTYPE "+g.name+' SYSTEM "'+g.systemId+'">':"<!DOCTYPE "+g.name+">"},h.prototype._serializeProcessingInstruction=function(g,p){if(p&&(g.target.indexOf(":")!==-1||/^xml$/i.test(g.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(p&&(!u.xml_isLegalChar(g.data)||g.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");return"<?"+(g.data===""?g.target:g.target+" "+g.data)+"?>"},h.prototype._serializeCData=function(g,p){if(p&&g.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");return"<![CDATA["+g.data+"]]>"},h.prototype._serializeAttributesNS=function(g,p,v,w,m,y){var C,x,S="",T=y?new s.LocalNameSet:void 0;try{for(var _=o(g.attributes),E=_.next();!E.done;E=_.next()){var D=E.value;if(m||y||D.namespaceURI!==null){if(y&&T&&T.has(D.namespaceURI,D.localName))throw new Error("Element contains duplicate attributes (well-formed required).");y&&T&&T.set(D.namespaceURI,D.localName);var b=D.namespaceURI,I=null;if(b!==null)if(I=p.get(D.prefix,b),b===d.namespace.XMLNS){if(D.value===d.namespace.XML||D.prefix===null&&m||D.prefix!==null&&(!(D.localName in w)||w[D.localName]!==D.value)&&p.has(D.localName,D.value))continue;if(y&&D.value===d.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(y&&D.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");D.prefix==="xmlns"&&(I="xmlns")}else I===null&&(S+=" xmlns:"+(I=D.prefix===null||p.hasPrefix(D.prefix)&&!p.has(D.prefix,b)?this._generatePrefix(b,p,v):D.prefix)+'="'+this._serializeAttributeValue(b,y)+'"');if(S+=" ",I!==null&&(S+=I+":"),y&&(D.localName.indexOf(":")!==-1||!u.xml_isName(D.localName)||D.localName==="xmlns"&&b===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");S+=D.localName+'="'+this._serializeAttributeValue(D.value,y)+'"'}else S+=" "+D.localName+'="'+this._serializeAttributeValue(D.value,y)+'"'}}catch(O){C={error:O}}finally{try{E&&!E.done&&(x=_.return)&&x.call(_)}finally{if(C)throw C.error}}return S},h.prototype._recordNamespaceInformation=function(g,p,v){var w,m,y=null;try{for(var C=o(g.attributes),x=C.next();!x.done;x=C.next()){var S=x.value,T=S.namespaceURI,_=S.prefix;if(T===d.namespace.XMLNS){if(_===null){y=S.value;continue}var E=S.localName,D=S.value;if(D===d.namespace.XML||(D===""&&(D=null),p.has(E,D)))continue;p.set(E,D),v[E]=D||""}}}catch(b){w={error:b}}finally{try{x&&!x.done&&(m=C.return)&&m.call(C)}finally{if(w)throw w.error}}return y},h.prototype._generatePrefix=function(g,p,v){var w="ns"+v.value;return v.value++,p.set(w,g),w},h.prototype._serializeAttributeValue=function(g,p){if(p&&g!==null&&!u.xml_isLegalChar(g))throw new Error("Invalid characters in attribute value.");if(g===null)return"";for(var v="",w=0;w<g.length;w++){var m=g[w];v+=m==='"'?"&quot;":m==="&"?"&amp;":m==="<"?"&lt;":m===">"?"&gt;":m}return v},h.prototype._serializeElement=function(g,p){var v,w;if(p&&(g.localName.indexOf(":")!==-1||!u.xml_isName(g.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var m=!1,y=g.localName,C="<"+y;if(C+=this._serializeAttributes(g,p),g._children.size===0&&(C+="/",m=!0),C+=">",m)return C;try{for(var x=o(g._children),S=x.next();!S.done;S=x.next()){var T=S.value;C+=this._serializeNode(T,p)}}catch(_){v={error:_}}finally{try{S&&!S.done&&(w=x.return)&&w.call(x)}finally{if(v)throw v.error}}return C+="</"+y+">"},h.prototype._serializeDocument=function(g,p){var v,w;if(p&&g.documentElement===null)throw new Error("Missing document element (well-formed required).");var m="";try{for(var y=o(g._children),C=y.next();!C.done;C=y.next()){var x=C.value;m+=this._serializeNode(x,p)}}catch(S){v={error:S}}finally{try{C&&!C.done&&(w=y.return)&&w.call(y)}finally{if(v)throw v.error}}return m},h.prototype._serializeDocumentFragment=function(g,p){var v,w,m="";try{for(var y=o(g._children),C=y.next();!C.done;C=y.next()){var x=C.value;m+=this._serializeNode(x,p)}}catch(S){v={error:S}}finally{try{C&&!C.done&&(w=y.return)&&w.call(y)}finally{if(v)throw v.error}}return m},h.prototype._serializeAttributes=function(g,p){var v,w,m="",y=p?{}:void 0;try{for(var C=o(g.attributes),x=C.next();!x.done;x=C.next()){var S=x.value;if(p&&y&&S.localName in y)throw new Error("Element contains duplicate attributes (well-formed required).");if(p&&y&&(y[S.localName]=!0),p&&(S.localName.indexOf(":")!==-1||!u.xml_isName(S.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");m+=" "+S.localName+'="'+this._serializeAttributeValue(S.value,p)+'"'}}catch(T){v={error:T}}finally{try{x&&!x.done&&(w=C.return)&&w.call(C)}finally{if(v)throw v.error}}return m},h._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),h})();n.XMLSerializerImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(277);n.XMLReader=o.XMLReader;var a=i(112);n.ObjectReader=a.ObjectReader;var s=i(280);n.JSONReader=s.JSONReader;var c=i(281);n.YAMLReader=c.YAMLReader},function(r,n,i){i(31),i(32),i(33),i(19),i(65),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(g,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,w){v.__proto__=w}||function(v,w){for(var m in w)w.hasOwnProperty(m)&&(v[m]=w[m])})(g,p)},function(g,p){function v(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(v.prototype=p.prototype,new v)}),s=this&&this.__read||function(g,p){var v=typeof Symbol=="function"&&g[Symbol.iterator];if(!v)return g;var w,m,y=v.call(g),C=[];try{for(;(p===void 0||p-- >0)&&!(w=y.next()).done;)C.push(w.value)}catch(x){m={error:x}}finally{try{w&&!w.done&&(v=y.return)&&v.call(y)}finally{if(m)throw m.error}}return C},c=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,v=p&&g[p],w=0;if(v)return v.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var l=i(180),d=i(111),u=i(7),f=i(0),h=(function(g){function p(){return g!==null&&g.apply(this,arguments)||this}return a(p,g),p.prototype._parse=function(v,w){for(var m,y,C,x,S=new l.XMLStringLexer(w,{skipWhitespaceOnlyText:!0}),T=v,_=v,E=S.nextToken();E.type!==d.TokenType.EOF;){switch(E.type){case d.TokenType.Declaration:var D=E,b=this.sanitize(D.version);if(b!=="1.0")throw new Error("Invalid xml version: "+b);var I={version:b};D.encoding&&(I.encoding=this.sanitize(D.encoding)),D.standalone&&(I.standalone=this.sanitize(D.standalone)==="yes"),_.set(I);break;case d.TokenType.DocType:var O=E;_=this.docType(_,this.sanitize(O.name),this.sanitize(O.pubId),this.sanitize(O.sysId))||_;break;case d.TokenType.CDATA:var M=E;_=this.cdata(_,this.sanitize(M.data))||_;break;case d.TokenType.Comment:var R=E;_=this.comment(_,this.sanitize(R.data))||_;break;case d.TokenType.PI:var A=E;_=this.instruction(_,this.sanitize(A.target),this.sanitize(A.data))||_;break;case d.TokenType.Text:var G=E;_=this.text(_,this._decodeText(this.sanitize(G.data)))||_;break;case d.TokenType.Element:var k=E,L=this.sanitize(k.name),F=s(f.namespace_extractQName(L),1)[0],j=_.node.lookupNamespaceURI(F),Y={};try{for(var ie=(m=void 0,c(k.attributes)),de=ie.next();!de.done;de=ie.next()){var ae=s(de.value,2),fe=ae[0],we=ae[1];if(fe=this.sanitize(fe),we=this.sanitize(we),fe==="xmlns")j=we;else{var _e=s(f.namespace_extractQName(fe),2),Se=_e[0],B=_e[1];Se==="xmlns"&&(B===F&&(j=we),Y[B]=we)}}}catch(ge){m={error:ge}}finally{try{de&&!de.done&&(y=ie.return)&&y.call(ie)}finally{if(m)throw m.error}}var P=j!==null?this.element(_,j,L):this.element(_,void 0,L);if(P===void 0)break;_.node===v.node&&(T=P);try{for(var $=(C=void 0,c(k.attributes)),W=$.next();!W.done;W=$.next()){var K=s(W.value,2);fe=K[0],we=K[1],fe=this.sanitize(fe),we=this.sanitize(we);var Q=s(f.namespace_extractQName(fe),2),ee=(Se=Q[0],B=Q[1],null);Se==="xmlns"||Se===null&&B==="xmlns"?ee=u.namespace.XMLNS:(ee=P.node.lookupNamespaceURI(Se))!==null&&P.node.isDefaultNamespace(ee)?ee=null:ee===null&&Se!==null&&(ee=Y[Se]||null),ee!==null?this.attribute(P,ee,fe,this._decodeAttributeValue(we)):this.attribute(P,void 0,fe,this._decodeAttributeValue(we))}}catch(ge){C={error:ge}}finally{try{W&&!W.done&&(x=$.return)&&x.call($)}finally{if(C)throw C.error}}k.selfClosing||(_=P);break;case d.TokenType.ClosingTag:_.node.parentNode&&(_=_.up())}E=S.nextToken()}return T},p})(i(75).BaseReader);n.XMLReader=h},function(r,n,i){var o=i(4),a=i(279);o({target:"Object",stat:!0,forced:Object.assign!==a},{assign:a})},function(r,n,i){var o=i(16),a=i(8),s=i(61),c=i(85),l=i(79),d=i(27),u=i(41),f=Object.assign,h=Object.defineProperty;r.exports=!f||a((function(){if(o&&f({b:1},f(h({},"a",{enumerable:!0,get:function(){h(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var g={},p={},v=Symbol();return g[v]=7,"abcdefghijklmnopqrst".split("").forEach((function(w){p[w]=w})),f({},g)[v]!=7||s(f({},p)).join("")!="abcdefghijklmnopqrst"}))?function(g,p){for(var v=d(g),w=arguments.length,m=1,y=c.f,C=l.f;w>m;)for(var x,S=u(arguments[m++]),T=y?s(S).concat(y(S)):s(S),_=T.length,E=0;_>E;)x=T[E++],o&&!C.call(S,x)||(v[x]=S[x]);return v}:f},function(r,n,i){var o,a=this&&this.__extends||(o=function(l,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)f.hasOwnProperty(h)&&(u[h]=f[h])})(l,d)},function(l,d){function u(){this.constructor=l}o(l,d),l.prototype=d===null?Object.create(d):(u.prototype=d.prototype,new u)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(112),c=(function(l){function d(){return l!==null&&l.apply(this,arguments)||this}return a(d,l),d.prototype._parse=function(u,f){return new s.ObjectReader(this._builderOptions).parse(u,JSON.parse(f))},d})(i(75).BaseReader);n.JSONReader=c},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,f)},function(u,f){function h(){this.constructor=u}o(u,f),u.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(112),c=i(75),l=i(282),d=(function(u){function f(){return u!==null&&u.apply(this,arguments)||this}return a(f,u),f.prototype._parse=function(h,g){var p=l.safeLoad(g);if(p===void 0)throw new Error("Unable to parse YAML document.");return new s.ObjectReader(this._builderOptions).parse(h,p)},f})(c.BaseReader);n.YAMLReader=d},function(r,n,i){var o=i(283);r.exports=o},function(r,n,i){var o=i(284),a=i(303);function s(c){return function(){throw new Error("Function "+c+" is deprecated and cannot be used.")}}r.exports.Type=i(10),r.exports.Schema=i(39),r.exports.FAILSAFE_SCHEMA=i(113),r.exports.JSON_SCHEMA=i(182),r.exports.CORE_SCHEMA=i(181),r.exports.DEFAULT_SAFE_SCHEMA=i(54),r.exports.DEFAULT_FULL_SCHEMA=i(76),r.exports.load=o.load,r.exports.loadAll=o.loadAll,r.exports.safeLoad=o.safeLoad,r.exports.safeLoadAll=o.safeLoadAll,r.exports.dump=a.dump,r.exports.safeDump=a.safeDump,r.exports.YAMLException=i(53),r.exports.MINIMAL_SCHEMA=i(113),r.exports.SAFE_SCHEMA=i(54),r.exports.DEFAULT_SCHEMA=i(76),r.exports.scan=s("scan"),r.exports.parse=s("parse"),r.exports.compose=s("compose"),r.exports.addConstructor=s("addConstructor")},function(r,n,i){var o=i(38),a=i(53),s=i(285),c=i(54),l=i(76),d=Object.prototype.hasOwnProperty,u=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,f=/[\x85\u2028\u2029]/,h=/[,\[\]\{\}]/,g=/^(?:!|!!|![a-z\-]+!)$/i,p=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function v(P){return Object.prototype.toString.call(P)}function w(P){return P===10||P===13}function m(P){return P===9||P===32}function y(P){return P===9||P===32||P===10||P===13}function C(P){return P===44||P===91||P===93||P===123||P===125}function x(P){var $;return 48<=P&&P<=57?P-48:97<=($=32|P)&&$<=102?$-97+10:-1}function S(P){return P===48?"\0":P===97?"\x07":P===98?"\b":P===116||P===9?"	":P===110?`
`:P===118?"\v":P===102?"\f":P===114?"\r":P===101?"\x1B":P===32?" ":P===34?'"':P===47?"/":P===92?"\\":P===78?"":P===95?"":P===76?"\u2028":P===80?"\u2029":""}function T(P){return P<=65535?String.fromCharCode(P):String.fromCharCode(55296+(P-65536>>10),56320+(P-65536&1023))}for(var _=new Array(256),E=new Array(256),D=0;D<256;D++)_[D]=S(D)?1:0,E[D]=S(D);function b(P,$){this.input=P,this.filename=$.filename||null,this.schema=$.schema||l,this.onWarning=$.onWarning||null,this.legacy=$.legacy||!1,this.json=$.json||!1,this.listener=$.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=P.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function I(P,$){return new a($,new s(P.filename,P.input,P.position,P.line,P.position-P.lineStart))}function O(P,$){throw I(P,$)}function M(P,$){P.onWarning&&P.onWarning.call(null,I(P,$))}var R={YAML:function(P,$,W){var K,Q,ee;P.version!==null&&O(P,"duplication of %YAML directive"),W.length!==1&&O(P,"YAML directive accepts exactly one argument"),(K=/^([0-9]+)\.([0-9]+)$/.exec(W[0]))===null&&O(P,"ill-formed argument of the YAML directive"),Q=parseInt(K[1],10),ee=parseInt(K[2],10),Q!==1&&O(P,"unacceptable YAML version of the document"),P.version=W[0],P.checkLineBreaks=ee<2,ee!==1&&ee!==2&&M(P,"unsupported YAML version of the document")},TAG:function(P,$,W){var K,Q;W.length!==2&&O(P,"TAG directive accepts exactly two arguments"),K=W[0],Q=W[1],g.test(K)||O(P,"ill-formed tag handle (first argument) of the TAG directive"),d.call(P.tagMap,K)&&O(P,'there is a previously declared suffix for "'+K+'" tag handle'),p.test(Q)||O(P,"ill-formed tag prefix (second argument) of the TAG directive"),P.tagMap[K]=Q}};function A(P,$,W,K){var Q,ee,ge,De;if($<W){if(De=P.input.slice($,W),K)for(Q=0,ee=De.length;Q<ee;Q+=1)(ge=De.charCodeAt(Q))===9||32<=ge&&ge<=1114111||O(P,"expected valid JSON character");else u.test(De)&&O(P,"the stream contains non-printable characters");P.result+=De}}function G(P,$,W,K){var Q,ee,ge,De;for(o.isObject(W)||O(P,"cannot merge mappings; the provided source object is unacceptable"),ge=0,De=(Q=Object.keys(W)).length;ge<De;ge+=1)ee=Q[ge],d.call($,ee)||($[ee]=W[ee],K[ee]=!0)}function k(P,$,W,K,Q,ee,ge,De){var Le,Ge;if(Array.isArray(Q))for(Le=0,Ge=(Q=Array.prototype.slice.call(Q)).length;Le<Ge;Le+=1)Array.isArray(Q[Le])&&O(P,"nested arrays are not supported inside keys"),typeof Q=="object"&&v(Q[Le])==="[object Object]"&&(Q[Le]="[object Object]");if(typeof Q=="object"&&v(Q)==="[object Object]"&&(Q="[object Object]"),Q=String(Q),$===null&&($={}),K==="tag:yaml.org,2002:merge")if(Array.isArray(ee))for(Le=0,Ge=ee.length;Le<Ge;Le+=1)G(P,$,ee[Le],W);else G(P,$,ee,W);else P.json||d.call(W,Q)||!d.call($,Q)||(P.line=ge||P.line,P.position=De||P.position,O(P,"duplicated mapping key")),$[Q]=ee,delete W[Q];return $}function L(P){var $;($=P.input.charCodeAt(P.position))===10?P.position++:$===13?(P.position++,P.input.charCodeAt(P.position)===10&&P.position++):O(P,"a line break is expected"),P.line+=1,P.lineStart=P.position}function F(P,$,W){for(var K=0,Q=P.input.charCodeAt(P.position);Q!==0;){for(;m(Q);)Q=P.input.charCodeAt(++P.position);if($&&Q===35)do Q=P.input.charCodeAt(++P.position);while(Q!==10&&Q!==13&&Q!==0);if(!w(Q))break;for(L(P),Q=P.input.charCodeAt(P.position),K++,P.lineIndent=0;Q===32;)P.lineIndent++,Q=P.input.charCodeAt(++P.position)}return W!==-1&&K!==0&&P.lineIndent<W&&M(P,"deficient indentation"),K}function j(P){var $,W=P.position;return!(($=P.input.charCodeAt(W))!==45&&$!==46||$!==P.input.charCodeAt(W+1)||$!==P.input.charCodeAt(W+2)||(W+=3,($=P.input.charCodeAt(W))!==0&&!y($)))}function Y(P,$){$===1?P.result+=" ":$>1&&(P.result+=o.repeat(`
`,$-1))}function ie(P,$){var W,K,Q=P.tag,ee=P.anchor,ge=[],De=!1;for(P.anchor!==null&&(P.anchorMap[P.anchor]=ge),K=P.input.charCodeAt(P.position);K!==0&&K===45&&y(P.input.charCodeAt(P.position+1));)if(De=!0,P.position++,F(P,!0,-1)&&P.lineIndent<=$)ge.push(null),K=P.input.charCodeAt(P.position);else if(W=P.line,fe(P,$,3,!1,!0),ge.push(P.result),F(P,!0,-1),K=P.input.charCodeAt(P.position),(P.line===W||P.lineIndent>$)&&K!==0)O(P,"bad indentation of a sequence entry");else if(P.lineIndent<$)break;return!!De&&(P.tag=Q,P.anchor=ee,P.kind="sequence",P.result=ge,!0)}function de(P){var $,W,K,Q,ee=!1,ge=!1;if((Q=P.input.charCodeAt(P.position))!==33)return!1;if(P.tag!==null&&O(P,"duplication of a tag property"),(Q=P.input.charCodeAt(++P.position))===60?(ee=!0,Q=P.input.charCodeAt(++P.position)):Q===33?(ge=!0,W="!!",Q=P.input.charCodeAt(++P.position)):W="!",$=P.position,ee){do Q=P.input.charCodeAt(++P.position);while(Q!==0&&Q!==62);P.position<P.length?(K=P.input.slice($,P.position),Q=P.input.charCodeAt(++P.position)):O(P,"unexpected end of the stream within a verbatim tag")}else{for(;Q!==0&&!y(Q);)Q===33&&(ge?O(P,"tag suffix cannot contain exclamation marks"):(W=P.input.slice($-1,P.position+1),g.test(W)||O(P,"named tag handle cannot contain such characters"),ge=!0,$=P.position+1)),Q=P.input.charCodeAt(++P.position);K=P.input.slice($,P.position),h.test(K)&&O(P,"tag suffix cannot contain flow indicator characters")}return K&&!p.test(K)&&O(P,"tag name cannot contain such characters: "+K),ee?P.tag=K:d.call(P.tagMap,W)?P.tag=P.tagMap[W]+K:W==="!"?P.tag="!"+K:W==="!!"?P.tag="tag:yaml.org,2002:"+K:O(P,'undeclared tag handle "'+W+'"'),!0}function ae(P){var $,W;if((W=P.input.charCodeAt(P.position))!==38)return!1;for(P.anchor!==null&&O(P,"duplication of an anchor property"),W=P.input.charCodeAt(++P.position),$=P.position;W!==0&&!y(W)&&!C(W);)W=P.input.charCodeAt(++P.position);return P.position===$&&O(P,"name of an anchor node must contain at least one character"),P.anchor=P.input.slice($,P.position),!0}function fe(P,$,W,K,Q){var ee,ge,De,Le,Ge,re,se,ve,le=1,pe=!1,We=!1;if(P.listener!==null&&P.listener("open",P),P.tag=null,P.anchor=null,P.kind=null,P.result=null,ee=ge=De=W===4||W===3,K&&F(P,!0,-1)&&(pe=!0,P.lineIndent>$?le=1:P.lineIndent===$?le=0:P.lineIndent<$&&(le=-1)),le===1)for(;de(P)||ae(P);)F(P,!0,-1)?(pe=!0,De=ee,P.lineIndent>$?le=1:P.lineIndent===$?le=0:P.lineIndent<$&&(le=-1)):De=!1;if(De&&(De=pe||Q),le!==1&&W!==4||(se=W===1||W===2?$:$+1,ve=P.position-P.lineStart,le===1?De&&(ie(P,ve)||(function(oe,st,gt){var ct,Ee,ze,Ke,Je,lt=oe.tag,Oe=oe.anchor,ke={},nt={},wt=null,gn=null,Sn=null,ln=!1,on=!1;for(oe.anchor!==null&&(oe.anchorMap[oe.anchor]=ke),Je=oe.input.charCodeAt(oe.position);Je!==0;){if(ct=oe.input.charCodeAt(oe.position+1),ze=oe.line,Ke=oe.position,Je!==63&&Je!==58||!y(ct)){if(!fe(oe,gt,2,!1,!0))break;if(oe.line===ze){for(Je=oe.input.charCodeAt(oe.position);m(Je);)Je=oe.input.charCodeAt(++oe.position);if(Je===58)y(Je=oe.input.charCodeAt(++oe.position))||O(oe,"a whitespace character is expected after the key-value separator within a block mapping"),ln&&(k(oe,ke,nt,wt,gn,null),wt=gn=Sn=null),on=!0,ln=!1,Ee=!1,wt=oe.tag,gn=oe.result;else{if(!on)return oe.tag=lt,oe.anchor=Oe,!0;O(oe,"can not read an implicit mapping pair; a colon is missed")}}else{if(!on)return oe.tag=lt,oe.anchor=Oe,!0;O(oe,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else Je===63?(ln&&(k(oe,ke,nt,wt,gn,null),wt=gn=Sn=null),on=!0,ln=!0,Ee=!0):ln?(ln=!1,Ee=!0):O(oe,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),oe.position+=1,Je=ct;if((oe.line===ze||oe.lineIndent>st)&&(fe(oe,st,4,!0,Ee)&&(ln?gn=oe.result:Sn=oe.result),ln||(k(oe,ke,nt,wt,gn,Sn,ze,Ke),wt=gn=Sn=null),F(oe,!0,-1),Je=oe.input.charCodeAt(oe.position)),oe.lineIndent>st&&Je!==0)O(oe,"bad indentation of a mapping entry");else if(oe.lineIndent<st)break}return ln&&k(oe,ke,nt,wt,gn,null),on&&(oe.tag=lt,oe.anchor=Oe,oe.kind="mapping",oe.result=ke),on})(P,ve,se))||(function(oe,st){var gt,ct,Ee,ze,Ke,Je,lt,Oe,ke,nt,wt=!0,gn=oe.tag,Sn=oe.anchor,ln={};if((nt=oe.input.charCodeAt(oe.position))===91)Ee=93,Je=!1,ct=[];else{if(nt!==123)return!1;Ee=125,Je=!0,ct={}}for(oe.anchor!==null&&(oe.anchorMap[oe.anchor]=ct),nt=oe.input.charCodeAt(++oe.position);nt!==0;){if(F(oe,!0,st),(nt=oe.input.charCodeAt(oe.position))===Ee)return oe.position++,oe.tag=gn,oe.anchor=Sn,oe.kind=Je?"mapping":"sequence",oe.result=ct,!0;wt||O(oe,"missed comma between flow collection entries"),ke=null,ze=Ke=!1,nt===63&&y(oe.input.charCodeAt(oe.position+1))&&(ze=Ke=!0,oe.position++,F(oe,!0,st)),gt=oe.line,fe(oe,st,1,!1,!0),Oe=oe.tag,lt=oe.result,F(oe,!0,st),nt=oe.input.charCodeAt(oe.position),!Ke&&oe.line!==gt||nt!==58||(ze=!0,nt=oe.input.charCodeAt(++oe.position),F(oe,!0,st),fe(oe,st,1,!1,!0),ke=oe.result),Je?k(oe,ct,ln,Oe,lt,ke):ze?ct.push(k(oe,null,ln,Oe,lt,ke)):ct.push(lt),F(oe,!0,st),(nt=oe.input.charCodeAt(oe.position))===44?(wt=!0,nt=oe.input.charCodeAt(++oe.position)):wt=!1}O(oe,"unexpected end of the stream within a flow collection")})(P,se)?We=!0:(ge&&(function(oe,st){var gt,ct,Ee,ze,Ke,Je=1,lt=!1,Oe=!1,ke=st,nt=0,wt=!1;if((ze=oe.input.charCodeAt(oe.position))===124)ct=!1;else{if(ze!==62)return!1;ct=!0}for(oe.kind="scalar",oe.result="";ze!==0;)if((ze=oe.input.charCodeAt(++oe.position))===43||ze===45)Je===1?Je=ze===43?3:2:O(oe,"repeat of a chomping mode identifier");else{if(!((Ee=48<=(Ke=ze)&&Ke<=57?Ke-48:-1)>=0))break;Ee===0?O(oe,"bad explicit indentation width of a block scalar; it cannot be less than one"):Oe?O(oe,"repeat of an indentation width identifier"):(ke=st+Ee-1,Oe=!0)}if(m(ze)){do ze=oe.input.charCodeAt(++oe.position);while(m(ze));if(ze===35)do ze=oe.input.charCodeAt(++oe.position);while(!w(ze)&&ze!==0)}for(;ze!==0;){for(L(oe),oe.lineIndent=0,ze=oe.input.charCodeAt(oe.position);(!Oe||oe.lineIndent<ke)&&ze===32;)oe.lineIndent++,ze=oe.input.charCodeAt(++oe.position);if(!Oe&&oe.lineIndent>ke&&(ke=oe.lineIndent),w(ze))nt++;else{if(oe.lineIndent<ke){Je===3?oe.result+=o.repeat(`
`,lt?1+nt:nt):Je===1&&lt&&(oe.result+=`
`);break}for(ct?m(ze)?(wt=!0,oe.result+=o.repeat(`
`,lt?1+nt:nt)):wt?(wt=!1,oe.result+=o.repeat(`
`,nt+1)):nt===0?lt&&(oe.result+=" "):oe.result+=o.repeat(`
`,nt):oe.result+=o.repeat(`
`,lt?1+nt:nt),lt=!0,Oe=!0,nt=0,gt=oe.position;!w(ze)&&ze!==0;)ze=oe.input.charCodeAt(++oe.position);A(oe,gt,oe.position,!1)}}return!0})(P,se)||(function(oe,st){var gt,ct,Ee;if((gt=oe.input.charCodeAt(oe.position))!==39)return!1;for(oe.kind="scalar",oe.result="",oe.position++,ct=Ee=oe.position;(gt=oe.input.charCodeAt(oe.position))!==0;)if(gt===39){if(A(oe,ct,oe.position,!0),(gt=oe.input.charCodeAt(++oe.position))!==39)return!0;ct=oe.position,oe.position++,Ee=oe.position}else w(gt)?(A(oe,ct,Ee,!0),Y(oe,F(oe,!1,st)),ct=Ee=oe.position):oe.position===oe.lineStart&&j(oe)?O(oe,"unexpected end of the document within a single quoted scalar"):(oe.position++,Ee=oe.position);O(oe,"unexpected end of the stream within a single quoted scalar")})(P,se)||(function(oe,st){var gt,ct,Ee,ze,Ke,Je,lt;if((Je=oe.input.charCodeAt(oe.position))!==34)return!1;for(oe.kind="scalar",oe.result="",oe.position++,gt=ct=oe.position;(Je=oe.input.charCodeAt(oe.position))!==0;){if(Je===34)return A(oe,gt,oe.position,!0),oe.position++,!0;if(Je===92){if(A(oe,gt,oe.position,!0),w(Je=oe.input.charCodeAt(++oe.position)))F(oe,!1,st);else if(Je<256&&_[Je])oe.result+=E[Je],oe.position++;else if((Ke=(lt=Je)===120?2:lt===117?4:lt===85?8:0)>0){for(Ee=Ke,ze=0;Ee>0;Ee--)(Ke=x(Je=oe.input.charCodeAt(++oe.position)))>=0?ze=(ze<<4)+Ke:O(oe,"expected hexadecimal character");oe.result+=T(ze),oe.position++}else O(oe,"unknown escape sequence");gt=ct=oe.position}else w(Je)?(A(oe,gt,ct,!0),Y(oe,F(oe,!1,st)),gt=ct=oe.position):oe.position===oe.lineStart&&j(oe)?O(oe,"unexpected end of the document within a double quoted scalar"):(oe.position++,ct=oe.position)}O(oe,"unexpected end of the stream within a double quoted scalar")})(P,se)?We=!0:(function(oe){var st,gt,ct;if((ct=oe.input.charCodeAt(oe.position))!==42)return!1;for(ct=oe.input.charCodeAt(++oe.position),st=oe.position;ct!==0&&!y(ct)&&!C(ct);)ct=oe.input.charCodeAt(++oe.position);return oe.position===st&&O(oe,"name of an alias node must contain at least one character"),gt=oe.input.slice(st,oe.position),oe.anchorMap.hasOwnProperty(gt)||O(oe,'unidentified alias "'+gt+'"'),oe.result=oe.anchorMap[gt],F(oe,!0,-1),!0})(P)?(We=!0,P.tag===null&&P.anchor===null||O(P,"alias node should not have any properties")):(function(oe,st,gt){var ct,Ee,ze,Ke,Je,lt,Oe,ke,nt=oe.kind,wt=oe.result;if(y(ke=oe.input.charCodeAt(oe.position))||C(ke)||ke===35||ke===38||ke===42||ke===33||ke===124||ke===62||ke===39||ke===34||ke===37||ke===64||ke===96||(ke===63||ke===45)&&(y(ct=oe.input.charCodeAt(oe.position+1))||gt&&C(ct)))return!1;for(oe.kind="scalar",oe.result="",Ee=ze=oe.position,Ke=!1;ke!==0;){if(ke===58){if(y(ct=oe.input.charCodeAt(oe.position+1))||gt&&C(ct))break}else if(ke===35){if(y(oe.input.charCodeAt(oe.position-1)))break}else{if(oe.position===oe.lineStart&&j(oe)||gt&&C(ke))break;if(w(ke)){if(Je=oe.line,lt=oe.lineStart,Oe=oe.lineIndent,F(oe,!1,-1),oe.lineIndent>=st){Ke=!0,ke=oe.input.charCodeAt(oe.position);continue}oe.position=ze,oe.line=Je,oe.lineStart=lt,oe.lineIndent=Oe;break}}Ke&&(A(oe,Ee,ze,!1),Y(oe,oe.line-Je),Ee=ze=oe.position,Ke=!1),m(ke)||(ze=oe.position+1),ke=oe.input.charCodeAt(++oe.position)}return A(oe,Ee,ze,!1),!!oe.result||(oe.kind=nt,oe.result=wt,!1)})(P,se,W===1)&&(We=!0,P.tag===null&&(P.tag="?")),P.anchor!==null&&(P.anchorMap[P.anchor]=P.result)):le===0&&(We=De&&ie(P,ve))),P.tag!==null&&P.tag!=="!")if(P.tag==="?"){for(P.result!==null&&P.kind!=="scalar"&&O(P,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+P.kind+'"'),Le=0,Ge=P.implicitTypes.length;Le<Ge;Le+=1)if((re=P.implicitTypes[Le]).resolve(P.result)){P.result=re.construct(P.result),P.tag=re.tag,P.anchor!==null&&(P.anchorMap[P.anchor]=P.result);break}}else d.call(P.typeMap[P.kind||"fallback"],P.tag)?(re=P.typeMap[P.kind||"fallback"][P.tag],P.result!==null&&re.kind!==P.kind&&O(P,"unacceptable node kind for !<"+P.tag+'> tag; it should be "'+re.kind+'", not "'+P.kind+'"'),re.resolve(P.result)?(P.result=re.construct(P.result),P.anchor!==null&&(P.anchorMap[P.anchor]=P.result)):O(P,"cannot resolve a node with !<"+P.tag+"> explicit tag")):O(P,"unknown tag !<"+P.tag+">");return P.listener!==null&&P.listener("close",P),P.tag!==null||P.anchor!==null||We}function we(P){var $,W,K,Q,ee=P.position,ge=!1;for(P.version=null,P.checkLineBreaks=P.legacy,P.tagMap={},P.anchorMap={};(Q=P.input.charCodeAt(P.position))!==0&&(F(P,!0,-1),Q=P.input.charCodeAt(P.position),!(P.lineIndent>0||Q!==37));){for(ge=!0,Q=P.input.charCodeAt(++P.position),$=P.position;Q!==0&&!y(Q);)Q=P.input.charCodeAt(++P.position);for(K=[],(W=P.input.slice($,P.position)).length<1&&O(P,"directive name must not be less than one character in length");Q!==0;){for(;m(Q);)Q=P.input.charCodeAt(++P.position);if(Q===35){do Q=P.input.charCodeAt(++P.position);while(Q!==0&&!w(Q));break}if(w(Q))break;for($=P.position;Q!==0&&!y(Q);)Q=P.input.charCodeAt(++P.position);K.push(P.input.slice($,P.position))}Q!==0&&L(P),d.call(R,W)?R[W](P,W,K):M(P,'unknown document directive "'+W+'"')}F(P,!0,-1),P.lineIndent===0&&P.input.charCodeAt(P.position)===45&&P.input.charCodeAt(P.position+1)===45&&P.input.charCodeAt(P.position+2)===45?(P.position+=3,F(P,!0,-1)):ge&&O(P,"directives end mark is expected"),fe(P,P.lineIndent-1,4,!1,!0),F(P,!0,-1),P.checkLineBreaks&&f.test(P.input.slice(ee,P.position))&&M(P,"non-ASCII line breaks are interpreted as content"),P.documents.push(P.result),P.position===P.lineStart&&j(P)?P.input.charCodeAt(P.position)===46&&(P.position+=3,F(P,!0,-1)):P.position<P.length-1&&O(P,"end of the stream or a document separator is expected")}function _e(P,$){$=$||{},(P=String(P)).length!==0&&(P.charCodeAt(P.length-1)!==10&&P.charCodeAt(P.length-1)!==13&&(P+=`
`),P.charCodeAt(0)===65279&&(P=P.slice(1)));var W=new b(P,$),K=P.indexOf("\0");for(K!==-1&&(W.position=K,O(W,"null byte is not allowed in input")),W.input+="\0";W.input.charCodeAt(W.position)===32;)W.lineIndent+=1,W.position+=1;for(;W.position<W.length-1;)we(W);return W.documents}function Se(P,$,W){$!==null&&typeof $=="object"&&W===void 0&&(W=$,$=null);var K=_e(P,W);if(typeof $!="function")return K;for(var Q=0,ee=K.length;Q<ee;Q+=1)$(K[Q])}function B(P,$){var W=_e(P,$);if(W.length!==0){if(W.length===1)return W[0];throw new a("expected a single document in the stream, but found more")}}r.exports.loadAll=Se,r.exports.load=B,r.exports.safeLoadAll=function(P,$,W){return typeof $=="object"&&$!==null&&W===void 0&&(W=$,$=null),Se(P,$,o.extend({schema:c},W))},r.exports.safeLoad=function(P,$){return B(P,o.extend({schema:c},$))}},function(r,n,i){var o=i(38);function a(s,c,l,d,u){this.name=s,this.buffer=c,this.position=l,this.line=d,this.column=u}a.prototype.getSnippet=function(s,c){var l,d,u,f,h;if(!this.buffer)return null;for(s=s||4,c=c||75,l="",d=this.position;d>0&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(d-1))===-1;)if(d-=1,this.position-d>c/2-1){l=" ... ",d+=5;break}for(u="",f=this.position;f<this.buffer.length&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(f))===-1;)if((f+=1)-this.position>c/2-1){u=" ... ",f-=5;break}return h=this.buffer.slice(d,f),o.repeat(" ",s)+l+h+u+`
`+o.repeat(" ",s+this.position-d+l.length)+"^"},a.prototype.toString=function(s){var c,l="";return this.name&&(l+='in "'+this.name+'" '),l+="at line "+(this.line+1)+", column "+(this.column+1),s||(c=this.getSnippet())&&(l+=`:
`+c),l},r.exports=a},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:str",{kind:"scalar",construct:function(a){return a!==null?a:""}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(a){return a!==null?a:[]}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:map",{kind:"mapping",construct:function(a){return a!==null?a:{}}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(a){if(a===null)return!0;var s=a.length;return s===1&&a==="~"||s===4&&(a==="null"||a==="Null"||a==="NULL")},construct:function(){return null},predicate:function(a){return a===null},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(a){if(a===null)return!1;var s=a.length;return s===4&&(a==="true"||a==="True"||a==="TRUE")||s===5&&(a==="false"||a==="False"||a==="FALSE")},construct:function(a){return a==="true"||a==="True"||a==="TRUE"},predicate:function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},represent:{lowercase:function(a){return a?"true":"false"},uppercase:function(a){return a?"TRUE":"FALSE"},camelcase:function(a){return a?"True":"False"}},defaultStyle:"lowercase"})},function(r,n,i){var o=i(38),a=i(10);function s(l){return 48<=l&&l<=55}function c(l){return 48<=l&&l<=57}r.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(l){if(l===null)return!1;var d,u,f=l.length,h=0,g=!1;if(!f)return!1;if((d=l[h])!=="-"&&d!=="+"||(d=l[++h]),d==="0"){if(h+1===f)return!0;if((d=l[++h])==="b"){for(h++;h<f;h++)if((d=l[h])!=="_"){if(d!=="0"&&d!=="1")return!1;g=!0}return g&&d!=="_"}if(d==="x"){for(h++;h<f;h++)if((d=l[h])!=="_"){if(!(48<=(u=l.charCodeAt(h))&&u<=57||65<=u&&u<=70||97<=u&&u<=102))return!1;g=!0}return g&&d!=="_"}for(;h<f;h++)if((d=l[h])!=="_"){if(!s(l.charCodeAt(h)))return!1;g=!0}return g&&d!=="_"}if(d==="_")return!1;for(;h<f;h++)if((d=l[h])!=="_"){if(d===":")break;if(!c(l.charCodeAt(h)))return!1;g=!0}return!(!g||d==="_")&&(d!==":"||/^(:[0-5]?[0-9])+$/.test(l.slice(h)))},construct:function(l){var d,u,f=l,h=1,g=[];return f.indexOf("_")!==-1&&(f=f.replace(/_/g,"")),(d=f[0])!=="-"&&d!=="+"||(d==="-"&&(h=-1),d=(f=f.slice(1))[0]),f==="0"?0:d==="0"?f[1]==="b"?h*parseInt(f.slice(2),2):f[1]==="x"?h*parseInt(f,16):h*parseInt(f,8):f.indexOf(":")!==-1?(f.split(":").forEach((function(p){g.unshift(parseInt(p,10))})),f=0,u=1,g.forEach((function(p){f+=p*u,u*=60})),h*f):h*parseInt(f,10)},predicate:function(l){return Object.prototype.toString.call(l)==="[object Number]"&&l%1==0&&!o.isNegativeZero(l)},represent:{binary:function(l){return l>=0?"0b"+l.toString(2):"-0b"+l.toString(2).slice(1)},octal:function(l){return l>=0?"0"+l.toString(8):"-0"+l.toString(8).slice(1)},decimal:function(l){return l.toString(10)},hexadecimal:function(l){return l>=0?"0x"+l.toString(16).toUpperCase():"-0x"+l.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(r,n,i){var o=i(38),a=i(10),s=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),c=/^[-+]?[0-9]+e/;r.exports=new a("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(l){return l!==null&&!(!s.test(l)||l[l.length-1]==="_")},construct:function(l){var d,u,f,h;return u=(d=l.replace(/_/g,"").toLowerCase())[0]==="-"?-1:1,h=[],"+-".indexOf(d[0])>=0&&(d=d.slice(1)),d===".inf"?u===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:d===".nan"?NaN:d.indexOf(":")>=0?(d.split(":").forEach((function(g){h.unshift(parseFloat(g,10))})),d=0,f=1,h.forEach((function(g){d+=g*f,f*=60})),u*d):u*parseFloat(d,10)},predicate:function(l){return Object.prototype.toString.call(l)==="[object Number]"&&(l%1!=0||o.isNegativeZero(l))},represent:function(l,d){var u;if(isNaN(l))switch(d){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===l)switch(d){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===l)switch(d){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(o.isNegativeZero(l))return"-0.0";return u=l.toString(10),c.test(u)?u.replace("e",".e"):u},defaultStyle:"lowercase"})},function(r,n,i){var o=i(10),a=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),s=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");r.exports=new o("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(c){return c!==null&&(a.exec(c)!==null||s.exec(c)!==null)},construct:function(c){var l,d,u,f,h,g,p,v,w=0,m=null;if((l=a.exec(c))===null&&(l=s.exec(c)),l===null)throw new Error("Date resolve error");if(d=+l[1],u=+l[2]-1,f=+l[3],!l[4])return new Date(Date.UTC(d,u,f));if(h=+l[4],g=+l[5],p=+l[6],l[7]){for(w=l[7].slice(0,3);w.length<3;)w+="0";w=+w}return l[9]&&(m=6e4*(60*+l[10]+ +(l[11]||0)),l[9]==="-"&&(m=-m)),v=new Date(Date.UTC(d,u,f,h,g,p,w)),m&&v.setTime(v.getTime()-m),v},instanceOf:Date,represent:function(c){return c.toISOString()}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(a){return a==="<<"||a===null}})},function(r,n,i){var o;try{o=i(145).Buffer}catch{}var a=i(10),s=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;r.exports=new a("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(c){if(c===null)return!1;var l,d,u=0,f=c.length,h=s;for(d=0;d<f;d++)if(!((l=h.indexOf(c.charAt(d)))>64)){if(l<0)return!1;u+=6}return u%8==0},construct:function(c){var l,d,u=c.replace(/[\r\n=]/g,""),f=u.length,h=s,g=0,p=[];for(l=0;l<f;l++)l%4==0&&l&&(p.push(g>>16&255),p.push(g>>8&255),p.push(255&g)),g=g<<6|h.indexOf(u.charAt(l));return(d=f%4*6)===0?(p.push(g>>16&255),p.push(g>>8&255),p.push(255&g)):d===18?(p.push(g>>10&255),p.push(g>>2&255)):d===12&&p.push(g>>4&255),o?o.from?o.from(p):new o(p):p},predicate:function(c){return o&&o.isBuffer(c)},represent:function(c){var l,d,u="",f=0,h=c.length,g=s;for(l=0;l<h;l++)l%3==0&&l&&(u+=g[f>>18&63],u+=g[f>>12&63],u+=g[f>>6&63],u+=g[63&f]),f=(f<<8)+c[l];return(d=h%3)===0?(u+=g[f>>18&63],u+=g[f>>12&63],u+=g[f>>6&63],u+=g[63&f]):d===2?(u+=g[f>>10&63],u+=g[f>>4&63],u+=g[f<<2&63],u+=g[64]):d===1&&(u+=g[f>>2&63],u+=g[f<<4&63],u+=g[64],u+=g[64]),u}})},function(r,n,i){var o=i(10),a=Object.prototype.hasOwnProperty,s=Object.prototype.toString;r.exports=new o("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(c){if(c===null)return!0;var l,d,u,f,h,g=[],p=c;for(l=0,d=p.length;l<d;l+=1){if(u=p[l],h=!1,s.call(u)!=="[object Object]")return!1;for(f in u)if(a.call(u,f)){if(h)return!1;h=!0}if(!h||g.indexOf(f)!==-1)return!1;g.push(f)}return!0},construct:function(c){return c!==null?c:[]}})},function(r,n,i){var o=i(10),a=Object.prototype.toString;r.exports=new o("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(s){if(s===null)return!0;var c,l,d,u,f,h=s;for(f=new Array(h.length),c=0,l=h.length;c<l;c+=1){if(d=h[c],a.call(d)!=="[object Object]"||(u=Object.keys(d)).length!==1)return!1;f[c]=[u[0],d[u[0]]]}return!0},construct:function(s){if(s===null)return[];var c,l,d,u,f,h=s;for(f=new Array(h.length),c=0,l=h.length;c<l;c+=1)d=h[c],u=Object.keys(d),f[c]=[u[0],d[u[0]]];return f}})},function(r,n,i){var o=i(10),a=Object.prototype.hasOwnProperty;r.exports=new o("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(s){if(s===null)return!0;var c,l=s;for(c in l)if(a.call(l,c)&&l[c]!==null)return!1;return!0},construct:function(s){return s!==null?s:{}}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(a){return a===void 0},represent:function(){return""}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(a){if(a===null||a.length===0)return!1;var s=a,c=/\/([gim]*)$/.exec(a),l="";return!(s[0]==="/"&&(c&&(l=c[1]),l.length>3||s[s.length-l.length-1]!=="/"))},construct:function(a){var s=a,c=/\/([gim]*)$/.exec(a),l="";return s[0]==="/"&&(c&&(l=c[1]),s=s.slice(1,s.length-l.length-1)),new RegExp(s,l)},predicate:function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},represent:function(a){var s="/"+a.source+"/";return a.global&&(s+="g"),a.multiline&&(s+="m"),a.ignoreCase&&(s+="i"),s}})},function(r,n,i){var o;try{o=i(302)}catch{typeof window<"u"&&(o=window.esprima)}var a=i(10);r.exports=new a("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(s){if(s===null)return!1;try{var c="("+s+")",l=o.parse(c,{range:!0});return l.type==="Program"&&l.body.length===1&&l.body[0].type==="ExpressionStatement"&&(l.body[0].expression.type==="ArrowFunctionExpression"||l.body[0].expression.type==="FunctionExpression")}catch{return!1}},construct:function(s){var c,l="("+s+")",d=o.parse(l,{range:!0}),u=[];if(d.type!=="Program"||d.body.length!==1||d.body[0].type!=="ExpressionStatement"||d.body[0].expression.type!=="ArrowFunctionExpression"&&d.body[0].expression.type!=="FunctionExpression")throw new Error("Failed to resolve function");return d.body[0].expression.params.forEach((function(f){u.push(f.name)})),c=d.body[0].expression.body.range,d.body[0].expression.body.type==="BlockStatement"?new Function(u,l.slice(c[0]+1,c[1]-1)):new Function(u,"return "+l.slice(c[0],c[1]))},predicate:function(s){return Object.prototype.toString.call(s)==="[object Function]"},represent:function(s){return s.toString()}})},function(r,n,i){var o;o=function(){return(function(a){var s={};function c(l){if(s[l])return s[l].exports;var d=s[l]={exports:{},id:l,loaded:!1};return a[l].call(d.exports,d,d.exports,c),d.loaded=!0,d.exports}return c.m=a,c.c=s,c.p="",c(0)})([function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(1),d=c(3),u=c(8),f=c(15);function h(p,v,w){var m=null,y=function(D,b){w&&w(D,b),m&&m.visit(D,b)},C=typeof w=="function"?y:null,x=!1;if(v){x=typeof v.comment=="boolean"&&v.comment;var S=typeof v.attachComment=="boolean"&&v.attachComment;(x||S)&&((m=new l.CommentHandler).attach=S,v.comment=!0,C=y)}var T,_=!1;v&&typeof v.sourceType=="string"&&(_=v.sourceType==="module"),T=v&&typeof v.jsx=="boolean"&&v.jsx?new d.JSXParser(p,v,C):new u.Parser(p,v,C);var E=_?T.parseModule():T.parseScript();return x&&m&&(E.comments=m.comments),T.config.tokens&&(E.tokens=T.tokens),T.config.tolerant&&(E.errors=T.errorHandler.errors),E}s.parse=h,s.parseModule=function(p,v,w){var m=v||{};return m.sourceType="module",h(p,m,w)},s.parseScript=function(p,v,w){var m=v||{};return m.sourceType="script",h(p,m,w)},s.tokenize=function(p,v,w){var m,y=new f.Tokenizer(p,v);m=[];try{for(;;){var C=y.getNextToken();if(!C)break;w&&(C=w(C)),m.push(C)}}catch(x){y.errorHandler.tolerate(x)}return y.errorHandler.tolerant&&(m.errors=y.errors()),m};var g=c(2);s.Syntax=g.Syntax,s.version="4.0.1"},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(2),d=(function(){function u(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return u.prototype.insertInnerComments=function(f,h){if(f.type===l.Syntax.BlockStatement&&f.body.length===0){for(var g=[],p=this.leading.length-1;p>=0;--p){var v=this.leading[p];h.end.offset>=v.start&&(g.unshift(v.comment),this.leading.splice(p,1),this.trailing.splice(p,1))}g.length&&(f.innerComments=g)}},u.prototype.findTrailingComments=function(f){var h=[];if(this.trailing.length>0){for(var g=this.trailing.length-1;g>=0;--g){var p=this.trailing[g];p.start>=f.end.offset&&h.unshift(p.comment)}return this.trailing.length=0,h}var v=this.stack[this.stack.length-1];if(v&&v.node.trailingComments){var w=v.node.trailingComments[0];w&&w.range[0]>=f.end.offset&&(h=v.node.trailingComments,delete v.node.trailingComments)}return h},u.prototype.findLeadingComments=function(f){for(var h,g=[];this.stack.length>0&&(w=this.stack[this.stack.length-1])&&w.start>=f.start.offset;)h=w.node,this.stack.pop();if(h){for(var p=(h.leadingComments?h.leadingComments.length:0)-1;p>=0;--p){var v=h.leadingComments[p];v.range[1]<=f.start.offset&&(g.unshift(v),h.leadingComments.splice(p,1))}return h.leadingComments&&h.leadingComments.length===0&&delete h.leadingComments,g}for(p=this.leading.length-1;p>=0;--p){var w;(w=this.leading[p]).start<=f.start.offset&&(g.unshift(w.comment),this.leading.splice(p,1))}return g},u.prototype.visitNode=function(f,h){if(!(f.type===l.Syntax.Program&&f.body.length>0)){this.insertInnerComments(f,h);var g=this.findTrailingComments(h),p=this.findLeadingComments(h);p.length>0&&(f.leadingComments=p),g.length>0&&(f.trailingComments=g),this.stack.push({node:f,start:h.start.offset})}},u.prototype.visitComment=function(f,h){var g=f.type[0]==="L"?"Line":"Block",p={type:g,value:f.value};if(f.range&&(p.range=f.range),f.loc&&(p.loc=f.loc),this.comments.push(p),this.attach){var v={comment:{type:g,value:f.value,range:[h.start.offset,h.end.offset]},start:h.start.offset};f.loc&&(v.comment.loc=f.loc),f.type=g,this.leading.push(v),this.trailing.push(v)}},u.prototype.visit=function(f,h){f.type==="LineComment"||f.type==="BlockComment"?this.visitComment(f,h):this.attach&&this.visitNode(f,h)},u})();s.CommentHandler=d},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(a,s,c){var l,d=this&&this.__extends||(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,x){C.__proto__=x}||function(C,x){for(var S in x)x.hasOwnProperty(S)&&(C[S]=x[S])},function(C,x){function S(){this.constructor=C}l(C,x),C.prototype=x===null?Object.create(x):(S.prototype=x.prototype,new S)});Object.defineProperty(s,"__esModule",{value:!0});var u=c(4),f=c(5),h=c(6),g=c(7),p=c(8),v=c(13),w=c(14);function m(C){var x;switch(C.type){case h.JSXSyntax.JSXIdentifier:x=C.name;break;case h.JSXSyntax.JSXNamespacedName:var S=C;x=m(S.namespace)+":"+m(S.name);break;case h.JSXSyntax.JSXMemberExpression:var T=C;x=m(T.object)+"."+m(T.property)}return x}v.TokenName[100]="JSXIdentifier",v.TokenName[101]="JSXText";var y=(function(C){function x(S,T,_){return C.call(this,S,T,_)||this}return d(x,C),x.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():C.prototype.parsePrimaryExpression.call(this)},x.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},x.prototype.finishJSX=function(){this.nextToken()},x.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},x.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},x.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},x.prototype.scanXHTMLEntity=function(S){for(var T="&",_=!0,E=!1,D=!1,b=!1;!this.scanner.eof()&&_&&!E;){var I=this.scanner.source[this.scanner.index];if(I===S)break;if(E=I===";",T+=I,++this.scanner.index,!E)switch(T.length){case 2:D=I==="#";break;case 3:D&&(_=(b=I==="x")||u.Character.isDecimalDigit(I.charCodeAt(0)),D=D&&!b);break;default:_=(_=_&&!(D&&!u.Character.isDecimalDigit(I.charCodeAt(0))))&&!(b&&!u.Character.isHexDigit(I.charCodeAt(0)))}}if(_&&E&&T.length>2){var O=T.substr(1,T.length-2);D&&O.length>1?T=String.fromCharCode(parseInt(O.substr(1),10)):b&&O.length>2?T=String.fromCharCode(parseInt("0"+O.substr(1),16)):D||b||!w.XHTMLEntities[O]||(T=w.XHTMLEntities[O])}return T},x.prototype.lexJSX=function(){var S=this.scanner.source.charCodeAt(this.scanner.index);if(S===60||S===62||S===47||S===58||S===61||S===123||S===125)return{type:7,value:I=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(S===34||S===39){for(var T=this.scanner.index,_=this.scanner.source[this.scanner.index++],E="";!this.scanner.eof()&&(O=this.scanner.source[this.scanner.index++])!==_;)E+=O==="&"?this.scanXHTMLEntity(_):O;return{type:8,value:E,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index}}if(S===46){var D=this.scanner.source.charCodeAt(this.scanner.index+1),b=this.scanner.source.charCodeAt(this.scanner.index+2),I=D===46&&b===46?"...":".";return T=this.scanner.index,this.scanner.index+=I.length,{type:7,value:I,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index}}if(S===96)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(u.Character.isIdentifierStart(S)&&S!==92){for(T=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var O=this.scanner.source.charCodeAt(this.scanner.index);if(u.Character.isIdentifierPart(O)&&O!==92)++this.scanner.index;else{if(O!==45)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(T,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index}}return this.scanner.lex()},x.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var S=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(S)),S},x.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var S=this.scanner.index,T="";!this.scanner.eof();){var _=this.scanner.source[this.scanner.index];if(_==="{"||_==="<")break;++this.scanner.index,T+=_,u.Character.isLineTerminator(_.charCodeAt(0))&&(++this.scanner.lineNumber,_==="\r"&&this.scanner.source[this.scanner.index]===`
`&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var E={type:101,value:T,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:S,end:this.scanner.index};return T.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(E)),E},x.prototype.peekJSXToken=function(){var S=this.scanner.saveState();this.scanner.scanComments();var T=this.lexJSX();return this.scanner.restoreState(S),T},x.prototype.expectJSX=function(S){var T=this.nextJSXToken();T.type===7&&T.value===S||this.throwUnexpectedToken(T)},x.prototype.matchJSX=function(S){var T=this.peekJSXToken();return T.type===7&&T.value===S},x.prototype.parseJSXIdentifier=function(){var S=this.createJSXNode(),T=this.nextJSXToken();return T.type!==100&&this.throwUnexpectedToken(T),this.finalize(S,new f.JSXIdentifier(T.value))},x.prototype.parseJSXElementName=function(){var S=this.createJSXNode(),T=this.parseJSXIdentifier();if(this.matchJSX(":")){var _=T;this.expectJSX(":");var E=this.parseJSXIdentifier();T=this.finalize(S,new f.JSXNamespacedName(_,E))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var D=T;this.expectJSX(".");var b=this.parseJSXIdentifier();T=this.finalize(S,new f.JSXMemberExpression(D,b))}return T},x.prototype.parseJSXAttributeName=function(){var S,T=this.createJSXNode(),_=this.parseJSXIdentifier();if(this.matchJSX(":")){var E=_;this.expectJSX(":");var D=this.parseJSXIdentifier();S=this.finalize(T,new f.JSXNamespacedName(E,D))}else S=_;return S},x.prototype.parseJSXStringLiteralAttribute=function(){var S=this.createJSXNode(),T=this.nextJSXToken();T.type!==8&&this.throwUnexpectedToken(T);var _=this.getTokenRaw(T);return this.finalize(S,new g.Literal(T.value,_))},x.prototype.parseJSXExpressionAttribute=function(){var S=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var T=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(S,new f.JSXExpressionContainer(T))},x.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},x.prototype.parseJSXNameValueAttribute=function(){var S=this.createJSXNode(),T=this.parseJSXAttributeName(),_=null;return this.matchJSX("=")&&(this.expectJSX("="),_=this.parseJSXAttributeValue()),this.finalize(S,new f.JSXAttribute(T,_))},x.prototype.parseJSXSpreadAttribute=function(){var S=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var T=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(S,new f.JSXSpreadAttribute(T))},x.prototype.parseJSXAttributes=function(){for(var S=[];!this.matchJSX("/")&&!this.matchJSX(">");){var T=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();S.push(T)}return S},x.prototype.parseJSXOpeningElement=function(){var S=this.createJSXNode();this.expectJSX("<");var T=this.parseJSXElementName(),_=this.parseJSXAttributes(),E=this.matchJSX("/");return E&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(S,new f.JSXOpeningElement(T,E,_))},x.prototype.parseJSXBoundaryElement=function(){var S=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var T=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(S,new f.JSXClosingElement(T))}var _=this.parseJSXElementName(),E=this.parseJSXAttributes(),D=this.matchJSX("/");return D&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(S,new f.JSXOpeningElement(_,D,E))},x.prototype.parseJSXEmptyExpression=function(){var S=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(S,new f.JSXEmptyExpression)},x.prototype.parseJSXExpressionContainer=function(){var S,T=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(S=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),S=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(T,new f.JSXExpressionContainer(S))},x.prototype.parseJSXChildren=function(){for(var S=[];!this.scanner.eof();){var T=this.createJSXChildNode(),_=this.nextJSXText();if(_.start<_.end){var E=this.getTokenRaw(_),D=this.finalize(T,new f.JSXText(_.value,E));S.push(D)}if(this.scanner.source[this.scanner.index]!=="{")break;var b=this.parseJSXExpressionContainer();S.push(b)}return S},x.prototype.parseComplexJSXElement=function(S){for(var T=[];!this.scanner.eof();){S.children=S.children.concat(this.parseJSXChildren());var _=this.createJSXChildNode(),E=this.parseJSXBoundaryElement();if(E.type===h.JSXSyntax.JSXOpeningElement){var D=E;if(D.selfClosing){var b=this.finalize(_,new f.JSXElement(D,[],null));S.children.push(b)}else T.push(S),S={node:_,opening:D,closing:null,children:[]}}if(E.type===h.JSXSyntax.JSXClosingElement){S.closing=E;var I=m(S.opening.name);if(I!==m(S.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",I),!(T.length>0))break;b=this.finalize(S.node,new f.JSXElement(S.opening,S.children,S.closing)),(S=T[T.length-1]).children.push(b),T.pop()}}return S},x.prototype.parseJSXElement=function(){var S=this.createJSXNode(),T=this.parseJSXOpeningElement(),_=[],E=null;if(!T.selfClosing){var D=this.parseComplexJSXElement({node:S,opening:T,closing:E,children:_});_=D.children,E=D.closing}return this.finalize(S,new f.JSXElement(T,_,E))},x.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var S=this.parseJSXElement();return this.finishJSX(),S},x.prototype.isStartOfExpression=function(){return C.prototype.isStartOfExpression.call(this)||this.match("<")},x})(p.Parser);s.JSXParser=y},function(a,s){Object.defineProperty(s,"__esModule",{value:!0});var c={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};s.Character={fromCodePoint:function(l){return l<65536?String.fromCharCode(l):String.fromCharCode(55296+(l-65536>>10))+String.fromCharCode(56320+(l-65536&1023))},isWhiteSpace:function(l){return l===32||l===9||l===11||l===12||l===160||l>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(l)>=0},isLineTerminator:function(l){return l===10||l===13||l===8232||l===8233},isIdentifierStart:function(l){return l===36||l===95||l>=65&&l<=90||l>=97&&l<=122||l===92||l>=128&&c.NonAsciiIdentifierStart.test(s.Character.fromCodePoint(l))},isIdentifierPart:function(l){return l===36||l===95||l>=65&&l<=90||l>=97&&l<=122||l>=48&&l<=57||l===92||l>=128&&c.NonAsciiIdentifierPart.test(s.Character.fromCodePoint(l))},isDecimalDigit:function(l){return l>=48&&l<=57},isHexDigit:function(l){return l>=48&&l<=57||l>=65&&l<=70||l>=97&&l<=102},isOctalDigit:function(l){return l>=48&&l<=55}}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(6),d=function(x){this.type=l.JSXSyntax.JSXClosingElement,this.name=x};s.JSXClosingElement=d;var u=function(x,S,T){this.type=l.JSXSyntax.JSXElement,this.openingElement=x,this.children=S,this.closingElement=T};s.JSXElement=u;var f=function(){this.type=l.JSXSyntax.JSXEmptyExpression};s.JSXEmptyExpression=f;var h=function(x){this.type=l.JSXSyntax.JSXExpressionContainer,this.expression=x};s.JSXExpressionContainer=h;var g=function(x){this.type=l.JSXSyntax.JSXIdentifier,this.name=x};s.JSXIdentifier=g;var p=function(x,S){this.type=l.JSXSyntax.JSXMemberExpression,this.object=x,this.property=S};s.JSXMemberExpression=p;var v=function(x,S){this.type=l.JSXSyntax.JSXAttribute,this.name=x,this.value=S};s.JSXAttribute=v;var w=function(x,S){this.type=l.JSXSyntax.JSXNamespacedName,this.namespace=x,this.name=S};s.JSXNamespacedName=w;var m=function(x,S,T){this.type=l.JSXSyntax.JSXOpeningElement,this.name=x,this.selfClosing=S,this.attributes=T};s.JSXOpeningElement=m;var y=function(x){this.type=l.JSXSyntax.JSXSpreadAttribute,this.argument=x};s.JSXSpreadAttribute=y;var C=function(x,S){this.type=l.JSXSyntax.JSXText,this.value=x,this.raw=S};s.JSXText=C},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(2),d=function(Be){this.type=l.Syntax.ArrayExpression,this.elements=Be};s.ArrayExpression=d;var u=function(Be){this.type=l.Syntax.ArrayPattern,this.elements=Be};s.ArrayPattern=u;var f=function(Be,rt,Mt){this.type=l.Syntax.ArrowFunctionExpression,this.id=null,this.params=Be,this.body=rt,this.generator=!1,this.expression=Mt,this.async=!1};s.ArrowFunctionExpression=f;var h=function(Be,rt,Mt){this.type=l.Syntax.AssignmentExpression,this.operator=Be,this.left=rt,this.right=Mt};s.AssignmentExpression=h;var g=function(Be,rt){this.type=l.Syntax.AssignmentPattern,this.left=Be,this.right=rt};s.AssignmentPattern=g;var p=function(Be,rt,Mt){this.type=l.Syntax.ArrowFunctionExpression,this.id=null,this.params=Be,this.body=rt,this.generator=!1,this.expression=Mt,this.async=!0};s.AsyncArrowFunctionExpression=p;var v=function(Be,rt,Mt){this.type=l.Syntax.FunctionDeclaration,this.id=Be,this.params=rt,this.body=Mt,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionDeclaration=v;var w=function(Be,rt,Mt){this.type=l.Syntax.FunctionExpression,this.id=Be,this.params=rt,this.body=Mt,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionExpression=w;var m=function(Be){this.type=l.Syntax.AwaitExpression,this.argument=Be};s.AwaitExpression=m;var y=function(Be,rt,Mt){var vn=Be==="||"||Be==="&&";this.type=vn?l.Syntax.LogicalExpression:l.Syntax.BinaryExpression,this.operator=Be,this.left=rt,this.right=Mt};s.BinaryExpression=y;var C=function(Be){this.type=l.Syntax.BlockStatement,this.body=Be};s.BlockStatement=C;var x=function(Be){this.type=l.Syntax.BreakStatement,this.label=Be};s.BreakStatement=x;var S=function(Be,rt){this.type=l.Syntax.CallExpression,this.callee=Be,this.arguments=rt};s.CallExpression=S;var T=function(Be,rt){this.type=l.Syntax.CatchClause,this.param=Be,this.body=rt};s.CatchClause=T;var _=function(Be){this.type=l.Syntax.ClassBody,this.body=Be};s.ClassBody=_;var E=function(Be,rt,Mt){this.type=l.Syntax.ClassDeclaration,this.id=Be,this.superClass=rt,this.body=Mt};s.ClassDeclaration=E;var D=function(Be,rt,Mt){this.type=l.Syntax.ClassExpression,this.id=Be,this.superClass=rt,this.body=Mt};s.ClassExpression=D;var b=function(Be,rt){this.type=l.Syntax.MemberExpression,this.computed=!0,this.object=Be,this.property=rt};s.ComputedMemberExpression=b;var I=function(Be,rt,Mt){this.type=l.Syntax.ConditionalExpression,this.test=Be,this.consequent=rt,this.alternate=Mt};s.ConditionalExpression=I;var O=function(Be){this.type=l.Syntax.ContinueStatement,this.label=Be};s.ContinueStatement=O;var M=function(){this.type=l.Syntax.DebuggerStatement};s.DebuggerStatement=M;var R=function(Be,rt){this.type=l.Syntax.ExpressionStatement,this.expression=Be,this.directive=rt};s.Directive=R;var A=function(Be,rt){this.type=l.Syntax.DoWhileStatement,this.body=Be,this.test=rt};s.DoWhileStatement=A;var G=function(){this.type=l.Syntax.EmptyStatement};s.EmptyStatement=G;var k=function(Be){this.type=l.Syntax.ExportAllDeclaration,this.source=Be};s.ExportAllDeclaration=k;var L=function(Be){this.type=l.Syntax.ExportDefaultDeclaration,this.declaration=Be};s.ExportDefaultDeclaration=L;var F=function(Be,rt,Mt){this.type=l.Syntax.ExportNamedDeclaration,this.declaration=Be,this.specifiers=rt,this.source=Mt};s.ExportNamedDeclaration=F;var j=function(Be,rt){this.type=l.Syntax.ExportSpecifier,this.exported=rt,this.local=Be};s.ExportSpecifier=j;var Y=function(Be){this.type=l.Syntax.ExpressionStatement,this.expression=Be};s.ExpressionStatement=Y;var ie=function(Be,rt,Mt){this.type=l.Syntax.ForInStatement,this.left=Be,this.right=rt,this.body=Mt,this.each=!1};s.ForInStatement=ie;var de=function(Be,rt,Mt){this.type=l.Syntax.ForOfStatement,this.left=Be,this.right=rt,this.body=Mt};s.ForOfStatement=de;var ae=function(Be,rt,Mt,vn){this.type=l.Syntax.ForStatement,this.init=Be,this.test=rt,this.update=Mt,this.body=vn};s.ForStatement=ae;var fe=function(Be,rt,Mt,vn){this.type=l.Syntax.FunctionDeclaration,this.id=Be,this.params=rt,this.body=Mt,this.generator=vn,this.expression=!1,this.async=!1};s.FunctionDeclaration=fe;var we=function(Be,rt,Mt,vn){this.type=l.Syntax.FunctionExpression,this.id=Be,this.params=rt,this.body=Mt,this.generator=vn,this.expression=!1,this.async=!1};s.FunctionExpression=we;var _e=function(Be){this.type=l.Syntax.Identifier,this.name=Be};s.Identifier=_e;var Se=function(Be,rt,Mt){this.type=l.Syntax.IfStatement,this.test=Be,this.consequent=rt,this.alternate=Mt};s.IfStatement=Se;var B=function(Be,rt){this.type=l.Syntax.ImportDeclaration,this.specifiers=Be,this.source=rt};s.ImportDeclaration=B;var P=function(Be){this.type=l.Syntax.ImportDefaultSpecifier,this.local=Be};s.ImportDefaultSpecifier=P;var $=function(Be){this.type=l.Syntax.ImportNamespaceSpecifier,this.local=Be};s.ImportNamespaceSpecifier=$;var W=function(Be,rt){this.type=l.Syntax.ImportSpecifier,this.local=Be,this.imported=rt};s.ImportSpecifier=W;var K=function(Be,rt){this.type=l.Syntax.LabeledStatement,this.label=Be,this.body=rt};s.LabeledStatement=K;var Q=function(Be,rt){this.type=l.Syntax.Literal,this.value=Be,this.raw=rt};s.Literal=Q;var ee=function(Be,rt){this.type=l.Syntax.MetaProperty,this.meta=Be,this.property=rt};s.MetaProperty=ee;var ge=function(Be,rt,Mt,vn,mi){this.type=l.Syntax.MethodDefinition,this.key=Be,this.computed=rt,this.value=Mt,this.kind=vn,this.static=mi};s.MethodDefinition=ge;var De=function(Be){this.type=l.Syntax.Program,this.body=Be,this.sourceType="module"};s.Module=De;var Le=function(Be,rt){this.type=l.Syntax.NewExpression,this.callee=Be,this.arguments=rt};s.NewExpression=Le;var Ge=function(Be){this.type=l.Syntax.ObjectExpression,this.properties=Be};s.ObjectExpression=Ge;var re=function(Be){this.type=l.Syntax.ObjectPattern,this.properties=Be};s.ObjectPattern=re;var se=function(Be,rt,Mt,vn,mi,nn){this.type=l.Syntax.Property,this.key=rt,this.computed=Mt,this.value=vn,this.kind=Be,this.method=mi,this.shorthand=nn};s.Property=se;var ve=function(Be,rt,Mt,vn){this.type=l.Syntax.Literal,this.value=Be,this.raw=rt,this.regex={pattern:Mt,flags:vn}};s.RegexLiteral=ve;var le=function(Be){this.type=l.Syntax.RestElement,this.argument=Be};s.RestElement=le;var pe=function(Be){this.type=l.Syntax.ReturnStatement,this.argument=Be};s.ReturnStatement=pe;var We=function(Be){this.type=l.Syntax.Program,this.body=Be,this.sourceType="script"};s.Script=We;var oe=function(Be){this.type=l.Syntax.SequenceExpression,this.expressions=Be};s.SequenceExpression=oe;var st=function(Be){this.type=l.Syntax.SpreadElement,this.argument=Be};s.SpreadElement=st;var gt=function(Be,rt){this.type=l.Syntax.MemberExpression,this.computed=!1,this.object=Be,this.property=rt};s.StaticMemberExpression=gt;var ct=function(){this.type=l.Syntax.Super};s.Super=ct;var Ee=function(Be,rt){this.type=l.Syntax.SwitchCase,this.test=Be,this.consequent=rt};s.SwitchCase=Ee;var ze=function(Be,rt){this.type=l.Syntax.SwitchStatement,this.discriminant=Be,this.cases=rt};s.SwitchStatement=ze;var Ke=function(Be,rt){this.type=l.Syntax.TaggedTemplateExpression,this.tag=Be,this.quasi=rt};s.TaggedTemplateExpression=Ke;var Je=function(Be,rt){this.type=l.Syntax.TemplateElement,this.value=Be,this.tail=rt};s.TemplateElement=Je;var lt=function(Be,rt){this.type=l.Syntax.TemplateLiteral,this.quasis=Be,this.expressions=rt};s.TemplateLiteral=lt;var Oe=function(){this.type=l.Syntax.ThisExpression};s.ThisExpression=Oe;var ke=function(Be){this.type=l.Syntax.ThrowStatement,this.argument=Be};s.ThrowStatement=ke;var nt=function(Be,rt,Mt){this.type=l.Syntax.TryStatement,this.block=Be,this.handler=rt,this.finalizer=Mt};s.TryStatement=nt;var wt=function(Be,rt){this.type=l.Syntax.UnaryExpression,this.operator=Be,this.argument=rt,this.prefix=!0};s.UnaryExpression=wt;var gn=function(Be,rt,Mt){this.type=l.Syntax.UpdateExpression,this.operator=Be,this.argument=rt,this.prefix=Mt};s.UpdateExpression=gn;var Sn=function(Be,rt){this.type=l.Syntax.VariableDeclaration,this.declarations=Be,this.kind=rt};s.VariableDeclaration=Sn;var ln=function(Be,rt){this.type=l.Syntax.VariableDeclarator,this.id=Be,this.init=rt};s.VariableDeclarator=ln;var on=function(Be,rt){this.type=l.Syntax.WhileStatement,this.test=Be,this.body=rt};s.WhileStatement=on;var pi=function(Be,rt){this.type=l.Syntax.WithStatement,this.object=Be,this.body=rt};s.WithStatement=pi;var Xt=function(Be,rt){this.type=l.Syntax.YieldExpression,this.argument=Be,this.delegate=rt};s.YieldExpression=Xt},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(9),d=c(10),u=c(11),f=c(7),h=c(12),g=c(2),p=c(13),v=(function(){function w(m,y,C){y===void 0&&(y={}),this.config={range:typeof y.range=="boolean"&&y.range,loc:typeof y.loc=="boolean"&&y.loc,source:null,tokens:typeof y.tokens=="boolean"&&y.tokens,comment:typeof y.comment=="boolean"&&y.comment,tolerant:typeof y.tolerant=="boolean"&&y.tolerant},this.config.loc&&y.source&&y.source!==null&&(this.config.source=String(y.source)),this.delegate=C,this.errorHandler=new d.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new h.Scanner(m,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return w.prototype.throwError=function(m){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];var x=Array.prototype.slice.call(arguments,1),S=m.replace(/%(\d)/g,(function(D,b){return l.assert(b<x.length,"Message reference must be in range"),x[b]})),T=this.lastMarker.index,_=this.lastMarker.line,E=this.lastMarker.column+1;throw this.errorHandler.createError(T,_,E,S)},w.prototype.tolerateError=function(m){for(var y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];var x=Array.prototype.slice.call(arguments,1),S=m.replace(/%(\d)/g,(function(D,b){return l.assert(b<x.length,"Message reference must be in range"),x[b]})),T=this.lastMarker.index,_=this.scanner.lineNumber,E=this.lastMarker.column+1;this.errorHandler.tolerateError(T,_,E,S)},w.prototype.unexpectedTokenError=function(m,y){var C,x=y||u.Messages.UnexpectedToken;if(m?(y||(x=m.type===2?u.Messages.UnexpectedEOS:m.type===3?u.Messages.UnexpectedIdentifier:m.type===6?u.Messages.UnexpectedNumber:m.type===8?u.Messages.UnexpectedString:m.type===10?u.Messages.UnexpectedTemplate:u.Messages.UnexpectedToken,m.type===4&&(this.scanner.isFutureReservedWord(m.value)?x=u.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(m.value)&&(x=u.Messages.StrictReservedWord))),C=m.value):C="ILLEGAL",x=x.replace("%0",C),m&&typeof m.lineNumber=="number"){var S=m.start,T=m.lineNumber,_=this.lastMarker.index-this.lastMarker.column,E=m.start-_+1;return this.errorHandler.createError(S,T,E,x)}return S=this.lastMarker.index,T=this.lastMarker.line,E=this.lastMarker.column+1,this.errorHandler.createError(S,T,E,x)},w.prototype.throwUnexpectedToken=function(m,y){throw this.unexpectedTokenError(m,y)},w.prototype.tolerateUnexpectedToken=function(m,y){this.errorHandler.tolerate(this.unexpectedTokenError(m,y))},w.prototype.collectComments=function(){if(this.config.comment){var m=this.scanner.scanComments();if(m.length>0&&this.delegate)for(var y=0;y<m.length;++y){var C=m[y],x=void 0;x={type:C.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(C.slice[0],C.slice[1])},this.config.range&&(x.range=C.range),this.config.loc&&(x.loc=C.loc);var S={start:{line:C.loc.start.line,column:C.loc.start.column,offset:C.range[0]},end:{line:C.loc.end.line,column:C.loc.end.column,offset:C.range[1]}};this.delegate(x,S)}}else this.scanner.scanComments()},w.prototype.getTokenRaw=function(m){return this.scanner.source.slice(m.start,m.end)},w.prototype.convertToken=function(m){var y={type:p.TokenName[m.type],value:this.getTokenRaw(m)};if(this.config.range&&(y.range=[m.start,m.end]),this.config.loc&&(y.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),m.type===9){var C=m.pattern,x=m.flags;y.regex={pattern:C,flags:x}}return y},w.prototype.nextToken=function(){var m=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var y=this.scanner.lex();return this.hasLineTerminator=m.lineNumber!==y.lineNumber,y&&this.context.strict&&y.type===3&&this.scanner.isStrictModeReservedWord(y.value)&&(y.type=4),this.lookahead=y,this.config.tokens&&y.type!==2&&this.tokens.push(this.convertToken(y)),m},w.prototype.nextRegexToken=function(){this.collectComments();var m=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(m))),this.lookahead=m,this.nextToken(),m},w.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},w.prototype.startNode=function(m,y){y===void 0&&(y=0);var C=m.start-m.lineStart,x=m.lineNumber;return C<0&&(C+=y,x--),{index:m.start,line:x,column:C}},w.prototype.finalize=function(m,y){if(this.config.range&&(y.range=[m.index,this.lastMarker.index]),this.config.loc&&(y.loc={start:{line:m.line,column:m.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(y.loc.source=this.config.source)),this.delegate){var C={start:{line:m.line,column:m.column,offset:m.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(y,C)}return y},w.prototype.expect=function(m){var y=this.nextToken();y.type===7&&y.value===m||this.throwUnexpectedToken(y)},w.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var m=this.lookahead;m.type===7&&m.value===","?this.nextToken():m.type===7&&m.value===";"?(this.nextToken(),this.tolerateUnexpectedToken(m)):this.tolerateUnexpectedToken(m,u.Messages.UnexpectedToken)}else this.expect(",")},w.prototype.expectKeyword=function(m){var y=this.nextToken();y.type===4&&y.value===m||this.throwUnexpectedToken(y)},w.prototype.match=function(m){return this.lookahead.type===7&&this.lookahead.value===m},w.prototype.matchKeyword=function(m){return this.lookahead.type===4&&this.lookahead.value===m},w.prototype.matchContextualKeyword=function(m){return this.lookahead.type===3&&this.lookahead.value===m},w.prototype.matchAssign=function(){if(this.lookahead.type!==7)return!1;var m=this.lookahead.value;return m==="="||m==="*="||m==="**="||m==="/="||m==="%="||m==="+="||m==="-="||m==="<<="||m===">>="||m===">>>="||m==="&="||m==="^="||m==="|="},w.prototype.isolateCoverGrammar=function(m){var y=this.context.isBindingElement,C=this.context.isAssignmentTarget,x=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var S=m.call(this);return this.context.firstCoverInitializedNameError!==null&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=y,this.context.isAssignmentTarget=C,this.context.firstCoverInitializedNameError=x,S},w.prototype.inheritCoverGrammar=function(m){var y=this.context.isBindingElement,C=this.context.isAssignmentTarget,x=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var S=m.call(this);return this.context.isBindingElement=this.context.isBindingElement&&y,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&C,this.context.firstCoverInitializedNameError=x||this.context.firstCoverInitializedNameError,S},w.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(this.lookahead.type===2||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},w.prototype.parsePrimaryExpression=function(){var m,y,C,x=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&this.lookahead.value==="await"&&this.tolerateUnexpectedToken(this.lookahead),m=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(x,new f.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,u.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),C=this.getTokenRaw(y),m=this.finalize(x,new f.Literal(y.value,C));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),C=this.getTokenRaw(y),m=this.finalize(x,new f.Literal(y.value==="true",C));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),C=this.getTokenRaw(y),m=this.finalize(x,new f.Literal(null,C));break;case 10:m=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,m=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":m=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":m=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,y=this.nextRegexToken(),C=this.getTokenRaw(y),m=this.finalize(x,new f.RegexLiteral(y.regex,C,y.pattern,y.flags));break;default:m=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?m=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?m=this.finalize(x,new f.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?m=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),m=this.finalize(x,new f.ThisExpression)):m=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:m=this.throwUnexpectedToken(this.nextToken())}return m},w.prototype.parseSpreadElement=function(){var m=this.createNode();this.expect("...");var y=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(m,new f.SpreadElement(y))},w.prototype.parseArrayInitializer=function(){var m=this.createNode(),y=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),y.push(null);else if(this.match("...")){var C=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),y.push(C)}else y.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(m,new f.ArrayExpression(y))},w.prototype.parsePropertyMethod=function(m){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var y=this.context.strict,C=this.context.allowStrictDirective;this.context.allowStrictDirective=m.simple;var x=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&m.firstRestricted&&this.tolerateUnexpectedToken(m.firstRestricted,m.message),this.context.strict&&m.stricted&&this.tolerateUnexpectedToken(m.stricted,m.message),this.context.strict=y,this.context.allowStrictDirective=C,x},w.prototype.parsePropertyMethodFunction=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters(),x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(m,new f.FunctionExpression(null,C.params,x,!1))},w.prototype.parsePropertyMethodAsyncFunction=function(){var m=this.createNode(),y=this.context.allowYield,C=this.context.await;this.context.allowYield=!1,this.context.await=!0;var x=this.parseFormalParameters(),S=this.parsePropertyMethod(x);return this.context.allowYield=y,this.context.await=C,this.finalize(m,new f.AsyncFunctionExpression(null,x.params,S))},w.prototype.parseObjectPropertyKey=function(){var m,y=this.createNode(),C=this.nextToken();switch(C.type){case 8:case 6:this.context.strict&&C.octal&&this.tolerateUnexpectedToken(C,u.Messages.StrictOctalLiteral);var x=this.getTokenRaw(C);m=this.finalize(y,new f.Literal(C.value,x));break;case 3:case 1:case 5:case 4:m=this.finalize(y,new f.Identifier(C.value));break;case 7:C.value==="["?(m=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):m=this.throwUnexpectedToken(C);break;default:m=this.throwUnexpectedToken(C)}return m},w.prototype.isPropertyKey=function(m,y){return m.type===g.Syntax.Identifier&&m.name===y||m.type===g.Syntax.Literal&&m.value===y},w.prototype.parseObjectProperty=function(m){var y,C=this.createNode(),x=this.lookahead,S=null,T=null,_=!1,E=!1,D=!1,b=!1;if(x.type===3){var I=x.value;this.nextToken(),_=this.match("["),S=(b=!(this.hasLineTerminator||I!=="async"||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(C,new f.Identifier(I))}else this.match("*")?this.nextToken():(_=this.match("["),S=this.parseObjectPropertyKey());var O=this.qualifiedPropertyName(this.lookahead);if(x.type===3&&!b&&x.value==="get"&&O)y="get",_=this.match("["),S=this.parseObjectPropertyKey(),this.context.allowYield=!1,T=this.parseGetterMethod();else if(x.type===3&&!b&&x.value==="set"&&O)y="set",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseSetterMethod();else if(x.type===7&&x.value==="*"&&O)y="init",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseGeneratorMethod(),E=!0;else if(S||this.throwUnexpectedToken(this.lookahead),y="init",this.match(":")&&!b)!_&&this.isPropertyKey(S,"__proto__")&&(m.value&&this.tolerateError(u.Messages.DuplicateProtoProperty),m.value=!0),this.nextToken(),T=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))T=b?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),E=!0;else if(x.type===3)if(I=this.finalize(C,new f.Identifier(x.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),D=!0;var M=this.isolateCoverGrammar(this.parseAssignmentExpression);T=this.finalize(C,new f.AssignmentPattern(I,M))}else D=!0,T=I;else this.throwUnexpectedToken(this.nextToken());return this.finalize(C,new f.Property(y,S,_,T,E,D))},w.prototype.parseObjectInitializer=function(){var m=this.createNode();this.expect("{");for(var y=[],C={value:!1};!this.match("}");)y.push(this.parseObjectProperty(C)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(m,new f.ObjectExpression(y))},w.prototype.parseTemplateHead=function(){l.assert(this.lookahead.head,"Template literal must start with a template head");var m=this.createNode(),y=this.nextToken(),C=y.value,x=y.cooked;return this.finalize(m,new f.TemplateElement({raw:C,cooked:x},y.tail))},w.prototype.parseTemplateElement=function(){this.lookahead.type!==10&&this.throwUnexpectedToken();var m=this.createNode(),y=this.nextToken(),C=y.value,x=y.cooked;return this.finalize(m,new f.TemplateElement({raw:C,cooked:x},y.tail))},w.prototype.parseTemplateLiteral=function(){var m=this.createNode(),y=[],C=[],x=this.parseTemplateHead();for(C.push(x);!x.tail;)y.push(this.parseExpression()),x=this.parseTemplateElement(),C.push(x);return this.finalize(m,new f.TemplateLiteral(C,y))},w.prototype.reinterpretExpressionAsPattern=function(m){switch(m.type){case g.Syntax.Identifier:case g.Syntax.MemberExpression:case g.Syntax.RestElement:case g.Syntax.AssignmentPattern:break;case g.Syntax.SpreadElement:m.type=g.Syntax.RestElement,this.reinterpretExpressionAsPattern(m.argument);break;case g.Syntax.ArrayExpression:m.type=g.Syntax.ArrayPattern;for(var y=0;y<m.elements.length;y++)m.elements[y]!==null&&this.reinterpretExpressionAsPattern(m.elements[y]);break;case g.Syntax.ObjectExpression:for(m.type=g.Syntax.ObjectPattern,y=0;y<m.properties.length;y++)this.reinterpretExpressionAsPattern(m.properties[y].value);break;case g.Syntax.AssignmentExpression:m.type=g.Syntax.AssignmentPattern,delete m.operator,this.reinterpretExpressionAsPattern(m.left)}},w.prototype.parseGroupExpression=function(){var m;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),m={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var y=this.lookahead,C=[];if(this.match("..."))m=this.parseRestElement(C),this.expect(")"),this.match("=>")||this.expect("=>"),m={type:"ArrowParameterPlaceHolder",params:[m],async:!1};else{var x=!1;if(this.context.isBindingElement=!0,m=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var S=[];for(this.context.isAssignmentTarget=!1,S.push(m);this.lookahead.type!==2&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var T=0;T<S.length;T++)this.reinterpretExpressionAsPattern(S[T]);x=!0,m={type:"ArrowParameterPlaceHolder",params:S,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),S.push(this.parseRestElement(C)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,T=0;T<S.length;T++)this.reinterpretExpressionAsPattern(S[T]);x=!0,m={type:"ArrowParameterPlaceHolder",params:S,async:!1}}else S.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(x)break}x||(m=this.finalize(this.startNode(y),new f.SequenceExpression(S)))}if(!x){if(this.expect(")"),this.match("=>")&&(m.type===g.Syntax.Identifier&&m.name==="yield"&&(x=!0,m={type:"ArrowParameterPlaceHolder",params:[m],async:!1}),!x)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),m.type===g.Syntax.SequenceExpression)for(T=0;T<m.expressions.length;T++)this.reinterpretExpressionAsPattern(m.expressions[T]);else this.reinterpretExpressionAsPattern(m);m={type:"ArrowParameterPlaceHolder",params:m.type===g.Syntax.SequenceExpression?m.expressions:[m],async:!1}}this.context.isBindingElement=!1}}}return m},w.prototype.parseArguments=function(){this.expect("(");var m=[];if(!this.match(")"))for(;;){var y=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(m.push(y),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),m},w.prototype.isIdentifierName=function(m){return m.type===3||m.type===4||m.type===1||m.type===5},w.prototype.parseIdentifierName=function(){var m=this.createNode(),y=this.nextToken();return this.isIdentifierName(y)||this.throwUnexpectedToken(y),this.finalize(m,new f.Identifier(y.value))},w.prototype.parseNewExpression=function(){var m,y=this.createNode(),C=this.parseIdentifierName();if(l.assert(C.name==="new","New expression must start with `new`"),this.match("."))if(this.nextToken(),this.lookahead.type===3&&this.context.inFunctionBody&&this.lookahead.value==="target"){var x=this.parseIdentifierName();m=new f.MetaProperty(C,x)}else this.throwUnexpectedToken(this.lookahead);else{var S=this.isolateCoverGrammar(this.parseLeftHandSideExpression),T=this.match("(")?this.parseArguments():[];m=new f.NewExpression(S,T),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(y,m)},w.prototype.parseAsyncArgument=function(){var m=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,m},w.prototype.parseAsyncArguments=function(){this.expect("(");var m=[];if(!this.match(")"))for(;;){var y=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(m.push(y),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),m},w.prototype.parseLeftHandSideExpressionAllowCall=function(){var m,y=this.lookahead,C=this.matchContextualKeyword("async"),x=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(m=this.createNode(),this.nextToken(),m=this.finalize(m,new f.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):m=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var S=this.parseIdentifierName();m=this.finalize(this.startNode(y),new f.StaticMemberExpression(m,S))}else if(this.match("(")){var T=C&&y.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var _=T?this.parseAsyncArguments():this.parseArguments();if(m=this.finalize(this.startNode(y),new f.CallExpression(m,_)),T&&this.match("=>")){for(var E=0;E<_.length;++E)this.reinterpretExpressionAsPattern(_[E]);m={type:"ArrowParameterPlaceHolder",params:_,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),S=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),m=this.finalize(this.startNode(y),new f.ComputedMemberExpression(m,S));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var D=this.parseTemplateLiteral();m=this.finalize(this.startNode(y),new f.TaggedTemplateExpression(m,D))}return this.context.allowIn=x,m},w.prototype.parseSuper=function(){var m=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(m,new f.Super)},w.prototype.parseLeftHandSideExpression=function(){l.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var m=this.startNode(this.lookahead),y=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var C=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),y=this.finalize(m,new f.ComputedMemberExpression(y,C))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),C=this.parseIdentifierName(),y=this.finalize(m,new f.StaticMemberExpression(y,C));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var x=this.parseTemplateLiteral();y=this.finalize(m,new f.TaggedTemplateExpression(y,x))}return y},w.prototype.parseUpdateExpression=function(){var m,y=this.lookahead;if(this.match("++")||this.match("--")){var C=this.startNode(y),x=this.nextToken();m=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&m.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(m.name)&&this.tolerateError(u.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment);var S=!0;m=this.finalize(C,new f.UpdateExpression(x.value,m,S)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(m=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&this.lookahead.type===7&&(this.match("++")||this.match("--"))){this.context.strict&&m.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(m.name)&&this.tolerateError(u.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var T=this.nextToken().value;S=!1,m=this.finalize(this.startNode(y),new f.UpdateExpression(T,m,S))}return m},w.prototype.parseAwaitExpression=function(){var m=this.createNode();this.nextToken();var y=this.parseUnaryExpression();return this.finalize(m,new f.AwaitExpression(y))},w.prototype.parseUnaryExpression=function(){var m;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var y=this.startNode(this.lookahead),C=this.nextToken();m=this.inheritCoverGrammar(this.parseUnaryExpression),m=this.finalize(y,new f.UnaryExpression(C.value,m)),this.context.strict&&m.operator==="delete"&&m.argument.type===g.Syntax.Identifier&&this.tolerateError(u.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else m=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return m},w.prototype.parseExponentiationExpression=function(){var m=this.lookahead,y=this.inheritCoverGrammar(this.parseUnaryExpression);if(y.type!==g.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var C=y,x=this.isolateCoverGrammar(this.parseExponentiationExpression);y=this.finalize(this.startNode(m),new f.BinaryExpression("**",C,x))}return y},w.prototype.binaryPrecedence=function(m){var y=m.value;return m.type===7?this.operatorPrecedence[y]||0:m.type===4&&(y==="instanceof"||this.context.allowIn&&y==="in")?7:0},w.prototype.parseBinaryExpression=function(){var m=this.lookahead,y=this.inheritCoverGrammar(this.parseExponentiationExpression),C=this.lookahead,x=this.binaryPrecedence(C);if(x>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var S=[m,this.lookahead],T=y,_=this.isolateCoverGrammar(this.parseExponentiationExpression),E=[T,C.value,_],D=[x];!((x=this.binaryPrecedence(this.lookahead))<=0);){for(;E.length>2&&x<=D[D.length-1];){_=E.pop();var b=E.pop();D.pop(),T=E.pop(),S.pop();var I=this.startNode(S[S.length-1]);E.push(this.finalize(I,new f.BinaryExpression(b,T,_)))}E.push(this.nextToken().value),D.push(x),S.push(this.lookahead),E.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var O=E.length-1;y=E[O];for(var M=S.pop();O>1;){var R=S.pop(),A=M&&M.lineStart;I=this.startNode(R,A),b=E[O-1],y=this.finalize(I,new f.BinaryExpression(b,E[O-2],y)),O-=2,M=R}}return y},w.prototype.parseConditionalExpression=function(){var m=this.lookahead,y=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var C=this.context.allowIn;this.context.allowIn=!0;var x=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=C,this.expect(":");var S=this.isolateCoverGrammar(this.parseAssignmentExpression);y=this.finalize(this.startNode(m),new f.ConditionalExpression(y,x,S)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return y},w.prototype.checkPatternParam=function(m,y){switch(y.type){case g.Syntax.Identifier:this.validateParam(m,y,y.name);break;case g.Syntax.RestElement:this.checkPatternParam(m,y.argument);break;case g.Syntax.AssignmentPattern:this.checkPatternParam(m,y.left);break;case g.Syntax.ArrayPattern:for(var C=0;C<y.elements.length;C++)y.elements[C]!==null&&this.checkPatternParam(m,y.elements[C]);break;case g.Syntax.ObjectPattern:for(C=0;C<y.properties.length;C++)this.checkPatternParam(m,y.properties[C].value)}m.simple=m.simple&&y instanceof f.Identifier},w.prototype.reinterpretAsCoverFormalsList=function(m){var y,C=[m],x=!1;switch(m.type){case g.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":C=m.params,x=m.async;break;default:return null}y={simple:!0,paramSet:{}};for(var S=0;S<C.length;++S)(T=C[S]).type===g.Syntax.AssignmentPattern?T.right.type===g.Syntax.YieldExpression&&(T.right.argument&&this.throwUnexpectedToken(this.lookahead),T.right.type=g.Syntax.Identifier,T.right.name="yield",delete T.right.argument,delete T.right.delegate):x&&T.type===g.Syntax.Identifier&&T.name==="await"&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(y,T),C[S]=T;if(this.context.strict||!this.context.allowYield)for(S=0;S<C.length;++S){var T;(T=C[S]).type===g.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(y.message===u.Messages.StrictParamDupe){var _=this.context.strict?y.stricted:y.firstRestricted;this.throwUnexpectedToken(_,y.message)}return{simple:y.simple,params:C,stricted:y.stricted,firstRestricted:y.firstRestricted,message:y.message}},w.prototype.parseAssignmentExpression=function(){var m;if(!this.context.allowYield&&this.matchKeyword("yield"))m=this.parseYieldExpression();else{var y=this.lookahead,C=y;if(m=this.parseConditionalExpression(),C.type===3&&C.lineNumber===this.lookahead.lineNumber&&C.value==="async"&&(this.lookahead.type===3||this.matchKeyword("yield"))){var x=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(x),m={type:"ArrowParameterPlaceHolder",params:[x],async:!0}}if(m.type==="ArrowParameterPlaceHolder"||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var S=m.async,T=this.reinterpretAsCoverFormalsList(m);if(T){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var _=this.context.strict,E=this.context.allowStrictDirective;this.context.allowStrictDirective=T.simple;var D=this.context.allowYield,b=this.context.await;this.context.allowYield=!0,this.context.await=S;var I=this.startNode(y);this.expect("=>");var O=void 0;if(this.match("{")){var M=this.context.allowIn;this.context.allowIn=!0,O=this.parseFunctionSourceElements(),this.context.allowIn=M}else O=this.isolateCoverGrammar(this.parseAssignmentExpression);var R=O.type!==g.Syntax.BlockStatement;this.context.strict&&T.firstRestricted&&this.throwUnexpectedToken(T.firstRestricted,T.message),this.context.strict&&T.stricted&&this.tolerateUnexpectedToken(T.stricted,T.message),m=S?this.finalize(I,new f.AsyncArrowFunctionExpression(T.params,O,R)):this.finalize(I,new f.ArrowFunctionExpression(T.params,O,R)),this.context.strict=_,this.context.allowStrictDirective=E,this.context.allowYield=D,this.context.await=b}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment),this.context.strict&&m.type===g.Syntax.Identifier){var A=m;this.scanner.isRestrictedWord(A.name)&&this.tolerateUnexpectedToken(C,u.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(A.name)&&this.tolerateUnexpectedToken(C,u.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(m):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var G=(C=this.nextToken()).value,k=this.isolateCoverGrammar(this.parseAssignmentExpression);m=this.finalize(this.startNode(y),new f.AssignmentExpression(G,m,k)),this.context.firstCoverInitializedNameError=null}}return m},w.prototype.parseExpression=function(){var m=this.lookahead,y=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var C=[];for(C.push(y);this.lookahead.type!==2&&this.match(",");)this.nextToken(),C.push(this.isolateCoverGrammar(this.parseAssignmentExpression));y=this.finalize(this.startNode(m),new f.SequenceExpression(C))}return y},w.prototype.parseStatementListItem=function(){var m;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,this.lookahead.type===4)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,u.Messages.IllegalExportDeclaration),m=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,u.Messages.IllegalImportDeclaration),m=this.parseImportDeclaration();break;case"const":m=this.parseLexicalDeclaration({inFor:!1});break;case"function":m=this.parseFunctionDeclaration();break;case"class":m=this.parseClassDeclaration();break;case"let":m=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:m=this.parseStatement()}else m=this.parseStatement();return m},w.prototype.parseBlock=function(){var m=this.createNode();this.expect("{");for(var y=[];!this.match("}");)y.push(this.parseStatementListItem());return this.expect("}"),this.finalize(m,new f.BlockStatement(y))},w.prototype.parseLexicalBinding=function(m,y){var C=this.createNode(),x=this.parsePattern([],m);this.context.strict&&x.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(x.name)&&this.tolerateError(u.Messages.StrictVarName);var S=null;return m==="const"?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),S=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(u.Messages.DeclarationMissingInitializer,"const")):(!y.inFor&&x.type!==g.Syntax.Identifier||this.match("="))&&(this.expect("="),S=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(C,new f.VariableDeclarator(x,S))},w.prototype.parseBindingList=function(m,y){for(var C=[this.parseLexicalBinding(m,y)];this.match(",");)this.nextToken(),C.push(this.parseLexicalBinding(m,y));return C},w.prototype.isLexicalDeclaration=function(){var m=this.scanner.saveState();this.scanner.scanComments();var y=this.scanner.lex();return this.scanner.restoreState(m),y.type===3||y.type===7&&y.value==="["||y.type===7&&y.value==="{"||y.type===4&&y.value==="let"||y.type===4&&y.value==="yield"},w.prototype.parseLexicalDeclaration=function(m){var y=this.createNode(),C=this.nextToken().value;l.assert(C==="let"||C==="const","Lexical declaration must be either let or const");var x=this.parseBindingList(C,m);return this.consumeSemicolon(),this.finalize(y,new f.VariableDeclaration(x,C))},w.prototype.parseBindingRestElement=function(m,y){var C=this.createNode();this.expect("...");var x=this.parsePattern(m,y);return this.finalize(C,new f.RestElement(x))},w.prototype.parseArrayPattern=function(m,y){var C=this.createNode();this.expect("[");for(var x=[];!this.match("]");)if(this.match(","))this.nextToken(),x.push(null);else{if(this.match("...")){x.push(this.parseBindingRestElement(m,y));break}x.push(this.parsePatternWithDefault(m,y)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(C,new f.ArrayPattern(x))},w.prototype.parsePropertyPattern=function(m,y){var C,x,S=this.createNode(),T=!1,_=!1;if(this.lookahead.type===3){var E=this.lookahead;C=this.parseVariableIdentifier();var D=this.finalize(S,new f.Identifier(E.value));if(this.match("=")){m.push(E),_=!0,this.nextToken();var b=this.parseAssignmentExpression();x=this.finalize(this.startNode(E),new f.AssignmentPattern(D,b))}else this.match(":")?(this.expect(":"),x=this.parsePatternWithDefault(m,y)):(m.push(E),_=!0,x=D)}else T=this.match("["),C=this.parseObjectPropertyKey(),this.expect(":"),x=this.parsePatternWithDefault(m,y);return this.finalize(S,new f.Property("init",C,T,x,!1,_))},w.prototype.parseObjectPattern=function(m,y){var C=this.createNode(),x=[];for(this.expect("{");!this.match("}");)x.push(this.parsePropertyPattern(m,y)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(C,new f.ObjectPattern(x))},w.prototype.parsePattern=function(m,y){var C;return this.match("[")?C=this.parseArrayPattern(m,y):this.match("{")?C=this.parseObjectPattern(m,y):(!this.matchKeyword("let")||y!=="const"&&y!=="let"||this.tolerateUnexpectedToken(this.lookahead,u.Messages.LetInLexicalBinding),m.push(this.lookahead),C=this.parseVariableIdentifier(y)),C},w.prototype.parsePatternWithDefault=function(m,y){var C=this.lookahead,x=this.parsePattern(m,y);if(this.match("=")){this.nextToken();var S=this.context.allowYield;this.context.allowYield=!0;var T=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=S,x=this.finalize(this.startNode(C),new f.AssignmentPattern(x,T))}return x},w.prototype.parseVariableIdentifier=function(m){var y=this.createNode(),C=this.nextToken();return C.type===4&&C.value==="yield"?this.context.strict?this.tolerateUnexpectedToken(C,u.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(C):C.type!==3?this.context.strict&&C.type===4&&this.scanner.isStrictModeReservedWord(C.value)?this.tolerateUnexpectedToken(C,u.Messages.StrictReservedWord):(this.context.strict||C.value!=="let"||m!=="var")&&this.throwUnexpectedToken(C):(this.context.isModule||this.context.await)&&C.type===3&&C.value==="await"&&this.tolerateUnexpectedToken(C),this.finalize(y,new f.Identifier(C.value))},w.prototype.parseVariableDeclaration=function(m){var y=this.createNode(),C=this.parsePattern([],"var");this.context.strict&&C.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(C.name)&&this.tolerateError(u.Messages.StrictVarName);var x=null;return this.match("=")?(this.nextToken(),x=this.isolateCoverGrammar(this.parseAssignmentExpression)):C.type===g.Syntax.Identifier||m.inFor||this.expect("="),this.finalize(y,new f.VariableDeclarator(C,x))},w.prototype.parseVariableDeclarationList=function(m){var y={inFor:m.inFor},C=[];for(C.push(this.parseVariableDeclaration(y));this.match(",");)this.nextToken(),C.push(this.parseVariableDeclaration(y));return C},w.prototype.parseVariableStatement=function(){var m=this.createNode();this.expectKeyword("var");var y=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(m,new f.VariableDeclaration(y,"var"))},w.prototype.parseEmptyStatement=function(){var m=this.createNode();return this.expect(";"),this.finalize(m,new f.EmptyStatement)},w.prototype.parseExpressionStatement=function(){var m=this.createNode(),y=this.parseExpression();return this.consumeSemicolon(),this.finalize(m,new f.ExpressionStatement(y))},w.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(u.Messages.StrictFunction),this.parseStatement()},w.prototype.parseIfStatement=function(){var m,y=this.createNode(),C=null;this.expectKeyword("if"),this.expect("(");var x=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),m=this.finalize(this.createNode(),new f.EmptyStatement)):(this.expect(")"),m=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),C=this.parseIfClause())),this.finalize(y,new f.IfStatement(x,m,C))},w.prototype.parseDoWhileStatement=function(){var m=this.createNode();this.expectKeyword("do");var y=this.context.inIteration;this.context.inIteration=!0;var C=this.parseStatement();this.context.inIteration=y,this.expectKeyword("while"),this.expect("(");var x=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(m,new f.DoWhileStatement(C,x))},w.prototype.parseWhileStatement=function(){var m,y=this.createNode();this.expectKeyword("while"),this.expect("(");var C=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),m=this.finalize(this.createNode(),new f.EmptyStatement);else{this.expect(")");var x=this.context.inIteration;this.context.inIteration=!0,m=this.parseStatement(),this.context.inIteration=x}return this.finalize(y,new f.WhileStatement(C,m))},w.prototype.parseForStatement=function(){var m,y,C,x=null,S=null,T=null,_=!0,E=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){x=this.createNode(),this.nextToken();var D=this.context.allowIn;this.context.allowIn=!1;var b=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=D,b.length===1&&this.matchKeyword("in")){var I=b[0];I.init&&(I.id.type===g.Syntax.ArrayPattern||I.id.type===g.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(u.Messages.ForInOfLoopInitializer,"for-in"),x=this.finalize(x,new f.VariableDeclaration(b,"var")),this.nextToken(),m=x,y=this.parseExpression(),x=null}else b.length===1&&b[0].init===null&&this.matchContextualKeyword("of")?(x=this.finalize(x,new f.VariableDeclaration(b,"var")),this.nextToken(),m=x,y=this.parseAssignmentExpression(),x=null,_=!1):(x=this.finalize(x,new f.VariableDeclaration(b,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){x=this.createNode();var O=this.nextToken().value;this.context.strict||this.lookahead.value!=="in"?(D=this.context.allowIn,this.context.allowIn=!1,b=this.parseBindingList(O,{inFor:!0}),this.context.allowIn=D,b.length===1&&b[0].init===null&&this.matchKeyword("in")?(x=this.finalize(x,new f.VariableDeclaration(b,O)),this.nextToken(),m=x,y=this.parseExpression(),x=null):b.length===1&&b[0].init===null&&this.matchContextualKeyword("of")?(x=this.finalize(x,new f.VariableDeclaration(b,O)),this.nextToken(),m=x,y=this.parseAssignmentExpression(),x=null,_=!1):(this.consumeSemicolon(),x=this.finalize(x,new f.VariableDeclaration(b,O)))):(x=this.finalize(x,new f.Identifier(O)),this.nextToken(),m=x,y=this.parseExpression(),x=null)}else{var M=this.lookahead;if(D=this.context.allowIn,this.context.allowIn=!1,x=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=D,this.matchKeyword("in"))this.context.isAssignmentTarget&&x.type!==g.Syntax.AssignmentExpression||this.tolerateError(u.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(x),m=x,y=this.parseExpression(),x=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&x.type!==g.Syntax.AssignmentExpression||this.tolerateError(u.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(x),m=x,y=this.parseAssignmentExpression(),x=null,_=!1;else{if(this.match(",")){for(var R=[x];this.match(",");)this.nextToken(),R.push(this.isolateCoverGrammar(this.parseAssignmentExpression));x=this.finalize(this.startNode(M),new f.SequenceExpression(R))}this.expect(";")}}if(m===void 0&&(this.match(";")||(S=this.parseExpression()),this.expect(";"),this.match(")")||(T=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),C=this.finalize(this.createNode(),new f.EmptyStatement);else{this.expect(")");var A=this.context.inIteration;this.context.inIteration=!0,C=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=A}return m===void 0?this.finalize(E,new f.ForStatement(x,S,T,C)):_?this.finalize(E,new f.ForInStatement(m,y,C)):this.finalize(E,new f.ForOfStatement(m,y,C))},w.prototype.parseContinueStatement=function(){var m=this.createNode();this.expectKeyword("continue");var y=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var C=this.parseVariableIdentifier();y=C;var x="$"+C.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,x)||this.throwError(u.Messages.UnknownLabel,C.name)}return this.consumeSemicolon(),y!==null||this.context.inIteration||this.throwError(u.Messages.IllegalContinue),this.finalize(m,new f.ContinueStatement(y))},w.prototype.parseBreakStatement=function(){var m=this.createNode();this.expectKeyword("break");var y=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var C=this.parseVariableIdentifier(),x="$"+C.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,x)||this.throwError(u.Messages.UnknownLabel,C.name),y=C}return this.consumeSemicolon(),y!==null||this.context.inIteration||this.context.inSwitch||this.throwError(u.Messages.IllegalBreak),this.finalize(m,new f.BreakStatement(y))},w.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(u.Messages.IllegalReturn);var m=this.createNode();this.expectKeyword("return");var y=(this.match(";")||this.match("}")||this.hasLineTerminator||this.lookahead.type===2)&&this.lookahead.type!==8&&this.lookahead.type!==10?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(m,new f.ReturnStatement(y))},w.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(u.Messages.StrictModeWith);var m,y=this.createNode();this.expectKeyword("with"),this.expect("(");var C=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),m=this.finalize(this.createNode(),new f.EmptyStatement)):(this.expect(")"),m=this.parseStatement()),this.finalize(y,new f.WithStatement(C,m))},w.prototype.parseSwitchCase=function(){var m,y=this.createNode();this.matchKeyword("default")?(this.nextToken(),m=null):(this.expectKeyword("case"),m=this.parseExpression()),this.expect(":");for(var C=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)C.push(this.parseStatementListItem());return this.finalize(y,new f.SwitchCase(m,C))},w.prototype.parseSwitchStatement=function(){var m=this.createNode();this.expectKeyword("switch"),this.expect("(");var y=this.parseExpression();this.expect(")");var C=this.context.inSwitch;this.context.inSwitch=!0;var x=[],S=!1;for(this.expect("{");!this.match("}");){var T=this.parseSwitchCase();T.test===null&&(S&&this.throwError(u.Messages.MultipleDefaultsInSwitch),S=!0),x.push(T)}return this.expect("}"),this.context.inSwitch=C,this.finalize(m,new f.SwitchStatement(y,x))},w.prototype.parseLabelledStatement=function(){var m,y=this.createNode(),C=this.parseExpression();if(C.type===g.Syntax.Identifier&&this.match(":")){this.nextToken();var x=C,S="$"+x.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,S)&&this.throwError(u.Messages.Redeclaration,"Label",x.name),this.context.labelSet[S]=!0;var T=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),T=this.parseClassDeclaration();else if(this.matchKeyword("function")){var _=this.lookahead,E=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(_,u.Messages.StrictFunction):E.generator&&this.tolerateUnexpectedToken(_,u.Messages.GeneratorInLegacyContext),T=E}else T=this.parseStatement();delete this.context.labelSet[S],m=new f.LabeledStatement(x,T)}else this.consumeSemicolon(),m=new f.ExpressionStatement(C);return this.finalize(y,m)},w.prototype.parseThrowStatement=function(){var m=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(u.Messages.NewlineAfterThrow);var y=this.parseExpression();return this.consumeSemicolon(),this.finalize(m,new f.ThrowStatement(y))},w.prototype.parseCatchClause=function(){var m=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var y=[],C=this.parsePattern(y),x={},S=0;S<y.length;S++){var T="$"+y[S].value;Object.prototype.hasOwnProperty.call(x,T)&&this.tolerateError(u.Messages.DuplicateBinding,y[S].value),x[T]=!0}this.context.strict&&C.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(C.name)&&this.tolerateError(u.Messages.StrictCatchVariable),this.expect(")");var _=this.parseBlock();return this.finalize(m,new f.CatchClause(C,_))},w.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},w.prototype.parseTryStatement=function(){var m=this.createNode();this.expectKeyword("try");var y=this.parseBlock(),C=this.matchKeyword("catch")?this.parseCatchClause():null,x=this.matchKeyword("finally")?this.parseFinallyClause():null;return C||x||this.throwError(u.Messages.NoCatchOrFinally),this.finalize(m,new f.TryStatement(y,C,x))},w.prototype.parseDebuggerStatement=function(){var m=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(m,new f.DebuggerStatement)},w.prototype.parseStatement=function(){var m;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:m=this.parseExpressionStatement();break;case 7:var y=this.lookahead.value;m=y==="{"?this.parseBlock():y==="("?this.parseExpressionStatement():y===";"?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:m=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":m=this.parseBreakStatement();break;case"continue":m=this.parseContinueStatement();break;case"debugger":m=this.parseDebuggerStatement();break;case"do":m=this.parseDoWhileStatement();break;case"for":m=this.parseForStatement();break;case"function":m=this.parseFunctionDeclaration();break;case"if":m=this.parseIfStatement();break;case"return":m=this.parseReturnStatement();break;case"switch":m=this.parseSwitchStatement();break;case"throw":m=this.parseThrowStatement();break;case"try":m=this.parseTryStatement();break;case"var":m=this.parseVariableStatement();break;case"while":m=this.parseWhileStatement();break;case"with":m=this.parseWithStatement();break;default:m=this.parseExpressionStatement()}break;default:m=this.throwUnexpectedToken(this.lookahead)}return m},w.prototype.parseFunctionSourceElements=function(){var m=this.createNode();this.expect("{");var y=this.parseDirectivePrologues(),C=this.context.labelSet,x=this.context.inIteration,S=this.context.inSwitch,T=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;this.lookahead.type!==2&&!this.match("}");)y.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=C,this.context.inIteration=x,this.context.inSwitch=S,this.context.inFunctionBody=T,this.finalize(m,new f.BlockStatement(y))},w.prototype.validateParam=function(m,y,C){var x="$"+C;this.context.strict?(this.scanner.isRestrictedWord(C)&&(m.stricted=y,m.message=u.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(m.paramSet,x)&&(m.stricted=y,m.message=u.Messages.StrictParamDupe)):m.firstRestricted||(this.scanner.isRestrictedWord(C)?(m.firstRestricted=y,m.message=u.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(C)?(m.firstRestricted=y,m.message=u.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(m.paramSet,x)&&(m.stricted=y,m.message=u.Messages.StrictParamDupe)),typeof Object.defineProperty=="function"?Object.defineProperty(m.paramSet,x,{value:!0,enumerable:!0,writable:!0,configurable:!0}):m.paramSet[x]=!0},w.prototype.parseRestElement=function(m){var y=this.createNode();this.expect("...");var C=this.parsePattern(m);return this.match("=")&&this.throwError(u.Messages.DefaultRestParameter),this.match(")")||this.throwError(u.Messages.ParameterAfterRestParameter),this.finalize(y,new f.RestElement(C))},w.prototype.parseFormalParameter=function(m){for(var y=[],C=this.match("...")?this.parseRestElement(y):this.parsePatternWithDefault(y),x=0;x<y.length;x++)this.validateParam(m,y[x],y[x].value);m.simple=m.simple&&C instanceof f.Identifier,m.params.push(C)},w.prototype.parseFormalParameters=function(m){var y;if(y={simple:!0,params:[],firstRestricted:m},this.expect("("),!this.match(")"))for(y.paramSet={};this.lookahead.type!==2&&(this.parseFormalParameter(y),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:y.simple,params:y.params,stricted:y.stricted,firstRestricted:y.firstRestricted,message:y.message}},w.prototype.matchAsyncFunction=function(){var m=this.matchContextualKeyword("async");if(m){var y=this.scanner.saveState();this.scanner.scanComments();var C=this.scanner.lex();this.scanner.restoreState(y),m=y.lineNumber===C.lineNumber&&C.type===4&&C.value==="function"}return m},w.prototype.parseFunctionDeclaration=function(m){var y=this.createNode(),C=this.matchContextualKeyword("async");C&&this.nextToken(),this.expectKeyword("function");var x,S=!C&&this.match("*");S&&this.nextToken();var T=null,_=null;if(!m||!this.match("(")){var E=this.lookahead;T=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(E.value)&&this.tolerateUnexpectedToken(E,u.Messages.StrictFunctionName):this.scanner.isRestrictedWord(E.value)?(_=E,x=u.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(E.value)&&(_=E,x=u.Messages.StrictReservedWord)}var D=this.context.await,b=this.context.allowYield;this.context.await=C,this.context.allowYield=!S;var I=this.parseFormalParameters(_),O=I.params,M=I.stricted;_=I.firstRestricted,I.message&&(x=I.message);var R=this.context.strict,A=this.context.allowStrictDirective;this.context.allowStrictDirective=I.simple;var G=this.parseFunctionSourceElements();return this.context.strict&&_&&this.throwUnexpectedToken(_,x),this.context.strict&&M&&this.tolerateUnexpectedToken(M,x),this.context.strict=R,this.context.allowStrictDirective=A,this.context.await=D,this.context.allowYield=b,C?this.finalize(y,new f.AsyncFunctionDeclaration(T,O,G)):this.finalize(y,new f.FunctionDeclaration(T,O,G,S))},w.prototype.parseFunctionExpression=function(){var m=this.createNode(),y=this.matchContextualKeyword("async");y&&this.nextToken(),this.expectKeyword("function");var C,x=!y&&this.match("*");x&&this.nextToken();var S,T=null,_=this.context.await,E=this.context.allowYield;if(this.context.await=y,this.context.allowYield=!x,!this.match("(")){var D=this.lookahead;T=this.context.strict||x||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(D.value)&&this.tolerateUnexpectedToken(D,u.Messages.StrictFunctionName):this.scanner.isRestrictedWord(D.value)?(S=D,C=u.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(D.value)&&(S=D,C=u.Messages.StrictReservedWord)}var b=this.parseFormalParameters(S),I=b.params,O=b.stricted;S=b.firstRestricted,b.message&&(C=b.message);var M=this.context.strict,R=this.context.allowStrictDirective;this.context.allowStrictDirective=b.simple;var A=this.parseFunctionSourceElements();return this.context.strict&&S&&this.throwUnexpectedToken(S,C),this.context.strict&&O&&this.tolerateUnexpectedToken(O,C),this.context.strict=M,this.context.allowStrictDirective=R,this.context.await=_,this.context.allowYield=E,y?this.finalize(m,new f.AsyncFunctionExpression(T,I,A)):this.finalize(m,new f.FunctionExpression(T,I,A,x))},w.prototype.parseDirective=function(){var m=this.lookahead,y=this.createNode(),C=this.parseExpression(),x=C.type===g.Syntax.Literal?this.getTokenRaw(m).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(y,x?new f.Directive(C,x):new f.ExpressionStatement(C))},w.prototype.parseDirectivePrologues=function(){for(var m=null,y=[];;){var C=this.lookahead;if(C.type!==8)break;var x=this.parseDirective();y.push(x);var S=x.directive;if(typeof S!="string")break;S==="use strict"?(this.context.strict=!0,m&&this.tolerateUnexpectedToken(m,u.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(C,u.Messages.IllegalLanguageModeDirective)):!m&&C.octal&&(m=C)}return y},w.prototype.qualifiedPropertyName=function(m){switch(m.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return m.value==="["}return!1},w.prototype.parseGetterMethod=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters();C.params.length>0&&this.tolerateError(u.Messages.BadGetterArity);var x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(m,new f.FunctionExpression(null,C.params,x,!1))},w.prototype.parseSetterMethod=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters();C.params.length!==1?this.tolerateError(u.Messages.BadSetterArity):C.params[0]instanceof f.RestElement&&this.tolerateError(u.Messages.BadSetterRestParameter);var x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(m,new f.FunctionExpression(null,C.params,x,!1))},w.prototype.parseGeneratorMethod=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var C=this.parseFormalParameters();this.context.allowYield=!1;var x=this.parsePropertyMethod(C);return this.context.allowYield=y,this.finalize(m,new f.FunctionExpression(null,C.params,x,!0))},w.prototype.isStartOfExpression=function(){var m=!0,y=this.lookahead.value;switch(this.lookahead.type){case 7:m=y==="["||y==="("||y==="{"||y==="+"||y==="-"||y==="!"||y==="~"||y==="++"||y==="--"||y==="/"||y==="/=";break;case 4:m=y==="class"||y==="delete"||y==="function"||y==="let"||y==="new"||y==="super"||y==="this"||y==="typeof"||y==="void"||y==="yield"}return m},w.prototype.parseYieldExpression=function(){var m=this.createNode();this.expectKeyword("yield");var y=null,C=!1;if(!this.hasLineTerminator){var x=this.context.allowYield;this.context.allowYield=!1,(C=this.match("*"))?(this.nextToken(),y=this.parseAssignmentExpression()):this.isStartOfExpression()&&(y=this.parseAssignmentExpression()),this.context.allowYield=x}return this.finalize(m,new f.YieldExpression(y,C))},w.prototype.parseClassElement=function(m){var y=this.lookahead,C=this.createNode(),x="",S=null,T=null,_=!1,E=!1,D=!1,b=!1;if(this.match("*"))this.nextToken();else if(_=this.match("["),(S=this.parseObjectPropertyKey()).name==="static"&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(y=this.lookahead,D=!0,_=this.match("["),this.match("*")?this.nextToken():S=this.parseObjectPropertyKey()),y.type===3&&!this.hasLineTerminator&&y.value==="async"){var I=this.lookahead.value;I!==":"&&I!=="("&&I!=="*"&&(b=!0,y=this.lookahead,S=this.parseObjectPropertyKey(),y.type===3&&y.value==="constructor"&&this.tolerateUnexpectedToken(y,u.Messages.ConstructorIsAsync))}var O=this.qualifiedPropertyName(this.lookahead);return y.type===3?y.value==="get"&&O?(x="get",_=this.match("["),S=this.parseObjectPropertyKey(),this.context.allowYield=!1,T=this.parseGetterMethod()):y.value==="set"&&O&&(x="set",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseSetterMethod()):y.type===7&&y.value==="*"&&O&&(x="init",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseGeneratorMethod(),E=!0),!x&&S&&this.match("(")&&(x="init",T=b?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),E=!0),x||this.throwUnexpectedToken(this.lookahead),x==="init"&&(x="method"),_||(D&&this.isPropertyKey(S,"prototype")&&this.throwUnexpectedToken(y,u.Messages.StaticPrototype),!D&&this.isPropertyKey(S,"constructor")&&((x!=="method"||!E||T&&T.generator)&&this.throwUnexpectedToken(y,u.Messages.ConstructorSpecialMethod),m.value?this.throwUnexpectedToken(y,u.Messages.DuplicateConstructor):m.value=!0,x="constructor")),this.finalize(C,new f.MethodDefinition(S,_,T,x,D))},w.prototype.parseClassElementList=function(){var m=[],y={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():m.push(this.parseClassElement(y));return this.expect("}"),m},w.prototype.parseClassBody=function(){var m=this.createNode(),y=this.parseClassElementList();return this.finalize(m,new f.ClassBody(y))},w.prototype.parseClassDeclaration=function(m){var y=this.createNode(),C=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var x=m&&this.lookahead.type!==3?null:this.parseVariableIdentifier(),S=null;this.matchKeyword("extends")&&(this.nextToken(),S=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var T=this.parseClassBody();return this.context.strict=C,this.finalize(y,new f.ClassDeclaration(x,S,T))},w.prototype.parseClassExpression=function(){var m=this.createNode(),y=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var C=this.lookahead.type===3?this.parseVariableIdentifier():null,x=null;this.matchKeyword("extends")&&(this.nextToken(),x=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var S=this.parseClassBody();return this.context.strict=y,this.finalize(m,new f.ClassExpression(C,x,S))},w.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var m=this.createNode(),y=this.parseDirectivePrologues();this.lookahead.type!==2;)y.push(this.parseStatementListItem());return this.finalize(m,new f.Module(y))},w.prototype.parseScript=function(){for(var m=this.createNode(),y=this.parseDirectivePrologues();this.lookahead.type!==2;)y.push(this.parseStatementListItem());return this.finalize(m,new f.Script(y))},w.prototype.parseModuleSpecifier=function(){var m=this.createNode();this.lookahead.type!==8&&this.throwError(u.Messages.InvalidModuleSpecifier);var y=this.nextToken(),C=this.getTokenRaw(y);return this.finalize(m,new f.Literal(y.value,C))},w.prototype.parseImportSpecifier=function(){var m,y,C=this.createNode();return this.lookahead.type===3?(y=m=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),y=this.parseVariableIdentifier())):(y=m=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),y=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(C,new f.ImportSpecifier(y,m))},w.prototype.parseNamedImports=function(){this.expect("{");for(var m=[];!this.match("}");)m.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),m},w.prototype.parseImportDefaultSpecifier=function(){var m=this.createNode(),y=this.parseIdentifierName();return this.finalize(m,new f.ImportDefaultSpecifier(y))},w.prototype.parseImportNamespaceSpecifier=function(){var m=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(u.Messages.NoAsAfterImportNamespace),this.nextToken();var y=this.parseIdentifierName();return this.finalize(m,new f.ImportNamespaceSpecifier(y))},w.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(u.Messages.IllegalImportDeclaration);var m,y=this.createNode();this.expectKeyword("import");var C=[];if(this.lookahead.type===8)m=this.parseModuleSpecifier();else{if(this.match("{")?C=C.concat(this.parseNamedImports()):this.match("*")?C.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(C.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?C.push(this.parseImportNamespaceSpecifier()):this.match("{")?C=C.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var x=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause;this.throwError(x,this.lookahead.value)}this.nextToken(),m=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(y,new f.ImportDeclaration(C,m))},w.prototype.parseExportSpecifier=function(){var m=this.createNode(),y=this.parseIdentifierName(),C=y;return this.matchContextualKeyword("as")&&(this.nextToken(),C=this.parseIdentifierName()),this.finalize(m,new f.ExportSpecifier(y,C))},w.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(u.Messages.IllegalExportDeclaration);var m,y=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var C=this.parseFunctionDeclaration(!0);m=this.finalize(y,new f.ExportDefaultDeclaration(C))}else this.matchKeyword("class")?(C=this.parseClassDeclaration(!0),m=this.finalize(y,new f.ExportDefaultDeclaration(C))):this.matchContextualKeyword("async")?(C=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),m=this.finalize(y,new f.ExportDefaultDeclaration(C))):(this.matchContextualKeyword("from")&&this.throwError(u.Messages.UnexpectedToken,this.lookahead.value),C=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),m=this.finalize(y,new f.ExportDefaultDeclaration(C)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var x=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause;this.throwError(x,this.lookahead.value)}this.nextToken();var S=this.parseModuleSpecifier();this.consumeSemicolon(),m=this.finalize(y,new f.ExportAllDeclaration(S))}else if(this.lookahead.type===4){switch(C=void 0,this.lookahead.value){case"let":case"const":C=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":C=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}m=this.finalize(y,new f.ExportNamedDeclaration(C,[],null))}else if(this.matchAsyncFunction())C=this.parseFunctionDeclaration(),m=this.finalize(y,new f.ExportNamedDeclaration(C,[],null));else{var T=[],_=null,E=!1;for(this.expect("{");!this.match("}");)E=E||this.matchKeyword("default"),T.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),_=this.parseModuleSpecifier(),this.consumeSemicolon()):E?(x=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause,this.throwError(x,this.lookahead.value)):this.consumeSemicolon(),m=this.finalize(y,new f.ExportNamedDeclaration(null,T,_))}return m},w})();s.Parser=v},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.assert=function(c,l){if(!c)throw new Error("ASSERT: "+l)}},function(a,s){Object.defineProperty(s,"__esModule",{value:!0});var c=(function(){function l(){this.errors=[],this.tolerant=!1}return l.prototype.recordError=function(d){this.errors.push(d)},l.prototype.tolerate=function(d){if(!this.tolerant)throw d;this.recordError(d)},l.prototype.constructError=function(d,u){var f=new Error(d);try{throw f}catch(h){Object.create&&Object.defineProperty&&(f=Object.create(h),Object.defineProperty(f,"column",{value:u}))}return f},l.prototype.createError=function(d,u,f,h){var g="Line "+u+": "+h,p=this.constructError(g,f);return p.index=d,p.lineNumber=u,p.description=h,p},l.prototype.throwError=function(d,u,f,h){throw this.createError(d,u,f,h)},l.prototype.tolerateError=function(d,u,f,h){var g=this.createError(d,u,f,h);if(!this.tolerant)throw g;this.recordError(g)},l})();s.ErrorHandler=c},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(9),d=c(4),u=c(11);function f(p){return"0123456789abcdef".indexOf(p.toLowerCase())}function h(p){return"01234567".indexOf(p)}var g=(function(){function p(v,w){this.source=v,this.errorHandler=w,this.trackComment=!1,this.isModule=!1,this.length=v.length,this.index=0,this.lineNumber=v.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return p.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},p.prototype.restoreState=function(v){this.index=v.index,this.lineNumber=v.lineNumber,this.lineStart=v.lineStart},p.prototype.eof=function(){return this.index>=this.length},p.prototype.throwUnexpectedToken=function(v){return v===void 0&&(v=u.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,v)},p.prototype.tolerateUnexpectedToken=function(v){v===void 0&&(v=u.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,v)},p.prototype.skipSingleLineComment=function(v){var w,m,y=[];for(this.trackComment&&(y=[],w=this.index-v,m={start:{line:this.lineNumber,column:this.index-this.lineStart-v},end:{}});!this.eof();){var C=this.source.charCodeAt(this.index);if(++this.index,d.Character.isLineTerminator(C)){if(this.trackComment){m.end={line:this.lineNumber,column:this.index-this.lineStart-1};var x={multiLine:!1,slice:[w+v,this.index-1],range:[w,this.index-1],loc:m};y.push(x)}return C===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,y}}return this.trackComment&&(m.end={line:this.lineNumber,column:this.index-this.lineStart},x={multiLine:!1,slice:[w+v,this.index],range:[w,this.index],loc:m},y.push(x)),y},p.prototype.skipMultiLineComment=function(){var v,w,m=[];for(this.trackComment&&(m=[],v=this.index-2,w={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var y=this.source.charCodeAt(this.index);if(d.Character.isLineTerminator(y))y===13&&this.source.charCodeAt(this.index+1)===10&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(y===42){if(this.source.charCodeAt(this.index+1)===47){if(this.index+=2,this.trackComment){w.end={line:this.lineNumber,column:this.index-this.lineStart};var C={multiLine:!0,slice:[v+2,this.index-2],range:[v,this.index],loc:w};m.push(C)}return m}++this.index}else++this.index}return this.trackComment&&(w.end={line:this.lineNumber,column:this.index-this.lineStart},C={multiLine:!0,slice:[v+2,this.index],range:[v,this.index],loc:w},m.push(C)),this.tolerateUnexpectedToken(),m},p.prototype.scanComments=function(){var v;this.trackComment&&(v=[]);for(var w=this.index===0;!this.eof();){var m=this.source.charCodeAt(this.index);if(d.Character.isWhiteSpace(m))++this.index;else if(d.Character.isLineTerminator(m))++this.index,m===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,w=!0;else if(m===47)if((m=this.source.charCodeAt(this.index+1))===47){this.index+=2;var y=this.skipSingleLineComment(2);this.trackComment&&(v=v.concat(y)),w=!0}else{if(m!==42)break;this.index+=2,y=this.skipMultiLineComment(),this.trackComment&&(v=v.concat(y))}else if(w&&m===45){if(this.source.charCodeAt(this.index+1)!==45||this.source.charCodeAt(this.index+2)!==62)break;this.index+=3,y=this.skipSingleLineComment(3),this.trackComment&&(v=v.concat(y))}else{if(m!==60||this.isModule||this.source.slice(this.index+1,this.index+4)!=="!--")break;this.index+=4,y=this.skipSingleLineComment(4),this.trackComment&&(v=v.concat(y))}}return v},p.prototype.isFutureReservedWord=function(v){switch(v){case"enum":case"export":case"import":case"super":return!0;default:return!1}},p.prototype.isStrictModeReservedWord=function(v){switch(v){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},p.prototype.isRestrictedWord=function(v){return v==="eval"||v==="arguments"},p.prototype.isKeyword=function(v){switch(v.length){case 2:return v==="if"||v==="in"||v==="do";case 3:return v==="var"||v==="for"||v==="new"||v==="try"||v==="let";case 4:return v==="this"||v==="else"||v==="case"||v==="void"||v==="with"||v==="enum";case 5:return v==="while"||v==="break"||v==="catch"||v==="throw"||v==="const"||v==="yield"||v==="class"||v==="super";case 6:return v==="return"||v==="typeof"||v==="delete"||v==="switch"||v==="export"||v==="import";case 7:return v==="default"||v==="finally"||v==="extends";case 8:return v==="function"||v==="continue"||v==="debugger";case 10:return v==="instanceof";default:return!1}},p.prototype.codePointAt=function(v){var w=this.source.charCodeAt(v);if(w>=55296&&w<=56319){var m=this.source.charCodeAt(v+1);m>=56320&&m<=57343&&(w=1024*(w-55296)+m-56320+65536)}return w},p.prototype.scanHexEscape=function(v){for(var w=v==="u"?4:2,m=0,y=0;y<w;++y){if(this.eof()||!d.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;m=16*m+f(this.source[this.index++])}return String.fromCharCode(m)},p.prototype.scanUnicodeCodePointEscape=function(){var v=this.source[this.index],w=0;for(v==="}"&&this.throwUnexpectedToken();!this.eof()&&(v=this.source[this.index++],d.Character.isHexDigit(v.charCodeAt(0)));)w=16*w+f(v);return(w>1114111||v!=="}")&&this.throwUnexpectedToken(),d.Character.fromCodePoint(w)},p.prototype.getIdentifier=function(){for(var v=this.index++;!this.eof();){var w=this.source.charCodeAt(this.index);if(w===92)return this.index=v,this.getComplexIdentifier();if(w>=55296&&w<57343)return this.index=v,this.getComplexIdentifier();if(!d.Character.isIdentifierPart(w))break;++this.index}return this.source.slice(v,this.index)},p.prototype.getComplexIdentifier=function(){var v,w=this.codePointAt(this.index),m=d.Character.fromCodePoint(w);for(this.index+=m.length,w===92&&(this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,v=this.scanUnicodeCodePointEscape()):(v=this.scanHexEscape("u"))!==null&&v!=="\\"&&d.Character.isIdentifierStart(v.charCodeAt(0))||this.throwUnexpectedToken(),m=v);!this.eof()&&(w=this.codePointAt(this.index),d.Character.isIdentifierPart(w));)m+=v=d.Character.fromCodePoint(w),this.index+=v.length,w===92&&(m=m.substr(0,m.length-1),this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,v=this.scanUnicodeCodePointEscape()):(v=this.scanHexEscape("u"))!==null&&v!=="\\"&&d.Character.isIdentifierPart(v.charCodeAt(0))||this.throwUnexpectedToken(),m+=v);return m},p.prototype.octalToDecimal=function(v){var w=v!=="0",m=h(v);return!this.eof()&&d.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(w=!0,m=8*m+h(this.source[this.index++]),"0123".indexOf(v)>=0&&!this.eof()&&d.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(m=8*m+h(this.source[this.index++]))),{code:m,octal:w}},p.prototype.scanIdentifier=function(){var v,w=this.index,m=this.source.charCodeAt(w)===92?this.getComplexIdentifier():this.getIdentifier();if((v=m.length===1?3:this.isKeyword(m)?4:m==="null"?5:m==="true"||m==="false"?1:3)!=3&&w+m.length!==this.index){var y=this.index;this.index=w,this.tolerateUnexpectedToken(u.Messages.InvalidEscapedReservedWord),this.index=y}return{type:v,value:m,lineNumber:this.lineNumber,lineStart:this.lineStart,start:w,end:this.index}},p.prototype.scanPunctuator=function(){var v=this.index,w=this.source[this.index];switch(w){case"(":case"{":w==="{"&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,this.source[this.index]==="."&&this.source[this.index+1]==="."&&(this.index+=2,w="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:(w=this.source.substr(this.index,4))===">>>="?this.index+=4:(w=w.substr(0,3))==="==="||w==="!=="||w===">>>"||w==="<<="||w===">>="||w==="**="?this.index+=3:(w=w.substr(0,2))==="&&"||w==="||"||w==="=="||w==="!="||w==="+="||w==="-="||w==="*="||w==="/="||w==="++"||w==="--"||w==="<<"||w===">>"||w==="&="||w==="|="||w==="^="||w==="%="||w==="<="||w===">="||w==="=>"||w==="**"?this.index+=2:(w=this.source[this.index],"<>=!+-*%&|^/".indexOf(w)>=0&&++this.index)}return this.index===v&&this.throwUnexpectedToken(),{type:7,value:w,lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanHexLiteral=function(v){for(var w="";!this.eof()&&d.Character.isHexDigit(this.source.charCodeAt(this.index));)w+=this.source[this.index++];return w.length===0&&this.throwUnexpectedToken(),d.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+w,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanBinaryLiteral=function(v){for(var w,m="";!this.eof()&&((w=this.source[this.index])==="0"||w==="1");)m+=this.source[this.index++];return m.length===0&&this.throwUnexpectedToken(),this.eof()||(w=this.source.charCodeAt(this.index),(d.Character.isIdentifierStart(w)||d.Character.isDecimalDigit(w))&&this.throwUnexpectedToken()),{type:6,value:parseInt(m,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanOctalLiteral=function(v,w){var m="",y=!1;for(d.Character.isOctalDigit(v.charCodeAt(0))?(y=!0,m="0"+this.source[this.index++]):++this.index;!this.eof()&&d.Character.isOctalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];return y||m.length!==0||this.throwUnexpectedToken(),(d.Character.isIdentifierStart(this.source.charCodeAt(this.index))||d.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(m,8),octal:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:w,end:this.index}},p.prototype.isImplicitOctalLiteral=function(){for(var v=this.index+1;v<this.length;++v){var w=this.source[v];if(w==="8"||w==="9")return!1;if(!d.Character.isOctalDigit(w.charCodeAt(0)))return!0}return!0},p.prototype.scanNumericLiteral=function(){var v=this.index,w=this.source[v];l.assert(d.Character.isDecimalDigit(w.charCodeAt(0))||w===".","Numeric literal must start with a decimal digit or a decimal point");var m="";if(w!=="."){if(m=this.source[this.index++],w=this.source[this.index],m==="0"){if(w==="x"||w==="X")return++this.index,this.scanHexLiteral(v);if(w==="b"||w==="B")return++this.index,this.scanBinaryLiteral(v);if(w==="o"||w==="O")return this.scanOctalLiteral(w,v);if(w&&d.Character.isOctalDigit(w.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(w,v)}for(;d.Character.isDecimalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];w=this.source[this.index]}if(w==="."){for(m+=this.source[this.index++];d.Character.isDecimalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];w=this.source[this.index]}if(w==="e"||w==="E")if(m+=this.source[this.index++],(w=this.source[this.index])!=="+"&&w!=="-"||(m+=this.source[this.index++]),d.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;d.Character.isDecimalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];else this.throwUnexpectedToken();return d.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(m),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanStringLiteral=function(){var v=this.index,w=this.source[v];l.assert(w==="'"||w==='"',"String literal must starts with a quote"),++this.index;for(var m=!1,y="";!this.eof();){var C=this.source[this.index++];if(C===w){w="";break}if(C==="\\")if((C=this.source[this.index++])&&d.Character.isLineTerminator(C.charCodeAt(0)))++this.lineNumber,C==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(C){case"u":if(this.source[this.index]==="{")++this.index,y+=this.scanUnicodeCodePointEscape();else{var x=this.scanHexEscape(C);x===null&&this.throwUnexpectedToken(),y+=x}break;case"x":var S=this.scanHexEscape(C);S===null&&this.throwUnexpectedToken(u.Messages.InvalidHexEscapeSequence),y+=S;break;case"n":y+=`
`;break;case"r":y+="\r";break;case"t":y+="	";break;case"b":y+="\b";break;case"f":y+="\f";break;case"v":y+="\v";break;case"8":case"9":y+=C,this.tolerateUnexpectedToken();break;default:if(C&&d.Character.isOctalDigit(C.charCodeAt(0))){var T=this.octalToDecimal(C);m=T.octal||m,y+=String.fromCharCode(T.code)}else y+=C}else{if(d.Character.isLineTerminator(C.charCodeAt(0)))break;y+=C}}return w!==""&&(this.index=v,this.throwUnexpectedToken()),{type:8,value:y,octal:m,lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanTemplate=function(){var v="",w=!1,m=this.index,y=this.source[m]==="`",C=!1,x=2;for(++this.index;!this.eof();){var S=this.source[this.index++];if(S==="`"){x=1,C=!0,w=!0;break}if(S==="$"){if(this.source[this.index]==="{"){this.curlyStack.push("${"),++this.index,w=!0;break}v+=S}else if(S==="\\")if(S=this.source[this.index++],d.Character.isLineTerminator(S.charCodeAt(0)))++this.lineNumber,S==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(S){case"n":v+=`
`;break;case"r":v+="\r";break;case"t":v+="	";break;case"u":if(this.source[this.index]==="{")++this.index,v+=this.scanUnicodeCodePointEscape();else{var T=this.index,_=this.scanHexEscape(S);_!==null?v+=_:(this.index=T,v+=S)}break;case"x":var E=this.scanHexEscape(S);E===null&&this.throwUnexpectedToken(u.Messages.InvalidHexEscapeSequence),v+=E;break;case"b":v+="\b";break;case"f":v+="\f";break;case"v":v+="\v";break;default:S==="0"?(d.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(u.Messages.TemplateOctalLiteral),v+="\0"):d.Character.isOctalDigit(S.charCodeAt(0))?this.throwUnexpectedToken(u.Messages.TemplateOctalLiteral):v+=S}else d.Character.isLineTerminator(S.charCodeAt(0))?(++this.lineNumber,S==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index,v+=`
`):v+=S}return w||this.throwUnexpectedToken(),y||this.curlyStack.pop(),{type:10,value:this.source.slice(m+1,this.index-x),cooked:v,head:y,tail:C,lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.testRegExp=function(v,w){var m=v,y=this;w.indexOf("u")>=0&&(m=m.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(C,x,S){var T=parseInt(x||S,16);return T>1114111&&y.throwUnexpectedToken(u.Messages.InvalidRegExp),T<=65535?String.fromCharCode(T):""})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(m)}catch{this.throwUnexpectedToken(u.Messages.InvalidRegExp)}try{return new RegExp(v,w)}catch{return null}},p.prototype.scanRegExpBody=function(){var v=this.source[this.index];l.assert(v==="/","Regular expression literal must start with a slash");for(var w=this.source[this.index++],m=!1,y=!1;!this.eof();)if(w+=v=this.source[this.index++],v==="\\")v=this.source[this.index++],d.Character.isLineTerminator(v.charCodeAt(0))&&this.throwUnexpectedToken(u.Messages.UnterminatedRegExp),w+=v;else if(d.Character.isLineTerminator(v.charCodeAt(0)))this.throwUnexpectedToken(u.Messages.UnterminatedRegExp);else if(m)v==="]"&&(m=!1);else{if(v==="/"){y=!0;break}v==="["&&(m=!0)}return y||this.throwUnexpectedToken(u.Messages.UnterminatedRegExp),w.substr(1,w.length-2)},p.prototype.scanRegExpFlags=function(){for(var v="";!this.eof();){var w=this.source[this.index];if(!d.Character.isIdentifierPart(w.charCodeAt(0)))break;if(++this.index,w!=="\\"||this.eof())v+=w;else if((w=this.source[this.index])==="u"){++this.index;var m=this.index,y=this.scanHexEscape("u");if(y!==null)for(v+=y;m<this.index;++m)this.source[m];else this.index=m,v+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return v},p.prototype.scanRegExp=function(){var v=this.index,w=this.scanRegExpBody(),m=this.scanRegExpFlags();return{type:9,value:"",pattern:w,flags:m,regex:this.testRegExp(w,m),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var v=this.source.charCodeAt(this.index);return d.Character.isIdentifierStart(v)?this.scanIdentifier():v===40||v===41||v===59?this.scanPunctuator():v===39||v===34?this.scanStringLiteral():v===46?d.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():d.Character.isDecimalDigit(v)?this.scanNumericLiteral():v===96||v===125&&this.curlyStack[this.curlyStack.length-1]==="${"?this.scanTemplate():v>=55296&&v<57343&&d.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},p})();s.Scanner=g},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenName={},s.TokenName[1]="Boolean",s.TokenName[2]="<end>",s.TokenName[3]="Identifier",s.TokenName[4]="Keyword",s.TokenName[5]="Null",s.TokenName[6]="Numeric",s.TokenName[7]="Punctuator",s.TokenName[8]="String",s.TokenName[9]="RegularExpression",s.TokenName[10]="Template"},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(10),d=c(12),u=c(13),f=(function(){function g(){this.values=[],this.curly=this.paren=-1}return g.prototype.beforeFunctionExpression=function(p){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(p)>=0},g.prototype.isRegexStart=function(){var p=this.values[this.values.length-1],v=p!==null;switch(p){case"this":case"]":v=!1;break;case")":var w=this.values[this.paren-1];v=w==="if"||w==="while"||w==="for"||w==="with";break;case"}":if(v=!1,this.values[this.curly-3]==="function")v=!!(m=this.values[this.curly-4])&&!this.beforeFunctionExpression(m);else if(this.values[this.curly-4]==="function"){var m;v=!(m=this.values[this.curly-5])||!this.beforeFunctionExpression(m)}}return v},g.prototype.push=function(p){p.type===7||p.type===4?(p.value==="{"?this.curly=this.values.length:p.value==="("&&(this.paren=this.values.length),this.values.push(p.value)):this.values.push(null)},g})(),h=(function(){function g(p,v){this.errorHandler=new l.ErrorHandler,this.errorHandler.tolerant=!!v&&typeof v.tolerant=="boolean"&&v.tolerant,this.scanner=new d.Scanner(p,this.errorHandler),this.scanner.trackComment=!!v&&typeof v.comment=="boolean"&&v.comment,this.trackRange=!!v&&typeof v.range=="boolean"&&v.range,this.trackLoc=!!v&&typeof v.loc=="boolean"&&v.loc,this.buffer=[],this.reader=new f}return g.prototype.errors=function(){return this.errorHandler.errors},g.prototype.getNextToken=function(){if(this.buffer.length===0){var p=this.scanner.scanComments();if(this.scanner.trackComment)for(var v=0;v<p.length;++v){var w=p[v],m=this.scanner.source.slice(w.slice[0],w.slice[1]),y={type:w.multiLine?"BlockComment":"LineComment",value:m};this.trackRange&&(y.range=w.range),this.trackLoc&&(y.loc=w.loc),this.buffer.push(y)}if(!this.scanner.eof()){var C=void 0;this.trackLoc&&(C={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var x=this.scanner.source[this.scanner.index]==="/"&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(x);var S={type:u.TokenName[x.type],value:this.scanner.source.slice(x.start,x.end)};if(this.trackRange&&(S.range=[x.start,x.end]),this.trackLoc&&(C.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},S.loc=C),x.type===9){var T=x.pattern,_=x.flags;S.regex={pattern:T,flags:_}}this.buffer.push(S)}}return this.buffer.shift()},g})();s.Tokenizer=h}])},r.exports=o()},function(r,n,i){var o=i(38),a=i(53),s=i(76),c=i(54),l=Object.prototype.toString,d=Object.prototype.hasOwnProperty,u={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},f=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function h(M){var R,A,G;if(R=M.toString(16).toUpperCase(),M<=255)A="x",G=2;else if(M<=65535)A="u",G=4;else{if(!(M<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");A="U",G=8}return"\\"+A+o.repeat("0",G-R.length)+R}function g(M){this.schema=M.schema||s,this.indent=Math.max(1,M.indent||2),this.noArrayIndent=M.noArrayIndent||!1,this.skipInvalid=M.skipInvalid||!1,this.flowLevel=o.isNothing(M.flowLevel)?-1:M.flowLevel,this.styleMap=(function(R,A){var G,k,L,F,j,Y,ie;if(A===null)return{};for(G={},L=0,F=(k=Object.keys(A)).length;L<F;L+=1)j=k[L],Y=String(A[j]),j.slice(0,2)==="!!"&&(j="tag:yaml.org,2002:"+j.slice(2)),(ie=R.compiledTypeMap.fallback[j])&&d.call(ie.styleAliases,Y)&&(Y=ie.styleAliases[Y]),G[j]=Y;return G})(this.schema,M.styles||null),this.sortKeys=M.sortKeys||!1,this.lineWidth=M.lineWidth||80,this.noRefs=M.noRefs||!1,this.noCompatMode=M.noCompatMode||!1,this.condenseFlow=M.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function p(M,R){for(var A,G=o.repeat(" ",R),k=0,L=-1,F="",j=M.length;k<j;)(L=M.indexOf(`
`,k))===-1?(A=M.slice(k),k=j):(A=M.slice(k,L+1),k=L+1),A.length&&A!==`
`&&(F+=G),F+=A;return F}function v(M,R){return`
`+o.repeat(" ",M.indent*R)}function w(M){return M===32||M===9}function m(M){return 32<=M&&M<=126||161<=M&&M<=55295&&M!==8232&&M!==8233||57344<=M&&M<=65533&&M!==65279||65536<=M&&M<=1114111}function y(M,R){return m(M)&&M!==65279&&M!==44&&M!==91&&M!==93&&M!==123&&M!==125&&M!==58&&(M!==35||R&&(function(A){return m(A)&&!w(A)&&A!==65279&&A!==13&&A!==10})(R))}function C(M){return/^\n* /.test(M)}function x(M,R,A,G,k){var L,F,j,Y,ie=!1,de=!1,ae=G!==-1,fe=-1,we=m(Y=M.charCodeAt(0))&&Y!==65279&&!w(Y)&&Y!==45&&Y!==63&&Y!==58&&Y!==44&&Y!==91&&Y!==93&&Y!==123&&Y!==125&&Y!==35&&Y!==38&&Y!==42&&Y!==33&&Y!==124&&Y!==61&&Y!==62&&Y!==39&&Y!==34&&Y!==37&&Y!==64&&Y!==96&&!w(M.charCodeAt(M.length-1));if(R)for(L=0;L<M.length;L++){if(!m(F=M.charCodeAt(L)))return 5;j=L>0?M.charCodeAt(L-1):null,we=we&&y(F,j)}else{for(L=0;L<M.length;L++){if((F=M.charCodeAt(L))===10)ie=!0,ae&&(de=de||L-fe-1>G&&M[fe+1]!==" ",fe=L);else if(!m(F))return 5;j=L>0?M.charCodeAt(L-1):null,we=we&&y(F,j)}de=de||ae&&L-fe-1>G&&M[fe+1]!==" "}return ie||de?A>9&&C(M)?5:de?4:3:we&&!k(M)?1:2}function S(M,R,A,G){M.dump=(function(){if(R.length===0)return"''";if(!M.noCompatMode&&f.indexOf(R)!==-1)return"'"+R+"'";var k=M.indent*Math.max(1,A),L=M.lineWidth===-1?-1:Math.max(Math.min(M.lineWidth,40),M.lineWidth-k),F=G||M.flowLevel>-1&&A>=M.flowLevel;switch(x(R,F,M.indent,L,(function(j){return(function(Y,ie){var de,ae;for(de=0,ae=Y.implicitTypes.length;de<ae;de+=1)if(Y.implicitTypes[de].resolve(ie))return!0;return!1})(M,j)}))){case 1:return R;case 2:return"'"+R.replace(/'/g,"''")+"'";case 3:return"|"+T(R,M.indent)+_(p(R,k));case 4:return">"+T(R,M.indent)+_(p((function(j,Y){for(var ie,de,ae=/(\n+)([^\n]*)/g,fe=(_e=j.indexOf(`
`),_e=_e!==-1?_e:j.length,ae.lastIndex=_e,E(j.slice(0,_e),Y)),we=j[0]===`
`||j[0]===" ",_e;de=ae.exec(j);){var Se=de[1],B=de[2];ie=B[0]===" ",fe+=Se+(we||ie||B===""?"":`
`)+E(B,Y),we=ie}return fe})(R,L),k));case 5:return'"'+(function(j){for(var Y,ie,de,ae="",fe=0;fe<j.length;fe++)(Y=j.charCodeAt(fe))>=55296&&Y<=56319&&(ie=j.charCodeAt(fe+1))>=56320&&ie<=57343?(ae+=h(1024*(Y-55296)+ie-56320+65536),fe++):(de=u[Y],ae+=!de&&m(Y)?j[fe]:de||h(Y));return ae})(R)+'"';default:throw new a("impossible error: invalid scalar style")}})()}function T(M,R){var A=C(M)?String(R):"",G=M[M.length-1]===`
`;return A+(G&&(M[M.length-2]===`
`||M===`
`)?"+":G?"":"-")+`
`}function _(M){return M[M.length-1]===`
`?M.slice(0,-1):M}function E(M,R){if(M===""||M[0]===" ")return M;for(var A,G,k=/ [^ ]/g,L=0,F=0,j=0,Y="";A=k.exec(M);)(j=A.index)-L>R&&(G=F>L?F:j,Y+=`
`+M.slice(L,G),L=G+1),F=j;return Y+=`
`,M.length-L>R&&F>L?Y+=M.slice(L,F)+`
`+M.slice(F+1):Y+=M.slice(L),Y.slice(1)}function D(M,R,A){var G,k,L,F,j,Y;for(L=0,F=(k=A?M.explicitTypes:M.implicitTypes).length;L<F;L+=1)if(((j=k[L]).instanceOf||j.predicate)&&(!j.instanceOf||typeof R=="object"&&R instanceof j.instanceOf)&&(!j.predicate||j.predicate(R))){if(M.tag=A?j.tag:"?",j.represent){if(Y=M.styleMap[j.tag]||j.defaultStyle,l.call(j.represent)==="[object Function]")G=j.represent(R,Y);else{if(!d.call(j.represent,Y))throw new a("!<"+j.tag+'> tag resolver accepts not "'+Y+'" style');G=j.represent[Y](R,Y)}M.dump=G}return!0}return!1}function b(M,R,A,G,k,L){M.tag=null,M.dump=A,D(M,A,!1)||D(M,A,!0);var F=l.call(M.dump);G&&(G=M.flowLevel<0||M.flowLevel>R);var j,Y,ie=F==="[object Object]"||F==="[object Array]";if(ie&&(Y=(j=M.duplicates.indexOf(A))!==-1),(M.tag!==null&&M.tag!=="?"||Y||M.indent!==2&&R>0)&&(k=!1),Y&&M.usedDuplicates[j])M.dump="*ref_"+j;else{if(ie&&Y&&!M.usedDuplicates[j]&&(M.usedDuplicates[j]=!0),F==="[object Object]")G&&Object.keys(M.dump).length!==0?((function(ae,fe,we,_e){var Se,B,P,$,W,K,Q="",ee=ae.tag,ge=Object.keys(we);if(ae.sortKeys===!0)ge.sort();else if(typeof ae.sortKeys=="function")ge.sort(ae.sortKeys);else if(ae.sortKeys)throw new a("sortKeys must be a boolean or a function");for(Se=0,B=ge.length;Se<B;Se+=1)K="",_e&&Se===0||(K+=v(ae,fe)),$=we[P=ge[Se]],b(ae,fe+1,P,!0,!0,!0)&&((W=ae.tag!==null&&ae.tag!=="?"||ae.dump&&ae.dump.length>1024)&&(ae.dump&&ae.dump.charCodeAt(0)===10?K+="?":K+="? "),K+=ae.dump,W&&(K+=v(ae,fe)),b(ae,fe+1,$,!0,W)&&(ae.dump&&ae.dump.charCodeAt(0)===10?K+=":":K+=": ",Q+=K+=ae.dump));ae.tag=ee,ae.dump=Q||"{}"})(M,R,M.dump,k),Y&&(M.dump="&ref_"+j+M.dump)):((function(ae,fe,we){var _e,Se,B,P,$,W="",K=ae.tag,Q=Object.keys(we);for(_e=0,Se=Q.length;_e<Se;_e+=1)$="",_e!==0&&($+=", "),ae.condenseFlow&&($+='"'),P=we[B=Q[_e]],b(ae,fe,B,!1,!1)&&(ae.dump.length>1024&&($+="? "),$+=ae.dump+(ae.condenseFlow?'"':"")+":"+(ae.condenseFlow?"":" "),b(ae,fe,P,!1,!1)&&(W+=$+=ae.dump));ae.tag=K,ae.dump="{"+W+"}"})(M,R,M.dump),Y&&(M.dump="&ref_"+j+" "+M.dump));else if(F==="[object Array]"){var de=M.noArrayIndent&&R>0?R-1:R;G&&M.dump.length!==0?((function(ae,fe,we,_e){var Se,B,P="",$=ae.tag;for(Se=0,B=we.length;Se<B;Se+=1)b(ae,fe+1,we[Se],!0,!0)&&(_e&&Se===0||(P+=v(ae,fe)),ae.dump&&ae.dump.charCodeAt(0)===10?P+="-":P+="- ",P+=ae.dump);ae.tag=$,ae.dump=P||"[]"})(M,de,M.dump,k),Y&&(M.dump="&ref_"+j+M.dump)):((function(ae,fe,we){var _e,Se,B="",P=ae.tag;for(_e=0,Se=we.length;_e<Se;_e+=1)b(ae,fe,we[_e],!1,!1)&&(_e!==0&&(B+=","+(ae.condenseFlow?"":" ")),B+=ae.dump);ae.tag=P,ae.dump="["+B+"]"})(M,de,M.dump),Y&&(M.dump="&ref_"+j+" "+M.dump))}else{if(F!=="[object String]"){if(M.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+F)}M.tag!=="?"&&S(M,M.dump,R,L)}M.tag!==null&&M.tag!=="?"&&(M.dump="!<"+M.tag+"> "+M.dump)}return!0}function I(M,R){var A,G,k=[],L=[];for((function F(j,Y,ie){var de,ae,fe;if(j!==null&&typeof j=="object")if((ae=Y.indexOf(j))!==-1)ie.indexOf(ae)===-1&&ie.push(ae);else if(Y.push(j),Array.isArray(j))for(ae=0,fe=j.length;ae<fe;ae+=1)F(j[ae],Y,ie);else for(de=Object.keys(j),ae=0,fe=de.length;ae<fe;ae+=1)F(j[de[ae]],Y,ie)})(M,k,L),A=0,G=L.length;A<G;A+=1)R.duplicates.push(k[L[A]]);R.usedDuplicates=new Array(G)}function O(M,R){var A=new g(R=R||{});return A.noRefs||I(M,A),b(A,0,M,!0,!0)?A.dump+`
`:""}r.exports.dump=O,r.exports.safeDump=function(M,R){return O(M,o.extend({schema:c},R))}},function(r,n,i){i(31),i(32),i(33),i(64),i(19),i(65),i(20),i(68),i(92),i(144),i(22),i(94),i(23);var o,a=this&&this.__extends||(o=function(x,S){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,_){T.__proto__=_}||function(T,_){for(var E in _)_.hasOwnProperty(E)&&(T[E]=_[E])})(x,S)},function(x,S){function T(){this.constructor=x}o(x,S),x.prototype=S===null?Object.create(S):(T.prototype=S.prototype,new T)}),s=this&&this.__values||function(x){var S=typeof Symbol=="function"&&Symbol.iterator,T=S&&x[S],_=0;if(T)return T.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&_>=x.length&&(x=void 0),{value:x&&x[_++],done:!x}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(x,S){var T=typeof Symbol=="function"&&x[Symbol.iterator];if(!T)return x;var _,E,D=T.call(x),b=[];try{for(;(S===void 0||S-- >0)&&!(_=D.next()).done;)b.push(_.value)}catch(I){E={error:I}}finally{try{_&&!_.done&&(T=D.return)&&T.call(D)}finally{if(E)throw E.error}}return b};Object.defineProperty(n,"__esModule",{value:!0});var l=i(91),d=i(1),u=i(183),f=i(0),h=i(7),g=i(95),p=i(69),v=i(3),w=i(305),m=i(306),y=i(307),C=(function(x){function S(T,_){_===void 0&&(_=!1);var E=x.call(this)||this;return E._hasDeclaration=!1,E._docTypeName="",E._hasDocumentElement=!1,E._currentElementSerialized=!1,E._openTags=[],E._ended=!1,E._fragment=_,E._options=d.applyDefaults(T||{},l.DefaultXMLBuilderCBOptions),E._builderOptions={defaultNamespace:E._options.defaultNamespace,namespaceAlias:E._options.namespaceAlias},E._options.format==="json"?E._writer=new m.JSONCBWriter(E._options):E._options.format==="yaml"?E._writer=new y.YAMLCBWriter(E._options):E._writer=new w.XMLCBWriter(E._options),E._options.data!==void 0&&E.on("data",E._options.data),E._options.end!==void 0&&E.on("end",E._options.end),E._options.error!==void 0&&E.on("error",E._options.error),E._prefixMap=new g.NamespacePrefixMap,E._prefixMap.set("xml",h.namespace.XML),E._prefixIndex={value:1},E._push(E._writer.frontMatter()),E}return a(S,x),S.prototype.ele=function(T,_,E){var D,b;if(d.isObject(T)||d.isString(T)&&(/^\s*</.test(T)||/^\s*[\{\[]/.test(T)||/^(\s*|(#.*)|(%.*))*---/.test(T))){var I=u.fragment().set(this._options);try{I.ele(T)}catch(A){return this.emit("error",A),this}try{for(var O=s(I.node.childNodes),M=O.next();!M.done;M=O.next()){var R=M.value;this._fromNode(R)}}catch(A){D={error:A}}finally{try{M&&!M.done&&(b=O.return)&&b.call(O)}finally{if(D)throw D.error}}return this}if(this._serializeOpenTag(!0),!this._fragment&&this._hasDocumentElement&&this._writer.level===0)return this.emit("error",new Error("Document cannot have multiple document element nodes.")),this;try{this._currentElement=u.fragment(this._builderOptions).ele(T,_,E)}catch(A){return this.emit("error",A),this}return this._fragment||this._hasDocumentElement||this._docTypeName===""||this._currentElement.node._qualifiedName===this._docTypeName?(this._currentElementSerialized=!1,this._fragment||(this._hasDocumentElement=!0),this):(this.emit("error",new Error("Document element name does not match DocType declaration name.")),this)},S.prototype.att=function(T,_,E){if(this._currentElement===void 0)return this.emit("error",new Error("Cannot insert an attribute node as child of a document node.")),this;try{this._currentElement.att(T,_,E)}catch(D){return this.emit("error",D),this}return this},S.prototype.com=function(T){var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).com(T).first().node}catch(E){return this.emit("error",E),this}return!this._options.wellFormed||f.xml_isLegalChar(_.data)&&_.data.indexOf("--")===-1&&!_.data.endsWith("-")?(this._push(this._writer.comment(_.data)),this):(this.emit("error",new Error("Comment data contains invalid characters (well-formed required).")),this)},S.prototype.txt=function(T){if(!this._fragment&&this._currentElement===void 0)return this.emit("error",new Error("Cannot insert a text node as child of a document node.")),this;var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).txt(T).first().node}catch(D){return this.emit("error",D),this}if(this._options.wellFormed&&!f.xml_isLegalChar(_.data))return this.emit("error",new Error("Text data contains invalid characters (well-formed required).")),this;var E=_.data.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this._push(this._writer.text(E)),this},S.prototype.ins=function(T,_){var E;_===void 0&&(_=""),this._serializeOpenTag(!0);try{E=u.fragment(this._builderOptions).ins(T,_).first().node}catch(D){return this.emit("error",D),this}return this._options.wellFormed&&(E.target.indexOf(":")!==-1||/^xml$/i.test(E.target))?(this.emit("error",new Error("Processing instruction target contains invalid characters (well-formed required).")),this):this._options.wellFormed&&!f.xml_isLegalChar(E.data)?(this.emit("error",Error("Processing instruction data contains invalid characters (well-formed required).")),this):(this._push(this._writer.instruction(E.target,E.data)),this)},S.prototype.dat=function(T){var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).dat(T).first().node}catch(E){return this.emit("error",E),this}return this._push(this._writer.cdata(_.data)),this},S.prototype.dec=function(T){return T===void 0&&(T={version:"1.0"}),this._fragment?(this.emit("error",Error("Cannot insert an XML declaration into a document fragment.")),this):this._hasDeclaration?(this.emit("error",Error("XML declaration is already inserted.")),this):(this._push(this._writer.declaration(T.version||"1.0",T.encoding,T.standalone)),this._hasDeclaration=!0,this)},S.prototype.dtd=function(T){if(this._fragment)return this.emit("error",Error("Cannot insert a DocType declaration into a document fragment.")),this;if(this._docTypeName!=="")return this.emit("error",new Error("DocType declaration is already inserted.")),this;if(this._hasDocumentElement)return this.emit("error",new Error("Cannot insert DocType declaration after document element.")),this;var _;try{_=u.create().dtd(T).first().node}catch(E){return this.emit("error",E),this}return this._options.wellFormed&&!f.xml_isPubidChar(_.publicId)?(this.emit("error",new Error("DocType public identifier does not match PubidChar construct (well-formed required).")),this):this._options.wellFormed&&(!f.xml_isLegalChar(_.systemId)||_.systemId.indexOf('"')!==-1&&_.systemId.indexOf("'")!==-1)?(this.emit("error",new Error("DocType system identifier contains invalid characters (well-formed required).")),this):(this._docTypeName=T.name,this._push(this._writer.docType(T.name,_.publicId,_.systemId)),this)},S.prototype.import=function(T){var _,E,D=u.fragment().set(this._options);try{D.import(T)}catch(M){return this.emit("error",M),this}try{for(var b=s(D.node.childNodes),I=b.next();!I.done;I=b.next()){var O=I.value;this._fromNode(O)}}catch(M){_={error:M}}finally{try{I&&!I.done&&(E=b.return)&&E.call(b)}finally{if(_)throw _.error}}return this},S.prototype.up=function(){return this._serializeOpenTag(!1),this._serializeCloseTag(),this},S.prototype.end=function(){for(this._serializeOpenTag(!1);this._openTags.length>0;)this._serializeCloseTag();return this._push(null),this},S.prototype._serializeOpenTag=function(T){if(!this._currentElementSerialized&&this._currentElement!==void 0){var _=this._currentElement.node;if(!this._options.wellFormed||_.localName.indexOf(":")===-1&&f.xml_isName(_.localName)){var E="",D=!1,b=this._prefixMap.copy(),I={},O=this._recordNamespaceInformation(_,b,I),M=this._openTags.length===0?null:this._openTags[this._openTags.length-1][1],R=_.namespaceURI;if(R===null&&(R=M),M===R)O!==null&&(D=!0),E=R===h.namespace.XML?"xml:"+_.localName:_.localName,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E));else{var A=_.prefix,G=null;if(A===null&&R===O||(G=b.get(A,R)),A==="xmlns"){if(this._options.wellFormed)return void this.emit("error",new Error("An element cannot have the 'xmlns' prefix (well-formed required)."));G=A}G!==null?(E=G+":"+_.localName,O!==null&&O!==h.namespace.XML&&(M=O||null),this._writer.beginElement(E),this._push(this._writer.openTagBegin(E))):A!==null?(A in I&&(A=this._generatePrefix(R,b,this._prefixIndex)),b.set(A,R),E+=A+":"+_.localName,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)),this._push(this._writer.attribute("xmlns:"+A,this._serializeAttributeValue(R,this._options.wellFormed))),O!==null&&(M=O||null)):O===null||O!==null&&O!==R?(D=!0,E+=_.localName,M=R,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)),this._push(this._writer.attribute("xmlns",this._serializeAttributeValue(R,this._options.wellFormed)))):(E+=_.localName,M=R,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)))}this._serializeAttributes(_,b,this._prefixIndex,I,D,this._options.wellFormed);var k=R===h.namespace.HTML;k&&!T&&S._VoidElementNames.has(_.localName)?(this._push(this._writer.openTagEnd(E,!0,!0)),this._writer.endElement(E)):k||T?this._push(this._writer.openTagEnd(E,!1,!1)):(this._push(this._writer.openTagEnd(E,!0,!1)),this._writer.endElement(E)),this._currentElementSerialized=!0,this._openTags.push([E,M,this._prefixMap,T]),this._isPrefixMapModified(this._prefixMap,b)&&(this._prefixMap=b),this._writer.level++}else this.emit("error",new Error("Node local name contains invalid characters (well-formed required)."))}},S.prototype._serializeCloseTag=function(){this._writer.level--;var T=this._openTags.pop();if(T!==void 0){var _=c(T,4),E=_[0],D=(_[1],_[2]),b=_[3];this._prefixMap=D,b&&(this._push(this._writer.closeTag(E)),this._writer.endElement(E))}else this.emit("error",new Error("Last element is undefined."))},S.prototype._push=function(T){T===null?(this._ended=!0,this.emit("end")):this._ended?this.emit("error",new Error("Cannot push to ended stream.")):T.length!==0&&(this._writer.hasData=!0,this.emit("data",T,this._writer.level))},S.prototype._fromNode=function(T){var _,E,D,b;if(v.Guard.isElementNode(T)){var I=T.prefix?T.prefix+":"+T.localName:T.localName;T.namespaceURI!==null?this.ele(T.namespaceURI,I):this.ele(I);try{for(var O=s(T.attributes),M=O.next();!M.done;M=O.next()){var R=M.value,A=R.prefix?R.prefix+":"+R.localName:R.localName;R.namespaceURI!==null?this.att(R.namespaceURI,A,R.value):this.att(A,R.value)}}catch(F){_={error:F}}finally{try{M&&!M.done&&(E=O.return)&&E.call(O)}finally{if(_)throw _.error}}try{for(var G=s(T.childNodes),k=G.next();!k.done;k=G.next()){var L=k.value;this._fromNode(L)}}catch(F){D={error:F}}finally{try{k&&!k.done&&(b=G.return)&&b.call(G)}finally{if(D)throw D.error}}this.up()}else v.Guard.isExclusiveTextNode(T)&&T.data?this.txt(T.data):v.Guard.isCommentNode(T)?this.com(T.data):v.Guard.isCDATASectionNode(T)?this.dat(T.data):v.Guard.isProcessingInstructionNode(T)&&this.ins(T.target,T.data)},S.prototype._serializeAttributes=function(T,_,E,D,b,I){var O,M,R=I?new p.LocalNameSet:void 0;try{for(var A=s(T.attributes),G=A.next();!G.done;G=A.next()){var k=G.value;if(I||b||k.namespaceURI!==null){if(I&&R&&R.has(k.namespaceURI,k.localName))return void this.emit("error",new Error("Element contains duplicate attributes (well-formed required)."));I&&R&&R.set(k.namespaceURI,k.localName);var L=k.namespaceURI,F=null;if(L!==null)if(F=_.get(k.prefix,L),L===h.namespace.XMLNS){if(k.value===h.namespace.XML||k.prefix===null&&b||k.prefix!==null&&(!(k.localName in D)||D[k.localName]!==k.value)&&_.has(k.localName,k.value))continue;if(I&&k.value===h.namespace.XMLNS)return void this.emit("error",new Error("XMLNS namespace is reserved (well-formed required)."));if(I&&k.value==="")return void this.emit("error",new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required)."));k.prefix==="xmlns"&&(F="xmlns")}else F===null&&(F=k.prefix===null||_.hasPrefix(k.prefix)&&!_.has(k.prefix,L)?this._generatePrefix(L,_,E):k.prefix,this._push(this._writer.attribute("xmlns:"+F,this._serializeAttributeValue(L,this._options.wellFormed))));if(I&&(k.localName.indexOf(":")!==-1||!f.xml_isName(k.localName)||k.localName==="xmlns"&&L===null))return void this.emit("error",new Error("Attribute local name contains invalid characters (well-formed required)."));this._push(this._writer.attribute((F!==null?F+":":"")+k.localName,this._serializeAttributeValue(k.value,this._options.wellFormed)))}else this._push(this._writer.attribute(k.localName,this._serializeAttributeValue(k.value,this._options.wellFormed)))}}catch(j){O={error:j}}finally{try{G&&!G.done&&(M=A.return)&&M.call(A)}finally{if(O)throw O.error}}},S.prototype._serializeAttributeValue=function(T,_){return _&&T!==null&&!f.xml_isLegalChar(T)?(this.emit("error",new Error("Invalid characters in attribute value.")),""):T===null?"":T.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},S.prototype._recordNamespaceInformation=function(T,_,E){var D,b,I=null;try{for(var O=s(T.attributes),M=O.next();!M.done;M=O.next()){var R=M.value,A=R.namespaceURI,G=R.prefix;if(A===h.namespace.XMLNS){if(G===null){I=R.value;continue}var k=R.localName,L=R.value;if(L===h.namespace.XML||(L===""&&(L=null),_.has(k,L)))continue;_.set(k,L),E[k]=L||""}}}catch(F){D={error:F}}finally{try{M&&!M.done&&(b=O.return)&&b.call(O)}finally{if(D)throw D.error}}return I},S.prototype._generatePrefix=function(T,_,E){var D="ns"+E.value;return E.value++,_.set(D,T),D},S.prototype._isPrefixMapModified=function(T,_){var E=T._items,D=_._items,b=T._nullItems,I=_._nullItems;for(var O in D){var M=E[O];if(M===void 0)return!0;var R=D[O];if(M.length!==R.length)return!0;for(var A=0;A<M.length;A++)if(M[A]!==R[A])return!0}if(b.length!==I.length)return!0;for(A=0;A<b.length;A++)if(b[A]!==I[A])return!0;return!1},S._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),S})(i(308).EventEmitter);n.XMLBuilderCBImpl=C},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,u){d.__proto__=u}||function(d,u){for(var f in u)u.hasOwnProperty(f)&&(d[f]=u[f])})(c,l)},function(c,l){function d(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(d.prototype=l.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(d){var u=c.call(this,d)||this;return u._lineLength=0,u}return a(l,c),l.prototype.frontMatter=function(){return""},l.prototype.declaration=function(d,u,f){var h=this._beginLine()+"<?xml";return h+=' version="'+d+'"',u!==void 0&&(h+=' encoding="'+u+'"'),f!==void 0&&(h+=' standalone="'+(f?"yes":"no")+'"'),h+="?>"},l.prototype.docType=function(d,u,f){var h=this._beginLine();return h+=u&&f?"<!DOCTYPE "+d+' PUBLIC "'+u+'" "'+f+'">':u?"<!DOCTYPE "+d+' PUBLIC "'+u+'">':f?"<!DOCTYPE "+d+' SYSTEM "'+f+'">':"<!DOCTYPE "+d+">"},l.prototype.comment=function(d){return this._beginLine()+"<!--"+d+"-->"},l.prototype.text=function(d){return this._beginLine()+d},l.prototype.instruction=function(d,u){return u?this._beginLine()+"<?"+d+" "+u+"?>":this._beginLine()+"<?"+d+"?>"},l.prototype.cdata=function(d){return this._beginLine()+"<![CDATA["+d+"]]>"},l.prototype.openTagBegin=function(d){return this._lineLength+=1+d.length,this._beginLine()+"<"+d},l.prototype.openTagEnd=function(d,u,f){return f?" />":u?this._writerOptions.allowEmptyTags?"></"+d+">":this._writerOptions.spaceBeforeSlash?" />":"/>":">"},l.prototype.closeTag=function(d){return this._beginLine()+"</"+d+">"},l.prototype.attribute=function(d,u){var f=d+'="'+u+'"';return this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._lineLength+1+f.length>this._writerOptions.width?(f=this._beginLine()+this._indent(1)+f,this._lineLength=f.length,f):(this._lineLength+=1+f.length," "+f)},l.prototype.beginElement=function(d){},l.prototype.endElement=function(d){},l.prototype._beginLine=function(){if(this._writerOptions.prettyPrint){var d=(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level);return this._lineLength=d.length,d}return""},l.prototype._indent=function(d){return d<=0?"":this._writerOptions.indent.repeat(d)},l})(i(114).BaseCBWriter);n.XMLCBWriter=s},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,u){d.__proto__=u}||function(d,u){for(var f in u)u.hasOwnProperty(f)&&(d[f]=u[f])})(c,l)},function(c,l){function d(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(d.prototype=l.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(d){var u=c.call(this,d)||this;return u._hasChildren=[],u._additionalLevel=0,u}return a(l,c),l.prototype.frontMatter=function(){return""},l.prototype.declaration=function(d,u,f){return""},l.prototype.docType=function(d,u,f){return""},l.prototype.comment=function(d){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.comment)+this._sep()+this._val(d)+this._sep()+"}"},l.prototype.text=function(d){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.text)+this._sep()+this._val(d)+this._sep()+"}"},l.prototype.instruction=function(d,u){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.ins)+this._sep()+this._val(u?d+" "+u:d)+this._sep()+"}"},l.prototype.cdata=function(d){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.cdata)+this._sep()+this._val(d)+this._sep()+"}"},l.prototype.attribute=function(d,u){return this._comma()+this._beginLine(1)+"{"+this._sep()+this._key(this._builderOptions.convert.att+d)+this._sep()+this._val(u)+this._sep()+"}"},l.prototype.openTagBegin=function(d){var u=this._comma()+this._beginLine()+"{"+this._sep()+this._key(d)+this._sep()+"{";return this._additionalLevel++,this.hasData=!0,u+=this._beginLine()+this._key(this._builderOptions.convert.text)+this._sep()+"[",this._hasChildren.push(!1),u},l.prototype.openTagEnd=function(d,u,f){if(u){var h=this._sep()+"]";return this._additionalLevel--,h+=this._beginLine()+"}"+this._sep()+"}"}return""},l.prototype.closeTag=function(d){var u=this._beginLine()+"]";return this._additionalLevel--,u+=this._beginLine()+"}"+this._sep()+"}"},l.prototype.beginElement=function(d){},l.prototype.endElement=function(d){this._hasChildren.pop()},l.prototype._beginLine=function(d){return d===void 0&&(d=0),this._writerOptions.prettyPrint?(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level+d):""},l.prototype._indent=function(d){return d+this._additionalLevel<=0?"":this._writerOptions.indent.repeat(d+this._additionalLevel)},l.prototype._comma=function(){var d=this._hasChildren[this._hasChildren.length-1]?",":"";return this._hasChildren.length>0&&(this._hasChildren[this._hasChildren.length-1]=!0),d},l.prototype._sep=function(){return this._writerOptions.prettyPrint?" ":""},l.prototype._key=function(d){return'"'+d+'":'},l.prototype._val=function(d){return JSON.stringify(d)},l})(i(114).BaseCBWriter);n.JSONCBWriter=s},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,u){d.__proto__=u}||function(d,u){for(var f in u)u.hasOwnProperty(f)&&(d[f]=u[f])})(c,l)},function(c,l){function d(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(d.prototype=l.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=(function(c){function l(d){var u=c.call(this,d)||this;if(u._rootWritten=!1,u._additionalLevel=0,d.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(d.offset<0)throw new Error("YAML offset should be zero or a positive number.");return u}return a(l,c),l.prototype.frontMatter=function(){return this._beginLine()+"---"},l.prototype.declaration=function(d,u,f){return""},l.prototype.docType=function(d,u,f){return""},l.prototype.comment=function(d){return this._beginLine()+this._key(this._builderOptions.convert.comment)+" "+this._val(d)},l.prototype.text=function(d){return this._beginLine()+this._key(this._builderOptions.convert.text)+" "+this._val(d)},l.prototype.instruction=function(d,u){return this._beginLine()+this._key(this._builderOptions.convert.ins)+" "+this._val(u?d+" "+u:d)},l.prototype.cdata=function(d){return this._beginLine()+this._key(this._builderOptions.convert.cdata)+" "+this._val(d)},l.prototype.attribute=function(d,u){this._additionalLevel++;var f=this._beginLine()+this._key(this._builderOptions.convert.att+d)+" "+this._val(u);return this._additionalLevel--,f},l.prototype.openTagBegin=function(d){var u=this._beginLine()+this._key(d);return this._rootWritten||(this._rootWritten=!0),this.hasData=!0,this._additionalLevel++,u+=this._beginLine(!0)+this._key(this._builderOptions.convert.text)},l.prototype.openTagEnd=function(d,u,f){return u?" "+this._val(""):""},l.prototype.closeTag=function(d){return this._additionalLevel--,""},l.prototype.beginElement=function(d){},l.prototype.endElement=function(d){},l.prototype._beginLine=function(d){return d===void 0&&(d=!1),(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level,d)},l.prototype._indent=function(d,u){if(d+this._additionalLevel<=0)return"";var f=this._writerOptions.indent.repeat(d+this._additionalLevel);return!u&&this._rootWritten?f.substr(0,f.length-2)+"-"+f.substr(-1,1):f},l.prototype._key=function(d){return'"'+d+'":'},l.prototype._val=function(d){return JSON.stringify(d)},l})(i(114).BaseCBWriter);n.YAMLCBWriter=s},function(r,n,i){var o,a=typeof Reflect=="object"?Reflect:null,s=a&&typeof a.apply=="function"?a.apply:function(y,C,x){return Function.prototype.apply.call(y,C,x)};o=a&&typeof a.ownKeys=="function"?a.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var c=Number.isNaN||function(y){return y!=y};function l(){l.init.call(this)}r.exports=l,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var d=10;function u(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}function f(y){return y._maxListeners===void 0?l.defaultMaxListeners:y._maxListeners}function h(y,C,x,S){var T,_,E,D;if(u(x),(_=y._events)===void 0?(_=y._events=Object.create(null),y._eventsCount=0):(_.newListener!==void 0&&(y.emit("newListener",C,x.listener?x.listener:x),_=y._events),E=_[C]),E===void 0)E=_[C]=x,++y._eventsCount;else if(typeof E=="function"?E=_[C]=S?[x,E]:[E,x]:S?E.unshift(x):E.push(x),(T=f(y))>0&&E.length>T&&!E.warned){E.warned=!0;var b=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(C)+" listeners added. Use emitter.setMaxListeners() to increase limit");b.name="MaxListenersExceededWarning",b.emitter=y,b.type=C,b.count=E.length,D=b,console&&console.warn&&console.warn(D)}return y}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(y,C,x){var S={fired:!1,wrapFn:void 0,target:y,type:C,listener:x},T=g.bind(S);return T.listener=x,S.wrapFn=T,T}function v(y,C,x){var S=y._events;if(S===void 0)return[];var T=S[C];return T===void 0?[]:typeof T=="function"?x?[T.listener||T]:[T]:x?(function(_){for(var E=new Array(_.length),D=0;D<E.length;++D)E[D]=_[D].listener||_[D];return E})(T):m(T,T.length)}function w(y){var C=this._events;if(C!==void 0){var x=C[y];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}function m(y,C){for(var x=new Array(C),S=0;S<C;++S)x[S]=y[S];return x}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(y){if(typeof y!="number"||y<0||c(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");d=y}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||c(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},l.prototype.getMaxListeners=function(){return f(this)},l.prototype.emit=function(y){for(var C=[],x=1;x<arguments.length;x++)C.push(arguments[x]);var S=y==="error",T=this._events;if(T!==void 0)S=S&&T.error===void 0;else if(!S)return!1;if(S){var _;if(C.length>0&&(_=C[0]),_ instanceof Error)throw _;var E=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw E.context=_,E}var D=T[y];if(D===void 0)return!1;if(typeof D=="function")s(D,this,C);else{var b=D.length,I=m(D,b);for(x=0;x<b;++x)s(I[x],this,C)}return!0},l.prototype.addListener=function(y,C){return h(this,y,C,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(y,C){return h(this,y,C,!0)},l.prototype.once=function(y,C){return u(C),this.on(y,p(this,y,C)),this},l.prototype.prependOnceListener=function(y,C){return u(C),this.prependListener(y,p(this,y,C)),this},l.prototype.removeListener=function(y,C){var x,S,T,_,E;if(u(C),(S=this._events)===void 0)return this;if((x=S[y])===void 0)return this;if(x===C||x.listener===C)--this._eventsCount==0?this._events=Object.create(null):(delete S[y],S.removeListener&&this.emit("removeListener",y,x.listener||C));else if(typeof x!="function"){for(T=-1,_=x.length-1;_>=0;_--)if(x[_]===C||x[_].listener===C){E=x[_].listener,T=_;break}if(T<0)return this;T===0?x.shift():(function(D,b){for(;b+1<D.length;b++)D[b]=D[b+1];D.pop()})(x,T),x.length===1&&(S[y]=x[0]),S.removeListener!==void 0&&this.emit("removeListener",y,E||C)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(y){var C,x,S;if((x=this._events)===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[y]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete x[y]),this;if(arguments.length===0){var T,_=Object.keys(x);for(S=0;S<_.length;++S)(T=_[S])!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(C=x[y])=="function")this.removeListener(y,C);else if(C!==void 0)for(S=C.length-1;S>=0;S--)this.removeListener(y,C[S]);return this},l.prototype.listeners=function(y){return v(this,y,!0)},l.prototype.rawListeners=function(y){return v(this,y,!1)},l.listenerCount=function(y,C){return typeof y.listenerCount=="function"?y.listenerCount(C):w.call(y,C)},l.prototype.listenerCount=w,l.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(77);n.createCB=function(a){return new o.XMLBuilderCBImpl(a)},n.fragmentCB=function(a){return new o.XMLBuilderCBImpl(a,!0)}}])}))})(gp)),gp.exports}var Zq=Jq(),fo=Uint8Array,hu=Uint16Array,YD=Uint32Array,JD=new fo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ZD=new fo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Qq=new fo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),QD=function(t,e){for(var r=new hu(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new YD(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},eI=QD(JD,2),tI=eI[0],eY=eI[1];tI[28]=258,eY[258]=28;var tY=QD(ZD,0),nY=tY[0],my=new hu(32768);for(var rr=0;rr<32768;++rr){var Fc=(rr&43690)>>>1|(rr&21845)<<1;Fc=(Fc&52428)>>>2|(Fc&13107)<<2,Fc=(Fc&61680)>>>4|(Fc&3855)<<4,my[rr]=((Fc&65280)>>>8|(Fc&255)<<8)>>>1}var wf=(function(t,e,r){for(var n=t.length,i=0,o=new hu(e);i<n;++i)t[i]&&++o[t[i]-1];var a=new hu(e);for(i=0;i<e;++i)a[i]=a[i-1]+o[i-1]<<1;var s;if(r){s=new hu(1<<e);var c=15-e;for(i=0;i<n;++i)if(t[i])for(var l=i<<4|t[i],d=e-t[i],u=a[t[i]-1]++<<d,f=u|(1<<d)-1;u<=f;++u)s[my[u]>>>c]=l}else for(s=new hu(n),i=0;i<n;++i)t[i]&&(s[i]=my[a[t[i]-1]++]>>>15-t[i]);return s}),Lh=new fo(288);for(var rr=0;rr<144;++rr)Lh[rr]=8;for(var rr=144;rr<256;++rr)Lh[rr]=9;for(var rr=256;rr<280;++rr)Lh[rr]=7;for(var rr=280;rr<288;++rr)Lh[rr]=8;var nI=new fo(32);for(var rr=0;rr<32;++rr)nI[rr]=5;var rY=wf(Lh,9,1),iY=wf(nI,5,1),P2=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},ea=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},R2=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},oY=function(t){return(t+7)/8|0},aY=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t.BYTES_PER_ELEMENT==2?hu:t.BYTES_PER_ELEMENT==4?YD:fo)(r-e);return n.set(t.subarray(e,r)),n},sY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ia=function(t,e,r){var n=new Error(e||sY[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,ia),!r)throw n;return n},Fw=function(t,e,r){var n=t.length;if(!n||r&&r.f&&!r.l)return e||new fo(0);var i=!e||r,o=!r||r.i;r||(r={}),e||(e=new fo(n*3));var a=function(fe){var we=e.length;if(fe>we){var _e=new fo(Math.max(we*2,fe));_e.set(e),e=_e}},s=r.f||0,c=r.p||0,l=r.b||0,d=r.l,u=r.d,f=r.m,h=r.n,g=n*8;do{if(!d){s=ea(t,c,1);var p=ea(t,c+1,3);if(c+=3,p)if(p==1)d=rY,u=iY,f=9,h=5;else if(p==2){var y=ea(t,c,31)+257,C=ea(t,c+10,15)+4,x=y+ea(t,c+5,31)+1;c+=14;for(var S=new fo(x),T=new fo(19),_=0;_<C;++_)T[Qq[_]]=ea(t,c+_*3,7);c+=C*3;for(var E=P2(T),D=(1<<E)-1,b=wf(T,E,1),_=0;_<x;){var I=b[ea(t,c,D)];c+=I&15;var v=I>>>4;if(v<16)S[_++]=v;else{var O=0,M=0;for(v==16?(M=3+ea(t,c,3),c+=2,O=S[_-1]):v==17?(M=3+ea(t,c,7),c+=3):v==18&&(M=11+ea(t,c,127),c+=7);M--;)S[_++]=O}}var R=S.subarray(0,y),A=S.subarray(y);f=P2(R),h=P2(A),d=wf(R,f,1),u=wf(A,h,1)}else ia(1);else{var v=oY(c)+4,w=t[v-4]|t[v-3]<<8,m=v+w;if(m>n){o&&ia(0);break}i&&a(l+w),e.set(t.subarray(v,m),l),r.b=l+=w,r.p=c=m*8,r.f=s;continue}if(c>g){o&&ia(0);break}}i&&a(l+131072);for(var G=(1<<f)-1,k=(1<<h)-1,L=c;;L=c){var O=d[R2(t,c)&G],F=O>>>4;if(c+=O&15,c>g){o&&ia(0);break}if(O||ia(2),F<256)e[l++]=F;else if(F==256){L=c,d=null;break}else{var j=F-254;if(F>264){var _=F-257,Y=JD[_];j=ea(t,c,(1<<Y)-1)+tI[_],c+=Y}var ie=u[R2(t,c)&k],de=ie>>>4;ie||ia(3),c+=ie&15;var A=nY[de];if(de>3){var Y=ZD[de];A+=R2(t,c)&(1<<Y)-1,c+=Y}if(c>g){o&&ia(0);break}i&&a(l+131072);for(var ae=l+j;l<ae;l+=4)e[l]=e[l-A],e[l+1]=e[l+1-A],e[l+2]=e[l+2-A],e[l+3]=e[l+3-A];l=ae}}r.l=d,r.p=L,r.b=l,r.f=s,d&&(s=1,r.m=f,r.d=u,r.n=h)}while(!s);return l==e.length?e:aY(e,0,l)},cY=new fo(0),lY=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&ia(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=t[10]|(t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},uY=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},dY=function(t){((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&ia(6,"invalid zlib data"),t[1]&32&&ia(6,"invalid zlib data: preset dictionaries not supported")};function fY(t,e){return Fw(t,e)}function hY(t,e){return Fw(t.subarray(lY(t),-8),new fo(uY(t)))}function gY(t,e){return Fw((dY(t),t.subarray(2,-4)),e)}function pY(t,e){return t[0]==31&&t[1]==139&&t[2]==8?hY(t):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?fY(t,e):gY(t,e)}var mY=typeof TextDecoder<"u"&&new TextDecoder,vY=0;try{mY.decode(cY,{stream:!0}),vY=1}catch{}const co=[];co[45]=62;co[95]=63;const c0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let t=0;t<c0.length;t++)co[c0.charCodeAt(t)]=t;function Fa(t){return co[t.charCodeAt(0)]!==void 0}function yY(t){const e=t.length,r=[];let n=null;for(let i=0;i<e;i++)Fa(t[i])?(n||(n={start:i,count:0}),n.count++,n.end=i):t[i]==="="&&n&&(r.push(n),n=null);return n&&r.push(n),r}function wY(t,e,r,n){const{start:i,count:o}=e,a=o%4,s=Math.floor(o/4);let c=i,l=null,d=r;for(let u=0;u<s;u++){for(;!Fa(t[c]);)c++;for(l=co[t.charCodeAt(c++)]<<18;!Fa(t[c]);)c++;for(l|=co[t.charCodeAt(c++)]<<12;!Fa(t[c]);)c++;for(l|=co[t.charCodeAt(c++)]<<6;!Fa(t[c]);)c++;l|=co[t.charCodeAt(c++)],n[d++]=l>>16&255,n[d++]=l>>8&255,n[d++]=l&255}switch(a){case 3:for(;!Fa(t[c]);)c++;for(l=co[t.charCodeAt(c++)]<<10;!Fa(t[c]);)c++;for(l|=co[t.charCodeAt(c++)]<<4;!Fa(t[c]);)c++;l|=co[t.charCodeAt(c++)]>>2,n[d++]=l>>8&255,n[d++]=l&255;break;case 2:for(;!Fa(t[c]);)c++;for(l=co[t.charCodeAt(c++)]<<2;!Fa(t[c]);)c++;l|=co[t.charCodeAt(c++)]>>4,n[d++]=l&255;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return d}function CY(t){const e=yY(t),r=e[e.length-1].end+1,n=(4-r%4)%4,i=(r+n)*3/4-n,o=new ArrayBuffer(i),a=new Uint8Array(o);let s=0;for(let c=0;c<e.length;c++)s+=wY(t,e[c],s,a),s+=(4-e[c].count%4)%4;return o}function KS(t,e,r){const n=(t<<16)+(e<<8)+r;return c0[n>>18]+c0[n>>12&63]+c0[n>>6&63]+c0[n&63]}function xY(t){const e=new Uint8Array(t),r=t.byteLength%3,n=t.byteLength-r,i=Array(n/3);for(let o=0;o<i.length;o++){const a=o*3;i[o]=KS(e[a],e[a+1],e[a+2])}if(r>0){const o=KS(e[n],e[n+1]||0,e[n+2]||0);r===1?i.push(`${o.substr(0,2)}==`):r===2&&i.push(`${o.substr(0,3)}=`)}return i.join("")}var Uw={toArrayBuffer:CY,fromArrayBuffer:xY};function SY(t,e){e.classHierarchy.push("vtkStringArray"),t.getComponent=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+n]},t.setComponent=(r,n,i)=>{i!==e.values[r*e.numberOfComponents+n]&&(e.values[r*e.numberOfComponents+n]=i,t.modified())},t.getData=()=>e.values,t.getTuple=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=e.numberOfComponents||1;n.length&&(n.length=i);const o=r*i;for(let a=0;a<i;a++)n[a]=e.values[o+a];return n},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.values.length,t.getNumberOfTuples=()=>e.values.length/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>iI({name:e.name,numberOfComponents:e.numberOfComponents,empty:!0}),t.getName=()=>(e.name||t.setName(`vtkStringArray${t.getMTime()}`),e.name),t.setData=(r,n)=>{e.values=r,e.size=r.length,n&&(e.numberOfComponents=n),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.modified()}}const TY={name:"",numberOfComponents:1,size:0,dataType:"string"};function rI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,TY,r),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkStringArray object without: size > 0, values");e.values?Array.isArray(e.values)&&(e.values=[...e.values]):e.values=[],e.values&&(e.size=e.values.length),Z.obj(t,e),Z.set(t,e,["name"]),SY(t,e)}const iI=Z.newInstance(rI,"vtkStringArray");var _Y={newInstance:iI,extend:rI};function EY(t,e){return[...t.getElementsByTagName(e)]}function qS(t,e){return EY(t,e)[0]}function bY(t){return Zq.create(t)}function DY(t){const e=/^\s*<AppendedData\s+encoding="raw">\s*_/m,r=/\n\s*<\/AppendedData>/m;return Fq.extractBinary(t,e,r)}const Zc={Int8:Int8Array,UInt8:Uint8Array,Int16:Int16Array,UInt16:Uint16Array,Int32:Int32Array,UInt32:Uint32Array,Int64:Int32Array,UInt64:Uint32Array,Float32:Float32Array,Float64:Float64Array},Jf={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,Int64:8,UInt64:8,Float32:4,Float64:8};function vy(t){const e=t.length-1;return t.filter((r,n)=>n<e&&n%2===0)}function yy(t,e,r){if(!["UInt64","UInt32"].includes(r))throw new Error(`Cannot handle a header type of ${r}`);let n=Zc[r],i=Zc[e],o=!1;r==="UInt64"&&(n=Zc.UInt32),/^U?Int64$/.test(e)&&(o=!0,i=Zc[e.replace("64","32")]);const{byteOffset:a}=t,s=Jf[e],c=Jf[r];let l;a%c===0?l=new n(t.buffer,a,1):l=new n(t.buffer.slice(a,a+c));const d=Number(l[0]);let u,f=d/s;o&&(f*=2);const h=a+c;return h%s===0?u=new i(t.buffer,h,f):u=new i(t.buffer.slice(h,h+d)),o&&(u=vy(u)),u}function IY(t,e){if(e==="UInt64"){let l=new Uint32Array(t.buffer,0,6);const d=l[0],u=l[2],f=l[4],h=[8,d,u,f];l=new Uint32Array(t.buffer,24,d*2);for(let g=0;g<d;g++)h.push(l[g*2]);return h}let r=new Uint32Array(t.buffer,0,3);const n=4,i=r[0],o=r[1],a=r[2],s=[n,i,o,a];r=new Uint32Array(t.buffer,12,i);for(let c=0;c<i;c++)s.push(r[c]);return s}function MY(t,e){const[r]=t;return(t.length-1)*r}function OY(t,e){const r=pY(t);e.uint8.set(r,e.offset),e.offset+=r.length}function Bw(t,e){const r=IY(t,e),n=r[1],i=r[2],o=r[3];let a=0;n>0&&(o===0?a=n*i:a=(n-1)*i+o);const s=new ArrayBuffer(a),c={offset:0,uint8:new Uint8Array(s)};let l=MY(r);for(;l<t.length&&t[l]!==120;)l++;for(let d=0;d<n;d++){const u=r[4+d],f=new Uint8Array(t.buffer,l,u);OY(f,c),l+=u}return c.uint8}function Zf(t,e,r,n,i,o){const a=e.getAttribute("type"),s=e.getAttribute("Name"),c=e.getAttribute("format"),l=Number(e.getAttribute("NumberOfComponents")||"1");let d=null;if(c==="ascii"){d=new Zc[a](t*l);let u=0;e.firstChild.nodeValue.split(/[\\t \\n]+/).forEach(f=>{f.trim().length&&(d[u++]=Number(f))})}else if(c==="binary"){const u=new Uint8Array(Uw.toArrayBuffer(e.firstChild.nodeValue.trim()));if(r==="vtkZLibDataCompressor"){const f=Bw(u,i);d=new Zc[a](f.buffer),/^U?Int64$/.test(a)&&(d=vy(d))}else d=new Zc[a](u.buffer,Jf[i]),a.indexOf("Int64")!==-1&&(d=vy(d))}else if(c==="appended"){const u=Number(e.getAttribute("offset"));d=yy(new Uint8Array(o,u),a,i)}else console.error("Format not supported",c);return{name:s,values:d,numberOfComponents:l}}function A2(t){return new TextDecoder().decode(t).split("\0").slice(0,-1)}function PY(t,e,r,n,i){const o=t.getAttribute("Name"),a=t.getAttribute("format"),s=Number(t.getAttribute("NumberOfComponents")||"1"),l=Number(t.getAttribute("NumberOfTuples")||"1")*s,d=[];if(a==="ascii"){const u=t.firstChild.nodeValue.trim().split(/\s+/);let f=0;const h=[];for(;d.length<l;){const g=Number(u[f++]);g===0?(d.push(h.join("")),h.length=0):h.push(String.fromCharCode(g))}}else if(a==="binary"){const u=new Uint8Array(Uw.toArrayBuffer(t.firstChild.nodeValue.trim()));if(e==="vtkZLibDataCompressor"){const f=Bw(u,n);d.push(...A2(f))}else{const f=yy(u,"UInt8",n);d.push(...A2(f))}}else if(a==="appended"){const u=Number(t.getAttribute("offset")),f=yy(new Uint8Array(i,u),"UInt8",n);d.push(...A2(f))}else Z.vtkErrorMacro(`Format not supported: ${a}`);return{name:o,values:d,numberOfComponents:s}}function RY(t,e,r,n,i,o){const a={},s=e.getElementsByTagName("DataArray");for(let g=0;g<s.length;g++){const p=s[g];a[p.getAttribute("Name")]=p}const c=Zf(t,a.offsets,r,n,i,o).values,l=c[c.length-1],d=Zf(l,a.connectivity,r,n,i,o).values,u=new Uint32Array(t+l);let f=0,h=0;return c.forEach(g=>{const p=g-h;u[f++]=p;for(let v=0;v<p;v++)u[f++]=d[h+v];h=g}),u}function AY(t,e,r,n,i,o,a){if(e){const s=["Scalars","Vectors","Normals","Tensors","TCoords"],c={};s.forEach(u=>{const f=e.getAttribute(u);f&&(c[f]=r[`set${u}`])});const l=e.getElementsByTagName("DataArray"),d=l.length;for(let u=0;u<d;u++){const f=l[u],h=Ot.newInstance(Zf(t,f,n,i,o,a)),g=h.getName();(c[g]||r.addArray)(h)}}}function LY(t,e,r,n,i){const o=[...t.getElementsByTagName("DataArray")].map(s=>Ot.newInstance(Zf(Number(s.getAttribute("NumberOfTuples")),s,e,r,n,i))),a=[...t.getElementsByTagName("Array")].filter(s=>s.getAttribute("type")==="String").map(s=>_Y.newInstance(PY(s,e,r,n,i)));return[...o,...a]}function NY(t,e){e.classHierarchy.push("vtkXMLReader"),e.dataAccessHelper||(e.dataAccessHelper=Bq.get("http"));function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.dataAccessHelper.fetchBinary(n,i)}t.setUrl=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.url=n;const o=n.split("/");return o.pop(),e.baseURL=o.join("/"),t.loadData(i)},t.loadData=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r(e.url,n).then(t.parseAsArrayBuffer)},t.parseAsArrayBuffer=n=>{if(!n)return!1;if(n!==e.rawDataBuffer)t.modified();else return!0;const{text:i,binaryBuffer:o}=DY(n);e.rawDataBuffer=n,e.binaryBuffer=o;const s=bY(i).root(),c=s.node,l=c.getAttribute("type"),d=c.getAttribute("compressor"),u=c.getAttribute("byte_order"),f=c.getAttribute("header_type")||"UInt32";if(d&&d!=="vtkZLibDataCompressor")return console.error("Invalid compressor",d),!1;if(u&&u!=="LittleEndian")return console.error("Only LittleEndian encoding is supported"),!1;if(l!==e.dataType)return console.error("Invalid data type",l,"expecting",e.dataType),!1;if(qS(c,"AppendedData")){const p=qS(c,"AppendedData"),v=p.getAttribute("encoding"),w=s.filter(T=>{const{node:_}=T;return _.nodeType===Node.ELEMENT_NODE&&_.getAttribute("format")==="appended"&&_.hasAttribute("offset")},!1,!0).map(T=>({node:T.node,offset:Number(T.node.getAttribute("offset"))}));w.sort((T,_)=>T.offset-_.offset);let m=e.binaryBuffer;v==="base64"&&(m=p.textContent.trim().substr(1));const y=[];for(let T=0;T<w.length;++T){const _=w[T].offset;let E=0;T===w.length-1?E=m.length||m.byteLength:E=w[T+1].offset,v==="base64"?y.push(new Uint8Array(Uw.toArrayBuffer(m.substring(_,E)))):y.push(new Uint8Array(m.slice(_,E)))}if(d==="vtkZLibDataCompressor")for(let T=0;T<y.length;++T){const _=y[T],E=Bw(_,f),D=new Uint8Array(E.length+Jf[f]);new Zc[f](D.buffer,0,1)[0]=E.length,D.set(E,Jf[f]),y[T]=D}const C=y.reduce((T,_)=>T+_.length,0),x=new ArrayBuffer(C),S=new Uint8Array(x);for(let T=0,_=0;T<y.length;++T)w[T].node.setAttribute("offset",_),S.set(y[T],_),_+=y[T].length;if(e.binaryBuffer=x,!e.binaryBuffer)return console.error("Processing appended data format: requires binaryBuffer to parse"),!1}t.parseXML(c,l,d,u,f);const g=c.getElementsByTagName(l)[0].getElementsByTagName("FieldData")[0];if(g){const p=LY(g,d,u,f,e.binaryBuffer);for(let v=0;v<e.output.length;v++){const w=e.output[v].getFieldData();for(let m=0;m<p.length;m++)w.addArray(p[m])}}return!0},t.requestData=(n,i)=>{t.parseAsArrayBuffer(e.rawDataBuffer)}}const VY={};function kY(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VY,r),Z.obj(t,e),Z.get(t,e,["url","baseURL"]),Z.setGet(t,e,["dataAccessHelper"]),Z.algo(t,e,0,1),NY(t,e)}var Qf={extend:kY,processDataArray:Zf,processFieldData:AY,processCells:RY};function FY(t,e,r,n,i,o,a){const s=Number(r.getAttribute(`NumberOf${e}`));if(s>0){const c=r.getElementsByTagName(e)[0].getElementsByTagName("DataArray")[0],{values:l,numberOfComponents:d}=Qf.processDataArray(s,c,n,i,o,a);t[`get${e}`]().setData(l,d)}return s}function UY(t,e,r,n,i,o,a){const s=Number(r.getAttribute(`NumberOf${e}`));if(s>0){const c=Qf.processCells(s,r.getElementsByTagName(e)[0],n,i,o,a);t[`get${e}`]().setData(c)}return s}function BY(t,e){e.classHierarchy.push("vtkXMLPolyDataReader"),t.parseXML=(r,n,i,o,a)=>{const c=r.getElementsByTagName(e.dataType)[0].getElementsByTagName("Piece"),l=c.length;for(let d=0;d<l;d++){const u=Ii.newInstance(),f=c[d],h=FY(u,"Points",f,i,o,a,e.binaryBuffer);let g=0;["Verts","Lines","Strips","Polys"].forEach(p=>{g+=UY(u,p,f,i,o,a,e.binaryBuffer)}),Qf.processFieldData(h,f.getElementsByTagName("PointData")[0],u.getPointData(),i,o,a,e.binaryBuffer),Qf.processFieldData(g,f.getElementsByTagName("CellData")[0],u.getCellData(),i,o,a,e.binaryBuffer),e.output[d]=u}}}const GY={dataType:"PolyData"};function oI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GY,r),Qf.extend(t,e,r),BY(t,e)}const WY=Z.newInstance(oI,"vtkXMLPolyDataReader");var $Y={newInstance:WY,extend:oI},ra;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(ra||(ra={}));class om{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,r,n){const i=e.indexOf(".");if(i!==-1){const a=e.substring(0,i);let s=this._children.get(a);s||(s=new om(this._target),this._children.set(a,s)),e=e.substring(i+1),s.addEventListener(e,r,n)}else this._addEventListener(e,r,n)}removeEventListener(e,r,n){const i=e.indexOf(".");if(i!==-1){const a=e.substring(0,i),s=this._children.get(a);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,r,n),s.isEmpty&&this._children.delete(a)}else this._removeEventListener(e,r,n)}reset(){Array.from(this._children.entries()).forEach(([e,r])=>{if(r.reset(),r.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,r,n){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const a=n?.capture??!1?ra.Capture:ra.Bubble,s=i.get(r)??ra.None;if(s&a){console.warn("A listener is already registered for this phase");return}i.set(r,s|a),this._target.addEventListener(e,r,n)}_removeEventListener(e,r,n){const o=n?.capture??!1?ra.Capture:ra.Bubble,a=this._eventListeners.get(e);if(!a)return;(r?[r]:Array.from(a.keys())).forEach(c=>{const l=a.get(c)??ra.None;if(!!!(l&o))return;this._target.removeEventListener(e,c,n);const u=l^o;u===ra.None?a.delete(c):a.set(c,u)}),a.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,r){Array.from(r.entries()).forEach(([n,i])=>{const o=ra.Capture;for(let a=o;i;a<<=1){if(!(i&a))continue;const s=a===ra.Capture;this.removeEventListener(e,n,{capture:s}),i^=a}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,r])=>{this._unregisterAllListeners(e,r)})}}class aI{constructor(){this._targetsEventListeners=new Map}addEventListener(e,r,n,i){let o=this._targetsEventListeners.get(e);o||(o=new om(e),this._targetsEventListeners.set(e,o)),o.addEventListener(r,n,i)}removeEventListener(e,r,n,i){const o=this._targetsEventListeners.get(e);o&&(o.removeEventListener(r,n,i),o.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,r])=>{r.reset(),this._targetsEventListeners.delete(e)})}}const zY=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:aI,TargetEventListeners:om},Symbol.toStringTag,{value:"Module"}));function jY(t,e){const r=t.getSize();for(let n=0;n<r;n++){const i=[];t.getNodeValue(n,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(n,i)}}function Gw(t){let e=t[0],r=t[0],n;const i=t.length;for(let o=1;o<i;o++)n=t[o],e=Math.min(e,n),r=Math.max(r,n);return{min:e,max:r}}const HY=Symbol("LastRuntimeId"),XY={},KY=4294967295,qY="-";function sI(t,e,r){return YY(t!==null&&typeof t=="object"?t:XY,HY,(typeof r=="number"&&r>0?r:KY)>>>0).join(typeof e=="string"?e:qY)}function YY(t,e,r){let n=t[e];n instanceof Array||(n=[0],Object.defineProperty(t,e,{value:n}));for(let i=!0,o=0;i&&o<n.length;++o){let a=n[o]|0;a<r?(i=!1,a=a+1):(a=0,o+1===n.length&&n.push(0)),n[o]=a}return n}const YS={},JY={add:(t,e)=>{const r=Yn(t);YS[r]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const r=Yn(e);return YS[r]}}};function of(t,e,r=1e-5){return Math.abs(t[0]+e[0])<r&&Math.abs(t[1]+e[1])<r&&Math.abs(t[2]+e[2])<r}function Sr(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function ZY(t,e){let r;e?r=[Fn(e)]:r=eo();const n=[];return r.forEach(i=>{const o=t.getActors(),a=i.getVolumeViewports();for(const s of a){const c=s.getActors();if(c.length!==o.length)continue;o.every(({uid:d})=>c.find(u=>d===u.uid))&&n.push(s)}}),n}const cI=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function lI(t,e,r=void 0,n="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const o=!e.imageId,a=!o&&e,s=o&&e,l=`renderGPUViewport-${a.imageId||s.volumeId}`,d=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const f=t.width,h=t.height;d.style.width=`${f/u+rl}px`,d.style.height=`${h/u+rl}px`,d.style.visibility="hidden",d.style.position="absolute",document.body.appendChild(d);const g=l.split(":").join("-");d.setAttribute("viewport-id-for-remove",g);const p=Go(d),v=Fn(n)||new zD(n);let w=v.getViewport(l);if(!w){const m={viewportId:l,type:o?Nn.ORTHOGRAPHIC:Nn.STACK,element:d,defaultOptions:{...i,suppressEvents:!0}};v.enableElement(m),w=v.getViewport(l)}return new Promise(m=>{let y=!1,{viewReference:C}=i;const x=S=>{if(y)return;if(C){const M=C;C=null,w.setViewReference(M),w.render();return}t.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t.width,t.height);const _=w.canvasToWorld([0,0]),E=w.canvasToWorld([p.width/u,0]),D=w.canvasToWorld([0,p.height/u]),b=rn([0,0,0],w.canvasToWorld([1/u,0]),_),I=rn([0,0,0],w.canvasToWorld([0,1/u]),_),O=1;y=!0,d.removeEventListener($e.IMAGE_RENDERED,x),setTimeout(()=>{v.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${g}"]`).forEach(R=>{R.remove()})},0),m({origin:_,bottomLeft:D,topRight:E,thicknessMm:O,rightVector:b,downVector:I})};d.addEventListener($e.IMAGE_RENDERED,x),o?w.setVolumes([s],!1,!0):w.renderImageObject(e),w.resetCamera(),r==="PT"&&!cI(a)&&w.setProperties({voiRange:{lower:a.minPixelValue,upper:a.maxPixelValue}}),w.render()})}function uI(t,e,r,n,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const a=e,s=GD(t,a,r),c={canvas:t,viewport:s,image:a,renderingTools:{}};c.transform=qf(c);const l=!0;return new Promise((d,u)=>{FD(c,l),d(null)})}function QY(t){const{canvas:e,imageId:r,viewReference:n,requestType:i=Jt.Thumbnail,priority:o=-5,renderingEngineId:a="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:d}=t,u=n?.volumeId,f=u&&!r,h=n&&d?{...d,viewReference:n}:d,g=s?uI:lI;return new Promise((p,v)=>{function w(x,S){const{modality:T}=ut("generalSeriesModule",S)||{},_=!f&&x,E=f&&x;_&&(_.isPreScaled=_.isPreScaled||_.preScale?.scaled),c&&(e.height=256,e.width=256),l&&_&&(e.width=_&&e.height*_.width/_.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,E&&s&&v(new Error("CPU rendering of volume not supported")),g(e,x,T,a,h).then(p)}function m(x,S){console.error(x,S),v(x)}function y(x,S,T){return dl(x,T).then(_=>{w.call(this,_,x)},_=>{m.call(this,_,x)})}const C={useRGBA:!!s,requestType:i};if(u){const x=Ne.getVolume(u);x||v(new Error(`Volume id ${u} not found in cache`));const S=x.imageIds[0];w(x,S)}else $i.addRequest(y.bind(null,r,null,C),i,{imageId:r},o)})}function wy(t){return Array.isArray(t)?t:[t]}const JS={HISTORY_UNDO:"CORNERSTONE_TOOLS_HISTORY_UNDO",HISTORY_REDO:"CORNERSTONE_TOOLS_HISTORY_REDO"};class dI{constructor(e="Tools",r=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.isRecordingGrouped=!1,this.label=e,this._size=r}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}get canUndo(){return this.undoAvailable>0}get canRedo(){return this.redoAvailable>0}undo(e=1){for(;e>0&&this.undoAvailable>0;){const r=this.ring[this.position];for(const n of wy(r).reverse())n.restoreMemo(!0),this.dispatchHistoryEvent({item:n,isUndo:!0});e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}}undoIf(e){return this.undoAvailable>0&&e(this.ring[this.position])?(this.undo(),!0):!1}dispatchHistoryEvent({item:e,isUndo:r}){e.id&&Fe.dispatchEvent(new CustomEvent(r?JS.HISTORY_UNDO:JS.HISTORY_REDO,{detail:{isUndo:r,id:e.id,operationType:e.operationType||"annotation",memo:e}}))}redo(e=1){for(;e>0&&this.redoAvailable>0;){const r=(this.position+1)%this.size,n=this.ring[r];for(const i of wy(n).reverse())i.restoreMemo(!1),this.dispatchHistoryEvent({item:i,isUndo:!1});e--,this.position=r,this.undoAvailable++,this.redoAvailable--}}initializeGroupItem(){this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=[]}startGroupRecording(){this.isRecordingGrouped=!0,this.initializeGroupItem()}rollbackUnusedGroupItem(){this.ring[this.position]=void 0,this.position=(this.position-1)%this._size,this.undoAvailable--}endGroupRecording(){this.isRecordingGrouped=!1;const e=this.ring[this.position];Array.isArray(e)&&e.length===0&&this.rollbackUnusedGroupItem()}pushGrouped(e){const r=this.ring[this.position];if(Array.isArray(r))return r.push(e),e;throw new Error("Last item should be an array for grouped memos.")}push(e){if(!e)return;const r=e.restoreMemo?e:e.createMemo?.();if(r)return this.isRecordingGrouped?this.pushGrouped(r):(this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=r,r)}}const fI=new dI,Ww=Object.freeze(Object.defineProperty({__proto__:null,DefaultHistoryMemo:fI,HistoryMemo:dI},Symbol.toStringTag,{value:"Module"}));function Cy(t,e){const r=ut("imagePlaneModule",t);if(!r)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:n,rowCosines:i,imagePositionPatient:o}=r;let{columnPixelSpacing:a,rowPixelSpacing:s}=r;a||=1,s||=1;const c=Ie();en(c,o,n,-a/2),en(c,c,i,-s/2);const l=Ie();rn(l,e,c);const d=ft(l,i),u=ft(l,n);return[d/s,u/a]}function hI(t,e){const r=ut("imagePlaneModule",t);if(!r)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:n,rowCosines:i,imagePositionPatient:o}=r;let{columnPixelSpacing:a,rowPixelSpacing:s}=r;a||=1,s||=1;const c=Ie();return en(c,o,i,s*(e[0]-.5)),en(c,c,n,a*(e[1]-.5)),Array.from(c)}function qp(t){const e=eo(),r=[];return e.forEach(n=>{n.getViewports().forEach(o=>{o.hasImageURI(t)&&r.push(o)})}),r}function $w(t,e){const r=eJ(t,e);return r?r.index:null}function eJ(t,e){const r=e.getImageIds(),n=e.getCurrentImageIdIndex();if(r.length===0)return null;const i=c=>{const l=tJ(c);if(!l)return null;const d=Ya(l.planeNormal,l.imagePositionPatient);return Kf(d,t)},o={distance:i(r[n])??1/0,index:n},a=r.slice(n+1);for(let c=0;c<a.length;c++){const l=a[c],d=i(l);if(d!==null)if(d<=o.distance)o.distance=d,o.index=c+n+1;else break}const s=r.slice(0,n);for(let c=s.length-1;c>=0;c--){const l=s[c],d=i(l);if(!(d===null||d===o.distance))if(d<o.distance)o.distance=d,o.index=c;else break}return o.distance===1/0?null:o}function tJ(t){const e=ut("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:r,columnCosines:n,imagePositionPatient:i}=e,o=Ji(Ie(),...r),a=Ji(Ie(),...n),s=tn(Ie(),o,a);return{rowCosines:r,columnCosines:n,imagePositionPatient:i,planeNormal:s}}function zw(t){const{width:e,height:r}=t.getCanvas(),{sliceToIndexMatrix:n,indexToSliceMatrix:i}=t.getSliceViewInfo(),o=qc(t,[0,0]),a=qc(t,[e-1,0]),s=qc(t,[0,r-1]),c=rn(Ie(),a,o),l=rn(Ie(),s,o),d=tn(Ie(),c,l);Lt(c,c),Lt(l,l),Lt(d,d);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),f=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!Du(1,u)||!Du(1,f))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:h}=t.getImageData(),g=t.getSliceViewInfo(),p=h.getSliceData(g);return{width:g.width,height:g.height,scalarData:p,sliceToIndexMatrix:n,indexToSliceMatrix:i}}const Jl={},eh={add:(t,e)=>{const[r,n]=t,i=`${r}_${n}`;Jl[i]||(Jl[i]={}),Jl[i]=e},get:(t,e,r)=>{if(t!=="spatialRegistrationModule")return;const n=`${e}_${r}`;if(Jl[n])return Jl[n];const i=`${r}_${e}`;if(Jl[i])return Cr(fi(),Jl[i])}};od(eh.get.bind(eh));const nJ=.05;function gI(t,e){const r=t.getSliceIndex(),n=e.getSliceIndex(),i=ut("imagePlaneModule",r.toString()),o=ut("imagePlaneModule",n.toString());if(!i||!o){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:a}=o;if(!i.imageOrientationPatient.every((f,h)=>Math.abs(f-a[h])<nJ)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i?.imageOrientationPatient,o?.imageOrientationPatient);return}const c=i.imagePositionPatient,l=o.imagePositionPatient,d=an(Ie(),c,l),u=ed(fi(),d);eh.add([t.id,e.id],u)}function Yp(t){const{imageData:e,dimensions:r}=t.getImageData()||{};if(!e||!r)return[];const{canvas:n}=t,i=window.devicePixelRatio,o=[0,0],a=[n.width/i,0],s=[n.width/i,n.height/i],c=[0,n.height/i],l=t.canvasToWorld(o),d=t.canvasToWorld(a),u=t.canvasToWorld(s),f=t.canvasToWorld(c),h=e.worldToIndex(l),g=e.worldToIndex(d),p=e.worldToIndex(u),v=e.worldToIndex(f);return rJ({dimensions:r,imageData:e,topLeftImage:h,topRightImage:g,bottomRightImage:p,bottomLeftImage:v,topLeftWorld:l,topRightWorld:d,bottomRightWorld:u,bottomLeftWorld:f})}function rJ({dimensions:t,imageData:e,topLeftImage:r,topRightImage:n,bottomRightImage:i,bottomLeftImage:o,topLeftWorld:a,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:l}){const d=_g(r,t)?a:e.indexToWorld([0,0,0]),u=_g(n,t)?s:e.indexToWorld([t[0]-1,0,0]),f=_g(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),h=_g(o,t)?l:e.indexToWorld([0,t[1]-1,0]);return[d,u,h,f]}function _g(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function Ce(t){if(!t)return;const{viewportUid:e,renderingEngineUid:r}=t.dataset;return Ln(e,r)}function Ln(t,e){if(!e||!t)return;const r=Fn(e);if(!r||r.hasBeenDestroyed)return;const n=r.getViewport(t);if(!n)return;const i=n.getFrameOfReferenceUID();return{viewport:n,renderingEngine:r,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function wn(t){const e=eo();for(let r=0;r<e.length;r++){const n=e[r];if(n.getViewport(t))return Ln(t,n.id)}}function iJ(){const t=[];return eo().forEach(r=>{r.getViewports().forEach(({element:i})=>{t.push(Ce(i))})}),t}function oJ(t){const e=Ce(t);if(!e)return;const{viewport:r}=e;if(!(r instanceof Wn))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${r.type}`);return r.getCornerstoneImage()}function vl(t){if(!t.length)return!1;const e=t[0],{modality:r,seriesInstanceUID:n}=ut("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:c,usingDefaultValues:l}=ut("imagePlaneModule",e);if(l)return!1;const d={modality:r,imageOrientationPatient:i,pixelSpacing:o,columns:s,rows:c,seriesInstanceUID:n};let u=!0;for(let f=0;f<t.length;f++){const h=t[f],{modality:g,seriesInstanceUID:p}=ut("generalSeriesModule",h),{imageOrientationPatient:v,pixelSpacing:w,columns:m,rows:y}=ut("imagePlaneModule",h);if(p!==d.seriesInstanceUID){u=!1;break}if(g!==d.modality){u=!1;break}if(m!==d.columns){u=!1;break}if(y!==d.rows){u=!1;break}if(!Et(v,d.imageOrientationPatient)){u=!1;break}if(!Et(w,d.pixelSpacing)){u=!1;break}}return u}const aJ=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function pI(t){return t?(Array.isArray(t)?t:[t]).find(r=>aJ.has(r)):!1}async function sJ({viewport:t,options:e={}}){const r=t.getRenderingEngine();let n=e.volumeId||`${cn()}`;n.split(":").length===0&&(n=`${IX()}:${n}`);const{id:i,element:o}=t,a=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();r.enableElement({viewportId:a,type:Nn.ORTHOGRAPHIC,element:o,defaultOptions:{background:e.background,orientation:e.orientation}}),(await dD(n,{imageIds:s})).load();const u=r.getViewport(a);await bq(r,[{volumeId:n}],[a]);const f=()=>{u.render(),o.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,f)};return o.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,f),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function cJ({viewport:t,options:e}){const r=t,{id:n,element:i}=r,o=t.getRenderingEngine(),{background:a}=e,s=e.viewportId||n,c=Ne.getVolume(r.getVolumeId());if(!(c instanceof id))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:s,type:Nn.STACK,element:i,defaultOptions:{background:a}},d=r.getViewReference();o.enableElement(l);const u=o.getViewport(s);return await u.setStack(c.imageIds),u.setViewReference(d),u.render(),u}function Ht(t,e=2){if(Array.isArray(t))return t.map(i=>Ht(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const r=Math.abs(t);if(r<1e-4)return`${t}`;const n=r>=100?e-2:r>=10?e-1:r>=1?e:r>=.1?e+1:r>=.01?e+2:r>=.001?e+3:e+4;return t.toFixed(n)}function Qc(t){return Math.round(t/yo)*yo}function mI(t,e,r){const n=t.length===e*r*4,i=t.length===e*r*3;if(n||i){const o=new Float32Array(e*r);let a=0,s=0;const c=n?4:3;for(let l=0;l<e;l++)for(let d=0;d<r;d++){const u=t[a],f=t[a+1],h=t[a+2];o[s]=(u+f+h)/3,a+=c,s++}return o}else return t}function lJ(t){if(t instanceof Gn)return Ne.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function jw(t,e){const r=[...t];return e>=r.length?(ZS(r),r):(ZS(r),r.slice(0,e))}function ZS(t){for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}}function L2(t){const e=t.toString(16);return e.length==1?"0"+e:e}function uJ(t,e,r){return"#"+L2(t)+L2(e)+L2(r)}function dJ(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const fJ=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:dJ,rgbToHex:uJ},Symbol.toStringTag,{value:"Module"}));function vI(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(r){return console.debug("Error in JSON.stringify during deep comparison:",r),t===e}}function hJ(t,e,r){if(!r)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!r?void 0:r(e).metadata.Modality;throw new Error("Invalid viewport type")}const gJ=(t,e)=>t.reduce((r,n)=>((r[n[e]]=r[n[e]]||[]).push(n),r),{});function pJ(t){const e=t.map(a=>{const{imagePositionPatient:s}=ut("imagePlaneModule",a)||{};return{imageId:a,imagePositionPatient:s}});if(!e.every(a=>a.imagePositionPatient))return null;const r=gJ(e,"imagePositionPatient"),n=Object.keys(r),i=r[n[0]].length;return i===1||!n.every(a=>r[a].length===i)?null:r}function mJ(t,e){const r={};let n=[];const i=Object.keys(t);for(let o=0;o<i.length;o++){const a=new Set,s=t[i[o]];for(let c=0;c<s.length;c++){const l=e(s[c].imageId)||0;if(r[l]=r[l]||[],r[l].push({imageId:s[c].imageId}),a.add(l),a.size-1<c)return}if(o==0)n=Array.from(a);else if(!CJ(n,a))return}return r}function Vd(t,e){const r=ut(e,t);try{return parseFloat(r)}catch{return}}function vJ(t){const e=ut("20011003",t);try{const{InlineBinary:r}=e;if(r){const n=atob(r),i=new ArrayBuffer(n.length),o=new DataView(i);for(let a=0;a<n.length;a++)o.setUint8(a,n.charCodeAt(a));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function yJ(t){let e=ut("0019100c",t)||ut("0019100C",t);try{const{InlineBinary:r}=e;return r&&(e=atob(r)),parseFloat(e)}catch{return}}function wJ(t){let e=ut("00431039",t);try{const{InlineBinary:r}=e;return r&&(e=atob(r).split("//")),parseFloat(e[0])%1e5}catch{return}}function CJ(t,e){if(t.length!=e.size)return!1;for(let r=0;r<t.length;r++)if(!e.has(t[r]))return!1;return!0}function xJ(t){const e=ut("petImageModule",t);return e?e.frameReferenceTime:0}function yI(t){const e=pJ(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const r=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],n=[i=>Vd(i,r[0]),i=>Vd(i,r[1]),i=>Vd(i,r[2]),i=>Vd(i,r[3]),i=>Vd(i,r[4]),vJ,yJ,wJ,xJ];for(let i=0;i<n.length;i++){const o=mJ(e,n[i]);if(o)return{imageIdGroups:Object.keys(o).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>o[c].map(l=>l.imageId)),splittingTag:r[i]}}return{imageIdGroups:[t],splittingTag:null}}function SJ(t){const{imageIdGroups:e,splittingTag:r}=yI(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:r}}function TJ(t,e){const r=t.length,{rescaleSlope:n,rescaleIntercept:i,suvbw:o}=e;if(e.modality==="PT"&&typeof o=="number")for(let a=0;a<r;a++)t[a]=o*(t[a]*n+i);else for(let a=0;a<r;a++)t[a]=t[a]*n+i;return t}function Jp(t,e,r){return Math.min(Math.max(e,t),r)}function Ou(t,e){if(!Ce(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof Wn&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:o}=e;if(t instanceof Gn)_J(t,n,i,o);else{const a=t.getCurrentImageIdIndex();if(a+i>t.getImageIds().length-1||a+i<0){const s={imageIdIndex:a,direction:i};Ye(Fe,$e.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function _J(t,e,r,n=!1){const i=n,{numScrollSteps:o,currentStepIndex:a,sliceRangeInfo:s}=yu(t,e,i);if(o===0||!s)return;const{sliceRange:c,spacingInNormalDirection:l,camera:d}=s,{focalPoint:u,viewPlaneNormal:f,position:h}=d,{newFocalPoint:g,newPosition:p}=T0(u,h,c,f,l,r);t.setCamera({focalPoint:g,position:p}),t.render();const v=a+r,w={volumeId:e,viewport:t,delta:r,desiredStepIndex:v,currentStepIndex:a,numScrollSteps:o,currentImageId:t.getCurrentImageId()};(v>o||v<0)&&t.getCurrentImageId()?Ye(Fe,$e.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,w):Ye(Fe,$e.VOLUME_VIEWPORT_SCROLL,w)}async function Hw(t,e={}){const{imageIndex:r,debounceLoading:n,volumeId:i}=e,o=Ce(t);if(!o)throw new Error("Element has been disabled");const{viewport:a}=o,{imageIndex:s,numberOfSlices:c}=EJ(a,n),d=bJ(c,r)-s;Ou(a,{delta:d,debounceLoading:n,volumeId:i})}function EJ(t,e){return t instanceof Wn?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function bJ(t,e){const r=t-1;return Jp(e,0,r)}function Xw(t,e,r={}){const n=Ne.getVolume(t);if(!n)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:o,direction:a,dimensions:s}=n,{minX:c,maxX:l,minY:d,maxY:u,minZ:f,maxZ:h}=e,g=[Math.min(c,l),Math.min(d,u),Math.min(f,h)],p=$0(n.imageData,g),v=[Math.abs(l-c)+1,Math.abs(u-d)+1,Math.abs(h-f)+1],{targetBuffer:w}=r,m={metadata:i,dimensions:v,spacing:o,origin:p,direction:a,targetBuffer:w,scalarData:w?.type==="Float32Array"?new Float32Array(v[0]*v[1]*v[2]):void 0},y=bw(cn(),m),C=y.voxelManager.getCompleteScalarDataArray(),x=v[0]*v[1],S=s[0]*s[1],T=n.voxelManager.getCompleteScalarDataArray();for(let _=0;_<v[2];_++)for(let E=0;E<v[1];E++){const D=$0(y.imageData,[0,E,_]),b=br(n.imageData,D),I=b[2]*S+b[1]*s[0]+b[0],O=T.slice(I,I+v[0]),M=_*x+E*v[0];C.set(O,M)}return y.voxelManager.setCompleteScalarDataArray(C),y}function am(t,e){const{viewUp:r,viewPlaneNormal:n}=e,i=np(t,[0,0,0]),o=ga(Ie(),r),a=ga(Ie(),n),s=tn(Ie(),o,a),c=rn(Ie(),np(t,o),i),l=rn(Ie(),np(t,a),i);Lt(c,c),Lt(l,l);const d=tn(Ie(),c,l);return{worldVecRowDir:s,worldVecColDir:o,worldVecSliceDir:a,ijkVecRowDir:d,ijkVecColDir:c,ijkVecSliceDir:l}}function wI(t,e,r,n){const[i,o,a]=e,s=i*o;let c=0,l=0,d=0;const[u,f,h]=r.map(Math.round);for(let w=h-n;w<=h+n;w++)if(!(w<0||w>=a)){for(let m=f-n;m<=f+n;m++)if(!(m<0||m>=o))for(let y=u-n;y<=u+n;y++){if(y<0||y>=i)continue;const C=w*s+m*i+y,x=t[C];c+=x,l+=x*x,d++}}if(d===0){const w=h*s+f*i+u;return w>=0&&w<t.length?{mean:t[w],stdDev:0,count:1}:{mean:0,stdDev:0,count:0}}const g=c/d,p=l/d-g*g,v=Math.sqrt(Math.max(0,p));return{mean:g,stdDev:v,count:d}}const DJ=new Set(["1.2.840.10008.5.1.4.1.1.1","1.2.840.10008.5.1.4.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.2","1.2.840.10008.5.1.4.1.1.1.2.1","1.2.840.10008.5.1.4.1.1.1.3","1.2.840.10008.5.1.4.1.1.1.3.1","1.2.840.10008.5.1.4.1.1.12.1","1.2.840.10008.5.1.4.1.1.12.1.1","1.2.840.10008.5.1.4.1.1.12.2","1.2.840.10008.5.1.4.1.1.12.2.1","1.2.840.10008.5.1.4.1.1.12.3"]);function CI(t){const{PixelSpacing:e,ImagerPixelSpacing:r,EstimatedRadiographicMagnificationFactor:n,DistanceSourceToDetector:i,DistanceSourceToPatient:o}=t;if(n)return n;if(o<i)return i/o;if(r?.[0]>e?.[0])return!0}function xI(t){const{PixelSpacing:e,ImagerPixelSpacing:r,PixelSpacingCalibrationType:n}=t,i=!0;if(e&&n==="GEOMETRY")return Et(e,r)&&console.warn("Calibration type is geometry, but pixel spacing and imager pixel spacing identical",e,r),{PixelSpacing:e,type:oa.ERMF,isProjection:i};if(e&&n==="FIDUCIAL")return{PixelSpacing:e,type:oa.CALIBRATED,isProjection:i};if(r){const o=CI(t);return o>1?{PixelSpacing:r.map(s=>s/o),type:oa.ERMF,isProjection:i}:o===!0?{PixelSpacing:e,type:oa.ERMF,isProjection:i}:(o&&console.error("Illegal ERMF value:",o),{PixelSpacing:e||r,type:oa.PROJECTION,isProjection:i})}return{PixelSpacing:e,type:oa.UNKNOWN,isProjection:i}}function IJ(t){const{PixelSpacing:e,SOPClassUID:r}=t;return DJ.has(r)?xI(t):{PixelSpacing:e,type:oa.NOT_APPLICABLE,isProjection:!1}}const SI=(t,e)=>hJ(t,e,Ne.getVolume),hn=Object.freeze(Object.defineProperty({__proto__:null,FrameRange:_0,HistoryMemo:Ww,PointsManager:sp,ProgressiveIterator:zp,RLEVoxelMap:o0,VoxelManager:ns,actorIsA:Gi,applyPreset:wD,asArray:wy,autoLoad:ly,buildMetadata:PD,calculateNeighborhoodStats:wI,calculateRadiographicPixelSpacing:xI,calculateSpacingBetweenImageIds:nD,calculateViewportsSpatialRegistration:gI,calibratedPixelSpacingMetadataProvider:JY,clamp:gy,clip:Jp,color:fJ,colormap:PV,convertStackToVolumeViewport:sJ,convertToGrayscale:mI,convertVolumeToStackViewport:cJ,createLinearRGBTransferFunction:AD,createSigmoidRGBTransferFunction:J5,createSubVolume:Xw,decimate:aD,deepClone:Bo,deepEqual:vI,deepMerge:kr,eventListener:zY,fnv1aHash:B4,generateVolumePropsFromImageIds:Y1,genericMetadataProvider:Jc,getBufferConfiguration:Tw,getClosestImageId:rc,getClosestStackImageIndexForPoint:$w,getCurrentVolumeViewportSlice:zw,getDynamicVolumeInfo:SJ,getERMF:CI,getImageDataMetadata:em,getImageLegacy:oJ,getImageSliceDataForVolumeViewport:Hp,getMinMax:Gw,getPixelSpacingInformation:IJ,getRandomSampleFromArray:jw,getRuntimeId:sI,getScalingParameters:iD,getSliceRange:Q1,getSpacingInNormalDirection:ml,getTargetVolumeAndSpacingInNormalDir:ad,getViewportImageCornersInWorld:Yp,getViewportImageIds:lJ,getViewportModality:SI,getViewportsWithImageURI:qp,getViewportsWithVolumeId:Ah,getVoiFromSigmoidRGBTransferFunction:yD,getVolumeActorCorners:hD,getVolumeDirectionVectors:am,getVolumeId:cs,getVolumeSliceRangeInfo:vD,getVolumeViewportScrollInfo:yu,getVolumeViewportsContainingSameVolumes:ZY,hasFloatScalingParameters:Ew,hasNaNValues:dy,imageIdToURI:Yn,imageRetrieveMetadataProvider:B0,imageToWorldCoords:hI,indexWithinDimensions:Sr,invertRgbTransferFunction:gf,isEqual:Et,isEqualAbs:tp,isEqualNegative:$4,isImageActor:Uo,isNumber:nr,isOpposite:of,isPTPrescaledWithSUV:cI,isValidVolume:vl,isVideoTransferSyntax:pI,jumpToSlice:Hw,loadImageToCanvas:QY,logger:LK,makeVolumeMetadata:tD,planar:zX,pointInShapeCallback:pw,renderToCanvasCPU:uI,renderToCanvasGPU:lI,roundNumber:Ht,roundToPrecision:Qc,scaleArray:TJ,scaleRgbTransferFunction:jY,scroll:Ou,snapFocalPointToSlice:T0,sortImageIdsAndGetSpacing:rD,spatialRegistrationMetadataProvider:eh,splitImageIdsBy4DTags:yI,transferFunctionUtils:LV,transformIndexToWorld:$0,transformWorldToIndex:br,transformWorldToIndexContinuous:np,triggerEvent:Ye,updatePlaneRestriction:mD,updateVTKImageDataWithCornerstoneImage:nm,uuidv4:cn,windowLevel:AV,worldToImageCoords:Cy},Symbol.toStringTag,{value:"Module"})),Nh=new g5("imageRetrievalPool");Nh.setMaxSimultaneousRequests(Jt.Interaction,200);Nh.setMaxSimultaneousRequests(Jt.Thumbnail,200);Nh.setMaxSimultaneousRequests(Jt.Prefetch,200);Nh.grabDelay=0;const QS=Symbol("DefaultSettings"),eT=Symbol("RuntimeSettings"),tT=Symbol("ObjectSettingsMap"),Rs=Symbol("Dictionary");class tr{constructor(e){const r=Object.create(e instanceof tr&&Rs in e?e[Rs]:null);Object.seal(Object.defineProperty(this,Rs,{value:r}))}set(e,r){return Zp(this[Rs],e,r,null)}get(e){return PJ(this[Rs],e)}unset(e){return MJ(this[Rs],e+"")}forEach(e){nT(this[Rs],e)}extend(){return new tr(this)}import(e){TI(e)&&Object.keys(e).forEach(r=>{Zp(this[Rs],r,e[r],null)})}dump(){const e={};return nT(this[Rs],(r,n)=>{typeof n<"u"&&_I(e,r,n)}),e}static assert(e){return e instanceof tr?e:tr.getRuntimeSettings()}static getDefaultSettings(e=null){let r=tr[QS];if(r instanceof tr||(r=new tr,tr[QS]=r),e){const n={};return r.forEach(i=>{if(i.startsWith(e)){const o=i.split(`${e}.`)[1];n[o]=r.get(i)}}),n}return r}static getRuntimeSettings(){let e=tr[eT];return e instanceof tr||(e=new tr(tr.getDefaultSettings()),tr[eT]=e),e}static getObjectSettings(e,r){let n=null;if(e instanceof tr)n=e;else if(typeof e=="object"&&e!==null){let i=tr[tT];i instanceof WeakMap||(i=new WeakMap,tr[tT]=i),n=i.get(e),n instanceof tr||(n=new tr(tr.assert(tr.getObjectSettings(r))),i.set(e,n))}return n}static extendRuntimeSettings(){return tr.getRuntimeSettings().extend()}}function MJ(t,e){if(e.endsWith(".")){let r=0;const n=e,i=n.slice(0,-1),o=i.length===0;for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(o||a.startsWith(n)||a===i)&&(delete t[a],++r);return r>0}return delete t[e]}function nT(t,e){for(const r in t)e(r,t[r])}function OJ(t,e,r,n){let i;if(n.has(r))return Zp(t,e,null,n);n.add(r),i=0;for(const o in r)if(Object.prototype.hasOwnProperty.call(r,o)){const a=o.length===0?e:`${e}.${o}`;Zp(t,a,r[o],n)||++i}return n.delete(r),i===0}function Zp(t,e,r,n){return RJ(e)?TI(r)?OJ(t,e,r,n instanceof WeakSet?n:new WeakSet):(t[e]=r,!0):!1}function PJ(t,e){return t[e]}function RJ(t){let e,r,n;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(n=-1;(r=t.indexOf(".",n+1))>=0;){if(r-n<2||r===e)return!1;n=r}return!0}function TI(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function _I(t,e,r){const n=e.indexOf(".");if(n>=0){const i=e.slice(0,n);let o=t[i];if(typeof o!="object"||o===null){const a=o;o={},typeof a<"u"&&(o[""]=a),t[i]=o}_I(o,e.slice(n+1,e.length),r)}else t[e]=r}tr.getDefaultSettings().set("useCursors",!0);function AJ(t,e){let r;if(e===void 0)for(const n of t)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of t)(i=e(i,++n,t))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function LJ(t){if(!(o=t.length))return[];for(var e=-1,r=AJ(t,NJ),n=new Array(r);++e<r;)for(var i=-1,o,a=n[e]=new Array(o);++i<o;)a[i]=t[i][e];return n}function NJ(t){return t.length}function rT(){return LJ(arguments)}function VJ(t,e,r,n,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*r+(1+3*t+3*o-3*a)*n+a*i)/6}function N2(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),i=t[n],o=t[n+1],a=n>0?t[n-1]:2*i-o,s=n<e-1?t[n+2]:2*o-i;return VJ((r-n/e)*e,a,i,o,s)}}function kd(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t(n/(e-1));return r}function kJ(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=r=>{e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.imageBitmap=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setImageBitmap=r=>{e.imageBitmap!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.jsImageData=null),e.imageBitmap=r,e.imageLoaded=!0,t.modified())},t.setCanvas=r=>{e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.imageBitmap=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=r=>{e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null,e.imageBitmap=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let r=0,n=0,i=1;if(t.getInputData()){const a=t.getInputData();r=a.getDimensions()[0],n=a.getDimensions()[1],i=a.getDimensions()[2]}return e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height),e.imageBitmap&&(r=e.imageBitmap.width,n=e.imageBitmap.height),(r>1)+(n>1)+(i>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData;if(e.imageBitmap)return e.imageBitmap;if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const r=e.image.width,n=e.image.height,o=new OffscreenCanvas(r,n).getContext("2d");return o.translate(0,n),o.scale(1,-1),o.drawImage(e.image,0,0,r,n),o.getImageData(0,0,r,n)}return null}}const FJ=(t,e,r)=>{const i=t.createShaderModule({code:`
    @group(0) @binding(0) var inputTexture: texture_2d<f32>;
    @group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;

    @compute @workgroup_size(8, 8)
    fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
      let texelCoord = vec2<i32>(global_id.xy);
      let outputSize = textureDimensions(outputTexture);

      if (texelCoord.x >= i32(outputSize.x) || texelCoord.y >= i32(outputSize.y)) {
        return;
      }

      let inputSize = textureDimensions(inputTexture);
      let scale = vec2<f32>(inputSize) / vec2<f32>(outputSize);

      // Compute the floating-point source coordinate
      let srcCoord = (vec2<f32>(texelCoord) + 0.5) * scale - 0.5;

      // Get integer coordinates for the four surrounding texels
      let x0 = i32(floor(srcCoord.x));
      let x1 = min(x0 + 1, i32(inputSize.x) - 1);
      let y0 = i32(floor(srcCoord.y));
      let y1 = min(y0 + 1, i32(inputSize.y) - 1);

      // Compute the weights
      let wx = srcCoord.x - f32(x0);
      let wy = srcCoord.y - f32(y0);

      // Fetch the four texels
      let c00 = textureLoad(inputTexture, vec2<i32>(x0, y0), 0);
      let c10 = textureLoad(inputTexture, vec2<i32>(x1, y0), 0);
      let c01 = textureLoad(inputTexture, vec2<i32>(x0, y1), 0);
      let c11 = textureLoad(inputTexture, vec2<i32>(x1, y1), 0);

      // Bilinear interpolation
      let color = mix(
        mix(c00, c10, wx),
        mix(c01, c11, wx),
        wy
      );

      textureStore(outputTexture, texelCoord, color);
    }
  `}),o=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm",access:"write-only"}},{binding:2,visibility:GPUShaderStage.COMPUTE,sampler:{type:"filtering"}}]}),a=t.createPipelineLayout({bindGroupLayouts:[o]}),s=t.createComputePipeline({label:"ComputeMipmapPipeline",layout:a,compute:{module:i,entryPoint:"main"}}),c=t.createSampler({magFilter:"linear",minFilter:"linear"});for(let l=1;l<r;l++){const d=e.createView({baseMipLevel:l-1,mipLevelCount:1}),u=e.createView({baseMipLevel:l,mipLevelCount:1}),f=t.createBindGroup({layout:s.getBindGroupLayout(0),entries:[{binding:0,resource:d},{binding:1,resource:u},{binding:2,resource:c}]}),h=t.createCommandEncoder({label:"MipmapGenerateCommandEncoder"}),g=h.beginComputePass();g.setPipeline(s),g.setBindGroup(0,f);const p=Math.max(1,e.width>>l),v=Math.max(1,e.height>>l),w=Math.ceil(p/8),m=Math.ceil(v/8);g.dispatchWorkgroups(w,m),g.end(),t.queue.submit([h.finish()])}},UJ={image:null,canvas:null,jsImageData:null,imageBitmap:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function EI(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UJ,r),Z.obj(t,e),Z.algo(t,e,6,0),Z.get(t,e,["canvas","image","jsImageData","imageBitmap","imageLoaded","resizable"]),Z.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),kJ(t,e)}const BJ=Z.newInstance(EI,"vtkTexture"),GJ={generateMipmaps:FJ};var WJ={newInstance:BJ,extend:EI,...GJ},rs;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(rs||(rs={}));var jr;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})(jr||(jr={}));var Cn;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(Cn||(Cn={}));var ca;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(ca||(ca={}));var V;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",t.VOLUMECROPPINGCONTROL_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPINGCONTROL_TOOL_CHANGED",t.VOLUMECROPPING_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPING_TOOL_CHANGED",t.STACK_PREFETCH_COMPLETE="CORNERSTONE_TOOLS_STACK_PREFETCH_COMPLETE",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",t.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(V||(V={}));var yt;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(yt||(yt={}));var gu;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(gu||(gu={}));var ht;(function(t){t.CalculateCursorGeometry="calculateCursorGeometry",t.RenderCursor="renderCursor",t.OnInteractionStart="onInteractionStart",t.OnInteractionEnd="onInteractionEnd",t.Preview="preview",t.RejectPreview="rejectPreview",t.AcceptPreview="acceptPreview",t.Fill="fill",t.Interpolate="interpolate",t.StrategyFunction="strategyFunction",t.CreateIsInThreshold="createIsInThreshold",t.Initialize="initialize",t.INTERNAL_setValue="setValue",t.AddPreview="addPreview",t.ComputeInnerCircleRadius="computeInnerCircleRadius",t.GetStatistics="getStatistics",t.EnsureImageVolumeFor3DManipulation="ensureImageVolumeFor3DManipulation",t.EnsureSegmentationVolumeFor3DManipulation="ensureSegmentationVolumeFor3DManipulation"})(ht||(ht={}));var At;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated",t.History="History",t.MetadataReferenceModified="MetadataReferenceModified",t.LabelChange="LabelChange"})(At||(At={}));var Co;(function(t){t.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",t.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",t.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",t.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",t.SURFACE_CLIPPING="Clipping Surfaces",t.COMPUTE_STATISTICS="Computing Statistics",t.INTERPOLATE_LABELMAP="Interpolating Labelmap",t.COMPUTE_LARGEST_BIDIRECTIONAL="Computing Largest Bidirectional",t.GENERATE_CONTOUR_SETS="Generating Contour Sets"})(Co||(Co={}));var Wo;(function(t){t.Linear="Linear",t.Area="Area",t.Volume="Volume",t.Pixel="Pixel"})(Wo||(Wo={}));const $J=Object.freeze(Object.defineProperty({__proto__:null,AnnotationStyleStates:ca,ChangeTypes:At,Events:V,get KeyboardBindings(){return jr},get MeasurementType(){return Wo},get MouseBindings(){return rs},SegmentationRepresentations:yt,StrategyCallbacks:ht,get Swipe(){return gu},ToolModes:Cn,WorkerTypes:Co},Symbol.toStringTag,{value:"Module"}));let sm={};function zJ(){sm={}}const iT={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:sm,enabledElements:[],handleRadius:6};let Ue={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:sm,enabledElements:[],handleRadius:6};function jJ(){zJ(),Ue={...structuredClone({...iT,svgNodeCache:{}}),svgNodeCache:{...iT.svgNodeCache}}}var V2,oT;function HJ(){if(oT)return V2;oT=1;var t="Expected a function",e="__lodash_hash_undefined__",r="[object Function]",n="[object GeneratorFunction]",i="[object Symbol]",o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/,s=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/[\\^$.*+?()[\]{}|]/g,d=/\\(\\)?/g,u=/^\[object .+?Constructor\]$/,f=typeof Ws=="object"&&Ws&&Ws.Object===Object&&Ws,h=typeof self=="object"&&self&&self.Object===Object&&self,g=f||h||Function("return this")();function p(Oe,ke){return Oe?.[ke]}function v(Oe){var ke=!1;if(Oe!=null&&typeof Oe.toString!="function")try{ke=!!(Oe+"")}catch{}return ke}var w=Array.prototype,m=Function.prototype,y=Object.prototype,C=g["__core-js_shared__"],x=(function(){var Oe=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||"");return Oe?"Symbol(src)_1."+Oe:""})(),S=m.toString,T=y.hasOwnProperty,_=y.toString,E=RegExp("^"+S.call(T).replace(l,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),D=g.Symbol,b=w.splice,I=Ge(g,"Map"),O=Ge(Object,"create"),M=D?D.prototype:void 0,R=M?M.toString:void 0;function A(Oe){var ke=-1,nt=Oe?Oe.length:0;for(this.clear();++ke<nt;){var wt=Oe[ke];this.set(wt[0],wt[1])}}function G(){this.__data__=O?O(null):{}}function k(Oe){return this.has(Oe)&&delete this.__data__[Oe]}function L(Oe){var ke=this.__data__;if(O){var nt=ke[Oe];return nt===e?void 0:nt}return T.call(ke,Oe)?ke[Oe]:void 0}function F(Oe){var ke=this.__data__;return O?ke[Oe]!==void 0:T.call(ke,Oe)}function j(Oe,ke){var nt=this.__data__;return nt[Oe]=O&&ke===void 0?e:ke,this}A.prototype.clear=G,A.prototype.delete=k,A.prototype.get=L,A.prototype.has=F,A.prototype.set=j;function Y(Oe){var ke=-1,nt=Oe?Oe.length:0;for(this.clear();++ke<nt;){var wt=Oe[ke];this.set(wt[0],wt[1])}}function ie(){this.__data__=[]}function de(Oe){var ke=this.__data__,nt=K(ke,Oe);if(nt<0)return!1;var wt=ke.length-1;return nt==wt?ke.pop():b.call(ke,nt,1),!0}function ae(Oe){var ke=this.__data__,nt=K(ke,Oe);return nt<0?void 0:ke[nt][1]}function fe(Oe){return K(this.__data__,Oe)>-1}function we(Oe,ke){var nt=this.__data__,wt=K(nt,Oe);return wt<0?nt.push([Oe,ke]):nt[wt][1]=ke,this}Y.prototype.clear=ie,Y.prototype.delete=de,Y.prototype.get=ae,Y.prototype.has=fe,Y.prototype.set=we;function _e(Oe){var ke=-1,nt=Oe?Oe.length:0;for(this.clear();++ke<nt;){var wt=Oe[ke];this.set(wt[0],wt[1])}}function Se(){this.__data__={hash:new A,map:new(I||Y),string:new A}}function B(Oe){return Le(this,Oe).delete(Oe)}function P(Oe){return Le(this,Oe).get(Oe)}function $(Oe){return Le(this,Oe).has(Oe)}function W(Oe,ke){return Le(this,Oe).set(Oe,ke),this}_e.prototype.clear=Se,_e.prototype.delete=B,_e.prototype.get=P,_e.prototype.has=$,_e.prototype.set=W;function K(Oe,ke){for(var nt=Oe.length;nt--;)if(st(Oe[nt][0],ke))return nt;return-1}function Q(Oe,ke){ke=re(ke,Oe)?[ke]:De(ke);for(var nt=0,wt=ke.length;Oe!=null&&nt<wt;)Oe=Oe[pe(ke[nt++])];return nt&&nt==wt?Oe:void 0}function ee(Oe){if(!Ee(Oe)||ve(Oe))return!1;var ke=ct(Oe)||v(Oe)?E:u;return ke.test(We(Oe))}function ge(Oe){if(typeof Oe=="string")return Oe;if(Ke(Oe))return R?R.call(Oe):"";var ke=Oe+"";return ke=="0"&&1/Oe==-1/0?"-0":ke}function De(Oe){return gt(Oe)?Oe:le(Oe)}function Le(Oe,ke){var nt=Oe.__data__;return se(ke)?nt[typeof ke=="string"?"string":"hash"]:nt.map}function Ge(Oe,ke){var nt=p(Oe,ke);return ee(nt)?nt:void 0}function re(Oe,ke){if(gt(Oe))return!1;var nt=typeof Oe;return nt=="number"||nt=="symbol"||nt=="boolean"||Oe==null||Ke(Oe)?!0:a.test(Oe)||!o.test(Oe)||ke!=null&&Oe in Object(ke)}function se(Oe){var ke=typeof Oe;return ke=="string"||ke=="number"||ke=="symbol"||ke=="boolean"?Oe!=="__proto__":Oe===null}function ve(Oe){return!!x&&x in Oe}var le=oe(function(Oe){Oe=Je(Oe);var ke=[];return s.test(Oe)&&ke.push(""),Oe.replace(c,function(nt,wt,gn,Sn){ke.push(gn?Sn.replace(d,"$1"):wt||nt)}),ke});function pe(Oe){if(typeof Oe=="string"||Ke(Oe))return Oe;var ke=Oe+"";return ke=="0"&&1/Oe==-1/0?"-0":ke}function We(Oe){if(Oe!=null){try{return S.call(Oe)}catch{}try{return Oe+""}catch{}}return""}function oe(Oe,ke){if(typeof Oe!="function"||ke&&typeof ke!="function")throw new TypeError(t);var nt=function(){var wt=arguments,gn=ke?ke.apply(this,wt):wt[0],Sn=nt.cache;if(Sn.has(gn))return Sn.get(gn);var ln=Oe.apply(this,wt);return nt.cache=Sn.set(gn,ln),ln};return nt.cache=new(oe.Cache||_e),nt}oe.Cache=_e;function st(Oe,ke){return Oe===ke||Oe!==Oe&&ke!==ke}var gt=Array.isArray;function ct(Oe){var ke=Ee(Oe)?_.call(Oe):"";return ke==r||ke==n}function Ee(Oe){var ke=typeof Oe;return!!Oe&&(ke=="object"||ke=="function")}function ze(Oe){return!!Oe&&typeof Oe=="object"}function Ke(Oe){return typeof Oe=="symbol"||ze(Oe)&&_.call(Oe)==i}function Je(Oe){return Oe==null?"":ge(Oe)}function lt(Oe,ke,nt){var wt=Oe==null?void 0:Q(Oe,ke);return wt===void 0?nt:wt}return V2=lt,V2}var XJ=HJ();const KJ=wa(XJ),aT=Symbol("DefinedCursors"),bI=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class bi{constructor(e,r){this.name=e+"",this.fallback=r}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:r}=this;return r instanceof bi?`${e}, ${r.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const r=sT(bi,aT);let n=r.get(e);if(n instanceof bi)return n;if(bI.has(e))return n=new bi(e),r.set(e,n),n}static setDefinedCursor(e,r){return r instanceof bi?(sT(bi,aT).set(e,r),!0):!1}}function sT(t,e){let r=t[e];return r instanceof Map||(r=new Map,Object.defineProperty(t,e,{value:r})),r}const qJ=bI.values(),YJ="image-cursor";class th extends bi{constructor(e,r,n,i,o){super(i||th.getUniqueInstanceName(YJ),o),this.url=e,this.x=Number(r)||0,this.y=Number(n)||0}getStyleProperty(){const{url:e,x:r,y:n}=this;let i=`url('${e}')`;return r>=0&&n>=0&&(r>0||n>0)&&(i+=` ${r} ${n}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${sI(th)}`}}const Tn={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},qi={x:127,y:60},qu=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,Uc=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,Eg='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Yu='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',bg='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',cm={Angle:_n(Tn,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:_n(Tn,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:_n(Tn,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:_n(Tn,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:_n(Tn,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:_n(Tn,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:_n(Tn,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:_n(Tn,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:_n(Tn,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:_n(Tn,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:_n(Tn,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:_n(Tn,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),Label:_n(Tn,{name:"Label",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:_n(Tn,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:_n(Tn,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:_n(Tn,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:_n(Tn,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:_n(Tn,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:_n(Tn,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:_n(Tn,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:_n(Tn,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:_n(Tn,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:_n(Tn,{name:"SegmentationFreeHandEraseInside",iconContent:`${Eg} ${qu}`,viewBox:qi}),SegmentationFreeHandFillInside:_n(Tn,{name:"SegmentationFreeHandFillInside",iconContent:`${Eg} ${Uc}`,viewBox:qi}),SegmentationFreeHandEraseOutside:_n(Tn,{name:"SegmentationFreeHandEraseOutside",iconContent:`${Eg} ${qu}`,viewBox:qi}),SegmentationFreeHandFillOutside:_n(Tn,{name:"SegmentationFreeHandFillOutside",iconContent:`${Eg} ${Uc}`,viewBox:qi}),SegmentationRectangleEraseInside:_n(Tn,{name:"SegmentationRectangleEraseInside",iconContent:`${Yu} ${qu}`,viewBox:qi}),RectangleScissor:_n(Tn,{name:"RectangleScissor",iconContent:`${Yu} ${Uc}`,viewBox:qi}),"RectangleScissor.FILL_INSIDE":_n(Tn,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${Yu} ${Uc}`,viewBox:qi}),"RectangleScissor.FILL_OUTSIDE":_n(Tn,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${Yu} ${Uc}`,viewBox:qi}),"RectangleScissor.ERASE_OUTSIDE":_n(Tn,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${Yu} ${qu}`,viewBox:qi}),"RectangleScissor.ERASE_INSIDE":_n(Tn,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${Yu} ${qu}`,viewBox:qi}),CircleScissor:_n(Tn,{name:"CircleScissor",iconContent:`${bg} ${Uc}`,viewBox:qi}),"CircleScissor.FILL_INSIDE":_n(Tn,{name:"CircleScissor.FILL_INSIDE",iconContent:`${bg} ${Uc}`,viewBox:qi}),"CircleScissor.ERASE_OUTSIDE":_n(Tn,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${bg} ${qu}`,viewBox:qi}),"CircleScissor.FILL_OUTSIDE":_n(Tn,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${bg} ${Uc}`,viewBox:qi})};function _n(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function JJ(t,e,r){cm[t]=_n(Tn,{iconContent:e,viewBox:r})}function ZJ(t){return cm[t]}const QJ=Object.keys(cm);class eZ{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0,markerSize:"10",angleArcLineDash:""};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,r){let n=this.config.annotations;n||(this.config={...this.config,annotations:{}},n=this.config.annotations),n[e]=r}setViewportToolStyles(e,r){let n=this.config.viewports;n||(this.config={...this.config,viewports:{}},n=this.config.viewports),n[e]=r}setToolGroupToolStyles(e,r){let n=this.config.toolGroups;n||(this.config={...this.config,toolGroups:{}},n=this.config.toolGroups),n[e]=r}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,r){const{annotationUID:n,viewportId:i,toolGroupId:o,toolName:a}=r;return this._getToolStyle(e,n,i,o,a)}_getToolStyle(e,r,n,i,o){if(r){const s=this.getAnnotationToolStyles(r);if(s&&s[e]!==void 0)return s[e]}if(n){const s=this.getViewportToolStyles(n);if(s){if(s[o]&&s[o][e]!==void 0)return s[o][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[o]&&s[o][e]!==void 0)return s[o][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const a=this.getDefaultToolStyles();if(a[o]&&a[o][e]!==void 0)return a[o][e];if(a.global&&a.global[e]!==void 0)return a.global[e]}_initializeConfig(e){const r={};for(const n in e)r[n]=e[n];this.config={default:{global:r}}}}const Kw=new eZ;function tZ(t,e,r){const n=[`${t}`];return e&&n.push(`${n[0]}${e}`),r&&n.push(`${n[n.length-1]}${r}`),n}function Mi(t,e,r,n){const i=tZ(t,r,n);for(let o=i.length-1;o>=0;--o){const a=Kw.getStyleProperty(i[o],e);if(a!==void 0)return a}}const nZ="color",rZ=ca.Highlighted,iZ=Cn.Active;class E0 extends th{constructor(e,r,n,i,o){super(e,r,n,i,o)}static getDefinedCursor(e,r=!1,n){n||(n=Mi(nZ,{},rZ,iZ));const i=oZ(e,r,n);let o=super.getDefinedCursor(i);const a=Number(Mi("pointerStrokeWidth",{}));if(!o){const s=ZJ(e);s&&(o=aZ(s,i,r,n,a,super.getDefinedCursor("default")),super.setDefinedCursor(i,o))}return o}}function DI(t,e){const r=Object(e),n=Object.prototype.hasOwnProperty.bind(r);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,o)=>n(o)?r[o]+"":"")}function oZ(t,e,r){return`${e?"pointer":"cursor"}:${t}/${r}`}function aZ(t,e,r,n,i,o){const{x:a,y:s}=t.mousePoint;return new E0(sZ(t,r,{color:n,pointerStrokeWidth:i}),a,s,e,o)}function sZ(t,e,r){const n=cZ(t,e,r);return`${URL.createObjectURL(n)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function cZ(t,e,r){const n=(e?uZ:lZ)(t,r);return new Blob([n],{type:"image/svg+xml"})}function lZ(t,e){const{iconContent:r,iconSize:n,viewBox:i}=t,o=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${n}" height="${n}" viewBox="0 0
      ${i.x} ${i.y}">
      ${r}
    </svg>`;return DI(o,e)}function uZ(t,e){const{iconContent:r,iconSize:n,viewBox:i,mousePointerGroupString:o}=t,a=n/Math.max(i.x,i.y,1),s=16+n,c=e.pointerStrokeWidth||1,l=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g stroke-width="${c}">${o}</g>
      <g transform="translate(16, 16) scale(${a})">${r}</g>
    </svg>`;return DI(l,e)}const cT=Symbol("ElementCursorsMap");function II(t,e){nh(t)[0]=e,Vh(t,e)}function Vh(t,e){const r=nh(t);r[1]=r[0],r[0]=e,t.style.cursor=(e instanceof bi?e:bi.getDefinedCursor("auto")).getStyleProperty()}function Nt(t){Vh(t,nh(t)[1])}function St(t){Vh(t,bi.getDefinedCursor("none"))}function nh(t){let e=nh[cT];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(nh,cT,{value:e}));let r=e.get(t);return r||(r=[null,null],e.set(t,r)),r}const dZ=Object.freeze(Object.defineProperty({__proto__:null,hideElementCursor:St,initElementCursor:II,resetElementCursor:Nt,setElementCursor:Vh},Symbol.toStringTag,{value:"Module"}));function fZ(t,e){let r=E0.getDefinedCursor(e,!0);r||(r=bi.getDefinedCursor(e)),r||(console.log(`Cursor ${e} is not defined either as SVG or as a standard cursor.`),r=bi.getDefinedCursor(e)),Vh(t,r)}const hZ=[...QJ,...qJ],gZ=Object.freeze(Object.defineProperty({__proto__:null,CursorNames:hZ,CursorSVG:cm,ImageMouseCursor:th,MouseCursor:bi,SVGMouseCursor:E0,elementCursor:dZ,registerCursor:JJ,setCursorForElement:fZ},Symbol.toStringTag,{value:"Module"}));function Fr(t){return Ue.toolGroups.find(e=>e.id===t)}const{Active:Fd,Passive:k2,Enabled:F2,Disabled:U2}=Cn,pZ=[{mouseButton:rs.Primary}];class qw{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const r=this._toolInstances[e];if(!r){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return r}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,r={}){const n=Ue.tools[e],i=typeof e<"u"&&e!=="",o=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",r);return}if(!n){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(o){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:a}=n,s={name:e,toolGroupId:this.id,configuration:r},c=new a(s);this._toolInstances[e]=c}addToolInstance(e,r,n={}){let i=Ue.tools[e]?.toolClass;if(!i){const o=Ue.tools[r].toolClass;class a extends o{}a.toolName=e,i=a,Ue.tools[e]={toolClass:a}}this.addTool(i.toolName,n)}addViewport(e,r){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const n=this._findRenderingEngine(e,r);this.viewportsInfo.some(({viewportId:a})=>a===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:n});const i=this.getActivePrimaryMouseButtonTool();this.setViewportsCursorByToolName(i);const o={toolGroupId:this.id,viewportId:e,renderingEngineId:n};Ye(Fe,V.TOOLGROUP_VIEWPORT_ADDED,o)}removeViewports(e,r){const n=[];if(this.viewportsInfo.forEach((o,a)=>{let s=!1;o.renderingEngineId===e&&(s=!0,r&&o.viewportId!==r&&(s=!1)),s&&n.push(a)}),n.length)for(let o=n.length-1;o>=0;o--)this.viewportsInfo.splice(n[o],1);const i={toolGroupId:this.id,viewportId:r,renderingEngineId:e};Ye(Fe,V.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,r){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}n.setActiveStrategy(r)}setToolMode(e,r,n={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(r===Cn.Active){this.setToolActive(e,n||this.restoreToolOptions[e]);return}if(r===Cn.Passive){this.setToolPassive(e);return}if(r===Cn.Enabled){this.setToolEnabled(e);return}if(r===Cn.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,r={}){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!n){console.warn(`'${e}' instance ${n} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],o=r.bindings?r.bindings:[],s={bindings:[...i,...o].reduce((l,d)=>{const u=d.numTouchPoints!==void 0,f=d.mouseButton!==void 0;return!l.some(h=>B2(h,d))&&(u||f)&&l.push(d),l},[]),mode:Fd};if(this.toolOptions[e]=s,this._toolInstances[e].mode=Fd,this._hasMousePrimaryButtonBinding(r))this.setViewportsCursorByToolName(e),n.isPrimary=!0;else{if(!this.getActivePrimaryMouseButtonTool()){const d=bi.getDefinedCursor("default");this._setCursorForViewports(d)}n.isPrimary=!1}this._hasMousePrimaryButtonBinding(r)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof n.onSetToolActive=="function"&&n.onSetToolActive(),this._renderViewports();const c={toolGroupId:this.id,toolName:e,toolBindingsOptions:r};Ye(Fe,V.TOOL_ACTIVATED,c),this._triggerToolModeChangedEvent(e,Fd,r)}setToolPassive(e,r){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),o=Object.assign({bindings:i?i.bindings:[]},i,{mode:k2}),a=Array.isArray(r?.removeAllBindings)?r.removeAllBindings:this.getDefaultPrimaryBindings();o.bindings=o.bindings.filter(c=>r?.removeAllBindings!==!0&&!a.some(l=>B2(c,l)));let s=k2;o.bindings.length!==0&&(s=Fd,o.mode=s),this.toolOptions[e]=o,n.mode=s,n.isPrimary=!1,typeof n.onSetToolPassive=="function"&&n.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,k2)}setToolEnabled(e){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:F2};this.toolOptions[e]=n,r.mode=F2,typeof r.onSetToolEnabled=="function"&&r.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,F2)}setToolDisabled(e){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:U2};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=n,r.mode=U2,typeof r.onSetToolDisabled=="function"&&r.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,U2)}getToolOptions(e){const r=this.toolOptions[e];if(r!==void 0)return r}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const r=this.toolOptions[e];return r.mode===Fd&&this._hasMousePrimaryButtonBinding(r)})}setViewportsCursorByToolName(e,r){const n=this._getCursor(e,r);this._setCursorForViewports(n)}_getCursor(e,r){let n,i;return r&&(n=`${e}.${r}`,i=E0.getDefinedCursor(n,!0),i)||(n=`${e}`,i=E0.getDefinedCursor(n,!0),i)||(n=e,i=E0.getDefinedCursor(n,!0),i)?i:bi.getDefinedCursor("default")}_setCursorForViewports(e){tr.getRuntimeSettings().get("useCursors")&&this.viewportsInfo.forEach(({renderingEngineId:n,viewportId:i})=>{const o=Ln(i,n);if(!o)return;const{viewport:a}=o;II(a.element,e)})}setToolConfiguration(e,r,n){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let o;return n?o=r:o=Object.assign(i.configuration,r),i.configuration=o,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return rs.Primary}getDefaultPrimaryBindings(){return pZ}getToolConfiguration(e,r){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const n=KJ(this._toolInstances[e].configuration,r)||this._toolInstances[e].configuration;return Bo(n)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const r=this.getCurrentActivePrimaryToolName();this.setToolDisabled(r),this.setToolActive(e,{bindings:[{mouseButton:rs.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,r=null){let n=Fr(e);return n?(console.debug(`ToolGroup ${e} already exists`),n):(n=new qw(e),Ue.toolGroups.push(n),r=r??(()=>!0),Object.keys(this._toolInstances).filter(r).forEach(i=>{const o=this._toolInstances[i],a=this.toolOptions[i],s=o.mode;n.addTool(i),n.setToolMode(i,s,{bindings:a.bindings??[]})}),n)}_hasMousePrimaryButtonBinding(e){const r=this.getDefaultPrimaryBindings();return e?.bindings?.some(n=>r.some(i=>B2(n,i)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:r})=>{Fn(e).renderViewport(r)})}_triggerToolModeChangedEvent(e,r,n){const i={toolGroupId:this.id,toolName:e,mode:r,toolBindingsOptions:n};Ye(Fe,V.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,r){const n=eo();if(n?.length===0)throw new Error("No rendering engines found.");if(r)return r;const i=n.filter(o=>o.getViewport(e));if(i.length===0){if(n.length===1)return n[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function B2(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function mZ(t){if(Ue.toolGroups.some(n=>n.id===t)){console.warn(`'${t}' already exists.`);return}const r=new qw(t);return Ue.toolGroups.push(r),r}function MI(t){const e=Ue.toolGroups.findIndex(r=>r.id===t);e>-1&&Ue.toolGroups.splice(e,1)}function OI(){const t=[...Ue.toolGroups];for(const e of t)MI(e.id);Ue.toolGroups=[]}function Qn(t,e){e||(e=eo().find(n=>n.getViewports().find(i=>i.id===t))?.id);const r=Ue.toolGroups.filter(n=>n.viewportsInfo.some(i=>i.renderingEngineId===e&&(!i.viewportId||i.viewportId===t)));if(r.length){if(r.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return r[0]}}function vZ(){return Ue.toolGroups}const yZ=[Cn.Active,Cn.Passive,Cn.Enabled];function PI(t){return Ue.toolGroups.filter(({toolOptions:e})=>{const r=Object.keys(e);for(let n=0;n<r.length;n++)if(t===r[n]&&e[t]&&yZ.includes(e[t].mode))return!0;return!1})}const RI=Object.freeze(Object.defineProperty({__proto__:null,createToolGroup:mZ,destroy:OI,destroyToolGroup:MI,getAllToolGroups:vZ,getToolGroup:Fr,getToolGroupForViewport:Qn,getToolGroupsWithToolName:PI},Symbol.toStringTag,{value:"Module"}));function AI(t,e){const r=Ce(e),{renderingEngine:n,viewportId:i}=r,o=V.ANNOTATION_ADDED,a={annotation:t,viewportId:i,renderingEngineId:n.id};Ye(Fe,o,a)}function LI(t){const{toolName:e}=t.metadata,r=PI(e);if(!r.length)return;const n=[];r.forEach(a=>{a.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:l}=s,{FrameOfReferenceUID:d}=Ln(l,c);t.metadata.FrameOfReferenceUID===d&&n.push(s)})});const i=V.ANNOTATION_ADDED,o={annotation:t};if(!n.length){Ye(Fe,i,o);return}n.forEach(({renderingEngineId:a,viewportId:s})=>{o.viewportId=s,o.renderingEngineId=a,Ye(Fe,i,o)})}function lm(t){const e=V.ANNOTATION_REMOVED;Ye(Fe,e,t)}function Gt(t,e,r=At.HandlesUpdated){const n=e&&Ce(e),{viewportId:i,renderingEngineId:o}=n||{},a=V.ANNOTATION_MODIFIED;Ye(Fe,a,{annotation:t,viewportId:i,renderingEngineId:o,changeType:r})}function xn(t){NI({annotation:t})}function um(t,e=!1){NI({annotation:t,contourHoleProcessingEnabled:e})}function NI(t){const e=V.ANNOTATION_COMPLETED;Ye(Fe,e,t)}const wZ=Object.freeze(Object.defineProperty({__proto__:null,triggerAnnotationAddedForElement:AI,triggerAnnotationAddedForFOR:LI,triggerAnnotationCompleted:xn,triggerAnnotationModified:Gt,triggerAnnotationRemoved:lm,triggerContourAnnotationCompleted:um},Symbol.toStringTag,{value:"Module"}));let VI;function xa(){return VI}function Yw(t){VI=t}function $t(t,e){const r=xa(),n=r.getGroupKey(e);return r.getAnnotations(n,t)}function fn(t){return xa().getAnnotation(t)}function ld(){return xa().getAllAnnotations()}function ud(t){const{annotationUID:e,parentAnnotationUID:r}=t;if(!r)return;const n=fn(r),i=n.childAnnotationUIDs.indexOf(e);n.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function kh(t,e){const{annotationUID:r}=t,{annotationUID:n}=e;ud(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(n)&&(t.childAnnotationUIDs.push(n),e.parentAnnotationUID=r)}function kI(t){return t.parentAnnotationUID?fn(t.parentAnnotationUID):void 0}function Fh(t){return t.childAnnotationUIDs?.map(e=>fn(e))??[]}function Ft(t,e){t.annotationUID||(t.annotationUID=cn());const r=xa();if(e instanceof HTMLDivElement){const n=r.getGroupKey(e);r.addAnnotation(t,n),AI(t,e)}else r.addAnnotation(t,void 0),LI(t);return t.annotationUID}function CZ(t,e){const r=xa(),n=r.getGroupKey(e);return r.getNumberOfAnnotations(n,t)}function kt(t){if(!t)return;const e=xa(),r=e.getAnnotation(t);r&&(r.childAnnotationUIDs?.forEach(n=>kt(n)),e.removeAnnotation(t),lm({annotation:r,annotationManagerUID:e.uid}))}function xZ(){const t=xa(),e=t.removeAllAnnotations();for(const r of e)lm({annotation:r,annotationManagerUID:t.uid})}function SZ(t,e){const r=xa(),n=r.getGroupKey(e),i=r.removeAnnotations(n,t);for(const o of i)lm({annotation:o,annotationManagerUID:r.uid})}function Jw(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?fn(e.parentAnnotationUID):void 0}const TZ=Object.freeze(Object.defineProperty({__proto__:null,addAnnotation:Ft,addChildAnnotation:kh,clearParentAnnotation:ud,getAllAnnotations:ld,getAnnotation:fn,getAnnotationManager:xa,getAnnotations:$t,getChildAnnotations:Fh,getNumberOfAnnotations:CZ,getParentAnnotation:kI,invalidateAnnotation:Jw,removeAllAnnotations:xZ,removeAnnotation:kt,removeAnnotations:SZ,setAnnotationManager:Yw},Symbol.toStringTag,{value:"Module"}));function Zw(t){const e=t.toolName;if(!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);Ue.tools[e]||(Ue.tools[e]={toolClass:t})}function _Z(t){const e=t.toolName;return!!(e&&Ue.tools[e])}function dm(t){return!!(t&&Ue.tools[t])}function FI(t){const e=t.toolName;if(!e)throw new Error(`No tool found for: ${t.name}`);if(!Ue.tools[e]!==void 0)delete Ue.tools[e];else throw new Error(`${e} cannot be removed because it has not been added`)}function ku(t,e){const r=e||t.currentTarget,{viewport:n}=Ce(r)||{};if(!n)return;const i=DZ(t),o=bZ(t),a=EZ(r,o),s=n.canvasToWorld(a);return{page:o,client:i,canvas:a,world:s}}function EZ(t,e){const r=t.getBoundingClientRect();return[e[0]-r.left-window.pageXOffset,e[1]-r.top-window.pageYOffset]}function bZ(t){return[t.pageX,t.pageY]}function DZ(t){return[t.clientX,t.clientY]}function UI(t){const e=t.currentTarget,{viewportId:r,renderingEngineId:n}=Ce(e),i=ku(t,e),o={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},a={event:t,eventName:V.MOUSE_DOUBLE_CLICK,viewportId:r,renderingEngineId:n,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:o};!Ye(e,V.MOUSE_DOUBLE_CLICK,a)&&(t.stopImmediatePropagation(),t.preventDefault())}const lT=V.MOUSE_MOVE;function Uh(t){const e=t.currentTarget,r=Ce(e);if(!r)return;const{renderingEngineId:n,viewportId:i}=r,o=ku(t);!Ye(e,lT,{renderingEngineId:n,viewportId:i,camera:{},element:e,currentPoints:o,eventName:lT,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:uT,MOUSE_DOWN_ACTIVATE:IZ,MOUSE_CLICK:MZ,MOUSE_UP:OZ,MOUSE_DRAG:dT}=V,PZ=400,RZ=150,AZ=3,LZ={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let Bt={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const Vr={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function BI(t){if(Vr.doubleClickTimeout){if(t.buttons===Vr.mouseDownEvent.buttons)return;Vr.mouseDownEvent=t,Qp();return}Vr.doubleClickTimeout=setTimeout(Qp,t.buttons===1?PZ:RZ),Vr.mouseDownEvent=t,Vr.ignoreDoubleClick=!1,Bt.element=t.currentTarget,Bt.mouseButton=t.buttons;const e=Ce(Bt.element),{renderingEngineId:r,viewportId:n}=e;Bt.renderingEngineId=r,Bt.viewportId=n,Bt.preventClickTimeout=setTimeout(VZ,Bt.clickDelay),Bt.element.removeEventListener("mousemove",Uh);const i=ku(t,Bt.element);Bt.startPoints=il(i),Bt.lastPoints=il(i),document.addEventListener("mouseup",Qw),document.addEventListener("mousemove",GI)}function NZ(t){const e=fm(Bt.startPoints,Bt.startPoints),r={event:t,eventName:uT,element:Bt.element,mouseButton:Bt.mouseButton,renderingEngineId:Bt.renderingEngineId,viewportId:Bt.viewportId,camera:{},startPoints:Bt.startPoints,lastPoints:Bt.startPoints,currentPoints:Bt.startPoints,deltaPoints:e};Bt.lastPoints=il(r.lastPoints),Ye(r.element,uT,r)&&Ye(r.element,IZ,r)}function GI(t){if(!Ce(Bt.element)?.viewport)return;const r=ku(t,Bt.element),n=jI(Bt.element,Bt.lastPoints),i=fm(r,n);if(Vr.doubleClickTimeout)if($I(i.canvas))Qp();else return;const o={event:t,eventName:dT,mouseButton:Bt.mouseButton,renderingEngineId:Bt.renderingEngineId,viewportId:Bt.viewportId,camera:{},element:Bt.element,startPoints:il(Bt.startPoints),lastPoints:il(n),currentPoints:r,deltaPoints:i};!Ye(Bt.element,dT,o)&&(t.stopImmediatePropagation(),t.preventDefault()),Bt.lastPoints=il(r)}function Qw(t){if(clearTimeout(Bt.preventClickTimeout),Vr.doubleClickTimeout)Vr.mouseUpEvent?xy():(Vr.mouseUpEvent=t,Bt.element.addEventListener("mousemove",WI));else{const e=Bt.isClickEvent?MZ:OZ,r=ku(t,Bt.element),n=fm(r,Bt.lastPoints),i={event:t,eventName:e,mouseButton:Bt.mouseButton,element:Bt.element,renderingEngineId:Bt.renderingEngineId,viewportId:Bt.viewportId,camera:{},startPoints:il(Bt.startPoints),lastPoints:il(Bt.lastPoints),currentPoints:r,deltaPoints:n};Ye(i.element,e,i),xy()}document.removeEventListener("mousemove",GI)}function WI(t){const e=ku(t,Bt.element),r=jI(Bt.element,Bt.lastPoints),n=fm(e,r);$I(n.canvas)&&(Qp(),Uh(t))}function $I(t){return Math.abs(t[0])+Math.abs(t[1])>AZ}function VZ(){Bt.isClickEvent=!1}function Qp(){Vr.ignoreDoubleClick=!0;const t=Vr.mouseDownEvent,e=Vr.mouseUpEvent;zI(),NZ(t),e&&Qw(e)}function zI(){Vr.doubleClickTimeout&&(clearTimeout(Vr.doubleClickTimeout),Vr.doubleClickTimeout=null),Vr.mouseDownEvent=null,Vr.mouseUpEvent=null}function xy(){document.removeEventListener("mouseup",Qw),Bt.element?.removeEventListener("mousemove",WI),Bt.element?.addEventListener("mousemove",Uh),zI(),Bt=JSON.parse(JSON.stringify(LZ))}function il(t){return JSON.parse(JSON.stringify(t))}function jI(t,e){const{viewport:r}=Ce(t)||{};if(!r)return e;const n=r.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:n}}function fm(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:G2(t.page,e.page),client:G2(t.client,e.client),canvas:G2(t.canvas,e.canvas),world:kZ(t.world,e.world)}}function G2(t,e){return[t[0]-e[0],t[1]-e[1]]}function kZ(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function FZ(){return Bt.mouseButton}function HI(t){Vr.ignoreDoubleClick?(Vr.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):xy()}function XI(t){t.removeEventListener("dblclick",UI),t.removeEventListener("mousedown",BI),t.removeEventListener("mousemove",Uh),t.removeEventListener("dblclick",HI,{capture:!0})}function UZ(t){XI(t),t.addEventListener("dblclick",UI),t.addEventListener("mousedown",BI),t.addEventListener("mousemove",Uh),t.addEventListener("dblclick",HI,{capture:!0})}const KI={enable:UZ,disable:XI},BZ=2e3,j0={mouse:0,touch:1};let fT,hT;function qI(t,e){const r=Date.now();if(t!==fT){if(r-hT<=BZ)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;fT=t}hT=r}const YI=qI.bind(null,j0.mouse),JI=qI.bind(null,j0.touch);function gT(t,e,r){const n=r?YI:JI;e.forEach(function(i){t.addEventListener(i,n,{passive:!1})})}function pT(t,e,r){const n=r?YI:JI;e.forEach(function(i){t.removeEventListener(i,n)})}const ZI=["mousedown","mouseup","mousemove"],QI=["touchstart","touchend"];function e9(t){pT(t,ZI,j0.mouse),pT(t,QI,j0.touch)}function GZ(t){e9(t),gT(t,ZI,j0.mouse),gT(t,QI,j0.touch)}const t9={enable:GZ,disable:e9};function hm(t,e){const r=e||t.currentTarget,n=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(n).map(i=>{const o=zZ(n[i]),a=$Z(n[i]),s=WZ(r,a),{viewport:c}=Ce(r),l=c.canvasToWorld(s);return{page:a,client:o,canvas:s,world:l,touch:{identifier:i,radiusX:n[i].radiusX,radiusY:n[i].radiusY,force:n[i].force,rotationAngle:n[i].rotationAngle}}})}function WZ(t,e){const r=t.getBoundingClientRect();return[e[0]-r.left-window.pageXOffset,e[1]-r.top-window.pageYOffset]}function $Z(t){return[t.pageX,t.pageY]}function zZ(t){return[t.clientX,t.clientY]}function e1(t,e){const r=rh(t),n=rh(e);return{page:W2(r.page,n.page),client:W2(r.client,n.client),canvas:W2(r.canvas,n.canvas),world:HZ(r.world,n.world)}}function eC(t,e){const r=rh(t),n=rh(e);return{page:b0(r.page,n.page),client:b0(r.client,n.client),canvas:b0(r.canvas,n.canvas),world:n9(r.world,n.world)}}function jZ(t,e){}function t1(t,e){const r=mT(t),n=mT(e);return{page:r.page-n.page,client:r.client-n.client,canvas:r.canvas-n.canvas,world:r.world-n.world}}function Ja(t){return JSON.parse(JSON.stringify(t))}function Sy(t){return JSON.parse(JSON.stringify(t))}function rh(t){return t.reduce((e,r)=>({page:[e.page[0]+r.page[0]/t.length,e.page[1]+r.page[1]/t.length],client:[e.client[0]+r.client[0]/t.length,e.client[1]+r.client[1]/t.length],canvas:[e.canvas[0]+r.canvas[0]/t.length,e.canvas[1]+r.canvas[1]/t.length],world:[e.world[0]+r.world[0]/t.length,e.world[1]+r.world[1]/t.length,e.world[2]+r.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function pa(t){return t.reduce((e,r)=>({page:[e.page[0]+r.page[0]/t.length,e.page[1]+r.page[1]/t.length],client:[e.client[0]+r.client[0]/t.length,e.client[1]+r.client[1]/t.length],canvas:[e.canvas[0]+r.canvas[0]/t.length,e.canvas[1]+r.canvas[1]/t.length],world:[e.world[0]+r.world[0]/t.length,e.world[1]+r.world[1]/t.length,e.world[2]+r.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+r.touch.radiusX/t.length,radiusY:e.touch.radiusY+r.touch.radiusY/t.length,force:e.touch.force+r.touch.force/t.length,rotationAngle:e.touch.rotationAngle+r.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function W2(t,e){return[t[0]-e[0],t[1]-e[1]]}function HZ(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function mT(t){const e=[];for(let r=0;r<t.length;r++)for(let n=0;n<t.length;n++)r<n&&e.push({page:b0(t[r].page,t[n].page),client:b0(t[r].client,t[n].client),canvas:b0(t[r].canvas,t[n].canvas),world:n9(t[r].world,t[n].world)});return e.reduce((r,n)=>({page:r.page+n.page/e.length,client:r.client+n.client/e.length,canvas:r.canvas+n.canvas/e.length,world:r.world+n.world/e.length}),{page:0,client:0,canvas:0,world:0})}function b0(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function n9(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}const XZ=Object.freeze(Object.defineProperty({__proto__:null,copyPoints:Sy,copyPointsList:Ja,getDeltaDistance:eC,getDeltaDistanceBetweenIPoints:t1,getDeltaPoints:e1,getDeltaRotation:jZ,getMeanPoints:rh,getMeanTouchPoints:pa},Symbol.toStringTag,{value:"Module"}));tr.getRuntimeSettings();const{TOUCH_START:vT,TOUCH_START_ACTIVATE:KZ,TOUCH_PRESS:yT,TOUCH_DRAG:wT,TOUCH_END:CT,TOUCH_TAP:xT,TOUCH_SWIPE:$2}=V,ih={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},n1={page:0,client:0,canvas:0,world:0},r9={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...ih,touch:null}],lastPointsList:[{...ih,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:n1,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},i9={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...ih,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let Tt=JSON.parse(JSON.stringify(r9)),vr=JSON.parse(JSON.stringify(i9));function fl(t,e,r){return Ye(t,e,r)}function o9(t){Tt.element=t.currentTarget;const e=Ce(Tt.element),{renderingEngineId:r,viewportId:n}=e;Tt.renderingEngineId=r,Tt.viewportId=n,!Tt.isTouchStart&&(clearTimeout(Tt.pressTimeout),Tt.pressTimeout=setTimeout(()=>qZ(t),Tt.pressDelay),YZ(t),document.addEventListener("touchmove",a9),document.addEventListener("touchend",s9))}function qZ(t){if(Tt.accumulatedDistance.canvas>Tt.pressMaxDistance)return;const r={event:t,eventName:yT,renderingEngineId:Tt.renderingEngineId,viewportId:Tt.viewportId,camera:{},element:Tt.element,startPointsList:Ja(Tt.startPointsList),lastPointsList:Ja(Tt.lastPointsList),startPoints:Sy(pa(Tt.startPointsList)),lastPoints:Sy(pa(Tt.lastPointsList))};fl(r.element,yT,r)}function YZ(t){Tt.isTouchStart=!0,Tt.startTime=new Date;const e=hm(t,Tt.element),r=pa(e),n=ih,i=n1,o={event:t,eventName:vT,element:Tt.element,renderingEngineId:Tt.renderingEngineId,viewportId:Tt.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:r,lastPoints:r,currentPoints:r,deltaPoints:n,deltaDistance:i};Tt.startPointsList=Ja(o.startPointsList),Tt.lastPointsList=Ja(o.lastPointsList),fl(o.element,vT,o)&&fl(o.element,KZ,o)}function a9(t){const e=hm(t,Tt.element),r=c9(Tt.element,Tt.lastPointsList),n=e.length===r.length?e1(e,r):ih,i=e.length===r.length?t1(e,r):n1,o=e.length===r.length?eC(e,Tt.lastPointsList):n1;Tt.accumulatedDistance={page:Tt.accumulatedDistance.page+o.page,client:Tt.accumulatedDistance.client+o.client,canvas:Tt.accumulatedDistance.canvas+o.canvas,world:Tt.accumulatedDistance.world+o.world};const a={event:t,eventName:wT,renderingEngineId:Tt.renderingEngineId,viewportId:Tt.viewportId,camera:{},element:Tt.element,startPoints:pa(Tt.startPointsList),lastPoints:pa(r),currentPoints:pa(e),startPointsList:Ja(Tt.startPointsList),lastPointsList:Ja(r),currentPointsList:e,deltaPoints:n,deltaDistance:i};fl(Tt.element,wT,a),ZZ(t,n),Tt.lastPointsList=Ja(e)}function s9(t){clearTimeout(Tt.pressTimeout);const e=hm(t,Tt.element),r=c9(Tt.element,Tt.lastPointsList),n=e.length===r.length?e1(e,r):e1(e,e),i=e.length===r.length?t1(e,r):t1(e,e),o={event:t,eventName:CT,element:Tt.element,renderingEngineId:Tt.renderingEngineId,viewportId:Tt.viewportId,camera:{},startPointsList:Ja(Tt.startPointsList),lastPointsList:Ja(r),currentPointsList:e,startPoints:pa(Tt.startPointsList),lastPoints:pa(r),currentPoints:pa(e),deltaPoints:n,deltaDistance:i};fl(o.element,CT,o),JZ(t),Tt=JSON.parse(JSON.stringify(r9)),document.removeEventListener("touchmove",a9),document.removeEventListener("touchend",s9)}function JZ(t){const e=new Date().getTime(),r=Tt.startTime.getTime();if(e-r>vr.tapToleranceMs||(vr.taps===0&&(vr.element=Tt.element,vr.renderingEngineId=Tt.renderingEngineId,vr.viewportId=Tt.viewportId,vr.startPointsList=Tt.startPointsList),vr.taps>0&&!(vr.element==Tt.element&&vr.renderingEngineId==Tt.renderingEngineId&&vr.viewportId==Tt.viewportId)))return;const n=hm(t,vr.element);eC(n,vr.startPointsList).canvas>vr.tapMaxDistance||(clearTimeout(vr.tapTimeout),vr.taps+=1,vr.tapTimeout=setTimeout(()=>{const o={event:t,eventName:xT,element:vr.element,renderingEngineId:vr.renderingEngineId,viewportId:vr.viewportId,camera:{},currentPointsList:n,currentPoints:pa(n),taps:vr.taps};fl(o.element,xT,o),vr=JSON.parse(JSON.stringify(i9))},vr.tapToleranceMs))}function ZZ(t,e){const r=new Date().getTime(),n=Tt.startTime.getTime();if(Tt.swiped||r-n>Tt.swipeToleranceMs)return;const[i,o]=e.canvas,a={event:t,eventName:$2,renderingEngineId:Tt.renderingEngineId,viewportId:Tt.viewportId,camera:{},element:Tt.element,swipe:null};Math.abs(i)>Tt.swipeDistanceThreshold&&(a.swipe=i>0?gu.RIGHT:gu.LEFT,fl(a.element,$2,a),Tt.swiped=!0),Math.abs(o)>Tt.swipeDistanceThreshold&&(a.swipe=o>0?gu.DOWN:gu.UP,fl(a.element,$2,a),Tt.swiped=!0)}function c9(t,e){const{viewport:r}=Ce(t);return e.map(n=>{const i=r.canvasToWorld(n.canvas);return{page:n.page,client:n.client,canvas:n.canvas,world:i,touch:n.touch}})}function l9(t){t9.disable(t),t.removeEventListener("touchstart",o9)}function QZ(t){l9(t),t9.enable(t),t.addEventListener("touchstart",o9,{passive:!1})}const u9={enable:QZ,disable:l9},ST=10,TT=40,_T=800;function eQ(t){let e=0,r=0,n=0,i=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),n=e*ST,i=r*ST,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||i)&&t.deltaMode&&(t.deltaMode===1?(n*=TT,i*=TT):(n*=_T,i*=_T)),n&&!e&&(e=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:i}}function d9(t){const e=t.currentTarget,r=Ce(e),{renderingEngineId:n,viewportId:i}=r;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:o,spinY:a,pixelX:s,pixelY:c}=eQ(t),l=a<0?-1:1,d={event:t,eventName:V.MOUSE_WHEEL,renderingEngineId:n,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:o,spinY:a,pixelX:s,pixelY:c,direction:l},points:ku(t)};Ye(e,V.MOUSE_WHEEL,d)}function tQ(t){f9(t),t.addEventListener("wheel",d9,{passive:!1})}function f9(t){t.removeEventListener("wheel",d9)}const h9={enable:tQ,disable:f9},nQ={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Er={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function gm(t){Er.element=t.currentTarget;const e=Ce(Er.element),{renderingEngineId:r,viewportId:n}=e;Er.renderingEngineId=r,Er.viewportId=n,Er.key=t.key,Er.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:Er.renderingEngineId,viewportId:Er.viewportId,element:Er.element,key:Er.key,keyCode:Er.keyCode};Ye(i.element,V.KEY_DOWN,i),document.addEventListener("keyup",g9),document.addEventListener("visibilitychange",tC),Er.element.removeEventListener("keydown",gm)}function tC(){document.removeEventListener("visibilitychange",tC),document.visibilityState==="hidden"&&p9()}function g9(t){const e={renderingEngineId:Er.renderingEngineId,viewportId:Er.viewportId,element:Er.element,key:Er.key,keyCode:Er.keyCode};document.removeEventListener("keyup",g9),document.removeEventListener("visibilitychange",tC),Er.element.addEventListener("keydown",gm),Er=structuredClone(nQ),Ye(e.element,V.KEY_UP,e)}function rQ(){return Er.keyCode}function p9(){Er.keyCode=void 0}function iQ(t){m9(t),t.addEventListener("keydown",gm)}function m9(t){t.removeEventListener("keydown",gm)}const dd={enable:iQ,disable:m9,getModifierKey:rQ},{EPSILON:Ju}=pl;function v9(t,e,r=!1){let n=1/0,i=r?-1/0:0,o=1/0,a=r?-1/0:0,s=1/0,c=r?-1/0:0;const l=t[0]?.length===3;for(let d=0;d<t.length;d++){const u=t[d];n=Math.min(u[0],n),i=Math.max(u[0],i),o=Math.min(u[1],o),a=Math.max(u[1],a),l&&(s=Math.min(u[2]??s,s),c=Math.max(u[2]??c,c))}return e?(n=Math.max(r?e[0]+Ju:0,n),i=Math.min(r?e[0]-Ju:e[0]-1,i),o=Math.max(r?e[1]+Ju:0,o),a=Math.min(r?e[1]-Ju:e[1]-1,a),l&&e.length===3&&(s=Math.max(r?e[2]+Ju:0,s),c=Math.min(r?e[2]-Ju:e[2]-1,c))):r||(n=Math.max(0,n),i=Math.min(1/0,i),o=Math.max(0,o),a=Math.min(1/0,a),l&&(s=Math.max(0,s),c=Math.min(1/0,c))),l?[[n,i],[o,a],[s,c]]:[[n,i],[o,a],null]}function hl(t,e){return v9(t,e,!1)}function oQ(t,e){return v9(t,e,!0)}const aQ=(t,e)=>JSON.stringify(t)===JSON.stringify(e);function nC(t,e,r,n){const i=r[0]/2,o=r[1]/2,a=r[2]/2,s=new Array(8);s[0]=br(t,[n[0]-i,n[1]-o,n[2]-a]);const c=[[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]];for(let l=0;l<7;l++){const[d,u,f]=c[l];s[l+1]=br(t,[n[0]+d*i,n[1]+u*o,n[2]+f*a])}return hl(s,e)}function y9(t,e){const{spacing:r}=t,n=t.voxelManager.getScalarDataLength(),i=[];let o=0;for(let a=0;a<e.length;a++){const{imageData:s,spacing:c,dimensions:l,voxelManager:d}=e[a].volume,u=e[a].volume.voxelManager.getScalarDataLength();u===n&&aQ(c,r)&&(o=a);const f=e[a].lower,h=e[a].upper;i.push({imageData:s,lower:f,upper:h,spacing:c,dimensions:l,volumeSize:u,voxelManager:d})}return{volumeInfoList:i,baseVolumeIdx:o}}const rC=new Map,sQ=t=>{const e=rC.get(t);e&&(e.isDirty=!0)},cQ=t=>{const e=rC.get(t);return e&&!e.isDirty?e.indices:null},lQ=(t,e)=>{rC.set(t,{indices:e,isDirty:!1})};function ei(t,e,r){const n={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:r};sQ(t),Ye(Fe,V.SEGMENTATION_DATA_MODIFIED,n)}function Ko(t){const e={segmentationId:t};Ye(Fe,V.SEGMENTATION_MODIFIED,e)}function iC(t){const e={segmentationId:t};Ye(Fe,V.SEGMENTATION_REMOVED,e)}function Ha(t,e,r){const n={segmentationId:e,type:r,viewportId:t};Ye(Fe,V.SEGMENTATION_REPRESENTATION_MODIFIED,n)}function Ty(t,e,r){const n={viewportId:t,segmentationId:e,type:r};Ye(Fe,V.SEGMENTATION_REPRESENTATION_REMOVED,n)}const uQ=Object.freeze(Object.defineProperty({__proto__:null,triggerSegmentationDataModified:ei,triggerSegmentationModified:Ko,triggerSegmentationRemoved:iC,triggerSegmentationRepresentationModified:Ha,triggerSegmentationRepresentationRemoved:Ty},Symbol.toStringTag,{value:"Module"})),dQ={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function fQ(){return dQ}const hQ={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function gQ(){return hQ}class pQ{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,r,n=!0){const{viewportId:i,segmentationId:o,type:a,segmentIndex:s}=e,c=this.getStyle(e),l=n?{...c,...r}:r;let d;if(!i&&!o?d=l:n?d=this.copyActiveToInactiveIfNotProvided(l,a):d=l,!a)throw new Error("Type is required to set a style");if(i){this.config.viewportsStyle[i]||(this.config.viewportsStyle[i]={renderInactiveSegmentations:!1,representations:{}});const u=this.config.viewportsStyle[i].representations;if(o){u[o]||(u[o]={}),u[o][a]||(u[o][a]={});const f=u[o][a];s!==void 0?(f.perSegment||(f.perSegment={}),f.perSegment[s]=d):f.allSegments=d}else{const f="__allSegmentations__";u[f]||(u[f]={}),u[f][a]||(u[f][a]={}),u[f][a].allSegments=d}}else if(o){this.config.segmentations[o]||(this.config.segmentations[o]={}),this.config.segmentations[o][a]||(this.config.segmentations[o][a]={});const u=this.config.segmentations[o][a];s!==void 0?(u.perSegment||(u.perSegment={}),u.perSegment[s]=d):u.allSegments=d}else this.config.global[a]=d}copyActiveToInactiveIfNotProvided(e,r){const n={...e};if(r===yt.Labelmap){const i=n;i.renderOutlineInactive??=i.renderOutline,i.outlineWidthInactive??=i.outlineWidth,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha,i.outlineOpacityInactive??=i.outlineOpacity}else if(r===yt.Contour){const i=n;i.outlineWidthInactive??=i.outlineWidth,i.outlineOpacityInactive??=i.outlineOpacity,i.outlineDashInactive??=i.outlineDash,i.renderOutlineInactive??=i.renderOutline,i.renderFillInactive??=i.renderFill,i.fillAlphaInactive??=i.fillAlpha}return n}getStyle(e){const{viewportId:r,segmentationId:n,type:i,segmentIndex:o}=e;let a=this.getDefaultStyle(i);if(this.config.global[i]&&(a={...a,...this.config.global[i]}),this.config.segmentations[n]?.[i]&&(a={...a,...this.config.segmentations[n][i].allSegments},o!==void 0&&this.config.segmentations[n][i].perSegment?.[o]&&(a={...a,...this.config.segmentations[n][i].perSegment[o]})),r&&this.config.viewportsStyle[r]){this.config.viewportsStyle[r].renderInactiveSegmentations;const s="__allSegmentations__";this.config.viewportsStyle[r].representations[s]?.[i]&&(a={...a,...this.config.viewportsStyle[r].representations[s][i].allSegments}),n&&this.config.viewportsStyle[r].representations[n]?.[i]&&(a={...a,...this.config.viewportsStyle[r].representations[n][i].allSegments},o!==void 0&&this.config.viewportsStyle[r].representations[n][i].perSegment?.[o]&&(a={...a,...this.config.viewportsStyle[r].representations[n][i].perSegment[o]}))}return a}getRenderInactiveSegmentations(e){return this.config.viewportsStyle[e]?.renderInactiveSegmentations}setRenderInactiveSegmentations(e,r){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=r}getDefaultStyle(e){switch(e){case yt.Labelmap:return gQ();case yt.Contour:return fQ();case yt.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const n=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:n,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:r}=e,n=this.getStyle(e),i=this.getDefaultStyle(r);return!vI(n,i)}}const Zi=new pQ;function mQ(t){const e={segmentationId:t};Ye(Fe,V.SEGMENTATION_ADDED,e)}const ET={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class vQ{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,this._labelmapImageIdReferenceMap=new Map,e||=cn(),this.state=Object.freeze(Bo(ET)),this.uid=e}getState(){return this.state}updateState(e){const r=Bo(this.state);e(r),this.state=Object.freeze(r)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this._stackLabelmapImageIdReferenceMap.clear(),this._labelmapImageIdReferenceMap.clear(),this.state=Object.freeze(Bo(ET))}getSegmentation(e){return this.state.segmentations.find(r=>r.segmentationId===e)}updateSegmentation(e,r){this.updateState(n=>{const i=n.segmentations.find(o=>o.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,r)}),Ko(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(r=>{const n=Bo(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const i=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=i}r.segmentations.push(n)}),mQ(e.segmentationId)}removeSegmentation(e){this.updateState(r=>{const n=r.segmentations.filter(i=>i.segmentationId!==e);r.segmentations.splice(0,r.segmentations.length,...n)}),iC(e)}addSegmentationRepresentation(e,r,n,i){if(!wn(e))return;if(this.getSegmentationRepresentations(e,{type:n,segmentationId:r}).length>0){console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",r);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],Zi.setRenderInactiveSegmentations(e,!0)),n!==yt.Labelmap?this.addDefaultSegmentationRepresentation(s,e,r,n,i):this.addLabelmapRepresentation(s,e,r,i)}),Ha(e,r,n)}addDefaultSegmentationRepresentation(e,r,n,i,o){const a=e.segmentations.find(c=>c.segmentationId===n);if(!a)return;const s={};Object.keys(a.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[r].push({segmentationId:n,type:i,active:!0,visible:!0,colorLUTIndex:o?.colorLUTIndex||0,segments:s,config:{...bT(i),...o}}),this._setActiveSegmentation(e,r,n)}addLabelmapRepresentation(e,r,n,i=bT(yt.Labelmap)){if(!wn(r))return;const a=this.getSegmentation(n);if(!a)return;const{representationData:s}=a;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,r,n,yt.Labelmap,i);this.processLabelmapRepresentationAddition(r,n),this.addDefaultSegmentationRepresentation(e,r,n,yt.Labelmap,i)}async processLabelmapRepresentationAddition(e,r){const n=wn(e);if(!n)return;const i=this.getSegmentation(r);if(!i)return;const o=n.viewport instanceof Zn,{representationData:a}=i,s="volumeId"in a.Labelmap;n.viewport,!o&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,r,n,i){const o=r.getCurrentImageId();let a=!1;for(const s of n)r.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(a=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(o,s),this._updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:o,labelmapImageId:s}));return i&&i(r,e,n),a?this._stackLabelmapImageIdReferenceMap.get(e).get(o):void 0}updateLabelmapSegmentationImageReferences(e,r){const n=this.getSegmentation(r);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(r)||this._stackLabelmapImageIdReferenceMap.set(r,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const o=this.getLabelmapImageIds(i),s=wn(e).viewport;return this._updateLabelmapSegmentationReferences(r,s,o,null)}_updateAllLabelmapSegmentationImageReferences(e,r){const n=this.getSegmentation(r);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(r)||this._stackLabelmapImageIdReferenceMap.set(r,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const o=this.getLabelmapImageIds(i),s=wn(e).viewport;this._updateLabelmapSegmentationReferences(r,s,o,(c,l,d)=>{c.getImageIds().forEach((f,h)=>{for(const g of d)c.isReferenceViewable({referencedImageId:g,sliceIndex:h},{asOverlay:!0,withNavigation:!0})&&(this._stackLabelmapImageIdReferenceMap.get(l).set(f,g),this._updateLabelmapImageIdReferenceMap({segmentationId:l,referenceImageId:f,labelmapImageId:g}))})})}getLabelmapImageIds(e){const r=e.Labelmap;let n;if(r.imageIds)n=r.imageIds;else if(!n&&r.volumeId){const i=r.volumeId;n=Ne.getVolume(i).imageIds}return n}getLabelmapImageIdsForImageId(e,r){const n=this._generateMapKey({segmentationId:r,referenceImageId:e});return this._labelmapImageIdReferenceMap.get(n)}getCurrentLabelmapImageIdsForViewport(e,r){const n=wn(e);if(!n)return;const o=n.viewport.getCurrentImageId();return this.getLabelmapImageIdsForImageId(o,r)}getCurrentLabelmapImageIdForViewport(e,r){const n=wn(e);if(!n||!this._stackLabelmapImageIdReferenceMap.has(r))return;const o=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(r).get(o)}getStackSegmentationImageIdsForViewport(e,r){if(!this.getSegmentation(r))return[];this._updateAllLabelmapSegmentationImageReferences(e,r);const{viewport:i}=wn(e),o=i.getImageIds(),a=this._stackLabelmapImageIdReferenceMap.get(r);return o.map(s=>a.get(s))}removeSegmentationRepresentationsInternal(e,r){const n=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const o=i.viewportSegRepresentations[e];let a=!1;if(!r||Object.values(r).every(s=>s===void 0))n.push(...o),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=r;i.viewportSegRepresentations[e]=o.filter(l=>{const d=s&&c&&l.segmentationId===s&&l.type===c||s&&!c&&l.segmentationId===s||!s&&c&&l.type===c;return d&&(n.push(l),l.active&&(a=!0)),!d}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:a&&(i.viewportSegRepresentations[e][0].active=!0)}}),n}removeSegmentationRepresentations(e,r){const n=this.removeSegmentationRepresentationsInternal(e,r);n.forEach(o=>{Ty(e,o.segmentationId,o.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&Ha(e,i[0].segmentationId,i[0].type),n}removeSegmentationRepresentation(e,r,n){const i=this.removeSegmentationRepresentationsInternal(e,r);return n||i.forEach(({segmentationId:o,type:a})=>{Ty(e,o,a)}),i}_updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:r,labelmapImageId:n}){const i=this._generateMapKey({segmentationId:e,referenceImageId:r});if(!this._labelmapImageIdReferenceMap.has(i)){this._labelmapImageIdReferenceMap.set(i,[n]);return}const o=this._labelmapImageIdReferenceMap.get(i),a=Array.from(new Set([...o,n]));this._labelmapImageIdReferenceMap.set(i,a)}_setActiveSegmentation(e,r,n){const i=e.viewportSegRepresentations[r];i&&i.forEach(o=>{o.active=o.segmentationId===n})}setActiveSegmentation(e,r){this.updateState(n=>{const i=n.viewportSegRepresentations[e];i&&i.forEach(o=>{o.active=o.segmentationId===r})}),Ha(e,r)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const r=this.state.viewportSegRepresentations[e].find(n=>n.active);if(r)return this.getSegmentation(r.segmentationId)}getSegmentationRepresentations(e,r={}){const n=this.state.viewportSegRepresentations[e];return n?!r.type&&!r.segmentationId?n:n.filter(i=>{const o=r.type?i.type===r.type:!0,a=r.segmentationId?i.segmentationId===r.segmentationId:!0;return o&&a}):[]}getSegmentationRepresentation(e,r){return this.getSegmentationRepresentations(e,r)[0]}getSegmentationRepresentationVisibility(e,r){return this.getSegmentationRepresentation(e,r)?.visible}setSegmentationRepresentationVisibility(e,r,n){this.updateState(i=>{const o=this.getSegmentationRepresentations(e,r);o&&o.forEach(a=>{a.visible=n,Object.entries(a.segments).forEach(([s,c])=>{c.visible=n})})}),Ha(e,r.segmentationId,r.type)}addColorLUT(e,r){this.updateState(n=>{n.colorLUT[r]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[r]=Bo(e)})}removeColorLUT(e){this.updateState(r=>{delete r.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(r=>r.slice(-Math.round(r.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,r])=>({viewportId:e,representations:r}))}getSegmentationRepresentationsBySegmentationId(e){const r=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([n,i])=>{const o=i.filter(a=>a.segmentationId===e);o.length>0&&r.push({viewportId:n,representations:o})}),r}_generateMapKey({segmentationId:e,referenceImageId:r}){return`${e}-${r}`}}async function w9({imageIds:t,options:e}){const r=t,n=e?.volumeId||cn();return await fD(n,r),{volumeId:n}}async function yQ({segmentationId:t,options:e}){const r=On.getSegmentation(t),n=r.representationData.Labelmap,{volumeId:i}=await w9({imageIds:n.imageIds,options:e});r.representationData.Labelmap.volumeId=i}function bT(t){const e=Qs.newInstance(),r=bu.newInstance();return r.addPoint(0,0),t===yt.Labelmap?{cfun:e,ofun:r}:{}}const On=new vQ("DEFAULT");function Ut(t){return On.getSegmentation(t)}function Qi(t,e={}){return On.getSegmentationRepresentations(t,e)}function oC(t,e){const r=On;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");return r.getSegmentationRepresentations(t,e)?.[0]}function C9(t){return On.getSegmentationRepresentationsBySegmentationId(t)}function wQ(t,e){const r=Ce(t),{viewport:n}=r,o=n.getActors().filter(a=>a.representationUID&&typeof a.representationUID=="string"&&a.representationUID.startsWith(e));n.removeActors(o.map(a=>a.uid))}function x9(t,e,r){const n=wn(t);if(!n)return;const{renderingEngine:i,viewport:o}=n;if(!i||!o)return;const s=o.getActors().filter(r);return s.length>0?s[0]:void 0}function CQ(t,e){const r=wn(t);if(!r)return;const{renderingEngine:n,viewport:i}=r;if(!n||!i)return;const a=i.getActors().filter(e);return a.length>0?a:void 0}function xQ(t,e){return pm(t,e)?.uid}function Cf(t,e){return CQ(t,r=>r.representationUID?.startsWith(`${e}-${yt.Labelmap}`))}function pm(t,e){return x9(t,e,r=>r.representationUID?.startsWith(`${e}-${yt.Labelmap}`))}function SQ(t,e,r){return x9(t,e,n=>n.representationUID===S9(e,r))}function S9(t,e){return`${t}-${yt.Surface}-${e}`}function TQ(t,e,r){const i=SQ(t.id,r,e.segmentIndex)?.actor,o=e.visible;if(i){if(i.setVisibility(o),!o)return;const p=i.getMapper(),v=p.getInputData(),w=e.points,m=e.polys,y=v.getPoints().getData(),C=v.getPolys().getData();if(w.length===y.length&&m.length===C.length)return;const x=Ii.newInstance();x.getPoints().setData(w,3);const S=ll.newInstance({values:Float32Array.from(m)});x.setPolys(S),p.setInputData(x),p.modified(),t.getRenderer().resetCameraClippingRange();return}const a=e.points,s=e.polys,c=e.color,l=Ii.newInstance();l.getPoints().setData(a,3);const d=ll.newInstance({values:Float32Array.from(s)});l.setPolys(d);const u=Mu.newInstance({});let f;u.setInputData(l);const h=U0.newInstance();h.setMapper(u),h.getProperty().setColor(c[0]/255,c[1]/255,c[2]/255),h.getProperty().setLineWidth(2);const g=S9(r,e.segmentIndex);t.addActor({uid:cn(),actor:h,clippingFilter:f,representationUID:g}),t.resetCamera(),t.getRenderer().resetCameraClippingRange(),t.render()}function Bh(t){return On.getColorLUT(t)}let r1={};function _Q(){return r1}function EQ(t){r1=t}let DT=!1;function Za(){if(!r1.addons?.polySeg)return console.warn("PolySeg add-on not configured. This will prevent automatic conversion between segmentation representations (labelmap, contour, surface). To enable these features, install @cornerstonejs/polymorphic-segmentation and register it during initialization: cornerstoneTools.init({ addons: { polySeg } })."),null;const t=r1.addons.polySeg;return DT||(t.init(),DT=!0),t}function aC({segmentationId:t,type:e,data:r}){const n=Ut(t);if(!n)throw new Error(`Segmentation ${t} not found`);switch(n.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case yt.Labelmap:r&&(n.representationData[e]=r);break;case yt.Contour:r&&(n.representationData[e]=r);break;case yt.Surface:r&&(n.representationData[e]=r);break;default:throw new Error(`Invalid representation type ${e}`)}}async function sC(t,e,r,n){const i=await r();return aC({segmentationId:t,type:e,data:i}),n?.(),i}function cC(t,e){const r=oC(t,e);return r?Object.entries(r.segments).reduce((i,[o,a])=>(a.visible||i.add(Number(o)),i),new Set):new Set}function bQ(t,e,r=!1){const n=wn(t);if(!n)return;const{viewport:i}=n;wQ(i.element,e),r&&i.render()}async function DQ(t,e){const{segmentationId:r,type:n}=e,i=Ut(r);if(!i)return;let o=i.representationData[yt.Surface];if(!o&&Za()?.canComputeRequestedRepresentation(r,yt.Surface)){const l=Za();if(o=await sC(r,yt.Surface,()=>l.computeSurfaceData(r,{viewport:t})),!o)throw new Error(`No Surface data found for segmentationId ${r} even we tried to compute it`)}else!o&&!Za()&&console.debug(`No surface data found for segmentationId ${r} and PolySeg add-on is not configured. Unable to convert from other representations to surface. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(!o){console.warn(`No Surface data found for segmentationId ${r}. Skipping render.`);return}const{geometryIds:a}=o;a?.size||console.warn(`No Surfaces found for segmentationId ${r}. Skipping render.`);const{colorLUTIndex:s}=e,c=Bh(s);a.forEach(l=>{const d=Ne.getGeometry(l);if(!d?.data){console.warn(`No Surfaces found for geometryId ${l}. Skipping render.`);return}const{segmentIndex:u}=d.data,h=cC(t.id,{segmentationId:r,type:n}).has(u),g=d.data,p=c[u];g.color=p.slice(0,3),g.visible=!h,TQ(t,g,r)}),t.render()}function IQ(t){const e=Za();return r=>e.updateSurfaceData(r,{viewport:t})}const lC={getUpdateFunction:IQ,render:DQ,removeRepresentation:bQ};function MQ(t,e,r,n){const i=t.getViewReference(),{viewPlaneNormal:o,FrameOfReferenceUID:a}=i,s={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:e,viewPlaneNormal:o,FrameOfReferenceUID:a,referencedImageId:OQ(t,r[0],o),...n}};return Ft(s,t.element),s}function OQ(t,e,r){let n;if(t instanceof Wn)n=uC(t,e,r);else if(t instanceof Zn){const i=PQ(t),o=cs(i),a=Ne.getVolume(o);n=rc(a,e,r)}else throw new Error("getReferencedImageId: viewport must be a StackViewport or BaseVolumeViewport");return n}function PQ(t){const e=t.getViewReferenceId?.();if(e)return e;if(t instanceof Zn)return`volumeId:${RQ(t)}`;throw new Error("getTargetId: viewport must have a getTargetId method")}function RQ(t){const e=t.getActors();if(e)return e.find(r=>r.actor.getClassName()==="vtkVolume")?.uid}function uC(t,e,r){const n=t.getImageIds();if(!n||!n.length)return;const i=n.map(o=>{const{imagePositionPatient:a}=ut("imagePlaneModule",o),s=AQ(e,a,r);return{imageId:o,distance:s}});return i.sort((o,a)=>o.distance-a.distance),i[0].imageId}function AQ(t,e,r){const n=Ie();rn(n,t,e);const i=ft(n,r);return Math.abs(i)}function T9(t,e){const{segmentation:r}=t.data,{segmentation:n}=e.data;return r.segmentationId===n.segmentationId&&r.segmentIndex===n.segmentIndex}class _9{constructor(e){this.getGroupKey=r=>{if(typeof r=="string")return r;const i=Ce(r);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=r=>{const n=r.detail,{FrameOfReferenceUID:i}=n,a=this.annotations[i];a&&Object.keys(a).forEach(s=>{a[s].forEach(l=>{l.invalidated!==void 0&&(l.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(r,n)=>{const i=this.annotations;return i[r]?n?i[r][n]?i[r][n]:[]:i[r]:[]},this.getAnnotation=r=>{const n=this.annotations;for(const i in n){const o=n[i];for(const a in o){const s=o[a];for(const c of s)if(r===c.annotationUID)return c}}},this.getNumberOfAnnotations=(r,n)=>{const i=this.getAnnotations(r,n);if(!i.length)return 0;if(n)return i.length;let o=0;for(const a in i)o+=i[a].length;return o},this.addAnnotation=(r,n)=>{const{metadata:i}=r,{FrameOfReferenceUID:o,toolName:a}=i;n=n||o;const s=this.annotations;let c=s[n];c||(s[n]={},c=s[n]);let l=c[a];l||(c[a]=[],l=c[a]),this.preprocessingFn&&(r=this.preprocessingFn(r)),l.push(r)},this.removeAnnotation=r=>{const{annotations:n}=this;for(const i in n){const o=n[i];for(const a in o){const s=o[a],c=s.findIndex(l=>l.annotationUID===r);c!==-1&&(s.splice(c,1),s.length===0&&delete o[a])}Object.keys(o).length===0&&delete n[i]}},this.removeAnnotations=(r,n)=>{const i=this.annotations,o=[];if(!i[r])return o;if(n){const a=i[r][n];if(a)for(const s of a)this.removeAnnotation(s.annotationUID),o.push(s)}else for(const a in i[r]){const s=i[r][a];for(const c of s)this.removeAnnotation(c.annotationUID),o.push(c)}return o},this.saveAnnotations=(r,n)=>{const i=this.annotations;if(r&&n){const o=i[r];if(!o)return;const a=o[n];return structuredClone(a)}else if(r){const o=i[r];return structuredClone(o)}return structuredClone(i)},this.restoreAnnotations=(r,n,i)=>{const o=this.annotations;if(n&&i){let a=o[n];a||(o[n]={},a=o[n]),a[i]=r}else n?o[n]=r:this.annotations=structuredClone(r)},this.getAllAnnotations=()=>Object.values(this.annotations).map(r=>Object.values(r)).flat(2),this.getNumberOfAllAnnotations=()=>{let r=0;const n=this.annotations;for(const i in n){const o=n[i];for(const a in o){const s=o[a];r+=s.length}}return r},this.removeAllAnnotations=()=>{const r=[];for(const n of this.getAllAnnotations())this.removeAnnotation(n.annotationUID),r.push(n);return r},e||(e=cn()),this.annotations={},this.uid=e,Fe.addEventListener($e.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const LQ=new _9("DEFAULT"),ol=new Set;function mm(t,e=!0){const r=b9();t&&(e?FQ(t,ol,r):D9(t,ol,r)),I9(r,ol)}function NQ(){const t=b9();UQ(ol,t),I9(t,ol)}function VQ(){return Array.from(ol)}function ir(t){return ol.has(t)}function kQ(){return ol.size}function E9(t){const e=ir(t);return mm(t,e),e}function b9(){return Object.freeze({added:[],removed:[],locked:[]})}function FQ(t,e,r){if(!e.has(t)){e.add(t),r.added.push(t);const n=fn(t);n&&(n.isLocked=!0)}}function D9(t,e,r){if(e.delete(t)){r.removed.push(t);const n=fn(t);n&&(n.isLocked=!1)}}function UQ(t,e){t.forEach(r=>{D9(r,t,e)})}function I9(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(r=>{t.locked.push(r)}),Ye(Fe,V.ANNOTATION_LOCK_CHANGE,t))}const BQ=Object.freeze(Object.defineProperty({__proto__:null,checkAndSetAnnotationLocked:E9,getAnnotationsLocked:VQ,getAnnotationsLockedCount:kQ,isAnnotationLocked:ir,setAnnotationLocked:mm,unlockAllAnnotations:NQ},Symbol.toStringTag,{value:"Module"})),Xa=new Set;function $o(t,e=!0,r=!1){e?GQ(t,r):dC(t)}function GQ(t,e=!1){const r=O9();if(!e){P9(Xa,r);const n=fn(t);n&&(n.isSelected=!0)}if(t&&!Xa.has(t)){Xa.add(t),r.added.push(t);const n=fn(t);n&&(n.isSelected=!0)}R9(r,Xa)}function dC(t){const e=O9();if(t){if(Xa.delete(t)){e.removed.push(t);const r=fn(t);r.isSelected=!1}}else P9(Xa,e);R9(e,Xa)}function M9(){return Array.from(Xa)}function WQ(t){return M9().filter(e=>fn(e)?.metadata?.toolName===t)}function Gh(t){return Xa.has(t)}function $Q(){return Xa.size}function O9(){return Object.freeze({added:[],removed:[],selection:[]})}function P9(t,e){t.forEach(r=>{if(t.delete(r)){e.removed.push(r);const n=fn(r);n&&(n.isSelected=!1)}})}function R9(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(r=>{t.selection.push(r)}),Ye(Fe,V.ANNOTATION_SELECTION_CHANGE,t))}const zQ=Object.freeze(Object.defineProperty({__proto__:null,deselectAnnotation:dC,getAnnotationsSelected:M9,getAnnotationsSelectedByToolName:WQ,getAnnotationsSelectedCount:$Q,isAnnotationSelected:Gh,setAnnotationSelected:$o},Symbol.toStringTag,{value:"Module"})),jQ=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),HQ=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),Pu=new Set;function A9(t,e=!0){const r=L9();t&&(e?N9(t,Pu,r):KQ(t,Pu,r)),V9(r)}function XQ(){const t=L9();Pu.forEach(e=>{N9(e,Pu,t)}),V9(t)}function or(t){if(fn(t))return!Pu.has(t)}function L9(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function N9(t,e,r){if(e.delete(t)){r.lastVisible.push(t);const n=fn(t);n.isVisible=!0}}function KQ(t,e,r){if(!e.has(t)){e.add(t),Gh(t)&&dC(t),r.lastHidden.push(t);const n=fn(t);n.isVisible=!1}}function V9(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(Pu.forEach(e=>{t.hidden.push(e)}),Ye(Fe,V.ANNOTATION_VISIBILITY_CHANGE,t))}function k9(t){const e=!Pu.has(t);return A9(t,e),e}const qQ=Object.freeze(Object.defineProperty({__proto__:null,checkAndSetAnnotationVisibility:k9,isAnnotationVisible:or,setAnnotationVisibility:A9,showAllAnnotations:XQ},Symbol.toStringTag,{value:"Module"})),fC=LQ,YQ=t=>{t=jQ(t),t=HQ(t);const e=t.annotationUID,r=E9(e);t.isLocked=r;const n=k9(e);return t.isVisible=n,t};fC.setPreprocessingFn(YQ);Yw(fC);function JQ(){Yw(fC)}function va(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:r}=t.data.segmentation,n=Ut(e),{annotationUIDsMap:i}=n?.representationData.Contour||{},o=i?.get(r);o&&(o.delete(t.annotationUID),o.size||i.delete(r))}function ic(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:r}=t.data.segmentation,n=Ut(e);n.representationData.Contour||(n.representationData.Contour={annotationUIDsMap:new Map});let{annotationUIDsMap:i}=n.representationData.Contour;i||(i=new Map);let o=i?.get(r);o||(o=new Set,i.set(r,o)),n.segments[r].locked&&mm(t.annotationUID,!0),i.set(r,o.add(t.annotationUID))}const ZQ="PlanarFreehandContourSegmentationTool";function hC(t){const{polyline:e}=t.data?.contour||{};if(!e||e.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",e);return}kt(t.annotationUID),va(t);const r=e[0],n=e[e.length-1],i={metadata:{...t.metadata,toolName:ZQ,originalToolName:t.metadata.originalToolName||t.metadata.toolName},data:{cachedStats:{},handles:{points:[r,n],textBox:t.data.handles.textBox?{...t.data.handles.textBox}:void 0},contour:{...t.data.contour},spline:t.data.spline,segmentation:{...t.data.segmentation}},annotationUID:cn(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:t.interpolationUID,interpolationCompleted:t.interpolationCompleted};return Ft(i,t.metadata.FrameOfReferenceUID),ic(i),Gt(i),i}function Fu(t){const n=On.getState().viewportSegRepresentations;return Object.entries(n).filter(([,o])=>o.some(a=>a.segmentationId===t)).map(([o])=>o)}function gC(t){const e=Fu(t);if(e?.length===0)return[];const r=[];for(const n of e){const{viewport:i}=wn(n)||{};i&&r.push(i)}return r}function pC(t){const e=gC(t);return e.length>0?e[0]:void 0}function mC(t,e,r=.99){const n=e.metadata?.viewPlaneNormal;if(!n||!Array.isArray(n))return;const i=Ie();Lt(i,n);for(const o of t){const a=o.getCamera();if(!a?.viewPlaneNormal)continue;const s=Ie();Lt(s,a.viewPlaneNormal);const c=ft(i,s);if(Math.abs(c)>=r)return o}}function oh(t){const e=Ut(t);if(!e)return;const r=e.representationData?.Contour;if(!r)return;const{annotationUIDsMap:n}=r;if(n)return n}function F9(t,e,r){const n={annotationUID:cn(),data:{contour:{closed:!0,polyline:[]},segmentation:{segmentationId:e,segmentIndex:r},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{...t.metadata,toolName:t.metadata.toolName}};return n.data.segmentation.segmentationId=e,n.data.segmentation.segmentIndex=r,t.data.contour?.polyline&&(n.data.contour.polyline=[...t.data.contour.polyline]),t.data.handles?.points&&(n.data.handles.points=t.data.handles.points.map(i=>[...i])),n}function U9(t,e,r,n){const i=oh(t),o=oh(r);if(!i||!o||!i?.has(e))return;const a=i.get(e),s=pC(r);if(!s)return;const c=Qn(s.id),l=u=>{const f=F9(u,r,n);if(c){const h=c.getToolInstance(u.metadata.toolName);h&&typeof h.isSplineAnnotation=="function"&&h.isSplineAnnotation(u)&&h.createSplineObjectFromType(f,u.data.spline.type)}return Ft(f,s.element),d.add(f.annotationUID),f},d=new Set;for(const u of a){const f=fn(u),h=l(f);if(f?.childAnnotationUIDs){h.childAnnotationUIDs=[];for(const g of f.childAnnotationUIDs){const p=fn(g),v=l(p);v.parentAnnotationUID=h.annotationUID,h.childAnnotationUIDs.push(v.annotationUID)}}}o.set(n,d)}var Wi;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(Wi||(Wi={}));function vC(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}function i1(t,e){const r=t.maxX-t.minX,n=t.maxY-t.minY,i=[r,n],o=[t.minX+r/2,t.minY+n/2],a=[Math.abs(e[0]-o[0]),Math.abs(e[1]-o[1])],s=a[0]-i[0]*.5,c=a[1]-i[1]*.5;if(s>0&&c>0)return s*s+c*c;const l=Math.max(s,0)+Math.max(c,0);return l*l}function QQ(t,e){return Math.sqrt(i1(t,e))}const eee=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:QQ,distanceToPointSquared:i1,intersectAABB:vC},Symbol.toStringTag,{value:"Module"}));class B9{}class G9{constructor(e){this.storePointData=e.storePointData}getStatistics(){console.debug("InstanceCalculator getStatistics called")}}const{PointsManager:tee}=hn;function ah(t){return{max:[-1/0],min:[1/0],sum:[0],count:0,maxIJK:null,maxLPS:null,minIJK:null,minLPS:null,runMean:[0],m2:[0],m3:[0],m4:[0],allValues:[[]],pointsInShape:t?tee.create3(1024):null,sumLPS:[0,0,0]}}function W9(t,e,r=null,n=null){Array.isArray(e)&&e.length>1&&t.max.length===1&&(t.max.push(t.max[0],t.max[0]),t.min.push(t.min[0],t.min[0]),t.sum.push(t.sum[0],t.sum[0]),t.runMean.push(0,0),t.m2.push(t.m2[0],t.m2[0]),t.m3.push(t.m3[0],t.m3[0]),t.m4.push(t.m4[0],t.m4[0]),t.allValues.push([],[])),t?.pointsInShape&&r&&t.pointsInShape.push(r);const i=Array.isArray(e)?e:[e];t.count+=1,r&&(t.sumLPS[0]+=r[0],t.sumLPS[1]+=r[1],t.sumLPS[2]+=r[2]),t.max.forEach((o,a)=>{const s=i[a];t.allValues[a].push(s);const c=t.count,l=s-t.runMean[a],d=l/c,u=l*d*(c-1);t.sum[a]+=s,t.runMean[a]+=d,t.m4[a]+=u*d*d*(c*c-3*c+3)+6*d*d*t.m2[a]-4*d*t.m3[a],t.m3[a]+=u*d*(c-2)-3*d*t.m2[a],t.m2[a]+=u,s<t.min[a]&&(t.min[a]=s,a===0&&(t.minIJK=n?[...n]:null,t.minLPS=r?[...r]:null)),s>t.max[a]&&(t.max[a]=s,a===0&&(t.maxIJK=n?[...n]:null,t.maxLPS=r?[...r]:null))})}function nee(t){if(t.length===0)return 0;const e=[...t].sort((n,i)=>n-i),r=Math.floor(e.length/2);return e.length%2===0?(e[r-1]+e[r])/2:e[r]}function $9(t,e){const r=t.sum.map(u=>u/t.count),n=t.m2.map(u=>Math.sqrt(u/t.count)),i=t.sumLPS.map(u=>u/t.count),o=t.m3.map((u,f)=>{const h=t.m2[f]/t.count;return h===0?0:u/(t.count*Math.pow(h,1.5))}),a=t.m4.map((u,f)=>{const h=t.m2[f]/t.count;return h===0?0:u/(t.count*h*h)-3}),s=t.allValues.map(u=>nee(u)),c={max:{name:"max",label:"Max Pixel",value:t.max.length===1?t.max[0]:t.max,unit:e,pointIJK:t.maxIJK?[...t.maxIJK]:null,pointLPS:t.maxLPS?[...t.maxLPS]:null},min:{name:"min",label:"Min Pixel",value:t.min.length===1?t.min[0]:t.min,unit:e,pointIJK:t.minIJK?[...t.minIJK]:null,pointLPS:t.minLPS?[...t.minLPS]:null},mean:{name:"mean",label:"Mean Pixel",value:r.length===1?r[0]:r,unit:e},stdDev:{name:"stdDev",label:"Standard Deviation",value:n.length===1?n[0]:n,unit:e},count:{name:"count",label:"Voxel Count",value:t.count,unit:null},median:{name:"median",label:"Median",value:s.length===1?s[0]:s,unit:e},skewness:{name:"skewness",label:"Skewness",value:o.length===1?o[0]:o,unit:null},kurtosis:{name:"kurtosis",label:"Kurtosis",value:a.length===1?a[0]:a,unit:null},maxLPS:{name:"maxLPS",label:"Max LPS",value:t.maxLPS?Array.from(t.maxLPS):null,unit:null},minLPS:{name:"minLPS",label:"Min LPS",value:t.minLPS?Array.from(t.minLPS):null,unit:null},pointsInShape:t.pointsInShape,center:{name:"center",label:"Center",value:i?[...i]:null,unit:null},array:[]};c.array.push(c.min,c.max,c.mean,c.stdDev,c.median,c.skewness,c.kurtosis,c.count,c.maxLPS,c.minLPS),c.center.value&&c.array.push(c.center);const l=t.pointsInShape!==null,d=ah(l);return t.max=d.max,t.min=d.min,t.sum=d.sum,t.count=d.count,t.maxIJK=d.maxIJK,t.maxLPS=d.maxLPS,t.minIJK=d.minIJK,t.minLPS=d.minLPS,t.runMean=d.runMean,t.m2=d.m2,t.m3=d.m3,t.m4=d.m4,t.allValues=d.allValues,t.pointsInShape=d.pointsInShape,t.sumLPS=d.sumLPS,c}const cu=class cu extends B9{static statsInit(e){e.storePointData||(this.state.pointsInShape=null),this.state=ah(e.storePointData)}};cu.state=ah(!0),cu.statsCallback=({value:e,pointLPS:r=null,pointIJK:n=null})=>{W9(cu.state,e,r,n)},cu.getStatistics=e=>$9(cu.state,e?.unit);let is=cu;class z9 extends G9{constructor(e){super(e),this.state=ah(e.storePointData)}statsInit(e){this.state=ah(e.storePointData)}statsCallback(e){W9(this.state,e.value,e.pointLPS,e.pointIJK)}getStatistics(e){return $9(this.state,e?.unit)}}const ree=Object.freeze(Object.defineProperty({__proto__:null,BasicStatsCalculator:is,Calculator:B9,InstanceBasicStatsCalculator:z9,InstanceCalculator:G9},Symbol.toStringTag,{value:"Module"}));function oc(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[r,n,i=0]=t,[o,a,s=0]=e,c=o-r,l=a-n,d=s-i;return c*c+l*l+d*d}function ls(t,e){return Math.sqrt(oc(t,e))}function _y(t,e){const[r,n]=t,[i,o]=e,a=2*i-r,s=2*o-n;return[a,s]}const iee=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:ls,distanceToPointSquared:oc,mirror:_y},Symbol.toStringTag,{value:"Module"}));function al(t){const[e,r]=t;return ls(e,r)}function pu(t){const[e,r]=t,n=ls(e,r),i=[e[0]-n,e[1]-n],o=[e[0]+n,e[1]+n];return[i,o]}const oee=Object.freeze(Object.defineProperty({__proto__:null,getCanvasCircleCorners:pu,getCanvasCircleRadius:al},Symbol.toStringTag,{value:"Module"}));function vm(t,e,r={}){return r.precalculated||j9(t,r),r.precalculated(e)}const j9=(t,e={})=>{const{xRadius:r,yRadius:n,zRadius:i}=t;(e.invXRadiusSq===void 0||e.invYRadiusSq===void 0||e.invZRadiusSq===void 0)&&(e.invXRadiusSq=r!==0?1/r**2:0,e.invYRadiusSq=n!==0?1/n**2:0,e.invZRadiusSq=i!==0?1/i**2:0);const{invXRadiusSq:o,invYRadiusSq:a,invZRadiusSq:s}=e,{center:c}=t,[l,d,u]=c;return e.precalculated=f=>{const h=f[0]-l;let g=h*h*o;if(g>1)return!1;const p=f[1]-d;if(g+=p*p*a,g>1)return!1;const v=f[2]-u;return g+=v*v*s,g<=1},e};function Ey(t){const[e,r,n,i]=t,o=[n[0],r[1]],a=[i[0],e[1]];return[o,a]}const aee=Object.freeze(Object.defineProperty({__proto__:null,getCanvasEllipseCorners:Ey,pointInEllipse:vm,precalculatePointInEllipse:j9},Symbol.toStringTag,{value:"Module"}));function o1(t,e,r){let n;const i=oc(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(n=t),!n){const o=((r[0]-t[0])*(e[0]-t[0])+(r[1]-t[1])*(e[1]-t[1]))/i;o<0?n=t:o>1?n=e:n=[t[0]+o*(e[0]-t[0]),t[1]+o*(e[1]-t[1])]}return{point:[...n],distanceSquared:oc(r,n)}}function Wh(t,e,r){return o1(t,e,r).distanceSquared}function yr(t,e,r){if(t.length!==2||e.length!==2||r.length!==2)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(Wh(t,e,r))}function Dg(t){return typeof t=="number"?t?t<0?-1:1:t===t?0:NaN:NaN}function a1(t,e,r,n,i=!1){const[o,a]=t,[s,c]=e,[l,d]=r,[u,f]=n;if(i){const I=(o-s)*(d-f)-(a-c)*(l-u);if(Math.abs(I)<1e-10)return;const O=((o-l)*(d-f)-(a-d)*(l-u))/I,M=o+O*(s-o),R=a+O*(c-a);return[M,R]}const h=c-a,g=o-s,p=s*a-o*c,v=h*l+g*d+p,w=h*u+g*f+p;if(v!==0&&w!==0&&Dg(v)===Dg(w))return;const m=f-d,y=l-u,C=u*d-l*f,x=m*o+y*a+C,S=m*s+y*c+C;if(x!==0&&S!==0&&Dg(x)===Dg(S))return;const T=h*y-m*g;let _;_=g*C-y*p;const E=_/T;_=m*p-h*C;const D=_/T;return[E,D]}const Ud=.01;function pp(t,e,r){const n=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],o=t[1]<=e[1]?t[1]:e[1],a=t[1]>=e[1]?t[1]:e[1];if(!(r[0]>=n-Ud&&r[0]<=i+Ud&&r[1]>=o-Ud&&r[1]<=a+Ud))return!1;const c=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return(c>=0?c:-c)<=Ud}const see=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:yr,distanceToPointSquared:Wh,distanceToPointSquaredInfo:o1,intersectLine:a1,isPointOnLineSegment:pp},Symbol.toStringTag,{value:"Module"}));function ym(t){if(t.length<3)return!1;const e=t.length,r=t[0],n=t[e-1],i=oc(r,n);return Du(0,i)}function Di(t,e,r={closed:void 0}){if(t.length<3)return!1;const n=t.length;let i=0;const{closed:o,holes:a}=r;if(a?.length){for(const l of a)if(Di(l,e))return!1}const s=!(o===void 0?ym(t):o),c=t.length-(s?1:2);for(let l=0;l<=c;l++){const d=t[l],u=l===n-1?0:l+1,f=t[u],h=d[0]>=f[0]?d[0]:f[0],g=d[1]>=f[1]?d[1]:f[1],p=d[1]<=f[1]?d[1]:f[1];if(e[0]<=h&&e[1]>=p&&e[1]<g){let m=d[0]===f[0];if(!m){const y=(e[1]-d[1])*(f[0]-d[0])/(f[1]-d[1])+d[0];m=e[0]<=y}i+=m?1:0}}return!!(i%2)}function Uu(t,e){for(let r=0,n=e.length;r<n;r++)if(!Di(t,e[r]))return!1;return!0}function gl(t,e){let r=t;const n=e?.numDimensions||2,i=n===3;if(!Array.isArray(t[0])){const u=t,f=u.length/n;r=new Array(u.length/n);for(let h=0,g=f;h<g;h++)r[h]=[u[h*n],u[h*n+1]],i&&r[h].push(u[h*n+2])}let o=1/0,a=1/0,s=-1/0,c=-1/0,l=1/0,d=-1/0;r=r;for(let u=0,f=r.length;u<f;u++){const[h,g,p]=r[u];o=o<h?o:h,a=a<g?a:g,s=s>h?s:h,c=c>g?c:g,i&&(l=l<p?l:p,d=d>p?d:p)}return i?{minX:o,maxX:s,minY:a,maxY:c,minZ:l,maxZ:d}:{minX:o,maxX:s,minY:a,maxY:c}}function $h(t){const e=t.length;let r=0,n=e-1;for(let i=0;i<e;i++)r+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(r/2)}function zo(t){if(t.length<3)return 0;const e=t[0];let r=0;for(let n=0,i=t.length;n<i;n++){const o=t[n],a=n===i-1?0:n+1,s=t[a],c=o[0]-e[0],l=o[1]-e[1],d=s[0]-e[0],u=s[1]-e[1];r+=c*u-l*d}return r*=.5,r}function mp(t){return zo(t)>=0?1:-1}function cee(t){const e=Ie(),r=t[0];for(let n=0,i=t.length;n<i;n++){const o=t[n],a=n===i-1?0:n+1,s=t[a],c=o[0]-r[0],l=o[1]-r[1],d=o[2]-r[2],u=s[0]-r[0],f=s[1]-r[1],h=s[2]-r[2];e[0]+=l*h-d*f,e[1]+=d*u-c*h,e[2]+=c*f-l*u}return xr(e,e,.5),e}function lee(t){const e=cee(t);return Lt(e,e)}function by(t){const e=zo(t);return[0,0,e/Math.abs(e)]}const Nr=1e-7;function z2(t,e){return t[0]*e[1]-t[1]*e[0]}function dr(t,e){return Et(t,e,Nr)}function H9(t,e,r,n){const i=En(xt(),e,t),o=En(xt(),n,r),a=z2(i,o),s=En(xt(),r,t),c=z2(s,i);if(Math.abs(a)<Nr){if(Math.abs(c)<Nr){const u=Us(i,i),f=Us(o,o);if(u<Nr||f<Nr)return dr(t,r)||dr(t,n)?t:dr(e,r)||dr(e,n)?e:null;const h=Us(En(xt(),r,t),i)/u,g=Us(En(xt(),n,t),i)/u,p=Us(En(xt(),t,r),o)/f,v=Us(En(xt(),e,r),o)/f,w=m=>m>=-Nr&&m<=1+Nr;if(w(h)){const m=Jd(xt(),t,i,h);if(dr(r,m))return r}if(w(g)){const m=Jd(xt(),t,i,g);if(dr(n,m))return n}if(w(p)){const m=Jd(xt(),r,o,p);if(dr(t,m))return t}if(w(v)){const m=Jd(xt(),r,o,v);if(dr(e,m))return e}}return null}const l=z2(s,o)/a,d=c/a;return l>=-Nr&&l<=1+Nr&&d>=-Nr&&d<=1+Nr?[t[0]+l*i[0],t[1]+l*i[1]]:null}var js;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(js||(js={}));var Si;(function(t){t[t.Entering=0]="Entering",t[t.Exiting=1]="Exiting",t[t.Unknown=2]="Unknown"})(Si||(Si={}));function fd(t,e){if(t.length!==e.length)return!1;const r=t.length;if(r===0)return!0;let n=!0;for(let o=0;o<r;o++)if(!dr(t[o],e[o])){n=!1;break}if(n)return!0;let i=!0;for(let o=0;o<r;o++)if(!dr(t[o],e[r-1-o])){i=!1;break}if(i)return!0;for(let o=1;o<r;o++){let a=!0;for(let c=0;c<r;c++)if(!dr(t[c],e[(c+o)%r])){a=!1;break}if(a)return!0;let s=!0;for(let c=0;c<r;c++)if(!dr(t[c],e[(r-1-c+o)%r])){s=!1;break}if(s)return!0}return!1}function wm(t,e){if(t.length<3)return[];if(e.length<3)return[t.slice()];const r=e.slice();if(fd(t,e))return[];const n=zo(t),i=zo(r);Math.sign(n)===Math.sign(i)&&Math.abs(i)>Nr&&r.reverse();const o=[];for(let d=0;d<t.length;d++){const u=t[d],f=t[(d+1)%t.length];for(let h=0;h<r.length;h++){const g=r[h],p=r[(h+1)%r.length],v=H9(u,f,g,p);if(v){const w=Math.sqrt(Yc(u,f)),m=Math.sqrt(Yc(g,p));o.push({coord:v,seg1Idx:d,seg2Idx:h,alpha1:w<Nr?0:Math.sqrt(Yc(u,v))/w,alpha2:m<Nr?0:Math.sqrt(Yc(g,v))/m})}}}const a=(d,u,f)=>{const h=[];let g=0;for(let v=0;v<d.length;v++){const w=d[v];h.push({id:`${u}_v${g++}`,coordinates:w,type:js.Vertex,originalPolyIndex:u,originalVertexIndex:v,next:null,prev:null,isIntersection:!1,visited:!1});const m=f.filter(y=>(u===0?y.seg1Idx:y.seg2Idx)===v).sort((y,C)=>(u===0?y.alpha1:y.alpha2)-(u===0?C.alpha1:C.alpha2));for(const y of m){if(h.length>0&&dr(h[h.length-1].coordinates,y.coord)){h[h.length-1].isIntersection||(h[h.length-1].isIntersection=!0,h[h.length-1].intersectionInfo=y,h[h.length-1].alpha=u===0?y.alpha1:y.alpha2);continue}h.push({id:`${u}_i${g++}`,coordinates:y.coord,type:js.Intersection,originalPolyIndex:u,next:null,prev:null,isIntersection:!0,visited:!1,alpha:u===0?y.alpha1:y.alpha2,intersectionInfo:y})}}const p=[];if(h.length>0){p.push(h[0]);for(let v=1;v<h.length;v++)dr(h[v].coordinates,p[p.length-1].coordinates)?h[v].isIntersection&&(p[p.length-1].isIntersection=!0,p[p.length-1].intersectionInfo=h[v].intersectionInfo,p[p.length-1].alpha=h[v].alpha):p.push(h[v])}if(p.length>0)for(let v=0;v<p.length;v++)p[v].next=p[(v+1)%p.length],p[v].prev=p[(v-1+p.length)%p.length];return p},s=a(t,0,o),c=a(r,1,o);s.forEach(d=>{if(d.isIntersection){const u=d.intersectionInfo,f=c.find(h=>h.isIntersection&&dr(h.coordinates,d.coordinates)&&h.intersectionInfo.seg1Idx===u.seg1Idx&&h.intersectionInfo.seg2Idx===u.seg2Idx);if(f){d.partnerNode=f,f.partnerNode=d;const h=d.prev.coordinates,g=d.coordinates,p=f.next.coordinates;En(xt(),g,h),En(xt(),p,g);const v=[(d.prev.coordinates[0]+d.coordinates[0])/2,(d.prev.coordinates[1]+d.coordinates[1])/2];Di(e,v)?d.intersectionDir=Si.Exiting:d.intersectionDir=Si.Entering}else d.isIntersection=!1}}),s.forEach(d=>delete d.intersectionInfo),c.forEach(d=>delete d.intersectionInfo);const l=[];for(let d=0;d<s.length;d++){const u=s[d];if(u.visited||u.isIntersection||Di(e,u.coordinates))continue;const f=[];let h=u,g=!0,p=0;const v=(s.length+c.length)*2;do{if(p++>v){console.warn("Subtraction: Max iterations reached, possible infinite loop.");break}h.visited=!0,(f.length===0||!dr(f[f.length-1],h.coordinates))&&f.push(h.coordinates),h.isIntersection&&(g?h.intersectionDir===Si.Entering&&h.partnerNode&&(h=h.partnerNode,g=!1):h.partnerNode?(h=h.partnerNode,g=!0):console.warn("Subtraction: Intersection on source without partner.")),h=h.next}while(h!==u||!g);f.length>=3&&(dr(f[0],f[f.length-1])&&f.pop(),f.length>=3&&l.push(f))}return l}function X9(t,e){if(t.length<3||e.length<3)return[];let r=e.slice();const n=zo(t),i=zo(r);if(Math.abs(n)<Nr||Math.abs(i)<Nr)return[];n<0&&(t=t.slice().reverse()),i<0&&(r=r.slice().reverse());const o=r,a=[];for(let u=0;u<t.length;u++){const f=t[u],h=t[(u+1)%t.length];for(let g=0;g<r.length;g++){const p=r[g],v=r[(g+1)%r.length],w=H9(f,h,p,v);if(w){const m=Math.sqrt(Yc(f,h)),y=Math.sqrt(Yc(p,v));a.push({coord:[...w],seg1Idx:u,seg2Idx:g,alpha1:m<Nr?0:Math.sqrt(Yc(f,w))/m,alpha2:y<Nr?0:Math.sqrt(Yc(p,w))/y})}}}if(a.length===0)return Di(o,t[0])&&t.every(u=>Di(o,u))?[[...t.map(u=>[...u])]]:Di(t,r[0])&&r.every(u=>Di(t,u))?[[...r.map(u=>[...u])]]:[];const s=(u,f,h)=>{const g=[];let p=0;for(let w=0;w<u.length;w++){const m=u[w];g.push({id:`${f}_v${p++}`,coordinates:[...m],type:js.Vertex,originalPolyIndex:f,originalVertexIndex:w,next:null,prev:null,isIntersection:!1,visited:!1,processedInPath:!1,intersectionDir:Si.Unknown});const y=h.filter(C=>(f===0?C.seg1Idx:C.seg2Idx)===w).sort((C,x)=>(f===0?C.alpha1:C.alpha2)-(f===0?x.alpha1:x.alpha2));for(const C of y){if(g.length>0&&dr(g[g.length-1].coordinates,C.coord)){const x=g[g.length-1];x.isIntersection||(x.isIntersection=!0,x.intersectionInfo=C,x.alpha=f===0?C.alpha1:C.alpha2,x.type=js.Intersection);continue}g.push({id:`${f}_i${p++}`,coordinates:[...C.coord],type:js.Intersection,originalPolyIndex:f,next:null,prev:null,isIntersection:!0,visited:!1,processedInPath:!1,alpha:f===0?C.alpha1:C.alpha2,intersectionInfo:C,intersectionDir:Si.Unknown})}}const v=[];if(g.length>0){v.push(g[0]);for(let w=1;w<g.length;w++)if(!dr(g[w].coordinates,v[v.length-1].coordinates))v.push(g[w]);else{const m=v[v.length-1];g[w].isIntersection&&g[w].intersectionInfo&&(m.isIntersection=!0,m.intersectionInfo=g[w].intersectionInfo,m.alpha=g[w].alpha,m.type=js.Intersection)}}if(v.length>1&&dr(v[0].coordinates,v[v.length-1].coordinates)){const w=v[0],m=v.pop();m.isIntersection&&!w.isIntersection&&m.intersectionInfo&&(w.isIntersection=!0,w.intersectionInfo=m.intersectionInfo,w.alpha=m.alpha,w.type=js.Intersection)}if(v.length>0)for(let w=0;w<v.length;w++)v[w].next=v[(w+1)%v.length],v[w].prev=v[(w-1+v.length)%v.length];return v},c=s(t,0,a),l=s(r,1,a);if(c.length===0||l.length===0)return[];c.forEach(u=>{if(u.isIntersection&&u.intersectionInfo){const f=u.intersectionInfo,h=l.find(g=>g.isIntersection&&g.intersectionInfo&&dr(g.coordinates,u.coordinates)&&g.intersectionInfo.seg1Idx===f.seg1Idx&&g.intersectionInfo.seg2Idx===f.seg2Idx);if(h){u.partnerNode=h,h.partnerNode=u;const g=En(xt(),u.coordinates,u.prev.coordinates),p=En(xt(),h.next.coordinates,h.coordinates),v=g[0]*p[1]-g[1]*p[0];if(v>Nr)u.intersectionDir=Si.Entering,h.intersectionDir=Si.Exiting;else if(v<-Nr)u.intersectionDir=Si.Exiting,h.intersectionDir=Si.Entering;else{const w=[(u.prev.coordinates[0]+u.coordinates[0])/2,(u.prev.coordinates[1]+u.coordinates[1])/2];Di(o,w)?(u.intersectionDir=Si.Exiting,h.intersectionDir=Si.Entering):(u.intersectionDir=Si.Entering,h.intersectionDir=Si.Exiting)}}else u.isIntersection=!1,u.intersectionInfo=void 0}});const d=[];for(const u of c){if(!u.isIntersection||u.visited||u.intersectionDir!==Si.Entering)continue;let f=[],h=u,g=!0;const p=u;let v=0;const w=(c.length+l.length)*2;c.forEach(m=>m.processedInPath=!1),l.forEach(m=>m.processedInPath=!1);do{if(v++>w){console.warn("Intersection: Max iterations in path tracing.",p.id,h.id),f=[];break}if(h.processedInPath&&h!==p){console.warn("Intersection: Path processing loop detected, discarding path segment.",p.id,h.id),f=[];break}h.processedInPath=!0,h.visited=!0,(f.length===0||!dr(f[f.length-1],h.coordinates))&&f.push([...h.coordinates]);let m=!1;h.isIntersection&&h.partnerNode&&(g?(h=h.partnerNode,g=!1,m=!0):(h=h.partnerNode,g=!0,m=!0)),h=h.next}while(h!==p||g&&h.originalPolyIndex!==0||!g&&h.originalPolyIndex!==1);if(v>w||f.length===0||f.length>0&&dr(f[0],f[f.length-1])&&f.pop(),f.length>=3){const m=zo(f);(n>0&&m<0||n<0&&m>0)&&f.reverse(),d.push(f.map(y=>[...y]))}}return d}function yC(t,e,r,n){let i=!1;const o=t[0]<e[0]?t[0]:e[0],a=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],l=r[0]<n[0]?r[0]:n[0],d=r[1]<n[1]?r[1]:n[1],u=r[0]>n[0]?r[0]:n[0],f=r[1]>n[1]?r[1]:n[1];if(o>u||s<l||a>f||c<d)return!1;const h=[Ig(t,e,r),Ig(t,e,n),Ig(r,n,t),Ig(r,n,e)];return h[0]!==h[1]&&h[2]!==h[3]?!0:((h[0]===0&&Mg(t,r,e)||h[1]===0&&Mg(t,n,e)||h[2]===0&&Mg(r,t,n)||h[3]===0&&Mg(r,e,n))&&(i=!0),i)}function Ig(t,e,r){const n=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return n===0?0:n>0?1:2}function Mg(t,e,r){return e[0]<=Math.max(t[0],r[0])&&e[0]>=Math.min(t[0],r[0])&&e[1]<=Math.max(t[1],r[1])&&e[1]>=Math.min(t[1],r[1])}function wC(t,e,r,n=!0){const i=[],o=t.length,a=o-(n?1:2);for(let s=0;s<=a;s++){const c=t[s],l=s===o-1?0:s+1,d=t[l];yC(e,r,c,d)&&i.push([s,l])}return i}function K9(t,e,r,n=!0){let i,o;n?(o=t.length-1,i=0):(o=0,i=1);for(let a=i;a<t.length;a++){const s=t[o],c=t[a];if(yC(e,r,s,c))return[o,a];o=a}}function Cm(t,e){for(let r=0,n=t.length;r<n;r++){const i=t[r],o=r===n-1?0:r+1,a=t[o];if(K9(e,i,a)?.length===2)return!0}return!1}const uee=.01;function q9(t,e,r,n){const i=[e[0]-t[0],e[1]-t[1]],o=[n[0]-r[0],n[1]-r[1]],a=o[1]*i[0]-o[0]*i[1];if((a>=0?a:-a)<uee){const g=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],p=[r[0]<n[0]?r[0]:n[0],r[0]>n[0]?r[0]:n[0],r[1]<n[1]?r[1]:n[1],r[1]>n[1]?r[1]:n[1]];if(!(g[0]<=p[1]&&g[1]>=p[0]&&g[2]<=p[3]&&g[3]>=p[2])||!(pp(t,e,r)||pp(t,e,n)||pp(r,n,t)))return;const m=g[0]>p[0]?g[0]:p[0],y=g[1]<p[1]?g[1]:p[1],C=g[2]>p[2]?g[2]:p[2],x=g[3]<p[3]?g[3]:p[3],S=(m+y)*.5,T=(C+x)*.5;return[S,T]}let c=t[1]-r[1],l=t[0]-r[0];const d=o[0]*c-o[1]*l,u=i[0]*c-i[1]*l;c=d/a,l=u/a;const f=t[0]+c*i[0],h=t[1]+c*i[1];return[f,h]}var wu;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(wu||(wu={}));var Cu;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})(Cu||(Cu={}));var l0;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(l0||(l0={}));function IT(t){for(let e=0,r=t.length;e<r;e++){const n=t[e];n.next||(n.next=t[e===r-1?0:e+1])}}function dee(t,e){const r=[],n=[],i=new Map;let a=Di(e,t[0])?l0.Exiting:l0.Entering;for(let s=0,c=t.length;s<c;s++){const l=t[s],d=Di(e,l),u={type:wu.Vertex,coordinates:l,position:d?Cu.Inside:Cu.Outside,visited:!1,next:null};r.push(u);const f=t[s===c-1?0:s+1],h=wC(e,l,f).map(g=>{const p=g[0],v=e[g[0]],w=e[g[1]],m=q9(l,f,v,w),y=oc(l,m);return{sourceLineSegmentId:p,coordinate:m,targetStartPointDistSquared:y}});h.sort((g,p)=>g.targetStartPointDistSquared-p.targetStartPointDistSquared),h.forEach(g=>{const{sourceLineSegmentId:p,coordinate:v}=g,w={type:wu.Intersection,coordinates:v,position:Cu.Edge,direction:a,visited:!1,next:null},m={...w,direction:l0.Unknown,cloned:!0};a===l0.Entering?w.next=m:m.next=w;let y=i.get(p);y||(y=[],i.set(p,y)),r.push(w),y.push(m),a*=-1})}for(let s=0,c=e.length;s<c;s++){const l=s,d=e[s],u={type:wu.Vertex,coordinates:d,visited:!1,next:null};n.push(u);const f=i.get(l);f?.length&&f.map(h=>({intersectionPoint:h,lineSegStartDistSquared:oc(d,h.coordinates)})).sort((h,g)=>h.lineSegStartDistSquared-g.lineSegStartDistSquared).map(({intersectionPoint:h})=>h).forEach(h=>n.push(h))}return IT(r),IT(n),{targetPolylinePoints:r,sourcePolylinePoints:n}}function fee(t){for(let e=0,r=t.length;e<r;e++){const n=t[e];if(!n.visited&&n.position===Cu.Outside&&n.type===wu.Vertex)return n}for(let e=0,r=t.length;e<r;e++){const n=t[e];if(!n.visited&&n.position===Cu.Outside)return n}}function xm(t,e){const r=by(t),n=by(e),i=ft(n,r);if(Du(1,i)||(e=e.slice().reverse()),!Cm(e,t)&&Uu(e,t))return e.slice();const{targetPolylinePoints:s}=dee(t,e),c=fee(s);if(!c)return t.slice();const l=[c.coordinates];let d=c.next,u=0;const f=t.length+e.length+1e3;for(;d!==c&&u<f;){if(u++,d.type===wu.Intersection&&d.cloned){d=d.next;continue}if(l.push(d.coordinates),d=d.next,!d){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}}return u>=f&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),l}const hee=.1;function Sm(t,e=hee){const r=t.length;if(r<3)return t;const n=e*e,i=[[0,r-1]],o=new Array(r).fill(!1);let a=2;for(o[0]=!0,o[r-1]=!0;i.length;){const[c,l]=i.pop();if(l-c===1)continue;const d=t[c],u=t[l];let f=-1/0,h=-1;for(let g=c+1;g<l;g++){const p=t[g],v=Wh(d,u,p);v>f&&(f=v,h=g)}f<n||(o[h]=!0,a++,i.push([h,l]),i.push([c,h]))}const s=new Array(a);for(let c=0,l=0;c<r;c++)o[c]&&(s[l++]=t[c]);return s}function Y9(t,e,r,n=!0){const i=[],o=wC(t,e,r,n);for(let a=0;a<o.length;a++){const s=t[o[a][0]],c=t[o[a][1]],l=q9(e,r,s,c);i.push(l)}return i}function gee(t,e,r,n=!0){let i,o;n?(o=t.length-1,i=0):(o=0,i=1);const a=[];for(let d=i;d<t.length;d++){const u=t[o],f=t[d];yC(e,r,u,f)&&a.push([o,d]),o=d}if(a.length===0)return;const s=[];a.forEach(d=>{const u=[t[d[0]],t[d[1]]],f=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2];s.push(Bn(f,e))});const c=Math.min(...s),l=s.indexOf(c);return{segment:a[l],distance:c}}const Zu=.001,pee=(t,e)=>{let r,n,i;if(t instanceof Wn){const a=t.getImageData();if(!a)return;n=a.direction.slice(0,3),i=a.direction.slice(3,6),r=a.spacing}else{const a=t.getImageData(),{direction:s,spacing:c}=a,{viewPlaneNormal:l,viewUp:d}=t.getCamera(),u=s.slice(0,3),f=s.slice(3,6),h=s.slice(6,9),g=Ie();tn(g,d,l);const p=Math.abs(ft(g,u)),v=Math.abs(ft(g,f)),w=Math.abs(ft(g,h));let m;if(Math.abs(1-p)<Zu)m=c[0],n=u;else if(Math.abs(1-v)<Zu)m=c[1],n=f;else if(Math.abs(1-w)<Zu)m=c[2],n=h;else throw new Error("No support yet for oblique plane planar contours");const y=Math.abs(ft(d,u)),C=Math.abs(ft(d,f)),x=Math.abs(ft(d,h));let S;if(Math.abs(1-y)<Zu)S=c[0],i=u;else if(Math.abs(1-C)<Zu)S=c[1],i=f;else if(Math.abs(1-x)<Zu)S=c[2],i=h;else throw new Error("No support yet for oblique plane planar contours");r=[m,S]}return{spacing:[r[0]/e,r[1]/e],xDir:n,yDir:i}},mee=(t,e,r)=>j5(t,e)<r,vee=(t,e,r,n)=>{const{xDir:i,yDir:o,spacing:a}=n,s=Ce(t),{viewport:c}=s;if(!e.length)return e.push(r),console.log(">>>>> !canvasPoints. :: RETURN"),1;const l=c.canvasToWorld(e[e.length-1]),d=c.canvasToWorld(r),u=Ie();an(u,d,l);const f=Math.abs(ft(u,i)),h=Math.abs(ft(u,o)),g=Math.max(Math.floor(f/a[0]),Math.floor(h/a[0]));if(g>1){const p=e[e.length-1],v=j5(p,r),w=xt();En(w,r,p),ko(w,w[0]/v,w[1]/v);const m=v/g;for(let y=1;y<=g;y++)e.push([p[0]+m*w[0]*y,p[1]+m*w[1]*y])}else e.push(r);return g},yee=(t,e,r,n)=>{const i=[t[0]-e[0],t[1]-e[1]],o=[r[0]-e[0],r[1]-e[1]],a=i[0]*o[0]+i[1]*o[1];if(a<0)return!1;const s=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(s===0)return!1;const c=a/s,l=[o[0]/s,o[1]/s],d=[l[0]*c,l[1]*c],u=[e[0]+d[0],e[1]+d[1]];return!(Bn(t,u)>n||Bn(e,u)>Bn(e,r))},wee=1e-6;function J9(t){let e;const r=jw(t,50);for(let a=0;a<3;a++)if(r.every((s,c,l)=>Math.abs(s[a]-l[0][a])<wee)){e=a;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const n=[],i=(e+1)%3,o=(e+2)%3;for(let a=0;a<t.length;a++)n.push([t[a][i],t[a][o]]);return{sharedDimensionIndex:e,projectedPolyline:n}}function CC(t,e,r={}){const{sharedDimensionIndex:n,projectedPolyline:i}=J9(e),{holes:o}=r,a=[];if(o)for(let c=0;c<o.length;c++){const l=o[c],d=[];for(let u=0;u<l.length;u++)d.push([l[u][(n+1)%3],l[u][(n+2)%3]]);a.push(d)}const s=[t[(n+1)%3],t[(n+2)%3]];return Di(i,s,{holes:a})}function Z9(t){if(t.length<3)return t.slice();const e=t.map(o=>[o[0],o[1]]).sort((o,a)=>o[0]===a[0]?o[1]-a[1]:o[0]-a[0]);function r(o,a,s){return(a[0]-o[0])*(s[1]-o[1])-(a[1]-o[1])*(s[0]-o[0])}const n=[];for(const o of e){for(;n.length>=2&&r(n[n.length-2],n[n.length-1],o)<=0;)n.pop();n.push(o)}const i=[];for(let o=e.length-1;o>=0;o--){const a=e[o];for(;i.length>=2&&r(i[i.length-2],i[i.length-1],a)<=0;)i.pop();i.push(a)}return n.pop(),i.pop(),n.concat(i)}const yl=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:vee,arePolylinesIdentical:fd,containsPoint:Di,containsPoints:Uu,convexHull:Z9,decimate:Sm,getAABB:gl,getArea:$h,getClosestLineSegmentIntersection:gee,getFirstLineSegmentIntersectionIndexes:K9,getLineSegmentIntersectionsCoordinates:Y9,getLineSegmentIntersectionsIndexes:wC,getNormal2:by,getNormal3:lee,getSignedArea:zo,getSubPixelSpacingAndXYDirections:pee,getWindingDirection:mp,intersectPolyline:Cm,intersectPolylines:X9,isClosed:ym,isPointInsidePolyline3D:CC,mergePolylines:xm,pointCanProjectOnLine:yee,pointsAreWithinCloseContourProximity:mee,projectTo2D:J9,subtractPolylines:wm},Symbol.toStringTag,{value:"Module"}));function Cee(t,e,r,n){const i=[t,e],o=[t+r,e],a=[t+r,e],s=[t+r,e+n],c=[t+r,e+n],l=[t,e+n],d=[t,e+n];return{top:[i,o],right:[a,s],bottom:[c,l],left:[d,[t,e]]}}function xC(t,e){if(t.length!==4||e.length!==2)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[r,n,i,o]=t;let a=655535;const s=Cee(r,n,i,o);return Object.keys(s).forEach(c=>{const[l,d]=s[c],u=yr(l,d,e);u<a&&(a=u)}),a}const xee=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:xC},Symbol.toStringTag,{value:"Module"}));function Dy(t,e){let r=[0,0],n=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const o=See(e,i);o<n&&(n=o,r=[...i])}),r}function See(t,e){const[r,n]=t,[i,o]=e;return Math.sqrt(Math.pow(r-i,2)+Math.pow(n-o,2))}const Iy=1e-6,MT=1,Tee=0;function Og(t,e,r){const[n,i]=r;if(Math.abs(e)<Iy)return t<0;const o=t/e;if(e>0){if(o>i)return 0;o>n&&(r[0]=o)}else{if(o<n)return 0;o<i&&(r[1]=o)}return 1}function mu(t,e,r,n,i){const[o,a]=t,[s,c]=e,l=s-o,d=c-a;if(n===void 0||i===void 0?(n=t,i=e):(n[0]=t[0],n[1]=t[1],i[0]=e[0],i[1]=e[1]),Math.abs(l)<Iy&&Math.abs(d)<Iy&&o>=r[0]&&o<=r[2]&&a>=r[1]&&a<=r[3])return MT;const u=[0,1];if(Og(r[0]-o,l,u)&&Og(o-r[2],-l,u)&&Og(r[1]-a,d,u)&&Og(a-r[3],-d,u)){const[f,h]=u;return h<1&&(i[0]=o+h*l,i[1]=a+h*d),f>0&&(n[0]+=f*l,n[1]+=f*d),MT}return Tee}const _ee=Object.freeze(Object.defineProperty({__proto__:null,findClosestPoint:Dy,liangBarksyClip:mu},Symbol.toStringTag,{value:"Module"}));function Eee(t,e){const[r,n]=t,[i,o]=e,a=rn(Ie(),n,r),s=rn(Ie(),i,o),c=ft(a,s),l=pr(a),d=pr(s),u=c/(l*d);return Math.acos(u)*180/Math.PI}function bee(t,e){const[r,n]=t,[i,o]=e,a=mo(xt(),n,r),s=mo(xt(),i,o),c=Us(a,s),l=Np(a),d=Np(s),u=c/(l*d);return Math.acos(u)*(180/Math.PI)}function D0(t,e){return t[0].length===3?Eee(t,e):bee(t,e)}const Dee=Object.freeze(Object.defineProperty({__proto__:null,angleBetweenLines:D0},Symbol.toStringTag,{value:"Module"})),Iee=Object.freeze(Object.defineProperty({__proto__:null,BasicStatsCalculator:ree,aabb:eee,angle:Dee,circle:oee,ellipse:aee,lineSegment:see,point:iee,polyline:yl,rectangle:xee,vec2:_ee},Symbol.toStringTag,{value:"Module"}));function Sa(t,e,r,n){const{canvasToWorld:i,worldToCanvas:o}=r,{data:a}=t,{targetWindingDirection:s}=e;let{points:c}=e,l=mp(c);n?.decimate?.enabled&&(c=Sm(e.points,n?.decimate?.epsilon));let{closed:d}=e;const u=c.length,f=new Array(u);mp(c);const h=kI(t);if(d===void 0){let g=!1;if(c.length>3){const p=oc(c[0],c[u-1]);g=Et(0,p)}d=g}if(n?.updateWindingDirection!==!1){let g=h?h.data.contour.windingDirection*-1:s;g===void 0&&(g=l),g!==l&&c.reverse();const p=(a.handles?.points??[]).map(o);p.length>2&&mp(p)!==g&&a.handles.points.reverse(),l=g}for(let g=0;g<u;g++)f[g]=i(c[g]);a.contour.polyline=f,a.contour.closed=d,a.contour.windingDirection=l,Jw(t)}const Mee="viewport-element";function Oee(t){const e=Ce(t),{viewportId:r,renderingEngineId:n}=e,i=`${r}:${n}`,o=Pee(t);return Object.keys(Ue.svgNodeCache[i]).forEach(a=>{Ue.svgNodeCache[i][a].touched=!1}),{svgLayerElement:o,svgNodeCacheForCanvas:Ue.svgNodeCache,getSvgNode:Ree.bind(this,i),appendNode:Aee.bind(this,o,i),setNodeTouched:Lee.bind(this,i),clearUntouched:Nee.bind(this,o,i)}}function Pee(t){const e=`.${Mee}`;return t.querySelector(e)?.querySelector(":scope > .svg-layer")}function Ree(t,e){if(Ue.svgNodeCache[t]&&Ue.svgNodeCache[t][e])return Ue.svgNodeCache[t][e].domRef}function Aee(t,e,r,n){if(!Ue.svgNodeCache[e])return null;Ue.svgNodeCache[e][n]={touched:!0,domRef:r},t.appendChild(r)}function Lee(t,e){Ue.svgNodeCache[t]&&Ue.svgNodeCache[t][e]&&(Ue.svgNodeCache[t][e].touched=!0)}function Nee(t,e){Ue.svgNodeCache[e]&&Object.keys(Ue.svgNodeCache[e]).forEach(r=>{const n=Ue.svgNodeCache[e][r];!n.touched&&n.domRef&&(t.removeChild(n.domRef),delete Ue.svgNodeCache[e][r])})}function Q9(t,e){const r=Oee(t);e(r),r.clearUntouched()}function us(t,e,r){return`${t}::${e}::${r}`}function xo(t,e){Object.keys(t).forEach(r=>{const n=e.getAttribute(r),i=t[r];i===void 0||i===""?e.removeAttribute(r):n!==i&&e.setAttribute(r,i)})}function ds(t,e){Object.keys(t).forEach(r=>{const n=t[r];n!==void 0&&n!==""&&e.setAttribute(r,n)})}function hi(t,e,r,n,i,o={},a=""){const{color:s,fill:c,width:l,lineWidth:d,lineDash:u,fillOpacity:f,strokeOpacity:h}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},o),g=d||l,p="http://www.w3.org/2000/svg",v=us(e,"circle",r),w=t.getSvgNode(v),m={cx:`${n[0]}`,cy:`${n[1]}`,r:`${i}`,stroke:s,fill:c,"stroke-width":g,"stroke-dasharray":u,"fill-opacity":f,"stroke-opacity":h};if(w)xo(m,w),t.setNodeTouched(v);else{const y=document.createElementNS(p,"circle");a!==""&&y.setAttribute("data-id",a),ds(m,y),t.appendNode(y,v)}}function SC(t,e,r,n,i={},o=""){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),d=c||s,u="http://www.w3.org/2000/svg",f=us(e,"ellipse",r),h=t.getSvgNode(f),[g,p,v,w]=n,m=Math.hypot(v[0]-w[0],v[1]-w[1]),y=Math.hypot(p[0]-g[0],p[1]-g[1]),C=Math.atan2(v[1]-w[1],v[0]-w[0])*180/Math.PI,x=[(v[0]+w[0])/2,(p[1]+g[1])/2],S=m/2,T=y/2,_={cx:`${x[0]}`,cy:`${x[1]}`,rx:`${S}`,ry:`${T}`,stroke:a,fill:"transparent",transform:`rotate(${C} ${x[0]} ${x[1]})`,"stroke-width":d,"stroke-dasharray":l};if(h)xo(_,h),t.setNodeTouched(f);else{const E=document.createElementNS(u,"ellipse");o!==""&&E.setAttribute("data-id",o),ds(_,E),t.appendNode(E,f)}}function Vee(t,e,r,n,i,o={},a=""){const s=[(n[0]+i[0])/2,n[1]],c=[(n[0]+i[0])/2,i[1]],l=[n[0],(n[1]+i[1])/2],d=[i[0],(n[1]+i[1])/2];SC(t,e,r,[c,s,l,d],o={},a="")}function s1(t,e,r,n,i={},o){const{color:a,handleRadius:s,width:c,lineWidth:l,fill:d,type:u,opacity:f}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),h=l||c,g="http://www.w3.org/2000/svg",p=us(e,"handle",`hg-${r}-index-${o}`);let v;if(u==="circle")v={cx:`${n[0]}`,cy:`${n[1]}`,r:s,stroke:a,fill:d,"stroke-width":h,opacity:f};else if(u==="rect"){const y=parseFloat(s)*1.5,C=n[0]-y*.5,x=n[1]-y*.5;v={x:`${C}`,y:`${x}`,width:`${y}`,height:`${y}`,stroke:a,fill:d,"stroke-width":h,rx:`${y*.1}`,opacity:f}}else throw new Error(`Unsupported handle type: ${u}`);const w=t.getSvgNode(p);if(w)xo(v,w),t.setNodeTouched(p);else{const m=document.createElementNS(g,u);ds(v,m),t.appendNode(m,p)}}function kn(t,e,r,n,i={}){n.forEach((o,a)=>{s1(t,e,r,o,i,a)})}function qt(t,e,r,n,i,o={},a=""){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s="rgb(0, 255, 0)",width:c=10,lineWidth:l,lineDash:d,markerStartId:u=null,markerEndId:f=null,shadow:h=!1,strokeOpacity:g=1,textBoxLinkLineColor:p}=o,v=l||c,w="http://www.w3.org/2000/svg",m=us(e,"line",r),y=t.getSvgNode(m),C=t.svgLayerElement.id,x=h?`filter:url(#shadow-${C});`:"",S={x1:`${n[0]}`,y1:`${n[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:p||s,style:x,"stroke-width":v,"stroke-dasharray":d,"marker-start":u?`url(#${u})`:"","marker-end":f?`url(#${f})`:"","stroke-opacity":g};if(y)xo(S,y),t.setNodeTouched(m);else{const T=document.createElementNS(w,"line");a!==""&&T.setAttribute("data-id",a),ds(S,T),t.appendNode(T,m)}}function e7(t,e,r,n,i,o={}){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),d=i[0]+(n[0]-i[0])/2,u=[d,n[1]],f=[d,i[1]],h={start:n,end:u},g={start:u,end:f},p={start:f,end:i};qt(t,e,"1",h.start,h.end,{color:a,width:s,lineWidth:c,lineDash:l}),qt(t,e,"2",g.start,g.end,{color:a,width:s,lineWidth:c,lineDash:l}),qt(t,e,"3",p.start,p.end,{color:a,width:s,lineWidth:c,lineDash:l})}function jo(t,e,r,n,i){if(n.length<2)return;const{color:o="rgb(0, 255, 0)",width:a=10,fillColor:s="none",fillOpacity:c=0,lineWidth:l,lineDash:d,closePath:u=!1,markerStartId:f=null,markerEndId:h=null}=i,g=l||a,p="http://www.w3.org/2000/svg",v=us(e,"polyline",r),w=t.getSvgNode(v);let m="";for(const C of n)m+=`${C[0].toFixed(1)}, ${C[1].toFixed(1)} `;if(u){const C=n[0];m+=`${C[0]}, ${C[1]}`}const y={points:m,stroke:o,fill:s,"fill-opacity":c,"stroke-width":g,"stroke-dasharray":d,"marker-start":f?`url(#${f})`:"","marker-end":h?`url(#${h})`:""};if(w)xo(y,w),t.setNodeTouched(v);else{const C=document.createElementNS(p,"polyline");ds(y,C),t.appendNode(C,v)}}function Js(t,e,r,n,i){const a=n.length&&n[0].length&&Array.isArray(n[0][0])?n:[n],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:l="none",fillOpacity:d=0,lineWidth:u,lineDash:f,closePath:h=!1}=i,g=u||c,p="http://www.w3.org/2000/svg",v=us(e,"path",r),w=t.getSvgNode(v);let m="";for(let C=0,x=a.length;C<x;C++){const S=a[C],T=S.length;if(!(T<2)){for(let _=0;_<T;_++){const E=S[_];m+=`${_?"L":"M"} ${E[0].toFixed(1)}, ${E[1].toFixed(1)} `}h&&(m+="Z ")}}if(!m)return;const y={d:m,stroke:s,fill:l,"fill-opacity":d,"stroke-width":g,"stroke-dasharray":f};if(w)xo(y,w),t.setNodeTouched(v);else{const C=document.createElementNS(p,"path");ds(y,C),t.appendNode(C,v)}}function My(t,e,r,n,i,o,a,s,c={},l="",d){const{color:u,fill:f,width:h,lineWidth:g,lineDash:p,fillOpacity:v,strokeOpacity:w}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},c),m=g||h,y="http://www.w3.org/2000/svg",C=us(e,"fan",r),x=t.getSvgNode(C),S=a*Math.PI/180,T=s*Math.PI/180,_=n[0],E=n[1],D=_+o*Math.cos(S),b=E+o*Math.sin(S),I=_+o*Math.cos(T),O=E+o*Math.sin(T),M=_+i*Math.cos(S),R=E+i*Math.sin(S),A=_+i*Math.cos(T),G=E+i*Math.sin(T),k=s-a<=180?0:1;let L=`M ${D} ${b}`;L+=` A ${o} ${o} 0 ${k} 1 ${I} ${O}`,L+=` L ${A} ${G}`,L+=` A ${i} ${i} 0 ${k} 0 ${M} ${R}`,L+=" Z";const F={d:L,stroke:u,fill:f,"stroke-width":m,"stroke-dasharray":p,"fill-opacity":v,"stroke-opacity":w,"mix-blend-mode":"normal"};if(x)xo(F,x),t.setNodeTouched(C);else{const j=document.createElementNS(y,"path");l!==""&&j.setAttribute("data-id",l),d!==void 0&&(j.style.zIndex=d.toString()),ds(F,j),t.appendNode(j,C)}}function ac(t,e,r,n,i,o={}){const a=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},o);return kee(t,e,r,n,i,a)}function kee(t,e,r,n=[""],i,o){const{padding:a,color:s,fontFamily:c,fontSize:l,background:d,textBoxBorderRadius:u,textBoxMargin:f}=o;let h;const[g,p]=[i[0]+a,i[1]+a],v={color:d,textBoxBorderRadius:u,textBoxMargin:f},w="http://www.w3.org/2000/svg",m=us(e,"text",r),y=t.getSvgNode(m);if(y){const C=y.querySelector("text"),x=Array.from(C.children);for(let _=0;_<x.length;_++){const E=x[_],D=n[_]||"";E.textContent=D}if(n.length>x.length){for(let _=0;_<n.length-x.length;_++){const E=n[_+x.length],D=OT(E);C.appendChild(D)}y.appendChild(C),t.appendNode(y,m)}const S={fill:s,"font-size":l,"font-family":c},T={transform:`translate(${g} ${p})`};xo(S,C),xo(T,y),y.setAttribute("data-annotation-uid",e),h=PT(y,v),t.setNodeTouched(m)}else{const C=document.createElementNS(w,"g");C.setAttribute("data-annotation-uid",e),C.setAttribute("transform",`translate(${g} ${p})`);const x=Fee(t,o);for(let S=0;S<n.length;S++){const T=n[S],_=OT(T);x.appendChild(_)}C.appendChild(x),t.appendNode(C,m),h=PT(C,v)}return Object.assign({},h,{x:g,y:p,height:h.height+a,width:h.width+a})}function Fee(t,e){const{color:r,fontFamily:n,fontSize:i}=e,a=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,l=`${s}${c}`;return a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("fill",r),a.setAttribute("font-family",n),a.setAttribute("font-size",i),a.setAttribute("style",l),a.setAttribute("pointer-events","visible"),a}function OT(t){const r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttribute("x","0"),r.setAttribute("dy","1.2em"),r.textContent=t,r}function PT(t,e){const{color:r,textBoxBorderRadius:n=0,textBoxMargin:i=0}=e;let o=t.querySelector("rect.background");const a=t.querySelector("text").getBBox();if(!r)return o&&t.removeChild(o),t.getBBox();o||(o=document.createElementNS("http://www.w3.org/2000/svg","rect"),o.setAttribute("class","background"),t.insertBefore(o,t.firstChild));const s=t.getBBox(),c={x:`${s.x}`,y:`${s.y}`,width:`${a.width+Number(i)*2}`,height:`${a.height+Number(i)*2}`,fill:r,rx:n,ry:n};return i&&Array.from(t.querySelector("text").querySelectorAll("tspan")).forEach((d,u)=>{u===0&&d.setAttribute("y",i),d.setAttribute("x",i)}),xo(c,o),s}function Uee(t,e,r,n,i,o,a={}){const s=n.length>0?Dy(n,i):i,c=Bee(o),l=Dy(c,s),d=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},a);qt(t,e,`link-${r}`,s,l,d)}function Bee(t){const{x:e,y:r,height:n,width:i}=t,o=i/2,a=n/2,s=[e+o,r],c=[e,r+a],l=[e+o,r+n],d=[e+i,r+a];return[s,c,l,d]}function gi(t,e,r,n,i,o,a,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),l=ac(t,e,r,n,i,c);return Uee(t,e,r,o,i,l,c),l}function TC(t,e,r,n,i={},o=""){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),d=c||s,u="http://www.w3.org/2000/svg",f=us(e,"rect",r),h=t.getSvgNode(f),[g,p,v,w]=n,m=Math.hypot(g[0]-p[0],g[1]-p[1]),y=Math.hypot(g[0]-v[0],g[1]-v[1]),C=[(w[0]+g[0])/2,(w[1]+g[1])/2],x=[(v[0]+g[0])/2,(v[1]+g[1])/2],S=Math.atan2(C[1]-x[1],C[0]-x[0])*180/Math.PI,T={x:`${C[0]-m/2}`,y:`${C[1]-y/2}`,width:`${m}`,height:`${y}`,stroke:a,fill:"transparent",transform:`rotate(${S} ${C[0]} ${C[1]})`,"stroke-width":d,"stroke-dasharray":l};if(h)xo(T,h),t.setNodeTouched(f);else{const _=document.createElementNS(u,"rect");o!==""&&_.setAttribute("data-id",o),ds(T,_),t.appendNode(_,f)}}function zh(t,e,r,n,i,o={},a=""){const s=[n[0],n[1]],c=[i[0],n[1]],l=[n[0],i[1]],d=[i[0],i[1]];TC(t,e,r,[s,c,l,d],o,a)}const RT="http://www.w3.org/2000/svg";function c1(t,e,r,n,i,o={}){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{viaMarker:a=!1,color:s="rgb(0, 255, 0)",markerSize:c=10}=o;if(!a){Gee(t,e,r,n,i,o);return}const l=t.svgLayerElement.id,u=`${`arrow-${e}`}-${l}`,f=t.svgLayerElement.querySelector("defs");let h=f.querySelector(`#${u}`);if(h){h.setAttribute("markerWidth",`${c}`),h.setAttribute("markerHeight",`${c}`);const g=h.querySelector("path");g&&g.setAttribute("fill",s)}else{h=document.createElementNS(RT,"marker"),h.setAttribute("id",u),h.setAttribute("viewBox","0 0 10 10"),h.setAttribute("refX","8"),h.setAttribute("refY","5"),h.setAttribute("markerWidth",`${c}`),h.setAttribute("markerHeight",`${c}`),h.setAttribute("orient","auto");const g=document.createElementNS(RT,"path");g.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),g.setAttribute("fill",s),h.appendChild(g),f.appendChild(h)}o.markerEndId=u,qt(t,e,r,n,i,o)}function Gee(t,e,r,n,i,o={}){const{color:a="rgb(0, 255, 0)",width:s=2,lineWidth:c,lineDash:l}=o,d=10,u=Math.atan2(i[1]-n[1],i[0]-n[0]),f={start:[i[0]-d*Math.cos(u-Math.PI/7),i[1]-d*Math.sin(u-Math.PI/7)],end:i},h={start:[i[0]-d*Math.cos(u+Math.PI/7),i[1]-d*Math.sin(u+Math.PI/7)],end:i};qt(t,e,r,n,i,{color:a,width:s,lineWidth:c,lineDash:l}),qt(t,e,"2",f.start,f.end,{color:a,width:s,lineWidth:c,lineDash:l}),qt(t,e,"3",h.start,h.end,{color:a,width:s,lineWidth:c,lineDash:l})}function t7(t,e,r,n,i,o={}){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),d=c||s,u="http://www.w3.org/2000/svg",f=us(e,"rect",r),h=t.getSvgNode(f),g=[Math.min(n[0],i[0]),Math.min(n[1],i[1])],p=Math.abs(n[0]-i[0]),v=Math.abs(n[1]-i[1]),w={x:`${g[0]}`,y:`${g[1]}`,width:`${p}`,height:`${v}`,stroke:a,fill:"black","stroke-width":d,"stroke-dasharray":l};if(h)xo(w,h),t.setNodeTouched(f);else{const m=document.createElementNS(u,"rect");ds(w,m),t.appendNode(m,f)}}const Wee=Object.freeze(Object.defineProperty({__proto__:null,draw:Q9,drawArrow:c1,drawCircle:hi,drawEllipse:Vee,drawEllipseByCoordinates:SC,drawFan:My,drawHandle:s1,drawHandles:kn,drawHeight:e7,drawLine:qt,drawLinkedTextBox:gi,drawPath:Js,drawPolyline:jo,drawRect:zh,drawRectByCoordinates:TC,drawRedactionRect:t7,drawTextBox:ac,setAttributesIfNecessary:xo,setNewAttributesIfValid:ds},Symbol.toStringTag,{value:"Module"}));function n7(t,e){const r=Ce(t),{renderingEngineId:n,viewportId:i}=r,o=Qn(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],d=o.toolOptions[l];if(d&&e.includes(d.mode)){const u=o.getToolInstance(l);a.push(u)}}return a}const{Active:$ee,Passive:zee,Enabled:jee}=Cn;class Hee{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let r=0;r<e.length;r++){const n=e[r];if(this._needsRender.has(n)&&(this._triggerRender(n),this._needsRender.delete(n),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,r){this._viewportElements.set(e,r)}removeViewportElement(e,r){this._viewportElements.delete(e),this._needsRender.delete(r),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(r=>{this._needsRender.add(r)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const r=[...this._viewportElements.values()];e.forEach(n=>{r.indexOf(n)!==-1&&this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const r=Ce(e);if(!r)return;if(!Fn(r.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=n7(e,[$ee,zee,jee]),{renderingEngineId:o,viewportId:a}=r,s={element:e,renderingEngineId:o,viewportId:a};Q9(e,c=>{let l=!1;const d=u=>{if(u.renderAnnotation){const f=u.renderAnnotation(r,c);l=l||f}};i.forEach(d),l&&Ye(e,V.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const _C=new Hee;function hd(t){_C.renderViewport(t)}function Me(t){t.length&&t.forEach(e=>{const r=wn(e);if(!r){console.warn(`Viewport not available for ${e}`);return}const{viewport:n}=r;if(!n){console.warn(`Viewport not available for ${e}`);return}const i=n.element;hd(i)})}function r7(t,e){const r=t.length,n=[];for(let i=0;i<r;i++){const o=t[i];o.getFrameOfReferenceUID()===e&&n.push(o)}return n}const{Active:Xee,Passive:Kee,Enabled:qee}=Cn;function Tm(t,e){const r=t.length,n=[];for(let i=0;i<r;i++){const o=t[i],a=Qn(o.id,o.renderingEngineId);if(!a)continue;Yee(a,e)&&n.push(o)}return n}function Yee(t,e){const{toolOptions:r}=t,n=r[e];if(!n)return!1;const i=n.mode;return i===Xee||i===Kee||i===qee}function i7(t,e,r=.999){return t.filter(n=>{const i=n.getCamera();return Math.abs(ft(i.viewPlaneNormal,e.viewPlaneNormal))>r})}function vt(t,e,r=!0){const n=Ce(t),{renderingEngine:i,FrameOfReferenceUID:o}=n;let a=i.getViewports();a=r7(a,o),a=Tm(a,e);const s=i.getViewport(n.viewportId);return r&&(a=i7(a,s.getCamera())),a.map(l=>l.id)}const Jee=Object.freeze(Object.defineProperty({__proto__:null,filterViewportsWithFrameOfReferenceUID:r7,filterViewportsWithParallelNormals:i7,filterViewportsWithToolEnabled:Tm,getViewportIdsWithToolToRender:vt},Symbol.toStringTag,{value:"Module"})),AT=1e-10,l1="PlanarFreehandContourSegmentationTool";function So(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}function o7(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.canvasToWorld(t[i]);return n}function jh(t,e){const r=gl(t),n=gl(e);if(!vC(r,n))return{hasIntersection:!1,isContourHole:!1};const o=Cm(t,e),a=!o&&Uu(e,t);return{hasIntersection:o||a,isContourHole:a}}function a7(t,e){return Fh(e).map(r=>{const n=r,i=So(n.data.contour.polyline,t);return{annotation:n,polyline:i}})}function _m(t,e,r){kh(e,r),va(r);const{contour:n}=r.data,i=So(n.polyline,t);Sa(r,{points:i,closed:n.closed,targetWindingDirection:e.data.contour.windingDirection===Wi.Clockwise?Wi.CounterClockwise:Wi.Clockwise},t);const{element:o}=t;bC(t,[e,r])}function EC(t,e,r,n,i){if(!dm(l1)){console.warn(`${l1} is not registered in cornerstone. Cannot combine polylines.`);return}const o=i[0],a=Di(r,o),s=a7(t,e),c=new Set(s),l=new Map,d=(m,y)=>{let C=l.get(m);C||(C=[],l.set(m,C)),C.push(y),c.delete(y)},u=[];if(a){const m=xm(r,i);u.push(m),Array.from(c.keys()).forEach(y=>d(m,y))}else wm(r,i).forEach(y=>{u.push(y),Array.from(c.keys()).forEach(C=>{Uu(y,C.polyline)&&d(y,C)})});Array.from(l.values()).forEach(m=>m.forEach(y=>ud(y.annotation)));const{element:f}=t,{metadata:h,data:g}=e,{handles:p,segmentation:v}=g,{textBox:w}=p;kt(n.annotationUID),kt(e.annotationUID),va(n),va(e);for(let m=0;m<u.length;m++){const y=u[m];if(!y||y.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",y);continue}const C=s7(t,e,y);Ft(C,f),ic(C),Gt(C,t.element),l.get(y)?.forEach(x=>kh(C,x.annotation))}bC(t,[e,n])}function s7(t,e,r){const n=t.canvasToWorld(r[0]),i=t.canvasToWorld(r[r.length-1]),o={metadata:{...e.metadata,toolName:l1,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[n,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:cn(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Sa(o,{points:r,closed:!0,targetWindingDirection:Wi.Clockwise},t),o}function bC(t,e){const{element:r}=t,n=new Set([l1]);e.forEach(i=>{n.add(i.metadata.toolName)});for(const i of n.values())if(dm(i)){const o=vt(r,i);Me(o)}}function DC(t){if(!t||t.length<2)return t;const e=[t[0]];for(let r=1;r<t.length;r++){const n=t[r],i=e[e.length-1],o=Math.abs(n[0]-i[0]),a=Math.abs(n[1]-i[1]);(o>AT||a>AT)&&e.push(n)}return e}function IC(t){const e=[],r=new Set;for(let n of t){if(!n||n.length<3||(n=DC(n),n.length<3))continue;const o=[...n].sort((a,s)=>a[0]!==s[0]?a[0]-s[0]:a[1]-s[1]).map(a=>`${a[0].toFixed(6)},${a[1].toFixed(6)}`).join("|");r.has(o)||(r.add(o),e.push(n))}return e}const Zee="PlanarFreehandContourSegmentationTool";function Qee(t,e,r,n,i){return n.forEach(({polyline:o,viewReference:a})=>{if(o.length<3)return;const s={annotationUID:cn(),data:{contour:{closed:!0,polyline:o},segmentation:{segmentationId:r,segmentIndex:i},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:Zee,...a}};Ft(s,t.element);const c=e?.get(i)||new Set;c.add(s.annotationUID),e.set(i,c)}),e}function sh(t){const{metadata:e}=t;if(!e)return{};const{FrameOfReferenceUID:r,referencedImageId:n,referencedImageURI:i,multiSliceReference:o,cameraFocalPoint:a,viewPlaneNormal:s,viewUp:c,sliceIndex:l,volumeId:d,bounds:u}=e;return{FrameOfReferenceUID:r,referencedImageId:n,referencedImageURI:i,multiSliceReference:o,cameraFocalPoint:a,viewPlaneNormal:s,viewUp:c,sliceIndex:l,volumeId:d,bounds:u}}function Em(t,e){if(!t||!e||t.FrameOfReferenceUID!==e.FrameOfReferenceUID||t.referencedImageId!==e.referencedImageId||!t.viewPlaneNormal||!e.viewPlaneNormal||t.viewPlaneNormal.length!==e.viewPlaneNormal.length)return!1;for(let r=0;r<t.viewPlaneNormal.length;r++)if(t.viewPlaneNormal[r]!==e.viewPlaneNormal[r])return!1;return!0}function ch(t,e){const r=[],n=new Set,i=new Set;for(let o=0;o<t.length;o++){if(n.has(o))continue;const a=t[o];let s=!1;for(let c=0;c<e.length;c++){if(i.has(c))continue;const l=e[c];if(!Em(a.viewReference,l.viewReference))continue;if(fd(a.polyline,l.polyline)){r.push(a),n.add(o),i.add(c),s=!0;break}const d=jh(a.polyline,l.polyline);if(d.hasIntersection&&!d.isContourHole){const u=xm(a.polyline,l.polyline);r.push({polyline:u,viewReference:a.viewReference}),n.add(o),i.add(c),s=!0;break}}s||(r.push(a),n.add(o))}for(let o=0;o<e.length;o++)i.has(o)||r.push(e[o]);return r}function ete(t){if(t.length===0)return[];if(t.length===1)return[...t[0]];let e=[...t[0]];for(let r=1;r<t.length;r++)e=ch(e,t[r]);return e}function tte(t,e,r){const n=t.map(o=>({polyline:So(o.data.contour.polyline,r),viewReference:sh(o)})),i=e.map(o=>({polyline:So(o.data.contour.polyline,r),viewReference:sh(o)}));return ch(n,i)}function H0(t,e){const r=[];for(let n=0;n<t.length;n++){let i=[t[n]];for(let o=0;o<e.length;o++){const a=e[o],s=[];for(const c of i){if(!Em(c.viewReference,a.viewReference)){s.push(c);continue}if(fd(c.polyline,a.polyline))continue;const l=jh(c.polyline,a.polyline);if(l.hasIntersection&&!l.isContourHole){const d=IC(wm(c.polyline,a.polyline));for(const u of d){const f=DC(u);f.length>=3&&s.push({polyline:f,viewReference:c.viewReference})}}else s.push({polyline:c.polyline,viewReference:c.viewReference})}i=s}r.push(...i)}return r}function nte(t,e){if(e.length===0)return[...t];let r=[...t];for(let n=0;n<e.length;n++)r=H0(r,e[n]);return r}function rte(t,e,r){const n=t.map(o=>({polyline:So(o.data.contour.polyline,r),viewReference:sh(o)})),i=e.map(o=>({polyline:So(o.data.contour.polyline,r),viewReference:sh(o)}));return H0(n,i)}function c7(t,e){if(!t.length||!e.length)return[];const r=[];for(const n of t)for(const i of e){if(!Em(n.viewReference,i.viewReference))continue;if(fd(n.polyline,i.polyline)){r.push({...n});continue}const o=jh(n.polyline,i.polyline);if(o.hasIntersection&&!o.isContourHole){const a=IC(X9(n.polyline,i.polyline));a&&a.length>0&&a.forEach(s=>{r.push({polyline:s,viewReference:n.viewReference})})}}return r}function l7(t,e){if(!t.length&&!e.length)return[];if(!t.length)return e;if(!e.length)return t;if(t.length===e.length){let o=!0;for(let a=0;a<t.length;a++){let s=!1;for(let c=0;c<e.length;c++)if(Em(t[a].viewReference,e[c].viewReference)&&fd(t[a].polyline,e[c].polyline)){s=!0;break}if(!s){o=!1;break}}if(o)return[]}const r=H0(t,e),n=H0(e,t);return[...r,...n]}var fa;(function(t){t[t.Union=0]="Union",t[t.Subtract=1]="Subtract",t[t.Intersect=2]="Intersect",t[t.XOR=3]="XOR",t[t.Copy=4]="Copy",t[t.Delete=5]="Delete"})(fa||(fa={}));function LT(t,e){const r=[],{annotationUIDsMap:n}=t||{};if(!n?.has(e))return;const i=n.get(e);for(const o of i){const a=fn(o),{polyline:s}=a.data.contour;r.push({polyline:s,viewReference:sh(a)})}return r}function ite(t,e,r){const n=Ut(e.segmentationId),i=Ut(r.segmentationId);if(!n||!i||!n.representationData.Contour||!i.representationData.Contour)return;const o=LT(n.representationData.Contour,e.segmentIndex),a=LT(i.representationData.Contour,r.segmentIndex);if(!o||!a)return;const s=o.map(({polyline:l,viewReference:d})=>({polyline:So(l,t),viewReference:d})),c=a.map(({polyline:l,viewReference:d})=>({polyline:So(l,t),viewReference:d}));return{polyLinesInfoCanvas1:s,polyLinesInfoCanvas2:c}}function ote(t,{segmentIndex:e,label:r,color:n}){if(!t?.segments)return;const i=t.segments[e]??{active:!1,locked:!1,segmentIndex:e,cachedStats:{},label:r,color:n};r!==void 0&&(i.label=r),n!==void 0&&(i.color=n),t.segments[e]=i}function u7(t){t.forEach(e=>{const r=fn(e);kt(e),va(r)}),t.clear()}function bm(t,e,r,n){const i=pC(t.segmentationId);if(!i)return;const{polyLinesInfoCanvas1:o,polyLinesInfoCanvas2:a}=ite(i,t,e)||{};if(!o||!a)return;let s;switch(n){case fa.Union:s=ch(o,a);break;case fa.Subtract:s=H0(o,a);break;case fa.Intersect:s=c7(o,a);break;case fa.XOR:s=l7(o,a);break;default:s=ch(o,a);break}const c=s.map(({polyline:v,viewReference:w})=>({polyline:o7(v,i),viewReference:w})),l=r,d=Ut(l.segmentationId),u=l.segmentIndex,f=l.color,h=l.label,g=d.representationData.Contour,{annotationUIDsMap:p}=g;if(p){if(t.segmentationId===l.segmentationId&&t.segmentIndex===u){const v=p.get(u);v&&u7(v)}Qee(i,p,d.segmentationId,c,u),ote(d,{segmentIndex:u,color:f,label:h})}}function ate(t,e,r){bm(t,e,r,fa.Union)}function ste(t,e,r){bm(t,e,r,fa.Subtract)}function cte(t,e,r){bm(t,e,r,fa.Intersect)}function lte(t,e,r){bm(t,e,r,fa.XOR)}function ute(t,e){U9(t.segmentationId,t.segmentIndex,e.segmentationId,e.segmentIndex)}function dte(t){const e=Ut(t.segmentationId);if(!e){console.log("No active segmentation detected");return}if(!e.representationData.Contour){console.log("No contour representation found");return}const r=e.representationData.Contour,{annotationUIDsMap:n}=r;if(!n){console.log("No annotation map found");return}if(!n.has(t.segmentIndex)){console.log("Segmentation index has no annotations");return}const i=n.get(t.segmentIndex);u7(i)}function gd(t){return!!t.data?.segmentation}function d7(t,e,r){const n=[],i=gl(e);for(let o=0;o<r.length;o++){const a=r[o],s=fte(a.data.contour.polyline,t),c=gl(s);if(!vC(i,c))continue;const d=Cm(e,s),u=!d&&Uu(s,e);(d||u)&&n.push({targetAnnotation:a,targetPolyline:s,isContourHole:u})}return n}function fte(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}const u1="PlanarFreehandContourSegmentationTool";function f7(t,e,r,n){const i=n.filter(a=>a.isContourHole),o=n.filter(a=>!a.isContourHole);if(i.length>0){const a=i[0];vte(t,a.targetAnnotation,e),h7(t,[e,a.targetAnnotation]);return}if(o.length!==0){if(!dm(u1)){console.warn(`${u1} is not registered in cornerstone. Cannot process multiple intersections.`);return}hte(t,e,r,o)}}function hte(t,e,r,n){const{element:i}=t,o=[e],a=[],s=[];n.forEach(({targetAnnotation:f})=>{const h=mte(t,f);s.push(...h),o.push(f)});const c=r[0];if(n.some(({targetPolyline:f})=>Di(f,c))){let f=r;n.forEach(({targetPolyline:h})=>{f=xm(f,h)}),a.push(f)}else n.forEach(({targetPolyline:f})=>{const h=wm(f,r);a.push(...h)});o.forEach(f=>{kt(f.annotationUID),va(f)}),s.forEach(f=>ud(f.annotation));const d=n[0].targetAnnotation,u=[];a.forEach(f=>{if(!f||f.length<3){console.warn("Skipping creation of new annotation due to invalid polyline:",f);return}const h=gte(t,d,f);Ft(h,i),ic(h),Gt(h,t.element),u.push(h)}),pte(t,s,u),h7(t,o)}function gte(t,e,r){const n=t.canvasToWorld(r[0]),i=t.canvasToWorld(r[r.length-1]),o={metadata:{...e.metadata,toolName:u1,originalToolName:e.metadata.originalToolName||e.metadata.toolName},data:{cachedStats:{},handles:{points:[n,i],textBox:e.data.handles.textBox?{...e.data.handles.textBox}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...e.data.segmentation}},annotationUID:cn(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};return Sa(o,{points:r,closed:!0,targetWindingDirection:Wi.Clockwise},t),o}function pte(t,e,r){e.forEach(n=>{const i=r.find(o=>{const a=MC(o.data.contour.polyline,t);return Uu(a,n.polyline)});i&&kh(i,n.annotation)})}function mte(t,e){return Fh(e).map(r=>{const n=r,i=MC(n.data.contour.polyline,t);return{annotation:n,polyline:i}})}function vte(t,e,r){kh(e,r),va(r);const{contour:n}=r.data,i=MC(n.polyline,t);Sa(r,{points:i,closed:n.closed,targetWindingDirection:e.data.contour.windingDirection===Wi.Clockwise?Wi.CounterClockwise:Wi.Clockwise},t)}function MC(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}function h7(t,e){const{element:r}=t,n=new Set([u1]);e.forEach(i=>{n.add(i.metadata.toolName)});for(const i of n.values())if(dm(i)){const o=vt(r,i);Me(o)}}const{isEqual:NT}=hn;function OC(t){const{metadata:e}=t;return iJ().filter(r=>{if(r.FrameOfReferenceUID===e.FrameOfReferenceUID){const n=r.viewport,{viewPlaneNormal:i,viewUp:o}=n.getCamera();return NT(i,e.viewPlaneNormal)&&(!e.viewUp||NT(o,e.viewUp))}}).map(r=>r.viewport)}async function yte(t,e,r,n=!0){const i=typeof t=="string"?fn(t):t,o=typeof e=="string"?fn(e):e;if(!i||!o)throw new Error("Both source and target annotations must be valid");r||(r=wte(i));const a=So(i.data.contour.polyline,r),s=So(o.data.contour.polyline,r),c=jh(a,s);if(!c.hasIntersection){console.warn("No intersection found between the two annotations");return}if(c.isContourHole){if(!n){console.warn("Hole processing is disabled");return}_m(r,o,i)}else EC(r,o,s,i,a)}function wte(t){const e=OC(t);if(!e.length)throw new Error("No viewport found for the annotation");return e[0]}const Cte=Object.freeze(Object.defineProperty({__proto__:null,get LogicalOperation(){return fa},add:ate,addContourSegmentationAnnotation:ic,areSameSegment:T9,checkIntersection:jh,cleanupPolylines:IC,combinePolylines:EC,contourSegmentationOperation:yte,convertContourPolylineToCanvasSpace:So,convertContourPolylineToWorld:o7,convertContourSegmentationAnnotation:hC,copy:ute,copyAnnotation:F9,copyContourSegment:U9,createNewAnnotationFromPolyline:s7,createPolylineHole:_m,deleteOperation:dte,findAllIntersectingContours:d7,getContourHolesData:a7,intersect:cte,intersectPolylinesSets:c7,isContourSegmentationAnnotation:gd,processMultipleIntersections:f7,removeContourSegmentationAnnotation:va,removeDuplicatePoints:DC,subtract:ste,subtractAnnotationPolylines:rte,subtractMultiplePolylineSets:nte,subtractPolylineSets:H0,unifyAnnotationPolylines:tte,unifyMultiplePolylineSets:ete,unifyPolylineSets:ch,updateViewportsForAnnotations:bC,xor:lte,xorPolylinesSets:l7},Symbol.toStringTag,{value:"Module"}));function xte(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==xp.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function Ste(t,e,r,n){r.size?t.render():Tte(t,e,n)}function Tte(t,e,r){const{segmentationId:n}=r,i=new Map;e.forEach(o=>{const a=Ne.getGeometry(o);if(!a){console.warn(`No geometry found for geometryId ${o}. Skipping render.`);return}const s=a.data.segmentIndex;xte(a);const c=Zi.getStyle({viewportId:t.id,segmentationId:n,type:yt.Contour,segmentIndex:s}),l=a.data,d=t.getCamera().viewPlaneNormal;l.contours.forEach(u=>{const{points:f,color:h,id:g}=u,p=uC(t,f[0],d),v={annotationUID:cn(),data:{contour:{closed:!0,polyline:f},segmentation:{segmentationId:n,segmentIndex:s,color:h,id:g},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:p,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},w=t.element;Ft(v,w),ic(v)}),c&&i.set(s,c)}),t.render()}function g7(t){const e=cQ(t);if(e)return e;const r=Ut(t);if(!r)throw new Error(`No segmentation found for segmentationId ${t}`);let n;if(r.representationData.Labelmap)n=_te(r,t);else if(r.representationData.Contour)n=Dte(r);else if(r.representationData.Surface)n=Ite(r);else throw new Error(`Unsupported segmentation type: ${r.representationData}`);return lQ(t,n),n}function _te(t,e){const r=t.representationData[yt.Labelmap],n=new Set;return r.imageIds?bte(n,r.imageIds):Ete(n,e),Array.from(n).map(Number).sort((i,o)=>i-o)}function Ete(t,e){Ne.getVolume(e).voxelManager.forEach(({value:n})=>{n!==0&&t.add(n)})}function bte(t,e){e.forEach(r=>{Ne.getImage(r).voxelManager.getScalarData().forEach(o=>{o!==0&&t.add(o)})})}function Dte(t){const{annotationUIDsMap:e,geometryIds:r}=t.representationData.Contour||{};if(!r)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const n=new Set([...e.keys()]);return r.forEach(i=>{const o=Ne.getGeometry(i);n.add(o.data.segmentIndex)}),Array.from(n).sort((i,o)=>i-o)}function Ite(t){const e=t.representationData.Surface?.geometryIds??[];return Array.from(e.keys()).map(Number).sort((r,n)=>r-n)}const Qu=new Map,VT=new Map;function Mte(t,e,r=!1){const n=wn(t);if(!n)return;const{viewport:i}=n;r&&i.render()}async function Ote(t,e){const{segmentationId:r}=e,n=Ut(r);if(!n)return;let i=n.representationData[yt.Contour];const o=Za();if(!i&&Za()?.canComputeRequestedRepresentation(r,yt.Contour)&&!Qu.get(t.id)?(Qu.set(t.id,!0),i=await sC(r,yt.Contour,()=>o.computeContourData(r,{viewport:t})),Qu.set(t.id,!1)):!i&&!Za()&&console.debug(`No contour data found for segmentationId ${r} and PolySeg add-on is not configured. Unable to convert from other representations to contour. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`),!i||!i.geometryIds?.length)return;let a=!1;const s=t.getCamera().viewPlaneNormal;i.annotationUIDsMap&&(a=!Rte(i.annotationUIDsMap,s)),i.geometryIds.length>0&&(a=!Pte(i.geometryIds,s));const c=VT.get(t.id)||new Set;if(a&&!Qu.get(t.id)&&!c.has(r)&&t.viewportStatus===_i.RENDERED){Qu.set(t.id,!0);const l=g7(r),u=(await o.computeSurfaceData(r,{segmentIndices:l,viewport:t})).geometryIds,f=[];for(const v of u.values()){const m=Ne.getGeometry(v).data;f.push({points:m.points,polys:m.polys,segmentIndex:m.segmentIndex,id:m.segmentIndex})}const h=await o.clipAndCacheSurfacesForViewport(f,t),g=o.extractContourData(h),p=o.createAndAddContourSegmentationsFromClippedSurfaces(g,t,r);i.annotationUIDsMap=new Map([...i.annotationUIDsMap,...p]),c.add(r),VT.set(t.id,c),Qu.set(t.id,!1)}Ste(t,i.geometryIds,i.annotationUIDsMap,e)}function Pte(t,e){let r=null,n=null;for(const d of t){const u=Ne.getGeometry(d);if(!u)continue;const f=u.data;if(f.contours?.[0]?.points?.length>=3){r=u,n=f;break}}if(!r||!n)return!1;const i=n.contours,{points:o}=i[0],[a]=o,s=Ie(),{length:c}=o,l=Math.ceil(c/25);for(let d=1;d<c;d+=l){const u=o[d];if(rn(s,a,u),Lt(s,s),ft(e,s)>.1)return!1}return!0}function Rte(t,e){const r=Array.from(t.values()).flat().map(i=>Array.from(i)).flat(),n=jw(r,3);for(const i of n){const o=fn(i);if(o?.metadata){if(!o.metadata.viewPlaneNormal)continue;const a=o.metadata.viewPlaneNormal,s=Math.abs(e[0]*a[0]+e[1]*a[1]+e[2]*a[2]);if(Math.abs(s-1)>.01)return!1}}return!0}function Ate(t){return null}const PC={getUpdateFunction:Ate,render:Ote,removeRepresentation:Mte};function wl(t,e){const r=sc(t,e);if(r?.length)return r[0]}function sc(t,e){return On.getCurrentLabelmapImageIdsForViewport(t,e)}function Lte(t,e){return On.getLabelmapImageIdsForImageId(t,e)}const kT=new Map,Nte=({cfun:t,ofun:e,actor:r})=>{r.getProperty().setRGBTransferFunction(1,t),r.getProperty().setScalarOpacity(1,e)};async function Vte({viewport:t,volumeInputs:e,segmentationId:r}){const n=t.getDefaultActor(),{actor:i}=n,{uid:o,callback:a}=n,s=t.getVolumeId();if(kT.get(o)?.added)return{uid:o,actor:i};const c=e,l=Ne.getVolume(c[0].volumeId);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{volumeId:d}=c[0],u=await uD(d);if(!u)throw new Error(`segImageVolume with id: ${u.volumeId} does not exist`);const h=u.voxelManager.getCompleteScalarDataArray(),{imageData:g}=u,p=Ne.getVolume(s),w=p.voxelManager.getCompleteScalarDataArray(),m=2,y=new Float32Array(m*p.voxelManager.getScalarDataLength()),C=g.getDimensions();for(let E=0;E<C[2];++E)for(let D=0;D<C[1];++D)for(let b=0;b<C[0];++b){const I=b+C[0]*(D+C[1]*E);y[I*m+0]=w[I],y[I*m+1]=h[I]}t.removeActors([o]);const x=i.getMapper(),S=OX(x);i.setMapper(S),S.setBlendMode(Ka.LABELMAP_EDGE_PROJECTION_BLEND);const T=S.getInputData().getPointData().getArray(0);T.setData(y),T.setNumberOfComponents(2),i.getProperty().setColorMixPreset(1),i.getProperty().setForceNearestInterpolation(1,!0),i.getProperty().setIndependentComponents(!0),t.addActor({actor:i,uid:o,callback:a,referencedId:s,representationUID:`${r}-${yt.Labelmap}`}),kT.set(o,{added:!0,segmentationRepresentationUID:`${r}`,originalBlendMode:t.getBlendMode()}),i.set({preLoad:Nte});function _(E){const{segmentationId:D}=E.detail,{representationData:b}=Ut(D),{volumeId:I}=b.Labelmap;if(I!==u.volumeId)return;const M=Ne.getVolume(I).voxelManager,R=S.getInputData(),A=R.getPointData().getArray(0),G=A.getData(),k=2,L=g.getDimensions(),F=Array.from({length:L[2]},(j,Y)=>Y);for(const j of F)for(let Y=0;Y<L[1];++Y)for(let ie=0;ie<L[0];++ie){const de=ie+L[0]*(Y+L[1]*j);G[de*k+1]=M.getAtIndex(de)}A.setData(G),R.modified(),t.render()}return Fe.addEventListenerDebounced(V.SEGMENTATION_DATA_MODIFIED,_,200),Fe.addEventListener(V.SEGMENTATION_REPRESENTATION_REMOVED,async E=>{Fe.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,_);const D=t.getActor(o),{element:b,id:I}=t;t.removeActors([o]);const O=await uy({volumeId:o,blendMode:Ka.MAXIMUM_INTENSITY_BLEND,callback:({volumeActor:M})=>{D.callback&&D.callback({volumeActor:M,volumeId:d})}},b,I);t.addActor({actor:O,uid:o}),t.render()}),{uid:o,actor:i}}const{uuidv4:p7}=hn;async function kte(t,e,r,n){const i=Ce(t),{renderingEngine:o,viewport:a}=i,{id:s}=a,c=!0,l=!1,d=!0;if(a instanceof Zn){const f=Fte(e,r);Ne.getVolume(f)||await Ute(e);let h=n?.blendMode??Ka.MAXIMUM_INTENSITY_BLEND,g=h===Ka.LABELMAP_EDGE_PROJECTION_BLEND;if(g){const v=a.getVolumeId(),w=Ne.getVolume(v),y=Ne.getVolume(f).dimensions,C=w.dimensions;(y[0]!==C[0]||y[1]!==C[1]||y[2]!==C[2])&&(g=!1,h=Ka.MAXIMUM_INTENSITY_BLEND,console.debug("Dimensions mismatch - falling back to regular volume addition"))}const p=[{volumeId:f,visibility:c,representationUID:`${r}-${yt.Labelmap}`,useIndependentComponents:g,blendMode:h}];if(!p[0].useIndependentComponents)await Dq(o,p,[s],l,d);else return await Vte({viewport:a,volumeInputs:p,segmentationId:r})}else{const f=sc(a.id,r).map(h=>({imageId:h,representationUID:`${r}-${yt.Labelmap}-${h}`}));Iq(o,f,[s])}ei(r)}function Fte(t,e){let{volumeId:r}=t;if(!r){r=p7();const n=Ut(e);n.representationData.Labelmap={...n.representationData.Labelmap,volumeId:r},t.volumeId=r,Ko(e)}return r}async function Ute(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await fD(t.volumeId||p7(),e.imageIds)}function Bte(t,e){const r=Ce(t),{viewport:n}=r;n.removeActors([xQ(n.id,e)])}function Ru(t){return On.getActiveSegmentation(t)}function Gte(t,e){On.setActiveSegmentation(t,e)}function uc(t){return Ru(t)}function Wte(t,e){Gte(t,e)}const $te=Object.freeze(Object.defineProperty({__proto__:null,getActiveSegmentation:uc,setActiveSegmentation:Wte},Symbol.toStringTag,{value:"Module"}));function zi(t){const e=Ut(t);if(e){const r=Object.keys(e.segments).find(n=>e.segments[n].active);return r?Number(r):void 0}}const j2=255,xf=new Map;let H2=!1;function zte(t,e,r=!1){const n=wn(t);if(xf.forEach((o,a)=>{a.includes(e)&&xf.delete(a)}),!n)return;const{viewport:i}=n;Bte(i.element,e),r&&i.render()}async function jte(t,e){const{segmentationId:r,config:n}=e,i=Ut(r);if(!i){console.warn("No segmentation found for segmentationId: ",r);return}let o=i.representationData[yt.Labelmap],a=Cf(t.id,r);if(!o&&Za()?.canComputeRequestedRepresentation(r,yt.Labelmap)&&!H2){H2=!0;const s=Za();if(o=await sC(r,yt.Labelmap,()=>s.computeLabelmapData(r,{viewport:t}),()=>{On.processLabelmapRepresentationAddition(t.id,r),setTimeout(()=>{ei(r)},0)}),!o)throw new Error(`No labelmap data found for segmentationId ${r}.`);H2=!1}else!o&&!Za()&&console.debug(`No labelmap data found for segmentationId ${r} and PolySeg add-on is not configured. Unable to convert from other representations to labelmap. Please register PolySeg using cornerstoneTools.init({ addons: { polySeg } }) to enable automatic conversion.`);if(o){if(t instanceof Gn)a?.length||await UT(t,o,r,n),a=Cf(t.id,r);else{if(!sc(t.id,r)?.length)return;a||await UT(t,o,r,n),a=Cf(t.id,r)}if(a?.length)for(const s of a)Hte(t.id,s,e)}}function Hte(t,e,r){const{segmentationId:n}=r,{cfun:i,ofun:o}=r.config,{colorLUTIndex:a}=r,c=uc(t)?.segmentationId===n,l=Zi.getStyle({viewportId:t,type:yt.Labelmap,segmentationId:n}),d=Zi.getRenderInactiveSegmentations(t),u=Bh(a),f=Math.min(256,u.length),{outlineWidth:h,renderOutline:g,outlineOpacity:p,activeSegmentOutlineWidthDelta:v}=FT(l,c),w=cC(t,{segmentationId:n,type:yt.Labelmap});for(let x=0;x<f;x++){const S=x,T=u[S],E=Zi.getStyle({viewportId:t,type:yt.Labelmap,segmentationId:n,segmentIndex:S}),{fillAlpha:D,outlineWidth:b,renderFill:I,renderOutline:O}=FT(l,c,E),{forceOpacityUpdate:M,forceColorUpdate:R}=Xte(t,n,S,{fillAlpha:D,renderFill:I,renderOutline:O,segmentColor:T,outlineWidth:b,segmentsHidden:w,cfun:i,ofun:o});if(R&&i.addRGBPoint(S,T[0]/j2,T[1]/j2,T[2]/j2),M)if(I){const A=w.has(S)?0:T[3]/255*D;o.removePoint(S),o.addPointLong(S,A,.5,1)}else o.addPointLong(S,.01,.5,1)}o.setClamping(!1);const m=e.actor,{preLoad:y}=m.get?.("preLoad")||{preLoad:null};if(y?y({cfun:i,ofun:o,actor:m}):(m.getProperty().setRGBTransferFunction(0,i),m.getProperty().setScalarOpacity(0,o),m.getProperty().setInterpolationTypeToNearest()),g){m.getProperty().setUseLabelOutline(g),m.getProperty().setLabelOutlineOpacity(p);const x=zi(r.segmentationId),S=new Array(f-1);for(let T=1;T<f;T++){if(w.has(T)){S[T-1]=0;continue}S[T-1]=T===x?h+v:h}m.getProperty().setLabelOutlineThickness(S),m.modified(),m.getProperty().modified(),m.getMapper().modified()}else m.getProperty().setLabelOutlineThickness(new Array(f-1).fill(0));const C=c||d;m.setVisibility(C)}function FT(t,e,r){const i={...t,...r||{}},o=e?i.fillAlpha:i.fillAlphaInactive,a=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,l=e?i.outlineOpacity:i.outlineOpacityInactive,d=i.activeSegmentOutlineWidthDelta;return{fillAlpha:o,outlineWidth:a,renderFill:s,renderOutline:c,outlineOpacity:l,activeSegmentOutlineWidthDelta:d}}function Xte(t,e,r,{fillAlpha:n,renderFill:i,renderOutline:o,segmentColor:a,outlineWidth:s,segmentsHidden:c,cfun:l,ofun:d}){const u=`${t}-${e}-${r}`,f=xf.get(u);if(!f)return xf.set(u,{fillAlpha:n,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:d.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:h,renderFill:g,renderOutline:p,outlineWidth:v,segmentColor:w,segmentsHidden:m,cfunMTime:y,ofunMTime:C}=f,x=w[0]!==a[0]||w[1]!==a[1]||w[2]!==a[2],S=w[3]!==a[3]||h!==n||g!==i||p!==o||v!==s||m!==c;return(S||x)&&xf.set(u,{fillAlpha:n,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:d.getMTime()}),{forceOpacityUpdate:S,forceColorUpdate:x}}async function UT(t,e,r,n){return await kte(t.element,e,r,n)||void 0}function Kte(t){}const RC={getUpdateFunction:Kte,render:jte,removeRepresentation:zte},{CalibrationTypes:nu}=To,X2="px",BT="voxels",m7=[1,2,3,4],qte=["4,3","4,7"],Oy={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},K2="",Yte=[nu.ERMF,nu.USER,nu.ERROR,nu.PROJECTION,nu.CALIBRATED,nu.UNKNOWN],_o=(t,e)=>{const{calibration:r,hasPixelSpacing:n,spacing:i=[1,1,1]}=t;let o=n?"mm":X2;const a=n?"mm":BT;let s=o+K2;const c=r?.scale||1;let l=c/(r?.columnPixelSpacing||i[0]),d=c/(r?.rowPixelSpacing||i[1]),u=c/i[2],f="";if(!r||!r.type&&!r.sequenceOfUltrasoundRegions)return{unit:o,areaUnit:s,scale:l,scaleY:d,scaleZ:u,volumeUnit:a};if(Yte.includes(r?.type)&&(f=r.type),r.type===nu.UNCALIBRATED)return{unit:X2,areaUnit:X2+K2,scale:l,scaleY:d,scaleZ:u,volumeUnit:BT};if(r.sequenceOfUltrasoundRegions){const h=r.sequenceOfUltrasoundRegions.find(g=>e.every(p=>p[0]>=g.regionLocationMinX0&&p[0]<=g.regionLocationMaxX1&&p[1]>=g.regionLocationMinY0&&p[1]<=g.regionLocationMaxY1)&&m7.includes(g.regionDataType));if(h&&h.physicalUnitsXDirection===h.physicalUnitsYDirection){const g=Math.abs(h.physicalDeltaX),p=Math.abs(h.physicalDeltaY);l=1/g,d=1/p,f="US Region",o=Oy[h.physicalUnitsXDirection]||"unknown",s=o+K2}}else r.scale&&(l=r.scale);return{unit:o+(f?` ${f}`:""),areaUnit:s+(f?` ${f}`:""),volumeUnit:a+(f?` ${f}`:""),scale:l,scaleY:d,scaleZ:u}},d1=(t,e)=>{const[r]=e,{calibration:n}=t;let i=["raw"],o=[null],a="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{units:i,values:o};if(n.sequenceOfUltrasoundRegions){const s=n.sequenceOfUltrasoundRegions.filter(p=>m7.includes(p.regionDataType)&&qte.includes(`${p.physicalUnitsXDirection},${p.physicalUnitsYDirection}`));if(!s?.length)return{units:i,values:o};const c=s.find(p=>r[0]>=p.regionLocationMinX0&&r[0]<=p.regionLocationMaxX1&&r[1]>=p.regionLocationMinY0&&r[1]<=p.regionLocationMaxY1);if(!c)return{units:i,values:o};const{referencePixelX0:l=0,referencePixelY0:d=0}=c,{physicalDeltaX:u,physicalDeltaY:f}=c,h=(r[1]-c.regionLocationMinY0-d)*f,g=(r[0]-c.regionLocationMinX0-l)*u;a="US Region",o=[g,h],i=[Oy[c.physicalUnitsXDirection],Oy[c.physicalUnitsYDirection]]}return{units:i,values:o,calibrationType:a}},AC=t=>t.calibration?.aspect||1,{isEqual:q2}=hn,{EPSILON:Jte}=pl,Zte=1-Jte;function LC(t,e,r){const{viewPlaneNormal:n}=e,i=t.filter(c=>{const{planeRestriction:l,referencedImageId:d}=c.metadata;let{viewPlaneNormal:u}=c.metadata;if(l){const{inPlaneVector1:h,inPlaneVector2:g}=l;return!(h&&!q2(0,ft(n,h))||g&&!q2(0,ft(n,g)))}if(!c.metadata.referencedImageId&&!u&&c.metadata.FrameOfReferenceUID){for(const h of c.data.handles.points){const g=rn(Ie(),h,e.focalPoint),p=ft(g,n);if(!q2(p,0))return!1}return c.metadata.viewPlaneNormal=n,c.metadata.cameraFocalPoint=e.focalPoint,!0}if(!u&&d){const{imageOrientationPatient:h}=ut("imagePlaneModule",d),g=mt(h[0],h[1],h[2]),p=mt(h[3],h[4],h[5]);u=Ie(),tn(u,g,p),c.metadata.viewPlaneNormal=u}const f=Math.abs(ft(n,u))>Zte;return u&&f});if(!i.length)return[];const o=r/2,{focalPoint:a}=e,s=[];for(const c of i){const{data:l,metadata:d,isVisible:u}=c;if(!u)continue;const f=d.planeRestriction?.point||l.handles?.points?.[0]||l.contour?.polyline[0];if(!f){s.push(c);continue}const h=rn(Ie(),a,f);Math.abs(ft(h,n))<o&&s.push(c)}return s}function Dm(t,e,r,n){const i=Ie();tn(i,e,t);const o=mt(...r),a=mt(...n),s=Ie();an(s,o,a);const c=pr(s);if(c<1e-4)return{worldWidth:0,worldHeight:0};const l=ft(s,i)/(c*pr(i)),u=Math.sqrt(1-l*l)*c,f=l*c;return{worldWidth:u,worldHeight:f}}function Hh(t,e,r={}){if(t instanceof Gn){const n=t.getCamera(),{spacingInNormalDirection:i}=ad(t,n);return LC(e,n,i)}if(t instanceof Wn){const n=t.getCurrentImageId();if(!n)return[];const i=n.indexOf(":");r.imageURI=n.substring(i+1)}return e.filter(n=>n.isVisible?n.data.isCanvasAnnotation?!0:t.isReferenceViewable(n.metadata,r):!1)}function Xh(t,e,r,n){const i=Ie();tn(i,e,t);const o=mt(...r),a=mt(...n),s=Ie();an(s,o,a);const c=pr(s);if(c<1e-4)return{worldWidth:0,worldHeight:0};const l=ft(s,i)/(c*pr(i)),u=Math.sqrt(1-l*l)*c,f=l*c;return{worldWidth:u,worldHeight:f}}function NC(t,e,r,n,i=.25){const o=VC(t,e,{targetVolumeId:r,stepSize:i});let a;for(const s of o){const c=t.getIntensityFromWorld(s),l=n(c,s);l&&(a=l)}return a}function VC(t,e,{targetVolumeId:r,stepSize:n}){const i=t.getCamera(),{viewPlaneNormal:o}=i,{spacingInNormalDirection:a}=ad(t,i,r),s=a*n||1,c=t.getBounds(),l=[];let d=[...e];for(;GT(d,c);)l.push([...d]),d[0]+=o[0]*s,d[1]+=o[1]*s,d[2]+=o[2]*s;for(d=[...e];GT(d,c);)l.push([...d]),d[0]-=o[0]*s,d[1]-=o[1]*s,d[2]-=o[2]*s;return l}const GT=function(t,e){const[r,n,i,o,a,s]=e,c=10;return t[0]>r+c&&t[0]<n-c&&t[1]>i+c&&t[1]<o-c&&t[2]>a+c&&t[2]<s-c},v7=(t,e,r,n,i,o,a,s)=>{const c=[mt(r,n,i),mt(o,n,i),mt(r,a,i),mt(o,a,i),mt(r,n,s),mt(o,n,s),mt(r,a,s),mt(o,a,s)],l=mt(e[0],e[1],e[2]),d=mt(t[0],t[1],t[2]),u=-ft(l,d);let f=null;for(const h of c){const g=ft(l,h)+u;if(f===null)f=Math.sign(g);else if(Math.sign(g)!==f)return!0}return!1},{EPSILON:Qte}=pl,ene=1-Qte;function Im(t,e){const{viewPlaneNormal:r}=e,n=t.filter(i=>{let o=i.metadata.viewPlaneNormal;if(!o){const{referencedImageId:s}=i.metadata,{imageOrientationPatient:c}=ut("imagePlaneModule",s),l=mt(c[0],c[1],c[2]),d=mt(c[3],c[4],c[5]);o=Ie(),tn(o,l,d),i.metadata.viewPlaneNormal=o}const a=Math.abs(ft(r,o))>ene;return o&&a});return n.length?n:[]}const tne={filterAnnotationsWithinSlice:LC,getWorldWidthAndHeightFromCorners:Dm,getWorldWidthAndHeightFromTwoPoints:Xh,filterAnnotationsForDisplay:Hh,getPointInLineOfSightWithCriteria:NC,isPlaneIntersectingAABB:v7,filterAnnotationsWithinSamePlane:Im,getPointsInLineOfSight:VC},nne=Object.freeze(Object.defineProperty({__proto__:null,default:tne,filterAnnotationsForDisplay:Hh,filterAnnotationsWithinSamePlane:Im,filterAnnotationsWithinSlice:LC,getPointInLineOfSightWithCriteria:NC,getPointsInLineOfSight:VC,getWorldWidthAndHeightFromCorners:Dm,getWorldWidthAndHeightFromTwoPoints:Xh,isPlaneIntersectingAABB:v7},Symbol.toStringTag,{value:"Module"}));function kC(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function pd(t,e,r){let n,i,o,a,s,c,l=0,d=!1,u=!1,f=!0;const h=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,kC(r)&&(d=!!r.leading,u="maxWait"in r,o=u?Math.max(Number(r.maxWait)||0,e):o,f="trailing"in r?!!r.trailing:f);function g(D){const b=n,I=i;return n=i=void 0,l=D,a=t.apply(I,b),a}function p(D,b){return h?window.requestAnimationFrame(D):setTimeout(D,b)}function v(D){if(h)return window.cancelAnimationFrame(D);clearTimeout(D)}function w(D){return l=D,s=p(C,e),d?g(D):a}function m(D){const b=D-c,I=D-l,O=e-b;return u?Math.min(O,o-I):O}function y(D){const b=D-c,I=D-l;return c===void 0||b>=e||b<0||u&&I>=o}function C(){const D=Date.now();if(y(D))return x(D);s=p(C,m(D))}function x(D){return s=void 0,f&&n?g(D):(n=i=void 0,a)}function S(){s!==void 0&&v(s),l=0,n=c=i=s=void 0}function T(){return s===void 0?a:x(Date.now())}function _(){return s!==void 0}function E(...D){const b=Date.now(),I=y(b);if(n=D,i=this,c=b,I){if(s===void 0)return w(c);if(u)return s=p(C,e),g(c)}return s===void 0&&(s=p(C,e)),a}return E.cancel=S,E.flush=T,E.pending=_,E}function Pi(t,e,r){let n=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return kC(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),pd(t,e,{leading:n,trailing:i,maxWait:e})}function rne(t){return t[0]?.length===3}function ine(t,e){if(!e||e.length===0||e.length===t.length)return t;const r=e[e.length-1]-e[0]+1,n=N2(e.map(o=>t[o][0])),i=N2(e.map(o=>t[o][1]));if(rne(t)){const o=N2(e.map(a=>t[a][2]));return rT(kd(n,r),kd(i,r),kd(o,r))}else return rT(kd(n,r),kd(i,r))}function one(t,e){const r=[],[n,i]=e,o=i-n+1,a=Math.floor(o/t);let s=0,c=Math.round((o-1)/(a-1)*s)+n;for(;c<=i;)r.push(c),s++,c=Math.round((o-1)/(a-1)*s)+n;return r}function f1(t,e,r,n){const i=r-e+1,o=Math.floor(n/100*i)??1,a=Math.floor(i/o)??1;if(isNaN(i)||!i||!a||i/a<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,r),l=t.slice(0,s),d=t.slice(c+1,t.length),u=one(a,[s,c]),f=ine(t,u);return[...l,...f,...d]}function Mm(t,e){return e?.autoGenerated?!1:t?.smoothing?.smoothOnAdd===!0||t?.smoothing?.smoothOnEdit===!0}function ane(t,e){return ls(t,e)<.001}function sne(t,e){return ls(t,e)===0}function cne(t,e){for(let r=0;r<t.length;r++)for(let n=0;n<e.length;n++)if(sne(t[r],e[n]))return[r,n]}function u0(t,e,r){return(t+e+r)%e}function WT(t,e,r,n){const[,i,o]=t,[,a,s]=e,c=o.length,l=s.length;let d=t[0],u=e[0];if(!o[d]||!s[u]||!o[i]||!s[a])return[void 0,void 0];for(;d!==i&&u!==a;){if(r(s[u],o[d]))return[d,u];d=u0(d,c,n),u=u0(u,l,n)}return[void 0,void 0]}function lne(t,e){const[r,n]=cne(t,e)||[],i=(c,l)=>ane(c,l)===!1,[o,a]=WT([u0(r,t.length,1),r,t],[u0(n,e.length,1),n,e],i,1),[s]=WT([u0(o,t.length,-1),o,t],[u0(a,e.length,-1),a,e],i,-1);return[o,s]}function Om(t,e,r){const{interpolation:n,smoothing:i}=t,o=e;if(n){const{knotsRatioPercentageOnAdd:a,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:l=!1}=i,d=r?s:a;if(r?l:c){const[f,h]=r?lne(e,r):[0,e.length-1];return!e[f]||!e[h]?e:f1(e,f,h,d)}}return o}const md=t=>{if(t.shiftKey)return t.ctrlKey?jr.ShiftCtrl:t.altKey?jr.ShiftAlt:t.metaKey?jr.ShiftMeta:jr.Shift;if(t.ctrlKey)return t.altKey?jr.CtrlAlt:t.metaKey?jr.CtrlMeta:jr.Ctrl;if(t.altKey)return t.metaKey&&jr.AltMeta||jr.Alt;if(t.metaKey)return jr.Meta};function FC(t,e){const r=t[0],n=t[t.length-1],i=xt();ko(i,n[0]-r[0],n[1]-r[1]),za(i,i);const o=xt(),a=xt();ko(o,-i[1],i[0]),ko(a,i[1],-i[0]);const s=[(r[0]+n[0])/2,(r[1]+n[1])/2],c={dist:0,index:null};for(let u=0;u<t.length;u++){const f=t[u],h=j5(f,s);h>c.dist&&(c.dist=h,c.index=u)}return[t[c.index],s].map(e.canvasToWorld)}function une(t,e){const{viewport:r}=t,n=e.data.contour.polyline.map(r.worldToCanvas);return FC(n,r)}const{addCanvasPointsToArray:UC,pointsAreWithinCloseContourProximity:y7,getFirstLineSegmentIntersectionIndexes:w7,getSubPixelSpacingAndXYDirections:dne}=yl;function fne(t,e,r){this.isDrawing=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=Ce(o),{viewport:c}=s,l=md(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:d,xDir:u,yDir:f}=dne(c,this.configuration.subPixelResolution)||{};!d||!u||!f||(this.drawData={canvasPoints:[a],polylineIndex:0,contourHoleProcessingEnabled:l,newAnnotation:!0},this.commonData={annotation:e,viewportIdsToRender:r,spacing:d,xDir:u,yDir:f,movingTextBox:!1},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpDrawCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_END,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpDrawCallback),St(o))}function hne(t){Ue.isInteractingWithTool=!1,t.removeEventListener(V.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(V.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(V.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(V.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(V.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(V.TOUCH_TAP,this.mouseUpDrawCallback),Nt(t)}function gne(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=Ce(n),{viewport:s}=a,{annotation:c,viewportIdsToRender:l,xDir:d,yDir:u,spacing:f,movingTextBox:h}=this.commonData,{polylineIndex:g,canvasPoints:p,newAnnotation:v}=this.drawData;this.createMemo(n,c,{newAnnotation:v});const w=p[p.length-1],m=s.canvasToWorld(w),y=Ie();an(y,i,m);const C=Math.abs(ft(y,d)),x=Math.abs(ft(y,u));if(!(C<=f[0]&&x<=f[1])){if(h){this.isDrawing=!1;const{deltaPoints:S}=e,T=S.world,{textBox:_}=c.data.handles,{worldPosition:E}=_;E[0]+=T[0],E[1]+=T[1],E[2]+=T[2],_.hasMoved=!0}else{const S=this.findCrossingIndexDuringCreate(t);if(S!==void 0)this.applyCreateOnCross(t,S);else{const T=UC(n,p,o,this.commonData);this.drawData.polylineIndex=g+T}c.invalidated=!0}Me(l),c.invalidated&&Gt(c,n,At.HandlesUpdated)}}function pne(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:r,contourHoleProcessingEnabled:n}=this.drawData,i=r[0],o=r[r.length-1],a=t.detail,{element:s}=a;this.doneEditMemo(),this.drawData.newAnnotation=!1,e&&!y7(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:n}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:n})}function mne(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:r}=this.drawData,{contourHoleProcessingEnabled:n,minPointsToSave:i}=e??{};if(i&&r.length<i||this.haltDrawing(t,r))return!1;const{annotation:o,viewportIdsToRender:a}=this.commonData,s=Ce(t),{viewport:c,renderingEngine:l}=s;UC(t,r,r[0],this.commonData),r.pop();const d=Mm(this.configuration,o)?Om(this.configuration,r):r;this.updateContourPolyline(o,{points:d,closed:!0,targetWindingDirection:Wi.Clockwise},c);const{textBox:u}=o.data.handles;return u?.hasMoved||um(o,n),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(a),this.deactivateDraw(t),!0}function vne(){const{canvasPoints:t}=this.drawData,e=t.length,r=[t[0],t[e-1]],n=t.slice(0,-1).slice(1),i=w7(n,r[0],r[1],!1);if(i){const o=i[1];o===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,o)}}function yne(t,e){const{canvasPoints:r}=this.drawData,{contourHoleProcessingEnabled:n}=e??{};if(this.haltDrawing(t,r))return!1;const{annotation:i,viewportIdsToRender:o}=this.commonData,a=Ce(t),{viewport:s,renderingEngine:c}=a,l=Mm(this.configuration,i)?Om(this.configuration,r):r;this.updateContourPolyline(i,{points:l,closed:!1},s);const{textBox:d}=i.data.handles,u=i.data.contour.polyline;return i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=FC(r,s)),d.hasMoved||um(i,n),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(o),this.deactivateDraw(t),!0}function wne(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{canvasPoints:a}=this.drawData,s=a.slice(0,-1),c=w7(s,i,o,!1);return c===void 0?void 0:c[0]}function Cne(t,e){const r=t.detail,{element:n}=r,{canvasPoints:i,contourHoleProcessingEnabled:o}=this.drawData,{annotation:a,viewportIdsToRender:s}=this.commonData;UC(n,i,i[e],this.commonData),i.pop();const c=i.slice(e),l=$h(c);if(Et(l,0)){i.splice(e+1);return}i.splice(0,e);const d={contourHoleProcessingEnabled:o,minPointsToSave:3};this.completeDrawClosedContour(n,d)&&this.activateClosedContourEdit(t,a,s)}function xne(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:r,contourHoleProcessingEnabled:n}=this.drawData,i=r[0],o=r[r.length-1];e&&!y7(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:n}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:n})}function Sne(t,e){const r=Math.max(e*3,3);return t.length<r}function Tne(t,e){const{subPixelResolution:r}=this.configuration;if(Sne(e,r)){const{annotation:n,viewportIdsToRender:i}=this.commonData,o=Ce(t),{renderingEngine:a}=o;return kt(n.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(i),this.deactivateDraw(t),!0}return!1}function _ne(t){t.activateDraw=fne.bind(t),t.deactivateDraw=hne.bind(t),t.applyCreateOnCross=Cne.bind(t),t.findCrossingIndexDuringCreate=wne.bind(t),t.completeDrawOpenContour=yne.bind(t),t.removeCrossedLinesOnCompleteDraw=vne.bind(t),t.mouseDragDrawCallback=gne.bind(t),t.mouseUpDrawCallback=pne.bind(t),t.completeDrawClosedContour=mne.bind(t),t.cancelDrawing=xne.bind(t),t.haltDrawing=Tne.bind(t)}const{addCanvasPointsToArray:Ene,getFirstLineSegmentIntersectionIndexes:Au}=yl;function bne(t,e){const r=t.detail,{element:n,currentPoints:i,lastPoints:o}=r,a=i.canvas,s=o.canvas,{editCanvasPoints:c,prevCanvasPoints:l}=this.editData,d=Au(l,a,s,e);if(d)this.editData.startCrossingIndex=d[0],this.removePointsUpUntilFirstCrossing(e);else if(l.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const u=c[0],f=[];for(let p=0;p<l.length;p++){const v=l[p],w=Bn(v,u);f.push({distance:w,index:p})}f.sort((p,v)=>p.distance-v.distance);const h=[f[0],f[1]],g=Math.min(h[0].index,h[1].index);this.editData.startCrossingIndex=g}else{const u=xt();En(u,c[1],c[0]),za(u,u);const f=6,h=[c[0][0]-u[0]*f,c[0][1]-u[1]*f],g=Au(l,h,c[0],e);if(g){const p=[h];Ene(n,p,c[0],this.commonData),c.unshift(...p),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=g[0]}}}function Dne(t){const{editCanvasPoints:e,prevCanvasPoints:r}=this.editData;let n=0;for(let i=0;i<e.length-1;i++){const o=[e[i],e[i+1]],a=!!Au(r,o[0],o[1],t);if(n++,a)break}e.splice(0,n),this.editData.editIndex=e.length-1}function Ine(t,e){const r=t.detail,{currentPoints:n,lastPoints:i}=r,o=n.canvas,a=i.canvas,{prevCanvasPoints:s}=this.editData;return!!Au(s,o,a,e)}function Mne(t){const{prevCanvasPoints:e,editCanvasPoints:r}=this.editData;for(let n=r.length-1;n>0;n--){const i=[r[n],r[n-1]],o=!!Au(e,i[0],i[1],t);if(r.pop(),o)break}}function One(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:r}=this.editData;if(r===void 0)return;const n=t[t.length-1],i=[];for(let a=0;a<e.length;a++){const s=e[a],c=Bn(s,n);i.push({distance:c,index:a})}i.sort((a,s)=>a.distance-s.distance);const o=t.slice(0,-1);for(let a=0;a<i.length;a++){const{index:s}=i[a],c=e[s],l=t[t.length-1];if(!Au(o,c,l,!1))return s}return-1}function Pne(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{editCanvasPoints:a}=this.editData,s=a.slice(0,-2),c=Au(s,i,o,!1);if(!c)return;const l=c[0],d=a.length-l;for(let u=0;u<d;u++)a.pop()}function Rne(t){t.checkForFirstCrossing=bne.bind(t),t.removePointsUpUntilFirstCrossing=Dne.bind(t),t.checkForSecondCrossing=Ine.bind(t),t.findSnapIndex=One.bind(t),t.removePointsAfterSecondCrossing=Mne.bind(t),t.checkAndRemoveCrossesOnEditLine=Pne.bind(t)}const{getSubPixelSpacingAndXYDirections:Ane,addCanvasPointsToArray:C7,getArea:$T}=yl;function Lne(t,e,r){this.isEditingClosed=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=Ce(o);if(!s)return;const{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:d,xDir:u,yDir:f}=Ane(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[a],startCrossingIndex:void 0,editIndex:0,annotation:e},this.commonData={annotation:e,viewportIdsToRender:r,spacing:d,xDir:u,yDir:f,movingTextBox:!1},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpClosedContourEditCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),o.addEventListener(V.TOUCH_END,this.mouseUpClosedContourEditCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpClosedContourEditCallback),St(o)}function Nne(t){Ue.isInteractingWithTool=!1,t.removeEventListener(V.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(V.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(V.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(V.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(V.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(V.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Nt(t)}function Vne(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=Ce(n),{viewport:s}=a,{viewportIdsToRender:c,xDir:l,yDir:d,spacing:u}=this.commonData,{editIndex:f,editCanvasPoints:h,startCrossingIndex:g,annotation:p}=this.editData;this.createMemo(n,p);const v=h[h.length-1],w=s.canvasToWorld(v),m=Ie();an(m,i,w);const y=Math.abs(ft(m,l)),C=Math.abs(ft(m,d));if(y<=u[0]&&C<=u[1])return;g!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const x=C7(n,h,o,this.commonData),S=f+x;if(this.editData.editIndex=S,g===void 0&&h.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),g!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),Me(c)}function kne(t){const e=t.detail,{element:r}=e,n=Ce(r),{viewport:i,renderingEngine:o}=n,{annotation:a,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Sa(a,{points:c,closed:!0,targetWindingDirection:Wi.Clockwise},i),a.autoGenerated&&(a.autoGenerated=!1),Gt(a,r);const d=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[d],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0,annotation:a},Me(s)}function Fne(t){const{prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n,snapIndex:i}=this.editData;if(n===void 0||i===void 0)return;const o=t.detail,{element:a}=o,s=[...r];C7(a,s,e[i],this.commonData),s.length>r.length&&s.pop();let c,l;n>i?(c=i,l=n):(c=n,l=i);const d=Bn(e[c],s[0]),u=Bn(e[c],s[s.length-1]),f=Bn(e[l],s[0]),h=Bn(e[l],s[s.length-1]),g=[];for(let x=0;x<c;x++){const S=e[x];g.push([S[0],S[1]])}let p=d+h,v=u+f;if(p<v)for(let x=0;x<s.length;x++){const S=s[x];g.push([S[0],S[1]])}else for(let x=s.length-1;x>=0;x--){const S=s[x];g.push([S[0],S[1]])}for(let x=l;x<e.length;x++){const S=e[x];g.push([S[0],S[1]])}const w=[];for(let x=c;x<l;x++){const S=e[x];w.push([S[0],S[1]])}if(p=f+u,v=h+d,p<v)for(let x=0;x<s.length;x++){const S=s[x];w.push([S[0],S[1]])}else for(let x=s.length-1;x>=0;x--){const S=s[x];w.push([S[0],S[1]])}const m=$T(g),y=$T(w);return m>y?g:w}function Une(t){const e=t.detail,{element:r}=e;this.completeClosedContourEdit(r)}function Bne(t){const e=Ce(t),{viewport:r}=e,{annotation:n,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:o,prevCanvasPoints:a}=this.editData;if(o){const s=Mm(this.configuration,n)?Om(this.configuration,o,a):o,c=this.configuration?.decimate||{};Sa(n,{points:s,closed:!0,targetWindingDirection:Wi.Clockwise},r,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}}),n.autoGenerated&&(n.autoGenerated=!1),Gt(n,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,Me(i),this.deactivateClosedContourEdit(t)}function Gne(t){this.completeClosedContourEdit(t)}function Wne(t){t.activateClosedContourEdit=Lne.bind(t),t.deactivateClosedContourEdit=Nne.bind(t),t.mouseDragClosedContourEditCallback=Vne.bind(t),t.mouseUpClosedContourEditCallback=Une.bind(t),t.finishEditAndStartNewEdit=kne.bind(t),t.fuseEditPointsWithClosedContour=Fne.bind(t),t.cancelClosedContourEdit=Gne.bind(t),t.completeClosedContourEdit=Bne.bind(t)}const{addCanvasPointsToArray:x7,getSubPixelSpacingAndXYDirections:$ne}=yl;function zne(t,e,r){this.isEditingOpen=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=Ce(o),{viewport:c}=s;this.doneEditMemo();const l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:d,xDir:u,yDir:f}=$ne(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[a],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:r,spacing:d,xDir:u,yDir:f,movingTextBox:!1},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpOpenContourEditCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),o.addEventListener(V.TOUCH_END,this.mouseUpOpenContourEditCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpOpenContourEditCallback),St(o)}function jne(t){Ue.isInteractingWithTool=!1,t.removeEventListener(V.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(V.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(V.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(V.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(V.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(V.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Nt(t)}function Hne(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=Ce(n),{viewport:s}=a,{viewportIdsToRender:c,xDir:l,yDir:d,spacing:u}=this.commonData,{editIndex:f,editCanvasPoints:h,startCrossingIndex:g}=this.editData,p=h[h.length-1],v=s.canvasToWorld(p),w=Ie();this.createMemo(n,this.commonData.annotation),an(w,i,v);const m=Math.abs(ft(w,l)),y=Math.abs(ft(w,d));if(m<=u[0]&&y<=u[1])return;g!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const C=x7(n,h,o,this.commonData),x=f+C;this.editData.editIndex=x,g===void 0&&h.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),g!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),Me(c)}function Xne(t){const e=t.detail,{element:r}=e,n=Ce(r),{viewport:i}=n,{annotation:o,viewportIdsToRender:a}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Sa(o,{points:s,closed:!1},i);const c=o.data.contour.polyline;o.data.handles.points=[c[0],c[c.length-1]],o.data.handles.activeHandleIndex=1,Gt(o,r),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.doneEditMemo(),this.deactivateOpenContourEdit(r),this.activateOpenContourEndEdit(t,o,a,null)}function Kne(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{snapIndex:a,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||a===void 0)return!1;if(a===-1)return!0;if(a!==0&&a!==s.length-1)return!1;const l=i,d=o,u=s[a],f=xt(),h=xt();ko(f,l[0]-d[0],l[1]-d[1]),ko(h,l[0]-u[0],l[1]-u[1]);const g=Us(f,h),p=Math.sqrt(f[0]*f[0]+f[1]*f[1]),v=Math.sqrt(h[0]*h[0]+h[1]*h[1]);return Math.acos(g/(p*v))<Math.PI/2}function qne(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=n;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<n;s++){const c=e[s];i.push([c[0],c[1]])}const o=Bn(e[n],r[0]),a=Bn(e[n],r[r.length-1]);if(o<a)for(let s=0;s<r.length;s++){const c=r[s];i.push([c[0],c[1]])}else for(let s=r.length-1;s>=0;s--){const c=r[s];i.push([c[0],c[1]])}return i}function Yne(t){const{prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n,snapIndex:i}=this.editData;if(n===void 0||i===void 0)return;const o=t.detail,{element:a}=o,s=[...r];x7(a,s,e[i],this.commonData),s.length>r.length&&s.pop();let c,l;n>i?(c=i,l=n):(c=n,l=i);const d=Bn(e[c],s[0]),u=Bn(e[c],s[s.length-1]),f=Bn(e[l],s[0]),h=Bn(e[l],s[s.length-1]),g=[];for(let w=0;w<c;w++){const m=e[w];g.push([m[0],m[1]])}const p=d+h,v=u+f;if(p<v)for(let w=0;w<s.length;w++){const m=s[w];g.push([m[0],m[1]])}else for(let w=s.length-1;w>=0;w--){const m=s[w];g.push([m[0],m[1]])}for(let w=l;w<e.length;w++){const m=e[w];g.push([m[0],m[1]])}return g}function Jne(t){const e=t.detail,{element:r}=e,n=Ce(r),{viewport:i,renderingEngine:o}=n,{annotation:a,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Sa(a,{points:c,closed:!1},i);const d=a.data.contour.polyline;a.data.handles.points=[d[0],d[d.length-1]],Gt(a,r);const u=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},Me(s)}function Zne(t){const e=t.detail,{element:r}=e;this.completeOpenContourEdit(r)}function Qne(t){const e=Ce(t),{viewport:r}=e,{annotation:n,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:o,prevCanvasPoints:a}=this.editData;if(o){const s=Mm(this.configuration)?Om(this.configuration,o,a):o,c=this.configuration?.decimate||{};Sa(n,{points:s,closed:!1},r,{decimate:{enabled:!!c.enabled,epsilon:c.epsilon}});const l=n.data.contour.polyline;n.data.handles.points=[l[0],l[l.length-1]],n.data.isOpenUShapeContour&&(n.data.openUShapeContourVectorToPeak=FC(o,r)),Gt(n,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,Me(i),this.deactivateOpenContourEdit(t)}function ere(t){this.completeOpenContourEdit(t)}function tre(t){t.activateOpenContourEdit=zne.bind(t),t.deactivateOpenContourEdit=jne.bind(t),t.mouseDragOpenContourEditCallback=Hne.bind(t),t.mouseUpOpenContourEditCallback=Zne.bind(t),t.fuseEditPointsWithOpenContour=Yne.bind(t),t.finishEditOpenOnSecondCrossing=Jne.bind(t),t.checkIfShouldOverwriteAnEnd=Kne.bind(t),t.fuseEditPointsForOpenContourEndEdit=qne.bind(t),t.openContourEditOverwriteEnd=Xne.bind(t),t.cancelOpenContourEdit=ere.bind(t),t.completeOpenContourEdit=Qne.bind(t)}const{getSubPixelSpacingAndXYDirections:nre}=yl;function rre(t,e,r,n){this.isDrawing=!0;const i=t.detail,{element:o}=i,a=Ce(o),{viewport:s}=a,{spacing:c,xDir:l,yDir:d}=nre(s,this.configuration.subPixelResolution),u=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&u.reverse();let h=!1;n?.worldPosition&&(h=!0),this.drawData={canvasPoints:u,polylineIndex:u.length-1},this.commonData={annotation:e,viewportIdsToRender:r,spacing:c,xDir:l,yDir:d,movingTextBox:h},Ue.isInteractingWithTool=!0,o.addEventListener(V.MOUSE_UP,this.mouseUpDrawCallback),o.addEventListener(V.MOUSE_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.MOUSE_CLICK,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_END,this.mouseUpDrawCallback),o.addEventListener(V.TOUCH_DRAG,this.mouseDragDrawCallback),o.addEventListener(V.TOUCH_TAP,this.mouseUpDrawCallback),St(o)}function ire(t){t.activateOpenContourEndEdit=rre.bind(t)}function S7(t){return(t.childAnnotationUIDs??[]).map(r=>fn(r).data.contour.polyline)}function Kh(t,e){const r=S7(t),n=[];return r.forEach(i=>{const o=i.length,a=new Array(o);for(let s=0;s<o;s++)a[s]=e.worldToCanvas(i[s]);n.push(a)}),n}const{pointsAreWithinCloseContourProximity:ore}=yl;function are(t,e){const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:n,lineDash:i,color:o,fillColor:a,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:r}),{closed:c}=e.data.contour;return{color:o,width:n,lineDash:i,fillColor:a,fillOpacity:s,closePath:c}}function sre(t,e,r){t?.viewport?.getImageData()&&(r.data.contour.closed?this.renderClosedContour(t,e,r):r.data.isOpenUShapeContour?(cre(t,r),this.renderOpenUShapedContour(t,e,r)):this.renderOpenContour(t,e,r))}function cre(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=une(t,e))}function lre(t,e,r){if(r.parentAnnotationUID)return;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(l=>n.worldToCanvas(l)),a=Kh(r,n),s=[o,...a];Js(e,r.annotationUID,"1",s,i)}function ure(t,e,r){const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(c=>n.worldToCanvas(c));jo(e,r.annotationUID,"1",o,i);const s=r.data.handles.activeHandleIndex;if(this.configuration.alwaysRenderOpenContourHandles?.enabled===!0){const c=this.configuration.alwaysRenderOpenContourHandles.radius,l="0",d=[o[0],o[o.length-1]];s===0?d.shift():s===1&&d.pop(),kn(e,r.annotationUID,l,d,{color:i.color,handleRadius:c})}if(s!==null){const l=s===0?0:o.length-1,d=o[l];kn(e,r.annotationUID,"1",[d],{color:i.color})}}function dre(t,e,r){const{viewport:n}=t,{openUShapeContourVectorToPeak:i}=r.data,{polyline:o}=r.data.contour;if(this.renderOpenContour(t,e,r),!i)return;const a=n.worldToCanvas(o[0]),s=n.worldToCanvas(o[o.length-1]),c=[n.worldToCanvas(i[0]),n.worldToCanvas(i[1])],l=this._getRenderingOptions(t,r);jo(e,r.annotationUID,"first-to-last",[a,s],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"}),jo(e,r.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"})}function fre(t,e,r){const n=this._getRenderingOptions(t,r),{allowOpenContours:i}=this.configuration,{canvasPoints:o}=this.drawData;if(n.closePath=!1,jo(e,r.annotationUID,"1",o,n),i){const a=o[0],s=o[o.length-1];ore(a,s,this.configuration.closeContourProximity)?jo(e,r.annotationUID,"2",[s,a],n):kn(e,r.annotationUID,"0",[a],{color:n.color,handleRadius:2})}}function hre(t,e,r){const{viewport:n}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,r);return}const o=Kh(r,n),a=[i,...o],s=this._getRenderingOptions(t,r),c="preview-1";r.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),Js(e,r.annotationUID,c,a,s)}function gre(t,e,r){const{fusedCanvasPoints:n}=this.editData;if(n===void 0){this.renderOpenContour(t,e,r);return}const i=this._getRenderingOptions(t,r);jo(e,r.annotationUID,"preview-1",n,i)}function pre(t,e,r){if(r.parentAnnotationUID)return;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(g=>n.worldToCanvas(g)),a=Kh(r,n),s="1",c=o[0],l=6,d=100,u=[];for(let g=0;g<d;g++){const p=g/d*2*Math.PI,v=c[0]+l*Math.cos(p),w=c[1]+l*Math.sin(p);u.push([v,w])}const f=[[c[0]-l*2,c[1]],[c[0]+l*2,c[1]],[c[0],c[1]-l*2],[c[0],c[1]+l*2]];Js(e,r.annotationUID,s+"-crosshair_v",[f[0],f[1]],i),Js(e,r.annotationUID,s+"-crosshair_h",[f[2],f[3]],i);const h=[u,...a];Js(e,r.annotationUID,s,h,i)}function mre(t){t.renderContour=sre.bind(t),t.renderClosedContour=lre.bind(t),t.renderOpenContour=ure.bind(t),t.renderPointContourWithMarker=pre.bind(t),t.renderOpenUShapedContour=dre.bind(t),t.renderContourBeingDrawn=fre.bind(t),t.renderClosedContourBeingEdited=hre.bind(t),t.renderOpenContourBeingEdited=gre.bind(t),t._getRenderingOptions=are.bind(t)}function to(t){const e=vre(t),r=(e.top[1]+e.bottom[1])/2;return[e.right[0],r]}function vre(t){const e=[t[0],t[1]].sort(a),r=[t[0],t[1]].sort(s),n=e[e.length-1],i=r[0],o=r[r.length-1];return{top:i,bottom:o,right:n};function a(c,l){return c[0]<l[0]?-1:1}function s(c,l){return c[1]<l[1]?-1:1}}const yre=Object.freeze(Object.defineProperty({__proto__:null,getTextBoxCoordsCanvas:to},Symbol.toStringTag,{value:"Module"}));function dc(t,e){if(t instanceof Zn){const r=cs(e),n=Ne.getVolume(r);return!!n?.scaling&&Object.keys(n.scaling).length>0}else if(t instanceof Wn){const{preScale:r}=t.getImageData()||{};return!!r?.scaled}else return!1}const{DefaultHistoryMemo:e0}=Ww,Pf=class Pf{constructor(e,r){this.isPrimary=!1;const n=Pf.mergeDefaultProps(Pf.defaults,r),i=kr(n,e),{configuration:o={},supportedInteractionTypes:a,toolGroupId:s}=i;this.toolGroupId=s,this.supportedInteractionTypes=a||[],this.configuration=Object.assign({},o),this.mode=Cn.Disabled}static mergeDefaultProps(e={},r){return r?kr(e,r):e}get toolName(){return this.getToolName()}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,r){const{strategies:n,activeStrategy:i}=this.configuration;return n[i]?.call(this,e,r)}applyActiveStrategyCallback(e,r,n,...i){const{strategies:o,activeStrategy:a}=this.configuration;if(!o[a])throw new Error(`applyActiveStrategyCallback: active strategy ${a} not found, check tool configuration or spellings`);return o[a][n]?.call(this,e,r,...i)}setConfiguration(e){this.configuration=kr(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const r=e.split("imageId:")[1],n=Yn(r);let i=qp(n);return!i||!i.length||(i=i.filter(o=>o.getCurrentImageId()===r),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const r=cs(e),n=Ah(r);return!n||!n.length?void 0:n[0].getImageData()}else if(e.startsWith("videoId:")){const r=Yn(e),n=qp(r);return!n||!n.length?void 0:n[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const r=e.getViewReferenceId?.();if(r)return r;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}undo(){this.doneEditMemo(),e0.undo()}redo(){e0.redo()}static createZoomPanMemo(e){const r={pan:e.getPan(),zoom:e.getZoom()},n={restoreMemo:()=>{const i=e.getPan(),o=e.getZoom();e.setZoom(r.zoom),e.setPan(r.pan),e.render(),r.pan=i,r.zoom=o}};return e0.push(n),n}doneEditMemo(){this.memo?.commitMemo?.()&&e0.push(this.memo),this.memo=null}static startGroupRecording(){e0.startGroupRecording()}static endGroupRecording(){e0.endGroupRecording()}static calculateLengthInIndex(e,r,n=!1){const i=e?.scale||1,o=e?.scaleY||i,a=e?.scaleZ||i;let s=0;const c=r.length,l=n?0:1;let d=n?r[c-1]:r[0];for(let u=l;u<c;u++){const f=r[u],h=(f[0]-d[0])/i,g=(f[1]-d[1])/o,p=(f[2]-d[2])/a;s+=Math.sqrt(h*h+g*g+p*p),d=f}return s}static isInsideVolume(e,r){const{length:n}=r;for(let i=0;i<n;i++)if(!Sr(r[i],e))return!1;return!0}};Pf.defaults={configuration:{strategies:{},defaultStrategy:void 0,activeStrategy:void 0,strategyOptions:{}}};let ar=Pf;ar.toolName="BaseTool";function T7(t){if(t){if(t.data&&t.highlighted)return ca.Highlighted;if(Gh(t.annotationUID))return ca.Selected;if(ir(t.annotationUID))return ca.Locked;if(t.data&&t.autoGenerated)return ca.AutoGenerated}return ca.Default}function wre(t,e,r){const n=Mi("textBoxFontSize",t,e,r),i=Mi("textBoxFontFamily",t,e,r);return`${n}px ${i}`}const Cre=Object.freeze(Object.defineProperty({__proto__:null,getFont:wre,getState:T7,style:Kw},Symbol.toStringTag,{value:"Module"}));class fs extends ar{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:r,imageId:n}=e.detail,i=Yn(n),o=xa();o.getFramesOfReference().forEach(s=>{const l=o.getAnnotations(s)[this.getToolName()];!l||!l.length||(l.forEach(d=>{if(!d.metadata?.referencedImageId)return;Yn(d.metadata.referencedImageId)===i&&(d.invalidated=!0,d.data.cachedStats={})}),hd(r))})}}filterInteractableAnnotationsForElement(e,r){if(!r?.length)return[];const n=Ce(e),{viewport:i}=n;return Hh(i,r)}static createAnnotation(...e){let r={annotationUID:null,highlighted:!0,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:this.toolName},data:{handles:{points:new Array,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{},label:""}};for(const n of e)r=kr(r,n);return r}createAnnotation(e,r,...n){const i=e.detail,{currentPoints:o,element:a}=i,{world:s}=o,c=Ce(a),{viewport:l}=c,d=l.getCamera(),{viewPlaneNormal:u,viewUp:f,position:h}=d,g=this.getReferencedImageId(l,s,u,f),p=l.getViewReference({points:[s]});return fs.createAnnotation({metadata:{toolName:this.getToolName(),...p,referencedImageId:g,viewUp:f,cameraPosition:h},data:{handles:{points:r||[]}}},...n)}getReferencedImageId(e,r,n,i){const o=this.getTargetId(e);let a=o.split(/^[a-zA-Z]+:/)[1];if(e instanceof Zn){const s=cs(o),c=Ne.getVolume(s);a=rc(c,r,n)}return a}getStyle(e,r,n){return Mi(e,r,T7(n),this.mode)}}fs.toolName="AnnotationDisplayTool";const{DefaultHistoryMemo:Y2}=Ww,{PointsManager:xre}=hn;class Un extends fs{static createAnnotationForViewport(e,...r){return this.createAnnotation({metadata:e.getViewReference()},...r)}static createAndAddAnnotation(e,...r){const n=this.createAnnotationForViewport(e,...r);Ft(n,e.element),Gt(n,e.element)}constructor(e,r){super(e,r),this.mouseMoveCallback=(n,i)=>{if(!i)return!1;const{element:o,currentPoints:a}=n.detail,s=a.canvas;let c=!1;for(const l of i){if(ir(l.annotationUID)||!or(l.annotationUID))continue;const{data:d}=l,u=d.handles?d.handles.activeHandleIndex:void 0,f=this._imagePointNearToolOrHandle(o,l,s,6),h=f&&!l.highlighted,g=!f&&l.highlighted;h||g?(l.highlighted=!l.highlighted,c=!0):d.handles&&d.handles.activeHandleIndex!==u&&(c=!0)}return c},this.isSuvScaled=Un.isSuvScaled,e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,r,n,i){const o=Ce(e),{viewport:a}=o,{data:s}=r,{isCanvasAnnotation:c}=s,{points:l,textBox:d}=s.handles;if(d){const{worldBoundingBox:u}=d;if(u){const f={topLeft:a.worldToCanvas(u.topLeft),topRight:a.worldToCanvas(u.topRight),bottomLeft:a.worldToCanvas(u.bottomLeft),bottomRight:a.worldToCanvas(u.bottomRight)};if(n[0]>=f.topLeft[0]&&n[0]<=f.bottomRight[0]&&n[1]>=f.topLeft[1]&&n[1]<=f.bottomRight[1])return s.handles.activeHandleIndex=null,d}}for(let u=0;u<l?.length;u++){const f=l[u],h=c?f.slice(0,2):a.worldToCanvas(f);if(Bn(n,h)<i===!0)return s.handles.activeHandleIndex=u,f}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,r){return{visibility:this.getStyle("textBoxVisibility",e,r),fontFamily:this.getStyle("textBoxFontFamily",e,r),fontSize:this.getStyle("textBoxFontSize",e,r),color:this.getStyle("textBoxColor",e,r),shadow:this.getStyle("textBoxShadow",e,r),background:this.getStyle("textBoxBackground",e,r),lineWidth:this.getStyle("textBoxLinkLineWidth",e,r),lineDash:this.getStyle("textBoxLinkLineDash",e,r),textBoxBorderRadius:this.getStyle("textBoxBorderRadius",e,r),textBoxMargin:this.getStyle("textBoxMargin",e,r),textBoxLinkLineColor:this.getStyle("textBoxLinkLineColor",e,r)}}static isSuvScaled(e,r,n){if(e instanceof Zn){const o=cs(r);return Ne.getVolume(o)?.scaling?.PT!==void 0}return typeof(n&&ut("scalingModule",n))?.suvbw=="number"}getAnnotationStyle(e){const{annotation:r,styleSpecifier:n}=e,i=p=>this.getStyle(p,n,r),{annotationUID:o}=r,a=or(o),s=ir(o),c=i("lineWidth"),l=i("lineDash"),d=i("angleArcLineDash"),u=i("color"),f=i("markerSize"),h=i("shadow"),g=this.getLinkedTextBoxStyle(n,r);return{visibility:a,locked:s,color:u,lineWidth:c,lineDash:l,lineOpacity:1,fillColor:u,fillOpacity:0,shadow:h,textbox:g,markerSize:f,angleArcLineDash:d}}_imagePointNearToolOrHandle(e,r,n,i){if(this.getHandleNearImagePoint(e,r,n,i)||this.isPointNearTool(e,r,n,i,"mouse"))return!0}static createAnnotationState(e,r){const{data:n,annotationUID:i}=e,o={...n,cachedStats:{}};delete o.contour,delete o.spline;const a={annotationUID:i,data:structuredClone(o),deleting:r},s=n.contour;return s&&(a.data.contour={...s,polyline:null,pointsManager:xre.create3(s.polyline.length,s.polyline)}),a}static createAnnotationMemo(e,r,n){if(!r)return;const{newAnnotation:i,deleting:o=i?!1:void 0}=n||{},{annotationUID:a}=r,s=Un.createAnnotationState(r,o),c={restoreMemo:()=>{const l=Un.createAnnotationState(r,o),{viewport:d}=Ce(e)||{};if(d?.setViewReference(r.metadata),s.deleting===!0){if(s.deleting=!1,Object.assign(r.data,s.data),r.data.contour){const f=r.data;f.contour.polyline=s.data.contour.pointsManager.points,delete s.data.contour.pointsManager,f.segmentation&&ic(r)}s.data=l.data,Ft(r,e),$o(r.annotationUID,!0),d?.render();return}if(s.deleting===!1){s.deleting=!0,s.data=l.data,$o(r.annotationUID),kt(r.annotationUID),d?.render();return}const u=fn(a);if(!u){console.warn("No current annotation");return}Object.assign(u.data,s.data),u.data.contour&&(u.data.contour.polyline=s.data.contour.pointsManager.points),s.data=l.data,u.invalidated=!0,Gt(u,e,At.History)},id:a,operationType:"annotation"};return Y2.push(c),c}createMemo(e,r,n){this.memo||=Un.createAnnotationMemo(e,r,n)}startGroupRecording(){Y2.startGroupRecording()}endGroupRecording(){Y2.endGroupRecording()}static hydrateBase(e,r,n,i={}){if(!r)return null;const{viewport:o}=r,a=o.getFrameOfReferenceUID(),s=o.getCamera(),c=i.viewplaneNormal??s.viewPlaneNormal,l=i.viewUp??s.viewUp,d=i.toolInstance||new e;let u,f=c,h=l;if(i.referencedImageId)u=i.referencedImageId,f=void 0,h=void 0;else if(o instanceof Wn){const g=$w(n[0],o);g!==void 0&&(u=o.getImageIds()[g])}else if(o instanceof Zn)u=d.getReferencedImageId(o,n[0],c,l);else throw new Error("Unsupported viewport type");return{FrameOfReferenceUID:a,referencedImageId:u,viewPlaneNormal:f,viewUp:h,instance:d,viewport:o}}}Un.toolName="AnnotationTool";class Sre extends Un{constructor(e,r){super(e,r)}static getContourSequence(e,r){const{data:n}=e,i=[];for(const s of n.contour.polyline)for(const c of s)i.push(c.toFixed(2));const{referencedImageId:o}=e.metadata,a=r.get("ImageSopInstanceReference",o);return{NumberOfContourPoints:i.length/3,ContourImageSequence:a,ContourGeometricType:"CLOSED_PLANAR",ContourData:i}}renderAnnotation(e,r){let n=!1;const{viewport:i}=e,{element:o}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let a=$t(this.getToolName(),o);if(!a?.length||(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length))return n;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let l=0;l<a.length;l++){const d=a[l];c.annotationUID=d.annotationUID;const u=this.getAnnotationStyle({annotation:d,styleSpecifier:c});if(!u.visibility)continue;const f=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:d,annotationStyle:u,svgDrawingHelper:r});n||=f,d.invalidated=!1}return n}createAnnotation(e){const r=super.createAnnotation(e);return Object.assign(r.data,{contour:{polyline:[],closed:!1}}),Object.assign(r,{interpolationUID:"",autoGenerated:!1}),r}addAnnotation(e,r){return Ft(e,r)}cancelAnnotation(e){}moveAnnotation(e,r){const{points:n}=e.data.handles;for(let i=0,o=n.length;i<o;i++){const a=n[i];a[0]+=r[0],a[1]+=r[1],a[2]+=r[2]}e.invalidated=!0,Fh(e).forEach(i=>this.moveAnnotation(i,r))}updateContourPolyline(e,r,n,i){const o=this.configuration?.decimate||{};Sa(e,r,n,{decimate:{enabled:!!o.enabled,epsilon:o.epsilon},updateWindingDirection:i?.updateWindingDirection})}getPolylinePoints(e){return e.data.contour?.polyline??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:r,annotationStyle:n,svgDrawingHelper:i}=e,o=e.annotation;if(o.parentAnnotationUID)return;const{annotationUID:a}=o,{viewport:s}=r,{worldToCanvas:c}=s,l=this.getPolylinePoints(o).map(w=>c(w)),{lineWidth:d,lineDash:u,color:f,fillColor:h,fillOpacity:g}=n,p=Kh(o,s),v=[l,...p];return Js(i,a,"contourPolyline",v,{color:f,lineDash:u,lineWidth:Math.max(.1,d),fillColor:h,fillOpacity:g}),!0}}class Tre{constructor(){this.annotationUIDs=new Set,this._isVisible=!0,this.visibleFilter=this.unboundVisibleFilter.bind(this)}unboundVisibleFilter(e){return!this._isVisible||!this.annotationUIDs.has(e)}has(e){return this.annotationUIDs.has(e)}setVisible(e=!0,r,n){this._isVisible!==e&&(this._isVisible=e,this.annotationUIDs.forEach(i=>{const o=fn(i);if(!o){this.annotationUIDs.delete(i);return}if(o.isVisible===e||!e&&n?.(i)===!1)return;o.isVisible=e;const a={...r,annotation:o};Ye(Fe,V.ANNOTATION_MODIFIED,a)}))}get isVisible(){return this._isVisible}findNearby(e,r){const n=[...this.annotationUIDs];if(n.length===0)return null;if(!e)return n[r===1?0:n.length-1];const i=n.indexOf(e);return i===-1||i+r<0||i+r>=n.length?null:n[i+r]}add(...e){e.forEach(r=>this.annotationUIDs.add(r))}remove(...e){e.forEach(r=>this.annotationUIDs.delete(r))}clear(){this.annotationUIDs.clear()}}const ma={...TZ,...wZ,resetAnnotationManager:JQ},_re=Object.freeze(Object.defineProperty({__proto__:null,AnnotationGroup:Tre,FrameOfReferenceSpecificAnnotationManager:_9,config:Cre,locking:BQ,selection:zQ,state:ma,visibility:qQ},Symbol.toStringTag,{value:"Module"})),zT="PlanarFreehandContourSegmentationTool";function BC(t,e=[]){const{viewport:r,sliceData:n,annotation:i}=t,o=new Map,{toolName:a,originalToolName:s}=i.metadata,c=s||a,l=($t(c,r.element)||[]).filter(d=>!d.metadata.originalToolName||d.metadata.originalToolName===c);if(c!==zT){const d=$t(zT,r.element);d?.length&&d.forEach(u=>{const{metadata:f}=u;f.originalToolName===c&&f.originalToolName!==f.toolName&&l.push(u)})}if(!l?.length)return o;for(let d=0;d<n.numberOfSlices;d++){const u=l.filter(h=>h.metadata.sliceIndex===d);if(!u?.length)continue;const f=u.filter(h=>e.every(g=>{const v=(g.parentKey?g.parentKey(h):h)?.[g.key];return Array.isArray(v)?v.every((w,m)=>w===g.value[m]):v===g.value}));f.length&&o.set(d,f)}return o}function Ere(t,e){const r=BC(t,e),n=[];if(!r?.size)return n;for(const i of r.values())i.forEach(o=>{n.push(o)});return n}function _7(t,e,r){const n=kr({data:{},metadata:{}},r);return Object.assign(n,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(n.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...r.data.contour,polyline:t}}),n}function bre(t,e){const r=BC(e,[{key:"interpolationUID",value:e.interpolationUID}]),n=Dre(r);if(!n){console.warn("No annotations found to interpolate",r);return}const i=Ire(r,t.annotationUID),o=[];for(let a=n[0]+1;a<n[1];a++)if(Mre(r,a)){const s=Pre(a,n,r);(s?.[0]===i||s?.[1]===i)&&Ore(s,o,a)}return{interpolationData:r,interpolationList:o}}function Dre(t){let e=1/0,r=-1/0,n=!1;for(const[i,o]of t.entries())o.length&&(e=Math.min(i,e),r=Math.max(i,r),n=!0);if(n)return[e,r]}function Ire(t,e){for(const[r,n]of t)for(let i=0;i<n.length;i++)if(n[i].annotationUID===e)return r}function Mre(t,e){const r=t.get(e);return!r?.length||r.length===1&&r[0].autoGenerated}function Ore(t,e,r){const[n]=t;e[n]||={pair:t,list:[]},e[n].list.push(r)}function Pre(t,e,r){const n=[];let i=!0;for(let o=t-1;o>=e[0];o--){const a=r.get(o);if(a?.length){if(a[0].autoGenerated)continue;a.length>1&&(i=!1),n.push(o);break}}if(!(!i||!n.length)){for(let o=t+1;o<=e[1];o++){const a=r.get(o);if(a?.length){if(a[0].autoGenerated)continue;a.length>1&&(i=!1),n.push(o);break}}if(!(!i||n.length<2))return n}}const{PointsManager:jT}=hn;function Rre(t,e=12){const r=jT.create3(e);r.sources=[];const{sources:n}=r,{length:i,sources:o=[]}=t,a=5;if(i<a*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,a*2));o.forEach(()=>n.push(jT.create3(e)));const c=Are(t,a),l=Lre(c,e),d=[];if(l?.length>2){let u=-1;const f=s/3;l.forEach(p=>{const[v,,w]=p,m=Math.ceil((v+w)/2);w-u<f||(m-v>2*f?(t0(d,u,v,s,i),u=t0(d,v,m,s,i)):u=t0(d,u,m,s,i),w-u>f&&(u=t0(d,u,w,s,i)))});const h=d[0];Py(h+i-u,i)>2*f&&t0(d,u,h-f,s,i)}else{const u=Math.floor(i/e);t0(d,-1,i-u,u,i)}return d.forEach(u=>{const f=t.getPointArray(u);r.push(f),o.forEach((h,g)=>n[g].push(h.getPoint(u)))}),r}function Are(t,e=6){const{length:r}=t,n=Ie(),i=Ie(),o=new Float32Array(r);for(let a=0;a<r;a++){const s=t.getPoint(a),c=t.getPoint(a-e),l=t.getPoint((a+e)%r);rn(n,s,c),rn(i,l,s);const d=ft(n,i)/(k0(n)*k0(i));o[a]=d}return o}function Lre(t,e){const{max:r,deviation:n}=Nre(t),{length:i}=t;if(n<.01||i<e*3)return[];const o=[];let a=null,s,c=0;for(let l=0;l<i;l++){const d=t[l];d<r-n?a?(a[2]=l,d<s&&(s=d,c=l),a[1]=c):(s=d,c=l,a=[l,l,l]):a&&(o.push(a),a=null)}return a&&(o[0][0]===0?o[0][0]=a[0]:(a[1]=c,a[2]=i-1,o.push(a))),o}function t0(t,e,r,n,i){r<e&&(r+=i);const o=r-e,a=Math.ceil(o/n);if(a<=0)return t[t.length-1]!==r&&t.push(Py(r,i)),r;for(let s=1;s<=a;s++){const c=Py(e+s*o/a,i);t.push(c)}return t[t.length-1]}function Py(t,e){return(Math.round(t)+e)%e}function Nre(t){const{length:e}=t;let r=0,n=1/0,i=-1/0,o=0;for(let s=0;s<e;s++){const c=t[s];r+=c,n=Math.min(n,c),i=Math.max(i,c)}const a=r/e;for(let s=0;s<e;s++){const c=t[s]-a;o+=c*c}return{mean:a,max:i,min:n,sumSq:o,deviation:Math.sqrt(o/e)}}function Vre(t){const{parentAnnotationUID:e,annotationUID:r}=t;if(!e)return t.interpolationUID;const n=ma.getAnnotation(e),{interpolationUID:i}=n,o=n.childAnnotationUIDs.indexOf(r);return t.interpolationUID=`${i}-${o}`,t.interpolationUID}const{PointsManager:Bd}=hn,HT=.2;function vp(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:r}=t;queueMicrotask(()=>{try{e&&(r.isInterpolationUpdate=!0,r.autoGenerated=!1),kre(t)}finally{e&&(r.autoGenerated=!0)}})}function kre(t){const{annotation:e}=t;Vre(e);const{interpolationData:r,interpolationList:n}=bre(e,t)||{};if(!r||!n)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let l=0;l<n.length;l++)n[l]&&Fre(n[l].list,n[l].pair,r,i);const{id:o,renderingEngineId:a,element:s}=t.viewport,c={annotation:e,element:s,viewportId:o,renderingEngineId:a};n.length&&(Ye(t.viewport.element,V.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c),Ye(Fe,V.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c))}function Fre(t,e,r,n){const i=r.get(e[0])[0],o=r.get(e[1])[0],a=QT(i.data.contour.polyline),s=QT(o.data.contour.polyline),{c1Interp:c,c2Interp:l}=$re(a,s);c.kIndex=e[0],l.kIndex=e[1],t.forEach(function(d){Ure(c,l,d,e,r,a.x.length>s.x.length,n)})}function Ure(t,e,r,n,i,o,a){const[s,c]=n,l=(r-s)/(c-s),d=i.get(s)[0],u=i.get(c)[0],f=Wre(t,e,l,o),h=l>.5?u:d,g=Rre(f);i.has(r)?Gre(f,g,r,h,a):Bre(f,g,r,h,a)}function Bre(t,e,r,n,i){const o=t.points,{viewport:a}=i,s=_7(o,e,n),c=a.getViewReference({sliceIndex:r});if(!c)throw new Error(`Can't find slice ${r}`);Object.assign(s.metadata,c),ma.addAnnotation(s,a.element),n.onInterpolationComplete?.(s,n);const{parentAnnotationUID:l}=n;if(l){const d=ma.getAnnotation(l),u=E7(d,r,i);_m(a,u,s)}}function E7(t,e,r){const{viewport:n}=r,i=ma.getAnnotations(t.metadata.toolName,n.element);for(let o=0;o<i.length;o++){const a=i[o];if(a.interpolationUID===t.interpolationUID&&a.metadata.sliceIndex===e)return a}}function Gre(t,e,r,n,i){const o=E7(n,r,i),a=t.points,s=_7(a,e,o);Object.assign(o,{metadata:s.metadata,data:s.data})}function Wre(t,e,r,n){const i=n?t.I:e.I,o=Bd.fromXYZ(t),a=Bd.fromXYZ(e),{length:s}=o,c=Bd.create3(s),l=Ie(),d=Ie(),u=Bd.create3(s);u.kIndex=t.kIndex;const f=Bd.create3(s);f.kIndex=e.kIndex;for(let h=0;h<t.x.length;h++)if(i[h]){const g=o.getPoint(h),p=a.getPoint(h);u.push(g),f.push(p),rn(l,p,g),c.push(en(d,g,l,r))}return c.sources=[u,f],c}function $re(t,e){const r=ZT(t),n=ZT(e),i=Math.max(Math.ceil(r[r.length-1]/HT),Math.ceil(n[n.length-1]/HT)),o=JT(r),a=JT(n),s=i+e.x.length,c=i+t.x.length,l=YT(s,o),d=YT(c,a),u=qT(s-2,t.x.length),f=qT(c-2,e.x.length),h=KT(l,u),g=KT(d,f),p=XT(t,h),v=XT(e,g);return jre(p,v),zre(p,v)}function zre(t,e){const r={x:[],y:[],z:[],I:[]},n={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(r.x.push(t.x[i]),r.y.push(t.y[i]),r.z.push(t.z[i]),r.I.push(t.I[i]),n.x.push(e.x[i]),n.y.push(e.y[i]),n.z.push(e.z[i]),n.I.push(e.I[i]));return{c1Interp:r,c2Interp:n}}function jre(t,e){const r=t.x.length,n={startingNode:0,totalSquaredXYLengths:1/0};for(let o=0;o<r;o++){let a=o,s=0;for(let c=0;c<r;c++)s+=(t.x[a]-e.x[c])**2+(t.y[a]-e.y[c])**2+(t.z[a]-e.z[c])**2,a++,a===r&&(a=0);s<n.totalSquaredXYLengths&&(n.totalSquaredXYLengths=s,n.startingNode=o)}const i=n.startingNode;Pg(t.x,i),Pg(t.y,i),Pg(t.z,i),Pg(t.I,i)}function Pg(t,e){e-=t.length*Math.floor(e/t.length);const r=t.splice(0,e);return t.push(...r),t}function XT(t,e){const r={x:[],y:[],z:[],I:[]};for(let n=0;n<t.x.length-1;n++){r.x.push(t.x[n]),r.y.push(t.y[n]),r.z.push(t.z[n]),r.I.push(!0);const i=(t.x[n+1]-t.x[n])/(e[n]+1),o=(t.y[n+1]-t.y[n])/(e[n]+1),a=(t.z[n+1]-t.z[n])/(e[n]+1);for(let s=0;s<e[n]-1;s++)r.x.push(r.x[r.x.length-1]+i),r.y.push(r.y[r.y.length-1]+o),r.z.push(r.z[r.z.length-1]+a),r.I.push(!1)}return r}function KT(t,e){const r=[];for(let a=0;a<t.length;++a)r[a]=a;r.sort(function(a,s){return t[a]<t[s]?-1:1});const n=[];for(let a=0;a<e.length;a++)n.push(e[r[a]]);const i=n.reduce(function(a,s,c){return s&&a.push(c),a},[]),o=[];for(let a=0;a<i.length-1;a++)o.push(i[a+1]-i[a]);return o}function qT(t,e){const r=new Array(t+e);return r.fill(!1,0,t),r.fill(!0,t,t+e),r}function YT(t,e){const r=1/(t-1),n=[r];for(let i=1;i<t-2;i++)n.push(n[n.length-1]+r);return n.concat(e)}function JT(t){const e=[];for(let r=0;r<t.length;r++)e.push(t[r]/t[t.length-1]);return e}function ZT(t){const e=[0];for(let r=1;r<t.x.length;r++){const n=Math.sqrt((t.x[r]-t.x[r-1])**2+(t.y[r]-t.y[r-1])**2+(t.z[r]-t.z[r-1])**2);e.push(e[r-1]+n)}return e}function QT(t){const e={x:[],y:[],z:[]};for(let r=0;r<t.length;r++)e.x[r]=t[r][0],e.y[r]=t[r][1],e.z[r]=t[r][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function e_(t){const{annotation:e}=t,r=BC(t,[{key:"interpolationUID",value:t.interpolationUID}]),n=e.metadata.sliceIndex;let i=-1,o=t.sliceData.numberOfSlices;for(const[s,c]of r.entries())s===n||!c.find(d=>!d.autoGenerated)||(s<n?i=Math.max(s,i):o=Math.min(s,o));const a=[];for(const[s,c]of r.entries())s<=i||s>=o||s===n||c.forEach(l=>{l.autoGenerated&&(ma.removeAnnotation(l.annotationUID),a.push(l))});if(a.length){const s={annotations:a,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};Ye(t.viewport.element,V.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&o<t.sliceData.numberOfSlices){const s=r.get(o)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};vp(c)}}function yp(t){const e=OC(t);return e?.length?e.find(n=>n.getImageIds().some(i=>i===t.metadata.referencedImageId))??e[0]:void 0}const{uuidv4:Hre}=hn,Xre=[At.HandlesUpdated,At.InterpolationUpdated],No=class No{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static removeTool(e){this.toolNames.includes(e)&&(this.toolNames=this.toolNames.filter(r=>r!==e))}static acceptAutoGenerated(e,r={}){const{toolNames:n,segmentationId:i,segmentIndex:o,sliceIndex:a}=r;for(const s of n||No.toolNames){const c=ma.getAnnotations(s,e);if(c?.length)for(const l of c){const{interpolationUID:d,data:u,autoGenerated:f,metadata:h}=l;d&&(l.interpolationCompleted=!0),f&&(o&&o!==u.segmentation.segmentIndex||a!==void 0&&h&&a!==h.sliceIndex||i&&i!==u.segmentation.segmentationId||(ic(l),l.autoGenerated=!1))}}}};No.toolNames=[],No.handleAnnotationCompleted=e=>{const r=e.detail.annotation;if(!r?.metadata)return;const{toolName:n,originalToolName:i}=r.metadata;if(!No.toolNames.includes(n)&&!No.toolNames.includes(i))return;const o=yp(r);if(!o){console.warn("Unable to find viewport for",r);return}const a=J2(o),s={viewport:o,sliceData:a,annotation:r,interpolationUID:r.interpolationUID},c=!!r.interpolationUID;if(r.autoGenerated=!1,c){e_(s),vp(s);return}const l=[{key:"segmentIndex",value:r.data.segmentation.segmentIndex,parentKey:h=>h.data.segmentation},{key:"viewPlaneNormal",value:r.metadata.viewPlaneNormal,parentKey:h=>h.metadata},{key:"viewUp",value:r.metadata.viewUp,parentKey:h=>h.metadata}];let d=Ere(s,l);const{sliceIndex:u}=r.metadata,f=new Set;d.forEach(h=>{if(h.interpolationCompleted||h.metadata.sliceIndex===u){const{interpolationUID:g}=h;f.add(g)}}),d=d.filter(h=>!f.has(h.interpolationUID)),r.interpolationUID=d[0]?.interpolationUID||Hre(),s.interpolationUID=r.interpolationUID,vp(s)},No.handleAnnotationUpdate=e=>{const r=e.detail.annotation,{changeType:n=At.HandlesUpdated}=e.detail;if(!r?.metadata)return;const{toolName:i,originalToolName:o}=r.metadata;if(!No.toolNames.includes(i)&&!No.toolNames.includes(o)||!Xre.includes(n))return;const a=yp(r);if(!a){console.warn("Unable to find matching viewport for annotation interpolation",r);return}r.autoGenerated&&(ic(r),r.autoGenerated=!1);const s=J2(a),c={viewport:a,sliceData:s,annotation:r,interpolationUID:r.interpolationUID,isInterpolationUpdate:n===At.InterpolationUpdated};vp(c)},No.handleAnnotationDelete=e=>{const r=e.detail.annotation;if(!r?.metadata)return;const{toolName:n}=r.metadata;if(!No.toolNames.includes(n)||r.autoGenerated)return;const i=yp(r);if(!i){console.warn("No viewport, can't delete interpolated results",r);return}const o=J2(i),a={viewport:i,sliceData:o,annotation:r,interpolationUID:r.interpolationUID};r.autoGenerated=!1,e_(a)};let Ho=No;function J2(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function b7(t){t.forEach(e=>{const r=Fr(e);if(!r){console.warn(`ToolGroup not available for ${e}`);return}r.getViewportsInfo().forEach(i=>{const{renderingEngineId:o,viewportId:a}=i,s=Fn(o);if(!s){console.warn(`RenderingEngine not available for ${o}`);return}const c=s.getViewport(a);hd(c.element)})})}function D7(t,e={}){const r=t.annotationUIDsMap,n=e.segmentIndices?.length?e.segmentIndices:Array.from(r.keys()),i=new Map;return n.forEach(o=>{const a=r.get(o);let s=Array.from(a);s=s.filter(l=>!fn(l).parentAnnotationUID);const c=s.map(l=>{const d=fn(l),u=d.childAnnotationUIDs?.length,f=u&&d.childAnnotationUIDs.map(p=>{const v=fn(p);return{polyline:v.data.contour.polyline,isClosed:v.data.contour.closed}}),h=u&&f.map(p=>p.isClosed),g=u&&f.map(p=>p.polyline);return{polyline:d.data.contour.polyline,isClosed:d.data.contour.closed,annotationUID:d.annotationUID,referencedImageId:d.metadata.referencedImageId,holesPolyline:g,holesUIDs:d.childAnnotationUIDs,holesClosed:h}});i.set(o,c)}),{segmentIndices:n,annotationUIDsInSegmentMap:i}}function t_(t,e){if(!t||t.length===0)return[];if(!e)return[...t];const r=t[0],n=t[t.length-1];return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]?[...t]:[...t,r]}function Kre(t,e){const{annotationUIDsInSegmentMap:r}=D7(t);if(!r.has(e)){console.warn(`No contour information found for segmentIndex ${e}`);return}const n=new Map,i=r.get(e);for(const o of i){n.set(o.annotationUID,t_(o.polyline,o.isClosed));for(let a=0;a<o.holesUIDs?.length;a++)n.set(o.holesUIDs[a],t_(o.holesPolyline[a],o.holesClosed[a]))}return n}function qh(t,e){const r=gC(t),n=Ut(t);if(!n||!n.representationData.Contour)return;const i=n.representationData.Contour,{annotationUIDsMap:o}=i;if(!o||!o.get(e))return;const a=Kre(i,e);if(!a)return;const s=Array.from(a?.keys()),c=new Map;for(const l of s){const d=fn(l),u=mC(r,d);c.set(l,So(a.get(l),u))}return c}function qre(t,e,r={epsilon:.1}){const n=Ut(t);if(!n){console.warn(`Invalid segmentation given ${t}`);return}if(!n.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const i=gC(t);if(!i){console.warn("No viewport associated to the segmentation found");return}const o=qh(t,e);if(!o){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const a=Array.from(o?.keys());for(const s of a){const c=fn(s);if(!c)continue;const l=o.get(s),d=Sm(l,r.epsilon),u=mC(i,c);u&&(c.data.contour.polyline=d.map(f=>u.canvasToWorld(f)),Jw(c))}}function Pm(t){t&&(t.parentAnnotationUID&&ud(t),kt(t.annotationUID),va(t))}function Yre(t,e){const{viewPlaneNormal:r}=t.metadata,{viewPlaneNormal:n}=e.metadata,i=ft(r,n);if(!Du(1,Math.abs(i)))return!1;const{polyline:a}=t.data.contour,{polyline:s}=e.data.contour,c=ft(r,a[0]),l=ft(r,s[0]);return Du(c,l)}function I7(t,e,r){let n=-1;if(e.forEach((i,o)=>{n>=0||i.a==t.b&&(n=o)}),n>=0){const i=e[n];return e.splice(n,1),r.push(i.b),r[0]==i.b?{remainingLines:e,contourPoints:r,type:"CLOSED_PLANAR"}:I7(i,e,r)}return{remainingLines:e,contourPoints:r,type:"OPEN_PLANAR"}}function GC(t){if(t.length==0)return[];const e=[],r=t.shift();e.push(r.a),e.push(r.b);const n=I7(r,t,e);if(n.remainingLines.length==0)return[{type:n.type,contourPoints:n.contourPoints}];{const i=GC(n.remainingLines);return i.push({type:n.type,contourPoints:n.contourPoints}),i}}function Jre(t){return GC(t)}const Zre={findContours:GC,findContoursFromReducedSet:Jre};function Qre(t,e=!1){const r=t.getPoints(),n=t.getLines(),i=new Array(r.getNumberOfPoints()).fill(0).map((c,l)=>r.getPoint(l).slice()),o=new Array(n.getNumberOfCells()).fill(0).map((c,l)=>{const d=n.getCell(l*3).slice();return{a:d[0],b:d[1]}});if(e)return{points:i,lines:o};const a=[];for(const[c,l]of i.entries()){const d=a.findIndex(u=>u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]);if(d>=0)o.map(u=>(u.a===c&&(u.a=d),u.b===c&&(u.b=d),u));else{const u=a.length;a.push(l),o.map(f=>(f.a===c&&(f.a=u),f.b===c&&(f.b=u),f))}}const s=o.filter(c=>c.a!==c.b);return{points:a,lines:s}}const eie=(t,e)=>{const r=t[0],n=t[1];let i=!1;for(let o=0,a=e.length-1;o<e.length;a=o++){const s=e[o][0],c=e[o][1],l=e[a][0],d=e[a][1];c>n!=d>n&&r<(l-s)*(n-c)/(d-c)+s&&(i=!i)}return i};function tie(t,e,r){const n=[];t.contourPoints.forEach(o=>{n.push([r[o][0],r[o][1]])});let i=0;return e.contourPoints.forEach(o=>{eie([r[o][0],r[o][1]],n)||i++}),i===0}function nie(t,e,r=!0){const n=t.filter(s=>s.type!=="CLOSED_PLANAR"),i=t.filter(s=>s.type==="CLOSED_PLANAR"),o=[];let a=[];return i.forEach((s,c)=>{const l=[];i.forEach((d,u)=>{c!=u&&tie(s,d,e)&&l.push(u)}),l.length>0?o.push({contour:s,holes:l}):a.push(c)}),r&&(o.forEach(s=>{s.contour.type="CLOSEDPLANAR_XOR",n.push(s.contour),s.holes.forEach(c=>{i[c].type="CLOSEDPLANAR_XOR",n.push(i[c]),a=a.filter(l=>l!==c)})}),a.forEach(s=>{n.push(i[s])})),n}const rie={processContourHoles:nie};function iie(t,e){return Uu(e,t)}function WC(t){const e=[],r=[];t.forEach((n,i)=>{ym(n)&&r.push({polyline:n,originalIndex:i})});for(let n=0;n<r.length;n++){const i=r[n],o=Math.abs(zo(i.polyline)),a=[];for(let s=0;s<r.length;s++){if(n===s)continue;const c=r[s];Math.abs(zo(c.polyline))<o&&iie(c.polyline,i.polyline)&&a.push(c.originalIndex)}a.length>0&&e.push({contourIndex:i.originalIndex,holeIndexes:a.sort((s,c)=>s-c)})}return e.sort((n,i)=>n.contourIndex-i.contourIndex)}let n_=!1;function Rm(){if(n_)return;n_=!0;const t=()=>new Worker(new URL("/radiology-ai-viewer/assets/computeWorker-B9Af7yv4.js",import.meta.url),{name:"compute",type:"module"}),e=cc(),i={maxWorkerInstances:1,autoTerminateOnIdle:_Q().computeWorker?.autoTerminateOnIdle??{enabled:!0,idleTimeThreshold:2e3}};e.registerWorker("compute",t,i)}function Am(){return On.getState().segmentations}function oie(t){const{segmentationId:e,representation:r,config:n}=t,{type:i,data:o}=r,a=o?{...o}:{};if(!a)throw new Error("Segmentation representation data may not be undefined");i===yt.Contour&&aie(a);const s=sie(n?.segments,i,a);return delete n?.segments,{segmentationId:e,label:n?.label??null,cachedStats:n?.cachedStats??{},segments:s,representationData:{[i]:{...a}}}}function aie(t){t.geometryIds=t.geometryIds??[],t.annotationUIDsMap=t.annotationUIDsMap??new Map}function sie(t,e,r){const n={};return t?Object.entries(t).forEach(([i,o])=>{const{label:a,locked:s,cachedStats:c,active:l,...d}=o,u={segmentIndex:Number(i),label:a??`Segment ${i}`,locked:s??!1,cachedStats:c??{},active:l??!1,...d};n[i]=u}):e===yt.Contour?cie(n,r):e===yt.Surface?lie(n,r):n[1]=uie(),n}function cie(t,e){const{geometryIds:r}=e;r?.forEach(n=>{const i=Ne.getGeometry(n);if(i?.data){const{segmentIndex:o}=i.data;t[o]={segmentIndex:o}}})}function lie(t,e){const{geometryIds:r}=e;r?.forEach(n=>{const i=Ne.getGeometry(n);if(i?.data){const{segmentIndex:o}=i.data;t[o]={segmentIndex:o}}})}function uie(){return{segmentIndex:1,label:"Segment 1",locked:!1,cachedStats:{},active:!0}}function M7(t,e){const r=On;t.forEach(n=>{const i=oie(n);r.addSegmentation(i),e||Ko(i.segmentationId)})}const die={[yt.Labelmap]:RC,[yt.Contour]:PC,[yt.Surface]:lC},I0=new Map;function $C(t,e,r){const n=die[r].getUpdateFunction(t);n&&O7(e,r,n)}function O7(t,e,r){I0.has(t)||I0.set(t,new Map);const n=I0.get(t);n.has(e)&&zC(t,e);const i=hie(t,e,r);Fe.addEventListener(V.SEGMENTATION_DATA_MODIFIED,i),n.set(e,i)}function zC(t,e){const r=I0.get(t);if(!r)return;const n=r.get(e);n&&(Fe.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,n),r.delete(e))}function fie(t){const e=I0.get(t);if(e){for(const r of e.values())Fe.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,r);I0.delete(t)}}function hie(t,e,r){const n=pd(i=>{const o=i.detail?.segmentationId,a=Ut(o);o===t&&a?.representationData?.[e]&&(r(t),Ko(t))},300);return(i=>{n(i)})}function vd(t,e,r){return R7(t,e,r)}function P7(t,e,r){return R7(t,e,r)}function R7(t,e,r){const{segmentationId:n,type:i}=e;return gie(t,n,i,r),On.removeSegmentationRepresentations(t,{segmentationId:n,type:i})}function A7(){On.getAllViewportSegmentationRepresentations().forEach(({viewportId:e,representations:r})=>{r.forEach(({segmentationId:n,type:i})=>{vd(e,{segmentationId:n,type:i})})}),On.resetState()}function L7(t,e,r){vd(t,{segmentationId:e,type:yt.Labelmap},r)}function N7(t,e,r){vd(t,{segmentationId:e,type:yt.Contour},r)}function V7(t,e,r){vd(t,{segmentationId:e,type:yt.Surface},r)}function gie(t,e,r,n){Qi(t,{segmentationId:e,type:r}).forEach(a=>{a.type===yt.Labelmap?RC.removeRepresentation(t,a.segmentationId,n):a.type===yt.Contour?PC.removeRepresentation(t,a.segmentationId,n):a.type===yt.Surface&&lC.removeRepresentation(t,a.segmentationId,n),zC(a.segmentationId,a.type)});const{viewport:o}=wn(t)||{};o&&o.render()}function jC(t){const e=On;e.getAllViewportSegmentationRepresentations().filter(({representations:n})=>n.some(i=>i.segmentationId===t)).map(({viewportId:n})=>n).forEach(n=>{P7(n,{segmentationId:t})}),e.removeSegmentation(t),iC(t)}function k7(){const t=On;t.getState().segmentations.map(n=>n.segmentationId).forEach(n=>{jC(n)}),t.resetState()}function F7(){return On.getNextColorLUTIndex()}const h1=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]];function Sf(t,e){const r=On,n=e??F7();let i=[...t];if(Et(i[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),i=[[0,0,0,0],...i]),i=i.map(o=>o.length===3?[o[0],o[1],o[2],255]:o),i.length<255){const o=h1.slice(i.length);i=[...i,...o]}return r.addColorLUT(i,n),n}function pie(t){On.removeColorLUT(t)}function U7(t,e){return B7(t).map(o=>(e&&o.type===e,Ut(o.segmentationId))).filter(o=>o!==void 0)}function B7(t){return On.getState().viewportSegRepresentations[t]}function G7(t,e){return On.updateLabelmapSegmentationImageReferences(t,e)}function mie(t,e){return On.getStackSegmentationImageIdsForViewport(t,e)}function vie(){On.resetState()}const yie=Object.freeze(Object.defineProperty({__proto__:null,addColorLUT:Sf,addSegmentations:M7,destroy:vie,getColorLUT:Bh,getCurrentLabelmapImageIdForViewport:wl,getCurrentLabelmapImageIdsForViewport:sc,getNextColorLUTIndex:F7,getSegmentation:Ut,getSegmentationRepresentation:oC,getSegmentationRepresentations:Qi,getSegmentationRepresentationsBySegmentationId:C9,getSegmentations:Am,getStackSegmentationImageIdsForViewport:mie,getViewportIdsWithSegmentation:Fu,getViewportSegmentationRepresentations:B7,getViewportSegmentations:U7,removeAllSegmentationRepresentations:A7,removeAllSegmentations:k7,removeColorLUT:pie,removeContourRepresentation:N7,removeLabelmapRepresentation:L7,removeSegmentation:jC,removeSegmentationRepresentation:vd,removeSurfaceRepresentation:V7,updateLabelmapSegmentationImageReferences:G7},Symbol.toStringTag,{value:"Module"}));function W7(t){if("volumeId"in t){if(t=t,!Ne.getVolume(t.volumeId))throw new Error(`volumeId of ${t.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else if("imageIds"in t){if(t=t,!t.imageIds)throw new Error("The segmentationInput.representationData.imageIds is undefined, please provide a valid representationData.imageIds for stack data")}else throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData")}function wie(t){if(!t.representation.data)throw new Error("The segmentationInput.representationData.data is undefined, please provide a valid representationData.data");const e=t.representation.data;W7(e)}function Cie(t){W7(t)}const xie=Object.freeze(Object.defineProperty({__proto__:null,validate:Cie,validatePublic:wie},Symbol.toStringTag,{value:"Module"}));function $7(t){const e=Ne.getVolume(t);if(!e)return null;const r=e.referencedVolumeId;let n;if(r)n=Ne.getVolume(r);else{const i=e.imageIds,a=Ne.getImage(i[0]).referencedImageId;n=Ne.getVolumeContainingImageId(a)?.volume}return n}function Sie({operationData:t}){const{volumeId:e}=t;if(!e){const c=new CustomEvent($e.ERROR_EVENT,{detail:{type:"Segmentation",message:"No volume id found for the segmentation"},cancelable:!0});return Fe.dispatchEvent(c),null}const r=Ne.getVolume(e),n=$7(e);if(!r||!n)return null;const{imageData:i}=r,{voxelManager:o}=r,{voxelManager:a,imageData:s}=n;return{segmentationImageData:i,segmentationVoxelManager:o,segmentationScalarData:null,imageScalarData:null,imageVoxelManager:a,imageData:s}}function Tie({operationData:t,viewport:e,strategy:r}){const{segmentationId:n}=t;let i,o,a,s,c,l;if(r.ensureSegmentationVolumeFor3DManipulation)r.ensureSegmentationVolumeFor3DManipulation({operationData:t,viewport:e}),o=t.segmentationVoxelManager,i=t.segmentationImageData,a=null;else{const d=wl(e.id,n);if(!d)return null;const u=pm(e.id,n);if(!u)return null;const f=Ne.getImage(d);i=u.actor.getMapper().getInputData(),o=f.voxelManager;const h=t.imageId,g=Ne.getImage(h);if(!g)return null;a=g.getPixelData?.()}if(r.ensureImageVolumeFor3DManipulation)r.ensureImageVolumeFor3DManipulation({operationData:t,viewport:e}),c=t.imageVoxelManager,s=t.imageScalarData,l=t.imageData;else{const d=e.getCurrentImageId();if(!d)return null;const u=Ne.getImage(d);l=u?null:e.getImageData(),s=u?.getPixelData()||l.getScalarData(),c=u?.voxelManager}return{segmentationImageData:i,segmentationScalarData:a,imageScalarData:s,segmentationVoxelManager:o,imageVoxelManager:c,imageData:l}}function HC({operationData:t,viewport:e,strategy:r}){return t?"volumeId"in t&&t.volumeId!=null||"referencedVolumeId"in t&&t.referencedVolumeId!=null?Sie({operationData:t}):Tie({operationData:t,viewport:e,strategy:r}):null}function yd(t){const{representationData:e}=Ut(t);let{volumeId:r}=e.Labelmap,n;if(r&&(n=Ne.getVolume(r),n))return n;const{imageIds:i}=e.Labelmap;if(r=Ne.generateVolumeId(i),!(!i||i.length===0||!vl(i)))return n=J1(r,i),n}const z7={[ht.EnsureSegmentationVolumeFor3DManipulation]:t=>{const{operationData:e,viewport:r}=t,{segmentationId:n,imageIds:i}=e,o=r?r.getImageIds():i.map(c=>Ne.getImage(c).referencedImageId);if(!vl(o))throw new Error("Volume is not reconstructable for sphere manipulation");const s=yd(n);s&&(e.segmentationVoxelManager=s.voxelManager,e.segmentationImageData=s.imageData)}};function Lm(t){if(!t?.length||!vl(t))return;const r=Ne.generateVolumeId(t);let n=Ne.getVolume(r);return n||(n=J1(r,t),n)}const j7={[ht.EnsureImageVolumeFor3DManipulation]:t=>{const{operationData:e,viewport:r}=t;let n;if(r){if(n=r.getImageIds(),!vl(n))throw new Error("Volume is not reconstructable for sphere manipulation")}else n=Ut(e.segmentationId).representationData.Labelmap.imageIds.map(s=>Ne.getImage(s).referencedImageId);const i=Lm(n);if(!i)throw new Error("Failed to create or get image volume");e.imageVoxelManager=i.voxelManager,e.imageData=i.imageData}},os=(t,e)=>{Ye(Fe,$e.WEB_WORKER_PROGRESS,{progress:e,type:t})},H7=(t,e)=>{const r=Ut(t),{representationData:n}=r,{Labelmap:i}=n;if(!i)return console.debug("No labelmap found for segmentation",t),null;const o=i.volumeId,a=i.imageIds,s={segmentationId:t,volumeId:o,imageIds:a};let c=!1;if(a){const d=a.map(u=>Ne.getImage(u).referencedImageId);c=vl(d)}let l=e;return l?Array.isArray(l)||(l=[l,255]):l=[zi(t)],{operationData:s,segVolumeId:o,segImageIds:a,reconstructableVolume:c,indices:l}},X7=t=>HC({operationData:t,strategy:{ensureSegmentationVolumeFor3DManipulation:z7.ensureSegmentationVolumeFor3DManipulation,ensureImageVolumeFor3DManipulation:j7.ensureImageVolumeFor3DManipulation}}),K7=t=>{const e=[],r=[];for(const n of t){const i=Ne.getImage(n),o=i.getPixelData(),{origin:a,direction:s,spacing:c,dimensions:l}=em(i);e.push({scalarData:o,dimensions:l,spacing:c,origin:a,direction:s});const d=i.referencedImageId;if(d){const u=Ne.getImage(d);if(!u)continue;const f=u.getPixelData(),h=u.voxelManager,g=[u.rowPixelSpacing,u.columnPixelSpacing];r.push({scalarData:f,dimensions:h?h.dimensions:[u.columns,u.rows,1],spacing:g})}}return{segmentationInfo:e,imageInfo:r}},_ie=(t,e)=>{let r;if(t){const s=Ne.getVolume(t).imageIds,c=Ne.getImage(s[0]);c&&(r=c.referencedImageId)}else e?.length&&(r=Ne.getImage(e[0]).referencedImageId);const n=Ne.getImage(r),i=ut("scalingModule",r),o={isPreScaled:!!n?.preScale?.scaled,isSuvScaled:typeof i?.suvbw=="number"};return{refImageId:r,modalityUnitOptions:o}},{Labelmap:Eie}=yt;async function q7({segmentations:t}){Rm(),os(Co.GENERATE_CONTOUR_SETS,0);const{representationData:e,segments:r=[0,1],segmentationId:n}=t;let{volumeId:i}=e[Eie];if(!i){const g=yd(n);g&&(i=g.volumeId)}const o=Ne.getVolume(i);if(!o){console.warn(`No volume found for ${i}`);return}const c={scalarData:o.voxelManager.getCompleteScalarDataArray(),dimensions:o.dimensions,spacing:o.imageData.getSpacing(),origin:o.imageData.getOrigin(),direction:o.imageData.getDirection()},l=Array.isArray(r)?r.filter(g=>g!==null).map(g=>g.segmentIndex||g):Object.values(r).filter(g=>g!==null).map(g=>g.segmentIndex||g),d=await cc().executeTask("compute","generateContourSetsFromLabelmapVolume",{segmentation:c,indices:l,mode:"individual"}),u=o.imageIds.map(g=>{const p=Ne.getImage(g)?.referencedImageId;return p?Ne.getImage(p):void 0}),f=u.map(g=>em(g)),h=d.map(g=>{const p=r[g.segment.segmentIndex]||{};if(!g.sliceContours.length)return null;const v=g.sliceContours[0].polyData.points[0];let w;if(v){const m=f.findIndex(y=>{const{scanAxisNormal:C,origin:x}=y,S=Ya(C,x);return pD(v,S)});m!==-1&&(w=u[m].imageId)}return{label:p.label,color:p.color,metadata:{FrameOfReferenceUID:o.metadata.FrameOfReferenceUID,referencedImageId:w},sliceContours:g.sliceContours.map(m=>({contours:m.contours,polyData:m.polyData,FrameNumber:m.sliceIndex+1,sliceIndex:m.sliceIndex,FrameOfReferenceUID:o.metadata.FrameOfReferenceUID,referencedImageId:w}))}}).filter(g=>g!==null);return os(Co.GENERATE_CONTOUR_SETS,100),h}class Y7{constructor(){}static getContourSequence(e,r){const{data:n}=e,{projectionPoints:i,projectionPointsImageIds:o}=n.cachedStats;return i.map((a,s)=>{const c=bie(a),l=Die(o[s],r);return{NumberOfContourPoints:c.length/3,ContourImageSequence:l,ContourGeometricType:"CLOSED_PLANAR",ContourData:c}})}}Y7.toolName="RectangleROIStartEndThreshold";function bie(t){return[...t[0],...t[1],...t[3],...t[2]].flat().map(i=>i.toFixed(2))}function Die(t,e){const r=e.get("sopCommonModule",t);return{ReferencedSOPClassUID:r.sopClassUID,ReferencedSOPInstanceUID:r.sopInstanceUID}}function Iie(t){if(!t?.data)throw new Error("Tool data is empty");if(!t.metadata||!t.metadata.referencedImageId)throw new Error("Tool data is not associated with any imageId")}const Rf=class Rf{constructor(){}static convert(e,r,n){Iie(e);const{toolName:i}=e.metadata,o=Rf.TOOL_NAMES[i];if(!o)throw new Error(`Unknown tool type: ${i}, cannot convert to RTSSReport`);const a=o.getContourSequence(e,n),s=r.color?.slice(0,3)||[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255)];return{ReferencedROINumber:r.segmentIndex,ROIDisplayColor:s,ContourSequence:Array.isArray(a)?a:[a]}}static register(e){Rf.TOOL_NAMES[e.toolName]=e}};Rf.TOOL_NAMES={};let X0=Rf;X0.register(Y7);function Mie(t,e){Ho.acceptAutoGenerated(t,e)}const{isEqual:Oie}=hn;function Ry(t,e){const{polyline:r}=t.data.contour,{points:n}=t.data.handles,{length:i}=n;if(e===i)return r.length;if(e<0&&(e=(e+i)%i),e===0)return 0;const o=n[e],a=r.findIndex(c=>Oie(o,c));if(a!==-1)return a;let s=1/0;return r.reduce((c,l,d)=>{const u=k4(l,o);return u<s?(s=u,d):c},-1)}function J7(t,e){if(!t||t.length===0)return[];if(e<=0)return[];const r=[];for(let n=0;n<t.length;n++){const i=t[n];if(!i||i.length<3)continue;ym(i)&&Math.abs(zo(i))/100<e&&r.push(n)}return r}const Pie=Object.freeze(Object.defineProperty({__proto__:null,AnnotationToPointData:X0,acceptAutogeneratedInterpolations:Mie,areCoplanarContours:Yre,contourFinder:Zre,detectContourHoles:rie,findContourHoles:WC,findHandlePolylineIndex:Ry,findIslands:J7,generateContourSetsFromLabelmap:q7,getContourHolesDataCanvas:Kh,getContourHolesDataWorld:S7,getDeduplicatedVTKPolyDataPoints:Qre,updateContourPolyline:Sa},Symbol.toStringTag,{value:"Module"}));function Rie(t,e){const r=Ut(t);if(!r){console.warn(`Invalid segmentation given ${t}`);return}if(!r.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const n=qh(t,e);if(!n){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const i=Array.from(n?.keys()),o=i.map(s=>n.get(s)),a=WC(o);a?.length>0&&a.forEach(s=>{s.holeIndexes.forEach(c=>{const l=fn(i[c]);Pm(l)})})}function Aie(t,e,r={threshold:3}){const n=Ut(t);if(!n){console.warn(`Invalid segmentation given ${t}`);return}if(!n.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const i=qh(t,e);if(!i){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const o=Array.from(i?.keys()),a=o.map(c=>i.get(c)),s=J7(a,r.threshold);s?.length>0&&s.forEach(c=>{const l=fn(o[c]);Pm(l)})}function Lie(t,e,r={knotsRatioPercentage:30}){const n=Ut(t);if(!n){console.warn(`Invalid segmentation given ${t}`);return}if(!n.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const i=n.representationData.Contour,{annotationUIDsMap:o}=i;if(!o){console.warn(`No contours found for segmentation ${t}`);return}if(!o.has(e)){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}o.get(e).forEach(s=>{const c=fn(s);if(!c)return;const l=c.data.contour.polyline;if(!l||l.length<3)return;const d=f1(l,0,l.length-1,r.knotsRatioPercentage);c.data.contour.polyline=d})}function Nie(t,e,r,n){const i=Ut(t);if(!i){console.warn(`Invalid segmentation given ${t}`);return}if(!i.representationData.Contour){console.warn(`No contour representation found for segmentation ${t}`);return}const{annotationUIDsMap:o}=i?.representationData.Contour||{};if(!o){console.warn(`No annotation map found for segmentation ${t}`);return}const a=o?.get(e);if(!a){console.warn(`Segmentation index ${e} has no annotations in segmentation ${t}`);return}let s;if(r&&typeof n=="number"){const f=Ut(r);if(!f){console.warn(`Target segmentation ${r} does not exist.`);return}if(!f.representationData.Contour){console.warn(`No contour representation found for target segmentation ${r}`);return}s=f.representationData.Contour.annotationUIDsMap.get(n),s||(s=new Set,f.representationData.Contour.annotationUIDsMap.set(n,s))}const c=qh(t,e);if(!c){console.warn(`Error extracting contour data from segment ${e} in segmentation ${t}`);return}const l=Array.from(c?.keys()),d=l.map(f=>c.get(f)),u=WC(d);u?.length>0&&u.forEach(f=>{f.holeIndexes.forEach(h=>{const g=fn(l[h]);ud(g),r&&typeof n=="number"?s.add(g.annotationUID):a.add(g.annotationUID)})})}const Vie=Object.freeze(Object.defineProperty({__proto__:null,convertContourHoles:Nie,decimateContours:qre,extractSegmentPolylines:qh,getAnnotationMapFromSegmentation:D7,getAnnotationsUIDMapFromSegmentation:oh,getViewportAssociatedToSegmentation:pC,getViewportWithMatchingViewPlaneNormal:mC,removeCompleteContourAnnotation:Pm,removeContourHoles:Rie,removeContourIslands:Aie,smoothContours:Lie},Symbol.toStringTag,{value:"Module"}));function kie(t,e,r){const n=oh(t.segmentationId);if(!n)return;const i=n.get(e);i&&i.forEach(o=>{mm(o,r)})}function Fie(t,e){const r=Ut(t);if(!r)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=r;return n[e].locked}function Uie(t,e,r=!0){const n=Ut(t);if(!n)throw new Error(`No segmentation state found for ${t}`);const{segments:i}=n;i[e].locked=r,n?.representationData?.Contour&&kie(n,e,r),Ko(t)}function Bu(t){const e=Ut(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:r}=e;return Object.keys(r).filter(i=>r[i].locked).map(i=>parseInt(i))}const Bie=Object.freeze(Object.defineProperty({__proto__:null,getLockedSegmentIndices:Bu,isSegmentIndexLocked:Fie,setSegmentIndexLocked:Uie},Symbol.toStringTag,{value:"Module"}));function Gie(t,e){if(!t)throw new Error("addColorLUT: colorLUT is required");return Sf(t,e)}function Wie(t,e,r){if(!Bh(r))throw new Error(`setColorLUT: could not find colorLUT with index ${r}`);const n=Qi(t,{segmentationId:e});if(!n)throw new Error(`viewport specific state for viewport ${t} does not exist`);n.forEach(i=>{i.colorLUTIndex=r}),Ha(t,e)}function as(t,e,r){const n=Qi(t,{segmentationId:e});if(!n||n.length===0)return null;const i=n[0],{colorLUTIndex:o}=i,a=Bh(o);let s=a[r];if(!s){if(typeof r!="number")return console.warn(`Can't create colour for LUT index ${r}`),null;s=a[r]=[0,0,0,0]}return s}function Z7(t,e,r,n){const i=as(t,e,r);for(let o=0;o<n.length;o++)i[o]=n[o];Ha(t,e)}const $ie=Object.freeze(Object.defineProperty({__proto__:null,addColorLUT:Gie,getSegmentIndexColor:as,setColorLUT:Wie,setSegmentIndexColor:Z7},Symbol.toStringTag,{value:"Module"}));function Q7(t,e){return On.getSegmentationRepresentationVisibility(t,e)}function eM({segmentationId:t,segmentIndex:e,viewportId:r,autoGenerated:n=!1}){const i=as(r,t,e),o=Q7(r,{segmentationId:t,type:yt.Contour}),s=Ru(r)?.segmentationId===t,c=Zi.getRenderInactiveSegmentations(r),d=Zi.getStyle({viewportId:r,segmentationId:t,type:yt.Contour,segmentIndex:e});let u=1,f,h=1,g=0,p=d.renderFill??!0,v=d.renderOutline??!0;n?(u=d.outlineWidthAutoGenerated??u,f=d.outlineDashAutoGenerated??f,h=d.outlineOpacity??h,g=d.fillAlphaAutoGenerated??g):s?(u=d.outlineWidth??u,f=d.outlineDash??f,h=d.outlineOpacity??h,g=d.fillAlpha??g):(u=d.outlineWidthInactive??u,f=d.outlineDashInactive??f,h=d.outlineOpacityInactive??h,g=d.fillAlphaInactive??g,p=d.renderFillInactive??p,v=d.renderOutlineInactive??v),zi(t)===e&&(u+=d.activeSegmentOutlineWidthDelta),u=v?u:0,g=p?g:0;const w=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${h})`,m=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,C=!cC(r,{segmentationId:t,type:yt.Contour}).has(e);return{color:w,fillColor:m,lineWidth:u,fillOpacity:g,lineDash:f,textbox:{color:w},visibility:s?o&&C:c}}const Dx=class Dx extends Sre{constructor(e,r){super(e,r),this.configuration.interpolation?.enabled&&Ho.addTool(this.getToolName())}onSetToolConfiguration(){this.configuration.interpolation?.enabled?Ho.addTool(this.getToolName()):Ho.removeTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const r=e.detail,{element:n}=r,i=Ce(n);if(!i)return;const{viewport:o}=i,a=super.createAnnotation(e);if(!this.isContourSegmentationTool())return a;const s=Ru(o.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,l=zi(c);return kr(a,{data:{segmentation:{segmentationId:c,segmentIndex:l}}})}addAnnotation(e,r){const n=super.addAnnotation(e,r);return this.isContourSegmentationTool()&&ic(e),n}cancelAnnotation(e){this.isContourSegmentationTool()&&va(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const r=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return r;const n=this._getContourSegmentationStyle(e);return kr(r,n)}renderAnnotationInstance(e){const{annotation:r}=e,{invalidated:n}=r,i=super.renderAnnotationInstance(e);if(n&&this.isContourSegmentationTool()){const{segmentationId:o}=r.data.segmentation;ei(o);const s=Fu(o).map(c=>Qn(c).id);b7(s)}return i}filterInteractableAnnotationsForElement(e,r){if(!r||!r.length)return;const n=super.filterInteractableAnnotationsForElement(e,r);if(!n||!n.length)return;const i=Ce(e),{viewport:o}=i;return n.filter(a=>{const s=a?.data?.segmentation?.segmentationId;return s?!!On.getSegmentationRepresentation(o.id,{segmentationId:s,type:yt.Contour}):!0})}_getContourSegmentationStyle(e){const r=e.annotation,{segmentationId:n,segmentIndex:i}=r.data.segmentation,{viewportId:o}=e.styleSpecifier,a=Qi(o,{segmentationId:n});if(!a?.length)return{};a.length>1?a.find(v=>v.segmentationId===n&&v.type===yt.Contour):a[0];const{autoGenerated:s}=r,l=Bu(n).includes(i),{color:d,fillColor:u,lineWidth:f,fillOpacity:h,lineDash:g,visibility:p}=eM({segmentationId:n,segmentIndex:i,viewportId:o,autoGenerated:s});return{color:d,fillColor:u,lineWidth:f,fillOpacity:h,lineDash:g,textbox:{color:d},visibility:p,locked:l}}};Dx.PreviewSegmentIndex=255;let lh=Dx;function tM(t,e){const r=ut("generalSeriesModule",t);return fc(r.modality,t,e)}function fc(t,e,r){return t==="CT"?"HU":t==="PT"?zie(e,r):""}function zie(t,e){return e.isPreScaled?e.isSuvScaled?"SUV":ut("generalSeriesModule",t)?.modality==="PT"?ut("petSeriesModule",t)?.units||"unitless":"unknown":"raw"}const{pointCanProjectOnLine:r_}=yl,{EPSILON:jie}=pl,Hie=1-jie,Af=class Af extends lh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:jr.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:Xie,statsCalculator:is}}){super(e,r),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=n=>{const i=n.detail,{element:o}=i,a=this.createAnnotation(n);this.addAnnotation(a,o);const s=vt(o,this.getToolName());return this.activateDraw(n,a,s),n.preventDefault(),Me(s),a},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,c=vt(s,this.getToolName());this.activateOpenContourEndEdit(n,i,c,o)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o,s=vt(a,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(n,i,s):this.activateOpenContourEdit(n,i,s),n.preventDefault()},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{polyline:l}=i.data.contour;let d=c.worldToCanvas(l[0]);for(let h=1;h<l.length;h++){const g=d,p=c.worldToCanvas(l[h]);if(r_(o,g,p,a))return!0;d=p}if(!i.data.contour.closed)return!1;const u=c.worldToCanvas(l[0]),f=c.worldToCanvas(l[l.length-1]);return r_(o,u,f,a)},this.cancel=n=>{const i=this.isDrawing,o=this.isEditingOpen,a=this.isEditingClosed;i?this.cancelDrawing(n):o?this.cancelOpenContourEdit(n):a&&this.cancelClosedContourEdit(n)},this._calculateCachedStats=(n,i,o,a)=>{const{data:s}=n,{cachedStats:c}=s,{polyline:l,closed:d}=s.contour,u=Object.keys(c);for(let h=0;h<u.length;h++){const g=u[h],p=this.getTargetImageData(g);if(!p)continue;const{imageData:v,metadata:w}=p,m=l.map(ae=>i.worldToCanvas(ae)),y={isPreScaled:dc(i,g),isSuvScaled:this.isSuvScaled(i,g,n.metadata.referencedImageId)},C=fc(w.Modality,n.metadata.referencedImageId,y),x=s.contour.polyline,S=x.length,T=new Array(S);for(let ae=0;ae<S;ae++)T[ae]=i.worldToCanvas(x[ae]);const{maxX:_,maxY:E,minX:D,minY:b}=gl(T),I=i.canvasToWorld([D,b]),O=br(v,I),M=i.canvasToWorld([_,E]),R=br(v,M),G=_o(p,[O,R]),k=m[0],L=i.canvasToWorld(k),F=i.canvasToWorld([k[0]+1,k[1]]),j=i.canvasToWorld([k[0],k[1]+1]),Y=Dr(L,F),ie=Dr(L,j),de={targetId:g,viewport:i,canvasCoordinates:m,points:l,imageData:v,metadata:w,cachedStats:c,modalityUnit:C,calibratedScale:G,deltaInX:Y,deltaInY:ie};d?this.updateClosedCachedStats(de):this.updateOpenCachedStats(de)}const f=n.invalidated;return n.invalidated=!1,f&&Gt(n,a.viewport.element,At.StatsUpdated),c},this._renderStats=(n,i,o,a)=>{const{data:s}=n,c=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:o.viewport.id,annotationUID:n.annotationUID},d=this.getLinkedTextBoxStyle(l,n);if(!d.visibility)return;const u=this.configuration.getTextLines(s,c);if(!u||u.length===0)return;const f=s.contour.polyline.map(C=>i.worldToCanvas(C));if(!s.handles.textBox.hasMoved){const C=to(f);s.handles.textBox.worldPosition=i.canvasToWorld(C)}const h=i.worldToCanvas(s.handles.textBox.worldPosition),p=gi(a,n.annotationUID??"","1",u,h,f,{},d),{x:v,y:w,width:m,height:y}=p;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([v,w]),topRight:i.canvasToWorld([v+m,w]),bottomLeft:i.canvasToWorld([v,w+y]),bottomRight:i.canvasToWorld([v+m,w+y])}},_ne(this),Rne(this),Wne(this),tre(this),ire(this),mre(this),this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,r){if(!r?.length)return[];const n=super.filterInteractableAnnotationsForElement(e,r);if(!n?.length)return[];const i=Ce(e),{viewport:o}=i;let a;if(o instanceof Gn){const s=o.getCamera(),{spacingInNormalDirection:c}=ad(o,s);a=this.filterAnnotationsWithinSlice(n,s,c)}else a=Hh(o,r);return a}filterAnnotationsWithinSlice(e,r,n){const{viewPlaneNormal:i}=r,o=e.filter(l=>{let d=l.metadata.viewPlaneNormal;if(!l.metadata.referencedImageId&&!d&&l.metadata.FrameOfReferenceUID){for(const f of l.data.contour.polyline){const h=rn(Ie(),f,r.focalPoint),g=ft(h,r.viewPlaneNormal);if(!Et(g,0))return!1}return l.metadata.viewPlaneNormal=r.viewPlaneNormal,l.metadata.cameraFocalPoint=r.focalPoint,!0}if(!d){const{referencedImageId:f}=l.metadata,{imageOrientationPatient:h}=ut("imagePlaneModule",f),g=mt(h[0],h[1],h[2]),p=mt(h[3],h[4],h[5]);d=Ie(),tn(d,g,p),l.metadata.viewPlaneNormal=d}const u=Math.abs(ft(i,d))>Hie;return d&&u});if(!o.length)return[];const a=n/2,{focalPoint:s}=r,c=[];for(const l of o){const u=l.data.contour.polyline[0];if(!l.isVisible)continue;const f=Ie();rn(f,s,u);const h=ft(f,i);Math.abs(h)<a&&c.push(l)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const r=e.detail.currentPoints.world,n=super.createAnnotation(e),i=a=>{a.data.handles.points.length=0};return kr(n,{data:{contour:{polyline:[[...r]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:r,targetId:n,svgDrawingHelper:i}=e,o=e.annotation;let a=!1;const{viewport:s,renderingEngine:c}=r,l=this.isDrawing,d=this.isEditingOpen,u=this.isEditingClosed;if(!(l||d||u))this.configuration.displayOnePointAsCrosshairs&&o.data.contour.polyline.length===1?this.renderPointContourWithMarker(r,i,o):this.renderContour(r,i,o);else{const f=this.commonData.annotation.annotationUID;if(o.annotationUID===f)if(l)this.renderContourBeingDrawn(r,i,o);else if(u)this.renderClosedContourBeingEdited(r,i,o);else if(d)this.renderOpenContourBeingEdited(r,i,o);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&o.data.contour.polyline.length===1?this.renderPointContourWithMarker(r,i,o):this.renderContour(r,i,o);a=!0}if(this.configuration.calculateStats)return o.invalidated&&this._calculateStatsIfActive(o,n,s,c,r),this._renderStats(o,s,r,i),a}_calculateStatsIfActive(e,r,n,i,o){const a=this.commonData?.annotation.annotationUID;if(!(e.annotationUID===a&&!this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:s}=e;s.cachedStats[r]?.unit?e.invalidated&&this._throttledCalculateCachedStats(e,n,i,o):(s.cachedStats[r]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,unit:null},this._calculateCachedStats(e,n,i,o))}}updateClosedCachedStats({viewport:e,points:r,imageData:n,metadata:i,cachedStats:o,targetId:a,modalityUnit:s,canvasCoordinates:c,calibratedScale:l,deltaInX:d,deltaInY:u}){const{scale:f,areaUnit:h,unit:g}=l,{voxelManager:p}=e.getImageData(),v=r.map(Y=>n.worldToIndex(Y));let w=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER,y=Number.MAX_SAFE_INTEGER,C=Number.MIN_SAFE_INTEGER,x=Number.MAX_SAFE_INTEGER,S=Number.MIN_SAFE_INTEGER;for(let Y=0;Y<r.length;Y++){const ie=v[Y].map(Math.floor);w=Math.min(w,ie[0]),m=Math.max(m,ie[0]),y=Math.min(y,ie[1]),C=Math.max(C,ie[1]),x=Math.min(x,ie[2]),S=Math.max(S,ie[2])}let T=$h(c)/f/f;T*=d*u;const _=Af.calculateLengthInIndex(l,v,closed),E=.01*(m-w),D=.01*(C-y),b=.01*(S-x);w=Math.floor(w-E),m=Math.ceil(m+E),y=Math.floor(y-D),C=Math.ceil(C+D),x=Math.floor(x-b),S=Math.ceil(S+b);const I=[[w,m],[y,C],[x,S]],O=n.indexToWorld([m,C,S]),M=e.worldToCanvas(O);let R=0,A=[],G=0,k;p&&(k=p.forEach(this.configuration.statsCalculator.statsCallback,{imageData:n,isInObject:(Y,ie)=>{let de=!0;const ae=e.worldToCanvas(Y);return ae[1]!=R&&(G=0,R=ae[1],A=Y9(c,ae,[M[0],ae[1]]),A.sort((function(fe){return function(we,_e){return we[fe]===_e[fe]?0:we[fe]<_e[fe]?-1:1}})(0))),A.length&&ae[0]>A[0][0]&&(A.shift(),G++),G%2===0&&(de=!1),de},boundsIJK:I,returnPoints:this.configuration.storePointData}));const L=this.configuration.statsCalculator.getStatistics(),F={name:"area",value:T,unit:h,type:Wo.Area},j={name:"perimeter",value:_,unit:g,type:Wo.Linear};o[a]={Modality:i.Modality,area:T,perimeter:_,mean:L.mean?.value,max:L.max?.value,min:L.min?.value,stdDev:L.stdDev?.value,statsArray:[F,j,...L.array],pointsInShape:k,areaUnit:h,modalityUnit:s,unit:g}}updateOpenCachedStats({targetId:e,metadata:r,cachedStats:n,modalityUnit:i,calibratedScale:o,imageData:a,points:s}){const{unit:c}=o,l=s.map(f=>a.worldToIndex(f)),d=Af.calculateLengthInIndex(o,l),u={name:"length",value:d,unit:c,type:Wo.Linear};n[e]={Modality:r.Modality,length:d,modalityUnit:i,unit:c,statArray:[u]}}};Af.toolName="PlanarFreehandROI";let g1=Af;function Xie(t,e){const r=t.cachedStats[e],{area:n,mean:i,stdDev:o,length:a,perimeter:s,max:c,min:l,isEmptyArea:d,unit:u,areaUnit:f,modalityUnit:h}=r||{},g=[];if(nr(n)){const p=d?"Area: Oblique not supported":`Area: ${Ht(n)} ${f}`;g.push(p)}return nr(i)&&g.push(`Mean: ${Ht(i)} ${h}`),nr(c)&&g.push(`Max: ${Ht(c)} ${h}`),nr(l)&&g.push(`Min: ${Ht(l)} ${h}`),nr(o)&&g.push(`Std Dev: ${Ht(o)} ${h}`),nr(s)&&g.push(`Perimeter: ${Ht(s)} ${u}`),nr(a)&&g.push(`${Ht(a)} ${u}`),g}const P1=class P1 extends g1{constructor(e){const r=kr({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(r)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const r=e.annotation,{invalidated:n}=r,i=super.renderAnnotationInstance(e);if(n){const{segmentationId:o}=r.data.segmentation;ei(o)}return i}};P1.toolName="PlanarFreehandContourSegmentationTool",X0.register(P1);let K0=P1;const Kie={[yt.Labelmap]:RC,[yt.Contour]:PC,[yt.Surface]:lC},Rg=K0.toolName;class qie{constructor(){this._needsRender=new Set,this._pendingRenderQueue=[],this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>eo().flatMap(r=>r.getViewports()),this._renderFlaggedSegmentations=()=>{if(this._throwIfDestroyed(),Array.from(this._needsRender).forEach(r=>{this._triggerRender(r)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._pendingRenderQueue.length>0){const r=this._pendingRenderQueue.shift();r&&r.length>0&&this._setViewportsToBeRenderedNextFrame(r)}}}renderSegmentationsForViewport(e){const r=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(r)}renderSegmentation(e){const r=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(r)}_getViewportIdsForSegmentation(e){const r=this._getAllViewports(),n=[];for(const i of r){const o=i.id;e?Qi(o,{segmentationId:e})?.length>0&&n.push(o):Qi(o)?.length>0&&n.push(o)}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){if(this._animationFrameSet){this._pendingRenderQueue.push(e);return}e.forEach(r=>{this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const r=Qi(e);if(!r?.length)return;const{viewport:n}=wn(e)||{};if(!n)return;const i=r.map(o=>{o.type===yt.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const a=Kie[o.type],c=Ut(o.segmentationId).representationData[o.type]!==void 0;try{a.render(n,o).then(()=>{c||$C(n,o.segmentationId,o.type)})}catch(l){console.error(l)}return Promise.resolve({segmentationId:o.segmentationId,type:o.type})});Promise.allSettled(i).then(o=>{const a=o.filter(l=>l.status==="fulfilled").map(l=>l.value);function s(l){const{element:d,viewportId:u}=l.detail;d.removeEventListener($e.IMAGE_RENDERED,s),a.forEach(f=>{const h={viewportId:u,segmentationId:f.segmentationId,type:f.type};Ye(Fe,V.SEGMENTATION_RENDERED,{...h})})}n.element.addEventListener($e.IMAGE_RENDERED,s),n.render()})}_addPlanarFreeHandToolIfAbsent(e){Rg in Ue.tools||Zw(K0);const r=Qn(e.id);r.hasTool(Rg)||(r.addTool(Rg),r.setToolPassive(Rg))}}function wd(t){nM.renderSegmentationsForViewport(t)}function Nm(t){nM.renderSegmentation(t)}const nM=new qie;function Yie({modifiedSlicesToUse:t,representationData:e,type:r}){const n=Ne.getVolume(e[r].volumeId);if(!n){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:o}=n;let a;if(t?.length>0)a=t;else{const s=i.getDimensions()[2];a=[...Array(s).keys()]}a.forEach(s=>{o.setUpdatedFrame(s)}),i.modified()}function Jie({viewportIds:t,segmentationId:e}){t.forEach(r=>{let n=Qi(r,{segmentationId:e});n=n.filter(i=>i.type===yt.Labelmap),n.forEach(i=>{if(i.segmentationId!==e)return;const o=wn(r);if(!o)return;const{viewport:a}=o;if(a instanceof Gn)return;const s=Cf(r,e);s?.length&&s.forEach((c,l)=>{const d=c.actor.getMapper().getInputData(),u=sc(r,e),f=Ne.getImage(u[l]);d.modified(),nm(d,f)})})})}const Zie=function(t){const{segmentationId:e,modifiedSlicesToUse:r}=t.detail,{representationData:n}=Ut(e),i=Fu(e),o=i.some(c=>{const{viewport:l}=wn(c);return l instanceof Gn}),a=i.some(c=>{const{viewport:l}=wn(c);return l instanceof Wn}),s=o&&a;i.forEach(c=>{const{viewport:l}=wn(c);l instanceof Gn&&Yie({modifiedSlicesToUse:s?[]:r,representationData:n,type:yt.Labelmap}),l instanceof Wn&&Jie({viewportIds:i,segmentationId:e})})},rM=function(t){const{segmentationId:e}=t.detail,{representationData:r}=Ut(e);r.Labelmap&&Zie(t),Nm(e)},iM=function(t){const{segmentationId:e}=t.detail;Nm(e)},Qie=function(t){if(!t)return;const e=Ce(t);if(!e)return;const{viewport:r}=e;r instanceof Zn||(t.addEventListener($e.PRE_STACK_NEW_IMAGE,uh),t.addEventListener($e.IMAGE_RENDERED,uh))},eoe=function(t){t.removeEventListener($e.PRE_STACK_NEW_IMAGE,uh),t.removeEventListener($e.IMAGE_RENDERED,uh)};function uh(t){const e=t.detail,{viewportId:r,renderingEngineId:n}=e,{viewport:i}=Ln(r,n),o=Qi(r);if(!o?.length)return;const a=o.filter(l=>l.type===yt.Labelmap),s=i.getActors();a.forEach(l=>{const{segmentationId:d}=l;G7(r,d)});const c=a.flatMap(l=>Cf(r,l.segmentationId)).filter(l=>l!==void 0);c.length&&(c.forEach(l=>{a.find(u=>sc(r,u.segmentationId)?.includes(l.referencedId))||i.removeActors([l.uid])}),a.forEach(l=>{const{segmentationId:d}=l,u=i.getCurrentImageId(),f=sc(r,d);if(!f)return;let h=!1;const g=p=>{const v=Ne.getImage(p);if(!v){console.warn("No derived image found in the cache for segmentation representation",l);return}const w=s.find(m=>m.referencedId===p);if(w){const m=w.actor.getMapper().getInputData();m.setDerivedImage?m.setDerivedImage(v):nm(m,v)}else{const{dimensions:m,spacing:y,direction:C}=i.getImageDataMetadata(v),x=Ne.getImage(u)||{imageId:u},{origin:S}=i.getImageDataMetadata(x),T=S,_=v.voxelManager.getConstructor(),E=v.voxelManager.getScalarData(),D=Ot.newInstance({name:"Pixels",numberOfComponents:1,values:new _(E)}),b=Rh.newInstance();b.setDimensions(m[0],m[1],1),b.setSpacing(y),b.setDirection(C),b.setOrigin(T),b.getPointData().setScalars(D),b.modified(),i.addImages([{imageId:p,representationUID:`${d}-${yt.Labelmap}-${v.imageId}`,callback:({imageActor:I})=>{I.getMapper().setInputData(b)}}]),h=!0;return}};f.forEach(g),h&&wd(r),i.render(),t.type===$e.IMAGE_RENDERED&&i.element.removeEventListener($e.IMAGE_RENDERED,uh)}))}const oM={enable:Qie,disable:eoe};async function toe(t){const e=t.detail.annotation;if(!gd(e))return;const r=roe(e),n=ioe(r,e);if(!n.length){Ye(Fe,V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:r.element,sourceAnnotation:e});return}const i=So(e.data.contour.polyline,r),o=d7(r,i,n);if(!o.length){Ye(Fe,V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,{element:r.element,sourceAnnotation:e});return}if(o.length>1){f7(r,e,i,o);return}const{targetAnnotation:a,targetPolyline:s,isContourHole:c}=o[0];if(c){const{contourHoleProcessingEnabled:l=!1}=t.detail;if(!l)return;_m(r,a,e)}else EC(r,a,s,e,i)}function noe(t,e=!1){const r="PlanarFreehandContourSegmentationTool",n=Qn(t.id,t.renderingEngineId);let i;return n?n.hasTool(r)?n.getToolOptions(r)||(i=`Tool ${r} must be in active/passive state in ${n.id} toolGroup`):i=`Tool ${r} not added to ${n.id} toolGroup`:i=`ToolGroup not found for viewport ${t.id}`,i&&!e&&console.warn(i),!i}function roe(t){const e=OC(t);return e.find(n=>noe(n,!0))??e[0]}function ioe(t,e){const{annotationUID:r}=e;return ld().filter(i=>i.annotationUID&&i.annotationUID!==r&&gd(i)&&T9(i,e)&&t.isReferenceViewable(i.metadata))}function ooe(t){const e=t.detail.annotation;va(e)}function aM(t){const e=t.detail.annotation;gd(e)&&toe(t)}function p1(t){if(!t.detail.removed.length)return;eo().forEach(n=>{const o=n.getViewports().map(a=>a.id);Me(o)})}function sM(t){const{viewportId:e}=t.detail;Me([e])}function cM(t){const e=t.detail.annotation;gd(e)&&ooe(t)}const lM=function(t){hd(t.detail.element)},aoe=function(t){t.addEventListener($e.IMAGE_RENDERED,lM)},soe=function(t){t.removeEventListener($e.IMAGE_RENDERED,lM)},uM={enable:aoe,disable:soe},{Active:coe}=Cn;function Cd(t,e,r){if(Ue.isInteractingWithTool)return!1;const{renderingEngineId:n,viewportId:i}=r.detail,o=Qn(i,n);if(!o)return!1;let a;const s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],d=o.toolOptions[l],u=o.getToolInstance(l);if(d.mode===coe&&typeof u[e]=="function"){a=o.getToolInstance(l);break}}a&&a[e](r)}const dM=Cd.bind(null,"Mouse","mouseClickCallback"),fM=Cd.bind(null,"Mouse","doubleClickCallback");function hM(t,e,r,n="mouse"){const i=n==="touch"?36:6,o=[];return e.forEach(({tool:a,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const l=a.getHandleNearImagePoint(t,c,r,i);if(l){o.push({tool:a,annotation:c,handle:l});break}}}),o}function Yh(t,e){const r=[];for(let n=0;n<e.length;n++){const i=e[n];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let o=$t(i.constructor.toolName,t);o?.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(o=i.filterInteractableAnnotationsForElement(t,o)),o?.length>0&&r.push({tool:i,annotations:o}))}return r}function XC(t,e,r,n="mouse"){const i=n==="touch"?36:6,o=[];return e.forEach(({tool:a,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(a.isPointNearTool(t,c,r,i,n)){o.push({tool:a,annotation:c});break}}}),o}const{Active:loe}=Cn;function Vm(t){const{renderingEngineId:e,viewportId:r,event:n}=t.detail,i=md(n)||dd.getModifierKey(),o=Qn(r,e);if(!o)return null;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary(),c=t.detail.buttons??n?.buttons??s;for(let l=0;l<a.length;l++){const d=a[l],u=o.toolOptions[d],f=u.bindings.length&&u.bindings.some(h=>h.mouseButton===c&&h.modifierKey===i);if(u.mode===loe&&f)return o.getToolInstance(d)}}function q0(t,e,r){const{renderingEngineId:n,viewportId:i}=t.detail,o=Qn(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],d=o.toolOptions[l],u=r!=null&&d.bindings.length&&d.bindings.some(f=>f.mouseButton===r);if(e.includes(d.mode)&&(!r||u)){const f=o.getToolInstance(l);a.push(f)}}return a}function uoe(t,e){const r=new Map,{renderingEngineId:n,viewportId:i}=t.detail,o=Qn(i,n);if(!o)return r;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary(),c=t.detail.event,l=c?.buttons??s,d=md(c)||dd.getModifierKey();for(let u=0;u<a.length;u++){const f=a[u],h=o.getToolInstance(f),g=h.configuration?.actions??{},p=Object.values(g);if(!p?.length||!e.includes(h.mode))continue;const v=p.find(w=>w.bindings?.length&&w.bindings.some(m=>m.mouseButton===l&&m.modifierKey===d));v&&r.set(h,v)}return r}const{Active:doe,Passive:foe}=Cn;function hoe(t){if(Ue.isInteractingWithTool)return!1;const e=t.detail,{element:r}=e,n=Ce(r),{canvas:i}=e.currentPoints;if(!n)return!1;const o=uoe(t,[doe,foe]),a=Array.from(o.keys()),s=Yh(r,a),c=XC(r,s,i);if(c.length>0){const{tool:l,annotation:d}=c[0],u=o.get(l);return(typeof u.method=="string"?l[u.method]:u.method).call(l,t,d),!0}return!1}const{Active:goe,Passive:poe}=Cn;function gM(t){if(Ue.isInteractingWithTool)return;const e=Vm(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const r=t.detail.event.buttons===1,n=q0(t,[goe],t.detail.event.buttons),i=r?q0(t,[poe]):void 0,o=[...n||[],...i||[]];if(hoe(t))return;const s=t.detail,{element:c}=s,l=Yh(c,o),d=s.currentPoints.canvas,u=hM(c,l,d,"mouse"),f=!!t.detail.event.shiftKey;if(u.length>0){const{tool:g,annotation:p,handle:v}=i_(u);o_(p.annotationUID,f),g.handleSelectedCallback(t,p,v,"Mouse");return}const h=XC(c,l,d,"mouse");if(h.length>0){const{tool:g,annotation:p}=i_(h);o_(p.annotationUID,f),g.toolSelectedCallback(t,p,"Mouse",d);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function i_(t){if(t.length>1){const e=t.find(r=>{const n=!ir(r.annotation.annotationUID),i=or(r.annotation.annotationUID);return n&&i});if(e)return e}return t[0]}function o_(t,e=!1){e?Gh(t)?$o(t,!1):$o(t,!0,!0):$o(t,!0,!1)}function pM(t){if(Ue.isInteractingWithTool)return;const e=Vm(t);if(e&&!Ue.isMultiPartToolActive&&e.addNewAnnotation){const r=e.addNewAnnotation(t,"mouse");$o(r.annotationUID)}}function mM(t){if(Ue.isInteractingWithTool)return;const e=Vm(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:moe,Passive:voe}=Cn;function vM(t){if(Ue.isInteractingWithTool||Ue.isMultiPartToolActive)return;const e=q0(t,[moe,voe]),r=t.detail,{element:n}=r,i=Yh(n,e),o=e.filter(s=>!i.some(l=>l.tool.getToolName()===s.getToolName()));let a=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(a=s.mouseMoveCallback(t,c)||a);o.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),a===!0&&hd(n)}const yM=Cd.bind(null,"Mouse","mouseUpCallback");function wM(t){if(Ue.isInteractingWithTool)return;t.detail.buttons=rs.Wheel|(t.detail.event.buttons||0);const e=Vm(t);if(e)return e.mouseWheelCallback(t)}const yoe=function(t){t.addEventListener(V.MOUSE_CLICK,dM),t.addEventListener(V.MOUSE_DOWN,gM),t.addEventListener(V.MOUSE_DOWN_ACTIVATE,pM),t.addEventListener(V.MOUSE_DOUBLE_CLICK,fM),t.addEventListener(V.MOUSE_DRAG,mM),t.addEventListener(V.MOUSE_MOVE,vM),t.addEventListener(V.MOUSE_UP,yM),t.addEventListener(V.MOUSE_WHEEL,wM)},woe=function(t){t.removeEventListener(V.MOUSE_CLICK,dM),t.removeEventListener(V.MOUSE_DOWN,gM),t.removeEventListener(V.MOUSE_DOWN_ACTIVATE,pM),t.removeEventListener(V.MOUSE_DOUBLE_CLICK,fM),t.removeEventListener(V.MOUSE_DRAG,mM),t.removeEventListener(V.MOUSE_MOVE,vM),t.removeEventListener(V.MOUSE_UP,yM),t.removeEventListener(V.MOUSE_WHEEL,wM)},CM={enable:yoe,disable:woe},{Active:Coe}=Cn;function xM(t){const{renderingEngineId:e,viewportId:r}=t.detail,n=FZ(),i=dd.getModifierKey(),o=Qn(r,e);if(!o)return null;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary();for(let c=0;c<a.length;c++){const l=a[c],d=o.toolOptions[l];if(d.mode!==Coe)continue;if(d.bindings.length&&d.bindings.some(f=>f.mouseButton===(n??s)&&f.modifierKey===i))return o.getToolInstance(l)}}function xoe(t,e){const r=new Map,{renderingEngineId:n,viewportId:i}=t.detail,o=Qn(i,n);if(!o)return r;const a=Object.keys(o.toolOptions),s=t.detail.key;for(let c=0;c<a.length;c++){const l=a[c],d=o.getToolInstance(l),u=d.configuration?.actions;if(!u)continue;const f=Object.values(u);if(!f?.length||!e.includes(d.mode))continue;const h=f.find(g=>g.bindings?.some(p=>p.key===s));h&&r.set(d,h)}return r}function SM(t){const e=xM(t);if(e){const{renderingEngineId:n,viewportId:i}=t.detail,o=Qn(i,n),a=e.getToolName();Object.keys(o.toolOptions).includes(a)&&o.setViewportsCursorByToolName(a)}const r=xoe(t,[Cn.Active]);if(r?.size){const{element:n}=t.detail;for(const[i,o]of[...r.entries()])(typeof o.method=="function"?o.method:i[o.method]).call(i,n,o,t)}}function TM(t){const e=xM(t);if(!e)return;const{renderingEngineId:r,viewportId:n}=t.detail,i=Qn(n,r);p9();const o=e.getToolName();Object.keys(i.toolOptions).includes(o)&&i.setViewportsCursorByToolName(o)}const Soe=function(t){t.addEventListener(V.KEY_DOWN,SM),t.addEventListener(V.KEY_UP,TM)},Toe=function(t){t.removeEventListener(V.KEY_DOWN,SM),t.removeEventListener(V.KEY_UP,TM)},_M={enable:Soe,disable:Toe},{Active:_oe,Passive:Eoe,Enabled:boe}=Cn,EM=function(t){q0(t,[_oe,Eoe,boe]).forEach(r=>{r.onCameraModified&&r.onCameraModified(t)})},Doe=function(t){t.addEventListener($e.CAMERA_MODIFIED,EM)},Ioe=function(t){t.removeEventListener($e.CAMERA_MODIFIED,EM)},bM={enable:Doe,disable:Ioe},{Active:Moe,Passive:Ooe,Enabled:Poe}=Cn,DM=function(t){q0(t,[Moe,Ooe,Poe]).forEach(r=>{r.onImageSpacingCalibrated&&r.onImageSpacingCalibrated(t)})},Roe=function(t){t.addEventListener($e.IMAGE_SPACING_CALIBRATED,DM)},Aoe=function(t){t.removeEventListener($e.IMAGE_SPACING_CALIBRATED,DM)},IM={enable:Roe,disable:Aoe},{Active:Loe}=Cn;function KC(t){const{renderingEngineId:e,viewportId:r}=t.detail,n=t.detail.event,i=Qn(r,e);if(!i)return null;const o=Object.keys(i.toolOptions),a=Object.keys(n.touches).length,s=md(n)||dd.getModifierKey(),c=i.getDefaultMousePrimary();for(let l=0;l<o.length;l++){const d=o[l],u=i.toolOptions[d],f=u.bindings.length&&u.bindings.some(h=>(h.numTouchPoints===a||a===1&&h.mouseButton===c)&&h.modifierKey===s);if(u.mode===Loe&&f)return i.getToolInstance(d)}}function a_(t,e,r){const{renderingEngineId:n,viewportId:i}=t.detail,o=Qn(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],d=o.toolOptions[l],u=r!=null&&d.bindings.length&&d.bindings.some(f=>f.numTouchPoints===r);if(e.includes(d.mode)&&(!r||u)){const f=o.getToolInstance(l);a.push(f)}}return a}const{Active:Noe,Passive:Voe}=Cn;function MM(t){if(Ue.isInteractingWithTool)return;const e=KC(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const r=Object.keys(t.detail.event.touches).length===1,n=a_(t,[Noe],Object.keys(t.detail.event.touches).length),i=r?a_(t,[Voe]):void 0,o=[...n||[],...i||[],e],a=t.detail,{element:s}=a,c=Yh(s,o),l=a.currentPoints.canvas,d=hM(s,c,l,"touch"),u=!1;if(d.length>0){const{tool:h,annotation:g,handle:p}=s_(d);c_(g.annotationUID,u),h.handleSelectedCallback(t,g,p,"Touch");return}const f=XC(s,c,l,"touch");if(f.length>0){const{tool:h,annotation:g}=s_(f);c_(g.annotationUID,u),h.toolSelectedCallback(t,g,"Touch",l);return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function s_(t){return t.length>1&&t.find(e=>!ir(e.annotation.annotationUID)&&or(e.annotation.annotationUID))||t[0]}function c_(t,e=!1){e?Gh(t)?$o(t,!1):$o(t,!0,!0):$o(t,!0,!1)}function OM(t){if(Ue.isInteractingWithTool)return;const e=KC(t);if(e&&!Ue.isMultiPartToolActive&&e.addNewAnnotation){const r=e.addNewAnnotation(t,"touch");$o(r.annotationUID)}}function PM(t){if(Ue.isInteractingWithTool)return;const e=KC(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const RM=Cd.bind(null,"Touch","touchEndCallback"),koe=Cd.bind(null,"Touch","touchTapCallback"),AM=Cd.bind(null,"Touch","touchPressCallback"),Foe=function(t){t.addEventListener(V.TOUCH_START,MM),t.addEventListener(V.TOUCH_START_ACTIVATE,OM),t.addEventListener(V.TOUCH_DRAG,PM),t.addEventListener(V.TOUCH_END,RM),t.addEventListener(V.TOUCH_TAP,koe),t.addEventListener(V.TOUCH_PRESS,AM)},Uoe=function(t){t.removeEventListener(V.TOUCH_START,MM),t.removeEventListener(V.TOUCH_START_ACTIVATE,OM),t.removeEventListener(V.TOUCH_DRAG,PM),t.removeEventListener(V.TOUCH_END,RM),t.removeEventListener(V.TOUCH_PRESS,AM)},LM={enable:Foe,disable:Uoe},Boe=function(){Fe.addEventListener(V.ANNOTATION_COMPLETED,Ho.handleAnnotationCompleted),Fe.addEventListener(V.ANNOTATION_MODIFIED,Ho.handleAnnotationUpdate),Fe.addEventListener(V.ANNOTATION_REMOVED,Ho.handleAnnotationDelete)},Goe=function(){Fe.removeEventListener(V.ANNOTATION_COMPLETED,Ho.handleAnnotationCompleted),Fe.removeEventListener(V.ANNOTATION_MODIFIED,Ho.handleAnnotationUpdate),Fe.removeEventListener(V.ANNOTATION_REMOVED,Ho.handleAnnotationDelete)},NM={enable:Boe,disable:Goe},{Active:Woe,Passive:$oe,Enabled:zoe}=Cn,VM=function(t){q0(t,[Woe,$oe,zoe]).forEach(r=>{r.onResetCamera&&r.onResetCamera(t)})},joe=function(t){t.addEventListener($e.CAMERA_RESET,VM)},Hoe=function(t){t.removeEventListener($e.CAMERA_RESET,VM)},kM={enable:joe,disable:Hoe};function qC(t){const{element:e,viewportId:r}=t.detail,n=Xoe(r);Koe(e),qoe(n,e),_C.addViewportElement(r,e),KI.enable(e),h9.enable(e),u9.enable(e),dd.enable(e),oM.enable(e),uM.enable(e),bM.enable(e),IM.enable(e),kM.enable(e),CM.enable(e),_M.enable(e),LM.enable(e),Ue.enabledElements.push(e)}function Xoe(t){const e="http://www.w3.org/2000/svg",r=document.createElementNS(e,"svg"),n=`svg-layer-${t}`;r.classList.add("svg-layer"),r.setAttribute("id",n),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.style.width="100%",r.style.height="100%",r.style.pointerEvents="none",r.style.position="absolute";const i=document.createElementNS(e,"defs"),o=document.createElementNS(e,"filter"),a=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return o.setAttribute("id",`shadow-${n}`),o.setAttribute("filterUnits","userSpaceOnUse"),a.setAttribute("result","offOut"),a.setAttribute("in","SourceGraphic"),a.setAttribute("dx","0.5"),a.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),o.appendChild(a),o.appendChild(s),o.appendChild(c),i.appendChild(o),r.appendChild(i),r}function Koe(t){const{viewportUid:e,renderingEngineUid:r}=t.dataset,n=`${e}:${r}`;Ue.svgNodeCache[n]={}}function qoe(t,e){e.querySelector("div.viewport-element").appendChild(t)}function FM(t,e){const r=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let n=0;n<Ue.synchronizers.length;n++){const i=Ue.synchronizers[n],o=!i.isDisabled(),a=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);o&&(a||s)&&r.push(i)}return r}const Yoe="viewport-element";function YC(t){const{element:e,viewportId:r}=t.detail;Qoe(e),eae(e),_C.removeViewportElement(r,e),KI.disable(e),h9.disable(e),u9.disable(e),dd.disable(e),oM.disable(e),uM.disable(e),bM.disable(e),IM.disable(e),kM.disable(e),CM.disable(e),_M.disable(e),LM.disable(e),Joe(e),Zoe(e),tae(e)}const Joe=t=>{const e=Ce(t);if(!e)return;FM(e.viewportId,e.renderingEngineId).forEach(n=>{n.remove(e)})},Zoe=t=>{const e=Ce(t);if(!e)return;const{renderingEngineId:r,viewportId:n}=e,i=Qn(n,r);i&&i.removeViewports(r,n)};function Qoe(t){const{viewportUid:e,renderingEngineUid:r}=t.dataset,n=`${e}:${r}`;delete Ue.svgNodeCache[n]}function eae(t){const e=t.querySelector(`div.${Yoe}`),r=e.querySelector("svg");r&&e.removeChild(r)}const tae=function(t){const e=Ue.enabledElements.findIndex(r=>r===t);e>-1&&Ue.enabledElements.splice(e,1)};function UM(t){const e=n7(t,[Cn.Active,Cn.Passive]),r=Yh(t,e);for(const{tool:n}of r){const i=n.cancel(t);if(i)return i}}class JC{constructor(e,r,n,i){this._viewportOptions={},this._onEvent=o=>{if(this._ignoreFiredEvents===!0||!this._targetViewports.length)return;const a=this._eventSource==="element"?Ce(o.currentTarget):wn(o.detail?.viewportId);if(!a)return;const{renderingEngineId:s,viewportId:c}=a;this._sourceViewports.find(l=>l.viewportId===c)&&this.fireEvent({renderingEngineId:s,viewportId:c},o)},this._enabled=!0,this._eventName=r,this._eventHandler=n,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this._options=i||{},this._eventSource=this._options.eventSource||"element",this._auxiliaryEvents=this._options.auxiliaryEvents||[],this.id=e}isDisabled(){return!this._enabled||!this._hasSourceElements()}setOptions(e,r={}){this._viewportOptions[e]=r}setEnabled(e){this._enabled=e}getOptions(e){return this._viewportOptions[e]}add(e){this.addTarget(e),this.addSource(e)}addSource(e){if(Ag(this._sourceViewports,e))return;const{renderingEngineId:r,viewportId:n}=e,i=Fn(r).getViewport(n);if(!i){console.warn(`Synchronizer.addSource: No viewport for ${r} ${n}`);return}(this._eventSource==="element"?i.element:Fe).addEventListener(this._eventName,this._onEvent.bind(this)),this._auxiliaryEvents.forEach(({name:a,source:s})=>{(s==="element"?i.element:Fe).addEventListener(a,this._onEvent.bind(this))}),this._updateDisableHandlers(),this._sourceViewports.push(e)}addTarget(e){Ag(this._targetViewports,e)||(this._targetViewports.push(e),this._updateDisableHandlers())}getSourceViewports(){return this._sourceViewports}getTargetViewports(){return this._targetViewports}destroy(){this._sourceViewports.forEach(e=>this.removeSource(e)),this._targetViewports.forEach(e=>this.removeTarget(e))}remove(e){this.removeTarget(e),this.removeSource(e)}removeSource(e){const r=l_(this._sourceViewports,e);if(r===-1)return;const n=this._eventSource==="element"?this.getViewportElement(e):Fe;this._sourceViewports.splice(r,1),n.removeEventListener(this._eventName,this._eventHandler),this._auxiliaryEvents.forEach(({name:i,source:o})=>{(o==="element"?this.getViewportElement(e):Fe).removeEventListener(i,this._eventHandler)}),this._updateDisableHandlers()}removeTarget(e){const r=l_(this._targetViewports,e);r!==-1&&(this._targetViewports.splice(r,1),this._updateDisableHandlers())}hasSourceViewport(e,r){return Ag(this._sourceViewports,{renderingEngineId:e,viewportId:r})}hasTargetViewport(e,r){return Ag(this._targetViewports,{renderingEngineId:e,viewportId:r})}fireEvent(e,r){if(this.isDisabled()||this._ignoreFiredEvents)return;this._ignoreFiredEvents=!0;const n=[];try{for(let i=0;i<this._targetViewports.length;i++){const o=this._targetViewports[i];if(e.viewportId===o.viewportId)continue;const s=this._eventHandler(this,e,o,r,this._options);s instanceof Promise&&n.push(s)}}catch(i){console.warn(`Synchronizer, for: ${this._eventName}`,i)}finally{n.length?Promise.allSettled(n).then(()=>{this._ignoreFiredEvents=!1}):this._ignoreFiredEvents=!1}}_hasSourceElements(){return this._sourceViewports.length!==0}_updateDisableHandlers(){const e=nae(this._sourceViewports,this._targetViewports),r=this.remove.bind(this),n=i=>{r(i.detail.element)};e.forEach(i=>{const o=this.getEventSource(i);o&&(o.removeEventListener($e.ELEMENT_DISABLED,n),o.addEventListener($e.ELEMENT_DISABLED,n))})}getEventSource(e){return this._eventSource==="element"?this.getViewportElement(e):Fe}getViewportElement(e){const{renderingEngineId:r,viewportId:n}=e,i=Fn(r);if(!i)return null;const o=i.getViewport(n);return o?o.element:null}}function nae(t,e){const r=[],n=t.concat(e);for(let i=0;i<n.length;i++){const o=n[i];r.some(a=>o.renderingEngineId===a.renderingEngineId&&o.viewportId===a.viewportId)||r.push(o)}return r}function l_(t,e){return t.findIndex(r=>e.renderingEngineId===r.renderingEngineId&&e.viewportId===r.viewportId)}function Ag(t,e){return t.some(r=>r.renderingEngineId===e.renderingEngineId&&r.viewportId===e.viewportId)}function Gu(t,e,r,n){if(Ue.synchronizers.some(a=>a.id===t))throw new Error(`Synchronizer with id '${t}' already exists.`);const o=new JC(t,e,r,n);return Ue.synchronizers.push(o),o}function rae(){for(;Ue.synchronizers.length>0;)Ue.synchronizers.pop().destroy()}function iae(t){return Ue.synchronizers.find(e=>e.id===t)}function oae(){return Ue.synchronizers}function aae(t){const e=Ue.synchronizers.findIndex(r=>r.id===t);e>-1&&(Ue.synchronizers[e].destroy(),Ue.synchronizers.splice(e,1))}const BM=Object.freeze(Object.defineProperty({__proto__:null,createSynchronizer:Gu,destroy:rae,destroySynchronizer:aae,getAllSynchronizers:oae,getSynchronizer:iae,getSynchronizersForViewport:FM},Symbol.toStringTag,{value:"Module"})),sae=Object.freeze(Object.defineProperty({__proto__:null,Synchronizer:JC,SynchronizerManager:BM,ToolGroupManager:RI,addEnabledElement:qC,addTool:Zw,cancelActiveManipulations:UM,hasTool:_Z,removeEnabledElement:YC,removeTool:FI,get state(){return Ue},svgNodeCache:sm},Symbol.toStringTag,{value:"Module"})),m1=function(t){const{viewportId:e}=t.detail;wd(e)},GM=function(t){const{segmentationId:e}=t.detail;ld().filter(n=>e===n?.data?.segmentation?.segmentationId).forEach(n=>{kt(n.annotationUID)})};let Ay=!1;function cae(t={}){Ay||(EQ(t),uae(),dae(),Ay=!0)}function lae(){WM(),$M(),OI(),jJ();const t=xa(),e=On;t.restoreAnnotations({}),e.resetState(),Ay=!1}function uae(){WM();const t=$e.ELEMENT_ENABLED,e=$e.ELEMENT_DISABLED;Fe.addEventListener(t,qC),Fe.addEventListener(e,YC),NM.enable()}function WM(){const t=$e.ELEMENT_ENABLED,e=$e.ELEMENT_DISABLED;Fe.removeEventListener(t,qC),Fe.removeEventListener(e,YC),NM.disable()}function dae(){$M(),Fe.addEventListener(V.ANNOTATION_COMPLETED,aM),Fe.addEventListener(V.ANNOTATION_MODIFIED,sM),Fe.addEventListener(V.ANNOTATION_SELECTION_CHANGE,p1),Fe.addEventListener(V.ANNOTATION_SELECTION_CHANGE,p1),Fe.addEventListener(V.ANNOTATION_REMOVED,cM),Fe.addEventListener(V.SEGMENTATION_MODIFIED,iM),Fe.addEventListener(V.SEGMENTATION_DATA_MODIFIED,rM),Fe.addEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,m1),Fe.addEventListener(V.SEGMENTATION_REPRESENTATION_ADDED,m1),Fe.addEventListener(V.SEGMENTATION_REMOVED,GM)}function $M(){Fe.removeEventListener(V.ANNOTATION_COMPLETED,aM),Fe.removeEventListener(V.ANNOTATION_MODIFIED,sM),Fe.removeEventListener(V.ANNOTATION_SELECTION_CHANGE,p1),Fe.removeEventListener(V.ANNOTATION_SELECTION_CHANGE,p1),Fe.removeEventListener(V.ANNOTATION_REMOVED,cM),Fe.removeEventListener(V.SEGMENTATION_MODIFIED,iM),Fe.removeEventListener(V.SEGMENTATION_DATA_MODIFIED,rM),Fe.removeEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,m1),Fe.removeEventListener(V.SEGMENTATION_REPRESENTATION_ADDED,m1),Fe.removeEventListener(V.SEGMENTATION_REMOVED,GM)}const fae=Object.freeze(Object.defineProperty({__proto__:null,COLOR_LUT:h1},Symbol.toStringTag,{value:"Module"})),hae="4.14.4";function gae(t,e,r,n){const{camera:i}=n.detail,o=Fn(r.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const a=o.getViewport(r.viewportId);a.setCamera(i),a.render()}const{CAMERA_MODIFIED:pae}=$e;function mae(t){return Gu(t,pae,gae)}function vae(t,e,r,n,i){const o=Fn(r.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const a=o.getViewport(r.viewportId),c=o.getViewport(e.viewportId).getViewPresentation(i);a.setViewPresentation(c),a.render()}const{CAMERA_MODIFIED:yae}=$e;function wae(t,e){return Gu(t,yae,vae,{viewPresentation:e})}function Cae(t,e,r,n,i){const o=n.detail,{volumeId:a,range:s,invertStateChanged:c,invert:l,colormap:d}=o,u=Fn(r.renderingEngineId);if(!u)throw new Error(`Rendering Engine does not exist: ${r.renderingEngineId}`);const f=u.getViewport(r.viewportId),h={voiRange:s};if(i?.syncInvertState&&c&&(h.invert=l),i?.syncColormap&&d&&(h.colormap=d),f instanceof Zn)f._actors&&f._actors.size>1?f.setProperties(h,a):f.setProperties(h);else if(f instanceof Wn)f.setProperties(h);else throw new Error("Viewport type not supported.");f.render()}function xae(t,e){return e=Object.assign({syncInvertState:!0,syncColormap:!0},e),Gu(t,$e.VOI_MODIFIED,Cae,{auxiliaryEvents:[{name:$e.COLORMAP_MODIFIED}],...e})}function Sae(t,e,r){const n=Fn(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=t.getOptions(r.viewportId),o=n.getViewport(r.viewportId),a=n.getViewport(e.viewportId);if(i?.syncZoom!==!1){const s=a.getZoom();o.setZoom(s)}if(i?.syncPan!==!1){const s=a.getPan();o.setPan(s)}o.render()}const{CAMERA_MODIFIED:Tae}=$e;function _ae(t){return Gu(t,Tae,Sae)}function Eae(t,e){const{viewPlaneNormal:r}=t.getCamera(),{viewPlaneNormal:n}=e.getCamera(),i=ft(r,n);return Math.abs(i)>.9}const u_=(t,e)=>eh.get("spatialRegistrationModule",t,e);async function zM(t,e,r){const n=Fn(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=n.getViewport(e.viewportId),o=t.getOptions(r.viewportId);if(o?.disabled)return;const a=n.getViewport(r.viewportId),s=i.getCurrentImageId(),l=ut("imagePlaneModule",s).imagePositionPatient,d=a.getImageIds();if(!Eae(i,a))return;let u=u_(r.viewportId,e.viewportId);if(!u){const p=i.getFrameOfReferenceUID(),v=a.getFrameOfReferenceUID();if(p===v&&o?.useInitialPosition!==!1?u=It(fi()):(gI(i,a),u=u_(r.viewportId,e.viewportId)),!u)return}const f=Vt(Ie(),l,u),h=bae(f,d);let g=h.index;a instanceof Gn&&(g=d.length-h.index-1),h.index!==-1&&a.getCurrentImageIdIndex()!==h.index&&await Hw(a.element,{imageIndex:g})}function bae(t,e){return e.reduce((r,n,i)=>{const{imagePositionPatient:o}=ut("imagePlaneModule",n),a=Dr(o,t);return a<r.distance?{distance:a,index:i}:r},{distance:1/0,index:-1})}const{STACK_NEW_IMAGE:Dae,VOLUME_NEW_IMAGE:Sge}=$e;function jM(t){return Gu(t,Dae,zM,{auxiliaryEvents:[{name:"VOLUME_NEW_IMAGE"}]})}function Iae(t,e,r){const n=Fn(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=n.getViewport(r.viewportId),a=n.getViewport(e.viewportId).getSlabThickness?.();a&&(i.setSlabThickness?.(a),i.render())}const{CAMERA_MODIFIED:Mae}=$e;function Oae(t){return Gu(t,Mae,Iae)}const Pae=jM,Rae=Object.freeze(Object.defineProperty({__proto__:null,createCameraPositionSynchronizer:mae,createImageSliceSynchronizer:jM,createPresentationViewSynchronizer:wae,createSlabThicknessSynchronizer:Oae,createStackImageSynchronizer:Pae,createVOISynchronizer:xae,createZoomPanSynchronizer:_ae,imageSliceSyncCallback:zM},Symbol.toStringTag,{value:"Module"}));function Aae(t,e,r=5){const n=Ce(t);if(!n)throw new Error("getAnnotationNearPoint: enabledElement not found");return HM(n,e,r)}function HM(t,e,r){const{renderingEngineId:n,viewportId:i}=t,o=Qn(i,n);if(!o)return null;const{_toolInstances:a}=o;for(const s in a){const c=Lae(a[s],t,e,r);if(c)return c}return null}function Lae(t,e,r,n){const{viewport:i}=e,o=$t(t.constructor.toolName,i?.element),a=i?.getCurrentImageId?.();if(o?.length){const{element:s}=e.viewport;for(const c of o){const l=c.metadata?.referencedImageId;if(!(a&&l&&a!==l||!t.isPointNearTool)&&(t.isPointNearTool(s,c,r,n,"")||t.getHandleNearImagePoint(s,c,r,n)))return c}}return null}const{calibratedPixelSpacingMetadataProvider:Nae}=hn;function Vae(t,e,r){typeof r=="number"&&(r={type:oa.USER,scale:r}),Nae.add(t,r),e.getStackViewports().forEach(i=>{i.getImageIds().includes(t)&&i.calibrateSpacing(t)})}function XM(t,e){const r=t.findIndex(([n,i])=>n===i);if(r===-1)throw new Error("3D bounding boxes not supported in an oblique plane");return t[r][0]-=e,t[r][1]+=e,t}const kae=Object.freeze(Object.defineProperty({__proto__:null,extend2DBoundingBoxInViewAxis:XM,getBoundingBoxAroundShape:hl,getBoundingBoxAroundShapeIJK:hl,getBoundingBoxAroundShapeWorld:oQ},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:Z2}=hn;function KM(t,e,r){const[n,i]=t,o=mt((n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2),a=Dr(n,i)/2,{boundsIJK:s,topLeftWorld:c,bottomRightWorld:l}=Uae(e,r,t,o,a);return{boundsIJK:s,centerWorld:o,radiusWorld:a,topLeftWorld:c,bottomRightWorld:l}}function qM(t,e){const r=e.getDirection(),n=mt(r[0],r[1],r[2]),i=mt(r[3],r[4],r[5]),o=mt(r[6],r[7],r[8]),a=ga(Ie(),o);return KM(t,e,{row:n,column:i,normal:a})}function Fae(t,e,r){if(!r)throw new Error("viewport is required in order to calculate the sphere bounds");const n=r.getCamera(),i=mt(n.viewUp[0],n.viewUp[1],n.viewUp[2]),o=mt(n.viewPlaneNormal[0],n.viewPlaneNormal[1],n.viewPlaneNormal[2]),a=Ie();tn(a,i,o);const s={row:a,normal:o,column:ga(Ie(),i)};return KM(t,e,s)}function Uae(t,e,r,n,i){const o=t.getDimensions(),{row:a,column:s,normal:c}=e,l=Ie(),d=Ie();en(l,n,c,i),en(d,n,c,-i),en(l,l,s,-i),en(d,d,s,i),en(l,l,a,-i),en(d,d,a,i);const u=Z2(t,l),f=Z2(t,d),h=r.map(p=>Z2(t,p));return{boundsIJK:hl([u,f,...h],o),topLeftWorld:l,bottomRightWorld:d}}function YM(t,e=5){return parseFloat(t[0]).toFixed(e)+","+parseFloat(t[1]).toFixed(e)+","+parseFloat(t[2]).toFixed(e)+","}class Bae{static setStartRange(e,r,n=e.getCurrentImageIdIndex()){this.setRange(e,r,n)}static setEndRange(e,r,n=e.getCurrentImageIdIndex()){this.setRange(e,r,void 0,n)}static setRange(e,r,n,i){const{metadata:o}=r;n===void 0&&(n=o.sliceIndex<i?o.sliceIndex:0,i===void 0&&(i=e.getNumberOfSlices()-1));const a=e.getSliceIndexForImage(o.multiSliceReference);i===void 0&&(i=a>=n?a:e.getNumberOfSlices()-1),i=Math.max(n,i),o.sliceIndex=Math.min(n,i),o.referencedImageId=e.getCurrentImageId(o.sliceIndex),o.referencedImageURI=void 0,i===o.sliceIndex?o.multiSliceReference=void 0:i!==o.multiSliceReference?.sliceIndex&&(o.multiSliceReference={referencedImageId:e.getCurrentImageId(i),sliceIndex:i});const s={viewportId:e.id,renderingEngineId:e.renderingEngineId,changeType:At.MetadataReferenceModified,annotation:r};Ye(Fe,V.ANNOTATION_MODIFIED,s),this.setViewportFrameRange(e,o)}static setSingle(e,r,n=e.getCurrentImageIdIndex()){this.setRange(e,r,n,n)}static getFrameRange(e){const{metadata:r}=e,{sliceIndex:n,multiSliceReference:i}=r,o=i?.sliceIndex;return o?[n+1,o+1]:n+1}static getFrameRangeStr(e){const r=this.getFrameRange(e);return Array.isArray(r)?`${r[0]}-${r[1]}`:String(r)}static setViewportFrameRange(e,r){e.setFrameRange&&r.multiSliceReference?.sliceIndex&&e.setFrameRange(r.sliceIndex+1,r.multiSliceReference.sliceIndex+1)}}function JM(t,e,r){const{imageData:n}=t,{overwrite:i,boundsIJK:o,segmentationId:a}=r;if(!a)throw new Error("Segmentation ID is required to be passed inside thresholdVolumeByRange as options");const s=r?.overlapType||0,c=t.voxelManager,l=t.voxelManager.getScalarDataLength();if(i)for(let y=0;y<l;y++)c.setAtIndex(y,0);const{baseVolumeIdx:d,volumeInfoList:u}=y9(t,e);let f,h,g;const p=(y,C,x)=>{const S=({value:M})=>{h=h+1,M>=g.lower&&M<=g.upper&&(f=f+1)},{imageData:T,dimensions:_,lower:E,upper:D}=y,b=nC(T,_,C,x);h=0,f=0,g={lower:E,upper:D};let I=!1;const{voxelManager:O}=T.get("voxelManager");return O.forEach(S,{imageData:T,boundsIJK:b}),s===0?I=f>0:s==1&&(I=f===h),I},v=(y,C)=>{const{imageData:x,lower:S,upper:T}=y,_=x.get("voxelManager").voxelManager,E=_.toIndex(C),D=_.getAtIndex(E);return!(D<=S||D>=T)},w=({index:y,pointIJK:C,pointLPS:x})=>{let S=u.length>0;for(let T=0;T<u.length&&(u[T].volumeSize===l?S=v(u[T],C):S=p(u[T],u[d].spacing,x),!!S);T++);S&&c.setAtIndex(y,r.segmentIndex||1)};return t.voxelManager.forEach(w,{imageData:n,boundsIJK:o}),ei(r.segmentationId),t}const{transformWorldToIndex:d_}=hn,m0=class m0 extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:Gae,statsCalculator:is}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const d=this.constructor.createAnnotationForViewport(l,{data:{handles:{points:[[...s],[...s],[...s],[...s]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}}});Ft(d,a);const u=vt(a,this.getToolName());return this.editData={annotation:d,viewportIdsToRender:u,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(u),d},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:d}=l.handles,u=c.worldToCanvas(d[0]),f=c.worldToCanvas(d[3]),h=this._getRectangleImageCoordinates([u,f]),g=[o[0],o[1]],{left:p,top:v,width:w,height:m}=h;return xC([p,v,w,m],g)<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,d;o.worldPosition?l=!0:d=c.handles.points.findIndex(g=>g===o);const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:d,movingTextBox:l},this._activateModify(s),St(s);const f=Ce(s),{renderingEngine:h}=f;Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;c&&!l||(d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o),this.doneEditMemo(),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a))},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:u}=a;if(l){const{deltaPoints:f}=i,h=f.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:f}=i,h=f.world,{points:g}=u.handles;g.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:f}=i,h=Ce(o),{worldToCanvas:g,canvasToWorld:p}=h.viewport,v=f.world,{points:w}=u.handles;w[c]=[...v];let m,y,C,x,S,T,_,E;switch(c){case 0:case 3:m=g(w[0]),x=g(w[3]),y=[x[0],m[1]],C=[m[0],x[1]],T=p(y),_=p(C),w[1]=T,w[2]=_;break;case 1:case 2:y=g(w[1]),C=g(w[2]),m=[C[0],y[1]],x=[y[0],C[1]],S=p(m),E=p(x),w[0]=S,w[3]=E;break}a.invalidated=!0}this.editData.hasMoved=!0,Ce(o),Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles,m=v.map(j=>a.worldToCanvas(j));u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),{viewPlaneNormal:S,viewUp:T}=a.getCamera();if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(h,S,T,d,n);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,S,T,d,n),a instanceof Gn)){const{referencedImageId:j}=h.metadata;for(const Y in p.cachedStats)Y.startsWith("imageId")&&d.getStackViewports().find(ae=>{const fe=Yn(j),we=ae.hasImageURI(fe),_e=Yn(ae.getCurrentImageId());return we&&_e!==fe})&&delete p.cachedStats[Y]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let _;if(!or(g))continue;!ir(g)&&!this.editData&&w!==null&&w!==void 0&&(_=[m[w]]);const E=!!Mi("showHandlesAlways",{});(_||E)&&kn(i,g,"0",E?m:_,{color:y});const D=`${g}-rect`;TC(i,g,"0",m,{color:y,lineDash:x,lineWidth:C},D),o=!0;const I=this.getLinkedTextBoxStyle(u,h);if(!I.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const O=this.configuration.getTextLines(p,l);if(!O||O.length===0)continue;if(!p.handles.textBox.hasMoved){const j=to(m);p.handles.textBox.worldPosition=a.canvasToWorld(j)}const M=a.worldToCanvas(p.handles.textBox.worldPosition),A=gi(i,g,"1",O,M,m,{},I),{x:G,y:k,width:L,height:F}=A;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([G,k]),topRight:a.canvasToWorld([G+L,k]),bottomLeft:a.canvasToWorld([G,k+F]),bottomRight:a.canvasToWorld([G+L,k+F])}}return o},this._getRectangleImageCoordinates=n=>{const[i,o]=n;return{left:Math.min(i[0],o[0]),top:Math.min(i[1],o[1]),width:Math.abs(i[0]-o[0]),height:Math.abs(i[1]-o[1])}},this._calculateCachedStats=(n,i,o,a,s)=>{if(!this.configuration.calculateStats)return;const{data:c}=n,{viewport:l}=s,{element:d}=l,u=c.handles.points[0],f=c.handles.points[3],{cachedStats:h}=c,g=Object.keys(h);for(let v=0;v<g.length;v++){const w=g[v],m=this.getTargetImageData(w);if(!m)continue;const{dimensions:y,imageData:C,metadata:x,voxelManager:S}=m,T=d_(C,u);T[0]=Math.floor(T[0]),T[1]=Math.floor(T[1]),T[2]=Math.floor(T[2]);const _=d_(C,f);if(_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]),this._isInsideVolume(T,_,y)){this.isHandleOutsideImage=!1;const E=Math.min(T[0],_[0]),D=Math.max(T[0],_[0]),b=Math.min(T[1],_[1]),I=Math.max(T[1],_[1]),O=Math.min(T[2],_[2]),M=Math.max(T[2],_[2]),R=[[E,D],[b,I],[O,M]],{worldWidth:A,worldHeight:G}=Dm(i,o,u,f),k=[T,_],{scale:L,areaUnit:F}=_o(m,k),j=Math.abs(A*G)/(L*L),Y={isPreScaled:dc(l,w),isSuvScaled:this.isSuvScaled(l,w,n.metadata.referencedImageId)},ie=fc(x.Modality,n.metadata.referencedImageId,Y);let de;S&&(de=S.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:R,imageData:C,returnPoints:this.configuration.storePointData}));const ae=this.configuration.statsCalculator.getStatistics();h[w]={Modality:x.Modality,area:j,mean:ae.mean?.value,stdDev:ae.stdDev?.value,max:ae.max?.value,min:ae.min?.value,statsArray:ae.array,pointsInShape:de,areaUnit:F,modalityUnit:ie}}else this.isHandleOutsideImage=!0,h[w]={Modality:x.Modality}}const p=n.invalidated;return n.invalidated=!1,p&&Gt(n,d,At.StatsUpdated),h},this._isInsideVolume=(n,i,o)=>Sr(n,o)&&Sr(i,o),this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}};m0.toolName="RectangleROI",m0.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=m0.hydrateBase(m0,i,r,n),{toolInstance:d,...u}=n||{},f={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(f,l.element),Me([l.id])};let dh=m0;function Gae(t,e){const r=t.cachedStats[e],{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c,min:l}=r;if(i==null)return;const d=[];return nr(n)&&d.push(`Area: ${Ht(n)} ${s}`),nr(i)&&d.push(`Mean: ${Ht(i)} ${c}`),nr(o)&&d.push(`Max: ${Ht(o)} ${c}`),nr(l)&&d.push(`Min: ${Ht(l)} ${c}`),nr(a)&&d.push(`Std Dev: ${Ht(a)} ${c}`),d}const{transformWorldToIndex:Gd}=hn;class ZC extends dh{constructor(e={},r={configuration:{storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!0,getTextLines:Wae,statsCalculator:is,showTextBox:!1,throttleTimeout:100}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:d}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:f,viewUp:h}=u;let g,p,v;if(l instanceof Wn)throw new Error("Stack Viewport Not implemented");{const T=this.getTargetId(l);v=cs(T),p=Ne.getVolume(v),g=rc(p,s,f)}const w=ml(p,f),m=this._getStartCoordinate(s,f),y=this._getEndCoordinate(s,w,f),C=l.getFrameOfReferenceUID(),x={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...f],enabledElement:c,viewUp:[...h],FrameOfReferenceUID:C,referencedImageId:g,toolName:this.getToolName(),volumeId:v,spacingInNormal:w},data:{label:"",startCoordinate:m,endCoordinate:y,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[g],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(x,p),Ft(x,a);const S=vt(a,this.getToolName());return this.editData={annotation:x,viewportIdsToRender:S,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(S),x},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const{metadata:u}=a,{enabledElement:f}=u;this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID);const h=this.getTargetId(f.viewport),g=Ne.getVolume(h.split(/volumeId:|\?/)[1]);this._computePointsInsideVolume(a,h,g,f),Me(s),c?xn(a):Gt(a,o)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;let s=$t(this.getToolName(),a.element);if(!s?.length)return o;s=Im(s,a.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let l=0;l<s.length;l++){const d=s[l],{annotationUID:u,data:f,metadata:h}=d,{startCoordinate:g,endCoordinate:p}=f,{points:v,activeHandleIndex:w}=f.handles,{enabledElement:m}=h,y=v.map(F=>a.worldToCanvas(F));c.annotationUID=u;const C=this.getStyle("lineWidth",c,d),x=this.getStyle("lineDash",c,d),S=this.getStyle("color",c,d),T=a.getCamera().focalPoint,_=a.getCamera().viewPlaneNormal;let E=g,D=p;if(Array.isArray(g)){E=this._getCoordinateForViewplaneNormal(E,_);const F=this._getIndexOfCoordinatesForViewplaneNormal(_);f.handles.points.forEach(j=>{j[F]=E}),f.startCoordinate=E}Array.isArray(p)&&(D=this._getCoordinateForViewplaneNormal(D,_),f.endCoordinate=D,f.endCoordinate=D);const b=Qc(E),I=Qc(D),O=this._getCoordinateForViewplaneNormal(T,_),M=Qc(O);if(M<Math.min(b,I)||M>Math.max(b,I))continue;const R=m.viewport?.volumeIds.values();for(const F of R)d.invalidated&&d.metadata.volumeId===F&&this._throttledCalculateCachedStats(d,m);let A=!1;if((M===b||M===I)&&(A=!0),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let G;if(!or(u))continue;!ir(u)&&!this.editData&&w!==null&&A&&(G=[y[w]]),G&&kn(i,u,"0",G,{color:S});let k=x;if(A||(k=2),zh(i,u,"0",y[0],y[3],{color:S,lineDash:k,lineWidth:C}),o=!0,this.configuration.showTextBox){const F=this.getLinkedTextBoxStyle(c,d);if(!F.visibility){f.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const j=this.configuration.getTextLines(f,{metadata:h});if(!j||j.length===0)continue;if(!f.handles.textBox.hasMoved){const Se=to(y);f.handles.textBox.worldPosition=a.canvasToWorld(Se)}const Y=a.worldToCanvas(f.handles.textBox.worldPosition),de=gi(i,u,"1",j,Y,y,{},F),{x:ae,y:fe,width:we,height:_e}=de;f.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([ae,fe]),topRight:a.canvasToWorld([ae+we,fe]),bottomLeft:a.canvasToWorld([ae,fe+_e]),bottomRight:a.canvasToWorld([ae+we,fe+_e])}}}return o},this.configuration.calculatePointsInsideVolume?this._throttledCalculateCachedStats=Pi(this._calculateCachedStatsTool,this.configuration.throttleTimeout,{trailing:!0}):this._throttledCalculateCachedStats=pd(this._calculateCachedStatsTool,this.configuration.throttleTimeout)}_computeProjectionPoints(e,r){const{data:n,metadata:i}=e,{viewPlaneNormal:o,spacingInNormal:a}=i,{imageData:s}=r,{startCoordinate:c,endCoordinate:l}=n,{points:d}=n.handles,u=Gd(s,d[0]),f=Gd(s,d[0]),h=Ie();s.indexToWorldVec3(u,h);const g=Ie();s.indexToWorldVec3(f,g);const p=this._getIndexOfCoordinatesForViewplaneNormal(o);p==2?(h[2]=c,g[2]=l):p==0?(h[0]=c,g[0]=l):p==1&&(h[1]=c,g[1]=l);const v=Ie();an(v,g,h);const w=pr(v);Lt(v,v);const m=[];for(let y=0;y<w;y+=a)m.push(d.map(C=>{const x=Ie();return en(x,C,v,y),Array.from(x)}));n.cachedStats.projectionPoints=m}_computePointsInsideVolume(e,r,n,i){const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:c}=a,{viewport:l}=i,d=o.cachedStats.projectionPoints,u=[[]],f=this.getTargetImageData(r),h=o.handles.points[0],g=o.handles.points[3],{worldWidth:p,worldHeight:v}=Dm(s,c,h,g),w=_o(f,o.habdles),m=Math.abs(p*v)/(w.scale*w.scale),y={isPreScaled:dc(l,r),isSuvScaled:this.isSuvScaled(l,r,e.metadata.referencedImageId)},C=fc(a.Modality,e.metadata.referencedImageId,y);for(let S=0;S<d.length;S++){if(!n)continue;const T=d[S][0],{dimensions:_,imageData:E,voxelManager:D}=n,b=Gd(E,h),I=Gd(E,T),O=this._getIndexOfCoordinatesForViewplaneNormal(s);b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]),b[O]=I[O];const M=Gd(E,g);if(M[0]=Math.floor(M[0]),M[1]=Math.floor(M[1]),M[2]=Math.floor(M[2]),M[O]=I[O],this._isInsideVolume(b,M,_)){this.isHandleOutsideImage=!1;const R=Math.min(b[0],M[0]),A=Math.max(b[0],M[0]),G=Math.min(b[1],M[1]),k=Math.max(b[1],M[1]),L=Math.min(b[2],M[2]),F=Math.max(b[2],M[2]),j=[[R,A],[G,k],[L,F]],Y=D.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:j,imageData:E,returnPoints:this.configuration.storePointData});u.push(Y)}}const x=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=u,o.cachedStats.statistics={Modality:a.Modality,area:m,mean:x.mean?.value,stdDev:x.stdDev?.value,max:x.max?.value,statsArray:x.array,areaUnit:w.areaUnit,modalityUnit:C}}_calculateCachedStatsTool(e,r){const n=e.data,{viewport:i}=r,{cachedStats:o}=n,a=this.getTargetId(i),s=Ne.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this._computePointsInsideVolume(e,a,s,r),e.invalidated=!1,Gt(e,i.element),o}_getStartCoordinate(e,r){const n=e;return this._getCoordinateForViewplaneNormal(n,r)}_getEndCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=Ie();return en(o,e,n,i*r),this._getCoordinateForViewplaneNormal(o,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const r=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return r.indexOf(Math.max(...r))}_getCoordinateForViewplaneNormal(e,r){const n=this._getIndexOfCoordinatesForViewplaneNormal(r);return e[n]}}function Wae(t,e={}){const r=t.cachedStats.statistics,{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Ht(n)} ${s}`),l.push(`Mean: ${Ht(i)} ${c}`),l.push(`Max: ${Ht(o)} ${c}`),l.push(`Std Dev: ${Ht(a)} ${c}`),l}ZC.toolName="RectangleROIStartEndThreshold";class QC extends dh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:d}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:f,viewUp:h}=u,g=this.getTargetId(l);let p,v;if(l instanceof Wn)p=g.split("imageId:")[1];else{v=cs(g);const C=Ne.getVolume(v);p=rc(C,s,f)}const w=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...f],enabledElement:c,viewUp:[...h],FrameOfReferenceUID:w,referencedImageId:p,toolName:this.getToolName(),volumeId:v},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},segmentationId:null}};Ft(m,a);const y=vt(a,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(y),m},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const u=c[d],{annotationUID:f,data:h}=u,{points:g,activeHandleIndex:p}=h.handles,v=g.map(S=>a.worldToCanvas(S));l.annotationUID=f;const w=this.getStyle("lineWidth",l,u),m=this.getStyle("lineDash",l,u),y=this.getStyle("color",l,u);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;Gt(u,s);let C;if(!or(f))continue;!ir(f)&&!this.editData&&p!==null&&(C=[v[p]]),C&&kn(i,f,"0",C,{color:y}),zh(i,f,"0",v[0],v[3],{color:y,lineDash:m,lineWidth:w}),o=!0}return o}}}QC.toolName="RectangleROIThreshold";function ZM(t,e,r={}){const n=[];return t.forEach(o=>{const{data:a}=o,{points:s}=a.handles,{imageData:c,dimensions:l}=e;let d=s;if(a.cachedStats?.projectionPoints){const{projectionPoints:h}=a.cachedStats;d=[].concat(...h)}const u=d.map(h=>br(c,h));let f=hl(u,l);r.numSlicesToProject&&!a.cachedStats?.projectionPoints&&(f=XM(f,r.numSlicesToProject)),n.push(f)}),n.length===1?n[0]:n.reduce((o,a)=>({iMin:Math.min(o.iMin,a.iMin),jMin:Math.min(o.jMin,a.jMin),kMin:Math.min(o.kMin,a.kMin),iMax:Math.max(o.iMax,a.iMax),jMax:Math.max(o.jMax,a.jMax),kMax:Math.max(o.kMax,a.kMax)}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})}function $ae(t,e,r,n){const i=t.map(s=>ma.getAnnotation(s));zae(i);let o;for(let s=0;s<r.length;s++)(r[s].volume.voxelManager.getScalarDataLength()===e.voxelManager.getScalarDataLength()||s===0)&&(o=ZM(i,r[s].volume,n));const a=JM(e,r,{...n,boundsIJK:o,segmentationId:n.segmentationId});return a.modified(),a}function zae(t){const e=[QC.toolName,ZC.toolName];for(const r of t){const n=r.metadata.toolName;if(!e.includes(n))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}function QM(t,e=1,r="mergedLabelmap"){t.forEach(({direction:l,dimensions:d,origin:u,spacing:f})=>{if(!Et(d,t[0].dimensions)||!Et(l,t[0].direction)||!Et(f,t[0].spacing)||!Et(u,t[0].origin))throw new Error("labelmaps must have the same size and shape")});const n=t[0],i=n.voxelManager.getConstructor(),o=new i(n.voxelManager.getScalarDataLength());t.forEach(l=>{const d=l.voxelManager,u=d.getScalarDataLength();for(let f=0;f<u;f++)d.getAtIndex(f)===e&&(o[f]=e)});const a={scalarData:o,metadata:n.metadata,spacing:n.spacing,origin:n.origin,direction:n.direction,dimensions:n.dimensions},s=Ne.getVolume(r);let c;return s?(c=s,c.voxelManager.setCompleteScalarDataArray(o)):c=bw(r,a),c}async function jae(t){const{viewportId:e,renderingEngineId:r,options:n}=t;let{segmentationId:i}=t;const o=Ln(e,r);if(!o)throw new Error("element disabled");const{viewport:a}=o;if(!(a instanceof Gn))throw new Error("Segmentation only supports VolumeViewport");const{uid:s}=a.getDefaultActor();if(i===void 0&&(i=`${s}-based-segmentation-${n?.volumeId??cn().slice(0,8)}`),n){const c=structuredClone(n);await bw(i,c)}else{const c=a.getVolumeId();Z1(c,{volumeId:i})}return i}function ex(t,e,r={}){const n=r.onFlood,i=r.onBoundary,o=r.equals,a=r.filter,s=r.diagonals||!1,c=x(e),l=S(),d=[],u=[],f=new Set,h=r.bounds;for(d.push({currentArgs:e});d.length>0;)g(d.pop());return{flooded:u};function g(_){const E=_.currentArgs,D=_.previousArgs;p(E)||(v(E),w(E)?(m(E),C(E)):y(D))}function p(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));return f.has(I)}function v(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));f.add(I)}function w(_){const E=x(_);return o?o(E,c):E===c}function m(_){u.push(_),n&&n(..._)}function y(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));h?.set(I,_),i&&i(..._)}function C(_){for(let E=0;E<l.length;E+=1){const D=l[E],b=_.slice(0);for(let I=0;I<_.length;I+=1)b[I]+=D[I];a?.(b)!==!1&&(p(b)||d.push({currentArgs:b,previousArgs:_}))}}function x(_){return t(..._)}function S(){return T(e.length).filter(function(E){const D=Hae(E);return D!==0&&(D===1||s)})}function T(_){const E=[],D=function(b){return b.split("").map(function(I){return parseInt(I,10)-1})};for(let b=0;b<Math.pow(3,_);b+=1){const I=Xae(b.toString(3),"0",_);E.push(D(I))}return E}}function Hae(t){let e=0;for(let r=0;r<t.length;r+=1)t[r]!==0&&(e+=1);return e}function Xae(t,e,r){return(new Array(r+1).join(e)+t).slice(-r)}const Kae={[ht.OnInteractionStart]:t=>{const{segmentIndex:e,previewSegmentIndex:r,segmentationVoxelManager:n,centerIJK:i,viewPlaneNormal:o,segmentationImageData:a,configuration:s}=t;if(!s?.useCenterSegmentIndex){t.centerSegmentIndexInfo.segmentIndex=null,t.centerSegmentIndexInfo.hasSegmentIndex=!1,t.centerSegmentIndexInfo.hasPreviewIndex=!1;return}let c=!1,l=!1;const d=[...n.getBoundsIJK()];Math.abs(o[0])>.8?d[0]=[i[0],i[0]]:Math.abs(o[1])>.8?d[1]=[i[1],i[1]]:Math.abs(o[2])>.8&&(d[2]=[i[2],i[2]]);const u=({value:h})=>{c||=h===e,l||=h===r};if(n.forEach(u,{imageData:a,isInObject:t.isInObject,boundsIJK:d}),!c&&!l){t.centerSegmentIndexInfo.segmentIndex=null;return}const f=n.getAtIJKPoint(i);t.centerSegmentIndexInfo.segmentIndex=f,t.centerSegmentIndexInfo.hasSegmentIndex=c,t.centerSegmentIndexInfo.hasPreviewIndex=l}},qae={[ht.Initialize]:t=>{const{operationName:e,centerIJK:r,segmentationVoxelManager:n,imageVoxelManager:i,configuration:o,segmentIndex:a,viewport:s}=t;if(!o?.threshold?.isDynamic||!r||!a||e===ht.RejectPreview||e===ht.OnInteractionEnd)return;const c=n.getBoundsIJK(),{range:l,dynamicRadius:d=0}=o.threshold,u=l?0:d,{viewPlaneNormal:f}=s.getCamera(),h=c.map((w,m)=>{const[y,C]=w;return[Math.max(y,r[m]-u),Math.min(C,r[m]+u)]});Math.abs(f[0])>.8?h[0]=[r[0],r[0]]:Math.abs(f[1])>.8?h[1]=[r[1],r[1]]:Math.abs(f[2])>.8&&(h[2]=[r[2],r[2]]);const g=l||[1/0,-1/0],p=u*u,v=({value:w,pointIJK:m})=>{if(Qv(r,m)>p)return;const C=Array.isArray(w)?k0(w):w;g[0]=Math.min(C,g[0]),g[1]=Math.max(C,g[1])};i.forEach(v,{boundsIJK:h}),o.threshold.range=g},[ht.OnInteractionStart]:t=>{const{configuration:e}=t;e?.threshold?.isDynamic&&(e.threshold.range=null)},[ht.ComputeInnerCircleRadius]:t=>{const{configuration:e,viewport:r}=t,n=e?.threshold;if(!n)return;const{dynamicRadius:i=0,isDynamic:o}=n;if(!o){n.dynamicRadiusInCanvas=0;return}if(i===0)return;const a=r.getImageData();if(!a)return;const{spacing:s}=a,c=[r.element.clientWidth/2,r.element.clientHeight/2],l=i*s[0],u=r.canvasToWorld(c).map(g=>g+l),f=r.worldToCanvas(u),h=Math.abs(c[0]-f[0]);n.dynamicRadiusInCanvas||(n.dynamicRadiusInCanvas=0),n.dynamicRadiusInCanvas=3+h}},Yae={[ht.Initialize]:t=>{t.segmentIndex=0}},{isEqual:Q2}=hn,f_={toIJK:t=>t,fromIJK:t=>t,type:"acquistion"},Jae={toIJK:([t,e,r])=>[r,t,e],fromIJK:([t,e,r])=>[e,r,t],type:"jk"},Zae={toIJK:([t,e,r])=>[t,r,e],fromIJK:([t,e,r])=>[t,r,e],type:"ik"};function eO(t,e){if(!(t instanceof Zn))return{...f_,boundsIJKPrime:e};const{viewPlaneNormal:r}=t.getCamera(),n=Q2(Math.abs(r[0]),1)&&Jae||Q2(Math.abs(r[1]),1)&&Zae||Q2(Math.abs(r[2]),1)&&f_;return n?{...n,boundsIJKPrime:n.fromIJK(e)}:{toIJK:null,boundsIJKPrime:null,fromIJK:null,error:`Only mappings orthogonal to acquisition plane are permitted, but requested ${r}`}}const{RLEVoxelMap:Qae,VoxelManager:ese}=hn,tse=65535;var li;(function(t){t[t.SEGMENT=-1]="SEGMENT",t[t.ISLAND=-2]="ISLAND",t[t.INTERIOR=-3]="INTERIOR",t[t.EXTERIOR=-4]="EXTERIOR",t[t.INTERIOR_SMALL=-5]="INTERIOR_SMALL",t[t.INTERIOR_TEST=-6]="INTERIOR_TEST"})(li||(li={}));class Lu{constructor(e){this.fillInternalEdge=!1,this.maxInternalRemove=128,this.maxInternalRemove=e?.maxInternalRemove??this.maxInternalRemove,this.fillInternalEdge=e?.fillInternalEdge??this.fillInternalEdge}initialize(e,r,n){const i=!!r.sourceVoxelManager,o=i?r.sourceVoxelManager:r,a=i?r:ese.createRLEHistoryVoxelManager(o),{segmentIndex:s=1,previewSegmentIndex:c=1}=n,l=n.points||o.getPoints();if(!l?.length)return;const d=o.getBoundsIJK().map((C,x)=>[Math.min(C[0],...l.map(S=>S[x])),Math.max(C[1],...l.map(S=>S[x]))]);if(d.find(C=>C[0]<0||C[1]>tse))return;const{toIJK:u,fromIJK:f,boundsIJKPrime:h,error:g}=eO(e,d);if(g){console.warn("Not performing island removal for planes not orthogonal to acquisition plane",g);return}const[p,v,w]=f(o.dimensions),m=new Qae(p,v,w),y=(C,x,S)=>{const T=o.toIndex(u([C,x,S])),_=o.getAtIndex(T);if(_===c||_===s)return li.SEGMENT};return m.fillFrom(y,h),m.normalizer={toIJK:u,fromIJK:f,boundsIJKPrime:h},this.segmentSet=m,this.previewVoxelManager=a,this.segmentIndex=s,this.previewSegmentIndex=c??s,this.selectedPoints=l,!0}floodFillSegmentIsland(){const{selectedPoints:e,segmentSet:r}=this;let n=0;const{fromIJK:i}=r.normalizer;return e.forEach(o=>{const a=i(o),s=r.toIndex(a),[c,l,d]=a;r.get(s)===li.SEGMENT&&(n+=r.floodFill(c,l,d,li.ISLAND))}),n}removeExternalIslands(){const{previewVoxelManager:e,segmentSet:r}=this,{toIJK:n}=r.normalizer,i=(o,a)=>{const[,s,c]=r.toIJK(o);if(a.value!==li.ISLAND)for(let l=a.start;l<a.end;l++){const d=n([l,s,c]),u=e.getAtIJKPoint(d);e.setAtIJKPoint(d,u===void 0?0:null)}};r.forEach(i,{rowModified:!0})}removeInternalIslands(){const{segmentSet:e,previewVoxelManager:r,previewSegmentIndex:n}=this,{height:i,normalizer:o,width:a}=e,{toIJK:s}=o;return e.forEachRow((c,l)=>{let d;for(const u of[...l])if(u.value===li.ISLAND){if(!d){if(this.fillInternalEdge&&u.start>0)for(let f=0;f<u.start;f++)e.set(c+f,li.INTERIOR);d=u;continue}for(let f=d.end;f<u.start;f++)e.set(c+f,li.INTERIOR);d=u}if(this.fillInternalEdge&&d?.end<a)for(let u=d.end;u<a;u++)e.set(c+u,li.INTERIOR)}),e.forEach((c,l)=>{if(l.value!==li.INTERIOR)return;const[,d,u]=e.toIJK(c),f=d>0?e.getRun(d-1,u):null,h=d+1<i?e.getRun(d+1,u):null,g=d===i-1,p=d===0,v=Lu.covers(l,f)||p&&this.fillInternalEdge,w=Lu.covers(l,h)||g&&this.fillInternalEdge;l.end-l.start>2&&(!v||!w)&&e.floodFill(l.start,d,u,li.EXTERIOR,{singlePlane:!0})}),e.forEach((c,l)=>{if(l.value!==li.INTERIOR)return;const[,d,u]=e.toIJK(c),g=e.floodFill(l.start,d,u,li.INTERIOR_TEST)>this.maxInternalRemove?li.EXTERIOR:li.INTERIOR_SMALL;e.floodFill(l.start,d,u,g)}),e.forEach((c,l)=>{if(l.value===li.INTERIOR_SMALL)for(let d=l.start;d<l.end;d++){const u=s(e.toIJK(c+d));r.setAtIJKPoint(u,n)}}),r.getArrayOfModifiedSlices()}static covers(e,r){if(!r)return!1;let{start:n}=e;const{end:i}=e;for(const o of r)if(n>=o.start&&n<o.end&&(n=o.end,n>=i))return!0;return!1}}const nse={[ht.OnInteractionEnd]:t=>{const{previewSegmentIndex:e,segmentIndex:r,viewport:n,segmentationVoxelManager:i,activeStrategy:o,memo:a}=t;if(o!=="THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL"||r===null)return;const s=new Lu,c=a?.voxelManager||i;if(!s.initialize(n,c,{previewSegmentIndex:e,segmentIndex:r}))return;s.floodFillSegmentIsland(),s.removeExternalIslands(),s.removeInternalIslands();const l=c.getArrayOfModifiedSlices();l&&ei(t.segmentationId,l,e)}},rse={[ht.Preview]:function(t){const{previewSegmentIndex:e,configuration:r,enabledElement:n}=t;if(!e||!r)return;this.onInteractionStart?.(n,t);const i=this.fill(n,t);return i&&this.onInteractionEnd?.(n,t),i},[ht.Initialize]:t=>{const{segmentIndex:e,previewColor:r,previewSegmentIndex:n}=t;if(t.modified=!1,n==null||e==null)return;Fu(t.segmentationId)?.forEach(o=>{Z7(o,t.segmentationId,n,r)}),t.modified=!0},[ht.AcceptPreview]:t=>{const{previewSegmentIndex:e,segmentationVoxelManager:r,memo:n,segmentIndex:i,centerSegmentIndexInfo:o}=t||{},{changedIndices:a}=o||{},s=n,c=({index:l})=>{const d=r.getAtIndex(l);a?.length>0?a.includes(l)&&s.voxelManager.setAtIndex(l,0):d===e&&s.voxelManager.setAtIndex(l,i)};r.forEach(c),ei(t.segmentationId,r.getArrayOfModifiedSlices(),i),t.centerSegmentIndexInfo.changedIndices=[]},[ht.RejectPreview]:t=>{t&&fI.undoIf(e=>{const r=e;if(!r?.voxelManager)return!1;const{segmentationVoxelManager:n}=r;let i=!1;const o=({value:a})=>{a===t.previewSegmentIndex&&(i=!0)};return n.forEach(o),i})}},ise={[ht.Fill]:t=>{const{segmentsLocked:e,segmentationImageData:r,segmentationVoxelManager:n,brushStrategy:i,centerIJK:o}=t,a=i.createIsInThreshold?.(t),{setValue:s}=i,c=a?l=>{const{value:d,index:u}=l;e.includes(d)||!a(u)||s(t,l)}:l=>s(t,l);n.forEach(c,{imageData:r,isInObject:t.isInObject,boundsIJK:t.isInObjectBoundsIJK}),n.addPoint(o)}};function ose({operationData:t,existingValue:e,index:r}){const{previewSegmentIndex:n,memo:i,centerSegmentIndexInfo:o,previewOnHover:a,segmentIndex:s}=t,{hasPreviewIndex:c,hasSegmentIndex:l,segmentIndex:d}=o;if(d===0&&l&&c){if(e===s||a)return;if(e===n){i.voxelManager.setAtIndex(r,0);return}return}if(d===0&&l&&!c){if(e===0||e!==s)return;i.voxelManager.setAtIndex(r,n),o.changedIndices.push(r);return}if(d===0&&!l&&c){if(e===s||a)return;if(e===n){i.voxelManager.setAtIndex(r,0);return}return}if(d===0&&!l&&!c){if(e===s)return;if(e===n){i.voxelManager.setAtIndex(r,n);return}return}if(d===n&&l&&c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}if(d===n&&!l&&c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}if(d===s&&l&&c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}if(d===s&&l&&!c){if(e===s)return;i.voxelManager.setAtIndex(r,n);return}}const ase={[ht.INTERNAL_setValue]:(t,{value:e,index:r})=>{const{segmentsLocked:n,previewSegmentIndex:i,memo:o,segmentationVoxelManager:a,centerSegmentIndexInfo:s,segmentIndex:c}=t,l=a.getAtIndex(r);if(!n.includes(e)&&!(!s&&l===c)&&!(s?.segmentIndex!==0&&l===c)){if(s?.segmentIndex===null){o.voxelManager.setAtIndex(r,i??c);return}if(!i){let d=c;s&&(d=s.segmentIndex),o.voxelManager.setAtIndex(r,d);return}ose({operationData:t,existingValue:l,index:r})}}},sse={[ht.CreateIsInThreshold]:t=>{const{imageVoxelManager:e,segmentIndex:r,configuration:n}=t;if(!(!n||!r))return i=>{const o=e.getAtIndex(i),a=Array.isArray(o)?pr(o):o,{threshold:s}=n||{};return s?.range?.length?s.range[0]<=a&&a<=s.range[1]:!0}}},h_=10;function v1(){return{maxIJKs:[]}}function tO(t,e){const{value:r}=e,{maxIJKs:n}=t,i=n.length;if(typeof r!="number"||i>=h_&&r<n[0].value)return;const o={value:e.value,pointLPS:e.pointLPS?[e.pointLPS[0],e.pointLPS[1],e.pointLPS[2]]:void 0,pointIJK:e.pointIJK?[e.pointIJK[0],e.pointIJK[1],e.pointIJK[2]]:void 0};if(!i||r>=n[i-1].value)n.push(o);else for(let a=0;a<i;a++)if(r<=n[a].value){n.splice(a,0,o);break}i>=h_&&n.splice(0,1)}function nO(t,e,r){const{spacing:n,calibration:i}=r,{volumeUnit:o}=_o({calibration:i,hasPixelSpacing:!0},[]),a=n?n[0]*n[1]*n[2]:1;return e.volume={value:Array.isArray(e.count.value)?e.count.value.map(s=>s*a):e.count.value*a,unit:o,name:"volume",label:"Volume"},e.maxIJKs=t.maxIJKs.filter(s=>s.pointIJK!==void 0),e.array.push(e.volume),t.maxIJKs=[],e}const Ix=class Ix extends is{static statsInit(e){super.statsInit(e),this.volumetricState=v1()}static statsCallback(e){super.statsCallback(e),tO(this.volumetricState,e)}static getStatistics(e){const r={...e,unit:e?.unit||"none",calibration:e?.calibration,hasPixelSpacing:e?.hasPixelSpacing},n=super.getStatistics(r);return nO(this.volumetricState,n,r)}};Ix.volumetricState=v1();let xu=Ix;class g_ extends z9{constructor(e){super(e),this.volumetricState=v1()}statsInit(e){super.statsInit(e),this.volumetricState=v1()}statsCallback(e){super.statsCallback(e),tO(this.volumetricState,e)}getStatistics(e){const r={...e,unit:e?.unit||"none",calibration:e?.calibration,hasPixelSpacing:e?.hasPixelSpacing},n=super.getStatistics(r);return nO(this.volumetricState,n,r)}}const cse=Math.pow(3*1e3/(4*Math.PI),1/3);async function rO({segmentationId:t,segmentIndices:e,mode:r="collective"}){Rm(),os(Co.COMPUTE_STATISTICS,0);const n=H7(t,e);if(!n)return;const{operationData:i,segVolumeId:o,segImageIds:a,reconstructableVolume:s,indices:c}=n,{refImageId:l,modalityUnitOptions:d}=_ie(o,a),u=tM(l,d);return s?await lse({operationData:i,indices:c,unit:u,mode:r}):await use({segImageIds:a,indices:c,unit:u,mode:r})}async function lse({operationData:t,indices:e,unit:r,mode:n}){const i=X7(t),{segmentationVoxelManager:o,imageVoxelManager:a,segmentationImageData:s,imageData:c}=i;if(!o||!s)return;const l=s.getSpacing(),{boundsIJK:d}=o;if(!d)return xu.getStatistics({spacing:l});const f={scalarData:o.getCompleteScalarDataArray(),dimensions:s.getDimensions(),spacing:s.getSpacing(),origin:s.getOrigin(),direction:s.getDirection()},h={scalarData:a.getCompleteScalarDataArray(),dimensions:c.getDimensions(),spacing:c.getSpacing(),origin:c.getOrigin(),direction:c.getDirection()};if(!h.scalarData?.length)return;const g=await cc().executeTask("compute","calculateSegmentsStatisticsVolume",{segmentationInfo:f,imageInfo:h,indices:e,unit:r,mode:n});if(os(Co.COMPUTE_STATISTICS,100),n==="collective")return y1({stats:g,unit:r,spacing:l,segmentationImageData:s,imageVoxelManager:a});{const p={};return Object.entries(g).forEach(([v,w])=>{p[v]=y1({stats:w,unit:r,spacing:l,segmentationImageData:s,imageVoxelManager:a})}),p}}const ev=(t,e)=>{if(!t.array)return;const r=t.array.findIndex(n=>n.name===e.name);r!==-1?t.array[r]=e:t.array.push(e)},y1=({stats:t,unit:e,spacing:r,segmentationImageData:n,imageVoxelManager:i})=>{if(t.mean.unit=e,t.max.unit=e,t.min.unit=e,e!=="SUV")return t;const o=r.map(a=>Math.max(1,Math.round(1.1*cse/a)));for(const a of t.maxIJKs){const s=dse(a,o,n,i,r);if(!s)continue;const{mean:c}=s;(!t.peakValue||t.peakValue.value<=c.value)&&(t.peakValue={name:"peakValue",label:"Peak Value",value:c.value,unit:e},t.peakPoint={name:"peakLPS",label:"Peak SUV Point",value:a.pointLPS?[...a.pointLPS]:null,unit:null},ev(t,t.peakValue),ev(t,t.peakPoint))}if(t.volume&&t.mean){const a=t.volume.value,s=t.mean.value;t.lesionGlycolysis={name:"lesionGlycolysis",label:"Lesion Glycolysis",value:a*s,unit:`${t.volume.unit}${e}`},ev(t,t.lesionGlycolysis)}return t};async function use({segImageIds:t,indices:e,unit:r,mode:n}){os(Co.COMPUTE_STATISTICS,0);const{segmentationInfo:i,imageInfo:o}=K7(t),a=await cc().executeTask("compute","calculateSegmentsStatisticsStack",{segmentationInfo:i,imageInfo:o,indices:e,mode:n});os(Co.COMPUTE_STATISTICS,100);const s=i[0].spacing,c=i[0],l=o[0].voxelManager;if(n==="collective")return y1({stats:a,unit:r,spacing:s,segmentationImageData:c,imageVoxelManager:l});{const d={};return Object.entries(a).forEach(([u,f])=>{d[u]=y1({stats:f,unit:r,spacing:s,segmentationImageData:c,imageVoxelManager:l})}),d}}function dse(t,e,r,n,i){const{pointIJK:o,pointLPS:a}=t;if(!o)return;const s=o.map((d,u)=>[d-e[u],d+e[u]]),c=(d,u)=>{const f=(u[0]-o[0])/e[0],h=(u[1]-o[1])/e[1],g=(u[2]-o[2])/e[2];return f*f+h*h+g*g<=1},l=({pointIJK:d,pointLPS:u})=>{const f=n.getAtIJKPoint(d);f!==void 0&&xu.statsCallback({value:f,pointLPS:u,pointIJK:d})};return xu.statsInit({storePointData:!1}),pw(r,{pointInShapeFn:c,callback:l,boundsIJK:s}),xu.getStatistics({spacing:i})}const fse={[ht.GetStatistics]:function(t,e,r){const{indices:n}=r,{segmentationId:i,viewport:o}=e;rO({segmentationId:i,segmentIndices:n})}},hse={[ht.CalculateCursorGeometry]:function(t,e){if(!e)return;const{configuration:r,activeStrategy:n,hoverData:i}=e,{viewport:o}=t,a=o.getCamera(),{brushSize:s}=r,c=mt(a.viewUp[0],a.viewUp[1],a.viewUp[2]),l=mt(a.viewPlaneNormal[0],a.viewPlaneNormal[1],a.viewPlaneNormal[2]),d=Ie();tn(d,c,l);const{canvasToWorld:u}=o,{centerCanvas:f}=i,h=u([f[0],f[1]]),g=Ie(),p=Ie(),v=Ie(),w=Ie();for(let x=0;x<=2;x++)g[x]=h[x]-c[x]*s,p[x]=h[x]+c[x]*s,v[x]=h[x]-d[x]*s,w[x]=h[x]+d[x]*s;if(!i)return;const{brushCursor:m}=i,{data:y}=m;y.handles===void 0&&(y.handles={}),y.handles.points=[g,p,v,w];const C=r.strategies[n];typeof C?.computeInnerCircleRadius=="function"&&C.computeInnerCircleRadius({configuration:r,viewport:o}),y.invalidated=!1},[ht.RenderCursor]:function(t,e,r){if(!e)return;const{configuration:n,hoverData:i}=e,{viewport:o}=t,{brushCursor:a}=i,s=a.metadata;if(!s)return;const c=s.brushCursorUID,l=a.data,{points:d}=l.handles,u=d.map(y=>o.worldToCanvas(y)),f=u[0],h=u[1],g=[Math.floor((f[0]+h[0])/2),Math.floor((f[1]+h[1])/2)],p=Math.abs(f[1]-Math.floor((f[1]+h[1])/2)),v=`rgb(${s.segmentColor?.slice(0,3)||[0,0,0]})`;if(!o.getRenderingEngine()){console.warn("Rendering Engine has been destroyed");return}hi(r,c,"0",g,p,{color:v,lineDash:this.centerSegmentIndexInfo.segmentIndex===0?[1,2]:null});const{dynamicRadiusInCanvas:m}=n?.threshold||{dynamicRadiusInCanvas:0};m&&hi(r,c,"1",g,m,{color:v})}},Qt={determineSegmentIndex:Kae,dynamicThreshold:qae,erase:Yae,islandRemoval:nse,preview:rse,regionFill:ise,setValue:ase,threshold:sse,labelmapStatistics:fse,ensureSegmentationVolumeFor3DManipulation:z7,ensureImageVolumeFor3DManipulation:j7,circularCursor:hse},lu=class lu{constructor(e,...r){this._initialize=[],this._fill=[],this._onInteractionStart=[],this.fill=(o,a)=>{const s=this.initialize(o,a,ht.Fill);if(!s)return;this._fill.forEach(d=>d(s));const{segmentationVoxelManager:c,segmentIndex:l}=s;return ei(s.segmentationId,c.getArrayOfModifiedSlices(),l),s},this.onInteractionStart=(o,a)=>{const s=this.initialize(o,a);s&&this._onInteractionStart.forEach(c=>c.call(this,s))},this.addPreview=(o,a)=>{const s=this.initialize(o,a,ht.AddPreview);if(s)return s},this.configurationName=e;const n=r.find(o=>o.hasOwnProperty(ht.CalculateCursorGeometry)),i=r.find(o=>o.hasOwnProperty(ht.RenderCursor));n||r.push({[ht.CalculateCursorGeometry]:Qt.circularCursor.calculateCursorGeometry}),i||r.push({[ht.RenderCursor]:Qt.circularCursor.renderCursor}),this.compositions=r,r.forEach(o=>{const a=typeof o=="function"?o():o;if(a)for(const s in a){if(!lu.childFunctions[s])throw new Error(`Didn't find ${s} as a brush strategy`);lu.childFunctions[s](this,a[s])}}),this.strategyFunction=(o,a)=>this.fill(o,a);for(const o of Object.keys(lu.childFunctions))this.strategyFunction[o]=this[o]}initialize(e,r,n){const{viewport:i}=e,o=HC({operationData:r,viewport:i,strategy:this});if(!o)return null;const{imageVoxelManager:a,segmentationVoxelManager:s,segmentationImageData:c}=o,l=r.createMemo(r.segmentationId,s),d={operationName:n,...r,segmentIndex:r.segmentIndex,enabledElement:e,imageVoxelManager:a,segmentationVoxelManager:s,segmentationImageData:c,viewport:i,centerWorld:null,isInObject:null,isInObjectBoundsIJK:null,brushStrategy:this,memo:l};return this._initialize.forEach(u=>u(d)),d}};lu.COMPOSITIONS=Qt,lu.childFunctions={[ht.OnInteractionStart]:ta(ht.OnInteractionStart,ht.Initialize),[ht.OnInteractionEnd]:ta(ht.OnInteractionEnd,ht.Initialize),[ht.Fill]:ta(ht.Fill),[ht.Initialize]:ta(ht.Initialize),[ht.CreateIsInThreshold]:n0(ht.CreateIsInThreshold),[ht.Interpolate]:ta(ht.Interpolate,ht.Initialize),[ht.AcceptPreview]:ta(ht.AcceptPreview,ht.Initialize),[ht.RejectPreview]:ta(ht.RejectPreview,ht.Initialize),[ht.INTERNAL_setValue]:n0(ht.INTERNAL_setValue),[ht.Preview]:n0(ht.Preview,!1),[ht.ComputeInnerCircleRadius]:ta(ht.ComputeInnerCircleRadius),[ht.EnsureSegmentationVolumeFor3DManipulation]:ta(ht.EnsureSegmentationVolumeFor3DManipulation),[ht.EnsureImageVolumeFor3DManipulation]:ta(ht.EnsureImageVolumeFor3DManipulation),[ht.AddPreview]:ta(ht.AddPreview),[ht.GetStatistics]:n0(ht.GetStatistics),[ht.CalculateCursorGeometry]:n0(ht.CalculateCursorGeometry,!0),[ht.RenderCursor]:n0(ht.RenderCursor,!0),compositions:null};let ya=lu;function ta(t,e){const r=`_${t}`;return(n,i)=>{n[r]||=[],n[r].push(i),n[t]||=e?(o,a,...s)=>{const c=n[e](o,a,t);let l;return n[r].forEach(d=>{const u=d.call(n,c,...s);l||=u}),l}:(o,...a)=>{n[r].forEach(s=>s.call(n,o,...a))}}}function n0(t,e=!0){return(r,n)=>{if(r[t])throw new Error(`The singleton method ${t} already exists`);r[t]=e?n:(i,o,...a)=>(o.enabledElement=i,n.call(r,o,...a))}}function iO(t,e){const{center:r,radius:n}=t,i=t.radius2||n*n;return(e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1])+(e[2]-r[2])*(e[2]-r[2])<=i}const{transformWorldToIndex:p_,transformIndexToWorld:m_,isEqual:gse}=hn;function oO(t){const[e,r,n,i]=t,o=[n[0],r[1]],a=[i[0],e[1]],s=[n[0],e[1]],c=[i[0],r[1]];return[o,a,s,c]}function pse(t,e,r,n){const i=mt(t[0],t[1],t[2]),o=Ie();en(o,i,e,n);const a=Ie();en(a,i,e,-n);const s=Ie();en(s,i,r,n);const c=Ie();return en(c,i,r,-n),[a,o,c,s]}function mse(t,e){if(!t.length||e<=0)return null;const r=e*e,n=t.map(o=>[o[0],o[1],o[2]]),i=[];for(let o=1;o<n.length;o++){const a=n[o-1],s=n[o],c=s[0]-a[0],l=s[1]-a[1],d=s[2]-a[2],u=c*c+l*l+d*d;i.push({start:a,vector:[c,l,d],lengthSquared:u})}return o=>{if(!o)return!1;for(const a of n){const s=o[0]-a[0],c=o[1]-a[1],l=o[2]-a[2];if(s*s+c*c+l*l<=r)return!0}for(const{start:a,vector:s,lengthSquared:c}of i){if(c===0){const C=o[0]-a[0],x=o[1]-a[1],S=o[2]-a[2];if(C*C+x*x+S*S<=r)return!0;continue}const l=o[0]-a[0],d=o[1]-a[1],u=o[2]-a[2],f=l*s[0]+d*s[1]+u*s[2],h=Math.max(0,Math.min(1,f/c)),g=a[0]+s[0]*h,p=a[1]+s[1]*h,v=a[2]+s[2]*h,w=o[0]-g,m=o[1]-p,y=o[2]-v;if(w*w+m*m+y*y<=r)return!0}return!1}}const aO={[ht.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n,viewUp:i,viewPlaneNormal:o}=t;if(!e)return;const a=Ie();e.length>=2?(hr(a,e[0],e[1]),xr(a,a,.5)):F1(a,e[0]),t.centerWorld=a,t.centerIJK=p_(n,a);const s=e.length>=2?Dr(e[0],e[1])/2:0,c=e.map(y=>r.worldToCanvas(y)),d=oO(c).map(y=>r.canvasToWorld(y)),u=mt(i[0],i[1],i[2]);Lt(u,u);const f=mt(o[0],o[1],o[2]);Lt(f,f);const h=Ie();tn(h,u,f),Lt(h,h);const p=(t.strokePointsWorld&&t.strokePointsWorld.length>0?t.strokePointsWorld:[t.centerWorld]).map(y=>Fo(y)),w=p.flatMap(y=>pse(y,u,h,s)).map(y=>p_(n,y)),m=hl(w,n.getDimensions());t.strokePointsWorld=p,t.isInObject=sO(d,{strokePointsWorld:p,segmentationImageData:n,radius:s}),t.isInObjectBoundsIJK=m}};function sO(t=[],e={}){if(!t||t.length!==4)throw new Error("createPointInEllipse: cornersInWorld must have 4 points");const[r,n,i,o]=t,a=Ie();hr(a,r,n),xr(a,a,.5);const s=Ie();an(s,o,r);const c=pr(s)/2;Lt(s,s);const l=Ie();an(l,i,r);const d=pr(l)/2;Lt(l,l);const u=Ie();tn(u,s,l),Lt(u,u);const f=e.radius??Math.max(c,d),h=mse(e.strokePointsWorld||[],f);if(gse(c,d)){const g=c,p={center:a,radius:g,radius2:g*g};return(v,w)=>{let m=v;return!m&&w&&e.segmentationImageData&&(m=m_(e.segmentationImageData,w)),m?h?.(m)?!0:iO(p,m):!1}}return(g,p)=>{let v=g;if(!v&&p&&e.segmentationImageData&&(v=m_(e.segmentationImageData,p)),!v)return!1;if(h?.(v))return!0;const w=Ie();an(w,v,a);const m=ft(w,u),y=Ie();en(y,w,u,-m);const C=Ie(),x=Ie();an(x,a,r),an(C,y,x);const S=ft(C,s),T=ft(C,l);return S*S/(c*c)+T*T/(d*d)<=1}}const cO=new ya("Circle",Qt.regionFill,Qt.setValue,aO,Qt.determineSegmentIndex,Qt.preview,Qt.labelmapStatistics),vse=new ya("CircleThreshold",Qt.regionFill,Qt.setValue,aO,Qt.determineSegmentIndex,Qt.dynamicThreshold,Qt.threshold,Qt.preview,Qt.islandRemoval,Qt.labelmapStatistics),km=cO.strategyFunction,yse=vse.strategyFunction;function wse(){throw new Error("Not yet implemented")}const{transformWorldToIndex:v_}=hn,Cse={[ht.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n}=t;if(!e)return;const i=Ie();e.length>=2?(hr(i,e[0],e[1]),xr(i,i,.5)):F1(i,e[0]),t.centerWorld=i,t.centerIJK=v_(n,i);const o=Fae(e.slice(0,2),n,r),a=e.map(p=>r.worldToCanvas(p)),c=oO(a).map(p=>r.canvasToWorld(p)),l=e.length>=2?Dr(e[0],e[1])/2:void 0,d=t.strokePointsWorld&&t.strokePointsWorld.length>0?t.strokePointsWorld:[t.centerWorld],u=o.boundsIJK,f=t.centerIJK,g=d.reduce((p,v)=>{if(!v)return p;const w=v_(n,v),m=[w[0]-f[0],w[1]-f[1],w[2]-f[2]],y=[[u[0][0]+m[0],u[0][1]+m[0]],[u[1][0]+m[1],u[1][1]+m[1]],[u[2][0]+m[2],u[2][1]+m[2]]];return p?[[Math.min(p[0][0],y[0][0]),Math.max(p[0][1],y[0][1])],[Math.min(p[1][0],y[1][0]),Math.max(p[1][1],y[1][1])],[Math.min(p[2][0],y[2][0]),Math.max(p[2][1],y[2][1])]]:y},null)??o.boundsIJK;if(n){const p=n.getDimensions();t.isInObjectBoundsIJK=[[Math.max(0,Math.min(g[0][0],p[0]-1)),Math.max(0,Math.min(g[0][1],p[0]-1))],[Math.max(0,Math.min(g[1][0],p[1]-1)),Math.max(0,Math.min(g[1][1],p[1]-1))],[Math.max(0,Math.min(g[2][0],p[2]-1)),Math.max(0,Math.min(g[2][1],p[2]-1))]]}else t.isInObjectBoundsIJK=g;t.isInObject=sO(c,{strokePointsWorld:t.strokePointsWorld,segmentationImageData:n,radius:l})}},Fm=new ya("Sphere",Qt.regionFill,Qt.setValue,Cse,Qt.determineSegmentIndex,Qt.preview,Qt.labelmapStatistics,Qt.ensureSegmentationVolumeFor3DManipulation),lO=Fm.strategyFunction,xse=new ya("SphereThreshold",...Fm.compositions,Qt.dynamicThreshold,Qt.threshold,Qt.ensureSegmentationVolumeFor3DManipulation,Qt.ensureImageVolumeFor3DManipulation),Sse=new ya("SphereThreshold",...Fm.compositions,Qt.dynamicThreshold,Qt.threshold,Qt.islandRemoval,Qt.ensureSegmentationVolumeFor3DManipulation,Qt.ensureImageVolumeFor3DManipulation),Tse=xse.strategyFunction,_se=Sse.strategyFunction,Ese=new ya("EraseSphere",Qt.erase,...Fm.compositions),uO=Ese.strategyFunction,bse=new ya("EraseCircle",Qt.erase,...cO.compositions),dO=bse.strategyFunction,{VoxelManager:Ly,RLEVoxelMap:Dse}=hn;function Ny(t,e){return hO(t,e)}function fO(t){const{segmentationVoxelManager:e,undoVoxelManager:r,redoVoxelManager:n}=this,i=t===!1?n:r;i.forEach(({value:a,pointIJK:s})=>{e.setAtIJKPoint(s,a)});const o=i.getArrayOfModifiedSlices();ei(this.segmentationId,o)}function hO(t,e){const r=Ly.createRLEHistoryVoxelManager(e);return{segmentationId:t,restoreMemo:fO,commitMemo:Ise,segmentationVoxelManager:e,voxelManager:r,id:cn(),operationType:"labelmap"}}function Ise(){if(this.redoVoxelManager)return!0;if(!this.voxelManager.modifiedSlices.size)return!1;const{segmentationVoxelManager:t}=this,e=Ly.createRLEHistoryVoxelManager(t);Dse.copyMap(e.map,this.voxelManager.map);for(const n of this.voxelManager.modifiedSlices.keys())e.modifiedSlices.add(n);this.undoVoxelManager=e;const r=Ly.createRLEVolumeVoxelManager({dimensions:this.segmentationVoxelManager.dimensions});return this.redoVoxelManager=r,e.forEach(({index:n,pointIJK:i,value:o})=>{const a=t.getAtIJKPoint(i);a!==o&&r.setAtIndex(n,a)}),!0}const Mse=Object.freeze(Object.defineProperty({__proto__:null,createLabelmapMemo:Ny,createRleMemo:hO,restoreMemo:fO},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:gO}=hn,pO={[ht.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n}=t;if(!e)return;const i=mt(0,0,0);e.forEach(s=>{hr(i,i,s)}),xr(i,i,1/e.length),t.centerWorld=i,t.centerIJK=gO(n,i);const{boundsIJK:o,pointInShapeFn:a}=Ose(r,e,n);t.isInObject=a,t.isInObjectBoundsIJK=o}};function Ose(t,e,r){let n=e.map(y=>gO(r,y));n=n.map(y=>y.map(C=>Math.round(C)));const i=hl(n,r.getDimensions()),[o,a,s,c]=e,l=Ie(),d=Ie();an(l,a,o),an(d,c,o);const u=pr(l),f=pr(d);Lt(l,l),Lt(d,d);const h=Ie();tn(h,l,d),Lt(h,h);const g=r.getDirection(),p=r.getSpacing(),{viewPlaneNormal:v}=t.getCamera(),w=ml({direction:g,spacing:p},v);return{boundsIJK:i,pointInShapeFn:y=>{const C=Ie();an(C,y,o);const x=ft(C,l),S=ft(C,d),T=Math.abs(ft(C,h));return x>=-w&&x<=u+w&&S>=-w&&S<=f+w&&T<=w}}}const Pse=new ya("Rectangle",Qt.regionFill,Qt.setValue,pO,Qt.determineSegmentIndex,Qt.preview,Qt.labelmapStatistics),Rse=new ya("RectangleThreshold",Qt.regionFill,Qt.setValue,pO,Qt.determineSegmentIndex,Qt.dynamicThreshold,Qt.threshold,Qt.preview,Qt.islandRemoval,Qt.labelmapStatistics),tx=Pse.strategyFunction,Ase=Rse.strategyFunction,Lse=Object.freeze(Object.defineProperty({__proto__:null,fillInsideCircle:km,fillInsideRectangle:tx,fillOutsideCircle:wse,thresholdInsideRectangle:Ase},Symbol.toStringTag,{value:"Module"})),Lf=class Lf extends ar{constructor(e,r){super(e,r),this.memoMap=new Map,this.acceptedMemoIds=new Map,this.centerSegmentIndexInfo={segmentIndex:null,hasSegmentIndex:!1,hasPreviewIndex:!1,changedIndices:[]}}_historyRedoHandler(e){const{id:r,operationType:n}=e.detail;if(n==="labelmap"){if(this.acceptedMemoIds.has(r)){this._hoverData=null;const i=this.acceptedMemoIds.get(r),o=i?.element,a=this.getOperationData(o);a.segmentIndex=i?.segmentIndex,o&&this.applyActiveStrategyCallback(Ce(o),a,ht.AcceptPreview)}this._previewData.isDrag=!0}}get _previewData(){return Lf.previewData}hasPreviewData(){return!!this._previewData.preview}shouldResolvePreviewRequests(){return(this.mode==="Active"||this.mode==="Enabled")&&this.hasPreviewData()}createMemo(e,r){const n=r.id;if(this.memo&&this.memo.segmentationVoxelManager===r)return this.memo;let i=this.memoMap.get(n);return i?i.redoVoxelManager&&(i=Ny(e,r),this.memoMap.set(n,i)):(i=Ny(e,r),this.memoMap.set(n,i)),this.memo=i,i}createEditData(e){const r=Ce(e),{viewport:n}=r,i=Ru(n.id);if(!i){const l=new CustomEvent($e.ERROR_EVENT,{detail:{type:"Segmentation",message:"No active segmentation detected, create a segmentation representation before using the brush tool"},cancelable:!0});return Fe.dispatchEvent(l),null}const{segmentationId:o}=i,a=Bu(o),{representationData:s}=Ut(o);return this.getEditData({viewport:n,representationData:s,segmentsLocked:a,segmentationId:o})}getEditData({viewport:e,representationData:r,segmentsLocked:n,segmentationId:i}){if(e instanceof Zn){const{volumeId:o}=r[yt.Labelmap],a=e.getActors();if(e instanceof Wn){const u=new CustomEvent($e.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return Fe.dispatchEvent(u),null}const c=a.map(u=>Ne.getVolume(u.referencedId)),l=Ne.getVolume(o),d=c.find(u=>Et(u.dimensions,l.dimensions))?.volumeId||c[0]?.volumeId;return{volumeId:o,referencedVolumeId:this.configuration.threshold?.volumeId??d,segmentsLocked:n}}else{const o=wl(e.id,i);return o?{imageId:o,segmentsLocked:n}:void 0}}createHoverData(e,r){const n=Ce(e),{viewport:i}=n,o=i.getCamera(),{viewPlaneNormal:a,viewUp:s}=o,c=[i.id],{segmentIndex:l,segmentationId:d,segmentColor:u}=this.getActiveSegmentationData(i)||{};return{brushCursor:{metadata:{viewPlaneNormal:[...a],viewUp:[...s],FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:u},data:{}},centerCanvas:r,segmentIndex:l,viewport:i,segmentationId:d,segmentColor:u,viewportIdsToRender:c}}getActiveSegmentationData(e){const r=e.id,n=Ru(r);if(!n)return;const{segmentationId:i}=n,o=zi(i);if(!o)return;const a=as(r,i,o);return{segmentIndex:o,segmentationId:i,segmentColor:a}}getOperationData(e){const r=this._editData||this.createEditData(e),{segmentIndex:n,segmentationId:i,brushCursor:o}=this._hoverData||this.createHoverData(e),{data:a,metadata:s={}}=o||{},{viewPlaneNormal:c,viewUp:l}=s,d=this.configuration.preview?.previewColors?.[n],{viewport:u}=Ce(e),f=as(u.id,i,n);if(!d&&!f)return;let h=null,g=null;return this.configuration.preview?.enabled&&(h=d||Nse(...f),g=255),{...r,points:a?.handles?.points,segmentIndex:n,viewPlaneNormal:c,previewOnHover:!this._previewData.isDrag,toolGroupId:this.toolGroupId,segmentationId:i,viewUp:l,centerSegmentIndexInfo:this.centerSegmentIndexInfo,activeStrategy:this.configuration.activeStrategy,configuration:this.configuration,previewColor:h,previewSegmentIndex:g,createMemo:this.createMemo.bind(this),hoverData:this._hoverData}}addPreview(e=this._previewData.element,r){const{_previewData:n}=this,i=r?.acceptReject;i===!0?this.acceptPreview(e):i===!1&&this.rejectPreview(e);const o=Ce(e),a=this.applyActiveStrategyCallback(o,this.getOperationData(e),ht.AddPreview);return n.isDrag=!0,a?.modified&&(n.preview=a,n.element=e),a}rejectPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const r=Ce(e);this.applyActiveStrategyCallback(r,this.getOperationData(e),ht.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(e=this._previewData.element){if(!e)return;const r=this.getOperationData(e);this.memo&&this.memo.id&&this.acceptedMemoIds.set(this.memo.id,{element:e,segmentIndex:r.segmentIndex});const n=Ce(e);this.applyActiveStrategyCallback(n,r,ht.AcceptPreview),this.doneEditMemo(),this._previewData.preview=null,this._previewData.isDrag=!1}static viewportContoursToLabelmap(e,r){const n=r?.removeContours??!0,i=ld(),o=Hh(e,i);if(!o?.length)return;const a=o.filter(v=>v.data.contour?.polyline?.length);if(!a.length)return;const c=new Lf({},{configuration:{strategies:{FILL_INSIDE_CIRCLE:km},activeStrategy:"FILL_INSIDE_CIRCLE"}}).addPreview(e.element),{memo:l,segmentationId:d}=c,u=l?.voxelManager,f=u.sourceVoxelManager||u,{dimensions:h}=u,g=e.getDefaultActor().actor.getMapper().getInputData();for(const v of a){const w=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],{polyline:m}=v.data.contour;for(const b of m)g.worldToIndex(b).forEach((O,M)=>{w[M][0]=Math.min(w[M][0],O),w[M][1]=Math.max(w[M][1],O)});w.forEach((b,I)=>{b[0]=Math.round(Math.max(0,b[0])),b[1]=Math.round(Math.min(h[I]-1,b[1]))});const y=zi(d),C=v.data.handles?.[0]||m[0],x=g.worldToIndex(C).map(Math.round),S=f.getAtIJKPoint(x)||0;let T=!1,_=!1;for(const b of m){const I=g.worldToIndex(b).map(Math.round),O=f.getAtIJKPoint(I);O===S?T=!0:O>=0&&(_=!0)}const D=T&&_?S:S===0?y:0;for(let b=w[0][0];b<=w[0][1];b++)for(let I=w[1][0];I<=w[1][1];I++)for(let O=w[2][0];O<=w[2][1];O++){const M=g.indexToWorld([b,I,O]);CC(M,m)&&u.setAtIJK(b,I,O,D)}n&&kt(v.annotationUID)}const p=u.getArrayOfModifiedSlices();ei(d,p)}};Lf.previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1};let Nu=Lf;function Nse(t,e,r,n,i=.4){return[Math.round(t+(255-t)*i),Math.round(e+(255-e)*i),Math.round(r+(255-r)*i),n]}class Vu extends Nu{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:km,ERASE_INSIDE_CIRCLE:dO,FILL_INSIDE_SPHERE:lO,ERASE_INSIDE_SPHERE:uO,THRESHOLD_INSIDE_CIRCLE:yse,THRESHOLD_INSIDE_SPHERE:Tse,THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL:_se},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",brushSize:25,useCenterSegmentIndex:!1,preview:{enabled:!1,previewColors:{0:[255,255,255,128]},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[ht.AcceptPreview]:{method:ht.AcceptPreview,bindings:[{key:"Enter"}]},[ht.RejectPreview]:{method:ht.RejectPreview,bindings:[{key:"Escape"}]},[ht.Interpolate]:{method:ht.Interpolate,bindings:[{key:"i"}],configuration:{useBallStructuringElement:!0,noUseDistanceTransform:!0,noUseExtrapolation:!0}},interpolateExtrapolation:{method:ht.Interpolate,bindings:[{key:"e"}],configuration:{}}}}}){super(e,r),this._lastDragInfo=null,this.onSetToolPassive=n=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=n=>{this.disableCursor()},this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c}=s;this._editData=this.createEditData(o),this._activateDraw(o),St(o),n.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const l=da(a.canvas),d=c.canvasToWorld([l[0],l[1]]);this._lastDragInfo={canvas:l,world:Fo(d)};const u=this._hoverData||this.createHoverData(o);Me(u.viewportIdsToRender);const f=this.getOperationData(o);return f?(this.applyActiveStrategyCallback(s,f,ht.OnInteractionStart),!0):!1},this.mouseMoveCallback=n=>{if(this.isPrimary&&this.mode===Cn.Active){if(this.updateCursor(n),!this.configuration.preview.enabled)return;const{previewTimeMs:i,previewMoveDistance:o,dragMoveDistance:a}=this.configuration.preview,{currentPoints:s,element:c}=n.detail,{canvas:l}=s,{startPoint:d,timer:u,timerStart:f,isDrag:h}=this._previewData;if(h)return;const g=Bn(l,d),p=Date.now()-f;if((g>o||p>i&&g>a)&&(u&&(window.clearTimeout(u),this._previewData.timer=null),h||this.rejectPreview(c)),!this._previewData.timer){const v=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:v,startPoint:l,element:c})}}},this.previewCallback=()=>{if(this._previewData.isDrag){this._previewData.timer=null;return}this._previewData.timer=null;const n=this.getOperationData(this._previewData.element),i=Ce(this._previewData.element);if(!i)return;const{viewport:o}=i,a=this.configuration.activeStrategy,s=HC({operationData:n,viewport:o,strategy:a});if(!n)return;const c=this.createMemo(n.segmentationId,s.segmentationVoxelManager);this._previewData.preview=this.applyActiveStrategyCallback(Ce(this._previewData.element),{...n,...s,memo:c},ht.Preview)},this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c}=s;this.updateCursor(n);const{viewportIdsToRender:l}=this._hoverData;Me(l);const d=Bn(a.canvas,this._previewData.startPoint),{dragTimeMs:u,dragMoveDistance:f}=this.configuration.preview;if(!this._previewData.isDrag&&Date.now()-this._previewData.timerStart<u&&d<f)return;if(this._previewData.timer&&(window.clearTimeout(this._previewData.timer),this._previewData.timer=null),!this._lastDragInfo){const w=this._previewData.startPoint,m=c.canvasToWorld([w[0],w[1]]);this._lastDragInfo={canvas:da(w),world:Fo(m)}}const h=a.canvas,g=c.canvasToWorld([h[0],h[1]]);this._hoverData=this.createHoverData(o,h),this._calculateCursor(o,h);const p=this.getOperationData(o);if(!p)return;p.strokePointsWorld=[Fo(this._lastDragInfo.world),Fo(g)],this._previewData.preview=this.applyActiveStrategy(s,p);const v=da(h);this._lastDragInfo={canvas:v,world:Fo(g)},this._previewData.element=o,this._previewData.timerStart=Date.now()+u,this._previewData.isDrag=!0,this._previewData.startPoint=v},this._endCallback=n=>{const i=n.detail,{element:o}=i,a=Ce(o),s=this.getOperationData(o);s&&(!this._previewData.preview&&!this._previewData.isDrag&&this.applyActiveStrategy(a,s),this.doneEditMemo(),this._deactivateDraw(o),Nt(o),this.updateCursor(n),this._editData=null,this._lastDragInfo=null,this.applyActiveStrategyCallback(a,s,ht.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(o))},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}updateCursor(e){const r=e.detail,{element:n}=r,{currentPoints:i}=r,o=i.canvas;this._hoverData=this.createHoverData(n,o),this._calculateCursor(n,o),this._hoverData&&(Vu.activeCursorTool=this,Me(this._hoverData.viewportIdsToRender))}_calculateCursor(e,r){const n=Ce(e);this.applyActiveStrategyCallback(n,this.getOperationData(e),ht.CalculateCursorGeometry)}getStatistics(e,r){if(!e)return;const n=Ce(e);return this.applyActiveStrategyCallback(n,this.getOperationData(e),ht.GetStatistics,r)}rejectPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const r=Ce(e);r&&(this.applyActiveStrategyCallback(r,this.getOperationData(e),ht.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1)}acceptPreview(e=this._previewData.element){e&&super.acceptPreview(e)}interpolate(e,r){if(!e)return;const n=Ce(e);this._previewData.preview=this.applyActiveStrategyCallback(n,this.getOperationData(e),ht.Interpolate,r.configuration),this._previewData.isDrag=!0}invalidateBrushCursor(){if(this._hoverData===void 0)return;const{data:e}=this._hoverData.brushCursor,{viewport:r}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(r)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,r){if(!this._hoverData||Vu.activeCursorTool!==this)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;if(this._hoverData.brushCursor.data.invalidated===!0){const{centerCanvas:a}=this._hoverData,{element:s}=n;this._calculateCursor(s,a)}this.applyActiveStrategyCallback(e,this.getOperationData(n.element),ht.RenderCursor,r)}}Vu.toolName="Brush";function xd(t,e){const r=Fr(t);if(r===void 0)return[];const n=r._toolInstances;return Object.keys(n).length?e&&n[e]?[n[e]]:Object.values(n).filter(o=>o instanceof Vu):[]}function Vse(t,e,r){const n=Fr(t);if(n===void 0)return;xd(t,r).forEach(a=>{const s=a.configuration.minRadius,c=a.configuration.maxRadius;let l=s?Math.max(e,s):e;l=c?Math.min(l,c):l,a.configuration.brushSize=l,a.invalidateBrushCursor()});const o=n.getViewportIds();Me(o)}function kse(t,e){const r=Fr(t);if(r===void 0)return;const n=r._toolInstances;if(!Object.keys(n).length)return;const o=xd(t,e)[0];if(o)return o.configuration.brushSize}function Fse(t,e){const r=Fr(t);if(r===void 0||(xd(t).forEach(a=>{a.configuration.activeStrategy.toLowerCase().includes("threshold")&&(a.configuration={...a.configuration,threshold:{...a.configuration.threshold,...e}})}),!r.getViewportsInfo().length))return;const o=r.getViewportIds();Me(o)}function Use(t){const e=Fr(t);if(e===void 0)return;const r=e._toolInstances;if(!Object.keys(r).length)return;const i=xd(t)[0];if(i)return i.configuration.threshold.range}const Nf=class Nf{static statsInit(e){const{storePointData:r,indices:n,mode:i}=e;this.mode=i,this.indices=n,this.calculators.clear(),this.mode==="individual"?n.forEach(o=>{this.calculators.set(o,new g_({storePointData:r}))}):this.calculators.set(n,new g_({storePointData:r}))}static statsCallback(e){const{segmentIndex:r,...n}=e;if(!r)throw new Error("Segment index is required for stats calculation");const i=this.mode==="individual"?this.calculators.get(r):this.calculators.get(this.indices);if(!i)throw new Error(`No calculator found for segment ${r}`);i.statsCallback(n)}static getStatistics(e){if(this.mode==="individual"){const n={};return this.calculators.forEach((i,o)=>{n[o]=i.getStatistics(e)}),n}return this.calculators.get(this.indices).getStatistics(e)}};Nf.calculators=new Map,Nf.indices=[],Nf.mode="collective";let Vy=Nf;function Bse(t,e,r,n,i){if(!i)throw new Error("Segmentation ID is required to be passed inside thresholdSegmentationByRange");const{baseVolumeIdx:o,volumeInfoList:a}=y9(t,r),{voxelManager:s}=a[o],c=s,l=t.voxelManager.getScalarDataLength(),d=t.voxelManager;return a.forEach(u=>{const{volumeSize:f}=u;f===l?Wse(d,c,e,u):Gse(d,c,e,u,a,o,n)}),ei(i),t}function Gse(t,e,r,n,i,o,a){const{imageData:s,lower:c,upper:l,dimensions:d}=n;let u,f,h;const g=t.getScalarDataLength();for(let p=0;p<g;p++)if(g.getAtIndex(p)===r){const v=nC(s,d,i[o].spacing,i[o].imageData.getPoint(p)),w=({value:y})=>{u=u+1,y>=h.lower&&y<=h.upper&&(f=f+1)};u=0,f=0,h={lower:c,upper:l};let m=!1;t.forEach(w,{imageData:s,boundsIJK:v}),m=a===0?f>0:f===u,t.setAtIndex(p,m?r:0)}return{total:u,range:h,overlaps:f}}function Wse(t,e,r,n){const{lower:i,upper:o}=n,a=t.getScalarDataLength();for(let s=0;s<a;s++)if(t.getAtIndex[s]===r){const c=e.getAtIndex(s);t.setAtIndex(s,c>=i&&c<=o?r:0)}}function y_(t,e,r){const n=r.toIJK(t),i=r.toIJK(e),o=Ie(),{testIJK:a}=r,s=rn(Ie(),n,i),c=Math.round(Math.max(...s.map(Math.abs)));if(c<2)return!0;const l=xr(Ie(),s,1/c);for(let d=1;d<c;d++)if(en(o,i,l,d),!a(o))return!1;return!0}function $se({dimensions:t,imageData:e,voxelManager:r,segmentIndex:n,containedSegmentIndices:i}){const o=t[0],a=o*t[1];return{testCenter:(s,c)=>{const l=hr(Ie(),s,c).map(v=>v/2),d=e.worldToIndex(l).map(Math.round),[u,f,h]=d,g=u+f*o+h*a,p=r.getAtIndex(g);return p===n||i?.has(p)},toIJK:s=>e.worldToIndex(s),testIJK:s=>{const[c,l,d]=s,u=Math.round(c)+Math.round(l)*o+Math.round(d)*a,f=r.getAtIndex(u);return f===n||i?.has(f)}}}function zse(t,e,r){const n=Ne.getVolume(t);if(!n){console.warn(`No volume found for ${t}`);return}return $se({dimensions:n.dimensions,imageData:n.imageData,voxelManager:n.voxelManager,segmentIndex:e,containedSegmentIndices:r})}const Wd=.01;function jse(t,e,r){const{sliceContours:n}=t,{segmentIndex:i,containedSegmentIndices:o}=r;let a;const s=zse(e,i,o);for(const c of n){const l=Hse(c,s,a);l&&(a=l)}return a&&Object.assign(a,r),a}function Hse(t,e,r={maxMajor:0,maxMinor:0}){const{points:n}=t.polyData,{maxMinor:i,maxMajor:o}=r;let a=o*o,s=i*i,c;for(let v=0;v<n.length;v++)for(let w=v+1;w<n.length;w++){const m=n[v],y=n[w],C=Qv(m,y);C<a||C-Wd<a+Wd&&c||e.testCenter(m,y)&&y_(m,y,e)&&(a=C-Wd,c=[v,w],s=0)}if(!c)return;a=Math.sqrt(a+Wd);const l=n[c[0]],d=n[c[1]],u=rn(Ie(),l,d);xr(u,u,1/a);let f;for(let v=0;v<n.length;v++)for(let w=v+1;w<n.length;w++){const m=n[v],y=n[w],C=Qv(m,y);if(C<=s)continue;const x=rn(Ie(),m,y);Math.abs(ft(x,u))/Math.sqrt(C)>Wd||e.testCenter(m,y)&&y_(m,y,e)&&(s=C,f=[v,w])}if(!f)return;s=Math.sqrt(s);const h=n[f[0]],g=n[f[1]];return{majorAxis:[l,d],minorAxis:[h,g],maxMajor:a,maxMinor:s,...t}}async function mO(t){const e=await q7({segmentations:t});if(!e?.length||!e[0].sliceContours.length)return;const{segments:r=[null,{label:"Unspecified",color:null,containedSegmentIndices:null}]}=t,n=yd(t.segmentationId);if(!n)return;const i=r.findIndex(o=>!!o);if(i!==-1)return r[i].segmentIndex=i,jse(e[0],n.volumeId,r[i])}function vO(t,e){const{majorAxis:r,minorAxis:n,label:i="",sliceIndex:o}=t,[a,s]=r,[c,l]=n,d=[a,s,c,l];return{highlighted:!0,invalidated:!0,metadata:{toolName:"Bidirectional",...e.getViewReference({sliceIndex:o})},data:{handles:{points:d,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:i,cachedStats:{}},isLocked:!1,isVisible:!0}}const ks=class ks extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Xse}}){super(e,r),this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:d}=l.handles;let u=c.worldToCanvas(d[0]),f=c.worldToCanvas(d[1]),h={start:{x:u[0],y:u[1]},end:{x:f[0],y:f[1]}},g=yr([h.start.x,h.start.y],[h.end.x,h.end.y],[o[0],o[1]]);return g<=a||(u=c.worldToCanvas(d[2]),f=c.worldToCanvas(d[3]),h={start:{x:u[0],y:u[1]},end:{x:f[0],y:f[1]}},g=yr([h.start.x,h.start.y],[h.end.x,h.end.y],[o[0],o[1]]),g<=a)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),St(a),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,c=i.data;i.highlighted=!0;let l=!1,d;o.worldPosition?l=!0:d=c.handles.points.findIndex(g=>g===o);const u=vt(s,this.getToolName());St(s),this.editData={annotation:i,viewportIdsToRender:u,handleIndex:d,movingTextBox:l},this._activateModify(s);const f=Ce(s),{renderingEngine:h}=f;Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;this.doneEditMemo(),d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const{renderingEngine:u}=Ce(o);if(this.editData.handleIndex!==void 0){const{points:f}=d.handles,h=Dr(f[0],f[1]);if(Dr(f[2],f[3])>h){const p=[[...f[2]],[...f[3]]],v=[...f[0]],w=[...f[1]],m=xt();ko(m,p[1][0]-p[0][0],p[1][1]-p[1][0]);const y=xt();ko(y,-m[1],m[0]);const C=xt();ko(C,w[0]-v[0],w[1]-v[0]);let x;Us(C,y)>0?x=[v,w]:x=[w,v],d.handles.points=[p[0],p[1],x[0],x[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=Ce(a),{viewport:c}=s,{worldToCanvas:l}=c,{annotation:d,viewportIdsToRender:u,handleIndex:f,newAnnotation:h}=this.editData;this.createMemo(a,d,{newAnnotation:h});const{data:g}=d,p=o.world;g.handles.points[f]=[...p];const v=g.handles.points.map(l),w={longLineSegment:{start:{x:v[0][0],y:v[0][1]},end:{x:v[1][0],y:v[1][1]}},shortLineSegment:{start:{x:v[2][0],y:v[2][1]},end:{x:v[3][0],y:v[3][1]}}},y=Bn(v[0],v[1])/3,C=w.longLineSegment.start.x-w.longLineSegment.end.x,x=w.longLineSegment.start.y-w.longLineSegment.end.y,S=Math.sqrt(C*C+x*x),T=C/S,_=x/S,E=(w.longLineSegment.start.x+w.longLineSegment.end.x)/2,D=(w.longLineSegment.start.y+w.longLineSegment.end.y)/2,b=E+y*_,I=D-y*T,O=E-y*_,M=D+y*T;g.handles.points[2]=c.canvasToWorld([b,I]),g.handles.points[3]=c.canvasToWorld([O,M]),d.invalidated=!0,Me(u),Gt(d,a,At.HandlesUpdated),this.editData.hasMoved=!0},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:u}=a;if(l){const{deltaPoints:f}=i,h=f.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:f}=i,h=f.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragModifyHandle(n),a.invalidated=!0;Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this._dragModifyHandle=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=Ce(a),{viewport:c}=s,{annotation:l,handleIndex:d}=this.editData,{data:u}=l,f=o.world,h=[c.worldToCanvas(u.handles.points[0]),c.worldToCanvas(u.handles.points[1]),c.worldToCanvas(u.handles.points[2]),c.worldToCanvas(u.handles.points[3])],g={start:{x:h[0][0],y:h[0][1]},end:{x:h[1][0],y:h[1][1]}},p={start:{x:h[2][0],y:h[2][1]},end:{x:h[3][0],y:h[3][1]}},v=[...f],w=c.worldToCanvas(v);if(d===0||d===1){const y=h[d===0?1:0],C=ko(xt(),w[0]-y[0],w[1]-y[1]),x=ko(xt(),h[d][0]-y[0],h[d][1]-y[1]);za(C,C),za(x,x);const S={start:{x:y[0],y:y[1]},end:{x:w[0],y:w[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(S,p))return;const T=y,_=this._getSignedAngle(x,C);let E=h[2][0],D=h[2][1],b=h[3][0],I=h[3][1];E-=T[0],D-=T[1],b-=T[0],I-=T[1];const O=E*Math.cos(_)-D*Math.sin(_),M=E*Math.sin(_)+D*Math.cos(_),R=b*Math.cos(_)-I*Math.sin(_),A=b*Math.sin(_)+I*Math.cos(_);E=O+T[0],D=M+T[1],b=R+T[0],I=A+T[1];const G=c.canvasToWorld([E,D]),k=c.canvasToWorld([b,I]);u.handles.points[d]=v,u.handles.points[2]=G,u.handles.points[3]=k}else{const m=d===2?3:2,y={longLineSegment:{start:g.start,end:g.end},shortLineSegment:{start:p.start,end:p.end}},C=En(xt(),[y.longLineSegment.end.x,y.longLineSegment.end.y],[y.longLineSegment.start.x,y.longLineSegment.start.y]),x=za(xt(),C),S=En(xt(),[w[0],w[1]],[h[d][0],h[d][1]]),T=Np(S),_=this._getSignedAngle(x,S),E=Math.cos(_)*T,D=Jd(xt(),[h[m][0],h[m][1]],x,E);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:w[0],y:w[1]},end:{x:D[0],y:D[1]}},{start:{x:y.longLineSegment.start.x,y:y.longLineSegment.start.y},end:{x:y.longLineSegment.end.x,y:y.longLineSegment.end.y}})||!a1([w[0],w[1]],[D[0],D[1]],[g.start.x,g.start.y],[g.end.x,g.end.y]))return;u.handles.points[m]=c.canvasToWorld(D),u.handles.points[d]=v}},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!0;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles,m=v.map(ie=>a.worldToCanvas(ie));u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x,shadow:S}=this.getAnnotationStyle({annotation:h,styleSpecifier:u});if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,width:null,unit:null},this._calculateCachedStats(h,d,n)):h.invalidated&&this._throttledCalculateCachedStats(h,d,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let T;if(!or(g))continue;!ir(g)&&!this.editData&&w!==null&&(T=[m[w]]);const _=!!Mi("showHandlesAlways",{});(T||_)&&kn(i,g,"0",_?m:T,{color:y});const E=`${g}-line-1`,D=`${g}-line-2`;qt(i,g,"0",m[0],m[1],{color:y,lineDash:x,lineWidth:C,shadow:S},E),qt(i,g,"1",m[2],m[3],{color:y,lineDash:x,lineWidth:C,shadow:S},D),o=!0;const O=this.getLinkedTextBoxStyle(u,h);if(!O.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const M=this.configuration.getTextLines(p,l);if(!M||M.length===0)continue;let R;p.handles.textBox.hasMoved||(R=to(m),p.handles.textBox.worldPosition=a.canvasToWorld(R));const A=a.worldToCanvas(p.handles.textBox.worldPosition),k=gi(i,g,"1",M,A,m,{},O),{x:L,y:F,width:j,height:Y}=k;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([L,F]),topRight:a.canvasToWorld([L+j,F]),bottomLeft:a.canvasToWorld([L,F+Y]),bottomRight:a.canvasToWorld([L+j,F+Y])}}return o},this._movingLongAxisWouldPutItThroughShortAxis=(n,i)=>{const o=xt();ko(o,i.end.x-i.start.x,i.end.y-i.start.y),za(o,o);const a={start:{x:i.start.x-o[0]*10,y:i.start.y-o[1]*10},end:{x:i.end.x+o[0]*10,y:i.end.y+o[1]*10}};return!a1([a.start.x,a.start.y],[a.end.x,a.end.y],[n.start.x,n.start.y],[n.end.x,n.end.y])},this._calculateCachedStats=(n,i,o)=>{const{data:a}=n,{element:s}=o.viewport;a.handles.points[0],a.handles.points[1],a.handles.points[2],a.handles.points[3];const{cachedStats:c}=a,l=Object.keys(c);for(let u=0;u<l.length;u++){const f=l[u],h=this.getTargetImageData(f);if(!h)continue;const{imageData:g,dimensions:p}=h,v=a.handles.points.map(D=>g.worldToIndex(D)),w=v.slice(0,2),m=v.slice(2,4),y=_o(h,v),C=ks.calculateLengthInIndex(y,w),x=ks.calculateLengthInIndex(y,m),{unit:S}=y,T=C>x?C:x,_=C>x?x:C,E=S;this.isHandleOutsideImage=!ks.isInsideVolume(p,v),c[f]={length:T,width:_,unit:S,widthUnit:E,statsArray:[{value:T,name:"height",unit:S,type:Wo.Linear},{value:_,name:"width",unit:S,type:Wo.Linear}]}}const d=n.invalidated;return n.invalidated=!1,d&&Gt(n,s,At.StatsUpdated),c},this._getSignedAngle=(n,i)=>Math.atan2(n[0]*i[1]-n[1]*i[0],n[0]*i[0]+n[1]*i[1]),this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,o=n.world;this.isDrawing=!0;const a=this.createAnnotation(e,[[...o],[...o],[...o],[...o]]);Ft(a,i);const s=vt(i,this.getToolName());return this.editData={annotation:a,viewportIdsToRender:s,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),St(i),e.preventDefault(),Me(s),a}};ks.toolName="Bidirectional",ks.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=ks.hydrateBase(ks,i,r[0],n),[d,u]=r,[f,h]=d,[g,p]=u,v=[f,h,g,p],{toolInstance:w,...m}=n||{},y={annotationUID:n?.annotationUID||cn(),data:{handles:{points:v,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...m}};return Ft(y,l.element),Me([l.id]),y};let fh=ks;function Xse(t,e){const{cachedStats:r,label:n}=t,{length:i,width:o,unit:a}=r[e],s=[];return n&&s.push(n),i===void 0||s.push(`L: ${Ht(i)} ${a||a}`,`W: ${Ht(o)} ${a}`),s}async function Kse(t,e){console.warn("Deprecation Alert: There is a new getSegmentLargestBidirectional function that handles volume, stack and individual segment cases properly. This function is deprecated and will be removed in a future version.");const{data:r}=e,n=Ce(t),i=(r.getSegment||qse)(n,r);if(!i)return;const o=n.viewport.getFrameOfReferenceUID(),a=Am(),{segmentIndex:s,segmentationId:c}=i,l=ma.getAnnotations(this.toolName||fh.toolName,o);let d=!1;const u=l.filter(h=>{const g=h.data.segment;return g?(g.segmentationId===c&&g.segmentIndex===s&&(d=!0,h.data.segment=g),!0):!1});d||u.push({data:{segment:i}});let f;if(u.forEach(async h=>{const g=[],p=h.data.segment,{segmentIndex:v,segmentationId:w}=p;g[v]=p,ma.removeAnnotation(h.annotationUID);const m=await mO({...a.find(x=>x.segmentationId===w),segments:g});if(!m)return;const y=vO(m,n.viewport);y.annotationUID=h.annotationUID,y.data.segment=p;const C=ma.addAnnotation(y,o);if(p.segmentIndex===i.segmentIndex&&p.segmentationId===i.segmentationId){f=m;const{style:x}=i;x&&Kw.setAnnotationStyles(C,x)}}),f){const{sliceIndex:h}=f,g=n.viewport.getImageIds();Hw(t,{imageIndex:g.length-1-h}),n.viewport.render()}else console.warn("No bidirectional found");return f}function qse(t,e){const r=Am();if(!r.length)return;const n=e.segmentationId||r[0].segmentationId,i=e.segmentIndex??zi(n);if(!i)return;const o=e.segmentData?.get(i);return{label:`Segment ${i}`,segmentIndex:i,segmentationId:n,...o}}function yO(t){const e=Fr(t);if(e===void 0)return;xd(t).forEach(a=>{a.invalidateBrushCursor()});const n=e.getViewportsInfo();if(!Object.keys(n).map(a=>n[a]).length)return;const o=e.getViewportIds();Me(o)}function nx(t,e,r={}){const n=Ut(t),i=n.representationData,o=r?.representationType??Object.keys(i)[0];if(!o)throw new Error(`Segmentation ${t} does not have any representations`);switch(o){case yt.Labelmap:return Yse(n,e,r);case yt.Contour:return Jse(n,e,r);default:return}}function Yse(t,e,{viewport:r}){const n=t.representationData.Labelmap;if(r instanceof Zn){const{volumeId:h}=n,g=Ne.getVolume(h);return g?g.imageData.getScalarValueFromWorld(e):void 0}const i=sc(r.id,t.segmentationId);if(i.length>1){console.warn("Segment selection for labelmaps with multiple imageIds in stack viewports is not supported yet.");return}const o=i[0];if(!Ne.getImage(o))return;const c=pm(r.id,t.segmentationId)?.actor.getMapper().getInputData(),l=br(c,e),d=c.getDimensions();return(c.voxelManager||ns.createScalarVolumeVoxelManager({dimensions:d,scalarData:c.getPointData().getScalars().getData()})).getAtIJKPoint(l)}function Jse(t,e,{viewport:r}){const n=t.representationData.Contour,i=Array.from(n.annotationUIDsMap.keys()),{viewPlaneNormal:o}=r.getCamera();for(const a of i){const s=n.annotationUIDsMap.get(a);if(s)for(const c of s){const l=fn(c);if(!l)continue;const{polyline:d}=l.data.contour;if(Et(o,l.metadata.viewPlaneNormal)&&CC(e,d))return Number(a)}}}function wO(t,e,{viewport:r,searchRadius:n}){const o=Ut(t).representationData.Labelmap;if(r instanceof Zn){const{volumeId:p}=o,v=Ne.getVolume(p);if(!v)return;const w=v.voxelManager,m=v.imageData,y=br(m,e),C=w.getAtIJK(y[0],y[1],y[2]),x=r.worldToCanvas(e);return Qse(x,C,r,m,n)?C:void 0}const a=wl(r.id,t);if(!Ne.getImage(a))return;const l=pm(r.id,t)?.actor.getMapper().getInputData(),d=br(l,e),u=l.getDimensions(),f=l.voxelManager||ns.createScalarVolumeVoxelManager({dimensions:u,scalarData:l.getPointData().getScalars().getData()}),h=f.getAtIJKPoint(d);return Zse(d,u,f,h)?h:void 0}function CO(t,e,r=1){const n=Array.from({length:2*r+1},(i,o)=>o-r);for(const i of n)for(const o of n)for(const a of n){if(i===0&&o===0&&a===0)continue;const s=t(i,o,a);if(s!==void 0&&e!==s)return!0}return!1}function Zse(t,e,r,n,i){return CO((a,s,c)=>{const l=[t[0]+a,t[1]+s,t[2]+c];return r.getAtIJK(l[0],l[1],l[2])},n,i)}function Qse(t,e,r,n,i){return CO((a,s)=>{const c=[t[0]+a,t[1]+s],l=r.canvasToWorld(c),d=n.get("voxelManager").voxelManager,u=br(n,l);return d.getAtIJK(u[0],u[1],u[2])},e,i)}function xO(t){const e=Ut(t),{annotationUIDsMap:r}=e.representationData.Contour;for(const[n,i]of r.entries())if(Array.from(i).find(a=>fn(a).highlighted))return n}const ece=`
const MAX_STRENGTH = 65535f;

// Workgroup size - X*Y*Z must be multiple of 32 for better performance
override workGroupSizeX = 1u;
override workGroupSizeY = 1u;
override workGroupSizeZ = 1u;

// Compare the current voxel to neighbors using a 9x9x9 window
override windowSize = 9i;

struct Params {
  size: vec3u,
  iteration: u32,
}

// New structure to track bounds of modified voxels
struct Bounds {
  minX: atomic<i32>,
  minY: atomic<i32>,
  minZ: atomic<i32>,
  maxX: atomic<i32>,
  maxY: atomic<i32>,
  maxZ: atomic<i32>,
}

@group(0) @binding(0) var<uniform> params: Params;
@group(0) @binding(1) var<storage> volumePixelData: array<f32>;
@group(0) @binding(2) var<storage, read_write> labelmap: array<u32>;
@group(0) @binding(3) var<storage, read_write> strengthData: array<f32>;
@group(0) @binding(4) var<storage> prevLabelmap: array<u32>;
@group(0) @binding(5) var<storage> prevStrengthData: array<f32>;
@group(0) @binding(6) var<storage, read_write> updatedVoxelsCounter: array<atomic<u32>>;
@group(0) @binding(7) var<storage, read_write> modifiedBounds: Bounds;

fn getPixelIndex(ijkPos: vec3u) -> u32 {
  let numPixelsPerSlice = params.size.x * params.size.y;
  return ijkPos.x + ijkPos.y * params.size.x + ijkPos.z * numPixelsPerSlice;
}

fn updateBounds(position: vec3i) {
  // Atomically update min bounds (use min operation)
  let oldMinX = atomicMin(&modifiedBounds.minX, position.x);
  let oldMinY = atomicMin(&modifiedBounds.minY, position.y);
  let oldMinZ = atomicMin(&modifiedBounds.minZ, position.z);

  // Atomically update max bounds (use max operation)
  let oldMaxX = atomicMax(&modifiedBounds.maxX, position.x);
  let oldMaxY = atomicMax(&modifiedBounds.maxY, position.y);
  let oldMaxZ = atomicMax(&modifiedBounds.maxZ, position.z);
}

@compute @workgroup_size(workGroupSizeX, workGroupSizeY, workGroupSizeZ)
fn main(
  @builtin(global_invocation_id) globalId: vec3u,
) {
  // Make sure it will not get out of bounds for volume with sizes that
  // are not multiple of workGroupSize
  if (
    globalId.x >= params.size.x ||
    globalId.y >= params.size.y ||
    globalId.z >= params.size.z
  ) {
    return;
  }

  // Initialize bounds for the first iteration
  if (params.iteration == 0 && globalId.x == 0 && globalId.y == 0 && globalId.z == 0) {
    // Initialize to opposite extremes to ensure any update will improve the bounds
    atomicStore(&modifiedBounds.minX, i32(params.size.x));
    atomicStore(&modifiedBounds.minY, i32(params.size.y));
    atomicStore(&modifiedBounds.minZ, i32(params.size.z));
    atomicStore(&modifiedBounds.maxX, -1);
    atomicStore(&modifiedBounds.maxY, -1);
    atomicStore(&modifiedBounds.maxZ, -1);
  }

  let currentCoord = vec3i(globalId);
  let currentPixelIndex = getPixelIndex(globalId);

  let numPixels = arrayLength(&volumePixelData);
  let currentPixelValue = volumePixelData[currentPixelIndex];

  if (params.iteration == 0) {
    // All non-zero initial labels are given maximum strength
    strengthData[currentPixelIndex] = select(MAX_STRENGTH, 0., labelmap[currentPixelIndex] == 0);

    // Update bounds for non-zero initial labels
    if (labelmap[currentPixelIndex] != 0) {
      updateBounds(currentCoord);
    }
    return;
  }

  // It should at least copy the values from previous state
  var newLabel = prevLabelmap[currentPixelIndex];
  var newStrength = prevStrengthData[currentPixelIndex];

  let window = i32(ceil(f32(windowSize - 1) * .5));
  let minWindow = -1i * window;
  let maxWindow = 1i * window;

  for (var k = minWindow; k <= maxWindow; k++) {
    for (var j = minWindow; j <= maxWindow; j++) {
      for (var i = minWindow; i <= maxWindow; i++) {
        // Skip current voxel
        if (i == 0 && j == 0 && k == 0) {
          continue;
        }

        let neighborCoord = currentCoord + vec3i(i, j, k);

        //  Boundary conditions. Do not grow outside of the volume
        if (
          neighborCoord.x < 0i || neighborCoord.x >= i32(params.size.x) ||
          neighborCoord.y < 0i || neighborCoord.y >= i32(params.size.y) ||
          neighborCoord.z < 0i || neighborCoord.z >= i32(params.size.z)
        ) {
          continue;
        }

        let neighborIndex = getPixelIndex(vec3u(neighborCoord));
        let neighborPixelValue = volumePixelData[neighborIndex];
        let prevNeighborStrength = prevStrengthData[neighborIndex];
        let strengthCost = abs(neighborPixelValue - currentPixelValue);
        let takeoverStrength = prevNeighborStrength - strengthCost;

        if (takeoverStrength > newStrength) {
          newLabel = prevLabelmap[neighborIndex];
          newStrength = takeoverStrength;
        }
      }
    }
  }

  if (labelmap[currentPixelIndex] != newLabel) {
    atomicAdd(&updatedVoxelsCounter[params.iteration], 1u);

    // Update bounds for modified voxels
    updateBounds(currentCoord);
  }

  labelmap[currentPixelIndex] = newLabel;
  strengthData[currentPixelIndex] = newStrength;
}
`,tce=1024*1024*1024,w_=1.99*tce,tv={windowSize:3,maxProcessingTime:3e4,inspection:{numCyclesInterval:5,numCyclesBelowThreshold:3,threshold:1e-4}};async function Um(t,e,r=tv){const n=[8,8,4],{windowSize:i,maxProcessingTime:o}=Object.assign({},tv,r),a=Object.assign({},tv.inspection,r.inspection),s=Ne.getVolume(t),c=Ne.getVolume(e),[l,d,u]=s.dimensions;if(c.dimensions[0]!==l||c.dimensions[1]!==d||c.dimensions[2]!==u)throw new Error("Volume and labelmap must have the same size");let f=Math.floor(Math.sqrt(d**2+l**2+u**2)/2);f=Math.min(f,500);const h=c.voxelManager.getCompleteScalarDataArray();let g=s.voxelManager.getCompleteScalarDataArray();g instanceof Float32Array||(g=new Float32Array(g));const p={maxStorageBufferBindingSize:w_,maxBufferSize:w_},w=await(await navigator.gpu?.requestAdapter()).requestDevice({requiredLimits:p}),m=g.byteLength,y=f*Uint32Array.BYTES_PER_ELEMENT,C=6*Int32Array.BYTES_PER_ELEMENT,x=w.createShaderModule({code:ece}),S=3,T=new Uint32Array([l,d,u,0]),_=w.createBuffer({size:T.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),E=w.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});w.queue.writeBuffer(E,0,g);const D=[0,1].map(()=>w.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}));w.queue.writeBuffer(D[0],0,new Uint32Array(h));const b=[0,1].map(()=>w.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST})),I=w.createBuffer({size:y,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}),O=w.createBuffer({size:C,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}),M=new Int32Array([l,d,u,-1,-1,-1]);w.queue.writeBuffer(O,0,M);const R=w.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:6,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:7,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),A=[0,1].map(ge=>{const De=D[ge],Le=b[ge],Ge=D[(ge+1)%2],re=b[(ge+1)%2];return w.createBindGroup({layout:R,entries:[{binding:0,resource:{buffer:_}},{binding:1,resource:{buffer:E}},{binding:2,resource:{buffer:De}},{binding:3,resource:{buffer:Le}},{binding:4,resource:{buffer:Ge}},{binding:5,resource:{buffer:re}},{binding:6,resource:{buffer:I}},{binding:7,resource:{buffer:O}}]})}),G=w.createComputePipeline({layout:w.createPipelineLayout({bindGroupLayouts:[R]}),compute:{module:x,entryPoint:"main",constants:{workGroupSizeX:n[0],workGroupSizeY:n[1],workGroupSizeZ:n[2],windowSize:i}}}),k=[Math.ceil(l/n[0]),Math.ceil(d/n[1]),Math.ceil(u/n[2])],L=w.createBuffer({size:y,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),F=o?performance.now()+o:0;let j=a.numCyclesInterval,Y=0;for(let ge=0;ge<f;ge++){T[S]=ge,w.queue.writeBuffer(_,0,T);const De=w.createCommandEncoder(),Le=De.beginComputePass();if(Le.setPipeline(G),Le.setBindGroup(0,A[ge%2]),Le.dispatchWorkgroups(k[0],k[1],k[2]),Le.end(),De.copyBufferToBuffer(I,ge*Uint32Array.BYTES_PER_ELEMENT,L,ge*Uint32Array.BYTES_PER_ELEMENT,Uint32Array.BYTES_PER_ELEMENT),w.queue.submit([De.finish()]),ge>0&&!(ge%j)){await L.mapAsync(GPUMapMode.READ,0,y);const re=L.getMappedRange(0,y),ve=new Uint32Array(re.slice(0))[ge]/g.length;if(L.unmap(),ge>=1&&ve<a.threshold){if(j=1,Y++,Y===a.numCyclesBelowThreshold)break}else j=a.numCyclesInterval}if(F&&performance.now()>F){console.warn(`Exceeded processing time limit (${o})ms`);break}}const ie=w.createCommandEncoder(),de=(f+1)%2,ae=w.createBuffer({size:m,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),fe=w.createBuffer({size:C,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});ie.copyBufferToBuffer(D[de],0,ae,0,m),ie.copyBufferToBuffer(O,0,fe,0,C),w.queue.submit([ie.finish()]),await ae.mapAsync(GPUMapMode.READ,0,m);const we=ae.getMappedRange(0,m),_e=new Uint32Array(we);h.set(_e),ae.unmap(),await fe.mapAsync(GPUMapMode.READ,0,C);const Se=fe.getMappedRange(0,C),B=new Int32Array(Se.slice(0));fe.unmap();const P=B[0],$=B[1],W=B[2],K=B[3],Q=B[4],ee=B[5];c.voxelManager.setCompleteScalarDataArray(h),c.voxelManager.clearBounds(),c.voxelManager.setBounds([[P,K],[$,Q],[W,ee]])}const{transformWorldToIndex:hh}=hn,nce=254,rce=255,ice=.1,oce=.8;function ace(t,e){const{topLeftWorld:r,bottomRightWorld:n}=e,i=hh(t.imageData,r),o=hh(t.imageData,n);return{...e,topLeftIJK:i,bottomRightIJK:o}}function sce(t,e){const r=t.imageData.getDirection(),n=mt(r[3],r[4],r[5]),{center:i,radius:o}=e,a=t.imageData,s=en(Ie(),i,n,-o),c=en(Ie(),i,n,o),l=qM([c,s],a);return ace(t,l)}function cce(t,e,r){const n=t.imageData,i=r.getCamera(),{ijkVecRowDir:o,ijkVecColDir:a}=am(n,i);if([o,a].some(d=>!Et(Math.abs(d[0]),1)&&!Et(Math.abs(d[1]),1)&&!Et(Math.abs(d[2]),1))){console.warn("Oblique view is not supported!");return}const{boundsIJK:c}=sce(t,e),l={minX:c[0][0],maxX:c[0][1]+1,minY:c[1][0],maxY:c[1][1]+1,minZ:c[2][0],maxZ:c[2][1]+1};return Xw(t.volumeId,l,{targetBuffer:{type:"Float32Array"}})}function lce(t,e,r,n){const i=t.voxelManager.getCompleteScalarDataArray(),o=r.center,[a,s,c]=t.dimensions,l=a*s,d=hh(t.imageData,o),u=i[d[2]*l+d[1]*a+d[0]],f=n.positiveSeedValue??nce,h=n.positiveSeedVariance??ice,g=Math.abs(u*h),p=u-g,v=u+g,w=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],m=d[2]*l+d[1]*a+d[0];e.voxelManager.setAtIndex(m,f);const y=[d];for(;y.length;){const C=y.shift(),[x,S,T]=C;for(let _=0,E=w.length;_<E;_++){const D=w[_],b=x+D[0],I=S+D[1],O=T+D[2];if(b<0||b>=a||I<0||I>=s||O<0||O>=c)continue;const M=O*l+I*a+b,R=i[M];e.voxelManager.getAtIndex(M)===f||R<p||R>v||(e.voxelManager.setAtIndex(M,f),y.push([b,I,O]))}}}function uce(t,e,r,n,i){const o=t.voxelManager.getCompleteScalarDataArray(),[a,s,c]=e.dimensions,l=a*s,{worldVecRowDir:d,worldVecSliceDir:u}=am(e.imageData,n.getCamera()),f=hh(t.imageData,r.center),h=o[f[2]*a*s+f[1]*a+f[0]],g=i.negativeSeedVariance??oce,p=i?.negativeSeedValue??rce,v=Math.abs(h*g),w=h-v,m=h+v,y=360,C=2*Math.PI/y,x=bh(tc(),u,C),S=Fo(d);for(let T=0;T<y;T++){const _=en(Ie(),r.center,S,r.radius),E=hh(e.imageData,_),[D,b,I]=E;if(pV(S,S,x),D<0||D>=a||b<0||b>=s||I<0||I>=c)continue;const O=D+b*a+I*l,M=o[O];(M<w||M>m)&&e.voxelManager.setAtIndex(O,p)}}async function dce(t,e,r,n){const i=await Z1(t.volumeId);return lce(t,i,e,n),uce(t,i,e,r,n),i}async function SO(t,e,r,n){const i=Ne.getVolume(t),o=cce(i,e,r),a=await dce(o,e,r,n);return await Um(o.volumeId,a.volumeId),a}const fce=254,hce=255,gce=[-1/0,-995],pce=[0,1900];function mce(t,e,r){const{negativeSeedValue:n=hce,negativePixelRange:i=gce}=r,o=t.voxelManager.getCompleteScalarDataArray(),[a,s,c]=e.dimensions,l=Math.floor(c/2),d=new Array(a*s).fill(!1),u=l*a*s,f=(g,p)=>{const v=[[g,p]];for(;v.length;){const[w,m]=v.shift(),y=m*a+w;if(w<0||w>=a||m<0||m>=s||d[y])continue;d[y]=!0;const C=u+y,x=o[C];x<i[0]||x>i[1]||(e.voxelManager.setAtIndex(C,n),v.push([w-1,m]),v.push([w+1,m]),v.push([w,m-1]),v.push([w,m+1]))}},h=(g,p,v,w)=>{for(let m=g;m!==p;m+=v){const y=w*a+m,C=u+y,x=o[C];if(x<i[0]||x>i[1])break;d[y]||f(m,w)}};for(let g=0;g<s;g++)h(0,a-1,1,g),h(a-1,0,-1,g)}function vce(t,e,r){const{positiveSeedValue:n=fce,positivePixelRange:i=pce}=r,o=t.voxelManager.getCompleteScalarDataArray();e.voxelManager.getCompleteScalarDataArray();const[a,s,c]=e.dimensions,l=Math.floor(c/2),d=Math.max(l-3,0),u=Math.max(d+5,c),f=a*s;for(let h=d;h<u;h++){const g=h*f;for(let p=0;p<s;p++){const v=p*a;for(let w=0;w<a;w++){const m=g+v+w,y=o[m];y>=i[0]&&y<=i[1]&&e.voxelManager.setAtIndex(m,n)}}}}async function yce(t,e){const r=Z1(t.volumeId);return vce(t,r,e),mce(t,r,e),r}async function TO(t,e,r){const{boundingBox:n}=e,{ijkTopLeft:i,ijkBottomRight:o}=n,a={minX:i[0],maxX:o[0],minY:i[1],maxY:o[1],minZ:i[2],maxZ:o[2]},s=Xw(t,a,{targetBuffer:{type:"Float32Array"}}),c=await yce(s,r);return await Um(s.volumeId,c.volumeId),c}const wce=254,Cce=255,xce=1,_O=1.8,Sce=3.2,ky=30,Tce=70,_ce=50,{transformWorldToIndex:Ece}=hn,af=1e5;function EO(t,e,r){const{dimensions:n,imageData:i}=t,[o,a,s]=n,c=t.voxelManager,l=c.getCompleteScalarDataArray(),d=o*a,u=r?.initialNeighborhoodRadius??xce,f=r?.positiveStdDevMultiplier??_O,h=r?.negativeStdDevMultiplier??Sce,g=r?.negativeSeedMargin??ky,p=r?.negativeSeedsTargetPatches??Tce,v=Ece(i,e).map(Math.round),w=c.toIndex(v);if(v[0]<0||v[0]>=o||v[1]<0||v[1]>=a||v[2]<0||v[2]>=s)return console.warn("Click position is outside volume bounds."),null;const m=wI(l,n,v,u);m.count===0&&(m.mean=l[w],m.stdDev=0);const y=m.mean-f*m.stdDev,C=m.mean+f*m.stdDev,x=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]];let S=1/0,T=1/0,_=1/0,E=-1/0,D=-1/0,b=-1/0;const I=new Set,O=[],M=l[w];if(M>=y&&M<=C)I.add(w),O.push(v),S=E=v[0],T=D=v[1],_=b=v[2];else return console.warn("Clicked voxel intensity is outside the calculated positive range. No positive seeds generated."),{positiveSeedIndices:new Set,negativeSeedIndices:new Set};let R=0;for(;R<O.length&&I.size<af;){const[W,K,Q]=O[R++];S=Math.min(W,S),T=Math.min(K,T),_=Math.min(Q,_),E=Math.max(W,E),D=Math.max(K,D),b=Math.max(Q,b);for(let ee=0;ee<x.length;ee++){const[ge,De,Le]=x[ee],Ge=W+ge,re=K+De,se=Q+Le;if(Ge<0||Ge>=o||re<0||re>=a||se<0||se>=s)continue;const ve=se*d+re*o+Ge;if(I.has(ve))continue;const le=l[ve];le>=y&&le<=C&&(I.add(ve),I.size<af&&O.push([Ge,re,se]))}}if(I.size>=af&&console.debug(`Reached maximum number of positive seeds (${af}). Stopping BFS.`),I.size===0)return console.warn("No positive seeds found after BFS."),{positiveSeedIndices:new Set,negativeSeedIndices:new Set};let A=0,G=0;I.forEach(W=>{const K=l[W];A+=K,G+=K*K});const k=I.size,L=A/k,F=G/k-L*L,j=Math.sqrt(Math.max(0,F)),Y=h*j,ie=Math.max(0,S-g),de=Math.max(0,T-g),ae=Math.max(0,_-g),fe=Math.min(o-1,E+g),we=Math.min(a-1,D+g),_e=Math.min(s-1,b+g),Se=new Set;let B=0,P=0;const $=p*_ce;for(;P<p&&B<$;){B++;const W=Math.floor(Math.random()*(fe-ie+1)+ie),K=Math.floor(Math.random()*(we-de+1)+de),Q=Math.floor(Math.random()*(_e-ae+1)+ae),ee=Q*d+K*o+W;if(I.has(ee)||Se.has(ee))continue;const ge=l[ee];if(Math.abs(ge-L)>Y){let De=!1;for(let Le=-1;Le<=1;Le++){const Ge=K+Le;if(!(Ge<0||Ge>=a))for(let re=-1;re<=1;re++){const se=W+re;if(se<0||se>=o)continue;const ve=Q*d+Ge*o+se;I.has(ve)||Se.has(ve)||(Se.add(ve),De=!0)}}De&&P++}}return Se.size===0&&console.warn("Could not find any negative seeds. GrowCut might fail or produce poor results."),console.debug("positiveSeedIndices",I.size),console.debug("negativeSeedIndices",Se.size),{positiveSeedIndices:I,negativeSeedIndices:Se}}async function bO({referencedVolumeId:t,worldPosition:e,options:r}){const n=Ne.getVolume(t),i=Z1(t);i.voxelManager.forEach(({index:d,value:u})=>{u!==0&&i.voxelManager.setAtIndex(d,0)});const o=r.seeds??EO(n,e,r),a=r?.positiveSeedValue??wce,s=r?.negativeSeedValue??Cce;if(!o)return null;const{positiveSeedIndices:c,negativeSeedIndices:l}=o;return c.size<10||c.size>af||l.size<10?(console.warn("Not enough seeds found. GrowCut might fail or produce poor results."),i):(c.forEach(d=>{i.voxelManager.setAtIndex(d,a)}),l.forEach(d=>{i.voxelManager.setAtIndex(d,s)}),await Um(t,i.volumeId,r),i)}const bce=Object.freeze(Object.defineProperty({__proto__:null,run:Um,runGrowCutForBoundingBox:TO,runGrowCutForSphere:SO,runOneClickGrowCut:bO},Symbol.toStringTag,{value:"Module"}));function gh(t,e){const r=Ut(t);typeof e=="string"&&(console.warn("segmentIndex is a string, converting to number"),e=Number(e)),Object.values(r.segments).forEach(i=>{i.active=!1}),r.segments[e]||(r.segments[e]={segmentIndex:e,label:"",locked:!1,cachedStats:{},active:!1}),r.segments[e].active!==!0&&(r.segments[e].active=!0,Ko(t));const n=Fu(t);n.forEach(i=>{Qi(i,{segmentationId:t}).forEach(a=>{a.segments[e]||(a.segments[e]={visible:!0})})}),n.forEach(i=>{const o=Qn(i);yO(o.id)})}const Dce=Object.freeze(Object.defineProperty({__proto__:null,getActiveSegmentIndex:zi,setActiveSegmentIndex:gh},Symbol.toStringTag,{value:"Module"}));function Ice(t,e){const{segmentationId:r,config:n}=e,i={colorLUTIndex:Mce(n),...n};On.addSegmentationRepresentation(t,r,e.type,i);const{viewport:o}=wn(t)||{};if(o&&$C(o,r,e.type),!zi(r)){let a=1;const s=On.getSegmentation(r);if(s){const c=Object.keys(s.segments);c.length>0&&(a=c.map(l=>Number(l)).sort()[0]),gh(r,a)}}e.type===yt.Contour&&Me([t]),e.type===yt.Surface&&ei(r),Ko(r)}function Mce(t){const{colorLUTOrIndex:e}=t||{};return e===void 0?Sf(JSON.parse(JSON.stringify(h1))):typeof e=="number"?e:Array.isArray(e)&&e.every(n=>Array.isArray(n)&&n.length===4)?Sf(e):Sf(JSON.parse(JSON.stringify(h1)))}function Sd(t,e){e.map(r=>Ice(t,r))}function rx(t,e){return Sd(t,e.map(r=>({...r,type:yt.Contour})))}function Oce(t){const e={};for(const[r,n]of Object.entries(t))e[r]=rx(r,n);return e}function DO(t,e){return Sd(t,e.map(r=>({...r,type:yt.Labelmap})))}function Pce(t){for(const[e,r]of Object.entries(t))DO(e,r.map(n=>({...n,type:yt.Labelmap})))}function IO(t,e){return Sd(t,e.map(r=>({...r,type:yt.Surface})))}function Rce(t){const e={};for(const[r,n]of Object.entries(t))e[r]=IO(r,n);return e}async function Ace({segmentationId:t,viewportId:e,imageIds:r,options:n}){const i=Ut(t);if(n?.removeOriginal){const o=i.representationData.Labelmap;Ne.getVolume(o.volumeId)&&Ne.removeVolumeLoadObject(o.volumeId),i.representationData.Labelmap={imageIds:r}}else i.representationData.Labelmap={...i.representationData.Labelmap,imageIds:r};await Sd(e,[{segmentationId:t,type:yt.Labelmap}]),Fe.addEventListenerOnce(V.SEGMENTATION_RENDERED,()=>ei(t))}async function Lce({volumeId:t}){return{imageIds:Ne.getVolume(t).imageIds}}function Nce({segmentationId:t,options:e}){const r=Ut(t);if(!r)return;const{volumeId:n}=r.representationData.Labelmap,i=Ne.getVolume(n);return Ace({segmentationId:t,viewportId:e.viewportId,imageIds:i.imageIds,options:e})}async function MO(t){return w9(t)}async function Vce({segmentationId:t,segmentIndices:e,mode:r="individual"}){Rm(),os(Co.COMPUTE_LARGEST_BIDIRECTIONAL,0);const n=H7(t,e);if(!n)return;const{operationData:i,segImageIds:o,reconstructableVolume:a,indices:s}=n,c=a?await kce({operationData:i,indices:s,mode:r}):await Fce({segImageIds:o,indices:s,mode:r});return os(Co.COMPUTE_LARGEST_BIDIRECTIONAL,100),c}async function kce({operationData:t,indices:e,mode:r}){const n=X7(t),{segmentationVoxelManager:i,segmentationImageData:o}=n,s={scalarData:i.getCompleteScalarDataArray(),dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection()};return await cc().executeTask("compute","getSegmentLargestBidirectionalInternal",{segmentationInfo:s,indices:e,mode:r})}async function Fce({segImageIds:t,indices:e,mode:r}){const{segmentationInfo:n}=K7(t);return await cc().executeTask("compute","getSegmentLargestBidirectionalInternal",{segmentationInfo:n,indices:e,mode:r,isStack:!0})}function Uce(t){const e=Ut(t);if(!e)return null;let r;const n=e.representationData.Labelmap;if("imageIds"in n){const{imageIds:i}=n,o=Ne.getImage(i[0]),a=Ne.getVolumeContainingImageId(o.referencedImageId);if(a?.volume)return a.volume;r=i.map(s=>Ne.getImage(s).referencedImageId)}else if("volumeId"in n){const{volumeId:i,referencedVolumeId:o}=n;if(o){const s=Ne.getVolume(o);if(s)return s}const a=Ne.getVolume(i);a&&(r=a.imageIds.map(s=>Ne.getImage(s).referencedImageId))}return Lm(r)}async function Bce({segmentationIds:t,segmentIndex:e}){Rm(),os(Co.COMPUTE_STATISTICS,0);const r=Ut(t[0]),{imageIds:n}=r.representationData.Labelmap;if(!vl(n))throw new Error("Invalid volume - TMTV cannot be calculated");return await Gce({segmentationIds:t,segmentIndex:e})}async function Gce({segmentationIds:t,segmentIndex:e}){const r=t.map(p=>yd(p)),n=QM(r,e);if(!n)throw new Error("Invalid volume - TMTV cannot be calculated");const{imageData:i,dimensions:o,direction:a,origin:s,voxelManager:c}=n,l=i.getSpacing(),u={scalarData:c.getCompleteScalarDataArray(),dimensions:o,spacing:l,origin:s,direction:a},f=Uce(t[0]),h={dimensions:f.dimensions,spacing:f.spacing,origin:f.origin,direction:f.direction,scalarData:f.voxelManager.getCompleteScalarDataArray()};if(h.scalarData.length===0||u.scalarData.length===0)return{[e]:{name:"TMTV",value:0}};const g=await cc().executeTask("compute","computeMetabolicStats",{segmentationInfo:u,imageInfo:h});return os(Co.COMPUTE_STATISTICS,100),g}const Wce=Object.freeze(Object.defineProperty({__proto__:null,IslandRemoval:Lu,LabelmapMemo:Mse,SegmentStatsCalculator:Vy,VolumetricCalculator:xu,computeMetabolicStats:Bce,computeStackLabelmapFromVolume:Lce,computeVolumeLabelmapFromStack:MO,contourAndFindLargestBidirectional:mO,createBidirectionalToolData:vO,createLabelmapVolumeForViewport:jae,createMergedLabelmapForIndex:QM,floodFill:ex,getBrushSizeForToolGroup:kse,getBrushThresholdForToolGroup:Use,getBrushToolInstances:xd,getHoveredContourSegmentationAnnotation:xO,getOrCreateImageVolume:Lm,getOrCreateSegmentationVolume:yd,getReferenceVolumeForSegmentationVolume:$7,getSegmentIndexAtLabelmapBorder:wO,getSegmentIndexAtWorldPoint:nx,getSegmentLargestBidirectional:Vce,getStatistics:rO,getUniqueSegmentIndices:g7,growCut:bce,invalidateBrushCursor:yO,rectangleROIThresholdVolumeByRange:$ae,segmentContourAction:Kse,setBrushSizeForToolGroup:Vse,setBrushThresholdForToolGroup:Fse,thresholdSegmentationByRange:Bse,thresholdVolumeByRange:JM,triggerSegmentationRender:wd,triggerSegmentationRenderBySegmentationId:Nm,validateLabelmap:xie},Symbol.toStringTag,{value:"Module"}));function $ce(t){let e="";const r=t[0]<0?"R":"L",n=t[1]<0?"A":"P",i=t[2]<0?"F":"H",o=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])],a=1e-4;for(let s=0;s<3;s++)if(o[0]>a&&o[0]>o[1]&&o[0]>o[2])e+=r,o[0]=0;else if(o[1]>a&&o[1]>o[0]&&o[1]>o[2])e+=n,o[1]=0;else if(o[2]>a&&o[2]>o[0]&&o[2]>o[1])e+=i,o[2]=0;else if(o[0]>a&&o[1]>a&&o[0]===o[1])e+=r+n,o[0]=0,o[1]=0;else if(o[0]>a&&o[2]>a&&o[0]===o[2])e+=r+i,o[0]=0,o[2]=0;else if(o[1]>a&&o[2]>a&&o[1]===o[2])e+=n+i,o[1]=0,o[2]=0;else break;return e}function zce(t){let e=t.replace("H","f");return e=e.replace("F","h"),e=e.replace("R","l"),e=e.replace("L","r"),e=e.replace("A","p"),e=e.replace("P","a"),e=e.toUpperCase(),e}const jce=Object.freeze(Object.defineProperty({__proto__:null,getOrientationStringLPS:$ce,invertOrientationStringLPS:zce},Symbol.toStringTag,{value:"Module"}));var M0;(function(t){t.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",t.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"})(M0||(M0={}));const ix={};function OO(t,e){const r=Ce(t),{viewportId:n}=r;ix[n]=e}function ox(t){const e=Ce(t),{viewportId:r}=e;return ix[r]}function Hce(t){return ix[t]}const{ViewportStatus:PO}=To,{triggerEvent:nv}=hn,RO=!0,Fy=new Map;function Xce(t,e){let r,n;if(t===void 0)throw new Error("playClip: element must not be undefined");const i=Ce(t);if(!i)throw new Error("playClip: element must be a valid Cornerstone enabled element");e||(e={}),e.dynamicCineEnabled=e.dynamicCineEnabled??!0;const{viewport:o}=i,a=Qce(o,e);let s=ox(t);const c=e.dynamicCineEnabled;if(c&&LO(t),s?Uy(t,{stopDynamicCine:!c,viewportId:o.id}):(s={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:e.frameTimeVector??void 0,speed:e.frameTimeVectorSpeedMultiplier??1,reverse:e.reverse??!1,loop:e.loop??!0,bounce:e.bounce??!1},OO(t,s)),s.dynamicCineEnabled=e.dynamicCineEnabled,(e.framesPerSecond<0||e.framesPerSecond>0)&&(s.framesPerSecond=Number(e.framesPerSecond),s.reverse=s.framesPerSecond<0,s.ignoreFrameTimeVector=!0),s.ignoreFrameTimeVector!==!0&&s.frameTimeVector&&s.frameTimeVector.length===a.numScrollSteps&&a.frameTimeVectorEnabled){const{timeouts:u,isTimeVarying:f}=Kce(s.frameTimeVector,s.speed);r=u,n=f}e.bounce!==void 0&&(s.bounce=e.bounce);const l=()=>{const{numScrollSteps:u,currentStepIndex:f}=a;let h=f+(s.reverse?-1:1);if(h<0||h>=u)if(s.bounce)s.reverse=!s.reverse,h=f+(s.reverse?-1:1),h=Math.max(0,Math.min(u-1,h));else if(s.loop)h=s.reverse?u-1:0;else{Uy(t,{stopDynamicCine:!c,viewportId:o.id}),nv(t,M0.CLIP_STOPPED,{element:t});return}const p=h-f;if(p)try{a.scroll(p)}catch(v){console.warn("Play clip not scrolling",v),NO(s),nv(t,M0.CLIP_STOPPED,{element:t})}};if(c){const u=ax(o);u&&Fy.set(u.volumeId,t)}a.play?s.framesPerSecond=a.play(e.framesPerSecond):r&&r.length>0&&n?(s.usingFrameTimeVector=!0,s.intervalId=window.setTimeout(function u(){s.intervalId=window.setTimeout(u,r[a.currentStepIndex]),l()},0)):(s.usingFrameTimeVector=!1,s.intervalId=window.setInterval(l,1e3/Math.abs(s.framesPerSecond)));const d={element:t};nv(t,M0.CLIP_STARTED,d)}function AO(t,e={}){Uy(t,{stopDynamicCine:!0,...e})}function Uy(t,e={stopDynamicCine:!0,viewportId:void 0}){const{stopDynamicCine:r,viewportId:n}=e,i=Ce(t);let o;const a=i?.viewport;if(i){const{viewport:s}=i;o=ox(s.element)}else if(n)o=Hce(n);else return;o&&NO(o),a instanceof Yf?a.pause():r&&a instanceof Zn&&LO(t)}function LO(t){const{viewport:e}=Ce(t);if(e instanceof Gn){const r=ax(e);if(r?.isDynamicVolume()){const n=Fy.get(r.volumeId);Fy.delete(r.volumeId),n&&n!==t&&AO(n)}}}function Kce(t,e){let r,n,i,o=0;const a=t.length,s=[];let c=!1;for((typeof e!="number"||e<=0)&&(e=1),r=1;r<a;r++)i=Number(t[r])/e|0,s.push(i),r===1?n=i:i!==n&&(c=!0),o+=i;return s.length>0&&(c?i=o/s.length|0:i=s[0],s.push(i)),{timeouts:s,isTimeVarying:c}}function NO(t){const e=t.intervalId;typeof e<"u"&&(t.intervalId=void 0,t.usingFrameTimeVector?clearTimeout(e):clearInterval(e))}function ax(t){if(!(t instanceof Gn))return;const e=t.getAllVolumeIds();if(!e?.length)return;const n=e.find(i=>Ne.getVolume(i)?.isDynamicVolume())??e[0];return Ne.getVolume(n)}function qce(t,e){const r=t.getImageIds();return{get numScrollSteps(){return r.length},get currentStepIndex(){return t.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(n){if(this.waitForRenderedCount<=e&&t.viewportStatus!==PO.RENDERED){this.waitForRenderedCount++;return}this.waitForRenderedCount=0,Ou(t,{delta:n,debounceLoading:RO})}}}function Yce(t,e){return{get numScrollSteps(){return t.getNumberOfSlices()},get currentStepIndex(){return t.getSliceIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(r){if(this.waitForRenderedCount<=e&&t.viewportStatus!==PO.RENDERED){this.waitForRenderedCount++;return}this.waitForRenderedCount=0,Ou(t,{delta:r,debounceLoading:RO})},play(r){return r&&t.setPlaybackRate(r/24),t.play(),t.getFrameRate()}}}function Jce(t,e){const{volumeId:r}=e,n={viewPlaneNormal:Ie(),scrollInfo:null},i=()=>{const o=t.getCamera();if(!n.scrollInfo||!Zv(o.viewPlaneNormal,n.viewPlaneNormal)){const s=yu(t,r);n.viewPlaneNormal=o.viewPlaneNormal,n.scrollInfo=s}return n.scrollInfo};return{get numScrollSteps(){return i().numScrollSteps},get currentStepIndex(){return i().currentStepIndex},get frameTimeVectorEnabled(){const o=t.getCamera(),a=e.direction.slice(6,9).map(c=>-c),s=ft(a,o.viewPlaneNormal);return Du(s,1)},scroll(o){i().currentStepIndex+=o,Ou(t,{delta:o})}}}function Zce(t){return{get numScrollSteps(){return t.numDimensionGroups},get currentStepIndex(){return t.dimensionGroupNumber-1},get frameTimeVectorEnabled(){return!1},scroll(e){t.scroll(e)}}}function Qce(t,e){if(t instanceof Wn)return qce(t,e.waitForRendered??30);if(t instanceof Gn){const r=ax(t);return e.dynamicCineEnabled&&r?.isDynamicVolume()?Zce(r):Jce(t,r)}if(t instanceof Yf)return Yce(t,e.waitForRendered??30);throw new Error("Unknown viewport type")}const ele=Object.freeze(Object.defineProperty({__proto__:null,Events:M0,addToolState:OO,getToolState:ox,playClip:Xce,stopClip:AO},Symbol.toStringTag,{value:"Module"}));function tle(t,e){const r=e?.knotsRatioPercentage||30;return!t?.data?.contour?.polyline?.length||r<=0}function nle(t,e){const r=fi(),n=hr(Ie(),e,t),i=Math.abs(t[0])>.1?mt(-t[1],t[0],0):mt(0,-t[2],t[1]);return $5(r,e,n,i),r}function Lg(t,e=Math.floor(Math.random()*(t.length-1))){if(e===0)return 0;const r=[...t],{length:n}=t;for(let i=0;i<n;i++)t[i]=r[(i+e+n)%n];return e}function VO(t,e){if(tle(t,e))return!1;const{viewPlaneNormal:r}=t.metadata,{closed:n,polyline:i}=t.data.contour,o=nle(r,t.data.contour.polyline[0]),a=t.data.contour.polyline.map(d=>{const u=Vt(Ie(),d,o);return[u[0],u[1]]});let s=n?Lg(a):0,c=f1(a,0,a.length-1,e?.knotsRatioPercentage||30);if(c===a)return!1;Lg(c,-s);for(let d=1;d<e?.loop;d++)s=n?Lg(c):0,c=f1(c,0,c.length-1,e?.knotsRatioPercentage||30),Lg(c,-s);const l=Cr(fi(),o);return t.data.contour.polyline=c.map(d=>Vt([0,0,0],[...d,0],l)),!0}const rle={smoothAnnotation:VO},ile=Object.freeze(Object.defineProperty({__proto__:null,default:rle,smoothAnnotation:VO},Symbol.toStringTag,{value:"Module"})),{isEqual:Ng}=hn,ole=mt(1,0,0),ale=mt(0,1,0),sle=mt(0,0,1),C_=[ole,ale,sle];function cle(t){const e=an(Ie(),t[0],t[1]),r=an(Ie(),t[0],t[2]),n=x_(e,C_),i=x_(r,C_);return[...n,...i].every(a=>Ng(a,0)||Ng(a,90)||Ng(a,180)||Ng(a,270))}function x_(t,e){return e.map(r=>z5(t,r)*180/Math.PI)}const lle=Object.freeze(Object.defineProperty({__proto__:null,getBoundsIJKFromRectangleAnnotations:ZM,isAxisAlignedRectangle:cle},Symbol.toStringTag,{value:"Module"})),kO={};function FO(t,e){const r=Ce(t),{viewportId:n}=r;kO[n]=e}function Td(t){const e=Ce(t),{viewportId:r}=e;return kO[r]}const Su=Jt.Prefetch,ule=0;function dle(t,e){t=Math.round(t)||0,e=Math.round(e)||0;const r=[];let n=e-t+1;if(n<=0)return r;for(;n--;)r[n]=e--;return r}function fle(t,e){let r=0,n=t.length-1;return t.forEach((i,o)=>{i<e?r=Math.max(o,r):i>e&&(n=Math.min(o,n))}),{low:r,high:n}}function _d(t){const e=Ce(t);if(!e)return null;const{viewport:r}=e;return r instanceof Wn?{currentImageIdIndex:r.getCurrentImageIdIndex(),imageIds:r.getImageIds()}:null}function Bm(t){return function(e){const r=e.detail;let n;try{n=_d(t)}catch{return}if(!n||!n.imageIds||n.imageIds.length===0)return;const o=n.imageIds.indexOf(r.imageId);if(o<0)return;const a=Td(t);!a||!a.indicesToRequest||!a.indicesToRequest.length||a.indicesToRequest.push(o)}}const hle=t=>{const e=new Set(t.imageIds);return r=>r.type!==Su||!e.has(r.additionalDetails.imageId)},{imageRetrieveMetadataProvider:gle}=hn;let Tf={maxImagesToPrefetch:1/0,preserveExistingPool:!0},By;const ple=10;function UO(t){const e=Td(t);if(!e)return;const r=e||{},n=_d(t);if(!n?.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const{currentImageIdIndex:i}=n;if(r.enabled=r.enabled&&(r.indicesToRequest?.length??0)>0,r.enabled===!1)return;function o(p){const v=r.indicesToRequest.indexOf(p);v>-1&&r.indicesToRequest.splice(v,1)}if(e.indicesToRequest.sort((p,v)=>p-v),r.indicesToRequest.slice().forEach(function(p){const v=n.imageIds[p];if(!v)return;(Math.abs(i-p)<6?Ne.getImageLoadObject(v):Ne.isLoaded(v))&&o(p)}),!r.indicesToRequest.length)return;Tf.preserveExistingPool||$i.clearRequestStack(Su);const s=fle(r.indicesToRequest,n.currentImageIdIndex);let c,l;function d(p){console.log("prefetch done: %s",p);const v=n.imageIds.indexOf(p);if(o(v),r.indicesToRequest.length===0){const w={element:t,lastPrefetchedImageId:p};Ye(Fe,V.STACK_PREFETCH_COMPLETE,w)}}let u=s.low,f=s.high;const h=[];for(;u>=0||f<r.indicesToRequest.length;){const p=n.currentImageIdIndex,v=p-r.indicesToRequest[u]>Tf.maxImagesToPrefetch,w=r.indicesToRequest[f]-p>Tf.maxImagesToPrefetch,m=!v&&u>=0,y=!w&&f<r.indicesToRequest.length;if(!y&&!m)break;m&&(l=r.indicesToRequest[u--],c=n.imageIds[l],h.push(c)),y&&(l=r.indicesToRequest[f++],c=n.imageIds[l],h.push(c))}const g=(p,v)=>{const{retrieveOptions:w={}}=ut(gle.IMAGE_RETRIEVE_CONFIGURATION,p,"stack")||{};return v.retrieveOptions={...v.retrieveOptions,...w.default||Object.values(w)?.[0]||{}},dl(p,v).then(()=>d(p))};h.forEach(p=>{const v={requestType:Su};$i.addRequest(g.bind(null,p,v),Su,{imageId:p},ule)})}function Gy(t){clearTimeout(By),By=setTimeout(function(){const e=t.target;try{UO(e)}catch{return}},ple)}function mle(t){const e=_d(t);if(!e||!e.imageIds||e.imageIds.length===0){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const r={indicesToRequest:dle(0,e.imageIds.length-1),enabled:!0,direction:1},n=r.indicesToRequest.indexOf(e.currentImageIdIndex);r.indicesToRequest.splice(n,1),FO(t,r),UO(t),t.removeEventListener($e.STACK_NEW_IMAGE,Gy),t.addEventListener($e.STACK_NEW_IMAGE,Gy);const i=Bm(t);Fe.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,i),Fe.addEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,i)}function vle(t){clearTimeout(By),t.removeEventListener($e.STACK_NEW_IMAGE,Gy);const e=Bm(t);Fe.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,e);const r=Td(t);r&&r.indicesToRequest.length&&(r.enabled=!1,$i.clearRequestStack(Su))}function yle(){return Tf}function wle(t){Tf=t}const Cle={enable:mle,disable:vle,getConfiguration:yle,setConfiguration:wle},{imageRetrieveMetadataProvider:xle}=hn;let ph={maxImagesToPrefetch:1/0,minBefore:2,maxAfter:2,directionExtraImages:10,preserveExistingPool:!1},Wy;const Sle=5,BO={},Tle=(t,e=0)=>{const r=_d(t);if(!r)return;if(!r.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}cx(t),BO[t]=e,sx(t,e),t.removeEventListener($e.STACK_NEW_IMAGE,$y),t.addEventListener($e.STACK_NEW_IMAGE,$y);const n=Bm(t);Fe.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,n),Fe.addEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,n)};function sx(t,e=0){const r=_d(t);if(!r)return;if(!r?.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const n=Td(t);if(!n)return;const i=n||{};if(i.enabled=i.enabled&&(i.indicesToRequest?.length??0)>0,i.enabled===!1)return;function o(d){const u=i.indicesToRequest.indexOf(d);u>-1&&i.indicesToRequest.splice(u,1)}const a=i.indicesToRequest.slice(),{currentImageIdIndex:s}=r;if(a.forEach(d=>{const u=r.imageIds[d];if(!u)return;(Math.abs(s-d)<6?Ne.getImageLoadObject(u):Ne.isLoaded(u))&&o(d)}),!i.indicesToRequest.length)return;ph.preserveExistingPool||$i.filterRequests(hle(r));function c(d){const u=r.imageIds.indexOf(d);o(u);const f=Ne.getCachedImageBasedOnImageURI(d),{stats:h}=i,g=f?.image?.decodeTimeInMS||0;if(g){h.imageIds.set(d,g),h.decodeTimeInMS+=g;const p=f?.image?.loadTimeInMS||0;h.loadTimeInMS+=p}if(!i.indicesToRequest.length&&f?.sizeInBytes){const{sizeInBytes:p}=f,v=Ne.getMaxCacheSize()/4/p;if(!i.cacheFill)h.initialTime=Date.now()-h.start,h.initialSize=h.imageIds.size,cx(t,v),sx(t,e);else if(h.imageIds.size){h.fillTime=Date.now()-h.start;const{size:w}=h.imageIds;h.fillSize=w}}if(i.indicesToRequest.length===0){const p={element:t,lastPrefetchedImageId:d};Ye(Fe,V.STACK_PREFETCH_COMPLETE,p)}}const l=(d,u)=>{const{retrieveOptions:f={}}=ut(xle.IMAGE_RETRIEVE_CONFIGURATION,d,"stack")||{};return u.retrieveOptions={...u.retrieveOptions,...f.default||Object.values(f)?.[0]||{}},dl(d,u).then(()=>c(d))};i.indicesToRequest.forEach(d=>{const u=r.imageIds[d],f={requestType:Su};$i.addRequest(l.bind(null,u,f),Su,{imageId:u},e)})}function $y(t){clearTimeout(Wy),Wy=setTimeout(function(){const e=t.target;try{cx(e),sx(e,BO[e])}catch{return}},Sle)}const _le=t=>t<0?-1:1,cx=(t,e)=>{const r=_d(t);if(!r)return;if(!r.imageIds?.length){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const{currentImageIdIndex:n}=r;let{maxAfter:i=2,minBefore:o=2}=ph;const{directionExtraImages:a=10}=ph,s=Td(t)||{indicesToRequest:[],currentImageIdIndex:n,stackCount:0,enabled:!0,direction:1,stats:{start:Date.now(),imageIds:new Map,decodeTimeInMS:0,loadTimeInMS:0,totalBytes:0}},c=n-s.currentImageIdIndex;if(s.direction=_le(c),s.currentImageIdIndex=n,s.enabled=!0,s.stackCount<100&&(s.stackCount+=a),Math.abs(c)>i||!c)if(s.stackCount=0,e){const f=n/r.imageIds.length;o=Math.ceil(e*f),i=Math.ceil(e*(1-f)),s.cacheFill=!0}else s.cacheFill=!1;else c<0?(o+=s.stackCount,i=0):(i+=s.stackCount,o=0);const l=Math.max(0,n-o),d=Math.min(r.imageIds.length-1,n+i),u=[];for(let f=n+1;f<=d;f++)u.push(f);for(let f=n-1;f>=l;f--)u.push(f);s.indicesToRequest=u,FO(t,s)};function Ele(t){clearTimeout(Wy),t.removeEventListener($e.STACK_NEW_IMAGE,$y);const e=Bm(t);Fe.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,e);const r=Td(t);r&&(r.enabled=!1)}function ble(){return ph}function Dle(t){ph=t}const Ile={enable:Tle,disable:Ele,getConfiguration:ble,setConfiguration:Dle},Mle=Object.freeze(Object.defineProperty({__proto__:null,isViewportPreScaled:dc},Symbol.toStringTag,{value:"Module"}));function Ole(t,e){let r;const n=e.dimensionGroupNumbers||e.frameNumbers||Array.from({length:t.numDimensionGroups},(i,o)=>o+1);if(e.frameNumbers&&console.warn("Warning: frameNumbers parameter is deprecated. Please use dimensionGroupNumbers instead."),!e.maskVolumeId&&!e.worldCoordinate)throw new Error("You should provide either maskVolumeId or imageCoordinate");if(e.maskVolumeId&&e.worldCoordinate)throw new Error("You can only use one of maskVolumeId or imageCoordinate");if(e.maskVolumeId){const i=Ne.getVolume(e.maskVolumeId);if(!i)throw new Error("Segmentation volume not found");const[o,a]=Rle(n,t,i);return[o,a]}return e.worldCoordinate?Ple(n,e.worldCoordinate,t):r}function Ple(t,e,r){const{dimensions:n,imageData:i}=r,o=i.worldToIndex(e);if(o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.floor(o[2]),!Sr(o,n))throw new Error("outside bounds");const a=n[0],s=n[0]*n[1],c=[];return t.forEach(l=>{const d=o[2]*s+o[1]*a+o[0];c.push(r.voxelManager.getAtIndexAndDimensionGroup(d,l))}),c}function Rle(t,e,r){const{imageData:n}=r,i=r.voxelManager,o=i.getScalarDataLength(),a=[];a.length=o;let s=0;for(let f=0,h=o;f<h;f++)i.getAtIndex(f)!==0&&(a[s++]=f);a.length=s;const c=[],l=e.voxelManager.getScalarDataLength()===o&&JSON.stringify(e.spacing)===JSON.stringify(r.spacing),d=[];if(l){for(let f=0;f<a.length;f++){const h=[],g=a[f];for(let p=0;p<t.length;p++)h.push(e.voxelManager.getAtIndexAndDimensionGroup(g,t[p]));c.push(h),d.push(i.toIJK(g))}return[c,d]}const u=({pointLPS:f,value:h,pointIJK:g})=>{if(h===0)return;const p=nC(e.imageData,e.dimensions,e.spacing,f);let v=0;const w=new Map;t.forEach(C=>w.set(C,0));const m=({index:C})=>{for(let x=0;x<t.length;x++){const S=e.voxelManager.getAtIndexAndDimensionGroup(C,t[x]),T=t[x];w.set(T,w.get(T)+S)}v++};e.voxelManager.forEach(m,{imageData:e.imageData,boundsIJK:p});const y=[];w.forEach(C=>{y.push(C/v)}),d.push(g),c.push(y)};return r.voxelManager.forEach(u,{imageData:n}),[c,d]}function GO(t,e){const r=t.getScalarDataLength(),n=new Float32Array(r);for(const i of e){const o=t.getDimensionGroupScalarData(i);for(let a=0;a<r;a++)n[a]+=o[a]}return n}function Ale(t,e){const r=GO(t,e),n=e.length;for(let i=0;i<r.length;i++)r[i]/=n;return r}const WO={[C0.SUM]:(t,e,r)=>{const n=GO(t,e);for(let i=0;i<n.length;i++)r(i,n[i])},[C0.AVERAGE]:(t,e,r)=>{const n=Ale(t,e);for(let i=0;i<n.length;i++)r(i,n[i])},[C0.SUBTRACT]:(t,e,r)=>{if(e.length!==2)throw new Error("Please provide only 2 dimension groups for subtraction.");const n=t.getScalarDataLength(),i=t.getDimensionGroupScalarData(e[0]),o=t.getDimensionGroupScalarData(e[1]);for(let a=0;a<n;a++){const s=i[a]-o[a];r(a,s)}}};function Lle(t,e,r){const{dimensionGroupNumbers:n,frameNumbers:i}=r;i&&console.warn("Warning: frameNumbers parameter is deprecated. Please use dimensionGroupNumbers instead.");const o=n||i||Array.from({length:t.numDimensionGroups},(d,u)=>u+1);if(o.length<=1)throw new Error("Please provide two or more dimension groups");const a=t.voxelManager,s=a.getScalarDataLength(),c=WO[e];if(!c)throw new Error(`Unsupported operation: ${e}`);const l=new Float32Array(s);return c(a,o,(d,u)=>{l[d]=u}),l}function Nle(t,e,r){const{dimensionGroupNumbers:n,frameNumbers:i,targetVolume:o}=r;if(!o)throw new Error("A target volume must be provided");i&&console.warn("Warning: frameNumbers parameter is deprecated. Please use dimensionGroupNumbers instead.");const a=n||i||Array.from({length:t.numDimensionGroups},(d,u)=>u+1);if(a.length<=1)throw new Error("Please provide two or more dimension groups");const s=t.voxelManager,c=o.voxelManager,l=WO[e];if(!l)throw new Error(`Unsupported operation: ${e}`);l(s,a,(d,u)=>{c.setAtIndex(d,u)}),c.resetModifiedSlices();for(let d=0;d<o.dimensions[2];d++)c.modifiedSlices.add(d)}const Vle=Object.freeze(Object.defineProperty({__proto__:null,generateImageFromTimeData:Lle,getDataInTime:Ole,updateVolumeFromTimeData:Nle},Symbol.toStringTag,{value:"Module"}));function $O(t,e){const r=e*3;if(r<t.length)return mt(t[r],t[r+1],t[r+2])}function zO(t){const e=t.getLines().getData();let r=0;const n=new Map;for(;r<e.length;){const s=e[r++],c=[];for(let l=0;l<s;l++)c.push(e[r+l]);n.set(c[0],c),r+=s}const i=[],o=s=>{for(const[c,l]of s.entries())if(l!==void 0)return c;return-1};let a=o(n);for(;a!==-1;){const s=[a];for(;n.has(a);){const c=n.get(a)[1];n.has(c)&&s.push(c),n.delete(a),a=c}i.push(s),a=o(n)}return i.length?i:void 0}function jO(t){const e=zO(t);if(!e)return;const r=t.getPoints().getData();return e.map(n=>n.map(i=>$O(r,i)))}const kle=Object.freeze(Object.defineProperty({__proto__:null,getPoint:$O,getPolyDataPointIndexes:zO,getPolyDataPoints:jO},Symbol.toStringTag,{value:"Module"}));var po;(function(t){t.Top="top",t.Left="left",t.Bottom="bottom",t.Right="right"})(po||(po={}));const Fle=Object.freeze(Object.defineProperty({__proto__:null,get ColorbarRangeTextPosition(){return po}},Symbol.toStringTag,{value:"Module"})),qs=t=>t&&t.upper>t.lower,w1=t=>!!t&&t.width>0&&t.height>0,mh=(t,e)=>!!t&&!!e&&t.lower===e.lower&&t.upper===e.upper,HO=(t,e)=>!!t&&!!e&&t.width===e.width&&t.height===e.height,Ule=(t,e,r)=>[t[0]*(1-r)+e[0]*r,t[1]*(1-r)+e[1]*r,t[2]*(1-r)+e[2]*r],{clamp:Ble}=hn;class lx{constructor(e){lx.validateProps(e);const{colormap:r,size:n={width:20,height:100},imageRange:i={lower:0,upper:1},voiRange:o={lower:0,upper:1},container:a,showFullPixelValueRange:s=!1}=e;this._colormap=r,this._imageRange=i,this._voiRange=o,this._showFullImageRange=s,this._canvas=this._createRootElement(n),a&&this.appendTo(a)}get colormap(){return this._colormap}set colormap(e){this._colormap=e,this.render()}get size(){const{width:e,height:r}=this._canvas;return{width:e,height:r}}set size(e){const{_canvas:r}=this;!w1(e)||HO(r,e)||(this._setCanvasSize(r,e),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){!qs(e)||mh(e,this._imageRange)||(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){!qs(e)||mh(e,this._voiRange)||(this._voiRange=e,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(e){e!==this._showFullImageRange&&(this._showFullImageRange=e,this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}dispose(){const{_canvas:e}=this,{parentElement:r}=e;r?.removeChild(e)}static validateProps(e){const{size:r,imageRange:n,voiRange:i}=e;if(r&&!w1(r))throw new Error('Invalid "size"');if(n&&!qs(n))throw new Error('Invalid "imageRange"');if(i&&!qs(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,r){const{width:n,height:i}=r;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createRootElement(e){const r=document.createElement("canvas");return Object.assign(r.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(r,e),r}render(){if(!this._canvas.isConnected)return;const{_colormap:e}=this,{RGBPoints:r}=e,n=r.length/4,i=v=>{const w=4*v;if(!(v<0||v>=n))return{index:v,position:r[w],color:[r[w+1],r[w+2],r[w+3]]}},{width:o,height:a}=this._canvas,s=this._canvas.getContext("2d");if(!s)return;const c=o>a,l=c?o:a,{_voiRange:d}=this,u=this._showFullImageRange?this._imageRange:{...d};let f,h=i(0);const g=(u.upper-u.lower)/(l-1);let p=u.lower;for(let v=0;v<l;v++){const w=(p-d.lower)/Math.abs(d.upper-d.lower);if(h)for(let C=h.index;C<n&&!(w<=h.position);C++)f=h,h=i(C+1);let m;if(!f)m=[...h.color];else if(!h)m=[...f.color];else{const C=(w-f.position)/(h.position-f.position);m=Ule(f.color,h.color,C)}const y=m.map(C=>Ble(Math.round(C*255),0,255));s.fillStyle=`rgb(${y[0]}, ${y[1]}, ${y[2]})`,c?s.fillRect(v,0,1,a):s.fillRect(0,a-v-1,o,1),p+=g}}}const Zl={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class ux{constructor(e){ux.validateProps(e);const{top:r=0,left:n=0,size:i={width:20,height:100},imageRange:o={lower:0,upper:1},voiRange:a={lower:0,upper:1},ticks:s,container:c,showFullPixelValueRange:l=!1}=e,{style:d,position:u}=s??{};this._imageRange=o,this._voiRange=a,this._font=d?.font??Zl.FONT,this._color=d?.color??Zl.COLOR,this._tickSize=d?.tickSize??Zl.TICK_SIZE,this._tickWidth=d?.tickWidth??Zl.TICK_WIDTH,this._labelMargin=d?.labelMargin??Zl.TICK_LABEL_MARGIN,this._maxNumTicks=d?.maxNumTicks??Zl.MAX_NUM_TICKS,this._rangeTextPosition=u??po.Right,this._showFullPixelValueRange=l,this._canvas=this._createCanvasElement(i,r,n),c&&this.appendTo(c)}get size(){const{width:e,height:r}=this._canvas;return{width:e,height:r}}set size(e){const{_canvas:r}=this;!w1(e)||HO(r,e)||(this._setCanvasSize(r,e),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(e){const{_canvas:r}=this,n=this.top;e!==n&&(r.style.top=`${e}px`,this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(e){const{_canvas:r}=this,n=this.left;e!==n&&(r.style.left=`${e}px`,this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){!qs(e)||mh(e,this._imageRange)||(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){!qs(e)||mh(e,this._voiRange)||(this._voiRange=e,this.render())}get tickSize(){return this._tickSize}set tickSize(e){e!==this._tickSize&&(this._tickSize=e,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(e){e!==this._tickWidth&&(this._tickWidth=e,this.render())}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(e){e!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=e,this.render())}get visible(){return this._canvas.style.display==="block"}set visible(e){e!==this.visible&&(this._canvas.style.display=e?"block":"none",e&&this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}static validateProps(e){const{size:r,imageRange:n,voiRange:i}=e;if(r&&!w1(r))throw new Error('Invalid "size"');if(n&&!qs(n))throw new Error('Invalid "imageRange"');if(i&&!qs(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,r){const{width:n,height:i}=r;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createCanvasElement(e,r,n){const i=document.createElement("canvas");return Object.assign(i.style,{display:"none",position:"absolute",boxSizing:"border-box",top:`${r}px`,left:`${n}px`}),this._setCanvasSize(i,e),i}_getTicks(e){const{lower:r,upper:n}=e,o=(n-r)/(this._maxNumTicks-1),a=Math.pow(10,-Math.floor(Math.log10(Math.abs(o)))),s=o*a,l=Zl.TICKS_STEPS.find(g=>g>=s)/a,d=Math.ceil(n/l)*l,u=Math.floor(r/l)*l,f=Math.round((d-u)/l)+1,h=[];for(let g=0;g<f;g++)h.push(u+g*l);return{scaleMin:u,scaleMax:d,step:l,ticks:h}}_getLeftTickInfo({position:e,labelMeasure:r}){const{width:n}=this._canvas,o=[n-this.tickSize-r.width-this._labelMargin,e],a={start:[n-this._tickSize,e],end:[n,e]};return{labelPoint:o,tickPoints:a}}_getRightTickInfo({position:e}){const r=[this._tickSize+this._labelMargin,e],n={start:[0,e],end:[this._tickSize,e]};return{labelPoint:r,tickPoints:n}}_getTopTickInfo({position:e,labelMeasure:r}){const{height:n}=this._canvas,i=n-this.tickSize-this._labelMargin,o=[e,i],a={start:[e,n-this._tickSize],end:[e,n]};return{labelPoint:o,tickPoints:a}}_getBottomTickInfo({position:e,labelMeasure:r}){const n=[e,this._tickSize+this._labelMargin],i={start:[e,0],end:[e,this._tickSize]};return{labelPoint:n,tickPoints:i}}render(){const{_canvas:e}=this;if(!e.isConnected||!this.visible)return;const{width:r,height:n}=e,i=r>=n,o=i?r:n,a=e.getContext("2d"),{_voiRange:s}=this,c=this._showFullPixelValueRange?this._imageRange:{...s},l=c.upper-c.lower,{ticks:d}=this._getTicks(c);a.clearRect(0,0,r,n),a.font=this._font,a.textBaseline=i?"top":"middle",a.textAlign=i?"center":"left",a.fillStyle=this._color,a.strokeStyle=this._color,a.lineWidth=this.tickWidth,d.forEach(u=>{let f=Math.round(o*((u-c.lower)/l));if(i||(f=n-f),f<0||f>o)return;const h=u.toString(),g=a.measureText(h);let p;i?this._rangeTextPosition===po.Top?p=this._getTopTickInfo({position:f,labelMeasure:g}):p=this._getBottomTickInfo({position:f,labelMeasure:g}):this._rangeTextPosition===po.Left?p=this._getLeftTickInfo({position:f,labelMeasure:g}):p=this._getRightTickInfo({position:f});const{labelPoint:v,tickPoints:w}=p,{start:m,end:y}=w;return a.beginPath(),a.moveTo(m[0],m[1]),a.lineTo(y[0],y[1]),a.fillText(h,v[0],v[1]),a.stroke(),f})}}function Gle(t,e,r){return(t>=e?[po.Top,po.Bottom]:[po.Left,po.Right]).includes(r)}class Wle{constructor({id:e,container:r}){this._containerResizeCallback=n=>{let i,o;const{contentRect:a,contentBoxSize:s}=n[0];a?(i=a.width,o=a.height):s?.length&&(i=s[0].inlineSize,o=s[0].blockSize),this._containerSize={width:i,height:o},this.onContainerResize()},this._id=e,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(e),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),r&&this.appendTo(r)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(e){const{_rootElement:r,_containerResizeObserver:n}=this,{parentElement:i}=r;!e||e===i||(i&&n.unobserve(i),e.appendChild(r),n.observe(e))}destroy(){const{_rootElement:e,_containerResizeObserver:r}=this,{parentElement:n}=e;n?.removeChild(e),r.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(e){const r=document.createElement("div");return r.id=e,r.classList.add("widget"),Object.assign(r.style,{width:"100%",height:"100%"}),r}onContainerResize(){}}const $d={MULTIPLIER:1,RANGE_TEXT_POSITION:po.Right,TICKS_BAR_SIZE:50};class vh extends Wle{constructor(e){super(e),this._isMouseOver=!1,this._isInteracting=!1,this._mouseOverCallback=r=>{this._isMouseOver=!0,this.showTicks(),r.stopPropagation()},this._mouseOutCallback=r=>{this._isMouseOver=!1,this.hideTicks(),r.stopPropagation()},this._mouseDownCallback=r=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(r),r.stopPropagation()},this._mouseDragCallback=(r,n)=>{const i=this.getVOIMultipliers(),o=this._getPointsFromMouseEvent(r),{points:a,voiRange:s}=n,c=mo(xt(),o.local,a.local),l=c[0]*i[0],d=c[1]*i[1];if(!l&&!d)return;const{lower:u,upper:f}=s;let{windowWidth:h,windowCenter:g}=td(u,f);h=Math.max(h+l,1),g+=d;const p=tl(h,g);this.voiRange=p,r.stopPropagation(),r.preventDefault()},this._mouseUpCallback=r=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),r.stopPropagation()},this._eventListenersManager=new aI,this._colormaps=vh.getColormapsMap(e),this._activeColormapName=vh.getInitialColormapName(e),this._canvas=this._createCanvas(e),this._ticksBar=this._createTicksBar(e),this._rangeTextPosition=e.ticks?.position??$d.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(e){if(e===this._activeColormapName)return;const r=this._colormaps.get(e);if(!r){console.warn(`Invalid colormap name (${e})`);return}this._activeColormapName=e,this._canvas.colormap=r}get imageRange(){return this._canvas.imageRange}set imageRange(e){this._canvas.imageRange=e,this._ticksBar.imageRange=e}get voiRange(){return this._canvas.voiRange}set voiRange(e){const{voiRange:r}=this._canvas;!qs(e)||mh(e,r)||(this._canvas.voiRange=e,this._ticksBar.voiRange=e,this.onVoiChange(e))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(e){this._canvas.showFullImageRange=e,this._ticksBar.showFullPixelValueRange=e}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const e=document.createElement("div");return Object.assign(e.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),e}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[$d.MULTIPLIER,$d.MULTIPLIER]}onVoiChange(e){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(e){const{colormaps:r}=e;return r.reduce((n,i)=>n.set(i.Name,i),new Map)}static getInitialColormapName(e){const{activeColormapName:r,colormaps:n}=e;return!!r&&n.some(o=>o.Name===r)?r:n[0].Name}_createCanvas(e){const{imageRange:r,voiRange:n,showFullPixelValueRange:i}=e,o=this._colormaps.get(this._activeColormapName);return new lx({colormap:o,imageRange:r,voiRange:n,showFullPixelValueRange:i})}_createTicksBar(e){const r=e.ticks;return new ux({imageRange:e.imageRange,voiRange:e.voiRange,ticks:r,showFullPixelValueRange:e.showFullPixelValueRange})}_getPointsFromMouseEvent(e){const{rootElement:r}=this,n=[e.clientX,e.clientY],i=[e.pageX,e.pageY],o=r.getBoundingClientRect(),a=[i[0]-o.left-window.pageXOffset,i[1]-o.top-window.pageYOffset];return{client:n,page:i,local:a}}updateTicksBar(){const{width:e,height:r}=this.containerSize;if(e===0&&r===0)return;const{_ticksBar:n,_rangeTextPosition:i}=this,o=e>=r,a=o?e:$d.TICKS_BAR_SIZE,s=o?$d.TICKS_BAR_SIZE:r;if(!Gle(e,r,i))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let c,l;n.size={width:a,height:s},o?(l=0,c=i===po.Top?-s:r):(c=0,l=i===po.Left?-a:e),n.top=c,n.left=l}_addRootElementEventListeners(){const{_eventListenersManager:e}=this,{rootElement:r}=this;e.addEventListener(r,"mouseover",this._mouseOverCallback),e.addEventListener(r,"mouseout",this._mouseOutCallback),e.addEventListener(r,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(e){const{_eventListenersManager:r}=this,n=this._getPointsFromMouseEvent(e),i={...this._canvas.voiRange},o={points:n,voiRange:i};this._removeVOIEventListeners(),r.addEventListener(document,"voi.mouseup",this._mouseUpCallback),r.addEventListener(document,"voi.mousemove",a=>this._mouseDragCallback(a,o))}_removeVOIEventListeners(){const{_eventListenersManager:e}=this;e.removeEventListener(document,"voi.mouseup"),e.removeEventListener(document,"voi.mousemove")}}const rv=4;function $le(t,e,r){if(SI(t,e)==="PT"){const{clientWidth:i,clientHeight:o}=t.element,a=5/Math.max(i,o),s=dc(t,e),{fixedPTWindowWidth:c=!0}=r??{},l=c?0:a;return s?[l,a]:[l,rv]}return[rv,rv]}const{Events:Bc}=To,Vg={lower:-1e3,upper:1e3};class d0 extends vh{constructor(e){const{element:r,volumeId:n}=e,i=d0._getImageRange(r,n),o=d0._getVOIRange(r,n);super({...e,imageRange:i,voiRange:o}),this.autoHideTicks=()=>{if(this._hideTicksTimeoutId)return;const a=this._hideTicksTime-Date.now();a<=0?this.hideTicks():this._hideTicksTimeoutId=window.setTimeout(()=>{this._hideTicksTimeoutId=0,this.autoHideTicks()},a)},this._stackNewImageCallback=()=>{this.imageRange=d0._getImageRange(this._element)},this._imageVolumeModifiedCallback=a=>{const{volumeId:s}=a.detail;if(s!==this._volumeId)return;const{_element:c}=this;this.imageRange=d0._getImageRange(c,s)},this._viewportVOIModifiedCallback=a=>{const{viewportId:s,volumeId:c,range:l,colormap:d}=a.detail,{viewport:u}=this.enabledElement;s!==u.id||c!==this._volumeId||(this.voiRange=l,d&&(this.activeColormapName=d.name),this.showAndAutoHideTicks())},this._viewportColormapModifiedCallback=a=>{const{viewportId:s,colormap:c,volumeId:l}=a.detail,{viewport:d}=this.enabledElement;s!==d.id||l!==this._volumeId||(this.activeColormapName=c.name)},this._element=r,this._volumeId=n,this._addCornerstoneEventListener()}get element(){return this._element}get enabledElement(){return Ce(this._element)}getVOIMultipliers(){const{viewport:e}=this.enabledElement;return $le(e,this._volumeId)}onVoiChange(e){super.onVoiChange(e);const{viewport:r}=this.enabledElement;if(r instanceof Wn)r.setProperties({voiRange:e}),r.render();else if(r instanceof Gn){const{_volumeId:n}=this,i=Ah(n);r.setProperties({voiRange:e},n),i.forEach(o=>o.render())}}static _getImageRange(e,r){const n=Ce(e),{viewport:i}=n,o=i.getImageActor(r);if(!o)return Vg;const s=o.getMapper().getInputData().getPointData().getScalars();let c;if(s)c=s.getRange();else{if(!r)throw new Error("volumeId is required when scalarData is not available");const l=Ne.getVolume(r),[d,u]=l.voxelManager.getRange();c=[d,u]}return c[0]===0&&c[1]===0?Vg:{lower:c[0],upper:c[1]}}static _getVOIRange(e,r){const n=Ce(e),{viewport:i}=n,o=i.getImageActor(r);if(!o)return Vg;const a=o.getProperty().getRGBTransferFunction(0).getRange();return a[0]===0&&a[1]===0?Vg:{lower:a[0],upper:a[1]}}showAndAutoHideTicks(e=1e3){this._hideTicksTime=Date.now()+e,this.showTicks(),this.autoHideTicks()}_addCornerstoneEventListener(){const{_element:e}=this;Fe.addEventListener(Bc.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.addEventListener(Bc.STACK_NEW_IMAGE,this._stackNewImageCallback),e.addEventListener(Bc.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.addEventListener(Bc.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}destroy(){super.destroy();const{_element:e}=this;Fe.removeEventListener(Bc.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.removeEventListener(Bc.STACK_NEW_IMAGE,this._stackNewImageCallback),e.removeEventListener(Bc.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.removeEventListener(Bc.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}}const zle=Object.freeze(Object.defineProperty({__proto__:null,Colorbar:vh,Enums:Fle,ViewportColorbar:d0},Symbol.toStringTag,{value:"Module"}));function XO(t,e,r,n,i){const o=[];let a=0;const s=t.scalarData;let c,l,d;if(t.color)for(l=0;l<i;l++)for(d=0;d<n;d++){c=((l+r)*t.columns+(d+e))*4;const u=s[c],f=s[c+1],h=s[c+2];o[a++]=.2126*u+.7152*f+.0722*h}else for(l=0;l<i;l++)for(d=0;d<n;d++)c=(l+r)*t.columns+(d+e),o[a++]=s[c];return o}function KO(t,e,r){const n=t.length;let i=r,o=e,a=0;if(n<2)return{min:i,max:o,mean:(e+r)/2};for(let s=0;s<n;s++){const c=t[s];i=Math.min(i,c),o=Math.max(o,c),a+=c}return{min:i,max:o,mean:a/n}}function qO(t){if(t instanceof Gn)return jle(t);if(t instanceof Wn)return Hle(t);throw new Error("Viewport not supported")}function jle(t){const{scalarData:e,width:r,height:n}=zw(t),{min:i,max:o}=Gw(e);return{scalarData:e,minPixelValue:i,maxPixelValue:o,width:r,height:n,rows:r,columns:n}}function Hle(t){const e=t.getImageData(),{scalarData:r}=e,{min:n,max:i}=Gw(r),o=e.dimensions[0],a=e.dimensions[1],{rows:s,columns:c,color:l}=t.getCornerstoneImage();return{scalarData:r,width:o,height:a,minPixelValue:n,maxPixelValue:i,rows:s,columns:c,color:l}}const Xle=Object.freeze(Object.defineProperty({__proto__:null,calculateMinMaxMean:KO,extractWindowLevelRegionToolData:qO,getLuminanceFromRegion:XO},Symbol.toStringTag,{value:"Module"})),Kle=Object.freeze(Object.defineProperty({__proto__:null,colorbar:zle,windowLevel:Xle},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:zy}=hn;function qle(t,e,r,n){const{boundsIJK:i,centerWorld:o,radiusWorld:a}=Yle(e,t,n),s={center:o,radius:a},c=t.getDimensions();ns.createScalarVolumeVoxelManager({dimensions:c,scalarData:t.getPointData().getScalars().getData()}).forEach(r,{boundsIJK:i,isInObject:d=>iO(s,d),imageData:t})}function Yle(t,e,r){const[n,i]=t,o=mt((n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2),a=Dr(n,i)/2;let s;if(!r){const c=zy(e,o),l=e.getSpacing(),d=Math.min(...l),u=Math.ceil(a/d);return s=[[c[0]-u,c[0]+u],[c[1]-u,c[1]+u],[c[2]-u,c[2]+u]],{boundsIJK:s,centerWorld:o,radiusWorld:a}}return s=Jle(e,r,t,o,a),{boundsIJK:s,centerWorld:o,radiusWorld:a}}function Jle(t,e,r,n,i){const[o,a]=r,s=t.getDimensions(),c=e.getCamera(),l=mt(c.viewUp[0],c.viewUp[1],c.viewUp[2]),d=mt(c.viewPlaneNormal[0],c.viewPlaneNormal[1],c.viewPlaneNormal[2]),u=Ie();tn(u,l,d);const f=Ie(),h=Ie();en(f,a,d,i),en(h,o,d,-i),en(f,f,u,-i),en(h,h,u,i);const g=[zy(t,f),zy(t,h)];return hl(g,s)}function YO(t){if(!Array.isArray(t)||t.length!==9)throw new Error("Matrix must be an array of 9 numbers");if(!t.every(e=>typeof e=="number"&&!isNaN(e)))throw new Error("Matrix must contain only valid numbers")}function JO(t){YO(t);const e=[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]]],r=e[0][0]*(e[1][1]*e[2][2]-e[1][2]*e[2][1])-e[0][1]*(e[1][0]*e[2][2]-e[1][2]*e[2][0])+e[0][2]*(e[1][0]*e[2][1]-e[1][1]*e[2][0]);if(Math.abs(r)<1e-10)throw new Error("Matrix is not invertible (determinant is zero)");const n=[[e[1][1]*e[2][2]-e[1][2]*e[2][1],-(e[0][1]*e[2][2]-e[0][2]*e[2][1]),e[0][1]*e[1][2]-e[0][2]*e[1][1]],[-(e[1][0]*e[2][2]-e[1][2]*e[2][0]),e[0][0]*e[2][2]-e[0][2]*e[2][0],-(e[0][0]*e[1][2]-e[0][2]*e[1][0])],[e[1][0]*e[2][1]-e[1][1]*e[2][0],-(e[0][0]*e[2][1]-e[0][1]*e[2][0]),e[0][0]*e[1][1]-e[0][1]*e[1][0]]],i=[];for(let o=0;o<3;o++)for(let a=0;a<3;a++)i.push(n[o][a]/r);return i}function iv(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return t.map(r=>r/e)}function Zle(t){YO(t);const e=t.slice(0,3),r=t.slice(3,6),n=t.slice(6,9),i=iv(e),o=iv(r),a=iv(n),s={x:[1,0,0],y:[0,1,0],z:[0,0,1]},c=1e-10,l=i.every((u,f)=>Math.abs(u-s.x[f])<c)&&o.every((u,f)=>Math.abs(u-s.y[f])<c)&&a.every((u,f)=>Math.abs(u-s.z[f])<c),d=l?[...s.x,...s.y,...s.z]:JO([...i,...o,...a]);return{isStandard:l,rotationMatrix:d}}function Qle(t,e,r){const n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return[r[0]*n+r[1]*i+r[2]*o+e[0],r[3]*n+r[4]*i+r[5]*o+e[1],r[6]*n+r[7]*i+r[8]*o+e[2]]}function eue(t,e,r){const n=[];for(let i=0;i<r.length;i+=3){const o=r.slice(i,i+3),a=Qle(o,e,t);n.push(...a)}return n}const tue=Object.freeze(Object.defineProperty({__proto__:null,checkStandardBasis:Zle,inverse3x3Matrix:JO,rotatePoints:eue},Symbol.toStringTag,{value:"Module"}));function ZO(t,e,r){t.data.label=r,Gt(t,e,At.LabelChange)}function nue(t,e){const{data:r}=t,{points:n}=r.handles,{focalPoint:i,viewPlaneNormal:o}=e.getCamera(),a=ft(rn(Ie(),n[0],i),o);return n.forEach(s=>{hr(s,s,xr(Ie(),[-o[0],-o[1],-o[2]],a))}),e instanceof Wn&&(t.metadata.referencedImageId=e.getCurrentImageId()),t}function rue(t,e,r){const n=e*r,i=t.length/n;if(![1,3,4].includes(i))throw new Error("Buffer must be 1, 3, or 4 channels per pixel");const o=Array.from({length:r},()=>new Array(e).fill(!1));for(let v=0;v<r;v++)for(let w=0;w<e;w++){const y=(v*e+w)*i;let C=!1;for(let x=0;x<Math.min(3,i);x++)if(t[y+x]>0){C=!0;break}o[v][w]=C}const a=Array.from({length:r},()=>new Array(e).fill(0));let s=0;const c={};for(let v=0;v<r;v++)for(let w=0;w<e;w++)if(o[v][w]&&a[v][w]===0){s++;const m=(x,S)=>x<0||x>=e||S<0||S>=r?!1:o[S][x]&&a[S][x]===0;let y=0;ex(m,[w,v],{onFlood:(x,S)=>{a[S][x]=s,y++},diagonals:!1}),c[s]=y}if(s===0)return[];const l=Object.keys(c).reduce((v,w)=>c[v]>c[w]?v:w);function d(v,w){if(a[w][v]!==+l)return!1;for(const[m,y]of[[1,0],[-1,0],[0,1],[0,-1]]){const C=v+m,x=w+y;if(C<0||C>=e||x<0||x>=r||a[x][C]!==+l)return!0}return!1}let u=null;e:for(let v=0;v<r;v++)for(let w=0;w<e;w++)if(d(w,v)){u=[w,v];break e}if(!u)return[];const f=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]],h=[];let g=u,p=[u[0]-1,u[1]];do{h.push([g[0],g[1]]);const v=p[0]-g[0],w=p[1]-g[1];let m=f.findIndex(C=>C[0]===v&&C[1]===w);m<0&&(m=0);let y=null;for(let C=1;C<=8;C++){const[x,S]=f[(m+C)%8],T=g[0]+x,_=g[1]+S;if(T>=0&&T<e&&_>=0&&_<r&&d(T,_)){y=[T,_];const[E,D]=f[(m+C-1+8)%8];p=[g[0]+E,g[1]+D];break}}if(!y)break;g=y}while(g[0]!==u[0]||g[1]!==u[1]);return h}function iue(t){const e=Sm(t,2),r=Z9(e);return{simplified:e,hull:r}}function oue(t,e=7){if(!t.length)throw new Error("Convex hull is empty");const r=t.length,n=w=>(w+1)%r,i=(w,m)=>{const y=[];for(let C=w;y.push(C),C!==m;C=n(C));return y};let o=0,a=0;for(let w=1;w<r;w++)t[w][0]<t[o][0]&&(o=w),t[w][0]>t[a][0]&&(a=w);const s=t[o],c=t[a],l=i(o,a),d=i(a,o),u=Math.min(...t.map(w=>w[1])),f=l.some(w=>t[w][1]===u)?l:d,h=Math.min(...f.map(w=>t[w][1]));let g=f.map(w=>t[w]).filter(w=>Math.abs(w[1]-h)<=e);g.length<2&&(g=f.map(w=>t[w]).sort((w,m)=>w[1]-m[1]).slice(0,2));const p=g.reduce((w,m)=>m[0]<w[0]?m:w,g[0]),v=g.reduce((w,m)=>m[0]>w[0]?m:w,g[0]);return{P1:p,P2:s,P3:c,P4:v}}function aue(t,e,r,n,i,o={}){const{maxDist:a=15,slack:s=2}=o,c={P1:{dx:-1,dy:-1},P2:{dx:-1,dy:1},P3:{dx:1,dy:1},P4:{dx:1,dy:-1}};function l(d,{dx:u,dy:f},h=5){const g=u<0?d[0]-a:d[0]-s,p=u<0?d[0]+s:d[0]+a,v=f<0?d[1]-a:d[1]-s,w=f<0?d[1]+s:d[1]+a;let m=d;for(const[y,C]of i){if(y<g||y>p||C<v||C>w)continue;const x=Math.round(y),S=Math.round(C);if(x<0||x>=e||S<0||S>=r)continue;const T=(x-m[0])*u,_=(S-m[0])*f;t[S*e+x]>h&&(T>0||_>0)&&(m=[y,C])}return m}return{P1:l(n.P1,c.P1),P2:l(n.P2,c.P2),P3:l(n.P3,c.P3),P4:l(n.P4,c.P4)}}function sue(t,e,r,n,i){const o=oue(n);return aue(t,e,r,o,i,{maxDist:20})}function S_(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function cue(t){const{P1:e,P2:r,P3:n,P4:i}=t,o=a1(e,r,i,n,!0);if(!o)throw new Error("Fan edges appear parallel  no apex found");const a=o;let s=S_(a,e)*(180/Math.PI),c=S_(a,i)*(180/Math.PI);if(c<=s){const p=s;s=c,c=p}const l=Math.hypot(e[0]-a[0],e[1]-a[1]),d=Math.hypot(i[0]-a[0],i[1]-a[1]),u=Math.hypot(r[0]-a[0],r[1]-a[1]),f=Math.hypot(n[0]-a[0],n[1]-a[1]),h=Math.min(l,d),g=Math.max(u,f);return{center:a,startAngle:s,endAngle:c,innerRadius:h,outerRadius:g}}function sf(t,e,r,n,i={}){const{strokeStyle:o="#f00",lineWidth:a=2,quality:s=.92}=i,c=document.createElement("canvas");c.width=e,c.height=r;const l=c.getContext("2d"),d=e*r,u=t.length/d,f=l.createImageData(e,r),h=f.data;for(let g=0;g<d;g++){const p=g*u,v=g*4;if(u===1){const w=t[p];h[v]=w,h[v+1]=w,h[v+2]=w,h[v+3]=255}else h[v]=t[p],h[v+1]=t[p+1],h[v+2]=t[p+2],h[v+3]=u===4?t[p+3]:255}if(l.putImageData(f,0,0),n.length>0){l.strokeStyle=o,l.lineWidth=a,l.beginPath(),l.moveTo(n[0][0]+.5,n[0][1]+.5);for(let g=1;g<n.length;g++)l.lineTo(n[g][0]+.5,n[g][1]+.5);l.closePath(),l.stroke()}return c.toDataURL("image/jpeg",s)}function dx(t){const e=Ne.getImage(t);if(!e)return;const r=e.width,n=e.height;return{pixelData:e.getPixelData(),width:r,height:n}}function QO(t,e){const r=document.createElement("a");r.href=t,r.download=e,document.body.appendChild(r),r.style.display="none",r.click(),r.remove()}function lue(t,e,r,n,i={}){const{center:o,startAngle:a,endAngle:s,innerRadius:c,outerRadius:l}=n,{strokeStyle:d="#0ff",lineWidth:u=2,quality:f=.92}=i,h=a*Math.PI/180,g=s*Math.PI/180,p=document.createElement("canvas");p.width=e,p.height=r;const v=p.getContext("2d"),w=e*r,m=t.length/w,y=v.createImageData(e,r),C=y.data;for(let x=0;x<w;x++){const S=x*4;if(m===1){const T=t[x];C[S]=T,C[S+1]=T,C[S+2]=T,C[S+3]=255}else{const T=x*m;C[S]=t[T],C[S+1]=t[T+1],C[S+2]=t[T+2],C[S+3]=m===4?t[T+3]:255}}v.putImageData(y,0,0),v.beginPath();for(let x=h;x<=g;x+=.01){const S=o[0]+c*Math.cos(x),T=o[1]+c*Math.sin(x);x===h?v.moveTo(S,T):v.lineTo(S,T)}for(let x=g;x>=h;x-=.01){const S=o[0]+l*Math.cos(x),T=o[1]+l*Math.sin(x);v.lineTo(S,T)}return v.closePath(),v.strokeStyle=d,v.lineWidth=u,v.stroke(),p.toDataURL("image/jpeg",f)}function uue(t,e=5){const{contour:r,simplified:n,hull:i,refined:o,fanGeometry:a}=fx(t),{pixelData:s,width:c,height:l}=dx(t)||{};if(!s)return;let d;e===1?d=sf(s,c,l,r):e===2?d=sf(s,c,l,n):e===3?d=sf(s,c,l,i):e===4?d=sf(s,c,l,[o.P1,o.P2,o.P3,o.P4]):d=lue(s,c,l,a,{strokeStyle:"#f00",lineWidth:3,quality:.95}),QO(d,"contour.jpg")}function fx(t){const{pixelData:e,width:r,height:n}=dx(t)||{};if(!e)return;const i=rue(e,r,n),{simplified:o,hull:a}=iue(i),s=sue(e,r,n,a,o),c=cue({P1:s.P1,P2:s.P2,P3:s.P3,P4:s.P4});return{contour:i,simplified:o,hull:a,refined:s,fanGeometry:c}}const due=Object.freeze(Object.defineProperty({__proto__:null,calculateFanGeometry:fx,default:QO,downloadFanJpeg:uue,exportContourJpeg:sf,getPixelData:dx},Symbol.toStringTag,{value:"Module"})),fue=Ht,hue=Object.freeze(Object.defineProperty({__proto__:null,AnnotationMultiSlice:Bae,IslandRemoval:Lu,annotationHydration:MQ,boundingBox:kae,calibrateImageSpacing:Vae,cine:ele,contourSegmentation:Cte,contours:Pie,debounce:pd,drawing:yre,dynamicVolume:Vle,geometricSurfaceUtils:tue,getAnnotationNearPoint:Aae,getAnnotationNearPointOnEnabledElement:HM,getCalibratedAspect:AC,getCalibratedLengthUnitsAndScale:_o,getCalibratedProbeUnitsAndValue:d1,getClosestImageIdForStackViewport:uC,getOrCreateImageVolume:Lm,getPixelValueUnits:fc,getPixelValueUnitsImageId:tM,getSphereBoundsInfo:qM,getViewportForAnnotation:yp,isObject:kC,math:Iee,moveAnnotationToViewPlane:nue,normalizeViewportPlane:eO,orientation:jce,planar:nne,planarFreehandROITool:ile,pointInSurroundingSphereCallback:qle,pointToString:YM,polyDataUtils:kle,rectangleROITool:lle,roundNumber:fue,segmentation:Wce,setAnnotationLabel:ZO,stackContextPrefetch:Ile,stackPrefetch:Cle,throttle:Pi,touch:XZ,triggerAnnotationRender:hd,triggerAnnotationRenderForToolGroupIds:b7,triggerAnnotationRenderForViewportIds:Me,triggerEvent:Ye,usFanExtraction:due,viewport:Mle,viewportFilters:Jee,voi:Kle},Symbol.toStringTag,{value:"Module"})),gue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function eP(t,e){const r=On;t.forEach(n=>{r.updateSegmentation(n.segmentationId,n.payload),e||Ko(n.segmentationId)})}function pue(t,e,r){On.setSegmentationRepresentationVisibility(t,e,r)}function mue(t,e,r){const n=Qi(t,e);n&&n.forEach(i=>{pue(t,{segmentationId:i.segmentationId,type:i.type},r)})}function vue(t,e){return Q7(t,e)}function yue(t,e,r,n){const i=Qi(t,e);i&&(i.forEach(o=>{!o.segments||!o.segments[r]||(o.segments[r].visible=n)}),Nm(e.segmentationId),Ha(t,e.segmentationId))}function wue(t,e,r){return!tP(t,e).has(r)}function tP(t,e){const r=oC(t,e);return r?Object.entries(r.segments).reduce((i,[o,a])=>(a.visible||i.add(Number(o)),i),new Set):new Set}const Cue=Object.freeze(Object.defineProperty({__proto__:null,getHiddenSegmentIndices:tP,getSegmentIndexVisibility:wue,getSegmentationRepresentationVisibility:vue,setSegmentIndexVisibility:yue,setSegmentationRepresentationVisibility:mue},Symbol.toStringTag,{value:"Module"}));function xue(t){return Zi.getStyle(t)}function Sue(t,e,r){Zi.setStyle(t,e,r),!t.viewportId&&!t.segmentationId&&Am().forEach(i=>{wd(i.segmentationId)}),Ha(t.viewportId,t.segmentationId,t.type)}function Tue(t,e){Zi.setRenderInactiveSegmentations(t,e),wd(t),U7(t).forEach(n=>{Ha(t,n.segmentationId)})}function _ue(t){return Zi.getRenderInactiveSegmentations(t)}function Eue(){Zi.resetToGlobalStyle(),wd()}function bue(t){return Zi.hasCustomStyle(t)}const Due=Object.freeze(Object.defineProperty({__proto__:null,getRenderInactiveSegmentations:_ue,getStyle:xue,hasCustomStyle:bue,resetToGlobalStyle:Eue,setRenderInactiveSegmentations:Tue,setStyle:Sue},Symbol.toStringTag,{value:"Module"})),Iue=Object.freeze(Object.defineProperty({__proto__:null,color:$ie,style:Due,visibility:Cue},Symbol.toStringTag,{value:"Module"}));async function Mue(t){const e=yQ(t);return Ko(t.segmentationId),e}function nP(t,e){const r=Ut(t);if(r.representationData.Labelmap){const{representationData:n}=r,i=n.Labelmap;("imageIds"in i||"volumeId"in i)&&("imageIds"in i?i.imageIds.map(a=>Ne.getImage(a)):[Ne.getVolume(i.volumeId)]).forEach(a=>{if(!a)return;const{voxelManager:s}=a;s.forEach(({value:c,index:l})=>{c===e&&s.setAtIndex(l,0)})}),ei(t)}else throw new Error("Invalid segmentation type, only labelmap is supported right now")}function Oue(t,e){const r=oh(t);if(!r)return;const n=r.get(e);n&&n.forEach(i=>{const o=fn(i);gd(o)&&Pm(o)})}function Pue(t,e,r={setNextSegmentAsActive:!0}){const n=Ut(t);if(n?.representationData.Contour)Oue(t,e);else if(n?.representationData.Labelmap)nP(t,e);else throw new Error("Invalid segmentation type");const i=zi(t)===e,{segments:o}=n;delete o[e];const a={...o};if(eP([{segmentationId:t,payload:{segments:a}}]),i&&r.setNextSegmentAsActive){const c=Object.keys(o).map(Number).sort((f,h)=>f-h),l=c.indexOf(e),d=c[l+1],u=c[l-1];d!==void 0?gh(t,d):u!==void 0&&gh(t,u)}Fu(t).forEach(c=>{Qi(c,{segmentationId:t}).forEach(d=>{delete d.segments[e]})})}function Rue(t){const e=On,r=Ut(t);return e.getLabelmapImageIds(r.representationData)}const Aue={clearSegmentValue:nP,convertStackToVolumeLabelmap:Mue,computeVolumeLabelmapFromStack:MO,convertVolumeToStackLabelmap:Nce},Lue=Object.freeze(Object.defineProperty({__proto__:null,activeSegmentation:$te,addContourRepresentationToViewport:rx,addContourRepresentationToViewportMap:Oce,addDefaultSegmentationListener:$C,addLabelmapRepresentationToViewport:DO,addLabelmapRepresentationToViewportMap:Pce,addRepresentationData:aC,addSegmentationListener:O7,addSegmentationRepresentations:Sd,addSegmentations:M7,addSurfaceRepresentationToViewport:IO,addSurfaceRepresentationToViewportMap:Rce,config:Iue,defaultSegmentationStateManager:On,getActiveSegmentation:Ru,getCurrentLabelmapImageIdsForViewport:sc,getLabelmapImageIds:Rue,getLabelmapImageIdsForImageId:Lte,helpers:Aue,removeAllSegmentationListeners:fie,removeAllSegmentationRepresentations:A7,removeAllSegmentations:k7,removeContourRepresentation:N7,removeLabelmapRepresentation:L7,removeSegment:Pue,removeSegmentation:jC,removeSegmentationListener:zC,removeSegmentationRepresentation:vd,removeSegmentationRepresentations:P7,removeSurfaceRepresentation:V7,segmentIndex:Dce,segmentLocking:Bie,segmentationStyle:Zi,state:yie,strategies:Lse,triggerSegmentationEvents:uQ,updateSegmentations:eP,utilities:Vie},Symbol.toStringTag,{value:"Module"}));class hx{constructor(e){this._controlPoints=[],this._invalidated=!1,this._length=0,this._controlPoints=[],this._resolution=e?.resolution??20,this._fixedResolution=e?.fixedResolution??!1,this._closed=e?.closed??!1,this._invalidated=!0}get controlPoints(){return this._controlPoints}get numControlPoints(){return this._controlPoints.length}get resolution(){return this._resolution}set resolution(e){this._fixedResolution||this._resolution===e||(this._resolution=e,this.invalidated=!0)}get fixedResolution(){return this._fixedResolution}get closed(){return this._closed}set closed(e){this._closed!==e&&(this._closed=e,this.invalidated=!0)}get aabb(){return this._update(),this._aabb}get length(){return this._update(),this._length}get invalidated(){return this._invalidated}set invalidated(e){this._invalidated=e}hasTangentPoints(){return!1}addControlPoint(e){this._controlPoints.push([e[0],e[1]]),this.invalidated=!0}addControlPoints(e){e.forEach(r=>this.addControlPoint(r))}addControlPointAtU(e){const r=this._getLineSegmentAt(e),{start:n,end:i}=r.points,o=Math.floor(e),a=this._curveSegments[o],s=e-Math.floor(o),c=[n[0]+s*(i[0]-n[0]),n[1]+s*(i[1]-n[1])],l=this._controlPoints.indexOf(a.controlPoints.p1)+1;return this._controlPoints.splice(l,0,c),this.invalidated=!0,{index:l,point:c}}deleteControlPointByIndex(e){const r=this._closed?3:1;return e>=0&&e<this._controlPoints.length&&this._controlPoints.length>r?(this._controlPoints.splice(e,1),this.invalidated=!0,!0):!1}clearControlPoints(){this._controlPoints=[],this.invalidated=!0}setControlPoints(e){this.clearControlPoints(),this.addControlPoints(e)}updateControlPoint(e,r){if(e<0||e>=this._controlPoints.length)throw new Error("Index out of bounds");this._controlPoints[e]=[...r],this.invalidated=!0}getControlPoints(){return this._controlPoints.map(e=>[e[0],e[1]])}getClosestControlPoint(e){const r=this._controlPoints;let n=1/0,i=-1;for(let o=0,a=r.length;o<a;o++){const s=r[o],c=e[0]-s[0],l=e[1]-s[1],d=c*c+l*l;d<n&&(n=d,i=o)}return{index:i,point:i===-1?void 0:[...r[i]],distance:Math.sqrt(n)}}getClosestControlPointWithinDistance(e,r){const n=this.getClosestControlPoint(e);return n.distance<=r?n:void 0}getClosestPoint(e){this._update();const r=this._getCurveSegmmentsDistanceSquaredInfo(e);if(!r.length)return;r.sort((u,f)=>u.distanceSquared-f.distanceSquared);let n,i=-1,o=1/0,a,s;for(let u=0;u<r.length;u++){const f=r[u];if(f.distanceSquared>o)continue;const{curveSegmentIndex:h,curveSegment:g}=f,{lineSegments:p}=g;for(let v=0;v<p.length;v++){const w=p[v],{point:m,distanceSquared:y}=o1(w.points.start,w.points.end,e);y<o&&(s=w,i=h,a=f.curveSegment,n=m,o=y)}}const l=(s.previousLineSegmentsLength+ls(s.points.start,n))/a.length,d=i+l;return{point:n,uValue:d,distance:Math.sqrt(o)}}getClosestPointOnControlPointLines(e){const r=[...this._controlPoints];if(this._closed&&r.push(this._controlPoints[0]),!r.length)return;let n,i=1/0,o=r[0];for(let a=1,s=r.length;a<s;a++){const c=r[a],{point:l,distanceSquared:d}=o1(o,c,e);d<i&&(n=l,i=d),o=c}return{point:n,distance:Math.sqrt(i)}}getPolylinePoints(){return this._update(),this._convertCurveSegmentsToPolyline(this._curveSegments)}getPreviewPolylinePoints(e,r){if(this._closed)return[];this._update();const i=this.getClosestControlPointWithinDistance(e,r)?.index===0,o=this.getPreviewCurveSegments(e,i);return o?.length?this._convertCurveSegmentsToPolyline(o):[]}isPointNearCurve(e,r){this._update();const n=this._getCurveSegmmentsWithinDistance(e,r),i=r*r;for(let o=0;o<n.length;o++){const{lineSegments:a}=n[o];for(let s=0;s<a.length;s++){const c=a[s];if(Wh(c.points.start,c.points.end,e)<=i)return!0}}return!1}containsPoint(e){if(this._update(),this._controlPoints.length<3)return!1;const n=[...this._curveSegments],i=this._getClosingCurveSegmentWithStraightLineSegment();i&&n.push(i);let o=0;for(let a=0;a<n.length;a++){const s=n[a],{aabb:c}=s;if(!(e[0]<=c.maxX&&e[1]>=c.minY&&e[1]<c.maxY))continue;const{lineSegments:d}=s;for(let u=0;u<d.length;u++){const f=d[u],{aabb:h}=f;if(e[0]<=h.maxX&&e[1]>=h.minY&&e[1]<h.maxY){const{start:p,end:v}=f.points,w=p[0]===v[0],m=(e[1]-p[1])*(v[0]-p[0])/(v[1]-p[1])+p[0];o+=w||e[0]<=m?1:0}}}return o%2===1}_update(){if(!this._invalidated)return;const e=this.getSplineCurves();let r=0,n=1/0,i=1/0,o=-1/0,a=-1/0;for(let s=0,c=e.length;s<c;s++){const{aabb:l,length:d}=e[s];n=n<=l.minX?n:l.minX,i=i<=l.minY?i:l.minY,o=o>=l.maxX?o:l.maxX,a=a>=l.maxY?a:l.maxY,r+=d}this._curveSegments=e,this._aabb={minX:n,minY:i,maxX:o,maxY:a},this._length=r,this._invalidated=!1}_convertCurveSegmentsToPolyline(e){this._update();const r=[];return e.forEach(({lineSegments:n},i)=>{n.forEach((o,a)=>{i===0&&a===0&&r.push([...o.points.start]),r.push([...o.points.end])})}),r}_getCurveSegmmentsDistanceSquaredInfo(e){this._update();const r=[],{_curveSegments:n}=this;for(let i=0;i<n.length;i++){const o=n[i],a=i1(o.aabb,e);r.push({curveSegmentIndex:i,curveSegment:o,distanceSquared:a})}return r}_getCurveSegmmentsWithinDistance(e,r){this._update();const n=r*r;if(i1(this.aabb,e)>n)return[];const i=this._getCurveSegmmentsDistanceSquaredInfo(e),o=[];for(let a=0,s=i.length;a<s;a++){const{curveSegment:c,distanceSquared:l}=i[a];l<=n&&o.push(c)}return o}_getLineSegmentAt(e){this._update();const r=Math.floor(e),n=e-r,i=this._curveSegments[r],{lineSegments:o}=i,a=i.length*n;for(let s=0;s<o.length;s++){const c=o[s],l=c.previousLineSegmentsLength+c.length;if(a>=c.previousLineSegmentsLength&&a<=l)return c}}_getClosingCurveSegmentWithStraightLineSegment(){if(this.closed)return;const e=this._controlPoints,r=e[0],n=e[e.length-1],i={points:{start:[...r],end:[...n]},aabb:{minX:Math.min(r[0],n[0]),minY:Math.min(r[1],n[1]),maxX:Math.max(r[0],n[0]),maxY:Math.max(r[1],n[1])}};return{aabb:{minX:i.aabb.minX,minY:i.aabb.minY,maxX:i.aabb.maxX,maxY:i.aabb.maxY},lineSegments:[i]}}}const Nue=1e-8;class gx extends hx{getPreviewCurveSegments(e,r){const n=this._getNumCurveSegments()+1,i=Math.max(0,n-2),o=r?n:n-1,a=this.getTransformMatrix(),s=[...this.controlPoints],c=[];r||s.push(e);for(let l=i;l<=o;l++){const d=this._getCurveSegment(l,a,s,r);c.push(d)}return c}getSplineCurves(){const e=this._getNumCurveSegments(),r=new Array(e);if(e<=0)return[];const n=this.getTransformMatrix();let i=0;for(let o=0;o<e;o++){const a=this._getCurveSegment(o,n);a.previousCurveSegmentsLength=i,r[o]=a,i+=a.length}return r}_getNumCurveSegments(e=this.controlPoints,r=this.closed){return r?e.length:Math.max(0,e.length-1)}_getPoint(e,r,n=this.controlPoints,i=this.closed){const o=this._getNumCurveSegments(n,i),a=Math.floor(e);let s=a%o;const c=e-a;if(s<0||s>=o)if(this.closed)s=(o+s)%o;else return;const{p0:d,p1:u,p2:f,p3:h}=this._getCurveSegmentPoints(s,n,i),g=c*c,p=g*c,v=Qg(1,c,g,p),w=$s(F4(),v,r);return[R3(w,Qg(d[0],u[0],f[0],h[0])),R3(w,Qg(d[1],u[1],f[1],h[1]))]}_getCurveSegmentPoints(e,r=this.controlPoints,n=this.closed){const i=this._getNumCurveSegments(r,n),o=e,a=o-1,s=n?(o+1)%i:o+1,c=s+1,l=r[o],d=r[s];let u,f;return a>=0?u=r[a]:u=n?r[r.length-1]:_y(d,l),c<r.length?f=r[c]:f=n?r[0]:_y(l,d),{p0:u,p1:l,p2:d,p3:f}}_getLineSegments(e,r,n=this.controlPoints,i=this.closed){const o=this._getNumCurveSegments(n,i),a=this.resolution+1,s=1/a,c=e;let l=c+1;!i&&e===o-1&&(l-=Nue);const d=[];let u,f,h=0;for(let g=0,p=c;g<=a;g++,p+=s){p=p>l?l:p;const v=this._getPoint(p,r,n,i);if(!g){u=v;continue}f=v;const w=f[0]-u[0],m=f[1]-u[1],y=Math.sqrt(w**2+m**2),C={minX:u[0]<=f[0]?u[0]:f[0],maxX:u[0]>=f[0]?u[0]:f[0],minY:u[1]<=f[1]?u[1]:f[1],maxY:u[1]>=f[1]?u[1]:f[1]};d.push({points:{start:u,end:f},aabb:C,length:y,previousLineSegmentsLength:h}),u=f,h+=y}return d}_getCurveSegment(e,r=this.getTransformMatrix(),n=this.controlPoints,i=this.closed){const{p0:o,p1:a,p2:s,p3:c}=this._getCurveSegmentPoints(e,n,i),l=this._getLineSegments(e,r,n,i);let d=0,u=1/0,f=1/0,h=-1/0,g=-1/0;return l.forEach(({aabb:p,length:v})=>{u=Math.min(u,p.minX),f=Math.min(f,p.minY),h=Math.max(h,p.maxX),g=Math.max(g,p.maxY),d+=v}),{controlPoints:{p0:o,p1:a,p2:s,p3:c},aabb:{minX:u,minY:f,maxX:h,maxY:g},length:d,previousCurveSegmentsLength:0,lineSegments:l}}}const Vue=N4(fi(),k5(1,4,1,0,-3,0,3,0,3,-6,3,0,-1,3,-3,1),1/6);class rP extends gx{getTransformMatrix(){return Vue}}class yh extends gx{constructor(e){super(e),this._scale=e?.scale??.5,this._fixedScale=e?.fixedScale??!1}get scale(){return this._scale}set scale(e){this._fixedScale||this._scale===e||(this._scale=e,this.invalidated=!0)}get fixedScale(){return this._fixedScale}getTransformMatrix(){const{scale:e}=this,r=2*e;return[0,1,0,0,-e,0,e,0,r,e-3,3-r,-e,-e,2-e,e-2,e]}}class iP extends yh{constructor(){super({scale:.5,fixedScale:!0})}}class oP extends yh{constructor(){super({resolution:0,fixedResolution:!0,scale:0,fixedScale:!0})}}class aP extends hx{getSplineCurves(){return[]}getLineSegments(){return[]}getPreviewCurveSegments(e,r){return[]}}const kue=[1,0,0,-2,2,0,1,-2,1];class Fue extends aP{hasTangentPoints(){return!0}getTransformMatrix(){return kue}}const Uue=Object.freeze(Object.defineProperty({__proto__:null,BSpline:rP,CardinalSpline:yh,CatmullRomSpline:iP,CubicSpline:gx,LinearSpline:oP,QuadraticBezier:Fue,QuadraticSpline:aP,Spline:hx},Symbol.toStringTag,{value:"Module"}));let sP=class extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{limitToViewport:!1,ignoreX:!1,ignoreY:!1,ignoreZ:!1}}){super(e,r)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_checkImageInViewport(e,r){const{canvas:n}=e,i=window.devicePixelRatio,o=0,a=n.width/i,s=0,c=n.height/i,l=e.getDefaultActor(),d=e.getRenderer();let u;l&&Uo(l)?u=l.actor.getMapper().getInputData().getBounds():u=d.computeVisiblePropBounds();const[f,h]=e.worldToCanvas([u[0],u[2],u[4]]),[g,p]=e.worldToCanvas([u[1],u[3],u[5]]);if(e.getZoom()<=1){if(f+r[0]<o&&r[0]<0||g+r[0]>a&&r[0]>0||h+r[1]<s&&r[1]<0||p+r[1]>c&&r[1]>0)return!1}else if(f+r[0]>o&&r[0]>0||g+r[0]<a&&r[0]<0||h+r[1]>s&&r[1]>0||p+r[1]<c&&r[1]<0)return!1;return!0}_dragCallback(e){const{element:r,deltaPoints:n}=e.detail,i=Ce(r),o=n.world,a=n.canvas;if(o[0]===0&&o[1]===0&&o[2]===0)return;this.configuration.ignoreX&&(o[0]=0),this.configuration.ignoreY&&(o[1]=0),this.configuration.ignoreZ&&(o[2]=0);const s=i.viewport,c=s.getCamera(),{focalPoint:l,position:d}=c;if(this.configuration.limitToViewport&&!this._checkImageInViewport(s,a))return;const u=[d[0]-o[0],d[1]-o[1],d[2]-o[2]],f=[l[0]-o[0],l[1]-o[1],l[2]-o[2]];s.setCamera({focalPoint:f,position:u}),s.render()}};sP.toolName="Pan";class cP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2,rotateSampleDistanceFactor:2}}){super(e,r),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a,d=s.getDefaultActor().actor.getMapper();if(!("getSampleDistance"in d||"getCurrentSampleDistance"in d))return!0;const f=d.getSampleDistance();if(!this._hasResolutionChanged){const{rotateSampleDistanceFactor:h}=this.configuration;d.setSampleDistance(f*h),this._hasResolutionChanged=!0,this.cleanUp!==null&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{d.setSampleDistance(f),s.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})}return!0},this._getViewportsInfo=()=>Fr(this.toolGroupId).viewportsInfo,this.onSetToolActive=()=>{const n=()=>{this._getViewportsInfo().forEach(({viewportId:o,renderingEngineId:a})=>{if(!this._resizeObservers.has(o)){const{viewport:s}=Ln(o,a)||{viewport:null};if(!s)return;const{element:c}=s,l=new ResizeObserver(()=>{const d=Ln(o,a);if(!d)return;const{viewport:u}=d,f=u.getViewPresentation();u.resetCamera(),u.setViewPresentation(f),u.render()});l.observe(c),this._resizeObservers.set(o,l)}})};n(),this._viewportAddedListener=i=>{i.detail.toolGroupId===this.toolGroupId&&n()},Fe.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)},this.onSetToolDisabled=()=>{this._resizeObservers.forEach((n,i)=>{n.disconnect(),this._resizeObservers.delete(i)}),this._viewportAddedListener&&(Fe.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)},this.rotateCamera=(n,i,o,a)=>{const s=n.getVtkActiveCamera(),c=s.getViewUp(),l=s.getFocalPoint(),d=s.getPosition(),u=[0,0,0],f=[0,0,0],h=[0,0,0],g=It(new Float32Array(16));Xn(g,g,i),Zr(g,g,a,o),Xn(g,g,[-i[0],-i[1],-i[2]]),Vt(u,d,g),Vt(f,l,g),It(g),Zr(g,g,a,o),Vt(h,c,g),n.setCamera({position:u,viewUp:h,focalPoint:f})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:r,currentPoints:n,lastPoints:i}=e.detail,o=n.canvas,a=i.canvas,{rotateIncrementDegrees:s}=this.configuration,c=Ce(r),{viewport:l}=c,d=l.getCamera(),u=r.clientWidth,f=r.clientHeight,h=[o[0]/u,o[1]/f],g=[a[0]/u,a[1]/f],p=[u*.5,f*.5],v=l.canvasToWorld(p),m=(1+Math.abs([.5,.5][0]))**2,y=[g[0],0,0],C=[h[0],0,0],x=y[0]**2,S=C[0]**2,T=x>m?0:Math.sqrt(m-x),_=S>m?0:Math.sqrt(m-S),E=[y[0],0,T];pt.normalize(E);const D=[C[0],0,_];pt.normalize(D);const b=pt.dot(E,D);if(Math.abs(b)>1e-4){const I=-2*Math.acos(pt.clampValue(b,-1,1))*Math.sign(h[0]-g[0])*s,O=d.viewUp,M=d.viewPlaneNormal,R=[0,0,0],A=[0,0,0];pt.cross(O,M,R),pt.normalize(R),pt.cross(M,R,A),pt.normalize(A),pt.normalize(O),this.rotateCamera(l,v,A,I);const G=(g[1]-h[1])*s;this.rotateCamera(l,v,R,G),l.render()}}}cP.toolName="TrackballRotate";function Bue(t,e){e.classHierarchy.push("vtkSphereSource"),t.requestData=(r,n)=>{let i=n[0];const o=i?i.getPoints().getDataType():e.pointType;i=i?.initialize()||Ii.newInstance();let a=0,{thetaResolution:s}=e,c=e.startTheta<e.endTheta?e.startTheta:e.endTheta;c*=Math.PI/180;let l=e.endTheta>e.startTheta?e.endTheta:e.startTheta;l*=Math.PI/180;let d=e.startPhi<e.endPhi?e.startPhi:e.endPhi;d*=Math.PI/180;let u=e.endPhi>e.startPhi?e.endPhi:e.startPhi;u*=Math.PI/180,Math.abs(c-l)<2*Math.PI&&++s;const f=(l-c)/e.thetaResolution,h=e.startPhi<=0?1:0,g=e.phiResolution+(e.endPhi>=180?-1:0),p=e.phiResolution*s+2,v=e.phiResolution*2*e.thetaResolution;let w=0,m=Z.newTypedArray(o,p*3),y=new Float32Array(p*3),C=0,x=new Uint32Array(v*5);e.startPhi<=0&&(m[w*3+0]=e.center[0],m[w*3+1]=e.center[1],m[w*3+2]=e.center[2]+e.radius,y[w*3+0]=0,y[w*3+1]=0,y[w*3+2]=1,w++,a++),e.endPhi>=180&&(m[w*3+0]=e.center[0],m[w*3+1]=e.center[1],m[w*3+2]=e.center[2]-e.radius,y[w*3+0]=0,y[w*3+1]=0,y[w*3+2]=-1,w++,a++);const S=e.phiResolution-a,T=(u-d)/(e.phiResolution-1);for(let D=0;D<s;D++){const b=c+D*f;for(let I=h;I<g;I++){const O=d+I*T,M=e.radius*Math.sin(O);y[w*3+0]=M*Math.cos(b),y[w*3+1]=M*Math.sin(b),y[w*3+2]=e.radius*Math.cos(O),m[w*3+0]=y[w*3+0]+e.center[0],m[w*3+1]=y[w*3+1]+e.center[1],m[w*3+2]=y[w*3+2]+e.center[2];let R=Math.sqrt(y[w*3+0]*y[w*3+0]+y[w*3+1]*y[w*3+1]+y[w*3+2]*y[w*3+2]);R=R===0?1:R,y[w*3+0]/=R,y[w*3+1]/=R,y[w*3+2]/=R,w++}}const _=S*s;if(Math.abs(c-l)<2*Math.PI&&--s,e.startPhi<=0)for(let D=0;D<s;D++)x[C++]=3,x[C++]=S*D+a,x[C++]=S*(D+1)%_+a,x[C++]=0;if(e.endPhi>=180){const D=S-1+a;for(let b=0;b<s;b++)x[C++]=3,x[C++]=S*b+D,x[C++]=a-1,x[C++]=S*(b+1)%_+D}for(let D=0;D<s;D++)for(let b=0;b<S-1;b++){const I=S*D+b+a,O=I+1,M=(S*(D+1)+b)%_+a+1;e.latLongTessellation?(x[C++]=4,x[C++]=I,x[C++]=O,x[C++]=M,x[C++]=M-1):(x[C++]=3,x[C++]=I,x[C++]=O,x[C++]=M,x[C++]=3,x[C++]=I,x[C++]=M,x[C++]=M-1)}m=m.subarray(0,w*3),i.getPoints().setData(m,3),y=y.subarray(0,w*3);const E=Ot.newInstance({name:"Normals",values:y,numberOfComponents:3});i.getPointData().setNormals(E),x=x.subarray(0,C),i.getPolys().setData(x,1),n[0]=i}}const Gue={radius:.5,latLongTessellation:!1,thetaResolution:8,startTheta:0,endTheta:360,phiResolution:8,startPhi:0,endPhi:180,center:[0,0,0],pointType:"Float64Array"};function lP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gue,r),Z.obj(t,e),Z.setGet(t,e,["radius","latLongTessellation","thetaResolution","startTheta","endTheta","phiResolution","startPhi","endPhi"]),Z.setGetArray(t,e,["center"],3),Z.algo(t,e,0,1),Bue(t,e)}const Wue=Z.newInstance(lP,"vtkSphereSource");var $ue={newInstance:Wue,extend:lP};const Ro={XMIN:0,XMAX:1,YMIN:2,YMAX:3,ZMIN:4,ZMAX:5},Pt={XMIN:0,XMAX:1,YMIN:2,YMAX:3,ZMIN:4,ZMAX:5,XMIN_YMIN_ZMIN:6,XMIN_YMIN_ZMAX:7,XMIN_YMAX_ZMIN:8,XMIN_YMAX_ZMAX:9,XMAX_YMIN_ZMIN:10,XMAX_YMIN_ZMAX:11,XMAX_YMAX_ZMIN:12,XMAX_YMAX_ZMAX:13};class uP extends ar{constructor(e={},r={configuration:{showCornerSpheres:!0,showHandles:!0,showClippingPlanes:!0,mobile:{enabled:!1,opacity:.8},initialCropFactor:.08,sphereColors:{SAGITTAL:[1,1,0],CORONAL:[0,1,0],AXIAL:[1,0,0],CORNERS:[0,0,1]},sphereRadius:8,grabSpherePixelDistance:20,rotateIncrementDegrees:2,rotateSampleDistanceFactor:2}}){super(e,r),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.originalClippingPlanes=[],this.draggingSphereIndex=null,this.toolCenter=[0,0,0],this.cornerDragOffset=null,this.faceDragOffset=null,this.sphereStates=[],this.edgeLines={},this.onSetToolConfiguration=()=>{console.debug("Setting tool settoolconfiguration : volumeCropping")},this.onSetToolEnabled=()=>{console.debug("Setting tool enabled: volumeCropping")},this.onCameraModified=n=>{const{element:i}=n.currentTarget?{element:n.currentTarget}:n.detail,o=Ce(i);this._updateClippingPlanes(o.viewport),o.viewport.render()},this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a,d=s.getDefaultActor().actor.getMapper(),u=[n.detail.currentPoints.canvas[0],n.detail.currentPoints.canvas[1]];this.draggingSphereIndex=null,this.cornerDragOffset=null,this.faceDragOffset=null;for(let g=0;g<this.sphereStates.length;++g){const p=s.worldToCanvas(this.sphereStates[g].point);if(Math.sqrt(Math.pow(u[0]-p[0],2)+Math.pow(u[1]-p[1],2))<this.configuration.grabSpherePixelDistance){this.draggingSphereIndex=g,o.style.cursor="grabbing";const w=this.sphereStates[g],m=s.canvasToWorld(u);if(w.isCorner)this.cornerDragOffset=[w.point[0]-m[0],w.point[1]-m[1],w.point[2]-m[2]],this.faceDragOffset=null;else{const y={x:0,y:1,z:2}[w.axis];this.faceDragOffset=w.point[y]-m[y],this.cornerDragOffset=null}return!0}}if(!("getSampleDistance"in d||"getCurrentSampleDistance"in d))return!0;const h=d.getSampleDistance();if(!this._hasResolutionChanged){const{rotateSampleDistanceFactor:g}=this.configuration;d.setSampleDistance(h*g),this._hasResolutionChanged=!0,this.cleanUp!==null&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{if(d.setSampleDistance(h),n.target.style.cursor="",this.draggingSphereIndex!==null){const p=this.sphereStates[this.draggingSphereIndex],[v]=this._getViewportsInfo(),m=Fn(v.renderingEngineId).getViewport(v.viewportId);p.isCorner&&(this._updateCornerSpheres(),this._updateFaceSpheresFromCorners(),this._updateClippingPlanesFromFaceSpheres(m))}this.draggingSphereIndex=null,this.cornerDragOffset=null,this.faceDragOffset=null,s.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})}return!0},this._onMouseMoveSphere=n=>{if(this.draggingSphereIndex===null)return!1;const i=this.sphereStates[this.draggingSphereIndex];if(!i)return!1;const{viewport:o,world:a}=this._getViewportAndWorldCoords(n);if(!o||!a)return!1;if(i.isCorner){const s=this._calculateNewCornerPosition(a);this._updateSpherePosition(i,s);const c=this._parseCornerKey(i.uid);this._updateRelatedCorners(i,s,c),this._updateFaceSpheresFromCorners(),this._updateCornerSpheres()}else{const s={x:0,y:1,z:2}[i.axis];let c=a[s];this.faceDragOffset!==null&&(c+=this.faceDragOffset),i.point[s]=c,i.sphereSource.setCenter(...i.point),i.sphereSource.modified(),this._updateCornerSpheresFromFaces(),this._updateFaceSpheresFromCorners(),this._updateCornerSpheres()}return this._updateClippingPlanesFromFaceSpheres(o),o.render(),this._triggerToolChangedEvent(i),!0},this._onControlToolChange=n=>{const i=this._getViewport();if(!n.detail.toolCenter)Ye(Fe,V.VOLUMECROPPING_TOOL_CHANGED,{originalClippingPlanes:this.originalClippingPlanes,viewportId:i.id,renderingEngineId:i.renderingEngineId,seriesInstanceUID:this.seriesInstanceUID});else{if(n.detail.seriesInstanceUID!==this.seriesInstanceUID)return;const o=n.detail.handleType==="min",a=o?n.detail.toolCenterMin:n.detail.toolCenterMax,s=o?[[1,0,0],[0,1,0],[0,0,1]]:[[-1,0,0],[0,-1,0],[0,0,-1]],c=o?[Ro.XMIN,Ro.YMIN,Ro.ZMIN]:[Ro.XMAX,Ro.YMAX,Ro.ZMAX],l=o?[Pt.XMIN,Pt.YMIN,Pt.ZMIN]:[Pt.XMAX,Pt.YMAX,Pt.ZMAX],d=["x","y","z"],u=[ha.SAGITTAL,ha.CORONAL,ha.AXIAL];for(let f=0;f<3;++f){const h=[0,0,0];h[f]=a[f];const g=Kn.newInstance({origin:h,normal:s[f]});this.originalClippingPlanes[c[f]].origin=g.getOrigin(),this.sphereStates[l[f]].point[f]=g.getOrigin()[f],this.sphereStates[l[f]].sphereSource.setCenter(...this.sphereStates[l[f]].point),this.sphereStates[l[f]].sphereSource.modified();const v=(this.sphereStates.find((m,y)=>m.axis===d[f]&&y!==l[f]).point[f]+g.getOrigin()[f])/2;this.sphereStates.forEach(m=>{!m.isCorner&&m.axis!==d[f]&&!n.detail.viewportOrientation.includes(u[f])&&(m.point[f]=v,m.sphereSource.setCenter(m.point),m.sphereActor.getProperty().setColor(m.color),m.sphereSource.modified())});const w=i.getDefaultActor()?.actor;if(w){const y=w.getMapper().getClippingPlanes();y&&y[c[f]].setOrigin(g.getOrigin())}}this._updateCornerSpheres(),i.render()}},this._getViewportsInfo=()=>Fr(this.toolGroupId).viewportsInfo,this._initialize3DViewports=n=>{if(!n||!n.length||!n[0]){console.warn("VolumeCroppingTool: No viewportsInfo available for initialization of volumecroppingtool.");return}const i=this._getViewport(),o=i.getActors();if(!o||o.length===0){console.warn("VolumeCroppingTool: No volume actors found in the viewport.");return}const a=o[0].actor.getMapper().getInputData();if(!a){console.warn("VolumeCroppingTool: No image data found for volume actor.");return}this.seriesInstanceUID=a.seriesInstanceUID||"unknown";const s=a.getBounds(),c=this.configuration.initialCropFactor||.1,l=s[1]-s[0],d=s[3]-s[2],u=s[5]-s[4],f=s[0]+c*l,h=s[1]-c*l,g=s[2]+c*d,p=s[3]-c*d,v=s[4]+c*u,w=s[5]-c*u,m=[],y=Kn.newInstance({origin:[f,0,0],normal:[1,0,0]}),C=Kn.newInstance({origin:[h,0,0],normal:[-1,0,0]}),x=Kn.newInstance({origin:[0,g,0],normal:[0,1,0]}),S=Kn.newInstance({origin:[0,p,0],normal:[0,-1,0]}),T=Kn.newInstance({origin:[0,0,v],normal:[0,0,1]}),_=Kn.newInstance({origin:[0,0,w],normal:[0,0,-1]}),E=i.getDefaultActor().actor.getMapper();m.push(y),m.push(C),m.push(x),m.push(S),m.push(T),m.push(_);const D=m.map(j=>({origin:[...j.getOrigin()],normal:[...j.getNormal()]}));this.originalClippingPlanes=D;const b=[f,(p+g)/2,(w+v)/2],I=[h,(p+g)/2,(w+v)/2],O=[(h+f)/2,g,(w+v)/2],M=[(h+f)/2,p,(w+v)/2],R=[(h+f)/2,(p+g)/2,v],A=[(h+f)/2,(p+g)/2,w],G=this._calculateAdaptiveSphereRadius(Math.sqrt(l*l+d*d+u*u));this._addSphere(i,b,"x","min",null,G),this._addSphere(i,I,"x","max",null,G),this._addSphere(i,O,"y","min",null,G),this._addSphere(i,M,"y","max",null,G),this._addSphere(i,R,"z","min",null,G),this._addSphere(i,A,"z","max",null,G);const k=[[f,g,v],[f,g,w],[f,p,v],[f,p,w],[h,g,v],[h,g,w],[h,p,v],[h,p,w]],L=["XMIN_YMIN_ZMIN","XMIN_YMIN_ZMAX","XMIN_YMAX_ZMIN","XMIN_YMAX_ZMAX","XMAX_YMIN_ZMIN","XMAX_YMIN_ZMAX","XMAX_YMAX_ZMIN","XMAX_YMAX_ZMAX"];for(let j=0;j<k.length;j++)this._addSphere(i,k[j],"corner",null,L[j],G);[["XMIN_YMIN_ZMIN","XMAX_YMIN_ZMIN"],["XMIN_YMIN_ZMAX","XMAX_YMIN_ZMAX"],["XMIN_YMAX_ZMIN","XMAX_YMAX_ZMIN"],["XMIN_YMAX_ZMAX","XMAX_YMAX_ZMAX"],["XMIN_YMIN_ZMIN","XMIN_YMAX_ZMIN"],["XMIN_YMIN_ZMAX","XMIN_YMAX_ZMAX"],["XMAX_YMIN_ZMIN","XMAX_YMAX_ZMIN"],["XMAX_YMIN_ZMAX","XMAX_YMAX_ZMAX"],["XMIN_YMIN_ZMIN","XMIN_YMIN_ZMAX"],["XMIN_YMAX_ZMIN","XMIN_YMAX_ZMAX"],["XMAX_YMIN_ZMIN","XMAX_YMIN_ZMAX"],["XMAX_YMAX_ZMIN","XMAX_YMAX_ZMAX"]].forEach(([j,Y],ie)=>{const de=this.sphereStates.find(fe=>fe.uid===`corner_${j}`),ae=this.sphereStates.find(fe=>fe.uid===`corner_${Y}`);if(de&&ae){const fe=`edge_${j}_${Y}`,{actor:we,source:_e}=this._addLine3DBetweenPoints(i,de.point,ae.point,[.7,.7,.7],fe);this.edgeLines[fe]={actor:we,source:_e,key1:j,key2:Y}}}),E.addClippingPlane(y),E.addClippingPlane(C),E.addClippingPlane(x),E.addClippingPlane(S),E.addClippingPlane(T),E.addClippingPlane(_),Fe.addEventListener(V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,j=>{this._onControlToolChange(j)}),i.render()},this._getViewportAndWorldCoords=n=>{const i=this._getViewport(),o=n.detail.currentPoints.canvas[0],a=n.detail.currentPoints.canvas[1],s=i.canvasToWorld([o,a]);return{viewport:i,world:s}},this._getViewport=()=>{const[n]=this._getViewportsInfo();return Fn(n.renderingEngineId).getViewport(n.viewportId)},this._handleCornerSphereMovement=(n,i,o)=>{const a=this._calculateNewCornerPosition(i);this._updateSpherePosition(n,a);const s=this._parseCornerKey(n.uid);this._updateRelatedCorners(n,a,s),this._updateAfterCornerMovement(o)},this._handleFaceSphereMovement=(n,i,o)=>{const a={x:0,y:1,z:2}[n.axis];let s=i[a];this.faceDragOffset!==null&&(s+=this.faceDragOffset),n.point[a]=s,n.sphereSource.setCenter(...n.point),n.sphereSource.modified(),this._updateAfterFaceMovement(o)},this._calculateNewCornerPosition=n=>{let i=[n[0],n[1],n[2]];return this.cornerDragOffset&&(i=[n[0]+this.cornerDragOffset[0],n[1]+this.cornerDragOffset[1],n[2]+this.cornerDragOffset[2]]),i},this._parseCornerKey=n=>{const i=n.replace("corner_","");return{isXMin:i.includes("XMIN"),isXMax:i.includes("XMAX"),isYMin:i.includes("YMIN"),isYMax:i.includes("YMAX"),isZMin:i.includes("ZMIN"),isZMax:i.includes("ZMAX")}},this._updateSpherePosition=(n,i)=>{n.point=i,n.sphereSource.setCenter(...i),n.sphereSource.modified()},this._updateRelatedCorners=(n,i,o)=>{this.sphereStates.forEach(a=>{if(!a.isCorner||a===n)return;const s=a.uid.replace("corner_","");this._shouldUpdateCorner(s,o)&&this._updateCornerCoordinates(a,i,s,o)})},this._shouldUpdateCorner=(n,i)=>i.isXMin&&n.includes("XMIN")||i.isXMax&&n.includes("XMAX")||i.isYMin&&n.includes("YMIN")||i.isYMax&&n.includes("YMAX")||i.isZMin&&n.includes("ZMIN")||i.isZMax&&n.includes("ZMAX"),this._updateCornerCoordinates=(n,i,o,a)=>{(a.isXMin&&o.includes("XMIN")||a.isXMax&&o.includes("XMAX"))&&(n.point[0]=i[0]),(a.isYMin&&o.includes("YMIN")||a.isYMax&&o.includes("YMAX"))&&(n.point[1]=i[1]),(a.isZMin&&o.includes("ZMIN")||a.isZMax&&o.includes("ZMAX"))&&(n.point[2]=i[2]),n.sphereSource.setCenter(...n.point),n.sphereSource.modified()},this._updateAfterCornerMovement=n=>{this._updateFaceSpheresFromCorners(),this._updateCornerSpheres(),this._updateClippingPlanesFromFaceSpheres(n)},this._updateAfterFaceMovement=n=>{this._updateCornerSpheresFromFaces(),this._updateClippingPlanesFromFaceSpheres(n)},this._triggerToolChangedEvent=n=>{Ye(Fe,V.VOLUMECROPPING_TOOL_CHANGED,{toolCenter:n.point,axis:n.isCorner?"corner":n.axis,draggingSphereIndex:this.draggingSphereIndex,seriesInstanceUID:this.seriesInstanceUID})},this._onNewVolume=()=>{const n=this._getViewportsInfo();this.originalClippingPlanes=[],this.sphereStates=[],this.edgeLines={},this._initialize3DViewports(n)},this._rotateCamera=(n,i,o,a)=>{const s=n.getVtkActiveCamera(),c=s.getViewUp(),l=s.getFocalPoint(),d=s.getPosition(),u=[0,0,0],f=[0,0,0],h=[0,0,0],g=It(new Float32Array(16));Xn(g,g,i),Zr(g,g,a,o),Xn(g,g,[-i[0],-i[1],-i[2]]),Vt(u,d,g),Vt(f,l,g),It(g),Zr(g,g,a,o),Vt(h,c,g),n.setCamera({position:u,viewUp:h,focalPoint:f})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}onSetToolActive(){if(this.sphereStates&&this.sphereStates.length>0)this.configuration.showHandles?(this.setHandlesVisible(!1),this.setClippingPlanesVisible(!1)):(this.setHandlesVisible(!0),this.setClippingPlanesVisible(!0));else{const e=this._getViewportsInfo(),r=()=>{e.forEach(({viewportId:n,renderingEngineId:i})=>{if(!this._resizeObservers.has(n)){const{viewport:o}=Ln(n,i)||{viewport:null};if(!o)return;const{element:a}=o,s=new ResizeObserver(()=>{const c=Ln(n,i);if(!c)return;const{viewport:l}=c,d=l.getViewPresentation();l.resetCamera(),l.setViewPresentation(d),l.render()});s.observe(a),this._resizeObservers.set(n,s)}})};r(),this._viewportAddedListener=n=>{n.detail.toolGroupId===this.toolGroupId&&r()},Fe.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._initialize3DViewports(e),this.sphereStates&&this.sphereStates.length>0?this.setHandlesVisible(!0):(this.originalClippingPlanes=[],this._initialize3DViewports(e))}}onSetToolDisabled(){this._resizeObservers.forEach((r,n)=>{r.disconnect(),this._resizeObservers.delete(n)}),this._viewportAddedListener&&(Fe.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null);const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e)}setHandlesVisible(e){this.configuration.showHandles=e,e&&(this.sphereStates[Pt.XMIN].point[0]=this.originalClippingPlanes[Ro.XMIN].origin[0],this.sphereStates[Pt.XMAX].point[0]=this.originalClippingPlanes[Ro.XMAX].origin[0],this.sphereStates[Pt.YMIN].point[1]=this.originalClippingPlanes[Ro.YMIN].origin[1],this.sphereStates[Pt.YMAX].point[1]=this.originalClippingPlanes[Ro.YMAX].origin[1],this.sphereStates[Pt.ZMIN].point[2]=this.originalClippingPlanes[Ro.ZMIN].origin[2],this.sphereStates[Pt.ZMAX].point[2]=this.originalClippingPlanes[Ro.ZMAX].origin[2],[Pt.XMIN,Pt.XMAX,Pt.YMIN,Pt.YMAX,Pt.ZMIN,Pt.ZMAX].forEach(a=>{const s=this.sphereStates[a];s.sphereSource.setCenter(...s.point),s.sphereSource.modified()}),this._updateCornerSpheres()),this._updateHandlesVisibility();const r=this._getViewportsInfo(),[n]=r;Fn(n.renderingEngineId).getViewport(n.viewportId).render()}getHandlesVisible(){return this.configuration.showHandles}getClippingPlanesVisible(){return this.configuration.showClippingPlanes}setClippingPlanesVisible(e){this.configuration.showClippingPlanes=e;const r=this._getViewport();this._updateClippingPlanes(r),r.render()}_dragCallback(e){const{element:r,currentPoints:n,lastPoints:i}=e.detail;if(this.draggingSphereIndex!==null)this._onMouseMoveSphere(e);else{const o=n.canvas,a=i.canvas,{rotateIncrementDegrees:s}=this.configuration,c=Ce(r),{viewport:l}=c,d=l.getCamera(),u=r.clientWidth,f=r.clientHeight,h=[o[0]/u,o[1]/f],g=[a[0]/u,a[1]/f],p=[u*.5,f*.5],v=l.canvasToWorld(p),m=(1+Math.abs([.5,.5][0]))**2,y=[g[0],0,0],C=[h[0],0,0],x=y[0]**2,S=C[0]**2,T=x>m?0:Math.sqrt(m-x),_=S>m?0:Math.sqrt(m-S),E=[y[0],0,T];pt.normalize(E);const D=[C[0],0,_];pt.normalize(D);const b=pt.dot(E,D);if(Math.abs(b)>1e-4){const I=-2*Math.acos(pt.clampValue(b,-1,1))*Math.sign(h[0]-g[0])*s,O=d.viewUp,M=d.viewPlaneNormal,R=[0,0,0],A=[0,0,0];pt.cross(O,M,R),pt.normalize(R),pt.cross(M,R,A),pt.normalize(A),pt.normalize(O),this._rotateCamera(l,v,A,I);const G=(g[1]-h[1])*s;this._rotateCamera(l,v,R,G)}l.render()}}_updateClippingPlanes(e){const r=e.getDefaultActor();if(!r||!r.actor){e._missingActorWarned||(console.warn("VolumeCroppingTool._updateClippingPlanes: No default actor found in viewport."),e._missingActorWarned=!0);return}const n=r.actor,i=n.getMapper(),o=n.getMatrix();if(!this.configuration.showClippingPlanes){i.removeAllClippingPlanes();return}const a=Vo();el(a,o);const s=Vo();ec(s,a),V0(s,s);const c=this.originalClippingPlanes;if(!c||!c.length)return;i.removeAllClippingPlanes();const l=[],d=[];for(let u=0;u<c.length;++u){const f=c[u],h=Ie();Vt(h,new Float32Array(f.origin),o);const g=[h[0],h[1],h[2]],p=Ie();zf(p,new Float32Array(f.normal),s),Lt(p,p);const v=[p[0],p[1],p[2]];l.push(g),d.push(v)}for(let u=0;u<l.length;++u){const f=Kn.newInstance({origin:l[u],normal:d[u]});i.addClippingPlane(f)}}_updateHandlesVisibility(){this.sphereStates.forEach(e=>{e.sphereActor&&e.sphereActor.setVisibility(this.configuration.showHandles)}),Object.values(this.edgeLines).forEach(({actor:e})=>{e&&e.setVisibility(this.configuration.showHandles)})}_addLine3DBetweenPoints(e,r,n,i=[.7,.7,.7],o=""){if(r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2])return{actor:null,source:null};const a=F0.newInstance();a.setNumberOfPoints(2),a.setPoint(0,r[0],r[1],r[2]),a.setPoint(1,n[0],n[1],n[2]);const s=ll.newInstance({values:[2,0,1]}),c=Ii.newInstance();c.setPoints(a),c.setLines(s);const l=Mu.newInstance();l.setInputData(c);const d=U0.newInstance();return d.setMapper(l),d.getProperty().setColor(...i),d.getProperty().setLineWidth(.5),d.getProperty().setOpacity(1),d.getProperty().setInterpolationToFlat(),d.getProperty().setAmbient(1),d.getProperty().setDiffuse(0),d.getProperty().setSpecular(0),d.setVisibility(this.configuration.showHandles),e.addActor({actor:d,uid:o}),{actor:d,source:c}}_addSphere(e,r,n,i,o=null,a){const s=o?`corner_${o}`:`${n}_${i}`;if(this.sphereStates.find(w=>w.uid===s))return;const l=$ue.newInstance();l.setCenter(r),l.setRadius(a);const d=Mu.newInstance();d.setInputConnection(l.getOutputPort());const u=U0.newInstance();u.setMapper(d);let f=[0,1,0];const h=this.configuration.sphereColors||{};o?f=h.CORNERS||[0,0,1]:n==="z"?f=h.AXIAL||[1,0,0]:n==="x"?f=h.SAGITTAL||[1,1,0]:n==="y"&&(f=h.CORONAL||[0,1,0]);const g=this.sphereStates.findIndex(w=>w.uid===s);g===-1?this.sphereStates.push({point:r.slice(),axis:n,uid:s,sphereSource:l,sphereActor:u,isCorner:!!o,color:f}):(this.sphereStates[g].point=r.slice(),this.sphereStates[g].sphereSource=l),!e.getActors().find(w=>w.uid===s)&&(u.getProperty().setColor(f),u.setVisibility(this.configuration.showHandles),e.addActor({actor:u,uid:s}))}_calculateAdaptiveSphereRadius(e){this.configuration.sphereRadius!==void 0&&this.configuration.sphereRadius;const r=this.configuration.sphereRadiusScale||.01,n=e*r,i=this.configuration.minSphereRadius||2,o=this.configuration.maxSphereRadius||50;return Math.max(i,Math.min(o,n))}_updateClippingPlanesFromFaceSpheres(e){const r=e.getDefaultActor().actor.getMapper();this.originalClippingPlanes[0].origin=[...this.sphereStates[Pt.XMIN].point],this.originalClippingPlanes[1].origin=[...this.sphereStates[Pt.XMAX].point],this.originalClippingPlanes[2].origin=[...this.sphereStates[Pt.YMIN].point],this.originalClippingPlanes[3].origin=[...this.sphereStates[Pt.YMAX].point],this.originalClippingPlanes[4].origin=[...this.sphereStates[Pt.ZMIN].point],this.originalClippingPlanes[5].origin=[...this.sphereStates[Pt.ZMAX].point],r.removeAllClippingPlanes();for(let n=0;n<6;++n){const i=this.originalClippingPlanes[n].origin,o=this.originalClippingPlanes[n].normal,a=Kn.newInstance({origin:i,normal:o});r.addClippingPlane(a)}}_updateCornerSpheresFromFaces(){const e=this.sphereStates[Pt.XMIN].point[0],r=this.sphereStates[Pt.XMAX].point[0],n=this.sphereStates[Pt.YMIN].point[1],i=this.sphereStates[Pt.YMAX].point[1],o=this.sphereStates[Pt.ZMIN].point[2],a=this.sphereStates[Pt.ZMAX].point[2],s=[{key:"XMIN_YMIN_ZMIN",pos:[e,n,o]},{key:"XMIN_YMIN_ZMAX",pos:[e,n,a]},{key:"XMIN_YMAX_ZMIN",pos:[e,i,o]},{key:"XMIN_YMAX_ZMAX",pos:[e,i,a]},{key:"XMAX_YMIN_ZMIN",pos:[r,n,o]},{key:"XMAX_YMIN_ZMAX",pos:[r,n,a]},{key:"XMAX_YMAX_ZMIN",pos:[r,i,o]},{key:"XMAX_YMAX_ZMAX",pos:[r,i,a]}];for(const c of s){const l=this.sphereStates.find(d=>d.uid===`corner_${c.key}`);l&&(l.point[0]=c.pos[0],l.point[1]=c.pos[1],l.point[2]=c.pos[2],l.sphereSource.setCenter(...l.point),l.sphereSource.modified())}}_updateFaceSpheresFromCorners(){const e=[this.sphereStates[Pt.XMIN_YMIN_ZMIN].point,this.sphereStates[Pt.XMIN_YMIN_ZMAX].point,this.sphereStates[Pt.XMIN_YMAX_ZMIN].point,this.sphereStates[Pt.XMIN_YMAX_ZMAX].point,this.sphereStates[Pt.XMAX_YMIN_ZMIN].point,this.sphereStates[Pt.XMAX_YMIN_ZMAX].point,this.sphereStates[Pt.XMAX_YMAX_ZMIN].point,this.sphereStates[Pt.XMAX_YMAX_ZMAX].point],r=e.map(u=>u[0]),n=e.map(u=>u[1]),i=e.map(u=>u[2]),o=Math.min(...r),a=Math.max(...r),s=Math.min(...n),c=Math.max(...n),l=Math.min(...i),d=Math.max(...i);this.sphereStates[Pt.XMIN].point=[o,(s+c)/2,(l+d)/2],this.sphereStates[Pt.XMAX].point=[a,(s+c)/2,(l+d)/2],this.sphereStates[Pt.YMIN].point=[(o+a)/2,s,(l+d)/2],this.sphereStates[Pt.YMAX].point=[(o+a)/2,c,(l+d)/2],this.sphereStates[Pt.ZMIN].point=[(o+a)/2,(s+c)/2,l],this.sphereStates[Pt.ZMAX].point=[(o+a)/2,(s+c)/2,d],[Pt.XMIN,Pt.XMAX,Pt.YMIN,Pt.YMAX,Pt.ZMIN,Pt.ZMAX].forEach(u=>{const f=this.sphereStates[u];f.sphereSource.setCenter(...f.point),f.sphereSource.modified()})}_updateCornerSpheres(){const e=this.sphereStates[Pt.XMIN].point[0],r=this.sphereStates[Pt.XMAX].point[0],n=this.sphereStates[Pt.YMIN].point[1],i=this.sphereStates[Pt.YMAX].point[1],o=this.sphereStates[Pt.ZMIN].point[2],a=this.sphereStates[Pt.ZMAX].point[2],s=[{key:"XMIN_YMIN_ZMIN",pos:[e,n,o]},{key:"XMIN_YMIN_ZMAX",pos:[e,n,a]},{key:"XMIN_YMAX_ZMIN",pos:[e,i,o]},{key:"XMIN_YMAX_ZMAX",pos:[e,i,a]},{key:"XMAX_YMIN_ZMIN",pos:[r,n,o]},{key:"XMAX_YMIN_ZMAX",pos:[r,n,a]},{key:"XMAX_YMAX_ZMIN",pos:[r,i,o]},{key:"XMAX_YMAX_ZMAX",pos:[r,i,a]}];for(const c of s){const l=this.sphereStates.find(d=>d.uid===`corner_${c.key}`);l&&(l.point[0]=c.pos[0],l.point[1]=c.pos[1],l.point[2]=c.pos[2],l.sphereSource.setCenter(...l.point),l.sphereSource.modified())}Object.values(this.edgeLines).forEach(({source:c,key1:l,key2:d})=>{const u=this.sphereStates.find(h=>h.uid===`corner_${l}`),f=this.sphereStates.find(h=>h.uid===`corner_${d}`);if(u&&f){const h=c.getPoints();h.setPoint(0,u.point[0],u.point[1],u.point[2]),h.setPoint(1,f.point[0],f.point[1],f.point[2]),h.modified(),c.modified()}})}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}}uP.toolName="VolumeCropping";function zue(){return"rgb(0, 200, 0)"}function jue(){return!0}const ov={DRAG:1};class dP extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse"],configuration:{viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},extendReferenceLines:!0,initialCropFactor:.2,mobile:{enabled:!1,opacity:.8},lineColors:{AXIAL:[1,0,0],CORONAL:[0,1,0],SAGITTAL:[1,1,0],UNKNOWN:[0,0,1]},lineWidth:1.5,lineWidthActive:2.5}}){super(e,r),this._virtualAnnotations=[],this.sphereStates=[],this.draggingSphereIndex=null,this.toolCenter=[0,0,0],this.toolCenterMin=[0,0,0],this.toolCenterMax=[0,0,0],this.initializeViewport=({renderingEngineId:i,viewportId:o})=>{if(!i||!o){console.warn("VolumeCroppingControlTool: Missing renderingEngineId or viewportId");return}const a=Ln(o,i);if(!a)return;const{viewport:s}=a;this._updateToolCentersFromViewport(s);const{element:c}=s,{position:l,focalPoint:d,viewPlaneNormal:u}=s.getCamera();let f=this._getAnnotations(a);f=this.filterInteractableAnnotationsForElement(c,f),f?.length&&kt(f[0].annotationUID);const h=this._getOrientationFromNormal(s.getCamera().viewPlaneNormal),g={highlighted:!1,metadata:{cameraPosition:[...l],cameraFocalPoint:[...d],toolName:this.getToolName()},data:{handles:{toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax},activeOperation:null,activeViewportIds:[],viewportId:o,referenceLines:[],orientation:h}};return Ft(g,c),{normal:u,point:s.canvasToWorld([100,100])}},this._getViewportsInfo=()=>Fr(this.toolGroupId).viewportsInfo,this.resetCroppingSpheres=()=>{const i=this._getViewportsInfo();for(const o of i){const{viewportId:a,renderingEngineId:s}=o,c=Ln(a,s),l=c.viewport;l.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!0,suppressEvents:!0}),l.resetSlabThickness();const{element:p}=l;let v=this._getAnnotations(c);v=this.filterInteractableAnnotationsForElement(p,v),v.length&&kt(v[0].annotationUID),l.render()}this._computeToolCenter(i)},this.computeToolCenter=()=>{this._getViewportsInfo()},this._computeToolCenter=i=>{if(!i||!i[0]){console.warn("  _computeToolCenter : No valid viewportsInfo for computeToolCenter.");return}const o=["AXIAL","CORONAL","SAGITTAL"],a=i.map(u=>{if(u.renderingEngineId){const h=Fn(u.renderingEngineId).getViewport(u.viewportId);if(h&&h.getCamera){const g=this._getOrientationFromNormal(h.getCamera().viewPlaneNormal);if(g)return g}}return null}).filter(Boolean),s=o.find(u=>!a.includes(u)),c=[],l=[],d=i.filter(u=>{let f=null;if(u.renderingEngineId){const g=Fn(u.renderingEngineId).getViewport(u.viewportId);g&&g.getCamera&&(f=this._getOrientationFromNormal(g.getCamera().viewPlaneNormal))}return f&&o.includes(f)});if(d.forEach(u=>{const{normal:f,point:h}=this.initializeViewport(u);c.push(f),l.push(h)}),d.length===2&&s){const u=[0,0,0];tn(u,c[0],c[1]),Lt(u,u);const f=[(l[0][0]+l[1][0])/2,(l[0][1]+l[1][1])/2,(l[0][2]+l[1][2])/2],g={highlighted:!1,metadata:{cameraPosition:[...f],cameraFocalPoint:[...f],toolName:this.getToolName()},data:{handles:{activeOperation:null,toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax},activeViewportIds:[],viewportId:s,referenceLines:[],orientation:null},isVirtual:!0,virtualNormal:u};this._virtualAnnotations=[g]}else if(d.length===1){let u=null;const f=d[0];if(f.renderingEngineId){const m=Fn(f.renderingEngineId).getViewport(f.viewportId);m&&m.getCamera&&(u=this._getOrientationFromNormal(m.getCamera().viewPlaneNormal))}const h=l[0],g={AXIAL:[0,0,1],CORONAL:[0,1,0],SAGITTAL:[1,0,0]},v=o.filter(w=>w!==u).map(w=>{const m=g[w];return{highlighted:!1,metadata:{cameraPosition:[...h],cameraFocalPoint:[...h],toolName:this.getToolName()},data:{handles:{activeOperation:null,toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax},activeViewportIds:[],viewportId:w,referenceLines:[],orientation:w},isVirtual:!0,virtualNormal:m}});this._virtualAnnotations=v}i&&i.length&&Me(i.map(({viewportId:u})=>u))},this.cancel=()=>{console.log("Not implemented yet")},this.isPointNearTool=(i,o,a,s)=>!!this._pointNearTool(i,o,a,6),this.toolSelectedCallback=(i,o,a)=>{const s=i.detail,{element:c}=s;o.highlighted=!0,this._activateModify(c),St(c),i.preventDefault()},this.onResetCamera=i=>{this.resetCroppingSpheres()},this.mouseMoveCallback=(i,o)=>{if(!o)return;const{element:a,currentPoints:s}=i.detail,c=s.canvas;let l=!1;for(let d=0;d<o.length;d++){const u=o[d];if(ir(u.annotationUID))continue;const{data:f,highlighted:h}=u;if(!f.handles)continue;f.handles.activeOperation,f.activeViewportIds&&f.activeViewportIds.length>0&&[...f.activeViewportIds],f.activeViewportIds=[];let g=!1;g=this._pointNearTool(a,u,c,6),(g&&!h||!g&&h)&&(u.highlighted=!h,l=!0)}return l},this.filterInteractableAnnotationsForElement=(i,o)=>{if(!o||!o.length)return[];const a=Ce(i);let s=null;return a.viewport&&a.viewport.getCamera&&(s=this._getOrientationFromNormal(a.viewport.getCamera().viewPlaneNormal)),o.filter(l=>!!(l.isVirtual||l.data.orientation&&s&&l.data.orientation===s))},this.renderAnnotation=(i,o)=>{function a(I,O,M,R){const A=O[0]-I[0],G=O[1]-I[1],k=R[0]-M[0],L=R[1]-M[1],F=-k*G+A*L;if(Math.abs(F)<1e-8)return null;const j=(-G*(I[0]-M[0])+A*(I[1]-M[1]))/F,Y=(k*(I[1]-M[1])-L*(I[0]-M[0]))/F;return j>=0&&j<=1&&Y>=0&&Y<=1?[I[0]+Y*A,I[1]+Y*G]:null}const s=this._getViewportsInfo();if(!s||s.length===0)return!1;let c=!1;const{viewport:l,renderingEngine:d}=i,{element:u}=l;let f=this._getAnnotations(i);this._virtualAnnotations&&this._virtualAnnotations.length&&(f=f.concat(this._virtualAnnotations));const h=l.getCamera(),p=this.filterInteractableAnnotationsForElement(u,f)[0];if(!p||!p.data)return c;const v=p.annotationUID,{clientWidth:w,clientHeight:m}=l.canvas,y=Math.sqrt(w*w+m*m),C=p.data,x=f,S=l.worldToCanvas(this.toolCenterMin),T=l.worldToCanvas(this.toolCenterMax),_=[],E=[0,0,w,m];x.forEach(I=>{const O=I.data,M="isVirtual"in I&&I.isVirtual===!0;O.handles.toolCenter=this.toolCenter;let R,A,G,k,L,F,j;if(M){const ee=s.filter(ge=>ge.viewportId!==O.viewportId);if(ee.length===2){const ge=d.getViewport(ee[0].viewportId),De=d.getViewport(ee[1].viewportId),Le=ge.getCamera().viewPlaneNormal,Ge=De.getCamera().viewPlaneNormal,re=Ie();tn(re,Le,Ge),Lt(re,re),A={viewPlaneNormal:re,position:O.handles.toolCenter,focalPoint:O.handles.toolCenter,viewUp:[0,1,0]},G=l.canvas.clientWidth,k=l.canvas.clientHeight,L=Math.sqrt(G*G+k*k),F=[G*.5,k*.5],j=O.handles.toolCenter,R={id:O.viewportId,canvas:l.canvas,canvasToWorld:()=>O.handles.toolCenter}}else A={viewPlaneNormal:I.virtualNormal??[0,0,1],position:O.handles.toolCenter,focalPoint:O.handles.toolCenter,viewUp:[0,1,0]},G=l.canvas.clientWidth,k=l.canvas.clientHeight,L=Math.sqrt(G*G+k*k),F=[G*.5,k*.5],j=O.handles.toolCenter,R={id:O.viewportId,canvas:l.canvas,canvasToWorld:()=>O.handles.toolCenter}}else R=d.getViewport(O.viewportId),A=R.getCamera(),G=R.canvas.clientWidth,k=R.canvas.clientHeight,L=Math.sqrt(G*G+k*k),F=[G*.5,k*.5],j=R.canvasToWorld(F);const Y=this._getReferenceLineControllable(R.id),ie=[0,0,0];pt.cross(h.viewPlaneNormal,A.viewPlaneNormal,ie),pt.normalize(ie),pt.multiplyScalar(ie,L);const de=[0,0,0];pt.add(j,ie,de);const ae=[0,0,0];pt.subtract(j,ie,ae);const fe=l.worldToCanvas(de),we=l.worldToCanvas([j[0]??0,j[1]??0,j[2]??0]),_e=xt();En(_e,fe,we),za(_e,_e);const Se=xt();Ga(Se,_e,y*100);const B=da(Y?S:we),P=xt(),$=xt();zr(P,B,Se),En($,B,Se),mu(P,$,E),_.push([R,P,$,"min"]);const W=da(Y?T:we),K=xt(),Q=xt();zr(K,W,Se),En(Q,W,Se),mu(K,Q,E),_.push([R,K,Q,"max"])}),C.referenceLines=_;const D=this._getReferenceLineColor(l.id),b=D!==void 0?D:"rgb(200, 200, 200)";if(_.forEach((I,O)=>{const M=[];for(let ae=0;ae<_.length;++ae){if(ae===O)continue;const fe=_[ae],we=a(I[1],I[2],fe[1],fe[2]);we&&M.push({with:fe[3],point:we})}const R=I[0];let A=null;if(R&&R.id){const ae=f.find(fe=>fe.data.viewportId===R.id);if(ae&&ae.data.orientation)A=String(ae.data.orientation).toUpperCase();else{const fe=R.id.toUpperCase();fe.includes("AXIAL")?A="AXIAL":fe.includes("CORONAL")?A="CORONAL":fe.includes("SAGITTAL")&&(A="SAGITTAL")}}const G=this.configuration.lineColors||{},k=G[A]||G.unknown||[1,0,0],L=Array.isArray(k)?`rgb(${k.map(ae=>Math.round(ae*255)).join(",")})`:k,F=this._getReferenceLineControllable(R.id),j=C.activeViewportIds.find(ae=>ae===R.id);let Y=this.configuration.lineWidth??1.5;C.handles.activeOperation!==null&&C.handles.activeOperation===ov.DRAG&&j&&(Y=this.configuration.activeLineWidth??2.5);const de=`${O}`;if(F&&(M.length===2&&qt(o,v,de,M[0].point,M[1].point,{color:L,lineWidth:Y}),this.configuration.extendReferenceLines&&M.length===2&&this.configuration.extendReferenceLines&&M.length===2)){const ae=M.map(fe=>({...fe,distance:Bn(I[1],fe.point)})).sort((fe,we)=>fe.distance-we.distance);qt(o,v,de+"_dashed_before",I[1],ae[0].point,{color:L,lineWidth:Y,lineDash:[4,4]}),qt(o,v,de+"_dashed_after",ae[1].point,I[2],{color:L,lineWidth:Y,lineDash:[4,4]})}}),c=!0,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:I}=this.configuration,O=I?.xOffset||.95,M=I?.yOffset||.05,R=[w*O,m*M],A=I?.circleRadius||y*.01;hi(o,v,"0",R,A,{color:b,fill:b})}return c},this._getAnnotations=i=>{const{viewport:o}=i,a=$t(this.getToolName(),o.element)||[],s=this._getViewportsInfo().map(({viewportId:l})=>l);return a.filter(l=>{const{data:d}=l;return s.includes(d.viewportId)})},this._onSphereMoved=i=>{if(i.detail.originalClippingPlanes)this._syncWithVolumeCroppingTool(i.detail.originalClippingPlanes);else{if(i.detail.seriesInstanceUID!==this.seriesInstanceUID)return;const{draggingSphereIndex:o,toolCenter:a}=i.detail,s=[...this.toolCenterMin],c=[...this.toolCenterMax];if(o>=0&&o<=5){const l=Math.floor(o/2),d=o%2===0;(d?s:c)[l]=a[l],this.setToolCenter(s,"min"),this.setToolCenter(c,"max");return}if(o>=6&&o<=13){const l=o;l<10?s[0]=a[0]:c[0]=a[0],[6,7,10,11].includes(l)?s[1]=a[1]:c[1]=a[1],l%2===0?s[2]=a[2]:c[2]=a[2],this.setToolCenter(s,"min"),this.setToolCenter(c,"max")}}},this._onNewVolume=()=>{const i=this._getViewportsInfo();if(i&&i.length>0){const{viewportId:o,renderingEngineId:a}=i[0],c=Fn(a).getViewport(o),l=c.getActors();if(l.length>0){const d=l[0].actor.getMapper().getInputData();d&&(this.seriesInstanceUID=d.seriesInstanceUID,this._updateToolCentersFromViewport(c),($t(this.getToolName(),o)||[]).forEach(f=>{f.data&&f.data.handles&&(f.data.handles.toolCenter=[...this.toolCenter])}))}}this._computeToolCenter(i),Ye(Fe,V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,{toolGroupId:this.toolGroupId,viewportsInfo:i,seriesInstanceUID:this.seriesInstanceUID})},this._getAnnotationsForViewportsWithDifferentCameras=(i,o)=>{const{viewportId:a,renderingEngine:s,viewport:c}=i,l=o.filter(g=>g.data.viewportId!==a);if(!l||!l.length)return[];const d=c.getCamera(),{viewPlaneNormal:u,position:f}=d;return l.filter(g=>{const{viewportId:p}=g.data,w=s.getViewport(p).getCamera();return!(Et(w.viewPlaneNormal,u,.01)&&Et(w.position,f,1))})},this._filterViewportWithSameOrientation=(i,o,a)=>{const{renderingEngine:s}=i,{data:c}=o,l=s.getViewport(c.viewportId),d=a.filter(g=>{const{data:p}=g,v=s.getViewport(p.viewportId);return this._getReferenceLineControllable(v.id)===!0});if(!d||!d.length)return[];const u=l.getCamera(),f=u.viewPlaneNormal;return pt.normalize(f),d.filter(g=>{const{viewportId:p}=g.data,w=s.getViewport(p).getCamera(),m=w.viewPlaneNormal;return pt.normalize(m),Et(f,m,.01)&&Et(u.viewUp,w.viewUp,.01)})},this._activateModify=i=>{Ue.isInteractingWithTool=!this.configuration.mobile?.enabled,i.addEventListener(V.MOUSE_UP,this._endCallback),i.addEventListener(V.MOUSE_DRAG,this._dragCallback),i.addEventListener(V.MOUSE_CLICK,this._endCallback),i.addEventListener(V.TOUCH_END,this._endCallback),i.addEventListener(V.TOUCH_DRAG,this._dragCallback),i.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=i=>{Ue.isInteractingWithTool=!1,i.removeEventListener(V.MOUSE_UP,this._endCallback),i.removeEventListener(V.MOUSE_DRAG,this._dragCallback),i.removeEventListener(V.MOUSE_CLICK,this._endCallback),i.removeEventListener(V.TOUCH_END,this._endCallback),i.removeEventListener(V.TOUCH_DRAG,this._dragCallback),i.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._endCallback=i=>{const o=i.detail,{element:a}=o;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(a),Nt(a),this.editData=null;const c=vt(a,this.getToolName(),!1);Me(c)},this._dragCallback=i=>{const o=i.detail,a=o.deltaPoints.world;if(Math.abs(a[0])<.001&&Math.abs(a[1])<.001&&Math.abs(a[2])<.001)return;const{element:s}=o,c=Ce(s),{viewport:l}=c;if(l.type===Nn.VOLUME_3D)return;const d=this._getAnnotations(c),f=this.filterInteractableAnnotationsForElement(s,d)[0];if(!f)return;const{handles:h}=f.data;if(h.activeOperation===ov.DRAG){h.activeType==="min"?(this.toolCenterMin[0]+=a[0],this.toolCenterMin[1]+=a[1],this.toolCenterMin[2]+=a[2]):h.activeType==="max"?(this.toolCenterMax[0]+=a[0],this.toolCenterMax[1]+=a[1],this.toolCenterMax[2]+=a[2]):(this.toolCenter[0]+=a[0],this.toolCenter[1]+=a[1],this.toolCenter[2]+=a[2]);const g=this._getViewportsInfo();Me(g.map(({viewportId:p})=>p)),Ye(Fe,V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,{toolGroupId:this.toolGroupId,toolCenter:this.toolCenter,toolCenterMin:this.toolCenterMin,toolCenterMax:this.toolCenterMax,handleType:h.activeType,viewportOrientation:[],seriesInstanceUID:this.seriesInstanceUID})}},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||zue,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||jue;const n=Fr(this.toolGroupId)?.viewportsInfo;if(Fe.addEventListener(V.VOLUMECROPPING_TOOL_CHANGED,this._onSphereMoved),n&&n.length>0){const{viewportId:i,renderingEngineId:o}=n[0];Ln(i,o);const c=Fn(o).getViewport(i).getActors();if(!c||!c.length){console.warn(`VolumeCroppingControlTool: No volume actors found in viewport ${i}.`);return}const l=c[0].actor.getMapper().getInputData();if(l){const d=l.getDimensions(),u=l.getSpacing(),f=l.getOrigin();this.seriesInstanceUID=l.seriesInstanceUID||"unknown";const h=this.configuration.initialCropFactor??.2;this.toolCenter=[f[0]+h*(d[0]-1)*u[0],f[1]+h*(d[1]-1)*u[1],f[2]+h*(d[2]-1)*u[2]];const g=1-h;this.toolCenterMin=[f[0]+h*(d[0]-1)*u[0],f[1]+h*(d[1]-1)*u[1],f[2]+h*(d[2]-1)*u[2]],this.toolCenterMax=[f[0]+g*(d[0]-1)*u[0],f[1]+g*(d[1]-1)*u[1],f[2]+g*(d[2]-1)*u[2]]}}}_updateToolCentersFromViewport(e){const r=e.getActors();if(!r||!r.length)return;const n=r[0].actor.getMapper().getInputData();if(!n)return;this.seriesInstanceUID=n.seriesInstanceUID||"unknown";const i=n.getDimensions(),o=n.getSpacing(),a=n.getOrigin(),s=this.configuration.initialCropFactor??.2,c=s/2,l=1-s/2;this.toolCenter=[a[0]+(c+l)/2*(i[0]-1)*o[0],a[1]+(c+l)/2*(i[1]-1)*o[1],a[2]+(c+l)/2*(i[2]-1)*o[2]],this.toolCenterMin=[a[0]+c*(i[0]-1)*o[0],a[1]+c*(i[1]-1)*o[1],a[2]+c*(i[2]-1)*o[2]],this.toolCenterMax=[a[0]+l*(i[0]-1)*o[0],a[1]+l*(i[1]-1)*o[1],a[2]+l*(i[2]-1)*o[2]]}onSetToolInactive(){console.debug(`VolumeCroppingControlTool: onSetToolInactive called for tool ${this.getToolName()}`)}onSetToolActive(){const e=this._getViewportsInfo();let r=!1;for(const n of e){const i=Ln(n.viewportId,n.renderingEngineId),o=this._getAnnotations(i);if(o&&o.length>0){r=!0;break}}if(!r)this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e),Ye(Fe,V.VOLUMECROPPINGCONTROL_TOOL_CHANGED,{toolGroupId:this.toolGroupId,viewportsInfo:e,seriesInstanceUID:this.seriesInstanceUID});else for(const n of e){const i=Ln(n.viewportId,n.renderingEngineId);if(!i)continue;const o=this._getAnnotations(i);o&&o.length>0&&o.forEach(a=>{kt(a.annotationUID)}),i.viewport.render()}}onSetToolEnabled(){console.debug(`VolumeCroppingControlTool: onSetToolEnabled called for tool ${this.getToolName()}`),this._getViewportsInfo()}onSetToolDisabled(){console.debug(`VolumeCroppingControlTool: onSetToolDisabled called for tool ${this.getToolName()}`);const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:r,viewportId:n})=>{const i=Ln(n,r);if(!i)return;const o=this._getAnnotations(i);o?.length&&o.forEach(a=>{kt(a.annotationUID)})})}_getOrientationFromNormal(e){if(!e)return null;const r={AXIAL:[0,0,1],CORONAL:[0,1,0],SAGITTAL:[1,0,0]},n=.01;for(const[i,o]of Object.entries(r))if(Math.abs(e[0]-o[0])<n&&Math.abs(e[1]-o[1])<n&&Math.abs(e[2]-o[2])<n||Math.abs(e[0]+o[0])<n&&Math.abs(e[1]+o[1])<n&&Math.abs(e[2]+o[2])<n)return i;return null}_syncWithVolumeCroppingTool(e){const r=e;if(r.length>=6){this.toolCenterMin=[r[0].origin[0],r[2].origin[1],r[4].origin[2]],this.toolCenterMax=[r[1].origin[0],r[3].origin[1],r[5].origin[2]],this.toolCenter=[(this.toolCenterMin[0]+this.toolCenterMax[0])/2,(this.toolCenterMin[1]+this.toolCenterMax[1])/2,(this.toolCenterMin[2]+this.toolCenterMax[2])/2];const n=this._getViewportsInfo();n.forEach(({viewportId:i,renderingEngineId:o})=>{const a=Ln(i,o);a&&this._getAnnotations(a).forEach(c=>{if(c.data&&c.data.handles&&c.data.orientation){const l=c.data.orientation;l==="AXIAL"?(c.data.handles.toolCenterMin=[r[0].origin[0],r[2].origin[1],c.data.handles.toolCenterMin[2]],c.data.handles.toolCenterMax=[r[1].origin[0],r[3].origin[1],c.data.handles.toolCenterMax[2]]):l==="CORONAL"?(c.data.handles.toolCenterMin=[r[0].origin[0],c.data.handles.toolCenterMin[1],r[4].origin[2]],c.data.handles.toolCenterMax=[r[1].origin[0],c.data.handles.toolCenterMax[1],r[5].origin[2]]):l==="SAGITTAL"&&(c.data.handles.toolCenterMin=[c.data.handles.toolCenterMin[0],r[2].origin[1],r[4].origin[2]],c.data.handles.toolCenterMax=[c.data.handles.toolCenterMax[0],r[3].origin[1],r[5].origin[2]]),c.data.handles.toolCenter=[(c.data.handles.toolCenterMin[0]+c.data.handles.toolCenterMax[0])/2,(c.data.handles.toolCenterMin[1]+c.data.handles.toolCenterMax[1])/2,(c.data.handles.toolCenterMin[2]+c.data.handles.toolCenterMax[2])/2]}})}),this._virtualAnnotations&&this._virtualAnnotations.length>0&&this._virtualAnnotations.forEach(i=>{if(i.data&&i.data.handles&&i.data.orientation){const o=i.data.orientation.toUpperCase();o==="AXIAL"?(i.data.handles.toolCenterMin=[r[0].origin[0],r[2].origin[1],i.data.handles.toolCenterMin[2]],i.data.handles.toolCenterMax=[r[1].origin[0],r[3].origin[1],i.data.handles.toolCenterMax[2]]):o==="CORONAL"?(i.data.handles.toolCenterMin=[r[0].origin[0],i.data.handles.toolCenterMin[1],r[4].origin[2]],i.data.handles.toolCenterMax=[r[1].origin[0],i.data.handles.toolCenterMax[1],r[5].origin[2]]):o==="SAGITTAL"&&(i.data.handles.toolCenterMin=[i.data.handles.toolCenterMin[0],r[2].origin[1],r[4].origin[2]],i.data.handles.toolCenterMax=[i.data.handles.toolCenterMax[0],r[3].origin[1],r[5].origin[2]]),i.data.handles.toolCenter=[(i.data.handles.toolCenterMin[0]+i.data.handles.toolCenterMax[0])/2,(i.data.handles.toolCenterMin[1]+i.data.handles.toolCenterMax[1])/2,(i.data.handles.toolCenterMin[2]+i.data.handles.toolCenterMax[2])/2]}}),Me(n.map(({viewportId:i})=>i))}}setToolCenter(e,r){r==="min"?this.toolCenterMin=[...e]:r==="max"&&(this.toolCenterMax=[...e]);const n=this._getViewportsInfo();Me(n.map(({viewportId:i})=>i))}addNewAnnotation(e){const r=e.detail,{element:n}=r,i=Ce(n),{viewport:o}=i,a=this._getAnnotations(i),s=this.filterInteractableAnnotationsForElement(o.element,a);if(!s||s.length===0||!s[0])return null;const{data:c}=s[0],l=[],d=c.referenceLines||[];for(let u=0;u<d.length;++u){const f=d[u][0];this._getReferenceLineControllable(f.id)&&(l.push(f.id),u++)}return c.activeViewportIds=[...l],c.handles.activeOperation=ov.DRAG,e.preventDefault(),St(n),this._activateModify(n),s[0]}handleSelectedCallback(e,r,n,i){this.toolSelectedCallback(e,r,i)}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_applyDeltaShiftToSelectedViewportCameras(e,r,n){r.forEach(i=>{this._applyDeltaShiftToViewportCamera(e,i,n)})}_applyDeltaShiftToViewportCamera(e,r,n){const{data:i}=r,o=e.getViewport(i.viewportId),a=o.getCamera(),s=a.viewPlaneNormal,c=pt.dot(n,s),l=[...s];if(pt.multiplyScalar(l,c),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const d=[0,0,0],u=[0,0,0];pt.add(a.focalPoint,l,d),pt.add(a.position,l,u),o.setCamera({focalPoint:d,position:u}),o.render()}}_pointNearTool(e,r,n,i){const{data:o}=r,a=o.referenceLines,s=[];if(a)for(let c=0;c<a.length;++c){const l=a[c][0],d=a[c][1],u=a[c][2],f=a[c][3];yr(d,u,[n[0],n[1]])<=i&&(s.push(l.id),o.handles.activeOperation=1,o.handles.activeType=f)}return o.activeViewportIds=[...s],this.editData={annotation:r},o.handles.activeOperation===1}}dP.toolName="VolumeCroppingControl";const av=4,T_=1024,Hue="PT";let fP=class extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this._getImageDynamicRangeFromMiddleSlice=(n,i)=>{const o=Math.floor(i[2]/2),a=i[0]*i[1];let s,c;n instanceof Float32Array?(s=4,c=Float32Array):n instanceof Uint8Array?(s=1,c=Uint8Array):n instanceof Uint16Array?(s=2,c=Uint16Array):n instanceof Int16Array&&(s=2,c=Int16Array);const l=n.buffer,d=o*a*s,u=new c(l,d,a),{max:f,min:h}=this._getMinMax(u,a);return f-h}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){const{element:r,deltaPoints:n}=e.detail,i=Ce(r),{viewport:o}=i;let a,s,c,l,d,u,f=!1;const h=o.getProperties();if(o instanceof Gn){a=o.getVolumeId(),u=Ah(a),{lower:s,upper:c}=h.voiRange;const g=Ne.getVolume(a);if(!g)throw new Error("Volume not found "+a);l=g.metadata.Modality,f=g.scaling&&Object.keys(g.scaling).length>0}else if(h.voiRange){l=o.modality,{lower:s,upper:c}=h.voiRange;const{preScale:g={scaled:!1}}=o.getImageData?.()||{};f=g.scaled&&g.scalingParameters?.suvbw!==void 0}else throw new Error("Viewport is not a valid type");if(l===Hue&&f?d=this.getPTScaledNewRange({deltaPointsCanvas:n.canvas,lower:s,upper:c,clientHeight:r.clientHeight,isPreScaled:f,viewport:o,volumeId:a}):d=this.getNewRange({viewport:o,deltaPointsCanvas:n.canvas,volumeId:a,lower:s,upper:c}),!(d.lower>=d.upper)&&(o.setProperties({voiRange:d}),o.render(),o instanceof Gn)){u.forEach(g=>{o!==g&&g.render()});return}}getPTScaledNewRange({deltaPointsCanvas:e,lower:r,upper:n,clientHeight:i,viewport:o,volumeId:a,isPreScaled:s}){let c=av;s?c=5/i:c=this._getMultiplierFromDynamicRange(o,a)||av;const d=e[1]*c;return n-=d,n=s?Math.max(n,.1):n,{lower:r,upper:n}}getNewRange({viewport:e,deltaPointsCanvas:r,volumeId:n,lower:i,upper:o}){const a=this._getMultiplierFromDynamicRange(e,n)||av,s=r[0]*a,c=r[1]*a;let{windowWidth:l,windowCenter:d}=td(i,o);l+=s,d+=c,l=Math.max(l,1);const u=e.getProperties().VOILUTFunction;return tl(l,d,u)}_getMultiplierFromDynamicRange(e,r){let n;if(r){const o=Ne.getVolume(r),{voxelManager:a}=e.getImageData(),c=a.getMiddleSliceData().reduce((f,h)=>[Math.min(f[0],h),Math.max(f[1],h)],[1/0,-1/0]),l=o?.metadata?.BitsStored,d=l?2**l:1/0,u=c[1]-c[0];n=Number.isFinite(u)?Math.min(u,d):d}else n=this._getImageDynamicRangeFromViewport(e);const i=n/T_;return Number.isFinite(i)?i>1?Math.round(i):i:T_}_getImageDynamicRangeFromViewport(e){const{imageData:r,voxelManager:n}=e.getImageData();if(n?.getRange){const s=n.getRange();return s[1]-s[0]}const i=r.getDimensions();if(r.getRange){const s=r.getRange();return s[1]-s[0]}let o;if(r.getScalarData?o=r.getScalarData():o=r.getPointData().getScalars().getData(),i[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(o,i);let a;if(o.getRange)a=o.getRange();else{const{min:s,max:c}=this._getMinMax(o,o.length);a=[s,c]}return a[1]-a[0]}_getMinMax(e,r){let n=1/0,i=-1/0;for(let o=0;o<r;o++){const a=e[o];a<n&&(n=a),a>i&&(i=a)}return{max:i,min:n}}};fP.toolName="WindowLevel";class hP extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const d=l.getCamera(),{viewPlaneNormal:u,viewUp:f}=d,h=this.getReferencedImageId(l,s,u,f),g=l.getFrameOfReferenceUID(),p={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...f],FrameOfReferenceUID:g,referencedImageId:h},data:{handles:{points:[[...s],[...s],[...s],[...s]]},cachedStats:{}}};Ft(p,a);const v=vt(a,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v},this._activateDraw(a),St(a),n.preventDefault(),Me(v),p},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData;this._deactivateDraw(o),Nt(o),this.editData=null,this.isDrawing=!1,kt(a.annotationUID),Me(s),xn(a),this.applyWindowLevelRegion(a,o)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData,{data:c}=a,{currentPoints:l}=i,d=Ce(o),{worldToCanvas:u,canvasToWorld:f}=d.viewport,h=l.world,{points:g}=c.handles,p=3;g[p]=[...h];const v=u(g[0]),w=u(g[3]),m=[w[0],v[1]],y=[v[0],w[1]],C=f(m),x=f(y);g[1]=C,g[2]=x,a.invalidated=!0,Me(s)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const u=c[d],{annotationUID:f,data:h}=u,{points:g}=h.handles,p=g.map(x=>a.worldToCanvas(x));l.annotationUID=f;const{color:v,lineWidth:w,lineDash:m}=this.getAnnotationStyle({annotation:u,styleSpecifier:l});if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const y=`${f}-rect`;zh(i,f,"0",p[0],p[3],{color:v,lineDash:m,lineWidth:w},y),o=!0}return o},this.applyWindowLevelRegion=(n,i)=>{const o=Ce(i),{viewport:a}=o,s=qO(a),{data:c}=n,{points:l}=c.handles,d=l.map(T=>a.worldToCanvas(T)),u=d[0],f=d[3];let h=Math.min(u[0],f[0]),g=Math.min(u[1],f[1]),p=Math.abs(u[0]-f[0]),v=Math.abs(u[1]-f[1]);h=Jp(h,0,s.width),g=Jp(g,0,s.height),p=Math.floor(Math.min(p,Math.abs(s.width-h))),v=Math.floor(Math.min(v,Math.abs(s.height-g)));const w=XO(s,Math.round(h),Math.round(g),p,v),m=KO(w,s.minPixelValue,s.maxPixelValue);this.configuration.minWindowWidth===void 0&&(this.configuration.minWindowWidth=10);const y=Math.max(Math.abs(m.max-m.min),this.configuration.minWindowWidth),C=m.mean,x=a.getProperties().VOILUTFunction,S=tl(y,C,x);a.setProperties({voiRange:S}),a.render()},this.cancel=()=>null,this.isPointNearTool=()=>null,this.toolSelectedCallback=()=>null,this.handleSelectedCallback=()=>null,this._activateModify=()=>null,this._deactivateModify=()=>null}}hP.toolName="WindowLevelRegion";let gP=class extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,r),this.deltaY=1}mouseWheelCallback(e){this._scroll(e)}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){this._scrollDrag(e)}_scrollDrag(e){const{deltaPoints:r,viewportId:n,renderingEngineId:i}=e.detail,{viewport:o}=Ln(n,i),{debounceIfNotLoaded:a,invert:s,loop:c}=this.configuration,l=r.canvas[1];let d;o instanceof Gn&&(d=o.getVolumeId());const u=this._getPixelPerImage(o),f=l+this.deltaY;if(u)if(Math.abs(f)>=u){const h=Math.round(f/u);Ou(o,{delta:s?-h:h,volumeId:d,debounceLoading:a,loop:c}),this.deltaY=f%u}else this.deltaY=f}_scroll(e){const{wheel:r,element:n}=e.detail,{direction:i}=r,{invert:o}=this.configuration,{viewport:a}=Ce(n),s=i*(o?-1:1);Ou(a,{delta:s,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:a instanceof Zn?a.getVolumeId():void 0,scrollSlabs:this.configuration.scrollSlabs})}_getPixelPerImage(e){const{element:r}=e,n=e.getNumberOfSlices();return Math.max(2,r.offsetHeight/Math.max(n,8))}};gP.toolName="StackScroll";class pP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.mouseWheelCallback=n=>{const{element:i,wheel:o}=n.detail,a=Ce(i),{viewport:s}=a,{invert:c}=this.configuration,l=o.direction*10*(c?-1:1);this.setAngle(s,l)},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:r,currentPoints:n,startPoints:i}=e.detail,o=n.world,a=i.world,s=Ce(r),{viewport:c}=s,l=c.getCamera(),d=r.clientWidth,u=r.clientHeight,f=[d*.5,u*.5],h=c.canvasToWorld(f);let g=D0([a,h],[h,o]);const{viewPlaneNormal:p}=l,v=rn(Ie(),h,a),w=rn(Ie(),h,o),m=tn(Ie(),v,w);ft(p,m)>0&&(g=-g),!Number.isNaN(g)&&this.setAngle(c,g)}setAngle(e,r){const{viewPlaneNormal:n,viewUp:i}=e.getCamera();if(e instanceof Zn){const o=(r+360)%360*Math.PI/180,a=It(new Float32Array(16));Zr(a,a,o,n);const s=Vt(Ie(),i,a);e.setCamera({viewUp:s})}else{const{rotation:o}=e.getViewPresentation();e.setViewPresentation({rotation:(o+r+360)%360})}e.render()}}pP.toolName="PlanarRotate";let mP=class extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,r),this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=a.world,l=Ce(o).viewport.getCamera(),{focalPoint:d}=l;this.initialMousePosWorld=s;let u=mt(d[0]-s[0],d[1]-s[1],d[2]-s[2]);return u=Lt(Ie(),u),this.dirVec=u,!1},this.preTouchStartCallback=n=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(n)},this._dragParallelProjection=(n,i,o,a=!1)=>{const{element:s,deltaPoints:c}=n.detail,l=a?n.detail.deltaDistance.canvas:c.canvas[1],d=[s.clientWidth,s.clientHeight],{parallelScale:u,focalPoint:f,position:h}=o,g=5/d[1],p=l*g*(this.configuration.invert?-1:1),v=(1-p)*u;let w=f,m=h;if(!this.configuration.zoomToCenter){const T=Dr(f,this.initialMousePosWorld);m=en(Ie(),h,this.dirVec,-T*p),w=en(Ie(),f,this.dirVec,-T*p)}const y=i.getImageData();let C=[1,1,1],x=v,S=!1;if(y){C=y.spacing;const{dimensions:T}=y,_=T[0]*C[0],E=T[1]*C[1],D=d[0]/d[1],b=Qa().rendering?.useLegacyCameraFOV?1.1:1,I=i.options?.displayArea,O=I?.imageArea?.[0]??b,M=I?.imageArea?.[1]??b,R=_*O,A=E*M,G=R/A;let k;G>D?k=R/D*.5:k=A*.5;const{minZoomScale:L,maxZoomScale:F}=this.configuration,j=k/F,Y=k/L;v<j?(x=j,S=!0):v>Y&&(x=Y,S=!0)}i.setCamera({parallelScale:x,focalPoint:S?f:w,position:S?h:m})},this._dragPerspectiveProjection=(n,i,o,a=!1)=>{const{element:s,deltaPoints:c}=n.detail,l=a?n.detail.deltaDistance.canvas:c.canvas[1],d=[s.clientWidth,s.clientHeight],{position:u,focalPoint:f,viewPlaneNormal:h}=o,g=pt.distance2BetweenPoints(u,f),p=Math.sqrt(g)/d[1],v=[-h[0],-h[1],-h[2]],w=this.configuration.invert?l/p:l*p;let m=w*v[0];u[0]+=m,f[0]+=m,m=w*v[1],u[1]+=m,f[1]+=m,m=w*v[2],u[2]+=m,f[2]+=m,i.setCamera({position:u,focalPoint:f})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}mouseWheelCallback(e){this._zoom(e)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:n,currentPoints:i}=e.detail,o=Ce(n),{viewport:a}=o,s=a.getCamera(),c=i.world,{focalPoint:l}=s;this.initialMousePosWorld=c;let d=mt(l[0]-c[0],l[1]-c[1],l[2]-c[2]);d=Lt(Ie(),d),this.dirVec=d,s.parallelProjection?this._dragParallelProjection(e,a,s,!0):this._dragPerspectiveProjection(e,a,s,!0),a.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:r}=e.detail,n=Ce(r),{viewport:i}=n,o=i.getCamera();o.parallelProjection?this._dragParallelProjection(e,i,o):this._dragPerspectiveProjection(e,i,o),i.render()}_zoom(e){const{element:r,points:n}=e.detail,i=Ce(r),{viewport:o}=i;o.getCamera();const s=e.detail.wheel.direction,c={detail:{element:r,eventName:V.MOUSE_WHEEL,renderingEngineId:i.renderingEngineId,viewportId:o.id,camera:{},deltaPoints:{page:n.page,client:n.client,world:n.world,canvas:[0,-s*5]},startPoints:n,lastPoints:n,currentPoints:n}};o.type===Nn.STACK&&this.preMouseDownCallback(c),this._dragCallback(c)}_panCallback(e){const{element:r,deltaPoints:n}=e.detail,i=Ce(r),o=n.world,a=i.viewport.getCamera(),{focalPoint:s,position:c}=a,l=[c[0]-o[0],c[1]-o[1],c[2]-o[2]],d=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];i.viewport.setCamera({focalPoint:d,position:l}),i.viewport.render()}};mP.toolName="Zoom";class vP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}){super(e,r)}mouseClickCallback(e){const{element:r,currentPoints:n}=e.detail,i=Ce(r),{viewport:o,renderingEngine:a}=i,s=o.getVolumeId();if(!s)throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");let c=-1/0;const l=(g,p)=>{if(g>c)return c=g,p},d=NC(o,n.world,s,l);if(!d||!d.length)return;const{targetViewportIds:u,toolGroupId:f}=this.configuration;a.getViewports().filter(g=>{if(u?.indexOf(g.id)>=0)return!0;const p=Qn(g.id,a.id);return!!(f&&f===p?.id)}).forEach(g=>{g instanceof Gn?g.jumpToWorld(d):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")})}}vP.toolName="MIPJumpToClickTool";const{RENDERING_DEFAULTS:sv}=pl;function Xue(){return"rgb(0, 200, 0)"}function Kue(){return!0}function que(){return!0}function Yue(){return!0}const na={DRAG:1,ROTATE:2,SLAB:3};class yP extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},handleRadius:3,enableHDPIHandles:!1,referenceLinesCenterGapRadius:20,referenceLinesCenterGapRatio:null,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:Ka.MAXIMUM_INTENSITY_BLEND,centerPoint:{enabled:!1,color:"rgba(255, 255, 0, 0.5)",size:2},mobile:{enabled:!1,opacity:.8,handleRadius:9,referenceLinesCenterGapRatio:.05}}}){super(e,r),this.toolCenter=[0,0,0],this.initializeViewport=({renderingEngineId:n,viewportId:i})=>{const o=Ln(i,n);if(!o)return;const{FrameOfReferenceUID:a,viewport:s}=o,{element:c}=s,{position:l,focalPoint:d,viewPlaneNormal:u}=s.getCamera();let f=this._getAnnotations(o);f=this.filterInteractableAnnotationsForElement(c,f),f?.length&&kt(f[0].annotationUID);const h={highlighted:!1,metadata:{cameraPosition:[...l],cameraFocalPoint:[...d],FrameOfReferenceUID:a,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:i}};return Ft(h,c),{normal:u,point:s.canvasToWorld([s.canvas.clientWidth/2,s.canvas.clientHeight/2])}},this._getViewportsInfo=()=>Fr(this.toolGroupId).viewportsInfo,this.resetCrosshairs=()=>{const n=this._getViewportsInfo();for(const i of n){const{viewportId:o,renderingEngineId:a}=i,s=Ln(o,a),c=s.viewport;c.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!0,suppressEvents:!0}),c.resetSlabThickness();const{element:g}=c;let p=this._getAnnotations(s);p=this.filterInteractableAnnotationsForElement(g,p),p.length&&kt(p[0].annotationUID),c.render()}this._computeToolCenter(n)},this.computeToolCenter=()=>{const n=this._getViewportsInfo();this._computeToolCenter(n)},this._computeToolCenter=n=>{if(!n.length||n.length===1){console.warn("For crosshairs to operate, at least two viewports must be given.");return}const[i,o,a]=n,{normal:s,point:c}=this.initializeViewport(i),{normal:l,point:d}=this.initializeViewport(o);let u=[0,0,0],f=Ie();a?{normal:u,point:f}=this.initializeViewport(a):(hr(f,c,d),xr(f,f,.5),tn(u,s,l));const h=Ya(s,c),g=Ya(l,d),p=Ya(u,f),v=gD(h,g,p);this.setToolCenter(v)},this.addNewAnnotation=n=>{const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.world,c=Ce(o),{viewport:l}=c;this._jump(c,s);const d=this._getAnnotations(c),u=this.filterInteractableAnnotationsForElement(l.element,d),{data:f}=u[0],{rotationPoints:h}=f.handles,g=[];for(let p=0;p<h.length-1;++p){const v=h[p][1],w=this._getReferenceLineControllable(v.id),m=this._getReferenceLineDraggableRotatable(v.id);!w||!m||(g.push(v.id),p++)}return f.activeViewportIds=[...g],f.handles.activeOperation=na.DRAG,n.preventDefault(),St(o),this._activateModify(o),u[0]},this.cancel=()=>{console.log("Not implemented yet")},this.handleSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0,this._activateModify(a),St(a),n.preventDefault()},this.isPointNearTool=(n,i,o,a)=>!!this._pointNearTool(n,i,o,6),this.toolSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a;i.highlighted=!0,this._activateModify(s),St(s),n.preventDefault()},this.onCameraModified=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{renderingEngine:s}=a,c=a.viewport,l=this._getAnnotations(a),u=this.filterInteractableAnnotationsForElement(o,l)[0];if(!u)return;const f=c.getCamera(),h=u.metadata.cameraPosition,g=[0,0,0];pt.subtract(f.position,h,g);const p=u.metadata.cameraFocalPoint,v=[0,0,0];pt.subtract(f.focalPoint,p,v),u.metadata.cameraPosition=[...f.position],u.metadata.cameraFocalPoint=[...f.focalPoint];const w=this._getReferenceLineControllable(c.id),m=this._getReferenceLineDraggableRotatable(c.id);if(!Et(f.position,h,.001)&&w&&m){let x=!1;Et(g,v,.001)||(x=!0);const T=Math.abs(pt.dot(g,f.viewPlaneNormal))<.01;!x&&!T&&(this.toolCenter[0]+=g[0],this.toolCenter[1]+=g[1],this.toolCenter[2]+=g[2],Ye(Fe,V.CROSSHAIR_TOOL_CENTER_CHANGED,{toolGroupId:this.toolGroupId,toolCenter:this.toolCenter}))}this.configuration.autoPan?.enabled&&Qn(c.id,s.id).getViewportIds().filter(T=>T!==c.id).forEach(T=>{this._autoPanViewportIfNecessary(T,s)});const C=vt(o,this.getToolName(),!1);Me(C)},this.onResetCamera=n=>{this.resetCrosshairs()},this.mouseMoveCallback=(n,i)=>{const{element:o,currentPoints:a}=n.detail,s=a.canvas;let c=!1;for(let l=0;l<i.length;l++){const d=i[l];if(ir(d.annotationUID))continue;const{data:u,highlighted:f}=d;if(!u.handles)continue;const h=u.handles.activeOperation,g=u.activeViewportIds&&u.activeViewportIds.length>0?[...u.activeViewportIds]:[];u.activeViewportIds=[],u.handles.activeOperation=null;const p=this.getHandleNearImagePoint(o,d,s,6);let v=!1;p?v=!0:v=this._pointNearTool(o,d,s,6),v&&!f||!v&&f?(d.highlighted=!f,c=!0):(u.handles.activeOperation!==h||!this._areViewportIdArraysEqual(u.activeViewportIds,g))&&(c=!0)}return c},this.filterInteractableAnnotationsForElement=(n,i)=>{if(!i||!i.length)return[];const o=Ce(n),{viewportId:a}=o;return i.filter(c=>c.data.viewportId===a)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a,renderingEngine:s}=n,{element:c}=a,l=this._getAnnotations(n),d=a.getCamera(),f=this.filterInteractableAnnotationsForElement(c,l)[0];if(!l?.length||!f?.data)return o;const h=f.annotationUID,{clientWidth:g,clientHeight:p}=a.canvas,v=Math.sqrt(g*g+p*p),w=Math.min(g,p),m=f.data,y=a.worldToCanvas(this.toolCenter),C=this._filterAnnotationsByUniqueViewportOrientations(n,l),x=[],S=[0,0,g,p];C.forEach(b=>{const{data:I}=b;I.handles.toolCenter=this.toolCenter;const O=s.getViewport(I.viewportId),M=O.getCamera(),R=this._getReferenceLineControllable(O.id),A=this._getReferenceLineDraggableRotatable(O.id),G=this._getReferenceLineSlabThicknessControlsOn(O.id),{clientWidth:k,clientHeight:L}=O.canvas,F=Math.sqrt(k*k+L*L),j=[k*.5,L*.5],Y=O.canvasToWorld(j),ie=[0,0,0];pt.cross(d.viewPlaneNormal,M.viewPlaneNormal,ie),pt.normalize(ie),pt.multiplyScalar(ie,F);const de=[0,0,0];pt.add(Y,ie,de);const ae=[0,0,0];pt.subtract(Y,ie,ae);const fe=a.worldToCanvas(de),we=a.worldToCanvas(Y),_e=xt();En(_e,fe,we),za(_e,_e);const Se=xt();Ga(Se,_e,v*100);const B=xt();Ga(B,_e,w*.4);const P=xt();Ga(P,_e,w*.2);const $=xt(),W=this.configuration.mobile,{referenceLinesCenterGapRatio:K}=W?.enabled?W:this.configuration,Q=K>0?w*K:this.configuration.referenceLinesCenterGapRadius;Ga($,_e,C.length===2?Q:0);const ee=xt(),ge=xt(),De=xt(),Le=xt();let Ge=da(y);(!A||!R)&&(Ge=da(we)),zr(ee,Ge,$),zr(ge,Ge,Se),En(De,Ge,$),En(Le,Ge,Se),mu(ee,ge,S),mu(De,Le,S);const re=xt();En(re,y,B);const se=xt();zr(se,y,B);let ve=da(y);!A&&G&&(ve=da(we));let le=[...this.toolCenter];!A&&G&&(le=[...Y]);const pe=[0,0,0];pt.subtract(de,ae,pe),pt.normalize(pe);const{viewPlaneNormal:We}=d,{matrix:oe}=Qr.buildFromDegree().rotate(90,We),st=[0,0,0];Vt(st,pe,oe);const gt=O.getSlabThickness(),ct=[...st];pt.multiplyScalar(ct,gt);const Ee=[0,0,0];pt.add(le,ct,Ee);const ze=a.worldToCanvas(Ee),Ke=xt();En(Ke,ve,ze);const Je=xt();En(Je,ve,Se),zr(Je,Je,Ke);const lt=xt();zr(lt,ve,Se),zr(lt,lt,Ke),mu(Je,lt,S);const Oe=xt();zr(Oe,ve,Se),En(Oe,Oe,Ke);const ke=xt();En(ke,ve,Se),En(ke,ke,Ke),mu(Oe,ke,S);const nt=xt(),wt=xt(),gn=xt(),Sn=xt();En(nt,ve,P),zr(nt,nt,Ke),zr(wt,ve,P),zr(wt,wt,Ke),En(gn,ve,P),En(gn,gn,Ke),zr(Sn,ve,P),En(Sn,Sn,Ke),x.push([O,ee,ge,De,Le,Je,lt,Oe,ke,re,se,nt,wt,gn,Sn])});const T=[],_=[],E=this._getReferenceLineColor(a.id),D=E!==void 0?E:"rgb(200, 200, 200)";if(x.forEach((b,I)=>{const O=b[0],M=this._getReferenceLineColor(O.id),R=this._getReferenceLineControllable(O.id),A=this._getReferenceLineDraggableRotatable(O.id)||this.configuration.mobile?.enabled,G=this._getReferenceLineSlabThicknessControlsOn(O.id)||this.configuration.mobile?.enabled,k=m.activeViewportIds.find(ie=>ie===O.id);let L=M!==void 0?M:"rgb(200, 200, 200)",F=1;const j=m.handles.activeOperation!==null&&m.handles.activeOperation===na.DRAG&&k;j&&(F=2.5);let Y=`${I}`;if(R&&A?(Y=`${I}One`,qt(i,h,Y,b[1],b[2],{color:L,lineWidth:F}),Y=`${I}Two`,qt(i,h,Y,b[3],b[4],{color:L,lineWidth:F})):qt(i,h,Y,b[2],b[4],{color:L,lineWidth:F}),R){L=M!==void 0?M:"rgb(200, 200, 200)";const ie=m.handles.activeOperation===na.ROTATE,de=[b[9],b[10]],ae=[a.canvasToWorld(b[9]),O,b[1],b[2]],fe=[a.canvasToWorld(b[10]),O,b[3],b[4]];T.push(ae,fe);const we=m.handles.activeOperation===na.SLAB,_e=[b[11],b[12],b[13],b[14]],Se=[a.canvasToWorld(b[11]),O,b[5],b[6]],B=[a.canvasToWorld(b[12]),O,b[5],b[6]],P=[a.canvasToWorld(b[13]),O,b[7],b[8]],$=[a.canvasToWorld(b[14]),O,b[7],b[8]];_.push(Se,B,P,$);let W=this.configuration.handleRadius*(this.configuration.enableHDPIHandles?window.devicePixelRatio:1),K=1;if(this.configuration.mobile?.enabled&&(W=this.configuration.mobile.handleRadius,K=this.configuration.mobile.opacity),(j||this.configuration.mobile?.enabled)&&!ie&&!we&&A&&G){let ee=`${I}One`;kn(i,h,ee,de,{color:L,handleRadius:W,opacity:K,type:"circle"}),ee=`${I}Two`,kn(i,h,ee,_e,{color:L,handleRadius:W,opacity:K,type:"rect"})}else if(j&&!ie&&!we&&A){const ee=`${I}`;kn(i,h,ee,de,{color:L,handleRadius:W,opacity:K,type:"circle"})}else if(k&&!ie&&!we&&G){const ee=`${I}`;kn(i,h,ee,_e,{color:L,handleRadius:W,opacity:K,type:"rect"})}else if(ie&&A){const ee=`${I}`,ge=this.configuration.handleRadius*(this.configuration.enableHDPIHandles?window.devicePixelRatio:1);kn(i,h,ee,de,{color:L,handleRadius:ge,fill:L,type:"circle"})}else if(we&&k&&G){const ee=this.configuration.handleRadius*(this.configuration.enableHDPIHandles?window.devicePixelRatio:1);kn(i,h,Y,_e,{color:L,handleRadius:ee,fill:L,type:"rect"})}O.getSlabThickness()>.5&&G&&(Y=`${I}STOne`,qt(i,h,Y,b[5],b[6],{color:L,width:1,lineDash:[2,3]}),Y=`${I}STTwo`,qt(i,h,Y,b[7],b[8],{color:L,width:b,lineDash:[2,3]}))}}),o=!0,m.handles.rotationPoints=T,m.handles.slabThicknessPoints=_,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:b}=this.configuration,I=b?.xOffset||.95,O=b?.yOffset||.05,M=[g*I,p*O],R=b?.circleRadius||v*.01;hi(i,h,"0",M,R,{color:D,fill:D})}if(this.configuration.centerPoint?.enabled){const M=this.configuration.centerPoint.color||"rgba(255, 255, 0, 0.5)",R=Math.min(this.configuration.centerPoint.size||2,5);hi(i,h,"centerPoint",y,R,{color:M,fill:M})}return o},this._getAnnotations=n=>{const{viewport:i}=n,o=$t(this.getToolName(),i.element)||[],a=this._getViewportsInfo().map(({viewportId:c})=>c);return o.filter(c=>{const{data:l}=c;return a.includes(l.viewportId)})},this._onNewVolume=()=>{const n=this._getViewportsInfo();this._computeToolCenter(n)},this._areViewportIdArraysEqual=(n,i)=>n.length!==i.length?!1:(n.forEach(o=>{let a=!1;for(let s=0;s<i.length;++s)if(o===i[s]){a=!0;break}if(a===!1)return!1}),!0),this._getAnnotationsForViewportsWithDifferentCameras=(n,i)=>{const{viewportId:o,renderingEngine:a,viewport:s}=n,c=i.filter(h=>h.data.viewportId!==o);if(!c||!c.length)return[];const l=s.getCamera(),{viewPlaneNormal:d,position:u}=l;return c.filter(h=>{const{viewportId:g}=h.data,v=a.getViewport(g).getCamera();return!(Et(v.viewPlaneNormal,d,.01)&&Et(v.position,u,1))})},this._filterViewportWithSameOrientation=(n,i,o)=>{const{renderingEngine:a}=n,{data:s}=i,c=a.getViewport(s.viewportId),l=o.filter(h=>{const{data:g}=h,p=a.getViewport(g.viewportId);return this._getReferenceLineControllable(p.id)===!0});if(!l||!l.length)return[];const d=c.getCamera(),u=d.viewPlaneNormal;return pt.normalize(u),l.filter(h=>{const{viewportId:g}=h.data,v=a.getViewport(g).getCamera(),w=v.viewPlaneNormal;return pt.normalize(w),Et(u,w,.01)&&Et(d.viewUp,v.viewUp,.01)})},this._filterAnnotationsByUniqueViewportOrientations=(n,i)=>{const{renderingEngine:o,viewport:a}=n,c=a.getCamera().viewPlaneNormal;pt.normalize(c);const l=i.filter(h=>{const{data:g}=h,p=o.getViewport(g.viewportId),v=this._getReferenceLineControllable(p.id);return a!==p&&v===!0}),d=[];for(let h=0;h<l.length;++h){const g=l[h],{viewportId:p}=g.data,w=o.getViewport(p).getCamera(),m=w.viewPlaneNormal;if(pt.normalize(m),Et(c,m,.01)||of(c,m,.01))continue;let y=!1;for(let C=0;C<d.length;++C){const x=d[C],{viewportId:S}=x.data,_=o.getViewport(S).getCamera();Et(_.viewPlaneNormal,w.viewPlaneNormal,.01)&&Et(_.position,w.position,1)&&(y=!0)}y||d.push(g)}const u=i.filter(h=>{const{data:g}=h,p=o.getViewport(g.viewportId),v=this._getReferenceLineControllable(p.id);return a!==p&&v!==!0});for(let h=0;h<u.length;++h){const g=u[h],{viewportId:p}=g.data,w=o.getViewport(p).getCamera(),m=w.viewPlaneNormal;if(pt.normalize(m),Et(c,m,.01)||of(c,m,.01))continue;let y=!1;for(let C=0;C<d.length;++C){const x=d[C],{viewportId:S}=x.data,_=o.getViewport(S).getCamera();Et(_.viewPlaneNormal,w.viewPlaneNormal,.01)&&Et(_.position,w.position,1)&&(y=!0)}y||d.push(g)}const f=this._getAnnotationsForViewportsWithDifferentCameras(n,i);for(let h=0;h<f.length;++h){const g=f[h];if(d.some(C=>C===g))continue;const{viewportId:p}=g.data,w=o.getViewport(p).getCamera(),m=w.viewPlaneNormal;if(pt.normalize(m),Et(c,m,.01)||of(c,m,.01))continue;let y=!1;for(let C=0;C<d.length;++C){const x=d[C],{viewportId:S}=x.data,_=o.getViewport(S).getCamera();Et(_.viewPlaneNormal,w.viewPlaneNormal,.01)&&Et(_.position,w.position,1)&&(y=!0)}y||d.push(g)}return d},this._checkIfViewportsRenderingSameScene=(n,i)=>{const o=n.getAllVolumeIds(),a=i.getAllVolumeIds();return o.length===a.length&&o.every(s=>a.includes(s))},this._jump=(n,i)=>{Ue.isInteractingWithTool=!0;const{viewport:o,renderingEngine:a}=n,s=this._getAnnotations(n),c=[0,0,0];pt.subtract(i,this.toolCenter,c);const d=this._getAnnotationsForViewportsWithDifferentCameras(n,s).filter(u=>{const{data:f}=u,h=a.getViewport(f.viewportId),g=this._checkIfViewportsRenderingSameScene(o,h);return this._getReferenceLineControllable(h.id)&&this._getReferenceLineDraggableRotatable(h.id)&&g});return d.length===0?(Ue.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(a,d,c),Ue.isInteractingWithTool=!1,!0)},this._activateModify=n=>{Ue.isInteractingWithTool=!this.configuration.mobile?.enabled,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._endCallback=n=>{const i=n.detail,{element:o}=i;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(o),Nt(o),this.editData=null;const s=vt(o,this.getToolName(),!1);Me(s)},this._dragCallback=n=>{const i=n.detail,o=i.deltaPoints.world;if(Math.abs(o[0])<.001&&Math.abs(o[1])<.001&&Math.abs(o[2])<.001)return;const{element:a}=i,s=Ce(a),{renderingEngine:c,viewport:l}=s,d=this._getAnnotations(s),f=this.filterInteractableAnnotationsForElement(a,d)[0];if(!f)return;const{handles:h}=f.data,{currentPoints:g}=n.detail,p=g.canvas;if(h.activeOperation===na.DRAG){const w=this._getAnnotationsForViewportsWithDifferentCameras(s,d).filter(m=>{const{data:y}=m,C=c.getViewport(y.viewportId),x=this._getReferenceLineControllable(C.id),S=this._getReferenceLineDraggableRotatable(C.id);return x===!0&&S===!0&&f.data.activeViewportIds.find(T=>T===C.id)});this._applyDeltaShiftToSelectedViewportCameras(c,w,o)}else if(h.activeOperation===na.ROTATE){const w=this._getAnnotationsForViewportsWithDifferentCameras(s,d).filter(I=>{const{data:O}=I,M=c.getViewport(O.viewportId),R=this._getReferenceLineControllable(M.id),A=this._getReferenceLineDraggableRotatable(M.id);return R===!0&&A===!0}),m=xt(),y=xt(),C=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],x=l.worldToCanvas(C),S=i.currentPoints.canvas,T=xt();mo(T,S,i.deltaPoints.canvas),mo(m,T,x),mo(y,S,x);let _=_V(m,y);this._isClockWise(x,T,S)&&(_*=-1),_=Math.round(_*100)/100;const E=l.getCamera().viewPlaneNormal,{matrix:D}=Qr.buildFromRadian().translate(C[0],C[1],C[2]).rotate(_,E).translate(-C[0],-C[1],-C[2]),b=[];w.forEach(I=>{const{data:O}=I;O.handles.toolCenter=C;const M=c.getViewport(O.viewportId),R=M.getCamera(),{viewUp:A,position:G,focalPoint:k}=R;A[0]+=G[0],A[1]+=G[1],A[2]+=G[2],Vt(k,k,D),Vt(G,G,D),Vt(A,A,D),A[0]-=G[0],A[1]-=G[1],A[2]-=G[2],M.setCamera({position:G,viewUp:A,focalPoint:k}),b.push(M.id)}),c.renderViewports(b)}else if(h.activeOperation===na.SLAB){const w=this._getAnnotationsForViewportsWithDifferentCameras(s,d).filter(C=>{const{data:x}=C,S=c.getViewport(x.viewportId),T=this._getReferenceLineControllable(S.id),_=this._getReferenceLineSlabThicknessControlsOn(S.id);return T===!0&&_===!0&&f.data.activeViewportIds.find(E=>E===S.id)});if(w.length===0)return;const m=this._filterViewportWithSameOrientation(s,w[0],d),y=[];y.push(l.id),m.forEach(C=>{const{data:x}=C,S=c.getViewport(x.viewportId),_=S.getCamera().viewPlaneNormal,E=pt.dot(o,_),D=[..._];if(pt.multiplyScalar(D,E),Math.abs(D[0])>.001||Math.abs(D[1])>.001||Math.abs(D[2])>.001){const b=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]),I=i.lastPoints.world,O=[0,0,0],M=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(S.id)){const{rotationPoints:de}=this.editData.annotation.data.handles,ae=de.filter(fe=>fe[1].uid===S.id);if(ae.length===2){const fe=l.canvasToWorld(ae[0][3]),we=l.canvasToWorld(ae[1][3]);pt.add(fe,we,M),pt.multiplyScalar(M,.5)}}pt.subtract(I,M,O);const A=pt.dot(O,_),G=[..._];pt.multiplyScalar(G,A);const k=[G[0],G[1],G[2]];Lt(k,k);const L=[D[0],D[1],D[2]];Lt(L,L);let F=S.getSlabThickness();of(k,L,.001)?F-=b:F+=b,F=Math.abs(F),F=Math.max(sv.MINIMUM_SLAB_THICKNESS,F),this._pointNearReferenceLine(f,p,6,S)&&(F=sv.MINIMUM_SLAB_THICKNESS),Qn(S.id,c.id).getToolInstance(this.getToolName()).setSlabThickness(S,F),y.push(S.id)}}),c.renderViewports(y)}},this._pointNearReferenceLine=(n,i,o,a)=>{const{data:s}=n,{rotationPoints:c}=s.handles;for(let l=0;l<c.length-1;++l){const d=c[l][1];if(d.id!==a.id||!this._getReferenceLineControllable(d.id))continue;const f={start:{x:c[l][2][0],y:c[l][2][1]},end:{x:c[l][3][0],y:c[l][3][1]}},h=yr([f.start.x,f.start.y],[f.end.x,f.end.y],[i[0],i[1]]),g={start:{x:c[l+1][2][0],y:c[l+1][2][1]},end:{x:c[l+1][3][0],y:c[l+1][3][1]}},p=yr([g.start.x,g.start.y],[g.end.x,g.end.y],[i[0],i[1]]);if(h<=o||p<=o)return!0;l++}return!1},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||Xue,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||Kue,this._getReferenceLineDraggableRotatable=e.configuration?.getReferenceLineDraggableRotatable||que,this._getReferenceLineSlabThicknessControlsOn=e.configuration?.getReferenceLineSlabThicknessControlsOn||Yue}onSetToolActive(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e)}onSetToolPassive(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolEnabled(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolDisabled(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:r,viewportId:n})=>{const i=Ln(n,r);if(!i)return;const o=this._getAnnotations(i);o?.length&&o.forEach(a=>{kt(a.annotationUID)})})}setToolCenter(e,r=!1){this._getViewportsInfo().map(({renderingEngineId:i,viewportId:o})=>{const s=Fn(i).getViewport(o),c=s.getCamera(),{focalPoint:l,position:d,viewPlaneNormal:u}=c,f=[e[0]-l[0],e[1]-l[1],e[2]-l[2]],h=f[0]*u[0]+f[1]*u[1]+f[2]*u[2],g=[h*u[0],h*u[1],h*u[2]],p=[l[0]+g[0],l[1]+g[1],l[2]+g[2]],v=[d[0]+g[0],d[1]+g[1],d[2]+g[2]];s.setCamera({focalPoint:p,position:v}),s.render()}),this.toolCenter=e,r||Ye(Fe,V.CROSSHAIR_TOOL_CENTER_CHANGED,{toolGroupId:this.toolGroupId,toolCenter:this.toolCenter})}getHandleNearImagePoint(e,r,n,i){const o=Ce(e),{viewport:a}=o;let s=this._getRotationHandleNearImagePoint(a,r,n,i);if(s!==null||(s=this._getSlabThicknessHandleNearImagePoint(a,r,n,i),s!==null))return s}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=Ln(r,n),{element:o}=i;o.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_autoPanViewportIfNecessary(e,r){const n=r.getViewport(e),{clientWidth:i,clientHeight:o}=n.canvas,a=n.worldToCanvas(this.toolCenter),s=this.configuration.autoPan.panSize,c=[a[0],a[1]];if(a[0]<0?c[0]=s:a[0]>i&&(c[0]=i-s),a[1]<0?c[1]=s:a[1]>o&&(c[1]=o-s),c[0]===a[0]&&c[1]===a[1])return;const l=n.canvasToWorld(c),d=[l[0]-this.toolCenter[0],l[1]-this.toolCenter[1],l[2]-this.toolCenter[2]],u=n.getCamera(),{focalPoint:f,position:h}=u,g=[h[0]-d[0],h[1]-d[1],h[2]-d[2]],p=[f[0]-d[0],f[1]-d[1],f[2]-d[2]];n.setCamera({focalPoint:p,position:g}),n.render()}setSlabThickness(e,r){let n;const{filterActorUIDsToSetSlabThickness:i}=this.configuration;i&&i.length>0&&(n=i);let o=this.configuration.slabThicknessBlendMode;r===sv.MINIMUM_SLAB_THICKNESS&&(o=Ka.COMPOSITE),e.setBlendMode(o,n,!1),e.setSlabThickness(r,n)}_isClockWise(e,r,n){return(r[0]-e[0])*(n[1]-e[1])-(r[1]-e[1])*(n[0]-e[0])>0}_applyDeltaShiftToSelectedViewportCameras(e,r,n){r.forEach(i=>{this._applyDeltaShiftToViewportCamera(e,i,n)})}_applyDeltaShiftToViewportCamera(e,r,n){const{data:i}=r,o=e.getViewport(i.viewportId),a=o.getCamera(),s=a.viewPlaneNormal,c=pt.dot(n,s),l=[...s];if(pt.multiplyScalar(l,c),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const d=[0,0,0],u=[0,0,0];pt.add(a.focalPoint,l,d),pt.add(a.position,l,u),o.setCamera({focalPoint:d,position:u}),o.render()}}_getRotationHandleNearImagePoint(e,r,n,i){const{data:o}=r,{rotationPoints:a}=o.handles;for(let s=0;s<a.length;s++){const c=a[s][0],l=a[s][1];if(!this._getReferenceLineControllable(l.id)||!this._getReferenceLineDraggableRotatable(l.id))continue;const f=e.worldToCanvas(c);if(Bn(n,f)<i)return o.handles.activeOperation=na.ROTATE,this.editData={annotation:r},c}return null}_getSlabThicknessHandleNearImagePoint(e,r,n,i){const{data:o}=r,{slabThicknessPoints:a}=o.handles;for(let s=0;s<a.length;s++){const c=a[s][0],l=a[s][1];if(!this._getReferenceLineControllable(l.id)||!this._getReferenceLineSlabThicknessControlsOn(l.id))continue;const f=e.worldToCanvas(c);if(Bn(n,f)<i)return o.handles.activeOperation=na.SLAB,o.activeViewportIds=[l.id],this.editData={annotation:r},c}return null}_pointNearTool(e,r,n,i){const o=Ce(e),{viewport:a}=o,{clientWidth:s,clientHeight:c}=a.canvas,l=Math.sqrt(s*s+c*c),{data:d}=r,{rotationPoints:u}=d.handles,{slabThicknessPoints:f}=d.handles,h=[];for(let g=0;g<u.length-1;++g){const p=u[g][1],v=this._getReferenceLineControllable(p.id),w=this._getReferenceLineDraggableRotatable(p.id);if(!v||!w)continue;const m={start:{x:u[g][2][0],y:u[g][2][1]},end:{x:u[g][3][0],y:u[g][3][1]}},y=yr([m.start.x,m.start.y],[m.end.x,m.end.y],[n[0],n[1]]),C={start:{x:u[g+1][2][0],y:u[g+1][2][1]},end:{x:u[g+1][3][0],y:u[g+1][3][1]}},x=yr([C.start.x,C.start.y],[C.end.x,C.end.y],[n[0],n[1]]);(y<=i||x<=i)&&(h.push(p.id),d.handles.activeOperation=na.DRAG),g++}for(let g=0;g<f.length-1;++g){const p=f[g][1];if(h.find(O=>O===p.id))continue;const v=this._getReferenceLineControllable(p.id),w=this._getReferenceLineSlabThicknessControlsOn(p.id);if(!v||!w)continue;const m=f[g][2],y=f[g][3],C=xt();zr(C,m,y),Ga(C,C,.5);const x=xt();En(x,m,C),za(x,x);const S=xt();Ga(S,x,l*.05);const T=xt(),_=xt();zr(T,C,S),En(_,C,S);const E={start:{x:T[0],y:T[1]},end:{x:m[0],y:m[1]}},D=yr([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]),b={start:{x:_[0],y:_[1]},end:{x:y[0],y:y[1]}},I=yr([b.start.x,b.start.y],[b.end.x,b.end.y],[n[0],n[1]]);(D<=i||I<=i)&&(h.push(p.id),d.handles.activeOperation=null),g++}return d.activeViewportIds=[...h],this.editData={annotation:r},d.handles.activeOperation===na.DRAG}}yP.toolName="Crosshairs";const kg="magnify-viewport";class wP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}){super(e,r),this._hasBeenRemoved=!1,this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c,renderingEngine:l}=s;if(!(c instanceof Wn))throw new Error("MagnifyTool only works on StackViewports");const d=this._getReferencedImageId(c);if(!d)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const u=vt(o,this.getToolName());return this.editData={referencedImageId:d,viewportIdsToRender:u,enabledElement:s,renderingEngine:l,currentPoints:a},this._createMagnificationViewport(),this._activateDraw(o),St(o),n.preventDefault(),Me(u),!0},this.preTouchStartCallback=n=>{this.preMouseDownCallback(n)},this._createMagnificationViewport=()=>{const{enabledElement:n,referencedImageId:i,viewportIdsToRender:o,renderingEngine:a,currentPoints:s}=this.editData,{viewport:c}=n,{element:l}=c,d=c.getProperties(),{rotation:u}=c.getViewPresentation(),{canvas:f,world:h}=s;let g;if(g=l.querySelector(".magnifyTool"),g===null){const v=document.createElement("div");v.classList.add("magnifyTool"),v.style.display="block",v.style.width=`${this.configuration.magnifyWidth}px`,v.style.height=`${this.configuration.magnifyHeight}px`,v.style.position="absolute",g=v,l.querySelector(".viewport-element").appendChild(v);const m={viewportId:kg,type:Nn.STACK,element:g};a.enableElement(m)}g.style.top=`${f[1]-this.configuration.magnifyHeight/2}px`,g.style.left=`${f[0]-this.configuration.magnifyWidth/2}px`;const p=a.getViewport(kg);p.setStack([i]).then(()=>{if(this._hasBeenRemoved)return;p.setProperties(d),p.setViewPresentation({rotation:u});const{parallelScale:v}=c.getCamera(),{focalPoint:w,position:m,viewPlaneNormal:y}=p.getCamera(),C=Math.sqrt(Math.pow(w[0]-m[0],2)+Math.pow(w[1]-m[1],2)+Math.pow(w[2]-m[2],2)),x=[h[0],h[1],h[2]],S=[x[0]+C*y[0],x[1]+C*y[1],x[2]+C*y[2]];p.setCamera({parallelScale:v*(1/this.configuration.magnifySize),focalPoint:x,position:S}),p.render()}),g.style.display="block",Me(o)},this._cancelCallback=n=>{n.preventDefault(),n.stopPropagation(),this._dragEndCallback(n)},this._dragCallback=n=>{const i=n.detail,{deltaPoints:o,element:a,currentPoints:s}=i,c=o.world,l=s.canvas,d=Ce(a),{renderingEngine:u}=d,f=u.getViewport(kg),h=a.querySelector(".magnifyTool");if(!h)return;h.style.top=`${l[1]-this.configuration.magnifyHeight/2}px`,h.style.left=`${l[0]-this.configuration.magnifyWidth/2}px`;const{focalPoint:g,position:p}=f.getCamera(),v=[p[0]+c[0],p[1]+c[1],p[2]+c[2]],w=[g[0]+c[0],g[1]+c[1],g[2]+c[2]];f.setCamera({focalPoint:w,position:v}),f.render()},this._dragEndCallback=n=>{let{element:i}=n.detail;if(i===void 0){const{enabledElement:l}=this.editData,{viewport:d}=l;i=d.element}const o=Ce(i),{renderingEngine:a}=o;a.disableElement(kg);const s=i.querySelector(".viewport-element"),c=s.querySelector(".magnifyTool");s.removeChild(c),this._deactivateDraw(i),Nt(i),this._hasBeenRemoved=!0},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,this._hasBeenRemoved=!1,n.addEventListener(V.MOUSE_UP,this._dragEndCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._dragEndCallback),n.addEventListener("contextmenu",this._cancelCallback),n.addEventListener(V.TOUCH_END,this._dragEndCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._dragEndCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._dragEndCallback),n.removeEventListener("contextmenu",this._cancelCallback),n.removeEventListener(V.TOUCH_END,this._dragEndCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)}}_getReferencedImageId(e){const r=this.getTargetId(e);let n;return e instanceof Wn&&(n=r.split("imageId:")[1]),n}}wP.toolName="Magnify";const Jue="advancedMagnifyTool",Zue=125,{Events:Gc}=To,__=t=>!!t.representationUID;var jy;(function(t){t.ShowZoomFactorsList="showZoomFactorsList"})(jy||(jy={}));const Que="AdvancedMagnify",e0e=1-yo,Mx=class Mx extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:rs.Secondary,modifierKey:jr.Shift}]}}}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=Ce(a),{viewport:c,renderingEngine:l}=s,d=o.world,u=o.canvas,{magnifyingGlass:f}=this.configuration,{radius:h,zoomFactor:g,autoPan:p}=f,v=this._getWorldHandlePoints(c,u,h),w=c.getCamera(),{viewPlaneNormal:m,viewUp:y}=w,C=this.getReferencedImageId(c,d,m,y),x=cn(),S=cn(),T=c.getFrameOfReferenceUID(),_={annotationUID:x,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...m],viewUp:[...y],FrameOfReferenceUID:T,referencedImageId:C},data:{sourceViewportId:c.id,magnifyViewportId:S,zoomFactor:g,isCanvasAnnotation:!1,handles:{points:v,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(_,{magnifyViewportId:S,sourceEnabledElement:s,position:u,radius:h,zoomFactor:g,autoPan:{enabled:p.enabled,padding:p.padding,callback:D=>{const b=_.data.handles.points,{world:I}=D.delta;for(let O=0,M=b.length;O<M;O++){const R=b[O];R[0]+=I[0],R[1]+=I[1],R[2]+=I[2]}_.invalidated=!0}}}),Ft(_,a);const E=vt(a,this.getToolName());return n.preventDefault(),Me(E),_},this.onSetToolDisabled=()=>{this.magnifyViewportManager.dispose(),ld().forEach(i=>{i.metadata.toolName===this.getToolName()&&kt(i.annotationUID)})},this.isPointNearTool=(n,i,o,a)=>{const{viewport:s}=Ce(n),{points:c}=i.data.handles,{radius:l,center:d}=this._getCanvasCircleData(s,c),u=al([d,o]);return Math.abs(u-l)<a*2},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},St(a),this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;const{points:l}=c.handles,d=l.findIndex(f=>f===o),u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:d},this._activateModify(s),St(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{data:l}=a;l.handles.activeHandleIndex=null,this._deactivateModify(o),Nt(o),this.editData=null,this.isDrawing=!1,Me(s),c&&xn(a)},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{viewport:a}=Ce(o),{deltaPoints:s}=i,c=s?.canvas??[0,0,0],{annotation:l,viewportIdsToRender:d}=this.editData,{points:u}=l.data.handles,f=this._getWorldDeltaFromCanvasDelta(a,u,c);this._applyWorldDelta(u,f),l.invalidated=!0,this.editData.hasMoved=!0,Me(d)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c}=this.editData,{data:l}=a;if(c===void 0){const{deltaPoints:d}=i,u=d.canvas??[0,0,0],f=l.handles.points,h=this._getWorldDeltaFromCanvasDelta(Ce(o).viewport,f,u);this._applyWorldDelta(f,h),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,{viewport:a}=Ce(o),{annotation:s}=this.editData,{data:c}=s,{points:l}=c.handles,{center:d}=this._getCanvasCircleData(a,l),{currentPoints:u}=i,f=u.canvas,h=al([d,f]),p=this._getCanvasHandlePoints(d,h).map(v=>a.canvasToWorld(v));l[0]=p[0],l[1]=p[1],l[2]=p[2],l[3]=p[3]},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length)return o;c=c?.filter(u=>u.data.sourceViewportId===a.id);const l=this.filterInteractableAnnotationsForElement(s,c);if(!l?.length)return o;const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let u=0;u<l.length;u++){const f=l[u],{annotationUID:h,data:g}=f,{magnifyViewportId:p,zoomFactor:v,handles:w}=g,{points:m,activeHandleIndex:y}=w,{center:C,radius:x,canvasPoints:S}=this._getCanvasCircleData(a,m);d.annotationUID=h,this.getStyle("lineWidth",d,f),this.getStyle("lineDash",d,f);const T=this.getStyle("color",d,f);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let _;if(!or(h))continue;if(!ir(h)&&!this.editData&&y!==null){const I=S[y];_=[[I[0],I[1],0]]}_&&kn(i,h,"0",_,{color:T});const E=`${h}-advancedMagnify`;hi(i,h,"0",C,x,{color:T,lineWidth:5},E);const b=this.magnifyViewportManager.getViewport(p);b.position=C,b.radius=x,b.zoomFactor=v,b.update(),o=!0}return o},this._getWorldHandlePoints=(n,i,o)=>this._getCanvasHandlePoints(i,o).map(s=>n.canvasToWorld(s)),this._getCanvasCircleData=(n,i)=>{const o=i.map(u=>n.worldToCanvas(u)),a=o[0],s=o[2],c=o[3],l=Math.abs(s[1]-a[1])*.5,d=[c[0]+l,a[1]+l];return{canvasPoints:o,center:d,radius:l}},this._getCanvasHandlePoints=(n,i)=>[[n[0],n[1]-i,0],[n[0]+i,n[1],0],[n[0],n[1]+i,0],[n[0]-i,n[1],0]],this.magnifyViewportManager=f0.getInstance()}showZoomFactorsList(e,r){const{element:n,currentPoints:i}=e.detail,o=Ce(n),{viewport:a}=o,{canvas:s}=i,c=n.querySelector(":scope .viewport-element"),l=r.data.zoomFactor,d=()=>u.parentElement.removeChild(u),u=this._getZoomFactorsListDropdown(l,f=>{f!==void 0&&(r.data.zoomFactor=Number.parseFloat(f),r.invalidated=!0),d(),a.render()});Object.assign(u.style,{left:`${s[0]}px`,top:`${s[1]}px`}),c.appendChild(u),u.focus()}_getZoomFactorsListDropdown(e,r){const{zoomFactorList:n}=this.configuration.magnifyingGlass,i=document.createElement("select");return i.size=5,Object.assign(i.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach(o=>{i.addEventListener(o,a=>a.stopPropagation())}),i.addEventListener("change",o=>{o.stopPropagation(),r(i.value)}),i.addEventListener("keydown",o=>{((o.keyCode??o.which===27)||o.key?.toLowerCase()==="escape")&&(o.stopPropagation(),r())}),n.forEach(o=>{const a=document.createElement("option");a.label=o,a.title=`Zoom factor ${o.toFixed(1)}`,a.value=o,a.defaultSelected=o===e,i.add(a)}),i}_getWorldDeltaFromCanvasDelta(e,r,n){if(!n)return[0,0,0];const i=r[0],o=e.worldToCanvas(i),a=e.canvasToWorld([o[0]+n[0],o[1]+n[1]]);return[a[0]-i[0],a[1]-i[1],a[2]-i[2]]}_applyWorldDelta(e,r){if(r)for(let n=0,i=e.length;n<i;n++){const o=e[n];o[0]+=r[0],o[1]+=r[1],o[2]+=r[2]}}};Mx.Actions=jy;let wh=Mx;class f0{constructor(){this.createViewport=(e,r)=>{const{magnifyViewportId:n,sourceEnabledElement:i,position:o,radius:a,zoomFactor:s,autoPan:c}=r,{viewport:l}=i,{element:d}=l,u=new t0e({magnifyViewportId:n,sourceEnabledElement:i,radius:a,position:o,zoomFactor:s,autoPan:c});return this._addSourceElementEventListener(d),this._magnifyViewportsMap.set(u.viewportId,{annotation:e,magnifyViewport:u,magnifyViewportInfo:r}),u},this._annotationRemovedCallback=e=>{const{annotation:r}=e.detail;r.metadata.toolName===Que&&this.destroyViewport(r.data.magnifyViewportId)},this._newStackImageCallback=e=>{const{viewportId:r,imageId:n}=e.detail,i=this._getMagnifyViewportsMapEntriesBySourceViewportId(r),{viewport:o}=wn(r);o.stackActorReInitialized&&this._reset(r),i.forEach(({annotation:a})=>{a.metadata.referencedImageId=n,a.invalidated=!0})},this._newVolumeImageCallback=e=>{const{renderingEngineId:r,viewportId:n}=e.detail,o=Fn(r).getViewport(n),{viewPlaneNormal:a}=o.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(n).forEach(({annotation:c})=>{const{viewPlaneNormal:l}=c.metadata;if(!(Math.abs(ft(l,a))>e0e))return;const{handles:u}=c.data,f=o.canvasToWorld([0,0]),h=rn(Ie(),f,u.points[0]),g=ft(h,a),p=xr(Ie(),a,g);for(let v=0,w=u.points.length;v<w;v++){const m=u.points[v];m[0]+=p[0],m[1]+=p[1],m[2]+=p[2]}c.invalidated=!0})},this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){return f0._singleton=f0._singleton??new f0,f0._singleton}getViewport(e){return this._magnifyViewportsMap.get(e)?.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(e){const r=this._magnifyViewportsMap.get(e);if(r){const{magnifyViewport:n}=r,{viewport:i}=n.sourceEnabledElement,{element:o}=i;this._removeSourceElementEventListener(o),n.dispose(),this._magnifyViewportsMap.delete(e)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach(r=>this.destroyViewport(r))}_getMagnifyViewportsMapEntriesBySourceViewportId(e){return Array.from(this._magnifyViewportsMap.values()).filter(({magnifyViewport:n})=>{const{viewport:i}=n.sourceEnabledElement;return i.id===e})}_reset(e){this._getMagnifyViewportsMapEntriesBySourceViewportId(e).forEach(({magnifyViewport:n,annotation:i,magnifyViewportInfo:o})=>{this.destroyViewport(n.viewportId);const a=wn(e);this.createViewport(i,{...o,sourceEnabledElement:{...a}})})}_addEventListeners(){Fe.addEventListener(V.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){Fe.removeEventListener(V.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(e){e.addEventListener(Gc.STACK_NEW_IMAGE,this._newStackImageCallback);const r=i=>{const{viewportId:o}=i.detail;this._reset(o)};e.addEventListener(Gc.VIEWPORT_NEW_IMAGE_SET,r);const n=i=>{const{viewportId:o}=i.detail;this._reset(o)};e.addEventListener(Gc.VOLUME_VIEWPORT_NEW_VOLUME,n),e.addEventListener(Gc.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.newStackHandler=r,e.newVolumeHandler=n}_removeSourceElementEventListener(e){e.removeEventListener(Gc.STACK_NEW_IMAGE,this._newStackImageCallback),e.removeEventListener(Gc.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.removeEventListener(Gc.VIEWPORT_NEW_IMAGE_SET,e.newStackHandler),e.removeEventListener(Gc.VOLUME_VIEWPORT_NEW_VOLUME,e.newVolumeHandler),delete e.newStackHandler,delete e.newVolumeHandler}_initialize(){this._addEventListeners()}}class t0e{constructor({magnifyViewportId:e,sourceEnabledElement:r,radius:n=Zue,position:i=[0,0],zoomFactor:o,autoPan:a}){this._enabledElement=null,this._sourceToolGroup=null,this._magnifyToolGroup=null,this._isViewportReady=!1,this._radius=0,this._resized=!1,this._canAutoPan=!1,this._viewportId=e??cn(),this._sourceEnabledElement=r,this._autoPan=a,this.radius=n,this.position=i,this.zoomFactor=o,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=pd(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(e){Math.abs(this._radius-e)>1e-5&&(this._radius=e,this._resized=!0)}update(){const{radius:e,position:r,visible:n}=this,{viewport:i}=this._enabledElement,{element:o}=i,a=2*e,[s,c]=r;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(o.style,{display:n?"block":"hidden",width:`${a}px`,height:`${a}px`,left:`${-e}px`,top:`${-e}px`,transform:`translate(${s}px, ${c}px)`}),this._isViewportReady&&(this._syncViewports(),i.render())}dispose(){const{viewport:e}=this._enabledElement,{element:r}=e,n=e.getRenderingEngine();this._removeEventListeners(r),n.disableElement(e.id),r.parentNode&&r.parentNode.removeChild(r)}_handleToolModeChanged(e){const{_magnifyToolGroup:r}=this,{toolGroupId:n,toolName:i,mode:o,toolBindingsOptions:a}=e.detail;if(this._sourceToolGroup?.id===n)switch(o){case Cn.Active:r.setToolActive(i,a);break;case Cn.Passive:r.setToolPassive(i);break;case Cn.Enabled:r.setToolEnabled(i);break;case Cn.Disabled:r.setToolDisabled(i);break;default:throw new Error(`Unknow tool mode (${o})`)}}_inheritBorderRadius(e){const r=e.querySelector(".viewport-element"),n=e.querySelector(".cornerstone-canvas");r.style.borderRadius="inherit",n.style.borderRadius="inherit"}_createViewportNode(){const e=document.createElement("div"),{radius:r}=this,n=r*2;return e.classList.add(Jue),Object.assign(e.style,{display:"block",width:`${n}px`,height:`${n}px`,position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:`${-r}px`,top:`${-r}px`,transform:"translate(-1000px, -1000px)"}),e}_convertZoomFactorToParallelScale(e,r,n){const{parallelScale:i}=e.getCamera(),o=r.canvas.offsetWidth/e.canvas.offsetWidth;return i*(1/n)*o}_isStackViewport(e){return"setStack"in e}_isVolumeViewport(e){return"addVolumes"in e}_cloneToolGroups(e,r){const n=e.getActors(),i=`${r.id}-toolGroup`,o=Qn(e.id,e.renderingEngineId),a=o.clone(i,s=>{const c=o.getToolInstance(s);return c instanceof Un&&!(c instanceof wh)});return a.addViewport(r.id,r.renderingEngineId),n.filter(__).forEach(s=>{Sd(this.viewportId,[{segmentationId:s.referencedId,type:yt.Labelmap}])}),{sourceToolGroup:o,magnifyToolGroup:a}}_cloneStack(e,r){const n=e.getImageIds();r.setStack(n).then(()=>{this._isViewportReady=!0,this.update()})}_cloneVolumes(e,r){const i=e.getActors().filter(o=>!__(o)).map(o=>({volumeId:o.referencedId}));return r.setVolumes(i).then(()=>{this._isViewportReady=!0,this.update()}),r}_cloneViewport(e,r){const{viewportId:n}=this,i=e.getRenderingEngine(),{options:o}=e,a={element:r,viewportId:n,type:e.type,defaultOptions:{...o}};i.enableElement(a);const s=i.getViewport(n);this._isStackViewport(e)?this._cloneStack(e,s):this._isVolumeViewport(e)&&this._cloneVolumes(e,s),this._inheritBorderRadius(r);const c=this._cloneToolGroups(e,s);this._sourceToolGroup=c.sourceToolGroup,this._magnifyToolGroup=c.magnifyToolGroup}_cancelMouseEventCallback(e){e.stopPropagation(),e.preventDefault()}_browserMouseUpCallback(e){const{element:r}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),r.addEventListener("mouseup",this._cancelMouseEventCallback),r.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(e){const{element:r}=this._enabledElement.viewport;this._canAutoPan=!!e.target?.closest(".advancedMagnifyTool"),document.addEventListener("mouseup",this._browserMouseUpCallback),r.removeEventListener("mouseup",this._cancelMouseEventCallback),r.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(e){if(!Ue.isInteractingWithTool)return;const{_autoPan:r}=this;if(!r.enabled||!this._canAutoPan)return;const{currentPoints:n}=e.detail,{viewport:i}=this._enabledElement,{canvasToWorld:o}=i,{canvas:a}=n,{radius:s}=this,c=[s,s],l=ls(c,a),d=s-r.padding;if(l<=d)return;const u=l-d,f=mo(xt(),a,c);za(f,f),Ga(f,f,u);const h=zr(xt(),this.position,f),g=o(this.position),p=o(h),v=rn(Ie(),p,g),w={points:{currentPosition:{canvas:this.position,world:g},newPosition:{canvas:h,world:p}},delta:{canvas:f,world:v}};r.callback(w)}_addBrowserEventListeners(e){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),e.addEventListener("mousedown",this._cancelMouseEventCallback),e.addEventListener("mouseup",this._cancelMouseEventCallback),e.addEventListener("mousemove",this._cancelMouseEventCallback),e.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(e){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),e.removeEventListener("mousedown",this._cancelMouseEventCallback),e.removeEventListener("mouseup",this._cancelMouseEventCallback),e.removeEventListener("mousemove",this._cancelMouseEventCallback),e.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(e){Fe.addEventListener(V.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(V.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(V.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(e)}_removeEventListeners(e){Fe.removeEventListener(V.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(V.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(V.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(e)}_initialize(){const{_sourceEnabledElement:e}=this,{viewport:r}=e,{canvas:n}=r,i=this._createViewportNode();n.parentNode.appendChild(i),this._addEventListeners(i),this._cloneViewport(r,i),this._enabledElement=Ce(i)}_syncViewportsCameras(e,r){const n=e.canvasToWorld(this.position),i=this._convertZoomFactorToParallelScale(e,r,this.zoomFactor),{focalPoint:o,position:a,viewPlaneNormal:s}=r.getCamera(),c=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)+Math.pow(o[2]-a[2],2)),l=[n[0],n[1],n[2]],d=[l[0]+c*s[0],l[1]+c*s[1],l[2]+c*s[2]];r.setCamera({parallelScale:i,focalPoint:l,position:d})}_syncStackViewports(e,r){r.setImageIdIndex(e.getCurrentImageIdIndex())}_syncViewports(){const{viewport:e}=this._sourceEnabledElement,{viewport:r}=this._enabledElement,n=e.getProperties();r.getImageData()&&(r.setProperties(n),this._syncViewportsCameras(e,r),this._isStackViewport(e)&&this._syncStackViewports(e,r),this._syncViewportsCameras(e,r),r.render())}_resizeViewport(){const{viewport:e}=this._enabledElement;e.getRenderingEngine().resize()}}wh.toolName="AdvancedMagnify";const{EPSILON:cv}=pl;class CP extends fs{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",enforceSameFrameOfReference:!0,showFullDimension:!1}}){super(e,r),this.editData=null,this._init=()=>{const i=eo()[0];if(!i)return;let o=i.getViewports();o=Tm(o,this.getToolName());const a=i.getViewport(this.configuration.sourceViewportId);if(!a?.getImageData())return;const{element:s}=a,{viewUp:c,viewPlaneNormal:l}=a.getCamera(),d=Yp(a);let u=this.editData?.annotation;const f=a.getFrameOfReferenceUID();if(u)this.editData.annotation.data.handles.points=d;else{const h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...c],FrameOfReferenceUID:f,referencedImageId:null},data:{handles:{points:d}}};Ft(h,s),u=h}this.editData={sourceViewportId:a.id,renderingEngine:i,annotation:u},Me(o.filter(h=>h.id!==a.id).map(h=>h.id))},this.onSetToolEnabled=()=>{this._init()},this.onSetToolConfiguration=()=>{this._init()},this.onCameraModified=n=>{this._init()},this.renderAnnotation=(n,i)=>{const{viewport:o}=n;if(!this.editData)return!1;const{annotation:a,sourceViewportId:s}=this.editData;let c=!1;const{viewport:l}=wn(s)||{};if(!l||l.id===o.id||!a||!a?.data?.handles?.points||this.configuration.enforceSameFrameOfReference&&l.getFrameOfReferenceUID()!==o.getFrameOfReferenceUID())return c;const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=a.data.handles.points[0],f=a.data.handles.points[1],h=a.data.handles.points[2],g=a.data.handles.points[3],{focalPoint:p,viewPlaneNormal:v,viewUp:w}=o.getCamera(),{viewPlaneNormal:m}=l.getCamera();if(this.isParallel(v,m))return c;const y=Ya(v,p),C=[u,h,f,g],x=[u,f,h,g];let S=C,T=an(Ie(),C[0],C[1]);T=Lt(Ie(),T);let _=an(Ie(),C[2],C[0]);_=Lt(Ie(),_);const E=tn(Ie(),T,_);if(this.isParallel(E,v))return c;this.isPerpendicular(T,v)&&(S=x);const D=G0(S[0],S[1],y),b=G0(S[2],S[3],y),{annotationUID:I}=a;d.annotationUID=I;const O=this.getStyle("lineWidth",d,a),M=this.getStyle("lineDash",d,a),R=this.getStyle("color",d,a),A=this.getStyle("shadow",d,a);let G=[D,b].map(F=>o.worldToCanvas(F));if(this.configuration.showFullDimension&&(G=this.handleFullDimension(o,D,v,w,b,G)),G.length<2)return c;const k=`${I}-line`;return qt(i,I,"1",G[0],G[1],{color:R,width:O,lineDash:M,shadow:A},k),c=!0,c},this.isPerpendicular=(n,i)=>{const o=ft(n,i);return Math.abs(o)<cv}}handleFullDimension(e,r,n,i,o,a){e.getRenderingEngine();const s=this.getTargetId(e),c=this.getTargetImageData(s),l=this.getReferencedImageId(e,r,n,i);if(l&&c)try{const{imageData:d,dimensions:u}=c,[f,h,g,p]=[d.indexToWorld([0,0,0]),d.indexToWorld([u[0]-1,0,0]),d.indexToWorld([u[0]-1,u[1]-1,0]),d.indexToWorld([0,u[1]-1,0])].map(m=>Cy(l,m)),[v,w]=[r,o].map(m=>Cy(l,m));a=[[f,h],[h,g],[p,g],[f,p]].map(([m,y])=>this.intersectInfiniteLines(m,y,v,w)).filter(m=>m&&this.isInBound(m,u)).map(m=>{const y=hI(l,m);return e.worldToCanvas(y)})}catch(d){console.log(d)}return a}intersectInfiniteLines(e,r,n,i){const[o,a]=e,[s,c]=r,[l,d]=n,[u,f]=i,h=c-a,g=o-s,p=s*a-o*c,v=f-d,w=l-u,m=u*d-l*f;if(Math.abs(h*w-v*g)<cv)return;const y=(g*m-w*p)/(h*w-v*g),C=(v*p-h*m)/(h*w-v*g);return[y,C]}isParallel(e,r){return Math.abs(ft(e,r))>1-cv}isInBound(e,r){return e[0]>=0&&e[0]<=r[0]&&e[1]>=0&&e[1]<=r[1]}}CP.toolName="ReferenceLines";const{EPSILON:E_}=pl;class xP extends fs{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}){super(e,r),this.onSetToolEnabled=()=>{this._init()},this.onSetToolActive=()=>{this._init()},this._init=()=>{const n=this.configuration.sourceImageIds;if(!n?.length){console.warn("OverlayGridTool: No sourceImageIds provided in configuration");return}const i=ut("imagePlaneModule",n[0]);if(!i){console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");return}const{frameOfReferenceUID:o}=i,a=Fr(this.toolGroupId).viewportsInfo;if(!a?.length){console.warn("OverlayGridTool: No viewports found");return}if(!$t(this.getToolName(),o)?.length){const c=n.map(d=>this.calculateImageIdPointSets(d)),l={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:o,referencedImageId:null},data:{viewportData:new Map,pointSets:c}};Ft(l,o)}Me(a.map(({viewportId:c})=>c))},this.calculateImageIdPointSets=n=>{const{imagePositionPatient:i,rows:o,columns:a,rowCosines:s,columnCosines:c,rowPixelSpacing:l,columnPixelSpacing:d}=ut("imagePlaneModule",n),u=[...i],f=[...i],h=[...i],g=[...i];return en(f,i,c,a*d),en(h,i,s,o*l),en(g,h,c,a*d),{pointSet1:[u,h,f,g],pointSet2:[u,f,h,g]}},this.renderAnnotation=(n,i)=>{const o=this.configuration.sourceImageIds;let a=!1;if(!o?.length)return a;const{viewport:s,FrameOfReferenceUID:c}=n;if(s.getImageIds().length<2)return a;const d=$t(this.getToolName(),c);if(!d?.length)return a;const u=d[0],{annotationUID:f}=u,{focalPoint:h,viewPlaneNormal:g}=s.getCamera(),p={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},v=this.getImageIdNormal(o[0]);if(this.isParallel(g,v))return a;const w=Ya(g,h),m=u.data.pointSets,y=u.data.viewportData;for(let C=0;C<o.length;C++){const{pointSet1:x,pointSet2:S}=m[C],T=y.get(s.id)||this.initializeViewportData(y,s.id);if(!T.pointSetsToUse[C]){let G=x,k=an(Ie(),x[0],x[1]);k=Lt(Ie(),k),this.isPerpendicular(k,g)&&(G=S),T.pointSetsToUse[C]=G,T.lineStartsWorld[C]=G0(G[0],G[1],w),T.lineEndsWorld[C]=G0(G[2],G[3],w)}const _=T.lineStartsWorld[C],E=T.lineEndsWorld[C];p.annotationUID=f;const D=this.getStyle("lineWidth",p,u),b=this.getStyle("lineDash",p,u),I=this.getStyle("color",p,u),O=this.getStyle("shadow",p,u),M=[_,E].map(G=>s.worldToCanvas(G)),R=`${f}-line`,A=`${C}`;qt(i,f,A,M[0],M[1],{color:I,width:D,lineDash:b,shadow:O},R)}return a=!0,a},this.initializeViewportData=(n,i)=>(n.set(i,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),n.get(i)),this.isPerpendicular=(n,i)=>{const o=ft(n,i);return Math.abs(o)<E_}}isParallel(e,r){return Math.abs(ft(e,r))>1-E_}getImageIdNormal(e){const{imageOrientationPatient:r}=ut("imagePlaneModule",e),n=mt(r[0],r[1],r[2]),i=mt(r[3],r[4],r[5]);return tn(Ie(),n,i)}}xP.toolName="OverlayGrid";class SP extends fs{constructor(e={},r={configuration:{opacity:.5}}){super(e,r),this._init=()=>{const n=Fr(this.toolGroupId).viewportsInfo;if(!n?.length){console.warn(this.getToolName()+"Tool: No viewports found");return}const i=Fn(n[0].renderingEngineId)?.getViewport(n[0].viewportId);if(!i)return;const o=i.getFrameOfReferenceUID();if(!$t(this.getToolName(),o)?.length){const s=new Map;n0e(s,n);const c={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:o,referencedImageId:null},data:{actorsWorldPointsMap:s}};Ft(c,o)}Me(n.map(({viewportId:s})=>s))},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=n=>{this._init()},this.renderAnnotation=(n,i)=>{const{viewport:o,FrameOfReferenceUID:a}=n;let s=!1;const c=$t(this.getToolName(),a);if(!c?.length)return s;const l=c[0],{annotationUID:d}=l,u=l.data.actorsWorldPointsMap;TP(u,o);const f=o.getActors(),h=_P(o);return f.forEach(g=>{if(!g?.clippingFilter)return;const p=u.get(g.uid);if(!p||!p.get(h))return;let v=1;const{worldPointsSet:w,color:m}=p.get(h);for(let y=0;y<w.length;y++){const x=w[y].map(_=>o.worldToCanvas(_)),S={color:m,fillColor:m,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},T=g.uid+"#"+v;Js(i,d,T,x,S),v++}}),s=!0,s}}}function n0e(t,e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const i=Fn(n)?.getViewport(r);TP(t,i)})}function TP(t,e){const r=e.getActors(),n=_P(e);r.forEach(i=>{if(!i?.clippingFilter)return;let o=t.get(i.uid);if(o||(o=new Map,t.set(i.uid,o)),!o.get(n)){const a=i.clippingFilter.getOutputData(),s=jO(a);if(!s)return;const c=i.actor.getProperty().getColor(),l=r0e(c);o.set(n,{worldPointsSet:s,color:l})}})}function _P(t){const{viewPlaneNormal:e}=t.getCamera(),r=t.getCurrentImageIdIndex();return`${t.id}-${YM(e)}-${r}`}function r0e(t){function e(r){let n=Math.floor(r*255).toString(16);return n.length===1&&(n="0"+n),n}return"#"+e(t[0])+e(t[1])+e(t[2])}SP.toolName="SegmentationIntersection";class EP extends fs{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}){super(e,r),this.isDrawing=!1,this.isHandleOutsideImage=!1,this._elementWithCursor=null,this._currentCursorWorldPosition=null,this._currentCanvasPosition=null,this._disableCursorEnabled=!1,this.mouseMoveCallback=n=>{const{detail:i}=n,{element:o,currentPoints:a}=i;this._currentCursorWorldPosition=a.world,this._currentCanvasPosition=a.canvas,this._elementWithCursor=o;const s=this.getActiveAnnotation(o);return s===null?(this.createInitialAnnotation(a.world,o),!1):(this.updateAnnotationPosition(o,s),!1)},this.createInitialAnnotation=(n,i)=>{const o=Ce(i);if(!o)throw new Error("No enabled element found");const{viewport:a,renderingEngine:s}=o;this.isDrawing=!0;const c=a.getCamera(),{viewPlaneNormal:l,viewUp:d}=c;if(!l||!d)throw new Error("Camera not found");const u=this.getReferencedImageId(a,n,l,d),f=a.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...d],FrameOfReferenceUID:f,referencedImageId:u},data:{label:"",handles:{points:[[...n]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if($t(this.getToolName(),i).length>0)return null;if(Ft(h,i)===null)return;const v=vt(i,this.getToolName(),!1);Me(v)},this.onCameraModified=n=>{const i=n.detail,{element:o,previousCamera:a,camera:s}=i,l=Ce(o).viewport;if(o!==this._elementWithCursor)return;const d=a.focalPoint,u=s.viewPlaneNormal,f=s.focalPoint,h=[0,0,0];if(pt.subtract(f,d,h),h.reduce((v,w)=>v+w,0)===0)return;const g=pt.dot(h,u);if(Math.abs(g)<.01||!this._currentCanvasPosition)return;const p=l.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=p,this.updateAnnotationPosition(o,this.getActiveAnnotation(o))},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a,FrameOfReferenceUID:s}=n,c=this._elementWithCursor===a.element;this.configuration.positionSync&&!c&&this.updateViewportImage(a);const{element:l}=a;let d=$t(this.getToolName(),l);if(!d?.length||(d=this.filterInteractableAnnotationsForElement(l,d),!d?.length))return o;const u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<d.length;f++){const h=d[f],{annotationUID:g,data:p}=h,{handles:v}=p,{points:w}=v;if(!g)return o;u.annotationUID=g;const m=parseFloat(this.getStyle("lineWidth",u,h)),y=m,C=this.getStyle("lineDash",u,h),x=this.getStyle("color",u,h);if(w[0].some(I=>isNaN(I)))return o;const S=w.map(I=>a.worldToCanvas(I));if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(g))continue;const T={upper:"upper",right:"right",lower:"lower",left:"left"},[_,E]=S[0],D=c?20:7,b=c?5:7;qt(i,g,T.upper,[_,E-(D/2+b)],[_,E-D/2],{color:x,lineDash:C,lineWidth:y}),qt(i,g,T.lower,[_,E+(D/2+b)],[_,E+D/2],{color:x,lineDash:C,lineWidth:y}),qt(i,g,T.right,[_+(D/2+b),E],[_+D/2,E],{color:x,lineDash:C,lineWidth:y}),qt(i,g,T.left,[_-(D/2+b),E],[_-D/2,E],{color:x,lineDash:C,lineWidth:y}),o=!0}return o},this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const e=Fr(this.toolGroupId).viewportsInfo;if(!e)return;e.map(n=>Ln(n.viewportId,n.renderingEngineId)).forEach(n=>{n&&St(n.viewport.element)})}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const e=Fr(this.toolGroupId).viewportsInfo;if(!e)return;e.map(n=>Ln(n.viewportId,n.renderingEngineId)).forEach(n=>{n&&Nt(n.viewport.element)})}getActiveAnnotation(e){const r=$t(this.getToolName(),e);return r.length?r[0]:null}updateAnnotationPosition(e,r){const n=this._currentCursorWorldPosition;if(!n||!r.data?.handles?.points)return;r.data.handles.points=[[...n]],r.invalidated=!0;const i=vt(e,this.getToolName(),!1);Ce(e)&&Me(i)}filterInteractableAnnotationsForElement(e,r){if(!(r instanceof Array)||r.length===0)return[];const n=r[0],i=Ce(e)?.viewport;if(!i)return[];const o=i.getCamera(),{viewPlaneNormal:a,focalPoint:s}=o;if(!a||!s)return[];const c=n.data?.handles?.points;if(!(c instanceof Array)||c.length!==1)return[];const l=c[0],d=Ya(a,s);return Kf(d,l)<this.configuration.displayThreshold?[n]:[]}updateViewportImage(e){const r=this._currentCursorWorldPosition;if(!(!r||r.some(n=>isNaN(n)))){if(e instanceof Wn){const n=$w(r,e);if(n===null)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof Gn){const{focalPoint:n,viewPlaneNormal:i}=e.getCamera();if(!n||!i)return;const o=Ya(i,n),a=Kf(o,r,!0);if(Math.abs(a)<.5)return;const s=Lt(Ie(),mt(...i)),c=xr(Ie(),s,a),l=hr(Ie(),mt(...n),c);{e.setCamera({focalPoint:l});const d=e.getRenderingEngine();d&&d.renderViewport(e.id)}}}}}EP.toolName="ReferenceCursors";const b_=[];class bP extends fs{constructor(e={},r={configuration:{viewportId:"",scaleLocation:"bottom"}}){super(e,r),this.editData=null,this._init=()=>{const i=eo()[0];if(!i)return;const o=Fr(this.toolGroupId).viewportsInfo;if(!o)return;const a=o.map(g=>Ln(g.viewportId,g.renderingEngineId));let{viewport:s}=a[0];const{FrameOfReferenceUID:c}=a[0];if(this.configuration.viewportId&&a.forEach(g=>{g.viewport.id==this.configuration.viewportId&&(s=g.viewport)}),!s)return;const{viewUp:l,viewPlaneNormal:d}=s.getCamera(),u=Yp(s);let f=this.editData?.annotation;const h=$t(this.getToolName(),s.element);h.length&&(f=h.filter(g=>g.data?.viewportId==s.id)[0]),a.forEach(g=>{const{viewport:p}=g;if(!b_.includes(p.id)){const v={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...l],FrameOfReferenceUID:c,referencedImageId:null},data:{handles:{points:Yp(p)},viewportId:p.id}};b_.push(p.id),Ft(v,p.element),f=v}}),this.editData?.annotation&&this.editData.annotation.data.viewportId==s.id&&(this.editData.annotation.data.handles.points=u,this.editData.annotation.data.viewportId=s.id),this.editData={viewport:s,renderingEngine:i,annotation:f}},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=n=>{this.configuration.viewportId=n.detail.viewportId,this._init()},this.computeScaleSize=(n,i,o)=>{const a=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let s;return o=="top"||o=="bottom"?s=a.filter(c=>c<n*.6&&c>n*.2):s=a.filter(c=>c<i*.6&&c>i*.2),s[0]},this.computeEndScaleTicks=(n,i)=>{const o={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]},a=[[n[1][0]+o[i][0][0],n[1][1]+o[i][0][0]],[n[1][0]+o[i][1][0],n[1][1]+o[i][1][1]]],s=[[n[0][0]+o[i][0][0],n[0][1]+o[i][0][0]],[n[0][0]+o[i][1][0],n[0][1]+o[i][1][1]]];return{endTick1:a,endTick2:s}},this.computeInnerScaleTicks=(n,i,o,a,s)=>{let c;i=="bottom"||i=="top"?c=s[0][0]-a[0][0]:(i=="left"||i=="right")&&(c=s[0][1]-a[0][1]);const l=[],d=[],u=[];let f=n;n>=50&&(f=n/10);const h=c/f;for(let g=0;g<f-1;g++){const p={bottom:[[h*(g+1),0],[h*(g+1),5]],top:[[h*(g+1),0],[h*(g+1),-5]],left:[[0,h*(g+1)],[-5,h*(g+1)]],right:[[0,h*(g+1)],[5,h*(g+1)]]};l.push(`${o}-tick${g}`),d.push(`tick${g}`),(g+1)%5==0?u.push([[a[0][0]+p[i][0][0],a[0][1]+p[i][0][1]],[a[1][0]+p[i][0][0],a[1][1]+p[i][0][1]]]):u.push([[a[0][0]+p[i][0][0],a[0][1]+p[i][0][1]],[a[1][0]+p[i][1][0],a[1][1]+p[i][1][1]]])}return{tickIds:l,tickUIDs:d,tickCoordinates:u}},this.computeWorldScaleCoordinates=(n,i,o)=>{let a,s=an(Ie(),o[0],o[1]);s=Lt(Ie(),s);let c=an(Ie(),o[2],o[0]);c=Lt(Ie(),c);const l={bottom:[o[1],o[2]],top:[o[0],o[3]],right:[o[2],o[3]],left:[o[0],o[1]]},d=hr(Ie(),l[i][0],l[i][0]).map(f=>f/2),u=n/2/Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2));return i=="top"||i=="bottom"?a=[an(Ie(),d,c.map(f=>f*u)),hr(Ie(),d,c.map(f=>f*u))]:(i=="left"||i=="right")&&(a=[hr(Ie(),d,s.map(f=>f*u)),an(Ie(),d,s.map(f=>f*u))]),a},this.computeCanvasScaleCoordinates=(n,i,o,a,s)=>{let c;if(s=="top"||s=="bottom"){const l=i[0][0]-i[1][0];c=[[n.width/2-l/2,o.height],[n.width/2+l/2,o.height]]}else if(s=="left"||s=="right"){const l=i[0][1]-i[1][1];c=[[a.width,n.height/2-l/2],[a.width,n.height/2+l/2]]}return c},this.computeScaleBounds=(n,i,o,a)=>{const s=i*Math.min(1e3,n.width),c=o*Math.min(1e3,n.height),l={bottom:[-c,-s],top:[c,s],left:[c,s],right:[-c,-s]},d={bottom:[n.height,n.width],top:[0,n.width],left:[n.height,0],right:[n.height,n.width]};return{height:d[a][0]+l[a][0],width:d[a][1]+l[a][1]}}}renderAnnotation(e,r){if(!this.editData||!this.editData.viewport)return;const n=this.configuration.scaleLocation,{viewport:i}=e,a=$t(this.getToolName(),i.element).filter(fe=>fe.data?.viewportId==i.id)[0],s=e.viewport.canvas,c=!1;if(!i||!a)return c;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},d={width:s.width/window.devicePixelRatio||1,height:s.height/window.devicePixelRatio||1},u=a.data.handles.points[0],f=a.data.handles.points[1],h=a.data.handles.points[2],g=a.data.handles.points[3],p=[u,h,f,g],v=Dr(h,g),w=Dr(u,h),m=this.computeScaleBounds(d,.05,.05,n),y=this.computeScaleBounds(d,.05,.05,n),C=this.computeScaleSize(v,w,n),x=this.computeWorldScaleCoordinates(C,n,p).map(fe=>i.worldToCanvas(fe)),S=this.computeCanvasScaleCoordinates(d,x,y,m,n),T=this.computeEndScaleTicks(S,n),{annotationUID:_}=a;l.annotationUID=_;const E=this.getStyle("lineWidth",l,a),D=this.getStyle("lineDash",l,a),b=this.getStyle("color",l,a),I=this.getStyle("shadow",l,a),O=`${_}-scaleline`;qt(r,_,"1",S[0],S[1],{color:b,width:E,lineDash:D,shadow:I},O);const R=`${_}-left`;qt(r,_,"2",T.endTick1[0],T.endTick1[1],{color:b,width:E,lineDash:D,shadow:I},R);const G=`${_}-right`;qt(r,_,"3",T.endTick2[0],T.endTick2[1],{color:b,width:E,lineDash:D,shadow:I},G);const L={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},F=[S[0][0]+L[n][0],S[0][1]+L[n][1]],j=this._getTextLines(C),{tickIds:Y,tickUIDs:ie,tickCoordinates:de}=this.computeInnerScaleTicks(C,n,_,T.endTick1,T.endTick2);for(let fe=0;fe<ie.length;fe++)qt(r,_,ie[fe],de[fe][0],de[fe][1],{color:b,width:E,lineDash:D,shadow:I},Y[fe]);return ac(r,_,"text0",j,[F[0],F[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:b}),c}_getTextLines(e){let r,n;return e>=50?(r=e/10,n=" cm"):(r=e,n=" mm"),[r.toString().concat(n)]}}bP.toolName="ScaleOverlay";const DP=(t,e,r)=>{if(!e?.data?.contour?.polyline?.length)return;const{polyline:n}=e.data.contour,{length:i}=n;let o=1/0;for(let a=0;a<i;a++){const s=t.worldToCanvas(n[a]),c=ls(s,r);o=Math.min(o,c)}if(!(o===1/0||isNaN(o)))return o},Ox=class Ox{constructor(){this.toolInfo={toolSize:null,radius:null,maxToolSize:null}}renderShape(e,r,n){hi(e,"SculptorTool","0",r,this.toolInfo.toolSize,n)}configureToolSize(e){const r=this.toolInfo;if(r.toolSize&&r.maxToolSize)return;const i=e.detail.element,a=Math.min(i.clientWidth,i.clientHeight)/24;r.toolSize=a,r.radius=null,r.maxToolSize=a}updateToolSize(e,r,n){const i=this.toolInfo,o=DP(r,n,e);o>0&&(i.toolSize=Math.min(i.maxToolSize,o),this.computeWorldRadius(r,!0))}getMaxSpacing(e){return Math.max(this.toolInfo.toolSize/4,e)}computeWorldRadius(e,r=!1){if(!this.toolInfo.radius||r){const n=e.canvasToWorld([0,0]),i=e.canvasToWorld([this.toolInfo.toolSize,0]);this.toolInfo.radius=pr(rn(Ie(),n,i))}return this.toolInfo.radius}getEdge(e,r,n,i){const o=hr(Ie(),r,n||r);xr(o,o,.5);const a=e.worldToCanvas(o),s=mo(xt(),a,i),c=Math.atan2(s[1],s[0]),l=this.interpolatePoint(e,c,i),d=e.worldToCanvas(l);return{point:l,angle:c,canvasPoint:d}}interpolatePoint(e,r,n){const[i,o]=n,a=this.toolInfo.toolSize,s=Math.cos(r)*a,c=Math.sin(r)*a,l=[i+s,o+c];return e.canvasToWorld(l)}isInCursor(e,r){return Dr(e,r)<this.toolInfo.radius}};Ox.shapeName="Circle";let _f=Ox;const{isEqual:i0e}=hn;class IP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}){super(e,r),this.registeredShapes=new Map,this.isActive=!1,this.commonData={activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0,external:!0,closed:!1},this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i;if(this.configureToolSize(n),this.selectFreehandTool(i),this.commonData.activeAnnotationUID!==null)return this.isActive=!0,St(o),this.activateModify(o),!0},this.mouseMoveCallback=n=>{this.mode===Cn.Active?(this.configureToolSize(n),this.updateCursor(n)):this.commonData.canvasLocation=void 0},this.endCallback=n=>{const i=n.detail,{element:o}=i;this.isActive=!1,this.deactivateModify(o),Nt(o);const a=this.getToolInstance(o);a.doneEditMemo?.();const c=this.filterSculptableAnnotationsForElement(o).find(l=>l.annotationUID===this.commonData.activeAnnotationUID);a.configuration.calculateStats&&(c.invalidated=!0),Gt(c,o,At.HandlesUpdated)},this.dragCallback=n=>{const i=n.detail,o=i.element;this.updateCursor(n);const a=this.filterSculptableAnnotationsForElement(o),s=a.find(l=>l.annotationUID===this.commonData.activeAnnotationUID);if(!a?.length||!this.isActive)return;const c=s.data.contour.polyline;this.sculpt(i,c)},this.registerShapes(_f.shapeName,_f),this.setToolShape(this.configuration.toolShape)}registerShapes(e,r){const n=new r;this.registeredShapes.set(e,n)}sculpt(e,r){const n=this.configuration,i=e.element,o=Ce(i),{viewport:a}=o,s=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:e.currentPoints.world,mouseCanvasPoint:e.currentPoints.canvas,points:r,maxSpacing:s.getMaxSpacing(n.minSpacing),element:i,contours:[{annotationUID:this.commonData.activeAnnotationUID,points:r}]};const c=this.intersect(a,s);if(!c.length)return;const l=this.getContourSelections(c,r.length),{closed:d}=this.commonData;for(const u of l){const f=new Array,h=u[u.length-1];let g=d?h.relIndex:0,p;for(const v of u)v.isEnter?(lv(f,r,g,v.index),p=v):this.interpolatePoints(a,p,v,r,f),g=v.index;if(l.length>1&&zo(f.map(a.worldToCanvas))<0){console.warn("Skipping internal area");continue}!d&&g<r.length-1&&lv(f,r,g),r.splice(0,r.length),lv(r,f);return}}intersect(e,r){const{contours:n,mousePoint:i,mouseCanvasPoint:o}=this.sculptData,{closed:a}=this.commonData;r.computeWorldRadius(e);const s=new Array;for(const c of n){const{annotationUID:l,points:d}=c;let u=!1;const{length:f}=d;for(let h=0;h<=f;h++){const g=h%f,p=d[g],v=r.isInCursor(p,i);if(h===0){if(u=v,!a&&v){const m=r.getEdge(e,p,null,o);s.push({annotationUID:l,isEnter:v,index:h,point:m.point,angle:m.angle})}continue}if(g===0&&!a){if(u){const m=r.getEdge(e,d[f-1],null,o);s.push({annotationUID:l,isEnter:!1,index:f-1,point:m.point,angle:m.angle})}continue}if(u===v)continue;u=v;const w=r.getEdge(e,p,d[h-1],o);s.push({annotationUID:l,isEnter:v,index:h,point:w.point,angle:w.angle})}}return s}interpolatePoints(e,r,n,i,o){const{external:a,closed:s}=this.commonData,c=i[r.index%i.length],l=i[n.index%i.length],d=rn(Ie(),l,c);if(i0e(pr(d),0))return;const u=this.registeredShapes.get(this.selectedShape),f=(r.angle+2*Math.PI)%(Math.PI*2),h=(n.angle+2*Math.PI)%(Math.PI*2);let g=h<f?h+2*Math.PI:h;const p=h>f?h-2*Math.PI:h;(a&&!s&&Math.abs(p-f)<Math.abs(g-f)||a&&s)&&(g=p);const v=Math.ceil(Math.abs(f-g)/.25);for(let w=0;w<=v;w++){const m=(f*(v-w)+w*g)/v;o.push(u.interpolatePoint(e,m,this.sculptData.mouseCanvasPoint))}}getContourSelections(e,r){const n=new Array,i=e.length/2;if(!i||e.length%2)return n;let o=Number.NEGATIVE_INFINITY;for(let a=0;a<i;a++){const s=this.findNext(e,o);if(!s){console.error("Couldnt' find an entry");continue}const c=this.findNext(e,s.angle,!1);if(!c){console.error("Couldn't find an exit for",s);continue}c.relIndex||=c.index<s.index?c.index+r:c.index,n.push([s,c])}n.sort((a,s)=>a[0].index-s[0].index);for(let a=0;a<n.length-1;){const s=n[a],c=this.findMergeable(n,s,a);c?s.push(...c):a++}return n.length>1&&console.warn("************* More than 1 result",n),n}findMergeable(e,r,n){const i=r[r.length-1];for(let o=n+1;o<e.length;o++){const[a]=e[o];if(a.index>=i.relIndex){const s=e[o];return e.splice(o,1),s}}}findNext(e,r,n=!0){if(e.length===1){const[s]=e;return e.splice(0,1),s}let i,o;for(let s=0;s<e.length;s++){const c=e[s];if(c.isEnter==n){const l=(c.angle-r+2*Math.PI)%(2*Math.PI);(!i||l<o)&&(i={i:s,intersection:c},o=l)}}if(!i){console.warn("Couldn't find an exit point for entry",JSON.stringify(e));return}e.splice(i.i,1);const{intersection:a}=i;return a}interpolatePointsWithinMaxSpacing(e,r,n,i){const{element:o}=this.sculptData,a=Ce(o),{viewport:s}=a,c=o0e(e+1,r.length),l=s.worldToCanvas(r[e]),d=s.worldToCanvas(r[c]);ls(l,d)>i&&n.push(e)}updateCursor(e){const r=e.detail,n=r.element,i=Ce(n),{viewport:o}=i;this.commonData.viewportIdsToRender=[o.id];const a=this.filterSculptableAnnotationsForElement(n);if(!a?.length)return;const s=a.find(c=>c.annotationUID===this.commonData.activeAnnotationUID);if(this.commonData.canvasLocation=r.currentPoints.canvas,this.isActive)s.highlighted=!0;else{const c=this.registeredShapes.get(this.selectedShape),l=r.currentPoints.canvas;c.updateToolSize(l,o,s)}Me(this.commonData.viewportIdsToRender)}getToolInstance(e){const r=Ce(e),{renderingEngineId:n,viewportId:i}=r;return Qn(i,n).getToolInstance(this.configuration.referencedToolName)}filterSculptableAnnotationsForElement(e){const{configuration:r}=this,n=[],i=this.getToolInstance(e);return r.referencedToolNames.forEach(o=>{const a=$t(o,e);a&&n.push(...a)}),i.filterInteractableAnnotationsForElement(e,n)}configureToolSize(e){this.registeredShapes.get(this.selectedShape).configureToolSize(e)}selectFreehandTool(e){const r=this.getClosestFreehandToolOnElement(e);if(r===void 0)return;const n=fn(r);if(this.commonData.activeAnnotationUID=r,this.commonData.closed=n.data.contour.closed,this.commonData.external=!0,this.commonData.closed){const{element:i}=e,o=Ce(i),{viewport:a}=o,s=n.data.contour.polyline.map(l=>a.worldToCanvas(l)),c=e.currentPoints.canvas;this.commonData.external=!Di(s,c,{closed:!0})}}getClosestFreehandToolOnElement(e){const{element:r}=e,n=Ce(r),{viewport:i}=n,o=this.configuration,a=this.filterSculptableAnnotationsForElement(r);if(!a?.length)return;const s=e.currentPoints.canvas,c={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let l=0;l<a?.length;l++){if(a[l].isLocked||!a[l].isVisible)continue;const d=DP(i,a[l],s);d!==-1&&d<c.distance&&(c.distance=d,c.toolIndex=l,c.annotationUID=a[l].annotationUID)}return this.commonData.isEditingOpenContour=!a[c.toolIndex].data.contour.closed,o.referencedToolName=a[c.toolIndex].metadata.toolName,c.annotationUID}activateModify(e){const r=fn(this.commonData.activeAnnotationUID);this.getToolInstance(e).createMemo?.(e,r),e.addEventListener(V.MOUSE_UP,this.endCallback),e.addEventListener(V.MOUSE_CLICK,this.endCallback),e.addEventListener(V.MOUSE_DRAG,this.dragCallback),e.addEventListener(V.TOUCH_TAP,this.endCallback),e.addEventListener(V.TOUCH_END,this.endCallback),e.addEventListener(V.TOUCH_DRAG,this.dragCallback)}deactivateModify(e){e.removeEventListener(V.MOUSE_UP,this.endCallback),e.removeEventListener(V.MOUSE_CLICK,this.endCallback),e.removeEventListener(V.MOUSE_DRAG,this.dragCallback),e.removeEventListener(V.TOUCH_TAP,this.endCallback),e.removeEventListener(V.TOUCH_END,this.endCallback),e.removeEventListener(V.TOUCH_DRAG,this.dragCallback)}setToolShape(e){this.selectedShape=this.registeredShapes.get(e)??_f.shapeName}renderAnnotation(e,r){const{viewport:n}=e,{element:i}=n,o=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==Cn.Active||!o.includes(n.id)||!this.filterSculptableAnnotationsForElement(i)?.length)return;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};let c=Mi("color",s,ca.Default,this.mode);this.isActive&&(c=Mi("color",s,ca.Highlighted,this.mode)),this.registeredShapes.get(this.selectedShape).renderShape(r,this.commonData.canvasLocation,{color:c})}}function lv(t,e,r=0,n=e.length){n<r&&(n=n+e.length);for(let i=r;i<n;i++)t.push(e[i%e.length])}const o0e=(t,e)=>(t+e)%e;IP.toolName="SculptorTool";const a0e={Z:[0,0,1]};class MP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:a0e.Z,rotateIncrementDegrees:30}}){super(e,r)}mouseWheelCallback(e){const{element:r,wheel:n}=e.detail,i=Ce(r),{viewport:o}=i,{direction:a,rotateIncrementDegrees:s}=this.configuration,c=o.getCamera(),{viewUp:l,position:d,focalPoint:u}=c,{direction:f}=n,[h,g,p]=u,[v,w,m]=a,y=f*(s*Math.PI)/180,C=[0,0,0],x=[0,0,0],S=[0,0,0],T=It(new Float32Array(16));Xn(T,T,[h,g,p]),Zr(T,T,y,[v,w,m]),Xn(T,T,[-h,-g,-p]),Vt(C,d,T),Vt(x,u,T),It(T),Zr(T,T,y,[v,w,m]),Vt(S,l,T),o.setCamera({position:C,viewUp:S,focalPoint:x}),o.render()}}MP.toolName="VolumeRotateMouseWheel";const Vf=class Vf extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:s0e,changeTextCallback:c0e,preventHandleOutsideImage:!1}}){super(e,r),this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{annotationUID:l}=i,d=i.data.handles.points[0],u=c.worldToCanvas(d);if(Bn(o,u)<a)return!0;const h=n.querySelector("svg");if(!h)return!1;const g=h.querySelector(`g[data-annotation-uid="${l}"]`);if(!g)return!1;const p=g,v=p.getBBox(),w=p.getAttribute("transform");let m=0,y=0;if(w){const T=w.match(/translate\(([-\d.]+)\s+([-\d.]+)\)/);T&&(m=parseFloat(T[1]),y=parseFloat(T[2]))}const C=v.x+m,x=v.y+y;return o[0]>=C&&o[0]<=C+v.width&&o[1]>=x&&o[1]<=x+v.height},this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,newAnnotation:!0,viewportIdsToRender:l,offset:[0,0,0]},n.preventDefault(),Me(l),this.configuration.getTextCallback(d=>{if(!d){kt(c.annotationUID),Me(l),this.isDrawing=!1;return}Nt(a),c.data.label=d,xn(c),Me(l)}),this.createMemo(a,c,{newAnnotation:!0}),c},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a,currentPoints:s}=o;i.highlighted=!0;const c=vt(a,this.getToolName());let l=[0,0,0];if(s&&s.world){const d=s.world,u=i.data.handles.points[0];l=[u[0]-d[0],u[1]-d[1],u[2]-d[2]]}this.editData={annotation:i,viewportIdsToRender:c,offset:l},this._activateModify(a),St(a),Me(c),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData;this._deactivateDraw(o),this._deactivateModify(o),Nt(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a)},this._dragCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,offset:d}=this.editData;d?c.data.handles.points[0]=[s[0]+d[0],s[1]+d[1],s[2]+d[2]]:c.data.handles.points[0]=[...s],c.invalidated=!0,Me(l),Gt(c,a,At.LabelChange)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length)return o;c=this.filterInteractableAnnotationsForElement(s,c);const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const u=c[d],{annotationUID:f,data:h}=u,g=h.handles.points[0];l.annotationUID=f;const p=a.worldToCanvas(g);if(o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(f)||!h.label)continue;const v=this.getLinkedTextBoxStyle(l,u);ac(i,f,"1",[h.label],p,{...v,padding:0})}return o}}handleSelectedCallback(e,r,n,i){}_doneChangingTextCallback(e,r,n){r.data.label=n;const i=vt(e,this.getToolName());Me(i),Gt(r,e)}_isInsideVolume(e,r,n){return Sr(e,n)&&Sr(r,n)}};Vf.toolName="Label",Vf.hydrate=(e,r,n,i)=>{const o=wn(e);if(!o)return;const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:c,viewUp:l}=a.getCamera(),d=new Vf,u=d.getReferencedImageId(a,r,c,l),f={annotationUID:i?.annotationUID||cn(),data:{label:n,handles:{points:[r]}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:d.getToolName(),viewPlaneNormal:c,FrameOfReferenceUID:s,referencedImageId:u,...i}};Ft(f,a.element),Me([a.id])};let C1=Vf;function s0e(t){return t(prompt("Enter your annotation:"))}function c0e(t,e,r){return r(prompt("Enter your annotation:"))}C1.toolName="Label";var sa;let l0e=(sa=class extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:u0e,actions:{undo:{method:"undo",bindings:[{key:"z"}]},redo:{method:"redo",bindings:[{key:"y"}]}}}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[d,u]=l.handles.points,f=c.worldToCanvas(d),h=c.worldToCanvas(u),g={start:{x:f[0],y:f[1]},end:{x:h[0],y:h[1]}};return yr([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;c&&!l||(d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&xn(a),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:d}),l){const{deltaPoints:f}=i,h=f.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:f}=i,h=f.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:f}=i,h=f.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:m,lineWidth:y,lineDash:C,shadow:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=v.map(F=>a.worldToCanvas(F));if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(h,d,n)):h.invalidated&&this._throttledCalculateCachedStats(h,d,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let T;if(!or(g))continue;!ir(g)&&!this.editData&&w!==null&&(T=[S[w]]);const _=!!Mi("showHandlesAlways",{});(T||_)&&kn(i,g,"0",S,{color:m,lineDash:C,lineWidth:y});const E=`${g}-line`;if(qt(i,g,"1",S[0],S[1],{color:m,width:y,lineDash:C,shadow:x},E),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const b=this.getLinkedTextBoxStyle(u,h);if(!b.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const I=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const F=to(S);p.handles.textBox.worldPosition=a.canvasToWorld(F)}const O=a.worldToCanvas(p.handles.textBox.worldPosition),R=gi(i,g,"1",I,O,S,{},b),{x:A,y:G,width:k,height:L}=R;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([A,G]),topRight:a.canvasToWorld([A+k,G]),bottomLeft:a.canvasToWorld([A,G+L]),bottomRight:a.canvasToWorld([A+k,G+L])}}return o},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(d=>d===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o),Me(l),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport,{cachedStats:a}=i,s=Object.keys(a);for(let l=0;l<s.length;l++){const d=s[l],u=this.getTargetImageData(d);if(!u)continue;const{imageData:f,dimensions:h}=u,g=i.handles.points.map(y=>f.worldToIndex(y)),p=_o(u,g),{unit:v}=p,w=sa.calculateLengthInIndex(p,g);this.isHandleOutsideImage=!sa.isInsideVolume(h,g);const m={name:"length",value:w,unit:v,type:Wo.Linear};a[d]={length:w,unit:v,statsArray:[m]}}const c=e.invalidated;return e.invalidated=!1,c&&Gt(e,o,At.StatsUpdated),a}},sa.toolName="Length",sa.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=sa.hydrateBase(sa,i,r,n),{toolInstance:d,...u}=n||{},f={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(f,l.element),Me([l.id])},sa);function u0e(t,e){const r=t.cachedStats[e],{length:n,unit:i}=r;return n==null||isNaN(n)?void 0:[`${Ht(n)} ${i}`]}const{transformWorldToIndex:D_}=hn,Px=class Px extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:d0e}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[d,u]=l.handles.points,f=c.worldToCanvas(d),h=c.worldToCanvas(u),g={start:{x:f[0],y:f[1]},end:{x:h[0],y:h[1]}};return yr([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a),Ce(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const u=Ce(o),{renderingEngine:f}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&xn(a),this.editData=null,this.isDrawing=!1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:d}),l){const{deltaPoints:g}=i,p=g.world,{textBox:v}=u.handles,{worldPosition:w}=v;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],v.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;u.handles.points.forEach(w=>{w[0]+=p[0],w[1]+=p[1],w[2]+=p[2]}),a.invalidated=!0}else{const{currentPoints:g}=i,p=g.world;u.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0;const f=Ce(o),{renderingEngine:h}=f;Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Ce(n),Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:m,lineWidth:y,lineDash:C,shadow:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=v.map(L=>a.worldToCanvas(L));let T;if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(h,d,n)):h.invalidated&&this._throttledCalculateCachedStats(h,d,n),!or(g))continue;!ir(g)&&!this.editData&&w!==null&&(T=[S[w]]);const _=!!Mi("showHandlesAlways",{});if((T||_)&&kn(i,g,"0",S,{color:m,lineDash:C,lineWidth:y}),e7(i,g,"0",S[0],S[1],{color:m,width:y,lineDash:C}),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const D=this.getLinkedTextBoxStyle(u,h);if(!D.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const b=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const L=to(S);p.handles.textBox.worldPosition=a.canvasToWorld(L)}const I=a.worldToCanvas(p.handles.textBox.worldPosition),M=gi(i,g,"1",b,I,S,{},D),{x:R,y:A,width:G,height:k}=M;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([R,A]),topRight:a.canvasToWorld([R+G,A]),bottomLeft:a.canvasToWorld([R,A+k]),bottomRight:a.canvasToWorld([R+G,A+k])}}return o},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o);const d=Ce(o),{renderingEngine:u}=d;Me(l),e.preventDefault()}_calculateHeight(e,r){const n=r[0]-e[0],i=r[1]-e[1],o=r[2]-e[2];if(n==0)return i!=0?Math.abs(o):0;if(i==0)return Math.abs(o);if(o==0)return Math.abs(i)}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport,a=i.handles.points[0],s=i.handles.points[1],{cachedStats:c}=i,l=Object.keys(c);for(let u=0;u<l.length;u++){const f=l[u],h=this.getTargetImageData(f);if(!h)continue;const{imageData:g,dimensions:p}=h,v=D_(g,a),w=D_(g,s),m=[v,w],{scale:y,unit:C}=_o(h,m),x=this._calculateHeight(a,s)/y,S=this._isInsideVolume(v,w,p);this.isHandleOutsideImage=S,c[f]={height:x,unit:C}}const d=e.invalidated;return e.invalidated=!1,d&&Gt(e,o,At.StatsUpdated),c}_isInsideVolume(e,r,n){return Sr(e,n)&&Sr(r,n)}};Px.toolName="Height";let Hy=Px;function d0e(t,e){const r=t.cachedStats[e],{height:n,unit:i}=r;return n==null||isNaN(n)?void 0:[`${Ht(n)} ${i}`]}const{transformWorldToIndex:f0e}=hn,Hc=class Hc extends Un{constructor(e={},r){super(e,Un.mergeDefaultProps(Hc.probeDefaults,r)),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const d=this.constructor.createAnnotationForViewport(l,{data:{handles:{points:[[...s]]}}});Ft(d,a);const u=vt(a,this.getToolName());return this.editData={annotation:d,newAnnotation:!0,viewportIdsToRender:u},this._activateModify(a),St(a),n.preventDefault(),Me(u),d},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{viewportId:l,renderingEngine:d}=Ce(o);this.eventDispatchDetail={viewportId:l,renderingEngineId:d.id},this._deactivateModify(o),Nt(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,newAnnotation:d}=this.editData,{data:u}=c;this.createMemo(a,c,{newAnnotation:d}),u.handles.points[0]=[...s],c.invalidated=!0,Me(l)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],g=h.annotationUID,p=h.data,v=p.handles.points[0],w=a.worldToCanvas(v);u.annotationUID=g;const{color:m,lineWidth:y}=this.getAnnotationStyle({annotation:h,styleSpecifier:u});if(p.cachedStats||(p.cachedStats={}),!p.cachedStats[l]||p.cachedStats[l].value===null)p.cachedStats[l]={Modality:null,index:null,value:null},this._calculateCachedStats(h,d,n,At.StatsUpdated);else if(h.invalidated&&(this._calculateCachedStats(h,d,n),a instanceof Gn)){const{referencedImageId:T}=h.metadata;for(const _ in p.cachedStats)_.startsWith("imageId")&&d.getStackViewports().find(b=>{const I=Yn(T),O=b.hasImageURI(I),M=Yn(b.getCurrentImageId());return O&&M!==I})&&delete p.cachedStats[_]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(g))continue;kn(i,g,"0",[w],{color:m,lineWidth:y,handleRadius:this.configuration.handleRadius}),o=!0;const x=this.getLinkedTextBoxStyle(u,h);if(!x.visibility)continue;const S=this.configuration.getTextLines(p,l);if(S){const T=[w[0]+this.configuration.textCanvasOffset.x,w[1]+this.configuration.textCanvasOffset.y];ac(i,g,"0",S,[T[0],T[1]],x)}}return o}}isPointNearTool(e,r,n,i){const o=Ce(e),{viewport:a}=o,{data:s}=r,c=s.handles.points[0],l=a.worldToCanvas(c);return Bn(n,l)<i}toolSelectedCallback(){}getHandleNearImagePoint(e,r,n,i){const o=Ce(e),{viewport:a}=o,{data:s}=r,c=s.handles.points[0],l=a.worldToCanvas(c);if(Bn(n,l)<i===!0)return c}handleSelectedCallback(e,r){const n=e.detail,{element:i}=n;r.highlighted=!0;const o=vt(i,this.getToolName());this.editData={annotation:r,viewportIdsToRender:o},this._activateModify(i),St(i),Me(o),e.preventDefault()}_calculateCachedStats(e,r,n,i=At.StatsUpdated){const o=e.data,{renderingEngineId:a,viewport:s}=n,{element:c}=s,l=o.handles.points[0],{cachedStats:d}=o,u=Object.keys(d);for(let h=0;h<u.length;h++){const g=u[h],p={isPreScaled:dc(s,g),isSuvScaled:this.isSuvScaled(s,g,e.metadata.referencedImageId)},v=this.getTargetImageData(g);if(!v)continue;const{dimensions:w,imageData:m,metadata:y,voxelManager:C}=v,x=y.Modality;let S=f0e(m,l);if(S=gV(S,S),Sr(S,w)){this.isHandleOutsideImage=!1;let T=C.getAtIJKPoint(S);if(g.startsWith("imageId:")){const E=g.split("imageId:")[1],D=Yn(E),I=qp(D)[0];S[2]=I.getCurrentImageIdIndex()}let _;if(x==="US"){const E=d1(v,[S]),D=E.values.every(b=>b!==null);T=D?E.values:T,_=D?E.units:"raw"}else _=fc(x,e.metadata.referencedImageId,p);d[g]={index:S,value:T,Modality:x,modalityUnit:_},e.invalidated=!0}else this.isHandleOutsideImage=!0,d[g]={index:S,Modality:x}}const f=e.invalidated;return e.invalidated=!1,f&&Gt(e,c,i),d}};Hc.toolName="Probe",Hc.probeDefaults={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:h0e,handleRadius:"6",textCanvasOffset:{x:6,y:-6}}},Hc.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,viewUp:c,instance:l,viewport:d}=Hc.hydrateBase(Hc,i,r,n),{toolInstance:u,...f}=n||{},h={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...f}};Ft(h,d.element),Me([d.id])};let x1=Hc;function h0e(t,e){const r=t.cachedStats[e],{index:n,value:i,modalityUnit:o}=r;if(i===void 0||!n)return;const a=[];if(a.push(`(${n[0]}, ${n[1]}, ${n[2]})`),i instanceof Array&&o instanceof Array)for(let s=0;s<i.length;s++)a.push(`${Ht(i[s])} ${o[s]}`);else a.push(`${Ht(i)} ${o}`);return a}const Rx=class Rx extends x1{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:g0e}}){super(e,r),this.postMouseDownCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:d}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:f,viewUp:h}=u,g=this.getReferencedImageId(l,s,f,h),p={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...h],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:g},data:{label:"",handles:{points:[[...s]]},cachedStats:{}}},v=vt(a,this.getToolName());return this.editData={annotation:p,newAnnotation:!0,viewportIdsToRender:v},this._activateModify(a),St(a),n.preventDefault(),Me(v),p},this.postTouchStartCallback=n=>this.postMouseDownCallback(n),this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;if(!this.editData||!this.filterInteractableAnnotationsForElement(a.element,[this.editData.annotation])?.length)return o;const c=this.getTargetId(a),l=a.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=this.editData.annotation,f=u.annotationUID,h=u.data,g=h.handles.points[0],p=a.worldToCanvas(g);d.annotationUID=f;const{color:v}=this.getAnnotationStyle({annotation:u,styleSpecifier:d});if(!h.cachedStats[c]||h.cachedStats[c].value===null?(h.cachedStats[c]={Modality:null,index:null,value:null},this._calculateCachedStats(u,l,n)):u.invalidated&&this._calculateCachedStats(u,l,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;kn(i,f,"0",[p],{color:v}),o=!0;const m=this.configuration.getTextLines(h,c);if(m){const y=[p[0]+6,p[1]-6];ac(i,f,"0",m,[y[0],y[1]],this.getLinkedTextBoxStyle(d,u))}return o}}};Rx.toolName="DragProbe";let Xy=Rx;function g0e(t,e){const r=t.cachedStats[e],{index:n,value:i,modalityUnit:o}=r;if(i===void 0)return;const a=[];return a.push(`(${n[0]}, ${n[1]}, ${n[2]})`),a.push(`${i.toFixed(2)} ${o}`),a}const{transformWorldToIndex:I_}=hn,v0=class v0 extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,calculateStats:!0,getTextLines:p0e,statsCalculator:is}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s],[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,centerWorld:s,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:d}=l.handles,u=d.map(_=>c.worldToCanvas(_)),[f,h,g,p]=u,v=Math.hypot(g[0]-p[0],g[1]-p[1]),w=Math.hypot(h[0]-f[0],h[1]-f[1]),m=Math.atan2(g[1]-p[1],g[0]-p[0]),y=[(g[0]+p[0])/2,(h[1]+f[1])/2],C={center:y,xRadius:(v-a)/2,yRadius:(w-a)/2,angle:m},x={center:y,xRadius:(v+a)/2,yRadius:(w+a)/2,angle:m},S=this._pointInEllipseCanvas(C,o);return!!(this._pointInEllipseCanvas(x,o)&&!S)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},St(a),this._activateModify(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,d,u,f,h,g,p;if(o.worldPosition)l=!0;else{const{points:w}=c.handles,{viewport:m}=Ce(s),{worldToCanvas:y,canvasToWorld:C}=m;d=w.findIndex(S=>S===o);const x=w.map(y);p=x[d],h=Math.abs(x[2][0]-x[3][0]),g=Math.abs(x[0][1]-x[1][1]),u=[(x[2][0]+x[3][0])/2,(x[0][1]+x[1][1])/2],f=C(u)}const v=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:v,handleIndex:d,canvasWidth:h,canvasHeight:g,centerWorld:f,originalHandleCanvas:p,movingTextBox:l},this._activateModify(s),St(s),Me(v),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;c&&!l||(this.doneEditMemo(),a.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{viewport:l}=c,{canvasToWorld:d}=l,{annotation:u,viewportIdsToRender:f,centerWorld:h,newAnnotation:g}=this.editData;this.createMemo(o,u,{newAnnotation:g});const p=l.worldToCanvas(h),{data:v}=u,w=Math.abs(s[0]-p[0]),m=Math.abs(s[1]-p[1]),y=[p[0],p[1]-m],C=[p[0],p[1]+m],x=[p[0]-w,p[1]],S=[p[0]+w,p[1]];v.handles.points=[d(y),d(C),d(x),d(S)],u.invalidated=!0,this.editData.hasMoved=!0,Me(f),Gt(u,o,At.HandlesUpdated)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:u}=a;if(l){const{deltaPoints:g}=i,p=g.world,{textBox:v}=u.handles,{worldPosition:w}=v;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],v.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;u.handles.points.forEach(w=>{w[0]+=p[0],w[1]+=p[1],w[2]+=p[2]}),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;const f=Ce(o),{renderingEngine:h}=f;Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,{viewport:a}=Ce(o),{canvasToWorld:s,worldToCanvas:c}=a,{annotation:l,canvasWidth:d,canvasHeight:u,handleIndex:f,centerWorld:h,originalHandleCanvas:g}=this.editData,p=a.worldToCanvas(h),{data:v}=l,{points:w}=v.handles,{currentPoints:m}=i,y=m.canvas;if(f===0||f===1){const C=Math.abs(y[1]-p[1]),x=[p[0],p[1]-C],S=[p[0],p[1]+C];w[0]=s(x),w[1]=s(S);const T=y[0]-g[0],_=d/2+T,E=[p[0]-_,p[1]],D=[p[0]+_,p[1]];w[2]=s(E),w[3]=s(D)}else{const C=Math.abs(y[0]-p[0]),x=[p[0]-C,p[1]],S=[p[0]+C,p[1]];w[2]=s(x),w[3]=s(S);const T=y[1]-g[1],_=u/2+T,E=[p[0],p[1]-_],D=[p[0],p[1]+_];w[0]=s(E),w[1]=s(D)}},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{handles:v}=p,{points:w,activeHandleIndex:m}=v;u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=w.map(ie=>a.worldToCanvas(ie)),T=Ey(S),{centerPointRadius:_}=this.configuration;if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(h,a,d);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,a,d,n),a instanceof Gn)){const{referencedImageId:ie}=h.metadata;for(const de in p.cachedStats)de.startsWith("imageId")&&d.getStackViewports().find(we=>{const _e=Yn(ie),Se=we.hasImageURI(_e),B=Yn(we.getCurrentImageId());return Se&&B!==_e})&&delete p.cachedStats[de]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let E;if(!or(g))continue;!ir(g)&&!this.editData&&m!==null&&(E=[S[m]]);const D=!!Mi("showHandlesAlways",{});(E||D)&&kn(i,g,"0",D?S:E,{color:y});const b=`${g}-ellipse`,I="0";if(SC(i,g,I,S,{color:y,lineDash:x,lineWidth:C},b),_>0&&Math.min(Math.abs(T[0][0]-T[1][0])/2,Math.abs(T[0][1]-T[1][1])/2)>3*_){const de=this._getCanvasEllipseCenter(S);hi(i,g,`${I}-center`,de,_,{color:y,lineDash:x,lineWidth:C})}o=!0;const O=this.getLinkedTextBoxStyle(u,h);if(!O.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const M=this.configuration.getTextLines(p,l);if(!M||M.length===0)continue;let R;p.handles.textBox.hasMoved||(R=to(T),p.handles.textBox.worldPosition=a.canvasToWorld(R));const A=a.worldToCanvas(p.handles.textBox.worldPosition),k=gi(i,g,"1",M,A,S,{},O),{x:L,y:F,width:j,height:Y}=k;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([L,F]),topRight:a.canvasToWorld([L+j,F]),bottomLeft:a.canvasToWorld([L,F+Y]),bottomRight:a.canvasToWorld([L+j,F+Y])}}return o},this._calculateCachedStats=(n,i,o)=>{if(!this.configuration.calculateStats)return;const a=n.data,{element:s}=i,{points:c}=a.handles,l=c.map(x=>i.worldToCanvas(x)),{viewPlaneNormal:d,viewUp:u}=i.getCamera(),[f,h]=Ey(l),g=i.canvasToWorld(f),p=i.canvasToWorld(h),{cachedStats:v}=a,w=Object.keys(v),m=g,y=p;for(let x=0;x<w.length;x++){const S=w[x],T=this.getTargetImageData(S);if(!T)continue;const{dimensions:_,imageData:E,metadata:D,voxelManager:b}=T,I=I_(E,m);I[0]=Math.floor(I[0]),I[1]=Math.floor(I[1]),I[2]=Math.floor(I[2]);const O=I_(E,y);if(O[0]=Math.floor(O[0]),O[1]=Math.floor(O[1]),O[2]=Math.floor(O[2]),this._isInsideVolume(I,O,_)){const M=Math.min(I[0],O[0]),R=Math.max(I[0],O[0]),A=Math.min(I[1],O[1]),G=Math.max(I[1],O[1]),k=Math.min(I[2],O[2]),L=Math.max(I[2],O[2]),F=[[M,R],[A,G],[k,L]],j=[(g[0]+p[0])/2,(g[1]+p[1])/2,(g[2]+p[2])/2],Y=Math.abs(g[0]-p[0])/2,ie=Math.abs(g[1]-p[1])/2,de=Math.abs(g[2]-p[2])/2,ae={center:j,xRadius:Y<rl/2?0:Y,yRadius:ie<rl/2?0:ie,zRadius:de<rl/2?0:de},{worldWidth:fe,worldHeight:we}=Xh(d,u,m,y),_e=fe===0&&we===0,Se=[I,O],{scale:B,areaUnit:P}=_o(T,Se),$=AC(T),W=Math.abs(Math.PI*(fe/B/2)*(we/$/B/2)),K={isPreScaled:dc(i,S),isSuvScaled:this.isSuvScaled(i,S,n.metadata.referencedImageId)},Q=fc(D.Modality,n.metadata.referencedImageId,K);let ee;b&&(ee=b.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:De=>vm(ae,De,{fast:!0}),boundsIJK:F,imageData:E,returnPoints:this.configuration.storePointData}));const ge=this.configuration.statsCalculator.getStatistics();v[S]={Modality:D.Modality,area:W,mean:ge.mean?.value,max:ge.max?.value,min:ge.min?.value,stdDev:ge.stdDev?.value,statsArray:ge.array,pointsInShape:ee,isEmptyArea:_e,areaUnit:P,modalityUnit:Q}}else this.isHandleOutsideImage=!0,v[S]={Modality:D.Modality}}const C=n.invalidated;return n.invalidated=!1,C&&Gt(n,s,At.StatsUpdated),v},this._isInsideVolume=(n,i,o)=>Sr(n,o)&&Sr(i,o),this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(e,r){const{xRadius:n,yRadius:i,center:o,angle:a}=e,s=TV(xt(),r,o,-a);if(n<=0||i<=0)return!1;const c=[s[0]-o[0],s[1]-o[1]];return c[0]*c[0]/(n*n)+c[1]*c[1]/(i*i)<=1}_getCanvasEllipseCenter(e){const[r,n,i,o]=e,a=[i[0],n[1]],s=[o[0],r[1]];return[(a[0]+s[0])/2,(a[1]+s[1])/2]}};v0.toolName="EllipticalROI",v0.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=v0.hydrateBase(v0,i,r,n),{toolInstance:d,...u}=n||{},f={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(f,l.element),Me([l.id])};let Ky=v0;function p0e(t,e){const r=t.cachedStats[e],{area:n,mean:i,stdDev:o,max:a,isEmptyArea:s,areaUnit:c,modalityUnit:l,min:d}=r,u=[];if(nr(n)){const f=s?"Area: Oblique not supported":`Area: ${Ht(n)} ${c}`;u.push(f)}return nr(i)&&u.push(`Mean: ${Ht(i)} ${l}`),nr(a)&&u.push(`Max: ${Ht(a)} ${l}`),nr(d)&&u.push(`Min: ${Ht(d)} ${l}`),nr(o)&&u.push(`Std Dev: ${Ht(o)} ${l}`),u}const{transformWorldToIndex:M_}=hn,uu=class uu extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,calculateStats:!0,getTextLines:m0e,statsCalculator:is,simplified:!0}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;this.isDrawing=!0;let c;this.configuration.simplified?c=[[...s],[...s]]:c=[[...s],[...s],[...s],[...s],[...s]];const l=this.createAnnotation(n,c);Ft(l,a);const d=vt(a,this.getToolName());return this.editData={annotation:l,viewportIdsToRender:d,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(d),l},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{points:l}=i.data.handles,d=l.map(g=>c.worldToCanvas(g)),u=d[0],f=al([u,d[1]]),h=al([u,o]);return Math.abs(h-f)<a/2},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},St(a),this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,d;if(o.worldPosition)l=!0;else{const{points:f}=c.handles;d=f.findIndex(h=>h===o)}const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:d,movingTextBox:l},this._activateModify(s),St(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;c&&!l||(this.doneEditMemo(),a.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o,currentPoints:a}=i,{world:s,canvas:c}=a,l=Ce(o),{viewport:d}=l,{canvasToWorld:u}=d,{annotation:f,viewportIdsToRender:h,newAnnotation:g}=this.editData;this.createMemo(o,f,{newAnnotation:g});const{data:p}=f,v=p.handles.points[0],w=d.worldToCanvas(v);if(this.configuration.simplified)p.handles.points[1]=s;else{const m=Bn(w,c);p.handles.points[0]=[...v],p.handles.points[1]=u([w[0],w[1]-m]),p.handles.points[2]=u([w[0],w[1]+m]),p.handles.points[3]=u([w[0]-m,w[1]]),p.handles.points[4]=u([w[0]+m,w[1]])}f.invalidated=!0,this.editData.hasMoved=!0,Me(h),Gt(f,o,At.HandlesUpdated)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:u}=a;if(l){const{deltaPoints:f}=i,h=f.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:f}=i,h=f.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{canvasToWorld:s,worldToCanvas:c}=a.viewport,{annotation:l,handleIndex:d}=this.editData,{data:u}=l,{points:f}=u.handles,{currentPoints:h,deltaPoints:g}=i;if(d===0){const p=g.world;f.forEach(v=>{hr(v,v,p)})}else{const p=f[0],v=c(p),w=h.canvas,m=Bn(v,w);f[1]=s([v[0],v[1]-m]),f[2]=s([v[0],v[1]+m]),f[3]=s([v[0]-m,v[1]]),f[4]=s([v[0]+m,v[1]])}l.invalidated=!0},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData;return i.highlighted=!1,i.data.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{handles:v}=p,{points:w,activeHandleIndex:m}=v;u.annotationUID=g;const{color:y,lineWidth:C,lineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=w.map(R=>a.worldToCanvas(R)),T=S[0],_=al([T,S[1]]),E=pu([T,S[1]]),{centerPointRadius:D}=this.configuration;if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(h,a,d,n);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,a,d,n),a instanceof Gn)){const{referencedImageId:R}=h.metadata;for(const A in p.cachedStats)A.startsWith("imageId")&&d.getStackViewports().find(L=>{const F=Yn(R),j=L.hasImageURI(F),Y=Yn(L.getCurrentImageId());return j&&Y!==F})&&delete p.cachedStats[A]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let b;if(!or(g))continue;!ir(g)&&!this.editData&&m!==null&&(this.configuration.simplified?b=[S[m]]:b=S);const I=!!Mi("showHandlesAlways",{});(b||I)&&kn(i,g,"0",I?S:b,{color:y});const O=`${g}-circle`,M="0";if(hi(i,g,M,T,_,{color:y,lineDash:x,lineWidth:C},O),D>0&&_>3*D&&hi(i,g,`${M}-center`,T,D,{color:y,lineDash:x,lineWidth:C}),o=!0,this.configuration.calculateStats){const R=this.getLinkedTextBoxStyle(u,h);if(!R.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(p,l);if(!A||A.length===0)continue;let G;p.handles.textBox.hasMoved||(G=to(E),p.handles.textBox.worldPosition=a.canvasToWorld(G));const k=a.worldToCanvas(p.handles.textBox.worldPosition),F=gi(i,g,"1",A,k,[T,S[1]],{},R),{x:j,y:Y,width:ie,height:de}=F;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([j,Y]),topRight:a.canvasToWorld([j+ie,Y]),bottomLeft:a.canvasToWorld([j,Y+de]),bottomRight:a.canvasToWorld([j+ie,Y+de])}}}return o},this._calculateCachedStats=(n,i,o,a)=>{if(!this.configuration.calculateStats)return;const{data:s}=n,{element:c}=i,l=n.invalidated,{points:d}=s.handles,u=d.map(C=>i.worldToCanvas(C)),f=u[0],h=u[1],[g,p]=pu([f,h]),v=i.canvasToWorld(g),w=i.canvasToWorld(p),{cachedStats:m}=s,y=Object.keys(m);for(let C=0;C<y.length;C++){const x=y[C],S=this.getTargetImageData(x);if(!S)continue;const{dimensions:T,imageData:_,metadata:E,voxelManager:D}=S,b=d.map(ae=>_.worldToIndex(ae)),I=_o(S,b),O=uu.calculateLengthInIndex(I,b),M=Math.PI*O*O,R=2*Math.PI*O,A=O===0,{unit:G,areaUnit:k}=I,L={name:"area",value:M,unit:k,type:Wo.Area},F={name:"circumference",value:R,unit:G,type:Wo.Linear},j={name:"radius",value:O,unit:G,type:Wo.Linear},Y=[L,j,F];m[x]={Modality:E.Modality,area:M,isEmptyArea:A,areaUnit:k,radius:O,radiusUnit:G,perimeter:R,statsArray:Y};const ie=M_(_,v),de=M_(_,w);if(this.isHandleOutsideImage=!ar.isInsideVolume(T,[ie,de]),!this.isHandleOutsideImage){const ae=Math.min(ie[0],de[0]),fe=Math.max(ie[0],de[0]),we=Math.min(ie[1],de[1]),_e=Math.max(ie[1],de[1]),Se=Math.min(ie[2],de[2]),B=Math.max(ie[2],de[2]),P=[[ae,fe],[we,_e],[Se,B]],$=d[0],W=Math.abs(v[0]-w[0])/2,K=Math.abs(v[1]-w[1])/2,Q=Math.abs(v[2]-w[2])/2,ee={center:$,xRadius:W<rl/2?0:W,yRadius:K<rl/2?0:K,zRadius:Q<rl/2?0:Q},ge={isPreScaled:dc(i,x),isSuvScaled:this.isSuvScaled(i,x,n.metadata.referencedImageId)},De=fc(E.Modality,n.metadata.referencedImageId,ge);let Le;D&&(Le=D.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:re=>vm(ee,re,{fast:!0}),boundsIJK:P,imageData:_,returnPoints:this.configuration.storePointData}));const Ge=this.configuration.statsCalculator.getStatistics();m[x]={...m[x],Modality:E.Modality,mean:Ge.mean?.value,max:Ge.max?.value,min:Ge.min?.value,pointsInShape:Le,stdDev:Ge.stdDev?.value,modalityUnit:De,statsArray:[...Y,...Ge.array]}}}return n.invalidated=!1,l&&Gt(n,c,At.StatsUpdated),m},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}};uu.toolName="CircleROI",uu.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=uu.hydrateBase(uu,i,r,n),{toolInstance:d,...u}=n||{},f={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(f,l.element),Me([l.id])};let Ch=uu;function m0e(t,e){const r=t.cachedStats[e],{radius:n,radiusUnit:i,area:o,mean:a,stdDev:s,max:c,min:l,isEmptyArea:d,areaUnit:u,modalityUnit:f}=r,h=[];if(nr(n)){const g=d?"Radius: Oblique not supported":`Radius: ${Ht(n)} ${i}`;h.push(g)}if(nr(o)){const g=d?"Area: Oblique not supported":`Area: ${Ht(o)} ${u}`;h.push(g)}return nr(a)&&h.push(`Mean: ${Ht(a)} ${f}`),nr(c)&&h.push(`Max: ${Ht(c)} ${f}`),nr(l)&&h.push(`Min: ${Ht(l)} ${f}`),nr(s)&&h.push(`Std Dev: ${Ht(s)} ${f}`),h}const Fg=5,Ax=class Ax extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,degrees:[45,135,225,315],diameters:[10,30,60]}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:d}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:f,viewUp:h}=u,g=this.getReferencedImageId(l,s,f,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{label:"",handles:{points:[[...s]]}}};Ft(v,a);const w=vt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,newAnnotation:!0},this._activateDraw(a),St(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{points:d}=l.handles,u=c.worldToCanvas(d[0]),f=al([u,o]);return Math.abs(f)<a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},St(a),this._activateModify(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;a.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const{renderingEngine:u}=Ce(o);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a)},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{renderingEngine:l,viewport:d}=c,{canvasToWorld:u}=d,{annotation:f,viewportIdsToRender:h}=this.editData,{data:g}=f;g.handles.points=[u(s),u(s)],f.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData,{data:c}=a,{deltaPoints:l}=i,d=l.world;c.handles.points.forEach(g=>{g[0]+=d[0],g[1]+=d[1],g[2]+=d[2]}),a.invalidated=!0;const f=Ce(o),{renderingEngine:h}=f;Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,a=Ce(o),{canvasToWorld:s,worldToCanvas:c}=a.viewport,{annotation:l}=this.editData,{data:d}=l,{points:u}=d.handles,f=u.map(y=>c(y)),{currentPoints:h}=i,g=h.canvas,p=g[0]-f[0][0],v=g[1]-f[0][1],w=g,m=[f[1][0]+p,f[1][1]+v];u[0]=s(w),u[1]=s(m)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;i.highlighted=!1,s.handles.activeHandleIndex=null;const{renderingEngine:c}=Ce(n);return Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const u=c[d],{annotationUID:f,data:h}=u,{handles:g}=h,{points:p}=g;l.annotationUID=f;const{color:v,lineWidth:w,lineDash:m}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),C=p.map(b=>a.worldToCanvas(b))[0];if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(f))continue;let x=`${f}-crosshair-vertical`,S=[C[0],C[1]+Fg],T=[C[0],C[1]-Fg];qt(i,f,x,S,T,{color:v,lineDash:m,lineWidth:w}),x=`${f}-crosshair-horizontal`,S=[C[0]+Fg,C[1]],T=[C[0]-Fg,C[1]],qt(i,f,x,S,T,{color:v,lineDash:m,lineWidth:w});const _=this.configuration.diameters.map(b=>this.worldMeasureToCanvas(b,a));for(let b=0;b<_.length;b++){const I=`${f}-circle-${b}`,O=`${f}-circle-${b}`;hi(i,f,O,C,_[b]/2,{color:v,lineDash:m,lineWidth:w},I)}const E=b=>b*Math.PI/180,D=this.configuration.degrees.map(b=>E(b));for(let b=0;b<D.length;b++){const I=`${f}-line-${b}`,O=[Math.cos(D[b])*_[0]/2+C[0],Math.sin(D[b])*_[0]/2+C[1]],M=[Math.cos(D[b])*_[2]/2+C[0],Math.sin(D[b])*_[2]/2+C[1]];qt(i,f,I,O,M,{color:v,lineDash:m,lineWidth:w})}o=!0}return o}}worldMeasureToCanvas(e,r){const n=r.canvasToWorld([r.canvas.width/2,r.canvas.height/2]),{viewUp:i}=r.getCamera(),o=en(Ie(),n,i,e),a=r.worldToCanvas(n),s=r.worldToCanvas(o);return Math.sqrt(Math.pow(s[0]-a[0],2)+Math.pow(s[1]-a[1],2))}};Ax.toolName="ETDRSGrid";let qy=Ax;const O_=3,P_=10,v0e={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var Vs;(function(t){t.Cardinal="CARDINAL",t.Linear="LINEAR",t.CatmullRom="CATMULLROM",t.BSpline="BSPLINE"})(Vs||(Vs={}));var Ef;(function(t){t.AddControlPoint="addControlPoint",t.DeleteControlPoint="deleteControlPoint"})(Ef||(Ef={}));const y0e=["CatmullRomSplineROI","LinearSplineROI","BSplineROI","CardinalSplineROI"],Xc=class Xc extends lh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,simplifiedSpline:!1,getTextLines:w0e,contourHoleAdditionModifierKey:jr.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[Vs.Cardinal]:{Class:yh,scale:.5},[Vs.CatmullRom]:{Class:iP},[Vs.Linear]:{Class:oP},[Vs.BSpline]:{Class:rP,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:Vs.CatmullRom,drawPreviewEnabled:!0,enableTwoPointPreview:!1,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[Ef.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:rs.Primary,modifierKey:jr.Shift}]},[Ef.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:rs.Primary,modifierKey:jr.Ctrl}]}}}}){super(e,r),this.splineToolNames=["CatmullRomSplineROI","LinearSplineROI","BSplineROI","CardinalSplineROI"],this.isHandleOutsideImage=!1,this.fireChangeOnUpdate=null,this.isPointNearTool=(n,i,o,a)=>{const{instance:s}=i.data.spline;return s.isPointNearCurve(o,a)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,d;if(o.worldPosition)l=!0;else{const{points:f}=c.handles;d=f.findIndex(h=>h===o)}const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:d,movingTextBox:l},this._activateModify(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,contourHoleProcessingEnabled:l}=this.editData,{data:d}=a;a.autoGenerated=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o);const u=Ce(o),f=this.getTargetImageData(this.getTargetId(u.viewport)),{imageData:h,dimensions:g}=f;this.isHandleOutsideImage=d.handles.points.map(v=>br(h,v)).some(v=>!Sr(v,g)),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID);const p=c?At.Completed:At.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=a.annotationUID,this.fireChangeOnUpdate.changeType=p):this.fireChangeOnUpdate={annotationUID:a.annotationUID,changeType:p,contourHoleProcessingEnabled:l},Me(s),this.doneEditMemo(),this.editData=null,this.isDrawing=!1},this._keyDownCallback=n=>{const i=n.detail,{element:o}=i,a=i.key??"",{lastControlPointDeletionKeys:s}=this.configuration.spline;if(!s.includes(a))return;const{annotation:l}=this.editData,{data:d}=l;if(d.handles.points.length===O_){this.cancel(o);return}else{const u=d.handles.points.length-1;this._deleteControlPointByIndex(o,l,u)}n.preventDefault()},this._mouseMoveCallback=n=>{const{drawPreviewEnabled:i}=this.configuration.spline;if(!i)return;const{element:o}=n.detail,{renderingEngine:a}=Ce(o),s=vt(o,this.getToolName());this.editData.lastCanvasPoint=n.detail.currentPoints.canvas,Me(s),n.preventDefault()},this._mouseDownCallback=n=>{const i=n.type===V.MOUSE_DOUBLE_CLICK,{annotation:o,viewportIdsToRender:a}=this.editData,{data:s}=o;if(s.contour.closed)return;this.doneEditMemo();const c=n.detail,{currentPoints:l,element:d}=c,{canvas:u,world:f}=l;let h=s.handles.points.length>=2&&i,g=!0;if(s.handles.points.length&&this.createMemo(d,o,{newAnnotation:s.handles.points.length===1}),s.handles.points.length>=3){this.createMemo(d,o);const{instance:p}=s.spline;p.getClosestControlPointWithinDistance(u,P_)?.index===0&&(g=!1,h=!0)}g&&s.handles.points.push(f),s.contour.closed=s.contour.closed||h,o.invalidated=!0,Me(a),s.contour.closed&&this._endCallback(n),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:d}),l){const{deltaPoints:g}=i,p=g.world,{textBox:v}=u.handles,{worldPosition:w}=v;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],v.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;this.moveAnnotation(a,p)}else{const{currentPoints:g}=i,p=g.world;u.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0;const f=Ce(o),{renderingEngine:h}=f;Me(s)},this.triggerAnnotationCompleted=(n,i)=>{const o=V.ANNOTATION_COMPLETED,a={annotation:n,changeType:At.Completed,contourHoleProcessingEnabled:i};Ye(Fe,o,a)},this.triggerAnnotationModified=(n,i,o=At.StatsUpdated)=>{const{viewportId:a,renderingEngineId:s}=i,c=V.ANNOTATION_MODIFIED;Ye(Fe,c,{annotation:n,viewportId:a,renderingEngineId:s,changeType:o})},this.triggerChangeEvent=(n,i,o=At.StatsUpdated,a)=>{o===At.Completed?this.triggerAnnotationCompleted(n,a):this.triggerAnnotationModified(n,i,o)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.KEY_DOWN,this._keyDownCallback),n.addEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.addEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.KEY_DOWN,this._keyDownCallback),n.removeEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.removeEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._renderStats=(n,i,o,a)=>{const s=n.data,c=this.getTargetId(i);if(!s.spline.instance.closed||!a.visibility)return;const l=this.configuration.getTextLines(s,c);if(!l||l.length===0)return;const d=s.handles.points.map(m=>i.worldToCanvas(m));if(!s.handles.textBox.hasMoved){const m=to(d);s.handles.textBox.worldPosition=i.canvasToWorld(m)}const u=i.worldToCanvas(s.handles.textBox.worldPosition),h=gi(o,n.annotationUID??"","textBox",l,u,d,{},a),{x:g,y:p,width:v,height:w}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([g,p]),topRight:i.canvasToWorld([g+v,p]),bottomLeft:i.canvasToWorld([g,p+w]),bottomRight:i.canvasToWorld([g+v,p+w])}},this.addControlPointCallback=(n,i)=>{const{data:o}=i,a=o.spline.type,s=this._getSplineConfig(a),c=s.controlPointAdditionDistance;if(s.controlPointAdditionEnabled===!1)return;const l=n.detail,{element:d}=l,u=Ce(d),{renderingEngine:f,viewport:h}=u,{canvasToWorld:g}=h,{instance:p}=o.spline,v=n.detail.currentPoints.canvas,w=p.getClosestPoint(v);if(w.distance>c)return;const{index:m,point:y}=p.addControlPointAtU(w.uValue);o.handles.points.splice(m,0,g(y)),i.invalidated=!0;const C=vt(d,this.getToolName());Me(C)},this.deleteControlPointCallback=(n,i)=>{const o=i.data.spline.type,a=this._getSplineConfig(o),s=a.controlPointDeletionDistance;if(a.controlPointDeletionEnabled===!1)return;const c=n.detail,{element:l,currentPoints:d}=c,{canvas:u}=d,{instance:f}=i.data.spline,h=f.getClosestControlPointWithinDistance(u,s);h&&this._deleteControlPointByIndex(l,i,h.index)},this._calculateCachedStats=(n,i)=>{if(!this.configuration.calculateStats)return;const o=n.data;if(!o.contour.closed)return;const a=Ce(i);if(!a)return;const{viewport:s}=a,{cachedStats:c}=o,{polyline:l}=o.contour,d=Object.keys(c);for(let f=0;f<d.length;f++){const h=d[f],g=this.getTargetImageData(h);if(!g)continue;const{metadata:p}=g,v=l.map(b=>s.worldToCanvas(b)),w=v[0],m=s.canvasToWorld(w),y=s.canvasToWorld([w[0]+1,w[1]]),C=s.canvasToWorld([w[0],w[1]+1]),x=Dr(m,y),S=Dr(m,C),{imageData:T}=g,{scale:_,areaUnit:E}=_o(g,()=>{const{maxX:b,maxY:I,minX:O,minY:M}=gl(v),R=s.canvasToWorld([O,M]),A=br(T,R),G=s.canvasToWorld([b,I]),k=br(T,G);return[A,k]});let D=$h(v)/_/_;D*=x*S,c[h]={Modality:p.Modality,area:D,areaUnit:E}}const u=n.invalidated;return n.invalidated=!1,u&&this.triggerAnnotationModified(n,a,At.StatsUpdated),c},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0}),this.annotationCompletedBinded=this.annotationCompleted.bind(this)}annotationCompleted(e){const{sourceAnnotation:r}=e.detail;!this.splineToolNames.includes(r?.metadata?.toolName)||!this.configuration.simplifiedSpline||!this.isContourSegmentationTool()||hC(r)}initializeListeners(){Fe.addEventListener(V.ANNOTATION_COMPLETED,this.annotationCompletedBinded)}removeListeners(){Fe.removeEventListener(V.ANNOTATION_COMPLETED,this.annotationCompletedBinded)}onSetToolEnabled(){this.initializeListeners()}onSetToolActive(){this.initializeListeners()}onSetToolDisabled(){this.removeListeners()}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{canvas:o}=n,a=md(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,s=this.createAnnotation(e);this.isDrawing=!0,this.addAnnotation(s,i);const c=vt(i,this.getToolName());return this.editData={annotation:s,viewportIdsToRender:c,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:o,contourHoleProcessingEnabled:a},this._activateDraw(i),e.preventDefault(),Me(c),s}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e);const{annotation:r,viewportIdsToRender:n,newAnnotation:i}=this.editData;i&&kt(r.annotationUID),super.cancelAnnotation(r);const o=Ce(e),{renderingEngine:a}=o;return Me(n),this.editData=null,r.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(e){const{enabledElement:r,targetId:n,svgDrawingHelper:i,annotationStyle:o}=e,{viewport:a}=r,{worldToCanvas:s}=a,{element:c}=a,l=e.annotation,{annotationUID:d,data:u,highlighted:f}=l,{handles:h}=u,{points:g,activeHandleIndex:p}=h,v=this.editData?.newAnnotation,{lineWidth:w,lineDash:m,color:y,locked:C}=o,x=g.map(M=>s(M)),{drawPreviewEnabled:S}=this.configuration.spline,T=l.data.spline.type,_=this._getSplineConfig(T),E=l.data.spline.instance,D=Fh(l);if(D.findIndex(M=>!M)!==-1)throw new Error(`Can't find annotation for child ${l.childAnnotationUIDs.join()}`);[l,...D].filter(M=>this._isSplineROIAnnotation(M)).forEach(M=>{const A=this._updateSplineInstance(c,M).getPolylinePoints();this.updateContourPolyline(M,{points:A,closed:u.contour.closed,targetWindingDirection:Wi.Clockwise},a,{updateWindingDirection:u.contour.closed})}),super.renderAnnotationInstance(e),!u.cachedStats[n]||u.cachedStats[n].areaUnit==null?(u.cachedStats[n]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(l,c)):l.invalidated&&this._throttledCalculateCachedStats(l,c);let O;if(!C&&!this.editData&&p!==null&&(O=[x[p]]),(O||v||f)&&kn(i,d,"0",x,{color:y,lineWidth:w,handleRadius:"3"}),S&&E.numControlPoints>=1&&this.editData?.lastCanvasPoint&&!E.closed){const{lastCanvasPoint:M}=this.editData,{enableTwoPointPreview:R}=this.configuration.spline;if(E.numControlPoints===1&&R){const G=[x[0],M];jo(i,d,"previewSplineChange",G,{color:"#9EA0CA",lineDash:m,lineWidth:1})}else if(E.numControlPoints>1){const A=E.getPreviewPolylinePoints(M,P_);jo(i,d,"previewSplineChange",A,{color:"#9EA0CA",lineDash:m,lineWidth:1})}}if(_.showControlPointsConnectors){const M=[...x];E.closed&&M.push(x[0]),jo(i,d,"controlPointsConnectors",M,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(l,a,i,o.textbox),this.fireChangeOnUpdate?.annotationUID===d&&(this.triggerChangeEvent(l,r,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),l.invalidated=!1,!0}createInterpolatedSplineControl(e){if(e.data.handles.points?.length)return;const{polyline:r}=e.data.contour;if(!r||!r.length)return;e.data.handles.points=[];const{points:n}=e.data.handles,i=Math.max(10,Math.floor(r.length/20));for(let o=0;o<r.length-i;o+=i)n.push(r[o]);n.push(r[r.length-1])}isSplineAnnotation(e){return y0e.includes(e?.metadata?.toolName)}createSplineObjectFromType(e,r){const n=this._getSplineConfig(r),i=new n.Class;e.data.spline={type:n.type,instance:i,resolution:n.resolution}}createAnnotation(e){const r=super.createAnnotation(e),{world:n}=e.detail.currentPoints,{type:i}=this.configuration.spline,o=this._getSplineConfig(i),a=new o.Class,s=()=>({type:o.type,instance:a,resolution:o.resolution});let c;return this.configuration.interpolation?.enabled&&(c=l=>{l.data.spline||=s(),this.createInterpolatedSplineControl(l)}),kr(r,{data:{handles:{points:[[...n]]},spline:s(),cachedStats:{}},onInterpolationComplete:c})}_deleteControlPointByIndex(e,r,n){const i=Ce(e),{points:o}=r.data.handles;o.length===3?kt(r.annotationUID):o.splice(n,1);const{renderingEngine:a}=i,s=vt(e,this.getToolName());r.invalidated=!0,Me(s)}_isSplineROIAnnotation(e){return!!e.data?.spline}_getSplineConfig(e){const{configuration:r}=this,n=r.spline.configuration;return Object.assign({type:e},v0e,n[e])}_updateSplineInstance(e,r){const n=Ce(e),{viewport:i}=n,{worldToCanvas:o}=i,{data:a}=r,{type:s,instance:c}=r.data.spline,l=this._getSplineConfig(s),u=a.handles.points.map(o),f=l.resolution!==void 0?parseInt(l.resolution):void 0,h=l.scale!==void 0?parseFloat(l.scale):void 0;return c.setControlPoints(u),c.closed=!!a.contour.closed,!c.fixedResolution&&f!==void 0&&c.resolution!==f&&(c.resolution=f,r.invalidated=!0),c instanceof yh&&!c.fixedScale&&h!==void 0&&c.scale!==h&&(c.scale=h,r.invalidated=!0),c}};Xc.toolName="SplineROI",Xc.SplineTypes=Vs,Xc.Actions=Ef,Xc.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;if(r.length<O_){console.warn("Spline requires at least 3 control points");return}const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,viewUp:c,instance:l,viewport:d}=Xc.hydrateBase(Xc,i,r,n),u=n?.splineType||Vs.CatmullRom,h=l._getSplineConfig(u).Class,g=new h,{toolInstance:p,...v}=n||{},w={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r},label:"",cachedStats:{},spline:{type:u,instance:g},contour:{closed:!0}},highlighted:!1,autoGenerated:!1,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...v}};Ft(w,d.element),Me([d.id])};let S1=Xc;function w0e(t,e){const r=t.cachedStats[e],{area:n,isEmptyArea:i,areaUnit:o}=r,a=[];if(n){const s=i?"Area: Oblique not supported":`Area: ${Ht(n)} ${o}`;a.push(s)}return a}const Lx=class Lx extends S1{constructor(e){const r=kr({configuration:{calculateStats:!1}},e);super(r),this.annotationCutMergeCompletedBinded=this.annotationCutMergeCompleted.bind(this)}isContourSegmentationTool(){return!0}initializeListeners(){Fe.addEventListener(V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,this.annotationCutMergeCompletedBinded)}removeListeners(){Fe.removeEventListener(V.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED,this.annotationCutMergeCompletedBinded)}annotationCutMergeCompleted(e){const{sourceAnnotation:r}=e.detail;this.toolName!==r?.metadata?.toolName||!this.splineToolNames.includes(r?.metadata?.toolName)||!this.configuration.simplifiedSpline||hC(r)}};Lx.toolName="SplineContourSegmentationTool";let Yy=Lx;class C0e{constructor({numBits:e,getPriority:r,areEqual:n}){this._bucketCount=1<<e,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=typeof r<"u"?r:i=>i,this._areEqual=typeof n=="function"?n:(i,o)=>i===o}push(e){const r=this._getBucketIndex(e),n=this._buckets[r],i={value:e,next:n};this._buckets[r]=i,this._size++}pop(){if(this._size===0)throw new Error("Cannot pop because the queue is empty.");for(;this._buckets[this._currentBucketIndex]===null;)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const e=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=e.next,this._size--,e.value}remove(e){if(!e)return!1;const r=this._getBucketIndex(e),n=this._buckets[r];let i=n,o;for(;i!==null&&!this._areEqual(e,i.value);)o=i,i=i.next;return i===null?!1:(i===n?this._buckets[r]=i.next:o.next=i.next,this._size--,!0)}isEmpty(){return this._size===0}_getBucketIndex(e){return this._getPriority(e)&this._mask}_buildArray(e){const r=new Array(e);return r.fill(null),r}}const uv=4294967295,x0e=2/(3*Math.PI);class T1{constructor(e,r,n){this._getPointIndex=(o,a)=>{const{width:s}=this;return o*s+a},this._getPointCoordinate=o=>{const a=o%this.width,s=Math.floor(o/this.width);return[a,s]},this._getPointCost=o=>Math.round(this.searchGranularity*this.costs[o]);const i=e.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=r,this.height=n,this.grayscalePixelData=e,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(i),this.parents=new Uint32Array(i),this.costs=new Float32Array(i)}startSearch(e){const r=this._getPointIndex(e[1],e[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(uv),this.costs.fill(1/0),this.priorityQueueNew=new C0e({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=e,this.costs[r]=0,this.priorityQueueNew.push(r)}findMinNearby(e,r=2){const[n,i]=e,{costs:o}=this,a=[Math.max(0,n-r),Math.min(n+r+1,this.width)],s=[Math.max(0,i-r),Math.min(i+r+1,this.height)];let c=o[this._getPointIndex(i,n)]*.8,l=e;for(let d=a[0];d<a[1];d++)for(let u=s[0];u<s[1];u++){const f=1-(Math.abs(d-e[0])+Math.abs(u-e[1]))/r/2,g=o[this._getPointIndex(u,d)]*.8+f*.2;g<c&&(l=[d,u],c=g)}return l}findPathToPoint(e){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:r,_getPointIndex:n,_getPointCoordinate:i}=this,o=n(r[1],r[0]),a=n(e[1],e[0]),{visited:s,parents:c,costs:l,priorityQueueNew:d}=this;if(a===o)return[];for(;!d.isEmpty()&&c[a]===uv;){const h=d.pop();if(s[h])continue;const g=i(h),p=this._getNeighborPoints(g);s[h]=!0;for(let v=0,w=p.length;v<w;v++){const m=p[v],y=n(m[1],m[0]),C=this._getWeightedDistance(g,m),x=l[h]+C;x<l[y]&&(l[y]!==1/0&&d.remove(y),l[y]=x,c[y]=h,d.push(y))}}const u=[];let f=a;for(;f!==uv;)u.push(i(f)),f=c[f];return u.reverse()}_getDeltaX(e,r){const{grayscalePixelData:n,width:i}=this;let o=this._getPointIndex(r,e);return e+1===i&&o--,n[o+1]-n[o]}_getDeltaY(e,r){const{grayscalePixelData:n,width:i,height:o}=this;let a=this._getPointIndex(r,e);return r+1===o&&(a-=i),n[a]-n[a+i]}_getGradientMagnitude(e,r){const n=this._getDeltaX(e,r),i=this._getDeltaY(e,r);return Math.sqrt(n*n+i*i)}_getLaplace(e,r){const{grayscalePixelData:n,_getPointIndex:i}=this,o=n[i(r-2,e)],a=n[i(r-1,e-1)],s=n[i(r-1,e)],c=n[i(r-1,e+1)],l=n[i(r,e-2)],d=n[i(r,e-1)],u=n[i(r,e)],f=n[i(r,e+1)],h=n[i(r,e+2)],g=n[i(r+1,e-1)],p=n[i(r+1,e)],v=n[i(r+1,e+1)],w=n[i(r+2,e)];let m=o;return m+=a+2*s+c,m+=l+2*d-16*u+2*f+h,m+=g+2*p+v,m+=w,m}_computeGradient(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0,o=0,a=0,s=0;for(s=0;s<r-1;s++){for(a=0;a<e-1;a++)n[i]=this._getGradientMagnitude(a,s),o=Math.max(n[i],o),i++;n[i]=n[i-1],i++}for(let c=n.length;i<c;i++)n[i]=n[i-e];for(let c=0,l=n.length;c<l;c++)n[c]=1-n[c]/o;return n}_computeLaplace(){const{width:e,height:r,_getPointIndex:n}=this,i=new Float32Array(e*r);i.fill(1,0,n(2,0));for(let o=2;o<r-2;o++){i[n(o,0)]=1,i[n(o,1)]=1;for(let a=2;a<e-2;a++)i[n(o,a)]=this._getLaplace(a,o)>.33?0:1;i[n(o,e-2)]=1,i[n(o,e-1)]=1}return i.fill(1,n(r-2,0)),i}_computeGradientX(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0;for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[i++]=this._getDeltaX(a,o);return n}_computeGradientY(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0;for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[i++]=this._getDeltaY(a,o);return n}_getGradientUnitVector(e,r){const{gradXNew:n,gradYNew:i,_getPointIndex:o}=this,a=n[o(r,e)],s=i[o(r,e)];let c=Math.sqrt(a*a+s*s);return c=Math.max(c,1e-100),[a/c,s/c]}_getGradientDirection(e,r,n,i){const o=this._getGradientUnitVector(e,r),a=this._getGradientUnitVector(n,i);let s=o[1]*(n-e)-o[0]*(i-r),c=a[1]*(n-e)-a[0]*(i-r);s<0&&(s=-s,c=-c),e!==n&&r!==i&&(s*=Math.SQRT1_2,c*=Math.SQRT1_2),c=Math.min(Math.max(c,-1),1);const l=x0e*(Math.acos(Math.min(s,1))+Math.acos(c));return isNaN(l)||!isFinite(l)?(console.warn("Found non-direction:",e,r,n,i,s,c,l),1):l}getCost(e,r){return this._getWeightedDistance(e,r)}_getWeightedDistance(e,r){const{_getPointIndex:n,width:i,height:o}=this,[a,s]=e,[c,l]=r;if(c<0||c>=i||l<0||l>=o)return 1;if(a<0||s<0||a>=i||s>=o)return 0;const d=n(l,c);let u=this.gradMagnitude[d];(a===c||s===l)&&(u*=Math.SQRT1_2);const f=this.laplace[d],h=this._getGradientDirection(a,s,c,l);return .43*u+.43*f+.11*h}_getNeighborPoints(e){const{width:r,height:n}=this,i=[],o=Math.max(e[0]-1,0),a=Math.max(e[1]-1,0),s=Math.min(e[0]+1,r-1),c=Math.min(e[1]+1,n-1);for(let l=a;l<=c;l++)for(let d=o;d<=s;d++)(d!==e[0]||l!==e[1])&&i.push([d,l]);return i}static createInstanceFromRawPixelData(e,r,n,i){const o=e.length,a=new Float32Array(o),{lower:s,upper:c}=i,l=c-s;for(let d=0,u=e.length;d<u;d++)a[d]=Math.max(0,Math.min(1,(e[d]-s)/l));return new T1(a,r,n)}}class Ls{constructor(e,r){this.pointArray=e?e.slice():[],this._controlPointIndexes=r?r.slice():[]}getPoint(e){return this.pointArray[e]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(e){const r=this.pointArray.indexOf(e);if(r!==-1)return this._controlPointIndexes.indexOf(r)!==-1;throw new Error("Error: isControlPoint called with not in list point.")}addPoint(e){this.pointArray.push(e)}addControlPoint(e){const r=this.pointArray.indexOf(e);if(r!==-1)this._controlPointIndexes.push(r);else throw new Error("Cannot mark a non registered point as control point.")}getControlPoints(){return this._controlPointIndexes.map(e=>this.pointArray[e])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(e){this.pointArray.splice(this.pointArray.length-e,e)}addPoints(e){this.pointArray=this.pointArray.concat(e)}prependPath(e){const r=e.pointArray.length,n=[];this.pointArray=e.pointArray.concat(this.pointArray);for(let i=0;i<this._controlPointIndexes.length;++i)n[i]=this._controlPointIndexes[i]+r;this._controlPointIndexes=e._controlPointIndexes.concat(n)}appendPath(e){this.addPoints(e.pointArray),e._controlPointIndexes.forEach(r=>this._controlPointIndexes.push(r))}}const S0e=10**2,Nx=class Nx extends lh{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextLines:T0e,calculateStats:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:jr.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{cancelInProgress:{method:"cancelInProgress",bindings:[{key:"Escape"}]}}}}){super(e,r),this.isHandleOutsideImage=!1,this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,l=a*a,d=i.data.contour.polyline.map(f=>c.worldToCanvas(f));let u=d[d.length-1];for(let f=0;f<d.length;f++){const h=d[f];if(Wh(u,h,o)<=l)return!0;u=h}return!1},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1};const c=Ce(a),{renderingEngine:l}=c;this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,d;if(o.worldPosition)l=!0;else{const{points:g}=c.handles;d=g.findIndex(p=>p===o)}const u=vt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:d,movingTextBox:l},this._activateModify(s);const f=Ce(s),{renderingEngine:h}=f;Me(u),n.preventDefault()},this._endCallback=(n,i=!1)=>{const o=n.detail,{element:a}=o,{annotation:s,viewportIdsToRender:c,newAnnotation:l,contourHoleProcessingEnabled:d}=this.editData,{data:u}=s;this.doneEditMemo(),u.handles.activeHandleIndex=null,this._deactivateModify(a),this._deactivateDraw(a);const f=Ce(a);if(this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage||i){kt(s.annotationUID),this.clearEditData(),Me(c);return}Me(c);const h=l?At.Completed:At.HandlesUpdated;this.triggerChangeEvent(s,f,h,d),this.clearEditData()},this.triggerChangeEvent=(n,i,o=At.StatsUpdated,a=!1)=>{o===At.Completed?um(n,a):Gt(n,i.viewport.element,o)},this._mouseDownCallback=n=>{const i=n.type===V.MOUSE_DOUBLE_CLICK,{annotation:o,viewportIdsToRender:a,worldToSlice:s,sliceToWorld:c,newAnnotation:l}=this.editData;if(this.editData.closed)return;const d=n.detail,{element:u}=d,{currentPoints:f}=d,{canvas:h,world:g}=f;let p=g;const v=Ce(u),{viewport:w,renderingEngine:m}=v,y=this.editData.currentPath.getControlPoints();let C=y.length>=2&&i;if(this.doneEditMemo(),this.createMemo(u,o,{newAnnotation:l&&y.length===1}),y.length>=2){const T={index:-1,distSquared:1/0};for(let _=0,E=y.length;_<E;_++){const D=y[_],b=c(D),I=w.worldToCanvas(b),O=oc(h,I);O<=S0e&&O<T.distSquared&&(T.distSquared=O,T.index=_)}T.index===0&&(C=!0)}const{snapHandleNearby:x}=this.configuration;if(x&&!this.editData.closed){const T=new Ls,_=this.scissors.findMinNearby(s(g),1),E=this.scissors.findPathToPoint(_);T.addPoints(E),T.prependPath(this.editData.confirmedPath),p=c(_),this.editData.currentPath=T}this.editData.closed=this.editData.closed||C,this.editData.confirmedPath=this.editData.currentPath;const S=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(S),o.data.handles.points.push(c(S)),this.scissors.startSearch(s(p)),o.invalidated=!0,Me(a),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(n)),n.preventDefault()},this._mouseMoveCallback=n=>{const{element:i,currentPoints:o}=n.detail,{world:a,canvas:s}=o,{renderingEngine:c}=Ce(i),l=vt(i,this.getToolName());this.editData.lastCanvasPoint=s;const{width:d,height:u}=this.scissors,{worldToSlice:f}=this.editData,h=f(a);if(h[0]<0||h[1]<0||h[0]>=d||h[1]>=u)return;const g=this.scissors.findPathToPoint(h),p=new Ls;p.addPoints(g),p.prependPath(this.editData.confirmedPath),this.editData.currentPath=p,Me(l),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,movingTextBox:c,handleIndex:l,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:u}=a;if(c){const{deltaPoints:g}=i,p=g.world,{textBox:v}=u.handles,{worldPosition:w}=v;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],v.hasMoved=!0}else if(l===void 0)console.warn("Drag annotation not implemented");else{const{currentPoints:g}=i,p=g.world;this.editHandle(p,o,a,l)}this.editData.hasMoved=!0;const f=Ce(o),{renderingEngine:h}=f;Me(s)},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData;return a&&kt(i.annotationUID),Me(o),this.doneEditMemo(),this.scissors=null,i.annotationUID},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.addEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_MOVE,this._mouseMoveCallback),n.removeEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(V.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._mouseDownCallback)},this._calculateCachedStats=(n,i)=>{if(!this.configuration.calculateStats)return;const o=n.data;if(!o.contour.closed)return;const a=Ce(i),{viewport:s,renderingEngine:c}=a,{cachedStats:l}=o,{polyline:d}=o.contour,u=Object.keys(l);for(let h=0;h<u.length;h++){const g=u[h],p=this.getTargetImageData(g);if(!p)continue;const{metadata:v}=p,w=d.map(I=>s.worldToCanvas(I)),m=w[0],y=s.canvasToWorld(m),C=s.canvasToWorld([m[0]+1,m[1]]),x=s.canvasToWorld([m[0],m[1]+1]),S=Dr(y,C),T=Dr(y,x),{imageData:_}=p,{scale:E,areaUnit:D}=_o(p,()=>{const{maxX:I,maxY:O,minX:M,minY:R}=gl(w),A=s.canvasToWorld([M,R]),G=br(_,A),k=s.canvasToWorld([I,O]),L=br(_,k);return[G,L]});let b=$h(w)/E/E;b*=S*T,l[g]={Modality:v.Modality,area:b,areaUnit:D}}const f=n.invalidated;return n.invalidated=!1,f&&this.triggerAnnotationModified(n,a,At.StatsUpdated),l},this._renderStats=(n,i,o,a)=>{const s=n.data,c=this.getTargetId(i);if(!s.contour.closed||!a.visibility)return;const l=this.configuration.getTextLines(s,c);if(!l||l.length===0)return;const d=s.handles.points.map(m=>i.worldToCanvas(m));if(!s.handles.textBox.hasMoved){const m=to(d);s.handles.textBox.worldPosition=i.canvasToWorld(m)}const u=i.worldToCanvas(s.handles.textBox.worldPosition),h=gi(o,n.annotationUID??"","textBox",l,u,d,{},a),{x:g,y:p,width:v,height:w}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([g,p]),topRight:i.canvasToWorld([g+v,p]),bottomLeft:i.canvasToWorld([g,p+w]),bottomRight:i.canvasToWorld([g+v,p+w])}},this.triggerAnnotationModified=(n,i,o=At.StatsUpdated)=>{const{viewportId:a,renderingEngineId:s}=i,c=V.ANNOTATION_MODIFIED;Ye(Fe,c,{annotation:n,viewportId:a,renderingEngineId:s,changeType:o})},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}setupBaseEditData(e,r,n,i,o){const a=Ce(r),{viewport:s}=a;this.isDrawing=!0;const c=s.getImageData(),{imageData:l}=c;let d,u,f,h,g;if(!(s instanceof Gn))f=c.dimensions[0],h=c.dimensions[1],d=T=>{const _=br(l,T);return[_[0],_[1]]},u=T=>$0(l,[T[0],T[1],0]),g=c.scalarData;else if(s instanceof Gn){const T=zw(s),{sliceToIndexMatrix:_,indexToSliceMatrix:E}=T;d=D=>{const b=br(l,D),I=Vt([0,0,0],b,E);return[I[0],I[1]]},u=D=>{const b=Vt([0,0,0],[D[0],D[1],0],_);return $0(l,b)},g=T.scalarData,f=T.width,h=T.height}else throw new Error("Viewport not supported");g=mI(g,f,h);const{voiRange:p}=s.getProperties(),v=d(e);this.scissors=T1.createInstanceFromRawPixelData(g,f,h,p),i&&(this.scissorsNext=T1.createInstanceFromRawPixelData(g,f,h,p),this.scissorsNext.startSearch(d(i))),this.scissors.startSearch(v);const w=!i,m=new Ls,y=new Ls,C=w?void 0:new Ls;m.addPoint(v),m.addControlPoint(v);const x=vt(r,this.getToolName()),S=s.worldToCanvas(e);this.editData={annotation:n,viewportIdsToRender:x,newAnnotation:w,hasMoved:!1,lastCanvasPoint:S,confirmedPath:m,currentPath:y,confirmedPathNext:C,closed:!1,handleIndex:this.editData?.handleIndex??n.handles?.activeHandleIndex,worldToSlice:d,sliceToWorld:u,contourHoleProcessingEnabled:o}}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{world:o}=n,a=this.createAnnotation(e),s=md(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(o,i,a,void 0,s),this.addAnnotation(a,i),this._activateDraw(i),e.preventDefault(),Me(this.editData.viewportIdsToRender),a}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(e,r,n,i){const{data:o}=n,{points:a}=o.handles,{length:s}=a,c=a[(i-1+s)%s],l=a[(i+1)%s];if(!this.editData?.confirmedPathNext){this.setupBaseEditData(c,r,n,l);const{polyline:y}=o.contour,C=new Ls,x=new Ls,{worldToSlice:S}=this.editData,T=Ry(n,i-1),_=Ry(n,i+1);if(_===-1||T===-1)throw new Error(`Can't find handle index ${_===-1&&l} ${T===-1&&c}`);i===0?x.addPoints(y.slice(_+1,T).map(S)):(C.addPoints(y.slice(0,T+1).map(S)),x.addPoints(y.slice(_,y.length).map(S))),this.editData.confirmedPath=C,this.editData.confirmedPathNext=x}const{editData:d,scissors:u}=this,{worldToSlice:f,sliceToWorld:h}=d,{activeHandleIndex:g}=o.handles;if(g==null)o.handles.activeHandleIndex=i;else if(g!==i)throw new Error(`Trying to edit a different handle than the one currently being edited ${i}!==${o.handles.activeHandleIndex}`);const p=f(e);if(p[0]<0||p[0]>=u.width||p[1]<0||p[1]>=u.height)return;a[i]=h(p);const v=u.findPathToPoint(p),w=this.scissorsNext.findPathToPoint(p),m=new Ls;m.prependPath(d.confirmedPath),i!==0&&m.addPoints(v),m.addPoints(w.reverse()),m.appendPath(d.confirmedPathNext),i===0&&m.addPoints(v),d.currentPath=m,n.invalidated=!0,d.hasMoved=!0,d.closed=!0}renderAnnotation(e,r){return this.updateAnnotation(this.editData?.currentPath),super.renderAnnotation(e,r)}isContourSegmentationTool(){return!1}createAnnotation(e){const r=super.createAnnotation(e),{world:n}=e.detail.currentPoints;return kr(r,{data:{handles:{points:[[...n]]}}})}cancelInProgress(e,r,n){if(!this.editData){this.undo();return}this._endCallback(n,!0)}renderAnnotationInstance(e){const{annotation:r,enabledElement:n,svgDrawingHelper:i,annotationStyle:o,targetId:a}=e,{viewport:s}=n,{element:c}=s,{worldToCanvas:l}=s,{annotationUID:d,data:u,highlighted:f}=r,{handles:h}=u,g=this.editData?.newAnnotation,{lineWidth:p,lineDash:v,color:w}=o;if(f||g&&r.annotationUID===this.editData?.annotation?.annotationUID){const y=h.points.map(l);kn(i,d,"0",y,{color:w,lineDash:v,lineWidth:p})}return super.renderAnnotationInstance(e),!u.cachedStats[a]||u.cachedStats[a]?.areaUnit===null?(u.cachedStats[a]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(r,c)):r.invalidated&&this._throttledCalculateCachedStats(r,c),this._renderStats(r,s,i,o.textbox),!0}updateAnnotation(e){if(!this.editData||!e)return;const{annotation:r,sliceToWorld:n,worldToSlice:i,closed:o,newAnnotation:a}=this.editData;let{pointArray:s}=e;s.length>1&&(s=[...s,s[0]]);const c=a&&o?Wi.Clockwise:void 0;this.updateContourPolyline(r,{points:s,closed:o,targetWindingDirection:c},{canvasToWorld:n,worldToCanvas:i})}};Nx.toolName="LivewireContour";let _1=Nx;function T0e(t,e){const r=t.cachedStats[e],{area:n,areaUnit:i}=r,o=[];if(n){const a=`Area: ${Ht(n)} ${i}`;o.push(a)}return o}const R1=class R1 extends _1{updateInterpolatedAnnotation(e,r){this.editData||!e.invalidated||!e.data.handles.interpolationSources||(e.data.contour.originalPolyline=e.data.contour.polyline,queueMicrotask(()=>{if(!e.data.handles.interpolationSources)return;const{points:n}=e.data.handles,{element:i}=r.viewport;this.setupBaseEditData(n[0],i,e);const{length:o}=n,{scissors:a}=this,{nearestEdge:s,repeatInterpolation:c}=this.configuration.interpolation;e.data.handles.originalPoints=n;const{worldToSlice:l,sliceToWorld:d}=this.editData,u=[];if(s){let h=l(n[n.length-1]);n.forEach((g,p)=>{const v=l(g);h=v,u.push(v),a.startSearch(h),a.findPathToPoint(v),a.findPathToPoint(l(n[(p+3)%n.length]));const w=a.findMinNearby(v,s);Et(v,w)||(u[p]=w,h=w,n[p]=d(w))})}const f=new Ls;for(let h=0;h<o;h++){a.startSearch(l(n[h]));const g=a.findPathToPoint(l(n[(h+1)%o]));f.addPoints(g)}this.updateAnnotation(f),this.scissors=null,this.scissorsNext=null,this.editData=null,e.data.handles.interpolationSources=null,c&&Gt(e,r.viewport.element,At.InterpolationUpdated)}))}renderAnnotationInstance(e){const{enabledElement:r,svgDrawingHelper:n}=e,i=e.annotation,{annotationUID:o}=i,{viewport:a}=r,{worldToCanvas:s}=a,{showInterpolationPolyline:c}=this.configuration.interpolation||{};this.updateInterpolatedAnnotation?.(i,r);const{originalPolyline:l}=i.data.contour,d=super.renderAnnotationInstance(e);if(c&&l&&i.autoGenerated){const u=l.map(s);u.push(u[0]),jo(n,o,"interpolationContour-0",u,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return d}isContourSegmentationTool(){return!0}};R1.toolName="LivewireContourSegmentationTool",X0.register(R1);let Jy=R1;const du=class du extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:_0e,changeTextCallback:E0e,preventHandleOutsideImage:!1,arrowFirst:!0,arrowHeadStyle:"legacy"}}){super(e,r),this.addNewAnnotation=n=>{this.startGroupRecording();const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const{arrowFirst:c}=this.configuration,l=this.createAnnotation(n,[[...s],[...s]],{data:{handles:{arrowFirst:c}}});Ft(l,a);const d=vt(a,this.getToolName());return this.editData={annotation:l,viewportIdsToRender:d,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(d),l},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[d,u]=l.handles.points,f=c.worldToCanvas(d),h=c.worldToCanvas(u),g={start:{x:f[0],y:f[1]},end:{x:h[0],y:h[1]}};return yr([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l,movingTextBox:d}=this.editData,{data:u}=a;c&&!l||(u.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),c?this.configuration.getTextCallback(f=>{if(!f){kt(a.annotationUID),Me(s),this.editData=null,this.isDrawing=!1;return}a.data.label=f,Gt(a,o,At.HandlesUpdated),xn(a),this.createMemo(o,a,{newAnnotation:!!this.memo}),ZO(a,o,f),this.endGroupRecording(),this.doneEditMemo(),Me(s)}):d||Gt(a,o,At.HandlesUpdated),this.doneEditMemo(),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:u}=a;if(l){const{deltaPoints:f}=i,h=f.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:f}=i,h=f.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:f}=i,h=f.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this.touchTapCallback=n=>{n.detail.taps==2&&this.doubleClickCallback(n)},this.doubleClickCallback=n=>{const i=n.detail,{element:o}=i;let a=$t(this.getToolName(),o);if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return;const s=a.find(l=>this.isPointNearTool(o,l,i.currentPoints.canvas,6));if(!s)return;const c=s;this.configuration.changeTextCallback(s,n.detail,this._doneChangingTextCallback.bind(this,o,c)),this.editData=null,this.isDrawing=!1,n.stopImmediatePropagation(),n.preventDefault()},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const u=c[d],{annotationUID:f,data:h}=u,{handles:g,label:p}=h,{points:v,activeHandleIndex:w}=g;l.annotationUID=f;const{color:m,lineWidth:y,lineDash:C,markerSize:x}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),S=v.map(k=>a.worldToCanvas(k));let T;if(!ir(f)&&!this.editData&&w!==null&&(T=[S[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(f))continue;const _=!!Mi("showHandlesAlways",{});(T||_)&&kn(i,f,"0",S,{color:m,lineWidth:y});const E="1";if(this.configuration.arrowFirst?c1(i,f,E,S[1],S[0],{color:m,width:y,lineDash:C,viaMarker:this.configuration.arrowHeadStyle!=="legacy",markerSize:x}):c1(i,f,E,S[0],S[1],{color:m,width:y,lineDash:C,viaMarker:this.configuration.arrowHeadStyle!=="legacy",markerSize:x}),o=!0,!p)continue;const D=this.getLinkedTextBoxStyle(l,u);if(!D.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!h.handles.textBox.hasMoved){const k=S[1];h.handles.textBox.worldPosition=a.canvasToWorld(k)}const b=a.worldToCanvas(h.handles.textBox.worldPosition),O=gi(i,f,"1",[p],b,S,{},D),{x:M,y:R,width:A,height:G}=O;h.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([M,R]),topRight:a.canvasToWorld([M+A,R]),bottomLeft:a.canvasToWorld([M,R+G]),bottomRight:a.canvasToWorld([M+A,R+G])}}return o}}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o);const d=Ce(o),{renderingEngine:u}=d;Me(l),e.preventDefault()}_doneChangingTextCallback(e,r,n){r.data.label=n;const i=vt(e,this.getToolName());Me(i),Gt(r,e)}_isInsideVolume(e,r,n){return Sr(e,n)&&Sr(r,n)}};du.toolName="ArrowAnnotate",du.hydrate=(e,r,n,i)=>{const o=wn(e);if(!o)return;const{FrameOfReferenceUID:a,referencedImageId:s,viewPlaneNormal:c,instance:l,viewport:d}=du.hydrateBase(du,o,r,i),{toolInstance:u,...f}=i||{},h=du.createAnnotation({annotationUID:i?.annotationUID||cn(),data:{label:n||"",handles:{points:r}},autoGenerated:!1,metadata:{toolName:l.getToolName(),viewPlaneNormal:c,FrameOfReferenceUID:a,referencedImageId:s,...f}});Ft(h,d.element),Me([d.id])};let Zy=du;function _0e(t){return t(prompt("Enter your annotation:"))}function E0e(t,e,r){return r(prompt("Enter your annotation:"))}const y0=class y0 extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,showAngleArc:!1,arcOffset:5,preventHandleOutsideImage:!1,getTextLines:b0e}}){super(e,r),this.addNewAnnotation=n=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[d,u,f]=l.handles.points,h=c.worldToCanvas(d),g=c.worldToCanvas(u),p={start:{x:h[0],y:h[1]},end:{x:g[0],y:g[1]}};if(yr([p.start.x,p.start.y],[p.end.x,p.end.y],[o[0],o[1]])<=a)return!0;if(!f)return!1;const w=c.worldToCanvas(f),m={start:{x:g[0],y:g[1]},end:{x:w[0],y:w[1]}};return yr([m.start.x,m.start.y],[m.end.x,m.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a);const c=Ce(a),{renderingEngine:l}=c;Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;if(this.angleStartedNotYetCompleted&&d.handles.points.length===2){this.editData.handleIndex=2;return}this.angleStartedNotYetCompleted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const u=Ce(o),{renderingEngine:f}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&xn(a),this.editData=null,this.isDrawing=!1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:d}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:d}),l){const{deltaPoints:g}=i,p=g.world,{textBox:v}=u.handles,{worldPosition:w}=v;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],v.hasMoved=!0}else if(c===void 0){const{deltaPoints:g}=i,p=g.world;u.handles.points.forEach(w=>{w[0]+=p[0],w[1]+=p[1],w[2]+=p[2]}),a.invalidated=!0}else{const{currentPoints:g}=i,p=g.world;u.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0;const f=Ce(o),{renderingEngine:h}=f;Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,this.angleStartedNotYetCompleted=!1,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:m,lineWidth:y,lineDash:C,angleArcLineDash:x}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=v.map(L=>a.worldToCanvas(L));!p.cachedStats[l]||p.cachedStats[l].angle==null?(p.cachedStats[l]={angle:null},this._calculateCachedStats(h,d,n)):h.invalidated&&this._throttledCalculateCachedStats(h,d,n);let T;if(!ir(h.annotationUID)&&!this.editData&&w!==null&&(T=[S[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(g))continue;const _=!!Mi("showHandlesAlways",{});(T||_)&&kn(i,g,"0",S,{color:m,lineDash:C,lineWidth:y});let E="1";if(qt(i,g,E,S[0],S[1],{color:m,width:y,lineDash:C}),o=!0,S.length!==3)return o;if(E="2",qt(i,g,E,S[1],S[2],{color:m,width:y,lineDash:C}),this.configuration.showAngleArc){const L=S[1],F=this.configuration.arcOffset,j=Math.min(yr([L[0],L[1]],[S[0][0],S[0][1]],[S[2][0],S[2][1]]),yr([L[0],L[1]],[S[2][0],S[2][1]],[S[0][0],S[0][1]]))/F,Y=[];let ie=Math.atan2(S[0][1]-L[1],S[0][0]-L[0]),de=Math.atan2(S[2][1]-L[1],S[2][0]-L[0]);if(de<ie&&(de+=2*Math.PI),de-ie>Math.PI){const we=ie;ie=de,de=we+2*Math.PI}const fe=32;for(let we=0;we<=fe;we++){const _e=ie+we/fe*(de-ie);Y.push([L[0]+j*Math.cos(_e),L[1]+j*Math.sin(_e)])}Js(i,g,"3",Y,{color:m,width:y,lineDash:x})}if(!p.cachedStats[l]?.angle)continue;const D=this.getLinkedTextBoxStyle(u,h);if(!D.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const b=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const L=S[1];p.handles.textBox.worldPosition=a.canvasToWorld(L)}const I=a.worldToCanvas(p.handles.textBox.worldPosition),M=gi(i,g,"1",b,I,S,{},D),{x:R,y:A,width:G,height:k}=M;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([R,A]),topRight:a.canvasToWorld([R+G,A]),bottomLeft:a.canvasToWorld([R,A+k]),bottomRight:a.canvasToWorld([R+G,A+k])}}return o},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o);const d=Ce(o),{renderingEngine:u}=d;Me(l),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport;if(i.handles.points.length!==3)return;const a=i.handles.points[0],s=i.handles.points[1],c=i.handles.points[2],{cachedStats:l}=i,d=Object.keys(l);for(let f=0;f<d.length;f++){const h=d[f],g=D0([a,s],[s,c]),{dimensions:p,imageData:v}=this.getTargetImageData(h);this.isHandleOutsideImage=[a,s,c].map(w=>br(v,w)).some(w=>!Sr(w,p)),l[h]={angle:isNaN(g)?"Incomplete Angle":g}}const u=e.invalidated;return e.invalidated=!1,u&&Gt(e,o,At.StatsUpdated),l}};y0.toolName="Angle",y0.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=y0.hydrateBase(y0,i,r,n),{toolInstance:d,...u}=n||{},f={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(f,l.element),Me([l.id])};let Qy=y0;function b0e(t,e){const r=t.cachedStats[e],{angle:n}=r;return n===void 0?void 0:isNaN(n)?[`${n}`]:[`${Ht(n)} `]}const D0e=(...t)=>{const e=t[0].length===2?[0,0]:[0,0,0],r=t.length;for(const n of t)e[0]+=n[0]/r,e[1]+=n[1]/r,e.length===3&&(e[2]+=n[2]/r);return e},As=D0e,Vx=class Vx extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:I0e,showArcLines:!1}}){super(e,r),this.addNewAnnotation=n=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;St(a),this.isDrawing=!0;const c=this.createAnnotation(n,[[...s],[...s]]);Ft(c,a);const l=vt(a,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:l,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(l),c},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,{distanceToPoint:d,distanceToPoint2:u}=this.distanceToLines({viewport:c,points:l.handles.points,canvasCoords:o,proximity:a});return d<=a||u<=a},this.toolSelectedCallback=(n,i,o,a,s=6)=>{const c=n.detail,{element:l}=c;i.highlighted=!0;const d=vt(l,this.getToolName()),u=Ce(l),{renderingEngine:f,viewport:h}=u,{isNearFirstLine:g,isNearSecondLine:p}=this.distanceToLines({viewport:h,points:i.data.handles.points,canvasCoords:a,proximity:s});this.editData={annotation:i,viewportIdsToRender:d,movingTextBox:!1,isNearFirstLine:g,isNearSecondLine:p},this._activateModify(l),St(l),Me(d),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;if(this.doneEditMemo(),this.angleStartedNotYetCompleted&&d.handles.points.length<4){Nt(o),this.editData.handleIndex=d.handles.points.length;return}this.angleStartedNotYetCompleted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const u=Ce(o),{renderingEngine:f}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a),this.editData=null,this.isDrawing=!1},this._mouseDownCallback=n=>{const{annotation:i,handleIndex:o}=this.editData,a=n.detail,{element:s,currentPoints:c}=a,l=c.world,{data:d}=i;if(o===1){d.handles.points[1]=l,this.editData.hasMoved=d.handles.points[1][0]!==d.handles.points[0][0]||d.handles.points[1][1]!==d.handles.points[0][0];return}if(o===3){d.handles.points[3]=l,this.editData.hasMoved=d.handles.points[3][0]!==d.handles.points[2][0]||d.handles.points[3][1]!==d.handles.points[2][0],this.angleStartedNotYetCompleted=!1;return}this.editData.hasMoved=!1,St(s),d.handles.points[2]=d.handles.points[3]=l,this.editData.handleIndex=d.handles.points.length-1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,isNearFirstLine:d,isNearSecondLine:u,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:h}=a;if(l){const{deltaPoints:v}=i,w=v.world,{textBox:m}=h.handles,{worldPosition:y}=m;y[0]+=w[0],y[1]+=w[1],y[2]+=w[2],m.hasMoved=!0}else if(c===void 0&&(d||u)){const{deltaPoints:v}=i,w=v.world,m=h.handles.points;d?[m[0],m[1]].forEach(C=>{C[0]+=w[0],C[1]+=w[1],C[2]+=w[2]}):u&&[m[2],m[3]].forEach(C=>{C[0]+=w[0],C[1]+=w[1],C[2]+=w[2]}),a.invalidated=!0}else{const{currentPoints:v}=i,w=v.world;h.handles.points[c]=[...w],a.invalidated=!0}this.editData.hasMoved=!0;const g=Ce(o),{renderingEngine:p}=g;Me(s),a.invalidated&&Gt(a,o,At.HandlesUpdated)},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;s.handles.points.length<4&&kt(i.annotationUID),i.highlighted=!1,s.handles.activeHandleIndex=null;const c=Ce(n),{renderingEngine:l}=c;return Me(o),a&&xn(i),this.editData=null,this.angleStartedNotYetCompleted=!1,i.annotationUID},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_START,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_START,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_START,this._mouseDownCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_START,this._mouseDownCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:m,lineWidth:y,lineDash:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),x=v.map(_e=>a.worldToCanvas(_e));!p.cachedStats[l]||p.cachedStats[l].angle==null?(p.cachedStats[l]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(h,d,n)):h.invalidated&&this._throttledCalculateCachedStats(h,d,n);let S;if(!ir(g)&&!this.editData&&w!==null&&(S=[x[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!or(g))continue;const T=!!Mi("showHandlesAlways",{});(S||T)&&kn(i,g,"0",x,{color:m,lineDash:C,lineWidth:y});const _=[x[0],x[1]],E=[x[2],x[3]];let D="line1";if(qt(i,g,D,_[0],_[1],{color:m,width:y,lineDash:C}),o=!0,x.length<4)return o;D="line2",qt(i,g,D,E[0],E[1],{color:m,width:y,lineDash:C}),D="linkLine";const b=As(_[0],_[1]),I=As(E[0],E[1]);qt(i,g,D,b,I,{color:m,lineWidth:"1",lineDash:"1,4"});const{arc1Start:O,arc1End:M,arc2End:R,arc2Start:A}=p.cachedStats[l].points.canvas,{arc1Angle:G,arc2Angle:k}=p.cachedStats[l];if(this.configuration.showArcLines&&(D="arc1",qt(i,g,D,O,M,{color:m,lineWidth:"1"}),D="arc2",qt(i,g,D,A,R,{color:m,lineWidth:"1"})),!p.cachedStats[l]?.angle)continue;const L=this.getLinkedTextBoxStyle(u,h);if(!L.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const F=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const _e=to(x);p.handles.textBox.worldPosition=a.canvasToWorld(_e)}const j=a.worldToCanvas(p.handles.textBox.worldPosition),ie=gi(i,g,"cobbAngleText",F,j,x,{},L),{x:de,y:ae,width:fe,height:we}=ie;if(p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([de,ae]),topRight:a.canvasToWorld([de+fe,ae]),bottomLeft:a.canvasToWorld([de,ae+we]),bottomRight:a.canvasToWorld([de+fe,ae+we])},this.configuration.showArcLines){const _e="arcAngle1",Se=[`${G.toFixed(2)} `],B=As(O,M);ac(i,g,_e,Se,B,{...L,padding:3});const P="arcAngle2",$=[`${k.toFixed(2)} `],W=As(A,R);ac(i,g,P,$,W,{...L,padding:3})}}return o},this.distanceToLines=({viewport:n,points:i,canvasCoords:o,proximity:a})=>{const[s,c,l,d]=i,u=n.worldToCanvas(s),f=n.worldToCanvas(c),h=n.worldToCanvas(l),g=n.worldToCanvas(d),p={start:{x:u[0],y:u[1]},end:{x:f[0],y:f[1]}},v={start:{x:h[0],y:h[1]},end:{x:g[0],y:g[1]}},w=yr([p.start.x,p.start.y],[p.end.x,p.end.y],[o[0],o[1]]),m=yr([v.start.x,v.start.y],[v.end.x,v.end.y],[o[0],o[1]]);let y=!1,C=!1;return w<=a?y=!0:m<=a&&(C=!0),{distanceToPoint:w,distanceToPoint2:m,isNearFirstLine:y,isNearSecondLine:C}},this.getArcsStartEndPoints=({firstLine:n,secondLine:i,mid1:o,mid2:a})=>{const s=[o,a],c=D0(n,s),l=D0(i,s),d=c>90?1:0,u=l>90?0:1,f=As(s[0],s[1]),h=Math.sqrt((s[1][0]-s[0][0])**2+(s[1][1]-s[0][1])**2),g=.1,p=As(n[0],n[1]),v=As(i[0],i[1]),w=[n[d][0]-p[0],n[d][1]-p[1]],m=Math.sqrt(w[0]**2+w[1]**2),y=[w[0]/m,w[1]/m],C=[p[0]+y[0]*h*g,p[1]+y[1]*h*g],x=[f[0]-o[0],f[1]-o[1]],S=Math.sqrt(x[0]**2+x[1]**2),T=[x[0]/S,x[1]/S],_=[o[0]+T[0]*h*g,o[1]+T[1]*h*g],E=[i[u][0]-v[0],i[u][1]-v[1]],D=Math.sqrt(E[0]**2+E[1]**2),b=[E[0]/D,E[1]/D],I=[v[0]+b[0]*h*g,v[1]+b[1]*h*g],O=[f[0]-a[0],f[1]-a[1]],M=Math.sqrt(O[0]**2+O[1]**2),R=[O[0]/M,O[1]/M],A=[a[0]+R[0]*h*g,a[1]+R[1]*h*g];return{arc1Start:C,arc1End:_,arc2Start:I,arc2End:A,arc1Angle:c>90?180-c:c,arc2Angle:l>90?180-l:l}},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(e,r,n,i="mouse"){const o=e.detail,{element:a}=o,{data:s}=r;r.highlighted=!0;let c=!1,l;n.worldPosition?c=!0:l=s.handles.points.findIndex(u=>u===n);const d=vt(a,this.getToolName());this.editData={annotation:r,viewportIdsToRender:d,handleIndex:l,movingTextBox:c},this._activateModify(a),St(a),Me(d),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data;if(i.handles.points.length!==4)return;const o=[null,null],a=[null,null];let s=Number.MAX_VALUE;for(let _=0;_<2;_+=1)for(let E=2;E<4;E+=1){const D=Dr(i.handles.points[_],i.handles.points[E]);D<s&&(s=D,o[1]=i.handles.points[_],o[0]=i.handles.points[(_+1)%2],a[0]=i.handles.points[E],a[1]=i.handles.points[2+(E-1)%2])}const{viewport:c}=n,{element:l}=c,d=i.handles.points.map(_=>c.worldToCanvas(_)),u=[d[0],d[1]],f=[d[2],d[3]],h=As(u[0],u[1]),g=As(f[0],f[1]),{arc1Start:p,arc1End:v,arc2End:w,arc2Start:m,arc1Angle:y,arc2Angle:C}=this.getArcsStartEndPoints({firstLine:u,secondLine:f,mid1:h,mid2:g}),{cachedStats:x}=i,S=Object.keys(x);for(let _=0;_<S.length;_++){const E=S[_];x[E]={angle:D0(o,a),arc1Angle:y,arc2Angle:C,points:{canvas:{arc1Start:p,arc1End:v,arc2End:w,arc2Start:m},world:{arc1Start:c.canvasToWorld(p),arc1End:c.canvasToWorld(v),arc2End:c.canvasToWorld(w),arc2Start:c.canvasToWorld(m)}}}}const T=e.invalidated;return e.invalidated=!1,T&&Gt(e,l,At.StatsUpdated),x}};Vx.toolName="CobbAngle";let e5=Vx;function I0e(t,e){const r=t.cachedStats[e],{angle:n}=r;return n===void 0?void 0:[`${n.toFixed(2)} `]}const{transformWorldToIndex:R_}=hn,kx=class kx extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:M0e,displayBothAxesDistances:!1}}){super(e,r),this.addNewAnnotation=n=>{if(this.startedDrawing)return;this.startedDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;if(!(l instanceof Wn))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");St(a),this.isDrawing=!0;const d=this.createAnnotation(n,[[...s],[...s]]);Ft(d,a);const u=vt(a,this.getToolName());return this.editData={annotation:d,viewportIdsToRender:u,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(u),d},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[d,u]=l.handles.points,f=c.worldToCanvas(d),h=c.worldToCanvas(u),g={start:{x:f[0],y:f[1]},end:{x:h[0],y:h[1]}};return yr([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;if(this.startedDrawing&&d.handles.points.length===1){this.editData.handleIndex=1;return}this.startedDrawing=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const u=Ce(o),{renderingEngine:f}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a),this.editData=null,this.isDrawing=!1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l}=this.editData,{data:d}=a;if(l){const{deltaPoints:h}=i,g=h.world,{textBox:p}=d.handles,{worldPosition:v}=p;v[0]+=g[0],v[1]+=g[1],v[2]+=g[2],p.hasMoved=!0}else if(c===void 0){const{deltaPoints:h}=i,g=h.world;d.handles.points.forEach(v=>{v[0]+=g[0],v[1]+=g[1],v[2]+=g[2]}),a.invalidated=!0}else{const{currentPoints:h}=i,g=h.world;d.handles.points[c]=[...g],a.invalidated=!0}this.editData.hasMoved=!0;const u=Ce(o),{renderingEngine:f}=u;Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,this.startedDrawing=!1,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l=this.getTargetId(a),d=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v}=p.handles;u.annotationUID=g;const w=this.getStyle("color",u,h),m=v.map(M=>a.worldToCanvas(M));if(!p.cachedStats[l]||p.cachedStats[l].xValues==null?(p.cachedStats[l]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(h,d,n)):h.invalidated&&this._throttledCalculateCachedStats(h,d,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let y="0";if(s1(i,g,y,m[0],{color:w},0),o=!0,m.length!==2)return o;if(y="1",s1(i,g,y,m[1],{color:w},1),p.cachedStats[l].isUnitless){const M=`${g}-line-1`;qt(i,g,"1",m[0],m[1],{color:w,width:1,shadow:this.configuration.shadow},M)}else{const M=m[0],R=m[1],A=R[1]-M[1],G=R[0]-M[0],k=p.cachedStats[l].isHorizontal;let L=[0,0];k?L=[M[0]+G,M[1]]:L=[M[0],M[1]+A];let F=`${g}-line-1`,j="1";qt(i,g,j,m[0],L,{color:w,width:1,shadow:this.configuration.shadow},F),F=`${g}-line-2`,j="2",qt(i,g,j,m[1],L,{color:w,width:1,lineDash:[1,1],shadow:this.configuration.shadow},F)}const x=this.getLinkedTextBoxStyle(u,h);if(!x.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const S=this.configuration.getTextLines(p,l,this.configuration);if(!p.handles.textBox.hasMoved){const M=m[1];p.handles.textBox.worldPosition=a.canvasToWorld(M)}const T=a.worldToCanvas(p.handles.textBox.worldPosition),E=gi(i,g,"1",S,T,m,{},x),{x:D,y:b,width:I,height:O}=E;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([D,b]),topRight:a.canvasToWorld([D+I,b]),bottomLeft:a.canvasToWorld([D,b+O]),bottomRight:a.canvasToWorld([D+I,b+O])}}return o},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(e,r,n,i){}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;const s=vt(o,this.getToolName());let c;n.worldPosition||(c=a.handles.points.findIndex(u=>u===n)),this.editData={handleIndex:c,annotation:r,viewportIdsToRender:s},this._activateModify(o),St(o);const l=Ce(o),{renderingEngine:d}=l;Me(s),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport;if(i.handles.points.length!==2)return;const{cachedStats:a}=i,s=Object.keys(a);for(let l=0;l<s.length;l++){const d=s[l],u=this.getTargetImageData(d);if(!u)continue;const{imageData:f}=u,h=i.handles.points[0],g=i.handles.points[1],p=R_(f,h),v=R_(f,g),{values:w,units:m}=d1(u,[p]),{values:y,units:C}=d1(u,[v]);let x,S,T,_,E=!1;if(m[0]!==C[0]||m[1]!==C[1]||m[0]==="raw"&&C[0]==="raw"){const D=ls(h,g);x=[D,0],S=[D,0],T=["px"],E=!0}else{const D=n.viewport.worldToCanvas(h),b=n.viewport.worldToCanvas(g),I=b[1]-D[1],O=b[0]-D[0];_=Math.abs(O)>Math.abs(I),x=[w[0],y[0]],S=[w[1],y[1]],T=[m[0],m[1]]}a[d]={xValues:x,yValues:S,isHorizontal:_,units:T,isUnitless:E}}const c=e.invalidated;return e.invalidated=!1,c&&Gt(e,o,At.StatsUpdated),a}};kx.toolName="UltrasoundDirectionalTool";let t5=kx;function M0e(t,e,r){const n=t.cachedStats[e],{xValues:i,yValues:o,units:a,isUnitless:s,isHorizontal:c}=n;if(s)return[`${Ht(i[0])} px`];if(r.displayBothAxesDistances){const l=Math.abs(i[1]-i[0]),d=Math.abs(o[1]-o[0]);return[`${Ht(l)} ${a[0]}`,`${Ht(d)} ${a[1]}`]}if(c){const l=Math.abs(i[1]-i[0]);return[`${Ht(l)} ${a[0]}`]}else{const l=Math.abs(o[1]-o[0]);return[`${Ht(l)} ${a[1]}`]}}function O0e(t){return(t%360+360)%360}function n5(t,e){const r=e[0]-t[0],n=e[1]-t[1],i=Math.atan2(n,r)*(180/Math.PI);return O0e(i)}function E1(t,e){const r=n5(t,e[0]),n=n5(t,e[1]);return r<n?[r,n]:[n,r]}function r5(t){if(!t.length)return[];t.sort((r,n)=>r[0]-n[0]);const e=[t[0].slice()];for(let r=1;r<t.length;r++){const n=e[e.length-1],i=t[r];i[0]<=n[1]?n[1]=Math.max(n[1],i[1]):e.push(i.slice())}return e}function A_(t,e){const[r,n]=e;if(n<=r)return[];const i=t.map(([d,u])=>[Math.max(d,r),Math.min(u,n)]).filter(([d,u])=>u>d);if(i.length===0)return[[r,n]];i.sort((d,u)=>d[0]-u[0]);const o=[];let[a,s]=i[0];for(let d=1;d<i.length;d++){const[u,f]=i[d];u<=s?s=Math.max(s,f):(o.push([a,s]),[a,s]=[u,f])}o.push([a,s]);const c=[];let l=r;for(const[d,u]of o)d>l&&c.push([l,d]),l=Math.max(l,u);return l<n&&c.push([l,n]),c}function OP(t,e){const r=[];for(const n of e){const i=Math.max(t[0],n[0]),o=Math.min(t[1],n[1]);i<o&&r.push([i,o])}return r}function P0e(t,e,r){const n=e.map(d=>E1(t,d)),i=r5(n),o=i.reduce((d,[u,f])=>d+(f-u),0);if(o===0)return 0;const a=[];for(const d of r){const u=E1(t,d),f=OP(u,i);a.push(...f)}const l=r5(a).reduce((d,[u,f])=>d+(f-u),0)/o*100;return Math.min(100,Math.max(0,l))}const{transformIndexToWorld:L_}=hn,Hn=class Hn extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:R0e,center:null,innerRadius:null,outerRadius:null,startAngle:null,endAngle:null,bLineColor:"rgb(60, 255, 60)",pleuraColor:"rgb(0, 4, 255)",drawDepthGuide:!0,depth_ratio:.5,depthGuideColor:"rgb(0, 255, 255)",depthGuideThickness:4,depthGuideDashLength:20,depthGuideDashGap:16,depthGuideOpacity:.2,fanOpacity:.1,showFanAnnotations:!0,updatePercentageCallback:null,actions:{undo:{method:"undo",bindings:[{key:"z"}]},redo:{method:"redo",bindings:[{key:"y"}]}}}}){super(e,r),this.pleuraAnnotations=[],this.bLineAnnotations=[],this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;St(a),this.isDrawing=!0;const{viewPlaneNormal:d,viewUp:u,position:f}=l.getCamera(),h=this.getReferencedImageId(l,s,d,u),g={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[s]}),toolName:this.getToolName(),referencedImageId:h,viewUp:u,cameraPosition:f},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null},annotationType:this.getActiveAnnotationType(),label:""}};Ft(g,a);const p=vt(a,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:p,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(p),g},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i,[d,u]=l.handles.points,f=c.worldToCanvas(d),h=c.worldToCanvas(u),g={start:{x:f[0],y:f[1]},end:{x:h[0],y:h[1]}};return yr([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=vt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),St(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;c&&!l||(d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),this.doneEditMemo(),c&&xn(a),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{viewport:a}=Ce(o)||{};if(!a)return;const{annotation:s,viewportIdsToRender:c,handleIndex:l,movingTextBox:d,newAnnotation:u}=this.editData,{data:f}=s;if(this.createMemo(o,s,{newAnnotation:u}),d){const{deltaPoints:h}=i,g=h.world,{textBox:p}=f.handles,{worldPosition:v}=p;v[0]+=g[0],v[1]+=g[1],v[2]+=g[2],p.hasMoved=!0}else if(l===void 0){const{deltaPoints:h}=i,g=h.world,p=f.handles.points;p.every(w=>{const m=[w[0]+g[0],w[1]+g[1],w[2]+g[2]];return this.isInsideFanShape(a,m)})&&(p.forEach(w=>{w[0]+=g[0],w[1]+=g[1],w[2]+=g[2]}),s.invalidated=!0)}else{const{currentPoints:h}=i,g=h.world;this.isInsideFanShape(a,g)&&(f.handles.points[l]=[...g],s.invalidated=!0)}this.editData.hasMoved=!0,Me(c),s.invalidated&&Gt(s,o,At.HandlesUpdated)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Nt(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&xn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;if(!this.getFanShapeGeometryParameters(a))return;const{imageData:c}=a.getImageData()||{};if(!c)return o;this.configuration.drawDepthGuide&&this.drawDepthGuide(i,a);let l=$t(this.getToolName(),s);if(!l?.length||(l=this.filterInteractableAnnotationsForElement(s,l),!l?.length))return o;this.getTargetId(a),a.getRenderingEngine();const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=a.worldToCanvas(L_(c,this.configuration.center)),f=this.getIndexToCanvasRatio(a),h=this.configuration.innerRadius*f,g=this.configuration.outerRadius*f,p=a.getCurrentImageId(),v=l.filter(T=>T.data.annotationType===Hn.USPleuraBLineAnnotationType.PLEURA&&T.metadata.referencedImageId===p).map(T=>{const _=T.data.handles.points.map(D=>a.worldToCanvas(D));return E1(u,_)}),w=r5(v),m=[],y=[],C=T=>{const{annotationUID:_,data:E}=T,{points:D,activeHandleIndex:b}=E.handles;d.annotationUID=_;const{color:I,lineWidth:O,lineDash:M,shadow:R}=this.getAnnotationStyle({annotation:T,styleSpecifier:d}),A=D.map(F=>a.worldToCanvas(F));if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let G;if(!or(_))return;!ir(_)&&!this.editData&&b!==null&&(G=[A[b]]),G&&kn(i,_,"0",A,{color:this.getColorForLineType(T),fill:this.getColorForLineType(T),lineDash:M,lineWidth:O});const k=`${_}-line`;if(qt(i,_,"1",A[0],A[1],{color:this.getColorForLineType(T),width:O,lineDash:M,shadow:R},k),this.configuration.showFanAnnotations){const F=E1(u,A);let j=0;T.data.annotationType===Hn.USPleuraBLineAnnotationType.BLINE?A_(y,F).forEach(ie=>{OP(ie,w).forEach(ae=>{j++;const fe=j,we=`${_}-fan-${fe}`,_e=`2-${fe}`;My(i,_,_e,u,h,g,ae[0],ae[1],{color:"transparent",fill:this.getColorForLineType(T),fillOpacity:this.configuration.fanOpacity,width:O,lineDash:M,shadow:R},we,10),y.push(ae)})}):T.data.annotationType===Hn.USPleuraBLineAnnotationType.PLEURA&&A_(m,F).forEach((ie,de)=>{j++;const ae=j,fe=`${_}-fan-${ae}`,we=`2-${ae}`;My(i,_,we,u,h,g,ie[0],ie[1],{color:"transparent",fill:this.getColorForLineType(T),fillOpacity:this.configuration.fanOpacity,width:O,lineDash:M,shadow:R},fe,5),m.push(ie)})}};return l.filter(T=>T.data.annotationType===Hn.USPleuraBLineAnnotationType.PLEURA&&T.metadata.referencedImageId===p).forEach(T=>{if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;C(T)}),l.filter(T=>T.data.annotationType===Hn.USPleuraBLineAnnotationType.BLINE&&T.metadata.referencedImageId===p).forEach(T=>{if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;C(T)}),o=!0,this.configuration.updatePercentageCallback&&a&&this.configuration.updatePercentageCallback(this.calculateBLinePleuraPercentage(a)),o},this.activeAnnotationType=Hn.USPleuraBLineAnnotationType.BLINE}static filterAnnotations(e,r=()=>!0){const n=$t(Hn.toolName,e);return n?.length?n.filter(o=>{const a=o.metadata.referencedImageId;return r(a)}):[]}static countAnnotations(e,r=()=>!0){const n=$t(Hn.toolName,e),{viewport:i}=Ce(e),o=i.getImageIds(),a=c=>{const l=o.findIndex(d=>d===c);return l===-1?0:l};if(!n?.length)return;const s=new Map;return n.forEach(c=>{const l=c.metadata.referencedImageId;if(!r(l))return;const{annotationType:d}=c.data;let u;s.has(l)?u=s.get(l):u={frame:a(l),bLine:0,pleura:0},d===Hn.USPleuraBLineAnnotationType.PLEURA?u.pleura++:d===Hn.USPleuraBLineAnnotationType.BLINE&&u.bLine++,s.set(l,u)}),s}static deleteAnnotations(e,r=()=>!1){const n=$t(Hn.toolName,e);n?.length&&n.forEach(i=>{r(i.metadata.referencedImageId)&&kt(i.annotationUID)})}setActiveAnnotationType(e){this.activeAnnotationType=e}getActiveAnnotationType(){return this.activeAnnotationType}deleteLastAnnotationType(e,r){let n;const i=$t(Hn.toolName,e);if(r===Hn.USPleuraBLineAnnotationType.PLEURA?n=i.filter(o=>o.data.annotationType===Hn.USPleuraBLineAnnotationType.PLEURA):r===Hn.USPleuraBLineAnnotationType.BLINE&&(n=i.filter(o=>o.data.annotationType===Hn.USPleuraBLineAnnotationType.BLINE)),n?.length>0){const o=n.pop();kt(o.annotationUID)}}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(d=>d===n);const l=vt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),St(o),Me(l),e.preventDefault()}isInsideFanShape(e,r){if(!this.getFanShapeGeometryParameters(e))return!1;const{imageData:n}=e.getImageData()||{};if(n){const i=e.worldToCanvas(n.indexToWorld(this.configuration.center)),o=e.worldToCanvas(r),a=n5(i,o);return a>=this.configuration.startAngle&&a<=this.configuration.endAngle}}updateFanGeometryConfiguration(e){e&&(this.isFanShapeGeometryParametersValid(e)&&(this.configuration.center=[e.center[0],e.center[1],0]),this.configuration.innerRadius=e.innerRadius,this.configuration.outerRadius=e.outerRadius,this.configuration.startAngle=e.startAngle,this.configuration.endAngle=e.endAngle)}deriveFanGeometryFromViewport(e){const r=e.getCurrentImageId(),{fanGeometry:n}=fx(r)||{};n&&this.updateFanGeometryConfiguration(n)}isFanShapeGeometryParametersValid(e){return e||(e=this.configuration),e?.center&&e?.innerRadius>0&&e?.outerRadius&&e?.startAngle>0&&e?.startAngle<360&&e?.endAngle>0&&e?.endAngle<360}getFanShapeGeometryParameters(e){if(this.isFanShapeGeometryParametersValid())return!0;if(!this.isFanShapeGeometryParametersValid()){const r=e.getCurrentImageId(),n=ut("ultrasoundFanShapeGeometry",r);this.updateFanGeometryConfiguration(n)}return this.isFanShapeGeometryParametersValid()||this.deriveFanGeometryFromViewport(e),this.isFanShapeGeometryParametersValid()}calculateBLinePleuraPercentage(e){if(!this.getFanShapeGeometryParameters(e))return;const{imageData:r}=e.getImageData()||{};if(!r)return;const{element:n}=e,i=e.worldToCanvas(r.indexToWorld(this.configuration.center)),o=e.getCurrentImageId(),a=$t(this.getToolName(),n)||[],s=a.filter(l=>l.data.annotationType===Hn.USPleuraBLineAnnotationType.PLEURA&&l.metadata.referencedImageId===o).map(l=>l.data.handles.points.map(u=>e.worldToCanvas(u))),c=a.filter(l=>l.data.annotationType===Hn.USPleuraBLineAnnotationType.BLINE&&l.metadata.referencedImageId===o).map(l=>l.data.handles.points.map(u=>e.worldToCanvas(u)));return P0e(i,s,c)}getColorForLineType(e){const{annotationType:r}=e.data,{bLineColor:n,pleuraColor:i}=this.configuration;return r===Hn.USPleuraBLineAnnotationType.BLINE?n:r===Hn.USPleuraBLineAnnotationType.PLEURA?i:n}getIndexToCanvasRatio(e){const{imageData:r}=e.getImageData()||{},n=e.worldToCanvas(r.indexToWorld([1,0,0])),i=e.worldToCanvas(r.indexToWorld([2,0,0])),o=[i[0]-n[0],i[1]-n[1]];return Math.sqrt(o[0]*o[0]+o[1]*o[1])}drawDepthGuide(e,r){if(!this.getFanShapeGeometryParameters(r))return;const{imageData:n}=r.getImageData()||{};if(!n)return;const i=g=>g*180/Math.PI,o=g=>g*Math.PI/180,a=g=>r.worldToCanvas(L_(n,g)),s=this.configuration.innerRadius+this.configuration.depth_ratio*(this.configuration.outerRadius-this.configuration.innerRadius),c=this.configuration.startAngle,d=this.configuration.endAngle-c,u=o(d)*s;let f=Math.round(u/(this.configuration.depthGuideDashLength+this.configuration.depthGuideDashGap));f<=0&&(f=Math.max(15,Math.round(d/5)));const h=d/f;for(let g=0;g<f;g++){const p=o(c+g*h),v=o(c+g*h+i(this.configuration.depthGuideDashLength)/s),w=[this.configuration.center[0]+s*Math.cos(p),this.configuration.center[1]+s*Math.sin(p),0],m=[this.configuration.center[0]+s*Math.cos(v),this.configuration.center[1]+s*Math.sin(v),0];qt(e,r.id,`depthGuide-${g}`,a(w),a(m),{color:this.configuration.depthGuideColor,lineWidth:this.configuration.depthGuideThickness,strokeOpacity:this.configuration.depthGuideOpacity})}}_isInsideVolume(e,r,n){return Sr(e,n)&&Sr(r,n)}};Hn.toolName="UltrasoundPleuraBLineTool",Hn.USPleuraBLineAnnotationType={BLINE:"bLine",PLEURA:"pleura"},Hn.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{FrameOfReferenceUID:o,referencedImageId:a,viewPlaneNormal:s,instance:c,viewport:l}=Hn.hydrateBase(Hn,i,r,n),{toolInstance:d,...u}=n||{},f={annotationUID:n?.annotationUID||cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:o,referencedImageId:a,...u}};Ft(f,l.element),Me([l.id])};let i5=Hn;function R0e(t,e){return[""]}const kf=class kf extends Un{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:A0e,changeTextCallback:L0e,canvasPosition:[10,10],canvasSize:10,handleRadius:"6",seriesLevel:!1,isPoint:!1}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=Ce(o),{viewport:c}=s,l=a.world,d=this.constructor.createAnnotationForViewport(c,{data:{handles:{points:[[...l]]},seriesLevel:this.configuration.seriesLevel,isPoint:this.configuration.isPoint}});Ft(d,o);const u=vt(o,this.getToolName());return n.preventDefault(),Me(u),this.configuration.getTextCallback(f=>{if(!f){kt(d.annotationUID),Me(u),this.isDrawing=!1;return}d.data.label=f,xn(d),Me(u)}),this.createMemo(o,d,{newAnnotation:!0}),d},this.isPointNearTool=(n,i,o,a)=>{const s=Ce(n),{viewport:c}=s,{data:l}=i;if(!l?.isPoint)return!1;const{canvasPosition:d,canvasSize:u}=this.configuration;return d?.length?Math.abs(o[0]-d[0]+u/2)<=u/2&&Math.abs(o[1]-d[1]+u/2)<=u/2:!1},this.toolSelectedCallback=(n,i)=>{i.highlighted=!0,n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{viewportId:l,renderingEngine:d}=Ce(o);this.eventDispatchDetail={viewportId:l,renderingEngineId:d.id},this._deactivateModify(o),Nt(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID),Me(s),c&&xn(a)},this.doubleClickCallback=n=>{const i=n.detail,{element:o}=i;let a=$t(this.getToolName(),o);if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return;const s=a.find(l=>this.isPointNearTool(o,l,i.currentPoints.canvas,6));if(!s)return;const c=s;this.createMemo(o,c),this.configuration.changeTextCallback(s,n.detail,this._doneChangingTextCallback.bind(this,o,c)),this.isDrawing=!1,this.doneEditMemo(),n.stopImmediatePropagation(),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,newAnnotation:d}=this.editData,{data:u}=c;this.createMemo(a,c,{newAnnotation:d}),u.handles.points[0]=[...s],c.invalidated=!0,Me(l)},this._activateModify=n=>{Ue.isInteractingWithTool=!0,n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{Ue.isInteractingWithTool=!1,n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=$t(this.getToolName(),s);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(s,c),!c?.length))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const u=c[d],{annotationUID:f,data:h}=u;l.annotationUID=f;const{color:g,lineWidth:p}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),{canvasPosition:v,canvasSize:w}=this.configuration,m="1";if(h?.isPoint){const y=h.handles.points[0],C=a.worldToCanvas(y);kn(i,f,m,[C],{color:g,lineWidth:p,handleRadius:this.configuration.handleRadius})}else v?.length&&c1(i,f,m,v.map(y=>y+w),v,{color:g,width:1});if(o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o}return o}}handleSelectedCallback(e,r){const n=e.detail,{element:i}=n;r.highlighted=!0;const o=vt(i,this.getToolName());this.editData={annotation:r,viewportIdsToRender:o},this._activateModify(i),St(i),Me(o),e.preventDefault()}static setPoint(e,r=!e.data.isPoint,n){e.data.isPoint=r,Gt(e,n)}_doneChangingTextCallback(e,r,n){r.data.label=n;const i=vt(e,this.getToolName());Me(i),Gt(r,e)}cancel(e){if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(e),Nt(e);const{annotation:r,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:o}=r;return r.highlighted=!1,o.handles.activeHandleIndex=null,Me(n),i&&xn(r),this.editData=null,r.annotationUID}}_isInsideVolume(e,r,n){return Sr(e,n)&&Sr(r,n)}};kf.toolName="KeyImage",kf.dataSeries={data:{seriesLevel:!0}},kf.dataPoint={data:{isPoint:!0}};let o5=kf;function A0e(t){return t(prompt("Enter your annotation:"))}function L0e(t,e,r){return r(prompt("Enter your annotation:"))}class PP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.preMouseDownCallback=n=>this._deleteNearbyAnnotations(n,"mouse"),this.preTouchStartCallback=n=>this._deleteNearbyAnnotations(n,"touch")}_deleteNearbyAnnotations(e,r){const{renderingEngineId:n,viewportId:i,element:o,currentPoints:a}=e.detail,s=Qn(i,n);if(!s)return!1;const c=s._toolInstances,l=[];for(const d in c){const u=c[d];if(typeof u.isPointNearTool!="function"||typeof u.filterInteractableAnnotationsForElement!="function")continue;const f=$t(d,o),h=u.filterInteractableAnnotationsForElement(o,f);if(h)for(const g of h)u.isPointNearTool(o,g,a.canvas,10,r)&&l.push(g.annotationUID)}for(const d of l){$o(d);const u=fn(d);Un.createAnnotationMemo(o,u,{deleting:!0}),kt(d)}return e.preventDefault(),!0}}PP.toolName="Eraser";const{transformWorldToIndex:N_,transformIndexToWorld:N0e}=hn,Ff=class Ff extends ar{constructor(e,r){const n=kr({configuration:{positiveStdDevMultiplier:_O,shrinkExpandIncrement:.1,islandRemoval:{enabled:!1}}},r);super(e,n)}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=Ce(n),{viewport:s,renderingEngine:c}=a,{viewUp:l}=s.getCamera(),{segmentationId:d,segmentIndex:u,labelmapVolumeId:f,referencedVolumeId:h}=await this.getLabelmapSegmentationData(s);if(!this._isOrthogonalView(s,h))throw new Error("Oblique view is not supported yet");return this.growCutData={metadata:{...s.getViewReference({points:[o]}),viewUp:l},segmentation:{segmentationId:d,segmentIndex:u,labelmapVolumeId:f,referencedVolumeId:h},viewportId:s.id,renderingEngineId:c.id},e.preventDefault(),!0}shrink(){this._runLastCommand({shrinkExpandAmount:-this.configuration.shrinkExpandIncrement})}expand(){this._runLastCommand({shrinkExpandAmount:this.configuration.shrinkExpandIncrement})}refresh(){this._runLastCommand()}async getGrowCutLabelmap(e){throw new Error("Not implemented")}async runGrowCut(){const{growCutData:e,configuration:r}=this,{segmentation:{segmentationId:n,segmentIndex:i,labelmapVolumeId:o}}=e,a=Ne.getVolume(o);let s=0;const c=async({shrinkExpandAmount:l=0}={})=>{l!==0&&(this.seeds=null),s+=l;const d=Math.max(.1,r.positiveStdDevMultiplier+s),u=l<0?Math.max(1,ky-Math.abs(s)*3):ky+s*3,f={...e,options:{...e.options||{},positiveSeedValue:i,negativeSeedValue:255,positiveStdDevMultiplier:d,negativeSeedMargin:u}},h=await this.getGrowCutLabelmap(f),{isPartialVolume:g}=r;(g?this.applyPartialGrowCutLabelmap:this.applyGrowCutLabelmap)(n,i,a,h),this._removeIslands(f)};await c(),Ff.lastGrowCutCommand=c,this.growCutData=null}applyPartialGrowCutLabelmap(e,r,n,i){const o=i.voxelManager.getCompleteScalarDataArray(),a=n.voxelManager,[s,c,l]=i.dimensions,[d,u]=n.dimensions,f=s*c,h=d*u;for(let g=0;g<l;g++)for(let p=0;p<c;p++){const v=[0,p,g],w=N0e(i.imageData,v),m=N_(n.imageData,w),[y,C,x]=m,S=p*s+g*f,T=y+C*d+x*h;for(let _=0;_<s;_++){const E=o[S+_]===r?r:0;a.setAtIndex(T+_,E)}}ei(e)}applyGrowCutLabelmap(e,r,n,i){const o=n.voxelManager;i.voxelManager.forEach(({value:s,index:c})=>{s===r&&o.setAtIndex(c,s)}),ei(e)}_runLastCommand({shrinkExpandAmount:e=0}={}){const r=Ff.lastGrowCutCommand;r&&r({shrinkExpandAmount:e})}async getLabelmapSegmentationData(e){const r=uc(e.id);if(!r)throw new Error("No active segmentation found");const{segmentationId:n}=r,i=zi(n),{representationData:o}=Ut(n),a=o[yt.Labelmap];let{volumeId:s,referencedVolumeId:c}=a;if(!s){const l=e.getImageIds();if(vl(l))s=yd(n).volumeId;else{const d=e.getCurrentImageId(),u=Ne.getImage(d),f=cy(d);c=this._createFakeVolume([u.imageId,f.imageId]).volumeId;const g=wl(e.id,n),p=cy(g);s=this._createFakeVolume([g,p.imageId]).volumeId}}if(!c){const{imageIds:l}=a,d=l.map(h=>Ne.getImage(h).referencedImageId),u=Ne.generateVolumeId(d),f=Ne.getVolume(u);c=f?f.volumeId:(await J1(u,d)).volumeId}return{segmentationId:n,segmentIndex:i,labelmapVolumeId:s,referencedVolumeId:c}}_createFakeVolume(e){const r=Ne.generateVolumeId(e),n=Ne.getVolume(r);if(n)return n;const i=Y1(e,r),o=i.spacing;o[2]===0&&(o[2]=1);const a=new id({volumeId:r,dataType:i.dataType,metadata:structuredClone(i.metadata),dimensions:i.dimensions,spacing:i.spacing,origin:i.origin,direction:i.direction,referencedVolumeId:i.referencedVolumeId,imageIds:i.imageIds,referencedImageIds:i.referencedImageIds});return Ne.putVolumeSync(r,a),a}_isOrthogonalView(e,r){const i=Ne.getVolume(r).imageData,o=e.getCamera(),{ijkVecColDir:a,ijkVecSliceDir:s}=am(i,o);return[a,s].every(c=>Et(Math.abs(c[0]),1)||Et(Math.abs(c[1]),1)||Et(Math.abs(c[2]),1))}getRemoveIslandData(e){}_removeIslands(e){const{islandRemoval:r}=this.configuration;if(!r.enabled)return;const{segmentation:{segmentIndex:n,labelmapVolumeId:i},renderingEngineId:o,viewportId:a}=e,s=Ne.getVolume(i),c=this.getRemoveIslandData(e);if(!c)return;const[l,d]=s.dimensions,u=l*d,{worldIslandPoints:f=[],islandPointIndexes:h=[]}=c;let g=[...c?.ijkIslandPoints??[]];const v=Fn(o).getViewport(a),{voxelManager:w}=s,m=new Lu;g=g.concat(f.map(y=>N_(s.imageData,y))),g=g.concat(h.map(y=>{const C=y%l,x=Math.floor(y/l)%d,S=Math.floor(y/u);return[C,x,S]})),m.initialize(v,w,{points:g,previewSegmentIndex:n,segmentIndex:n}),m.floodFillSegmentIsland(),m.removeExternalIslands(),m.removeInternalIslands()}getSegmentStyle({segmentationId:e,viewportId:r,segmentIndex:n}){return eM({segmentationId:e,segmentIndex:n,viewportId:r})}};Ff.lastGrowCutCommand=null;let Y0=Ff;Y0.toolName="GrowCutBaseTool";const Fx=class Fx extends Y0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{isPartialVolume:!0,positiveSeedVariance:.5,negativeSeedVariance:.9}}){super(e,r),this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,{world:s}=a,c=Ce(o),{viewport:l}=c;this.growCutData.circleBorderPoint=s,Me([l.id])},this._endCallback=async n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a;this.runGrowCut(),this._deactivateDraw(o),this.growCutData=null,Nt(o),Me([s.id])},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback)}}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=Ce(n),{viewport:s,renderingEngine:c}=a;return await super.preMouseDownCallback(e),Object.assign(this.growCutData,{circleCenterPoint:o,circleBorderPoint:o}),this._activateDraw(n),St(n),Me([s.id]),!0}async getGrowCutLabelmap(e){const{segmentation:{referencedVolumeId:r},renderingEngineId:n,viewportId:i,circleCenterPoint:o,circleBorderPoint:a,options:s}=e,l=Fn(n).getViewport(i),d=k0(rn(Ie(),o,a));return SO(r,{center:o,radius:d},l,s)}_activateDraw(e){e.addEventListener(V.MOUSE_UP,this._endCallback),e.addEventListener(V.MOUSE_DRAG,this._dragCallback),e.addEventListener(V.MOUSE_CLICK,this._endCallback)}renderAnnotation(e,r){if(!this.growCutData)return;const{viewport:n}=e,{segmentation:i,circleCenterPoint:o,circleBorderPoint:a}=this.growCutData,s=n.worldToCanvas(o),c=n.worldToCanvas(a),l=mo(xt(),c,s),d=EV(l);if(Et(d,0))return;const u="growcut",f="0",{color:h}=this.getSegmentStyle({segmentationId:i.segmentationId,segmentIndex:i.segmentIndex,viewportId:n.id});hi(r,u,f,s,d,{color:h})}};Fx.toolName="RegionSegment";let a5=Fx;const Ux=class Ux extends Y0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{isPartialVolume:!1,positiveSeedVariance:.4,negativeSeedVariance:.9,subVolumePaddingPercentage:.1,islandRemoval:{enabled:!1}}}){super(e,r),this.mouseTimer=null,this.allowedToProceed=!1}mouseMoveCallback(e){if(this.mode!==Cn.Active)return;const r=e.detail,{currentPoints:n,element:i}=r,{world:o}=n;i.style.cursor="default",this.mouseTimer!==null&&(window.clearTimeout(this.mouseTimer),this.mouseTimer=null),this.mouseTimer=window.setTimeout(()=>{this.onMouseStable(e,o,i)},this.configuration.mouseStabilityDelay||500)}async onMouseStable(e,r,n){await super.preMouseDownCallback(e);const i=Ne.getVolume(this.growCutData.segmentation.referencedVolumeId),o=EO(i,r,{})||{positiveSeedIndices:new Set,negativeSeedIndices:new Set},{positiveSeedIndices:a,negativeSeedIndices:s}=o;let c;a.size/s.size>20||s.size<30?(c="not-allowed",this.allowedToProceed=!1):(c="copy",this.allowedToProceed=!0);const l=Ce(n);n&&(n.style.cursor=c,requestAnimationFrame(()=>{n.style.cursor!==c&&(n.style.cursor=c)})),this.allowedToProceed&&(this.seeds=o),l&&l.viewport&&l.viewport.render()}async preMouseDownCallback(e){if(!this.allowedToProceed)return!1;const r=e.detail,{currentPoints:n,element:i}=r;Ce(i)&&(i.style.cursor="wait",requestAnimationFrame(()=>{i.style.cursor!=="wait"&&(i.style.cursor="wait")}));const{world:a}=n;return await super.preMouseDownCallback(e),this.growCutData=kr(this.growCutData,{worldPoint:a,islandRemoval:{worldIslandPoints:[a]}}),this.growCutData.worldPoint=a,this.growCutData.islandRemoval={worldIslandPoints:[a]},await this.runGrowCut(),i&&(i.style.cursor="default"),!0}getRemoveIslandData(e){const{worldPoint:r}=e;return{worldIslandPoints:[r]}}async getGrowCutLabelmap(e){const{segmentation:{referencedVolumeId:r},worldPoint:n,options:i}=e,{subVolumePaddingPercentage:o}=this.configuration,a={...i,subVolumePaddingPercentage:o,seeds:this.seeds};return bO({referencedVolumeId:r,worldPosition:n,options:a})}};Ux.toolName="RegionSegmentPlus";let s5=Ux;const V0e=[-1/0,-995],k0e=[0,1900],F0e=[1e3,1900],{transformWorldToIndex:Ug,transformIndexToWorld:dv}=hn;class RP extends Y0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{isPartialVolume:!0,positivePixelRange:k0e,negativePixelRange:V0e,islandRemoval:{enabled:!0,islandPixelRange:F0e}}}){super(e,r),this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,{world:s}=a,c=Ce(o),{viewport:l}=c,d=this._getHorizontalLineWorldPoints(c,s);this.growCutData.horizontalLines[1]=d,Me([l.id])},this._endCallback=async n=>{const i=n.detail,{element:o}=i,a=Ce(o),{viewport:s}=a;await this.runGrowCut(),this._deactivateDraw(o),this.growCutData=null,Nt(o),Me([s.id])},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback)}}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=Ce(n),{viewport:s,renderingEngine:c}=a,l=this._getHorizontalLineWorldPoints(a,o);return await super.preMouseDownCallback(e),this.growCutData.horizontalLines=[l,l],this._activateDraw(n),St(n),Me([s.id]),!0}renderAnnotation(e,r){if(!this.growCutData)return;const{segmentation:n,horizontalLines:i}=this.growCutData;if(i.length!==2)return;const{viewport:o}=e,{segmentationId:a,segmentIndex:s}=n,[c,l]=i,[d,u]=c,[f,h]=l,g=[d,u,h,f].map(S=>o.worldToCanvas(S)),p="growCutRect",v="0",{color:w,fillColor:m,lineWidth:y,fillOpacity:C,lineDash:x}=this.getSegmentStyle({segmentationId:a,segmentIndex:s,viewportId:o.id});jo(r,p,v,g,{color:w,fillColor:m,fillOpacity:C,lineWidth:y,lineDash:x,closePath:!0})}async getGrowCutLabelmap(e){const{segmentation:{segmentIndex:r,referencedVolumeId:n},renderingEngineId:i,viewportId:o,horizontalLines:a}=e,c=Fn(i).getViewport(o),[l,d]=a,u=[l[0],l[1],d[1],d[0]],f=Ne.getVolume(n),{topLeft:h,bottomRight:g}=this._getWorldBoundingBoxFromProjectedSquare(c,u),p=Ug(f.imageData,h),v=Ug(f.imageData,g),w={boundingBox:{ijkTopLeft:p,ijkBottomRight:v}},m=this.configuration,y={positiveSeedValue:r,negativeSeedValue:255,negativePixelRange:m.negativePixelRange,positivePixelRange:m.positivePixelRange};return TO(n,w,y)}getRemoveIslandData(){const{segmentation:{segmentIndex:e,referencedVolumeId:r,labelmapVolumeId:n}}=this.growCutData,i=Ne.getVolume(r),o=Ne.getVolume(n),a=i.voxelManager.getCompleteScalarDataArray(),s=o.voxelManager.getCompleteScalarDataArray(),{islandPixelRange:c}=this.configuration.islandRemoval,l=[];for(let d=0,u=s.length;d<u;d++){if(s[d]!==e)continue;const f=a[d];f>=c[0]&&f<=c[1]&&l.push(d)}return{islandPointIndexes:l}}_activateDraw(e){e.addEventListener(V.MOUSE_UP,this._endCallback),e.addEventListener(V.MOUSE_DRAG,this._dragCallback),e.addEventListener(V.MOUSE_CLICK,this._endCallback)}_projectWorldPointAcrossSlices(e,r,n){const i=this._getViewportVolume(e),{dimensions:o}=i,a=Ug(i.imageData,r),s=n.findIndex(d=>Et(Math.abs(d),1));if(s===-1)throw new Error("Non-orthogonal direction vector");const c=[...a],l=[...a];return c[s]=0,l[s]=o[s]-1,[c,l]}_getCuboidIJKEdgePointsFromProjectedWorldPoint(e,r){const{viewPlaneNormal:n}=e.getCamera();return this._projectWorldPointAcrossSlices(e,r,n)}_getWorldCuboidCornerPoints(e,r){const n=[],i=this._getViewportVolume(e);return r.forEach(o=>{const s=this._getCuboidIJKEdgePointsFromProjectedWorldPoint(e,o).map(c=>dv(i.imageData,c));n.push(...s)}),n}_getWorldBoundingBoxFromProjectedSquare(e,r){const n=this._getWorldCuboidCornerPoints(e,r),i=[...n[0]],o=[...n[0]];return n.forEach(a=>{fV(i,i,a),hV(o,o,a)}),{topLeft:i,bottomRight:o}}_getViewportVolume(e){if(!(e instanceof Zn))throw new Error("Viewport is not a BaseVolumeViewport");const r=e.getAllVolumeIds()[0];return Ne.getVolume(r)}_getHorizontalLineIJKPoints(e,r){const{viewport:n}=e,i=this._getViewportVolume(n),{dimensions:o}=i,a=Ug(i.imageData,r),{viewUp:s,viewPlaneNormal:c}=n.getCamera(),d=tn(Ie(),s,c).findIndex(h=>Et(Math.abs(h),1)),u=[...a],f=[...a];return u[d]=0,f[d]=o[d]-1,[u,f]}_getHorizontalLineWorldPoints(e,r){const{viewport:n}=e,i=this._getViewportVolume(n),[o,a]=this._getHorizontalLineIJKPoints(e,r),s=dv(i.imageData,o),c=dv(i.imageData,a);return[s,c]}}RP.toolName="WholeBodySegment";function U0e(t,e,r=!0){const n=Object.assign({},e,{segmentIndex:0});tx(t,n)}function B0e(t,e){U0e(t,e,!0)}class AP extends Nu{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:tx,ERASE_INSIDE:B0e},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c;this.isDrawing=!0;const d=l.getCamera(),{viewPlaneNormal:u,viewUp:f}=d,h=uc(l.id);if(!h)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:g}=h,p=zi(g),v=Bu(g),w=as(l.id,g,p),{representationData:m}=Ut(g),y=m[yt.Labelmap],C={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],viewUp:[...f],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:w},data:{handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null}}},x=vt(a,this.getToolName());if(this.editData={annotation:C,segmentIndex:p,segmentationId:g,segmentsLocked:v,segmentColor:w,viewportIdsToRender:x,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},l instanceof Zn){const{volumeId:S}=y,T=Ne.getVolume(S);this.editData={...this.editData,volumeId:S,referencedVolumeId:T.referencedVolumeId}}else{const S=wl(l.id,g);this.editData={...this.editData,imageId:S}}return this._activateDraw(a),St(a),n.preventDefault(),Me(x),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c}=this.editData,{data:l}=a,{currentPoints:d}=i,u=Ce(o),{worldToCanvas:f,canvasToWorld:h}=u.viewport,g=d.world,{points:p}=l.handles;p[c]=[...g];let v,w,m,y,C,x,S,T;switch(c){case 0:case 3:v=f(p[0]),y=f(p[3]),w=[y[0],v[1]],m=[v[0],y[1]],x=h(w),S=h(m),p[1]=x,p[2]=S;break;case 1:case 2:w=f(p[1]),m=f(p[2]),v=[m[0],w[1]],y=[w[0],m[1]],C=h(v),T=h(y),p[0]=C,p[3]=T;break}a.invalidated=!0,this.editData.hasMoved=!0,Me(s)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=a;if(s&&!c)return;l.handles.activeHandleIndex=null,this._deactivateDraw(o),Nt(o);const d=Ce(o),u={...this.editData,points:l.handles.points,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(d,u),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{annotation:s}=this.editData,c=s.metadata,l=s.annotationUID,d=s.data,{points:u}=d.handles,f=u.map(p=>a.worldToCanvas(p)),h=`rgb(${c.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(zh(i,l,"0",f[0],f[3],{color:h}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}AP.toolName="RectangleScissor";class LP extends Nu{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:km,ERASE_INSIDE:dO},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=o.canvas,l=Ce(a),{viewport:d}=l;this.isDrawing=!0;const u=d.getCamera(),{viewPlaneNormal:f,viewUp:h}=u,g=uc(d.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,v=zi(p),w=Bu(p),m=as(d.id,p,v),{representationData:y}=Ut(p),C=y.Labelmap;if(!C)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const x={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...f],viewUp:[...h],FrameOfReferenceUID:d.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:m},data:{handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},S=[d.id];if(this.editData={annotation:x,centerCanvas:c,segmentIndex:v,segmentationId:p,segmentsLocked:w,segmentColor:m,viewportIdsToRender:S,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},d instanceof Zn){const{volumeId:T}=C,_=Ne.getVolume(T);this.editData={...this.editData,volumeId:T,referencedVolumeId:_.referencedVolumeId}}else{const T=wl(d.id,p);this.editData={...this.editData,imageId:T}}return this._activateDraw(a),St(a),n.preventDefault(),Me(S),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{renderingEngine:l,viewport:d}=c,{canvasToWorld:u}=d,{annotation:f,viewportIdsToRender:h,centerCanvas:g}=this.editData,{data:p}=f,v=Math.abs(s[0]-g[0]),w=Math.abs(s[1]-g[1]),m=Math.sqrt(v*v+w*w),y=[g[0],g[1]+m],C=[g[0],g[1]-m],x=[g[0]-m,g[1]],S=[g[0]+m,g[1]];p.handles.points=[u(y),u(C),u(x),u(S)],f.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=a,{viewPlaneNormal:d,viewUp:u}=a.metadata;if(s&&!c)return;l.handles.activeHandleIndex=null,this._deactivateDraw(o),Nt(o);const f=Ce(o),h={...this.editData,points:l.handles.points,viewPlaneNormal:d,viewUp:u,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(f,h),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback),n.addEventListener(V.TOUCH_END,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{viewportIdsToRender:s}=this.editData;if(!s.includes(a.id))return o;const{annotation:c}=this.editData,l=c.metadata,d=c.annotationUID,u=c.data,{points:f}=u.handles,h=f.map(C=>a.worldToCanvas(C)),g=h[0],p=h[1],v=[Math.floor((g[0]+p[0])/2),Math.floor((g[1]+p[1])/2)],w=Math.abs(g[1]-Math.floor((g[1]+p[1])/2)),m=`rgb(${l.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(hi(i,d,"0",v,w,{color:m}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}LP.toolName="CircleScissor";class NP extends Nu{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:lO,ERASE_INSIDE:uO},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;this.doneEditMemo();const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=o.canvas,l=Ce(a),{viewport:d}=l;this.isDrawing=!0;const u=d.getCamera(),{viewPlaneNormal:f,viewUp:h}=u,g=uc(d.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,v=zi(p),w=Bu(p),m=as(d.id,p,v);this.isDrawing=!0;const y={metadata:{viewPlaneNormal:[...f],viewUp:[...h],FrameOfReferenceUID:d.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:m},data:{invalidated:!0,handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},C=[d.id];this.editData={annotation:y,centerCanvas:c,segmentIndex:v,segmentationId:p,segmentsLocked:w,segmentColor:m,toolGroupId:this.toolGroupId,viewportIdsToRender:C,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null};const{representationData:x}=Ut(p),S=this.getEditData({viewport:d,representationData:x,segmentsLocked:w,segmentationId:p});return this.editData={...this.editData,...S},this._activateDraw(a),St(a),n.preventDefault(),Me(C),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=Ce(o),{renderingEngine:l,viewport:d}=c,{canvasToWorld:u}=d,{annotation:f,viewportIdsToRender:h,centerCanvas:g}=this.editData,{data:p}=f,v=Math.abs(s[0]-g[0]),w=Math.abs(s[1]-g[1]),m=Math.sqrt(v*v+w*w),y=[g[0],g[1]+m],C=[g[0],g[1]-m],x=[g[0]-m,g[1]],S=[g[0]+m,g[1]];p.handles.points=[u(y),u(C),u(x),u(S)],f.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c,segmentIndex:l,segmentsLocked:d}=this.editData,{data:u}=a,{viewPlaneNormal:f,viewUp:h}=a.metadata;if(s&&!c)return;a.highlighted=!1,u.handles.activeHandleIndex=null,this._deactivateDraw(o),Nt(o);const g=Ce(o),p={...this.editData,points:u.handles.points,segmentIndex:l,segmentsLocked:d,viewPlaneNormal:f,viewUp:h,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(g,p),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(V.MOUSE_UP,this._endCallback),n.addEventListener(V.MOUSE_DRAG,this._dragCallback),n.addEventListener(V.MOUSE_CLICK,this._endCallback),n.addEventListener(V.MOUSE_MOVE,this._dragCallback),n.addEventListener(V.TOUCH_END,this._endCallback),n.addEventListener(V.TOUCH_TAP,this._endCallback),n.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{n.removeEventListener(V.MOUSE_UP,this._endCallback),n.removeEventListener(V.MOUSE_DRAG,this._dragCallback),n.removeEventListener(V.MOUSE_CLICK,this._endCallback),n.removeEventListener(V.MOUSE_MOVE,this._dragCallback),n.removeEventListener(V.TOUCH_END,this._endCallback),n.removeEventListener(V.TOUCH_DRAG,this._dragCallback),n.removeEventListener(V.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{viewportIdsToRender:s}=this.editData;if(!s.includes(a.id))return o;const{annotation:c}=this.editData,l=c.metadata,d=c.annotationUID,u=c.data,{points:f}=u.handles,h=f.map(C=>a.worldToCanvas(C)),g=h[0],p=h[1],v=[Math.floor((g[0]+p[0])/2),Math.floor((g[1]+p[1])/2)],w=Math.abs(g[1]-Math.floor((g[1]+p[1])/2)),m=`rgb(${l.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(hi(i,d,"0",v,w,{color:m}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}NP.toolName="SphereScissor";const{transformWorldToIndex:fv}=hn;class VP extends Ch{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{simplified:!0,storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!0,getTextLines:G0e,statsCalculator:is,showTextBox:!1,throttleTimeout:100}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l,renderingEngine:d}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:f,viewUp:h}=u;let g,p,v;if(l instanceof Wn)throw new Error("Stack Viewport Not implemented");{const _=this.getTargetId(l);v=cs(_),p=Ne.getVolume(v),g=rc(p,s,f)}const w=ml(p,f),m=this._getStartCoordinate(s,w,f),y=this._getEndCoordinate(s,w,f),C=l.getFrameOfReferenceUID();let x;this.configuration.simplified?x=[[...s],[...s]]:x=[[...s],[...s],[...s],[...s],[...s]];const S={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...h],FrameOfReferenceUID:C,referencedImageId:g,volumeId:v,spacingInNormal:w,enabledElement:c},data:{label:"",startCoordinate:m,endCoordinate:y,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:x,activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[],statistics:[]},labelmapUID:null}};this._computeProjectionPoints(S,p),Ft(S,a);const T=vt(a,this.getToolName());return this.editData={annotation:S,viewportIdsToRender:T,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),St(a),n.preventDefault(),Me(T),S},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:d}=a;if(c&&!l)return;a.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Nt(o);const{metadata:u}=a,{enabledElement:f}=u;this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(a.annotationUID);const h=this.getTargetId(f.viewport),g=Ne.getVolume(h.split(/volumeId:|\?/)[1]);this._computePointsInsideVolume(a,g,h,f),Me(s),c?xn(a):Gt(a,o)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;let s=$t(this.getToolName(),a.element);if(!s?.length)return o;s=Im(s,a.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let l=0;l<s.length;l++){const d=s[l],{annotationUID:u,data:f,metadata:h}=d,{startCoordinate:g,endCoordinate:p}=f,{points:v,activeHandleIndex:w}=f.handles,{enabledElement:m}=h;c.annotationUID=u;const y=this.getStyle("lineWidth",c,d),C=this.getStyle("lineDash",c,d),x=this.getStyle("color",c,d),S=v.map(fe=>a.worldToCanvas(fe)),T=S[0],_=al([S[0],S[1]]),{centerPointRadius:E}=this.configuration,D=pu([S[0],S[1]]),b=a.getCamera().focalPoint,I=a.getCamera().viewPlaneNormal;let O=g,M=p;Array.isArray(g)&&(O=this._getCoordinateForViewplaneNormal(O,I),f.startCoordinate=O),Array.isArray(p)&&(M=this._getCoordinateForViewplaneNormal(M,I),f.endCoordinate=M);const R=Qc(f.startCoordinate),A=Qc(f.endCoordinate),G=this._getCoordinateForViewplaneNormal(b,I),k=Qc(G);if(k<Math.min(R,A)||k>Math.max(R,A))continue;const L=Qc((f.startCoordinate+f.endCoordinate)/2);let F=!1;k===L&&(F=!0),f.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(I)]=L;const j=m.viewport?.volumeIds.values();for(const fe of j)d.invalidated&&d.metadata.volumeId===fe&&this._throttledCalculateCachedStats(d,m);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let Y;if(!or(u))continue;!ir(u)&&!this.editData&&w!==null&&F&&(this.configuration.simplified?Y=[S[w]]:Y=S),Y&&kn(i,u,"0",Y,{color:x});let ie=y,de=C;F?(ie=y,de=[]):de=[5,5];const ae="0";if(hi(i,u,ae,T,_,{color:x,lineDash:de,lineWidth:ie}),E>0&&_>3*E&&hi(i,u,`${ae}-center`,T,E,{color:x,lineDash:C,lineWidth:y}),o=!0,this.configuration.showTextBox){const fe=this.getLinkedTextBoxStyle(c,d);if(!fe.visibility){f.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const we=this.configuration.getTextLines(f,{metadata:h});if(!we||we.length===0)continue;let _e;f.handles.textBox.hasMoved||(_e=to(D),f.handles.textBox.worldPosition=a.canvasToWorld(_e));const Se=a.worldToCanvas(f.handles.textBox.worldPosition),P=gi(i,u,"1",we,Se,[S[0],S[1]],{},fe),{x:$,y:W,width:K,height:Q}=P;f.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([$,W]),topRight:a.canvasToWorld([$+K,W]),bottomLeft:a.canvasToWorld([$,W+Q]),bottomRight:a.canvasToWorld([$+K,W+Q])}}}return o},this.configuration.calculatePointsInsideVolume?this._throttledCalculateCachedStats=Pi(this._calculateCachedStatsTool,this.configuration.throttleTimeout,{trailing:!0}):this._throttledCalculateCachedStats=pd(this._calculateCachedStatsTool,this.configuration.throttleTimeout)}_computeProjectionPoints(e,r){const{data:n,metadata:i}=e,{viewPlaneNormal:o,spacingInNormal:a}=i,{startCoordinate:s,endCoordinate:c}=n,{points:l}=n.handles,d=this._getIndexOfCoordinatesForViewplaneNormal(o),u=Fo(l[0]);u[d]=s;const f=Fo(l[0]);f[d]=c;const h=Ie();an(h,f,u);const g=pr(h);if(g===0){const w=l.map(m=>{const y=Fo(m);return y[d]=s,Array.from(y)});n.cachedStats.projectionPoints=[w];return}Lt(h,h);const p=Bo(l);p[0][d]=s,p[1][d]=s;const v=[];for(let w=0;w<=g+1e-6;w+=a)v.push(p.map(m=>{const y=Ie();return en(y,m,h,w),Array.from(y)}));n.cachedStats.projectionPoints=v}_computePointsInsideVolume(e,r,n,i){const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:c}=a,{viewport:l}=i,d=o.cachedStats.projectionPoints,u=[[]],f=this.getTargetImageData(n),h=o.handles.points.map(D=>l.worldToCanvas(D)),g=pu([h[0],h[1]])[0],p=pu([h[0],h[1]])[1],v=l.canvasToWorld(g),w=l.canvasToWorld(p),{worldWidth:m,worldHeight:y}=Xh(s,c,v,w),C=_o(f,o.handles.points),x=AC(f),S=Math.abs(Math.PI*(m/C.scale/2)*(y/x/C.scale/2)),T={isPreScaled:dc(l,n),isSuvScaled:this.isSuvScaled(l,n,e.metadata.referencedImageId)},_=fc(a.Modality,e.metadata.referencedImageId,T);for(let D=0;D<d.length;D++){if(!r)continue;const b=d[D][0],I=d[D].map(fe=>l.worldToCanvas(fe)),[O,M]=pu([I[0],I[1]]),R=l.canvasToWorld(O),A=l.canvasToWorld(M),G=R,k=A,{dimensions:L,imageData:F,voxelManager:j}=r,Y=fv(F,G),ie=fv(F,b),de=this._getIndexOfCoordinatesForViewplaneNormal(s);Y[0]=Math.floor(Y[0]),Y[1]=Math.floor(Y[1]),Y[2]=Math.floor(Y[2]),Y[de]=ie[de];const ae=fv(F,k);if(ae[0]=Math.floor(ae[0]),ae[1]=Math.floor(ae[1]),ae[2]=Math.floor(ae[2]),ae[de]=ie[de],Ch.isInsideVolume(L,[Y,ae])){const fe=Math.min(Y[0],ae[0]),we=Math.max(Y[0],ae[0]),_e=Math.min(Y[1],ae[1]),Se=Math.max(Y[1],ae[1]),B=Math.min(Y[2],ae[2]),P=Math.max(Y[2],ae[2]),$=[[fe,we],[_e,Se],[B,P]],K={center:b,xRadius:Math.abs(R[0]-A[0])/2,yRadius:Math.abs(R[1]-A[1])/2,zRadius:Math.abs(R[2]-A[2])/2},Q=j.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:ee=>vm(K,ee),boundsIJK:$,imageData:F,returnPoints:this.configuration.storePointData});u.push(Q)}}const E=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=u,o.cachedStats.statistics={Modality:a.Modality,area:S,mean:E.mean?.value,stdDev:E.stdDev?.value,max:E.max?.value,statsArray:E.array,areaUnit:C.areaUnit,modalityUnit:_}}_calculateCachedStatsTool(e,r){const n=e.data,{viewport:i}=r,{cachedStats:o}=n,a=this.getTargetId(i),s=Ne.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this._computePointsInsideVolume(e,s,a,r),e.invalidated=!1,Gt(e,i.element),o}_getStartCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=Math.round(i/2),a=Ie();return en(a,e,n,o*-r),this._getCoordinateForViewplaneNormal(a,n)}_getEndCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=i-Math.round(i/2),a=Ie();return en(a,e,n,o*r),this._getCoordinateForViewplaneNormal(a,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const r=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return r.indexOf(Math.max(...r))}_getCoordinateForViewplaneNormal(e,r){const n=this._getIndexOfCoordinatesForViewplaneNormal(r);return e[n]}}function G0e(t,e={}){const r=t.cachedStats.statistics,{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Ht(n)} ${s}`),l.push(`Mean: ${Ht(i)} ${c}`),l.push(`Max: ${Ht(o)} ${c}`),l.push(`Std Dev: ${Ht(a)} ${c}`),l}VP.toolName="CircleROIStartEndThreshold";const{transformWorldToIndex:V_,isEqual:hv}=hn;class kP extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.preMouseDownCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=Ce(a),{viewport:l}=c,d=l.getCamera(),{viewPlaneNormal:u}=d,f=uc(l.id);if(!f)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:h}=f,g=zi(h),p=Bu(h),{representationData:v}=Ut(h);let w,m,y,C;if(this.doneEditMemo(),l instanceof Zn){const{volumeId:R}=v[yt.Labelmap],A=Ne.getVolume(R);({dimensions:w,direction:m}=A),C=A.voxelManager,y=V_(A.imageData,s)}else{const R=wl(l.id,h);if(!R)throw new Error("No active segmentation imageId detected, create one before using scissors tool");const{imageData:A}=l.getImageData();w=A.getDimensions(),m=A.getDirection(),C=Ne.getImage(R).voxelManager,y=V_(A,s)}const x=this.getFixedDimension(u,m);if(x===void 0){console.warn("Oblique paint fill not yet supported");return}const{floodFillGetter:S,getLabelValue:T,getScalarDataPositionFromPlane:_,inPlaneSeedPoint:E,fixedDimensionValue:D}=this.generateHelpers(C,w,y,x);if(y[0]<0||y[0]>=w[0]||y[1]<0||y[1]>=w[1]||y[2]<0||y[2]>=w[2])return;const b=T(y[0],y[1],y[2]);if(p.includes(b))return;const I=ex(S,E),{flooded:O}=I;O.forEach(R=>{const A=_(R[0],R[1]);C.setAtIndex(A,g)});const M=this.getFramesModified(x,D,I);return ei(h,M),!0},this.getFramesModified=(n,i,o)=>{const{flooded:a}=o;if(n===2)return[i];let s=1/0,c=-1/0;for(let d=0;d<a.length;d++){const u=a[d][1];u<s&&(s=u),u>c&&(c=u)}const l=[];for(let d=s;d<=c;d++)l.push(d);return l},this.generateHelpers=(n,i,o,a=2)=>{let s,c;switch(a){case 0:s=o[0],c=[o[1],o[2]];break;case 1:s=o[1],c=[o[0],o[2]];break;case 2:s=o[2],c=[o[0],o[1]];break;default:throw new Error(`Invalid fixedDimension: ${a}`)}const l=(h,g,p)=>n.toIndex([h,g,p]),d=(h,g,p)=>n.getAtIJK(h,g,p),u=this.generateFloodFillGetter(i,a,s,d);return{getScalarDataPositionFromPlane:this.generateGetScalarDataPositionFromPlane(l,a,s),getLabelValue:d,floodFillGetter:u,inPlaneSeedPoint:c,fixedDimensionValue:s}},this.generateFloodFillGetter=(n,i,o,a)=>{let s;switch(i){case 0:s=(c,l)=>{if(!(c>=n[1]||c<0||l>=n[2]||l<0))return a(o,c,l)};break;case 1:s=(c,l)=>{if(!(c>=n[0]||c<0||l>=n[2]||l<0))return a(c,o,l)};break;case 2:s=(c,l)=>{if(!(c>=n[0]||c<0||l>=n[1]||l<0))return a(c,l,o)};break;default:throw new Error(`Invalid fixedDimension: ${i}`)}return s},this.generateGetScalarDataPositionFromPlane=(n,i,o)=>{let a;switch(i){case 0:a=(s,c)=>n(o,s,c);break;case 1:a=(s,c)=>n(s,o,c);break;case 2:a=(s,c)=>n(s,c,o);break;default:throw new Error(`Invalid fixedDimension: ${i}`)}return a}}getFixedDimension(e,r){const n=r.slice(0,3),i=r.slice(3,6),o=r.slice(6,9),a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],s=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(hv(a,s))return 0;const c=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];if(hv(a,c))return 1;const l=[Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2])];if(hv(a,l))return 2}}kP.toolName="PaintFill";const W0e={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"};var px={Corners:W0e};const{vtkErrorMacro:gv}=Z,{Corners:Bg}=px;function $0e(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");const r={...t},n=[],i=B6.newInstance(),o=new ResizeObserver(f=>{t.updateViewport()});let a=null,s=null,c=null,l=null,d=null;function u(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{const f=e.parentRenderer||e._interactor.getCurrentRenderer(),[h,g,p,v]=f.getViewport(),w=e._interactor.getView(),m=w.getSize(),[y,C]=w.getViewportSize(f),x=Math.min(y,C);let S=e.viewportSize*x;S=Math.max(Math.min(e.minPixelSize,x),Math.min(e.maxPixelSize,S));const T=S/m[0],_=S/m[1];switch(e.viewportCorner){case Bg.TOP_LEFT:return[h,v-_,h+T,v];case Bg.TOP_RIGHT:return[p-T,v-_,p,v];case Bg.BOTTOM_LEFT:return[h,g,h+T,g+_];case Bg.BOTTOM_RIGHT:return[p-T,g,p,g+_];default:return gv("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(i.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{const h=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!h)return;const g=h.getReferenceByName("position"),p=h.getReferenceByName("focalPoint"),v=h.getReferenceByName("viewUp");if(n[0]!==g[0]||n[1]!==g[1]||n[2]!==g[2]||n[3]!==p[0]||n[4]!==p[1]||n[5]!==p[2]||n[6]!==v[0]||n[7]!==v[1]||n[8]!==v[2]){n[0]=g[0],n[1]=g[1],n[2]=g[2],n[3]=p[0],n[4]=p[1],n[5]=p[2],n[6]=v[0],n[7]=v[1],n[8]=v[2];const w=i.getActiveCamera();w.setPosition(g[0],g[1],g[2]),w.setFocalPoint(p[0],p[1],p[2]),w.setViewUp(v[0],v[1],v[2]),i.resetCamera()}},t.setEnabled=f=>{if(f){if(e.enabled)return;if(!e.actor){gv("Must set actor before enabling orientation marker.");return}if(!e._interactor){gv("Must set interactor before enabling orientation marker.");return}const h=e.parentRenderer||e._interactor.getCurrentRenderer(),g=h.getRenderWindow();g.addRenderer(i),g.getNumberOfLayers()<2&&g.setNumberOfLayers(2),i.setLayer(g.getNumberOfLayers()-1),i.setInteractive(e.interactiveRenderer),i.addViewProp(e.actor),e.actor.setVisibility(!0),a=h.onEvent(p=>{p.type==="ActiveCameraEvent"&&(s&&s.unsubscribe(),s=p.camera.onModified(u))}),s=h.getActiveCamera().onModified(u),c=e._interactor.onAnimation(t.updateMarkerOrientation),l=e._interactor.onEndAnimation(t.updateMarkerOrientation),o.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,o.disconnect(),a.unsubscribe(),a=null,s.unsubscribe(),s=null,c.unsubscribe(),c=null,l.unsubscribe(),l=null,e.actor.setVisibility(!1),i.removeViewProp(e.actor);const h=e._interactor?.findPokedRenderer()?.getRenderWindow();h&&h.removeRenderer(i)}t.modified()},t.setViewportCorner=f=>{f!==e.viewportCorner&&(e.viewportCorner=f,t.updateViewport())},t.setViewportSize=f=>{const h=Math.min(1,Math.max(0,f));h!==e.viewportSize&&(e.viewportSize=h,t.updateViewport())},t.setActor=f=>{const h=e.enabled;t.setEnabled(!1),e.actor=f,t.setEnabled(h)},t.getRenderer=()=>i,t.delete=()=>{r.delete(),d&&(d.unsubscribe(),d=null),a&&(a.unsubscribe(),a=null),s&&(s.unsubscribe(),s=null),c&&(c.unsubscribe(),c=null),l&&(l.unsubscribe(),l=null),o.disconnect()},d=t.onModified(t.updateViewport)}const z0e={viewportCorner:px.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function FP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,z0e,r),Z.obj(t,e),Z.get(t,e,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),Z.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),Z.get(t,e,["actor"]),Z.moveToProtected(t,e,["interactor"]),$0e(t,e)}const j0e=Z.newInstance(FP,"vtkOrientationMarkerWidget");var k_={newInstance:j0e,extend:FP,...px};function UP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0];const[r,n,i,o]=e,s=t.getContext("2d").getImageData(r,n,i||t.width,o||t.height),c=Rh.newInstance({type:"vtkImageData"});c.setOrigin(0,0,0),c.setSpacing(1,1,1),c.setExtent(0,(i||t.width)-1,0,(o||t.height)-1,0,0);const l=Ot.newInstance({numberOfComponents:4,values:new Uint8Array(s.data.buffer)});return l.setName("scalars"),c.getPointData().setScalars(l),c}function H0e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const n=r.getContext("2d"),{flipX:i,flipY:o,rotate:a}=e;return n.translate(r.width/2,r.height/2),n.scale(i?-1:1,o?-1:1),n.rotate(a*Math.PI/180),n.drawImage(t,-t.width/2,-t.height/2),UP(r)}var X0e={canvasToImageData:UP,imageToImageData:H0e};const BP={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:t=>t/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function GP(t,e){e.set(t)}function K0e(t,e){return GP(BP[t],e)}function q0e(t,e){BP[t]=e}var Y0e={applyDefinitions:GP,applyPreset:K0e,registerStylePreset:q0e};const J0e={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};function Z0e(t,e){e.classHierarchy.push("vtkAnnotatedCubeActor"),e.xPlusFaceProperty={...e.xPlusFaceProperty},e.xMinusFaceProperty={...e.xMinusFaceProperty},e.yPlusFaceProperty={...e.yPlusFaceProperty},e.yMinusFaceProperty={...e.yMinusFaceProperty},e.zPlusFaceProperty={...e.zPlusFaceProperty},e.zMinusFaceProperty={...e.zMinusFaceProperty};let r=null;const n=document.createElement("canvas"),i=Mu.newInstance(),o=WJ.newInstance();o.setInterpolate(!0);function a(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;l&&Object.assign(e[`${c}FaceProperty`],l);const d={...e.defaultStyle,...e[`${c}FaceProperty`]};n.width=d.resolution,n.height=d.resolution;const u=n.getContext("2d");u.fillStyle=d.faceColor,u.fillRect(0,0,n.width,n.height),d.edgeThickness>0&&(u.strokeStyle=d.edgeColor,u.lineWidth=d.edgeThickness*n.width,u.strokeRect(0,0,n.width,n.height)),u.save(),u.translate(0,n.height),u.scale(1,-1),u.translate(n.width/2,n.height/2),u.rotate(-Math.PI*(d.faceRotation/180));const f=d.fontSizeScale(d.resolution);u.fillStyle=d.fontColor,u.textAlign="center",u.textBaseline="middle",u.font=`${d.fontStyle} ${f}px "${d.fontFamily}"`,u.fillText(d.text,0,0),u.restore();const h=X0e.canvasToImageData(n);o.setInputData(h,J0e[c]),t.modified()}function s(){r=xb.newInstance({generate3DTextureCoordinates:!0}),i.setInputConnection(r.getOutputPort()),a("xPlus"),a("xMinus"),a("yPlus"),a("yMinus"),a("zPlus"),a("zMinus")}t.setDefaultStyle=c=>{e.defaultStyle={...e.defaultStyle,...c},s()},t.setXPlusFaceProperty=c=>a("xPlus",c),t.setXMinusFaceProperty=c=>a("xMinus",c),t.setYPlusFaceProperty=c=>a("yPlus",c),t.setYMinusFaceProperty=c=>a("yMinus",c),t.setZPlusFaceProperty=c=>a("zPlus",c),t.setZMinusFaceProperty=c=>a("zMinus",c),s(),i.setInputConnection(r.getOutputPort()),t.setMapper(i),t.addTexture(o)}const Q0e={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:t=>t/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function WP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Q0e,r),U0.extend(t,e,r),Z.get(t,e,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),Z0e(t,e)}const ede=Z.newInstance(WP,"vtkAnnotatedCubeActor");var F_={newInstance:ede,extend:WP,Presets:Y0e};const{vtkErrorMacro:tde}=Z;function nde(t,e){let r=0;return t.map((n,i)=>i===r?(r+=n+1,n):n+e)}function Gg(t,e,r,n){t.set(nde(e,r),n)}function rde(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(r,n)=>{const i=t.getNumberOfInputPorts();if(!i){tde("No input specified.");return}if(i===1){n[0]=r[0];return}const o=n[0]&&r[0]!==n[0]?n[0].initialize():Ii.newInstance();let a=0,s=0,c=1,l=1,d=0,u=0,f=0,h=0,g=!0,p=!0,v=!0;for(let b=0;b<i;b++){const I=r[b];if(!I)continue;const O=I.getPoints().getNumberOfPoints();a+=O,d+=I.getVerts().getNumberOfValues(),u+=I.getLines().getNumberOfValues(),f+=I.getStrips().getNumberOfValues(),h+=I.getPolys().getNumberOfValues(),O&&(l&&(l=0,s=I.getPoints().getDataType()),c=I.getPoints().getDataType(),s=s>c?s:c);const M=I.getPointData();M?(g=g&&M.getNormals()!==null,p=p&&M.getTCoords()!==null,v=v&&M.getScalars()!==null):(g=!1,p=!1,v=!1)}e.outputPointsPrecision===Bp.SINGLE?s=Zt.FLOAT:e.outputPointsPrecision===Bp.DOUBLE&&(s=Zt.DOUBLE);const w=F0.newInstance({dataType:s});w.setNumberOfPoints(a);const m=w.getData(),y=new Uint32Array(d),C=new Uint32Array(u),x=new Uint32Array(f),S=new Uint32Array(h);let T=null,_=null,E=null;const D=r[i-1];if(g){const b=D.getPointData().getNormals();T=Ot.newInstance({numberOfComponents:3,numberOfTuples:a,size:3*a,dataType:b.getDataType(),name:b.getName()})}if(p){const b=D.getPointData().getTCoords();_=Ot.newInstance({numberOfComponents:2,numberOfTuples:a,size:2*a,dataType:b.getDataType(),name:b.getName()})}if(v){const b=D.getPointData().getScalars();E=Ot.newInstance({numberOfComponents:b.getNumberOfComponents(),numberOfTuples:a,size:a*b.getNumberOfComponents(),dataType:b.getDataType(),name:b.getName()})}a=0,d=0,u=0,f=0,h=0;for(let b=0;b<i;b++){const I=r[b];m.set(I.getPoints().getData(),a*3),Gg(y,I.getVerts().getData(),a,d),d+=I.getVerts().getNumberOfValues(),Gg(C,I.getLines().getData(),a,u),u+=I.getLines().getNumberOfValues(),Gg(x,I.getStrips().getData(),a,f),f+=I.getStrips().getNumberOfValues(),Gg(S,I.getPolys().getData(),a,h),h+=I.getPolys().getNumberOfValues();const O=I.getPointData();if(g){const M=O.getNormals();T.getData().set(M.getData(),a*3)}if(p){const M=O.getTCoords();_.getData().set(M.getData(),a*2)}if(v){const M=O.getScalars();E.getData().set(M.getData(),a*E.getNumberOfComponents())}a+=I.getPoints().getNumberOfPoints()}o.setPoints(w),o.getVerts().setData(y),o.getLines().setData(C),o.getStrips().setData(x),o.getPolys().setData(S),T&&o.getPointData().setNormals(T),_&&o.getPointData().setTCoords(_),E&&o.getPointData().setScalars(E),n[0]=o}}const ide={outputPointsPrecision:Bp.DEFAULT};function $P(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ide,r),Z.setGet(t,e,["outputPointsPrecision"]),Z.obj(t,e),Z.algo(t,e,1,1),rde(t,e)}const ode=Z.newInstance($P,"vtkAppendPolyData");var zP={newInstance:ode,extend:$P};function ade(t,e){e.classHierarchy.push("vtkConeSource"),t.requestData=(r,n)=>{const i=2*Math.PI/e.resolution,o=-e.height/2,a=e.resolution+1,s=4*e.resolution+1+e.resolution;let c=0;const l=Z.newTypedArray(e.pointType,a*3);let d=0;const u=new Uint32Array(s);l[0]=e.height/2,l[1]=0,l[2]=0,e.capping&&(u[d++]=e.resolution);for(let h=0;h<e.resolution;h++)c++,l[c*3+0]=o,l[c*3+1]=e.radius*Math.cos(h*i),l[c*3+2]=e.radius*Math.sin(h*i),e.capping&&(u[e.resolution-d+++1]=c);for(let h=0;h<e.resolution;h++)u[d++]=3,u[d++]=0,u[d++]=h+1,u[d++]=h+2>e.resolution?1:h+2;Qr.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(l);const f=n[0]?.initialize()||Ii.newInstance();f.getPoints().setData(l,3),f.getPolys().setData(u,1),n[0]=f}}const sde={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function jP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sde,r),Z.obj(t,e),Z.setGet(t,e,["height","radius","resolution","capping"]),Z.setGetArray(t,e,["center","direction"],3),Z.algo(t,e,0,1),ade(t,e)}const cde=Z.newInstance(jP,"vtkConeSource");var lde={newInstance:cde,extend:jP};function ude(t,e){e.classHierarchy.push("vtkCylinderSource"),t.requestData=(r,n)=>{const i=2*Math.PI/e.resolution;let o=2*e.resolution,a=5*e.resolution;e.capping&&(o=4*e.resolution,a=7*e.resolution+2);const s=Z.newTypedArray(e.pointType,o*3);let c=0;const l=new Uint32Array(a),d=new Float32Array(o*3),u=Ot.newInstance({numberOfComponents:3,values:d,name:"Normals"}),f=new Float32Array(o*2),h=Ot.newInstance({numberOfComponents:2,values:f,name:"TCoords"}),g=[0,0,0],p=[0,0,0],v=[0,0,0],w=[0,0,0],m=[0,0],y=[0,0],C=e.otherRadius==null?e.radius:e.otherRadius;for(let S=0;S<e.resolution;S++){g[0]=Math.cos(S*i+e.initAngle),p[0]=g[0],v[0]=e.radius*g[0]+e.center[0],w[0]=v[0],m[0]=Math.abs(2*S/e.resolution-1),y[0]=m[0],v[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],m[1]=0,y[1]=1,g[2]=-Math.sin(S*i+e.initAngle),p[2]=g[2],v[2]=C*g[2]+e.center[2],w[2]=v[2];const T=2*S;for(let _=0;_<3;_++)d[T*3+_]=g[_],d[(T+1)*3+_]=p[_],s[T*3+_]=v[_],s[(T+1)*3+_]=w[_],_<2&&(f[T*2+_]=m[_],f[(T+1)*2+_]=y[_])}for(let S=0;S<e.resolution;S++){l[c++]=4,l[c++]=2*S,l[c++]=2*S+1;const T=(2*S+3)%(2*e.resolution);l[c++]=T,l[c++]=T-1}if(e.capping){for(let S=0;S<e.resolution;S++){v[0]=e.radius*Math.cos(S*i+e.initAngle),w[0]=v[0],m[0]=v[0],y[0]=v[0],v[0]+=e.center[0],w[0]+=e.center[0],g[1]=1,p[1]=-1,v[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],v[2]=-C*Math.sin(S*i+e.initAngle),w[2]=v[2],m[1]=v[2],y[1]=v[2],v[2]+=e.center[2],w[2]+=e.center[2];const T=2*e.resolution+S,_=3*e.resolution+e.resolution-S-1;for(let E=0;E<3;E++)d[3*T+E]=g[E],d[3*_+E]=p[E],s[3*T+E]=v[E],s[3*_+E]=w[E],E<2&&(f[2*T+E]=m[E],f[2*_+E]=y[E])}l[c++]=e.resolution;for(let S=0;S<e.resolution;S++)l[c++]=2*e.resolution+S;l[c++]=e.resolution;for(let S=0;S<e.resolution;S++)l[c++]=3*e.resolution+S}Qr.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(S=>S*-1)).apply(s);const x=n[0]?.initialize()||Ii.newInstance();x.getPoints().setData(s,3),x.getPolys().setData(l,1),x.getPointData().setNormals(u),x.getPointData().setTCoords(h),n[0]=x}}const dde={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function HP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dde,r),Z.obj(t,e),Z.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),Z.setGetArray(t,e,["center","direction"],3),Z.algo(t,e,0,1),ude(t,e)}const fde=Z.newInstance(HP,"vtkCylinderSource");var hde={newInstance:fde,extend:HP};function gde(t,e){e.classHierarchy.push("vtkArrowSource"),t.requestData=(r,n)=>{const i=hde.newInstance({capping:!0});i.setResolution(e.shaftResolution),i.setRadius(e.shaftRadius),i.setHeight(1-e.tipLength),i.setCenter(0,(1-e.tipLength)*.5,0);const o=i.getOutputData(),a=o.getPoints().getData(),s=o.getPointData().getNormals().getData();Qr.buildFromDegree().rotateZ(-90).apply(a).apply(s);const c=lde.newInstance();c.setResolution(e.tipResolution),c.setHeight(e.tipLength),c.setRadius(e.tipRadius);const l=c.getOutputData(),d=l.getPoints().getData();Qr.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(d);const u=zP.newInstance();u.setInputData(o),u.addInputData(l);const f=u.getOutputData(),h=f.getPoints().getData();Qr.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(h),e.invert?(Qr.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(h),n[0]=f):(Qr.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(h),n[0]=u.getOutputData())}}const pde={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function XP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pde,r),Z.obj(t,e),Z.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),Z.setGetArray(t,e,["direction"],3),Z.algo(t,e,0,1),gde(t,e)}const mde=Z.newInstance(XP,"vtkArrowSource");var pv={newInstance:mde,extend:XP};function mv(t){const e=t.getPoints().getBounds(),r=[-(e[0]+e[1])*.5,-(e[2]+e[3])*.5,-(e[4]+e[5])*.5];Qr.buildFromDegree().translate(...r).apply(t.getPoints().getData())}function vv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.getPoints().getBounds(),i=[0,0,0];r?i[e]=-n[e*2+1]:i[e]=-n[e*2],Qr.buildFromDegree().translate(...i).apply(t.getPoints().getData())}function yv(t,e,r,n){const i=t.getPoints().getData().length,o=new Uint8ClampedArray(i);let a=0;for(;a<i;)o[a++]=e,o[a++]=r,o[a++]=n;t.getPointData().setScalars(Ot.newInstance({name:"color",numberOfComponents:3,values:o}))}function vde(t,e){e.classHierarchy.push("vtkAxesActor");const r=Mu.newInstance();t.setMapper(r),t.update=()=>{let i={...e.config,...e.xConfig};const o=pv.newInstance({direction:[1,0,0],...i}).getOutputData();e.config.recenter?mv(o):vv(o,0,i.invert),yv(o,...i.color),i={...e.config,...e.yConfig};const a=pv.newInstance({direction:[0,1,0],...i}).getOutputData();e.config.recenter?mv(a):vv(a,1,i.invert),yv(a,...i.color),i={...e.config,...e.zConfig};const s=pv.newInstance({direction:[0,0,1],...i}).getOutputData();e.config.recenter?mv(s):vv(s,2,i.invert),yv(s,...i.color);const c=zP.newInstance();c.setInputData(o),c.addInputData(a),c.addInputData(s),r.setInputConnection(c.getOutputPort())},t.update();const n=Z.debounce(t.update,0);t.setXAxisColor=i=>t.setXConfig({...t.getXConfig(),color:i}),t.setYAxisColor=i=>t.setYConfig({...t.getYConfig(),color:i}),t.setZAxisColor=i=>t.setZConfig({...t.getZConfig(),color:i}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=n,e._onXConfigChanged=n,e._onYConfigChanged=n,e._onZConfigChanged=n}function yde(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t?.config},xConfig:{color:[255,0,0],invert:!1,...t?.xConfig},yConfig:{color:[255,255,0],invert:!1,...t?.yConfig},zConfig:{color:[0,128,0],invert:!1,...t?.zConfig}}}function KP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};U0.extend(t,e,yde(r)),Z.setGet(t,e,["config","xConfig","yConfig","zConfig"]),vde(t,e)}const wde=Z.newInstance(KP,"vtkAxesActor");var Cde={newInstance:wde,extend:KP},b1;(function(t){t[t.ANNOTATED_CUBE=1]="ANNOTATED_CUBE",t[t.AXES=2]="AXES",t[t.CUSTOM=3]="CUSTOM"})(b1||(b1={}));const Ua=class Ua extends ar{constructor(e={},r={configuration:{orientationWidget:{enabled:!0,viewportCorner:k_.Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:Ua.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[Ua.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"L",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"R",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:n=>n/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[Ua.OVERLAY_MARKER_TYPES.AXES]:{},[Ua.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}){super(e,r),this._resizeObservers=new Map,this.onSetToolEnabled=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolActive=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolDisabled=()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()},this._getViewportsInfo=()=>Fr(this.toolGroupId).viewportsInfo,this.resize=n=>{const i=this.orientationMarkers[n];if(!i)return;const{orientationWidget:o}=i;o.updateViewport()},this.orientationMarkers={},this.updatingOrientationMarker={}}_unsubscribeToViewportNewVolumeSet(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:n,renderingEngineId:i})=>{const{viewport:o}=Ln(n,i),{element:a}=o;a.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this)),this._resizeObservers.get(n).unobserve(a)})};Fe.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,r=>{r.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}_subscribeToViewportEvents(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:n,renderingEngineId:i})=>{const{viewport:o}=Ln(n,i),{element:a}=o;this.initViewports(),a.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const s=new ResizeObserver(()=>{setTimeout(()=>{const c=Ln(n,i);if(!c)return;const{viewport:l}=c;this.resize(n),l.render()},100)});s.observe(a),this._resizeObservers.set(n,s)})};e(),Fe.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,r=>{r.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}cleanUpData(){eo()[0].getViewports().forEach(i=>{const o=this.orientationMarkers[i.id];if(!o)return;const{actor:a,orientationWidget:s}=o;s?.setEnabled(!1),s?.delete(),a?.delete(),i.getRenderingEngine().getOffscreenMultiRenderWindow(i.id).getRenderWindow().render(),i.getRenderingEngine().render(),delete this.orientationMarkers[i.id]})}initViewports(){const r=eo()[0];if(!r)return;let n=r.getViewports();n=Tm(n,this.getToolName()),n.forEach(i=>{const o=i.getWidget(this.getToolName());(!o||o.isDeleted())&&this.addAxisActorInViewport(i)})}async addAxisActorInViewport(e){const r=e.id;if(!this.updatingOrientationMarker[r]){this.updatingOrientationMarker[r]=!0;const n=this.configuration.overlayMarkerType,i=this.configuration.overlayConfiguration[n];if(this.orientationMarkers[r]){const{actor:g,orientationWidget:p}=this.orientationMarkers[r];e.getRenderer().removeActor(g),p.setEnabled(!1)}let o;n===1?o=this.createAnnotationCube(i):n===2?o=Cde.newInstance():n===3&&(o=await this.createCustomActor());const a=e.getRenderer(),s=e.getRenderingEngine().getOffscreenMultiRenderWindow(r).getRenderWindow(),{enabled:c,viewportCorner:l,viewportSize:d,minPixelSize:u,maxPixelSize:f}=this.configuration.orientationWidget,h=k_.newInstance({actor:o,interactor:s.getInteractor(),parentRenderer:a});h.setEnabled(c),h.setViewportCorner(l),h.setViewportSize(d),h.setMinPixelSize(u),h.setMaxPixelSize(f),h.updateMarkerOrientation(),this.orientationMarkers[r]={orientationWidget:h,actor:o},e.addWidget(this.getToolName(),h),s.render(),e.getRenderingEngine().render(),this.updatingOrientationMarker[r]=!1}}async createCustomActor(){const e=this.configuration.overlayConfiguration[b1.CUSTOM].polyDataURL,n=await(await fetch(e)).arrayBuffer(),i=$Y.newInstance();i.parseAsArrayBuffer(n),i.update();const o=Ii.newInstance();o.shallowCopy(i.getOutputData()),o.getPointData().setActiveScalars("Color");const a=Mu.newInstance();a.setInputData(o),a.setColorModeToDirectScalars();const s=U0.newInstance();return s.setMapper(a),s.rotateZ(180),s}createAnnotationCube(e){const r=F_.newInstance();return r.setDefaultStyle({...e.defaultStyle}),r.setXPlusFaceProperty({...e.faceProperties.xPlus}),r.setXMinusFaceProperty({...e.faceProperties.xMinus}),r.setYPlusFaceProperty({...e.faceProperties.yPlus}),r.setYMinusFaceProperty({...e.faceProperties.yMinus}),r.setZPlusFaceProperty({...e.faceProperties.zPlus}),r.setZMinusFaceProperty({...e.faceProperties.zMinus}),r}async createAnnotatedCubeActor(){const e=F_.newInstance(),{faceProperties:r,defaultStyle:n}=this.configuration.annotatedCube;return e.setDefaultStyle(n),Object.keys(r).forEach(i=>{const o=`set${i.charAt(0).toUpperCase()+i.slice(1)}FaceProperty`;e[o](r[i])}),e}};Ua.CUBE=1,Ua.AXIS=2,Ua.VTPFILE=3,Ua.OVERLAY_MARKER_TYPES=b1;let D1=Ua;D1.toolName="OrientationMarker";const Uf=class Uf extends ar{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:Uf.SelectMode.Border,searchRadius:6}}){super(e,r),this.mouseMoveCallback=n=>{if(this.mode===Cn.Active)return this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setActiveSegment(n),this.hoverTimer=null},this.configuration.hoverTimeout),!0},this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.hoverTimer=null}_setActiveSegment(e={}){if(Ue.isInteractingWithTool)return;const{element:r,currentPoints:n}=e.detail,i=n.world,o=Ce(r);if(!o)return;const{viewport:a}=o,s=uc(a.id);s&&this._setActiveSegmentForType(s,i,a)}_setActiveSegmentForType(e,r,n){if(!n.getImageData())return;const{segmentationId:o,representationData:a}=e;let s;if(this.configuration.mode===Uf.SelectMode.Inside?s=nx(o,r,{viewport:n}):a.Labelmap?s=wO(o,r,{viewport:n,searchRadius:this.configuration.searchRadius}):a.Contour?s=xO(o):a.Surface,!s||s===0)return;gh(o,s);const l=n.getRenderingEngine().getViewports().map(d=>d.id);Ko(o),Me(l)}};Uf.SelectMode={Inside:"Inside",Border:"Border"};let I1=Uf;I1.toolName="SegmentSelectTool";const w0=class w0 extends fh{constructor(e={}){super(e),this.renderAnnotation=(r,n)=>{let i=!0;const{viewport:o}=r,{element:a}=o,s=o.id;let c=$t(this.getToolName(),a);if(!c?.length||(c=this.filterInteractableAnnotationsForElement(a,c),!c?.length))return i;const l=this.getTargetId(o),d=o.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:r.viewport.id};for(let f=0;f<c.length;f++){const h=c[f],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles,m=v.map(ae=>o.worldToCanvas(ae));u.annotationUID=g;const{segmentIndex:y,segmentationId:C}=h.metadata,{lineWidth:x,lineDash:S,shadow:T}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),E=`rgb(${as(s,C,y).slice(0,3).join(",")})`;if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,width:null,unit:null},this._calculateCachedStats(h,d,r)):h.invalidated&&this._throttledCalculateCachedStats(h,d,r),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),i;let D;if(!or(g))continue;!ir(g)&&!this.editData&&w!==null&&(D=[m[w]]),D&&kn(n,g,"0",D,{color:E});const b=`${g}-line-1`,I=`${g}-line-2`;qt(n,g,"0",m[0],m[1],{color:E,lineWidth:x,lineDash:S,shadow:T},b),qt(n,g,"1",m[2],m[3],{color:E,lineWidth:x,lineDash:S,shadow:T},I),i=!0;const R=this.getLinkedTextBoxStyle(u,h);if(!R.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}R.color=E;const A=this.configuration.getTextLines(p,l);if(!A||A.length===0)continue;let G;p.handles.textBox.hasMoved||(G=to(m),p.handles.textBox.worldPosition=o.canvasToWorld(G));const k=o.worldToCanvas(p.handles.textBox.worldPosition),F=gi(n,g,"1",A,k,m,{},R),{x:j,y:Y,width:ie,height:de}=F;p.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([j,Y]),topRight:o.canvasToWorld([j+ie,Y]),bottomLeft:o.canvasToWorld([j,Y+de]),bottomRight:o.canvasToWorld([j+ie,Y+de])}}return i}}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,o=n.world,a=Ce(i),{viewport:s}=a;this.isDrawing=!0;const c=s.getCamera(),{viewPlaneNormal:l,viewUp:d}=c,u=this.getReferencedImageId(s,o,l,d),f=s.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...d],FrameOfReferenceUID:f,referencedImageId:u,...s.getViewReference({points:[o]})},data:{handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};Ft(h,i);const g=vt(i,this.getToolName());return this.editData={annotation:h,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),St(i),e.preventDefault(),Me(g),h}};w0.toolName="SegmentBidirectional",w0.hydrate=(e,r,n)=>{const i=wn(e);if(!i)return;const{viewport:o}=i,c=ld().filter(T=>T.metadata.toolName==="SegmentBidirectional").find(T=>{const{metadata:_}=T;return _.segmentIndex===n?.segmentIndex&&_.segmentationId===n?.segmentationId});c&&kt(c.annotationUID);const{FrameOfReferenceUID:l,referencedImageId:d,viewPlaneNormal:u,instance:f}=w0.hydrateBase(w0,i,r[0],n),[h,g]=r,[p,v]=h,[w,m]=g,y=[p,v,w,m],{toolInstance:C,...x}=n||{},S={annotationUID:n?.annotationUID||cn(),data:{handles:{points:y,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{segmentIndex:n?.segmentIndex,segmentationId:n?.segmentationId,toolName:f.getToolName(),viewPlaneNormal:u,FrameOfReferenceUID:l,referencedImageId:d,...x}};return Ft(S,o.element),Me([o.id]),S};let c5=w0;class qP extends ar{constructor(e={data:{handles:{textBox:{worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,searchRadius:6,color:null,background:null}}){super(e,r),this.mouseMoveCallback=n=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setHoveredSegment(n),this.hoverTimer=null},this.configuration.hoverTimeout),!0),this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.data=e.data??{handles:{textBox:{worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}},this.hoverTimer=null}_setHoveredSegment(e={}){if(Ue.isInteractingWithTool)return;const{element:r,currentPoints:n}=e.detail,i=n.world,o=Ce(r);if(!o)return;const{viewport:a}=o,s=uc(a.id);s&&this._setHoveredSegmentForType(s,i,a)}_setHoveredSegmentForType(e,r,n){if(!n.getImageData())return;const{segmentationId:o}=e,a=nx(o,r,{viewport:n}),s=e.segments[a],c=this.configuration.color??as(n.id,o,a),l=s?.label,d=n.worldToCanvas(r);if(this._editData={hoveredSegmentIndex:a,hoveredSegmentLabel:l,canvasCoordinates:d,color:c},!a||a===0)return;const f=n.getRenderingEngine().getViewports().map(h=>h.id);Ko(o),Me(f)}renderAnnotation(e,r){if(!this._editData)return;const{viewport:n}=e,{hoveredSegmentIndex:i,hoveredSegmentLabel:o,canvasCoordinates:a,color:s}=this._editData;if(!i)return;const c=-15,l=[a[0]+c,a[1]+c],d=ac(r,"segmentSelectLabelAnnotation","segmentSelectLabelTextBox",[o??"(unnamed segment)"],l,{color:`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${s[3]})`,background:this.configuration.background??void 0}),u=a[0],f=a[1],{width:h,height:g}=d;this.data.handles.textBox.worldBoundingBox={topLeft:n.canvasToWorld([u,f]),topRight:n.canvasToWorld([u+h,f]),bottomLeft:n.canvasToWorld([u,f+g]),bottomRight:n.canvasToWorld([u+h,f+g])}}}qP.toolName="SegmentLabelTool";const xi=class xi extends K0{constructor(e={}){const r=kr({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(r),this.onViewportAddedToToolGroupBinded=this.onViewportAddedToToolGroup.bind(this),this.onSegmentationModifiedBinded=this.onSegmentationModified.bind(this)}initializeListeners(){xi.annotationsToViewportMap.clear(),xi.viewportIdsChecked=[],Fe.addEventListener(V.ANNOTATION_MODIFIED,this.annotationModified),Fe.addEventListener(V.ANNOTATION_COMPLETED,this.annotationCompleted),Fe.addEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this.onViewportAddedToToolGroupBinded),Fe.addEventListener(V.SEGMENTATION_MODIFIED,this.onSegmentationModifiedBinded),Fe.addEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,this.onSegmentationModifiedBinded)}cleanUpListeners(){xi.annotationsToViewportMap.clear(),xi.viewportIdsChecked=[],Fe.removeEventListener(V.ANNOTATION_MODIFIED,this.annotationModified),Fe.removeEventListener(V.ANNOTATION_COMPLETED,this.annotationCompleted),Fe.removeEventListener(V.TOOLGROUP_VIEWPORT_ADDED,this.onViewportAddedToToolGroup.bind(this)),Fe.removeEventListener(V.SEGMENTATION_MODIFIED,this.onSegmentationModified.bind(this)),Fe.removeEventListener(V.SEGMENTATION_REPRESENTATION_MODIFIED,this.onSegmentationModified.bind(this))}async checkContourSegmentation(e){if(xi.viewportIdsChecked.includes(e))return;const r=Ru(e);if(!r)return console.log("No active segmentation detected"),!1;const n=r.segmentationId;return r.representationData.Contour?xi.viewportIdsChecked.push(e):(xi.viewportIdsChecked.push(e),await rx(e,[{segmentationId:n,type:yt.Contour}]),aC({segmentationId:n,type:yt.Contour,data:{}})),!0}onViewportAddedToToolGroup(e){const{toolGroupId:r,viewportId:n}=e.detail;r===this.toolGroupId&&this.checkContourSegmentation(n)}onSegmentationModified(e){const{segmentationId:r}=e.detail||{};if(!r)return;const n=C9(r);n&&n.forEach(async({viewportId:i})=>await this.checkContourSegmentation(i))}onSetToolEnabled(){this.initializeListeners()}onSetToolActive(){this.initializeListeners()}onSetToolDisabled(){this.cleanUpListeners()}annotationModified(e){const{annotation:r,renderingEngineId:n,viewportId:i}=e.detail,o=Fn(n)?.getViewport(i);o&&xi.annotationsToViewportMap.set(r.annotationUID,o)}annotationCompleted(e){const{annotation:r}=e.detail,{polyline:n}=r.data?.contour||{};if(r?.metadata?.toolName===xi.toolName&&n&&xi.annotationsToViewportMap.has(r.annotationUID)){const i=xi.annotationsToViewportMap.get(r.annotationUID);n.length>3&&Vu.viewportContoursToLabelmap(i)}}};xi.toolName="LabelMapEditWithContour",xi.annotationsToViewportMap=new Map,xi.viewportIdsChecked=[];let l5=xi;const Bx=class Bx extends Un{constructor(e={}){super(e,{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),this.addNewAnnotation=r=>{const n=r.detail,{currentPoints:i,element:o}=n,a=i.world,s=Ce(o),{viewport:c}=s;this.isDrawing=!0;const l=this.constructor.createAnnotationForViewport(c,{data:{handles:{points:[[...a],[...a],[...a],[...a]]}}});Ft(l,o);const d=vt(o,this.getToolName(),!1);return this.editData={annotation:l,viewportUIDsToRender:d,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),St(o),r.preventDefault(),Me(d),l},this.getHandleNearImagePoint=(r,n,i,o)=>{const a=Ce(r),{viewport:s}=a,{data:c}=n,{points:l}=c.handles;for(let d=0;d<l.length;d++){const u=l[d],f=s.worldToCanvas(u);if(Bn(i,f)<o===!0)return c.handles.activeHandleIndex=d,u}c.handles.activeHandleIndex=null},this.isPointNearTool=(r,n,i,o)=>{const a=Ce(r),{viewport:s}=a,{data:c}=n,{points:l}=c.handles,d=s.worldToCanvas(l[0]),u=s.worldToCanvas(l[3]),f=this._getRectangleImageCoordinates([d,u]),h=[i[0],i[1]],{left:g,top:p,width:v,height:w}=f;if(xC([g,p,v,w],h)<=o)return!0},this.toolSelectedCallback=(r,n,i="mouse")=>{const o=r.detail,{element:a}=o,{data:s}=n;s.active=!0;const c=vt(a,this.getToolName(),!1);this.editData={annotation:n,viewportUIDsToRender:c},this._activateModify(a),St(a),Me(c),r.preventDefault()},this.handleSelectedCallback=(r,n,i,o="mouse")=>{const a=r.detail,{element:s}=a,{data:c}=n;c.active=!0;let l;i.worldPosition||(l=c.handles.points.findIndex(u=>u===i));const d=vt(s,this.getToolName(),!1);this.editData={annotation:n,viewportUIDsToRender:d,handleIndex:l},this._activateModify(s),St(s),Me(d),r.preventDefault()},this._endCallback=r=>{const n=r.detail,{element:i}=n,{annotation:o,viewportUIDsToRender:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=o;s&&!c||(this.doneEditMemo(),l.active=!1,l.handles.activeHandleIndex=null,this._deactivateModify(i),this._deactivateDraw(i),Nt(i),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&kt(o.annotationUID),Me(a))},this._dragCallback=r=>{this.isDrawing=!0;const n=r.detail,{element:i}=n,{annotation:o,viewportUIDsToRender:a,handleIndex:s,newAnnotation:c}=this.editData;this.createMemo(i,o,{newAnnotation:c});const{data:l}=o;if(s===void 0){const{deltaPoints:d}=n,u=d.world,{points:f}=l.handles;f.forEach(h=>{h[0]+=u[0],h[1]+=u[1],h[2]+=u[2]}),l.invalidated=!0}else{const{currentPoints:d}=n,u=Ce(i),{worldToCanvas:f,canvasToWorld:h}=u.viewport,g=d.world,{points:p}=l.handles;p[s]=[...g];let v,w,m,y,C,x,S,T;switch(s){case 0:case 3:v=f(p[0]),y=f(p[3]),w=[y[0],v[1]],m=[v[0],y[1]],x=h(w),S=h(m),p[1]=x,p[2]=S;break;case 1:case 2:w=f(p[1]),m=f(p[2]),v=[m[0],w[1]],y=[w[0],m[1]],C=h(v),T=h(y),p[0]=C,p[3]=T;break}l.invalidated=!0}this.editData.hasMoved=!0,Ce(i),Me(a)},this._activateDraw=r=>{Ue.isInteractingWithTool=!0,r.addEventListener(V.MOUSE_UP,this._endCallback),r.addEventListener(V.MOUSE_DRAG,this._dragCallback),r.addEventListener(V.MOUSE_MOVE,this._dragCallback),r.addEventListener(V.MOUSE_CLICK,this._endCallback),r.addEventListener(V.TOUCH_END,this._endCallback),r.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=r=>{Ue.isInteractingWithTool=!1,r.removeEventListener(V.MOUSE_UP,this._endCallback),r.removeEventListener(V.MOUSE_DRAG,this._dragCallback),r.removeEventListener(V.MOUSE_MOVE,this._dragCallback),r.removeEventListener(V.MOUSE_CLICK,this._endCallback),r.removeEventListener(V.TOUCH_END,this._endCallback),r.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this._activateModify=r=>{Ue.isInteractingWithTool=!0,r.addEventListener(V.MOUSE_UP,this._endCallback),r.addEventListener(V.MOUSE_DRAG,this._dragCallback),r.addEventListener(V.MOUSE_CLICK,this._endCallback),r.addEventListener(V.TOUCH_END,this._endCallback),r.addEventListener(V.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=r=>{Ue.isInteractingWithTool=!1,r.removeEventListener(V.MOUSE_UP,this._endCallback),r.removeEventListener(V.MOUSE_DRAG,this._dragCallback),r.removeEventListener(V.MOUSE_CLICK,this._endCallback),r.removeEventListener(V.TOUCH_END,this._endCallback),r.removeEventListener(V.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(r,n)=>{const{viewport:o}=r,{element:a}=o;let s=$t(this.getToolName(),a);if(!s?.length||(s=this.filterInteractableAnnotationsForElement(a,s),!s?.length))return!1;const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:r.viewport.id};for(let l=0;l<s.length;l++){const d=s[l],{annotationUID:u}=d,f=d.data,{points:h,activeHandleIndex:g}=f.handles,p=h.map(x=>o.worldToCanvas(x)),v=this.getStyle("lineWidth",c,d),w=this.getStyle("lineDash",c,d),m=this.getStyle("color",c,d);if(!o.getRenderingEngine()){console.warn("Rendering Engine has been destroyed");return}let y;!this.editData&&g!==null&&(y=[p[g]]),y&&kn(n,u,"0",y,{color:m}),t7(n,u,"0",p[0],p[3],{color:"black",lineDash:w,lineWidth:v})}},this._getRectangleImageCoordinates=r=>{const[n,i]=r;return{left:Math.min(n[0],i[0]),top:Math.min(n[1],i[1]),width:Math.abs(n[0]-i[0]),height:Math.abs(n[1]-i[1])}},this._calculateCachedStats=(r,n,i,o,a)=>{const{data:s}=r,{viewportUID:c,renderingEngineUID:l,sceneUID:d}=a,u=s.handles.points[0],f=s.handles.points[3],{cachedStats:h}=s,g=Object.keys(h);for(let v=0;v<g.length;v++){const w=g[v],{imageVolume:m}=this._getImageVolumeFromTargetUID(w,o),{dimensions:y,scalarData:C,vtkImageData:x,metadata:S}=m,T=mt(0,0,0),_=mt(0,0,0);if(x.worldToIndexVec3(u,T),T[0]=Math.floor(T[0]),T[1]=Math.floor(T[1]),T[2]=Math.floor(T[2]),x.worldToIndexVec3(f,_),_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]),this._isInsideVolume(T,_,y)){this.isHandleOutsideImage=!1;const E=Math.min(T[0],_[0]),D=Math.max(T[0],_[0]),b=Math.min(T[1],_[1]),I=Math.max(T[1],_[1]),O=Math.min(T[2],_[2]),M=Math.max(T[2],_[2]),{worldWidth:R,worldHeight:A}=Xh(n,i,u,f),G=R*A;let k=0,L=0,F=0;const j=y[0],Y=y[0]*y[1];for(let ie=O;ie<=M;ie++)for(let de=b;de<=I;de++)for(let ae=E;ae<=D;ae++){const fe=C[ie*Y+de*j+ae];k++,L+=fe}L/=k;for(let ie=O;ie<=M;ie++)for(let de=b;de<=I;de++)for(let ae=E;ae<=D;ae++){const we=C[ie*Y+de*j+ae]-L;F+=we*we}F/=k,F=Math.sqrt(F),h[w]={Modality:S.Modality,area:G,mean:L,stdDev:F}}else this.isHandleOutsideImage=!0,h[w]={Modality:S.Modality}}const p=r.invalidated;if(r.invalidated=!1,p){const v=V.ANNOTATION_MODIFIED,w={annotation:r,viewportUID:c,renderingEngineUID:l,sceneUID:d,changeType:At.StatsUpdated};Ye(Fe,v,w)}return h},this._isInsideVolume=(r,n,i)=>Sr(r,i)&&Sr(n,i),this._getTargetVolumeUID=r=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const n=r.getVolumeActors();if(!(!n&&!n.length))return n[0].uid},this._throttledCalculateCachedStats=Pi(this._calculateCachedStats,100,{trailing:!0})}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),Nt(e);const{annotation:r,viewportUIDsToRender:n}=this.editData,{data:i}=r;return i.active=!1,i.handles.activeHandleIndex=null,Me(n),this.editData=null,r.annotationUID}_getImageVolumeFromTargetUID(e,r){let n,i;if(e.startsWith("stackTarget")){const o=e.indexOf(":"),a=e.substring(o+1);n=r.getViewport(a).getImageData()}else n=Ne.getVolume(e);return{imageVolume:n,viewport:i}}_getTargetStackUID(e){return`stackTarget:${e.uid}`}};Bx.toolName="VideoRedaction";let u5=Bx;const xde=Object.freeze(Object.defineProperty({__proto__:null,AdvancedMagnifyTool:wh,AngleTool:Qy,AnnotationDisplayTool:fs,AnnotationTool:Un,ArrowAnnotateTool:Zy,BaseTool:ar,BidirectionalTool:fh,BrushTool:Vu,CONSTANTS:fae,CircleROIStartEndThresholdTool:VP,CircleROITool:Ch,CircleScissorsTool:LP,CobbAngleTool:e5,CrosshairsTool:yP,DragProbeTool:Xy,ETDRSGridTool:qy,EllipticalROITool:Ky,Enums:$J,EraserTool:PP,HeightTool:Hy,KeyImageTool:o5,LabelMapEditWithContourTool:l5,LabelTool:C1,LabelmapBaseTool:Nu,LengthTool:l0e,LivewireContourSegmentationTool:Jy,LivewireContourTool:_1,MIPJumpToClickTool:vP,MagnifyTool:wP,OrientationMarkerTool:D1,OverlayGridTool:xP,PaintFillTool:kP,PanTool:sP,PlanarFreehandContourSegmentationTool:K0,PlanarFreehandROITool:g1,PlanarRotateTool:pP,ProbeTool:x1,RectangleROIStartEndThresholdTool:ZC,RectangleROIThresholdTool:QC,RectangleROITool:dh,RectangleScissorsTool:AP,ReferenceCursors:EP,ReferenceLinesTool:CP,RegionSegmentPlusTool:s5,RegionSegmentTool:a5,ScaleOverlayTool:bP,SculptorTool:IP,SegmentBidirectionalTool:c5,SegmentLabelTool:qP,SegmentSelectTool:I1,SegmentationIntersectionTool:SP,SphereScissorsTool:NP,SplineContourSegmentationTool:Yy,SplineROITool:S1,StackScrollTool:gP,Synchronizer:JC,SynchronizerManager:BM,ToolGroupManager:RI,TrackballRotateTool:cP,Types:gue,UltrasoundDirectionalTool:t5,UltrasoundPleuraBLineTool:i5,VideoRedactionTool:u5,VolumeCroppingControlTool:dP,VolumeCroppingTool:uP,VolumeRotateTool:MP,WholeBodySegmentTool:RP,WindowLevelRegionTool:hP,WindowLevelTool:fP,ZoomTool:mP,addTool:Zw,annotation:_re,cancelActiveManipulations:UM,cursors:gZ,destroy:lae,drawing:Wee,init:cae,removeTool:FI,segmentation:Lue,splines:Uue,get state(){return Ue},store:sae,synchronizers:Rae,utilities:hue,version:hae},Symbol.toStringTag,{value:"Module"}));function YP(t,e,r){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0;if(r){for(let a=0;a<n;a++)e[o++]=t[i++],e[o++]=t[i++],e[o++]=t[i++],e[o++]=255;return}e.set(t)}function Sde(t,e,r){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0,a=n,s=n*2;if(r)for(let c=0;c<n;c++)e[i++]=t[o++],e[i++]=t[a++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<n;c++)e[i++]=t[o++],e[i++]=t[a++],e[i++]=t[s++]}function Tde(t,e,r){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0;if(r){for(let a=0;a<n;a++){const s=t[i++],c=t[i++],l=t[i++];e[o++]=s+1.402*(l-128),e[o++]=s-.34414*(c-128)-.71414*(l-128),e[o++]=s+1.772*(c-128),e[o++]=255}return}for(let a=0;a<n;a++){const s=t[i++],c=t[i++],l=t[i++];e[o++]=s+1.402*(l-128),e[o++]=s-.34414*(c-128)-.71414*(l-128),e[o++]=s+1.772*(c-128)}}function _de(t,e,r){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0,a=n,s=n*2;if(r){for(let c=0;c<n;c++){const l=t[o++],d=t[a++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(d-128)-.71414*(u-128),e[i++]=l+1.772*(d-128),e[i++]=255}return}for(let c=0;c<n;c++){const l=t[o++],d=t[a++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(d-128)-.71414*(u-128),e[i++]=l+1.772*(d-128)}}function Ede(t,e,r){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const n=t.length/2;let i=0,o=0;if(r){for(let a=0;a<n;a+=2){const s=t[i++],c=t[i++],l=t[i++],d=t[i++];e[o++]=s+1.402*(d-128),e[o++]=s-.34414*(l-128)-.71414*(d-128),e[o++]=s+1.772*(l-128),e[o++]=255,e[o++]=c+1.402*(d-128),e[o++]=c-.34414*(l-128)-.71414*(d-128),e[o++]=c+1.772*(l-128),e[o++]=255}return}for(let a=0;a<n;a+=2){const s=t[i++],c=t[i++],l=t[i++],d=t[i++];e[o++]=s+1.402*(d-128),e[o++]=s-.34414*(l-128)-.71414*(d-128),e[o++]=s+1.772*(l-128),e[o++]=c+1.402*(d-128),e[o++]=c-.34414*(l-128)-.71414*(d-128),e[o++]=c+1.772*(l-128)}}function wv(t,e){const r=t.length,n=new Uint8ClampedArray(r);for(let i=0;i<r;++i)n[i]=t[i]>>e;return n}function Cv(t,e,r){const n=t[`${e}PaletteColorLookupTableData`];if(n)return Promise.resolve(n);const i=ut("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(o=>o?o[`${e}PaletteColorLookupTableData`]:r):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:r)}function bde(t,e,r){const n=t.columns*t.rows,i=t.pixelData;Promise.all([Cv(t,"red",null),Cv(t,"green",null),Cv(t,"blue",null)]).then(([o,a,s])=>{if(!o||!a||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=o.length;let l=0,d=0;const u=t.redPaletteColorLookupTableDescriptor[1],f=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,h=wv(o,f),g=wv(a,f),p=wv(s,f);if(r){for(let v=0;v<n;++v){let w=i[l++];w<u?w=0:w>u+c-1?w=c-1:w-=u,e[d++]=h[w],e[d++]=g[w],e[d++]=p[w],e[d++]=255}return}for(let v=0;v<n;++v){let w=i[l++];w<u?w=0:w>u+c-1?w=c-1:w-=u,e[d++]=h[w],e[d++]=g[w],e[d++]=p[w]}})}function xv(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function Sv(t,e,r){const n=[],i=t.elements[e];for(let o=0;o<r[0];o++)r[2]===16?n[o]=t.uint16(e,o):n[o]=t.byteArray[o+i.dataOffset];return n}function Dde(t,e){e.redPaletteColorLookupTableDescriptor=xv(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=xv(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=xv(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const r=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===r?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=Sv(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=Sv(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=Sv(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function Ide(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function Mde(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return Ide(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&Dde(t,e),e}function Ode(t,e){let r=e.uint16("x00283002",0);r===0&&(r=65535);let n=0;t===0?n=e.uint16("x00283002",1):n=e.int16("x00283002",1);const i=e.uint16("x00283002",2),o={id:"1",firstValueMapped:n,numBitsPerEntry:i,lut:[]};for(let a=0;a<r;a++)t===0?o.lut[a]=e.uint16("x00283006",a):o.lut[a]=e.int16("x00283006",a);return o}function U_(t,e){if(!e||!e.items||!e.items.length)return;const r=[];for(let n=0;n<e.items.length;n++){const i=e.items[n].dataSet,o=Ode(t,i);o&&r.push(o)}return r}function Pde(t){const e=t.uint16("x00280103"),r=t.uint16("x00280101");return e===0?0:-1<<r-1}function Rde(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const r=t.floatString("x00281052"),n=t.floatString("x00281053");return r!==void 0&&n!==void 0?Pde(t)*n+r<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function ss(t,e,r){const n=[],i=t.string(e);if(!i)return;const o=i.split("\\");if(!(r&&o.length<r)){for(let a=0;a<o.length;a++)n.push(parseFloat(o[a]));return n}}var wp={exports:{}};var Ade=wp.exports,B_;function Lde(){return B_||(B_=1,(function(t,e){(function(r,n){t.exports=n(Zs)})(Ade,function(r){return i=[function(a,s){a.exports=r},function(a,s,c){c.r(s),c.d(s,"isStringVr",function(){return d}),c.d(s,"isPrivateTag",function(){return u}),c.d(s,"parsePN",function(){return f}),c.d(s,"parseTM",function(){return h}),c.d(s,"parseDA",function(){return p}),c.d(s,"explicitElementToString",function(){return v}),c.d(s,"explicitDataSetToJS",function(){return w}),c.d(s,"createJPEGBasicOffsetTable",function(){return C}),c.d(s,"parseDicomDataSetExplicit",function(){return Y}),c.d(s,"parseDicomDataSetImplicit",function(){return ie}),c.d(s,"readFixedString",function(){return _}),c.d(s,"alloc",function(){return de}),c.d(s,"version",function(){return ae}),c.d(s,"bigEndianByteArrayParser",function(){return fe}),c.d(s,"ByteStream",function(){return Se}),c.d(s,"sharedCopy",function(){return we}),c.d(s,"DataSet",function(){return b}),c.d(s,"findAndSetUNElementLength",function(){return T}),c.d(s,"findEndOfEncapsulatedElement",function(){return S}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return I}),c.d(s,"littleEndianByteArrayParser",function(){return B}),c.d(s,"parseDicom",function(){return W}),c.d(s,"readDicomElementExplicit",function(){return j}),c.d(s,"readDicomElementImplicit",function(){return M}),c.d(s,"readEncapsulatedImageFrame",function(){return De}),c.d(s,"readEncapsulatedPixelData",function(){return Ge}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return Q}),c.d(s,"readPart10Header",function(){return P}),c.d(s,"readSequenceItemsExplicit",function(){return L}),c.d(s,"readSequenceItemsImplicit",function(){return G}),c.d(s,"readSequenceItem",function(){return R}),c.d(s,"readTag",function(){return x});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},d=function(re){return l[re]},u=function(re){if(re=parseInt(re[4],16),isNaN(re))throw"dicomParser.isPrivateTag: cannot parse last character of group";return re%2==1},f=function(re){if(re!==void 0)return re=re.split("^"),{familyName:re[0],givenName:re[1],middleName:re[2],prefix:re[3],suffix:re[4]}};function h(re,se){if(2<=re.length){var ve=parseInt(re.substring(0,2),10),le=4<=re.length?parseInt(re.substring(2,4),10):void 0,pe=6<=re.length?parseInt(re.substring(4,6),10):void 0,We=8<=re.length?re.substring(7,13):void 0,We=We?parseInt(We,10)*Math.pow(10,6-We.length):void 0;if(se&&(isNaN(ve)||le!==void 0&&isNaN(le)||pe!==void 0&&isNaN(pe)||We!==void 0&&isNaN(We)||ve<0||23<ve||le&&(le<0||59<le)||pe&&(pe<0||59<pe)||We&&(We<0||999999<We)))throw"invalid TM '".concat(re,"'");return{hours:ve,minutes:le,seconds:pe,fractionalSeconds:We}}if(se)throw"invalid TM '".concat(re,"'")}function g(re,se,ve){return!isNaN(ve)&&0<se&&se<=12&&0<re&&re<=(function(le,pe){switch(le){case 2:return pe%4==0&&pe%100||pe%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}})(se,ve)}function p(re,se){if(re&&re.length===8){var ve=parseInt(re.substring(0,4),10),le=parseInt(re.substring(4,6),10),pe=parseInt(re.substring(6,8),10);if(se&&g(pe,le,ve)!==!0)throw"invalid DA '".concat(re,"'");return{year:ve,month:le,day:pe}}if(se)throw"invalid DA '".concat(re,"'")}function v(re,se){if(re===void 0||se===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(se.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var ve,le=se.vr,pe=se.tag;function We(st,gt){for(var ct="",Ee=0;Ee<st;Ee++)Ee!==0&&(ct+="/"),ct+=gt.call(re,pe,Ee).toString();return ct}if(d(le)===!0)ve=re.string(pe);else{if(le==="AT"){var oe=re.uint32(pe);return oe===void 0?void 0:"x".concat((oe=oe<0?4294967295+oe+1:oe).toString(16).toUpperCase())}le==="US"?ve=We(se.length/2,re.uint16):le==="SS"?ve=We(se.length/2,re.int16):le==="UL"?ve=We(se.length/4,re.uint32):le==="SL"?ve=We(se.length/4,re.int32):le==="FD"?ve=We(se.length/8,re.double):le==="FL"&&(ve=We(se.length/4,re.float))}return ve}function w(re,se){if(re===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";se=se||{omitPrivateAttibutes:!0,maxElementLength:128};var ve,le={};for(ve in re.elements){var pe=re.elements[ve];if(se.omitPrivateAttibutes!==!0||!u(ve))if(pe.items){for(var We=[],oe=0;oe<pe.items.length;oe++)We.push(w(pe.items[oe].dataSet,se));le[ve]=We}else{var st=void 0;pe.length<se.maxElementLength&&(st=v(re,pe)),le[ve]=st!==void 0?st:{dataOffset:pe.dataOffset,length:pe.length}}}return le}function m(re,se){return re.byteArray[se]===255&&re.byteArray[se+1]===217}function y(re,se,ve){for(var le,pe,We=ve;We<se.fragments.length;We++)if(le=re,pe=We,pe=se.fragments[pe],!(!m(le,pe.position+pe.length-2)&&!m(le,pe.position+pe.length-3)))return We}function C(re,se,ve){if(re===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(se===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(se.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(se.encapsulatedPixelData!==!0||se.hadUndefinedLength!==!0||se.basicOffsetTable===void 0||se.fragments===void 0||se.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ve&&ve.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";ve=ve||se.fragments;for(var le=[],pe=0;;){le.push(se.fragments[pe].offset);var We=y(re,se,pe);if(We===void 0||We===se.fragments.length-1)return le;pe=We+1}}function x(ve){if(ve===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var se=256*ve.readUint16()*256,ve=ve.readUint16();return"x".concat("00000000".concat((se+ve).toString(16)).substr(-8))}function S(re,se,ve){if(re===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(se===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(se.encapsulatedPixelData=!0,se.basicOffsetTable=[],se.fragments=[],x(re)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var le=re.readUint32()/4,pe=0;pe<le;pe++){var We=re.readUint32();se.basicOffsetTable.push(We)}for(var oe=re.position;re.position<re.byteArray.length;){var st=x(re),gt=re.readUint32();if(st==="xfffee0dd")return re.seek(gt),void(se.length=re.position-se.dataOffset);if(st!=="xfffee000")return ve&&ve.push("unexpected tag ".concat(st," while searching for end of pixel data element with undefined length")),gt>re.byteArray.length-re.position&&(gt=re.byteArray.length-re.position),se.fragments.push({offset:re.position-oe-8,position:re.position,length:gt}),re.seek(gt),void(se.length=re.position-se.dataOffset);se.fragments.push({offset:re.position-oe-8,position:re.position,length:gt}),re.seek(gt)}ve&&ve.push("pixel data element ".concat(se.tag," missing sequence delimiter tag xfffee0dd"))}function T(re,se){if(re===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var ve=re.byteArray.length-8;re.position<=ve;)if(re.readUint16()===65534){var le=re.readUint16();if(le===57565)return re.readUint32()!==0&&re.warnings("encountered non zero length following item delimiter at position ".concat(re.position-4," while reading element of undefined length with tag ").concat(se.tag)),void(se.length=re.position-se.dataOffset)}se.length=re.byteArray.length-se.dataOffset,re.seek(re.byteArray.length-re.position)}function _(re,se,ve){if(ve<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(se+ve>re.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var le,pe="",We=0;We<ve;We++){if((le=re[se+We])===0)return se+=ve,pe;pe+=String.fromCharCode(le)}return pe}function E(re,se){for(var ve=0;ve<se.length;ve++){var le=se[ve];le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(re,le.key,le)}}function D(re,se){return re.parser!==void 0?re.parser:se}var b=(function(){function re(le,pe,We){(function(oe,st){if(!(oe instanceof st))throw new TypeError("Cannot call a class as a function")})(this,re),this.byteArrayParser=le,this.byteArray=pe,this.elements=We}var se,ve;return se=re,(ve=[{key:"uint16",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readUint16(this.byteArray,le.dataOffset+2*pe)}},{key:"int16",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readInt16(this.byteArray,le.dataOffset+2*pe)}},{key:"uint32",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readUint32(this.byteArray,le.dataOffset+4*pe)}},{key:"int32",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readInt32(this.byteArray,le.dataOffset+4*pe)}},{key:"float",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readFloat(this.byteArray,le.dataOffset+4*pe)}},{key:"double",value:function(le,pe){if(le=this.elements[le],pe=pe!==void 0?pe:0,le&&le.length!==0)return D(le,this.byteArrayParser).readDouble(this.byteArray,le.dataOffset+8*pe)}},{key:"numStringValues",value:function(le){if(le=this.elements[le],le&&0<le.length)return le=_(this.byteArray,le.dataOffset,le.length).match(/\\/g),le===null?1:le.length+1}},{key:"string",value:function(le,pe){if(le=this.elements[le],le&&le.Value)return le.Value;if(le&&0<le.length)return le=_(this.byteArray,le.dataOffset,le.length),0<=pe?le.split("\\")[pe].trim():le.trim()}},{key:"text",value:function(le,pe){if(le=this.elements[le],le&&0<le.length)return le=_(this.byteArray,le.dataOffset,le.length),0<=pe?le.split("\\")[pe].replace(/ +$/,""):le.replace(/ +$/,"")}},{key:"floatString",value:function(le,pe){var We=this.elements[le];if(We&&0<We.length&&(pe=this.string(le,pe=pe!==void 0?pe:0),pe!==void 0))return parseFloat(pe)}},{key:"intString",value:function(le,pe){var We=this.elements[le];if(We&&0<We.length&&(pe=this.string(le,pe=pe!==void 0?pe:0),pe!==void 0))return parseInt(pe)}},{key:"attributeTag",value:function(le){var pe=this.elements[le];if(pe&&pe.length===4){var We=D(pe,this.byteArrayParser).readUint16,le=this.byteArray,pe=pe.dataOffset;return"x".concat("00000000".concat((256*We(le,pe)*256+We(le,pe+2)).toString(16)).substr(-8))}}}])&&E(se.prototype,ve),Object.defineProperty(se,"prototype",{writable:!1}),re})();function I(re,se){if(re===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var ve=re.byteArray.length-8;re.position<=ve;)if(re.readUint16()===65534){var le=re.readUint16();if(le===57357)return re.readUint32()!==0&&re.warnings("encountered non zero length following item delimiter at position ".concat(re.position-4," while reading element of undefined length with tag ").concat(se.tag)),void(se.length=re.position-se.dataOffset)}se.length=re.byteArray.length-se.dataOffset,re.seek(re.byteArray.length-re.position)}var O=function(re,se){return re.vr!==void 0?re.vr==="SQ":se.position+4<=se.byteArray.length?(re=x(se),se.seek(-4),re==="xfffee000"||re==="xfffee0dd"):(se.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function M(re,se,ve){if(re===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var le=x(re),le={tag:le,vr:ve!==void 0?ve(le):void 0,length:re.readUint32(),dataOffset:re.position};return le.length===4294967295&&(le.hadUndefinedLength=!0),le.tag===se||(!O(le,re)||u(le.tag)&&!le.hadUndefinedLength?le.hadUndefinedLength?I(re,le):re.seek(le.length):(G(re,le,ve),u(le.tag)&&(le.items=void 0))),le}function R(re){if(re===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var se={tag:x(re),length:re.readUint32(),dataOffset:re.position};if(se.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(re.position);return se}function A(re,se){var ve=R(re);return ve.length===4294967295?(ve.hadUndefinedLength=!0,ve.dataSet=(function(le,pe){for(var We={};le.position<le.byteArray.length;){var oe=M(le,void 0,pe);if((We[oe.tag]=oe).tag==="xfffee00d")return new b(le.byteArrayParser,le.byteArray,We)}return le.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new b(le.byteArrayParser,le.byteArray,We)})(re,se),ve.length=re.position-ve.dataOffset):(ve.dataSet=new b(re.byteArrayParser,re.byteArray,{}),ie(ve.dataSet,re,re.position+ve.length,{vrCallback:se})),ve}function G(re,se,ve){if(re===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(se===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";se.items=[],(se.length===4294967295?function(le,pe,We){for(;le.position+4<=le.byteArray.length;){var oe=x(le);if(le.seek(-4),oe==="xfffee0dd")return pe.length=le.position-pe.dataOffset,le.seek(8);oe=A(le,We),pe.items.push(oe)}le.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),pe.length=le.byteArray.length-pe.dataOffset}:function(le,pe,We){for(var oe=pe.dataOffset+pe.length;le.position<oe;){var st=A(le,We);pe.items.push(st)}})(re,se,ve)}function k(re,se){var ve=R(re);return ve.length===4294967295?(ve.hadUndefinedLength=!0,ve.dataSet=(function(le,pe){for(var We={};le.position<le.byteArray.length;){var oe=j(le,pe);if((We[oe.tag]=oe).tag==="xfffee00d")return new b(le.byteArrayParser,le.byteArray,We)}return pe.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new b(le.byteArrayParser,le.byteArray,We)})(re,se),ve.length=re.position-ve.dataOffset):(ve.dataSet=new b(re.byteArrayParser,re.byteArray,{}),Y(ve.dataSet,re,re.position+ve.length)),ve}function L(re,se,ve){if(re===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(se===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";se.items=[],(se.length===4294967295?function(le,pe,We){for(;le.position+4<=le.byteArray.length;){var oe=x(le);if(le.seek(-4),oe==="xfffee0dd")return pe.length=le.position-pe.dataOffset,le.seek(8);oe=k(le,We),pe.items.push(oe)}We.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),pe.length=le.position-pe.dataOffset}:function(le,pe,We){for(var oe=pe.dataOffset+pe.length;le.position<oe;){var st=k(le,We);pe.items.push(st)}})(re,se,ve)}var F=function(re){return re==="OB"||re==="OD"||re==="OL"||re==="OW"||re==="SQ"||re==="OF"||re==="UC"||re==="UR"||re==="UT"||re==="UN"?4:2};function j(re,se,ve){if(re===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var le={tag:x(re),vr:re.readFixedString(2)};return F(le.vr)===2?le.length=re.readUint16():(re.seek(2),le.length=re.readUint32()),le.dataOffset=re.position,le.length===4294967295&&(le.hadUndefinedLength=!0),le.tag===ve||(le.vr==="SQ"?L(re,le,se):le.length===4294967295?le.tag==="x7fe00010"?S(re,le,se):(le.vr==="UN"?G:I)(re,le):re.seek(le.length)),le}function Y(re,se,ve){var le=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ve=ve===void 0?se.byteArray.length:ve,se===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(ve<se.position||ve>se.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var pe=re.elements;se.position<ve;){var We=j(se,re.warnings,le.untilTag);if((pe[We.tag]=We).tag===le.untilTag)return}if(se.position>ve)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function ie(re,se,ve){var le=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ve=ve===void 0?re.byteArray.length:ve,se===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(ve<se.position||ve>se.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var pe=re.elements;se.position<ve;){var We=M(se,le.untilTag,le.vrCallback);if((pe[We.tag]=We).tag===le.untilTag)return}}function de(re,se){if(typeof Buffer<"u"&&re instanceof Buffer)return Buffer.alloc(se);if(re instanceof Uint8Array)return new Uint8Array(se);throw"dicomParser.alloc: unknown type for byteArray"}var ae="1.8.12",fe={readUint16:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(se+2>re.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(re[se]<<8)+re[se+1]},readInt16:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(se+2>re.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return se=(re[se]<<8)+re[se+1],se=32768&se?se-65535-1:se},readUint32:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(se+4>re.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*re[se]+re[se+1])+re[se+2])+re[se+3]},readInt32:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(se+4>re.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(re[se]<<24)+(re[se+1]<<16)+(re[se+2]<<8)+re[se+3]},readFloat:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(se+4>re.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ve=new Uint8Array(4);return ve[3]=re[se],ve[2]=re[se+1],ve[1]=re[se+2],ve[0]=re[se+3],new Float32Array(ve.buffer)[0]},readDouble:function(re,se){if(se<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(se+8>re.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ve=new Uint8Array(8);return ve[7]=re[se],ve[6]=re[se+1],ve[5]=re[se+2],ve[4]=re[se+3],ve[3]=re[se+4],ve[2]=re[se+5],ve[1]=re[se+6],ve[0]=re[se+7],new Float64Array(ve.buffer)[0]}};function we(re,se,ve){if(typeof Buffer<"u"&&re instanceof Buffer)return re.slice(se,se+ve);if(re instanceof Uint8Array)return new Uint8Array(re.buffer,re.byteOffset+se,ve);throw"dicomParser.from: unknown type for byteArray"}function _e(re,se){for(var ve=0;ve<se.length;ve++){var le=se[ve];le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(re,le.key,le)}}var Se=(function(){function re(le,pe,We){if((function(oe,st){if(!(oe instanceof st))throw new TypeError("Cannot call a class as a function")})(this,re),le===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(pe===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(pe instanceof Uint8Array)&&(typeof Buffer>"u"||!(pe instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(We<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(We>=pe.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=le,this.byteArray=pe,this.position=We||0,this.warnings=[]}var se,ve;return se=re,(ve=[{key:"seek",value:function(le){if(this.position+le<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=le}},{key:"readByteStream",value:function(le){if(this.position+le>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var pe=we(this.byteArray,this.position,le);return this.position+=le,new re(this.byteArrayParser,pe)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var le=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,le}},{key:"readUint32",value:function(){var le=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,le}},{key:"readFixedString",value:function(le){var pe=_(this.byteArray,this.position,le);return this.position+=le,pe}}])&&_e(se.prototype,ve),Object.defineProperty(se,"prototype",{writable:!1}),re})(),B={readUint16:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(se+2>re.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return re[se]+256*re[se+1]},readInt16:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(se+2>re.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return se=re[se]+(re[se+1]<<8),se=32768&se?se-65535-1:se},readUint32:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(se+4>re.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return re[se]+256*re[se+1]+256*re[se+2]*256+256*re[se+3]*256*256},readInt32:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(se+4>re.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return re[se]+(re[se+1]<<8)+(re[se+2]<<16)+(re[se+3]<<24)},readFloat:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(se+4>re.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ve=new Uint8Array(4);return ve[0]=re[se],ve[1]=re[se+1],ve[2]=re[se+2],ve[3]=re[se+3],new Float32Array(ve.buffer)[0]},readDouble:function(re,se){if(se<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(se+8>re.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ve=new Uint8Array(8);return ve[0]=re[se],ve[1]=re[se+1],ve[2]=re[se+2],ve[3]=re[se+3],ve[4]=re[se+4],ve[5]=re[se+5],ve[6]=re[se+6],ve[7]=re[se+7],new Float64Array(ve.buffer)[0]}};function P(re){var se=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(re===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var ve=se.TransferSyntaxUID,le=new Se(B,re);return(function(){var pe=(function(){if(le.getSize()<=132&&ve)return!1;if(le.seek(128),le.readFixedString(4)==="DICM")return!0;if(!(se||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return le.seek(0),!1})(),We=[],oe={};if(!pe)return le.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:ve}},warnings:We};for(;le.position<le.byteArray.length;){var st=le.position,gt=j(le,We);if("x0002ffff"<gt.tag){le.position=st;break}gt.parser=B,oe[gt.tag]=gt}return(pe=new b(le.byteArrayParser,le.byteArray,oe)).warnings=le.warnings,pe.position=le.position,pe})()}var $="1.2.840.10008.1.2.2";function W(re){var se=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(re===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var ve,le=function(We){if(We.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return We=We.elements.x00020010,We&&We.Value||_(re,We.dataOffset,We.length)};function pe(gt){var st=le(gt),oe=st!=="1.2.840.10008.1.2",st=(function(ct,Ee){var ze=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(ct!=="1.2.840.10008.1.2.1.99")return new Se(ct===$?fe:B,re,Ee);if(se&&se.inflater)return ct=se.inflater(re,Ee),new Se(B,ct,0);if(ze==!0){var Ke=c(0),Je=we(re,Ee,re.length-Ee),Ke=Ke.inflateRawSync(Je),Je=de(re,Ke.length+Ee);return re.copy(Je,0,0,Ee),Ke.copy(Je,Ee),new Se(B,Je,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return Ke=re.slice(Ee),Je=pako.inflateRaw(Ke),(Ke=de(re,Je.length+Ee)).set(re.slice(0,Ee),0),Ke.set(Je,Ee),new Se(B,Ke,0)})(st,gt.position),gt=new b(st.byteArrayParser,st.byteArray,{});gt.warnings=st.warnings;try{(oe?Y:ie)(gt,st,st.byteArray.length,se)}catch(ct){throw{exception:ct,dataSet:gt}}return gt}return(function(We,oe){for(var st in We.elements)We.elements.hasOwnProperty(st)&&(oe.elements[st]=We.elements[st]);return We.warnings!==void 0&&(oe.warnings=We.warnings.concat(oe.warnings)),oe})(ve=P(re,se),pe(ve))}var K=function(re,se,ve){for(var le=0,pe=se;pe<se+ve;pe++)le+=re[pe].length;return le};function Q(re,oe,ve,le,pe){if(pe=pe||oe.fragments,re===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(oe===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(ve===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((le=le||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(oe.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(oe.encapsulatedPixelData!==!0||oe.hadUndefinedLength!==!0||oe.basicOffsetTable===void 0||oe.fragments===void 0||oe.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ve<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(ve>=oe.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(le<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(ve+le>oe.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var We=new Se(re.byteArrayParser,re.byteArray,oe.dataOffset),oe=R(We);if(oe.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";We.seek(oe.length);var st=We.position;if(le===1)return we(We.byteArray,st+pe[ve].offset+8,pe[ve].length);for(var oe=K(pe,ve,le),gt=de(We.byteArray,oe),ct=0,Ee=ve;Ee<ve+le;Ee++)for(var ze=st+pe[Ee].offset+8,Ke=0;Ke<pe[Ee].length;Ke++)gt[ct++]=We.byteArray[ze++];return gt}var ee=function(re,se){for(var ve=0;ve<re.length;ve++)if(re[ve].offset===se)return ve},ge=function(re,se,ve,le){if(re===se.length-1)return ve.length-le;for(var pe=se[re+1],We=le+1;We<ve.length;We++)if(ve[We].offset===pe)return We-le;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function De(re,se,ve,le,pe){if(le=le||se.basicOffsetTable,pe=pe||se.fragments,re===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(se===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(ve===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(le===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(se.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(se.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(se.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(se.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(le.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(ve<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(ve>=le.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var We=le[ve],We=ee(pe,We);if(We===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Q(re,se,We,ge(ve,le,pe,We),pe)}var Le=!1;function Ge(re,se,ve){if(Le||(Le=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),re===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(se===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(ve===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(se.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(se.encapsulatedPixelData!==!0||se.hadUndefinedLength!==!0||se.basicOffsetTable===void 0||se.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(ve<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return se.basicOffsetTable.length!==0?De(re,se,ve):Q(re,se,0,se.fragments.length)}s.default={isStringVr:d,isPrivateTag:u,parsePN:f,parseTM:h,parseDA:p,explicitElementToString:v,explicitDataSetToJS:w,createJPEGBasicOffsetTable:C,parseDicomDataSetExplicit:Y,parseDicomDataSetImplicit:ie,readFixedString:_,alloc:de,version:ae,bigEndianByteArrayParser:fe,ByteStream:Se,sharedCopy:we,DataSet:b,findAndSetUNElementLength:T,findEndOfEncapsulatedElement:S,findItemDelimitationItemAndSetElementLength:I,littleEndianByteArrayParser:B,parseDicom:W,readDicomElementExplicit:j,readDicomElementImplicit:M,readEncapsulatedImageFrame:De,readEncapsulatedPixelData:Ge,readEncapsulatedPixelDataFromFragments:Q,readPart10Header:P,readSequenceItemsExplicit:L,readSequenceItemsImplicit:G,readSequenceItem:R,readTag:x,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],o={},n.m=i,n.c=o,n.d=function(a,s,c){n.o(a,s)||Object.defineProperty(a,s,{enumerable:!0,get:c})},n.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,s){if(1&s&&(a=n(a)),8&s||4&s&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(n.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),2&s&&typeof a!="string")for(var l in a)n.d(c,l,(function(d){return a[d]}).bind(null,l));return c},n.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(s,"a",s),s},n.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},n.p="",n(n.s=1);function n(a){if(o[a])return o[a].exports;var s=o[a]={i:a,l:!1,exports:{}};return i[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var i,o})})(wp)),wp.exports}var Ei=Lde();const Nde=wa(Ei);function Gm(t){const e=t.indexOf(":");let r=t.substring(e+1);const n=r.indexOf("frame=");let i;if(n!==-1){const s=r.substring(n+6);i=parseInt(s,10),r=r.substring(0,n-1)}const o=t.substring(0,e),a=i!==void 0?i-1:void 0;return{scheme:o,url:r,frame:i,pixelDataFrame:a}}let d5={open(t,e){t.open("get",e,!0)},beforeSend:async()=>{},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function Vde(t){d5=Object.assign(d5,t)}function Wm(){return d5}function mx(t,e,r={},n={}){const i=Wm(),o=c=>{if(typeof i.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,i.errorInterceptor(l)}},a=new XMLHttpRequest,s=new Promise(async(c,l)=>{i.open(a,t,r,n);const d=await i.beforeSend(a,e,r,n);a.responseType="arraybuffer";const u=Object.assign({},r,d);Object.keys(u).forEach(function(f){u[f]!==null&&(f==="Accept"&&t.indexOf("accept=")!==-1||a.setRequestHeader(f,u[f]))}),n.deferred={resolve:c,reject:l},n.url=t,n.imageId=e,a.onloadstart=function(f){i.onloadstart&&i.onloadstart(f,n),Ye(Fe,"cornerstoneimageloadstart",{url:t,imageId:e})},a.onloadend=function(f){i.onloadend&&i.onloadend(f,n),Ye(Fe,"cornerstoneimageloadend",{url:t,imageId:e})},a.onreadystatechange=function(f){i.onreadystatechange&&i.onreadystatechange(f,n),a.readyState===4&&(a.status===200||a.status===206?i.beforeProcessing(a).then(c).catch(()=>{o(a),l(a)}):(o(a),l(a)))},a.onprogress=function(f){const h=f.loaded;let g,p;f.lengthComputable&&(g=f.total,p=Math.round(h/g*100)),Ye(Fe,"cornerstoneimageloadprogress",{url:t,imageId:e,loaded:h,total:g,percentComplete:p}),i.onprogress&&i.onprogress(f,n)},a.onerror=function(){o(a),l(a)},a.onabort=function(){o(a),l(a)},a.send()});return s.xhr=a,s}function kde(t,e,r){if(r+t.length>e.length)return!1;let n=r;for(let i=0;i<t.length;i++)if(t[i]!==e[n++])return!1;return!0}function Fde(t){const e=new Uint8Array(t.length);for(let r=0,n=t.length;r<n;r++)e[r]=t.charCodeAt(r);return e}function G_(t,e,r){r=r||0;const n=Fde(e);for(let i=r;i<t.length;i++)if(n[0]===t[i]&&kde(n,t,i))return i;return-1}const{ImageQualityStatus:W_}=To;function vx(t,e,r){r||={};const n=new Uint8Array(e),i=!!r?.isPartial;if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?W_.SUBRESOLUTION:W_.FULL_RESOLUTION,pixelData:n};let{tokenIndex:o,responseHeaders:a,boundary:s,multipartContentType:c}=r;if(o||=G_(n,`\r
\r
`),o===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(a=Gde(n,0,o).split(`\r
`),s=Ude(a),!s))throw new Error("invalid response - no boundary marker");const l=o+4,d=G_(n,s,l);if(d===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||=Bde(a),r.tokenIndex=o,r.boundary=s,r.responseHeaders=a,r.multipartContentType=c,r.isPartial=d===-1,{contentType:c,extractDone:!i||d!==-1,tokenIndex:o,responseHeaders:a,boundary:s,multipartContentType:c,pixelData:e.slice(l,d-2)}}function Ude(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function Bde(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function Gde(t,e,r){e=e||0,r=r||t.length-e;let n="";for(let i=e;i<e+r;i++)n+=String.fromCharCode(t[i]);return n}const{ImageQualityStatus:$_}=To;function yx(t,e=!0){return e?t.imageQualityStatus??$_.FULL_RESOLUTION:$_.SUBRESOLUTION}const{ProgressiveIterator:Wde}=hn;function $de(t,e,r={},n={}){const i=Wm(),{retrieveOptions:o={},streamingData:a={}}=n,s=o.minChunkSize||128*1024,c=d=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}},l=new Wde("streamRequest");return l.generate(async(d,u)=>{const f=await i.beforeSend?.(null,t,r,{}),h=Object.assign({},r,f);Object.keys(h).forEach(function(g){h[g]===null&&(h[g]=void 0),g==="Accept"&&t.indexOf("accept=")!==-1&&(h[g]=void 0)});try{const g=await fetch(t,{headers:h,signal:void 0});if(g.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${g.status}`);const p=g.body.getReader(),v=g.headers,w=v.get("content-type"),m=Number(v.get("Content-Length"));let y=!1,C=a.encodedData,x=a.lastSize||0;for(a.isPartial=!0;!y;){const{done:S,value:T}=await p.read();if(C=zde(C,T),!C){if(y)throw new Error(`Done but no image frame available ${e}`);continue}if(y=S||C.byteLength===m,!y&&C.length<x+s)continue;x=C.length,a.isPartial=!S;const _=vx(w,C,a),E=yx(o,y),D={url:t,imageId:e,..._,percentComplete:S?100:_.pixelData?.length*100/m,imageQualityStatus:E,done:y};d.add(D,y)}}catch(g){c(),console.error(g),u(g)}}),l.getNextPromise()}function zde(t,e){if(!t)return e;if(!e)return t;const r=new Uint8Array(t.length+e.length);return r.set(t,0),r.set(e,t.length),r}function jde(t){const e=t.elements.x7fe00010.fragments,r=t.byteArray.length;for(const n of e){const{position:i,length:o}=n;o>r-i&&(console.log(`Truncated fragment, changing fragment length from ${n.length} to ${r-i}`),n.length=r-i)}return t}function Hde(t){let e=Ei.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let r;try{r=Ei.parseDicom(t)}catch(n){console.error(n),console.log("pixel data dataset:",n.dataSet),r=n.dataSet}return e.elements.x7fe00010=r.elements.x7fe00010,e=jde(e),e}async function JP(t,e,r){const n=Hde(t),{uri:i,imageId:o,fileTotalLength:a}=r;return n.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:o,fetchedLength:t.length,lengthToFetch:a-t.length},s),{fetchedLength:l,lengthToFetch:d}=c,{arrayBuffer:u}=await e(i,o,{byteRange:`${l}-${l+d}`}),f=new Uint8Array(u),h=new Uint8Array(n.byteArray.length+f.length);return h.set(n.byteArray),h.set(f,n.byteArray.length),JP(h,e,r)},n}function Xde(t,e){if(!t)return;const{NumberOfFrames:r,PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i}=QP(t);if(n||r>1){const{shared:o,perFrame:a}=ZP(n,i,e);return{NumberOfFrames:r,PerFrameFunctionalInformation:a,SharedFunctionalInformation:o}}return{NumberOfFrames:r}}function ZP(t,e,r){const n={};(e?Object.values(e.items[0].dataSet.elements):[]).map(o=>n[o.tag]=o);const i={};return(t?Object.values(t.items[r-1].dataSet.elements):[]).map(o=>i[o.tag]=o),{shared:n,perFrame:i}}function QP(t){if(!t)return;const{elements:e,...r}=t,{x52009230:n,x52009229:i,...o}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i,otherElements:o,otherAttributtes:r}}function Kde(t,e){if(!e)return;const{NumberOfFrames:r,PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i,otherElements:o}=QP(e);if(n||r>1){const{shared:a,perFrame:s}=ZP(n,i,t),c={elements:{...o,...a,...s}},l=Object.create(e);return Object.assign(l,c)}return e}let Xr={};const qde=()=>{Xr={}};function wx(t){if(Xr[t])return Xr[t]}function Yde(t){const e=wx(t);return eR(e)}function eR(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function Jde(t){return t.indexOf("&frame=")}function Zde(t){const e=Jde(t),r=e===-1?t:t.slice(0,e),n=parseInt(t.slice(e+7),10)||1;let i;return Xr[r]?i=Xr[r].dataSet:i=void 0,{dataSet:i,frame:n}}function Qde(t){const e=[],r=wx(t);if(eR(r)){const n=r.intString("x00280008");for(let i=1;i<=n;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const tR={_get:wx,generateMultiframeWADOURIs:Qde,retrieveMultiframeDataset:Zde,isMultiframeDataset:Yde};let J0=0,ru={};function efe(t){return Xr[t]!==void 0}function tfe(t){let e;if(t.includes("&frame=")){const{frame:r,dataSet:n}=tR.retrieveMultiframeDataset(t);e=Kde(r,n)}else Xr[t]&&(e=Xr[t].dataSet);return e}function nfe(t,e){const r=Xr[t];if(!r){console.error(`No loaded dataSet for uri ${t}`);return}J0-=r.dataSet.byteArray.length,r.dataSet=e,J0+=e.byteArray.length,Ye(Fe,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:$m()})}function rfe(t,e=mx,r){if(Xr[t])return new Promise(o=>{Xr[t].cacheCount++,o(Xr[t].dataSet)});if(ru[t])return ru[t].cacheCount++,ru[t];const n=e(t,r),i=new Promise((o,a)=>{n.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return a(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const l=new Uint8Array(s);let d;try{c.isPartialContent?d=await JP(l,e,{uri:t,imageId:r,fileTotalLength:c.fileTotalLength}):d=Ei.parseDicom(l)}catch(u){return a(u)}Xr[t]={dataSet:d,cacheCount:i.cacheCount},J0+=d.byteArray.length,o(d),Ye(Fe,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:$m()})},a).then(()=>{delete ru[t]},()=>{delete ru[t]})});return i.cacheCount=1,ru[t]=i,i}function ife(t){Xr[t]&&(Xr[t].cacheCount--,Xr[t].cacheCount===0&&(J0-=Xr[t].dataSet.byteArray.length,delete Xr[t],Ye(Fe,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:$m()})))}function $m(){return{cacheSizeInBytes:J0,numberOfDataSetsCached:Object.keys(Xr).length}}function ofe(){qde(),ru={},J0=0}const bf={isLoaded:efe,load:rfe,unload:ife,getInfo:$m,purge:ofe,get:tfe,update:nfe};function afe(t){const e=[];for(let r=0;r<=30;r+=2){let n=`x60${r.toString(16)}`;n.length===4&&(n=`x600${r.toString(16)}`);const i=t.elements[`${n}3000`];if(!i)continue;const o=[];for(let a=0;a<i.length;a++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+a];o[a*8+s]=c>>s&1}e.push({rows:t.uint16(`${n}0010`),columns:t.uint16(`${n}0011`),type:t.string(`${n}0040`),x:t.int16(`${n}0050`,1)-1,y:t.int16(`${n}0050`,0)-1,pixelData:o,description:t.string(`${n}0022`),label:t.string(`${n}1500`),roiArea:t.string(`${n}1301`),roiMean:t.string(`${n}1302`),roiStandardDeviation:t.string(`${n}1303`)})}return{overlays:e}}function Ed(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function Cx(t,e){const r=t.string("x00080008");if(r){const n=r.split("\\");if(n.length>e)return n[e]}}function sfe(t){let e;if(t.string("x00080060")?.includes("NM")){const n=Cx(t,2);n&&Ed(n)&&t.elements.x00540022&&(e=ss(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function cfe(t){let e;if(t.string("x00080060")?.includes("NM")){const n=Cx(t,2);n&&Ed(n)&&t.elements.x00540022&&(e=ss(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function z_(t){let e=ss(t,"x00200037",6);return!e&&t.elements.x00209116?.items?.[0]?.dataSet&&(e=ss(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=sfe(t)),e}function j_(t){let e=ss(t,"x00200032",3);return!e&&t.elements.x00209113?.items?.[0]?.dataSet&&(e=ss(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=cfe(t)),e}function H_(t){let e=ss(t,"x00280030",2);return!e&&t.elements.x00289110?.items?.[0]?.dataSet&&(e=ss(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function X_(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}const nR=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function K_(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(n=>{const i=n.dataSet.double("x0018602c"),o=n.dataSet.double("x0018602e"),a=n.dataSet.uint16("x00186024"),s=n.dataSet.uint16("x00186026"),c=n.dataSet.uint16("x0018601a"),l=n.dataSet.uint16("x0018601e"),d=n.dataSet.uint16("x00186018"),u=n.dataSet.uint16("x0018601c"),f=n.dataSet.int32("x00186020")||null,h=n.dataSet.int32("x00186022")||null,g=n.dataSet.uint16("x0018602a"),p=n.dataSet.uint16("x00186028"),v=n.dataSet.uint16("x00186012"),w=n.dataSet.uint16("x00186014"),m=n.dataSet.uint16("x00186016"),y=n.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:d,regionLocationMaxX1:u,referencePixelX0:f,referencePixelY0:h,physicalDeltaX:i,physicalDeltaY:o,physicalUnitsXDirection:a,physicalUnitsYDirection:s,referencePhysicalPixelValueY:g,referencePhysicalPixelValueX:p,regionSpatialFormat:v,regionDataType:w,regionFlags:m,transducerFrequency:y}})}function lfe(t,e){const{MetadataModules:r}=To;if(Array.isArray(e))return;const n=Gm(e);if(t===r.MULTIFRAME){const a=tR.retrieveMultiframeDataset(n.url);return a.dataSet?Xde(a.dataSet,a.frame):void 0}let i=n.url;n.frame&&(i=`${i}&frame=${n.frame}`);const o=bf.get(i);if(o)return ufe(t,e,o)}function ufe(t,e,r){const{MetadataModules:n}=To;if(t===n.GENERAL_STUDY)return{studyDescription:r.string("x00081030"),studyDate:Ei.parseDA(r.string("x00080020")),studyTime:Ei.parseTM(r.string("x00080030")||""),accessionNumber:r.string("x00080050")};if(t===n.GENERAL_SERIES)return{modality:r.string("x00080060"),seriesInstanceUID:r.string("x0020000e"),seriesDescription:r.string("x0008103e"),seriesNumber:r.intString("x00200011"),studyInstanceUID:r.string("x0020000d"),seriesDate:Ei.parseDA(r.string("x00080021")),seriesTime:Ei.parseTM(r.string("x00080031")||""),acquisitionDate:Ei.parseDA(r.string("x00080022")),acquisitionTime:Ei.parseTM(r.string("x00080032")||"")};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:r.string("x00080018"),instanceNumber:r.intString("x00200013"),lossyImageCompression:r.string("x00282110"),lossyImageCompressionRatio:r.floatString("x00282112"),lossyImageCompressionMethod:r.string("x00282114")};if(t===n.PATIENT)return{patientID:r.string("x00100020"),patientName:r.string("x00100010")};if(t===n.PATIENT_STUDY)return{patientAge:r.intString("x00101010"),patientSize:r.floatString("x00101020"),patientSex:r.string("x00100040"),patientWeight:r.floatString("x00101030")};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=r.string("x00080060"),o=Cx(r,2);return{modality:i,imageType:r.string("x00080008"),imageSubType:o,imageOrientationPatient:z_(r),imagePositionPatient:j_(r),sliceThickness:X_(r),pixelSpacing:H_(r),numberOfFrames:r.uint16("x00280008"),isNMReconstructable:Ed(o)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){const i=z_(r),o=j_(r),a=H_(r),s=X_(r);let c=null,l=null,d=!1;a?(l=a[0],c=a[1]):(d=!0,l=1,c=1);let u=null,f=null;return i&&(u=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],f=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:r.string("x00200052"),rows:r.uint16("x00280010"),columns:r.uint16("x00280011"),imageOrientationPatient:i,rowCosines:u,columnCosines:f,imagePositionPatient:o,sliceThickness:s,sliceLocation:r.floatString("x00201041"),pixelSpacing:a,rowPixelSpacing:l,columnPixelSpacing:c,usingDefaultValues:d}}if(t===n.CINE)return{frameTime:r.floatString("x00181063")};if(t===n.IMAGE_PIXEL)return Mde(r);if(t===n.VOI_LUT){const i=Rde(r);return{windowCenter:ss(r,"x00281050",1),windowWidth:ss(r,"x00281051",1),voiLUTSequence:U_(i,r.elements.x00283010),voiLUTFunction:r.string("x00281056")}}if(t===n.MODALITY_LUT)return{rescaleIntercept:r.floatString("x00281052"),rescaleSlope:r.floatString("x00281053"),rescaleType:r.string("x00281054"),modalityLUTSequence:U_(r.uint16("x00280103"),r.elements.x00283000)};if(t===n.SOP_COMMON)return{sopClassUID:r.string("x00080016"),sopInstanceUID:r.string("x00080018")};if(t===n.PET_ISOTOPE){const i=r.elements.x00540016;if(i===void 0)return;const o=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Ei.parseTM(o.string("x00181072")||""),radionuclideTotalDose:o.floatString("x00181074"),radionuclideHalfLife:o.floatString("x00181075")}}}if(t===n.OVERLAY_PLANE)return afe(r);if(t==="transferSyntax"){let i;try{i=r.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===n.PET_SERIES)return{correctedImage:r.string("x00280051"),units:r.string("x00541001"),decayCorrection:r.string("x00541102")};if(t===n.PET_IMAGE)return{frameReferenceTime:r.floatString(r.string("x00541300")||""),actualFrameDuration:r.intString(r.string("x00181242"))};if(t===n.ULTRASOUND_ENHANCED_REGION)return K_(r);if(t===n.CALIBRATION&&r.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:K_(r)};if(t==="instance")return _w(e,nR)}let zm=[];function dfe(t){return`dicomfile:${zm.push(t)-1}`}function ffe(t){return zm[t]}function hfe(t){zm[t]=void 0}function gfe(){zm=[]}const rR={add:dfe,get:ffe,remove:hfe,purge:gfe};function pfe(t){const e=t.intString("x00280008"),r=t.elements.x7fe00010;return e!==r.fragments.length}function mfe(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return Ei.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(pfe(t)){const l=Ei.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return Ei.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const r=t.elements.x7fe00010.fragments,n=new Ei.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=Ei.readSequenceItem(n);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";n.seek(i.length);const o=n.position;if(e+1>r.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=o+r[e].offset+8,c=r[e].length;return new Uint8Array(n.byteArray.buffer.slice(n.byteArray.byteOffset+s,n.byteArray.byteOffset+s+c))}function vfe(t,e){return t&1<<e}function yfe(t,e,r){const n=new Uint8Array(r);for(let i=0;i<r;i++){const o=Math.floor(i/8),a=t[o+e],s=i%8;n[i]=vfe(a,s)?1:0}return n}function wfe(t,e){const r=t.elements.x7fe00010||t.elements.x7fe00008,n=t.uint16("x00280100"),i=t.uint16("x00280010"),o=t.uint16("x00280011");let a=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(a=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=r.dataOffset,l=i*o*a;let d;if(n===8){if(d=c+e*l,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(d,d+l))}else if(n===16){if(d=c+e*l*2,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(d,d+l*2))}else if(n===1){if(d=c+e*l*.125,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return yfe(t.byteArray,d,l)}else if(n===32){if(d=c+e*l*4,d>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(d,d+l*4))}throw new Error("unsupported pixel format")}function Cfe(t){const e=Gm(t),r=parseInt(e.url,10),n=rR.get(r);return new Promise((i,o)=>{const a=new FileReader;a.onload=s=>{const c=s.target.result;i(c)},a.onerror=o,a.readAsArrayBuffer(n)})}function iR(t,e=0){const r=t.elements.x7fe00010||t.elements.x7fe00008;return r?r.encapsulatedPixelData?mfe(t,e):wfe(t,e):null}function xx(t){let e=t[0],r=t[0],n;const i=t.length;for(let o=1;o<i;o++)n=t[o],e=Math.min(e,n),r=Math.max(r,n);return{min:e,max:r}}function xfe(t,e,r){t.planarConfiguration===0?YP(t.pixelData,e,r):Sde(t.pixelData,e,r)}function Sfe(t,e,r){t.planarConfiguration===0?Tde(t.pixelData,e,r):_de(t.pixelData,e,r)}function Tfe(t,e,r){const{photometricInterpretation:n}=t;if(t.photometricInterpretation==="RGB")xfe(t,e,r);else if(n==="YBR_RCT"||n==="YBR_ICT"||n==="YBR_PARTIAL_420")YP(t.pixelData,e,r);else if(t.photometricInterpretation==="PALETTE COLOR")bde(t,e,r);else if(t.photometricInterpretation==="YBR_FULL_422")Ede(t.pixelData,e,r);else if(t.photometricInterpretation==="YBR_FULL")Sfe(t,e,r);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function _fe(t){if(t===void 0)return!1;const{rows:e,columns:r,photometricInterpretation:n,pixelDataLength:i,planarConfiguration:o}=t;return i===4*r*e?!1:n==="PALETTE COLOR"?!0:n.endsWith("420")?i===(3*Math.ceil(r/2)+Math.floor(r/2))*e:n.endsWith("422")?i===(3*Math.ceil(r/2)+Math.floor(r/2))*Math.ceil(e/2)+Math.floor(e/2)*r:n!=="RGB"||o===1}function Efe(t){return bfe(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function bfe(t){let e;try{return decodeURIComponent(escape(t))}catch(r){if(e=r,e instanceof URIError)return t;throw e}}function Dfe(t,e,r){const n=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((o,a)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){r.height=c.height,r.width=c.width,t.rows=c.height,t.columns=c.width;const l=r.getContext("2d");l.drawImage(this,0,0);const d=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(d.data.buffer),t.imageData=d,t.decodeTimeInMS=u-n;const f=xx(t.pixelData);t.smallestPixelValue=f.min,t.largestPixelValue=f.max,t.pixelDataLength=t.pixelData.length,o(t)},c.onerror=function(l){a(l)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(Efe(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{a(c)}})}function Yi(t,e,r,n,i){const o={...n};delete o.loader,delete o.streamingData;const a=cc(),s=o.priority||void 0;return o.transferPixelData&&r.buffer,a.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:r,options:o,decodeConfig:i},{priority:s,requestType:o?.requestType})}function Ife(t,e,r,n,i={},o){switch(e){case"1.2.840.10008.1.2":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.1":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.2":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.1.99":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.5":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?Dfe(t,r,n):Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.51":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.57":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.70":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.80":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.81":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.90":return Yi(t,e,r,i,o);case"1.2.840.10008.1.2.4.91":return Yi(t,e,r,i,o);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return Yi(t,e,r,i,o)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function Mfe(t){const e=ut("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function Ofe(t,e){const r=t.get("modalityLutModule",e)||{},n=t.get("generalSeriesModule",e)||{},{modality:i}=n,o={rescaleSlope:r.rescaleSlope,rescaleIntercept:r.rescaleIntercept,modality:i},a=t.get("scalingModule",e)||{};return{...o,...i==="PT"&&{suvbw:a.suvbw},...i==="RTDOSE"&&{doseGridScaling:a.DoseGridScaling,doseSummation:a.DoseSummation,doseType:a.DoseType,doseUnit:a.DoseUnit}}}function oR(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}function Pfe(t,e){const r=t.length/4;let n=0,i=0;for(let o=0;o<r;o++)e[i++]=t[n++],e[i++]=t[n++],e[i++]=t[n++],n++;return e}function Rfe(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function Sx(t,e){let r;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?r=Uint8Array:e<=65535?r=Uint16Array:e<=4294967295&&(r=Uint32Array):t>=-128&&e<=127?r=Int8Array:t>=-32768&&e<=32767&&(r=Int16Array)),r||Float32Array}function Afe(t,e,r){return Sx(t,e)===r}function Lfe(t){const e=t.smallestPixelValue,r=t.largestPixelValue,n=Sx(e,r);if(n){const i=new n(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}let q_="";function Tx(t,e,r,n={}){const i=n.useRGBA;if(n.preScale={enabled:n.preScale&&n.preScale.enabled!==void 0?n.preScale.enabled:!0},!e?.length)return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:o}=To,a=document.createElement("canvas"),s=Mfe(t);if(s.decodeLevel=n.decodeLevel,n.allowFloatRendering=p5(),n.preScale.enabled){const u=Ofe(dX,t);u&&(n.preScale={...n.preScale,scalingParameters:u})}const{decodeConfig:c}=Wm();Object.keys(s).forEach(u=>{(typeof s[u]=="function"||s[u]instanceof Promise)&&delete s[u]});const l=Ife(s,r,e,a,n,c),d=oR(s.photometricInterpretation);return new Promise((u,f)=>{l.then(function(h){let g=!1;if(n.targetBuffer&&n.targetBuffer.type&&!d){const{arrayBuffer:E,type:D,offset:b=0,length:I}=n.targetBuffer,O=h.pixelDataLength,M=b,R=I??O-M,A={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};if(R!==h.pixelDataLength)throw new Error(`target array for image does not have the same length (${R}) as the decoded image length (${h.pixelDataLength}).`);const G=A[D],k=E?new G(E,M,R):new G(h.pixelData);if(R!==h.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");h.pixelData=k,g=!0}g||Lfe(h);const p=ut(o.IMAGE_PLANE,t)||{},v=ut(o.VOI_LUT,t)||{},w=ut(o.MODALITY_LUT,t)||{},m=ut(o.SOP_COMMON,t)||{},y=ut(o.CALIBRATION,t)||{},{rows:C,columns:x}=h;if(d){if(_fe(h)){a.height=h.rows,a.width=h.columns;let b=a.getContext("2d").createImageData(h.columns,h.rows);i||(b={...b,data:new Uint8ClampedArray(3*h.columns*h.rows)}),Tfe(h,b.data,i),h.imageData=b,h.pixelData=b.data,h.pixelDataLength=b.data.length}else if(!i&&h.pixelDataLength===4*C*x){const D=new Uint8Array(h.pixelData.length/4*3);h.pixelData=Pfe(h.pixelData,D),h.pixelDataLength=h.pixelData.length}const E=xx(h.pixelData);h.smallestPixelValue=E.min,h.largestPixelValue=E.max}let S=h.samplesPerPixel;h.photometricInterpretation==="PALETTE COLOR"&&(S=i?4:3);const T=ns.createImageVoxelManager({scalarData:h.pixelData,width:h.columns,height:h.rows,numberOfComponents:S}),_={imageId:t,dataType:h.pixelData.constructor.name,color:d,calibration:y,columnPixelSpacing:p.columnPixelSpacing,columns:h.columns,height:h.rows,preScale:h.preScale,intercept:w.rescaleIntercept?w.rescaleIntercept:0,slope:w.rescaleSlope?w.rescaleSlope:1,invert:h.photometricInterpretation==="MONOCHROME1",minPixelValue:h.smallestPixelValue,maxPixelValue:h.largestPixelValue,rowPixelSpacing:p.rowPixelSpacing,rows:h.rows,sizeInBytes:h.pixelData.byteLength,width:h.columns,windowCenter:v.windowCenter?v.windowCenter[0]:void 0,windowWidth:v.windowWidth?v.windowWidth[0]:void 0,voiLUTFunction:v.voiLUTFunction?v.voiLUTFunction:void 0,decodeTimeInMS:h.decodeTimeInMS,floatPixelData:void 0,imageFrame:h,voxelManager:T,rgba:d&&i,getPixelData:()=>h.pixelData,getCanvas:void 0,numberOfComponents:S};if(_.color&&(_.getCanvas=function(){if(q_===t)return a;const E=_.columns,D=_.rows;a.height=D,a.width=E;const b=a.getContext("2d"),I=b.createImageData(E,D),O=h.pixelData;if(O.length===E*D*4)for(let M=0;M<O.length;M++)I.data[M]=O[M];else if(O.length===E*D*3){let M=0;for(let R=0;R<O.length;R+=3)I.data[M++]=O[R],I.data[M++]=O[R+1],I.data[M++]=O[R+2],I.data[M++]=255}return h.pixelData=I.data,h.pixelDataLength=I.data.length,h.imageData=I,b.putImageData(h.imageData,0,0),q_=t,a}),w.modalityLUTSequence&&w.modalityLUTSequence.length>0&&Rfe(m.sopClassUID)&&(_.modalityLUT=w.modalityLUTSequence[0]),v.voiLUTSequence&&v.voiLUTSequence.length>0&&(_.voiLUT=v.voiLUTSequence[0]),_.color&&(_.windowWidth=256,_.windowCenter=128),_.windowCenter===void 0||_.windowWidth===void 0){const E=td(_.imageFrame.smallestPixelValue,_.imageFrame.largestPixelValue);_.windowWidth=E.windowWidth,_.windowCenter=E.windowCenter}u(_)},f)})}const{ImageQualityStatus:aR}=To;function Nfe(t,e){t.decache=function(){const r=Gm(e);bf.unload(r.url)}}function Vfe(t,e,r=0,n,i,o){const a=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,l)=>{t.then(d=>{const u=iR(d,r),f=d.string("x00020010"),h=new Date().getTime(),g=Tx(e,u,f,i);Nfe(s,e),g.then(p=>{p=p,p.data=d,p.sharedCacheKey=n;const v=new Date().getTime();p.loadTimeInMS=h-a,p.totalTimeInMS=v-a,p.imageQualityStatus=aR.FULL_RESOLUTION,o!==void 0&&o.imageDoneCallback!==void 0&&o.imageDoneCallback(p),c(p)},function(p){l({error:p,dataSet:d})})},function(d){l({error:d})})}),s}function kfe(t,e,r=0,n,i){const o=new Date().getTime();return{promise:new Promise((s,c)=>{const l=new Date().getTime();let d;try{const u=iR(t,r),f=t.string("x00020010");d=Tx(e,u,f,i)}catch(u){c({error:u,dataSet:t});return}d.then(u=>{u=u,u.data=t;const f=new Date().getTime();u.loadTimeInMS=l-o,u.totalTimeInMS=f-o,u.imageQualityStatus=aR.FULL_RESOLUTION,s(u)},c)}),cancelFn:void 0}}function Ffe(t){if(t==="dicomweb"||t==="wadouri")return mx;if(t==="dicomfile")return Cfe}function Tv(t,e={}){const r=Gm(t);e=Object.assign({},e),delete e.loader;const n=Ffe(r.scheme);if(bf.isLoaded(r.url)){const o=bf.get(r.url,n,t);return kfe(o,t,r.pixelDataFrame,r.url,e)}const i=bf.load(r.url,n,t);return Vfe(i,t,r.frame,r.url,e)}function Ufe(){lp("dicomweb",Tv),lp("wadouri",Tv),lp("dicomfile",Tv),od(lfe)}const Bfe={fileManager:rR};function zt(t,e,r){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?r:t.Value[e]}function An(t,e){const r=zt(t,e);if(r!==void 0)return parseFloat(r)}function ki(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const r=[];for(let n=0;n<t.Value.length;n++)r.push(parseFloat(t.Value[n]));return r}function Gfe(t){const e=[];for(let r=0;r<=30;r+=2){let n=`x60${r.toString(16)}`;n.length===4&&(n=`x600${r.toString(16)}`);const i=zt(t[`${n}3000`]);if(!i)continue;const o=[];for(let a=0;a<i.length;a++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+a];o[a*8+s]=c>>s&1}e.push({rows:An(t[`${n}0010`]),columns:An(t[`${n}0011`]),type:zt(t[`${n}0040`]),x:An(t[`${n}0050`],1)-1,y:An(t[`${n}0050`],0)-1,pixelData:o,description:zt(t[`${n}0022`]),label:zt(t[`${n}1500`]),roiArea:zt(t[`${n}1301`]),roiMean:zt(t[`${n}1302`]),roiStandardDeviation:zt(t[`${n}1303`])})}return{overlays:e}}function jm(t){const e=t.indexOf(":");return t.substring(e+1)}function O0(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function sR(t,e,r){const n=(e?Object.values(e[0]):[]).map(o=>o.Value?.[0]).filter(o=>o!==void 0&&typeof o=="object"),i=(t?Object.values(t[r-1]):[]).map(o=>o.Value?.[0]).filter(o=>o!==void 0&&typeof o=="object");return{shared:n,perFrame:i}}function cR(t){let{52009230:e,52009229:r,"00280008":n,...i}=t;return e=O0(e,!1),r=O0(r,!1),n=O0(n),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:r,NumberOfFrames:n,rest:i}}function Wfe(t,e){const{PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:n,NumberOfFrames:i,rest:o}=cR(e);if(r||i>1){const{shared:a,perFrame:s}=sR(r,n,t),c=Object.assign(e,{frameNumber:t});return[...a,...s].forEach(l=>{Object.entries(l).forEach(([d,u])=>{c[d]=u})}),Object.assign(o,{"00280008":i},c)}return e}let Jh=[],M1={};function lR(t){const e=t.indexOf("/frames/")+8,r=t.slice(0,e),n=parseInt(t.slice(e),10);return{metadata:Jh[`${r}1`],frame:n}}function $fe(t){const e=jm(t);return lR(e)}function zfe(t){if(t[52009230]!==void 0||t[52009229]!==void 0)return!0;const e=zt(t["00280008"]);return e&&e>1}function jfe(t,e){const r=jm(t);Object.defineProperty(e,"isMultiframe",{value:zfe(e),enumerable:!1}),Jh[r]=e}function Hfe(t){const e=jm(t),r=Jh[e];if(r&&!r?.isMultiframe)return r;const n=M1[e];if(n)return n;const i=lR(e);if(!i||!i.metadata)return;const{metadata:o,frame:a}=i;if(o){const s=Wfe(a,o);return M1[e]=s,s}}function Xfe(t){const e=jm(t);Jh[e]=void 0,M1[e]=void 0}function Kfe(){Jh=[],M1={}}const uR={add:jfe,get:Hfe,remove:Xfe,purge:Kfe};function dR(t){return zt(t["00080060"]).includes("NM")}function _x(t,e){const r=O0(t["00080008"],!1);if(r)return r[e]}function qfe(t){let e;const r=_x(t,2);if(r&&Ed(r)){const n=O0(t["00540022"]);n&&(e=ki(n["00200037"],6))}return e}function Yfe(t){let e;const r=_x(t,2);if(r&&Ed(r)){const n=O0(t["00540022"]);n&&(e=ki(n["00200032"],3))}return e}function Y_(t){let e=ki(t["00200037"],6);return!e&&dR(t)&&(e=qfe(t)),e}function J_(t){let e=ki(t["00200032"],3);return!e&&dR(t)&&(e=Yfe(t)),e}function Ci(t,e){const r=ki(t[e]);return r?r[0]:null}function Jfe(t){return t?.Value?.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function Z_(t){const e=Jfe(t["00186011"]);return!e||!e.length?null:e.map(n=>{const i=Ci(n,"0018602C"),o=Ci(n,"0018602E"),a=Ci(n,"00186024"),s=Ci(n,"00186026"),c=Ci(n,"0018601A"),l=Ci(n,"0018601E"),d=Ci(n,"00186018"),u=Ci(n,"0018601C"),f=Ci(n,"00186020"),h=Ci(n,"00186022"),g=Ci(n,"0018602A"),p=Ci(n,"00186028"),v=Ci(n,"00186012"),w=Ci(n,"00186014"),m=Ci(n,"00186016"),y=Ci(n,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:d,regionLocationMaxX1:u,referencePixelX0:f,referencePixelY0:h,physicalDeltaX:i,physicalDeltaY:o,physicalUnitsXDirection:a,physicalUnitsYDirection:s,referencePhysicalPixelValueY:g,referencePhysicalPixelValueX:p,regionSpatialFormat:v,regionDataType:w,regionFlags:m,transducerFrequency:y}})}function Zfe(t,e){const{MetadataModules:r}=To;if(t===r.MULTIFRAME){const{metadata:i,frame:o}=$fe(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:a,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=cR(i);if(a||c>1){const{shared:l,perFrame:d}=sR(a,s,o);return{NumberOfFrames:c,PerFrameFunctionalInformation:d,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const n=uR.get(e);if(n){if(t===r.GENERAL_STUDY)return{studyDescription:zt(n["00081030"]),studyDate:zt(n["00080020"]),studyTime:zt(n["00080030"]),accessionNumber:zt(n["00080050"])};if(t===r.GENERAL_SERIES)return{modality:zt(n["00080060"]),seriesInstanceUID:zt(n["0020000E"]),seriesDescription:zt(n["0008103E"]),seriesNumber:An(n["00200011"]),studyInstanceUID:zt(n["0020000D"]),seriesDate:zt(n["00080021"]),seriesTime:zt(n["00080031"]),acquisitionDate:zt(n["00080022"]),acquisitionTime:zt(n["00080032"])};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:zt(n["00080018"]),instanceNumber:An(n["00200013"]),lossyImageCompression:zt(n["00282110"]),lossyImageCompressionRatio:An(n["00282112"]),lossyImageCompressionMethod:zt(n["00282114"])};if(t===r.PATIENT)return{patientID:zt(n["00100020"]),patientName:zt(n["00100010"])};if(t===r.PATIENT_STUDY)return{patientAge:An(n["00101010"]),patientSize:An(n["00101020"]),patientSex:zt(n["00100040"]),patientWeight:An(n["00101030"])};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=zt(n["00080060"]),o=_x(n,2);return{modality:i,imageType:zt(n["00080008"]),imageSubType:o,imageOrientationPatient:Y_(n),imagePositionPatient:J_(n),sliceThickness:An(n["00180050"]),spacingBetweenSlices:An(n["00180088"]),pixelSpacing:ki(n["00280030"],2),numberOfFrames:An(n["00280008"]),isNMReconstructable:Ed(o)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){let i=Y_(n),o=J_(n);const a=ki(n["00280030"],2);let s=null,c=null,l=null,d=null,u=!1;return a?(c=a[0],s=a[1]):(u=!0,c=1,s=1),i?(l=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],d=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(l=[1,0,0],d=[0,1,0],u=!0,i=[...l,...d]),o||(o=[0,0,0],u=!0),{frameOfReferenceUID:zt(n["00200052"]),rows:An(n["00280010"]),columns:An(n["00280011"]),imageOrientationPatient:i,rowCosines:l,columnCosines:d,imagePositionPatient:o,sliceThickness:An(n["00180050"]),sliceLocation:An(n["00201041"]),pixelSpacing:a,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:u}}if(t===r.ULTRASOUND_ENHANCED_REGION)return Z_(n);if(t===r.CALIBRATION&&zt(n["00080060"])==="US")return{sequenceOfUltrasoundRegions:Z_(n)};if(t===r.IMAGE_URL)return Qfe(e,n);if(t===r.CINE)return ehe(e,n);if(t===r.IMAGE_PIXEL)return{samplesPerPixel:An(n["00280002"]),photometricInterpretation:zt(n["00280004"]),rows:An(n["00280010"]),columns:An(n["00280011"]),bitsAllocated:An(n["00280100"]),bitsStored:An(n["00280101"]),highBit:zt(n["00280102"]),pixelRepresentation:An(n["00280103"]),planarConfiguration:An(n["00280006"]),pixelAspectRatio:zt(n["00280034"]),smallestPixelValue:An(n["00280106"]),largestPixelValue:An(n["00280107"]),redPaletteColorLookupTableDescriptor:ki(n["00281101"]),greenPaletteColorLookupTableDescriptor:ki(n["00281102"]),bluePaletteColorLookupTableDescriptor:ki(n["00281103"]),redPaletteColorLookupTableData:ki(n["00281201"]),greenPaletteColorLookupTableData:ki(n["00281202"]),bluePaletteColorLookupTableData:ki(n["00281203"])};if(t===r.VOI_LUT)return{windowCenter:ki(n["00281050"],1),windowWidth:ki(n["00281051"],1),voiLUTFunction:zt(n["00281056"])};if(t===r.MODALITY_LUT)return{rescaleIntercept:An(n["00281052"]),rescaleSlope:An(n["00281053"]),rescaleType:zt(n["00281054"])};if(t===r.SOP_COMMON)return{sopClassUID:zt(n["00080016"]),sopInstanceUID:zt(n["00080018"])};if(t===r.PET_ISOTOPE){const i=zt(n["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:zt(i["00181072"],0,""),radiopharmaceuticalStartDateTime:zt(i["00181078"],0,""),radionuclideTotalDose:An(i["00181074"]),radionuclideHalfLife:An(i["00181075"])}}}if(t===r.OVERLAY_PLANE)return Gfe(n);if(t==="transferSyntax")return fR(e,n);if(t===r.PET_SERIES){let i=n["00280051"],o=zt(n["00280051"]);return i&&i.Value&&Array.isArray(i.Value)&&(o=i.Value.join("\\")),{correctedImage:o,units:zt(n["00541001"]),decayCorrection:zt(n["00541102"])}}if(t===r.PET_IMAGE)return{frameReferenceTime:An(n["00541300"]),actualFrameDuration:An(n["00181242"])};if(t==="instance")return _w(e,nR)}}function Qfe(t,e){const{transferSyntaxUID:r}=fR(t,e),n=pI(r),i=t.substring(7),o=i.replace("/frames/","/thumbnail/");let a=i.replace("/frames/","/rendered/");return n&&(a=a.replace("/rendered/1","/rendered")),{isVideo:n,rendered:a,thumbnail:o}}function ehe(t,e){return{cineRate:zt(e["00180040"]),numberOfFrames:An(e["00280008"])}}function fR(t,e){return{transferSyntaxUID:zt(e["00020010"])||zt(e["00083002"])}}function the(t,e,r={},n={}){const i=Wm(),{retrieveOptions:o={},streamingData:a}=n,s=a.chunkSize||rhe(e,o,"chunkSize")||65536,c=d=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}else console.warn("rangeRequest:Caught",d)};return new Promise(async(d,u)=>{const f=Object.assign({},r);Object.keys(f).forEach(function(h){(f[h]===null||f[h]===void 0)&&delete f[h]});try{a.encodedData||(a.chunkSize=s,a.rangesFetched=0);const h=ihe(a,o),{encodedData:g,responseHeaders:p}=await nhe(t,f,h,a),v=p.get("content-type"),{totalBytes:w}=a,m=w===g.byteLength,y=vx(v,g,{isPartial:!0}),C=yx(o,m||y.extractDone===!0);d({...y,imageQualityStatus:C,percentComplete:y.extractDone?100:g.byteLength*100/w})}catch(h){c(h),console.error(h),u(h)}})}async function nhe(t,e,r,n){r&&(e=Object.assign(e,{Range:`bytes=${r[0]}-${r[1]}`}));let{encodedData:i}=n;if(r[1]&&i?.byteLength>r[1])return n;const o=await fetch(t,{headers:e,signal:void 0}),a=await o.arrayBuffer(),s=new Uint8Array(a),{status:c}=o;let l;i?(l=new Uint8Array(i.length+s.length),l.set(i,0),l.set(s,i.length),n.rangesFetched=1):(l=new Uint8Array(s.length),l.set(s,0),n.rangesFetched++),n.encodedData=i=l,n.responseHeaders=o.headers;const d=o.headers.get("Content-Range");return d?n.totalBytes=Number(d.split("/")[1]):c!==206||!r?n.totalBytes=i?.byteLength:r[1]===""||i?.length<r[1]?n.totalBytes=i.byteLength:n.totalBytes=Number.MAX_SAFE_INTEGER,n}function rhe(t,e,r){const n=e[r];if(typeof n!="function")return n;const i=uR.get(t);return n(i,t)}function ihe(t,e){const{totalBytes:r,encodedData:n,chunkSize:i=65536}=t,{rangeIndex:o=0}=e;return o===-1&&(!r||!n)?[0,""]:o===-1||n?.byteLength>r-i?[n?.byteLength||0,""]:[n?.byteLength||0,i*(o+1)-1]}function ohe(t,e,r="application/octet-stream",n){const{streamingData:i,retrieveOptions:o={}}=n||{},a={Accept:r};let s=o.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${o.urlArguments}`:t;if(o.framesPath&&(s=s.replace("/frames/",o.framesPath)),i?.url!==s&&(n.streamingData={url:s}),o.rangeIndex!==void 0)return the(s,e,a,n);if(o.streaming)return $de(s,e,a,n);const c=mx(s,e,a),{xhr:l}=c;return c.then(function(d){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",f=vx(u,new Uint8Array(d));return f.imageQualityStatus=yx(o,!0),f})}const{ProgressiveIterator:Q_}=hn,{ImageQualityStatus:eE}=To,ahe=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function she(t){const e="1.2.840.10008.1.2";if(!t)return e;const r=t.split(";"),n={};r.forEach(o=>{const a=o.split("=");if(a.length!==2)return;const s=a[1].trim().replace(/"/g,"");n[a[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return n["transfer-syntax"]?n["transfer-syntax"]:t&&!Object.keys(n).length&&i[t]?i[t]:n.type&&i[n.type]?i[n.type]:i[t]?i[t]:e}function che(){return Nh}const lhe="multipart/related; type=application/octet-stream; transfer-syntax=*";function uhe(t,e={}){const r=che(),n=new Date().getTime(),i=new Q_("decompress");async function o(d,u,f){i.generate(async h=>{const g=Q_.as(ohe(d,u,f,e));let p=10;for await(const v of g){const{pixelData:w,imageQualityStatus:m=eE.FULL_RESOLUTION,percentComplete:y,done:C=!0,extractDone:x=!0}=v,S=she(v.contentType);if(!x&&!ahe.has(S))continue;const T=v.decodeLevel??(m===eE.FULL_RESOLUTION?0:dhe(y,e.retrieveOptions?.decodeLevel));if(!(!C&&p<=T))try{const _={...e,decodeLevel:T},E=await Tx(u,w,S,_),D=new Date().getTime();E.loadTimeInMS=D-n,E.transferSyntaxUID=S,E.imageQualityStatus=m,h.add(E,C),p=T}catch(_){if(x)throw console.warn("Couldn't decode",_),_}}})}const a=e.requestType||Jt.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return r.addRequest(o.bind(this,l,t,lhe),a,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function dhe(t,e=4){const r=t/100-.02;return r>1/4?Math.min(e,0):r>1/16?Math.min(e,1):r>1/64?Math.min(e,2):Math.min(e,3)}function fhe(){lp("wadors",uhe),od(Zfe)}function hhe(){fhe(),Ufe()}const ghe=()=>new Worker(new URL("/radiology-ai-viewer/assets/decodeImageFrameWorker-C6Q2UkgP.js",import.meta.url),{type:"module"});function phe(t={}){Vde(t),hhe();const e=cc(),r=t?.maxWebWorkers||mhe();e.registerWorker("dicomImageLoader",ghe,{maxWorkerInstances:r})}function mhe(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function vhe(t,e){const{rows:r,columns:n,data:i}=t,{rows:o,columns:a,data:s}=e,c=[],l=[],d=[];for(let u=0;u<a;u++){const f=u*(n-1)/(a-1);c[u]=Math.floor(f),l[u]=Math.min(c[u]+1,n-1),d[u]=f-c[u]}for(let u=0;u<o;u++){const f=u*(r-1)/(o-1),h=Math.floor(f)*n,g=Math.min(h+n,(r-1)*n),p=f-Math.floor(f),v=1-p,w=u*a;for(let m=0;m<a;m++){const y=i[h+c[m]],C=i[h+l[m]],x=i[g+c[m]],S=i[g+l[m]],T=1-d[m];s[w+m]=(y*T+C*d[m])*v+(x*T+S*d[m])*p}}return s}function yhe(t,e){const{rows:r,columns:n,pixelData:i,samplesPerPixel:o=1}=t,{rows:a,columns:s,pixelData:c}=e,l=[];for(let d=0;d<s;d++){const u=d*(n-1)/(s-1);l[d]=Math.floor(u)*o}for(let d=0;d<a;d++){const u=d*(r-1)/(a-1),f=Math.floor(u)*n*o,h=d*s;for(let g=0;g<s;g++)for(let p=0;p<o;p++)c[h+g+p]=i[f+l[g]+p]}return c}async function tE(t,e){let r=e.buffer,n=e.byteOffset;const i=e.length;if(t.bitsAllocated===16)n%2&&(r=r.slice(n),n=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(r,n,i/2):t.pixelData=new Int16Array(r,n,i/2);else if(t.bitsAllocated===8||t.bitsAllocated===1)t.pixelData=e;else if(t.bitsAllocated===32){if(n%2&&(r=r.slice(n),n=0),t.floatPixelData||t.doubleFloatPixelData)throw new Error("Float pixel data is not supported for parsing into ImageFrame");t.pixelRepresentation===0?t.pixelData=new Uint32Array(r,n,i/4):t.pixelRepresentation===1?t.pixelData=new Int32Array(r,n,i/4):t.pixelData=new Float32Array(r,n,i/4)}return t}function whe(t){return(t&255)<<8|t>>8&255}async function Che(t,e){if(t.bitsAllocated===16){let r=e.buffer,n=e.byteOffset;const i=e.length;n%2&&(r=r.slice(n),n=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(r,n,i/2):t.pixelData=new Int16Array(r,n,i/2);for(let o=0;o<t.pixelData.length;o++)t.pixelData[o]=whe(t.pixelData[o])}else t.bitsAllocated===8&&(t.pixelData=e);return t}async function xhe(t,e){if(t.bitsAllocated===8)return t.planarConfiguration?The(t,e):She(t,e);if(t.bitsAllocated===16)return _he(t,e);throw new Error("unsupported pixel format for RLE")}function She(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let c=0;const l=o.getInt32(0,!0);for(let d=0;d<l;++d){c=d;let u=o.getInt32((d+1)*4,!0),f=o.getInt32((d+2)*4,!0);f===0&&(f=r.length);const h=n*l;for(;u<f;){const g=a[u++];if(g>=0&&g<=127)for(let p=0;p<g+1&&c<h;++p)s[c]=a[u++],c+=t.samplesPerPixel;else if(g<=-1&&g>=-127){const p=a[u++];for(let v=0;v<-g+1&&c<h;++v)s[c]=p,c+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(i),t}function The(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let c=0;const l=o.getInt32(0,!0);for(let d=0;d<l;++d){c=d*n;let u=o.getInt32((d+1)*4,!0),f=o.getInt32((d+2)*4,!0);f===0&&(f=r.length);const h=n*l;for(;u<f;){const g=a[u++];if(g>=0&&g<=127)for(let p=0;p<g+1&&c<h;++p)s[c]=a[u++],c++;else if(g<=-1&&g>=-127){const p=a[u++];for(let v=0;v<-g+1&&c<h;++v)s[c]=p,c++}}}return t.pixelData=new Uint8Array(i),t}function _he(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel*2),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i),c=o.getInt32(0,!0);for(let l=0;l<c;++l){let d=0;const u=l===0?1:0;let f=o.getInt32((l+1)*4,!0),h=o.getInt32((l+2)*4,!0);for(h===0&&(h=r.length);f<h;){const g=a[f++];if(g>=0&&g<=127)for(let p=0;p<g+1&&d<n;++p)s[d*2+u]=a[f++],d++;else if(g<=-1&&g>=-127){const p=a[f++];for(let v=0;v<-g+1&&d<n;++v)s[d*2+u]=p,d++}}}return t.pixelRepresentation===0?t.pixelData=new Uint16Array(i):t.pixelData=new Int16Array(i),t}var _v={exports:{}},nE;function Ehe(){return nE||(nE=1,(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(N,U){a=N,s=U});var c=Object.assign({},o),l="./this.program",d=(N,U)=>{throw U},u=typeof window=="object",f=typeof importScripts=="function",h=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function p(N){return o.locateFile?o.locateFile(N,g):g+N}var v,w,m;if(h){var y=Zs,C=Zs;f?g=C.dirname(g)+"/":g=__dirname+"/",v=(N,U)=>(N=le(N)?new URL(N):C.normalize(N),y.readFileSync(N,U?void 0:"utf8")),m=N=>{var U=v(N,!0);return U.buffer||(U=new Uint8Array(U)),U},w=(N,U,J)=>{N=le(N)?new URL(N):C.normalize(N),y.readFile(N,function(ce,he){ce?J(ce):U(he.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(N){if(!(N instanceof gt))throw N}),process.on("unhandledRejection",function(N){throw N}),d=(N,U)=>{throw process.exitCode=N,U},o.inspect=function(){return"[Emscripten Module object]"}}else(u||f)&&(f?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),n&&(g=n),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",v=N=>{var U=new XMLHttpRequest;return U.open("GET",N,!1),U.send(null),U.responseText},f&&(m=N=>{var U=new XMLHttpRequest;return U.open("GET",N,!1),U.responseType="arraybuffer",U.send(null),new Uint8Array(U.response)}),w=(N,U,J)=>{var ce=new XMLHttpRequest;ce.open("GET",N,!0),ce.responseType="arraybuffer",ce.onload=()=>{if(ce.status==200||ce.status==0&&ce.response){U(ce.response);return}J()},ce.onerror=J,ce.send(null)});var x=o.print||console.log.bind(console),S=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&(l=o.thisProgram),o.quit&&(d=o.quit);var T;o.wasmBinary&&(T=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&re("no native wasm support detected");var _,E=!1;function D(N,U){N||re(U)}var b=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function I(N,U,J){for(var ce=U+J,he=U;N[he]&&!(he>=ce);)++he;if(he-U>16&&N.buffer&&b)return b.decode(N.subarray(U,he));for(var ye="";U<he;){var xe=N[U++];if(!(xe&128)){ye+=String.fromCharCode(xe);continue}var be=N[U++]&63;if((xe&224)==192){ye+=String.fromCharCode((xe&31)<<6|be);continue}var Ae=N[U++]&63;if((xe&240)==224?xe=(xe&15)<<12|be<<6|Ae:xe=(xe&7)<<18|be<<12|Ae<<6|N[U++]&63,xe<65536)ye+=String.fromCharCode(xe);else{var Qe=xe-65536;ye+=String.fromCharCode(55296|Qe>>10,56320|Qe&1023)}}return ye}function O(N,U){return N?I(L,N,U):""}function M(N,U,J,ce){if(!(ce>0))return 0;for(var he=J,ye=J+ce-1,xe=0;xe<N.length;++xe){var be=N.charCodeAt(xe);if(be>=55296&&be<=57343){var Ae=N.charCodeAt(++xe);be=65536+((be&1023)<<10)|Ae&1023}if(be<=127){if(J>=ye)break;U[J++]=be}else if(be<=2047){if(J+1>=ye)break;U[J++]=192|be>>6,U[J++]=128|be&63}else if(be<=65535){if(J+2>=ye)break;U[J++]=224|be>>12,U[J++]=128|be>>6&63,U[J++]=128|be&63}else{if(J+3>=ye)break;U[J++]=240|be>>18,U[J++]=128|be>>12&63,U[J++]=128|be>>6&63,U[J++]=128|be&63}}return U[J]=0,J-he}function R(N,U,J){return M(N,L,U,J)}function A(N){for(var U=0,J=0;J<N.length;++J){var ce=N.charCodeAt(J);ce<=127?U++:ce<=2047?U+=2:ce>=55296&&ce<=57343?(U+=4,++J):U+=3}return U}var G,k,L,F,j,Y,ie,de,ae;function fe(N){G=N,o.HEAP8=k=new Int8Array(N),o.HEAP16=F=new Int16Array(N),o.HEAP32=Y=new Int32Array(N),o.HEAPU8=L=new Uint8Array(N),o.HEAPU16=j=new Uint16Array(N),o.HEAPU32=ie=new Uint32Array(N),o.HEAPF32=de=new Float32Array(N),o.HEAPF64=ae=new Float64Array(N)}o.INITIAL_MEMORY;var we,_e=[],Se=[],B=[];function P(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)K(o.preRun.shift());ct(_e)}function $(){ct(Se)}function W(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)ee(o.postRun.shift());ct(B)}function K(N){_e.unshift(N)}function Q(N){Se.unshift(N)}function ee(N){B.unshift(N)}var ge=0,De=null;function Le(N){ge++,o.monitorRunDependencies&&o.monitorRunDependencies(ge)}function Ge(N){if(ge--,o.monitorRunDependencies&&o.monitorRunDependencies(ge),ge==0&&De){var U=De;De=null,U()}}function re(N){o.onAbort&&o.onAbort(N),N="Aborted("+N+")",S(N),E=!0,N+=". Build with -sASSERTIONS for more info.";var U=new WebAssembly.RuntimeError(N);throw s(U),U}var se="data:application/octet-stream;base64,";function ve(N){return N.startsWith(se)}function le(N){return N.startsWith("file://")}var pe;pe="libjpegturbowasm_decode.wasm",ve(pe)||(pe=p(pe));function We(N){try{if(N==pe&&T)return new Uint8Array(T);if(m)return m(N);throw"both async and sync fetching of the wasm failed"}catch(U){re(U)}}function oe(){if(!T&&(u||f)){if(typeof fetch=="function"&&!le(pe))return fetch(pe,{credentials:"same-origin"}).then(function(N){if(!N.ok)throw"failed to load wasm binary file at '"+pe+"'";return N.arrayBuffer()}).catch(function(){return We(pe)});if(w)return new Promise(function(N,U){w(pe,function(J){N(new Uint8Array(J))},U)})}return Promise.resolve().then(function(){return We(pe)})}function st(){var N={a:He};function U(xe,be){var Ae=xe.exports;o.asm=Ae,_=o.asm.K,fe(_.buffer),we=o.asm.M,Q(o.asm.L),Ge()}Le();function J(xe){U(xe.instance)}function ce(xe){return oe().then(function(be){return WebAssembly.instantiate(be,N)}).then(function(be){return be}).then(xe,function(be){S("failed to asynchronously prepare wasm: "+be),re(be)})}function he(){return!T&&typeof WebAssembly.instantiateStreaming=="function"&&!ve(pe)&&!le(pe)&&!h&&typeof fetch=="function"?fetch(pe,{credentials:"same-origin"}).then(function(xe){var be=WebAssembly.instantiateStreaming(xe,N);return be.then(J,function(Ae){return S("wasm streaming compile failed: "+Ae),S("falling back to ArrayBuffer instantiation"),ce(J)})}):ce(J)}if(o.instantiateWasm)try{var ye=o.instantiateWasm(N,U);return ye}catch(xe){S("Module.instantiateWasm callback failed with error: "+xe),s(xe)}return he().catch(s),{}}function gt(N){this.name="ExitStatus",this.message="Program terminated with exit("+N+")",this.status=N}function ct(N){for(;N.length>0;)N.shift()(o)}function Ee(N){this.excPtr=N,this.ptr=N-24,this.set_type=function(U){ie[this.ptr+4>>2]=U},this.get_type=function(){return ie[this.ptr+4>>2]},this.set_destructor=function(U){ie[this.ptr+8>>2]=U},this.get_destructor=function(){return ie[this.ptr+8>>2]},this.set_refcount=function(U){Y[this.ptr>>2]=U},this.set_caught=function(U){U=U?1:0,k[this.ptr+12>>0]=U},this.get_caught=function(){return k[this.ptr+12>>0]!=0},this.set_rethrown=function(U){U=U?1:0,k[this.ptr+13>>0]=U},this.get_rethrown=function(){return k[this.ptr+13>>0]!=0},this.init=function(U,J){this.set_adjusted_ptr(0),this.set_type(U),this.set_destructor(J),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var U=Y[this.ptr>>2];Y[this.ptr>>2]=U+1},this.release_ref=function(){var U=Y[this.ptr>>2];return Y[this.ptr>>2]=U-1,U===1},this.set_adjusted_ptr=function(U){ie[this.ptr+16>>2]=U},this.get_adjusted_ptr=function(){return ie[this.ptr+16>>2]},this.get_exception_ptr=function(){var U=Te(this.get_type());if(U)return ie[this.excPtr>>2];var J=this.get_adjusted_ptr();return J!==0?J:this.excPtr}}function ze(N,U,J){var ce=new Ee(N);throw ce.init(U,J),N}var Ke={};function Je(N){for(;N.length;){var U=N.pop(),J=N.pop();J(U)}}function lt(N){return this.fromWireType(Y[N>>2])}var Oe={},ke={},nt={},wt=48,gn=57;function Sn(N){if(N===void 0)return"_unknown";N=N.replace(/[^a-zA-Z0-9_]/g,"$");var U=N.charCodeAt(0);return U>=wt&&U<=gn?"_"+N:N}function ln(N,U){return N=Sn(N),new Function("body","return function "+N+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(U)}function on(N,U){var J=ln(U,function(ce){this.name=U,this.message=ce;var he=new Error(ce).stack;he!==void 0&&(this.stack=this.toString()+`
`+he.replace(/^Error(:[^\n]*)?\n/,""))});return J.prototype=Object.create(N.prototype),J.prototype.constructor=J,J.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},J}var pi=void 0;function Xt(N){throw new pi(N)}function Be(N,U,J){N.forEach(function(be){nt[be]=U});function ce(be){var Ae=J(be);Ae.length!==N.length&&Xt("Mismatched type converter count");for(var Qe=0;Qe<N.length;++Qe)Br(N[Qe],Ae[Qe])}var he=new Array(U.length),ye=[],xe=0;U.forEach((be,Ae)=>{ke.hasOwnProperty(be)?he[Ae]=ke[be]:(ye.push(be),Oe.hasOwnProperty(be)||(Oe[be]=[]),Oe[be].push(()=>{he[Ae]=ke[be],++xe,xe===ye.length&&ce(he)}))}),ye.length===0&&ce(he)}function rt(N){var U=Ke[N];delete Ke[N];var J=U.rawConstructor,ce=U.rawDestructor,he=U.fields,ye=he.map(xe=>xe.getterReturnType).concat(he.map(xe=>xe.setterArgumentType));Be([N],ye,xe=>{var be={};return he.forEach((Ae,Qe)=>{var at=Ae.fieldName,_t=xe[Qe],Ct=Ae.getter,Yt=Ae.getterContext,Kt=xe[Qe+he.length],Rn=Ae.setter,Tr=Ae.setterContext;be[at]={read:Pr=>_t.fromWireType(Ct(Yt,Pr)),write:(Pr,Wl)=>{var Oo=[];Rn(Tr,Pr,Kt.toWireType(Oo,Wl)),Je(Oo)}}}),[{name:U.name,fromWireType:function(Ae){var Qe={};for(var at in be)Qe[at]=be[at].read(Ae);return ce(Ae),Qe},toWireType:function(Ae,Qe){for(var at in be)if(!(at in Qe))throw new TypeError('Missing field:  "'+at+'"');var _t=J();for(at in be)be[at].write(_t,Qe[at]);return Ae!==null&&Ae.push(ce,_t),_t},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:ce}]})}function Mt(N,U,J,ce,he){}function vn(N){switch(N){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+N)}}function mi(){for(var N=new Array(256),U=0;U<256;++U)N[U]=String.fromCharCode(U);nn=N}var nn=void 0;function Pn(N){for(var U="",J=N;L[J];)U+=nn[L[J++]];return U}var Ri=void 0;function pn(N){throw new Ri(N)}function Br(N,U,J={}){if(!("argPackAdvance"in U))throw new TypeError("registerType registeredInstance requires argPackAdvance");var ce=U.name;if(N||pn('type "'+ce+'" must have a positive integer typeid pointer'),ke.hasOwnProperty(N)){if(J.ignoreDuplicateRegistrations)return;pn("Cannot register type '"+ce+"' twice")}if(ke[N]=U,delete nt[N],Oe.hasOwnProperty(N)){var he=Oe[N];delete Oe[N],he.forEach(ye=>ye())}}function vi(N,U,J,ce,he){var ye=vn(J);U=Pn(U),Br(N,{name:U,fromWireType:function(xe){return!!xe},toWireType:function(xe,be){return be?ce:he},argPackAdvance:8,readValueFromPointer:function(xe){var be;if(J===1)be=k;else if(J===2)be=F;else if(J===4)be=Y;else throw new TypeError("Unknown boolean type size: "+U);return this.fromWireType(be[xe>>ye])},destructorFunction:null})}function Ta(N){if(!(this instanceof Hi)||!(N instanceof Hi))return!1;for(var U=this.$$.ptrType.registeredClass,J=this.$$.ptr,ce=N.$$.ptrType.registeredClass,he=N.$$.ptr;U.baseClass;)J=U.upcast(J),U=U.baseClass;for(;ce.baseClass;)he=ce.upcast(he),ce=ce.baseClass;return U===ce&&J===he}function hc(N){return{count:N.count,deleteScheduled:N.deleteScheduled,preservePointerOnDelete:N.preservePointerOnDelete,ptr:N.ptr,ptrType:N.ptrType,smartPtr:N.smartPtr,smartPtrType:N.smartPtrType}}function qo(N){function U(J){return J.$$.ptrType.registeredClass.name}pn(U(N)+" instance already deleted")}var _a=!1;function no(N){}function mr(N){N.smartPtr?N.smartPtrType.rawDestructor(N.smartPtr):N.ptrType.registeredClass.rawDestructor(N.ptr)}function ni(N){N.count.value-=1;var U=N.count.value===0;U&&mr(N)}function mn(N,U,J){if(U===J)return N;if(J.baseClass===void 0)return null;var ce=mn(N,U,J.baseClass);return ce===null?null:J.downcast(ce)}var sr={};function ro(){return Object.keys(ii).length}function Eo(){var N=[];for(var U in ii)ii.hasOwnProperty(U)&&N.push(ii[U]);return N}var Yo=[];function Jo(){for(;Yo.length;){var N=Yo.pop();N.$$.deleteScheduled=!1,N.delete()}}var ri=void 0;function gc(N){ri=N,Yo.length&&ri&&ri(Jo)}function Cl(){o.getInheritedInstanceCount=ro,o.getLiveInheritedInstances=Eo,o.flushPendingDeletes=Jo,o.setDelayFunction=gc}var ii={};function pc(N,U){for(U===void 0&&pn("ptr should not be undefined");N.baseClass;)U=N.upcast(U),N=N.baseClass;return U}function bo(N,U){return U=pc(N,U),ii[U]}function Ea(N,U){(!U.ptrType||!U.ptr)&&Xt("makeClassHandle requires ptr and ptrType");var J=!!U.smartPtrType,ce=!!U.smartPtr;return J!==ce&&Xt("Both smartPtrType and smartPtr must be specified"),U.count={value:1},Kr(Object.create(N,{$$:{value:U}}))}function xl(N){var U=this.getPointee(N);if(!U)return this.destructor(N),null;var J=bo(this.registeredClass,U);if(J!==void 0){if(J.$$.count.value===0)return J.$$.ptr=U,J.$$.smartPtr=N,J.clone();var ce=J.clone();return this.destructor(N),ce}function he(){return this.isSmartPointer?Ea(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:U,smartPtrType:this,smartPtr:N}):Ea(this.registeredClass.instancePrototype,{ptrType:this,ptr:N})}var ye=this.registeredClass.getActualType(U),xe=sr[ye];if(!xe)return he.call(this);var be;this.isConst?be=xe.constPointerType:be=xe.pointerType;var Ae=mn(U,this.registeredClass,be.registeredClass);return Ae===null?he.call(this):this.isSmartPointer?Ea(be.registeredClass.instancePrototype,{ptrType:be,ptr:Ae,smartPtrType:this,smartPtr:N}):Ea(be.registeredClass.instancePrototype,{ptrType:be,ptr:Ae})}function Kr(N){return typeof FinalizationRegistry>"u"?(Kr=U=>U,N):(_a=new FinalizationRegistry(U=>{ni(U.$$)}),Kr=U=>{var J=U.$$,ce=!!J.smartPtr;if(ce){var he={$$:J};_a.register(U,he,U)}return U},no=U=>_a.unregister(U),Kr(N))}function hs(){if(this.$$.ptr||qo(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var N=Kr(Object.create(Object.getPrototypeOf(this),{$$:{value:hc(this.$$)}}));return N.$$.count.value+=1,N.$$.deleteScheduled=!1,N}function Zo(){this.$$.ptr||qo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&pn("Object already scheduled for deletion"),no(this),ni(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function oi(){return!this.$$.ptr}function gs(){return this.$$.ptr||qo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&pn("Object already scheduled for deletion"),Yo.push(this),Yo.length===1&&ri&&ri(Jo),this.$$.deleteScheduled=!0,this}function io(){Hi.prototype.isAliasOf=Ta,Hi.prototype.clone=hs,Hi.prototype.delete=Zo,Hi.prototype.isDeleted=oi,Hi.prototype.deleteLater=gs}function Hi(){}function ba(N,U,J){if(N[U].overloadTable===void 0){var ce=N[U];N[U]=function(){return N[U].overloadTable.hasOwnProperty(arguments.length)||pn("Function '"+J+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+N[U].overloadTable+")!"),N[U].overloadTable[arguments.length].apply(this,arguments)},N[U].overloadTable=[],N[U].overloadTable[ce.argCount]=ce}}function Gr(N,U,J){o.hasOwnProperty(N)?(pn("Cannot register public name '"+N+"' twice"),ba(o,N,N),o.hasOwnProperty(J)&&pn("Cannot register multiple overloads of a function with the same number of arguments ("+J+")!"),o[N].overloadTable[J]=U):o[N]=U}function Sl(N,U,J,ce,he,ye,xe,be){this.name=N,this.constructor=U,this.instancePrototype=J,this.rawDestructor=ce,this.baseClass=he,this.getActualType=ye,this.upcast=xe,this.downcast=be,this.pureVirtualFunctions=[]}function Xi(N,U,J){for(;U!==J;)U.upcast||pn("Expected null or instance of "+J.name+", got an instance of "+U.name),N=U.upcast(N),U=U.baseClass;return N}function mc(N,U){if(U===null)return this.isReference&&pn("null is not a valid "+this.name),0;U.$$||pn('Cannot pass "'+Io(U)+'" as a '+this.name),U.$$.ptr||pn("Cannot pass deleted object as a pointer of type "+this.name);var J=U.$$.ptrType.registeredClass,ce=Xi(U.$$.ptr,J,this.registeredClass);return ce}function ps(N,U){var J;if(U===null)return this.isReference&&pn("null is not a valid "+this.name),this.isSmartPointer?(J=this.rawConstructor(),N!==null&&N.push(this.rawDestructor,J),J):0;U.$$||pn('Cannot pass "'+Io(U)+'" as a '+this.name),U.$$.ptr||pn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&U.$$.ptrType.isConst&&pn("Cannot convert argument of type "+(U.$$.smartPtrType?U.$$.smartPtrType.name:U.$$.ptrType.name)+" to parameter type "+this.name);var ce=U.$$.ptrType.registeredClass;if(J=Xi(U.$$.ptr,ce,this.registeredClass),this.isSmartPointer)switch(U.$$.smartPtr===void 0&&pn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:U.$$.smartPtrType===this?J=U.$$.smartPtr:pn("Cannot convert argument of type "+(U.$$.smartPtrType?U.$$.smartPtrType.name:U.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:J=U.$$.smartPtr;break;case 2:if(U.$$.smartPtrType===this)J=U.$$.smartPtr;else{var he=U.clone();J=this.rawShare(J,Li.toHandle(function(){he.delete()})),N!==null&&N.push(this.rawDestructor,J)}break;default:pn("Unsupporting sharing policy")}return J}function Tl(N,U){if(U===null)return this.isReference&&pn("null is not a valid "+this.name),0;U.$$||pn('Cannot pass "'+Io(U)+'" as a '+this.name),U.$$.ptr||pn("Cannot pass deleted object as a pointer of type "+this.name),U.$$.ptrType.isConst&&pn("Cannot convert argument of type "+U.$$.ptrType.name+" to parameter type "+this.name);var J=U.$$.ptrType.registeredClass,ce=Xi(U.$$.ptr,J,this.registeredClass);return ce}function vc(N){return this.rawGetPointee&&(N=this.rawGetPointee(N)),N}function yi(N){this.rawDestructor&&this.rawDestructor(N)}function wi(N){N!==null&&N.delete()}function yc(){Mr.prototype.getPointee=vc,Mr.prototype.destructor=yi,Mr.prototype.argPackAdvance=8,Mr.prototype.readValueFromPointer=lt,Mr.prototype.deleteObject=wi,Mr.prototype.fromWireType=xl}function Mr(N,U,J,ce,he,ye,xe,be,Ae,Qe,at){this.name=N,this.registeredClass=U,this.isReference=J,this.isConst=ce,this.isSmartPointer=he,this.pointeeType=ye,this.sharingPolicy=xe,this.rawGetPointee=be,this.rawConstructor=Ae,this.rawShare=Qe,this.rawDestructor=at,!he&&U.baseClass===void 0?ce?(this.toWireType=mc,this.destructorFunction=null):(this.toWireType=Tl,this.destructorFunction=null):this.toWireType=ps}function wc(N,U,J){o.hasOwnProperty(N)||Xt("Replacing nonexistant public symbol"),o[N].overloadTable!==void 0&&J!==void 0||(o[N]=U,o[N].argCount=J)}function ms(N,U,J){var ce=o["dynCall_"+N];return J&&J.length?ce.apply(null,[U].concat(J)):ce.call(null,U)}var Da=[];function er(N){var U=Da[N];return U||(N>=Da.length&&(Da.length=N+1),Da[N]=U=we.get(N)),U}function Ai(N,U,J){if(N.includes("j"))return ms(N,U,J);var ce=er(U).apply(null,J);return ce}function Ia(N,U){var J=[];return function(){return J.length=0,Object.assign(J,arguments),Ai(N,U,J)}}function Wr(N,U){N=Pn(N);function J(){return N.includes("j")?Ia(N,U):er(U)}var ce=J();return typeof ce!="function"&&pn("unknown function pointer with signature "+N+": "+U),ce}var Cc=void 0;function qr(N){var U=bt(N),J=Pn(U);return dt(U),J}function ai(N,U){var J=[],ce={};function he(ye){if(!ce[ye]&&!ke[ye]){if(nt[ye]){nt[ye].forEach(he);return}J.push(ye),ce[ye]=!0}}throw U.forEach(he),new Cc(N+": "+J.map(qr).join([", "]))}function Ma(N,U,J,ce,he,ye,xe,be,Ae,Qe,at,_t,Ct){at=Pn(at),ye=Wr(he,ye),be&&(be=Wr(xe,be)),Qe&&(Qe=Wr(Ae,Qe)),Ct=Wr(_t,Ct);var Yt=Sn(at);Gr(Yt,function(){ai("Cannot construct "+at+" due to unbound types",[ce])}),Be([N,U,J],ce?[ce]:[],function(Kt){Kt=Kt[0];var Rn,Tr;ce?(Rn=Kt.registeredClass,Tr=Rn.instancePrototype):Tr=Hi.prototype;var Pr=ln(Yt,function(){if(Object.getPrototypeOf(this)!==Wl)throw new Ri("Use 'new' to construct "+at);if(Oo.constructor_body===void 0)throw new Ri(at+" has no accessible constructor");var Wx=Oo.constructor_body[arguments.length];if(Wx===void 0)throw new Ri("Tried to invoke ctor of "+at+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Oo.constructor_body).toString()+") parameters instead!");return Wx.apply(this,arguments)}),Wl=Object.create(Tr,{constructor:{value:Pr}});Pr.prototype=Wl;var Oo=new Sl(at,Pr,Wl,Ct,Rn,ye,be,Qe),Zh=new Mr(at,Oo,!0,!1,!1),bd=new Mr(at+"*",Oo,!1,!1,!1),Gx=new Mr(at+" const*",Oo,!1,!0,!1);return sr[N]={pointerType:bd,constPointerType:Gx},wc(Yt,Pr),[Zh,bd,Gx]})}function Oa(N,U){for(var J=[],ce=0;ce<N;ce++)J.push(ie[U+ce*4>>2]);return J}function _l(N,U){if(!(N instanceof Function))throw new TypeError("new_ called with constructor type "+typeof N+" which is not a function");var J=ln(N.name||"unknownFunctionName",function(){});J.prototype=N.prototype;var ce=new J,he=N.apply(ce,U);return he instanceof Object?he:ce}function Pa(N,U,J,ce,he){var ye=U.length;ye<2&&pn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var xe=U[1]!==null&&J!==null,be=!1,Ae=1;Ae<U.length;++Ae)if(U[Ae]!==null&&U[Ae].destructorFunction===void 0){be=!0;break}for(var Qe=U[0].name!=="void",at="",_t="",Ae=0;Ae<ye-2;++Ae)at+=(Ae!==0?", ":"")+"arg"+Ae,_t+=(Ae!==0?", ":"")+"arg"+Ae+"Wired";var Ct="return function "+Sn(N)+"("+at+`) {
if (arguments.length !== `+(ye-2)+`) {
throwBindingError('function `+N+" called with ' + arguments.length + ' arguments, expected "+(ye-2)+` args!');
}
`;be&&(Ct+=`var destructors = [];
`);var Yt=be?"destructors":"null",Kt=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Rn=[pn,ce,he,Je,U[0],U[1]];xe&&(Ct+="var thisWired = classParam.toWireType("+Yt+`, this);
`);for(var Ae=0;Ae<ye-2;++Ae)Ct+="var arg"+Ae+"Wired = argType"+Ae+".toWireType("+Yt+", arg"+Ae+"); // "+U[Ae+2].name+`
`,Kt.push("argType"+Ae),Rn.push(U[Ae+2]);if(xe&&(_t="thisWired"+(_t.length>0?", ":"")+_t),Ct+=(Qe?"var rv = ":"")+"invoker(fn"+(_t.length>0?", ":"")+_t+`);
`,be)Ct+=`runDestructors(destructors);
`;else for(var Ae=xe?1:2;Ae<U.length;++Ae){var Tr=Ae===1?"thisWired":"arg"+(Ae-2)+"Wired";U[Ae].destructorFunction!==null&&(Ct+=Tr+"_dtor("+Tr+"); // "+U[Ae].name+`
`,Kt.push(Tr+"_dtor"),Rn.push(U[Ae].destructorFunction))}Qe&&(Ct+=`var ret = retType.fromWireType(rv);
return ret;
`),Ct+=`}
`,Kt.push(Ct);var Pr=_l(Function,Kt).apply(null,Rn);return Pr}function jn(N,U,J,ce,he,ye){D(U>0);var xe=Oa(U,J);he=Wr(ce,he),Be([],[N],function(be){be=be[0];var Ae="constructor "+be.name;if(be.registeredClass.constructor_body===void 0&&(be.registeredClass.constructor_body=[]),be.registeredClass.constructor_body[U-1]!==void 0)throw new Ri("Cannot register multiple constructors with identical number of parameters ("+(U-1)+") for class '"+be.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return be.registeredClass.constructor_body[U-1]=()=>{ai("Cannot construct "+be.name+" due to unbound types",xe)},Be([],xe,function(Qe){return Qe.splice(1,0,null),be.registeredClass.constructor_body[U-1]=Pa(Ae,Qe,null,he,ye),[]}),[]})}function vs(N,U,J,ce,he,ye,xe,be){var Ae=Oa(J,ce);U=Pn(U),ye=Wr(he,ye),Be([],[N],function(Qe){Qe=Qe[0];var at=Qe.name+"."+U;U.startsWith("@@")&&(U=Symbol[U.substring(2)]),be&&Qe.registeredClass.pureVirtualFunctions.push(U);function _t(){ai("Cannot call "+at+" due to unbound types",Ae)}var Ct=Qe.registeredClass.instancePrototype,Yt=Ct[U];return Yt===void 0||Yt.overloadTable===void 0&&Yt.className!==Qe.name&&Yt.argCount===J-2?(_t.argCount=J-2,_t.className=Qe.name,Ct[U]=_t):(ba(Ct,U,at),Ct[U].overloadTable[J-2]=_t),Be([],Ae,function(Kt){var Rn=Pa(at,Kt,Qe,ye,xe);return Ct[U].overloadTable===void 0?(Rn.argCount=J-2,Ct[U]=Rn):Ct[U].overloadTable[J-2]=Rn,[]}),[]})}var Ra=[],Or=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ys(N){N>4&&--Or[N].refcount===0&&(Or[N]=void 0,Ra.push(N))}function si(){for(var N=0,U=5;U<Or.length;++U)Or[U]!==void 0&&++N;return N}function xc(){for(var N=5;N<Or.length;++N)if(Or[N]!==void 0)return Or[N];return null}function Do(){o.count_emval_handles=si,o.get_first_emval=xc}var Li={toValue:N=>(N||pn("Cannot use deleted val. handle = "+N),Or[N].value),toHandle:N=>{switch(N){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var U=Ra.length?Ra.pop():Or.length;return Or[U]={refcount:1,value:N},U}}}};function El(N,U){U=Pn(U),Br(N,{name:U,fromWireType:function(J){var ce=Li.toValue(J);return ys(J),ce},toWireType:function(J,ce){return Li.toHandle(ce)},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:null})}function Io(N){if(N===null)return"null";var U=typeof N;return U==="object"||U==="array"||U==="function"?N.toString():""+N}function ci(N,U){switch(U){case 2:return function(J){return this.fromWireType(de[J>>2])};case 3:return function(J){return this.fromWireType(ae[J>>3])};default:throw new TypeError("Unknown float type: "+N)}}function Sc(N,U,J){var ce=vn(J);U=Pn(U),Br(N,{name:U,fromWireType:function(he){return he},toWireType:function(he,ye){return ye},argPackAdvance:8,readValueFromPointer:ci(U,ce),destructorFunction:null})}function bl(N,U,J){switch(U){case 0:return J?function(he){return k[he]}:function(he){return L[he]};case 1:return J?function(he){return F[he>>1]}:function(he){return j[he>>1]};case 2:return J?function(he){return Y[he>>2]}:function(he){return ie[he>>2]};default:throw new TypeError("Unknown integer type: "+N)}}function Dl(N,U,J,ce,he){U=Pn(U);var ye=vn(J),xe=_t=>_t;if(ce===0){var be=32-8*J;xe=_t=>_t<<be>>>be}var Ae=U.includes("unsigned"),Qe=(_t,Ct)=>{},at;Ae?at=function(_t,Ct){return Qe(Ct,this.name),Ct>>>0}:at=function(_t,Ct){return Qe(Ct,this.name),Ct},Br(N,{name:U,fromWireType:xe,toWireType:at,argPackAdvance:8,readValueFromPointer:bl(U,ye,ce!==0),destructorFunction:null})}function Tc(N,U,J){var ce=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],he=ce[U];function ye(xe){xe=xe>>2;var be=ie,Ae=be[xe],Qe=be[xe+1];return new he(G,Qe,Ae)}J=Pn(J),Br(N,{name:J,fromWireType:ye,argPackAdvance:8,readValueFromPointer:ye},{ignoreDuplicateRegistrations:!0})}function Aa(N,U){U=Pn(U);var J=U==="std::string";Br(N,{name:U,fromWireType:function(ce){var he=ie[ce>>2],ye=ce+4,xe;if(J)for(var be=ye,Ae=0;Ae<=he;++Ae){var Qe=ye+Ae;if(Ae==he||L[Qe]==0){var at=Qe-be,_t=O(be,at);xe===void 0?xe=_t:(xe+="\0",xe+=_t),be=Qe+1}}else{for(var Ct=new Array(he),Ae=0;Ae<he;++Ae)Ct[Ae]=String.fromCharCode(L[ye+Ae]);xe=Ct.join("")}return dt(ce),xe},toWireType:function(ce,he){he instanceof ArrayBuffer&&(he=new Uint8Array(he));var ye,xe=typeof he=="string";xe||he instanceof Uint8Array||he instanceof Uint8ClampedArray||he instanceof Int8Array||pn("Cannot pass non-string to std::string"),J&&xe?ye=A(he):ye=he.length;var be=et(4+ye+1),Ae=be+4;if(ie[be>>2]=ye,J&&xe)R(he,Ae,ye+1);else if(xe)for(var Qe=0;Qe<ye;++Qe){var at=he.charCodeAt(Qe);at>255&&(dt(Ae),pn("String has UTF-16 code units that do not fit in 8 bits")),L[Ae+Qe]=at}else for(var Qe=0;Qe<ye;++Qe)L[Ae+Qe]=he[Qe];return ce!==null&&ce.push(dt,be),be},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:function(ce){dt(ce)}})}var _c=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ws(N,U){for(var J=N,ce=J>>1,he=ce+U/2;!(ce>=he)&&j[ce];)++ce;if(J=ce<<1,J-N>32&&_c)return _c.decode(L.subarray(N,J));for(var ye="",xe=0;!(xe>=U/2);++xe){var be=F[N+xe*2>>1];if(be==0)break;ye+=String.fromCharCode(be)}return ye}function Il(N,U,J){if(J===void 0&&(J=2147483647),J<2)return 0;J-=2;for(var ce=U,he=J<N.length*2?J/2:N.length,ye=0;ye<he;++ye){var xe=N.charCodeAt(ye);F[U>>1]=xe,U+=2}return F[U>>1]=0,U-ce}function Ml(N){return N.length*2}function Ol(N,U){for(var J=0,ce="";!(J>=U/4);){var he=Y[N+J*4>>2];if(he==0)break;if(++J,he>=65536){var ye=he-65536;ce+=String.fromCharCode(55296|ye>>10,56320|ye&1023)}else ce+=String.fromCharCode(he)}return ce}function Cs(N,U,J){if(J===void 0&&(J=2147483647),J<4)return 0;for(var ce=U,he=ce+J-4,ye=0;ye<N.length;++ye){var xe=N.charCodeAt(ye);if(xe>=55296&&xe<=57343){var be=N.charCodeAt(++ye);xe=65536+((xe&1023)<<10)|be&1023}if(Y[U>>2]=xe,U+=4,U+4>he)break}return Y[U>>2]=0,U-ce}function Pl(N){for(var U=0,J=0;J<N.length;++J){var ce=N.charCodeAt(J);ce>=55296&&ce<=57343&&++J,U+=4}return U}function Rl(N,U,J){J=Pn(J);var ce,he,ye,xe,be;U===2?(ce=ws,he=Il,xe=Ml,ye=()=>j,be=1):U===4&&(ce=Ol,he=Cs,xe=Pl,ye=()=>ie,be=2),Br(N,{name:J,fromWireType:function(Ae){for(var Qe=ie[Ae>>2],at=ye(),_t,Ct=Ae+4,Yt=0;Yt<=Qe;++Yt){var Kt=Ae+4+Yt*U;if(Yt==Qe||at[Kt>>be]==0){var Rn=Kt-Ct,Tr=ce(Ct,Rn);_t===void 0?_t=Tr:(_t+="\0",_t+=Tr),Ct=Kt+U}}return dt(Ae),_t},toWireType:function(Ae,Qe){typeof Qe!="string"&&pn("Cannot pass non-string to C++ string type "+J);var at=xe(Qe),_t=et(4+at+U);return ie[_t>>2]=at>>be,he(Qe,_t+4,at+U),Ae!==null&&Ae.push(dt,_t),_t},argPackAdvance:8,readValueFromPointer:lt,destructorFunction:function(Ae){dt(Ae)}})}function Al(N,U,J,ce,he,ye){Ke[N]={name:Pn(U),rawConstructor:Wr(J,ce),rawDestructor:Wr(he,ye),fields:[]}}function xs(N,U,J,ce,he,ye,xe,be,Ae,Qe){Ke[N].fields.push({fieldName:Pn(U),getterReturnType:J,getter:Wr(ce,he),getterContext:ye,setterArgumentType:xe,setter:Wr(be,Ae),setterContext:Qe})}function Ll(N,U){U=Pn(U),Br(N,{isVoid:!0,name:U,argPackAdvance:0,fromWireType:function(){},toWireType:function(J,ce){}})}function Ec(){throw 1/0}var bc={};function Nl(N){var U=bc[N];return U===void 0?Pn(N):U}function Ss(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function Vl(N){return N===0?Li.toHandle(Ss()):(N=Nl(N),Li.toHandle(Ss()[N]))}function Dc(N){N>4&&(Or[N].refcount+=1)}function Ic(N,U){var J=ke[N];return J===void 0&&pn(U+" has unknown type "+qr(N)),J}function Mc(N){for(var U="",J=0;J<N;++J)U+=(J!==0?", ":"")+"arg"+J;for(var ce=()=>ie,he="return function emval_allocator_"+N+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,J=0;J<N;++J)he+="var argType"+J+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+J+`');
var arg`+J+" = argType"+J+`.readValueFromPointer(args);
args += argType`+J+`['argPackAdvance'];
argTypes += 4;
`;return he+="var obj = new constructor("+U+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",he)(Ic,o,Li.toHandle,ce)}var Oc={};function kl(N,U,J,ce){N=Li.toValue(N);var he=Oc[U];return he||(he=Mc(U),Oc[U]=he),he(N,J,ce)}function Fl(N,U){N=Ic(N,"_emval_take_value");var J=N.readValueFromPointer(U);return Li.toHandle(J)}function Ul(){re("")}function Ts(N,U,J){L.copyWithin(N,U,U+J)}function Bl(){return 2147483648}function Qo(N){try{return _.grow(N-G.byteLength+65535>>>16),fe(_.buffer),1}catch{}}function Gl(N){var U=L.length;N=N>>>0;var J=Bl();if(N>J)return!1;let ce=(Ae,Qe)=>Ae+(Qe-Ae%Qe)%Qe;for(var he=1;he<=4;he*=2){var ye=U*(1+.2/he);ye=Math.min(ye,N+100663296);var xe=Math.min(J,ce(Math.max(N,ye),65536)),be=Qo(xe);if(be)return!0}return!1}var _s={};function Es(){return l||"./this.program"}function Mo(){if(!Mo.strings){var N=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",U={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:N,_:Es()};for(var J in _s)_s[J]===void 0?delete U[J]:U[J]=_s[J];var ce=[];for(var J in U)ce.push(J+"="+U[J]);Mo.strings=ce}return Mo.strings}function Ni(N,U,J){for(var ce=0;ce<N.length;++ce)k[U++>>0]=N.charCodeAt(ce);k[U>>0]=0}function Pc(N,U){var J=0;return Mo().forEach(function(ce,he){var ye=U+J;ie[N+he*4>>2]=ye,Ni(ce,ye),J+=ce.length+1}),0}function Rc(N,U){var J=Mo();ie[N>>2]=J.length;var ce=0;return J.forEach(function(he){ce+=he.length+1}),ie[U>>2]=ce,0}function bs(N){d(N,new gt(N))}function Ac(N,U){bs(N)}var La=Ac;function Ds(N){return 52}function te(N,U,J,ce,he){return 70}var ne=[null,[],[]];function me(N,U){var J=ne[N];U===0||U===10?((N===1?x:S)(I(J,0)),J.length=0):J.push(U)}function Pe(N,U,J,ce){for(var he=0,ye=0;ye<J;ye++){var xe=ie[U>>2],be=ie[U+4>>2];U+=8;for(var Ae=0;Ae<be;Ae++)me(N,L[xe+Ae]);he+=be}return ie[ce>>2]=he,0}function je(N){var U=o["_"+N];return U}function tt(N,U){k.set(N,U)}function qe(N,U,J,ce,he){var ye={string:Kt=>{var Rn=0;if(Kt!=null&&Kt!==0){var Tr=(Kt.length<<2)+1;Rn=ue(Tr),R(Kt,Rn,Tr)}return Rn},array:Kt=>{var Rn=ue(Kt.length);return tt(Kt,Rn),Rn}};function xe(Kt){return U==="string"?O(Kt):U==="boolean"?!!Kt:Kt}var be=je(N),Ae=[],Qe=0;if(ce)for(var at=0;at<ce.length;at++){var _t=ye[J[at]];_t?(Qe===0&&(Qe=X()),Ae[at]=_t(ce[at])):Ae[at]=ce[at]}var Ct=be.apply(null,Ae);function Yt(Kt){return Qe!==0&&q(Qe),xe(Kt)}return Ct=Yt(Ct),Ct}pi=o.InternalError=on(Error,"InternalError"),mi(),Ri=o.BindingError=on(Error,"BindingError"),io(),Cl(),yc(),Cc=o.UnboundTypeError=on(Error,"UnboundTypeError"),Do();var He={g:ze,A:rt,w:Mt,F:vi,u:Ma,t:jn,c:vs,E:El,m:Sc,b:Dl,a:Tc,l:Aa,h:Rl,J:Al,d:xs,G:Ll,x:Ec,i:ys,r:Vl,p:Dc,q:kl,s:Fl,j:Ul,D:Ts,y:Gl,z:Pc,B:Rc,I:La,C:Ds,v:te,k:Pe,o:Ze,n:ot,H:Xe,f:Ve,e:it};st(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.L).apply(null,arguments)};var et=o._malloc=function(){return(et=o._malloc=o.asm.N).apply(null,arguments)},dt=o._free=function(){return(dt=o._free=o.asm.O).apply(null,arguments)},bt=o.___getTypeName=function(){return(bt=o.___getTypeName=o.asm.P).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.Q).apply(null,arguments)};var Rt=o._setThrew=function(){return(Rt=o._setThrew=o.asm.R).apply(null,arguments)},X=o.stackSave=function(){return(X=o.stackSave=o.asm.S).apply(null,arguments)},q=o.stackRestore=function(){return(q=o.stackRestore=o.asm.T).apply(null,arguments)},ue=o.stackAlloc=function(){return(ue=o.stackAlloc=o.asm.U).apply(null,arguments)},Te=o.___cxa_is_pointer_type=function(){return(Te=o.___cxa_is_pointer_type=o.asm.V).apply(null,arguments)};o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.W).apply(null,arguments)};function Ve(N,U){var J=X();try{er(N)(U)}catch(ce){if(q(J),ce!==ce+0)throw ce;Rt(1,0)}}function Ze(N,U){var J=X();try{return er(N)(U)}catch(ce){if(q(J),ce!==ce+0)throw ce;Rt(1,0)}}function it(N,U,J,ce){var he=X();try{er(N)(U,J,ce)}catch(ye){if(q(he),ye!==ye+0)throw ye;Rt(1,0)}}function Xe(N,U,J,ce){var he=X();try{return er(N)(U,J,ce)}catch(ye){if(q(he),ye!==ye+0)throw ye;Rt(1,0)}}function ot(N,U,J){var ce=X();try{return er(N)(U,J)}catch(he){if(q(ce),he!==he+0)throw he;Rt(1,0)}}o.ccall=qe;var z;De=function N(){z||H(),z||(De=N)};function H(N){if(ge>0||(P(),ge>0))return;function U(){z||(z=!0,o.calledRun=!0,!E&&($(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),W()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),U()},1)):U()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return H(),i.ready})})();t.exports=r})(_v)),_v.exports}var bhe=Ehe();const Dhe=wa(bhe),Ihe=new URL("/radiology-ai-viewer/assets/libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url),Cp={codec:void 0,decoder:void 0};function Mhe(){if(Cp.codec)return Promise.resolve();const t=Dhe({locateFile:e=>e.endsWith(".wasm")?Ihe.toString():e});return new Promise((e,r)=>{t.then(n=>{Cp.codec=n,Cp.decoder=new n.JPEGDecoder,e()},r)})}async function Ohe(t,e){await Mhe();const r=Cp.decoder;r.getEncodedBuffer(t.length).set(t),r.decode();const i=r.getFrameInfo(),o=r.getDecodedBuffer(),a={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},s=Phe(i,o),c={frameInfo:i};return{...e,pixelData:s,imageInfo:a,encodeOptions:c,...c,...a}}function Phe(t,e){return t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const Rhe="modulepreload",Ahe=function(t){return"/radiology-ai-viewer/"+t},rE={},hR=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){let c=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");i=c(r.map(l=>{if(l=Ahe(l),l in rE)return;rE[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":Rhe,d||(f.as="script"),f.crossOrigin="",f.href=l,s&&f.setAttribute("nonce",s),document.head.appendChild(f),d)return new Promise((h,g)=>{f.addEventListener("load",h),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})},Df={JpegImage:void 0,decodeConfig:{}};function Lhe(t){return Df.decodeConfig=t,Df.JpegImage?Promise.resolve():new Promise((e,r)=>{hR(()=>import("./jpeg-B-x1txLf.js"),[]).then(n=>{Df.JpegImage=n.default,e()}).catch(r)})}async function Nhe(t,e){if(await Lhe(),typeof Df.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const r=new Df.JpegImage;if(r.parse(e),r.colorTransform=!1,t.bitsAllocated===8)return t.pixelData=r.getData(t.columns,t.rows),t;if(t.bitsAllocated===16)return t.pixelData=r.getData16(t.columns,t.rows),t}const If={DecoderClass:void 0,decodeConfig:{}};function Vhe(t){return If.decodeConfig=t,If.DecoderClass?Promise.resolve():new Promise((e,r)=>{hR(async()=>{const{Decoder:n}=await import("./lossless-CyYqoyFe.js");return{Decoder:n}},[]).then(({Decoder:n})=>{If.DecoderClass=n,e()},r)})}async function iE(t,e){if(await Vhe(),typeof If.DecoderClass>"u")throw new Error("No JPEG Lossless decoder loaded");const r=new If.DecoderClass,n=t.bitsAllocated<=8?1:2,i=e.buffer,o=r.decode(i,e.byteOffset,e.length,n);return t.pixelRepresentation===0?t.bitsAllocated===16?(t.pixelData=new Uint16Array(o.buffer),t):(t.pixelData=new Uint8Array(o.buffer),t):(t.pixelData=new Int16Array(o.buffer),t)}var Ev={exports:{}},oE;function khe(){return oE||(oE=1,(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(te,ne){a=te,s=ne});var c=Object.assign({},o),l=typeof window=="object",d=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",f="";function h(te){return o.locateFile?o.locateFile(te,f):f+te}var g,p,v;if(u){var w=Zs,m=Zs;d?f=m.dirname(f)+"/":f=__dirname+"/",g=(te,ne)=>(te=re(te)?new URL(te):m.normalize(te),w.readFileSync(te,ne?void 0:"utf8")),v=te=>{var ne=g(te,!0);return ne.buffer||(ne=new Uint8Array(ne)),ne},p=(te,ne,me)=>{te=re(te)?new URL(te):m.normalize(te),w.readFile(te,function(Pe,je){Pe?me(Pe):ne(je.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(te){if(!(te instanceof We))throw te}),process.on("unhandledRejection",function(te){throw te}),o.inspect=function(){return"[Emscripten Module object]"}}else(l||d)&&(d?f=self.location.href:typeof document<"u"&&document.currentScript&&(f=document.currentScript.src),n&&(f=n),f.indexOf("blob:")!==0?f=f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):f="",g=te=>{var ne=new XMLHttpRequest;return ne.open("GET",te,!1),ne.send(null),ne.responseText},d&&(v=te=>{var ne=new XMLHttpRequest;return ne.open("GET",te,!1),ne.responseType="arraybuffer",ne.send(null),new Uint8Array(ne.response)}),p=(te,ne,me)=>{var Pe=new XMLHttpRequest;Pe.open("GET",te,!0),Pe.responseType="arraybuffer",Pe.onload=()=>{if(Pe.status==200||Pe.status==0&&Pe.response){ne(Pe.response);return}me()},Pe.onerror=me,Pe.send(null)});o.print||console.log.bind(console);var y=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit;var C;o.wasmBinary&&(C=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&De("no native wasm support detected");var x,S=!1;function T(te,ne){te||De(ne)}var _=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function E(te,ne,me){for(var Pe=ne+me,je=ne;te[je]&&!(je>=Pe);)++je;if(je-ne>16&&te.buffer&&_)return _.decode(te.subarray(ne,je));for(var tt="";ne<je;){var qe=te[ne++];if(!(qe&128)){tt+=String.fromCharCode(qe);continue}var He=te[ne++]&63;if((qe&224)==192){tt+=String.fromCharCode((qe&31)<<6|He);continue}var et=te[ne++]&63;if((qe&240)==224?qe=(qe&15)<<12|He<<6|et:qe=(qe&7)<<18|He<<12|et<<6|te[ne++]&63,qe<65536)tt+=String.fromCharCode(qe);else{var dt=qe-65536;tt+=String.fromCharCode(55296|dt>>10,56320|dt&1023)}}return tt}function D(te,ne){return te?E(A,te,ne):""}function b(te,ne,me,Pe){if(!(Pe>0))return 0;for(var je=me,tt=me+Pe-1,qe=0;qe<te.length;++qe){var He=te.charCodeAt(qe);if(He>=55296&&He<=57343){var et=te.charCodeAt(++qe);He=65536+((He&1023)<<10)|et&1023}if(He<=127){if(me>=tt)break;ne[me++]=He}else if(He<=2047){if(me+1>=tt)break;ne[me++]=192|He>>6,ne[me++]=128|He&63}else if(He<=65535){if(me+2>=tt)break;ne[me++]=224|He>>12,ne[me++]=128|He>>6&63,ne[me++]=128|He&63}else{if(me+3>=tt)break;ne[me++]=240|He>>18,ne[me++]=128|He>>12&63,ne[me++]=128|He>>6&63,ne[me++]=128|He&63}}return ne[me]=0,me-je}function I(te,ne,me){return b(te,A,ne,me)}function O(te){for(var ne=0,me=0;me<te.length;++me){var Pe=te.charCodeAt(me);Pe<=127?ne++:Pe<=2047?ne+=2:Pe>=55296&&Pe<=57343?(ne+=4,++me):ne+=3}return ne}var M,R,A,G,k,L,F,j,Y;function ie(te){M=te,o.HEAP8=R=new Int8Array(te),o.HEAP16=G=new Int16Array(te),o.HEAP32=L=new Int32Array(te),o.HEAPU8=A=new Uint8Array(te),o.HEAPU16=k=new Uint16Array(te),o.HEAPU32=F=new Uint32Array(te),o.HEAPF32=j=new Float32Array(te),o.HEAPF64=Y=new Float64Array(te)}o.INITIAL_MEMORY;var de,ae=[],fe=[],we=[];function _e(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)P(o.preRun.shift());oe(ae)}function Se(){oe(fe)}function B(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)W(o.postRun.shift());oe(we)}function P(te){ae.unshift(te)}function $(te){fe.unshift(te)}function W(te){we.unshift(te)}var K=0,Q=null;function ee(te){K++,o.monitorRunDependencies&&o.monitorRunDependencies(K)}function ge(te){if(K--,o.monitorRunDependencies&&o.monitorRunDependencies(K),K==0&&Q){var ne=Q;Q=null,ne()}}function De(te){o.onAbort&&o.onAbort(te),te="Aborted("+te+")",y(te),S=!0,te+=". Build with -sASSERTIONS for more info.";var ne=new WebAssembly.RuntimeError(te);throw s(ne),ne}var Le="data:application/octet-stream;base64,";function Ge(te){return te.startsWith(Le)}function re(te){return te.startsWith("file://")}var se;se="charlswasm_decode.wasm",Ge(se)||(se=h(se));function ve(te){try{if(te==se&&C)return new Uint8Array(C);if(v)return v(te);throw"both async and sync fetching of the wasm failed"}catch(ne){De(ne)}}function le(){if(!C&&(l||d)){if(typeof fetch=="function"&&!re(se))return fetch(se,{credentials:"same-origin"}).then(function(te){if(!te.ok)throw"failed to load wasm binary file at '"+se+"'";return te.arrayBuffer()}).catch(function(){return ve(se)});if(p)return new Promise(function(te,ne){p(se,function(me){te(new Uint8Array(me))},ne)})}return Promise.resolve().then(function(){return ve(se)})}function pe(){var te={a:_s};function ne(qe,He){var et=qe.exports;o.asm=et,x=o.asm.z,ie(x.buffer),de=o.asm.C,$(o.asm.A),ge()}ee();function me(qe){ne(qe.instance)}function Pe(qe){return le().then(function(He){return WebAssembly.instantiate(He,te)}).then(function(He){return He}).then(qe,function(He){y("failed to asynchronously prepare wasm: "+He),De(He)})}function je(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!Ge(se)&&!re(se)&&!u&&typeof fetch=="function"?fetch(se,{credentials:"same-origin"}).then(function(qe){var He=WebAssembly.instantiateStreaming(qe,te);return He.then(me,function(et){return y("wasm streaming compile failed: "+et),y("falling back to ArrayBuffer instantiation"),Pe(me)})}):Pe(me)}if(o.instantiateWasm)try{var tt=o.instantiateWasm(te,ne);return tt}catch(qe){y("Module.instantiateWasm callback failed with error: "+qe),s(qe)}return je().catch(s),{}}function We(te){this.name="ExitStatus",this.message="Program terminated with exit("+te+")",this.status=te}function oe(te){for(;te.length>0;)te.shift()(o)}function st(te){this.excPtr=te,this.ptr=te-24,this.set_type=function(ne){F[this.ptr+4>>2]=ne},this.get_type=function(){return F[this.ptr+4>>2]},this.set_destructor=function(ne){F[this.ptr+8>>2]=ne},this.get_destructor=function(){return F[this.ptr+8>>2]},this.set_refcount=function(ne){L[this.ptr>>2]=ne},this.set_caught=function(ne){ne=ne?1:0,R[this.ptr+12>>0]=ne},this.get_caught=function(){return R[this.ptr+12>>0]!=0},this.set_rethrown=function(ne){ne=ne?1:0,R[this.ptr+13>>0]=ne},this.get_rethrown=function(){return R[this.ptr+13>>0]!=0},this.init=function(ne,me){this.set_adjusted_ptr(0),this.set_type(ne),this.set_destructor(me),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var ne=L[this.ptr>>2];L[this.ptr>>2]=ne+1},this.release_ref=function(){var ne=L[this.ptr>>2];return L[this.ptr>>2]=ne-1,ne===1},this.set_adjusted_ptr=function(ne){F[this.ptr+16>>2]=ne},this.get_adjusted_ptr=function(){return F[this.ptr+16>>2]},this.get_exception_ptr=function(){var ne=Ac(this.get_type());if(ne)return F[this.excPtr>>2];var me=this.get_adjusted_ptr();return me!==0?me:this.excPtr}}function gt(te,ne,me){var Pe=new st(te);throw Pe.init(ne,me),te}var ct={};function Ee(te){for(;te.length;){var ne=te.pop(),me=te.pop();me(ne)}}function ze(te){return this.fromWireType(L[te>>2])}var Ke={},Je={},lt={},Oe=48,ke=57;function nt(te){if(te===void 0)return"_unknown";te=te.replace(/[^a-zA-Z0-9_]/g,"$");var ne=te.charCodeAt(0);return ne>=Oe&&ne<=ke?"_"+te:te}function wt(te,ne){return te=nt(te),new Function("body","return function "+te+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(ne)}function gn(te,ne){var me=wt(ne,function(Pe){this.name=ne,this.message=Pe;var je=new Error(Pe).stack;je!==void 0&&(this.stack=this.toString()+`
`+je.replace(/^Error(:[^\n]*)?\n/,""))});return me.prototype=Object.create(te.prototype),me.prototype.constructor=me,me.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},me}var Sn=void 0;function ln(te){throw new Sn(te)}function on(te,ne,me){te.forEach(function(He){lt[He]=ne});function Pe(He){var et=me(He);et.length!==te.length&&ln("Mismatched type converter count");for(var dt=0;dt<te.length;++dt)Pn(te[dt],et[dt])}var je=new Array(ne.length),tt=[],qe=0;ne.forEach((He,et)=>{Je.hasOwnProperty(He)?je[et]=Je[He]:(tt.push(He),Ke.hasOwnProperty(He)||(Ke[He]=[]),Ke[He].push(()=>{je[et]=Je[He],++qe,qe===tt.length&&Pe(je)}))}),tt.length===0&&Pe(je)}function pi(te){var ne=ct[te];delete ct[te];var me=ne.rawConstructor,Pe=ne.rawDestructor,je=ne.fields,tt=je.map(qe=>qe.getterReturnType).concat(je.map(qe=>qe.setterArgumentType));on([te],tt,qe=>{var He={};return je.forEach((et,dt)=>{var bt=et.fieldName,Rt=qe[dt],X=et.getter,q=et.getterContext,ue=qe[dt+je.length],Te=et.setter,Ve=et.setterContext;He[bt]={read:Ze=>Rt.fromWireType(X(q,Ze)),write:(Ze,it)=>{var Xe=[];Te(Ve,Ze,ue.toWireType(Xe,it)),Ee(Xe)}}}),[{name:ne.name,fromWireType:function(et){var dt={};for(var bt in He)dt[bt]=He[bt].read(et);return Pe(et),dt},toWireType:function(et,dt){for(var bt in He)if(!(bt in dt))throw new TypeError('Missing field:  "'+bt+'"');var Rt=me();for(bt in He)He[bt].write(Rt,dt[bt]);return et!==null&&et.push(Pe,Rt),Rt},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:Pe}]})}function Xt(te,ne,me,Pe,je){}function Be(te){switch(te){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+te)}}function rt(){for(var te=new Array(256),ne=0;ne<256;++ne)te[ne]=String.fromCharCode(ne);Mt=te}var Mt=void 0;function vn(te){for(var ne="",me=te;A[me];)ne+=Mt[A[me++]];return ne}var mi=void 0;function nn(te){throw new mi(te)}function Pn(te,ne,me={}){if(!("argPackAdvance"in ne))throw new TypeError("registerType registeredInstance requires argPackAdvance");var Pe=ne.name;if(te||nn('type "'+Pe+'" must have a positive integer typeid pointer'),Je.hasOwnProperty(te)){if(me.ignoreDuplicateRegistrations)return;nn("Cannot register type '"+Pe+"' twice")}if(Je[te]=ne,delete lt[te],Ke.hasOwnProperty(te)){var je=Ke[te];delete Ke[te],je.forEach(tt=>tt())}}function Ri(te,ne,me,Pe,je){var tt=Be(me);ne=vn(ne),Pn(te,{name:ne,fromWireType:function(qe){return!!qe},toWireType:function(qe,He){return He?Pe:je},argPackAdvance:8,readValueFromPointer:function(qe){var He;if(me===1)He=R;else if(me===2)He=G;else if(me===4)He=L;else throw new TypeError("Unknown boolean type size: "+ne);return this.fromWireType(He[qe>>tt])},destructorFunction:null})}function pn(te){if(!(this instanceof oi)||!(te instanceof oi))return!1;for(var ne=this.$$.ptrType.registeredClass,me=this.$$.ptr,Pe=te.$$.ptrType.registeredClass,je=te.$$.ptr;ne.baseClass;)me=ne.upcast(me),ne=ne.baseClass;for(;Pe.baseClass;)je=Pe.upcast(je),Pe=Pe.baseClass;return ne===Pe&&me===je}function Br(te){return{count:te.count,deleteScheduled:te.deleteScheduled,preservePointerOnDelete:te.preservePointerOnDelete,ptr:te.ptr,ptrType:te.ptrType,smartPtr:te.smartPtr,smartPtrType:te.smartPtrType}}function vi(te){function ne(me){return me.$$.ptrType.registeredClass.name}nn(ne(te)+" instance already deleted")}var Ta=!1;function hc(te){}function qo(te){te.smartPtr?te.smartPtrType.rawDestructor(te.smartPtr):te.ptrType.registeredClass.rawDestructor(te.ptr)}function _a(te){te.count.value-=1;var ne=te.count.value===0;ne&&qo(te)}function no(te,ne,me){if(ne===me)return te;if(me.baseClass===void 0)return null;var Pe=no(te,ne,me.baseClass);return Pe===null?null:me.downcast(Pe)}var mr={};function ni(){return Object.keys(ri).length}function mn(){var te=[];for(var ne in ri)ri.hasOwnProperty(ne)&&te.push(ri[ne]);return te}var sr=[];function ro(){for(;sr.length;){var te=sr.pop();te.$$.deleteScheduled=!1,te.delete()}}var Eo=void 0;function Yo(te){Eo=te,sr.length&&Eo&&Eo(ro)}function Jo(){o.getInheritedInstanceCount=ni,o.getLiveInheritedInstances=mn,o.flushPendingDeletes=ro,o.setDelayFunction=Yo}var ri={};function gc(te,ne){for(ne===void 0&&nn("ptr should not be undefined");te.baseClass;)ne=te.upcast(ne),te=te.baseClass;return ne}function Cl(te,ne){return ne=gc(te,ne),ri[ne]}function ii(te,ne){(!ne.ptrType||!ne.ptr)&&ln("makeClassHandle requires ptr and ptrType");var me=!!ne.smartPtrType,Pe=!!ne.smartPtr;return me!==Pe&&ln("Both smartPtrType and smartPtr must be specified"),ne.count={value:1},bo(Object.create(te,{$$:{value:ne}}))}function pc(te){var ne=this.getPointee(te);if(!ne)return this.destructor(te),null;var me=Cl(this.registeredClass,ne);if(me!==void 0){if(me.$$.count.value===0)return me.$$.ptr=ne,me.$$.smartPtr=te,me.clone();var Pe=me.clone();return this.destructor(te),Pe}function je(){return this.isSmartPointer?ii(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:ne,smartPtrType:this,smartPtr:te}):ii(this.registeredClass.instancePrototype,{ptrType:this,ptr:te})}var tt=this.registeredClass.getActualType(ne),qe=mr[tt];if(!qe)return je.call(this);var He;this.isConst?He=qe.constPointerType:He=qe.pointerType;var et=no(ne,this.registeredClass,He.registeredClass);return et===null?je.call(this):this.isSmartPointer?ii(He.registeredClass.instancePrototype,{ptrType:He,ptr:et,smartPtrType:this,smartPtr:te}):ii(He.registeredClass.instancePrototype,{ptrType:He,ptr:et})}function bo(te){return typeof FinalizationRegistry>"u"?(bo=ne=>ne,te):(Ta=new FinalizationRegistry(ne=>{_a(ne.$$)}),bo=ne=>{var me=ne.$$,Pe=!!me.smartPtr;if(Pe){var je={$$:me};Ta.register(ne,je,ne)}return ne},hc=ne=>Ta.unregister(ne),bo(te))}function Ea(){if(this.$$.ptr||vi(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var te=bo(Object.create(Object.getPrototypeOf(this),{$$:{value:Br(this.$$)}}));return te.$$.count.value+=1,te.$$.deleteScheduled=!1,te}function xl(){this.$$.ptr||vi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&nn("Object already scheduled for deletion"),hc(this),_a(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Kr(){return!this.$$.ptr}function hs(){return this.$$.ptr||vi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&nn("Object already scheduled for deletion"),sr.push(this),sr.length===1&&Eo&&Eo(ro),this.$$.deleteScheduled=!0,this}function Zo(){oi.prototype.isAliasOf=pn,oi.prototype.clone=Ea,oi.prototype.delete=xl,oi.prototype.isDeleted=Kr,oi.prototype.deleteLater=hs}function oi(){}function gs(te,ne,me){if(te[ne].overloadTable===void 0){var Pe=te[ne];te[ne]=function(){return te[ne].overloadTable.hasOwnProperty(arguments.length)||nn("Function '"+me+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+te[ne].overloadTable+")!"),te[ne].overloadTable[arguments.length].apply(this,arguments)},te[ne].overloadTable=[],te[ne].overloadTable[Pe.argCount]=Pe}}function io(te,ne,me){o.hasOwnProperty(te)?((me===void 0||o[te].overloadTable!==void 0&&o[te].overloadTable[me]!==void 0)&&nn("Cannot register public name '"+te+"' twice"),gs(o,te,te),o.hasOwnProperty(me)&&nn("Cannot register multiple overloads of a function with the same number of arguments ("+me+")!"),o[te].overloadTable[me]=ne):(o[te]=ne,me!==void 0&&(o[te].numArguments=me))}function Hi(te,ne,me,Pe,je,tt,qe,He){this.name=te,this.constructor=ne,this.instancePrototype=me,this.rawDestructor=Pe,this.baseClass=je,this.getActualType=tt,this.upcast=qe,this.downcast=He,this.pureVirtualFunctions=[]}function ba(te,ne,me){for(;ne!==me;)ne.upcast||nn("Expected null or instance of "+me.name+", got an instance of "+ne.name),te=ne.upcast(te),ne=ne.baseClass;return te}function Gr(te,ne){if(ne===null)return this.isReference&&nn("null is not a valid "+this.name),0;ne.$$||nn('Cannot pass "'+Do(ne)+'" as a '+this.name),ne.$$.ptr||nn("Cannot pass deleted object as a pointer of type "+this.name);var me=ne.$$.ptrType.registeredClass,Pe=ba(ne.$$.ptr,me,this.registeredClass);return Pe}function Sl(te,ne){var me;if(ne===null)return this.isReference&&nn("null is not a valid "+this.name),this.isSmartPointer?(me=this.rawConstructor(),te!==null&&te.push(this.rawDestructor,me),me):0;ne.$$||nn('Cannot pass "'+Do(ne)+'" as a '+this.name),ne.$$.ptr||nn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&ne.$$.ptrType.isConst&&nn("Cannot convert argument of type "+(ne.$$.smartPtrType?ne.$$.smartPtrType.name:ne.$$.ptrType.name)+" to parameter type "+this.name);var Pe=ne.$$.ptrType.registeredClass;if(me=ba(ne.$$.ptr,Pe,this.registeredClass),this.isSmartPointer)switch(ne.$$.smartPtr===void 0&&nn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:ne.$$.smartPtrType===this?me=ne.$$.smartPtr:nn("Cannot convert argument of type "+(ne.$$.smartPtrType?ne.$$.smartPtrType.name:ne.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:me=ne.$$.smartPtr;break;case 2:if(ne.$$.smartPtrType===this)me=ne.$$.smartPtr;else{var je=ne.clone();me=this.rawShare(me,si.toHandle(function(){je.delete()})),te!==null&&te.push(this.rawDestructor,me)}break;default:nn("Unsupporting sharing policy")}return me}function Xi(te,ne){if(ne===null)return this.isReference&&nn("null is not a valid "+this.name),0;ne.$$||nn('Cannot pass "'+Do(ne)+'" as a '+this.name),ne.$$.ptr||nn("Cannot pass deleted object as a pointer of type "+this.name),ne.$$.ptrType.isConst&&nn("Cannot convert argument of type "+ne.$$.ptrType.name+" to parameter type "+this.name);var me=ne.$$.ptrType.registeredClass,Pe=ba(ne.$$.ptr,me,this.registeredClass);return Pe}function mc(te){return this.rawGetPointee&&(te=this.rawGetPointee(te)),te}function ps(te){this.rawDestructor&&this.rawDestructor(te)}function Tl(te){te!==null&&te.delete()}function vc(){yi.prototype.getPointee=mc,yi.prototype.destructor=ps,yi.prototype.argPackAdvance=8,yi.prototype.readValueFromPointer=ze,yi.prototype.deleteObject=Tl,yi.prototype.fromWireType=pc}function yi(te,ne,me,Pe,je,tt,qe,He,et,dt,bt){this.name=te,this.registeredClass=ne,this.isReference=me,this.isConst=Pe,this.isSmartPointer=je,this.pointeeType=tt,this.sharingPolicy=qe,this.rawGetPointee=He,this.rawConstructor=et,this.rawShare=dt,this.rawDestructor=bt,!je&&ne.baseClass===void 0?Pe?(this.toWireType=Gr,this.destructorFunction=null):(this.toWireType=Xi,this.destructorFunction=null):this.toWireType=Sl}function wi(te,ne,me){o.hasOwnProperty(te)||ln("Replacing nonexistant public symbol"),o[te].overloadTable!==void 0&&me!==void 0?o[te].overloadTable[me]=ne:(o[te]=ne,o[te].argCount=me)}function yc(te,ne,me){var Pe=o["dynCall_"+te];return me&&me.length?Pe.apply(null,[ne].concat(me)):Pe.call(null,ne)}var Mr=[];function wc(te){var ne=Mr[te];return ne||(te>=Mr.length&&(Mr.length=te+1),Mr[te]=ne=de.get(te)),ne}function ms(te,ne,me){if(te.includes("j"))return yc(te,ne,me);var Pe=wc(ne).apply(null,me);return Pe}function Da(te,ne){var me=[];return function(){return me.length=0,Object.assign(me,arguments),ms(te,ne,me)}}function er(te,ne){te=vn(te);function me(){return te.includes("j")?Da(te,ne):wc(ne)}var Pe=me();return typeof Pe!="function"&&nn("unknown function pointer with signature "+te+": "+ne),Pe}var Ai=void 0;function Ia(te){var ne=Mo(te),me=vn(ne);return Ni(ne),me}function Wr(te,ne){var me=[],Pe={};function je(tt){if(!Pe[tt]&&!Je[tt]){if(lt[tt]){lt[tt].forEach(je);return}me.push(tt),Pe[tt]=!0}}throw ne.forEach(je),new Ai(te+": "+me.map(Ia).join([", "]))}function Cc(te,ne,me,Pe,je,tt,qe,He,et,dt,bt,Rt,X){bt=vn(bt),tt=er(je,tt),He&&(He=er(qe,He)),dt&&(dt=er(et,dt)),X=er(Rt,X);var q=nt(bt);io(q,function(){Wr("Cannot construct "+bt+" due to unbound types",[Pe])}),on([te,ne,me],Pe?[Pe]:[],function(ue){ue=ue[0];var Te,Ve;Pe?(Te=ue.registeredClass,Ve=Te.instancePrototype):Ve=oi.prototype;var Ze=wt(q,function(){if(Object.getPrototypeOf(this)!==it)throw new mi("Use 'new' to construct "+bt);if(Xe.constructor_body===void 0)throw new mi(bt+" has no accessible constructor");var N=Xe.constructor_body[arguments.length];if(N===void 0)throw new mi("Tried to invoke ctor of "+bt+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Xe.constructor_body).toString()+") parameters instead!");return N.apply(this,arguments)}),it=Object.create(Ve,{constructor:{value:Ze}});Ze.prototype=it;var Xe=new Hi(bt,Ze,it,X,Te,tt,He,dt),ot=new yi(bt,Xe,!0,!1,!1),z=new yi(bt+"*",Xe,!1,!1,!1),H=new yi(bt+" const*",Xe,!1,!0,!1);return mr[te]={pointerType:z,constPointerType:H},wi(q,Ze),[ot,z,H]})}function qr(te,ne){for(var me=[],Pe=0;Pe<te;Pe++)me.push(F[ne+Pe*4>>2]);return me}function ai(te,ne){if(!(te instanceof Function))throw new TypeError("new_ called with constructor type "+typeof te+" which is not a function");var me=wt(te.name||"unknownFunctionName",function(){});me.prototype=te.prototype;var Pe=new me,je=te.apply(Pe,ne);return je instanceof Object?je:Pe}function Ma(te,ne,me,Pe,je){var tt=ne.length;tt<2&&nn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var qe=ne[1]!==null&&me!==null,He=!1,et=1;et<ne.length;++et)if(ne[et]!==null&&ne[et].destructorFunction===void 0){He=!0;break}for(var dt=ne[0].name!=="void",bt="",Rt="",et=0;et<tt-2;++et)bt+=(et!==0?", ":"")+"arg"+et,Rt+=(et!==0?", ":"")+"arg"+et+"Wired";var X="return function "+nt(te)+"("+bt+`) {
if (arguments.length !== `+(tt-2)+`) {
throwBindingError('function `+te+" called with ' + arguments.length + ' arguments, expected "+(tt-2)+` args!');
}
`;He&&(X+=`var destructors = [];
`);var q=He?"destructors":"null",ue=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Te=[nn,Pe,je,Ee,ne[0],ne[1]];qe&&(X+="var thisWired = classParam.toWireType("+q+`, this);
`);for(var et=0;et<tt-2;++et)X+="var arg"+et+"Wired = argType"+et+".toWireType("+q+", arg"+et+"); // "+ne[et+2].name+`
`,ue.push("argType"+et),Te.push(ne[et+2]);if(qe&&(Rt="thisWired"+(Rt.length>0?", ":"")+Rt),X+=(dt?"var rv = ":"")+"invoker(fn"+(Rt.length>0?", ":"")+Rt+`);
`,He)X+=`runDestructors(destructors);
`;else for(var et=qe?1:2;et<ne.length;++et){var Ve=et===1?"thisWired":"arg"+(et-2)+"Wired";ne[et].destructorFunction!==null&&(X+=Ve+"_dtor("+Ve+"); // "+ne[et].name+`
`,ue.push(Ve+"_dtor"),Te.push(ne[et].destructorFunction))}dt&&(X+=`var ret = retType.fromWireType(rv);
return ret;
`),X+=`}
`,ue.push(X);var Ze=ai(Function,ue).apply(null,Te);return Ze}function Oa(te,ne,me,Pe,je,tt){T(ne>0);var qe=qr(ne,me);je=er(Pe,je),on([],[te],function(He){He=He[0];var et="constructor "+He.name;if(He.registeredClass.constructor_body===void 0&&(He.registeredClass.constructor_body=[]),He.registeredClass.constructor_body[ne-1]!==void 0)throw new mi("Cannot register multiple constructors with identical number of parameters ("+(ne-1)+") for class '"+He.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return He.registeredClass.constructor_body[ne-1]=()=>{Wr("Cannot construct "+He.name+" due to unbound types",qe)},on([],qe,function(dt){return dt.splice(1,0,null),He.registeredClass.constructor_body[ne-1]=Ma(et,dt,null,je,tt),[]}),[]})}function _l(te,ne,me,Pe,je,tt,qe,He){var et=qr(me,Pe);ne=vn(ne),tt=er(je,tt),on([],[te],function(dt){dt=dt[0];var bt=dt.name+"."+ne;ne.startsWith("@@")&&(ne=Symbol[ne.substring(2)]),He&&dt.registeredClass.pureVirtualFunctions.push(ne);function Rt(){Wr("Cannot call "+bt+" due to unbound types",et)}var X=dt.registeredClass.instancePrototype,q=X[ne];return q===void 0||q.overloadTable===void 0&&q.className!==dt.name&&q.argCount===me-2?(Rt.argCount=me-2,Rt.className=dt.name,X[ne]=Rt):(gs(X,ne,bt),X[ne].overloadTable[me-2]=Rt),on([],et,function(ue){var Te=Ma(bt,ue,dt,tt,qe);return X[ne].overloadTable===void 0?(Te.argCount=me-2,X[ne]=Te):X[ne].overloadTable[me-2]=Te,[]}),[]})}var Pa=[],jn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function vs(te){te>4&&--jn[te].refcount===0&&(jn[te]=void 0,Pa.push(te))}function Ra(){for(var te=0,ne=5;ne<jn.length;++ne)jn[ne]!==void 0&&++te;return te}function Or(){for(var te=5;te<jn.length;++te)if(jn[te]!==void 0)return jn[te];return null}function ys(){o.count_emval_handles=Ra,o.get_first_emval=Or}var si={toValue:te=>(te||nn("Cannot use deleted val. handle = "+te),jn[te].value),toHandle:te=>{switch(te){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var ne=Pa.length?Pa.pop():jn.length;return jn[ne]={refcount:1,value:te},ne}}}};function xc(te,ne){ne=vn(ne),Pn(te,{name:ne,fromWireType:function(me){var Pe=si.toValue(me);return vs(me),Pe},toWireType:function(me,Pe){return si.toHandle(Pe)},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:null})}function Do(te){if(te===null)return"null";var ne=typeof te;return ne==="object"||ne==="array"||ne==="function"?te.toString():""+te}function Li(te,ne){switch(ne){case 2:return function(me){return this.fromWireType(j[me>>2])};case 3:return function(me){return this.fromWireType(Y[me>>3])};default:throw new TypeError("Unknown float type: "+te)}}function El(te,ne,me){var Pe=Be(me);ne=vn(ne),Pn(te,{name:ne,fromWireType:function(je){return je},toWireType:function(je,tt){return tt},argPackAdvance:8,readValueFromPointer:Li(ne,Pe),destructorFunction:null})}function Io(te,ne,me,Pe,je,tt){var qe=qr(ne,me);te=vn(te),je=er(Pe,je),io(te,function(){Wr("Cannot call "+te+" due to unbound types",qe)},ne-1),on([],qe,function(He){var et=[He[0],null].concat(He.slice(1));return wi(te,Ma(te,et,null,je,tt),ne-1),[]})}function ci(te,ne,me){switch(ne){case 0:return me?function(je){return R[je]}:function(je){return A[je]};case 1:return me?function(je){return G[je>>1]}:function(je){return k[je>>1]};case 2:return me?function(je){return L[je>>2]}:function(je){return F[je>>2]};default:throw new TypeError("Unknown integer type: "+te)}}function Sc(te,ne,me,Pe,je){ne=vn(ne);var tt=Be(me),qe=Rt=>Rt;if(Pe===0){var He=32-8*me;qe=Rt=>Rt<<He>>>He}var et=ne.includes("unsigned"),dt=(Rt,X)=>{},bt;et?bt=function(Rt,X){return dt(X,this.name),X>>>0}:bt=function(Rt,X){return dt(X,this.name),X},Pn(te,{name:ne,fromWireType:qe,toWireType:bt,argPackAdvance:8,readValueFromPointer:ci(ne,tt,Pe!==0),destructorFunction:null})}function bl(te,ne,me){var Pe=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],je=Pe[ne];function tt(qe){qe=qe>>2;var He=F,et=He[qe],dt=He[qe+1];return new je(M,dt,et)}me=vn(me),Pn(te,{name:me,fromWireType:tt,argPackAdvance:8,readValueFromPointer:tt},{ignoreDuplicateRegistrations:!0})}function Dl(te,ne){ne=vn(ne);var me=ne==="std::string";Pn(te,{name:ne,fromWireType:function(Pe){var je=F[Pe>>2],tt=Pe+4,qe;if(me)for(var He=tt,et=0;et<=je;++et){var dt=tt+et;if(et==je||A[dt]==0){var bt=dt-He,Rt=D(He,bt);qe===void 0?qe=Rt:(qe+="\0",qe+=Rt),He=dt+1}}else{for(var X=new Array(je),et=0;et<je;++et)X[et]=String.fromCharCode(A[tt+et]);qe=X.join("")}return Ni(Pe),qe},toWireType:function(Pe,je){je instanceof ArrayBuffer&&(je=new Uint8Array(je));var tt,qe=typeof je=="string";qe||je instanceof Uint8Array||je instanceof Uint8ClampedArray||je instanceof Int8Array||nn("Cannot pass non-string to std::string"),me&&qe?tt=O(je):tt=je.length;var He=Es(4+tt+1),et=He+4;if(F[He>>2]=tt,me&&qe)I(je,et,tt+1);else if(qe)for(var dt=0;dt<tt;++dt){var bt=je.charCodeAt(dt);bt>255&&(Ni(et),nn("String has UTF-16 code units that do not fit in 8 bits")),A[et+dt]=bt}else for(var dt=0;dt<tt;++dt)A[et+dt]=je[dt];return Pe!==null&&Pe.push(Ni,He),He},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:function(Pe){Ni(Pe)}})}var Tc=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Aa(te,ne){for(var me=te,Pe=me>>1,je=Pe+ne/2;!(Pe>=je)&&k[Pe];)++Pe;if(me=Pe<<1,me-te>32&&Tc)return Tc.decode(A.subarray(te,me));for(var tt="",qe=0;!(qe>=ne/2);++qe){var He=G[te+qe*2>>1];if(He==0)break;tt+=String.fromCharCode(He)}return tt}function _c(te,ne,me){if(me===void 0&&(me=2147483647),me<2)return 0;me-=2;for(var Pe=ne,je=me<te.length*2?me/2:te.length,tt=0;tt<je;++tt){var qe=te.charCodeAt(tt);G[ne>>1]=qe,ne+=2}return G[ne>>1]=0,ne-Pe}function ws(te){return te.length*2}function Il(te,ne){for(var me=0,Pe="";!(me>=ne/4);){var je=L[te+me*4>>2];if(je==0)break;if(++me,je>=65536){var tt=je-65536;Pe+=String.fromCharCode(55296|tt>>10,56320|tt&1023)}else Pe+=String.fromCharCode(je)}return Pe}function Ml(te,ne,me){if(me===void 0&&(me=2147483647),me<4)return 0;for(var Pe=ne,je=Pe+me-4,tt=0;tt<te.length;++tt){var qe=te.charCodeAt(tt);if(qe>=55296&&qe<=57343){var He=te.charCodeAt(++tt);qe=65536+((qe&1023)<<10)|He&1023}if(L[ne>>2]=qe,ne+=4,ne+4>je)break}return L[ne>>2]=0,ne-Pe}function Ol(te){for(var ne=0,me=0;me<te.length;++me){var Pe=te.charCodeAt(me);Pe>=55296&&Pe<=57343&&++me,ne+=4}return ne}function Cs(te,ne,me){me=vn(me);var Pe,je,tt,qe,He;ne===2?(Pe=Aa,je=_c,qe=ws,tt=()=>k,He=1):ne===4&&(Pe=Il,je=Ml,qe=Ol,tt=()=>F,He=2),Pn(te,{name:me,fromWireType:function(et){for(var dt=F[et>>2],bt=tt(),Rt,X=et+4,q=0;q<=dt;++q){var ue=et+4+q*ne;if(q==dt||bt[ue>>He]==0){var Te=ue-X,Ve=Pe(X,Te);Rt===void 0?Rt=Ve:(Rt+="\0",Rt+=Ve),X=ue+ne}}return Ni(et),Rt},toWireType:function(et,dt){typeof dt!="string"&&nn("Cannot pass non-string to C++ string type "+me);var bt=qe(dt),Rt=Es(4+bt+ne);return F[Rt>>2]=bt>>He,je(dt,Rt+4,bt+ne),et!==null&&et.push(Ni,Rt),Rt},argPackAdvance:8,readValueFromPointer:ze,destructorFunction:function(et){Ni(et)}})}function Pl(te,ne,me,Pe,je,tt){ct[te]={name:vn(ne),rawConstructor:er(me,Pe),rawDestructor:er(je,tt),fields:[]}}function Rl(te,ne,me,Pe,je,tt,qe,He,et,dt){ct[te].fields.push({fieldName:vn(ne),getterReturnType:me,getter:er(Pe,je),getterContext:tt,setterArgumentType:qe,setter:er(He,et),setterContext:dt})}function Al(te,ne){ne=vn(ne),Pn(te,{isVoid:!0,name:ne,argPackAdvance:0,fromWireType:function(){},toWireType:function(me,Pe){}})}var xs={};function Ll(te){var ne=xs[te];return ne===void 0?vn(te):ne}function Ec(){return typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")()}function bc(te){return te===0?si.toHandle(Ec()):(te=Ll(te),si.toHandle(Ec()[te]))}function Nl(te){te>4&&(jn[te].refcount+=1)}function Ss(te,ne){var me=Je[te];return me===void 0&&nn(ne+" has unknown type "+Ia(te)),me}function Vl(te){for(var ne="",me=0;me<te;++me)ne+=(me!==0?", ":"")+"arg"+me;for(var Pe=()=>F,je="return function emval_allocator_"+te+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,me=0;me<te;++me)je+="var argType"+me+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+me+`');
var arg`+me+" = argType"+me+`.readValueFromPointer(args);
args += argType`+me+`['argPackAdvance'];
argTypes += 4;
`;return je+="var obj = new constructor("+ne+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",je)(Ss,o,si.toHandle,Pe)}var Dc={};function Ic(te,ne,me,Pe){te=si.toValue(te);var je=Dc[ne];return je||(je=Vl(ne),Dc[ne]=je),je(te,me,Pe)}function Mc(te,ne){te=Ss(te,"_emval_take_value");var me=te.readValueFromPointer(ne);return si.toHandle(me)}function Oc(){De("")}function kl(te,ne,me){A.copyWithin(te,ne,ne+me)}function Fl(){return 2147483648}function Ul(te){try{return x.grow(te-M.byteLength+65535>>>16),ie(x.buffer),1}catch{}}function Ts(te){var ne=A.length;te=te>>>0;var me=Fl();if(te>me)return!1;let Pe=(et,dt)=>et+(dt-et%dt)%dt;for(var je=1;je<=4;je*=2){var tt=ne*(1+.2/je);tt=Math.min(tt,te+100663296);var qe=Math.min(me,Pe(Math.max(te,tt),65536)),He=Ul(qe);if(He)return!0}return!1}function Bl(te){var ne=o["_"+te];return ne}function Qo(te,ne){R.set(te,ne)}function Gl(te,ne,me,Pe,je){var tt={string:ue=>{var Te=0;if(ue!=null&&ue!==0){var Ve=(ue.length<<2)+1;Te=bs(Ve),I(ue,Te,Ve)}return Te},array:ue=>{var Te=bs(ue.length);return Qo(ue,Te),Te}};function qe(ue){return ne==="string"?D(ue):ne==="boolean"?!!ue:ue}var He=Bl(te),et=[],dt=0;if(Pe)for(var bt=0;bt<Pe.length;bt++){var Rt=tt[me[bt]];Rt?(dt===0&&(dt=Pc()),et[bt]=Rt(Pe[bt])):et[bt]=Pe[bt]}var X=He.apply(null,et);function q(ue){return dt!==0&&Rc(dt),qe(ue)}return X=q(X),X}Sn=o.InternalError=gn(Error,"InternalError"),rt(),mi=o.BindingError=gn(Error,"BindingError"),Zo(),Jo(),vc(),Ai=o.UnboundTypeError=gn(Error,"UnboundTypeError"),ys();var _s={h:gt,q:pi,r:Xt,w:Ri,p:Cc,o:Oa,c:_l,v:xc,k:El,e:Io,b:Sc,a:bl,j:Dl,g:Cs,u:Pl,d:Rl,x:Al,i:vs,m:bc,l:Nl,y:Ic,n:Mc,f:Oc,t:kl,s:Ts};pe(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.A).apply(null,arguments)};var Es=o._malloc=function(){return(Es=o._malloc=o.asm.B).apply(null,arguments)},Mo=o.___getTypeName=function(){return(Mo=o.___getTypeName=o.asm.D).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.E).apply(null,arguments)};var Ni=o._free=function(){return(Ni=o._free=o.asm.F).apply(null,arguments)},Pc=o.stackSave=function(){return(Pc=o.stackSave=o.asm.G).apply(null,arguments)},Rc=o.stackRestore=function(){return(Rc=o.stackRestore=o.asm.H).apply(null,arguments)},bs=o.stackAlloc=function(){return(bs=o.stackAlloc=o.asm.I).apply(null,arguments)},Ac=o.___cxa_is_pointer_type=function(){return(Ac=o.___cxa_is_pointer_type=o.asm.J).apply(null,arguments)};o.ccall=Gl;var La;Q=function te(){La||Ds(),La||(Q=te)};function Ds(te){if(K>0||(_e(),K>0))return;function ne(){La||(La=!0,o.calledRun=!0,!S&&(Se(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),B()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),ne()},1)):ne()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return Ds(),i.ready})})();t.exports=r})(Ev)),Ev.exports}var Fhe=khe();const Uhe=wa(Fhe),Bhe=new URL("/radiology-ai-viewer/assets/charlswasm_decode-484ovEoR.wasm",import.meta.url),h0={codec:void 0,decoder:void 0,decodeConfig:{}};function Ghe(t){return typeof t=="number"?h0.codec.getExceptionMessage(t):t}function Whe(t){if(h0.decodeConfig=t,h0.codec)return Promise.resolve();const e=Uhe({locateFile:r=>r.endsWith(".wasm")?Bhe.toString():r});return new Promise((r,n)=>{e.then(i=>{h0.codec=i,h0.decoder=new i.JpegLSDecoder,r()},n)})}async function aE(t,e){try{await Whe();const r=h0.decoder;r.getEncodedBuffer(t.length).set(t),r.decode();const i=r.getFrameInfo(),o=r.getInterleaveMode(),a=r.getNearLossless(),s=r.getDecodedBuffer(),c={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},l=$he(i,s,e.signed),d={nearLossless:a,interleaveMode:o,frameInfo:i};return{...e,pixelData:l,imageInfo:c,encodeOptions:d,...d,...c}}catch(r){throw Ghe(r)}}function $he(t,e,r){return t.bitsPerSample>8?r?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):r?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var bv={exports:{}},sE;function zhe(){return sE||(sE=1,(function(t,e){var r=(()=>{var n=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(i={}){var o,a=i,s,c,l=new Promise((X,q)=>{s=X,c=q}),d=typeof window=="object",u=typeof WorkerGlobalScope<"u",f=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",h=Object.assign({},a),g="./this.program",p="";function v(X){return a.locateFile?a.locateFile(X,p):p+X}var w,m;if(f){var y=Zs;p=__dirname+"/",m=X=>{X=K(X)?new URL(X):X;var q=y.readFileSync(X);return q},w=async(X,q=!0)=>{X=K(X)?new URL(X):X;var ue=y.readFileSync(X,q?void 0:"utf8");return ue},!a.thisProgram&&process.argv.length>1&&(g=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else(d||u)&&(u?p=self.location.href:typeof document<"u"&&document.currentScript&&(p=document.currentScript.src),n&&(p=n),p.startsWith("blob:")?p="":p=p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(m=X=>{var q=new XMLHttpRequest;return q.open("GET",X,!1),q.responseType="arraybuffer",q.send(null),new Uint8Array(q.response)}),w=async X=>{if(K(X))return new Promise((ue,Te)=>{var Ve=new XMLHttpRequest;Ve.open("GET",X,!0),Ve.responseType="arraybuffer",Ve.onload=()=>{if(Ve.status==200||Ve.status==0&&Ve.response){ue(Ve.response);return}Te(Ve.status)},Ve.onerror=Te,Ve.send(null)});var q=await fetch(X,{credentials:"same-origin"});if(q.ok)return q.arrayBuffer();throw new Error(q.status+" : "+q.url)});var C=a.print||console.log.bind(console),x=a.printErr||console.error.bind(console);Object.assign(a,h),h=null,a.arguments&&a.arguments,a.thisProgram&&(g=a.thisProgram);var S=a.wasmBinary,T,_=!1,E,D,b,I,O,M,R,A;function G(){var X=T.buffer;a.HEAP8=E=new Int8Array(X),a.HEAP16=b=new Int16Array(X),a.HEAPU8=D=new Uint8Array(X),a.HEAPU16=I=new Uint16Array(X),a.HEAP32=O=new Int32Array(X),a.HEAPU32=M=new Uint32Array(X),a.HEAPF32=R=new Float32Array(X),a.HEAPF64=A=new Float64Array(X)}var k=[],L=[],F=[];function j(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)de(a.preRun.shift());ve(k)}function Y(){ve(L)}function ie(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)fe(a.postRun.shift());ve(F)}function de(X){k.unshift(X)}function ae(X){L.unshift(X)}function fe(X){F.unshift(X)}var we=0,_e=null;function Se(X){we++,a.monitorRunDependencies?.(we)}function B(X){if(we--,a.monitorRunDependencies?.(we),we==0&&_e){var q=_e;_e=null,q()}}function P(X){a.onAbort?.(X),X="Aborted("+X+")",x(X),_=!0,X+=". Build with -sASSERTIONS for more info.";var q=new WebAssembly.RuntimeError(X);throw c(q),q}var $="data:application/octet-stream;base64,",W=X=>X.startsWith($),K=X=>X.startsWith("file://");function Q(){var X="openjpegwasm_decode.wasm";return W(X)?X:v(X)}var ee;function ge(X){if(X==ee&&S)return new Uint8Array(S);if(m)return m(X);throw"both async and sync fetching of the wasm failed"}async function De(X){if(!S)try{var q=await w(X);return new Uint8Array(q)}catch{}return ge(X)}async function Le(X,q){try{var ue=await De(X),Te=await WebAssembly.instantiate(ue,q);return Te}catch(Ve){x(`failed to asynchronously prepare wasm: ${Ve}`),P(Ve)}}async function Ge(X,q,ue){if(!X&&typeof WebAssembly.instantiateStreaming=="function"&&!W(q)&&!K(q)&&!f&&typeof fetch=="function")try{var Te=fetch(q,{credentials:"same-origin"}),Ve=await WebAssembly.instantiateStreaming(Te,ue);return Ve}catch(Ze){x(`wasm streaming compile failed: ${Ze}`),x("falling back to ArrayBuffer instantiation")}return Le(q,ue)}function re(){return{a:me}}async function se(){function X(Ve,Ze){return Pe=Ve.exports,T=Pe.F,G(),gs=Pe.I,ae(Pe.G),B(),Pe}Se();function q(Ve){X(Ve.instance)}var ue=re();if(a.instantiateWasm)try{return a.instantiateWasm(ue,X)}catch(Ve){x(`Module.instantiateWasm callback failed with error: ${Ve}`),c(Ve)}ee??=Q();try{var Te=await Ge(S,ee,ue);return q(Te),Te}catch(Ve){c(Ve);return}}var ve=X=>{for(;X.length>0;)X.shift()(a)};a.noExitRuntime;var le=X=>He(X),pe=()=>dt();class We{constructor(q){this.excPtr=q,this.ptr=q-24}set_type(q){M[this.ptr+4>>2]=q}get_type(){return M[this.ptr+4>>2]}set_destructor(q){M[this.ptr+8>>2]=q}get_destructor(){return M[this.ptr+8>>2]}set_caught(q){q=q?1:0,E[this.ptr+12]=q}get_caught(){return E[this.ptr+12]!=0}set_rethrown(q){q=q?1:0,E[this.ptr+13]=q}get_rethrown(){return E[this.ptr+13]!=0}init(q,ue){this.set_adjusted_ptr(0),this.set_type(q),this.set_destructor(ue)}set_adjusted_ptr(q){M[this.ptr+16>>2]=q}get_adjusted_ptr(){return M[this.ptr+16>>2]}}var oe=0,st=(X,q,ue)=>{var Te=new We(X);throw Te.init(q,ue),oe=X,oe},gt=()=>P(""),ct={},Ee=X=>{for(;X.length;){var q=X.pop(),ue=X.pop();ue(q)}};function ze(X){return this.fromWireType(M[X>>2])}var Ke={},Je={},lt={},Oe,ke=X=>{throw new Oe(X)},nt=(X,q,ue)=>{X.forEach(Xe=>lt[Xe]=q);function Te(Xe){var ot=ue(Xe);ot.length!==X.length&&ke("Mismatched type converter count");for(var z=0;z<X.length;++z)rt(X[z],ot[z])}var Ve=new Array(q.length),Ze=[],it=0;q.forEach((Xe,ot)=>{Je.hasOwnProperty(Xe)?Ve[ot]=Je[Xe]:(Ze.push(Xe),Ke.hasOwnProperty(Xe)||(Ke[Xe]=[]),Ke[Xe].push(()=>{Ve[ot]=Je[Xe],++it,it===Ze.length&&Te(Ve)}))}),Ze.length===0&&Te(Ve)},wt=X=>{var q=ct[X];delete ct[X];var ue=q.rawConstructor,Te=q.rawDestructor,Ve=q.fields,Ze=Ve.map(it=>it.getterReturnType).concat(Ve.map(it=>it.setterArgumentType));nt([X],Ze,it=>{var Xe={};return Ve.forEach((ot,z)=>{var H=ot.fieldName,N=it[z],U=ot.getter,J=ot.getterContext,ce=it[z+Ve.length],he=ot.setter,ye=ot.setterContext;Xe[H]={read:xe=>N.fromWireType(U(J,xe)),write:(xe,be)=>{var Ae=[];he(ye,xe,ce.toWireType(Ae,be)),Ee(Ae)}}}),[{name:q.name,fromWireType:ot=>{var z={};for(var H in Xe)z[H]=Xe[H].read(ot);return Te(ot),z},toWireType:(ot,z)=>{for(var H in Xe)if(!(H in z))throw new TypeError(`Missing field: "${H}"`);var N=ue();for(H in Xe)Xe[H].write(N,z[H]);return ot!==null&&ot.push(Te,N),N},argPackAdvance:Mt,readValueFromPointer:ze,destructorFunction:Te}]})},gn=(X,q,ue,Te,Ve)=>{},Sn=()=>{for(var X=new Array(256),q=0;q<256;++q)X[q]=String.fromCharCode(q);ln=X},ln,on=X=>{for(var q="",ue=X;D[ue];)q+=ln[D[ue++]];return q},pi,Xt=X=>{throw new pi(X)};function Be(X,q,ue={}){var Te=q.name;if(X||Xt(`type "${Te}" must have a positive integer typeid pointer`),Je.hasOwnProperty(X)){if(ue.ignoreDuplicateRegistrations)return;Xt(`Cannot register type '${Te}' twice`)}if(Je[X]=q,delete lt[X],Ke.hasOwnProperty(X)){var Ve=Ke[X];delete Ke[X],Ve.forEach(Ze=>Ze())}}function rt(X,q,ue={}){return Be(X,q,ue)}var Mt=8,vn=(X,q,ue,Te)=>{q=on(q),rt(X,{name:q,fromWireType:function(Ve){return!!Ve},toWireType:function(Ve,Ze){return Ze?ue:Te},argPackAdvance:Mt,readValueFromPointer:function(Ve){return this.fromWireType(D[Ve])},destructorFunction:null})},mi=X=>({count:X.count,deleteScheduled:X.deleteScheduled,preservePointerOnDelete:X.preservePointerOnDelete,ptr:X.ptr,ptrType:X.ptrType,smartPtr:X.smartPtr,smartPtrType:X.smartPtrType}),nn=X=>{function q(ue){return ue.$$.ptrType.registeredClass.name}Xt(q(X)+" instance already deleted")},Pn=!1,Ri=X=>{},pn=X=>{X.smartPtr?X.smartPtrType.rawDestructor(X.smartPtr):X.ptrType.registeredClass.rawDestructor(X.ptr)},Br=X=>{X.count.value-=1;var q=X.count.value===0;q&&pn(X)},vi=(X,q,ue)=>{if(q===ue)return X;if(ue.baseClass===void 0)return null;var Te=vi(X,q,ue.baseClass);return Te===null?null:ue.downcast(Te)},Ta={},hc={},qo=(X,q)=>{for(q===void 0&&Xt("ptr should not be undefined");X.baseClass;)q=X.upcast(q),X=X.baseClass;return q},_a=(X,q)=>(q=qo(X,q),hc[q]),no=(X,q)=>{(!q.ptrType||!q.ptr)&&ke("makeClassHandle requires ptr and ptrType");var ue=!!q.smartPtrType,Te=!!q.smartPtr;return ue!==Te&&ke("Both smartPtrType and smartPtr must be specified"),q.count={value:1},ni(Object.create(X,{$$:{value:q,writable:!0}}))};function mr(X){var q=this.getPointee(X);if(!q)return this.destructor(X),null;var ue=_a(this.registeredClass,q);if(ue!==void 0){if(ue.$$.count.value===0)return ue.$$.ptr=q,ue.$$.smartPtr=X,ue.clone();var Te=ue.clone();return this.destructor(X),Te}function Ve(){return this.isSmartPointer?no(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:q,smartPtrType:this,smartPtr:X}):no(this.registeredClass.instancePrototype,{ptrType:this,ptr:X})}var Ze=this.registeredClass.getActualType(q),it=Ta[Ze];if(!it)return Ve.call(this);var Xe;this.isConst?Xe=it.constPointerType:Xe=it.pointerType;var ot=vi(q,this.registeredClass,Xe.registeredClass);return ot===null?Ve.call(this):this.isSmartPointer?no(Xe.registeredClass.instancePrototype,{ptrType:Xe,ptr:ot,smartPtrType:this,smartPtr:X}):no(Xe.registeredClass.instancePrototype,{ptrType:Xe,ptr:ot})}var ni=X=>typeof FinalizationRegistry>"u"?(ni=q=>q,X):(Pn=new FinalizationRegistry(q=>{Br(q.$$)}),ni=q=>{var ue=q.$$,Te=!!ue.smartPtr;if(Te){var Ve={$$:ue};Pn.register(q,Ve,q)}return q},Ri=q=>Pn.unregister(q),ni(X)),mn=()=>{Object.assign(sr.prototype,{isAliasOf(X){if(!(this instanceof sr)||!(X instanceof sr))return!1;var q=this.$$.ptrType.registeredClass,ue=this.$$.ptr;X.$$=X.$$;for(var Te=X.$$.ptrType.registeredClass,Ve=X.$$.ptr;q.baseClass;)ue=q.upcast(ue),q=q.baseClass;for(;Te.baseClass;)Ve=Te.upcast(Ve),Te=Te.baseClass;return q===Te&&ue===Ve},clone(){if(this.$$.ptr||nn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var X=ni(Object.create(Object.getPrototypeOf(this),{$$:{value:mi(this.$$)}}));return X.$$.count.value+=1,X.$$.deleteScheduled=!1,X},delete(){this.$$.ptr||nn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Xt("Object already scheduled for deletion"),Ri(this),Br(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||nn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Xt("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}})};function sr(){}var ro=(X,q)=>Object.defineProperty(q,"name",{value:X}),Eo=(X,q,ue)=>{if(X[q].overloadTable===void 0){var Te=X[q];X[q]=function(...Ve){return X[q].overloadTable.hasOwnProperty(Ve.length)||Xt(`Function '${ue}' called with an invalid number of arguments (${Ve.length}) - expects one of (${X[q].overloadTable})!`),X[q].overloadTable[Ve.length].apply(this,Ve)},X[q].overloadTable=[],X[q].overloadTable[Te.argCount]=Te}},Yo=(X,q,ue)=>{a.hasOwnProperty(X)?(Xt(`Cannot register public name '${X}' twice`),Eo(a,X,X),a[X].overloadTable.hasOwnProperty(ue)&&Xt(`Cannot register multiple overloads of a function with the same number of arguments (${ue})!`),a[X].overloadTable[ue]=q):(a[X]=q,a[X].argCount=ue)},Jo=48,ri=57,gc=X=>{X=X.replace(/[^a-zA-Z0-9_]/g,"$");var q=X.charCodeAt(0);return q>=Jo&&q<=ri?`_${X}`:X};function Cl(X,q,ue,Te,Ve,Ze,it,Xe){this.name=X,this.constructor=q,this.instancePrototype=ue,this.rawDestructor=Te,this.baseClass=Ve,this.getActualType=Ze,this.upcast=it,this.downcast=Xe,this.pureVirtualFunctions=[]}var ii=(X,q,ue)=>{for(;q!==ue;)q.upcast||Xt(`Expected null or instance of ${ue.name}, got an instance of ${q.name}`),X=q.upcast(X),q=q.baseClass;return X};function pc(X,q){if(q===null)return this.isReference&&Xt(`null is not a valid ${this.name}`),0;q.$$||Xt(`Cannot pass "${Oa(q)}" as a ${this.name}`),q.$$.ptr||Xt(`Cannot pass deleted object as a pointer of type ${this.name}`);var ue=q.$$.ptrType.registeredClass,Te=ii(q.$$.ptr,ue,this.registeredClass);return Te}function bo(X,q){var ue;if(q===null)return this.isReference&&Xt(`null is not a valid ${this.name}`),this.isSmartPointer?(ue=this.rawConstructor(),X!==null&&X.push(this.rawDestructor,ue),ue):0;(!q||!q.$$)&&Xt(`Cannot pass "${Oa(q)}" as a ${this.name}`),q.$$.ptr||Xt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&q.$$.ptrType.isConst&&Xt(`Cannot convert argument of type ${q.$$.smartPtrType?q.$$.smartPtrType.name:q.$$.ptrType.name} to parameter type ${this.name}`);var Te=q.$$.ptrType.registeredClass;if(ue=ii(q.$$.ptr,Te,this.registeredClass),this.isSmartPointer)switch(q.$$.smartPtr===void 0&&Xt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:q.$$.smartPtrType===this?ue=q.$$.smartPtr:Xt(`Cannot convert argument of type ${q.$$.smartPtrType?q.$$.smartPtrType.name:q.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:ue=q.$$.smartPtr;break;case 2:if(q.$$.smartPtrType===this)ue=q.$$.smartPtr;else{var Ve=q.clone();ue=this.rawShare(ue,qr.toHandle(()=>Ve.delete())),X!==null&&X.push(this.rawDestructor,ue)}break;default:Xt("Unsupporting sharing policy")}return ue}function Ea(X,q){if(q===null)return this.isReference&&Xt(`null is not a valid ${this.name}`),0;q.$$||Xt(`Cannot pass "${Oa(q)}" as a ${this.name}`),q.$$.ptr||Xt(`Cannot pass deleted object as a pointer of type ${this.name}`),q.$$.ptrType.isConst&&Xt(`Cannot convert argument of type ${q.$$.ptrType.name} to parameter type ${this.name}`);var ue=q.$$.ptrType.registeredClass,Te=ii(q.$$.ptr,ue,this.registeredClass);return Te}var xl=()=>{Object.assign(Kr.prototype,{getPointee(X){return this.rawGetPointee&&(X=this.rawGetPointee(X)),X},destructor(X){this.rawDestructor?.(X)},argPackAdvance:Mt,readValueFromPointer:ze,fromWireType:mr})};function Kr(X,q,ue,Te,Ve,Ze,it,Xe,ot,z,H){this.name=X,this.registeredClass=q,this.isReference=ue,this.isConst=Te,this.isSmartPointer=Ve,this.pointeeType=Ze,this.sharingPolicy=it,this.rawGetPointee=Xe,this.rawConstructor=ot,this.rawShare=z,this.rawDestructor=H,!Ve&&q.baseClass===void 0?Te?(this.toWireType=pc,this.destructorFunction=null):(this.toWireType=Ea,this.destructorFunction=null):this.toWireType=bo}var hs=(X,q,ue)=>{a.hasOwnProperty(X)||ke("Replacing nonexistent public symbol"),a[X].overloadTable!==void 0&&ue!==void 0||(a[X]=q,a[X].argCount=ue)},Zo=(X,q,ue)=>{X=X.replace(/p/g,"i");var Te=a["dynCall_"+X];return Te(q,...ue)},oi=[],gs,io=X=>{var q=oi[X];return q||(X>=oi.length&&(oi.length=X+1),oi[X]=q=gs.get(X)),q},Hi=(X,q,ue=[])=>{if(X.includes("j"))return Zo(X,q,ue);var Te=io(q)(...ue);return Te},ba=(X,q)=>(...ue)=>Hi(X,q,ue),Gr=(X,q)=>{X=on(X);function ue(){return X.includes("j")?ba(X,q):io(q)}var Te=ue();return typeof Te!="function"&&Xt(`unknown function pointer with signature ${X}: ${q}`),Te},Sl=(X,q)=>{var ue=ro(q,function(Te){this.name=q,this.message=Te;var Ve=new Error(Te).stack;Ve!==void 0&&(this.stack=this.toString()+`
`+Ve.replace(/^Error(:[^\n]*)?\n/,""))});return ue.prototype=Object.create(X.prototype),ue.prototype.constructor=ue,ue.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},ue},Xi,mc=X=>{var q=je(X),ue=on(q);return qe(q),ue},ps=(X,q)=>{var ue=[],Te={};function Ve(Ze){if(!Te[Ze]&&!Je[Ze]){if(lt[Ze]){lt[Ze].forEach(Ve);return}ue.push(Ze),Te[Ze]=!0}}throw q.forEach(Ve),new Xi(`${X}: `+ue.map(mc).join([", "]))},Tl=(X,q,ue,Te,Ve,Ze,it,Xe,ot,z,H,N,U)=>{H=on(H),Ze=Gr(Ve,Ze),Xe&&=Gr(it,Xe),z&&=Gr(ot,z),U=Gr(N,U);var J=gc(H);Yo(J,function(){ps(`Cannot construct ${H} due to unbound types`,[Te])}),nt([X,q,ue],Te?[Te]:[],ce=>{ce=ce[0];var he,ye;Te?(he=ce.registeredClass,ye=he.instancePrototype):ye=sr.prototype;var xe=ro(H,function(...Ct){if(Object.getPrototypeOf(this)!==be)throw new pi("Use 'new' to construct "+H);if(Ae.constructor_body===void 0)throw new pi(H+" has no accessible constructor");var Yt=Ae.constructor_body[Ct.length];if(Yt===void 0)throw new pi(`Tried to invoke ctor of ${H} with invalid number of parameters (${Ct.length}) - expected (${Object.keys(Ae.constructor_body).toString()}) parameters instead!`);return Yt.apply(this,Ct)}),be=Object.create(ye,{constructor:{value:xe}});xe.prototype=be;var Ae=new Cl(H,xe,be,U,he,Ze,Xe,z);Ae.baseClass&&(Ae.baseClass.__derivedClasses??=[],Ae.baseClass.__derivedClasses.push(Ae));var Qe=new Kr(H,Ae,!0,!1,!1),at=new Kr(H+"*",Ae,!1,!1,!1),_t=new Kr(H+" const*",Ae,!1,!0,!1);return Ta[X]={pointerType:at,constPointerType:_t},hs(J,xe),[Qe,at,_t]})},vc=(X,q)=>{for(var ue=[],Te=0;Te<X;Te++)ue.push(M[q+Te*4>>2]);return ue};function yi(X){for(var q=1;q<X.length;++q)if(X[q]!==null&&X[q].destructorFunction===void 0)return!0;return!1}function wi(X,q){if(!(X instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof X} which is not a function`);var ue=ro(X.name||"unknownFunctionName",function(){});ue.prototype=X.prototype;var Te=new ue,Ve=X.apply(Te,q);return Ve instanceof Object?Ve:Te}function yc(X,q,ue,Te){var Ve=yi(X),Ze=X.length-2,it=[],Xe=["fn"];q&&Xe.push("thisWired");for(var ot=0;ot<Ze;++ot)it.push(`arg${ot}`),Xe.push(`arg${ot}Wired`);it=it.join(","),Xe=Xe.join(",");var z=`return function (${it}) {
`;Ve&&(z+=`var destructors = [];
`);var H=Ve?"destructors":"null",N=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];q&&(z+=`var thisWired = classParam['toWireType'](${H}, this);
`);for(var ot=0;ot<Ze;++ot)z+=`var arg${ot}Wired = argType${ot}['toWireType'](${H}, arg${ot});
`,N.push(`argType${ot}`);if(z+=(ue||Te?"var rv = ":"")+`invoker(${Xe});
`,Ve)z+=`runDestructors(destructors);
`;else for(var ot=q?1:2;ot<X.length;++ot){var U=ot===1?"thisWired":"arg"+(ot-2)+"Wired";X[ot].destructorFunction!==null&&(z+=`${U}_dtor(${U});
`,N.push(`${U}_dtor`))}return ue&&(z+=`var ret = retType['fromWireType'](rv);
return ret;
`),z+=`}
`,[N,z]}function Mr(X,q,ue,Te,Ve,Ze){var it=q.length;it<2&&Xt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Xe=q[1]!==null&&ue!==null,ot=yi(q),z=q[0].name!=="void",H=[X,Xt,Te,Ve,Ee,q[0],q[1]],N=0;N<it-2;++N)H.push(q[N+2]);if(!ot)for(var N=Xe?1:2;N<q.length;++N)q[N].destructorFunction!==null&&H.push(q[N].destructorFunction);let[U,J]=yc(q,Xe,z,Ze);U.push(J);var ce=wi(Function,U)(...H);return ro(X,ce)}var wc=(X,q,ue,Te,Ve,Ze)=>{var it=vc(q,ue);Ve=Gr(Te,Ve),nt([],[X],Xe=>{Xe=Xe[0];var ot=`constructor ${Xe.name}`;if(Xe.registeredClass.constructor_body===void 0&&(Xe.registeredClass.constructor_body=[]),Xe.registeredClass.constructor_body[q-1]!==void 0)throw new pi(`Cannot register multiple constructors with identical number of parameters (${q-1}) for class '${Xe.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return Xe.registeredClass.constructor_body[q-1]=()=>{ps(`Cannot construct ${Xe.name} due to unbound types`,it)},nt([],it,z=>(z.splice(1,0,null),Xe.registeredClass.constructor_body[q-1]=Mr(ot,z,null,Ve,Ze),[])),[]})},ms=X=>{X=X.trim();const q=X.indexOf("(");return q!==-1?X.substr(0,q):X},Da=(X,q,ue,Te,Ve,Ze,it,Xe,ot,z)=>{var H=vc(ue,Te);q=on(q),q=ms(q),Ze=Gr(Ve,Ze),nt([],[X],N=>{N=N[0];var U=`${N.name}.${q}`;q.startsWith("@@")&&(q=Symbol[q.substring(2)]),Xe&&N.registeredClass.pureVirtualFunctions.push(q);function J(){ps(`Cannot call ${U} due to unbound types`,H)}var ce=N.registeredClass.instancePrototype,he=ce[q];return he===void 0||he.overloadTable===void 0&&he.className!==N.name&&he.argCount===ue-2?(J.argCount=ue-2,J.className=N.name,ce[q]=J):(Eo(ce,q,U),ce[q].overloadTable[ue-2]=J),nt([],H,ye=>{var xe=Mr(U,ye,N,Ze,it,ot);return ce[q].overloadTable===void 0?(xe.argCount=ue-2,ce[q]=xe):ce[q].overloadTable[ue-2]=xe,[]}),[]})},er=[],Ai=[],Ia=X=>{X>9&&--Ai[X+1]===0&&(Ai[X]=void 0,er.push(X))},Wr=()=>Ai.length/2-5-er.length,Cc=()=>{Ai.push(0,1,void 0,1,null,1,!0,1,!1,1),a.count_emval_handles=Wr},qr={toValue:X=>(X||Xt("Cannot use deleted val. handle = "+X),Ai[X]),toHandle:X=>{switch(X){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const q=er.pop()||Ai.length;return Ai[q]=X,Ai[q+1]=1,q}}}},ai={name:"emscripten::val",fromWireType:X=>{var q=qr.toValue(X);return Ia(X),q},toWireType:(X,q)=>qr.toHandle(q),argPackAdvance:Mt,readValueFromPointer:ze,destructorFunction:null},Ma=X=>rt(X,ai),Oa=X=>{if(X===null)return"null";var q=typeof X;return q==="object"||q==="array"||q==="function"?X.toString():""+X},_l=(X,q)=>{switch(q){case 4:return function(ue){return this.fromWireType(R[ue>>2])};case 8:return function(ue){return this.fromWireType(A[ue>>3])};default:throw new TypeError(`invalid float width (${q}): ${X}`)}},Pa=(X,q,ue)=>{q=on(q),rt(X,{name:q,fromWireType:Te=>Te,toWireType:(Te,Ve)=>Ve,argPackAdvance:Mt,readValueFromPointer:_l(q,ue),destructorFunction:null})},jn=(X,q,ue)=>{switch(q){case 1:return ue?Te=>E[Te]:Te=>D[Te];case 2:return ue?Te=>b[Te>>1]:Te=>I[Te>>1];case 4:return ue?Te=>O[Te>>2]:Te=>M[Te>>2];default:throw new TypeError(`invalid integer width (${q}): ${X}`)}},vs=(X,q,ue,Te,Ve)=>{q=on(q);var Ze=H=>H;if(Te===0){var it=32-8*ue;Ze=H=>H<<it>>>it}var Xe=q.includes("unsigned"),ot=(H,N)=>{},z;Xe?z=function(H,N){return ot(N,this.name),N>>>0}:z=function(H,N){return ot(N,this.name),N},rt(X,{name:q,fromWireType:Ze,toWireType:z,argPackAdvance:Mt,readValueFromPointer:jn(q,ue,Te!==0),destructorFunction:null})},Ra=(X,q,ue)=>{var Te=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ve=Te[q];function Ze(it){var Xe=M[it>>2],ot=M[it+4>>2];return new Ve(E.buffer,ot,Xe)}ue=on(ue),rt(X,{name:ue,fromWireType:Ze,argPackAdvance:Mt,readValueFromPointer:Ze},{ignoreDuplicateRegistrations:!0})},Or=(X,q,ue,Te)=>{if(!(Te>0))return 0;for(var Ve=ue,Ze=ue+Te-1,it=0;it<X.length;++it){var Xe=X.charCodeAt(it);if(Xe>=55296&&Xe<=57343){var ot=X.charCodeAt(++it);Xe=65536+((Xe&1023)<<10)|ot&1023}if(Xe<=127){if(ue>=Ze)break;q[ue++]=Xe}else if(Xe<=2047){if(ue+1>=Ze)break;q[ue++]=192|Xe>>6,q[ue++]=128|Xe&63}else if(Xe<=65535){if(ue+2>=Ze)break;q[ue++]=224|Xe>>12,q[ue++]=128|Xe>>6&63,q[ue++]=128|Xe&63}else{if(ue+3>=Ze)break;q[ue++]=240|Xe>>18,q[ue++]=128|Xe>>12&63,q[ue++]=128|Xe>>6&63,q[ue++]=128|Xe&63}}return q[ue]=0,ue-Ve},ys=(X,q,ue)=>Or(X,D,q,ue),si=X=>{for(var q=0,ue=0;ue<X.length;++ue){var Te=X.charCodeAt(ue);Te<=127?q++:Te<=2047?q+=2:Te>=55296&&Te<=57343?(q+=4,++ue):q+=3}return q},xc=typeof TextDecoder<"u"?new TextDecoder:void 0,Do=(X,q=0,ue=NaN)=>{for(var Te=q+ue,Ve=q;X[Ve]&&!(Ve>=Te);)++Ve;if(Ve-q>16&&X.buffer&&xc)return xc.decode(X.subarray(q,Ve));for(var Ze="";q<Ve;){var it=X[q++];if(!(it&128)){Ze+=String.fromCharCode(it);continue}var Xe=X[q++]&63;if((it&224)==192){Ze+=String.fromCharCode((it&31)<<6|Xe);continue}var ot=X[q++]&63;if((it&240)==224?it=(it&15)<<12|Xe<<6|ot:it=(it&7)<<18|Xe<<12|ot<<6|X[q++]&63,it<65536)Ze+=String.fromCharCode(it);else{var z=it-65536;Ze+=String.fromCharCode(55296|z>>10,56320|z&1023)}}return Ze},Li=(X,q)=>X?Do(D,X,q):"",El=(X,q)=>{q=on(q),rt(X,{name:q,fromWireType(ue){for(var Te=M[ue>>2],Ve=ue+4,Ze,it,Xe=Ve,it=0;it<=Te;++it){var ot=Ve+it;if(it==Te||D[ot]==0){var z=ot-Xe,H=Li(Xe,z);Ze===void 0?Ze=H:(Ze+="\0",Ze+=H),Xe=ot+1}}return qe(ue),Ze},toWireType(ue,Te){Te instanceof ArrayBuffer&&(Te=new Uint8Array(Te));var Ve,Ze=typeof Te=="string";Ze||Te instanceof Uint8Array||Te instanceof Uint8ClampedArray||Te instanceof Int8Array||Xt("Cannot pass non-string to std::string"),Ze?Ve=si(Te):Ve=Te.length;var it=tt(4+Ve+1),Xe=it+4;if(M[it>>2]=Ve,Ze)ys(Te,Xe,Ve+1);else if(Ze)for(var ot=0;ot<Ve;++ot){var z=Te.charCodeAt(ot);z>255&&(qe(Xe),Xt("String has UTF-16 code units that do not fit in 8 bits")),D[Xe+ot]=z}else for(var ot=0;ot<Ve;++ot)D[Xe+ot]=Te[ot];return ue!==null&&ue.push(qe,it),it},argPackAdvance:Mt,readValueFromPointer:ze,destructorFunction(ue){qe(ue)}})},Io=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,ci=(X,q)=>{for(var ue=X,Te=ue>>1,Ve=Te+q/2;!(Te>=Ve)&&I[Te];)++Te;if(ue=Te<<1,ue-X>32&&Io)return Io.decode(D.subarray(X,ue));for(var Ze="",it=0;!(it>=q/2);++it){var Xe=b[X+it*2>>1];if(Xe==0)break;Ze+=String.fromCharCode(Xe)}return Ze},Sc=(X,q,ue)=>{if(ue??=2147483647,ue<2)return 0;ue-=2;for(var Te=q,Ve=ue<X.length*2?ue/2:X.length,Ze=0;Ze<Ve;++Ze){var it=X.charCodeAt(Ze);b[q>>1]=it,q+=2}return b[q>>1]=0,q-Te},bl=X=>X.length*2,Dl=(X,q)=>{for(var ue=0,Te="";!(ue>=q/4);){var Ve=O[X+ue*4>>2];if(Ve==0)break;if(++ue,Ve>=65536){var Ze=Ve-65536;Te+=String.fromCharCode(55296|Ze>>10,56320|Ze&1023)}else Te+=String.fromCharCode(Ve)}return Te},Tc=(X,q,ue)=>{if(ue??=2147483647,ue<4)return 0;for(var Te=q,Ve=Te+ue-4,Ze=0;Ze<X.length;++Ze){var it=X.charCodeAt(Ze);if(it>=55296&&it<=57343){var Xe=X.charCodeAt(++Ze);it=65536+((it&1023)<<10)|Xe&1023}if(O[q>>2]=it,q+=4,q+4>Ve)break}return O[q>>2]=0,q-Te},Aa=X=>{for(var q=0,ue=0;ue<X.length;++ue){var Te=X.charCodeAt(ue);Te>=55296&&Te<=57343&&++ue,q+=4}return q},_c=(X,q,ue)=>{ue=on(ue);var Te,Ve,Ze,it;q===2?(Te=ci,Ve=Sc,it=bl,Ze=Xe=>I[Xe>>1]):q===4&&(Te=Dl,Ve=Tc,it=Aa,Ze=Xe=>M[Xe>>2]),rt(X,{name:ue,fromWireType:Xe=>{for(var ot=M[Xe>>2],z,H=Xe+4,N=0;N<=ot;++N){var U=Xe+4+N*q;if(N==ot||Ze(U)==0){var J=U-H,ce=Te(H,J);z===void 0?z=ce:(z+="\0",z+=ce),H=U+q}}return qe(Xe),z},toWireType:(Xe,ot)=>{typeof ot!="string"&&Xt(`Cannot pass non-string to C++ string type ${ue}`);var z=it(ot),H=tt(4+z+q);return M[H>>2]=z/q,Ve(ot,H+4,z+q),Xe!==null&&Xe.push(qe,H),H},argPackAdvance:Mt,readValueFromPointer:ze,destructorFunction(Xe){qe(Xe)}})},ws=(X,q,ue,Te,Ve,Ze)=>{ct[X]={name:on(q),rawConstructor:Gr(ue,Te),rawDestructor:Gr(Ve,Ze),fields:[]}},Il=(X,q,ue,Te,Ve,Ze,it,Xe,ot,z)=>{ct[X].fields.push({fieldName:on(q),getterReturnType:ue,getter:Gr(Te,Ve),getterContext:Ze,setterArgumentType:it,setter:Gr(Xe,ot),setterContext:z})},Ml=(X,q)=>{q=on(q),rt(X,{isVoid:!0,name:q,argPackAdvance:0,fromWireType:()=>{},toWireType:(ue,Te)=>{}})},Ol=(X,q,ue)=>D.copyWithin(X,q,q+ue),Cs=[],Pl=(X,q,ue,Te)=>(X=Cs[X],q=qr.toValue(q),X(null,q,ue,Te)),Rl={},Al=X=>{var q=Rl[X];return q===void 0?on(X):q},xs=()=>typeof globalThis=="object"?globalThis:(function(){return Function})()("return this")(),Ll=X=>X===0?qr.toHandle(xs()):(X=Al(X),qr.toHandle(xs()[X])),Ec=X=>{var q=Cs.length;return Cs.push(X),q},bc=(X,q)=>{var ue=Je[X];return ue===void 0&&Xt(`${q} has unknown type ${mc(X)}`),ue},Nl=(X,q)=>{for(var ue=new Array(X),Te=0;Te<X;++Te)ue[Te]=bc(M[q+Te*4>>2],"parameter "+Te);return ue},Ss=(X,q,ue)=>{var Te=[],Ve=X.toWireType(Te,ue);return Te.length&&(M[q>>2]=qr.toHandle(Te)),Ve},Vl=(X,q,ue)=>{var Te=Nl(X,q),Ve=Te.shift();X--;var Ze=`return function (obj, func, destructorsRef, args) {
`,it=0,Xe=[];ue===0&&Xe.push("obj");for(var ot=["retType"],z=[Ve],H=0;H<X;++H)Xe.push("arg"+H),ot.push("argType"+H),z.push(Te[H]),Ze+=`  var arg${H} = argType${H}.readValueFromPointer(args${it?"+"+it:""});
`,it+=Te[H].argPackAdvance;var N=ue===1?"new func":"func.call";Ze+=`  var rv = ${N}(${Xe.join(", ")});
`,Ve.isVoid||(ot.push("emval_returnValue"),z.push(Ss),Ze+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Ze+=`};
`,ot.push(Ze);var U=wi(Function,ot)(...z),J=`methodCaller<(${Te.map(ce=>ce.name).join(", ")}) => ${Ve.name}>`;return Ec(ro(J,U))},Dc=X=>{var q=qr.toValue(X);Ee(q),Ia(X)},Ic=(X,q)=>{X=bc(X,"_emval_take_value");var ue=X.readValueFromPointer(q);return qr.toHandle(ue)},Mc=()=>2147483648,Oc=()=>Mc(),kl=(X,q)=>Math.ceil(X/q)*q,Fl=X=>{var q=T.buffer,ue=(X-q.byteLength+65535)/65536|0;try{return T.grow(ue),G(),1}catch{}},Ul=X=>{var q=D.length;X>>>=0;var ue=Mc();if(X>ue)return!1;for(var Te=1;Te<=4;Te*=2){var Ve=q*(1+.2/Te);Ve=Math.min(Ve,X+100663296);var Ze=Math.min(ue,kl(Math.max(X,Ve),65536)),it=Fl(Ze);if(it)return!0}return!1},Ts={},Bl=()=>g||"./this.program",Qo=()=>{if(!Qo.strings){var X=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",q={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:X,_:Bl()};for(var ue in Ts)Ts[ue]===void 0?delete q[ue]:q[ue]=Ts[ue];var Te=[];for(var ue in q)Te.push(`${ue}=${q[ue]}`);Qo.strings=Te}return Qo.strings},Gl=(X,q)=>{for(var ue=0;ue<X.length;++ue)E[q++]=X.charCodeAt(ue);E[q]=0},_s=(X,q)=>{var ue=0;return Qo().forEach((Te,Ve)=>{var Ze=q+ue;M[X+Ve*4>>2]=Ze,Gl(Te,Ze),ue+=Te.length+1}),0},Es=(X,q)=>{var ue=Qo();M[X>>2]=ue.length;var Te=0;return ue.forEach(Ve=>Te+=Ve.length+1),M[q>>2]=Te,0},Mo=X=>52;function Ni(X,q,ue,Te,Ve){return 70}var Pc=[null,[],[]],Rc=(X,q)=>{var ue=Pc[X];q===0||q===10?((X===1?C:x)(Do(ue)),ue.length=0):ue.push(q)},bs=(X,q,ue,Te)=>{for(var Ve=0,Ze=0;Ze<ue;Ze++){var it=M[q>>2],Xe=M[q+4>>2];q+=8;for(var ot=0;ot<Xe;ot++)Rc(X,D[it+ot]);Ve+=Xe}return M[Te>>2]=Ve,0},Ac=X=>{var q=a["_"+X];return q},La=(X,q)=>{E.set(X,q)},Ds=X=>et(X),te=X=>{var q=si(X)+1,ue=Ds(q);return ys(X,ue,q),ue},ne=(X,q,ue,Te,Ve)=>{var Ze={string:ce=>{var he=0;return ce!=null&&ce!==0&&(he=te(ce)),he},array:ce=>{var he=Ds(ce.length);return La(ce,he),he}};function it(ce){return q==="string"?Li(ce):q==="boolean"?!!ce:ce}var Xe=Ac(X),ot=[],z=0;if(Te)for(var H=0;H<Te.length;H++){var N=Ze[ue[H]];N?(z===0&&(z=pe()),ot[H]=N(Te[H])):ot[H]=Te[H]}var U=Xe(...ot);function J(ce){return z!==0&&le(z),it(ce)}return U=J(U),U};Oe=a.InternalError=class extends Error{constructor(q){super(q),this.name="InternalError"}},Sn(),pi=a.BindingError=class extends Error{constructor(q){super(q),this.name="BindingError"}},mn(),xl(),Xi=a.UnboundTypeError=Sl(Error,"UnboundTypeError"),Cc();var me={A:st,p:gt,e:wt,o:gn,y:vn,m:Tl,l:wc,b:Da,w:Ma,i:Pa,d:vs,a:Ra,x:El,g:_c,f:ws,c:Il,z:Ml,v:Ol,C:Pl,D:Ia,E:Ll,j:Vl,B:Dc,k:Ic,r:Oc,q:Ul,s:_s,t:Es,u:Mo,n:Ni,h:bs},Pe;se();var je=X=>(je=Pe.H)(X),tt=X=>(tt=Pe.J)(X),qe=X=>(qe=Pe.K)(X),He=X=>(He=Pe.L)(X),et=X=>(et=Pe.M)(X),dt=()=>(dt=Pe.N)();a.dynCall_iji=(X,q,ue,Te)=>(a.dynCall_iji=Pe.O)(X,q,ue,Te),a.dynCall_jji=(X,q,ue,Te)=>(a.dynCall_jji=Pe.P)(X,q,ue,Te),a.dynCall_iiji=(X,q,ue,Te,Ve)=>(a.dynCall_iiji=Pe.Q)(X,q,ue,Te,Ve),a.dynCall_jiji=(X,q,ue,Te,Ve)=>(a.dynCall_jiji=Pe.R)(X,q,ue,Te,Ve),a.ccall=ne;var bt;_e=function X(){bt||Rt(),bt||(_e=X)};function Rt(){if(we>0||(j(),we>0))return;function X(){bt||(bt=!0,a.calledRun=!0,!_&&(Y(),s(a),a.onRuntimeInitialized?.(),ie()))}a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),X()},1)):X()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Rt(),o=l,o})})();t.exports=r,t.exports.default=r})(bv)),bv.exports}var jhe=zhe();const Hhe=wa(jhe),Xhe=new URL("/radiology-ai-viewer/assets/openjpegwasm_decode-B3gWTHpv.wasm",import.meta.url),cf={codec:void 0,decoder:void 0,decodeConfig:{}};function Khe(t){if(cf.decodeConfig=t,cf.codec)return Promise.resolve();const e=Hhe({locateFile:r=>r.endsWith(".wasm")?Xhe.toString():r});return new Promise((r,n)=>{e.then(i=>{cf.codec=i,cf.decoder=new i.J2KDecoder,r()},n)})}async function cE(t,e){await Khe();const r=cf.decoder,n=r.getEncodedBuffer(t.length);n.set(t),r.decode();const i=r.getFrameInfo(),o=r.getDecodedBuffer();new Uint8Array(o.length).set(o);const s=`x: ${r.getImageOffset().x}, y: ${r.getImageOffset().y}`,c=r.getNumDecompositions(),l=r.getNumLayers(),d=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][r.getProgressionOrder()+1],u=r.getIsReversible(),f=`${r.getBlockDimensions().width} x ${r.getBlockDimensions().height}`,h=`${r.getTileSize().width} x ${r.getTileSize().height}`,g=`${r.getTileOffset().x}, ${r.getTileOffset().y}`,p=r.getColorSpace(),v=`${o.length.toLocaleString()} bytes`,w=`${(o.length/n.length).toFixed(2)}:1`,m={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:i.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},y=qhe(i,o),C={imageOffset:s,numDecompositions:c,numLayers:l,progessionOrder:d,reversible:u,blockDimensions:f,tileSize:h,tileOffset:g,colorTransform:p,decodedSize:v,compressionRatio:w};return{...e,pixelData:y,imageInfo:m,encodeOptions:C,...C,...m}}function qhe(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var Dv={exports:{}},lE;function Yhe(){return lE||(lE=1,(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),(function(o){o=o||{};var o=typeof o<"u"?o:{},a,s;o.ready=new Promise(function(z,H){a=z,s=H});var c=Object.assign({},o),l=typeof window=="object",d=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",f="";function h(z){return o.locateFile?o.locateFile(z,f):f+z}var g,p,v;if(u){var w=Zs,m=Zs;d?f=m.dirname(f)+"/":f=__dirname+"/",g=(z,H)=>(z=se(z)?new URL(z):m.normalize(z),w.readFileSync(z,H?void 0:"utf8")),v=z=>{var H=g(z,!0);return H.buffer||(H=new Uint8Array(H)),H},p=(z,H,N)=>{z=se(z)?new URL(z):m.normalize(z),w.readFile(z,function(U,J){U?N(U):H(J.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(z){if(!(z instanceof oe))throw z}),process.on("unhandledRejection",function(z){throw z}),o.inspect=function(){return"[Emscripten Module object]"}}else(l||d)&&(d?f=self.location.href:typeof document<"u"&&document.currentScript&&(f=document.currentScript.src),n&&(f=n),f.indexOf("blob:")!==0?f=f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):f="",g=z=>{var H=new XMLHttpRequest;return H.open("GET",z,!1),H.send(null),H.responseText},d&&(v=z=>{var H=new XMLHttpRequest;return H.open("GET",z,!1),H.responseType="arraybuffer",H.send(null),new Uint8Array(H.response)}),p=(z,H,N)=>{var U=new XMLHttpRequest;U.open("GET",z,!0),U.responseType="arraybuffer",U.onload=()=>{if(U.status==200||U.status==0&&U.response){H(U.response);return}N()},U.onerror=N,U.send(null)});var y=o.print||console.log.bind(console),C=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit;var x;o.wasmBinary&&(x=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&Le("no native wasm support detected");var S,T=!1;function _(z,H){z||Le(H)}var E=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function D(z,H,N){for(var U=H+N,J=H;z[J]&&!(J>=U);)++J;if(J-H>16&&z.buffer&&E)return E.decode(z.subarray(H,J));for(var ce="";H<J;){var he=z[H++];if(!(he&128)){ce+=String.fromCharCode(he);continue}var ye=z[H++]&63;if((he&224)==192){ce+=String.fromCharCode((he&31)<<6|ye);continue}var xe=z[H++]&63;if((he&240)==224?he=(he&15)<<12|ye<<6|xe:he=(he&7)<<18|ye<<12|xe<<6|z[H++]&63,he<65536)ce+=String.fromCharCode(he);else{var be=he-65536;ce+=String.fromCharCode(55296|be>>10,56320|be&1023)}}return ce}function b(z,H){return z?D(G,z,H):""}function I(z,H,N,U){if(!(U>0))return 0;for(var J=N,ce=N+U-1,he=0;he<z.length;++he){var ye=z.charCodeAt(he);if(ye>=55296&&ye<=57343){var xe=z.charCodeAt(++he);ye=65536+((ye&1023)<<10)|xe&1023}if(ye<=127){if(N>=ce)break;H[N++]=ye}else if(ye<=2047){if(N+1>=ce)break;H[N++]=192|ye>>6,H[N++]=128|ye&63}else if(ye<=65535){if(N+2>=ce)break;H[N++]=224|ye>>12,H[N++]=128|ye>>6&63,H[N++]=128|ye&63}else{if(N+3>=ce)break;H[N++]=240|ye>>18,H[N++]=128|ye>>12&63,H[N++]=128|ye>>6&63,H[N++]=128|ye&63}}return H[N]=0,N-J}function O(z,H,N){return I(z,G,H,N)}function M(z){for(var H=0,N=0;N<z.length;++N){var U=z.charCodeAt(N);U<=127?H++:U<=2047?H+=2:U>=55296&&U<=57343?(H+=4,++N):H+=3}return H}var R,A,G,k,L,F,j,Y,ie;function de(z){R=z,o.HEAP8=A=new Int8Array(z),o.HEAP16=k=new Int16Array(z),o.HEAP32=F=new Int32Array(z),o.HEAPU8=G=new Uint8Array(z),o.HEAPU16=L=new Uint16Array(z),o.HEAPU32=j=new Uint32Array(z),o.HEAPF32=Y=new Float32Array(z),o.HEAPF64=ie=new Float64Array(z)}o.INITIAL_MEMORY;var ae,fe=[],we=[],_e=[];function Se(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)$(o.preRun.shift());st(fe)}function B(){st(we)}function P(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)K(o.postRun.shift());st(_e)}function $(z){fe.unshift(z)}function W(z){we.unshift(z)}function K(z){_e.unshift(z)}var Q=0,ee=null;function ge(z){Q++,o.monitorRunDependencies&&o.monitorRunDependencies(Q)}function De(z){if(Q--,o.monitorRunDependencies&&o.monitorRunDependencies(Q),Q==0&&ee){var H=ee;ee=null,H()}}function Le(z){o.onAbort&&o.onAbort(z),z="Aborted("+z+")",C(z),T=!0,z+=". Build with -sASSERTIONS for more info.";var H=new WebAssembly.RuntimeError(z);throw s(H),H}var Ge="data:application/octet-stream;base64,";function re(z){return z.startsWith(Ge)}function se(z){return z.startsWith("file://")}var ve;ve="openjphjs.wasm",re(ve)||(ve=h(ve));function le(z){try{if(z==ve&&x)return new Uint8Array(x);if(v)return v(z);throw"both async and sync fetching of the wasm failed"}catch(H){Le(H)}}function pe(){if(!x&&(l||d)){if(typeof fetch=="function"&&!se(ve))return fetch(ve,{credentials:"same-origin"}).then(function(z){if(!z.ok)throw"failed to load wasm binary file at '"+ve+"'";return z.arrayBuffer()}).catch(function(){return le(ve)});if(p)return new Promise(function(z,H){p(ve,function(N){z(new Uint8Array(N))},H)})}return Promise.resolve().then(function(){return le(ve)})}function We(){var z={env:te,wasi_snapshot_preview1:te};function H(he,ye){var xe=he.exports;o.asm=xe,S=o.asm.memory,de(S.buffer),ae=o.asm.__indirect_function_table,W(o.asm.__wasm_call_ctors),De()}ge();function N(he){H(he.instance)}function U(he){return pe().then(function(ye){return WebAssembly.instantiate(ye,z)}).then(function(ye){return ye}).then(he,function(ye){C("failed to asynchronously prepare wasm: "+ye),Le(ye)})}function J(){return!x&&typeof WebAssembly.instantiateStreaming=="function"&&!re(ve)&&!se(ve)&&!u&&typeof fetch=="function"?fetch(ve,{credentials:"same-origin"}).then(function(he){var ye=WebAssembly.instantiateStreaming(he,z);return ye.then(N,function(xe){return C("wasm streaming compile failed: "+xe),C("falling back to ArrayBuffer instantiation"),U(N)})}):U(N)}if(o.instantiateWasm)try{var ce=o.instantiateWasm(z,H);return ce}catch(he){C("Module.instantiateWasm callback failed with error: "+he),s(he)}return J().catch(s),{}}function oe(z){this.name="ExitStatus",this.message="Program terminated with exit("+z+")",this.status=z}function st(z){for(;z.length>0;)z.shift()(o)}function gt(z,H,N,U){Le("Assertion failed: "+b(z)+", at: "+[H?b(H):"unknown filename",N,U?b(U):"unknown function"])}var ct=[];function Ee(z){z.add_ref()}function ze(z){var H=new nt(z);return H.get_caught()||H.set_caught(!0),H.set_rethrown(!1),ct.push(H),Ee(H),H.get_exception_ptr()}var Ke=0,Je=[];function lt(z){var H=Je[z];return H||(z>=Je.length&&(Je.length=z+1),Je[z]=H=ae.get(z)),H}function Oe(z){if(z.release_ref()&&!z.get_rethrown()){var H=z.get_destructor();H&&lt(H)(z.excPtr),Pe(z.excPtr)}}function ke(){_setThrew(0);var z=ct.pop();Oe(z),Ke=0}function nt(z){this.excPtr=z,this.ptr=z-24,this.set_type=function(H){j[this.ptr+4>>2]=H},this.get_type=function(){return j[this.ptr+4>>2]},this.set_destructor=function(H){j[this.ptr+8>>2]=H},this.get_destructor=function(){return j[this.ptr+8>>2]},this.set_refcount=function(H){F[this.ptr>>2]=H},this.set_caught=function(H){H=H?1:0,A[this.ptr+12>>0]=H},this.get_caught=function(){return A[this.ptr+12>>0]!=0},this.set_rethrown=function(H){H=H?1:0,A[this.ptr+13>>0]=H},this.get_rethrown=function(){return A[this.ptr+13>>0]!=0},this.init=function(H,N){this.set_adjusted_ptr(0),this.set_type(H),this.set_destructor(N),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var H=F[this.ptr>>2];F[this.ptr>>2]=H+1},this.release_ref=function(){var H=F[this.ptr>>2];return F[this.ptr>>2]=H-1,H===1},this.set_adjusted_ptr=function(H){j[this.ptr+16>>2]=H},this.get_adjusted_ptr=function(){return j[this.ptr+16>>2]},this.get_exception_ptr=function(){var H=bt(this.get_type());if(H)return j[this.excPtr>>2];var N=this.get_adjusted_ptr();return N!==0?N:this.excPtr}}function wt(z){throw Ke||(Ke=z),z}function gn(){var z=Ke;if(!z)return tt(0),0;var H=new nt(z);H.set_adjusted_ptr(z);var N=H.get_type();if(!N)return tt(0),z;for(var U=0;U<arguments.length;U++){var J=arguments[U];if(J===0||J===N)break;var ce=H.ptr+16;if(dt(J,N,ce))return tt(J),z}return tt(N),z}function Sn(){var z=Ke;if(!z)return tt(0),0;var H=new nt(z);H.set_adjusted_ptr(z);var N=H.get_type();if(!N)return tt(0),z;for(var U=0;U<arguments.length;U++){var J=arguments[U];if(J===0||J===N)break;var ce=H.ptr+16;if(dt(J,N,ce))return tt(J),z}return tt(N),z}function ln(z,H,N){var U=new nt(z);throw U.init(H,N),Ke=z,z}var on={};function pi(z){for(;z.length;){var H=z.pop(),N=z.pop();N(H)}}function Xt(z){return this.fromWireType(F[z>>2])}var Be={},rt={},Mt={},vn=48,mi=57;function nn(z){if(z===void 0)return"_unknown";z=z.replace(/[^a-zA-Z0-9_]/g,"$");var H=z.charCodeAt(0);return H>=vn&&H<=mi?"_"+z:z}function Pn(z,H){return z=nn(z),new Function("body","return function "+z+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(H)}function Ri(z,H){var N=Pn(H,function(U){this.name=H,this.message=U;var J=new Error(U).stack;J!==void 0&&(this.stack=this.toString()+`
`+J.replace(/^Error(:[^\n]*)?\n/,""))});return N.prototype=Object.create(z.prototype),N.prototype.constructor=N,N.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},N}var pn=void 0;function Br(z){throw new pn(z)}function vi(z,H,N){z.forEach(function(ye){Mt[ye]=H});function U(ye){var xe=N(ye);xe.length!==z.length&&Br("Mismatched type converter count");for(var be=0;be<z.length;++be)sr(z[be],xe[be])}var J=new Array(H.length),ce=[],he=0;H.forEach((ye,xe)=>{rt.hasOwnProperty(ye)?J[xe]=rt[ye]:(ce.push(ye),Be.hasOwnProperty(ye)||(Be[ye]=[]),Be[ye].push(()=>{J[xe]=rt[ye],++he,he===ce.length&&U(J)}))}),ce.length===0&&U(J)}function Ta(z){var H=on[z];delete on[z];var N=H.rawConstructor,U=H.rawDestructor,J=H.fields,ce=J.map(he=>he.getterReturnType).concat(J.map(he=>he.setterArgumentType));vi([z],ce,he=>{var ye={};return J.forEach((xe,be)=>{var Ae=xe.fieldName,Qe=he[be],at=xe.getter,_t=xe.getterContext,Ct=he[be+J.length],Yt=xe.setter,Kt=xe.setterContext;ye[Ae]={read:Rn=>Qe.fromWireType(at(_t,Rn)),write:(Rn,Tr)=>{var Pr=[];Yt(Kt,Rn,Ct.toWireType(Pr,Tr)),pi(Pr)}}}),[{name:H.name,fromWireType:function(xe){var be={};for(var Ae in ye)be[Ae]=ye[Ae].read(xe);return U(xe),be},toWireType:function(xe,be){for(var Ae in ye)if(!(Ae in be))throw new TypeError('Missing field:  "'+Ae+'"');var Qe=N();for(Ae in ye)ye[Ae].write(Qe,be[Ae]);return xe!==null&&xe.push(U,Qe),Qe},argPackAdvance:8,readValueFromPointer:Xt,destructorFunction:U}]})}function hc(z,H,N,U,J){}function qo(z){switch(z){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+z)}}function _a(){for(var z=new Array(256),H=0;H<256;++H)z[H]=String.fromCharCode(H);no=z}var no=void 0;function mr(z){for(var H="",N=z;G[N];)H+=no[G[N++]];return H}var ni=void 0;function mn(z){throw new ni(z)}function sr(z,H,N={}){if(!("argPackAdvance"in H))throw new TypeError("registerType registeredInstance requires argPackAdvance");var U=H.name;if(z||mn('type "'+U+'" must have a positive integer typeid pointer'),rt.hasOwnProperty(z)){if(N.ignoreDuplicateRegistrations)return;mn("Cannot register type '"+U+"' twice")}if(rt[z]=H,delete Mt[z],Be.hasOwnProperty(z)){var J=Be[z];delete Be[z],J.forEach(ce=>ce())}}function ro(z,H,N,U,J){var ce=qo(N);H=mr(H),sr(z,{name:H,fromWireType:function(he){return!!he},toWireType:function(he,ye){return ye?U:J},argPackAdvance:8,readValueFromPointer:function(he){var ye;if(N===1)ye=A;else if(N===2)ye=k;else if(N===4)ye=F;else throw new TypeError("Unknown boolean type size: "+H);return this.fromWireType(ye[he>>ce])},destructorFunction:null})}function Eo(z){if(!(this instanceof wi)||!(z instanceof wi))return!1;for(var H=this.$$.ptrType.registeredClass,N=this.$$.ptr,U=z.$$.ptrType.registeredClass,J=z.$$.ptr;H.baseClass;)N=H.upcast(N),H=H.baseClass;for(;U.baseClass;)J=U.upcast(J),U=U.baseClass;return H===U&&N===J}function Yo(z){return{count:z.count,deleteScheduled:z.deleteScheduled,preservePointerOnDelete:z.preservePointerOnDelete,ptr:z.ptr,ptrType:z.ptrType,smartPtr:z.smartPtr,smartPtrType:z.smartPtrType}}function Jo(z){function H(N){return N.$$.ptrType.registeredClass.name}mn(H(z)+" instance already deleted")}var ri=!1;function gc(z){}function Cl(z){z.smartPtr?z.smartPtrType.rawDestructor(z.smartPtr):z.ptrType.registeredClass.rawDestructor(z.ptr)}function ii(z){z.count.value-=1;var H=z.count.value===0;H&&Cl(z)}function pc(z,H,N){if(H===N)return z;if(N.baseClass===void 0)return null;var U=pc(z,H,N.baseClass);return U===null?null:N.downcast(U)}var bo={};function Ea(){return Object.keys(io).length}function xl(){var z=[];for(var H in io)io.hasOwnProperty(H)&&z.push(io[H]);return z}var Kr=[];function hs(){for(;Kr.length;){var z=Kr.pop();z.$$.deleteScheduled=!1,z.delete()}}var Zo=void 0;function oi(z){Zo=z,Kr.length&&Zo&&Zo(hs)}function gs(){o.getInheritedInstanceCount=Ea,o.getLiveInheritedInstances=xl,o.flushPendingDeletes=hs,o.setDelayFunction=oi}var io={};function Hi(z,H){for(H===void 0&&mn("ptr should not be undefined");z.baseClass;)H=z.upcast(H),z=z.baseClass;return H}function ba(z,H){return H=Hi(z,H),io[H]}function Gr(z,H){(!H.ptrType||!H.ptr)&&Br("makeClassHandle requires ptr and ptrType");var N=!!H.smartPtrType,U=!!H.smartPtr;return N!==U&&Br("Both smartPtrType and smartPtr must be specified"),H.count={value:1},Xi(Object.create(z,{$$:{value:H}}))}function Sl(z){var H=this.getPointee(z);if(!H)return this.destructor(z),null;var N=ba(this.registeredClass,H);if(N!==void 0){if(N.$$.count.value===0)return N.$$.ptr=H,N.$$.smartPtr=z,N.clone();var U=N.clone();return this.destructor(z),U}function J(){return this.isSmartPointer?Gr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:H,smartPtrType:this,smartPtr:z}):Gr(this.registeredClass.instancePrototype,{ptrType:this,ptr:z})}var ce=this.registeredClass.getActualType(H),he=bo[ce];if(!he)return J.call(this);var ye;this.isConst?ye=he.constPointerType:ye=he.pointerType;var xe=pc(H,this.registeredClass,ye.registeredClass);return xe===null?J.call(this):this.isSmartPointer?Gr(ye.registeredClass.instancePrototype,{ptrType:ye,ptr:xe,smartPtrType:this,smartPtr:z}):Gr(ye.registeredClass.instancePrototype,{ptrType:ye,ptr:xe})}function Xi(z){return typeof FinalizationRegistry>"u"?(Xi=H=>H,z):(ri=new FinalizationRegistry(H=>{ii(H.$$)}),Xi=H=>{var N=H.$$,U=!!N.smartPtr;if(U){var J={$$:N};ri.register(H,J,H)}return H},gc=H=>ri.unregister(H),Xi(z))}function mc(){if(this.$$.ptr||Jo(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var z=Xi(Object.create(Object.getPrototypeOf(this),{$$:{value:Yo(this.$$)}}));return z.$$.count.value+=1,z.$$.deleteScheduled=!1,z}function ps(){this.$$.ptr||Jo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&mn("Object already scheduled for deletion"),gc(this),ii(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Tl(){return!this.$$.ptr}function vc(){return this.$$.ptr||Jo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&mn("Object already scheduled for deletion"),Kr.push(this),Kr.length===1&&Zo&&Zo(hs),this.$$.deleteScheduled=!0,this}function yi(){wi.prototype.isAliasOf=Eo,wi.prototype.clone=mc,wi.prototype.delete=ps,wi.prototype.isDeleted=Tl,wi.prototype.deleteLater=vc}function wi(){}function yc(z,H,N){if(z[H].overloadTable===void 0){var U=z[H];z[H]=function(){return z[H].overloadTable.hasOwnProperty(arguments.length)||mn("Function '"+N+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+z[H].overloadTable+")!"),z[H].overloadTable[arguments.length].apply(this,arguments)},z[H].overloadTable=[],z[H].overloadTable[U.argCount]=U}}function Mr(z,H,N){o.hasOwnProperty(z)?((N===void 0||o[z].overloadTable!==void 0&&o[z].overloadTable[N]!==void 0)&&mn("Cannot register public name '"+z+"' twice"),yc(o,z,z),o.hasOwnProperty(N)&&mn("Cannot register multiple overloads of a function with the same number of arguments ("+N+")!"),o[z].overloadTable[N]=H):(o[z]=H,N!==void 0&&(o[z].numArguments=N))}function wc(z,H,N,U,J,ce,he,ye){this.name=z,this.constructor=H,this.instancePrototype=N,this.rawDestructor=U,this.baseClass=J,this.getActualType=ce,this.upcast=he,this.downcast=ye,this.pureVirtualFunctions=[]}function ms(z,H,N){for(;H!==N;)H.upcast||mn("Expected null or instance of "+N.name+", got an instance of "+H.name),z=H.upcast(z),H=H.baseClass;return z}function Da(z,H){if(H===null)return this.isReference&&mn("null is not a valid "+this.name),0;H.$$||mn('Cannot pass "'+ws(H)+'" as a '+this.name),H.$$.ptr||mn("Cannot pass deleted object as a pointer of type "+this.name);var N=H.$$.ptrType.registeredClass,U=ms(H.$$.ptr,N,this.registeredClass);return U}function er(z,H){var N;if(H===null)return this.isReference&&mn("null is not a valid "+this.name),this.isSmartPointer?(N=this.rawConstructor(),z!==null&&z.push(this.rawDestructor,N),N):0;H.$$||mn('Cannot pass "'+ws(H)+'" as a '+this.name),H.$$.ptr||mn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&H.$$.ptrType.isConst&&mn("Cannot convert argument of type "+(H.$$.smartPtrType?H.$$.smartPtrType.name:H.$$.ptrType.name)+" to parameter type "+this.name);var U=H.$$.ptrType.registeredClass;if(N=ms(H.$$.ptr,U,this.registeredClass),this.isSmartPointer)switch(H.$$.smartPtr===void 0&&mn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:H.$$.smartPtrType===this?N=H.$$.smartPtr:mn("Cannot convert argument of type "+(H.$$.smartPtrType?H.$$.smartPtrType.name:H.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:N=H.$$.smartPtr;break;case 2:if(H.$$.smartPtrType===this)N=H.$$.smartPtr;else{var J=H.clone();N=this.rawShare(N,Aa.toHandle(function(){J.delete()})),z!==null&&z.push(this.rawDestructor,N)}break;default:mn("Unsupporting sharing policy")}return N}function Ai(z,H){if(H===null)return this.isReference&&mn("null is not a valid "+this.name),0;H.$$||mn('Cannot pass "'+ws(H)+'" as a '+this.name),H.$$.ptr||mn("Cannot pass deleted object as a pointer of type "+this.name),H.$$.ptrType.isConst&&mn("Cannot convert argument of type "+H.$$.ptrType.name+" to parameter type "+this.name);var N=H.$$.ptrType.registeredClass,U=ms(H.$$.ptr,N,this.registeredClass);return U}function Ia(z){return this.rawGetPointee&&(z=this.rawGetPointee(z)),z}function Wr(z){this.rawDestructor&&this.rawDestructor(z)}function Cc(z){z!==null&&z.delete()}function qr(){ai.prototype.getPointee=Ia,ai.prototype.destructor=Wr,ai.prototype.argPackAdvance=8,ai.prototype.readValueFromPointer=Xt,ai.prototype.deleteObject=Cc,ai.prototype.fromWireType=Sl}function ai(z,H,N,U,J,ce,he,ye,xe,be,Ae){this.name=z,this.registeredClass=H,this.isReference=N,this.isConst=U,this.isSmartPointer=J,this.pointeeType=ce,this.sharingPolicy=he,this.rawGetPointee=ye,this.rawConstructor=xe,this.rawShare=be,this.rawDestructor=Ae,!J&&H.baseClass===void 0?U?(this.toWireType=Da,this.destructorFunction=null):(this.toWireType=Ai,this.destructorFunction=null):this.toWireType=er}function Ma(z,H,N){o.hasOwnProperty(z)||Br("Replacing nonexistant public symbol"),o[z].overloadTable!==void 0&&N!==void 0?o[z].overloadTable[N]=H:(o[z]=H,o[z].argCount=N)}function Oa(z,H,N){var U=o["dynCall_"+z];return N&&N.length?U.apply(null,[H].concat(N)):U.call(null,H)}function _l(z,H,N){if(z.includes("j"))return Oa(z,H,N);var U=lt(H).apply(null,N);return U}function Pa(z,H){var N=[];return function(){return N.length=0,Object.assign(N,arguments),_l(z,H,N)}}function jn(z,H){z=mr(z);function N(){return z.includes("j")?Pa(z,H):lt(H)}var U=N();return typeof U!="function"&&mn("unknown function pointer with signature "+z+": "+H),U}var vs=void 0;function Ra(z){var H=je(z),N=mr(H);return me(H),N}function Or(z,H){var N=[],U={};function J(ce){if(!U[ce]&&!rt[ce]){if(Mt[ce]){Mt[ce].forEach(J);return}N.push(ce),U[ce]=!0}}throw H.forEach(J),new vs(z+": "+N.map(Ra).join([", "]))}function ys(z,H,N,U,J,ce,he,ye,xe,be,Ae,Qe,at){Ae=mr(Ae),ce=jn(J,ce),ye&&(ye=jn(he,ye)),be&&(be=jn(xe,be)),at=jn(Qe,at);var _t=nn(Ae);Mr(_t,function(){Or("Cannot construct "+Ae+" due to unbound types",[U])}),vi([z,H,N],U?[U]:[],function(Ct){Ct=Ct[0];var Yt,Kt;U?(Yt=Ct.registeredClass,Kt=Yt.instancePrototype):Kt=wi.prototype;var Rn=Pn(_t,function(){if(Object.getPrototypeOf(this)!==Tr)throw new ni("Use 'new' to construct "+Ae);if(Pr.constructor_body===void 0)throw new ni(Ae+" has no accessible constructor");var bd=Pr.constructor_body[arguments.length];if(bd===void 0)throw new ni("Tried to invoke ctor of "+Ae+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Pr.constructor_body).toString()+") parameters instead!");return bd.apply(this,arguments)}),Tr=Object.create(Kt,{constructor:{value:Rn}});Rn.prototype=Tr;var Pr=new wc(Ae,Rn,Tr,at,Yt,ce,ye,be),Wl=new ai(Ae,Pr,!0,!1,!1),Oo=new ai(Ae+"*",Pr,!1,!1,!1),Zh=new ai(Ae+" const*",Pr,!1,!0,!1);return bo[z]={pointerType:Oo,constPointerType:Zh},Ma(_t,Rn),[Wl,Oo,Zh]})}function si(z,H){for(var N=[],U=0;U<z;U++)N.push(j[H+U*4>>2]);return N}function xc(z,H){if(!(z instanceof Function))throw new TypeError("new_ called with constructor type "+typeof z+" which is not a function");var N=Pn(z.name||"unknownFunctionName",function(){});N.prototype=z.prototype;var U=new N,J=z.apply(U,H);return J instanceof Object?J:U}function Do(z,H,N,U,J){var ce=H.length;ce<2&&mn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var he=H[1]!==null&&N!==null,ye=!1,xe=1;xe<H.length;++xe)if(H[xe]!==null&&H[xe].destructorFunction===void 0){ye=!0;break}for(var be=H[0].name!=="void",Ae="",Qe="",xe=0;xe<ce-2;++xe)Ae+=(xe!==0?", ":"")+"arg"+xe,Qe+=(xe!==0?", ":"")+"arg"+xe+"Wired";var at="return function "+nn(z)+"("+Ae+`) {
if (arguments.length !== `+(ce-2)+`) {
throwBindingError('function `+z+" called with ' + arguments.length + ' arguments, expected "+(ce-2)+` args!');
}
`;ye&&(at+=`var destructors = [];
`);var _t=ye?"destructors":"null",Ct=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Yt=[mn,U,J,pi,H[0],H[1]];he&&(at+="var thisWired = classParam.toWireType("+_t+`, this);
`);for(var xe=0;xe<ce-2;++xe)at+="var arg"+xe+"Wired = argType"+xe+".toWireType("+_t+", arg"+xe+"); // "+H[xe+2].name+`
`,Ct.push("argType"+xe),Yt.push(H[xe+2]);if(he&&(Qe="thisWired"+(Qe.length>0?", ":"")+Qe),at+=(be?"var rv = ":"")+"invoker(fn"+(Qe.length>0?", ":"")+Qe+`);
`,ye)at+=`runDestructors(destructors);
`;else for(var xe=he?1:2;xe<H.length;++xe){var Kt=xe===1?"thisWired":"arg"+(xe-2)+"Wired";H[xe].destructorFunction!==null&&(at+=Kt+"_dtor("+Kt+"); // "+H[xe].name+`
`,Ct.push(Kt+"_dtor"),Yt.push(H[xe].destructorFunction))}be&&(at+=`var ret = retType.fromWireType(rv);
return ret;
`),at+=`}
`,Ct.push(at);var Rn=xc(Function,Ct).apply(null,Yt);return Rn}function Li(z,H,N,U,J,ce){_(H>0);var he=si(H,N);J=jn(U,J),vi([],[z],function(ye){ye=ye[0];var xe="constructor "+ye.name;if(ye.registeredClass.constructor_body===void 0&&(ye.registeredClass.constructor_body=[]),ye.registeredClass.constructor_body[H-1]!==void 0)throw new ni("Cannot register multiple constructors with identical number of parameters ("+(H-1)+") for class '"+ye.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return ye.registeredClass.constructor_body[H-1]=()=>{Or("Cannot construct "+ye.name+" due to unbound types",he)},vi([],he,function(be){return be.splice(1,0,null),ye.registeredClass.constructor_body[H-1]=Do(xe,be,null,J,ce),[]}),[]})}function El(z,H,N,U,J,ce,he,ye){var xe=si(N,U);H=mr(H),ce=jn(J,ce),vi([],[z],function(be){be=be[0];var Ae=be.name+"."+H;H.startsWith("@@")&&(H=Symbol[H.substring(2)]),ye&&be.registeredClass.pureVirtualFunctions.push(H);function Qe(){Or("Cannot call "+Ae+" due to unbound types",xe)}var at=be.registeredClass.instancePrototype,_t=at[H];return _t===void 0||_t.overloadTable===void 0&&_t.className!==be.name&&_t.argCount===N-2?(Qe.argCount=N-2,Qe.className=be.name,at[H]=Qe):(yc(at,H,Ae),at[H].overloadTable[N-2]=Qe),vi([],xe,function(Ct){var Yt=Do(Ae,Ct,be,ce,he);return at[H].overloadTable===void 0?(Yt.argCount=N-2,at[H]=Yt):at[H].overloadTable[N-2]=Yt,[]}),[]})}var Io=[],ci=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Sc(z){z>4&&--ci[z].refcount===0&&(ci[z]=void 0,Io.push(z))}function bl(){for(var z=0,H=5;H<ci.length;++H)ci[H]!==void 0&&++z;return z}function Dl(){for(var z=5;z<ci.length;++z)if(ci[z]!==void 0)return ci[z];return null}function Tc(){o.count_emval_handles=bl,o.get_first_emval=Dl}var Aa={toValue:z=>(z||mn("Cannot use deleted val. handle = "+z),ci[z].value),toHandle:z=>{switch(z){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var H=Io.length?Io.pop():ci.length;return ci[H]={refcount:1,value:z},H}}}};function _c(z,H){H=mr(H),sr(z,{name:H,fromWireType:function(N){var U=Aa.toValue(N);return Sc(N),U},toWireType:function(N,U){return Aa.toHandle(U)},argPackAdvance:8,readValueFromPointer:Xt,destructorFunction:null})}function ws(z){if(z===null)return"null";var H=typeof z;return H==="object"||H==="array"||H==="function"?z.toString():""+z}function Il(z,H){switch(H){case 2:return function(N){return this.fromWireType(Y[N>>2])};case 3:return function(N){return this.fromWireType(ie[N>>3])};default:throw new TypeError("Unknown float type: "+z)}}function Ml(z,H,N){var U=qo(N);H=mr(H),sr(z,{name:H,fromWireType:function(J){return J},toWireType:function(J,ce){return ce},argPackAdvance:8,readValueFromPointer:Il(H,U),destructorFunction:null})}function Ol(z,H,N,U,J,ce){var he=si(H,N);z=mr(z),J=jn(U,J),Mr(z,function(){Or("Cannot call "+z+" due to unbound types",he)},H-1),vi([],he,function(ye){var xe=[ye[0],null].concat(ye.slice(1));return Ma(z,Do(z,xe,null,J,ce),H-1),[]})}function Cs(z,H,N){switch(H){case 0:return N?function(J){return A[J]}:function(J){return G[J]};case 1:return N?function(J){return k[J>>1]}:function(J){return L[J>>1]};case 2:return N?function(J){return F[J>>2]}:function(J){return j[J>>2]};default:throw new TypeError("Unknown integer type: "+z)}}function Pl(z,H,N,U,J){H=mr(H);var ce=qo(N),he=Qe=>Qe;if(U===0){var ye=32-8*N;he=Qe=>Qe<<ye>>>ye}var xe=H.includes("unsigned"),be=(Qe,at)=>{},Ae;xe?Ae=function(Qe,at){return be(at,this.name),at>>>0}:Ae=function(Qe,at){return be(at,this.name),at},sr(z,{name:H,fromWireType:he,toWireType:Ae,argPackAdvance:8,readValueFromPointer:Cs(H,ce,U!==0),destructorFunction:null})}function Rl(z,H,N){var U=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],J=U[H];function ce(he){he=he>>2;var ye=j,xe=ye[he],be=ye[he+1];return new J(R,be,xe)}N=mr(N),sr(z,{name:N,fromWireType:ce,argPackAdvance:8,readValueFromPointer:ce},{ignoreDuplicateRegistrations:!0})}function Al(z,H){H=mr(H);var N=H==="std::string";sr(z,{name:H,fromWireType:function(U){var J=j[U>>2],ce=U+4,he;if(N)for(var ye=ce,xe=0;xe<=J;++xe){var be=ce+xe;if(xe==J||G[be]==0){var Ae=be-ye,Qe=b(ye,Ae);he===void 0?he=Qe:(he+="\0",he+=Qe),ye=be+1}}else{for(var at=new Array(J),xe=0;xe<J;++xe)at[xe]=String.fromCharCode(G[ce+xe]);he=at.join("")}return me(U),he},toWireType:function(U,J){J instanceof ArrayBuffer&&(J=new Uint8Array(J));var ce,he=typeof J=="string";he||J instanceof Uint8Array||J instanceof Uint8ClampedArray||J instanceof Int8Array||mn("Cannot pass non-string to std::string"),N&&he?ce=M(J):ce=J.length;var ye=ne(4+ce+1),xe=ye+4;if(j[ye>>2]=ce,N&&he)O(J,xe,ce+1);else if(he)for(var be=0;be<ce;++be){var Ae=J.charCodeAt(be);Ae>255&&(me(xe),mn("String has UTF-16 code units that do not fit in 8 bits")),G[xe+be]=Ae}else for(var be=0;be<ce;++be)G[xe+be]=J[be];return U!==null&&U.push(me,ye),ye},argPackAdvance:8,readValueFromPointer:Xt,destructorFunction:function(U){me(U)}})}var xs=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ll(z,H){for(var N=z,U=N>>1,J=U+H/2;!(U>=J)&&L[U];)++U;if(N=U<<1,N-z>32&&xs)return xs.decode(G.subarray(z,N));for(var ce="",he=0;!(he>=H/2);++he){var ye=k[z+he*2>>1];if(ye==0)break;ce+=String.fromCharCode(ye)}return ce}function Ec(z,H,N){if(N===void 0&&(N=2147483647),N<2)return 0;N-=2;for(var U=H,J=N<z.length*2?N/2:z.length,ce=0;ce<J;++ce){var he=z.charCodeAt(ce);k[H>>1]=he,H+=2}return k[H>>1]=0,H-U}function bc(z){return z.length*2}function Nl(z,H){for(var N=0,U="";!(N>=H/4);){var J=F[z+N*4>>2];if(J==0)break;if(++N,J>=65536){var ce=J-65536;U+=String.fromCharCode(55296|ce>>10,56320|ce&1023)}else U+=String.fromCharCode(J)}return U}function Ss(z,H,N){if(N===void 0&&(N=2147483647),N<4)return 0;for(var U=H,J=U+N-4,ce=0;ce<z.length;++ce){var he=z.charCodeAt(ce);if(he>=55296&&he<=57343){var ye=z.charCodeAt(++ce);he=65536+((he&1023)<<10)|ye&1023}if(F[H>>2]=he,H+=4,H+4>J)break}return F[H>>2]=0,H-U}function Vl(z){for(var H=0,N=0;N<z.length;++N){var U=z.charCodeAt(N);U>=55296&&U<=57343&&++N,H+=4}return H}function Dc(z,H,N){N=mr(N);var U,J,ce,he,ye;H===2?(U=Ll,J=Ec,he=bc,ce=()=>L,ye=1):H===4&&(U=Nl,J=Ss,he=Vl,ce=()=>j,ye=2),sr(z,{name:N,fromWireType:function(xe){for(var be=j[xe>>2],Ae=ce(),Qe,at=xe+4,_t=0;_t<=be;++_t){var Ct=xe+4+_t*H;if(_t==be||Ae[Ct>>ye]==0){var Yt=Ct-at,Kt=U(at,Yt);Qe===void 0?Qe=Kt:(Qe+="\0",Qe+=Kt),at=Ct+H}}return me(xe),Qe},toWireType:function(xe,be){typeof be!="string"&&mn("Cannot pass non-string to C++ string type "+N);var Ae=he(be),Qe=ne(4+Ae+H);return j[Qe>>2]=Ae>>ye,J(be,Qe+4,Ae+H),xe!==null&&xe.push(me,Qe),Qe},argPackAdvance:8,readValueFromPointer:Xt,destructorFunction:function(xe){me(xe)}})}function Ic(z,H,N,U,J,ce){on[z]={name:mr(H),rawConstructor:jn(N,U),rawDestructor:jn(J,ce),fields:[]}}function Mc(z,H,N,U,J,ce,he,ye,xe,be){on[z].fields.push({fieldName:mr(H),getterReturnType:N,getter:jn(U,J),getterContext:ce,setterArgumentType:he,setter:jn(ye,xe),setterContext:be})}function Oc(z,H){H=mr(H),sr(z,{isVoid:!0,name:H,argPackAdvance:0,fromWireType:function(){},toWireType:function(N,U){}})}function kl(z){z>4&&(ci[z].refcount+=1)}function Fl(z,H){var N=rt[z];return N===void 0&&mn(H+" has unknown type "+Ra(z)),N}function Ul(z,H){z=Fl(z,"_emval_take_value");var N=z.readValueFromPointer(H);return Aa.toHandle(N)}function Ts(){Le("")}function Bl(z,H,N){G.copyWithin(z,H,H+N)}function Qo(){return 2147483648}function Gl(z){try{return S.grow(z-R.byteLength+65535>>>16),de(S.buffer),1}catch{}}function _s(z){var H=G.length;z=z>>>0;var N=Qo();if(z>N)return!1;let U=(xe,be)=>xe+(be-xe%be)%be;for(var J=1;J<=4;J*=2){var ce=H*(1+.2/J);ce=Math.min(ce,z+100663296);var he=Math.min(N,U(Math.max(z,ce),65536)),ye=Gl(he);if(ye)return!0}return!1}function Es(z){return 52}function Mo(z,H,N,U,J){return 70}var Ni=[null,[],[]];function Pc(z,H){var N=Ni[z];H===0||H===10?((z===1?y:C)(D(N,0)),N.length=0):N.push(H)}function Rc(z,H,N,U){for(var J=0,ce=0;ce<N;ce++){var he=j[H>>2],ye=j[H+4>>2];H+=8;for(var xe=0;xe<ye;xe++)Pc(z,G[he+xe]);J+=ye}return j[U>>2]=J,0}function bs(z){return z}function Ac(z){var H=o["_"+z];return H}function La(z,H){A.set(z,H)}function Ds(z,H,N,U,J){var ce={string:Ct=>{var Yt=0;if(Ct!=null&&Ct!==0){var Kt=(Ct.length<<2)+1;Yt=et(Kt),O(Ct,Yt,Kt)}return Yt},array:Ct=>{var Yt=et(Ct.length);return La(Ct,Yt),Yt}};function he(Ct){return H==="string"?b(Ct):H==="boolean"?!!Ct:Ct}var ye=Ac(z),xe=[],be=0;if(U)for(var Ae=0;Ae<U.length;Ae++){var Qe=ce[N[Ae]];Qe?(be===0&&(be=qe()),xe[Ae]=Qe(U[Ae])):xe[Ae]=U[Ae]}var at=ye.apply(null,xe);function _t(Ct){return be!==0&&He(be),he(Ct)}return at=_t(at),at}pn=o.InternalError=Ri(Error,"InternalError"),_a(),ni=o.BindingError=Ri(Error,"BindingError"),yi(),gs(),qr(),vs=o.UnboundTypeError=Ri(Error,"UnboundTypeError"),Tc();var te={__assert_fail:gt,__cxa_begin_catch:ze,__cxa_end_catch:ke,__cxa_find_matching_catch_2:gn,__cxa_find_matching_catch_3:Sn,__cxa_throw:ln,__resumeException:wt,_embind_finalize_value_object:Ta,_embind_register_bigint:hc,_embind_register_bool:ro,_embind_register_class:ys,_embind_register_class_constructor:Li,_embind_register_class_function:El,_embind_register_emval:_c,_embind_register_float:Ml,_embind_register_function:Ol,_embind_register_integer:Pl,_embind_register_memory_view:Rl,_embind_register_std_string:Al,_embind_register_std_wstring:Dc,_embind_register_value_object:Ic,_embind_register_value_object_field:Mc,_embind_register_void:Oc,_emval_decref:Sc,_emval_incref:kl,_emval_take_value:Ul,abort:Ts,emscripten_memcpy_big:Bl,emscripten_resize_heap:_s,fd_close:Es,fd_seek:Mo,fd_write:Rc,invoke_i:Ve,invoke_ii:Rt,invoke_iii:it,invoke_iiii:Te,invoke_v:ue,invoke_vi:X,invoke_viiii:q,invoke_viiiiii:Ze,llvm_eh_typeid_for:bs};We(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.__wasm_call_ctors).apply(null,arguments)};var ne=o._malloc=function(){return(ne=o._malloc=o.asm.malloc).apply(null,arguments)},me=o._free=function(){return(me=o._free=o.asm.free).apply(null,arguments)},Pe=o.___cxa_free_exception=function(){return(Pe=o.___cxa_free_exception=o.asm.__cxa_free_exception).apply(null,arguments)},je=o.___getTypeName=function(){return(je=o.___getTypeName=o.asm.__getTypeName).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm._embind_initialize_bindings).apply(null,arguments)},o.___errno_location=function(){return(o.___errno_location=o.asm.__errno_location).apply(null,arguments)};var tt=o.setTempRet0=function(){return(tt=o.setTempRet0=o.asm.setTempRet0).apply(null,arguments)},qe=o.stackSave=function(){return(qe=o.stackSave=o.asm.stackSave).apply(null,arguments)},He=o.stackRestore=function(){return(He=o.stackRestore=o.asm.stackRestore).apply(null,arguments)},et=o.stackAlloc=function(){return(et=o.stackAlloc=o.asm.stackAlloc).apply(null,arguments)},dt=o.___cxa_can_catch=function(){return(dt=o.___cxa_can_catch=o.asm.__cxa_can_catch).apply(null,arguments)},bt=o.___cxa_is_pointer_type=function(){return(bt=o.___cxa_is_pointer_type=o.asm.__cxa_is_pointer_type).apply(null,arguments)};o.dynCall_ji=function(){return(o.dynCall_ji=o.asm.dynCall_ji).apply(null,arguments)},o.dynCall_iiji=function(){return(o.dynCall_iiji=o.asm.dynCall_iiji).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.dynCall_jiji).apply(null,arguments)};function Rt(z,H){var N=qe();try{return lt(z)(H)}catch(U){if(He(N),U!==U+0)throw U;_setThrew(1,0)}}function X(z,H){var N=qe();try{lt(z)(H)}catch(U){if(He(N),U!==U+0)throw U;_setThrew(1,0)}}function q(z,H,N,U,J){var ce=qe();try{lt(z)(H,N,U,J)}catch(he){if(He(ce),he!==he+0)throw he;_setThrew(1,0)}}function ue(z){var H=qe();try{lt(z)()}catch(N){if(He(H),N!==N+0)throw N;_setThrew(1,0)}}function Te(z,H,N,U){var J=qe();try{return lt(z)(H,N,U)}catch(ce){if(He(J),ce!==ce+0)throw ce;_setThrew(1,0)}}function Ve(z){var H=qe();try{return lt(z)()}catch(N){if(He(H),N!==N+0)throw N;_setThrew(1,0)}}function Ze(z,H,N,U,J,ce,he){var ye=qe();try{lt(z)(H,N,U,J,ce,he)}catch(xe){if(He(ye),xe!==xe+0)throw xe;_setThrew(1,0)}}function it(z,H,N){var U=qe();try{return lt(z)(H,N)}catch(J){if(He(U),J!==J+0)throw J;_setThrew(1,0)}}o.ccall=Ds;var Xe;ee=function z(){Xe||ot(),Xe||(ee=z)};function ot(z){if(Q>0||(Se(),Q>0))return;function H(){Xe||(Xe=!0,o.calledRun=!0,!T&&(B(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),P()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),H()},1)):H()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return ot(),o.ready})})();t.exports=r})(Dv)),Dv.exports}var Jhe=Yhe();const Zhe=wa(Jhe),Qhe=new URL("/radiology-ai-viewer/assets/openjphjs-C-BUUy4a.wasm",import.meta.url),lf={codec:void 0,decoder:void 0,decodeConfig:{}};function ege(t,e,r){const n={width:e,height:r};for(;t>0;)n.width=Math.ceil(n.width/2),n.height=Math.ceil(n.height/2),t--;return n}function tge(t){if(lf.decodeConfig=t,lf.codec)return Promise.resolve();const e=Zhe({locateFile:r=>r.endsWith(".wasm")?Qhe.toString():r});return new Promise((r,n)=>{e.then(i=>{lf.codec=i,lf.decoder=new i.HTJ2KDecoder,r()},n)})}async function nge(t,e){await tge();const r=new lf.codec.HTJ2KDecoder,n=r.getEncodedBuffer(t.length);n.set(t);const i=e.decodeLevel||0;r.decodeSubResolution(i);const o=r.getFrameInfo();if(e.decodeLevel>0){const{width:E,height:D}=ege(e.decodeLevel,o.width,o.height);o.width=E,o.height=D}const a=r.getDecodedBuffer();new Uint8Array(a.length).set(a);const c=`x: ${r.getImageOffset().x}, y: ${r.getImageOffset().y}`,l=r.getNumDecompositions(),d=r.getNumLayers(),u=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][r.getProgressionOrder()+1],f=r.getIsReversible(),h=`${r.getBlockDimensions().width} x ${r.getBlockDimensions().height}`,g=`${r.getTileSize().width} x ${r.getTileSize().height}`,p=`${r.getTileOffset().x}, ${r.getTileOffset().y}`,v=`${a.length.toLocaleString()} bytes`,w=`${(a.length/n.length).toFixed(2)}:1`,m={columns:o.width,rows:o.height,bitsPerPixel:o.bitsPerSample,signed:o.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:o.componentCount};let y=rge(o,a);const{buffer:C,byteOffset:x,byteLength:S}=y,T=C.slice(x,x+S);y=new y.constructor(T);const _={imageOffset:c,numDecompositions:l,numLayers:d,progessionOrder:u,reversible:f,blockDimensions:h,tileSize:g,tileOffset:p,decodedSize:v,compressionRatio:w};return{...e,pixelData:y,imageInfo:m,encodeOptions:_,..._,...m}}function rge(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function ige(t,e){const r=t.length,{rescaleSlope:n,rescaleIntercept:i,suvbw:o,doseGridScaling:a}=e;if(e.modality==="PT"&&typeof o=="number"&&!isNaN(o))for(let s=0;s<r;s++)t[s]=o*(t[s]*n+i);else if(e.modality==="RTDOSE"&&typeof a=="number"&&!isNaN(a))for(let s=0;s<r;s++)t[s]=t[s]*a;else for(let s=0;s<r;s++)t[s]=t[s]*n+i;return!0}const oge={bilinear:vhe,replicate:yhe},uE={Uint8Array,Uint16Array,Int16Array,Float32Array,Uint32Array};function age(t,e,r,n){const i=t.pixelRepresentation!==void 0&&t.pixelRepresentation===1,o=i&&t.bitsStored!==void 0?32-t.bitsStored:void 0;if(i&&o!==void 0)for(let m=0;m<t.pixelData.length;m++)t.pixelData[m]=t.pixelData[m]<<o>>o;let a=t.pixelData;t.pixelDataLength=t.pixelData.length;const{min:s,max:c}=xx(t.pixelData),l=typeof e.allowFloatRendering<"u"?e.allowFloatRendering:!0;let d=oR(t.photometricInterpretation)&&e.targetBuffer?.offset===void 0;const f=e.preScale?.enabled&&Object.values(e.preScale.scalingParameters).some(m=>typeof m=="number"&&!Number.isInteger(m)),h=!e.preScale.enabled||!l&&f,g=e.targetBuffer?.type;if(g&&e.preScale.enabled&&!h){const m=e.preScale.scalingParameters,y=f5(s,c,m);d=!Afe(y.min,y.max,uE[g])}g&&!d?a=cge(e,t,uE,a):e.preScale.enabled&&!h?a=lge(e,s,c,t):a=gR(s,c,t);let p=s,v=c;if(e.preScale.enabled&&!h){const m=e.preScale.scalingParameters;if(pR(m),sge(m)){ige(a,m),t.preScale={...e.preScale,scaled:!0};const C=f5(s,c,m);p=C.min,v=C.max}}else h&&(t.preScale={enabled:!0,scaled:!1},p=s,v=c);t.pixelData=a,t.smallestPixelValue=p,t.largestPixelValue=v;const w=new Date().getTime();return t.decodeTimeInMS=w-r,t}function sge(t){const{rescaleSlope:e,rescaleIntercept:r,modality:n,doseGridScaling:i,suvbw:o}=t;return typeof e=="number"&&typeof r=="number"||n==="RTDOSE"&&typeof i=="number"||n==="PT"&&typeof o=="number"}function cge(t,e,r,n){const{arrayBuffer:i,type:o,offset:a=0,length:s,rows:c}=t.targetBuffer,l=r[o];if(!l)throw new Error(`target array ${o} is not supported, or doesn't exist.`);c&&c!=e.rows&&dge(e,t.targetBuffer,l);const d=e.pixelDataLength,u=a,f=s??d-u,h=e.pixelData;if(f!==h.length)throw new Error(`target array for image does not have the same length (${f}) as the decoded image length (${h.length}).`);const g=i?new l(i,u,f):new l(f);return g.set(h,0),n=g,n}function lge(t,e,r,n){const i=t.preScale.scalingParameters;pR(i);const o=f5(e,r,i);return gR(o.min,o.max,n)}function gR(t,e,r){const n=Sx(t,e),i=new n(r.pixelData.length);return i.set(r.pixelData,0),i}function f5(t,e,r){const{rescaleSlope:n,rescaleIntercept:i,modality:o,doseGridScaling:a,suvbw:s}=r;return o==="PT"&&typeof s=="number"&&!isNaN(s)?{min:s*(t*n+i),max:s*(e*n+i)}:o==="RTDOSE"&&typeof a=="number"&&!isNaN(a)?{min:t*a,max:e*a}:typeof n=="number"&&typeof i=="number"?{min:n*t+i,max:n*e+i}:{min:t,max:e}}function pR(t){if(!t)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function uge(t,e,r){const{samplesPerPixel:n}=t,{rows:i,columns:o}=e,a=i*o*n,s=new r(a),c=s.byteLength/a;return{pixelData:s,rows:i,columns:o,frameInfo:{...t.frameInfo,rows:i,columns:o},imageInfo:{...t.imageInfo,rows:i,columns:o,bytesPerPixel:c}}}function dge(t,e,r){const n=uge(t,e,r),{scalingType:i="replicate"}=e;return oge[i](t,n),Object.assign(t,n),t.pixelDataLength=t.pixelData.length,t}async function fge(t,e,r,n,i,o){const a=new Date().getTime();let s=null,c;switch(e){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":s=tE(t,r);break;case"1.2.840.10008.1.2.2":s=Che(t,r);break;case"1.2.840.10008.1.2.1.99":s=tE(t,r);break;case"1.2.840.10008.1.2.5":s=xhe(t,r);break;case"1.2.840.10008.1.2.4.50":c={...t},s=Ohe(r,c);break;case"1.2.840.10008.1.2.4.51":s=Nhe(t,r);break;case"1.2.840.10008.1.2.4.57":s=iE(t,r);break;case"1.2.840.10008.1.2.4.70":s=iE(t,r);break;case"1.2.840.10008.1.2.4.80":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=aE(r,c);break;case"1.2.840.10008.1.2.4.81":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=aE(r,c);break;case"1.2.840.10008.1.2.4.90":c={...t},s=cE(r,c);break;case"1.2.840.10008.1.2.4.91":c={...t},s=cE(r,c);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":c={...t},s=nge(r,c);break;default:throw new Error(`no decoder for transfer syntax ${e}`)}if(!s)throw new Error("decodePromise not defined");const l=await s,d=age(l,i,a);return o?.(d),d}const hge={decodeTask({imageFrame:t,transferSyntax:e,decodeConfig:r,options:n,pixelData:i,callbackFn:o}){return fge(t,e,i,r,n,o)}};h5(hge);const{init:gge,addTool:zd,ToolGroupManager:pge,PanTool:Iv,ZoomTool:Mv,WindowLevelTool:Ov,StackScrollTool:Pv,LengthTool:Rv,Enums:mge}=xde,{MouseBindings:jd,KeyboardBindings:vge}=mge,Ex=document.getElementById("dicomViewport"),yge=document.getElementById("status"),wge=document.getElementById("dicomFiles");let Av,O1;function sl(t){yge.textContent=t}async function Cge(){sl("Initializing Cornerstone..."),await GR(),await gge(),phe({dicomParser:Nde}),zd(Iv),zd(Mv),zd(Ov),zd(Pv),zd(Rv);const t="re1",e="vp1";Av=new Vq(t),Av.enableElement({viewportId:e,type:Nn.STACK,element:Ex}),O1=Av.getViewport(e);const n=pge.createToolGroup("tg1");n.addTool(Pv.toolName),n.addTool(Ov.toolName),n.addTool(Iv.toolName),n.addTool(Mv.toolName),n.addTool(Rv.toolName),n.addViewport(e,t),n.setToolActive(Ov.toolName,{bindings:[{mouseButton:jd.Primary}]}),n.setToolActive(Iv.toolName,{bindings:[{mouseButton:jd.Auxiliary}]}),n.setToolActive(Mv.toolName,{bindings:[{mouseButton:jd.Secondary}]}),n.setToolActive(Pv.toolName,{bindings:[{mouseButton:jd.Wheel}]}),n.setToolActive(Rv.toolName,{bindings:[{mouseButton:jd.Primary,modifierKey:vge.Shift}]}),O1.render(),sl("Ready. Choose DICOM files (one series) to load.")}async function mR(t){const e=Array.from(t||[]).filter(n=>n&&n.size>0);if(e.length===0)return;sl("Indexing files...");const r=e.map(n=>Bfe.fileManager.add(n));sl("Loading stack..."),await O1.setStack(r),O1.render(),sl("Loaded "+r.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom, Shift+left length.")}wge.addEventListener("change",async t=>{try{await mR(t.target.files)}catch(e){console.error(e),sl("Load failed. Try selecting only one series.")}});Ex.addEventListener("dragover",t=>{t.preventDefault()});Ex.addEventListener("drop",async t=>{t.preventDefault();try{await mR(t.dataTransfer.files)}catch(e){console.error(e),sl("Drop failed. Try selecting only one series.")}});Cge().catch(t=>{console.error(t),sl("Initialization failed. Check console.")});
