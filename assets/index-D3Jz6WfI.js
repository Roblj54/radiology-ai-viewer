const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DdKylV0O.js","assets/index-Cp4iUYqv.js","assets/Texture-C9D3AFRO.js","assets/imageRetrievalPoolManager-DiP2nqZv.js","assets/index-BFl08faP.js","assets/index-DBDK9yKC.js"])))=>i.map(i=>d[i]);
(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const l of e.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&p(l)}).observe(document,{childList:!0,subtree:!0});function i(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function p(o){if(o.ep)return;o.ep=!0;const e=i(o);fetch(o.href,e)}})();const z="modulepreload",R=function(r){return"/radiology-ai-viewer/"+r},N={},M=function(a,i,p){let o=Promise.resolve();if(i&&i.length>0){let y=function(c){return Promise.all(c.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");o=y(i.map(c=>{if(c=R(c),c in N)return;N[c]=!0;const g=c.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${v}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":z,g||(d.as="script"),d.crossOrigin="",d.href=c,u&&d.setAttribute("nonce",u),document.head.appendChild(d),g)return new Promise((x,s)=>{d.addEventListener("load",x),d.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${c}`)))})}))}function e(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return o.then(l=>{for(const u of l||[])u.status==="rejected"&&e(u.reason);return a().catch(e)})};function q(r){const a=r&&r.viewport,i=r&&r.container;if(!i)throw new Error("setupAIMockOverlay: container is required");window.getComputedStyle(i).position==="static"&&(i.style.position="relative");const o=document.createElement("canvas");o.style.position="absolute",o.style.inset="0",o.style.pointerEvents="none",o.style.zIndex="9998",o.style.width="100%",o.style.height="100%",i.appendChild(o);const e=o.getContext("2d");let l=!1,u=[],y=[],c=[];const g=!!(a&&typeof a.canvasToWorld=="function"&&typeof a.worldToCanvas=="function"),v=(t,n)=>g?a.canvasToWorld([t,n]):[t,n,0],d=t=>g?a.worldToCanvas(t):[t[0],t[1]],x=(t,n)=>Math.hypot(t[0]-n[0],t[1]-n[1],(t[2]||0)-(n[2]||0));function s(){const t=a&&typeof a.getCanvas=="function"&&a.getCanvas()||i.querySelector("canvas"),n=t&&t.width?t.width:i.clientWidth,f=t&&t.height?t.height:i.clientHeight;o.width!==n&&(o.width=n),o.height!==f&&(o.height=f)}function m(t,n){s();const f=t*o.width,w=n*o.height;return v(f,w)}function A(){u=[{a:m(.28,.3),b:m(.55,.58),label:"Nodule 0.87"},{a:m(.62,.22),b:m(.82,.4),label:"Mass 0.73"}],y=[(()=>{const t=m(.48,.52),n=m(.56,.52);return{c:t,e:n,w:.55}})(),(()=>{const t=m(.7,.35),n=m(.76,.35);return{c:t,e:n,w:.35}})()],c=[(()=>{const t=m(.3,.72),n=m(.52,.72);return{p1:t,p2:n,label:"AI length"}})()]}function h(){e.clearRect(0,0,o.width,o.height)}function T(){if(s(),h(),!!l){e.save(),e.lineWidth=2,e.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial",e.textBaseline="top";for(const t of y){const n=d(t.c),f=d(t.e),w=Math.hypot(n[0]-f[0],n[1]-f[1]),S=e.createRadialGradient(n[0],n[1],0,n[0],n[1],w);S.addColorStop(0,"rgba(255,0,0,"+.35*t.w+")"),S.addColorStop(1,"rgba(255,0,0,0)"),e.fillStyle=S,e.beginPath(),e.arc(n[0],n[1],w,0,Math.PI*2),e.fill()}e.strokeStyle="rgba(0,255,0,0.9)",e.fillStyle="rgba(0,255,0,0.9)";for(const t of u){const n=d(t.a),f=d(t.b),w=Math.min(n[0],f[0]),S=Math.min(n[1],f[1]),O=Math.abs(n[0]-f[0]),W=Math.abs(n[1]-f[1]);e.strokeRect(w,S,O,W),e.fillText(t.label,w+3,S+3)}e.strokeStyle="rgba(255,255,0,0.95)",e.fillStyle="rgba(255,255,0,0.95)";for(const t of c){const n=d(t.p1),f=d(t.p2);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(f[0],f[1]),e.stroke();const w=x(t.p1,t.p2).toFixed(1);e.fillText(t.label+": "+w+" mm",(n[0]+f[0])/2+6,(n[1]+f[1])/2+6)}e.restore()}}const E=()=>window.requestAnimationFrame(T);return window.addEventListener("resize",E,{passive:!0}),i.addEventListener("wheel",E,{passive:!0}),i.addEventListener("pointermove",E,{passive:!0}),i.addEventListener("pointerup",E,{passive:!0}),{start(){l=!0,A(),T()},stop(){l=!1,T()},toggle(){l?this.stop():this.start()},redraw:T,destroy(){try{o.remove()}catch{}window.removeEventListener("resize",E)}}}const I=document.getElementById("dicomViewport"),P=document.getElementById("status"),V=document.getElementById("dicomFiles");let C,L,_;function b(r){P&&(P.textContent=r)}function k(r){return r?.stack||r?.message||String(r)}b("main.js running. Loading Cornerstone modules...");async function D(){try{const r=await M(()=>import("./index-DdKylV0O.js"),__vite__mapDeps([0,1,2,3])),a=await M(()=>import("./index-BFl08faP.js"),__vite__mapDeps([4,1,2])),i=await M(()=>import("./index-DBDK9yKC.js"),__vite__mapDeps([5,1,3]));if(b("Initializing Cornerstone..."),await r.init(),await a.init(),i.init({maxWebWorkers:navigator.hardwareConcurrency||1}),_=i.wadouri,!_?.fileManager?.add)throw new Error("wadouri.fileManager.add is missing. DICOM image loader did not initialize.");const{addTool:p,ToolGroupManager:o,PanTool:e,ZoomTool:l,WindowLevelTool:u,StackScrollTool:y,LengthTool:c,Enums:g}=a;p(e),p(l),p(u),p(y),p(c);const v="re1",d="vp1";C=new r.RenderingEngine(v),C.enableElement({viewportId:d,type:r.Enums.ViewportType.STACK,element:I}),L=C.getViewport(d),(()=>{try{if(window.__aiMock)return;let h=document.getElementById("btnAIMock");h||(h=document.createElement("button"),h.id="btnAIMock",h.type="button",h.textContent="AI Overlay (mock)",h.style.cssText="position:fixed; top:12px; right:12px; z-index:9999; padding:8px 10px; border-radius:10px; border:1px solid #999; background:#fff; cursor:pointer;",document.body.appendChild(h));const T=document.querySelector("canvas"),E=typeof viewportElement<"u"&&viewportElement||typeof I<"u"&&I||document.getElementById("viewport")||document.querySelector("[data-viewport]")||(T?T.parentElement:null);if(!E){console.warn("AI overlay: could not find viewport container");return}window.__rav_viewport=I;const t=q({viewport:I,container:E});h.addEventListener("click",()=>t.toggle()),window.__aiMock=t}catch(h){console.warn("AI overlay init failed:",h)}})();const s=o.createToolGroup("tg1");s.addTool(y.toolName),s.addTool(u.toolName),s.addTool(e.toolName),s.addTool(l.toolName),s.addTool(c.toolName),s.addViewport(d,v);const m=g?.MouseBindings??null,A=g?.KeyboardBindings??null;m?(s.setToolActive(u.toolName,{bindings:[{mouseButton:m.Primary}]}),s.setToolActive(e.toolName,{bindings:[{mouseButton:m.Auxiliary}]}),s.setToolActive(l.toolName,{bindings:[{mouseButton:m.Secondary}]}),s.setToolActive(y.toolName,{bindings:[{mouseButton:m.Wheel}]}),A?.Shift!=null?s.setToolActive(c.toolName,{bindings:[{mouseButton:m.Primary,modifierKey:A.Shift}]}):s.setToolPassive(c.toolName)):(s.setToolActive(y.toolName),s.setToolActive(u.toolName),s.setToolPassive(e.toolName),s.setToolPassive(l.toolName),s.setToolPassive(c.toolName)),L.render(),b("Ready. Choose DICOM files (one series) to load.")}catch(r){console.error(r),b("Initialization failed:\\n"+k(r))}}async function B(r){const a=Array.from(r||[]).filter(i=>i&&i.size>0);if(a.length!==0){if(!L){b("Viewer not initialized yet. See error above.");return}try{a.sort((p,o)=>p.name.localeCompare(o.name,void 0,{numeric:!0,sensitivity:"base"})),b("Indexing files...");const i=a.map(p=>_.fileManager.add(p));b("Loading stack..."),await L.setStack(i),L.render(),b("Loaded "+i.length+" slices. Wheel scroll, left drag window/level, middle pan, right zoom.")}catch(i){console.error(i),b("Load failed:\\n"+k(i)+"\\nTry selecting only one series.")}}}V?.addEventListener("change",r=>B(r.target.files));I?.addEventListener("dragover",r=>{r.preventDefault()});I?.addEventListener("drop",r=>{r.preventDefault(),B(r.dataTransfer.files)});D();export{M as _};
